"use strict";(self.webpackChunkdefra=self.webpackChunkdefra||[]).push([[2377,5777,7844],{94932:function(e,t,n){n.r(t),n.d(t,{executeScript:function(){return V},extend:function(){return Q},functionHelper:function(){return U}});var r=n(95735),o=n(81216),i=n(26519),a=n(88464),s=n(45824),l=n(37568),c=n(70868),u=n(95341),f=n(69243),d=n(24962),h=n(73465),p=n(20234),w=n(90306),g=n(79146),m=n(86867),y=n(19371),v=n(77256),b=n(46556),A=n(57165);const S=100;async function D(e,t){const n=[];for(let r=0;r<t.arguments.length;r++)n.push(await P(e,t.arguments[r]));return n}async function T(e,t,n){return!0===t.preparsed?n(e,null,t.arguments):n(e,t,await D(e,t))}class k extends u.fF{constructor(e,t){super(),this.definition=null,this.context=null,this.definition=e,this.context=t}createFunction(e){return(...t)=>{const n={spatialReference:this.context.spatialReference,console:this.context.console,lrucache:this.context.lrucache,timeZone:this.context.timeZone??null,exports:this.context.exports,libraryResolver:this.context.libraryResolver,interceptor:this.context.interceptor,localScope:{},depthCounter:{depth:e.depthCounter+1},globalScope:this.context.globalScope};if(n.depthCounter.depth>64)throw new l.D$(e,l.TX.MaximumCallDepth,null);return G(this.definition,n,t,null)}}call(e,t){return I(e,t,((n,r,o)=>{const i={spatialReference:e.spatialReference,services:e.services,console:e.console,libraryResolver:e.libraryResolver,exports:e.exports,lrucache:e.lrucache,timeZone:e.timeZone??null,interceptor:e.interceptor,localScope:{},abortSignal:e.abortSignal,globalScope:e.globalScope,depthCounter:{depth:e.depthCounter.depth+1}};if(i.depthCounter.depth>64)throw new l.D$(e,l.TX.MaximumCallDepth,t);return G(this.definition,i,o,t)}))}marshalledCall(e,t,n,r){return r(e,t,(async(o,i,a)=>{const s={spatialReference:e.spatialReference,globalScope:n.globalScope,depthCounter:{depth:e.depthCounter.depth+1},libraryResolver:e.libraryResolver,exports:e.exports,console:e.console,abortSignal:e.abortSignal,lrucache:e.lrucache,timeZone:e.timeZone??null,interceptor:e.interceptor,localScope:{}};return a=a.map((t=>!(0,f.i)(t)||t instanceof u.CU?t:(0,u.o6)(t,e,r))),(0,u.o6)(await G(this.definition,s,a,t),n,r)}))}}class _ extends o.x{constructor(e){super(),this.source=e}async global(e){const t=this.executingContext.globalScope[e.toLowerCase()];if(t.valueset||(t.value=await P(this.executingContext,t.node),t.valueset=!0),(0,f.i)(t.value)&&!(t.value instanceof u.CU)){const e=new u.CU;e.fn=t.value,e.parameterEvaluator=I,e.context=this.executingContext,t.value=e}return t.value}setGlobal(e,t){if((0,f.i)(t))throw new l.D$(null,l.TX.AssignModuleFunction,null);this.executingContext.globalScope[e.toLowerCase()]={value:t,valueset:!0,node:null}}hasGlobal(e){return void 0===this.executingContext.exports[e]&&(e=e.toLowerCase()),void 0!==this.executingContext.exports[e]}async loadModule(e){let t=e.spatialReference;null==t&&(t=new A.A({wkid:102100})),this.moduleScope=z({},e.customfunctions,e.timeZone),this.executingContext={spatialReference:t,services:e.services,libraryResolver:new i.a(e.libraryResolver._moduleSingletons,this.source.syntax.loadedModules),exports:{},abortSignal:void 0===e.abortSignal||null===e.abortSignal?{aborted:!1}:e.abortSignal,globalScope:this.moduleScope,console:e.console??B,lrucache:e.lrucache,timeZone:e.timeZone??null,interceptor:e.interceptor,localScope:null,depthCounter:{depth:1}},await F(this.executingContext,this.source.syntax)}}async function I(e,t,n){return!0===t.preparsed?n(e,null,t.arguments):n(e,t,await D(e,t))}async function P(e,t){t.breakpoint&&await t.breakpoint();try{switch(t.type){case"UpdateExpression":return await async function(e,t){const n=t.argument;if("CallExpression"===n.type)throw new l.D$(e,l.TX.NeverReach,t);if("MemberExpression"===n.type){const r=await P(e,n.object);let o,i;if(!0===n.computed)o=await P(e,n.property);else{if("Identifier"!==n.property.type)throw new l.D$(e,l.TX.Unrecognized,t);o=n.property.name}if((0,f.o)(r)){if(!(0,f.b)(o))throw new l.D$(e,l.TX.ArrayAccessorMustBeNumber,t);if(o<0&&(o=r.length+o),o<0||o>=r.length)throw new l.D$(e,l.TX.OutOfBounds,t);i=(0,f.g)(r[o]),r[o]="++"===t.operator?i+1:i-1}else if(r instanceof s.A){if(!1===(0,f.c)(o))throw new l.D$(e,l.TX.KeyAccessorMustBeString,t);if(!0!==r.hasField(o))throw new l.D$(e,l.TX.FieldNotFound,t,{key:o});i=(0,f.g)(r.field(o)),r.setField(o,"++"===t.operator?i+1:i-1)}else if(r instanceof _){if(!1===(0,f.c)(o))throw new l.D$(e,l.TX.ModuleAccessorMustBeString,t);if(!0!==r.hasGlobal(o))throw new l.D$(e,l.TX.ModuleExportNotFound,t);i=(0,f.g)(await r.global(o)),r.setGlobal(o,"++"===t.operator?i+1:i-1)}else{if(!(0,f.r)(r))throw(0,f.q)(r)?new l.D$(e,l.TX.Immutable,t):new l.D$(e,l.TX.InvalidParameter,t);if(!1===(0,f.c)(o))throw new l.D$(e,l.TX.KeyAccessorMustBeString,t);if(!0!==r.hasField(o))throw new l.D$(e,l.TX.FieldNotFound,t,{key:o});i=(0,f.g)(r.field(o)),r.setField(o,"++"===t.operator?i+1:i-1)}return!1===t.prefix?i:"++"===t.operator?i+1:i-1}const o=(0,r.X)(n);let i;if(null!=e.localScope&&void 0!==e.localScope[o])return i=(0,f.g)(e.localScope[o].value),e.localScope[o]={value:"++"===t.operator?i+1:i-1,valueset:!0,node:t},!1===t.prefix?i:"++"===t.operator?i+1:i-1;if(void 0!==e.globalScope[o])return i=(0,f.g)(e.globalScope[o].value),e.globalScope[o]={value:"++"===t.operator?i+1:i-1,valueset:!0,node:t},!1===t.prefix?i:"++"===t.operator?i+1:i-1;throw new l.D$(e,l.TX.InvalidIdentifier,t)}(e,t);case"AssignmentExpression":return await async function(e,t){const n=t.left;if("MemberExpression"===n.type){const r=await P(e,n.object);let o;if(!0===n.computed)o=await P(e,n.property);else{if("Identifier"!==n.property.type)throw new l.D$(e,l.TX.InvalidIdentifier,t);o=n.property.name}const i=await P(e,t.right);if((0,f.o)(r)){if(!(0,f.b)(o))throw new l.D$(e,l.TX.ArrayAccessorMustBeNumber,t);if(o<0&&(o=r.length+o),o<0||o>r.length)throw new l.D$(e,l.TX.OutOfBounds,t);if(o===r.length){if("="!==t.operator)throw new l.D$(e,l.TX.OutOfBounds,t);r[o]=M(i,t.operator,r[o],t,e)}else r[o]=M(i,t.operator,r[o],t,e)}else if(r instanceof s.A){if(!1===(0,f.c)(o))throw new l.D$(e,l.TX.KeyAccessorMustBeString,t);if(!0===r.hasField(o))r.setField(o,M(i,t.operator,r.field(o),t,e));else{if("="!==t.operator)throw new l.D$(e,l.TX.FieldNotFound,t,{key:o});r.setField(o,M(i,t.operator,null,t,e))}}else if(r instanceof _){if(!1===(0,f.c)(o))throw new l.D$(e,l.TX.KeyAccessorMustBeString,t);if(!0!==r.hasGlobal(o))throw new l.D$(e,l.TX.ModuleExportNotFound,t);r.setGlobal(o,M(i,t.operator,await r.global(o),t,e))}else{if(!(0,f.r)(r))throw(0,f.q)(r)?new l.D$(e,l.TX.Immutable,t):new l.D$(e,l.TX.InvalidParameter,t);if(!1===(0,f.c)(o))throw new l.D$(e,l.TX.KeyAccessorMustBeString,t);if(!0===r.hasField(o))r.setField(o,M(i,t.operator,r.field(o),t,e));else{if("="!==t.operator)throw new l.D$(e,l.TX.FieldNotFound,t,{key:o});r.setField(o,M(i,t.operator,null,t,e))}}return f.z}const o=(0,r.X)(n);if(null!=e.localScope&&void 0!==e.localScope[o]){const n=await P(e,t.right);return e.localScope[o]={value:M(n,t.operator,e.localScope[o].value,t,e),valueset:!0,node:t.right},f.z}if(void 0!==e.globalScope[o]){const n=await P(e,t.right);return e.globalScope[o]={value:M(n,t.operator,e.globalScope[o].value,t,e),valueset:!0,node:t.right},f.z}throw new l.D$(e,l.TX.InvalidIdentifier,t)}(e,t);case"TemplateLiteral":return await async function(e,t){let n="",r=0;for(const o of t.quasis)if(n+=o.value?o.value.cooked:"",!1===o.tail){if(t.expressions[r]){const o=await P(e,t.expressions[r]);if((0,f.i)(o))throw new l.D$(e,l.TX.NoFunctionInTemplateLiteral,t);n+=(0,f.j)(o)}r++}return n}(e,t);case"Identifier":return await L(e,t);case"MemberExpression":return await async function(e,t){const n=await P(e,t.object);if(null===n)throw new l.D$(e,l.TX.MemberOfNull,t);if(!1===t.computed){if("Identifier"===t.property.type){if(n instanceof s.A||(0,f.r)(n))return n.field(t.property.name);if(n instanceof b.A)return(0,a.B)(n,t.property.name,e,t);if(n instanceof _){if(!n.hasGlobal(t.property.name))throw new l.D$(e,l.TX.InvalidIdentifier,t);return n.global(t.property.name)}throw new l.D$(e,l.TX.InvalidMemberAccessKey,t)}throw new l.D$(e,l.TX.InvalidMemberAccessKey,t)}let r=await P(e,t.property);if(n instanceof s.A||(0,f.r)(n)){if((0,f.c)(r))return n.field(r);throw new l.D$(e,l.TX.InvalidMemberAccessKey,t)}if(n instanceof _){if((0,f.c)(r))return n.global(r);throw new l.D$(e,l.TX.InvalidMemberAccessKey,t)}if(n instanceof b.A){if((0,f.c)(r))return(0,a.B)(n,r,e,t);throw new l.D$(e,l.TX.InvalidMemberAccessKey,t)}if((0,f.o)(n)){if((0,f.b)(r)&&isFinite(r)&&Math.floor(r)===r){if(r<0&&(r=n.length+r),r>=n.length||r<0)throw new l.D$(e,l.TX.OutOfBounds,t);return n[r]}throw new l.D$(e,l.TX.InvalidMemberAccessKey,t)}if((0,f.q)(n)){if((0,f.b)(r)&&isFinite(r)&&Math.floor(r)===r){if(r<0&&(r=n.length()+r),r>=n.length()||r<0)throw new l.D$(e,l.TX.OutOfBounds,t);return n.get(r)}throw new l.D$(e,l.TX.InvalidMemberAccessKey,t)}if((0,f.c)(n)){if((0,f.b)(r)&&isFinite(r)&&Math.floor(r)===r){if(r<0&&(r=n.length+r),r>=n.length||r<0)throw new l.D$(e,l.TX.OutOfBounds,t);return n[r]}throw new l.D$(e,l.TX.InvalidMemberAccessKey,t)}throw new l.D$(e,l.TX.InvalidMemberAccessKey,t)}(e,t);case"Literal":return t.value;case"CallExpression":return await async function(e,t){if("MemberExpression"===t.callee.type){const n=await P(e,t.callee.object);if(!(n instanceof _))throw new l.D$(e,l.TX.FunctionNotFound,t);const r=!1===t.callee.computed?t.callee.property.name:await P(e,t.callee.property);if(!n.hasGlobal(r))throw new l.D$(e,l.TX.FunctionNotFound,t);const o=await n.global(r);if(!(0,f.i)(o))throw new l.D$(e,l.TX.CallNonFunction,t);return o.call(e,t)}if("Identifier"!==t.callee.type)throw new l.D$(e,l.TX.FunctionNotFound,t);const n=(0,r.X)(t.callee);if(null!=e.localScope&&void 0!==e.localScope[n]){const r=e.localScope[n];if((0,f.i)(r.value))return r.value.call(e,t);throw new l.D$(e,l.TX.CallNonFunction,t)}if(void 0!==e.globalScope[n]){const r=e.globalScope[n];if((0,f.i)(r.value))return r.value.call(e,t);throw new l.D$(e,l.TX.CallNonFunction,t)}throw new l.D$(e,l.TX.FunctionNotFound,t)}(e,t);case"UnaryExpression":return await async function(e,t){const n=await P(e,t.argument);if((0,f.a)(n)){if("!"===t.operator)return!n;if("-"===t.operator)return-1*(0,f.g)(n);if("+"===t.operator)return 1*(0,f.g)(n);if("~"===t.operator)return~(0,f.g)(n);throw new l.D$(e,l.TX.UnsupportedUnaryOperator,t)}if("-"===t.operator)return-1*(0,f.g)(n);if("+"===t.operator)return 1*(0,f.g)(n);if("~"===t.operator)return~(0,f.g)(n);throw new l.D$(e,l.TX.UnsupportedUnaryOperator,t)}(e,t);case"BinaryExpression":return await async function(e,t){const n=await P(e,t.left),r=await P(e,t.right);switch(t.operator){case"|":case"<<":case">>":case">>>":case"^":case"&":return(0,f.F)((0,f.g)(n),(0,f.g)(r),t.operator);case"==":return(0,f.E)(n,r);case"!=":return!(0,f.E)(n,r);case"<":case">":case"<=":case">=":return(0,f.D)(n,r,t.operator);case"+":return(0,f.c)(n)||(0,f.c)(r)?(0,f.j)(n)+(0,f.j)(r):(0,f.g)(n)+(0,f.g)(r);case"-":return(0,f.g)(n)-(0,f.g)(r);case"*":return(0,f.g)(n)*(0,f.g)(r);case"/":return(0,f.g)(n)/(0,f.g)(r);case"%":return(0,f.g)(n)%(0,f.g)(r);default:throw new l.D$(e,l.TX.UnsupportedOperator,t)}}(e,t);case"LogicalExpression":return await async function(e,t){const n=await P(e,t.left);if(!(0,f.a)(n))throw new l.D$(e,l.TX.LogicalExpressionOnlyBoolean,t);switch(t.operator){case"||":{if(!0===n)return n;const r=await P(e,t.right);if((0,f.a)(r))return r;throw new l.D$(e,l.TX.LogicExpressionOrAnd,t)}case"&&":{if(!1===n)return n;const r=await P(e,t.right);if((0,f.a)(r))return r;throw new l.D$(e,l.TX.LogicExpressionOrAnd,t)}default:throw new l.D$(e,l.TX.LogicExpressionOrAnd,t)}}(e,t);case"ArrayExpression":return await async function(e,t){const n=[];for(let r=0;r<t.elements.length;r++)n.push(await P(e,t.elements[r]));for(let r=0;r<n.length;r++){if((0,f.i)(n[r]))throw new l.D$(e,l.TX.NoFunctionInArray,t);n[r]===f.z&&(n[r]=null)}return n}(e,t);case"ObjectExpression":return await async function(e,t){const n=[];for(let r=0;r<t.properties.length;r++){const o=t.properties[r],i=await P(e,o.value),a="Identifier"===o.key.type?o.key.name:await P(e,o.key);n[r]={key:a,value:i}}const r={},o=new Map;for(let i=0;i<n.length;i++){const a=n[i];if((0,f.i)(a.value))throw new l.D$(e,l.TX.NoFunctionInDictionary,t);if(!1===(0,f.c)(a.key))throw new l.D$(e,l.TX.KeyMustBeString,t);let s=a.key.toString();const c=s.toLowerCase();o.has(c)?s=o.get(c):o.set(c,s),a.value===f.z?r[s]=null:r[s]=a.value}const i=new s.A(r);return i.immutable=!1,i}(e,t);default:throw new l.D$(e,l.TX.Unrecognized,t)}}catch(n){throw(0,l.Nh)(e,t,n)}}async function $(e,t){t.breakpoint&&await t.breakpoint();try{switch(t.type){case"ImportDeclaration":return await async function(e,t){const n=(0,r.X)(t.specifiers[0].local),o=e.libraryResolver.loadLibrary(n);let i;return e.libraryResolver._moduleSingletons?.has(o.uri)?i=e.libraryResolver._moduleSingletons.get(o.uri):(i=new _(o),await i.loadModule(e),e.libraryResolver._moduleSingletons?.set(o.uri,i)),e.globalScope[n]={value:i,valueset:!0,node:t},f.z}(e,t);case"ExportNamedDeclaration":return await async function(e,t){if(await $(e,t.declaration),"FunctionDeclaration"===t.declaration.type)e.exports[(0,r.X)(t.declaration.id)]="function";else if("VariableDeclaration"===t.declaration.type)for(const n of t.declaration.declarations)e.exports[(0,r.X)(n.id)]="variable";return f.z}(e,t);case"VariableDeclaration":return await j(e,t,0);case"BlockStatement":return await F(e,t);case"FunctionDeclaration":return await async function(e,t){const n=(0,r.X)(t.id);return e.globalScope[n]={valueset:!0,node:null,value:new k(t,e)},f.z}(e,t);case"ReturnStatement":return await async function(e,t){if(null===t.argument)return new f.R(f.z);const n=await P(e,t.argument);return new f.R(n)}(e,t);case"IfStatement":return await async function(e,t){const n=await P(e,t.test);if(!0===n)return $(e,t.consequent);if(!1===n)return null!==t.alternate?$(e,t.alternate):f.z;throw new l.D$(e,l.TX.BooleanConditionRequired,t)}(e,t);case"ExpressionStatement":return await async function(e,t){const n=await P(e,t.expression);return n===f.z?f.z:new f.I(n)}(e,t);case"ForStatement":return await async function(e,t){try{return null!==t.init&&("VariableDeclaration"===t.init.type?await $(e,t.init):await P(e,t.init)),await new Promise(((n,r)=>{N(e,t,{testResult:!0,lastAction:f.z},(e=>{n(e)}),(e=>{r(e)}),0)}))}catch(e){throw e}}(e,t);case"WhileStatement":return await async function(e,t){const n={testResult:!0,lastAction:f.z};if(n.testResult=await P(e,t.test),!1===n.testResult)return f.z;if(!0!==n.testResult)throw new l.D$(e,l.TX.BooleanConditionRequired,t);for(;!0===n.testResult&&(n.lastAction=await $(e,t.body),n.lastAction!==f.A)&&!(n.lastAction instanceof f.R);)if(n.testResult=await P(e,t.test),!0!==n.testResult&&!1!==n.testResult)throw new l.D$(e,l.TX.BooleanConditionRequired,t);return n.lastAction instanceof f.R?n.lastAction:f.z}(e,t);case"ForInStatement":return await async function(e,t){return new Promise(((n,o)=>{P(e,t.right).then((i=>{try{let a;a="VariableDeclaration"===t.left.type?$(e,t.left):Promise.resolve(),a.then((()=>{try{const a=(0,r.X)("VariableDeclaration"===t.left.type?t.left.declarations[0].id:t.left);let c=null;if(null!=e.localScope&&void 0!==e.localScope[a]&&(c=e.localScope[a]),null===c&&void 0!==e.globalScope[a]&&(c=e.globalScope[a]),null===c)return void o(new l.D$(e,l.TX.InvalidIdentifier,t));(0,f.o)(i)||(0,f.c)(i)?E(e,t,i,{reject:o,resolve:n},c):(0,f.q)(i)?function(e,t,n,r,o,i){try{if(void 0===i&&(i="i"),0===n.length())return void r.resolve(f.z);O(e,t,n,o,0,i,(e=>{r.resolve(e)}),(e=>{r.reject(e)}),0)}catch(e){r.reject(e)}}(e,t,i,{reject:o,resolve:n},c):i instanceof s.A||(0,f.r)(i)?function(e,t,n,r,o){try{E(e,t,n.keys(),r,o,"k")}catch(e){r.reject(e)}}(e,t,i,{reject:o,resolve:n},c):(0,f.u)(i)?x(i.iterator(e.abortSignal),e,t,i,c,(e=>{n(e)}),(e=>{o(e)}),0):E(e,t,[],{reject:o,resolve:n},c)}catch(e){o(e)}}),o)}catch(e){o(e)}}),o)}))}(e,t);case"BreakStatement":return f.A;case"EmptyStatement":return f.z;case"ContinueStatement":return f.B;default:throw new l.D$(e,l.TX.Unrecognized,t)}}catch(n){throw(0,l.Nh)(e,t,n)}}async function X(e,t,n){const r=await $(e,t.body);return n.lastAction=r,n.lastAction===f.A||n.lastAction instanceof f.R?(n.testResult=!1,n):null!==t.update?(await P(e,t.update),n):n}function N(e,t,n,r,o,i){try{(async function(e,t,n){if(null!==t.test){const r=await P(e,t.test);if(!0===e.abortSignal?.aborted)throw new l.D$(e,l.TX.Cancelled,t);if(n.testResult=r,!1===n.testResult)return n;if(!0!==n.testResult)throw new l.D$(e,l.TX.BooleanConditionRequired,t);return X(e,t,n)}return X(e,t,n)})(e,t,n).then((()=>{try{!0===n.testResult?++i>S?(i=0,setTimeout((()=>{N(e,t,n,r,o,i)}),0)):N(e,t,n,r,o,i):n.lastAction instanceof f.R?r(n.lastAction):r(f.z)}catch(e){o(e)}}),(e=>{o(e)}))}catch(e){o(e)}}function R(e,t,n,r,o,i,a,s,l,c){try{if(r<=i)return void s(f.z);o.value="k"===a?n[i]:i,$(e,t.body).then((u=>{try{u instanceof f.R?s(u):u===f.A?s(f.z):++c>S?(c=0,setTimeout((()=>{R(e,t,n,r,o,i+1,a,s,l,c)}),0)):R(e,t,n,r,o,i+1,a,s,l,c)}catch(e){l(e)}}),(e=>{l(e)}))}catch(e){l(e)}}function O(e,t,n,r,o,i,a,s,l){try{if(n.length()<=o)return void a(f.z);r.value="k"===i?n.get(o):o,$(e,t.body).then((c=>{c instanceof f.R?a(c):c===f.A?a(f.z):++l>S?(l=0,setTimeout((()=>{O(e,t,n,r,o+1,i,a,s,l)}),0)):O(e,t,n,r,o+1,i,a,s,l)}),(e=>{s(e)}))}catch(e){s(e)}}function E(e,t,n,r,o,i){try{if(void 0===i&&(i="i"),0===n.length)return void r.resolve(f.z);R(e,t,n,n.length,o,0,i,(e=>{r.resolve(e)}),(e=>{r.reject(e)}),0)}catch(e){r.reject(e)}}function x(e,t,n,r,o,i,a,s){try{e.next().then((l=>{try{if(null===l)i(f.z);else{const u=c.A.createFromGraphicLikeObject(l.geometry,l.attributes,r,t.timeZone);u._underlyingGraphic=l,o.value=u,$(t,n.body).then((l=>{try{l===f.A?i(f.z):l instanceof f.R?i(l):++s>S?(s=0,setTimeout((()=>{x(e,t,n,r,o,i,a,s)}),0)):x(e,t,n,r,o,i,a,s)}catch(e){a(e)}}),(e=>{a(e)}))}}catch(e){a(e)}}),(e=>{a(e)}))}catch(e){a(e)}}function M(e,t,n,r,o){switch(t){case"=":return e===f.z?null:e;case"/=":return(0,f.g)(n)/(0,f.g)(e);case"*=":return(0,f.g)(n)*(0,f.g)(e);case"-=":return(0,f.g)(n)-(0,f.g)(e);case"+=":return(0,f.c)(n)||(0,f.c)(e)?(0,f.j)(n)+(0,f.j)(e):(0,f.g)(n)+(0,f.g)(e);case"%=":return(0,f.g)(n)%(0,f.g)(e);default:throw new l.D$(o,l.TX.UnsupportedOperator,r)}}async function F(e,t){return C(e,t,0)}async function C(e,t,n){if(n>=t.body.length)return f.z;const r=await $(e,t.body[n]);return r instanceof f.R||r===f.A||r===f.B||n===t.body.length-1?r:C(e,t,n+1)}async function j(e,t,n){return n>=t.declarations.length||(await async function(e,t){let n=null;if(n=null===t.init?null:await P(e,t.init),null!==e.localScope){if(n===f.z&&(n=null),"Identifier"!==t.id.type)throw new l.D$(e,l.TX.InvalidIdentifier,t);const o=(0,r.X)(t.id);return void(null!=e.localScope&&(e.localScope[o]={value:n,valueset:!0,node:t.init}))}if("Identifier"!==t.id.type)throw new l.D$(e,l.TX.InvalidIdentifier,t);const o=(0,r.X)(t.id);n===f.z&&(n=null),e.globalScope[o]={value:n,valueset:!0,node:t.init}}(e,t.declarations[n]),n===t.declarations.length-1||await j(e,t,n+1)),f.z}async function L(e,t){const n=(0,r.X)(t);if(null!=e.localScope&&void 0!==e.localScope[n]){const t=e.localScope[n];if(!0===t.valueset)return t.value;if(null!==t.d)return t.d;t.d=P(e,t.node);const r=await t.d;return t.value=r,t.valueset=!0,r}if(void 0!==e.globalScope[n]){const t=e.globalScope[n];if(!0===t.valueset)return t.value;if(null!==t.d)return t.d;t.d=P(e,t.node);const r=await t.d;return t.value=r,t.valueset=!0,r}throw new l.D$(e,l.TX.InvalidIdentifier,t)}const H={};async function J(e,t,n,r){const o=await P(e,t.arguments[n]);if((0,f.E)(o,r))return P(e,t.arguments[n+1]);const i=t.arguments.length-n;return 1===i?P(e,t.arguments[n]):2===i?null:3===i?P(e,t.arguments[n+2]):J(e,t,n+2,r)}async function K(e,t,n,r){if(!0===r)return P(e,t.arguments[n+1]);if(3==t.arguments.length-n)return P(e,t.arguments[n+2]);const o=await P(e,t.arguments[n+2]);if(!1===(0,f.a)(o))throw new l.D$(e,l.TX.ModuleExportNotFound,t.arguments[n+2]);return K(e,t,n+2,o)}async function G(e,t,n,o){const i=e.body;if(n.length!==e.params.length)throw new l.D$(t,l.TX.WrongNumberOfParameters,null);for(let o=0;o<n.length;o++){const i=e.params[o];"Identifier"===i.type&&null!=t.localScope&&(t.localScope[(0,r.X)(i)]={d:null,value:n[o],valueset:!0,node:null})}const a=await $(t,i);if(a instanceof f.R)return a.value;if(a===f.A)throw new l.D$(t,l.TX.UnexpectedToken,o);if(a===f.B)throw new l.D$(t,l.TX.UnexpectedToken,o);return a instanceof f.I?a.value:a}(0,p.d)(H,T),(0,v.d)(H,T),(0,m.d)(H,T),(0,g.d)(H,T),(0,y.d)(H,T),(0,w.registerFunctions)({functions:H,compiled:!1,signatures:null,evaluateIdentifier:null,mode:"async",standardFunction:T,standardFunctionAsync:I}),H.iif=async function(e,t){(0,f.G)(null===t.arguments?[]:t.arguments,3,3,e,t);const n=await P(e,t.arguments[0]);if(!1===(0,f.a)(n))throw new l.D$(e,l.TX.BooleanConditionRequired,t);return P(e,n?t.arguments[1]:t.arguments[2])},H.defaultvalue=async function(e,t){(0,f.G)(null===t.arguments?[]:t.arguments,2,3,e,t);const n=await P(e,t.arguments[0]);if(3===t.arguments.length){const r=await P(e,t.arguments[1]),o=(0,a.j)(n,r);return null!=o&&""!==o?o:P(e,t.arguments[2])}return null==n||""===n?P(e,t.arguments[1]):n},H.decode=async function(e,t){if(t.arguments.length<2)throw new l.D$(e,l.TX.WrongNumberOfParameters,t);if(2===t.arguments.length)return P(e,t.arguments[1]);if((t.arguments.length-1)%2==0)throw new l.D$(e,l.TX.WrongNumberOfParameters,t);return J(e,t,1,await P(e,t.arguments[0]))},H.when=async function(e,t){if(t.arguments.length<3)throw new l.D$(e,l.TX.WrongNumberOfParameters,t);if(t.arguments.length%2==0)throw new l.D$(e,l.TX.WrongNumberOfParameters,t);const n=await P(e,t.arguments[0]);if(!1===(0,f.a)(n))throw new l.D$(e,l.TX.BooleanConditionRequired,t.arguments[0]);return K(e,t,0,n)};const q={fixSpatialReference:f.x,parseArguments:D,standardFunction:T,standardFunctionAsync:I,evaluateIdentifier:L};for(const e in H)H[e]={value:new u.UQ(H[e]),valueset:!0,node:null};const W=function(){};function z(e,t,n){const r=new W;null==e&&(e={}),null==t&&(t={});const o=new s.A({newline:"\n",tab:"\t",singlequote:"'",doublequote:'"',forwardslash:"/",backwardslash:"\\"});o.immutable=!1,r.textformatting={value:o,valueset:!0,node:null};for(const e in t)r[e]={value:new u.UQ(t[e]),native:!0,valueset:!0,node:null};for(const t in e)r[t]={value:(0,f.C)(e[t])?c.A.createFromGraphic(e[t],n):e[t],valueset:!0,node:null};return r}function B(e){console.log(e)}W.prototype=H,W.prototype.infinity={value:Number.POSITIVE_INFINITY,valueset:!0,node:null},W.prototype.pi={value:Math.PI,valueset:!0,node:null};const U=q;function Q(e){const t={mode:"async",compiled:!1,functions:{},signatures:[],standardFunction:T,standardFunctionAsync:I,evaluateIdentifier:L};for(let n=0;n<e.length;n++)e[n].registerFunctions(t);for(const e in t.functions)H[e]={value:new u.UQ(t.functions[e]),valueset:!0,node:null},W.prototype[e]=H[e];for(let e=0;e<t.signatures.length;e++)(0,d.WC)(t.signatures[e],"async")}async function V(e,t){let n=t.spatialReference;null==n&&(n=new A.A({wkid:102100}));let r=null;e.usesModules&&(r=new i.a(new Map,e.loadedModules));const o=z(t.vars,t.customfunctions,t.timeZone),a={spatialReference:n,services:t.services,exports:{},libraryResolver:r,abortSignal:void 0===t.abortSignal||null===t.abortSignal?{aborted:!1}:t.abortSignal,globalScope:o,console:t.console??B,timeZone:t.timeZone??null,lrucache:t.lrucache,interceptor:t.interceptor,localScope:null,depthCounter:{depth:1}},s=await F(a,e);if(s instanceof f.R||s instanceof f.I){const e=s.value;if(e===f.z)return null;if((0,f.i)(e))throw new l.D$(a,l.TX.IllegalResult,null);return e}if(s===f.z)return null;if(s===f.A)throw new l.D$(a,l.TX.IllegalResult,null);if(s===f.B)throw new l.D$(a,l.TX.IllegalResult,null);throw new l.D$(a,l.TX.NeverReach,null)}Q([h.A])},90306:function(e,t,n){n.r(t),n.d(t,{registerFunctions:function(){return _}});var r=n(63022),o=n(45824),i=n(37568),a=n(80749),s=n(69243),l=n(30165),c=n(36254),u=n(86875),f=n(62938),d=n(91484),h=n(46556),p=n(75160),w=n(71673),g=n(45532),m=n(44740),y=n(91508),v=n(74697),b=n(51432),A=n(7156),S=n(93040);async function D(e,t,n){const r=A.id?.findCredential(e.restUrl);if(!r)return null;if("loaded"===e.loadStatus&&""===t&&e.user?.sourceJSON&&!1===n)return e.user.sourceJSON;const o={responseType:"json",query:{f:"json"}};if(n&&(o.query.returnUserLicenseTypeExtensions=!0),""===t){const t=await(0,S.A)(e.restUrl+"/community/self",o);if(t.data){const e=t.data;if(e?.username)return e}return null}const i=await(0,S.A)(e.restUrl+"/community/users/"+t,o);if(i.data){const e=i.data;return e.error?null:e}return null}function T(e,t,n){if((0,s.G)(e,2,2,t,n),e[0]instanceof h.A&&e[1]instanceof h.A);else if(e[0]instanceof h.A&&null===e[1]);else if(e[1]instanceof h.A&&null===e[0]);else if(null!==e[0]||null!==e[1])throw new i.D$(t,i.TX.InvalidParameter,n)}async function k(e,t){if("polygon"!==e.type&&"polyline"!==e.type&&"extent"!==e.type)return 0;let n=1;(e.spatialReference.vcsWkid||e.spatialReference.latestVcsWkid)&&(n=(0,c.G9)(e.spatialReference)/(0,f.GA)(e.spatialReference));let r=0;if("polyline"===e.type)for(const t of e.paths)for(let e=1;e<t.length;e++)r+=(0,c.BM)(t[e],t[e-1],n);else if("polygon"===e.type)for(const t of e.rings){for(let e=1;e<t.length;e++)r+=(0,c.BM)(t[e],t[e-1],n);(t[0][0]!==t[t.length-1][0]||t[0][1]!==t[t.length-1][1]||void 0!==t[0][2]&&t[0][2]!==t[t.length-1][2])&&(r+=(0,c.BM)(t[0],t[t.length-1],n))}else"extent"===e.type&&(r+=2*(0,c.BM)([e.xmin,e.ymin,0],[e.xmax,e.ymin,0],n),r+=2*(0,c.BM)([e.xmin,e.ymin,0],[e.xmin,e.ymax,0],n),r*=2,r+=4*Math.abs((0,s.K)(e.zmax,0)*n-(0,s.K)(e.zmin,0)*n));const o=new y.A({hasZ:!1,hasM:!1,spatialReference:e.spatialReference,paths:[[[0,0],[0,r]]]});return(0,p.planarLength)(o,t)}function _(e){"async"===e.mode&&(e.functions.disjoint=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>(T(o=(0,s.H)(o),t,n),null===o[0]||null===o[1]||(0,p.disjoint)(o[0],o[1]))))},e.functions.intersects=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>(T(o=(0,s.H)(o),t,n),null!==o[0]&&null!==o[1]&&(0,p.intersects)(o[0],o[1]))))},e.functions.touches=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>(T(o=(0,s.H)(o),t,n),null!==o[0]&&null!==o[1]&&(0,p.touches)(o[0],o[1]))))},e.functions.crosses=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>(T(o=(0,s.H)(o),t,n),null!==o[0]&&null!==o[1]&&(0,p.crosses)(o[0],o[1]))))},e.functions.within=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>(T(o=(0,s.H)(o),t,n),null!==o[0]&&null!==o[1]&&(0,p.within)(o[0],o[1]))))},e.functions.contains=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>(T(o=(0,s.H)(o),t,n),null!==o[0]&&null!==o[1]&&(0,p.contains)(o[0],o[1]))))},e.functions.overlaps=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>(T(o=(0,s.H)(o),t,n),null!==o[0]&&null!==o[1]&&(0,p.overlaps)(o[0],o[1]))))},e.functions.equals=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>((0,s.G)(o,2,2,t,n),o[0]===o[1]||(o[0]instanceof h.A&&o[1]instanceof h.A?(0,p.equals)(o[0],o[1]):((0,s.k)(o[0])&&(0,s.k)(o[1])||!!((0,s.n)(o[0])&&(0,s.n)(o[1])||(0,s.m)(o[0])&&(0,s.m)(o[1])))&&o[0].equals(o[1])))))},e.functions.relate=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>{if(o=(0,s.H)(o),(0,s.G)(o,3,3,t,n),o[0]instanceof h.A&&o[1]instanceof h.A)return(0,p.relate)(o[0],o[1],(0,s.j)(o[2]));if(o[0]instanceof h.A&&null===o[1])return!1;if(o[1]instanceof h.A&&null===o[0])return!1;if(null===o[0]&&null===o[1])return!1;throw new i.D$(t,i.TX.InvalidParameter,n)}))},e.functions.intersection=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>(T(o=(0,s.H)(o),t,n),null===o[0]||null===o[1]?null:(0,p.intersect)(o[0],o[1]))))},e.functions.union=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>{const l=[];if(0===(o=(0,s.H)(o)).length)throw new i.D$(t,i.TX.WrongNumberOfParameters,n);if(1===o.length)if((0,s.o)(o[0])){const e=(0,s.H)(o[0]);for(let r=0;r<e.length;r++)if(null!==e[r]){if(!(e[r]instanceof h.A))throw new i.D$(t,i.TX.InvalidParameter,n);l.push(e[r])}}else{if(!(0,s.q)(o[0])){if(o[0]instanceof h.A)return(0,s.x)((0,a.Yq)(o[0]),t.spatialReference);if(null===o[0])return null;throw new i.D$(t,i.TX.InvalidParameter,n)}{const e=(0,s.H)(o[0].toArray());for(let r=0;r<e.length;r++)if(null!==e[r]){if(!(e[r]instanceof h.A))throw new i.D$(t,i.TX.InvalidParameter,n);l.push(e[r])}}}else for(let e=0;e<o.length;e++)if(null!==o[e]){if(!(o[e]instanceof h.A))throw new i.D$(t,i.TX.InvalidParameter,n);l.push(o[e])}return 0===l.length?null:(0,p.union)(l)}))},e.functions.difference=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>(T(o=(0,s.H)(o),t,n),null===o[0]?null:null===o[1]?(0,a.Yq)(o[0]):(0,p.difference)(o[0],o[1]))))},e.functions.symmetricdifference=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>(T(o=(0,s.H)(o),t,n),null===o[0]&&null===o[1]?null:null===o[0]?(0,a.Yq)(o[1]):null===o[1]?(0,a.Yq)(o[0]):(0,p.symmetricDifference)(o[0],o[1]))))},e.functions.clip=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>{if(o=(0,s.H)(o),(0,s.G)(o,2,2,t,n),!(o[1]instanceof d.default)&&null!==o[1])throw new i.D$(t,i.TX.InvalidParameter,n);if(null===o[0])return null;if(!(o[0]instanceof h.A))throw new i.D$(t,i.TX.InvalidParameter,n);return null===o[1]?null:(0,p.clip)(o[0],o[1])}))},e.functions.cut=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>{if(o=(0,s.H)(o),(0,s.G)(o,2,2,t,n),!(o[1]instanceof y.A)&&null!==o[1])throw new i.D$(t,i.TX.InvalidParameter,n);if(null===o[0])return[];if(!(o[0]instanceof h.A))throw new i.D$(t,i.TX.InvalidParameter,n);return null===o[1]?[(0,a.Yq)(o[0])]:(0,p.cut)(o[0],o[1])}))},e.functions.area=function(t,n){return e.standardFunctionAsync(t,n,(async(e,r,o)=>{if((0,s.G)(o,1,2,t,n),null===(o=(0,s.H)(o))[0])return 0;if((0,s.u)(o[0])){const e=await o[0].sumArea((0,a.uf)((0,s.K)(o[1],-1)),!1,t.abortSignal);if(t.abortSignal.aborted)throw new i.D$(t,i.TX.Cancelled,n);return e}if((0,s.o)(o[0])||(0,s.q)(o[0])){const e=(0,s.J)(o[0],t.spatialReference);return null===e?0:(0,p.planarArea)(e,(0,a.uf)((0,s.K)(o[1],-1)))}if(!(o[0]instanceof h.A))throw new i.D$(t,i.TX.InvalidParameter,n);return(0,p.planarArea)(o[0],(0,a.uf)((0,s.K)(o[1],-1)))}))},e.functions.areageodetic=function(t,n){return e.standardFunctionAsync(t,n,(async(e,r,o)=>{if((0,s.G)(o,1,2,t,n),null===(o=(0,s.H)(o))[0])return 0;if((0,s.u)(o[0])){const e=await o[0].sumArea((0,a.uf)((0,s.K)(o[1],-1)),!0,t.abortSignal);if(t.abortSignal.aborted)throw new i.D$(t,i.TX.Cancelled,n);return e}if((0,s.o)(o[0])||(0,s.q)(o[0])){const e=(0,s.J)(o[0],t.spatialReference);return null===e?0:(0,p.geodesicArea)(e,(0,a.uf)((0,s.K)(o[1],-1)))}if(!(o[0]instanceof h.A))throw new i.D$(t,i.TX.InvalidParameter,n);return(0,p.geodesicArea)(o[0],(0,a.uf)((0,s.K)(o[1],-1)))}))},e.functions.length=function(t,n){return e.standardFunctionAsync(t,n,(async(e,r,o)=>{if((0,s.G)(o,1,2,t,n),null===(o=(0,s.H)(o))[0])return 0;if((0,s.u)(o[0])){const e=await o[0].sumLength((0,a.SQ)((0,s.K)(o[1],-1)),!1,t.abortSignal);if(t.abortSignal.aborted)throw new i.D$(t,i.TX.Cancelled,n);return e}if((0,s.o)(o[0])||(0,s.q)(o[0])){const e=(0,s.L)(o[0],t.spatialReference);return null===e?0:(0,p.planarLength)(e,(0,a.SQ)((0,s.K)(o[1],-1)))}if(!(o[0]instanceof h.A))throw new i.D$(t,i.TX.InvalidParameter,n);return(0,p.planarLength)(o[0],(0,a.SQ)((0,s.K)(o[1],-1)))}))},e.functions.length3d=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>{if((0,s.G)(o,1,2,t,n),null===(o=(0,s.H)(o))[0])return 0;if((0,s.o)(o[0])||(0,s.q)(o[0])){const e=(0,s.L)(o[0],t.spatialReference);return null===e?0:!0===e.hasZ?k(e,(0,a.SQ)((0,s.K)(o[1],-1))):(0,p.planarLength)(e,(0,a.SQ)((0,s.K)(o[1],-1)))}if(!(o[0]instanceof h.A))throw new i.D$(t,i.TX.InvalidParameter,n);return!0===o[0].hasZ?k(o[0],(0,a.SQ)((0,s.K)(o[1],-1))):(0,p.planarLength)(o[0],(0,a.SQ)((0,s.K)(o[1],-1)))}))},e.functions.lengthgeodetic=function(t,n){return e.standardFunctionAsync(t,n,(async(e,r,o)=>{if((0,s.G)(o,1,2,t,n),null===(o=(0,s.H)(o))[0])return 0;if((0,s.u)(o[0])){const e=await o[0].sumLength((0,a.SQ)((0,s.K)(o[1],-1)),!0,t.abortSignal);if(t.abortSignal.aborted)throw new i.D$(t,i.TX.Cancelled,n);return e}if((0,s.o)(o[0])||(0,s.q)(o[0])){const e=(0,s.L)(o[0],t.spatialReference);return null===e?0:(0,p.geodesicLength)(e,(0,a.SQ)((0,s.K)(o[1],-1)))}if(!(o[0]instanceof h.A))throw new i.D$(t,i.TX.InvalidParameter,n);return(0,p.geodesicLength)(o[0],(0,a.SQ)((0,s.K)(o[1],-1)))}))},e.functions.distance=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>{o=(0,s.H)(o),(0,s.G)(o,2,3,t,n);let l=o[0];((0,s.o)(o[0])||(0,s.q)(o[0]))&&(l=(0,s.M)(o[0],t.spatialReference));let c=o[1];if(((0,s.o)(o[1])||(0,s.q)(o[1]))&&(c=(0,s.M)(o[1],t.spatialReference)),!(l instanceof h.A))throw new i.D$(t,i.TX.InvalidParameter,n);if(!(c instanceof h.A))throw new i.D$(t,i.TX.InvalidParameter,n);return(0,p.distance)(l,c,(0,a.SQ)((0,s.K)(o[2],-1)))}))},e.functions.distancegeodetic=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>{o=(0,s.H)(o),(0,s.G)(o,2,3,t,n);const l=o[0],c=o[1];if(!(l instanceof g.default))throw new i.D$(t,i.TX.InvalidParameter,n);if(!(c instanceof g.default))throw new i.D$(t,i.TX.InvalidParameter,n);const u=new y.A({paths:[],spatialReference:l.spatialReference});return u.addPath([l,c]),(0,p.geodesicLength)(u,(0,a.SQ)((0,s.K)(o[2],-1)))}))},e.functions.densify=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>{if(o=(0,s.H)(o),(0,s.G)(o,2,3,t,n),null===o[0])return null;if(!(o[0]instanceof h.A))throw new i.D$(t,i.TX.InvalidParameter,n);const l=(0,s.g)(o[1]);if(isNaN(l))throw new i.D$(t,i.TX.InvalidParameter,n);if(l<=0)throw new i.D$(t,i.TX.InvalidParameter,n);return o[0]instanceof m.A||o[0]instanceof y.A?(0,p.densify)(o[0],l,(0,a.SQ)((0,s.K)(o[2],-1))):o[0]instanceof d.default?(0,p.densify)(m.A.fromExtent(o[0]),l,(0,a.SQ)((0,s.K)(o[2],-1))):o[0]}))},e.functions.densifygeodetic=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>{if(o=(0,s.H)(o),(0,s.G)(o,2,3,t,n),null===o[0])return null;if(!(o[0]instanceof h.A))throw new i.D$(t,i.TX.InvalidParameter,n);const l=(0,s.g)(o[1]);if(isNaN(l))throw new i.D$(t,i.TX.InvalidParameter,n);if(l<=0)throw new i.D$(t,i.TX.InvalidParameter,n);return o[0]instanceof m.A||o[0]instanceof y.A?(0,p.geodesicDensify)(o[0],l,(0,a.SQ)((0,s.K)(o[2],-1))):o[0]instanceof d.default?(0,p.geodesicDensify)(m.A.fromExtent(o[0]),l,(0,a.SQ)((0,s.K)(o[2],-1))):o[0]}))},e.functions.generalize=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>{if(o=(0,s.H)(o),(0,s.G)(o,2,4,t,n),null===o[0])return null;if(!(o[0]instanceof h.A))throw new i.D$(t,i.TX.InvalidParameter,n);const l=(0,s.g)(o[1]);if(isNaN(l))throw new i.D$(t,i.TX.InvalidParameter,n);return(0,p.generalize)(o[0],l,(0,s.h)((0,s.K)(o[2],!0)),(0,a.SQ)((0,s.K)(o[3],-1)))}))},e.functions.buffer=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>{if(o=(0,s.H)(o),(0,s.G)(o,2,3,t,n),null===o[0])return null;if(!(o[0]instanceof h.A))throw new i.D$(t,i.TX.InvalidParameter,n);const l=(0,s.g)(o[1]);if(isNaN(l))throw new i.D$(t,i.TX.InvalidParameter,n);return 0===l?(0,a.Yq)(o[0]):(0,p.buffer)(o[0],l,(0,a.SQ)((0,s.K)(o[2],-1)))}))},e.functions.buffergeodetic=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>{if(o=(0,s.H)(o),(0,s.G)(o,2,3,t,n),null===o[0])return null;if(!(o[0]instanceof h.A))throw new i.D$(t,i.TX.InvalidParameter,n);const l=(0,s.g)(o[1]);if(isNaN(l))throw new i.D$(t,i.TX.InvalidParameter,n);return 0===l?(0,a.Yq)(o[0]):(0,p.geodesicBuffer)(o[0],l,(0,a.SQ)((0,s.K)(o[2],-1)))}))},e.functions.offset=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>{if(o=(0,s.H)(o),(0,s.G)(o,2,6,t,n),null===o[0])return null;if(!(o[0]instanceof m.A||o[0]instanceof y.A))throw new i.D$(t,i.TX.InvalidParameter,n);const l=(0,s.g)(o[1]);if(isNaN(l))throw new i.D$(t,i.TX.InvalidParameter,n);const c=(0,s.g)((0,s.K)(o[4],10));if(isNaN(c))throw new i.D$(t,i.TX.InvalidParameter,n);const u=(0,s.g)((0,s.K)(o[5],0));if(isNaN(u))throw new i.D$(t,i.TX.InvalidParameter,n);return(0,p.offset)(o[0],l,(0,a.SQ)((0,s.K)(o[2],-1)),(0,s.j)((0,s.K)(o[3],"round")).toLowerCase(),c,u)}))},e.functions.rotate=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>{if(o=(0,s.H)(o),(0,s.G)(o,2,3,t,n),null===o[0])return null;if(!(o[0]instanceof h.A))throw new i.D$(t,i.TX.InvalidParameter,n);const a=o[0]instanceof d.default?m.A.fromExtent(o[0]):o[0],l=(0,s.g)(o[1]);if(isNaN(l))throw new i.D$(t,i.TX.InvalidParameter,n);const c=(0,s.K)(o[2],null);if(null===c)return(0,p.rotate)(a,l);if(c instanceof g.default)return(0,p.rotate)(a,l,c);throw new i.D$(t,i.TX.InvalidParameter,n)}))},e.functions.centroid=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>{if(o=(0,s.H)(o),(0,s.G)(o,1,1,t,n),null===o[0])return null;let l=o[0];if(((0,s.o)(o[0])||(0,s.q)(o[0]))&&(l=(0,s.M)(o[0],t.spatialReference)),null===l)return null;if(!(l instanceof h.A))throw new i.D$(t,i.TX.InvalidParameter,n);return l instanceof g.default?(0,s.x)((0,a.Yq)(l),t.spatialReference):l instanceof m.A?l.centroid:l instanceof y.A?(0,c.tI)(l):l instanceof w.A?(0,c.e0)(l):l instanceof d.default?l.center:null}))},e.functions.measuretocoordinate=function(t,n){return e.standardFunctionAsync(t,n,((e,r,a)=>{if(a=(0,s.H)(a),(0,s.G)(a,2,2,t,n),null===a[0])return null;let l=a[0];if(((0,s.o)(a[0])||(0,s.q)(a[0]))&&(l=(0,s.L)(a[0],t.spatialReference)),null===l)return null;if(!(l instanceof h.A))throw new i.D$(t,i.TX.InvalidParameter,n);if(!(l instanceof y.A))throw new i.D$(t,i.TX.InvalidParameter,n);if((0,s.b)(!1===a[1]))throw new i.D$(t,i.TX.InvalidParameter,n);const c=(0,u.EP)(l,a[1]);return c?o.A.convertObjectToArcadeDictionary(c,(0,s.N)(t),!1,!0):null}))},e.functions.pointtocoordinate=function(t,n){return e.standardFunctionAsync(t,n,((e,r,a)=>{if(a=(0,s.H)(a),(0,s.G)(a,2,2,t,n),null===a[0])return null;let l=a[0];if(((0,s.o)(a[0])||(0,s.q)(a[0]))&&(l=(0,s.L)(a[0],t.spatialReference)),null===l)return null;if(!(l instanceof h.A))throw new i.D$(t,i.TX.InvalidParameter,n);if(!(l instanceof y.A))throw new i.D$(t,i.TX.InvalidParameter,n);const c=a[1];if(null===c)return null;if(!(c instanceof g.default))throw new i.D$(t,i.TX.InvalidParameter,n);if((0,s.b)(!1===a[1]))throw new i.D$(t,i.TX.InvalidParameter,n);const f=(0,u.sO)(l,c);return f?o.A.convertObjectToArcadeDictionary(f,(0,s.N)(t),!1,!0):null}))},e.functions.distancetocoordinate=function(t,n){return e.standardFunctionAsync(t,n,((e,r,a)=>{if(a=(0,s.H)(a),(0,s.G)(a,2,2,t,n),null===a[0])return null;let l=a[0];if(((0,s.o)(a[0])||(0,s.q)(a[0]))&&(l=(0,s.L)(a[0],t.spatialReference)),null===l)return null;if(!(l instanceof h.A))throw new i.D$(t,i.TX.InvalidParameter,n);if(!(l instanceof y.A))throw new i.D$(t,i.TX.InvalidParameter,n);if((0,s.b)(!1===a[1]))throw new i.D$(t,i.TX.InvalidParameter,n);const c=(0,u.du)(l,a[1]);return c?o.A.convertObjectToArcadeDictionary(c,(0,s.N)(t),!1,!0):null}))},e.functions.multiparttosinglepart=function(t,n){return e.standardFunctionAsync(t,n,(async(e,r,o)=>{if(o=(0,s.H)(o),(0,s.G)(o,1,1,t,n),null===o[0])return null;if(!(o[0]instanceof h.A))throw new i.D$(t,i.TX.InvalidParameter,n);if(o[0]instanceof g.default)return[(0,s.x)((0,a.Yq)(o[0]),t.spatialReference)];if(o[0]instanceof d.default)return[(0,s.x)((0,a.Yq)(o[0]),t.spatialReference)];const l=await(0,p.simplify)(o[0]);if(l instanceof m.A){const e=[],t=[];for(let n=0;n<l.rings.length;n++)if(l.isClockwise(l.rings[n])){const t=(0,v.rS)({rings:[l.rings[n]],hasZ:!0===l.hasZ,hasM:!0===l.hasM,spatialReference:l.spatialReference.toJSON()});e.push(t)}else t.push({ring:l.rings[n],pt:l.getPoint(n,0)});for(let n=0;n<t.length;n++)for(let r=0;r<e.length;r++)if(e[r].contains(t[n].pt)){e[r].addRing(t[n].ring);break}return e}if(l instanceof y.A){const e=[];for(let t=0;t<l.paths.length;t++){const n=(0,v.rS)({paths:[l.paths[t]],hasZ:!0===l.hasZ,hasM:!0===l.hasM,spatialReference:l.spatialReference.toJSON()});e.push(n)}return e}if(o[0]instanceof w.A){const e=[],n=(0,s.x)((0,a.Yq)(o[0]),t.spatialReference);for(let t=0;t<n.points.length;t++)e.push(n.getPoint(t));return e}return null}))},e.functions.issimple=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>{if(o=(0,s.H)(o),(0,s.G)(o,1,1,t,n),null===o[0])return!0;if(!(o[0]instanceof h.A))throw new i.D$(t,i.TX.InvalidParameter,n);return(0,p.isSimple)(o[0])}))},e.functions.simplify=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>{if(o=(0,s.H)(o),(0,s.G)(o,1,1,t,n),null===o[0])return null;if(!(o[0]instanceof h.A))throw new i.D$(t,i.TX.InvalidParameter,n);return(0,p.simplify)(o[0])}))},e.functions.convexhull=function(t,n){return e.standardFunctionAsync(t,n,((e,r,o)=>{if(o=(0,s.H)(o),(0,s.G)(o,1,1,t,n),null===o[0])return null;if(!(o[0]instanceof h.A))throw new i.D$(t,i.TX.InvalidParameter,n);return(0,p.convexHull)(o[0])}))},e.functions.getuser=function(t,n){return e.standardFunctionAsync(t,n,(async(e,a,c)=>{(0,s.G)(c,0,2,t,n);let u=(0,s.K)(c[1],""),f=!0===u;if(u=!0===u||!1===u?"":(0,s.j)(u),0===c.length||c[0]instanceof r.A){let e;e=t.services?.portal?t.services.portal:b.A.getDefault(),c.length>0&&(e=(0,l.R)(c[0],e));const n=await D(e,u,f);if(n){const e=JSON.parse(JSON.stringify(n));for(const t of["lastLogin","created","modified"])void 0!==e[t]&&null!==e[t]&&(e[t]=new Date(e[t]));return o.A.convertObjectToArcadeDictionary(e,(0,s.N)(t))}return null}let d=null;if((0,s.u)(c[0])&&(d=c[0]),d){if(f=!1,u)return null;await d.load();const e=await d.getOwningSystemUrl();if(!e){if(!u){const e=await d.getIdentityUser();return e?o.A.convertObjectToArcadeDictionary({username:e},(0,s.N)(t)):null}return null}let n;n=t.services?.portal?t.services.portal:b.A.getDefault(),n=(0,l.R)(new r.A(e),n);const i=await D(n,u,f);if(i){const e=JSON.parse(JSON.stringify(i));for(const t of["lastLogin","created","modified"])void 0!==e[t]&&null!==e[t]&&(e[t]=new Date(e[t]));return o.A.convertObjectToArcadeDictionary(e,(0,s.N)(t))}return null}throw new i.D$(t,i.TX.InvalidParameter,n)}))},e.functions.nearestcoordinate=function(t,n){return e.standardFunctionAsync(t,n,(async(e,r,a)=>{if(a=(0,s.H)(a),(0,s.G)(a,2,2,t,n),!(a[0]instanceof h.A||null===a[0]))throw new i.D$(t,i.TX.InvalidParameter,n);if(!(a[1]instanceof g.default||null===a[1]))throw new i.D$(t,i.TX.InvalidParameter,n);if(null===a[0]||null===a[1])return null;const l=await(0,p.nearestCoordinate)(a[0],a[1]);return null===l?null:o.A.convertObjectToArcadeDictionary({coordinate:l.coordinate,distance:l.distance,sideOfLine:0===l.distance?"straddle":l.isRightSide?"right":"left"},(0,s.N)(t),!1,!0)}))},e.functions.nearestvertex=function(t,n){return e.standardFunctionAsync(t,n,(async(e,r,a)=>{if(a=(0,s.H)(a),(0,s.G)(a,2,2,t,n),!(a[0]instanceof h.A||null===a[0]))throw new i.D$(t,i.TX.InvalidParameter,n);if(!(a[1]instanceof g.default||null===a[1]))throw new i.D$(t,i.TX.InvalidParameter,n);if(null===a[0]||null===a[1])return null;const l=await(0,p.nearestVertex)(a[0],a[1]);return null===l?null:o.A.convertObjectToArcadeDictionary({coordinate:l.coordinate,distance:l.distance,sideOfLine:0===l.distance?"straddle":l.isRightSide?"right":"left"},(0,s.N)(t),!1,!0)}))})}},30165:function(e,t,n){n.d(t,{R:function(){return o}});var r=n(51432);function o(e,t){return null===e?t:new r.A({url:e.field("url")})}},37797:function(e,t,n){n.d(t,{A:function(){return c}});var r=n(61226),o=(n(58941),n(60539)),i=n(51846),a=n(13370),s=n(90465),l=n(50193);class c{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new i.A}destroy(){this.close()}get closed(){return!this._clients?.length}open(e,t){return new Promise(((n,r)=>{let i=!0;const a=e=>{(0,o.Te)(t.signal),i&&(i=!1,e())};this._clients.length=e.length,this._clientPromises.length=e.length,this._inUseClients.length=e.length;for(let i=0;i<e.length;++i){const s=e[i];(0,o.$X)(s)?this._clientPromises[i]=s.then((e=>(this._clients[i]=new l.A(e,t,this._ongoingJobsQueue),a(n),this._clients[i])),(()=>(a(r),null))):(this._clients[i]=new l.A(s,t,this._ongoingJobsQueue),this._clientPromises[i]=Promise.resolve(this._clients[i]),a(n))}}))}broadcast(e,t,n){const r=new Array(this._clientPromises.length);for(let o=0;o<this._clientPromises.length;++o){const i=this._clientPromises[o];r[o]=i.then((r=>r?.invoke(e,t,n)))}return r}close(){let e;for(;e=this._ongoingJobsQueue.pop();)e.resolver.reject((0,o.NK)(`Worker closing, aborting job calling '${e.methodName}'`));for(const e of this._clientPromises)e.then((e=>e?.close()));this._clients.length=0,this._clientPromises.length=0,this._inUseClients.length=0,(0,a.h)(this)}invoke(e,t,n){return this.apply(e,[t],n)}apply(e,t,n){const r=(0,o.Tw)();this._ongoingJobsQueue.push({methodName:e,data:t,invokeOptions:n,resolver:r});for(let e=0;e<this._clientPromises.length;e++){const t=this._clients[e];t?t.jobAdded():this._clientPromises[e].then((e=>e?.jobAdded()))}return r.promise}createInvokeProxy(e){return(0,s.L)(this,e)}on(e,t){return Promise.all(this._clientPromises).then((()=>(0,r.vE)(this._clients.map((n=>n.on(e,t))))))}openPorts(){return new Promise((e=>{const t=new Array(this._clientPromises.length);let n=t.length;for(let r=0;r<this._clientPromises.length;++r)this._clientPromises[r].then((o=>{o&&(t[r]=o.openPort()),0==--n&&e(t)}))}))}get test(){}}},90465:function(e,t,n){function r(e,t){return new Proxy({},{get:(n,r,o)=>(...n)=>{let o,i;const a=n[n.length-1];return function(e){return"object"==typeof e&&!Array.isArray(e)&&null!=e&&("signal"in e||"transferList"in e||0===Object.keys(e).length)}(a)&&(o=a.signal,i=a.transferList,n.pop()),e.apply(t?`${t}.${r.toString()}`:r.toString(),n,{transferList:i,signal:o})}})}n.d(t,{L:function(){return r}})},50193:function(e,t,n){n.d(t,{A:function(){return b}});var r=n(7156),o=n(39819),i=n(40212),a=n(61226),s=n(95929),l=n(60539),c=n(90465);const u={statsWorker:()=>n.e(1838).then(n.bind(n,27966)),geometryEngineWorker:()=>n.e(2384).then(n.bind(n,9568)),CSVSourceWorker:()=>n.e(2600).then(n.bind(n,80172)),EdgeProcessingWorker:()=>n.e(2933).then(n.bind(n,92273)),ElevationSamplerWorker:()=>n.e(5120).then(n.bind(n,55412)),FeatureServiceSnappingSourceWorker:()=>n.e(8246).then(n.bind(n,66038)),GeoJSONSourceWorker:()=>n.e(7253).then(n.bind(n,4389)),LercWorker:()=>n.e(6594).then(n.bind(n,67024)),MemorySourceWorker:()=>n.e(807).then(n.bind(n,8489)),PBFDecoderWorker:()=>n.e(8950).then(n.bind(n,19939)),FeaturePipelineWorker:()=>n.e(3806).then(n.bind(n,25423)),PointCloudWorker:()=>n.e(9722).then(n.bind(n,33764)),RasterWorker:()=>n.e(6221).then(n.bind(n,85563)),SceneLayerSnappingSourceWorker:()=>n.e(5974).then(n.bind(n,28820)),SceneLayerWorker:()=>n.e(5404).then(n.bind(n,90525)),WFSSourceWorker:()=>n.e(4900).then(n.bind(n,6412)),WorkerTileHandler:()=>n.e(3295).then(n.bind(n,27787)),Lyr3DWorker:()=>n.e(3213).then(n.bind(n,6883)),Feature3DPipelineWorker:()=>n.e(3929).then(n.bind(n,38518))};var f=n(64272),d=n(23532);const{CLOSE:h,ABORT:p,INVOKE:w,RESPONSE:g,OPEN_PORT:m,ON:y}=f.Go;class v{constructor(e){this._invoke=e,this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._timer=null,this._process=this._process.bind(this)}push(e){e.type===f.Go.ABORT?this._cancelledJobIds.add(e.jobId):(this._invokeMessages.push(e),null===this._timer&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const e of this._invokeMessages)this._cancelledJobIds.has(e.jobId)||this._invoke(e);this._cancelledJobIds.clear(),this._invokeMessages.length=0}}class b{static connect(e,t){const n=new MessageChannel;let r;r="function"==typeof e?new e:"default"in e&&"function"==typeof e.default?new e.default:e;const o=new b(n.port1,{channel:n,client:r,schedule:t});return"object"==typeof r&&"remoteClient"in r&&(r.remoteClient=o),b.clients.set(o,r),n.port2}static loadWorker(e){const t=u[e];return t?t():Promise.resolve(null)}constructor(e,t,n){this._port=e,this._jobQueue=n,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new v((e=>this._onInvokeMessage(e))),this._client=t.client,this._onMessage=this._onMessage.bind(this),this._channel=t.channel,this._schedule=t.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}close(){this._post({type:h}),this._close()}isBusy(){return this._outJobs.size>0}invoke(e,t,n){return this.apply(e,[t],n)}apply(e,t,n){const r=n?.signal,i=n?.transferList;if(!this._port)return Promise.reject(new o.A(f.T,`Cannot call invoke('${e}'), port is closed`,{methodName:e,data:t}));const a=(0,f.Jc)();return new Promise(((n,o)=>{if((0,l.G4)(r))return this._processWork(),void o((0,l.NK)());const c=(0,l.u7)(r,(()=>{const e=this._outJobs.get(a);e&&(this._outJobs.delete(a),this._processWork(),(0,s.xt)(e.abortHandle),this._post({type:p,jobId:a}),o((0,l.NK)()))})),u={resolve:n,reject:o,abortHandle:c,debugInfo:e};this._outJobs.set(a,u),this._post({type:w,jobId:a,methodName:e,abortable:null!=r},t,i)}))}createInvokeProxy(e){return(0,c.L)(this,e)}on(e,t){const n=new MessageChannel;function r(e){t(e.data)}return this._port.postMessage({type:f.Go.ON,eventType:e,port:n.port2},[n.port2]),n.port1.addEventListener("message",r),n.port1.start(),(0,a.hA)((()=>{n.port1.postMessage({type:f.Go.CLOSE}),n.port1.close(),n.port1.removeEventListener("message",r)}))}jobAdded(){this._processWork()}openPort(){const e=new MessageChannel;return this._post({type:m,port:e.port2}),e.port1}_processWork(){if(this._outJobs.size>=2)return;const e=this._jobQueue?.pop();if(!e)return;const{methodName:t,data:n,invokeOptions:r,resolver:o}=e;this.apply(t,n,r).then((e=>o.resolve(e))).catch((e=>o.reject(e)))}_close(){this._channel&&(this._channel=void 0),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach((e=>{(0,s.xt)(e.abortHandle),e.reject((0,l.NK)(`Worker closing, aborting job calling '${e.debugInfo}'`))})),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=null,this._client=null,this._schedule=null}_onMessage(e){null!=this._schedule?this._schedule((()=>this._processMessage(e,!0))):this._processMessage(e,!1)}_processMessage(e,t){const n=(0,f.VI)(e);if(n)switch(n.type){case g:this._onResponseMessage(n);break;case w:t?this._onInvokeMessage(n):this._invokeQueue.push(n);break;case p:this._onAbortMessage(n);break;case h:this._onCloseMessage();break;case m:this._onOpenPortMessage(n);break;case y:this._onOnMessage(n)}}_onAbortMessage(e){const t=this._inJobs,n=e.jobId,r=t.get(n);this._invokeQueue.push(e),r&&(r.controller&&r.controller.abort(),t.delete(n))}_onCloseMessage(){const e=this._client;this._close(),e&&"destroy"in e&&b.clients.get(this)===e&&e.destroy(),b.clients.delete(this),e?.remoteClient&&(e.remoteClient=null)}_onInvokeMessage(e){const{methodName:t,jobId:n,data:r=[],abortable:o}=e,i=o?new AbortController:null,a=this._inJobs;let s,c=this._client,u=c[t];try{if(!u&&t&&t.includes(".")){const e=t.split(".");for(let t=0;t<e.length-1;t++)c=c[e[t]],u=c[e[t+1]]}if("function"!=typeof u)throw new TypeError(`${t} is not a function`);r.push({client:this,signal:i?i.signal:null}),s=u.apply(c,r)}catch(e){return void this._post({type:g,jobId:n,error:(0,f.mF)(e)})}(0,l.$X)(s)?(a.set(n,{controller:i,promise:s}),s.then((e=>{a.has(n)&&(a.delete(n),this._post({type:g,jobId:n},e))}),(e=>{a.has(n)&&(a.delete(n),(0,l.zf)(e)||this._post({type:g,jobId:n,error:(0,f.mF)(e||{message:`Error encountered at method ${t}`})}))}))):this._post({type:g,jobId:n},s)}_onOpenPortMessage(e){new b(e.port,{client:this._client})}_onOnMessage(e){const{port:t}=e,n=this._client.on(e.eventType,(e=>{t.postMessage(e)})),r=(0,i.on)(e.port,"message",(e=>{const o=(0,f.VI)(e);o?.type===f.Go.CLOSE&&(r.remove(),n.remove(),t.close())}))}_onResponseMessage(e){const{jobId:t,error:n,data:r}=e,i=this._outJobs;if(!i.has(t))return;const a=i.get(t);i.delete(t),this._processWork(),(0,s.xt)(a.abortHandle),n?a.reject(o.A.fromJSON(JSON.parse(n))):a.resolve(r)}_post(e,t,n){return(0,f.u1)(this._port,e,t,n)}}b.kernelInfo={buildDate:d.$,fullVersion:r.ol,revision:d.u},b.clients=new Map},13370:function(e,t,n){n.d(t,{h:function(){return i},k:function(){return o}});const r=new FinalizationRegistry((e=>{e.close()}));function o(e,t){r.register(e,t,t)}function i(e){r.unregister(e)}},64272:function(e,t,n){n.d(t,{Go:function(){return a},Jc:function(){return c},T:function(){return i},VI:function(){return d},mF:function(){return u},oV:function(){return p},u1:function(){return f}});var r=n(58941),o=n(60539);const i="worker:port-closed";var a,s;(s=a||(a={}))[s.HANDSHAKE=0]="HANDSHAKE",s[s.OPEN=1]="OPEN",s[s.OPENED=2]="OPENED",s[s.RESPONSE=3]="RESPONSE",s[s.INVOKE=4]="INVOKE",s[s.ABORT=5]="ABORT",s[s.CLOSE=6]="CLOSE",s[s.OPEN_PORT=7]="OPEN_PORT",s[s.ON=8]="ON";let l=0;function c(){return l++}function u(e){return e?"string"==typeof e?JSON.stringify({name:"message",message:e}):e.toJSON?JSON.stringify(e):JSON.stringify({name:e.name,message:e.message,details:e.details||{stack:e.stack}}):null}function f(e,t,n,o){if(t.type===a.OPEN_PORT)return void e.postMessage(t,[t.port]);if(t.type!==a.INVOKE&&t.type!==a.RESPONSE)return void e.postMessage(t);let i;if(function(e){return e&&"object"==typeof e&&("result"in e||"transferList"in e)}(n)?(i=h(n.transferList),t.data=n.result):(i=h(o),t.data=n),i){if((0,r.A)("ff"))for(const n of i)if("byteLength"in n&&n.byteLength>267386880){const n="Worker call with large ArrayBuffer would crash Firefox";switch(t.type){case a.INVOKE:throw n;case a.RESPONSE:return void f(e,{type:a.RESPONSE,jobId:t.jobId,error:u(n)})}}e.postMessage(t,i)}else e.postMessage(t)}function d(e){if(!e)return null;const t=e.data;return t?"string"==typeof t?JSON.parse(t):t:null}function h(e){if(!e?.length)return null;if((0,r.A)("esri-workers-arraybuffer-transfer"))return e;const t=e.filter((e=>!function(e){return e instanceof ArrayBuffer||"ArrayBuffer"===e?.constructor?.name}(e)));return t.length?t:null}async function p(e){try{return await e}catch(e){const t=e?.name===i;if(!(0,o.zf)(e)&&!t)throw e;return}}},86027:function(e,t,n){n.d(t,{n_:function(){return H},ho:function(){return K}});var r=n(39819),o=n(58941),i=n(60539),a=n(37797),s=n(13370),l=n(50193),c=n(40633),u=n(95929),f=n(93040),d=n(90683);const h={async request(e,t){const n=e.options,r=n.responseType;n.signal=t?.signal,n.responseType="native"===r||"native-request-init"===r?"native-request-init":r&&["blob","json","text"].includes(r)&&(0,d.sC)(e.url)?.after?r:"array-buffer";const o=await(0,f.A)(e.url,n),i={data:o.data,httpStatus:o.httpStatus,ssl:o.ssl};switch(o.requestOptions?.responseType){case"native-request-init":return delete i.data.signal,i;case"blob":i.data=await i.data.arrayBuffer();break;case"json":i.data=(new TextEncoder).encode(JSON.stringify(i.data)).buffer;break;case"text":i.data=(new TextEncoder).encode(i.data).buffer}return{result:i,transferList:[i.data]}}};var p=n(64272),w=n(53216),g=n(25591),m=(n(64122),n(7156));const y={};var v=n(29601);class b{constructor(){const e=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach((t=>{this[t]=(...n)=>e[t](...n)}))}}class A{constructor(){this._dispatcher=new b,this._workerPostMessage({type:p.Go.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=e,e&&this.addEventListener("message",e)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(e){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=e,e&&this.addEventListener("messageerror",e)}get onerror(){return this._onerrorHandler}set onerror(e){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=e,e&&this.addEventListener("error",e)}postMessage(e){(0,v.d)((()=>{this._workerMessageHandler(new MessageEvent("message",{data:e}))}))}dispatchEvent(e){return this._dispatcher.dispatchEvent(e)}addEventListener(e,t,n){this._dispatcher.addEventListener(e,t,n)}removeEventListener(e,t,n){this._dispatcher.removeEventListener(e,t,n)}_workerPostMessage(e){(0,v.d)((()=>{this.dispatchEvent(new MessageEvent("message",{data:e}))}))}async _workerMessageHandler(e){const t=(0,p.VI)(e);if(t&&t.type===p.Go.OPEN){const{modulePath:e,jobId:n}=t;let r=await l.A.loadWorker(e);r||(r=await import(e));const o=l.A.connect(r);this._workerPostMessage({type:p.Go.OPENED,jobId:n,data:o})}}}var S=n(22739),D=n(23532);const T=()=>c.A.getLogger("esri.core.workers.workerFactory"),{HANDSHAKE:k}=p.Go;let _,I;const P="Failed to create Worker. Fallback to execute module in main thread";async function $(e){return new Promise((t=>{function n(o){const i=(0,p.VI)(o);i&&i.type===k&&(e.removeEventListener("message",n),e.removeEventListener("error",r),t(e))}function r(t){t.preventDefault(),e.removeEventListener("message",n),e.removeEventListener("error",r),T().warn("Failed to create Worker. Fallback to execute module in main thread",t),(e=new A).addEventListener("message",n),e.addEventListener("error",r)}e.addEventListener("message",n),e.addEventListener("error",r)}))}let X=0;const{ABORT:N,INVOKE:R,OPEN:O,OPENED:E,RESPONSE:x}=p.Go;class M{static async create(e){const t=await async function(){if(!(0,o.A)("esri-workers"))return $(new A);if(!_&&!I)try{const e='let globalId=0;const outgoing=new Map,configuration={CONFIGURATION};self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;let s=null;return new Promise(((r,i)=>{if(t){if(t.aborted)return i(createAbortError());s=()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:5,jobId:n}),i(createAbortError()))},t.addEventListener("abort",s)}outgoing.set(n,{resolve:r,reject:i}),self.postMessage({type:4,jobId:n,methodName:e,abortable:null!=t,data:o})})).finally((()=>{t&&t.removeEventListener("abort",s)}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,fullVersion:r}=configuration.kernelInfo,{revision:t,fullVersion:n,version:s}=e.kernelInfo;esriConfig.assetsPath!==esriConfig.defaultAssetsPath&&o!==t&&console.warn(`Version mismatch detected between ArcGIS Maps SDK for JavaScript modules and assets. For more information visit https://bit.ly/3QnsuSo.\nModules version: ${r}\nAssets version: ${n??s}\nAssets path: ${esriConfig.assetsPath}`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case 1:let n;function t(e){const o=n.connect(e);self.postMessage({type:2,jobId:r,data:o},[o])}"function"==typeof define&&define.amd?require([workerPath],(e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((e=>(n=e.default,checkWorkerRevision(n),n.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),n=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(n),n.loadWorker(o.modulePath).then(t));break;case 3:if(outgoing.has(r)){const s=outgoing.get(r);outgoing.delete(r),o.error?s.reject(JSON.parse(o.error)):s.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});'.split("{CONFIGURATION}").join(function(){let e;if(null!=g.default.default){const t={...g.default};delete t.default,e=JSON.parse(JSON.stringify(t))}else e=JSON.parse(JSON.stringify(g.default));e.assetsPath=(0,d.s2)(e.assetsPath),e.defaultAssetsPath=e.defaultAssetsPath?(0,d.s2)(e.defaultAssetsPath):void 0,e.request.interceptors=[],e.log.interceptors=[],e.locale=(0,S.JK)(),e.has={"esri-csp-restrictions":(0,o.A)("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":(0,o.A)("esri-2d-update-debug"),"esri-2d-log-updating":(0,o.A)("esri-2d-log-updating"),"featurelayer-pbf":(0,o.A)("featurelayer-pbf"),"featurelayer-fast-triangulation-enabled":(0,o.A)("featurelayer-fast-triangulation-enabled"),"featurelayer-simplify-thresholds":(0,o.A)("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":(0,o.A)("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":(0,o.A)("featurelayer-simplify-mobile-factor"),"featurelayer-query-max-depth":(0,o.A)("featurelayer-query-max-depth"),"featurelayer-query-pausing-enabled":(0,o.A)("featurelayer-query-pausing-enabled"),"featurelayer-snapshot-enabled":(0,o.A)("featurelayer-snapshot-enabled"),"esri-atomics":(0,o.A)("esri-atomics"),"esri-shared-array-buffer":(0,o.A)("esri-shared-array-buffer"),"esri-tiles-debug":(0,o.A)("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":(0,o.A)("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":(0,o.A)("feature-polyline-generalization-factor"),"host-webworker":1},e.workers.loaderUrl&&(e.workers.loaderUrl=(0,d.s2)(e.workers.loaderUrl)),e.workers.workerPath?e.workers.workerPath=(0,d.s2)(e.workers.workerPath):e.workers.workerPath=(0,d.s2)((0,w.s)("esri/core/workers/RemoteClient.js")),e.workers.useDynamicImport=!1;const t=g.default.workers.loaderConfig,n=function(e){const t={async:e.async,isDebug:e.isDebug,locale:e.locale,baseUrl:e.baseUrl,has:{...e.has},map:{...e.map},packages:e.packages?.slice()||[],paths:{...y.paths,...e.paths}};return e.hasOwnProperty("async")||(t.async=!0),e.hasOwnProperty("isDebug")||(t.isDebug=!1),e.baseUrl||(t.baseUrl=y.baseUrl),t}({baseUrl:t?.baseUrl,locale:(0,S.JK)(),has:{"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1,...t?.has},map:{...t?.map},paths:{...t?.paths},packages:t?.packages||[]}),r={buildDate:D.$,fullVersion:m.ol,revision:D.u};return JSON.stringify({esriConfig:e,loaderConfig:n,kernelInfo:r})}());_=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))}catch(e){I=e||{}}let e;if(_)try{e=new Worker(_,{name:"esri-worker-"+X++})}catch(t){T().warn(P,I),e=new A}else T().warn(P,I),e=new A;return $(e)}();return new M(t,e)}constructor(e,t){this._outJobs=new Map,this._inJobs=new Map,this.worker=e,this.id=t,e.addEventListener("message",this._onMessage.bind(this)),e.addEventListener("error",(e=>{e.preventDefault(),c.A.getLogger("esri.core.workers.WorkerOwner").error(e)}))}terminate(){this.worker.terminate()}async open(e,t={}){const{signal:n}=t,r=(0,p.Jc)();return new Promise(((t,o)=>{const a={resolve:t,reject:o,abortHandle:(0,i.NY)(n,(()=>{this._outJobs.delete(r),this._post({type:N,jobId:r})}))};this._outJobs.set(r,a),this._post({type:O,jobId:r,modulePath:e})}))}_onMessage(e){const t=(0,p.VI)(e);if(t)switch(t.type){case E:this._onOpenedMessage(t);break;case x:this._onResponseMessage(t);break;case N:this._onAbortMessage(t);break;case R:this._onInvokeMessage(t)}}_onAbortMessage(e){const t=this._inJobs,n=e.jobId,r=t.get(n);r&&(r.controller&&r.controller.abort(),t.delete(n))}_onInvokeMessage(e){const{methodName:t,jobId:n,data:r,abortable:o}=e,a=o?new AbortController:null,s=this._inJobs,l=h[t];let c;try{if("function"!=typeof l)throw new TypeError(`${t} is not a function`);c=l.call(null,r,{signal:a?a.signal:null})}catch(e){return void this._post({type:x,jobId:n,error:(0,p.mF)(e)})}(0,i.$X)(c)?(s.set(n,{controller:a,promise:c}),c.then((e=>{s.has(n)&&(s.delete(n),this._post({type:x,jobId:n},e))}),(e=>{s.has(n)&&(s.delete(n),e||(e={message:"Error encountered at method"+t}),(0,i.zf)(e)||this._post({type:x,jobId:n,error:(0,p.mF)(e||{message:`Error encountered at method ${t}`})}))}))):this._post({type:x,jobId:n},c)}_onOpenedMessage(e){const{jobId:t,data:n}=e,r=this._outJobs.get(t);r&&(this._outJobs.delete(t),(0,u.xt)(r.abortHandle),r.resolve(n))}_onResponseMessage(e){const{jobId:t,error:n,data:o}=e,i=this._outJobs.get(t);i&&(this._outJobs.delete(t),(0,u.xt)(i.abortHandle),n?i.reject(r.A.fromJSON(JSON.parse(n))):i.resolve(o))}_post(e,t,n){return(0,p.u1)(this.worker,e,t,n)}}const F=(0,o.A)("host-browser")?Math.min(navigator.hardwareConcurrency-1,(0,o.A)("workers-pool-size")??8):0;let C=(0,o.A)("esri-mobile")?Math.min(F,3):F;C||(C=(0,o.A)("safari")&&(0,o.A)("mac")?7:2);let j=0;const L=[];function H(){W()}async function J(e,t){const n=new a.A,{registryTarget:r,...o}=t;return await n.open(e,o),r&&(0,s.k)(r,n),n}async function K(e,t={}){if("string"!=typeof e)throw new r.A("workers:undefined-module","modulePath is missing");let n=t.strategy||"distributed";if((0,o.A)("host-webworker")&&!(0,o.A)("esri-workers")&&(n="local"),"local"===n){let n=await l.A.loadWorker(e);n||(n=await import(e)),(0,i.Te)(t.signal);const r=t.client||n;return J([l.A.connect(n,t.schedule)],{...t,client:r})}if(await W(),(0,i.Te)(t.signal),"dedicated"===n){const n=j++%C;return J([await L[n].open(e,t)],t)}if(t.maxNumWorkers&&t.maxNumWorkers>0){const n=Math.min(t.maxNumWorkers,C);if(n<C){const r=new Array(n);for(let o=0;o<n;++o){const n=j++%C;r[o]=L[n].open(e,t)}return J(r,t)}}return J(L.map((n=>n.open(e,t))),t)}let G,q=null;async function W(){if(q)return q;G=new AbortController;const e=[];for(let t=0;t<C;t++){const n=M.create(t).then((e=>(L[t]=e,e)));e.push(n)}return q=Promise.all(e),q}},75160:function(e,t,n){n.r(t),n.d(t,{buffer:function(){return E},changeDefaultSpatialReferenceTolerance:function(){return V},clearDefaultSpatialReferenceTolerance:function(){return Z},clip:function(){return p},contains:function(){return g},convexHull:function(){return P},crosses:function(){return m},cut:function(){return w},densify:function(){return G},difference:function(){return $},disjoint:function(){return D},distance:function(){return y},equals:function(){return v},extendedSpatialReferenceInfo:function(){return h},flipHorizontal:function(){return H},flipVertical:function(){return J},generalize:function(){return K},geodesicArea:function(){return B},geodesicBuffer:function(){return x},geodesicDensify:function(){return q},geodesicLength:function(){return U},intersect:function(){return N},intersectLinesToPoints:function(){return Q},intersects:function(){return b},isSimple:function(){return _},nearestCoordinate:function(){return M},nearestVertex:function(){return F},nearestVertices:function(){return C},offset:function(){return O},overlaps:function(){return T},planarArea:function(){return W},planarLength:function(){return z},relate:function(){return k},rotate:function(){return L},simplify:function(){return I},symmetricDifference:function(){return X},touches:function(){return A},union:function(){return R},within:function(){return S}}),n(50917);var r=n(86027),o=n(45532),i=n(74697);function a(e){return Array.isArray(e)?e[0]?.spatialReference:e?.spatialReference}function s(e){return e?Array.isArray(e)?e.map(s):e.toJSON?e.toJSON():e:e}function l(e){return Array.isArray(e)?e.map((e=>(0,i.rS)(e))):(0,i.rS)(e)}let c;async function u(){return c||(c=(0,r.ho)("geometryEngineWorker",{strategy:"distributed"})),c}async function f(e,t){return(await u()).invoke("executeGEOperation",{operation:e,parameters:s(t)})}async function d(e,t){const n=await u();return Promise.all(n.broadcast("executeGEOperation",{operation:e,parameters:s(t)}))}function h(e){return f("extendedSpatialReferenceInfo",[e])}async function p(e,t){return l(await f("clip",[a(e),e,t]))}async function w(e,t){return l(await f("cut",[a(e),e,t]))}function g(e,t){return f("contains",[a(e),e,t])}function m(e,t){return f("crosses",[a(e),e,t])}function y(e,t,n){return f("distance",[a(e),e,t,n])}function v(e,t){return f("equals",[a(e),e,t])}function b(e,t){return f("intersects",[a(e),e,t])}function A(e,t){return f("touches",[a(e),e,t])}function S(e,t){return f("within",[a(e),e,t])}function D(e,t){return f("disjoint",[a(e),e,t])}function T(e,t){return f("overlaps",[a(e),e,t])}function k(e,t,n){return f("relate",[a(e),e,t,n])}function _(e){return f("isSimple",[a(e),e])}async function I(e){return l(await f("simplify",[a(e),e]))}async function P(e,t=!1){return l(await f("convexHull",[a(e),e,t]))}async function $(e,t){return l(await f("difference",[a(e),e,t]))}async function X(e,t){return l(await f("symmetricDifference",[a(e),e,t]))}async function N(e,t){return l(await f("intersect",[a(e),e,t]))}async function R(e,t=null){const n=function(e,t){let n;return Array.isArray(e)?n=e:(n=[],n.push(e),null!=t&&n.push(t)),n}(e,t);return l(await f("union",[a(n),n]))}async function O(e,t,n,r,o,i){return l(await f("offset",[a(e),e,t,n,r,o,i]))}async function E(e,t,n,r=!1){const o=[a(e),e,t,n,r];return l(await f("buffer",o))}async function x(e,t,n,r,o,i){const s=[a(e),e,t,n,r,o,i];return l(await f("geodesicBuffer",s))}async function M(e,t,n=!0){const r=await f("nearestCoordinate",[a(e),e,t,n]);return{...r,coordinate:o.default.fromJSON(r.coordinate)}}async function F(e,t){const n=await f("nearestVertex",[a(e),e,t]);return{...n,coordinate:o.default.fromJSON(n.coordinate)}}async function C(e,t,n,r){return(await f("nearestVertices",[a(e),e,t,n,r])).map((e=>({...e,coordinate:o.default.fromJSON(e.coordinate)})))}function j(e){return"xmin"in e?e.center:"x"in e?e:e.extent?.center}async function L(e,t,n){if(null==e)throw new Y;const r=e.spatialReference;if(null==(n=n??j(e)))throw new Y;const o=e.constructor.fromJSON(await f("rotate",[r,e,t,n]));return o.spatialReference=r,o}async function H(e,t){if(null==e)throw new Y;const n=e.spatialReference;if(null==(t=t??j(e)))throw new Y;const r=e.constructor.fromJSON(await f("flipHorizontal",[n,e,t]));return r.spatialReference=n,r}async function J(e,t){if(null==e)throw new Y;const n=e.spatialReference;if(null==(t=t??j(e)))throw new Y;const r=e.constructor.fromJSON(await f("flipVertical",[n,e,t]));return r.spatialReference=n,r}async function K(e,t,n,r){return l(await f("generalize",[a(e),e,t,n,r]))}async function G(e,t,n){return l(await f("densify",[a(e),e,t,n]))}async function q(e,t,n,r=0){return l(await f("geodesicDensify",[a(e),e,t,n,r]))}function W(e,t){return f("planarArea",[a(e),e,t])}function z(e,t){return f("planarLength",[a(e),e,t])}function B(e,t,n){return f("geodesicArea",[a(e),e,t,n])}function U(e,t,n){return f("geodesicLength",[a(e),e,t,n])}async function Q(e,t){return l(await f("intersectLinesToPoints",[a(e),e,t]))}async function V(e,t){await d("changeDefaultSpatialReferenceTolerance",[e,t])}async function Z(e){await d("clearDefaultSpatialReferenceTolerance",[e])}class Y extends Error{constructor(){super("Illegal Argument Exception")}}},23532:function(e,t,n){n.d(t,{$:function(){return r},u:function(){return o}});const r="20241122",o="f6f7099a0e79cf518abdcf87c5aa8b6f24ecdcd8"}}]);
//# sourceMappingURL=arcade-arcadeAsyncRuntime.js.map