"use strict";(self.webpackChunkdefra=self.webpackChunkdefra||[]).push([[2416,3929,4292,6314],{74756:function(e,t,r){r.r(t),r.d(t,{default:function(){return L}});var n=r(53804),i=r(93040),s=r(78879),a=r(61500),o=r(30905),l=r(21609),c=r(31609),u=r(75218),d=r(40633),h=r(95929),f=r(60539),p=r(90683),m=r(23502),g=(r(58941),r(65953)),_=r(81392),y=r(57165),v=r(51432),T=r(43173),b=r(11876),S=r(83525),A=(r(13798),r(22739));const E=new Set(["ar","bs","ca","hr","cs","da","nl","en","et","fi","fr","de","el","he","hu","id","it","ja","ko","lv","lt","nb","pl","ro","ru","sr","es","sv","th","tr","uk","vi"]);let w=class extends S.A{constructor(e){super(e),this.apiKey=null,this.id=null,this.language=null,this.places=null,this.serviceUrl="https://basemapstyles-api.arcgis.com/arcgis/rest/services/styles/v2/webmaps",this.worldview=null}getLanguageParamValue(){if(this.language)return this.language;const e=(0,A.JK)().toLowerCase();switch(e){case"pt-br":return"pt-BR";case"pt-pt":return"pt-PT";case"zh-cn":return"zh-CN";case"zh-hk":return"zh-HK";case"zh-tw":return"zh-TW"}const t=(0,A.Z0)(e);return"pt"===t?"pt-BR":t&&E.has(t)?t:"global"}};(0,n._)([(0,m.MZ)()],w.prototype,"apiKey",void 0),(0,n._)([(0,m.MZ)()],w.prototype,"id",void 0),(0,n._)([(0,m.MZ)()],w.prototype,"language",void 0),(0,n._)([(0,m.MZ)()],w.prototype,"places",void 0),(0,n._)([(0,m.MZ)()],w.prototype,"serviceUrl",void 0),(0,n._)([(0,m.MZ)()],w.prototype,"worldview",void 0),w=(0,n._)([(0,g.$)("esri.support.BasemapStyle")],w);const I=w;var x,R=r(84624);let M=0,O=x=class extends((0,o.Te)(c.A)){constructor(e){super(e),this.id=null,this.portalItem=null,this.spatialReference=null,this.style=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+M++,this.baseLayers=new s.A,this.referenceLayers=new s.A;const t=e=>{e.parent&&e.parent!==this&&"remove"in e.parent&&e.parent.remove(e),e.parent=this,"elevation"===e.type&&d.A.getLogger(this).error(`Layer '${e.title}, id:${e.id}' of type '${e.type}' is not supported as a basemap layer and will therefore be ignored.`)},r=e=>{e.parent=null};this.addHandles([this.baseLayers.on("after-add",(e=>t(e.item))),this.referenceLayers.on("after-add",(e=>t(e.item))),this.baseLayers.on("after-remove",(e=>r(e.item))),this.referenceLayers.on("after-remove",(e=>r(e.item)))])}initialize(){this.when().catch((e=>{d.A.getLogger(this).error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,e)})),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const e=this.baseLayers.toArray();for(const t of e)t.destroy();const t=this.referenceLayers.toArray();for(const e of t)e.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),this.portalItem=(0,h.pR)(this.portalItem)}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e={...e}).resourceInfo),e}set baseLayers(e){this._set("baseLayers",(0,a.V)(e,this._get("baseLayers")))}_writeBaseLayers(e,t,r){const n=[];e?(r={...r,layerContainerType:"basemap"},this.baseLayers.forEach((e=>{const t=(0,R.CJ)(e,r.webmap?r.webmap.getLayerJSONFromResourceInfo(e):null,r);null!=t&&n.push(t)})),this.referenceLayers.forEach((e=>{const t=(0,R.CJ)(e,r.webmap?r.webmap.getLayerJSONFromResourceInfo(e):null,r);null!=t&&("scene"!==e.type&&(t.isReference=!0),n.push(t))})),t.baseMapLayers=n):t.baseMapLayers=n}set referenceLayers(e){this._set("referenceLayers",(0,a.V)(e,this._get("referenceLayers")))}writeTitle(e,t){t.title=e||"Basemap"}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return(0,u.g)(this,(e=>{e(this.baseLayers,this.referenceLayers)}))}clone(){const e={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.map((e=>(0,l.Nb)(e)?e.clone():e)),referenceLayers:this.referenceLayers.map((e=>(0,l.Nb)(e)?e.clone():e))};return this.loaded&&(e.loadStatus="loaded"),new x({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}write(e,t){return e=e||{},t?.origin||(t={origin:"web-map",...t}),super.write(e,t),!this.loaded&&this.resourceInfo?.data.baseMapLayers&&(e.baseMapLayers=this.resourceInfo.data.baseMapLayers.map((e=>{const t=(0,l.o8)(e);return t.url&&(0,p.BQ)(t.url)&&(t.url=`https:${t.url}`),t.templateUrl&&(0,p.BQ)(t.templateUrl)&&(t.templateUrl=`https:${t.templateUrl}`),t}))),e}async _loadFromSource(e){const{resourceInfo:t,portalItem:r,style:n}=this;(0,f.Te)(e);const i=[];if(t){const r=t.context?t.context.url:null;if(i.push(this._loadLayersFromJSON(t.data,r,e)),t.data.id&&!t.data.title){const e=t.data.id;i.push((0,b.q)(e).then((e=>{e&&this.read({title:e},t.context)})))}}else r?i.push(this._loadFromItem(r,e)):n&&i.push(this._loadFromStylesService(n,e));await Promise.all(i)}async _loadLayersFromJSON(e,t,n){const i=this.resourceInfo?.context,s=this.portalItem?.portal||i?.portal||null,a=N[i?.origin||""]??"web-map",{populateOperationalLayers:o}=await r.e(3538).then(r.bind(r,80669)),l=[];if((0,f.Te)(n),e.baseMapLayers&&Array.isArray(e.baseMapLayers)){const r={context:{...i,origin:a,url:t,portal:s,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},n=e=>"web-scene"===a&&"ArcGISSceneServiceLayer"===e.layerType||e.isReference,c=o(this.baseLayers,e.baseMapLayers.filter((e=>!n(e))),r);l.push(c);const u=o(this.referenceLayers,e.baseMapLayers.filter(n),r);l.push(u)}await Promise.allSettled(l)}async _loadFromItem(e,t){const r=await e.load(t),n=await r.fetchData("json",t),i=(0,p.An)(e.itemUrl??"");return this._set("resourceInfo",{data:n.baseMap??{},context:{origin:C[e.type||""]??"web-map",portal:e.portal||v.A.getDefault(),url:i}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:n.spatialReference},this.resourceInfo.context),this.read({title:e.title,thumbnailUrl:e.thumbnailUrl},{origin:"portal-item",portal:e.portal||v.A.getDefault(),url:i}),this._loadLayersFromJSON(this.resourceInfo.data,i,t)}async _loadFromStylesService(e,t){const r=`${e.serviceUrl}/${e.id}`,n=(await(0,i.A)(r,{query:{language:e.getLanguageParamValue(),places:e.places,worldview:e.worldview,token:e.apiKey},signal:t?.signal})).data,s=(0,p.An)(r);if(this._set("resourceInfo",{data:n.baseMap??{},context:{origin:"web-map",url:s}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:n.spatialReference},this.resourceInfo.context),await this._loadLayersFromJSON(this.resourceInfo.data,s,t),e.apiKey)for(const t of[...this.baseLayers,...this.referenceLayers])"apiKey"in t&&(t.apiKey=e.apiKey)}static fromId(e){const t=b.H[e];return t?t.itemId?new x({portalItem:{id:t.itemId,portal:{url:"https://www.arcgis.com"}}}):x.fromJSON(t,{origin:t.is3d?"web-scene":"web-map"}):null}};(0,n._)([(0,m.MZ)({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(e,t,r,n){this._writeBaseLayers(e,t,n)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:s.A}},writer(e,t,r,n){this._writeBaseLayers(e,t,n)}}}}}})],O.prototype,"baseLayers",null),(0,n._)([(0,m.MZ)({type:String,json:{origins:{"web-scene":{write:!0}}}})],O.prototype,"id",void 0),(0,n._)([(0,m.MZ)({type:T.default})],O.prototype,"portalItem",void 0),(0,n._)([(0,m.MZ)()],O.prototype,"referenceLayers",null),(0,n._)([(0,m.MZ)({readOnly:!0})],O.prototype,"resourceInfo",void 0),(0,n._)([(0,m.MZ)({type:y.A})],O.prototype,"spatialReference",void 0),(0,n._)([(0,m.MZ)({type:I})],O.prototype,"style",void 0),(0,n._)([(0,m.MZ)()],O.prototype,"thumbnailUrl",void 0),(0,n._)([(0,m.MZ)({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],O.prototype,"title",void 0),(0,n._)([(0,_.K)("title")],O.prototype,"writeTitle",null),O=x=(0,n._)([(0,g.$)("esri.Basemap")],O);const C={"Web Scene":"web-scene","Web Map":"web-map","Link Chart":"link-chart"},N={"web-scene":"web-scene","web-map":"web-map","link-chart":"link-chart"},L=O},9688:function(e,t,r){r.d(t,{lY:function(){return d},mT:function(){return h}});var n,i=r(50944),s=r(92955),a=r(96285);(n||(n={})).TimeZoneNotRecognized="TimeZoneNotRecognized";const o={[n.TimeZoneNotRecognized]:"Timezone identifier has not been recognized."};class l extends Error{constructor(e,t){super((0,i.HC)(o[e],t)),this.declaredRootClass="esri.arcade.arcadedate.dateerror",Error.captureStackTrace&&Error.captureStackTrace(this,l)}}function c(e,t,r){return e<t?e-t:e>r?e-r:0}function u(e,t,r){return e<t?t:e>r?r:e}class d{constructor(e){this._date=e,this.declaredRootClass="esri.arcade.arcadedate"}static fromParts(e=0,t=1,r=1,n=0,i=0,s=0,o=0,l){if(isNaN(e)||isNaN(t)||isNaN(r)||isNaN(n)||isNaN(i)||isNaN(s)||isNaN(o))return null;const f=a.c9.local(e,t).daysInMonth;let p=a.c9.fromObject({day:u(r,1,f),year:e,month:u(t,1,12),hour:u(n,0,23),minute:u(i,0,59),second:u(s,0,59),millisecond:u(o,0,999)},{zone:h(l)});return p=p.plus({months:c(t,1,12),days:c(r,1,f),hours:c(n,0,23),minutes:c(i,0,59),seconds:c(s,0,59),milliseconds:c(o,0,999)}),new d(p)}static get systemTimeZoneCanonicalName(){return Intl.DateTimeFormat().resolvedOptions().timeZone??"system"}static arcadeDateAndZoneToArcadeDate(e,t){const r=h(t);return e.isUnknownTimeZone||r===s.GB.instance?d.fromParts(e.year,e.monthJS+1,e.day,e.hour,e.minute,e.second,e.millisecond,r):new d(e._date.setZone(r))}static dateJSToArcadeDate(e){return new d(a.c9.fromJSDate(e,{zone:"system"}))}static dateJSAndZoneToArcadeDate(e,t="system"){const r=h(t);return new d(a.c9.fromJSDate(e,{zone:r}))}static unknownEpochToArcadeDate(e){return new d(a.c9.fromMillis(e,{zone:s.GB.instance}))}static unknownDateJSToArcadeDate(e){return new d(a.c9.fromMillis(e.getTime(),{zone:s.GB.instance}))}static epochToArcadeDate(e,t="system"){const r=h(t);return new d(a.c9.fromMillis(e,{zone:r}))}static dateTimeToArcadeDate(e){return new d(e)}clone(){return new d(this._date)}changeTimeZone(e){const t=h(e);return d.dateTimeToArcadeDate(this._date.setZone(t))}static dateTimeAndZoneToArcadeDate(e,t){const r=h(t);return e.zone===s.GB.instance||r===s.GB.instance?d.fromParts(e.year,e.month,e.day,e.hour,e.minute,e.second,e.millisecond,r):new d(e.setZone(r))}static nowToArcadeDate(e){const t=h(e);return new d(a.c9.fromJSDate(new Date,{zone:t}))}static nowUTCToArcadeDate(){return new d(a.c9.utc())}get isSystem(){return"system"===this.timeZone||this.timeZone===d.systemTimeZoneCanonicalName}equals(e){return this.isSystem&&e.isSystem?this.toNumber()===e.toNumber():this.isUnknownTimeZone===e.isUnknownTimeZone&&this._date.equals(e._date)}get isUnknownTimeZone(){return this._date.zone===s.GB.instance}get isValid(){return this._date.isValid}get hour(){return this._date.hour}get second(){return this._date.second}get day(){return this._date.day}get dayOfWeekISO(){return this._date.weekday}get dayOfWeekJS(){let e=this._date.weekday;return e>6&&(e=0),e}get millisecond(){return this._date.millisecond}get monthISO(){return this._date.month}get weekISO(){return this._date.weekNumber}get yearISO(){return this._date.weekYear}get monthJS(){return this._date.month-1}get year(){return this._date.year}get minute(){return this._date.minute}get zone(){return this._date.zone}get timeZoneOffset(){return this.isUnknownTimeZone?0:this._date.offset}get timeZone(){if(this.isUnknownTimeZone)return"unknown";if("system"===this._date.zone.type)return"system";const e=this.zone;return"fixed"===e.type?0===e.fixed?"UTC":e.formatOffset(0,"short"):e.name}stringify(){return JSON.stringify(this.toJSDate())}plus(e){return new d(this._date.plus(e))}diff(e,t="milliseconds"){return this._date.diff(e._date,t)[t]}toISODate(){return this._date.toISODate()}toISOString(e){return e?this._date.toISO({suppressMilliseconds:!0,includeOffset:!this.isUnknownTimeZone}):this._date.toISO({includeOffset:!this.isUnknownTimeZone})}toISOTime(e,t){return this._date.toISOTime({suppressMilliseconds:e,includeOffset:t&&!this.isUnknownTimeZone})}toFormat(e,t){return this.isUnknownTimeZone&&(e=e.replaceAll("Z","")),this._date.toFormat(e,t)}toJSDate(){return this._date.toJSDate()}toSQLValue(){return this._date.toFormat("yyyy-LL-dd HH:mm:ss")}toSQLWithKeyword(){return`timestamp '${this.toSQLValue()}'`}toDateTime(){return this._date}toNumber(){return this._date.toMillis()}getTime(){return this._date.toMillis()}toUTC(){return new d(this._date.toUTC())}toLocal(){return new d(this._date.toLocal())}toString(){return this.toISOString(!0)}static fromReaderAsTimeStampOffset(e){if(!e)return null;const t=a.c9.fromISO(e,{setZone:!0});return new d(t)}}function h(e,t=!0){if(e instanceof a.bo)return e;if("system"===e.toLowerCase())return"system";if("utc"===e.toLowerCase())return"UTC";if("unknown"===e.toLowerCase())return s.GB.instance;if(/^[+-]?[0-9]{1,2}([:][0-9]{2})?$/.test(e)){const t=a.mQ.parseSpecifier("UTC"+(e.startsWith("+")||e.startsWith("-")?"":"+")+e);if(t)return t}const r=a.oh.create(e);if(!r.isValid){if(t)throw new l(n.TimeZoneNotRecognized);return null}return r}},80749:function(e,t,r){r.d(t,{Fq:function(){return l},SQ:function(){return a},Yc:function(){return s},Yq:function(){return o},uf:function(){return i}});var n=r(91484);function i(e){if(null==e)return null;if("number"==typeof e)return e;let t=e.toLowerCase();switch(t=t.replaceAll(/\s/g,""),t=t.replaceAll("-",""),t){case"meters":case"meter":case"m":case"squaremeters":case"squaremeter":return 109404;case"miles":case"mile":case"squaremile":case"squaremiles":return 109439;case"kilometers":case"kilometer":case"squarekilometers":case"squarekilometer":case"km":return 109414;case"acres":case"acre":case"ac":return 109402;case"hectares":case"hectare":case"ha":return 109401;case"yard":case"yd":case"yards":case"squareyards":case"squareyard":return 109442;case"feet":case"ft":case"foot":case"squarefeet":case"squarefoot":return 109405;case"nmi":case"nauticalmile":case"nauticalmiles":case"squarenauticalmile":case"squarenauticalmiles":return 109409}return null}function s(e){if(null==e)return null;switch(e.type){case"polygon":case"multipoint":case"polyline":return e.extent;case"point":return new n.default({xmin:e.x,ymin:e.y,xmax:e.x,ymax:e.y,spatialReference:e.spatialReference});case"extent":return e}return null}function a(e){if(null==e)return null;if("number"==typeof e)return e;let t=e.toLowerCase();switch(t=t.replaceAll(/\s/g,""),t=t.replaceAll("-",""),t){case"meters":case"meter":case"m":case"squaremeters":case"squaremeter":return 9001;case"miles":case"mile":case"squaremile":case"squaremiles":return 9093;case"kilometers":case"kilometer":case"squarekilometers":case"squarekilometer":case"km":return 9036;case"yard":case"yd":case"yards":case"squareyards":case"squareyard":return 9096;case"feet":case"ft":case"foot":case"squarefeet":case"squarefoot":return 9002;case"nmi":case"nauticalmile":case"nauticalmiles":case"squarenauticalmile":case"squarenauticalmiles":return 9030}return null}function o(e){if(null==e)return null;const t=e.clone();return void 0!==e.cache._geVersion&&(t.cache._geVersion=e.cache._geVersion),t}function l(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}},62480:function(e,t,r){r.d(t,{D:function(){return H},b:function(){return z}});var n=r(30087),i=r(36101),s=r(27264),a=r(13668),o=r(34178),l=r(14812),c=r(11377),u=r(91765),d=r(40883),h=r(2457),f=r(85709),p=r(94211),m=r(74603),g=r(15209),_=r(40602),y=r(32488),v=r(97910),T=r(42426),b=r(50865),S=r(51942),A=r(11520),E=r(56574),w=r(77771),I=r(86207),x=r(58766),R=r(28686),M=r(19462),O=r(54613),C=r(20830),N=r(82598),L=r(38917),F=r(14543),D=r(39506),P=r(62988),B=r(39838),U=r(65839),G=r(25124);function z(e){const t=new P.N5,{vertex:r,fragment:z,varyings:H}=t,{output:V,normalType:k,offsetBackfaces:j,instancedColor:Z,spherical:q,receiveShadows:W,snowCover:Y,pbrMode:$,textureAlphaPremultiplied:X,instancedDoublePrecision:J,hasVertexColors:Q,hasVertexTangents:K,hasColorTexture:ee,hasNormalTexture:te,hasNormalTextureTransform:re,hasColorTextureTransform:ne}=e;if((0,C.NB)(r,e),t.include(u.I),H.add("vpos","vec3"),t.include(x.A,e),t.include(l.B,e),t.include(m.G,e),t.include(I.q2,e),!(0,s.RN)(V))return t.include(g.E,e),t;t.include(I.Sx,e),t.include(I.MU,e),t.include(I.O1,e),t.include(I.QM,e),(0,C.yu)(r,e),t.include(c.Y,e),t.include(o.d,e);const ie=k===c.W.Attribute||k===c.W.Compressed;return ie&&j&&t.include(i.M),t.include(_.W,e),t.include(p.Mh,e),Z&&t.attributes.add(U.r.INSTANCECOLOR,"vec4"),H.add("vPositionLocal","vec3"),t.include(h.U,e),t.include(n.oD,e),t.include(d.K,e),t.include(f.c,e),r.uniforms.add(new L.E("externalColor",(e=>e.externalColor))),H.add("vcolorExt","vec4"),e.terrainDepthTest&&H.add("depth","float"),r.main.add(D.H`
    forwardNormalizedVertexColor();
    vcolorExt = externalColor;
    ${(0,D.If)(Z,"vcolorExt *= instanceColor * 0.003921568627451;")}
    vcolorExt *= vvColor();
    vcolorExt *= getSymbolColor();
    forwardColorMixMode();

    if (vcolorExt.a < ${D.H.float(R.Q)}) {
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
    } else {
      vpos = getVertexInLocalOriginSpace();
      vPositionLocal = vpos - view[3].xyz;
      vpos = subtractOrigin(vpos);
      ${(0,D.If)(ie,"vNormalWorld = dpNormal(vvLocalNormal(normalModel()));")}
      vpos = addVerticalOffset(vpos, localOrigin);
      ${(0,D.If)(K,"vTangent = dpTransformVertexTangent(tangent);")}
      gl_Position = transformPosition(proj, view, vpos);
      ${(0,D.If)(ie&&j,"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);")}
    }

    ${(0,D.If)(e.terrainDepthTest,"depth = (view * vec4(vpos, 1.0)).z;")}
    forwardLinearDepth();
    forwardTextureCoordinates();
    forwardColorUV();
    forwardNormalUV();
    forwardEmissiveUV();
    forwardOcclusionUV();
    forwardMetallicRoughnessUV();
  `),t.include(v.kA,e),t.include(y.n,e),t.include(M.S,e),t.include(J?E.G:E.Bz,e),t.include(w.Z,e),t.include(a.HQ,e),t.include(G.z,e),(0,C.yu)(z,e),z.uniforms.add(r.uniforms.get("localOrigin"),new N.t("ambient",(e=>e.ambient)),new N.t("diffuse",(e=>e.diffuse)),new F.m("opacity",(e=>e.opacity)),new F.m("layerOpacity",(e=>e.layerOpacity))),ee&&z.uniforms.add(new B.N("tex",(e=>e.texture))),t.include(A._Z,e),t.include(S.c,e),z.include(O.N),t.include(b.r,e),(0,v.a8)(z),(0,v.eU)(z),(0,T.O4)(z),z.main.add(D.H`
      discardBySlice(vpos);
      ${(0,D.If)(e.terrainDepthTest,"terrainDepthTest(depth);")}
      ${ee?D.H`
              vec4 texColor = texture(tex, ${ne?"colorUV":"vuv0"});
              ${(0,D.If)(X,"texColor.rgb /= texColor.a;")}
              discardOrAdjustAlpha(texColor);`:D.H`vec4 texColor = vec4(1.0);`}
      shadingParams.viewDirection = normalize(vpos - cameraPosition);
      ${k===c.W.ScreenDerivative?D.H`vec3 normal = screenDerivativeNormal(vPositionLocal);`:D.H`shadingParams.normalView = vNormalWorld;
                 vec3 normal = shadingNormal(shadingParams);`}
      applyPBRFactors();
      float ssao = evaluateAmbientOcclusionInverse() * getBakedOcclusion();

      vec3 posWorld = vpos + localOrigin;

      float additionalAmbientScale = additionalDirectedAmbientLight(posWorld);
      float shadow = ${W?"max(lightingGlobalFactor * (1.0 - additionalAmbientScale), readShadowMap(vpos, linearDepth))":(0,D.If)(q,"lightingGlobalFactor * (1.0 - additionalAmbientScale)","0.0")};

      vec3 matColor = max(ambient, diffuse);
      vec3 albedo = mixExternalColor(${(0,D.If)(Q,"vColor.rgb *")} matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
      float opacity_ = layerOpacity * mixExternalOpacity(${(0,D.If)(Q,"vColor.a * ")} opacity, texColor.a, vcolorExt.a, int(colorMixMode));
      ${te?`mat3 tangentSpace = computeTangentSpace(${K?"normal":"normal, vpos, vuv0"});\n             vec3 shadingNormal = computeTextureNormal(tangentSpace, ${re?"normalUV":"vuv0"});`:"vec3 shadingNormal = normal;"}
      vec3 normalGround = ${q?"normalize(posWorld);":"vec3(0.0, 0.0, 1.0);"}

      ${(0,D.If)(Y,D.H`
            float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
            albedo = mix(albedo, vec3(1), snow);
            shadingNormal = mix(shadingNormal, normal, snow);
            ssao = mix(ssao, 1.0, snow);`)}

      vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

      ${$===A.A9.Normal||$===A.A9.Schematic?D.H`
              float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
              ${(0,D.If)(Y,D.H`mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);`)}
              vec4 emission = ${Y?"mix(getEmissions(), vec4(0.0), snow)":"getEmissions()"};
              vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:D.H`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
      vec4 finalColor = vec4(shadedColor, opacity_);
      outputColorHighlightOID(finalColor, vpos);
  `),t}const H=Object.freeze(Object.defineProperty({__proto__:null,build:z},Symbol.toStringTag,{value:"Module"}))},88008:function(e,t,r){r.d(t,{H:function(){return D},b:function(){return C},c:function(){return L},s:function(){return O}});var n=r(13786),i=r(1932),s=r(41546),a=r(43587),o=r(27264),l=r(13668),c=r(27271),u=r(10155),d=r(1143),h=r(50399),f=r(80231),p=r(84435),m=r(58766),g=r(28686),_=r(23864),y=r(52766),v=r(19202),T=r(20830),b=r(11687),S=r(41356),A=r(38917),E=r(14543),w=r(39506),I=r(62988),x=r(39838),R=r(54840),M=r(65839);const O={occludedFadeFactor:.6};function C(e){const t=new I.N5,r=e.signedDistanceFieldEnabled;if(t.include(d.Q,e),t.include(l.HQ,e),e.occlusionPass)return t.include(h.I,e),t;const{vertex:i,fragment:C}=t;t.include(v.Y6),t.include(m.A,e),t.include(c.g,e),t.include(f.y),C.include(y.W),C.include(_.a),t.varyings.add("vcolor","vec4"),t.varyings.add("vtc","vec2"),t.varyings.add("vsize","vec2"),t.varyings.add("voccluded","float"),i.uniforms.add(new A.E("viewport",((e,t)=>t.camera.fullViewport)),new b.G("screenOffset",((e,t)=>(0,n.hZ)(F,2*e.screenOffset[0]*t.camera.pixelRatio,2*e.screenOffset[1]*t.camera.pixelRatio))),new b.G("anchorPosition",(e=>L(e))),new A.E("materialColor",(e=>e.color)),new E.m("materialRotation",(e=>e.rotation))),(0,T.Nz)(i),r&&(i.uniforms.add(new A.E("outlineColor",(e=>e.outlineColor))),C.uniforms.add(new A.E("outlineColor",(e=>N(e)?e.outlineColor:s.uY)),new E.m("outlineSize",(e=>N(e)?e.outlineSize:0)))),e.horizonCullingEnabled&&i.uniforms.add(new S.V("pointDistanceSphere",((e,t)=>{const r=t.camera.eye,n=e.origin;return(0,s.fA)(n[0]-r[0],n[1]-r[1],n[2]-r[2],a.$O.radius)}))),e.pixelSnappingEnabled&&i.include(u.K),e.hasScreenSizePerspective&&((0,v.pM)(i),(0,v.OH)(i)),e.debugDrawLabelBorder&&t.varyings.add("debugBorderCoords","vec4"),t.attributes.add(M.r.UV0,"vec2"),t.attributes.add(M.r.COLOR,"vec4"),t.attributes.add(M.r.SIZE,"vec2"),t.attributes.add(M.r.ROTATION,"float"),t.attributes.add(M.r.FEATUREATTRIBUTE,"vec4"),i.code.add(e.horizonCullingEnabled?w.H`bool behindHorizon(vec3 posModel) {
vec3 camToEarthCenter = pointDistanceSphere.xyz - localOrigin;
vec3 camToPos = pointDistanceSphere.xyz + posModel;
float earthRadius = pointDistanceSphere.w;
float a = dot(camToPos, camToPos);
float b = dot(camToPos, camToEarthCenter);
float c = dot(camToEarthCenter, camToEarthCenter) - earthRadius * earthRadius;
return  b > 0.0 && b < a && b * b  > a * c;
}`:w.H`bool behindHorizon(vec3 posModel) { return false; }`),i.main.add(w.H`
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }

      if (behindHorizon(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }

      vec2 inputSize;
      ${(0,w.If)(e.hasScreenSizePerspective,w.H`
          inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
          vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);`,w.H`
          inputSize = size;
          vec2 screenOffsetScaled = screenOffset;`)}
      ${(0,w.If)(e.vvSize,w.H`inputSize *= vvScale(featureAttribute).xx;`)}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);
      bool visible = testHUDVisibility(posProj);
      voccluded = visible ? 0.0 : 1.0;
    `);const D=w.H`
      vec2 uv01 = floor(uv0);
      vec2 uv = uv0 - uv01;
      quadOffset.xy = (uv01 - anchorPosition) * 2.0 * combinedSize;

      ${(0,w.If)(e.hasRotation,w.H`
          float angle = radians(materialRotation + rotation);
          float cosAngle = cos(angle);
          float sinAngle = sin(angle);
          mat2 rotate = mat2(cosAngle, -sinAngle, sinAngle,  cosAngle);

          quadOffset.xy = rotate * quadOffset.xy;
        `)}

      quadOffset.xy = (quadOffset.xy + screenOffsetScaled) / viewport.zw * posProj.w;
  `,P=e.pixelSnappingEnabled?r?w.H`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:w.H`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:w.H`posProj += quadOffset;`;i.main.add(w.H`
    ${(0,w.If)(e.occlusionTestEnabled,w.H`
      if (!visible) {
        vtc = vec2(0.0);
        ${(0,w.If)(e.debugDrawLabelBorder,"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);")}
        return;
      }`)}
    ${D}
    ${e.vvColor?"vcolor = interpolateVVColor(featureAttribute.y) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    ${(0,w.If)(e.output===o.V.ObjectAndLayerIdColor,w.H`vcolor.a = 1.0;`)}

    bool alphaDiscard = vcolor.a < ${w.H.float(g.Q)};
    ${(0,w.If)(r,`alphaDiscard = alphaDiscard && outlineColor.a < ${w.H.float(g.Q)};`)}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${P}
      gl_Position = posProj;
    }

    vtc = uv;

    ${(0,w.If)(e.debugDrawLabelBorder,w.H`debugBorderCoords = vec4(uv01, 1.5 / combinedSize);`)}
    vsize = inputSize;
  `),C.uniforms.add(new x.N("tex",(e=>e.texture))),e.occludedFragmentFade&&(C.uniforms.add(new x.N("depthMap",((e,t)=>t.mainDepth))),C.uniforms.add(new E.m("fadeFactor",(()=>O.occludedFadeFactor))));const B=e.debugDrawLabelBorder?w.H`(isBorder > 0.0 ? 0.0 : ${w.H.float(g.Q)})`:w.H.float(g.Q),U=e.output===o.V.Highlight,G=w.H`
    ${(0,w.If)(e.debugDrawLabelBorder,w.H`float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`)}

    ${(0,w.If)(e.sampleSignedDistanceFieldTexelCenter,w.H`
      float txSize = float(textureSize(tex, 0).x);
      float texelSize = 1.0 / txSize;

      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;`,w.H`vec2 samplePos = vtc;`)}

    ${r?w.H`
      vec4 fillPixelColor = vcolor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${B} ||
          fillPixelColor.a + outlinePixelColor.a < ${w.H.float(g.Q)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        ${(0,w.If)(!U,w.H`fragColor = vec4(compositeColor, compositeAlpha);`)}
      } else {
        if (fillAlphaFactor < ${B}) {
          discard;
        }

        ${(0,w.If)(!U,w.H`fragColor = premultiplyAlpha(fillPixelColor);`)}
      }

      // visualize SDF:
      // fragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:w.H`
          vec4 texColor = texture(tex, vtc, -0.5);
          if (texColor.a < ${B}) {
            discard;
          }
          ${(0,w.If)(!U,w.H`fragColor = texColor * premultiplyAlpha(vcolor);`)}
          `}

    ${(0,w.If)(e.occludedFragmentFade&&!U,w.H`
        float zSample = texelFetch(depthMap, ivec2(gl_FragCoord.xy), 0).x;
        if (zSample < gl_FragCoord.z) {
          fragColor *= fadeFactor;
        }
        `)}

    ${(0,w.If)(!U&&e.debugDrawLabelBorder,w.H`fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`)}
  `;switch(e.output){case o.V.Color:e.oitPass===R.Y.ColorAlpha&&(t.outputs.add("fragColor","vec4",0),t.outputs.add("fragAlpha","float",1)),C.main.add(w.H`
        ${G}
        ${(0,w.If)(e.oitPass===R.Y.FrontFace,w.H`fragColor.rgb /= fragColor.a;`)}
        ${(0,w.If)(e.oitPass===R.Y.ColorAlpha,w.H`fragAlpha = fragColor.a;`)}`);break;case o.V.ObjectAndLayerIdColor:C.main.add(w.H`
        ${G}
        outputObjectAndLayerIdColor();`);break;case o.V.Highlight:t.include(p.Q,e),C.main.add(w.H`
        ${G}
        outputHighlight(voccluded == 1.0);`)}return t}function N(e){return e.outlineColor[3]>0&&e.outlineSize>0}function L(e,t=F){return e.textureIsSignedDistanceField?function(e,t,r){null!=t?(0,n.hZ)(r,e[0]*(t[2]-t[0])+t[0],e[1]*(t[3]-t[1])+t[1]):(0,n.hZ)(r,0,0)}(e.anchorPosition,e.distanceFieldBoundingBox,t):(0,n.C)(t,e.anchorPosition),t}const F=(0,i.vt)(),D=Object.freeze(Object.defineProperty({__proto__:null,build:C,calculateAnchorPosForRendering:L,shaderSettings:O},Symbol.toStringTag,{value:"Module"}))},93776:function(e,t,r){r.d(t,{R:function(){return B},b:function(){return P}});var n=r(30087),i=r(36101),s=r(27264),a=r(13668),o=r(34178),l=r(14812),c=r(11377),u=r(91765),d=r(40883),h=r(2457),f=r(85709),p=r(74603),m=r(15209),g=r(32488),_=r(97910),y=r(42426),v=r(51942),T=r(11520),b=r(56574),S=r(77771),A=r(58766),E=r(28686),w=r(19462),I=r(54613),x=r(20830),R=r(82598),M=r(38917),O=r(14543),C=r(39506),N=r(62988),L=r(39838),F=r(65839),D=r(25124);function P(e){const t=new N.N5,{vertex:r,fragment:P,varyings:B}=t,{output:U,offsetBackfaces:G,instancedColor:z,pbrMode:H,snowCover:V,spherical:k}=e,j=H===T.A9.Normal||H===T.A9.Schematic;if((0,x.NB)(r,e),t.include(u.I),B.add("vpos","vec3"),t.include(A.A,e),t.include(l.B,e),t.include(p.G,e),U===s.V.Color&&((0,x.yu)(t.vertex,e),t.include(c.Y,e),t.include(o.d,e),G&&t.include(i.M),z&&t.attributes.add(F.r.INSTANCECOLOR,"vec4"),B.add("vNormalWorld","vec3"),B.add("localvpos","vec3"),e.terrainDepthTest&&B.add("depth","float"),t.include(h.U,e),t.include(n.oD,e),t.include(d.K,e),t.include(f.c,e),r.uniforms.add(new M.E("externalColor",(e=>e.externalColor))),B.add("vcolorExt","vec4"),r.main.add(C.H`
      forwardNormalizedVertexColor();
      vcolorExt = externalColor;
      ${(0,C.If)(z,"vcolorExt *= instanceColor * 0.003921568627451;")}
      vcolorExt *= vvColor();
      vcolorExt *= getSymbolColor();
      forwardColorMixMode();

      if (vcolorExt.a < ${C.H.float(E.Q)}) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      } else {
        vpos = getVertexInLocalOriginSpace();
        localvpos = vpos - view[3].xyz;
        vpos = subtractOrigin(vpos);
        vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPosition(proj, view, vpos);
        ${(0,C.If)(G,"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);")}
      }
      ${(0,C.If)(e.terrainDepthTest,"depth = (view * vec4(vpos, 1.0)).z;")}
      forwardLinearDepth();
      forwardTextureCoordinates();`)),U===s.V.Color){const{hasColorTexture:n,hasColorTextureTransform:i,receiveShadows:s}=e;t.include(_.kA,e),t.include(g.n,e),t.include(w.S,e),t.include(e.instancedDoublePrecision?b.G:b.Bz,e),t.include(S.Z,e),t.include(a.HQ,e),t.include(D.z,e),(0,x.yu)(t.fragment,e),(0,y.Gc)(P),(0,_.a8)(P),(0,_.eU)(P),P.uniforms.add(r.uniforms.get("localOrigin"),r.uniforms.get("view"),new R.t("ambient",(e=>e.ambient)),new R.t("diffuse",(e=>e.diffuse)),new O.m("opacity",(e=>e.opacity)),new O.m("layerOpacity",(e=>e.layerOpacity))),n&&P.uniforms.add(new L.N("tex",(e=>e.texture))),t.include(T._Z,e),t.include(v.c,e),P.include(I.N),(0,y.O4)(P),P.main.add(C.H`
      discardBySlice(vpos);
      ${(0,C.If)(e.terrainDepthTest,"terrainDepthTest(depth);")}
      vec4 texColor = ${n?`texture(tex, ${i?"colorUV":"vuv0"})`:" vec4(1.0)"};
      ${(0,C.If)(n,`${(0,C.If)(e.textureAlphaPremultiplied,"texColor.rgb /= texColor.a;")}\n        discardOrAdjustAlpha(texColor);`)}
      vec3 viewDirection = normalize(vpos - cameraPosition);
      applyPBRFactors();
      float ssao = evaluateAmbientOcclusionInverse();
      ssao *= getBakedOcclusion();

      float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
      vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
      float shadow = ${s?"max(lightingGlobalFactor * (1.0 - additionalAmbientScale), readShadowMap(vpos, linearDepth))":k?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};
      vec3 matColor = max(ambient, diffuse);
      ${e.hasVertexColors?C.H`vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
             float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:C.H`vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
             float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
      ${(0,C.If)(V,"albedo = mix(albedo, vec3(1), 0.9);")}
      ${C.H`vec3 shadingNormal = normalize(vNormalWorld);
             albedo *= 1.2;
             vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
             float alignmentLightView = clamp(dot(viewForward, -mainLightDirection), 0.0, 1.0);
             float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
             float treeRadialFalloff = vColor.r;
             float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
             additionalLight += backLightFactor * mainLightIntensity;`}
      ${(0,C.If)(j,`vec3 normalGround = ${k?"normalize(vpos + localOrigin)":"vec3(0.0, 0.0, 1.0)"};`)}
      ${j?C.H`float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                 ${(0,C.If)(V,C.H`mrr = vec3(0.0, 1.0, 0.04);`)}
            vec4 emission = ${V?"vec4(0.0)":"getEmissions()"};
            vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:C.H`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
      vec4 finalColor = vec4(shadedColor, opacity_);
      outputColorHighlightOID(finalColor, vpos);`)}return t.include(m.E,e),t}const B=Object.freeze(Object.defineProperty({__proto__:null,build:P},Symbol.toStringTag,{value:"Module"}))},184:function(e,t,r){r.d(t,{S:function(){return _},b:function(){return p},g:function(){return m}});var n=r(13786),i=r(1932),s=r(77423),a=r(23397),o=r(82316),l=r(11687),c=r(14543),u=r(39506),d=r(62988),h=r(39838);const f=16;function p(){const e=new d.N5,t=e.fragment;return e.include(s.c),e.include(o.Ir),t.include(a.E),t.uniforms.add(new c.m("radius",((e,t)=>m(t.camera)))).code.add(u.H`vec3 sphere[16] = vec3[16](
vec3(0.186937, 0.0, 0.0),
vec3(0.700542, 0.0, 0.0),
vec3(-0.864858, -0.481795, -0.111713),
vec3(-0.624773, 0.102853, -0.730153),
vec3(-0.387172, 0.260319, 0.007229),
vec3(-0.222367, -0.642631, -0.707697),
vec3(-0.01336, -0.014956, 0.169662),
vec3(0.122575, 0.1544, -0.456944),
vec3(-0.177141, 0.85997, -0.42346),
vec3(-0.131631, 0.814545, 0.524355),
vec3(-0.779469, 0.007991, 0.624833),
vec3(0.308092, 0.209288,0.35969),
vec3(0.359331, -0.184533, -0.377458),
vec3(0.192633, -0.482999, -0.065284),
vec3(0.233538, 0.293706, -0.055139),
vec3(0.417709, -0.386701, 0.442449)
);
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn - bias, 0.0);
}`),t.code.add(u.H`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),t.uniforms.add(new h.N("normalMap",(e=>e.normalTexture)),new h.N("depthMap",(e=>e.depthTexture)),new c.m("projScale",(e=>e.projScale)),new h.N("rnm",(e=>e.noiseTexture)),new l.G("rnmScale",((e,t)=>(0,n.hZ)(g,t.camera.fullWidth/e.noiseTexture.descriptor.width,t.camera.fullHeight/e.noiseTexture.descriptor.height))),new c.m("intensity",(e=>e.intensity)),new l.G("screenSize",((e,t)=>(0,n.hZ)(g,t.camera.fullWidth,t.camera.fullHeight)))),e.outputs.add("fragOcclusion","float"),t.main.add(u.H`
      float depth = depthFromTexture(depthMap, uv);

      // Early out if depth is out of range, such as in the sky
      if (depth >= 1.0 || depth <= 0.0) {
        fragOcclusion = 1.0;
        return;
      }

      // get the normal of current fragment
      vec4 norm4 = texture(normalMap, uv);
      if(norm4.a != 1.0) {
        fragOcclusion = 1.0;
        return;
      }
      vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;

      float currentPixelDepth = linearizeDepth(depth);
      vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy, currentPixelDepth);

      float sum = 0.0;
      vec3 tapPixelPos;

      vec3 fres = normalize(2.0 * texture(rnm, uv * rnmScale).xyz - 1.0);

      // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
      // bug or deviation from CE somewhere else?
      float ps = projScale / (2.0 * currentPixelPos.z * zScale.x + zScale.y);

      for(int i = 0; i < ${u.H.int(f)}; ++i) {
        vec2 unitOffset = reflect(sphere[i], fres).xy;
        vec2 offset = vec2(-unitOffset * radius * ps);

        // don't use current or very nearby samples
        if( abs(offset.x) < 2.0 || abs(offset.y) < 2.0){
          continue;
        }

        vec2 tc = vec2(gl_FragCoord.xy + offset);
        if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
        vec2 tcTap = tc / screenSize;
        float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap);

        tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

        sum += aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
      }

      // output the result
      float A = max(1.0 - sum * intensity / float(${u.H.int(f)}), 0.0);

      // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4) / 2.2
      A = (pow(A, 0.2) + 1.2 * A * A * A * A) / 2.2;

      fragOcclusion = A;`),e}function m(e){return Math.max(10,20*e.computeScreenPixelSizeAtDist(Math.abs(4*e.relativeElevation)))}const g=(0,i.vt)(),_=Object.freeze(Object.defineProperty({__proto__:null,build:p,getRadius:m},Symbol.toStringTag,{value:"Module"}))},37739:function(e,t,r){r.d(t,{S:function(){return f},b:function(){return h}});var n=r(77423),i=r(23397),s=r(30262),a=r(14543),o=r(39506),l=r(62988),c=r(40075),u=r(39838);const d=4;function h(){const e=new l.N5,t=e.fragment;e.include(n.c);const r=(d+1)/2,h=1/(2*r*r);return t.include(i.E),t.uniforms.add(new u.N("depthMap",(e=>e.depthTexture)),new c.o("tex",(e=>e.colorTexture)),new s.t("blurSize",(e=>e.blurSize)),new a.m("projScale",((e,t)=>{const r=t.camera.distance;return r>5e4?Math.max(0,e.projScale-(r-5e4)):e.projScale}))),t.code.add(o.H`
    void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
      float c = texture(tex, uv).r;
      float d = linearDepthFromTexture(depthMap, uv);

      float ddiff = d - center_d;

      float w = exp(-r * r * ${o.H.float(h)} - ddiff * ddiff * sharpness);
      wTotal += w;
      bTotal += w * c;
    }
  `),e.outputs.add("fragBlur","float"),t.main.add(o.H`
    float b = 0.0;
    float w_total = 0.0;

    float center_d = linearDepthFromTexture(depthMap, uv);

    float sharpness = -0.05 * projScale / center_d;
    for (int r = -${o.H.int(d)}; r <= ${o.H.int(d)}; ++r) {
      float rf = float(r);
      vec2 uvOffset = uv + rf * blurSize;
      blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
    }
    fragBlur = b / w_total;`),e}const f=Object.freeze(Object.defineProperty({__proto__:null,build:h},Symbol.toStringTag,{value:"Module"}))},2075:function(e,t,r){r.d(t,{a:function(){return y},b:function(){return Z},c:function(){return v},f:function(){return T},g:function(){return A},h:function(){return O},u:function(){return b}}),r(58941);var n=r(40633),i=r(15774),s=r(89736),a=r(73364),o=r(39714),l=r(20551),c=r(32501),u=r(87416),d=r(72485),h=r(73313),f=r(5596),p=r(79578),m=r(29531),g=r(50973);const _=()=>n.A.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");function y(e=B){return{plane:(0,f.vt)(e.plane),origin:(0,c.o8)(e.origin),basis1:(0,c.o8)(e.basis1),basis2:(0,c.o8)(e.basis2)}}function v(e,t=y()){return T(e.origin,e.basis1,e.basis2,t)}function T(e,t,r,n=y()){return(0,l.c)(n.origin,e),(0,l.c)(n.basis1,t),(0,l.c)(n.basis2,r),b(n),function(e,t){Math.abs((0,l.f)(e.basis1,e.basis2)/((0,l.l)(e.basis1)*(0,l.l)(e.basis2)))>1e-6&&_().warn(t,"Provided basis vectors are not perpendicular"),Math.abs((0,l.f)(e.basis1,N(e)))>1e-6&&_().warn(t,"Basis vectors and plane normal are not perpendicular"),Math.abs(-(0,l.f)(N(e),e.origin)-e.plane[3])>1e-6&&_().warn(t,"Plane offset is not consistent with plane origin")}(n,"fromValues()"),n}function b(e){(0,f.mR)(e.basis2,e.basis1,e.origin,e.plane)}function S(e,t,r){e!==r&&v(e,r);const n=(0,l.h)(g.rq.get(),N(e),t);return(0,l.g)(r.origin,r.origin,n),r.plane[3]-=t,r}function A(e,t=y()){const r=(e[2]-e[0])/2,n=(e[3]-e[1])/2;return(0,l.i)(t.origin,e[0]+r,e[1]+n,0),(0,l.i)(t.basis1,r,0,0),(0,l.i)(t.basis2,0,n,0),(0,f.fA)(0,0,1,0,t.plane),t}function E(e,t,r){return!!(0,f.Ui)(e.plane,t,r)&&L(e,r)}function w(e,t,r){const n=U.get();P(e,t,n,U.get());let s=Number.POSITIVE_INFINITY;for(const a of V){const o=D(e,a,G.get()),c=g.rq.get();if((0,f.T7)(n,o,c)){const e=(0,l.o)(g.rq.get(),t.origin,c),n=Math.abs((0,i.XM)((0,l.f)(t.direction,e)));n<s&&(s=n,(0,l.c)(r,c))}}return s===Number.POSITIVE_INFINITY?I(e,t,r):r}function I(e,t,r){if(E(e,t,r))return r;const n=U.get(),i=U.get();P(e,t,n,i);let s=Number.POSITIVE_INFINITY;for(const a of V){const o=D(e,a,G.get()),c=g.rq.get();if((0,f.gv)(n,o,c)){const e=(0,p.kb)(t,c);if(!(0,f.Tj)(i,c))continue;e<s&&(s=e,(0,l.c)(r,c))}}return M(e,t.origin)<s&&x(e,t.origin,r),r}function x(e,t,r){const n=(0,f._I)(e.plane,t,g.rq.get()),i=(0,h.H6)(F(e,e.basis1),n,-1,1,g.rq.get()),s=(0,h.H6)(F(e,e.basis2),n,-1,1,g.rq.get());return(0,l.d)(r,(0,l.g)(g.rq.get(),i,s),e.origin),r}function R(e,t,r){const{origin:n,basis1:i,basis2:s}=e,a=(0,l.d)(g.rq.get(),t,n),o=(0,m.gr)(i,a),c=(0,m.gr)(s,a),u=(0,m.gr)(N(e),a);return(0,l.i)(r,o,c,u)}function M(e,t){const r=R(e,t,g.rq.get()),{basis1:n,basis2:i}=e,s=(0,l.l)(n),a=(0,l.l)(i),o=Math.max(Math.abs(r[0])-s,0),c=Math.max(Math.abs(r[1])-a,0),u=r[2];return o*o+c*c+u*u}function O(e,t){return Math.sqrt(M(e,t))}function C(e,t){const r=-e.plane[3];return(0,m.gr)(N(e),t)-r}function N(e){return(0,f.Qj)(e.plane)}function L(e,t){const r=(0,l.d)(g.rq.get(),t,e.origin),n=(0,l.k)(e.basis1),i=(0,l.k)(e.basis2),s=(0,l.f)(e.basis1,r),a=(0,l.f)(e.basis2,r);return-s-n<0&&s-n<0&&-a-i<0&&a-i<0}function F(e,t){const r=G.get();return(0,l.c)(r.origin,e.origin),(0,l.c)(r.vector,t),r}function D(e,t,r){const{basis1:n,basis2:i,origin:s}=e,a=(0,l.h)(g.rq.get(),n,t.origin[0]),o=(0,l.h)(g.rq.get(),i,t.origin[1]);(0,l.g)(r.origin,a,o),(0,l.g)(r.origin,r.origin,s);const c=(0,l.h)(g.rq.get(),n,t.direction[0]),u=(0,l.h)(g.rq.get(),i,t.direction[1]);return(0,l.h)(r.vector,(0,l.g)(c,c,u),2),r}function P(e,t,r,n){const i=N(e);(0,f.mR)(i,t.direction,t.origin,r),(0,f.mR)((0,f.Qj)(r),i,t.origin,n)}const B={plane:(0,f.vt)(),origin:(0,c.fA)(0,0,0),basis1:(0,c.fA)(1,0,0),basis2:(0,c.fA)(0,1,0)},U=new s.I(f.vt),G=new s.I(h.vt),z=(0,c.vt)(),H=new s.I((()=>y())),V=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],k=(0,o.vt)(),j=(0,o.vt)(),Z=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:class{constructor(){this.plane=(0,f.vt)(),this.origin=(0,c.vt)(),this.basis1=(0,c.vt)(),this.basis2=(0,c.vt)()}},altitudeAt:C,axisAt:function(e,t,r,n){return function(e,t,r){switch(t){case d._.X:(0,l.c)(r,e.basis1),(0,l.n)(r,r);break;case d._.Y:(0,l.c)(r,e.basis2),(0,l.n)(r,r);break;case d._.Z:(0,l.c)(r,N(e))}return r}(e,r,n)},cameraFrustumCoverage:function(e,t){return(t-e)/t},closestPoint:I,closestPointOnSilhouette:w,copy:v,copyWithoutVerify:function(e,t){(0,l.c)(t.origin,e.origin),(0,l.c)(t.basis1,e.basis1),(0,l.c)(t.basis2,e.basis2),(0,f.C)(t.plane,e.plane)},create:y,distance:O,distance2:M,distanceToSilhouette:function(e,t){let r=Number.NEGATIVE_INFINITY;for(const n of V){const i=D(e,n,G.get()),s=(0,h.kb)(i,t);s>r&&(r=s)}return Math.sqrt(r)},elevate:S,equals:function(e,t){return(0,l.p)(e.basis1,t.basis1)&&(0,l.p)(e.basis2,t.basis2)&&(0,l.p)(e.origin,t.origin)},extrusionContainsPoint:function(e,t){return(0,f.Tj)(e.plane,t)&&L(e,t)},fromAABoundingRect:A,fromValues:T,getExtent:function(e,t){const r=e.basis1[0],n=e.basis2[1],[i,s]=e.origin;return(0,u.fA)(i-r,s-n,i+r,s+n,t)},intersectRay:E,intersectRayClosestSilhouette:function(e,t,r){if(E(e,t,r))return r;const n=w(e,t,g.rq.get());return(0,l.g)(r,t.origin,(0,l.h)(g.rq.get(),t.direction,(0,l.j)(t.origin,n)/(0,l.l)(t.direction))),r},normal:N,projectPoint:x,projectPointLocal:R,rotate:function(e,t,r,n){return e!==n&&v(e,n),(0,a.$0)(j,t,r),(0,l.t)(n.basis1,e.basis1,j),(0,l.t)(n.basis2,e.basis2,j),b(n),n},setAltitudeAt:function(e,t,r,n){const i=C(e,t),s=(0,l.h)(z,N(e),r-i);return(0,l.g)(n,t,s),n},setExtent:function(e,t,r){return A(t,r),S(r,C(e,e.origin),r),r},transform:function(e,t,r){return e!==r&&v(e,r),(0,a.B8)(k,t),(0,a.mg)(k,k),(0,l.t)(r.basis1,e.basis1,k),(0,l.t)(r.basis2,e.basis2,k),(0,l.t)((0,f.Qj)(r.plane),(0,f.Qj)(e.plane),k),(0,l.t)(r.origin,e.origin,t),(0,f.mP)(r.plane,r.plane,r.origin),r},up:B,updateUnboundedPlane:b,wrap:function(e,t,r){const n=H.get();return n.origin=e,n.basis1=t,n.basis2=r,n.plane=(0,f.LV)(0,0,0,0),b(n),n}},Symbol.toStringTag,{value:"Module"}))},88923:function(e,t,r){function n(e,t,r,n,s){i(e,t,r||0,n||e.length-1,s||a)}function i(e,t,r,n,a){for(;n>r;){if(n-r>600){var o=n-r+1,l=t-r+1,c=Math.log(o),u=.5*Math.exp(2*c/3),d=.5*Math.sqrt(c*u*(o-u)/o)*(l-o/2<0?-1:1);i(e,t,Math.max(r,Math.floor(t-l*u/o+d)),Math.min(n,Math.floor(t+(o-l)*u/o+d)),a)}var h=e[t],f=r,p=n;for(s(e,r,t),a(e[n],h)>0&&s(e,r,n);f<p;){for(s(e,f,p),f++,p--;a(e[f],h)<0;)f++;for(;a(e[p],h)>0;)p--}0===a(e[r],h)?s(e,r,p):s(e,++p,n),p<=t&&(r=p+1),t<=p&&(n=p-1)}}function s(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function a(e,t){return e<t?-1:e>t?1:0}r.d(t,{q:function(){return n}})},13794:function(e,t,r){r.d(t,{N:function(){return m},a:function(){return A},c:function(){return g},e:function(){return v},f:function(){return E},g:function(){return S},k:function(){return O},l:function(){return T},m:function(){return _},n:function(){return I},o:function(){return B},p:function(){return N},s:function(){return z},w:function(){return b}}),r(58941),r(40633);var n=r(15774),i=r(73364),s=r(20551),a=r(32501),o=r(33400),l=r(41546),c=r(8527),u=r(72485),d=r(79578);function h(e,t){const r=(0,s.l)(e),i=(0,n.YN)(e[2]/r),a=Math.atan2(e[1]/r,e[0]/r);return(0,s.i)(t,r,i,a),t}var f=r(29531),p=r(50973);const m=g();function g(){return(0,l.vt)()}const _=o.e,y=o.e;function v(e,t){return(0,o.c)(t,e)}function T(e,t){return(0,l.fA)(e[0],e[1],e[2],t)}function b(e){return e}function S(e){return e[3]}function A(e){return e}function E(e,t,r,n){return(0,l.fA)(e,t,r,n)}function w(e,t,r){if(null==t)return!1;if(!R(e,t,x))return!1;let{t0:n,t1:i}=x;if((n<0||i<n&&i>0)&&(n=i),n<0)return!1;if(r){const{origin:e,direction:i}=t;r[0]=e[0]+i[0]*n,r[1]=e[1]+i[1]*n,r[2]=e[2]+i[2]*n}return!0}function I(e,t,r){const n=(0,d.Cr)(t,r);if(!R(e,n,x))return[];const{origin:i,direction:o}=n,{t0:l,t1:u}=x,h=t=>{const r=(0,a.vt)();return(0,s.b)(r,i,o,t),N(e,r,r)};return Math.abs(l-u)<(0,c.FD)()?[h(l)]:[h(l),h(u)]}const x={t0:0,t1:0};function R(e,t,r){const{origin:n,direction:i}=t,s=M;s[0]=n[0]-e[0],s[1]=n[1]-e[1],s[2]=n[2]-e[2];const a=i[0]*i[0]+i[1]*i[1]+i[2]*i[2];if(0===a)return!1;const o=2*(i[0]*s[0]+i[1]*s[1]+i[2]*s[2]),l=o*o-4*a*(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]-e[3]*e[3]);if(l<0)return!1;const c=Math.sqrt(l);return r.t0=(-o-c)/(2*a),r.t1=(-o+c)/(2*a),!0}const M=(0,a.vt)();function O(e,t){return w(e,t,null)}function C(e,t,r){const n=p.rq.get(),a=p.Rc.get();(0,s.e)(n,t.origin,t.direction);const o=S(e);(0,s.e)(r,n,t.origin),(0,s.h)(r,r,1/(0,s.l)(r)*o);const l=L(e,t.origin),c=(0,f.g7)(t.origin,r);return(0,i.$0)(a,c+l,n),(0,s.t)(r,r,a),r}function N(e,t,r){const n=(0,s.d)(p.rq.get(),t,e),i=(0,s.h)(p.rq.get(),n,e[3]/(0,s.l)(n));return(0,s.g)(r,i,e)}function L(e,t){const r=(0,s.d)(p.rq.get(),t,e),i=(0,s.l)(r),a=S(e),o=a+Math.abs(a-i);return(0,n.XM)(a/o)}const F=(0,a.vt)();function D(e,t,r,n){const i=(0,s.d)(F,t,e);switch(r){case u._.X:{const e=h(i,F)[2];return(0,s.i)(n,-Math.sin(e),Math.cos(e),0)}case u._.Y:{const e=h(i,F),t=e[1],r=e[2],a=Math.sin(t);return(0,s.i)(n,-a*Math.cos(r),-a*Math.sin(r),Math.cos(t))}case u._.Z:return(0,s.n)(n,i);default:return}}function P(e,t){const r=(0,s.d)(U,t,e);return(0,s.l)(r)-e[3]}function B(e,t){const r=(0,s.s)(e,t),n=S(e);return r<=n*n}const U=(0,a.vt)(),G=g(),z=Object.freeze(Object.defineProperty({__proto__:null,NullSphere:m,altitudeAt:P,angleToSilhouette:L,axisAt:D,cameraFrustumCoverage:function(e,t,r,n){const i=S(e),s=i*i,a=t+.5*Math.PI,o=r*r+s-2*Math.cos(a)*r*i,l=Math.sqrt(o),c=o-s;if(c<=0)return.5;const u=Math.sqrt(c),d=Math.acos(u/l)-Math.asin(i/(l/Math.sin(a)));return Math.min(1,(d+.5*n)/n)},clear:function(e){e[0]=e[1]=e[2]=e[3]=0},closestPoint:function(e,t,r){return w(e,t,r)?r:((0,d.oC)(t,e,r),N(e,r,r))},closestPointOnSilhouette:C,containsPoint:B,copy:v,create:g,distanceToSilhouette:function(e,t){const r=(0,s.d)(p.rq.get(),t,e),n=(0,s.k)(r),i=e[3]*e[3];return Math.sqrt(Math.abs(n-i))},elevate:function(e,t,r){return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2]),r[3]=e[3]+t,r},equals:y,exactEquals:_,fromCenterAndRadius:T,fromRadius:function(e,t){return e[0]=e[1]=e[2]=0,e[3]=t,e},fromValues:E,getCenter:A,getExtent:function(e,t){return t},getRadius:S,intersectLine:I,intersectRay:w,intersectRayClosestSilhouette:function(e,t,r){if(w(e,t,r))return r;const n=C(e,t,p.rq.get());return(0,s.g)(r,t.origin,(0,s.h)(p.rq.get(),t.direction,(0,s.j)(t.origin,n)/(0,s.l)(t.direction))),r},intersectsRay:O,projectPoint:N,setAltitudeAt:function(e,t,r,n){const i=P(e,t),a=D(e,t,u._.Z,U),o=(0,s.h)(U,a,r-i);return(0,s.g)(n,t,o)},setExtent:function(e,t,r){return e!==r&&v(e,r),r},tmpSphere:G,union:function(e,t,r=(0,l.vt)()){const n=(0,s.j)(e,t),i=e[3],a=t[3];return n+a<i?((0,o.c)(r,e),r):n+i<a?((0,o.c)(r,t),r):((0,s.m)(r,e,t,(n+a-i)/(2*n)),r[3]=(n+i+a)/2,r)},wrap:b},Symbol.toStringTag,{value:"Module"}))},99680:function(e,t,r){r.d(t,{q:function(){return i}});var n=r(85408);class i{constructor(e,t){this._storage=new n.F,this.id="",this.name="",this.size=0,this._storage.maxSize=e,this._storage.register(this),t&&this._storage.registerRemoveFunc("",t)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(e,t,r=1){this._storage.put(this,e,t,r,1)}pop(e){return this._storage.pop(this,e)}get(e){return this._storage.get(this,e)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}resetHitRate(){}}},85408:function(e,t,r){r.d(t,{F:function(){return l},Ti:function(){return i}});var n=r(7187);const i=-3,s=i-1;var a,o;(o=a||(a={}))[o.ALL=0]="ALL",o[o.SOME=1]="SOME";class l{get size(){return this._size}constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new n.A,this._users=new n.A}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(e){this._users.push(e)}deregister(e){this._users.removeUnordered(e)}registerRemoveFunc(e,t){this._removeFuncs.push([e,t])}deregisterRemoveFunc(e){this._removeFuncs.filterInPlace((t=>t[0]!==e))}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,-1),this._checkSize()}getSize(e,t){const r=this._db.get(e.id+t);return r?.size??0}put(e,t,r,n,o){t=e.id+t;const l=this._db.get(t);if(l&&(this._size-=l.size,e.size-=l.size,this._db.delete(t),l.entry!==r&&this._notifyRemove(t,l.entry,l.size,a.ALL)),n>this._maxSize)return void this._notifyRemove(t,r,n,a.ALL);if(void 0===r)return void console.warn("Refusing to cache undefined entry ");if(!n||n<0)return console.warn(`Refusing to cache entry with size ${n} for key ${t}`),void this._notifyRemove(t,r,0,a.ALL);const u=1+Math.max(o,s)-i;this._db.set(t,new c(r,n,u)),this._size+=n,e.size+=n,this._checkSize()}updateSize(e,t,r,n){t=e.id+t;const i=this._db.get(t);if(i&&i.entry===r){for(this._size-=i.size,e.size-=i.size;n>this._maxSize;){const e=this._notifyRemove(t,r,n,a.SOME);if(!(null!=e&&e>0))return void this._db.delete(t);n=e}i.size=n,this._size+=n,e.size+=n,this._checkSize()}}pop(e,t){t=e.id+t;const r=this._db.get(t);if(r)return this._size-=r.size,e.size-=r.size,this._db.delete(t),++this._hit,r.entry;++this._miss}get(e,t){t=e.id+t;const r=this._db.get(t);if(void 0!==r)return this._db.delete(t),r.lives=r.lifetime,this._db.set(t,r),++this._hit,r.entry;++this._miss}peek(e,t){const r=this._db.get(e.id+t);return r?++this._hit:++this._miss,r?.entry}get performanceInfo(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},t={},r=new Array;this._db.forEach(((e,n)=>{const i=e.lifetime;r[i]=(r[i]||0)+e.size,this._users.forAll((r=>{const{id:i,name:s}=r;if(n.startsWith(i)){const r=t[s]||0;t[s]=r+e.size}}))}));const n={};this._users.forAll((e=>{const r=e.name;if("hitRate"in e&&"number"==typeof e.hitRate&&!isNaN(e.hitRate)&&e.hitRate>0){const i=t[r]||0;t[r]=i,n[r]=Math.round(100*e.hitRate)+"%"}else n[r]="0%"}));const s=Object.keys(t);s.sort(((e,r)=>t[r]-t[e])),s.forEach((r=>e[r]=Math.round(t[r]/2**20)+"MB / "+n[r]));for(let t=r.length-1;t>=0;--t){const n=r[t];n&&(e["Priority "+(t+i-1)]=Math.round(n/this._size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forAll((e=>e.resetHitRate()))}clear(e){const t=e.id;this._db.forEach(((e,r)=>{r.startsWith(t)&&(this._size-=e.size,this._db.delete(r),this._notifyRemove(r,e.entry,e.size,a.ALL))})),e.size=0}clearAll(){this._db.forEach(((e,t)=>this._notifyRemove(t,e.entry,e.size,a.ALL))),this._users.forAll((e=>e.size=0)),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,t,r,n){let i;return this._removeFuncs.some((s=>{if(e.startsWith(s[0])){const e=s[1](t,n,r);return"number"==typeof e&&(i=e),!0}return!1})),i}_checkSize(){this._users.forAll((e=>this._checkSizeLimits(e))),this._checkSizeLimits()}_checkSizeLimits(e){const t=e??this;if(t.maxSize<0||t.size<=t.maxSize)return;const r=e?.id;let n=!0;for(;n;){n=!1;for(const[i,s]of this._db)if(0===s.lifetime&&(!r||i.startsWith(r))){if(this._purgeItem(i,s,e),t.size<=.9*t.maxSize)return;n||=this._db.has(i)}}for(const[n,i]of this._db)if((!r||n.startsWith(r))&&(this._purgeItem(n,i,e),t.size<=.9*t.maxSize))return}_purgeItem(e,t,r=this._users.find((t=>e.startsWith(t.id)))){if(this._db.delete(e),t.lives<=1){this._size-=t.size,r&&(r.size-=t.size);const n=this._notifyRemove(e,t.entry,t.size,a.SOME);null!=n&&n>0&&(this._size+=n,r&&(r.size+=n),t.lives=t.lifetime,t.size=n,this._db.set(e,t))}else--t.lives,this._db.set(e,t)}}class c{constructor(e,t,r){this.entry=e,this.size=t,this.lifetime=r,this.lives=r}}},7970:function(e,t,r){r.d(t,{O:function(){return n}});class n{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return 0===this._outer.size}get(e,t){return this._outer.get(e)?.get(t)}getInner(e){return this._outer.get(e)}set(e,t,r){const n=this._outer.get(e);n?n.set(t,r):this._outer.set(e,new Map([[t,r]]))}delete(e,t){const r=this._outer.get(e);r&&(r.delete(t),0===r.size&&this._outer.delete(e))}forEach(e){this._outer.forEach(((t,r)=>e(t,r)))}forAll(e){for(const t of this._outer.values())for(const r of t.values())e(r)}}},89736:function(e,t,r){r.d(t,{I:function(){return i}});var n=r(29601);class i{constructor(e){this._allocator=e,this._items=[],this._itemsPtr=0,this._grow()}get(){return 0===this._itemsPtr&&(0,n.d)((()=>this._reset())),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const e=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*s);this._items.length=Math.min(e,this._items.length),this._itemsPtr=0}_grow(){for(let e=0;e<Math.max(8,Math.min(this._items.length,s));e++)this._items.push(this._allocator())}}const s=1024},62790:function(e,t,r){r.d(t,{A:function(){return s}});var n=r(44567),i=r(87085);class s{constructor(e){this._observable=new i.I,this._map=new Map(e)}get size(){return(0,n.gc)(this._observable),this._map.size}clear(){this._map.size>0&&(this._map.clear(),this._observable.notify())}delete(e){const t=this._map.delete(e);return t&&this._observable.notify(),t}entries(){return(0,n.gc)(this._observable),this._map.entries()}forEach(e,t){(0,n.gc)(this._observable),this._map.forEach(((r,n)=>e.call(t,r,n,this)),t)}get(e){return(0,n.gc)(this._observable),this._map.get(e)}has(e){return(0,n.gc)(this._observable),this._map.has(e)}keys(){return(0,n.gc)(this._observable),this._map.keys()}set(e,t){return this._map.set(e,t),this._observable.notify(),this}values(){return(0,n.gc)(this._observable),this._map.values()}[Symbol.iterator](){return(0,n.gc)(this._observable),this._map[Symbol.iterator]()}get[Symbol.toStringTag](){return this._map[Symbol.toStringTag]}}},5161:function(e,t,r){r.d(t,{T:function(){return s},U:function(){return i}});var n=r(15774);function i(e,t,r=0){const i=(0,n.qE)(e,0,l);for(let e=0;e<4;e++)t[r+e]=Math.floor(256*c(i*a[e]))}function s(e,t=0){let r=0;for(let n=0;n<4;n++)r+=e[t+n]*o[n];return r}const a=[1,256,65536,16777216],o=[1/256,1/65536,1/16777216,1/4294967296],l=s(new Uint8ClampedArray([255,255,255,255]));function c(e){return e-Math.floor(e)}},87725:function(e,t,r){function n(){return[1,0,0,0,1,0,0,0,1]}function i(e,t,r,n,i,s,a,o,l){return[e,t,r,n,i,s,a,o,l]}r.d(t,{fA:function(){return i},vt:function(){return n},zK:function(){return s}});const s=[1,0,0,0,1,0,0,0,1];Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:s,clone:function(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]},create:n,createView:function(e,t){return new Float64Array(e,t,9)},fromValues:i},Symbol.toStringTag,{value:"Module"}))},39714:function(e,t,r){function n(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function i(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]}function s(e,t,r,n,i,s,a,o,l,c,u,d,h,f,p,m){return[e,t,r,n,i,s,a,o,l,c,u,d,h,f,p,m]}r.d(t,{fA:function(){return s},o8:function(){return i},vt:function(){return n},zK:function(){return a}});const a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:a,clone:i,create:n,createView:function(e,t){return new Float64Array(e,t,16)},fromValues:s},Symbol.toStringTag,{value:"Module"}))},61769:function(e,t,r){function n(){return[0,0,0,1]}function i(e){return[e[0],e[1],e[2],e[3]]}r.d(t,{o8:function(){return i},vt:function(){return n},zK:function(){return s}});const s=[0,0,0,1];Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:s,clone:i,create:n,fromValues:function(e,t,r,n){return[e,t,r,n]}},Symbol.toStringTag,{value:"Module"}))},43274:function(e,t,r){function n(){return new Float32Array(3)}function i(e){const t=new Float32Array(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function s(e,t,r){const n=new Float32Array(3);return n[0]=e,n[1]=t,n[2]=r,n}function a(){return n()}function o(){return s(1,1,1)}function l(){return s(1,0,0)}function c(){return s(0,1,0)}function u(){return s(0,0,1)}r.d(t,{fA:function(){return s},o8:function(){return i},vt:function(){return n}});const d=a(),h=o(),f=l(),p=c(),m=u();Object.freeze(Object.defineProperty({__proto__:null,ONES:h,UNIT_X:f,UNIT_Y:p,UNIT_Z:m,ZEROS:d,clone:i,create:n,createView:function(e,t){return new Float32Array(e,t,3)},fromValues:s,ones:o,unitX:l,unitY:c,unitZ:u,zeros:a},Symbol.toStringTag,{value:"Module"}))},32237:function(e,t,r){r.d(t,{A6:function(){return g},B8:function(){return f},Xd:function(){return u},Xr:function(){return p},Yc:function(){return C},hZ:function(){return y},lw:function(){return d},t2:function(){return M},x8:function(){return c}});var n=r(87725),i=r(61769),s=r(32501),a=r(8527),o=r(20551),l=r(33400);function c(e,t,r){r*=.5;const n=Math.sin(r);return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=Math.cos(r),e}function u(e,t){const r=2*Math.acos(t[3]),n=Math.sin(r/2);return n>(0,a.FD)()?(e[0]=t[0]/n,e[1]=t[1]/n,e[2]=t[2]/n):(e[0]=1,e[1]=0,e[2]=0),r}function d(e,t,r){const n=t[0],i=t[1],s=t[2],a=t[3],o=r[0],l=r[1],c=r[2],u=r[3];return e[0]=n*u+a*o+i*c-s*l,e[1]=i*u+a*l+s*o-n*c,e[2]=s*u+a*c+n*l-i*o,e[3]=a*u-n*o-i*l-s*c,e}function h(e,t,r,n){const i=t[0],s=t[1],o=t[2],l=t[3];let c,u,d,h,f,p=r[0],m=r[1],g=r[2],_=r[3];return u=i*p+s*m+o*g+l*_,u<0&&(u=-u,p=-p,m=-m,g=-g,_=-_),1-u>(0,a.FD)()?(c=Math.acos(u),d=Math.sin(c),h=Math.sin((1-n)*c)/d,f=Math.sin(n*c)/d):(h=1-n,f=n),e[0]=h*i+f*p,e[1]=h*s+f*m,e[2]=h*o+f*g,e[3]=h*l+f*_,e}function f(e,t){const r=t[0],n=t[1],i=t[2],s=t[3],a=r*r+n*n+i*i+s*s,o=a?1/a:0;return e[0]=-r*o,e[1]=-n*o,e[2]=-i*o,e[3]=s*o,e}function p(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function m(e,t){const r=t[0]+t[4]+t[8];let n;if(r>0)n=Math.sqrt(r+1),e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{let r=0;t[4]>t[0]&&(r=1),t[8]>t[3*r+r]&&(r=2);const i=(r+1)%3,s=(r+2)%3;n=Math.sqrt(t[3*r+r]-t[3*i+i]-t[3*s+s]+1),e[r]=.5*n,n=.5/n,e[3]=(t[3*i+s]-t[3*s+i])*n,e[i]=(t[3*i+r]+t[3*r+i])*n,e[s]=(t[3*s+r]+t[3*r+s])*n}return e}function g(e,t,r,n){const i=.5*Math.PI/180;t*=i,r*=i,n*=i;const s=Math.sin(t),a=Math.cos(t),o=Math.sin(r),l=Math.cos(r),c=Math.sin(n),u=Math.cos(n);return e[0]=s*l*u-a*o*c,e[1]=a*o*u+s*l*c,e[2]=a*l*c-s*o*u,e[3]=a*l*u+s*o*c,e}const _=l.c,y=l.s,v=l.g,T=d,b=l.d,S=l.h,A=l.l,E=l.j,w=E,I=l.b,x=I,R=l.n,M=l.a,O=l.e;function C(e,t,r){const n=(0,o.f)(t,r);return n<-.999999?((0,o.e)(N,L,t),(0,o.G)(N)<1e-6&&(0,o.e)(N,F,t),(0,o.n)(N,N),c(e,N,Math.PI),e):n>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):((0,o.e)(N,t,r),e[0]=N[0],e[1]=N[1],e[2]=N[2],e[3]=1+n,R(e,e))}const N=(0,s.vt)(),L=(0,s.fA)(1,0,0),F=(0,s.fA)(0,1,0),D=(0,i.vt)(),P=(0,i.vt)(),B=(0,n.vt)();Object.freeze(Object.defineProperty({__proto__:null,add:v,calculateW:function(e,t){const r=t[0],n=t[1],i=t[2];return e[0]=r,e[1]=n,e[2]=i,e[3]=Math.sqrt(Math.abs(1-r*r-n*n-i*i)),e},conjugate:p,copy:_,dot:S,equals:O,exactEquals:M,fromEuler:g,fromMat3:m,getAxisAngle:u,identity:function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},invert:f,len:w,length:E,lerp:A,mul:T,multiply:d,normalize:R,random:function(e){const t=a.Ov,r=t(),n=t(),i=t(),s=Math.sqrt(1-r),o=Math.sqrt(r);return e[0]=s*Math.sin(2*Math.PI*n),e[1]=s*Math.cos(2*Math.PI*n),e[2]=o*Math.sin(2*Math.PI*i),e[3]=o*Math.cos(2*Math.PI*i),e},rotateX:function(e,t,r){r*=.5;const n=t[0],i=t[1],s=t[2],a=t[3],o=Math.sin(r),l=Math.cos(r);return e[0]=n*l+a*o,e[1]=i*l+s*o,e[2]=s*l-i*o,e[3]=a*l-n*o,e},rotateY:function(e,t,r){r*=.5;const n=t[0],i=t[1],s=t[2],a=t[3],o=Math.sin(r),l=Math.cos(r);return e[0]=n*l-s*o,e[1]=i*l+a*o,e[2]=s*l+n*o,e[3]=a*l-i*o,e},rotateZ:function(e,t,r){r*=.5;const n=t[0],i=t[1],s=t[2],a=t[3],o=Math.sin(r),l=Math.cos(r);return e[0]=n*l+i*o,e[1]=i*l-n*o,e[2]=s*l+a*o,e[3]=a*l-s*o,e},rotationTo:C,scale:b,set:y,setAxes:function(e,t,r,n){const i=B;return i[0]=r[0],i[3]=r[1],i[6]=r[2],i[1]=n[0],i[4]=n[1],i[7]=n[2],i[2]=-t[0],i[5]=-t[1],i[8]=-t[2],R(e,m(e,i))},setAxisAngle:c,slerp:h,sqlerp:function(e,t,r,n,i,s){return h(D,t,i,s),h(P,r,n,s),h(e,D,P,2*s*(1-s)),e},sqrLen:x,squaredLength:I,str:function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}},Symbol.toStringTag,{value:"Module"}))},50612:function(e,t,r){r.d(t,{E:function(){return E},w:function(){return a}});var n=r(50659),i=(r(58941),r(7187)),s=r(88923);class a{constructor(e=9,t){this._compareMinX=d,this._compareMinY=h,this._toBBox=e=>e,this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&("function"==typeof t?this._toBBox=t:this._initFormat(t)),this.clear()}destroy(){this.clear(),T.prune(),b.prune(),S.prune(),A.prune()}all(e){o(this._data,e)}search(e,t){let r=this._data;const n=this._toBBox;if(y(e,r))for(T.clear();r;){for(let i=0,s=r.children.length;i<s;i++){const s=r.children[i],a=r.leaf?n(s):s;y(e,a)&&(r.leaf?t(s):_(e,a)?o(s,t):T.push(s))}r=T.pop()}}collides(e){let t=this._data;const r=this._toBBox;if(!y(e,t))return!1;for(T.clear();t;){for(let n=0,i=t.children.length;n<i;n++){const i=t.children[n],s=t.leaf?r(i):i;if(y(e,s)){if(t.leaf||_(e,s))return!0;T.push(i)}}t=T.pop()}return!1}load(e){if(!e.length)return this;if(e.length<this._minEntries){for(let t=0,r=e.length;t<r;t++)this.insert(e[t]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(this._data.children.length)if(this._data.height===t.height)this._splitRoot(this._data,t);else{if(this._data.height<t.height){const e=this._data;this._data=t,t=e}this._insert(t,this._data.height-t.height-1,!0)}else this._data=t;return this}insert(e){return e&&this._insert(e,this._data.height-1),this}clear(){return this._data=new I([]),this}remove(e){if(!e)return this;let t,r=this._data,i=null,s=0,a=!1;const o=this._toBBox(e);for(S.clear(),A.clear();r||S.length>0;){if(r||(r=S.pop(),i=S.data[S.length-1],s=A.pop()??0,a=!0),r.leaf&&(t=(0,n.qh)(r.children,e,r.children.length,r.indexHint),-1!==t))return r.children.splice(t,1),S.push(r),this._condense(S),this;a||r.leaf||!_(r,o)?i?(s++,r=i.children[s],a=!1):r=null:(S.push(r),A.push(s),s=0,i=r,r=r.children[0])}return this}toJSON(){return this._data}fromJSON(e){return this._data=e,this}_build(e,t,r,n){const i=r-t+1;let s=this._maxEntries;if(i<=s){const n=new I(e.slice(t,r+1));return l(n,this._toBBox),n}n||(n=Math.ceil(Math.log(i)/Math.log(s)),s=Math.ceil(i/s**(n-1)));const a=new x([]);a.height=n;const o=Math.ceil(i/s),c=o*Math.ceil(Math.sqrt(s));v(e,t,r,c,this._compareMinX);for(let i=t;i<=r;i+=c){const t=Math.min(i+c-1,r);v(e,i,t,o,this._compareMinY);for(let r=i;r<=t;r+=o){const i=Math.min(r+o-1,t);a.children.push(this._build(e,r,i,n-1))}}return l(a,this._toBBox),a}_insert(e,t,r){const n=this._toBBox,i=r?e:n(e);S.clear();const s=function(e,t,r,n){for(;n.push(t),!0!==t.leaf&&n.length-1!==r;){let r,n=1/0,i=1/0;for(let s=0,a=t.children.length;s<a;s++){const a=t.children[s],o=f(a),l=m(e,a)-o;l<i?(i=l,n=o<n?o:n,r=a):l===i&&o<n&&(n=o,r=a)}t=r||t.children[0]}return t}(i,this._data,t,S);for(s.children.push(e),u(s,i);t>=0&&S.data[t].children.length>this._maxEntries;)this._split(S,t),t--;!function(e,t,r){for(let n=r;n>=0;n--)u(t.data[n],e)}(i,S,t)}_split(e,t){const r=e.data[t],n=r.children.length,i=this._minEntries;this._chooseSplitAxis(r,i,n);const s=this._chooseSplitIndex(r,i,n);if(!s)return;const a=r.children.splice(s,r.children.length-s),o=r.leaf?new I(a):new x(a);o.height=r.height,l(r,this._toBBox),l(o,this._toBBox),t?e.data[t-1].children.push(o):this._splitRoot(r,o)}_splitRoot(e,t){this._data=new x([e,t]),this._data.height=e.height+1,l(this._data,this._toBBox)}_chooseSplitIndex(e,t,r){let n,i,s;n=i=1/0;for(let a=t;a<=r-t;a++){const t=c(e,0,a,this._toBBox),o=c(e,a,r,this._toBBox),l=g(t,o),u=f(t)+f(o);l<n?(n=l,s=a,i=u<i?u:i):l===n&&u<i&&(i=u,s=a)}return s}_chooseSplitAxis(e,t,r){const n=e.leaf?this._compareMinX:d,i=e.leaf?this._compareMinY:h;this._allDistMargin(e,t,r,n)<this._allDistMargin(e,t,r,i)&&e.children.sort(n)}_allDistMargin(e,t,r,n){e.children.sort(n);const i=this._toBBox,s=c(e,0,t,i),a=c(e,r-t,r,i);let o=p(s)+p(a);for(let n=t;n<r-t;n++){const t=e.children[n];u(s,e.leaf?i(t):t),o+=p(s)}for(let n=r-t-1;n>=t;n--){const t=e.children[n];u(a,e.leaf?i(t):t),o+=p(a)}return o}_condense(e){for(let t=e.length-1;t>=0;t--){const r=e.data[t];if(0===r.children.length)if(t>0){const i=e.data[t-1],s=i.children;s.splice((0,n.qh)(s,r,s.length,i.indexHint),1)}else this.clear();else l(r,this._toBBox)}}_initFormat(e){const t=["return a"," - b",";"];this._compareMinX=new Function("a","b",t.join(e[0])),this._compareMinY=new Function("a","b",t.join(e[1])),this._toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}}function o(e,t){let r=e;for(b.clear();r;){if(!0===r.leaf)for(const e of r.children)t(e);else b.pushArray(r.children);r=b.pop()??null}}function l(e,t){c(e,0,e.children.length,t,e)}function c(e,t,r,n,i){i||(i=new I([])),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(let s,a=t;a<r;a++)s=e.children[a],u(i,e.leaf?n(s):s);return i}function u(e,t){e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY)}function d(e,t){return e.minX-t.minX}function h(e,t){return e.minY-t.minY}function f(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function p(e){return e.maxX-e.minX+(e.maxY-e.minY)}function m(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function g(e,t){const r=Math.max(e.minX,t.minX),n=Math.max(e.minY,t.minY),i=Math.min(e.maxX,t.maxX),s=Math.min(e.maxY,t.maxY);return Math.max(0,i-r)*Math.max(0,s-n)}function _(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function y(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function v(e,t,r,n,i){const a=[t,r];for(;a.length;){const t=a.pop(),r=a.pop();if(t-r<=n)continue;const o=r+Math.ceil((t-r)/n/2)*n;(0,s.q)(e,o,r,t,i),a.push(r,o,o,t)}}const T=new i.A,b=new i.A,S=new i.A,A=new i.A({deallocator:void 0});class E{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}}class w extends E{constructor(){super(...arguments),this.height=1,this.indexHint=new n.vW}}class I extends w{constructor(e){super(),this.children=e,this.leaf=!0}}class x extends w{constructor(e){super(),this.children=e,this.leaf=!1}}},75218:function(e,t,r){r.d(t,{L:function(){return o},g:function(){return a}});var n=r(77472),i=r(78879),s=r(31609);async function a(e,t){return await e.load(),o(e,t)}async function o(e,t){const r=[],a=(...e)=>{for(const t of e)null!=t&&(Array.isArray(t)?a(...t):i.A.isCollection(t)?t.forEach((e=>a(e))):s.A.isLoadable(t)&&r.push(t))};t(a);let o=null;if(await(0,n.Tj)(r,(async e=>{const t=await(0,n.Ke)(function(e){return"loadAll"in e&&"function"==typeof e.loadAll}(e)?e.loadAll():e.load());!1!==t.ok||o||(o=t)})),o)throw o.error;return e}},68225:function(e,t,r){r.d(t,{A:function(){return u}});var n,i,s=r(58941),a=r(56996);(i=n||(n={}))[i.varint=0]="varint",i[i.fixed64=1]="fixed64",i[i.delimited=2]="delimited",i[i.fixed32=5]="fixed32",i[i.unknown=99]="unknown";const o=4294967296,l=new TextDecoder("utf-8"),c=(0,s.A)("safari")||(0,s.A)("ios")?6:(0,s.A)("ff")?12:32;class u{constructor(e,t,r=0,i=(e?e.byteLength:0)){this._tag=0,this._dataType=n.unknown,this._init(e,t,r,i)}_init(e,t,r,n){this._data=e,this._dataView=t,this._pos=r,this._end=n}asUnsafe(){return this}clone(){return new u(this._data,this._dataView,this._pos,this._end)}pos(){return this._pos}move(e){this._pos=e}nextTag(e){for(;;){if(this._pos===this._end)return!1;const t=this._decodeVarint();if(this._tag=t>>3,this._dataType=7&t,!e||e===this._tag)break;this.skip()}return!0}next(){if(this._pos===this._end)return!1;const e=this._decodeVarint();return this._tag=e>>3,this._dataType=7&e,!0}empty(){return this._pos>=this._end}tag(){return this._tag}getInt32(){return this._decodeVarint()}getInt64(){return this._decodeVarint()}getUInt32(){let e=4294967295;if(e=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128)return e;if(e=(e|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128)return e;if(e=(e|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128)return e;if(e=(e|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128)return e;if(e=(e|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128)return e;throw new Error("Varint overflow")}getUInt64(){return this._decodeVarint()}getSInt32(){const e=this.getUInt32();return e>>>1^-(1&e)}getSInt64(){return this._decodeSVarint()}getBool(){const e=0!==this._data[this._pos];return this._skip(1),e}getEnum(){return this._decodeVarint()}getFixed64(){const e=this._dataView,t=this._pos,r=e.getUint32(t,!0)+e.getUint32(t+4,!0)*o;return this._skip(8),r}getSFixed64(){const e=this._dataView,t=this._pos,r=e.getUint32(t,!0)+e.getInt32(t+4,!0)*o;return this._skip(8),r}getDouble(){const e=this._dataView.getFloat64(this._pos,!0);return this._skip(8),e}getFixed32(){const e=this._dataView.getUint32(this._pos,!0);return this._skip(4),e}getSFixed32(){const e=this._dataView.getInt32(this._pos,!0);return this._skip(4),e}getFloat(){const e=this._dataView.getFloat32(this._pos,!0);return this._skip(4),e}getString(){const e=this._getLength(),t=this._pos,r=this._toString(this._data,t,t+e);return this._skip(e),r}getBytes(){const e=this._getLength(),t=this._pos,r=this._toBytes(this._data,t,t+e);return this._skip(e),r}getLength(){return this._getLengthUnsafe()}processMessageWithArgs(e,t,r,n){const i=this.getMessage(),s=e(i,t,r,n);return i.release(),s}processMessage(e){const t=this.getMessage(),r=e(t);return t.release(),r}getMessage(){const e=this._getLength(),t=u.pool.acquire();return t._init(this._data,this._dataView,this._pos,this._pos+e),this._skip(e),t}release(){u.pool.release(this)}dataType(){return this._dataType}skip(){switch(this._dataType){case n.varint:this._decodeVarint();break;case n.fixed64:this._skip(8);break;case n.delimited:this._skip(this._getLength());break;case n.fixed32:this._skip(4);break;default:throw new Error("Invalid data type!")}}skipLen(e){this._skip(e)}_skip(e){if(this._pos+e>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=e}_decodeVarint(){const e=this._data;let t=this._pos,r=0,n=0;if(this._end-t>=10)do{if(n=e[t++],r|=127&n,!(128&n))break;if(n=e[t++],r|=(127&n)<<7,!(128&n))break;if(n=e[t++],r|=(127&n)<<14,!(128&n))break;if(n=e[t++],r|=(127&n)<<21,!(128&n))break;if(n=e[t++],r+=268435456*(127&n),!(128&n))break;if(n=e[t++],r+=34359738368*(127&n),!(128&n))break;if(n=e[t++],r+=4398046511104*(127&n),!(128&n))break;if(n=e[t++],r+=562949953421312*(127&n),!(128&n))break;if(n=e[t++],r+=72057594037927940*(127&n),!(128&n))break;if(n=e[t++],r+=0x8000000000000000*(127&n),!(128&n))break;throw new Error("Varint too long!")}while(0);else{let i=1;for(;t!==this._end&&(n=e[t],128&n);)++t,r+=(127&n)*i,i*=128;if(t===this._end)throw new Error("Varint overrun!");++t,r+=n*i}return this._pos=t,r}_decodeSVarint(){const e=this._data;let t,r=0,n=0;const i=1&e[this._pos];if(n=e[this._pos++],r|=127&n,!(128&n))return i?-(r+1)/2:r/2;if(n=e[this._pos++],r|=(127&n)<<7,!(128&n))return i?-(r+1)/2:r/2;if(n=e[this._pos++],r|=(127&n)<<14,!(128&n))return i?-(r+1)/2:r/2;if(n=e[this._pos++],r|=(127&n)<<21,!(128&n))return i?-(r+1)/2:r/2;if(n=e[this._pos++],r+=268435456*(127&n),!(128&n))return i?-(r+1)/2:r/2;if(n=e[this._pos++],r+=34359738368*(127&n),!(128&n))return i?-(r+1)/2:r/2;if(n=e[this._pos++],r+=4398046511104*(127&n),!(128&n))return i?-(r+1)/2:r/2;if(t=BigInt(r),n=e[this._pos++],t+=0x2000000000000n*BigInt(127&n),!(128&n))return Number(i?-(t+1n)/2n:t/2n);if(n=e[this._pos++],t+=0x100000000000000n*BigInt(127&n),!(128&n))return Number(i?-(t+1n)/2n:t/2n);if(n=e[this._pos++],t+=0x8000000000000000n*BigInt(127&n),!(128&n))return Number(i?-(t+1n)/2n:t/2n);throw new Error("Varint too long!")}_getLength(){if(this._dataType!==n.delimited)throw new Error("Not a delimited data type!");return this._decodeVarint()}_getLengthUnsafe(){return this.getUInt32()}_toString(e,t,r){if((r=Math.min(this._end,r))-t>c){const n=e.subarray(t,r);return l.decode(n)}let n="",i="";for(let s=t;s<r;++s){const t=e[s];128&t?i+="%"+t.toString(16):(n+=decodeURIComponent(i)+String.fromCharCode(t),i="")}return i.length&&(n+=decodeURIComponent(i)),n}_toBytes(e,t,r){return r=Math.min(this._end,r),new Uint8Array(e.buffer,t,r-t)}}u.pool=new a.A(u,void 0,(e=>{e._data=null,e._dataView=null}))},83324:function(e,t,r){r.d(t,{M:function(){return c},s:function(){return l}});var n=r(42042),i=r(93393),s=r(359),a=r(70891),o=r(96285);function l(e,t){const r=u[e.toLowerCase()];if(null==r)throw new i.L8(i.Z7.FunctionNotRecognized);if(t.length<r.minParams||t.length>r.maxParams)throw new i.L8(i.Z7.InvalidParameterCount,{name:e.toUpperCase()});return r.evaluate(t)}function c(e,t){const r=u[e.toLowerCase()];return null!=r&&t>=r.minParams&&t<=r.maxParams}const u={min:{minParams:1,maxParams:1,evaluate:e=>f(e[0],"min")},max:{minParams:1,maxParams:1,evaluate:e=>f(e[0],"max")},avg:{minParams:1,maxParams:1,evaluate:e=>d(e[0])},sum:{minParams:1,maxParams:1,evaluate:e=>function(e){if(null===e)return null;let t=0;for(let r=0;r<e.length;r++){const n=e[r];if(null!==n){if(!h(n))throw new i.L8(i.Z7.InvalidValueForAggregateFunction);t+=n}}return t}(e[0])},stddev:{minParams:1,maxParams:1,evaluate:e=>function(e){if(null===e)return null;const t=p(e);return null===t?null:Math.sqrt(t)}(e[0])},count:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:e[0].length},var:{minParams:1,maxParams:1,evaluate:e=>p(e[0])}};function d(e){if(null===e)return null;let t=0,r=0;for(let n=0;n<e.length;n++){const s=e[n];if(null!==s){if(!h(s))throw new i.L8(i.Z7.InvalidValueForAggregateFunction);r++,t+=s}}return 0===r?null:t/e.length}function h(e){return"number"==typeof e}function f(e,t){if(null===e)return null;let r=null,i=null;for(const l of e){let e=l;e=l instanceof n.n||l instanceof a.k?l.toNumber():l instanceof o.c9?l.toMillis():l instanceof s.g?l.toMilliseconds():l,(null===r||"max"===t&&null!==i&&null!==e&&i<=e||"min"===t&&null!==i&&null!==e&&i>=e)&&(r=l,i=e)}return r}function p(e){if(null===e)return null;if(0===(e=e.filter((e=>null!==e))).length)return null;const t=d(e);if(null===t)return null;let r=0;for(const n of e){if(!h(n))throw new i.L8(i.Z7.InvalidValueForAggregateFunction);r+=(t-n)**2}return r/(e.length-1)}},42042:function(e,t,r){r.d(t,{n:function(){return o}});var n=r(9688),i=r(22739),s=r(96285);function a(e){e=e.replaceAll(/LTS|LT|L{1,4}|l{1,4}/g,"[$&]");let t="";const r=/(\[[^[]*\])|(\\)?([Hh]mm(ss)?|Mo|M{1,4}|Do|DDDo|D{1,4}|d{2,4}|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;for(const n of e.match(r)||[])switch(n){case"D":t+="d";break;case"DD":t+="dd";break;case"DDD":t+="o";break;case"d":t+="c";break;case"ddd":t+="ccc";break;case"dddd":t+="cccc";break;case"M":t+="L";break;case"MM":t+="LL";break;case"MMM":t+="LLL";break;case"MMMM":t+="LLLL";break;case"YY":t+="yy";break;case"Y":case"YYYY":t+="yyyy";break;case"Q":t+="q";break;case"X":case"x":t+=n;break;default:n.length>=2&&"["===n.slice(0,1)&&"]"===n.slice(-1)?t+=`'${n.slice(1,-1)}'`:t+=`'${n}'`}return t}class o{constructor(e,t,r){this._year=e,this._month=t,this._day=r,this.declaredRootClass="esri.core.sql.dateonly"}get month(){return this._month}get monthJS(){return this._month-1}get year(){return this._year}get day(){return this._day}get isValid(){return this.toDateTime("unknown").isValid}equals(e){return e instanceof o&&e.day===this.day&&e.month===this.month&&e.year===this.year}clone(){return new o(this._year,this._month,this._day)}toDateTime(e){return s.c9.fromObject({day:this.day,month:this.month,year:this.year},{zone:(0,n.mT)(e)})}toDateTimeLuxon(e){return s.c9.fromObject({day:this.day,month:this.month,year:this.year},{zone:(0,n.mT)(e)})}toString(){return`${this.year.toString().padStart(4,"0")}-${this.month.toString().padStart(2,"0")}-${this.day.toString().padStart(2,"0")}`}toFormat(e=null,t=!0){if(null===e||""===e)return this.toString();if(t&&(e=a(e)),!e)return"";const r=this.toDateTime("unknown");return n.lY.dateTimeToArcadeDate(r).toFormat(e,{locale:(0,i.JK)(),numberingSystem:"latn"})}toArcadeDate(){const e=this.toDateTime("unknown");return n.lY.dateTimeToArcadeDate(e)}toNumber(){return this.toDateTime("unknown").toMillis()}toJSDate(){return this.toDateTime("unknown").toJSDate()}toStorageFormat(){return this.toFormat("yyyy-LL-dd",!1)}toSQLValue(){return this.toFormat("yyyy-LL-dd",!1)}toSQLWithKeyword(){return"date '"+this.toFormat("yyyy-LL-dd",!1)+"'"}plus(e,t){return o.fromDateTime(this.toUTCDateTime().plus({[e]:t}))}toUTCDateTime(){return s.c9.utc(this.year,this.month,this.day,0,0,0,0)}difference(e,t){switch(t.toLowerCase()){case"days":case"day":case"d":return this.toUTCDateTime().diff(e.toUTCDateTime(),"days").days;case"months":case"month":return this.toUTCDateTime().diff(e.toUTCDateTime(),"months").months;case"minutes":case"minute":case"m":return"M"===t?this.toUTCDateTime().diff(e.toUTCDateTime(),"months").months:this.toUTCDateTime().diff(e.toUTCDateTime(),"minutes").minutes;case"seconds":case"second":case"s":return this.toUTCDateTime().diff(e.toUTCDateTime(),"seconds").seconds;case"milliseconds":case"millisecond":case"ms":default:return this.toUTCDateTime().diff(e.toUTCDateTime(),"milliseconds").milliseconds;case"hours":case"hour":case"h":return this.toUTCDateTime().diff(e.toUTCDateTime(),"hours").hours;case"years":case"year":case"y":return this.toUTCDateTime().diff(e.toUTCDateTime(),"years").years}}static fromMilliseconds(e){const t=s.c9.fromMillis(e,{zone:s.mQ.utcInstance});return t.isValid?o.fromParts(t.year,t.month,t.day):null}static fromSeconds(e){const t=s.c9.fromSeconds(e,{zone:s.mQ.utcInstance});return t.isValid?o.fromParts(t.year,t.month,t.day):null}static fromReader(e){if(!e)return null;const t=e.split("-");return 3!==t.length?null:new o(parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2],10))}static fromParts(e,t,r){const n=new o(e,t,r);return!1===n.isValid?null:n}static fromDateJS(e){return o.fromParts(e.getFullYear(),e.getMonth()+1,e.getDay())}static fromDateTime(e){return o.fromParts(e.year,e.month,e.day)}static fromSqlTimeStampOffset(e){return this.fromDateTime(e.toDateTime())}static fromString(e,t=null){if(""===e)return null;if(null===e)return null;const r=[];if(t)(t=a(t))&&r.push(t);else if(null===t||""===t){const t=s.c9.fromISO(e,{setZone:!0});return t.isValid?o.fromParts(t.year,t.month,t.day):null}for(const n of r){const r=s.c9.fromFormat(e,t??n);if(r.isValid)return new o(r.year,r.month,r.day)}return null}static fromNow(e="system"){const t=s.c9.fromJSDate(new Date).setZone((0,n.mT)(e));return new o(t.year,t.month,t.day)}}},359:function(e,t,r){r.d(t,{g:function(){return s}});var n=r(96285);function i(e){return Number.isNaN(e)||0===e?e:Math.trunc(e)}class s{constructor(e){this._timeStampOffset=e,this._date=null}toDateTime(){return this._date??=n.c9.fromISO(this._timeStampOffset,{setZone:!0}),this._date}get isValid(){return this.toDateTime().isValid}get timezoneOffsetHour(){return i(this.toDateTime().offset/60)}get timezoneOffsetMinutes(){return i(this.toDateTime().offset%60)}toMilliseconds(){return this.toDateTime().toMillis()}get hour(){return this.toDateTime().hour}get minute(){return this.toDateTime().minute}get second(){return this.toDateTime().second}get day(){return this.toDateTime().day}get month(){return this.toDateTime().month}get year(){return this.toDateTime().year}startOfDay(){return s.fromDateTime(this.toDateTime().startOf("day"))}static fromJSDate(e){return new s(n.c9.fromJSDate(e).toISO({includeOffset:!0}))}static fromDateTime(e){return new s(e.toISO({includeOffset:!0}))}static fromParts(e,t,r=0,n=0,i=0,a=0,o=0,l=!1,c=0,u=0){const d=`${e.toString().padStart(4,"0")}-${t.toString().padStart(2,"0")}-${r.toString().padStart(2,"0")}`;let h="";a<10&&(h="0");let f=`${n.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}:${h+a.toString()}`;0!==o&&(f+="."+o.toString().padStart(3,"0"));const p=`${l?"-":"+"}${c.toString().padStart(2,"0")}:${u.toString().padStart(2,"0")}`;return new s(d+"T"+f+p)}toStorageFormat(){return this._timeStampOffset}toString(){return this._timeStampOffset}toSQLValue(){let e=this.toDateTime().toSQL({includeOffset:!0,includeOffsetSpace:!0});return e&&(e=e.replace(".000","")),e}toSQLWithKeyword(){return`timestamp '${this.toSQLValue()}'`}addMilliseconds(e){const t=this.toDateTime().plus(e);return s.fromDateTime(t)}}},70891:function(e,t,r){r.d(t,{k:function(){return o}});var n=r(80749),i=r(22739),s=r(96285);function a(e){if(!e)return"";const t=/(a|A|hh?|HH?|mm?|ss?|SSS|S|.)/g;let r="";for(const n of e.match(t)||[])switch(n){case"SSS":case"m":case"mm":case"h":case"hh":case"H":case"HH":case"s":case"ss":r+=n;break;case"A":case"a":r+="a";break;default:r+=`'${n}'`}return r}class o{constructor(e,t,r,n){this._hour=e,this._minute=t,this._second=r,this._millisecond=n,this.declaredRootClass="esri.core.sql.timeonly"}get hour(){return this._hour}get minute(){return this._minute}get second(){return this._second}get millisecond(){return this._millisecond}equals(e){return e instanceof o&&e.hour===this.hour&&e.minute===this.minute&&e.second===this.second&&e.millisecond===this.millisecond}clone(){return new o(this.hour,this.minute,this.second,this.millisecond)}isValid(){return(0,n.Fq)(this.hour)&&(0,n.Fq)(this.minute)&&(0,n.Fq)(this.second)&&(0,n.Fq)(this.millisecond)&&this.hour>=0&&this.hour<24&&this.minute>=0&&this.minute<60&&this.second>=0&&this.second<60&&this.millisecond>=0&&this.millisecond<1e3}toString(){return`${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}`+(this.millisecond>0?"."+this.millisecond.toString().padStart(3,"0"):"")}toSQLValue(){return this.toString()}toSQLWithKeyword(){return`time '${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}${this.millisecond>0?"."+this.millisecond.toString().padStart(3,"0"):""}'`}toStorageString(){return`${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}`}toFormat(e=null){return null===e||""===e?this.toString():(e=a(e))?s.c9.local(1970,1,1,this._hour,this._minute,this._second,this._millisecond).toFormat(e,{locale:(0,i.JK)(),numberingSystem:"latn"}):""}toNumber(){return this.millisecond+1e3*this.second+1e3*this.minute*60+60*this.hour*60*1e3}static fromParts(e,t,r,n){const i=new o(e,t,r,n);return i.isValid()?i:null}static fromReader(e){if(!e)return null;const t=e.split(":");return 3!==t.length?null:new o(parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2],10),0)}static fromMilliseconds(e){if(e>864e5||e<0)return null;const t=Math.floor(e/1e3%60),r=Math.floor(e/6e4%60),n=Math.floor(e/36e5%24),i=Math.floor(e%1e3);return new o(n,r,t,i)}static fromDateJS(e){return new o(e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds())}static fromDateTime(e){return new o(e.hour,e.minute,e.second,e.millisecond)}static fromSqlTimeStampOffset(e){return this.fromDateTime(e.toDateTime())}static fromString(e,t=null){if(""===e)return null;if(null===e)return null;const r=[];t?(t=a(t))&&r.push(t):null!==t&&""!==t||(r.push("HH:mm:ss"),r.push("HH:mm:ss.SSS"),r.push("hh:mm:ss a"),r.push("hh:mm:ss.SSS a"),r.push("HH:mm"),r.push("hh:mm a"),r.push("H:mm"),r.push("h:mm a"),r.push("H:mm:ss"),r.push("h:mm:ss a"),r.push("H:mm:ss.SSS"),r.push("h:mm:ss.SSS a"));for(const t of r){const r=s.c9.fromFormat(e,t);if(r.isValid)return new o(r.hour,r.minute,r.second,r.millisecond)}return null}plus(e,t){switch(e){case"days":case"years":case"months":return this.clone();case"hours":case"minutes":case"seconds":case"milliseconds":return o.fromDateTime(this.toUTCDateTime().plus({[e]:t}))}return null}toUTCDateTime(){return s.c9.utc(1970,1,1,this.hour,this.minute,this.second,this.millisecond)}difference(e,t){switch(t.toLowerCase()){case"days":case"day":case"d":return this.toUTCDateTime().diff(e.toUTCDateTime(),"days").days;case"months":case"month":return this.toUTCDateTime().diff(e.toUTCDateTime(),"months").months;case"minutes":case"minute":case"m":return"M"===t?this.toUTCDateTime().diff(e.toUTCDateTime(),"months").months:this.toUTCDateTime().diff(e.toUTCDateTime(),"minutes").minutes;case"seconds":case"second":case"s":return this.toUTCDateTime().diff(e.toUTCDateTime(),"seconds").seconds;case"milliseconds":case"millisecond":case"ms":default:return this.toUTCDateTime().diff(e.toUTCDateTime(),"milliseconds").milliseconds;case"hours":case"hour":case"h":return this.toUTCDateTime().diff(e.toUTCDateTime(),"hours").hours;case"years":case"year":case"y":return this.toUTCDateTime().diff(e.toUTCDateTime(),"years").years}}}},92955:function(e,t,r){r.d(t,{GB:function(){return i},Qo:function(){return a},Y4:function(){return s}});var n=r(96285);class i{}function s(e){return e instanceof n.bo?e===i.instance:"unknown"===e?.toString().toLowerCase()}function a(e){return s(e)?i.instance:e}i.instance=new n.oh("Etc/UTC")},16177:function(e,t,r){r.r(t),r.d(t,{WhereClause:function(){return te},defaultAttributeAdapter:function(){return he}});var n=r(9688),i=r(58941),s=r(83324),a=r(42042),o=r(93393);class l{constructor(){this.op="+",this.day=0,this.second=0,this.hour=0,this.month=0,this.year=0,this.minute=0,this.millis=0}static _fixDefaults(e){if(null!==e.precision||null!==e.secondary)throw new o.L8(o.Z7.PrimarySecondaryQualifiers)}static _parseSecondsComponent(e,t){if(t.includes(".")){const r=t.split(".");e.second=parseFloat(r[0]),e.millis=parseInt(r[1],10)}else e.second=parseFloat(t)}static createFromMilliseconds(e){const t=new l;return t.second=e/1e3,t}static createFromValueAndQualifier(e,t,r){let n=null;const i=new l;if(i.op="-"===r?"-":"+","interval-period"===t.type){l._fixDefaults(t);const r=new RegExp("^[0-9]{1,}$");if("year"===t.period||"month"===t.period)throw new o.L8(o.Z7.YearMonthIntervals);if("second"===t.period){if(!/^[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/.test(e))throw new o.L8(o.Z7.IllegalInterval);l._parseSecondsComponent(i,e)}else{if(!r.test(e))throw new o.L8(o.Z7.IllegalInterval);i[t.period]=parseFloat(e)}}else{if(l._fixDefaults(t.start),l._fixDefaults(t.end),"year"===t.start.period||"month"===t.start.period||"year"===t.end.period||"month"===t.end.period)throw new o.L8(o.Z7.YearMonthIntervals);switch(t.start.period){case"day":switch(t.end.period){case"hour":if(n=new RegExp("^[0-9]{1,} [0-9]{1,}$"),!n.test(e))throw new o.L8(o.Z7.IllegalInterval);i[t.start.period]=parseFloat(e.split(" ")[0]),i[t.end.period]=parseFloat(e.split(" ")[1]);break;case"minute":if(n=new RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,}$"),!n.test(e))throw new o.L8(o.Z7.IllegalInterval);{i[t.start.period]=parseFloat(e.split(" ")[0]);const r=e.split(" ")[1].split(":");i.hour=parseFloat(r[0]),i.minute=parseFloat(r[1])}break;case"second":if(n=new RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$"),!n.test(e))throw new o.L8(o.Z7.IllegalInterval);{i[t.start.period]=parseFloat(e.split(" ")[0]);const r=e.split(" ")[1].split(":");i.hour=parseFloat(r[0]),i.minute=parseFloat(r[1]),l._parseSecondsComponent(i,r[2])}break;default:throw new o.L8(o.Z7.IllegalInterval)}break;case"hour":switch(t.end.period){case"minute":if(n=new RegExp("^[0-9]{1,}:[0-9]{1,}$"),!n.test(e))throw new o.L8(o.Z7.IllegalInterval);i.hour=parseFloat(e.split(":")[0]),i.minute=parseFloat(e.split(":")[1]);break;case"second":if(n=new RegExp("^[0-9]{1,}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$"),!n.test(e))throw new o.L8(o.Z7.IllegalInterval);{const t=e.split(":");i.hour=parseFloat(t[0]),i.minute=parseFloat(t[1]),l._parseSecondsComponent(i,t[2])}break;default:throw new o.L8(o.Z7.IllegalInterval)}break;case"minute":if("second"!==t.end.period)throw new o.L8(o.Z7.IllegalInterval);if(n=new RegExp("^[0-9]{1,}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$"),!n.test(e))throw new o.L8(o.Z7.IllegalInterval);{const t=e.split(":");i.minute=parseFloat(t[0]),l._parseSecondsComponent(i,t[1])}break;default:throw new o.L8(o.Z7.IllegalInterval)}}return i}valueInMilliseconds(){return("-"===this.op?-1:1)*(this.millis+1e3*this.second+60*this.minute*1e3+60*this.hour*60*1e3+24*this.day*60*60*1e3+this.month*(365/12)*24*60*60*1e3+365*this.year*24*60*60*1e3)}}var c=r(359),u=r(70891),d=r(92955),h=r(96285);const f=/^(\d{1,2}):(\d{1,2}):(\d{1,2})$/,p=/^(\d{1,2}):(\d{1,2})$/,m=/^(\d{1,2}):(\d{1,2}):(\d{1,2}).([0-9]+)$/,g=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,_=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?$/,y=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?[ ]{0,1}(\+|-)(\d{1,2}):(\d{1,2})$/,v=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})?[ ]{0,1}(\+|-)(\d{1,2}):(\d{1,2})$/,T=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/;function b(e,t){if(t instanceof h.bo)return t===d.GB.instance?h.c9.fromMillis(e.getTime(),{zone:d.GB.instance}):h.c9.fromJSDate(e,{zone:t});switch(t){case"system":case"local":case null:return h.c9.fromJSDate(e);default:return"unknown"===t?.toLowerCase()?h.c9.fromMillis(e.getTime(),{zone:d.GB.instance}):h.c9.fromJSDate(e,{zone:t})}}function S(e){return"number"==typeof e}function A(e){return"string"==typeof e||e instanceof String}function E(e){return e instanceof l}function w(e){return e instanceof Date}function I(e){return e instanceof h.c9}function x(e){return e instanceof a.n}function R(e){return e instanceof u.k}function M(e){return e instanceof c.g}function O(e){let t=f.exec(e);if(null!==t){const[,e,r,n]=t,i=u.k.fromParts(parseInt(e,10),parseInt(r,10),parseInt(n,10),0);if(null!==i)return i;throw new o.L8(o.Z7.InvalidTime)}if(t=p.exec(e),null!==t){const[,e,r]=t,n=u.k.fromParts(parseInt(e,10),parseInt(r,10),0,0);if(null!==n)return n;throw new o.L8(o.Z7.InvalidTime)}if(t=m.exec(e),null!==t){const[,e,r,n,i]=t,s=u.k.fromParts(parseInt(e,10),parseInt(r,10),parseInt(n,10),parseInt(i,10));if(null!==s)return s;throw new o.L8(o.Z7.InvalidTime)}throw new o.L8(o.Z7.InvalidTime)}function C(e,t,r=!1){let n=_.exec(e);if(null!==n){const[,e,r,i,s,a,l,c]=n,u=h.c9.fromObject({year:parseInt(e,10),month:parseInt(r,10),day:parseInt(i,10),hour:parseInt(s,10),minute:parseInt(a,10),second:parseInt(l,10),millisecond:c?parseInt(c.replace(".",""),10):0},{zone:(0,d.Qo)(t)});if(!1===u.isValid)throw new o.L8(o.Z7.InvalidTimeStamp);return u}if(n=y.exec(e),null!==n){const[,e,t,r,i,s,a,l,u,d,h]=n,f=c.g.fromParts(parseInt(e,10),parseInt(t,10),parseInt(r,10),parseInt(i,10),parseInt(s,10),parseInt(a,10),l?parseInt(l.replace(".",""),10):0,"-"===u,parseInt(d,10),parseInt(h,10));if(!1===f.isValid)throw new o.L8(o.Z7.InvalidTimeStamp);return f}if(n=v.exec(e),null!==n){const[,e,t,r,i,s,a,l,u]=n,d=c.g.fromParts(parseInt(e,10),parseInt(t,10),parseInt(r,10),parseInt(i,10),parseInt(s,10),0,0,"-"===a,parseInt(l,10),parseInt(u,10));if(!1===d.isValid)throw new o.L8(o.Z7.InvalidTimeStamp);return d}if(n=T.exec(e),null!==n){const[,e,r,i,s,a]=n,l=h.c9.fromObject({year:parseInt(e,10),month:parseInt(r,10),day:parseInt(i,10),hour:parseInt(s,10),minute:parseInt(a,10),second:0},{zone:(0,d.Qo)(t)});if(!1===l.isValid)throw new o.L8(o.Z7.InvalidTimeStamp);return l}if(n=g.exec(e),null!==n){const[,e,r,i]=n,s=h.c9.fromObject({year:parseInt(e,10),month:parseInt(r,10),day:parseInt(i,10),hour:0,minute:0,second:0},{zone:(0,d.Qo)(t)});if(!1===s.isValid)throw new o.L8(o.Z7.InvalidTimeStamp);return s}throw new o.L8(o.Z7.InvalidTimeStamp)}function N(e,t){const r=g.exec(e);if(null===r)try{return C(e,t)}catch{throw new o.L8(o.Z7.InvalidDate)}const[,n,i,s]=r,l=a.n.fromParts(parseInt(n,10),parseInt(i,10),parseInt(s,10));if(null===l)throw new o.L8(o.Z7.InvalidDate);return l}var L=r(15774),F=r(50944);function D(e){return!!I(e)||!!M(e)}function P(e){return!!(I(e)||x(e)||M(e)||R(e))}function B(e){if(I(e))return e.toMillis();if(x(e))return e.toNumber();if(M(e))return e.toMilliseconds();throw new o.L8(o.Z7.InvalidDataType)}function U(e,t,r,n){if(null==e||null==t)return null;if(S(e)){if(S(t))return G(e,t,r);if(A(t))return function(e,t,r){const n=parseFloat(t);if(!isNaN(n))return G(e,n,r);const i=e.toString();switch(r){case"<>":return i!==t;case"=":return i===t;case">":return i>t;case"<":return i<t;case">=":return i>=t;case"<=":return i<=t}}(e,t,r);if(P(t))throw new o.L8(o.Z7.InvalidOperator);if(x(t))throw new o.L8(o.Z7.InvalidOperator)}else if(A(e)){if(S(t))return function(e,t,r){const n=parseFloat(e);if(!isNaN(n))return G(n,t,r);const i=t.toString();switch(r){case"<>":return e!==i;case"=":return e===i;case">":return e>i;case"<":return e<i;case">=":return e>=i;case"<=":return e<=i}}(e,t,r);if(A(t))return function(e,t,r){switch(r){case"<>":return e!==t;case"=":return e===t;case">":return e>t;case"<":return e<t;case">=":return e>=t;case"<=":return e<=t}}(e,t,r);if(I(t))throw new o.L8(o.Z7.InvalidOperator);if(x(t))throw new o.L8(o.Z7.InvalidOperator);if(R(t))throw new o.L8(o.Z7.InvalidOperator);if(M(t))throw new o.L8(o.Z7.InvalidOperator)}else if(I(e)){if(D(t)){if(e instanceof h.c9&&(0,d.Y4)(e.zone)){if(t instanceof h.c9&&!1===(0,d.Y4)(t.zone))return z(e,t,r);if(t instanceof c.g)return z(e,t,r)}else if(t instanceof h.c9&&(0,d.Y4)(t.zone)){if(e instanceof h.c9&&!1===(0,d.Y4)(e.zone))return z(e,t,r);if(e instanceof c.g)return z(e,t,r)}return G(B(e),B(t),r)}if(A(t))throw new o.L8(o.Z7.InvalidOperator);if(x(t))return function(e,t,r){const n=t.toDateTimeLuxon(e.zone);return G((e=e.startOf("day")).toMillis(),n.toMillis(),r)}(e,t,r);if(R(t))throw new o.L8(o.Z7.InvalidOperator);if(S(t))throw new o.L8(o.Z7.InvalidOperator)}else if(x(e)){if(M(t))return function(e,t,r){const n=e.toDateTimeLuxon(t.toDateTime().zone);return t=t.startOfDay(),G(n.toMillis(),t.toMilliseconds(),r)}(e,t,r);if(I(t))return function(e,t,r){const n=e.toDateTimeLuxon(t.zone);return t=t.startOf("day"),G(n.toMillis(),t.toMillis(),r)}(e,t,r);if(A(t))throw new o.L8(o.Z7.InvalidOperator);if(x(t))return G(e.toNumber(),t.toNumber(),r);if(R(t))throw new o.L8(o.Z7.InvalidOperator);if(S(t))throw new o.L8(o.Z7.InvalidOperator)}else if(R(e)){if(R(t))return G(e.toNumber(),t.toNumber(),r);if(A(t))throw new o.L8(o.Z7.InvalidOperator);if(S(t))throw new o.L8(o.Z7.InvalidOperator);if(x(t))throw new o.L8(o.Z7.InvalidOperator);if(D(t))throw new o.L8(o.Z7.InvalidOperator)}else if(M(e)){if(D(t))return t instanceof h.c9&&(0,d.Y4)(t.zone)?z(e,t,r):G(B(e),B(t),r);if(A(t))throw new o.L8(o.Z7.InvalidOperator);if(x(t))return function(e,t,r){const n=t.toDateTimeLuxon(e.toDateTime().zone);return G((e=e.startOfDay()).toMilliseconds(),n.toMillis(),r)}(e,t,r);if(R(t))throw new o.L8(o.Z7.InvalidOperator);if(S(t))throw new o.L8(o.Z7.InvalidOperator)}switch(r){case"<>":return e!==t;case"=":return e===t;case">":return e>t;case"<":return e<t;case">=":return e>=t;case"<=":return e<=t}}function G(e,t,r){switch(r){case"<>":return e!==t;case"=":return e===t;case">":return e>t;case"<":return e<t;case">=":return e>=t;case"<=":return e<=t}}function z(e,t,r){e instanceof c.g&&(e=e.toDateTime()),t instanceof c.g&&(t=t.toDateTime());const n=H(e),i=H(t);switch(r){case"<>":return n!==i;case"=":return n===i;case">":return n>i;case"<":return n<i;case">=":return n>=i;case"<=":return n<=i}}function H(e){return 321408e5*e.year+26784e5*e.month+864e5*e.day+36e5*e.hour+6e4*e.minute+1e3*e.second+e.millisecond}function V(e,t,r){const n=q[e.toLowerCase()];if(null==n)throw new o.L8(o.Z7.FunctionNotRecognized);if(t.length<n.minParams||t.length>n.maxParams)throw new o.L8(o.Z7.InvalidParameterCount,{name:e.toUpperCase()});return n.evaluate(t,r)}function k(e){return"string"==typeof e||e instanceof String}function j(e){return!(w(e)||x(e)||I(e)||R(e)||M(e))}function Z(e){return x(e)||R(e)?e.toString():M(e)?e.toSQLValue():I(e)?0===e.millisecond?e.toFormat("yyyy-LL-dd HH:mm:ss"):e.toSQL({includeOffset:!1}):w(e)?Z(h.c9.fromJSDate(e)):e.toString()}const q={extract:{minParams:2,maxParams:2,evaluate:([e,t])=>{if(null==t)return null;if(w(t))switch(e.toUpperCase()){case"SECOND":return t.getSeconds();case"MINUTE":return t.getMinutes();case"HOUR":return t.getHours();case"DAY":return t.getDate();case"MONTH":return t.getMonth()+1;case"YEAR":return t.getFullYear();case"TIMEZONE_HOUR":case"TIMEZONE_MINUTE":return 0}else if(I(t))switch(e.toUpperCase()){case"SECOND":return t.second;case"MINUTE":return t.minute;case"HOUR":return t.hour;case"DAY":return t.day;case"MONTH":return t.month;case"YEAR":return t.year;case"TIMEZONE_HOUR":case"TIMEZONE_MINUTE":throw new o.L8(o.Z7.InvalidFunctionParameters,{function:"EXTRACT"})}else if(x(t))switch(e.toUpperCase()){case"DAY":return t.day;case"MONTH":return t.month;case"YEAR":return t.year;case"TIMEZONE_HOUR":case"TIMEZONE_MINUTE":throw new o.L8(o.Z7.InvalidFunctionParameters,{function:"EXTRACT"})}else if(R(t))switch(e.toUpperCase()){case"SECOND":return t.second;case"MINUTE":return t.minute;case"HOUR":return t.hour}else if(M(t))switch(e.toUpperCase()){case"SECOND":return t.second;case"MINUTE":return t.minute;case"HOUR":return t.hour;case"DAY":return t.day;case"MONTH":return t.month;case"YEAR":return t.year;case"TIMEZONE_HOUR":return t.timezoneOffsetHour;case"TIMEZONE_MINUTE":return t.timezoneOffsetMinutes}throw new o.L8(o.Z7.InvalidFunctionParameters,{function:"EXTRACT"})}},substring:{minParams:2,maxParams:3,evaluate:e=>{if(2===e.length){const[t,r]=e;return null==t||null==r?null:t.toString().substring(r-1)}if(3===e.length){const[t,r,n]=e;return null==t||null==r||null==n?null:n<=0?"":t.toString().substring(r-1,r+n-1)}}},position:{minParams:2,maxParams:2,evaluate:([e,t])=>null==e||null==t?null:t.indexOf(e)+1},trim:{minParams:2,maxParams:3,evaluate:e=>{const t=3===e.length,r=t?e[1]:" ",n=t?e[2]:e[1];if(null==r||null==n)return null;const i=`(${(0,F.Cj)(r)})`;switch(e[0]){case"BOTH":return n.replaceAll(new RegExp(`^${i}*|${i}*$`,"g"),"");case"LEADING":return n.replaceAll(new RegExp(`^${i}*`,"g"),"");case"TRAILING":return n.replaceAll(new RegExp(`${i}*$`,"g"),"")}throw new o.L8(o.Z7.InvalidFunctionParameters,{function:"TRIM"})}},abs:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.abs(e[0])},ceiling:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.ceil(e[0])},floor:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.floor(e[0])},log:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.log(e[0])},log10:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.log(e[0])*Math.LOG10E},sin:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.sin(e[0])},cos:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.cos(e[0])},tan:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.tan(e[0])},asin:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.asin(e[0])},acos:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.acos(e[0])},atan:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.atan(e[0])},sign:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:e[0]>0?1:e[0]<0?-1:0},power:{minParams:2,maxParams:2,evaluate:e=>null==e[0]||null==e[1]?null:e[0]**e[1]},mod:{minParams:2,maxParams:2,evaluate:e=>null==e[0]||null==e[1]?null:e[0]%e[1]},round:{minParams:1,maxParams:2,evaluate:e=>{const t=e[0],r=2===e.length?10**e[1]:1;return null==t?null:Math.round(t*r)/r}},truncate:{minParams:1,maxParams:2,evaluate:e=>null==e[0]?null:1===e.length||0===e[1]?Math.trunc(e[0]):(0,L.pF)("trunc",e[0],-Number(e[1]))},char_length:{minParams:1,maxParams:1,evaluate:e=>k(e[0])?e[0].length:0},concat:{minParams:1,maxParams:1/0,evaluate:e=>{let t="";for(let r=0;r<e.length;r++){if(null==e[r])return null;t+=e[r].toString()}return t}},lower:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:e[0].toString().toLowerCase()},upper:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:e[0].toString().toUpperCase()},coalesce:{minParams:1,maxParams:1/0,evaluate:e=>{for(const t of e)if(null!==t)return t;return null}},cosh:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.cosh(e[0])},sinh:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.sinh(e[0])},tanh:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.tanh(e[0])},nullif:{minParams:2,maxParams:2,evaluate:(e,t)=>U(e[0],e[1],"=")?null:e[0]},cast:{minParams:2,maxParams:2,evaluate:(e,t)=>{const r=e[0],n=e[1];if(null===r)return null;switch(n.type){case"integer":{if(!j(r))throw new o.L8(o.Z7.CannotCastValue);const e=parseInt(r,10);if(isNaN(e))throw new o.L8(o.Z7.CannotCastValue);return e}case"smallint":{if(!j(r))throw new o.L8(o.Z7.CannotCastValue);const e=parseInt(r,10);if(isNaN(e))throw new o.L8(o.Z7.CannotCastValue);if(e>32767||e<-32767)throw new o.L8(o.Z7.CannotCastValue);return e}case"float":case"real":{if(!j(r))throw new o.L8(o.Z7.CannotCastValue);const e=parseFloat(r);if(isNaN(e))throw new o.L8(o.Z7.CannotCastValue);return e}case"time":return function(e){if(w(e))return u.k.fromDateJS(e);if(I(e))return u.k.fromDateTime(e);if(x(e))throw new o.L8(o.Z7.CannotCastValue);if(R(e))return e;if(M(e))return u.k.fromSqlTimeStampOffset(e);if(k(e))return O(e);throw new o.L8(o.Z7.CannotCastValue)}(r);case"date":return function(e){if(w(e))return a.n.fromDateJS(e);if(I(e))return a.n.fromParts(e.year,e.month,e.day);if(x(e))return e;if(R(e))throw new o.L8(o.Z7.CannotCastValue);if(M(e)&&null===a.n.fromParts(e.year,e.month,e.day))throw new o.L8(o.Z7.CannotCastValue);if(k(e)){const t=a.n.fromReader(e);if(null!==t&&t.isValid)return t}throw new o.L8(o.Z7.CannotCastValue)}(r);case"timestamp":return function(e,t,r){if(w(e))return b(e,t);if(I(e))return e;if(x(e))return e.toDateTimeLuxon("unknown");if(R(e))throw new o.L8(o.Z7.CannotCastValue);if(M(e))return e;if(k(e))return C(e,"unknown",r);throw new o.L8(o.Z7.CannotCastValue)}(r,t,!0===n.withtimezone);case"varchar":{const e=Z(r);if(e.length>n.size)throw new o.L8(o.Z7.CannotCastValue);return e}default:throw new o.L8(o.Z7.InvalidDataType)}}}};function W(e,t,r,n){if("||"===e)return V("concat",[t,r],n);if(null===t||null===r)return null;if(S(t)){if(S(r))return Y(t,r,e);if(E(r))return function(e,t,r){switch(r){case"+":return l.createFromMilliseconds(e+t.valueInMilliseconds());case"-":return l.createFromMilliseconds(e-t.valueInMilliseconds());case"*":return l.createFromMilliseconds(e*t.valueInMilliseconds());case"/":return l.createFromMilliseconds(e/t.valueInMilliseconds())}throw new o.L8(o.Z7.InvalidOperator)}(t,r,e);if(R(r))return function(){throw new o.L8(o.Z7.InvalidOperator)}();if(x(r))return function(){throw new o.L8(o.Z7.InvalidOperator)}();if(M(r))return function(){throw new o.L8(o.Z7.InvalidOperator)}();if(I(r))return function(){throw new o.L8(o.Z7.InvalidOperator)}();if(A(r))return function(e,t,r){const n=parseFloat(t);if(isNaN(n))throw new o.L8(o.Z7.InvalidOperator);return Y(e,n,r)}(t,r,e);throw new o.L8(o.Z7.InvalidOperator)}if(x(t)){if(S(r))return function(e,t,r){const n=1e3*t*24*60*60;switch(r){case"+":return e.plus("milliseconds",n);case"-":return e.plus("milliseconds",-1*n)}throw new o.L8(o.Z7.InvalidOperator)}(t,r,e);if(E(r))return function(e,t,r){switch(r){case"+":return e.plus("milliseconds",t.valueInMilliseconds());case"-":return e.plus("milliseconds",-1*t.valueInMilliseconds())}throw new o.L8(o.Z7.InvalidOperator)}(t,r,e);if(R(r))return function(){throw new o.L8(o.Z7.InvalidOperator)}();if(x(r))return function(e,t,r){if("-"===r)return e.toDateTimeLuxon("UTC").diff(t.toDateTimeLuxon("UTC")).as("days");throw new o.L8(o.Z7.InvalidOperator)}(t,r,e);if(M(r))return function(e,t,r){if("-"===r)return e.toDateTimeLuxon(t.toDateTime().zone).diff(t.toDateTime()).as("days");throw new o.L8(o.Z7.InvalidOperator)}(t,r,e);if(I(r))return function(e,t,r){if("-"===r)return e.toDateTimeLuxon(t.zone).diff(t).as("days");throw new o.L8(o.Z7.InvalidOperator)}(t,r,e);if(A(r))return function(){throw new o.L8(o.Z7.InvalidOperator)}();throw new o.L8(o.Z7.InvalidOperator)}if(R(t)){if(S(r))return function(e,t,r){const n=1e3*t*24*60*60;switch(r){case"+":return e.plus("milliseconds",n);case"-":return e.plus("milliseconds",-1*n)}throw new o.L8(o.Z7.InvalidOperator)}(t,r,e);if(E(r))return function(e,t,r){switch(r){case"+":return e.plus("milliseconds",t.valueInMilliseconds());case"-":return e.plus("milliseconds",-1*t.valueInMilliseconds())}throw new o.L8(o.Z7.InvalidOperator)}(t,r,e);if(R(r))return function(){throw new o.L8(o.Z7.InvalidOperator)}();if(x(r))return function(){throw new o.L8(o.Z7.InvalidOperator)}();if(M(r))return function(){throw new o.L8(o.Z7.InvalidOperator)}();if(I(r))return function(){throw new o.L8(o.Z7.InvalidOperator)}();if(A(r))return function(){throw new o.L8(o.Z7.InvalidOperator)}();throw new o.L8(o.Z7.InvalidOperator)}if(E(t)){if(S(r))return function(e,t,r){switch(r){case"+":return l.createFromMilliseconds(e.valueInMilliseconds()+t);case"-":return l.createFromMilliseconds(e.valueInMilliseconds()-t);case"*":return l.createFromMilliseconds(e.valueInMilliseconds()*t);case"/":return l.createFromMilliseconds(e.valueInMilliseconds()/t)}throw new o.L8(o.Z7.InvalidOperator)}(t,r,e);if(E(r))return function(e,t,r){switch(r){case"+":return l.createFromMilliseconds(e.valueInMilliseconds()+t.valueInMilliseconds());case"-":return l.createFromMilliseconds(e.valueInMilliseconds()-t.valueInMilliseconds());case"*":return l.createFromMilliseconds(e.valueInMilliseconds()*t.valueInMilliseconds());case"/":return l.createFromMilliseconds(e.valueInMilliseconds()/t.valueInMilliseconds())}throw new o.L8(o.Z7.InvalidOperator)}(t,r,e);if(R(r))return function(e,t,r){if("+"===r)return t.plus("milliseconds",e.valueInMilliseconds());throw new o.L8(o.Z7.InvalidOperator)}(t,r,e);if(x(r))return function(e,t,r){if("+"===r)return t.plus("milliseconds",e.valueInMilliseconds());throw new o.L8(o.Z7.InvalidOperator)}(t,r,e);if(M(r))return function(e,t,r){if("+"===r)return t.addMilliseconds(e.valueInMilliseconds());throw new o.L8(o.Z7.InvalidOperator)}(t,r,e);if(I(r))return function(e,t,r){switch(r){case"+":return t.plus({milliseconds:e.valueInMilliseconds()});case"-":return e.valueInMilliseconds()-t.toMillis()}throw new o.L8(o.Z7.InvalidOperator)}(t,r,e);if(A(r))return function(){throw new o.L8(o.Z7.InvalidOperator)}();throw new o.L8(o.Z7.InvalidOperator)}if(I(t)){if(S(r))return function(e,t,r){const n=1e3*t*24*60*60;switch(r){case"+":return e.plus({milliseconds:n});case"-":return e.minus({milliseconds:n})}throw new o.L8(o.Z7.InvalidOperator)}(t,r,e);if(E(r))return function(e,t,r){switch(r){case"+":return e.plus({milliseconds:t.valueInMilliseconds()});case"-":return e.minus({milliseconds:t.valueInMilliseconds()})}throw new o.L8(o.Z7.InvalidOperator)}(t,r,e);if(R(r))return function(){throw new o.L8(o.Z7.InvalidOperator)}();if(x(r))return function(e,t,r){if("-"===r)return e.diff(t.toDateTimeLuxon(e.zone)).as("days");throw new o.L8(o.Z7.InvalidOperator)}(t,r,e);if(M(r))return function(e,t,r){if("-"===r)return e.diff(t.toDateTime()).as("days");throw new o.L8(o.Z7.InvalidOperator)}(t,r,e);if(I(r))return function(e,t,r){if("-"===r)return e.diff(t).as("days");throw new o.L8(o.Z7.InvalidOperator)}(t,r,e);if(A(r))return function(){throw new o.L8(o.Z7.InvalidOperator)}();throw new o.L8(o.Z7.InvalidOperator)}if(M(t)){if(S(r))return function(e,t,r){const n=1e3*t*24*60*60;switch(r){case"+":return e.addMilliseconds(n);case"-":return e.addMilliseconds(-1*n)}throw new o.L8(o.Z7.InvalidOperator)}(t,r,e);if(E(r))return function(e,t,r){switch(r){case"+":return e.addMilliseconds(t.valueInMilliseconds());case"-":return e.addMilliseconds(-1*t.valueInMilliseconds())}throw new o.L8(o.Z7.InvalidOperator)}(t,r,e);if(R(r))return function(){throw new o.L8(o.Z7.InvalidOperator)}();if(x(r))return function(e,t,r){if("-"===r)return e.toDateTime().diff(t.toDateTimeLuxon(e.toDateTime().zone)).as("days");throw new o.L8(o.Z7.InvalidOperator)}(t,r,e);if(M(r))return function(e,t,r){if("-"===r)return e.toDateTime().diff(t.toDateTime()).as("days");throw new o.L8(o.Z7.InvalidOperator)}(t,r,e);if(I(r))return function(e,t,r){if("-"===r)return e.toDateTime().diff(t).as("days");throw new o.L8(o.Z7.InvalidOperator)}(t,r,e);if(A(r))return function(){throw new o.L8(o.Z7.InvalidOperator)}();throw new o.L8(o.Z7.InvalidOperator)}if(A(t)){if(S(r))return function(e,t,r){const n=parseFloat(e);if(isNaN(n))throw new o.L8(o.Z7.InvalidOperator);return Y(n,t,r)}(t,r,e);if(E(r))return function(){throw new o.L8(o.Z7.InvalidOperator)}();if(R(r))return function(){throw new o.L8(o.Z7.InvalidOperator)}();if(x(r))return function(){throw new o.L8(o.Z7.InvalidOperator)}();if(M(r))return function(){throw new o.L8(o.Z7.InvalidOperator)}();if(I(r))return function(){throw new o.L8(o.Z7.InvalidOperator)}();if(A(r))return function(e,t,r){if("+"===r)return e+t;throw new o.L8(o.Z7.InvalidOperator)}(t,r,e);throw new o.L8(o.Z7.InvalidOperator)}throw new o.L8(o.Z7.InvalidOperator)}function Y(e,t,r){switch(r){case"+":return e+t;case"-":return e-t;case"*":return e*t;case"/":return e/t}throw new o.L8(o.Z7.InvalidOperator)}function $(e,t,r,n){var i=Error.call(this,e);return Object.setPrototypeOf&&Object.setPrototypeOf(i,$.prototype),i.expected=t,i.found=r,i.location=n,i.name="SyntaxError",i}function X(e,t,r){return r=r||" ",e.length>t?e:(t-=e.length,e+(r+=r.repeat(t)).slice(0,t))}(function(e,t){function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r})($,Error),$.prototype.format=function(e){var t="Error: "+this.message;if(this.location){var r,n=null;for(r=0;r<e.length;r++)if(e[r].source===this.location.source){n=e[r].text.split(/\r\n|\n|\r/g);break}var i=this.location.start,s=this.location.source&&"function"==typeof this.location.source.offset?this.location.source.offset(i):i,a=this.location.source+":"+s.line+":"+s.column;if(n){var o=this.location.end,l=X("",s.line.toString().length," "),c=n[i.line-1],u=(i.line===o.line?o.column:c.length+1)-i.column||1;t+="\n --\x3e "+a+"\n"+l+" |\n"+s.line+" | "+c+"\n"+l+" | "+X("",i.column-1," ")+X("",u,"^")}else t+="\n at "+a}return t},$.buildMessage=function(e,t){var r={literal:function(e){return'"'+i(e.text)+'"'},class:function(e){var t=e.parts.map((function(e){return Array.isArray(e)?s(e[0])+"-"+s(e[1]):s(e)}));return"["+(e.inverted?"^":"")+t.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(e){return e.description}};function n(e){return e.charCodeAt(0).toString(16).toUpperCase()}function i(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+n(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+n(e)}))}function s(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+n(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+n(e)}))}function a(e){return r[e.type](e)}return"Expected "+function(e){var t,r,n=e.map(a);if(n.sort(),n.length>0){for(t=1,r=1;t<n.length;t++)n[t-1]!==n[t]&&(n[r]=n[t],r++);n.length=r}switch(n.length){case 1:return n[0];case 2:return n[0]+" or "+n[1];default:return n.slice(0,-1).join(", ")+", or "+n[n.length-1]}}(e)+" but "+function(e){return e?'"'+i(e)+'"':"end of input"}(t)+" found."};class J{static parse(e){return function(e,t){var r,n={},i=(t=void 0!==t?t:{}).grammarSource,s={start:rs},a=rs,o="!",l="=",c=">=",u=">",d="<=",h="<>",f="!=",p="||",m="@",g="'",_="N'",y="''",v=".",T="null",b="true",S="false",A="in",E="is",w="like",I="escape",x="not",R="and",M="or",O="between",C="from",N="for",L="substring",F="extract",D="trim",P="position",B="timestamp",U="date",G="time",z="leading",H="trailing",V="both",k="cast",j="as",Z="integer",q="int",W="smallint",Y="float",X="real",J="varchar",Q="to",K="interval",ee="year",te="timezone_hour",re="timezone_minute",ne="month",ie="day",se="hour",ae="minute",oe="second",le="case",ce="end",ue="when",de="then",he="else",fe=",",pe="(",me=")",ge="`",_e=/^[<-=]/,ye=/^[+\-]/,ve=/^[*\/]/,Te=/^[A-Za-z_\x80-\uFFFF]/,be=/^[A-Za-z0-9_]/,Se=/^[A-Za-z0-9_.\x80-\uFFFF]/,Ae=/^["]/,Ee=/^[^']/,we=/^[0-9]/,Ie=/^[eE]/,xe=/^[ \t\n\r]/,Re=/^[^`]/,Me=Xi("!",!1),Oe=Xi("=",!1),Ce=Xi(">=",!1),Ne=Xi(">",!1),Le=Xi("<=",!1),Fe=Xi("<>",!1),De=Ji([["<","="]],!1,!1),Pe=Xi("!=",!1),Be=Ji(["+","-"],!1,!1),Ue=Xi("||",!1),Ge=Ji(["*","/"],!1,!1),ze=Ji([["A","Z"],["a","z"],"_",["",""]],!1,!1),He=Ji([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),Ve=Ji([["A","Z"],["a","z"],["0","9"],"_",".",["",""]],!1,!1),ke=Ji(['"'],!1,!1),je=Xi("@",!1),Ze=Xi("'",!1),qe=Xi("N'",!1),We=Xi("''",!1),Ye=Ji(["'"],!0,!1),$e=Xi(".",!1),Xe=Ji([["0","9"]],!1,!1),Je=Ji(["e","E"],!1,!1),Qe=Xi("NULL",!0),Ke=Xi("TRUE",!0),et=Xi("FALSE",!0),tt=Xi("IN",!0),rt=Xi("IS",!0),nt=Xi("LIKE",!0),it=Xi("ESCAPE",!0),st=Xi("NOT",!0),at=Xi("AND",!0),ot=Xi("OR",!0),lt=Xi("BETWEEN",!0),ct=Xi("FROM",!0),ut=Xi("FOR",!0),dt=Xi("SUBSTRING",!0),ht=Xi("EXTRACT",!0),ft=Xi("TRIM",!0),pt=Xi("POSITION",!0),mt=Xi("TIMESTAMP",!0),gt=Xi("DATE",!0),_t=Xi("TIME",!0),yt=Xi("LEADING",!0),vt=Xi("TRAILING",!0),Tt=Xi("BOTH",!0),bt=Xi("CAST",!0),St=Xi("AS",!0),At=Xi("INTEGER",!0),Et=Xi("INT",!0),wt=Xi("SMALLINT",!0),It=Xi("FLOAT",!0),xt=Xi("REAL",!0),Rt=Xi("VARCHAR",!0),Mt=Xi("TO",!0),Ot=Xi("INTERVAL",!0),Ct=Xi("YEAR",!0),Nt=Xi("TIMEZONE_HOUR",!0),Lt=Xi("TIMEZONE_MINUTE",!0),Ft=Xi("MONTH",!0),Dt=Xi("DAY",!0),Pt=Xi("HOUR",!0),Bt=Xi("MINUTE",!0),Ut=Xi("SECOND",!0),Gt=Xi("CASE",!0),zt=Xi("END",!0),Ht=Xi("WHEN",!0),Vt=Xi("THEN",!0),kt=Xi("ELSE",!0),jt=Xi(",",!1),Zt=Xi("(",!1),qt=Xi(")",!1),Wt=Ji([" ","\t","\n","\r"],!1,!1),Yt=Xi("`",!1),$t=Ji(["`"],!0,!1),Xt=function(e){return e},Jt=function(e){return Ha(Yi(),...e)},Qt=function(e,t,r){return{op:t,expr:r,location:Yi()}},Kt=function(e,t){return Va(e,t)},er=function(e,t,r){return{op:t,expr:r,location:Yi()}},tr=function(e,t){return Va(e,t)},rr=function(e){return function(e,t,r){return{type:"unary-expression",location:r,operator:"NOT",expr:t}}(0,e,Yi())},nr=function(e,t){return""==t||null==t||null==t?e:"arithmetic"==t.type?Va(e,t.tail):za(t.op,e,t.right,t.escape,Yi())},ir=function(e,t){return{op:e,expr:t,location:Yi()}},sr=function(e){return{type:"arithmetic",tail:e}},ar=function(e,t){return{op:e+"NOT",right:t}},or=function(e,t){return{op:e,right:t}},lr=function(e,t,r){return Ha(Yi(),t,r)},cr=function(e,t){return{op:"NOT"+e,right:t}},ur=function(e,t,r){return Ha(Yi(),t,r)},dr=function(e,t){return{op:e,right:t}},hr=function(e){return e[0]+" "+e[2]},fr=function(e){return e[0]+" "+e[2]},pr=function(e,t,r){return{op:e,right:t,escape:r.value}},mr=function(e,t){return{op:e,right:t,escape:""}},gr=function(e,t){return{op:e,right:t}},_r=function(e,t){return{op:e,right:t}},yr=function(e,t,r){return{op:t,expr:r,location:Yi()}},vr=function(e,t){return Va(e,t)},Tr=function(e,t,r){return{op:t,expr:r,location:Yi()}},br=function(e,t){return Va(e,t)},Sr=function(e){return e.paren=!0,e},Ar=function(e){return/^CURRENT_DATE$/i.test(e)?{type:"current-time",location:Yi(),mode:"date"}:/^CURRENT_TIMESTAMP$/i.test(e)?{type:"current-time",location:Yi(),mode:"timestamp"}:/^CURRENT_TIME$/i.test(e)?{type:"current-time",location:Yi(),mode:"time"}:/^CURRENT_USER$/i.test(e)?{type:"current-user",location:Yi()}:{type:"column-reference",location:Yi(),table:"",column:e}},Er=function(e){return{type:"column-reference",location:Yi(),table:"",column:e,delimited:!0}},wr=function(e){return e},Ir=function(e,t){return e+t.join("")},xr=function(e,t){return e+t.join("")},Rr=function(e){return e},Mr=function(e){return e.join("")},Or=function(){return'"'},Cr=function(e){return{type:"parameter",location:Yi(),value:e[1]}},Nr=function(e,t){return Ha(Yi(),e,t)},Lr=function(e,t){return Ha(Yi(),e,t)},Fr=function(e){return{type:"function",location:Yi(),name:"extract",args:e}},Dr=function(e,t,r){return Ha(Yi(),e,t,...r?[r]:[])},Pr=function(e,t,r){return Ha(Yi(),e,t,r)},Br=function(e){return{type:"function",location:Yi(),name:"substring",args:e}},Ur=function(e,t){return Ha(Yi(),e,t)},Gr=function(e,t){return Ha(Yi(),e,t)},zr=function(e){return{type:"function",location:Yi(),name:"cast",args:e}},Hr=function(){return{type:"data-type",location:Yi(),value:{type:"integer"}}},Vr=function(){return{type:"data-type",location:Yi(),value:{type:"smallint"}}},kr=function(){return{type:"data-type",location:Yi(),value:{type:"float"}}},jr=function(){return{type:"data-type",location:Yi(),value:{type:"real"}}},Zr=function(){return{type:"data-type",location:Yi(),value:{type:"date"}}},qr=function(){return{type:"data-type",location:Yi(),value:{type:"timestamp"}}},Wr=function(){return{type:"data-type",location:Yi(),value:{type:"time"}}},Yr=function(e){return{type:"data-type",location:Yi(),value:{type:"varchar",size:parseInt(e)}}},$r=function(e,t,r){return Ha(Yi(),e,t,r)},Xr=function(e,t){return Ha(Yi(),e,t)},Jr=function(e){return{type:"function",location:Yi(),name:"trim",args:e}},Qr=function(e){return{type:"string",location:Yi(),value:e??"BOTH"}},Kr=function(e,t){return Ha(Yi(),e,t)},en=function(e,t){return Ha(Yi(),e,t)},tn=function(e){return{type:"function",location:Yi(),name:"position",args:e}},rn=function(e,t){return{type:"function",location:Yi(),name:e,args:t}},nn=function(e){return{type:"string",location:Yi(),value:e}},sn=function(e){return"string"===e.type&&function(e){!0!==/^(\d{4})-(\d{1,2})-(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/.test(e)&&$i("Timestamp literal is invalid")}(e.value),{type:"timestamp",location:Yi(),value:e.value}},an=function(e){return"string"===e.type&&function(e){!0!==/^(\d{1,2}):(\d{1,2}):(\d{1,2})$|^(\d{1,2}):(\d{1,2})$|^(\d{1,2}):(\d{1,2}):(\d{1,2}).([0-9]+)$/.test(e)&&$i("Time literal is invalid")}(e.value),{type:"time",location:Yi(),value:e.value}},on=function(e,t,r){return{type:"interval",location:Yi(),value:t,qualifier:r,op:e}},ln=function(e,t){return{type:"interval",location:Yi(),value:e,qualifier:t,op:""}},cn=function(e,t){return{type:"interval-qualifier",location:Yi(),start:e,end:t}},un=function(e,t){return{type:"interval-period",location:Yi(),period:e.value,precision:t,secondary:null}},dn=function(e){return{type:"interval-period",location:Yi(),period:e.value,precision:null,secondary:null}},hn=function(e){return{type:"interval-period",location:Yi(),period:e.value,precision:null,secondary:null}},fn=function(e,t){return{type:"interval-period",location:Yi(),period:"second",precision:e,secondary:t}},pn=function(e){return{type:"interval-period",location:Yi(),period:"second",precision:e,secondary:null}},mn=function(){return{type:"interval-period",location:Yi(),period:"second",precision:null,secondary:null}},gn=function(e,t){return{type:"interval-period",location:Yi(),period:e.value,precision:t,secondary:null}},_n=function(e){return{type:"interval-period",location:Yi(),period:e.value,precision:null,secondary:null}},yn=function(e,t){return{type:"interval-period",location:Yi(),period:"second",precision:e,secondary:t}},vn=function(e){return{type:"interval-period",location:Yi(),period:"second",precision:e,secondary:null}},Tn=function(){return{type:"interval-period",location:Yi(),period:"second",precision:null,secondary:null}},bn=function(){return{type:"string",location:Yi(),value:"day"}},Sn=function(){return{type:"string",location:Yi(),value:"hour"}},An=function(){return{type:"string",location:Yi(),value:"minute"}},En=function(){return{type:"string",location:Yi(),value:"month"}},wn=function(){return{type:"string",location:Yi(),value:"year"}},In=function(e){return parseFloat(e)},xn=function(e){return parseFloat(e)},Rn=function(e){return"string"===e.type&&function(e){!0!==/^(\d{4})-(\d{1,2})-(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/.test(e)&&$i("Date literal is invalid")}(e.value),{type:"date",location:Yi(),value:e.value}},Mn=function(){return{type:"null",location:Yi(),value:null}},On=function(){return{type:"boolean",location:Yi(),value:!0}},Cn=function(){return{type:"boolean",location:Yi(),value:!1}},Nn=function(){return"'"},Ln=function(e){return{type:"string",location:Yi(),value:e.join("")}},Fn=function(e,t){return{type:"case-expression",location:Yi(),format:"simple",operand:e,clauses:t,else:null,elseLocation:null}},Dn=function(e,t,r){return{type:"case-expression",location:Yi(),format:"simple",operand:e,clauses:t,else:r.value,elseLocation:r.location}},Pn=function(e){return{type:"case-expression",location:Yi(),format:"searched",clauses:e,else:null,elseLocation:null}},Bn=function(e,t){return{type:"case-expression",location:Yi(),format:"searched",clauses:e,else:t.value,elseLocation:t.location}},Un=function(e,t){return{type:"when-clause",location:Yi(),operand:e,value:t}},Gn=function(e,t){return{type:"when-clause",location:Yi(),operand:e,value:t}},zn=function(e){return{type:"else-clause",location:Yi(),value:e}},Hn=function(e){return{type:"number",location:Yi(),value:e}},Vn=function(e,t,r){return parseFloat(e+t+r)},kn=function(e,t){return parseFloat(e+t)},jn=function(e,t){return parseFloat(e+t)},Zn=function(e){return parseFloat(e)},qn=function(e,t){return e[0]+t},Wn=function(e){return"."+(null!=e?e:"")},Yn=function(e,t){return e+t},$n=function(e){return e.join("")},Xn=function(e,t){return"e"+(null===t?"":t)},Jn=function(){return"IN"},Qn=function(){return"IS"},Kn=function(){return"LIKE"},ei=function(){return"ESCAPE"},ti=function(){return"NOT"},ri=function(){return"AND"},ni=function(){return"OR"},ii=function(){return"BETWEEN"},si=function(){return"FROM"},ai=function(){return"FOR"},oi=function(){return"SUBSTRING"},li=function(){return"EXTRACT"},ci=function(){return"TRIM"},ui=function(){return"POSITION"},di=function(){return"TIMESTAMP"},hi=function(){return"DATE"},fi=function(){return"TIME"},pi=function(){return"LEADING"},mi=function(){return"TRAILING"},gi=function(){return"BOTH"},_i=function(){return"CAST"},yi=function(){return"AS"},vi=function(){return"INTEGER"},Ti=function(){return"INT"},bi=function(){return"SMALLINT"},Si=function(){return"FLOAT"},Ai=function(){return"REAL"},Ei=function(){return"VARCHAR"},wi=function(){return"TO"},Ii=function(){return"INTERVAL"},xi=function(){return"YEAR"},Ri=function(){return"TIMEZONE_HOUR"},Mi=function(){return"TIMEZONE_MINUTE"},Oi=function(){return"MONTH"},Ci=function(){return"DAY"},Ni=function(){return"HOUR"},Li=function(){return"MINUTE"},Fi=function(){return"SECOND"},Di=function(){return"CASE"},Pi=function(){return"END"},Bi=function(){return"WHEN"},Ui=function(){return"THEN"},Gi=function(){return"ELSE"},zi=function(e){return e},Hi=function(e){return e.join("")},Vi=0|t.peg$currPos,ki=Vi,ji=[{line:1,column:1}],Zi=Vi,qi=t.peg$maxFailExpected||[],Wi=0|t.peg$silentFails;if(t.startRule){if(!(t.startRule in s))throw new Error("Can't start parsing from rule \""+t.startRule+'".');a=s[t.startRule]}function Yi(){return Ki(ki,Vi)}function $i(e,t){throw ts(e,t=void 0!==t?t:Ki(ki,Vi))}function Xi(e,t){return{type:"literal",text:e,ignoreCase:t}}function Ji(e,t,r){return{type:"class",parts:e,inverted:t,ignoreCase:r}}function Qi(t){var r,n=ji[t];if(n)return n;if(t>=ji.length)r=ji.length-1;else for(r=t;!ji[--r];);for(n={line:(n=ji[r]).line,column:n.column};r<t;)10===e.charCodeAt(r)?(n.line++,n.column=1):n.column++,r++;return ji[t]=n,n}function Ki(e,t,r){var n=Qi(e),s=Qi(t);return{source:i,start:{offset:e,line:n.line,column:n.column},end:{offset:t,line:s.line,column:s.column}}}function es(e){Vi<Zi||(Vi>Zi&&(Zi=Vi,qi=[]),qi.push(e))}function ts(e,t){return new $(e,null,null,t)}function rs(){var e,t;return e=Vi,Ba(),(t=is())!==n?(Ba(),ki=e,e=Xt(t)):(Vi=e,e=n),e}function ns(){var e,t,r,i,s,a;if(e=Vi,Da()!==n){for(Ba(),t=[],r=is();r!==n;)t.push(r),r=Vi,i=Vi,s=Ba(),(a=Fa())!==n?i=s=[s,a,Ba()]:(Vi=i,i=n),i!==n&&(i=is())===n?(Vi=r,r=n):r=i;r=Ba(),(i=Pa())!==n?(ki=e,e=Jt(t)):(Vi=e,e=n)}else Vi=e,e=n;return e}function is(){var e,t,r,i,s,a;if(e=Vi,(t=ss())!==n){for(r=[],i=Vi,Ba(),(s=Js())!==n?(Ba(),(a=ss())!==n?(ki=i,i=Qt(t,s,a)):(Vi=i,i=n)):(Vi=i,i=n);i!==n;)r.push(i),i=Vi,Ba(),(s=Js())!==n?(Ba(),(a=ss())!==n?(ki=i,i=Qt(t,s,a)):(Vi=i,i=n)):(Vi=i,i=n);ki=e,e=Kt(t,r)}else Vi=e,e=n;return e}function ss(){var e,t,r,i,s,a;if(e=Vi,(t=as())!==n){for(r=[],i=Vi,Ba(),(s=Xs())!==n?(Ba(),(a=as())!==n?(ki=i,i=er(t,s,a)):(Vi=i,i=n)):(Vi=i,i=n);i!==n;)r.push(i),i=Vi,Ba(),(s=Xs())!==n?(Ba(),(a=as())!==n?(ki=i,i=er(t,s,a)):(Vi=i,i=n)):(Vi=i,i=n);ki=e,e=tr(t,r)}else Vi=e,e=n;return e}function as(){var t,r,i,s,a;return t=Vi,(r=$s())===n&&(r=Vi,33===e.charCodeAt(Vi)?(i=o,Vi++):(i=n,0===Wi&&es(Me)),i!==n?(s=Vi,Wi++,61===e.charCodeAt(Vi)?(a=l,Vi++):(a=n,0===Wi&&es(Oe)),Wi--,a===n?s=void 0:(Vi=s,s=n),s!==n?r=i=[i,s]:(Vi=r,r=n)):(Vi=r,r=n)),r!==n?(i=Ba(),(s=as())!==n?(ki=t,t=rr(s)):(Vi=t,t=n)):(Vi=t,t=n),t===n&&(t=function(){var e,t,r,i;return e=Vi,(t=us())!==n?(r=Vi,Ba(),(i=function(){var e;return(e=function(){var e,t,r,i,s;if(e=Vi,t=[],r=Vi,Ba(),(i=os())!==n?(Ba(),(s=us())!==n?(ki=r,r=ir(i,s)):(Vi=r,r=n)):(Vi=r,r=n),r!==n)for(;r!==n;)t.push(r),r=Vi,Ba(),(i=os())!==n?(Ba(),(s=us())!==n?(ki=r,r=ir(i,s)):(Vi=r,r=n)):(Vi=r,r=n);else t=n;return t!==n&&(ki=e,t=sr(t)),t}())===n&&(e=function(){var e,t,r;return e=Vi,(t=cs())!==n?(Ba(),(r=ns())!==n?(ki=e,e=gr(t,r)):(Vi=e,e=n)):(Vi=e,e=n),e===n&&(e=Vi,(t=cs())!==n?(Ba(),(r=Ss())!==n?(ki=e,e=_r(t,r)):(Vi=e,e=n)):(Vi=e,e=n)),e}())===n&&(e=function(){var e,t,r,i,s,a,o,l;return e=Vi,(t=$s())!==n?(Ba(),(r=Qs())!==n?(i=Ba(),s=Vi,(a=us())!==n?(Ba(),(o=Xs())!==n?(Ba(),(l=us())!==n?(ki=s,s=lr(r,a,l)):(Vi=s,s=n)):(Vi=s,s=n)):(Vi=s,s=n),s!==n?(ki=e,e=cr(r,s)):(Vi=e,e=n)):(Vi=e,e=n)):(Vi=e,e=n),e===n&&(e=Vi,(t=Qs())!==n?(Ba(),r=Vi,(i=us())!==n?(s=Ba(),(a=Xs())!==n?(Ba(),(o=us())!==n?(ki=r,r=ur(t,i,o)):(Vi=r,r=n)):(Vi=r,r=n)):(Vi=r,r=n),r!==n?(ki=e,e=dr(t,r)):(Vi=e,e=n)):(Vi=e,e=n)),e}())===n&&(e=function(){var e,t,r,i;return e=Vi,(t=qs())!==n?(Ba(),(r=$s())!==n?(Ba(),(i=us())!==n?(ki=e,e=ar(t,i)):(Vi=e,e=n)):(Vi=e,e=n)):(Vi=e,e=n),e===n&&(e=Vi,(t=qs())!==n?(Ba(),(r=us())!==n?(ki=e,e=or(t,r)):(Vi=e,e=n)):(Vi=e,e=n)),e}())===n&&(e=function(){var e,t,r,i;return e=Vi,(t=ls())!==n?(Ba(),(r=Cs())!==n?(Ba(),Ys()!==n?(Ba(),(i=Ns())!==n?(ki=e,e=pr(t,r,i)):(Vi=e,e=n)):(Vi=e,e=n)):(Vi=e,e=n)):(Vi=e,e=n),e===n&&(e=Vi,(t=ls())!==n?(Ba(),(r=Cs())!==n?(ki=e,e=mr(t,r)):(Vi=e,e=n)):(Vi=e,e=n)),e}()),e}())!==n?r=i:(Vi=r,r=n),r===n&&(r=null),ki=e,e=nr(t,r)):(Vi=e,e=n),e}()),t}function os(){var t;return e.substr(Vi,2)===c?(t=c,Vi+=2):(t=n,0===Wi&&es(Ce)),t===n&&(62===e.charCodeAt(Vi)?(t=u,Vi++):(t=n,0===Wi&&es(Ne)),t===n&&(e.substr(Vi,2)===d?(t=d,Vi+=2):(t=n,0===Wi&&es(Le)),t===n&&(e.substr(Vi,2)===h?(t=h,Vi+=2):(t=n,0===Wi&&es(Fe)),t===n&&(t=e.charAt(Vi),_e.test(t)?Vi++:(t=n,0===Wi&&es(De)),t===n&&(e.substr(Vi,2)===f?(t=f,Vi+=2):(t=n,0===Wi&&es(Pe))))))),t}function ls(){var e,t,r,i,s;return e=Vi,t=Vi,(r=$s())!==n?(i=Ba(),(s=Ws())!==n?t=r=[r,i,s]:(Vi=t,t=n)):(Vi=t,t=n),t!==n&&(ki=e,t=hr(t)),(e=t)===n&&(e=Ws()),e}function cs(){var e,t,r,i,s;return e=Vi,t=Vi,(r=$s())!==n?(i=Ba(),(s=Zs())!==n?t=r=[r,i,s]:(Vi=t,t=n)):(Vi=t,t=n),t!==n&&(ki=e,t=fr(t)),(e=t)===n&&(e=Zs()),e}function us(){var e,t,r,i,s,a;if(e=Vi,(t=hs())!==n){for(r=[],i=Vi,Ba(),(s=ds())!==n?(Ba(),(a=hs())!==n?(ki=i,i=yr(t,s,a)):(Vi=i,i=n)):(Vi=i,i=n);i!==n;)r.push(i),i=Vi,Ba(),(s=ds())!==n?(Ba(),(a=hs())!==n?(ki=i,i=yr(t,s,a)):(Vi=i,i=n)):(Vi=i,i=n);ki=e,e=vr(t,r)}else Vi=e,e=n;return e}function ds(){var t;return t=e.charAt(Vi),ye.test(t)?Vi++:(t=n,0===Wi&&es(Be)),t===n&&(e.substr(Vi,2)===p?(t=p,Vi+=2):(t=n,0===Wi&&es(Ue))),t}function hs(){var e,t,r,i,s,a;if(e=Vi,(t=ps())!==n){for(r=[],i=Vi,Ba(),(s=fs())!==n?(Ba(),(a=ps())!==n?(ki=i,i=Tr(t,s,a)):(Vi=i,i=n)):(Vi=i,i=n);i!==n;)r.push(i),i=Vi,Ba(),(s=fs())!==n?(Ba(),(a=ps())!==n?(ki=i,i=Tr(t,s,a)):(Vi=i,i=n)):(Vi=i,i=n);ki=e,e=br(t,r)}else Vi=e,e=n;return e}function fs(){var t;return t=e.charAt(Vi),ve.test(t)?Vi++:(t=n,0===Wi&&es(Ge)),t}function ps(){var e,t;return(e=function(){var e;return(e=Ns())===n&&(e=function(){var e,t,r,i;return e=Vi,(t=function(){var e,t,r,i;return e=Vi,(t=Ps())!==n&&(r=Bs())!==n&&(i=Us())!==n?(ki=e,e=Vn(t,r,i)):(Vi=e,e=n),e===n&&(e=Vi,(t=Ps())!==n&&(r=Bs())!==n?(ki=e,e=kn(t,r)):(Vi=e,e=n),e===n&&(e=Vi,(t=Ps())!==n&&(r=Us())!==n?(ki=e,e=jn(t,r)):(Vi=e,e=n),e===n&&(e=Vi,(t=Ps())!==n&&(ki=e,t=Zn(t)),e=t))),e}())!==n?(r=Vi,Wi++,i=gs(),Wi--,i===n?r=void 0:(Vi=r,r=n),r!==n?(ki=e,e=Hn(t)):(Vi=e,e=n)):(Vi=e,e=n),e}())===n&&(e=function(){var e,t;return e=Vi,(t=ks())!==n&&(ki=e,t=On()),(e=t)===n&&(e=Vi,(t=js())!==n&&(ki=e,t=Cn()),e=t),e}())===n&&(e=function(){var e,t;return e=Vi,(t=Vs())!==n&&(ki=e,t=Mn()),t}())===n&&(e=function(){var e,t;return e=Vi,aa()!==n?(Ba(),(t=Cs())!==n?(ki=e,e=Rn(t)):(Vi=e,e=n)):(Vi=e,e=n),e}())===n&&(e=function(){var e,t;return e=Vi,sa()!==n?(Ba(),(t=Cs())!==n?(ki=e,e=sn(t)):(Vi=e,e=n)):(Vi=e,e=n),e}())===n&&(e=Is())===n&&(e=function(){var e,t;return e=Vi,oa()!==n?(Ba(),(t=Cs())!==n?(ki=e,e=an(t)):(Vi=e,e=n)):(Vi=e,e=n),e}()),e}())===n&&(e=function(){var e,t,r,i;return e=Vi,ra()!==n?(Ba(),t=Vi,Da()!==n?(Ba(),(r=ws())!==n?(Ba(),Ks()!==n?(Ba(),(i=is())!==n?(Ba(),Pa()!==n?(ki=t,t=Nr(r,i)):(Vi=t,t=n)):(Vi=t,t=n)):(Vi=t,t=n)):(Vi=t,t=n)):(Vi=t,t=n),t===n&&(t=Vi,Da()!==n?(Ba(),(r=ws())!==n?(Ba(),Fa()!==n?(Ba(),(i=is())!==n?(Ba(),Pa()!==n?(ki=t,t=Lr(r,i)):(Vi=t,t=n)):(Vi=t,t=n)):(Vi=t,t=n)):(Vi=t,t=n)):(Vi=t,t=n)),t!==n?(ki=e,e=Fr(t)):(Vi=e,e=n)):(Vi=e,e=n),e}())===n&&(e=function(){var e,t,r,i,s,a,o;return e=Vi,ta()!==n?(Ba(),t=Vi,Da()!==n?(Ba(),(r=is())!==n?(Ba(),Ks()!==n?(Ba(),(i=is())!==n?(Ba(),s=Vi,ea()!==n?(a=Ba(),(o=is())!==n?(Ba(),s=o):(Vi=s,s=n)):(Vi=s,s=n),s===n&&(s=null),Pa()!==n?(ki=t,t=Dr(r,i,s)):(Vi=t,t=n)):(Vi=t,t=n)):(Vi=t,t=n)):(Vi=t,t=n)):(Vi=t,t=n),t===n&&(t=Vi,Da()!==n?(Ba(),(r=is())!==n?(Ba(),Fa()!==n?(Ba(),(i=is())!==n?(Ba(),(s=Fa())!==n?(Ba(),(a=is())!==n&&(o=Pa())!==n?(ki=t,t=Pr(r,i,a)):(Vi=t,t=n)):(Vi=t,t=n)):(Vi=t,t=n)):(Vi=t,t=n)):(Vi=t,t=n)):(Vi=t,t=n)),t!==n?(ki=e,e=Br(t)):(Vi=e,e=n)):(Vi=e,e=n),e}())===n&&(e=function(){var e,t,r,i,s;return e=Vi,na()!==n?(Ba(),t=Vi,Da()!==n?(Ba(),r=Es(),Ba(),(i=is())!==n?(Ba(),Ks()!==n?(Ba(),(s=is())!==n?(Ba(),Pa()!==n?(ki=t,t=$r(r,i,s)):(Vi=t,t=n)):(Vi=t,t=n)):(Vi=t,t=n)):(Vi=t,t=n)):(Vi=t,t=n),t===n&&(t=Vi,Da()!==n?(Ba(),r=Es(),Ba(),(i=is())!==n?(Ba(),Pa()!==n?(ki=t,t=Xr(r,i)):(Vi=t,t=n)):(Vi=t,t=n)):(Vi=t,t=n)),t!==n?(ki=e,e=Jr(t)):(Vi=e,e=n)):(Vi=e,e=n),e}())===n&&(e=function(){var e,t,r,i;return e=Vi,ia()!==n?(Ba(),t=Vi,Da()!==n?(Ba(),(r=is())!==n?(Ba(),Zs()!==n?(Ba(),(i=is())!==n?(Ba(),Pa()!==n?(ki=t,t=Kr(r,i)):(Vi=t,t=n)):(Vi=t,t=n)):(Vi=t,t=n)):(Vi=t,t=n)):(Vi=t,t=n),t===n&&(t=Vi,Da()!==n?(Ba(),(r=is())!==n?(Ba(),Fa()!==n?(Ba(),(i=is())!==n?(Ba(),Pa()!==n?(ki=t,t=en(r,i)):(Vi=t,t=n)):(Vi=t,t=n)):(Vi=t,t=n)):(Vi=t,t=n)):(Vi=t,t=n)),t!==n?(ki=e,e=tn(t)):(Vi=e,e=n)):(Vi=e,e=n),e}())===n&&(e=function(){var e,t,r,i;return e=Vi,da()!==n?(Ba(),t=Vi,Da()!==n?(Ba(),(r=is())!==n?(Ba(),ha()!==n?(Ba(),(i=As())!==n?(Ba(),Pa()!==n?(ki=t,t=Ur(r,i)):(Vi=t,t=n)):(Vi=t,t=n)):(Vi=t,t=n)):(Vi=t,t=n)):(Vi=t,t=n),t===n&&(t=Vi,Da()!==n?(Ba(),(r=is())!==n?(Ba(),Fa()!==n?(Ba(),(i=As())!==n?(Ba(),Pa()!==n?(ki=t,t=Gr(r,i)):(Vi=t,t=n)):(Vi=t,t=n)):(Vi=t,t=n)):(Vi=t,t=n)):(Vi=t,t=n)),t!==n?(ki=e,e=zr(t)):(Vi=e,e=n)):(Vi=e,e=n),e}())===n&&(e=function(){var e,t,r,i;return e=Vi,t=Vi,Wi++,r=ra(),Wi--,r===n?t=void 0:(Vi=t,t=n),t!==n&&(r=Ga())!==n?(Ba(),(i=ns())!==n?(ki=e,e=rn(r,i)):(Vi=e,e=n)):(Vi=e,e=n),e}())===n&&(e=function(){var e;return(e=function(){var e,t,r,i,s;if(e=Vi,Ma()!==n)if(Ba(),(t=is())!==n){for(Ba(),r=[],i=Vi,(s=Fs())!==n?(Ba(),i=s):(Vi=i,i=n);i!==n;)r.push(i),i=Vi,(s=Fs())!==n?(Ba(),i=s):(Vi=i,i=n);(i=Oa())!==n?(ki=e,e=Fn(t,r)):(Vi=e,e=n)}else Vi=e,e=n;else Vi=e,e=n;if(e===n)if(e=Vi,Ma()!==n)if(Ba(),(t=is())!==n){for(Ba(),r=[],i=Vi,(s=Fs())!==n?(Ba(),i=s):(Vi=i,i=n);i!==n;)r.push(i),i=Vi,(s=Fs())!==n?(Ba(),i=s):(Vi=i,i=n);(i=Ds())!==n?(s=Ba(),Oa()!==n?(ki=e,e=Dn(t,r,i)):(Vi=e,e=n)):(Vi=e,e=n)}else Vi=e,e=n;else Vi=e,e=n;return e}())===n&&(e=function(){var e,t,r,i;if(e=Vi,Ma()!==n){for(Ba(),t=[],r=Vi,(i=Ls())!==n?(Ba(),r=i):(Vi=r,r=n);r!==n;)t.push(r),r=Vi,(i=Ls())!==n?(Ba(),r=i):(Vi=r,r=n);(r=Oa())!==n?(ki=e,e=Pn(t)):(Vi=e,e=n)}else Vi=e,e=n;if(e===n)if(e=Vi,Ma()!==n){for(Ba(),t=[],r=Vi,(i=Ls())!==n?(Ba(),r=i):(Vi=r,r=n);r!==n;)t.push(r),r=Vi,(i=Ls())!==n?(Ba(),r=i):(Vi=r,r=n);(r=Ds())!==n?(i=Ba(),Oa()!==n?(ki=e,e=Bn(t,r)):(Vi=e,e=n)):(Vi=e,e=n)}else Vi=e,e=n;return e}()),e}())===n&&(e=function(){var e,t;return e=Vi,(t=function(){var e,t;return e=Vi,(t=function(){var e,t,r,i;if(e=Vi,(t=gs())!==n){for(r=[],i=ys();i!==n;)r.push(i),i=ys();ki=e,e=Ir(t,r)}else Vi=e,e=n;return e}())!==n&&(ki=e,t=wr(t)),t}())!==n&&(ki=e,t=Ar(t)),(e=t)===n&&(e=Vi,(t=function(){var e,t;return e=Vi,bs()!==n?(t=function(){var e,t,r;for(e=Vi,t=[],r=vs();r!==n;)t.push(r),r=vs();return ki=e,Mr(t)}(),bs()!==n?(ki=e,e=Rr(t)):(Vi=e,e=n)):(Vi=e,e=n),e}())!==n&&(ki=e,t=Er(t)),e=t),e}())===n&&(e=Ss())===n&&(e=Vi,Da()!==n?(Ba(),(t=is())!==n?(Ba(),Pa()!==n?(ki=e,e=Sr(t)):(Vi=e,e=n)):(Vi=e,e=n)):(Vi=e,e=n)),e}function ms(){var e,t,r,i;if(e=Vi,(t=gs())!==n){for(r=[],i=_s();i!==n;)r.push(i),i=_s();ki=e,e=xr(t,r)}else Vi=e,e=n;return e}function gs(){var t;return t=e.charAt(Vi),Te.test(t)?Vi++:(t=n,0===Wi&&es(ze)),t}function _s(){var t;return t=e.charAt(Vi),be.test(t)?Vi++:(t=n,0===Wi&&es(He)),t}function ys(){var t;return t=e.charAt(Vi),Se.test(t)?Vi++:(t=n,0===Wi&&es(Ve)),t}function vs(){var e;return(e=Ts())===n&&(e=function(){var e;return e=Vi,bs()!==n&&bs()!==n?(ki=e,e=Or()):(Vi=e,e=n),e}()),e}function Ts(){var t;return t=e.charAt(Vi),Se.test(t)?Vi++:(t=n,0===Wi&&es(Ve)),t}function bs(){var t;return t=e.charAt(Vi),Ae.test(t)?Vi++:(t=n,0===Wi&&es(ke)),t}function Ss(){var t,r,i,s;return t=Vi,r=Vi,64===e.charCodeAt(Vi)?(i=m,Vi++):(i=n,0===Wi&&es(je)),i!==n&&(s=ms())!==n?r=i=[i,s]:(Vi=r,r=n),r!==n&&(ki=t,r=Cr(r)),r}function As(){var e,t,r;return e=Vi,(t=fa())===n&&(t=pa()),t!==n&&(ki=e,t=Hr()),(e=t)===n&&(e=Vi,(t=ma())!==n&&(ki=e,t=Vr()),(e=t)===n&&(e=Vi,(t=ga())!==n&&(ki=e,t=kr()),(e=t)===n&&(e=Vi,(t=_a())!==n&&(ki=e,t=jr()),(e=t)===n&&(e=Vi,(t=aa())!==n&&(ki=e,t=Zr()),(e=t)===n&&(e=Vi,(t=sa())!==n&&(ki=e,t=qr()),(e=t)===n&&(e=Vi,(t=oa())!==n&&(ki=e,t=Wr()),(e=t)===n&&(e=Vi,(t=ya())!==n?(Ba(),Da()!==n?(Ba(),(r=Gs())!==n?(Ba(),Pa()!==n?(ki=e,e=Yr(r)):(Vi=e,e=n)):(Vi=e,e=n)):(Vi=e,e=n)):(Vi=e,e=n)))))))),e}function Es(){var e,t;return e=Vi,(t=la())===n&&(t=ca())===n&&(t=ua()),t===n&&(t=null),ki=e,Qr(t)}function ws(){var e,t;return e=Vi,(t=ba())===n&&(t=Ea())===n&&(t=wa())===n&&(t=Ia())===n&&(t=xa())===n&&(t=Ra())===n&&(t=Sa())===n&&(t=Aa()),t!==n&&(ki=e,t=nn(t)),t}function Is(){var t,r,i,s;return t=Vi,Ta()!==n?(Ba(),r=e.charAt(Vi),ye.test(r)?Vi++:(r=n,0===Wi&&es(Be)),r!==n?(Ba(),(i=Cs())!==n?(Ba(),(s=xs())!==n?(ki=t,t=on(r,i,s)):(Vi=t,t=n)):(Vi=t,t=n)):(Vi=t,t=n)):(Vi=t,t=n),t===n&&(t=Vi,Ta()!==n?(Ba(),(r=Cs())!==n?(Ba(),(i=xs())!==n?(ki=t,t=ln(r,i)):(Vi=t,t=n)):(Vi=t,t=n)):(Vi=t,t=n)),t}function xs(){var e,t,r;return e=Vi,(t=function(){var e,t,r;return e=Vi,(t=Rs())!==n?(Ba(),Da()!==n?(Ba(),(r=Os())!==n?(Ba(),Pa()!==n?(ki=e,e=un(t,r)):(Vi=e,e=n)):(Vi=e,e=n)):(Vi=e,e=n)):(Vi=e,e=n),e===n&&(e=Vi,(t=Rs())!==n&&(ki=e,t=dn(t)),e=t),e}())!==n?(Ba(),va()!==n?(Ba(),(r=function(){var e,t,r,i;return e=Vi,(t=Rs())!==n&&(ki=e,t=hn(t)),(e=t)===n&&(e=Vi,(t=Ra())!==n?(Ba(),Da()!==n?(Ba(),(r=Os())!==n?(Ba(),Fa()!==n?(Ba(),(i=Ms())!==n?(Ba(),Pa()!==n?(ki=e,e=fn(r,i)):(Vi=e,e=n)):(Vi=e,e=n)):(Vi=e,e=n)):(Vi=e,e=n)):(Vi=e,e=n)):(Vi=e,e=n),e===n&&(e=Vi,(t=Ra())!==n?(Ba(),Da()!==n?(Ba(),(r=Os())!==n?(Ba(),Pa()!==n?(ki=e,e=pn(r)):(Vi=e,e=n)):(Vi=e,e=n)):(Vi=e,e=n)):(Vi=e,e=n),e===n&&(e=Vi,(t=Ra())!==n&&(ki=e,t=mn()),e=t))),e}())!==n?(ki=e,e=cn(t,r)):(Vi=e,e=n)):(Vi=e,e=n)):(Vi=e,e=n),e===n&&(e=function(){var e,t,r,i;return e=Vi,(t=Rs())!==n?(Ba(),Da()!==n?(Ba(),(r=Ms())!==n?(Ba(),Pa()!==n?(ki=e,e=gn(t,r)):(Vi=e,e=n)):(Vi=e,e=n)):(Vi=e,e=n)):(Vi=e,e=n),e===n&&(e=Vi,(t=Rs())!==n&&(ki=e,t=_n(t)),(e=t)===n&&(e=Vi,(t=Ra())!==n?(Ba(),Da()!==n?(Ba(),(r=Os())!==n?(Ba(),Fa()!==n?(Ba(),(i=Ms())!==n?(Ba(),Pa()!==n?(ki=e,e=yn(r,i)):(Vi=e,e=n)):(Vi=e,e=n)):(Vi=e,e=n)):(Vi=e,e=n)):(Vi=e,e=n)):(Vi=e,e=n),e===n&&(e=Vi,(t=Ra())!==n?(Ba(),Da()!==n?(Ba(),(r=Ms())!==n?(Ba(),Pa()!==n?(ki=e,e=vn(r)):(Vi=e,e=n)):(Vi=e,e=n)):(Vi=e,e=n)):(Vi=e,e=n),e===n&&(e=Vi,(t=Ra())!==n&&(ki=e,t=Tn()),e=t)))),e}()),e}function Rs(){var e,t;return e=Vi,(t=wa())!==n&&(ki=e,t=bn()),(e=t)===n&&(e=Vi,(t=Ia())!==n&&(ki=e,t=Sn()),(e=t)===n&&(e=Vi,(t=xa())!==n&&(ki=e,t=An()),(e=t)===n&&(e=Vi,(t=Ea())!==n&&(ki=e,t=En()),(e=t)===n&&(e=Vi,(t=ba())!==n&&(ki=e,t=wn()),e=t)))),e}function Ms(){var e,t;return e=Vi,(t=Gs())!==n&&(ki=e,t=In(t)),t}function Os(){var e,t;return e=Vi,(t=Gs())!==n&&(ki=e,t=xn(t)),t}function Cs(){var e;return(e=Ns())===n&&(e=Ss()),e}function Ns(){var t,r,i,s,a;if(t=Vi,39===e.charCodeAt(Vi)?(r=g,Vi++):(r=n,0===Wi&&es(Ze)),r===n&&(e.substr(Vi,2)===_?(r=_,Vi+=2):(r=n,0===Wi&&es(qe))),r!==n){for(i=[],s=Vi,e.substr(Vi,2)===y?(a=y,Vi+=2):(a=n,0===Wi&&es(We)),a!==n&&(ki=s,a=Nn()),(s=a)===n&&(s=e.charAt(Vi),Ee.test(s)?Vi++:(s=n,0===Wi&&es(Ye)));s!==n;)i.push(s),s=Vi,e.substr(Vi,2)===y?(a=y,Vi+=2):(a=n,0===Wi&&es(We)),a!==n&&(ki=s,a=Nn()),(s=a)===n&&(s=e.charAt(Vi),Ee.test(s)?Vi++:(s=n,0===Wi&&es(Ye)));39===e.charCodeAt(Vi)?(s=g,Vi++):(s=n,0===Wi&&es(Ze)),s!==n?(ki=t,t=Ln(i)):(Vi=t,t=n)}else Vi=t,t=n;return t}function Ls(){var e,t,r;return e=Vi,Ca()!==n?(Ba(),(t=is())!==n?(Ba(),Na()!==n?(Ba(),(r=is())!==n?(ki=e,e=Un(t,r)):(Vi=e,e=n)):(Vi=e,e=n)):(Vi=e,e=n)):(Vi=e,e=n),e}function Fs(){var e,t,r;return e=Vi,Ca()!==n?(Ba(),(t=is())!==n?(Ba(),Na()!==n?(Ba(),(r=is())!==n?(ki=e,e=Gn(t,r)):(Vi=e,e=n)):(Vi=e,e=n)):(Vi=e,e=n)):(Vi=e,e=n),e}function Ds(){var e,t;return e=Vi,La()!==n?(Ba(),(t=is())!==n?(ki=e,e=zn(t)):(Vi=e,e=n)):(Vi=e,e=n),e}function Ps(){var t,r,i;return(t=Gs())===n&&(t=Vi,r=e.charAt(Vi),ye.test(r)?Vi++:(r=n,0===Wi&&es(Be)),r!==n&&(i=Gs())!==n?(ki=t,t=qn(r,i)):(Vi=t,t=n)),t}function Bs(){var t,r,i;return t=Vi,46===e.charCodeAt(Vi)?(r=v,Vi++):(r=n,0===Wi&&es($e)),r!==n?((i=Gs())===n&&(i=null),ki=t,t=Wn(i)):(Vi=t,t=n),t}function Us(){var e,t,r;return e=Vi,(t=Hs())!==n&&(r=Gs())!==n?(ki=e,e=Yn(t,r)):(Vi=e,e=n),e}function Gs(){var e,t,r;if(e=Vi,t=[],(r=zs())!==n)for(;r!==n;)t.push(r),r=zs();else t=n;return t!==n&&(ki=e,t=$n(t)),t}function zs(){var t;return t=e.charAt(Vi),we.test(t)?Vi++:(t=n,0===Wi&&es(Xe)),t}function Hs(){var t,r,i;return t=Vi,r=e.charAt(Vi),Ie.test(r)?Vi++:(r=n,0===Wi&&es(Je)),r!==n?(i=e.charAt(Vi),ye.test(i)?Vi++:(i=n,0===Wi&&es(Be)),i===n&&(i=null),ki=t,t=Xn(r,i)):(Vi=t,t=n),t}function Vs(){var t,r,i,s;return t=Vi,(r=e.substr(Vi,4)).toLowerCase()===T?Vi+=4:(r=n,0===Wi&&es(Qe)),r!==n?(i=Vi,Wi++,s=_s(),Wi--,s===n?i=void 0:(Vi=i,i=n),i!==n?t=r=[r,i]:(Vi=t,t=n)):(Vi=t,t=n),t}function ks(){var t,r,i,s;return t=Vi,(r=e.substr(Vi,4)).toLowerCase()===b?Vi+=4:(r=n,0===Wi&&es(Ke)),r!==n?(i=Vi,Wi++,s=_s(),Wi--,s===n?i=void 0:(Vi=i,i=n),i!==n?t=r=[r,i]:(Vi=t,t=n)):(Vi=t,t=n),t}function js(){var t,r,i,s;return t=Vi,(r=e.substr(Vi,5)).toLowerCase()===S?Vi+=5:(r=n,0===Wi&&es(et)),r!==n?(i=Vi,Wi++,s=_s(),Wi--,s===n?i=void 0:(Vi=i,i=n),i!==n?t=r=[r,i]:(Vi=t,t=n)):(Vi=t,t=n),t}function Zs(){var t,r,i,s;return t=Vi,(r=e.substr(Vi,2)).toLowerCase()===A?Vi+=2:(r=n,0===Wi&&es(tt)),r!==n?(i=Vi,Wi++,s=_s(),Wi--,s===n?i=void 0:(Vi=i,i=n),i!==n?(ki=t,t=Jn()):(Vi=t,t=n)):(Vi=t,t=n),t}function qs(){var t,r,i,s;return t=Vi,(r=e.substr(Vi,2)).toLowerCase()===E?Vi+=2:(r=n,0===Wi&&es(rt)),r!==n?(i=Vi,Wi++,s=_s(),Wi--,s===n?i=void 0:(Vi=i,i=n),i!==n?(ki=t,t=Qn()):(Vi=t,t=n)):(Vi=t,t=n),t}function Ws(){var t,r,i,s;return t=Vi,(r=e.substr(Vi,4)).toLowerCase()===w?Vi+=4:(r=n,0===Wi&&es(nt)),r!==n?(i=Vi,Wi++,s=_s(),Wi--,s===n?i=void 0:(Vi=i,i=n),i!==n?(ki=t,t=Kn()):(Vi=t,t=n)):(Vi=t,t=n),t}function Ys(){var t,r,i,s;return t=Vi,(r=e.substr(Vi,6)).toLowerCase()===I?Vi+=6:(r=n,0===Wi&&es(it)),r!==n?(i=Vi,Wi++,s=_s(),Wi--,s===n?i=void 0:(Vi=i,i=n),i!==n?(ki=t,t=ei()):(Vi=t,t=n)):(Vi=t,t=n),t}function $s(){var t,r,i,s;return t=Vi,(r=e.substr(Vi,3)).toLowerCase()===x?Vi+=3:(r=n,0===Wi&&es(st)),r!==n?(i=Vi,Wi++,s=_s(),Wi--,s===n?i=void 0:(Vi=i,i=n),i!==n?(ki=t,t=ti()):(Vi=t,t=n)):(Vi=t,t=n),t}function Xs(){var t,r,i,s;return t=Vi,(r=e.substr(Vi,3)).toLowerCase()===R?Vi+=3:(r=n,0===Wi&&es(at)),r!==n?(i=Vi,Wi++,s=_s(),Wi--,s===n?i=void 0:(Vi=i,i=n),i!==n?(ki=t,t=ri()):(Vi=t,t=n)):(Vi=t,t=n),t}function Js(){var t,r,i,s;return t=Vi,(r=e.substr(Vi,2)).toLowerCase()===M?Vi+=2:(r=n,0===Wi&&es(ot)),r!==n?(i=Vi,Wi++,s=_s(),Wi--,s===n?i=void 0:(Vi=i,i=n),i!==n?(ki=t,t=ni()):(Vi=t,t=n)):(Vi=t,t=n),t}function Qs(){var t,r,i,s;return t=Vi,(r=e.substr(Vi,7)).toLowerCase()===O?Vi+=7:(r=n,0===Wi&&es(lt)),r!==n?(i=Vi,Wi++,s=_s(),Wi--,s===n?i=void 0:(Vi=i,i=n),i!==n?(ki=t,t=ii()):(Vi=t,t=n)):(Vi=t,t=n),t}function Ks(){var t,r,i,s;return t=Vi,(r=e.substr(Vi,4)).toLowerCase()===C?Vi+=4:(r=n,0===Wi&&es(ct)),r!==n?(i=Vi,Wi++,s=_s(),Wi--,s===n?i=void 0:(Vi=i,i=n),i!==n?(ki=t,t=si()):(Vi=t,t=n)):(Vi=t,t=n),t}function ea(){var t,r,i,s;return t=Vi,(r=e.substr(Vi,3)).toLowerCase()===N?Vi+=3:(r=n,0===Wi&&es(ut)),r!==n?(i=Vi,Wi++,s=_s(),Wi--,s===n?i=void 0:(Vi=i,i=n),i!==n?(ki=t,t=ai()):(Vi=t,t=n)):(Vi=t,t=n),t}function ta(){var t,r,i,s;return t=Vi,(r=e.substr(Vi,9)).toLowerCase()===L?Vi+=9:(r=n,0===Wi&&es(dt)),r!==n?(i=Vi,Wi++,s=_s(),Wi--,s===n?i=void 0:(Vi=i,i=n),i!==n?(ki=t,t=oi()):(Vi=t,t=n)):(Vi=t,t=n),t}function ra(){var t,r,i,s;return t=Vi,(r=e.substr(Vi,7)).toLowerCase()===F?Vi+=7:(r=n,0===Wi&&es(ht)),r!==n?(i=Vi,Wi++,s=_s(),Wi--,s===n?i=void 0:(Vi=i,i=n),i!==n?(ki=t,t=li()):(Vi=t,t=n)):(Vi=t,t=n),t}function na(){var t,r,i,s;return t=Vi,(r=e.substr(Vi,4)).toLowerCase()===D?Vi+=4:(r=n,0===Wi&&es(ft)),r!==n?(i=Vi,Wi++,s=_s(),Wi--,s===n?i=void 0:(Vi=i,i=n),i!==n?(ki=t,t=ci()):(Vi=t,t=n)):(Vi=t,t=n),t}function ia(){var t,r,i,s;return t=Vi,(r=e.substr(Vi,8)).toLowerCase()===P?Vi+=8:(r=n,0===Wi&&es(pt)),r!==n?(i=Vi,Wi++,s=_s(),Wi--,s===n?i=void 0:(Vi=i,i=n),i!==n?(ki=t,t=ui()):(Vi=t,t=n)):(Vi=t,t=n),t}function sa(){var t,r,i,s;return t=Vi,(r=e.substr(Vi,9)).toLowerCase()===B?Vi+=9:(r=n,0===Wi&&es(mt)),r!==n?(i=Vi,Wi++,s=_s(),Wi--,s===n?i=void 0:(Vi=i,i=n),i!==n?(ki=t,t=di()):(Vi=t,t=n)):(Vi=t,t=n),t}function aa(){var t,r,i,s;return t=Vi,(r=e.substr(Vi,4)).toLowerCase()===U?Vi+=4:(r=n,0===Wi&&es(gt)),r!==n?(i=Vi,Wi++,s=_s(),Wi--,s===n?i=void 0:(Vi=i,i=n),i!==n?(ki=t,t=hi()):(Vi=t,t=n)):(Vi=t,t=n),t}function oa(){var t,r,i,s;return t=Vi,(r=e.substr(Vi,4)).toLowerCase()===G?Vi+=4:(r=n,0===Wi&&es(_t)),r!==n?(i=Vi,Wi++,s=_s(),Wi--,s===n?i=void 0:(Vi=i,i=n),i!==n?(ki=t,t=fi()):(Vi=t,t=n)):(Vi=t,t=n),t}function la(){var t,r,i,s;return t=Vi,(r=e.substr(Vi,7)).toLowerCase()===z?Vi+=7:(r=n,0===Wi&&es(yt)),r!==n?(i=Vi,Wi++,s=_s(),Wi--,s===n?i=void 0:(Vi=i,i=n),i!==n?(ki=t,t=pi()):(Vi=t,t=n)):(Vi=t,t=n),t}function ca(){var t,r,i,s;return t=Vi,(r=e.substr(Vi,8)).toLowerCase()===H?Vi+=8:(r=n,0===Wi&&es(vt)),r!==n?(i=Vi,Wi++,s=_s(),Wi--,s===n?i=void 0:(Vi=i,i=n),i!==n?(ki=t,t=mi()):(Vi=t,t=n)):(Vi=t,t=n),t}function ua(){var t,r,i,s;return t=Vi,(r=e.substr(Vi,4)).toLowerCase()===V?Vi+=4:(r=n,0===Wi&&es(Tt)),r!==n?(i=Vi,Wi++,s=_s(),Wi--,s===n?i=void 0:(Vi=i,i=n),i!==n?(ki=t,t=gi()):(Vi=t,t=n)):(Vi=t,t=n),t}function da(){var t,r,i,s;return t=Vi,(r=e.substr(Vi,4)).toLowerCase()===k?Vi+=4:(r=n,0===Wi&&es(bt)),r!==n?(i=Vi,Wi++,s=_s(),Wi--,s===n?i=void 0:(Vi=i,i=n),i!==n?(ki=t,t=_i()):(Vi=t,t=n)):(Vi=t,t=n),t}function ha(){var t,r,i,s;return t=Vi,(r=e.substr(Vi,2)).toLowerCase()===j?Vi+=2:(r=n,0===Wi&&es(St)),r!==n?(i=Vi,Wi++,s=_s(),Wi--,s===n?i=void 0:(Vi=i,i=n),i!==n?(ki=t,t=yi()):(Vi=t,t=n)):(Vi=t,t=n),t}function fa(){var t,r,i,s;return t=Vi,(r=e.substr(Vi,7)).toLowerCase()===Z?Vi+=7:(r=n,0===Wi&&es(At)),r!==n?(i=Vi,Wi++,s=_s(),Wi--,s===n?i=void 0:(Vi=i,i=n),i!==n?(ki=t,t=vi()):(Vi=t,t=n)):(Vi=t,t=n),t}function pa(){var t,r,i,s;return t=Vi,(r=e.substr(Vi,3)).toLowerCase()===q?Vi+=3:(r=n,0===Wi&&es(Et)),r!==n?(i=Vi,Wi++,s=_s(),Wi--,s===n?i=void 0:(Vi=i,i=n),i!==n?(ki=t,t=Ti()):(Vi=t,t=n)):(Vi=t,t=n),t}function ma(){var t,r,i,s;return t=Vi,(r=e.substr(Vi,8)).toLowerCase()===W?Vi+=8:(r=n,0===Wi&&es(wt)),r!==n?(i=Vi,Wi++,s=_s(),Wi--,s===n?i=void 0:(Vi=i,i=n),i!==n?(ki=t,t=bi()):(Vi=t,t=n)):(Vi=t,t=n),t}function ga(){var t,r,i,s;return t=Vi,(r=e.substr(Vi,5)).toLowerCase()===Y?Vi+=5:(r=n,0===Wi&&es(It)),r!==n?(i=Vi,Wi++,s=_s(),Wi--,s===n?i=void 0:(Vi=i,i=n),i!==n?(ki=t,t=Si()):(Vi=t,t=n)):(Vi=t,t=n),t}function _a(){var t,r,i,s;return t=Vi,(r=e.substr(Vi,4)).toLowerCase()===X?Vi+=4:(r=n,0===Wi&&es(xt)),r!==n?(i=Vi,Wi++,s=_s(),Wi--,s===n?i=void 0:(Vi=i,i=n),i!==n?(ki=t,t=Ai()):(Vi=t,t=n)):(Vi=t,t=n),t}function ya(){var t,r,i,s;return t=Vi,(r=e.substr(Vi,7)).toLowerCase()===J?Vi+=7:(r=n,0===Wi&&es(Rt)),r!==n?(i=Vi,Wi++,s=_s(),Wi--,s===n?i=void 0:(Vi=i,i=n),i!==n?(ki=t,t=Ei()):(Vi=t,t=n)):(Vi=t,t=n),t}function va(){var t,r,i,s;return t=Vi,(r=e.substr(Vi,2)).toLowerCase()===Q?Vi+=2:(r=n,0===Wi&&es(Mt)),r!==n?(i=Vi,Wi++,s=_s(),Wi--,s===n?i=void 0:(Vi=i,i=n),i!==n?(ki=t,t=wi()):(Vi=t,t=n)):(Vi=t,t=n),t}function Ta(){var t,r,i,s;return t=Vi,(r=e.substr(Vi,8)).toLowerCase()===K?Vi+=8:(r=n,0===Wi&&es(Ot)),r!==n?(i=Vi,Wi++,s=_s(),Wi--,s===n?i=void 0:(Vi=i,i=n),i!==n?(ki=t,t=Ii()):(Vi=t,t=n)):(Vi=t,t=n),t}function ba(){var t,r,i,s;return t=Vi,(r=e.substr(Vi,4)).toLowerCase()===ee?Vi+=4:(r=n,0===Wi&&es(Ct)),r!==n?(i=Vi,Wi++,s=_s(),Wi--,s===n?i=void 0:(Vi=i,i=n),i!==n?(ki=t,t=xi()):(Vi=t,t=n)):(Vi=t,t=n),t}function Sa(){var t,r,i,s;return t=Vi,(r=e.substr(Vi,13)).toLowerCase()===te?Vi+=13:(r=n,0===Wi&&es(Nt)),r!==n?(i=Vi,Wi++,s=_s(),Wi--,s===n?i=void 0:(Vi=i,i=n),i!==n?(ki=t,t=Ri()):(Vi=t,t=n)):(Vi=t,t=n),t}function Aa(){var t,r,i,s;return t=Vi,(r=e.substr(Vi,15)).toLowerCase()===re?Vi+=15:(r=n,0===Wi&&es(Lt)),r!==n?(i=Vi,Wi++,s=_s(),Wi--,s===n?i=void 0:(Vi=i,i=n),i!==n?(ki=t,t=Mi()):(Vi=t,t=n)):(Vi=t,t=n),t}function Ea(){var t,r,i,s;return t=Vi,(r=e.substr(Vi,5)).toLowerCase()===ne?Vi+=5:(r=n,0===Wi&&es(Ft)),r!==n?(i=Vi,Wi++,s=_s(),Wi--,s===n?i=void 0:(Vi=i,i=n),i!==n?(ki=t,t=Oi()):(Vi=t,t=n)):(Vi=t,t=n),t}function wa(){var t,r,i,s;return t=Vi,(r=e.substr(Vi,3)).toLowerCase()===ie?Vi+=3:(r=n,0===Wi&&es(Dt)),r!==n?(i=Vi,Wi++,s=_s(),Wi--,s===n?i=void 0:(Vi=i,i=n),i!==n?(ki=t,t=Ci()):(Vi=t,t=n)):(Vi=t,t=n),t}function Ia(){var t,r,i,s;return t=Vi,(r=e.substr(Vi,4)).toLowerCase()===se?Vi+=4:(r=n,0===Wi&&es(Pt)),r!==n?(i=Vi,Wi++,s=_s(),Wi--,s===n?i=void 0:(Vi=i,i=n),i!==n?(ki=t,t=Ni()):(Vi=t,t=n)):(Vi=t,t=n),t}function xa(){var t,r,i,s;return t=Vi,(r=e.substr(Vi,6)).toLowerCase()===ae?Vi+=6:(r=n,0===Wi&&es(Bt)),r!==n?(i=Vi,Wi++,s=_s(),Wi--,s===n?i=void 0:(Vi=i,i=n),i!==n?(ki=t,t=Li()):(Vi=t,t=n)):(Vi=t,t=n),t}function Ra(){var t,r,i,s;return t=Vi,(r=e.substr(Vi,6)).toLowerCase()===oe?Vi+=6:(r=n,0===Wi&&es(Ut)),r!==n?(i=Vi,Wi++,s=_s(),Wi--,s===n?i=void 0:(Vi=i,i=n),i!==n?(ki=t,t=Fi()):(Vi=t,t=n)):(Vi=t,t=n),t}function Ma(){var t,r,i,s;return t=Vi,(r=e.substr(Vi,4)).toLowerCase()===le?Vi+=4:(r=n,0===Wi&&es(Gt)),r!==n?(i=Vi,Wi++,s=_s(),Wi--,s===n?i=void 0:(Vi=i,i=n),i!==n?(ki=t,t=Di()):(Vi=t,t=n)):(Vi=t,t=n),t}function Oa(){var t,r,i,s;return t=Vi,(r=e.substr(Vi,3)).toLowerCase()===ce?Vi+=3:(r=n,0===Wi&&es(zt)),r!==n?(i=Vi,Wi++,s=_s(),Wi--,s===n?i=void 0:(Vi=i,i=n),i!==n?(ki=t,t=Pi()):(Vi=t,t=n)):(Vi=t,t=n),t}function Ca(){var t,r,i,s;return t=Vi,(r=e.substr(Vi,4)).toLowerCase()===ue?Vi+=4:(r=n,0===Wi&&es(Ht)),r!==n?(i=Vi,Wi++,s=_s(),Wi--,s===n?i=void 0:(Vi=i,i=n),i!==n?(ki=t,t=Bi()):(Vi=t,t=n)):(Vi=t,t=n),t}function Na(){var t,r,i,s;return t=Vi,(r=e.substr(Vi,4)).toLowerCase()===de?Vi+=4:(r=n,0===Wi&&es(Vt)),r!==n?(i=Vi,Wi++,s=_s(),Wi--,s===n?i=void 0:(Vi=i,i=n),i!==n?(ki=t,t=Ui()):(Vi=t,t=n)):(Vi=t,t=n),t}function La(){var t,r,i,s;return t=Vi,(r=e.substr(Vi,4)).toLowerCase()===he?Vi+=4:(r=n,0===Wi&&es(kt)),r!==n?(i=Vi,Wi++,s=_s(),Wi--,s===n?i=void 0:(Vi=i,i=n),i!==n?(ki=t,t=Gi()):(Vi=t,t=n)):(Vi=t,t=n),t}function Fa(){var t;return 44===e.charCodeAt(Vi)?(t=fe,Vi++):(t=n,0===Wi&&es(jt)),t}function Da(){var t;return 40===e.charCodeAt(Vi)?(t=pe,Vi++):(t=n,0===Wi&&es(Zt)),t}function Pa(){var t;return 41===e.charCodeAt(Vi)?(t=me,Vi++):(t=n,0===Wi&&es(qt)),t}function Ba(){var e,t;for(e=[],t=Ua();t!==n;)e.push(t),t=Ua();return e}function Ua(){var t;return t=e.charAt(Vi),xe.test(t)?Vi++:(t=n,0===Wi&&es(Wt)),t}function Ga(){var t,r,i,s;if(t=Vi,(r=ms())!==n&&(ki=t,r=zi(r)),(t=r)===n)if(t=Vi,96===e.charCodeAt(Vi)?(r=ge,Vi++):(r=n,0===Wi&&es(Yt)),r!==n){if(i=[],s=e.charAt(Vi),Re.test(s)?Vi++:(s=n,0===Wi&&es($t)),s!==n)for(;s!==n;)i.push(s),s=e.charAt(Vi),Re.test(s)?Vi++:(s=n,0===Wi&&es($t));else i=n;i!==n?(96===e.charCodeAt(Vi)?(s=ge,Vi++):(s=n,0===Wi&&es(Yt)),s!==n?(ki=t,t=Hi(i)):(Vi=t,t=n)):(Vi=t,t=n)}else Vi=t,t=n;return t}function za(e,t,r,n,i){const s={type:"binary-expression",location:i,operator:e,left:t,right:r};return void 0!==n&&(s.escape=n),s}function Ha(e,...t){return{type:"expression-list",location:e,value:t}}function Va(e,t){let r=e;for(const{op:e,expr:n,location:{end:i}}of t)r=za(e,r,n,void 0,{...r.location,end:i});return r}if(r=a(),t.peg$library)return{peg$result:r,peg$currPos:Vi,peg$FAILED:n,peg$maxFailExpected:qi,peg$maxFailPos:Zi};if(r!==n&&Vi===e.length)return r;throw r!==n&&Vi<e.length&&es({type:"end"}),function(e,t,r){return new $($.buildMessage(e,t),e,t,r)}(qi,Zi<e.length?e.charAt(Zi):null,Zi<e.length?Ki(Zi,Zi+1):Ki(Zi,Zi))}(e)}}function Q(e,t){if(null!=e)switch(t(e),e.type){case"when-clause":Q(e.operand,t),Q(e.value,t);break;case"case-expression":for(const r of e.clauses)Q(r,t);"simple"===e.format&&Q(e.operand,t),null!==e.else&&Q(e.else,t);break;case"expression-list":for(const r of e.value)Q(r,t);break;case"unary-expression":Q(e.expr,t);break;case"binary-expression":Q(e.left,t),Q(e.right,t);break;case"function":Q(e.args,t);break;case"interval":Q(e.value,t),Q(e.qualifier,t);break;case"interval-qualifier":Q(e.start,t),Q(e.end,t)}}const K=new Set(["current_timestamp","current_date","current_time"]);class ee{static makeBool(e){return re(e)}static featureValue(e,t,r,n){return de(e,t,r,n)}static equalsNull(e){return null===e}static applyLike(e,t,r){return ue(e,t,r)}static ensureArray(e){return ne(e)}static applyIn(e,t,r){return oe(e,t)}static currentTimestamp(e){return b(new Date,e)}static currentDate(e){return a.n.fromNow(e)}static currentTime(e){const t=b(new Date,e);return u.k.fromDateTime(t)}static makeSqlInterval(e,t,r){return l.createFromValueAndQualifier(e,t,r)}static convertInterval(e){return e instanceof l?e.valueInMilliseconds():e}static compare(e,t,r,n){return U(t,r,e)}static calculate(e,t,r,n){return W(e,t,r,n)}static evaluateTime(e){return O(e)}static evaluateTimestamp(e,t,r){return C(e,t,r)}static evaluateDate(e,t){return N(e,t)}static evaluateFunction(e,t,r){return V(e,t,r)}static lookup(e,t){const r=t[e];return void 0===r?null:r}static between(e,t,r){return null==e||null==t[0]||null==t[1]?null:U(e,t[0],">=")&&U(e,t[1],"<=")}static notbetween(e,t,r){return null==e||null==t[0]||null==t[1]?null:U(e,t[0],"<")||U(e,t[1],">")}static ternaryNot(e){return ie(e)}static ternaryAnd(e,t){return se(e,t)}static ternaryOr(e,t){return ae(e,t)}}class te{constructor(e,t,r="UTC",n=null){this.fieldsIndex=t,this.timeZone=r,this.currentUser=n,this.parameters={},this._hasDateFunctions=void 0,this.parseTree=J.parse(e);const{isStandardized:i,isAggregate:s,currentUserRequired:a,referencedFieldNames:o}=this._extractExpressionInfo(t);this._referencedFieldNames=o,this.isStandardized=i,this.isAggregate=s,this.currentUserRequired=a}static convertValueToStorageFormat(e,t=null){if(null===t)return w(e)?e.getTime():I(e)?e.toMillis():M(e)?e.toStorageFormat():R(e)?e.toStorageString():x(e)?e.toStorageFormat():e;switch(t){case"date":return w(e)?e.getTime():I(e)?e.toMillis():M(e)?e.toMilliseconds():x(e)?e.toNumber():e;case"date-only":return w(e)?a.n.fromDateJS(e).toString():M(e)?a.n.fromSqlTimeStampOffset(e).toString():I(e)?a.n.fromDateTime(e).toString():e;case"time-only":return w(e)?u.k.fromDateJS(e).toStorageString():I(e)?u.k.fromDateTime(e).toStorageString():M(e)?u.k.fromSqlTimeStampOffset(e).toStorageString():R(e)?e.toStorageString():e;case"timestamp-offset":if(w(e))return c.g.fromJSDate(e).toStorageFormat();if(I(e))return c.g.fromDateTime(e).toStorageFormat();if(M(e))return e.toStorageFormat()}return e}static create(e,t={}){return new te(e,t.fieldsIndex,t.timeZone??void 0,t.currentUser)}get fieldNames(){return this._referencedFieldNames}testSet(e,t=he,r=this.currentUser){return!!this._evaluateNode(this.parseTree,null,t,e,r)}calculateValue(e,t=he,r=this.currentUser){const n=this._evaluateNode(this.parseTree,e,t,null,r);return n instanceof l?n.valueInMilliseconds()/864e5:n}calculateValueCompiled(e,t=he,r=this.currentUser){return null!=this.parseTree._compiledVersion?this.parseTree._compiledVersion(e,this.parameters,t,this.fieldsIndex,this.timeZone,r??null):(0,i.A)("esri-csp-restrictions")?this.calculateValue(e,t):(this._compileMe(),this.parseTree._compiledVersion(e,this.parameters,t,this.fieldsIndex,this.timeZone,r??null))}testFeature(e,t=he,r=this.currentUser){return!!this._evaluateNode(this.parseTree,e,t,null,r)}testFeatureCompiled(e,t=he,r=this.currentUser){return null!=this.parseTree._compiledVersion?!!this.parseTree._compiledVersion(e,this.parameters,t,this.fieldsIndex,this.timeZone,r??null):(0,i.A)("esri-csp-restrictions")?this.testFeature(e,t):(this._compileMe(),!!this.parseTree._compiledVersion(e,this.parameters,t,this.fieldsIndex,this.timeZone,r??null))}get hasDateFunctions(){return null!=this._hasDateFunctions||(this._hasDateFunctions=!1,Q(this.parseTree,(e=>{"current-time"===e.type?this._hasDateFunctions=!0:"function"===e.type&&(this._hasDateFunctions=this._hasDateFunctions||K.has(e.name.toLowerCase()))}))),this._hasDateFunctions}getFunctions(){const e=new Set;return Q(this.parseTree,(t=>{"function"===t.type&&e.add(t.name.toLowerCase())})),Array.from(e)}getExpressions(){const e=new Map;return Q(this.parseTree,(t=>{if("function"===t.type){const r=t.name.toLowerCase(),n=t.args.value[0];if("column-reference"===n.type){const t=n.column,i=`${r}-${t}`;e.has(i)||e.set(i,{aggregateType:r,field:t})}}})),[...e.values()]}getVariables(){const e=new Set;return Q(this.parseTree,(t=>{"parameter"===t.type&&e.add(t.value.toLowerCase())})),Array.from(e)}_compileMe(){const e="return this.convertInterval("+this.evaluateNodeToJavaScript(this.parseTree)+")";this.parseTree._compiledVersion=new Function("feature","lookups","attributeAdapter","fieldsIndex","timeZone","currentUser",e).bind(ee)}_extractExpressionInfo(e){const t=[],r=new Set;let n=!0,i=!1,a=!1;return Q(this.parseTree,(o=>{switch(o.type){case"column-reference":{const n=e?.get(o.column);let i,s;n?i=s=n.name??"":(s=o.column,i=s.toLowerCase()),r.has(i)||(r.add(i),t.push(s)),o.column=s;break}case"current-user":a=!0;break;case"function":{const{name:e,args:t}=o,r=t.value.length;n&&(n=function(e,t){const r=q[e.toLowerCase()];return null!=r&&t>=r.minParams&&t<=r.maxParams}(e,r)),!1===i&&(i=(0,s.M)(e,r));break}}})),{referencedFieldNames:Array.from(t),isStandardized:n,isAggregate:i,currentUserRequired:a}}evaluateNodeToJavaScript(e){switch(e.type){case"interval":return"this.makeSqlInterval("+this.evaluateNodeToJavaScript(e.value)+", "+JSON.stringify(e.qualifier)+","+JSON.stringify(e.op)+")";case"case-expression":{let t="";if("simple"===e.format){const r=this.evaluateNodeToJavaScript(e.operand);t="( ";for(let n=0;n<e.clauses.length;n++)t+=" (this.compare('=',"+r+","+this.evaluateNodeToJavaScript(e.clauses[n].operand)+") ? ("+this.evaluateNodeToJavaScript(e.clauses[n].value)+") : ";null!==e.else?t+=this.evaluateNodeToJavaScript(e.else):t+="null",t+=" )"}else{t="( ";for(let r=0;r<e.clauses.length;r++)t+=" this.makeBool("+this.evaluateNodeToJavaScript(e.clauses[r].operand)+")===true ? ("+this.evaluateNodeToJavaScript(e.clauses[r].value)+") : ";null!==e.else?t+=this.evaluateNodeToJavaScript(e.else):t+="null",t+=" )"}return t}case"parameter":return"this.lookup("+JSON.stringify(e.value.toLowerCase())+",lookups)";case"expression-list":{let t="[";for(const r of e.value)"["!==t&&(t+=","),t+=this.evaluateNodeToJavaScript(r);return t+="]",t}case"unary-expression":return"this.ternaryNot("+this.evaluateNodeToJavaScript(e.expr)+")";case"binary-expression":switch(e.operator){case"AND":return"this.ternaryAnd("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+" )";case"OR":return"this.ternaryOr("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+" )";case"IS":if("null"!==e.right.type)throw new o.L8(o.Z7.UnsupportedIsRhs);return"this.equalsNull("+this.evaluateNodeToJavaScript(e.left)+")";case"ISNOT":if("null"!==e.right.type)throw new o.L8(o.Z7.UnsupportedIsRhs);return"(!(this.equalsNull("+this.evaluateNodeToJavaScript(e.left)+")))";case"IN":return"this.applyIn("+this.evaluateNodeToJavaScript(e.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(e.right)+"), timeZone)";case"NOT IN":return"this.ternaryNot(this.applyIn("+this.evaluateNodeToJavaScript(e.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(e.right)+"), timeZone))";case"BETWEEN":return"this.between("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+", timeZone)";case"NOTBETWEEN":return"this.notbetween("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+", timeZone)";case"LIKE":return"this.applyLike("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+","+JSON.stringify(e.escape)+")";case"NOT LIKE":return"this.ternaryNot(this.applyLike("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+","+JSON.stringify(e.escape)+"))";case"<>":case"<":case">":case">=":case"<=":case"=":return"this.compare("+JSON.stringify(e.operator)+","+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+", timeZone)";case"*":case"-":case"+":case"/":case"||":return"this.calculate("+JSON.stringify(e.operator)+","+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+", timeZone)";default:throw new o.L8(o.Z7.UnsupportedOperator,{operator:e.operator})}case"null":case"boolean":case"string":case"number":return JSON.stringify(e.value);case"time":return"this.evaluateTime("+JSON.stringify(e.value)+")";case"date":return"this.evaluateDate("+JSON.stringify(e.value)+", 'unknown')";case"timestamp":return"this.evaluateTimestamp("+JSON.stringify(e.value)+", 'unknown')";case"current-time":return"date"===e.mode?"this.currentDate(timeZone)":"time"===e.mode?"this.currentTime(timeZone)":"this.currentTimestamp(timeZone)";case"current-user":return"currentUser";case"column-reference":return"this.featureValue(feature,"+JSON.stringify(e.column)+",fieldsIndex,attributeAdapter)";case"function":return"this.evaluateFunction("+JSON.stringify(e.name)+","+this.evaluateNodeToJavaScript(e.args)+", timeZone)"}throw new o.L8(o.Z7.UnsupportedSyntax,{node:e.type})}_evaluateNode(e,t,r,i,a){let c;switch(e.type){case"interval":{const n=this._evaluateNode(e.value,t,r,i,a);return l.createFromValueAndQualifier(n,e.qualifier,e.op)}case"case-expression":if("simple"===e.format){const n=this._evaluateNode(e.operand,t,r,i,a);for(let s=0;s<e.clauses.length;s++)if(U(n,this._evaluateNode(e.clauses[s].operand,t,r,i,a),"=",this.timeZone))return this._evaluateNode(e.clauses[s].value,t,r,i,a);if(null!==e.else)return this._evaluateNode(e.else,t,r,i,a)}else{for(let n=0;n<e.clauses.length;n++)if(re(this._evaluateNode(e.clauses[n].operand,t,r,i,a)))return this._evaluateNode(e.clauses[n].value,t,r,i,a);if(null!==e.else)return this._evaluateNode(e.else,t,r,i,a)}return null;case"parameter":return c=this.parameters[e.value.toLowerCase()],w(c)?h.c9.fromJSDate(c):c instanceof n.lY?c.toDateTime():c;case"expression-list":{const n=[];for(const s of e.value)n.push(this._evaluateNode(s,t,r,i,a));return n}case"unary-expression":return ie(this._evaluateNode(e.expr,t,r,i,a));case"binary-expression":switch(e.operator){case"AND":return se(this._evaluateNode(e.left,t,r,i,a),this._evaluateNode(e.right,t,r,i,a));case"OR":return ae(this._evaluateNode(e.left,t,r,i,a),this._evaluateNode(e.right,t,r,i,a));case"IS":if("null"!==e.right.type)throw new o.L8(o.Z7.UnsupportedIsRhs);return null===this._evaluateNode(e.left,t,r,i,a);case"ISNOT":if("null"!==e.right.type)throw new o.L8(o.Z7.UnsupportedIsRhs);return null!==this._evaluateNode(e.left,t,r,i,a);case"IN":{const n=ne(this._evaluateNode(e.right,t,r,i,a));return oe(this._evaluateNode(e.left,t,r,i,a),n,this.timeZone)}case"NOT IN":{const n=ne(this._evaluateNode(e.right,t,r,i,a));return ie(oe(this._evaluateNode(e.left,t,r,i,a),n,this.timeZone))}case"BETWEEN":{const n=this._evaluateNode(e.left,t,r,i,a),s=this._evaluateNode(e.right,t,r,i,a);return null==n||null==s[0]||null==s[1]?null:U(n,s[0],">=",this.timeZone)&&U(n,s[1],"<=",this.timeZone)}case"NOTBETWEEN":{const n=this._evaluateNode(e.left,t,r,i,a),s=this._evaluateNode(e.right,t,r,i,a);return null==n||null==s[0]||null==s[1]?null:U(n,s[0],"<",this.timeZone)||U(n,s[1],">",this.timeZone)}case"LIKE":return ue(this._evaluateNode(e.left,t,r,i,a),this._evaluateNode(e.right,t,r,i,a),e.escape);case"NOT LIKE":return ie(ue(this._evaluateNode(e.left,t,r,i,a),this._evaluateNode(e.right,t,r,i,a),e.escape));case"<>":case"<":case">":case">=":case"<=":case"=":return U(this._evaluateNode(e.left,t,r,i,a),this._evaluateNode(e.right,t,r,i,a),e.operator,this.timeZone);case"-":case"+":case"*":case"/":case"||":return W(e.operator,this._evaluateNode(e.left,t,r,i,a),this._evaluateNode(e.right,t,r,i,a),this.timeZone)}case"null":case"boolean":case"string":case"number":return e.value;case"date":return e.parsedValue??=N(e.value,"unknown"),e.parsedValue;case"timestamp":return e.parsedValue??=C(e.value,"unknown"),e.parsedValue;case"time":return O(e.value);case"current-time":return"date"===e.mode?ee.currentDate(this.timeZone):"time"===e.mode?ee.currentTime(this.timeZone):ee.currentTimestamp(this.timeZone);case"current-user":return a??null;case"column-reference":return de(t,e.column,this.fieldsIndex,r);case"data-type":return e.value;case"function":{if(this.isAggregate&&(0,s.M)(e.name,e.args.value.length)){const t=[];for(const n of e.args?.value||[]){const e=[];for(const t of i||[])e.push(this._evaluateNode(n,t,r,null,a));t.push(e)}return(0,s.s)(e.name,t)}const n=this._evaluateNode(e.args,t,r,i,a);return V(e.name,n,this.timeZone)}}throw new o.L8(o.Z7.UnsupportedSyntax,{node:e.type})}}function re(e){return!0===e}function ne(e){return Array.isArray(e)?e:[e]}function ie(e){return null!==e?!0!==e:null}function se(e,t){return null!=e&&null!=t?!0===e&&!0===t:!1!==e&&!1!==t&&null}function ae(e,t){return null!=e&&null!=t?!0===e||!0===t:!0===e||!0===t||null}function oe(e,t,r){if(null==e)return null;let n=!1;for(const r of t)if(null==r)n=null;else{if(e===r){n=!0;break}if(P(e)&&P(r)&&(n=U(e,r,"="),n))break}return n}const le="-[]/{}()*+?.\\^$|";var ce;function ue(e,t,r){return null==e?null:function(e,t){const r=t;let n="",i=ce.Normal;for(let t=0;t<e.length;t++){const s=e.charAt(t);switch(i){case ce.Normal:s===r?i=ce.Escaped:le.includes(s)?n+="\\"+s:n+="%"===s?".*":"_"===s?".":s;break;case ce.Escaped:le.includes(s)?n+="\\"+s:n+=s,i=ce.Normal}}return new RegExp("^"+n+"$","m")}(t,r).test(e)}function de(e,t,r,n){const i=n.getAttribute(e,t),s=r?.get(t);return null==i||"esriFieldTypeDate"!==s?.type&&"date"!==s?.type?null==i||"esriFieldTypeDateOnly"!==s?.type&&"date-only"!==s?.type?null==i||"esriFieldTypeTimeOnly"!==s?.type&&"time-only"!==s?.type?null==i||"esriFieldTypeTimestampOffset"!==s?.type&&"timestamp-offset"!==s?.type?i:new c.g(i):u.k.fromReader(i):a.n.fromReader(i):b(new Date(i),r?.getLuxonTimeZone(s.name)??h.mQ.utcInstance)}!function(e){e[e.Normal=0]="Normal",e[e.Escaped=1]="Escaped"}(ce||(ce={}));const he={getAttribute:(e,t)=>(function(e){return e&&"object"==typeof e.attributes}(e)?e.attributes:e)[t]}},93393:function(e,t,r){r.d(t,{L8:function(){return o},Z7:function(){return n}});var n,i,s=r(50944);(i=n||(n={})).InvalidFunctionParameters="InvalidFunctionParameters",i.InvalidValueForAggregateFunction="InvalidValueForAggregateFunction",i.UnsupportedSqlFunction="UnsupportedSqlFunction",i.UnsupportedOperator="UnsupportedOperator",i.UnsupportedSyntax="UnsupportedSyntax",i.UnsupportedIsRhs="UnsupportedIsRhs",i.UnsupportedIsLhs="UnsupportedIsLhs",i.InvalidDataType="InvalidDataType",i.CannotCastValue="CannotCastValue",i.FunctionNotRecognized="FunctionNotRecognized",i.InvalidTime="InvalidTime",i.InvalidParameterCount="InvalidParameterCount",i.InvalidTimeStamp="InvalidTimeStamp",i.InvalidDate="InvalidDate",i.InvalidOperator="InvalidOperator",i.IllegalInterval="IllegalInterval",i.YearMonthIntervals="YearMonthIntervals",i.PrimarySecondaryQualifiers="PrimarySecondaryQualifiers",i.MissingStatisticParameters="MissingStatisticParameters";const a={[n.InvalidValueForAggregateFunction]:"Invalid value used in aggregate function",[n.MissingStatisticParameters]:"Statistic does not have 1 or 0 Parameters",[n.InvalidFunctionParameters]:"Invalid parameters for call to {function}",[n.UnsupportedIsLhs]:"Unsupported left hand expression in is statement",[n.UnsupportedIsRhs]:"Unsupported right hand expression in is statement",[n.UnsupportedOperator]:"Unsupported operator - {operator}",[n.UnsupportedSyntax]:"Unsupported syntax - {node}",[n.UnsupportedSqlFunction]:"Sql function not found = {function}",[n.InvalidDataType]:"Invalid sql data type",[n.InvalidDate]:"Invalid date encountered",[n.InvalidOperator]:"Invalid operator encountered",[n.InvalidTime]:"Invalid time encountered",[n.IllegalInterval]:"Illegal interval",[n.FunctionNotRecognized]:"Function not recognized",[n.InvalidTimeStamp]:"Invalid timestamp encountered",[n.InvalidParameterCount]:"Invalid parameter count for call to {name}",[n.PrimarySecondaryQualifiers]:"Primary and Secondary SqlInterval qualifiers not supported",[n.YearMonthIntervals]:"Year-Month Intervals not supported",[n.CannotCastValue]:"Cannot cast value to the required data type"};class o extends Error{constructor(e,t){super((0,s.HC)(a[e],t)),this.declaredRootClass="esri.arcade.featureset.support.sqlerror",Error.captureStackTrace&&Error.captureStackTrace(this,o)}}},86029:function(e,t,r){r.d(t,{g:function(){return n}});const n={convertToGEGeometry:function(e,t){return null==t?null:e.convertJSONToGeometry(t)},exportPoint:function(e,t,r){const n=new i(e.getPointX(t),e.getPointY(t),r),s=e.hasZ(t),a=e.hasM(t);return s&&(n.z=e.getPointZ(t)),a&&(n.m=e.getPointM(t)),n},exportPolygon:function(e,t,r){return new s(e.exportPaths(t),r,e.hasZ(t),e.hasM(t))},exportPolyline:function(e,t,r){return new a(e.exportPaths(t),r,e.hasZ(t),e.hasM(t))},exportMultipoint:function(e,t,r){return new o(e.exportPoints(t),r,e.hasZ(t),e.hasM(t))},exportExtent:function(e,t,r){const n=e.hasZ(t),i=e.hasM(t),s=new l(e.getXMin(t),e.getYMin(t),e.getXMax(t),e.getYMax(t),r);if(n){const r=e.getZExtent(t);s.zmin=r.vmin,s.zmax=r.vmax}if(i){const r=e.getMExtent(t);s.mmin=r.vmin,s.mmax=r.vmax}return s}};class i{constructor(e,t,r){this.x=e,this.y=t,this.spatialReference=r,this.z=void 0,this.m=void 0}}class s{constructor(e,t,r,n){this.rings=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,r&&(this.hasZ=r),n&&(this.hasM=n)}}class a{constructor(e,t,r,n){this.paths=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,r&&(this.hasZ=r),n&&(this.hasM=n)}}class o{constructor(e,t,r,n){this.points=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,r&&(this.hasZ=r),n&&(this.hasM=n)}}class l{constructor(e,t,r,n,i){this.xmin=e,this.ymin=t,this.xmax=r,this.ymax=n,this.spatialReference=i,this.zmin=void 0,this.zmax=void 0,this.mmin=void 0,this.mmax=void 0}}},7456:function(e,t,r){r.d(t,{l:function(){return c}});var n=r(15774),i=r(73364),s=r(32501),a=r(46098),o=r(61441),l=r(57652);function c(e,t,r,n){if(null==e||null==n)return!1;const s=(0,o.Qk)(e,o.Wv),c=(0,o.Qk)(n,o.zp);if(s===c&&!u(c)&&(s!==o.rz.UNKNOWN||(0,l.aI)(e,n)))return(0,i.kN)(r,t),!0;if(u(c)){const e=o.w5[s][o.rz.LON_LAT],n=o.w5[o.rz.LON_LAT][c];return null!=e&&null!=n&&(e(t,0,h,0),n(h,0,f,0),(0,a.z)(d*h[0],d*h[1],r),r[12]=f[0],r[13]=f[1],r[14]=f[2],!0)}const p=u(s);if((c===o.rz.WEB_MERCATOR||c===o.rz.PLATE_CARREE||c===o.rz.WGS84||c===o.rz.CGCS2000)&&(s===o.rz.WGS84||p||s===o.rz.WEB_MERCATOR||s===o.rz.CGCS2000)){const e=o.w5[s][o.rz.LON_LAT],n=o.w5[o.rz.LON_LAT][c];return null!=e&&null!=n&&(e(t,0,h,0),n(h,0,f,0),p?(0,a.Z)(d*h[0],d*h[1],r):(0,i.D_)(r),r[12]=f[0],r[13]=f[1],r[14]=f[2],!0)}return!1}function u(e){return e===o.rz.SPHERICAL_ECEF||e===o.rz.SPHERICAL_MARS_PCPF||e===o.rz.SPHERICAL_MOON_PCPF||e===o.rz.WGS84_ECEF}const d=(0,n.kU)(1),h=(0,s.vt)(),f=(0,s.vt)()},46098:function(e,t,r){r.d(t,{Z:function(){return s},z:function(){return i}});var n=r(73364);function i(e,t,r){const n=Math.sin(e),i=Math.cos(e),s=Math.sin(t),a=Math.cos(t),o=r;return o[0]=-n,o[4]=-s*i,o[8]=a*i,o[12]=0,o[1]=i,o[5]=-s*n,o[9]=a*n,o[13]=0,o[2]=0,o[6]=a,o[10]=s,o[14]=0,o[3]=0,o[7]=0,o[11]=0,o[15]=1,o}function s(e,t,r){return i(e,t,r),(0,n.mg)(r,r),r}},56763:function(e,t,r){r.d(t,{W:function(){return o},g:function(){return a}});var n=r(32501),i=r(46157),s=r(57617);function a(e,t,r,n){if((0,i.canProjectWithoutEngine)(e.spatialReference,r)){l[0]=e.x,l[1]=e.y;const i=e.z;return l[2]=i??n??0,(0,s.projectBuffer)(l,e.spatialReference,0,t,r,0)}const a=(0,i.tryProjectWithZConversion)(e,r);return!!a&&(t[0]=a?.x,t[1]=a?.y,t[2]=a?.z??n??0,!0)}async function o(e,t,r,n,s){return await(0,i.initializeProjection)(e.spatialReference,r,null,s),a(e,t,r,n)}const l=(0,n.vt)()},56919:function(e,t,r){r.d(t,{E:function(){return s}});var n=r(32501),i=(r(46157),r(68734));function s(e,t,r){return!!(0,i.F)(e,t,a,r.spatialReference)&&(r.x=a[0],r.y=a[1],r.z=a[2],!0)}const a=(0,n.vt)()},68734:function(e,t,r){r.d(t,{F:function(){return s}}),r(46157);var n=r(57165),i=r(56763);function s(e,t,r,n,s){return!(null==t||null==n||e.length<2)&&(a.x=e[0],a.y=e[1],a.z=e[2],a.spatialReference=t,(0,i.g)(a,r,n,s))}const a=(0,r(46460).T)(0,0,0,n.A.WGS84)},96611:function(e,t,r){r.d(t,{Y0:function(){return c},lO:function(){return u}});var n=r(61714),i=r(57165),s=r(57652);const a=new i.A(n.fv),o=new i.A(n.FY),l=new i.A(n.LJ),c=new i.A(n.Ro);function u(e){const t=d.get(e);if(t)return t;let r=a;if(e)if(e===o)r=o;else if(e===l)r=l;else{const t=e.wkid,n=e.latestWkid;if(null!=t||null!=n)(0,s.tl)(t)||(0,s.tl)(n)?r=o:((0,s.ZL)(t)||(0,s.ZL)(n))&&(r=l);else{const t=e.wkt2??e.wkt;if(t){const e=t.toUpperCase();e===h?r=o:e===f&&(r=l)}}}return d.set(e,r),r}const d=new Map,h=o.wkt.toUpperCase(),f=l.wkt.toUpperCase()},5047:function(e,t,r){r.d(t,{AK:function(){return a},Wz:function(){return s},oe:function(){return i}});var n=r(24540);function i(e,t=!1){return e<=n.y9?t?new Array(e).fill(0):new Array(e):new Float32Array(e)}function s(e){return((0,n.cy)(e)?e.length:e.byteLength/8)<=n.y9?Array.from(e):new Float32Array(e)}function a(e,t,r){return Array.isArray(e)?e.slice(t,t+r):e.subarray(t,t+r)}},37819:function(e,t,r){r.d(t,{Dg:function(){return i},EH:function(){return h},JH:function(){return a},my:function(){return s},tM:function(){return u}});var n=r(24540);function i(e){if((0,n.cy)(e)){if(e.length<n.y9)return e}else if(e.length<n.y9)return Array.from(e);let t=!0,r=!0;return e.some(((e,n)=>(t=t&&0===e,r=r&&e===n,!t&&!r))),t?h(e.length):r?u(e.length):(0,n.cy)(e)||e.BYTES_PER_ELEMENT!==Uint16Array.BYTES_PER_ELEMENT?function(e){let t=!0;for(const r of e){if(r>=65536)return(0,n.cy)(e)?new Uint32Array(e):e;r>=256&&(t=!1)}return t?new Uint8Array(e):new Uint16Array(e)}(e):e}function s(e){return e<=n.y9?new Array(e):e<=65536?new Uint16Array(e):new Uint32Array(e)}function a(e){return e<=n.y9?new Array(e):new Uint32Array(e)}let o=(()=>{const e=new Uint32Array(131072);for(let t=0;t<e.length;++t)e[t]=t;return e})();const l=[0],c=(()=>{const e=new Uint16Array(65536);for(let t=0;t<e.length;++t)e[t]=t;return e})();function u(e){if(1===e)return l;if(e<n.y9)return Array.from(new Uint16Array(c.buffer,0,e));if(e<c.length)return new Uint16Array(c.buffer,0,e);if(e>o.length){const t=Math.max(2*o.length,e);o=new Uint32Array(t);for(let e=0;e<o.length;e++)o[e]=e}return new Uint32Array(o.buffer,0,e)}let d=new Uint8Array(65536);function h(e){if(1===e)return l;if(e<n.y9)return new Array(e).fill(0);if(e>d.length){const t=Math.max(2*d.length,e);d=new Uint8Array(t)}return new Uint8Array(d.buffer,0,e)}},65907:function(e,t,r){r.d(t,{A:function(){return d}});var n,i=r(53804),s=r(75743),a=r(30905),o=r(23502),l=(r(58941),r(40633),r(13798),r(74376)),c=r(65953);let u=n=class extends((0,s.O)(a.oY)){constructor(e){super(e),this.type="georeferenced",this.origin=null}};u.absolute=new n,(0,i._)([(0,l.e)({georeferenced:"georeferenced"},{readOnly:!0})],u.prototype,"type",void 0),(0,i._)([(0,o.MZ)({type:[Number],nonNullable:!1,json:{write:!0}})],u.prototype,"origin",void 0),u=n=(0,i._)([(0,c.$)("esri.geometry.support.MeshGeoreferencedVertexSpace")],u);const d=u},20460:function(e,t,r){r.d(t,{A:function(){return d}});var n=r(53804),i=r(75743),s=r(30905),a=r(23502),o=(r(58941),r(40633),r(13798),r(74376)),l=r(65953),c=r(32501);let u=class extends((0,i.O)(s.oY)){constructor(e){super(e),this.type="local",this.origin=(0,c.vt)()}};(0,n._)([(0,o.e)({local:"local"},{readOnly:!0})],u.prototype,"type",void 0),(0,n._)([(0,a.MZ)({type:[Number],nonNullable:!0,json:{write:!0}})],u.prototype,"origin",void 0),u=(0,n._)([(0,l.$)("esri.geometry.support.MeshLocalVertexSpace")],u);const d=u},92754:function(e,t,r){r.d(t,{Y$:function(){return h},qB:function(){return T},Qt:function(){return z},My:function(){return j},bf:function(){return P},jZ:function(){return g},j0:function(){return _},Sx:function(){return y},E$:function(){return v},h:function(){return R},P:function(){return N},SL:function(){return E},gH:function(){return f},si:function(){return b},mJ:function(){return H},UL:function(){return Z},D6:function(){return B},Yi:function(){return M},An:function(){return L},LC:function(){return w},xs:function(){return p},Xm:function(){return S},Vp:function(){return V},zD:function(){return q},m8:function(){return U},nS:function(){return O},H$:function(){return F},eI:function(){return I},Eq:function(){return m},Aj:function(){return A},E7:function(){return k},Y4:function(){return W},TX:function(){return G},Uz:function(){return C},ml:function(){return D},XP:function(){return x}});class n{constructor(e,t,r=0,n,i){this.TypedArrayConstructor=e,this.elementCount=9;const s=this.TypedArrayConstructor;void 0===n&&(n=9*s.BYTES_PER_ELEMENT);const a=0===t.byteLength?0:r;this.typedBuffer=null==i?new s(t,a):new s(t,a,(i-r)/s.BYTES_PER_ELEMENT),this.typedBufferStride=n/s.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,r=this.count-t){const n=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,n,this.stride,n+r*this.stride)}getMat(e,t){let r=e*this.typedBufferStride;for(let e=0;e<9;e++)t[e]=this.typedBuffer[r++];return t}setMat(e,t){let r=e*this.typedBufferStride;for(let e=0;e<9;e++)this.typedBuffer[r++]=t[e]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,r){this.typedBuffer[e*this.typedBufferStride+t]=r}copyFrom(e,t,r){const n=this.typedBuffer,i=t.typedBuffer;let s=e*this.typedBufferStride,a=r*t.typedBufferStride;for(let e=0;e<9;++e)n[s++]=i[a++]}get buffer(){return this.typedBuffer.buffer}}n.ElementCount=9;class i{constructor(e,t,r=0,n,i){this.TypedArrayConstructor=e,this.elementCount=16;const s=this.TypedArrayConstructor;void 0===n&&(n=16*s.BYTES_PER_ELEMENT);const a=0===t.byteLength?0:r;this.typedBuffer=null==i?new s(t,a):new s(t,a,(i-r)/s.BYTES_PER_ELEMENT),this.typedBufferStride=n/s.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,r=this.count-t){const n=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,n,this.stride,n+r*this.stride)}getMat(e,t){let r=e*this.typedBufferStride;for(let e=0;e<16;e++)t[e]=this.typedBuffer[r++];return t}setMat(e,t){let r=e*this.typedBufferStride;for(let e=0;e<16;e++)this.typedBuffer[r++]=t[e]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,r){this.typedBuffer[e*this.typedBufferStride+t]=r}copyFrom(e,t,r){this.copyFromTypedBuffer(e,t.typedBuffer,r*t.typedBufferStride)}copyFromTypedBuffer(e,t,r){const n=this.typedBuffer;let i=e*this.typedBufferStride;for(let e=0;e<16;++e)n[i++]=t[r++]}get buffer(){return this.typedBuffer.buffer}}i.ElementCount=16;class s{constructor(e,t,r=0,n,i){this.TypedArrayConstructor=e,this.elementCount=1;const s=this.TypedArrayConstructor;void 0===n&&(n=s.BYTES_PER_ELEMENT);const a=0===t.byteLength?0:r;this.typedBuffer=null==i?new s(t,a):new s(t,a,(i-r)/s.BYTES_PER_ELEMENT),this.stride=n,this.typedBufferStride=n/s.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride)}sliceBuffer(e,t,r=this.count-t){const n=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,n,this.stride,n+r*this.stride)}get(e){return this.typedBuffer[e*this.typedBufferStride]}set(e,t){this.typedBuffer[e*this.typedBufferStride]=t}get buffer(){return this.typedBuffer.buffer}}s.ElementCount=1;var a=r(13786);class o{constructor(e,t,r=0,n,i){this.TypedArrayConstructor=e,this.elementCount=2;const s=this.TypedArrayConstructor;void 0===n&&(n=2*s.BYTES_PER_ELEMENT);const a=0===t.byteLength?0:r;this.typedBuffer=null==i?new s(t,a):new s(t,a,(i-r)/s.BYTES_PER_ELEMENT),this.typedBufferStride=n/s.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,r=this.count-t){const n=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,n,this.stride,n+r*this.stride)}getVec(e,t){return e*=this.typedBufferStride,(0,a.hZ)(t,this.typedBuffer[e],this.typedBuffer[e+1])}setVec(e,t){e*=this.typedBufferStride,this.typedBuffer[e++]=t[0],this.typedBuffer[e]=t[1]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,r){this.typedBuffer[e*this.typedBufferStride+t]=r}setValues(e,t,r){e*=this.typedBufferStride,this.typedBuffer[e++]=t,this.typedBuffer[e]=r}copyFrom(e,t,r){const n=this.typedBuffer,i=t.typedBuffer;let s=e*this.typedBufferStride,a=r*t.typedBufferStride;n[s++]=i[a++],n[s]=i[a]}get buffer(){return this.typedBuffer.buffer}}o.ElementCount=2;var l=r(20551);class c{constructor(e,t,r=0,n,i){this.TypedArrayConstructor=e,this.elementCount=3;const s=this.TypedArrayConstructor;void 0===n&&(n=3*s.BYTES_PER_ELEMENT);const a=0===t.byteLength?0:r;this.typedBuffer=null==i?new s(t,a):new s(t,a,(i-r)/s.BYTES_PER_ELEMENT),this.typedBufferStride=n/s.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,r=this.count-t){const n=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,n,this.stride,n+r*this.stride)}getVec(e,t){return e*=this.typedBufferStride,(0,l.i)(t,this.typedBuffer[e],this.typedBuffer[e+1],this.typedBuffer[e+2])}setVec(e,t){e*=this.typedBufferStride,this.typedBuffer[e++]=t[0],this.typedBuffer[e++]=t[1],this.typedBuffer[e]=t[2]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,r){this.typedBuffer[e*this.typedBufferStride+t]=r}setValues(e,t,r,n){e*=this.typedBufferStride,this.typedBuffer[e++]=t,this.typedBuffer[e++]=r,this.typedBuffer[e]=n}copyFrom(e,t,r){const n=this.typedBuffer,i=t.typedBuffer;let s=e*this.typedBufferStride,a=r*t.typedBufferStride;n[s++]=i[a++],n[s++]=i[a++],n[s]=i[a]}get buffer(){return this.typedBuffer.buffer}}c.ElementCount=3;var u=r(33400);class d{constructor(e,t,r=0,n,i){this.TypedArrayConstructor=e,this.start=r,this.elementCount=4;const s=this.TypedArrayConstructor;void 0===n&&(n=4*s.BYTES_PER_ELEMENT);const a=0===t.byteLength?0:r;this.typedBuffer=null==i?new s(t,a):new s(t,a,(i-r)/s.BYTES_PER_ELEMENT),this.typedBufferStride=n/s.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,r=this.count-t){const n=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,n,this.stride,n+r*this.stride)}getVec(e,t){return e*=this.typedBufferStride,(0,u.s)(t,this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e])}setVec(e,t){e*=this.typedBufferStride,this.typedBuffer[e++]=t[0],this.typedBuffer[e++]=t[1],this.typedBuffer[e++]=t[2],this.typedBuffer[e]=t[3]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,r){this.typedBuffer[e*this.typedBufferStride+t]=r}setValues(e,t,r,n,i){e*=this.typedBufferStride,this.typedBuffer[e++]=t,this.typedBuffer[e++]=r,this.typedBuffer[e++]=n,this.typedBuffer[e]=i}copyFrom(e,t,r){const n=this.typedBuffer,i=t.typedBuffer;let s=e*this.typedBufferStride,a=r*t.typedBufferStride;n[s++]=i[a++],n[s++]=i[a++],n[s++]=i[a++],n[s]=i[a]}get buffer(){return this.typedBuffer.buffer}}d.ElementCount=4;class h extends s{constructor(e,t=0,r,n){super(Float32Array,e,t,r,n),this.elementType="f32"}static fromTypedArray(e,t){return new h(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}h.ElementType="f32";class f extends o{constructor(e,t=0,r,n){super(Float32Array,e,t,r,n),this.elementType="f32"}slice(e,t){return this.sliceBuffer(f,e,t)}static fromTypedArray(e,t){return new f(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}f.ElementType="f32";class p extends c{constructor(e,t=0,r,n){super(Float32Array,e,t,r,n),this.elementType="f32"}slice(e,t){return this.sliceBuffer(p,e,t)}static fromTypedArray(e,t){return new p(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}p.ElementType="f32";class m extends d{constructor(e,t=0,r,n){super(Float32Array,e,t,r,n),this.elementType="f32"}slice(e,t){return this.sliceBuffer(m,e,t)}static fromTypedArray(e,t){return new m(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}m.ElementType="f32";class g extends n{constructor(e,t=0,r,n){super(Float32Array,e,t,r,n),this.elementType="f32"}slice(e,t){return this.sliceBuffer(g,e,t)}static fromTypedArray(e,t){return new g(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}g.ElementType="f32";class _ extends n{constructor(e,t=0,r,n){super(Float64Array,e,t,r,n),this.elementType="f64"}slice(e,t){return this.sliceBuffer(_,e,t)}static fromTypedArray(e,t){return new _(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}_.ElementType="f64";class y extends i{constructor(e,t=0,r,n){super(Float32Array,e,t,r,n),this.elementType="f32"}slice(e,t){return this.sliceBuffer(y,e,t)}static fromTypedArray(e,t){return new y(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}y.ElementType="f32";class v extends i{constructor(e,t=0,r,n){super(Float64Array,e,t,r,n),this.elementType="f64"}slice(e,t){return this.sliceBuffer(v,e,t)}static fromTypedArray(e,t){return new v(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}v.ElementType="f64";class T extends s{constructor(e,t=0,r,n){super(Float64Array,e,t,r,n),this.elementType="f64"}slice(e,t){return this.sliceBuffer(T,e,t)}static fromTypedArray(e,t){return new T(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}T.ElementType="f64";class b extends o{constructor(e,t=0,r,n){super(Float64Array,e,t,r,n),this.elementType="f64"}slice(e,t){return this.sliceBuffer(b,e,t)}static fromTypedArray(e,t){return new b(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}b.ElementType="f64";class S extends c{constructor(e,t=0,r,n){super(Float64Array,e,t,r,n),this.elementType="f64"}slice(e,t){return this.sliceBuffer(S,e,t)}static fromTypedArray(e,t){return new S(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}S.ElementType="f64";class A extends d{constructor(e,t=0,r,n){super(Float64Array,e,t,r,n),this.elementType="f64"}slice(e,t){return this.sliceBuffer(A,e,t)}static fromTypedArray(e,t){return new A(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}A.ElementType="f64";class E extends s{constructor(e,t=0,r,n){super(Uint8Array,e,t,r,n),this.elementType="u8"}slice(e,t){return this.sliceBuffer(E,e,t)}static fromTypedArray(e,t){return new E(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}E.ElementType="u8";class w extends o{constructor(e,t=0,r,n){super(Uint8Array,e,t,r,n),this.elementType="u8"}slice(e,t){return this.sliceBuffer(w,e,t)}static fromTypedArray(e,t){return new w(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}w.ElementType="u8";class I extends c{constructor(e,t=0,r,n){super(Uint8Array,e,t,r,n),this.elementType="u8"}slice(e,t){return this.sliceBuffer(I,e,t)}static fromTypedArray(e,t){return new I(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}I.ElementType="u8";class x extends d{constructor(e,t=0,r,n){super(Uint8Array,e,t,r,n),this.elementType="u8"}slice(e,t){return this.sliceBuffer(x,e,t)}static fromTypedArray(e,t){return new x(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}x.ElementType="u8";class R extends s{constructor(e,t=0,r,n){super(Uint16Array,e,t,r,n),this.elementType="u16"}slice(e,t){return this.sliceBuffer(R,e,t)}static fromTypedArray(e,t){return new R(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}R.ElementType="u16";class M extends o{constructor(e,t=0,r,n){super(Uint16Array,e,t,r,n),this.elementType="u16"}slice(e,t){return this.sliceBuffer(M,e,t)}static fromTypedArray(e,t){return new M(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}M.ElementType="u16";class O extends c{constructor(e,t=0,r,n){super(Uint16Array,e,t,r,n),this.elementType="u16"}slice(e,t){return this.sliceBuffer(O,e,t)}static fromTypedArray(e,t){return new O(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}O.ElementType="u16";class C extends d{constructor(e,t=0,r,n){super(Uint16Array,e,t,r,n),this.elementType="u16"}slice(e,t){return this.sliceBuffer(C,e,t)}static fromTypedArray(e,t){return new C(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}C.ElementType="u16";class N extends s{constructor(e,t=0,r,n){super(Uint32Array,e,t,r,n),this.elementType="u32"}slice(e,t){return this.sliceBuffer(N,e,t)}static fromTypedArray(e,t){return new N(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}N.ElementType="u32";class L extends o{constructor(e,t=0,r,n){super(Uint32Array,e,t,r,n),this.elementType="u32"}slice(e,t){return this.sliceBuffer(L,e,t)}static fromTypedArray(e,t){return new L(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}L.ElementType="u32";class F extends c{constructor(e,t=0,r,n){super(Uint32Array,e,t,r,n),this.elementType="u32"}slice(e,t){return this.sliceBuffer(F,e,t)}static fromTypedArray(e,t){return new F(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}F.ElementType="u32";class D extends d{constructor(e,t=0,r,n){super(Uint32Array,e,t,r,n),this.elementType="u32"}slice(e,t){return this.sliceBuffer(D,e,t)}static fromTypedArray(e,t){return new D(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}D.ElementType="u32";class P extends s{constructor(e,t=0,r,n){super(Int8Array,e,t,r,n),this.elementType="i8"}slice(e,t){return this.sliceBuffer(P,e,t)}static fromTypedArray(e,t){return new P(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}P.ElementType="i8";class B extends o{constructor(e,t=0,r,n){super(Int8Array,e,t,r,n),this.elementType="i8"}slice(e,t){return this.sliceBuffer(B,e,t)}static fromTypedArray(e,t){return new B(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}B.ElementType="i8";class U extends c{constructor(e,t=0,r,n){super(Int8Array,e,t,r,n),this.elementType="i8"}slice(e,t){return this.sliceBuffer(U,e,t)}static fromTypedArray(e,t){return new U(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}U.ElementType="i8";class G extends d{constructor(e,t=0,r,n){super(Int8Array,e,t,r,n),this.elementType="i8"}slice(e,t){return this.sliceBuffer(G,e,t)}static fromTypedArray(e,t){return new G(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}G.ElementType="i8";class z extends s{constructor(e,t=0,r,n){super(Int16Array,e,t,r,n),this.elementType="i16"}slice(e,t){return this.sliceBuffer(z,e,t)}static fromTypedArray(e,t){return new z(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}z.ElementType="i16";class H extends o{constructor(e,t=0,r,n){super(Int16Array,e,t,r,n),this.elementType="i16"}slice(e,t){return this.sliceBuffer(H,e,t)}static fromTypedArray(e,t){return new H(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}H.ElementType="i16";class V extends c{constructor(e,t=0,r,n){super(Int16Array,e,t,r,n),this.elementType="i16"}slice(e,t){return this.sliceBuffer(V,e,t)}static fromTypedArray(e,t){return new V(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}V.ElementType="i16";class k extends d{constructor(e,t=0,r,n){super(Int16Array,e,t,r,n),this.elementType="i16"}slice(e,t){return this.sliceBuffer(k,e,t)}static fromTypedArray(e,t){return new k(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}k.ElementType="i16";class j extends s{constructor(e,t=0,r,n){super(Int32Array,e,t,r,n),this.elementType="i32"}slice(e,t){return this.sliceBuffer(j,e,t)}static fromTypedArray(e,t){return new j(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}j.ElementType="i32";class Z extends o{constructor(e,t=0,r,n){super(Int32Array,e,t,r,n),this.elementType="i32"}slice(e,t){return this.sliceBuffer(Z,e,t)}static fromTypedArray(e,t){return new Z(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}Z.ElementType="i32";class q extends c{constructor(e,t=0,r,n){super(Int32Array,e,t,r,n),this.elementType="i32"}slice(e,t){return this.sliceBuffer(q,e,t)}static fromTypedArray(e,t){return new q(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}q.ElementType="i32";class W extends d{constructor(e,t=0,r,n){super(Int32Array,e,t,r,n),this.elementType="i32"}slice(e,t){return this.sliceBuffer(W,e,t)}static fromTypedArray(e,t){return new W(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}W.ElementType="i32"},28404:function(e,t,r){function n(e){switch(e){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8}}r.d(t,{GJ:function(){return n}})},91912:function(e,t,r){r.d(t,{$e:function(){return o},j1:function(){return l},mO:function(){return c},vt:function(){return a}});var n=r(89736),i=r(20551),s=r(79578);function a(e){return e?{ray:(0,s.vt)(e.ray),c0:e.c0,c1:e.c1}:{ray:(0,s.vt)(),c0:0,c1:Number.MAX_VALUE}}function o(e,t=a()){return(0,s.C)(e,t.ray),t.c0=0,t.c1=Number.MAX_VALUE,t}function l(e,t){return u(e,e.c0,t)}function c(e,t){return u(e,e.c1,t)}function u(e,t,r){return(0,i.g)(r,e.ray.origin,(0,i.h)(r,e.ray.direction,t))}new n.I((()=>a()))},69508:function(e,t,r){r.d(t,{C:function(){return g},FB:function(){return n},ig:function(){return v},m7:function(){return y},ui:function(){return _},vt:function(){return m}});var n,i,s,a=r(89736),o=r(73364),l=r(20551),c=r(32501),u=r(33400),d=r(41546),h=r(91912),f=r(5596),p=r(50973);function m(e){return e?[(0,f.vt)(e[0]),(0,f.vt)(e[1]),(0,f.vt)(e[2]),(0,f.vt)(e[3]),(0,f.vt)(e[4]),(0,f.vt)(e[5])]:[(0,f.vt)(),(0,f.vt)(),(0,f.vt)(),(0,f.vt)(),(0,f.vt)(),(0,f.vt)()]}function g(e,t){for(let r=0;r<T;r++)(0,f.C)(e[r],t[r]);return e}function _(e,t,r,s=A){const a=(0,o.lw)(p.Rc.get(),t,e);(0,o.B8)(a,a);for(let e=0;e<b;++e){const t=(0,u.t)(p.Km.get(),S[e],a);(0,l.i)(s[e],t[0]/t[3],t[1]/t[3],t[2]/t[3])}!function(e,t){(0,f.Cr)(t[i.FAR_BOTTOM_LEFT],t[i.NEAR_BOTTOM_LEFT],t[i.NEAR_TOP_LEFT],e[n.LEFT]),(0,f.Cr)(t[i.NEAR_BOTTOM_RIGHT],t[i.FAR_BOTTOM_RIGHT],t[i.FAR_TOP_RIGHT],e[n.RIGHT]),(0,f.Cr)(t[i.FAR_BOTTOM_LEFT],t[i.FAR_BOTTOM_RIGHT],t[i.NEAR_BOTTOM_RIGHT],e[n.BOTTOM]),(0,f.Cr)(t[i.NEAR_TOP_LEFT],t[i.NEAR_TOP_RIGHT],t[i.FAR_TOP_RIGHT],e[n.TOP]),(0,f.Cr)(t[i.NEAR_BOTTOM_LEFT],t[i.NEAR_BOTTOM_RIGHT],t[i.NEAR_TOP_RIGHT],e[n.NEAR]),(0,f.Cr)(t[i.FAR_BOTTOM_RIGHT],t[i.FAR_BOTTOM_LEFT],t[i.FAR_TOP_LEFT],e[n.FAR])}(r,s)}function y(e,t){for(let r=0;r<T;r++){const n=e[r];if(n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]>=t[3])return!1}return!0}function v(e,t){for(let r=0;r<T;r++){const n=e[r];if(!(0,f.b6)(n,t))return!1}return!0}(s=n||(n={}))[s.LEFT=0]="LEFT",s[s.RIGHT=1]="RIGHT",s[s.BOTTOM=2]="BOTTOM",s[s.TOP=3]="TOP",s[s.NEAR=4]="NEAR",s[s.FAR=5]="FAR",function(e){e[e.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",e[e.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",e[e.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",e[e.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",e[e.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",e[e.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",e[e.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",e[e.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(i||(i={})),i.FAR_BOTTOM_RIGHT,i.NEAR_BOTTOM_RIGHT,i.NEAR_BOTTOM_LEFT,i.FAR_BOTTOM_LEFT,i.NEAR_BOTTOM_LEFT,i.NEAR_BOTTOM_RIGHT,i.NEAR_TOP_RIGHT,i.NEAR_TOP_LEFT,i.FAR_BOTTOM_RIGHT,i.FAR_BOTTOM_LEFT,i.FAR_TOP_LEFT,i.FAR_TOP_RIGHT,i.NEAR_BOTTOM_RIGHT,i.FAR_BOTTOM_RIGHT,i.FAR_TOP_RIGHT,i.NEAR_TOP_RIGHT,i.FAR_BOTTOM_LEFT,i.NEAR_BOTTOM_LEFT,i.NEAR_TOP_LEFT,i.FAR_TOP_LEFT,i.FAR_TOP_LEFT,i.NEAR_TOP_LEFT,i.NEAR_TOP_RIGHT,i.FAR_TOP_RIGHT;const T=6,b=8,S=[(0,d.fA)(-1,-1,-1,1),(0,d.fA)(1,-1,-1,1),(0,d.fA)(1,1,-1,1),(0,d.fA)(-1,1,-1,1),(0,d.fA)(-1,-1,1,1),(0,d.fA)(1,-1,1,1),(0,d.fA)(1,1,1,1),(0,d.fA)(-1,1,1,1)],A=(new a.I(h.vt),[(0,c.vt)(),(0,c.vt)(),(0,c.vt)(),(0,c.vt)(),(0,c.vt)(),(0,c.vt)(),(0,c.vt)(),(0,c.vt)()])},73313:function(e,t,r){r.d(t,{C:function(){return c},Cr:function(){return d},H6:function(){return m},_I:function(){return f},dz:function(){return g},fA:function(){return u},kb:function(){return h},ld:function(){return _},sd:function(){return p},vt:function(){return l}});var n=r(15774),i=r(89736),s=r(20551),a=r(32501),o=r(50973);function l(e){return e?{origin:(0,a.o8)(e.origin),vector:(0,a.o8)(e.vector)}:{origin:(0,a.vt)(),vector:(0,a.vt)()}}function c(e,t=l()){return u(e.origin,e.vector,t)}function u(e,t,r=l()){return(0,s.c)(r.origin,e),(0,s.c)(r.vector,t),r}function d(e,t,r=l()){return(0,s.c)(r.origin,e),(0,s.d)(r.vector,t,e),r}function h(e,t){const r=(0,s.d)(o.rq.get(),t,e.origin),i=(0,s.f)(e.vector,r),a=(0,s.f)(e.vector,e.vector),l=(0,n.qE)(i/a,0,1),c=(0,s.d)(o.rq.get(),(0,s.h)(o.rq.get(),e.vector,l),r);return(0,s.f)(c,c)}function f(e,t,r){return m(e,t,0,1,r)}function p(e,t,r){return(0,s.g)(r,e.origin,(0,s.h)(r,e.vector,t))}function m(e,t,r,i,a){const{vector:l,origin:c}=e,u=(0,s.d)(o.rq.get(),t,c),d=(0,s.f)(l,u)/(0,s.k)(l);return(0,s.h)(a,l,(0,n.qE)(d,r,i)),(0,s.g)(a,a,e.origin)}function g(e,t){if(y(e,function(e,t){const r=T.get();return r.origin=e,r.vector=t,r}(t.origin,t.direction),!1,v)){const{tA:t,pB:r,distance2:n}=v;if(t>=0&&t<=1)return n;if(t<0)return(0,s.s)(e.origin,r);if(t>1)return(0,s.s)((0,s.g)(o.rq.get(),e.origin,e.vector),r)}return null}function _(e,t,r){return!!y(e,t,!0,v)&&((0,s.c)(r,v.pA),!0)}function y(e,t,r,i){const a=1e-6,l=e.origin,c=(0,s.g)(o.rq.get(),l,e.vector),u=t.origin,d=(0,s.g)(o.rq.get(),u,t.vector),h=o.rq.get(),f=o.rq.get();if(h[0]=l[0]-u[0],h[1]=l[1]-u[1],h[2]=l[2]-u[2],f[0]=d[0]-u[0],f[1]=d[1]-u[1],f[2]=d[2]-u[2],Math.abs(f[0])<a&&Math.abs(f[1])<a&&Math.abs(f[2])<a)return!1;const p=o.rq.get();if(p[0]=c[0]-l[0],p[1]=c[1]-l[1],p[2]=c[2]-l[2],Math.abs(p[0])<a&&Math.abs(p[1])<a&&Math.abs(p[2])<a)return!1;const m=h[0]*f[0]+h[1]*f[1]+h[2]*f[2],g=f[0]*p[0]+f[1]*p[1]+f[2]*p[2],_=h[0]*p[0]+h[1]*p[1]+h[2]*p[2],y=f[0]*f[0]+f[1]*f[1]+f[2]*f[2],v=(p[0]*p[0]+p[1]*p[1]+p[2]*p[2])*y-g*g;if(Math.abs(v)<a)return!1;let T=(m*g-_*y)/v,b=(m+g*T)/y;r&&(T=(0,n.qE)(T,0,1),b=(0,n.qE)(b,0,1));const S=o.rq.get(),A=o.rq.get();return S[0]=l[0]+T*p[0],S[1]=l[1]+T*p[1],S[2]=l[2]+T*p[2],A[0]=u[0]+b*f[0],A[1]=u[1]+b*f[1],A[2]=u[2]+b*f[2],i.tA=T,i.tB=b,i.pA=S,i.pB=A,i.distance2=(0,s.s)(S,A),!0}const v={tA:0,tB:0,pA:(0,a.vt)(),pB:(0,a.vt)(),distance2:0},T=new i.I((()=>l()))},67376:function(e,t,r){r.d(t,{CK:function(){return h},E9:function(){return u},Hq:function(){return d},MW:function(){return f},TE:function(){return p},yJ:function(){return m}});var n=r(88022),i=r(40633),s=r(20551),a=r(45532),o=r(65907),l=r(20460);function c(){return i.A.getLogger("esri.geometry.Mesh")}function u(e){return!d(e)}function d(e){return null!=e.origin}function h(e){return d(e.vertexSpace)}function f(e,t){if(!d(e))return null;const[r,n,i]=e.origin;return new a.default({x:r,y:n,z:i,spatialReference:t})}function p(e,t){const{x:r,y:i,z:s,spatialReference:a}=e,u=[r,i,s??0];return void 0!==t?.geographic&&((0,n.io)(c(),"option: geographic",{replacement:"Use the `vertexSpace` option instead.",version:"4.29",warnOnce:!0}),t.vertexSpace&&c().warn("Deprecated geographic flag ignored since vertexSpace option is provided.")),"local"===(t?.vertexSpace??(d=t?.geographic,null==d?void 0:d?"local":"georeferenced")??function(e){return e.isGeographic||e.isWebMercator?"local":"georeferenced"}(a))?new l.A({origin:u}):new o.A({origin:u});var d}function m(e,t){return e.type===t.type&&(e.origin===t.origin||null!=e.origin&&null!=t.origin&&(0,s.p)(e.origin,t.origin))}},65298:function(e,t,r){r.d(t,{O7:function(){return I},Hr:function(){return w},el:function(){return E},mT:function(){return x},XX:function(){return T}});var n=r(25591),i=r(39819),s=r(40633),a=r(44740),o=r(91508),l=r(65417),c=r(57652),u=r(1644),d=(r(50917),r(93040)),h=r(74697),f=r(39397),p=r(90683),m=r(26765);const g=()=>s.A.getLogger("esri.geometry.support.normalizeUtils");function _(e){return"polygon"===e[0].type}function y(e){return"polyline"===e[0].type}function v(e){const t=[];let r=0,n=0;for(let i=0;i<e.length;i++){const s=e[i];let a=null;for(let e=0;e<s.length;e++)a=s[e],t.push(a),0===e?(r=a[0],n=r):(r=Math.min(r,a[0]),n=Math.max(n,a[0]));a&&t.push([(r+n)/2,0])}return t}function T(e,t){if(!(e instanceof o.A||e instanceof a.A)){const e="straightLineDensify: the input geometry is neither polyline nor polygon";throw g().error(e),new i.A(e)}const r=(0,l.r8)(e),n=[];for(const e of r){const r=[];n.push(r),r.push([e[0][0],e[0][1]]);for(let n=0;n<e.length-1;n++){const i=e[n][0],s=e[n][1],a=e[n+1][0],o=e[n+1][1],l=Math.sqrt((a-i)*(a-i)+(o-s)*(o-s)),c=(o-s)/l,u=(a-i)/l,d=l/t;if(d>1){for(let e=1;e<=d-1;e++){const n=e*t,a=u*n+i,o=c*n+s;r.push([a,o])}const e=(l+Math.floor(d-1)*t)/2,n=u*e+i,a=c*e+s;r.push([n,a])}r.push([a,o])}}return function(e){return"polygon"===e.type}(e)?new a.A({rings:n,spatialReference:e.spatialReference}):new o.A({paths:n,spatialReference:e.spatialReference})}function b(e,t,r){if(t){const t=T(e,1e6);e=(0,u.ci)(t,!0)}return r&&(e=(0,l.kS)(e,r)),e}function S(e,t,r){if(Array.isArray(e)){const n=e[0];if(n>t){const r=(0,l.kd)(n,t);e[0]=n+r*(-2*t)}else if(n<r){const t=(0,l.kd)(n,r);e[0]=n+t*(-2*r)}}else{const n=e.x;if(n>t){const r=(0,l.kd)(n,t);e=e.clone().offset(r*(-2*t),0)}else if(n<r){const t=(0,l.kd)(n,r);e=e.clone().offset(t*(-2*r),0)}}return e}function A(e,t){let r=-1;for(let n=0;n<t.cutIndexes.length;n++){const i=t.cutIndexes[n],s=t.geometries[n],a=(0,l.r8)(s);for(let e=0;e<a.length;e++){const t=a[e];t.some((r=>{if(r[0]<180)return!0;{let r=0;for(let e=0;e<t.length;e++){const n=t[e][0];r=n>r?n:r}r=Number(r.toFixed(9));const n=-360*(0,l.kd)(r,180);for(let r=0;r<t.length;r++){const t=s.getPoint(e,r);s.setPoint(e,r,t.clone().offset(n,0))}return!0}}))}if(i===r){if(_(e))for(const t of(0,l.r8)(s))e[i]=e[i].addRing(t);else if(y(e))for(const t of(0,l.r8)(s))e[i]=e[i].addPath(t)}else r=i,e[i]=s}return e}async function E(e,t,r){if(!Array.isArray(e))return E([e],t);t&&"string"!=typeof t&&g().warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");const i="string"==typeof t?t:t?.url??n.default.geometryServiceUrl;let s,_,y,v,T,w,I,x,R=0;const M=[],O=[];for(const t of e)if(null!=t)if(s||(s=t.spatialReference,_=(0,c.Vp)(s),y=s.isWebMercator,w=y?102100:4326,v=l.j7[w].maxX,T=l.j7[w].minX,I=l.j7[w].plus180Line,x=l.j7[w].minus180Line),_)if("mesh"===t.type)O.push(t);else if("point"===t.type)O.push(S(t.clone(),v,T));else if("multipoint"===t.type){const e=t.clone();e.points=e.points.map((e=>S(e,v,T))),O.push(e)}else if("extent"===t.type){const e=t.clone()._normalize(!1,!1,_);O.push(e.rings?new a.A(e):e)}else if(t.extent){const e=t.extent,r=(0,l.kd)(e.xmin,T)*(2*v);let n=0===r?t.clone():(0,l.kS)(t.clone(),r);e.offset(r,0);let{xmin:i,xmax:s}=e;i=Number(i.toFixed(9)),s=Number(s.toFixed(9)),e.intersects(I)&&s!==v?(R=s>R?s:R,n=b(n,y),M.push(n),O.push("cut")):e.intersects(x)&&i!==T?(R=s*(2*v)>R?s*(2*v):R,n=b(n,y,360),M.push(n),O.push("cut")):O.push(n)}else O.push(t.clone());else O.push(t);else O.push(t);let C=(0,l.kd)(R,v),N=-90;const L=C,F=new o.A;for(;C>0;){const e=360*C-180;F.addPath([[e,N],[e,-1*N]]),N*=-1,C--}if(M.length>0&&L>0){const t=A(M,await async function(e,t,r,n){const i=(0,f.Dl)(e),s=t[0].spatialReference,a={...n,responseType:"json",query:{...i.query,f:"json",sr:(0,c.YX)(s),target:JSON.stringify({geometryType:(0,h.$B)(t[0]),geometries:t}),cutter:JSON.stringify(r)}},o=await(0,d.A)(i.path+"/cut",a),{cutIndexes:l,geometries:u=[]}=o.data;return{cutIndexes:l,geometries:u.map((e=>{const t=(0,h.rS)(e);return t.spatialReference=s,t}))}}(i,M,F,r)),n=[],s=[];for(let r=0;r<O.length;r++){const i=O[r];if("cut"!==i)s.push(i);else{const i=t.shift(),a=e[r];null!=a&&"polygon"===a.type&&a.rings&&a.rings.length>1&&i.rings.length>=a.rings.length?(n.push(i),s.push("simplify")):s.push(y?(0,u.Gh)(i):i)}}if(!n.length)return s;const a=await async function(e,t,r){const n="string"==typeof e?(0,p.An)(e):e,i=t[0].spatialReference,s=(0,h.$B)(t[0]),a={...r,query:{...n.query,f:"json",sr:(0,c.YX)(i),geometries:JSON.stringify((0,m.X)(t))}},{data:o}=await(0,d.A)(n.path+"/simplify",a);return(0,m.V)(o.geometries,s,i)}(i,n,r),o=[];for(let e=0;e<s.length;e++){const t=s[e];"simplify"!==t?o.push(t):o.push(y?(0,u.Gh)(a.shift()):a.shift())}return o}const D=[];for(let e=0;e<O.length;e++){const t=O[e];if("cut"!==t)D.push(t);else{const e=M.shift();D.push(!0===y?(0,u.Gh)(e):e)}}return D}function w(e){if(!e)return null;const t=e.extent;if(!t)return null;const r=e.spatialReference&&(0,c.Vp)(e.spatialReference);if(!r)return t;const[n,i]=r.valid,s=2*i,{width:a}=t;let o,{xmin:l,xmax:u}=t;if([l,u]=[u,l],"extent"===e.type||0===a||a<=i||a>s||l<n||u>i)return t;switch(e.type){case"polygon":if(!(e.rings.length>1))return t;o=v(e.rings);break;case"polyline":if(!(e.paths.length>1))return t;o=v(e.paths);break;case"multipoint":o=e.points}const d=t.clone();for(let e=0;e<o.length;e++){let t=o[e][0];t<0?(t+=i,u=Math.max(t,u)):(t-=i,l=Math.min(t,l))}return d.xmin=l,d.xmax=u,d.width<a?(d.xmin-=i,d.xmax-=i,d):t}function I(e,t,r){const n=(0,c.Vp)(r);if(null==n)return e;const[i,s]=n.valid,a=2*s;let o=0,l=0;t>s?o=Math.ceil(Math.abs(t-s)/a):t<i&&(o=-Math.ceil(Math.abs(t-i)/a)),e>s?l=Math.ceil(Math.abs(e-s)/a):e<i&&(l=-Math.ceil(Math.abs(e-i)/a));let u=e+(o-l)*a;const d=u-t;return d>s?u-=a:d<i&&(u+=a),u}function x(e,t){const r=(0,c.Vp)(t);if(r){const[t,n]=r.valid,i=n-t;if(e<t)for(;e<t;)e+=i;if(e>n)for(;e>n;)e-=i}return e}},65417:function(e,t,r){r.d(t,{j7:function(){return a},kS:function(){return l},kd:function(){return o},r8:function(){return c}});var n=r(91508),i=r(57165),s=r(74697);const a={102100:{maxX:20037508.342788905,minX:-20037508.342788905,plus180Line:new n.A({paths:[[[20037508.342788905,-20037508.342788905],[20037508.342788905,20037508.342788905]]],spatialReference:i.A.WebMercator}),minus180Line:new n.A({paths:[[[-20037508.342788905,-20037508.342788905],[-20037508.342788905,20037508.342788905]]],spatialReference:i.A.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new n.A({paths:[[[180,-180],[180,180]]],spatialReference:i.A.WGS84}),minus180Line:new n.A({paths:[[[-180,-180],[-180,180]]],spatialReference:i.A.WGS84})}};function o(e,t){return Math.ceil((e-t)/(2*t))}function l(e,t){const r=c(e);for(const e of r)for(const r of e)r[0]+=t;return e}function c(e){return(0,s.Bi)(e)?e.rings:e.paths}},5596:function(e,t,r){r.d(t,{C:function(){return d},Cr:function(){return m},Io:function(){return D},LV:function(){return u},O_:function(){return p},Qj:function(){return h},T7:function(){return M},Tj:function(){return C},U5:function(){return x},Ui:function(){return R},Z1:function(){return F},_I:function(){return L},b6:function(){return N},ci:function(){return _},fA:function(){return f},gv:function(){return O},lU:function(){return g},mN:function(){return P},mP:function(){return E},mR:function(){return I},vt:function(){return c},ze:function(){return w}});var n=r(15774),i=r(20551),s=r(32501),a=(r(33400),r(29531)),o=r(50973),l=r(76185);function c(e=H){return[e[0],e[1],e[2],e[3]]}function u(e=H[0],t=H[1],r=H[2],n=H[3]){return f(e,t,r,n,o.Km.get())}function d(e,t){return f(t[0],t[1],t[2],t[3],e)}function h(e){return e}function f(e,t,r,n,i=c()){return i[0]=e,i[1]=t,i[2]=r,i[3]=n,i}function p(e,t,r){const n=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=Math.abs(n-1)>1e-5&&n>1e-12?1/Math.sqrt(n):1;return r[0]=t[0]*i,r[1]=t[1]*i,r[2]=t[2]*i,r[3]=-(r[0]*e[0]+r[1]*e[1]+r[2]*e[2]),r}function m(e,t,r,n=c()){const i=r[0]-t[0],s=r[1]-t[1],a=r[2]-t[2],o=e[0]-t[0],l=e[1]-t[1],u=e[2]-t[2],d=s*u-a*l,h=a*o-i*u,f=i*l-s*o,p=d*d+h*h+f*f,m=Math.abs(p-1)>1e-5&&p>1e-12?1/Math.sqrt(p):1;return n[0]=d*m,n[1]=h*m,n[2]=f*m,n[3]=-(n[0]*e[0]+n[1]*e[1]+n[2]*e[2]),n}function g(e,t,r,n=0,s=Math.floor(r*(1/3)),a=Math.floor(r*(2/3))){if(r<3)return!1;t(v,n);let o=s,l=!1;for(;o<r-1&&!l;)t(T,o),o++,l=!(0,i.p)(v,T);if(!l)return!1;for(o=Math.max(o,a),l=!1;o<r&&!l;)t(b,o),o++,(0,i.d)(S,v,T),(0,i.n)(S,S),(0,i.d)(A,T,b),(0,i.n)(A,A),l=!(0,i.p)(v,b)&&!(0,i.p)(T,b)&&Math.abs((0,i.f)(S,A))<y;return l?(m(v,T,b,e),!0):(0!==n||1!==s||2!==a)&&g(e,t,r,0,1,2)}function _(e,t,r=!0){const n=t.length/3;return g(e,((e,r)=>(0,i.i)(e,t[3*r+0],t[3*r+1],t[3*r+2])),r?n-1:n)}const y=.99619469809,v=(0,s.vt)(),T=(0,s.vt)(),b=(0,s.vt)(),S=(0,s.vt)(),A=(0,s.vt)();function E(e,t,r){return t!==e&&d(e,t),e[3]=-(0,i.f)(e,r),e}function w(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function I(e,t,r,n){return(0,i.e)(b,t,e),p(r,b,n)}function x(e,t,r,n){return G(z(e,t,(0,i.d)(o.rq.get(),r,t),k,n))}function R(e,t,r){return null!=t&&G(z(e,t.origin,t.direction,j,r))}function M(e,t,r){return G(z(e,t.origin,t.vector,V.NONE,r))}function O(e,t,r){return G(z(e,t.origin,t.vector,V.CLAMP,r))}function C(e,t){return P(e,t)>=0}function N(e,t){const r=(0,i.f)(e,t.ray.direction),n=-P(e,t.ray.origin);if(r>-1e-6&&r<1e-6)return n>0;const s=n/r;return r>0?s<t.c1&&(t.c1=s):s>t.c0&&(t.c0=s),t.c0<=t.c1}function L(e,t,r){const n=(0,i.h)(o.rq.get(),e,-e[3]),s=function(e,t,r){const n=(0,i.h)(o.rq.get(),e,(0,i.f)(e,t));return(0,i.d)(r,t,n),r}(e,(0,i.d)(o.rq.get(),t,n),o.rq.get());return(0,i.g)(r,s,n),r}function F(e,t,r,n){const s=e,c=o.rq.get(),u=o.rq.get();(0,l.VV)(s,c,u);const d=(0,i.d)(o.rq.get(),r,t),h=(0,a.gr)(c,d),f=(0,a.gr)(u,d),p=(0,a.gr)(s,d);return(0,i.i)(n,h,f,p)}function D(e,t){return Math.abs(P(e,t))}function P(e,t){return(0,i.f)(e,t)+e[3]}var B,U;function G(e){return e===B.INTERSECTS_INSIDE_OUT||e===B.INTERSECTS_OUTSIDE_IN}function z(e,t,r,s,a){const o=(0,i.f)(e,r),l=P(e,t);if(0===o)return l>=0?B.INSIDE:B.OUTSIDE;let c=-l/o;return s&V.CLAMP&&(c=(0,n.qE)(c,0,1)),!(s&V.INFINITE_MIN)&&c<0||!(s&V.INFINITE_MAX)&&c>1?l>=0?B.INSIDE:B.OUTSIDE:((0,i.g)(a,t,(0,i.h)(a,r,c)),l>=0?B.INTERSECTS_INSIDE_OUT:B.INTERSECTS_OUTSIDE_IN)}(U=B||(B={}))[U.INTERSECTS_INSIDE_OUT=0]="INTERSECTS_INSIDE_OUT",U[U.INTERSECTS_OUTSIDE_IN=1]="INTERSECTS_OUTSIDE_IN",U[U.INSIDE=2]="INSIDE",U[U.OUTSIDE=3]="OUTSIDE";const H=[0,0,1,0];var V;!function(e){e[e.NONE=0]="NONE",e[e.CLAMP=1]="CLAMP",e[e.INFINITE_MIN=4]="INFINITE_MIN",e[e.INFINITE_MAX=8]="INFINITE_MAX"}(V||(V={}));const k=V.INFINITE_MIN|V.INFINITE_MAX,j=V.INFINITE_MAX},87280:function(e,t,r){function n(e){return e?{originPosition:"upper-left"===e.originPosition?"upperLeft":"lower-left"===e.originPosition?"lowerLeft":e.originPosition,scale:e.tolerance?[e.tolerance,e.tolerance,1,1]:[1,1,1,1],translate:null!=e.extent?[e.extent.xmin,e.extent.ymax,e.extent.zmin??0,e.extent.mmin??0]:[0,0,0,0]}:null}function i(e){if(function(e){return"lowerLeft"===e.originPosition&&4===e.scale.length&&4===e.translate.length}(e))return e;const{originPosition:t,scale:r,translate:n}=e,i=r[0]??1,s=r[1]??1;return{originPosition:"lowerLeft",scale:[i,"lowerLeft"===t?s:-s,r[2]??1,r[3]??1],translate:[n[0]??0,n[1]??0,n[2]??0,n[3]??0]}}function s({scale:e,translate:t},r){return r*e[0]+t[0]}function a({scale:e,translate:t},r){return r*e[1]+t[1]}function o({scale:e,translate:t},r){return(r??0)*e[2]+t[2]}function l({scale:e,translate:t},r){return r?r*e[3]+t[3]:0}function c(e,t){return e&&t?f:e&&!t?d:!e&&t?h:u}r.d(t,{$X:function(){return y},Gy:function(){return m},P5:function(){return v},Q1:function(){return i},SW:function(){return g},Tr:function(){return _},VV:function(){return n}}),r(74697);const u=(e,t)=>{const r=new Array(t.length);if(!t.length)return r;const n=t[0];let i=s(e,n[0]),o=a(e,n[1]);r[0]=[i,o];const{scale:l,originPosition:c}=e,u=l[0],d="lowerLeft"===c?l[1]:-l[1];for(let e=1;e<t.length;e++){const[n,s]=t[e];i+=u*n,o+=d*s,r[e]=[i,o]}return r},d=(e,t)=>{const r=new Array(t.length);if(!t.length)return r;const n=t[0];let i=s(e,n[0]),l=a(e,n[1]);r[0]=[i,l,o(e,n[2])];const{scale:c,originPosition:u}=e,d=c[0],h="lowerLeft"===u?c[1]:-c[1];for(let n=1;n<t.length;n++){const[s,a,c]=t[n];i+=d*s,l+=h*a,r[n]=[i,l,o(e,c)]}return r},h=(e,t)=>{const r=new Array(t.length);if(!t.length)return r;const n=t[0];let i=s(e,n[0]),o=a(e,n[1]);r[0]=[i,o,l(e,n[2])];const{scale:c,originPosition:u}=e,d=c[0],h="lowerLeft"===u?c[1]:-c[1];for(let n=1;n<t.length;n++){const[s,a,c]=t[n];i+=d*s,o+=h*a,r[n]=[i,o,l(e,c)]}return r},f=(e,t)=>{const r=new Array(t.length);if(!t.length)return r;const n=t[0];let i=s(e,n[0]),c=a(e,n[1]);r[0]=[i,c,o(e,n[2]),l(e,n[3])];const{scale:u,originPosition:d}=e,h=u[0],f="lowerLeft"===d?u[1]:-u[1];for(let n=1;n<t.length;n++){const[s,a,u,d]=t[n];i+=h*s,c+=f*a,r[n]=[i,c,o(e,u),l(e,d)]}return r};function p(e,t,r){const n=new Array(r.length);for(let i=0;i<r.length;i++)n[i]=t(e,r[i]);return n}function m(e,t,r){const n=i(e);return t.x=function({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}(n,r.x),t.y=function({scale:e,translate:t},r){return Math.round((r-t[1])/e[1])}(n,r.y),null!=r.z&&(t.z=function({scale:e,translate:t},r){return Math.round(((r??0)-t[2])/e[2])}(n,r.z)),null!=r.m&&(t.m=function({scale:e,translate:t},r){return r?Math.round((r-t[3])/e[3]):0}(n,r.m)),t}function g(e,t,r,n=r?.hasZ??!1,s=r?.hasM??!1){if(null!=r){const a=i(e);t.points=c(n,s)(a,r.points),t.hasZ=n,t.hasM=s}return t}function _(e,t,r,n=null!=r?.z,c=null!=r?.m){if(null==r)return t;const u=i(e);return t.x=s(u,r.x),t.y=a(u,r.y),n&&(t.z=o(u,r.z)),c&&(t.m=l(u,r.m)),t}function y(e,t,r,n=r?.hasZ??!1,s=r?.hasM??!1){if(null!=r){const a=i(e);t.rings=p(a,c(n,s),r.rings),t.hasZ=n,t.hasM=s}return t}function v(e,t,r,n=r?.hasZ??!1,s=r?.hasM??!1){if(null!=r){const a=i(e);t.paths=p(a,c(n,s),r.paths),t.hasZ=n,t.hasM=s}return t}},79578:function(e,t,r){r.d(t,{C:function(){return d},Cr:function(){return h},LV:function(){return u},kb:function(){return f},oC:function(){return p},vt:function(){return l}}),r(50659);var n=r(89736),i=(r(44705),r(87725)),s=r(20551),a=r(32501),o=r(50973);function l(e){return e?c((0,a.o8)(e.origin),(0,a.o8)(e.direction)):c((0,a.vt)(),(0,a.vt)())}function c(e,t){return{origin:e,direction:t}}function u(e,t){const r=m.get();return r.origin=e,r.direction=t,r}function d(e,t=l()){return function(e,t,r=l()){return(0,s.c)(r.origin,e),(0,s.c)(r.direction,t),r}(e.origin,e.direction,t)}function h(e,t,r=l()){return(0,s.c)(r.origin,e),(0,s.d)(r.direction,t,e),r}function f(e,t){const r=(0,s.e)(o.rq.get(),(0,s.n)(o.rq.get(),e.direction),(0,s.d)(o.rq.get(),t,e.origin));return(0,s.f)(r,r)}function p(e,t,r){const n=(0,s.f)(e.direction,(0,s.d)(r,t,e.origin));return(0,s.g)(r,e.origin,(0,s.h)(r,e.direction,n)),r}const m=new n.I((()=>l()));(0,a.vt)(),(0,a.vt)(),(0,a.vt)(),(0,i.vt)()},67496:function(e,t,r){r.d(t,{Fm:function(){return o},Q7:function(){return l}});var n=r(89736),i=r(20551),s=r(32501),a=r(73313);function o(e,t,r){const n=t[0]-e[0],i=t[1]-e[1],s=r[0]-e[0],a=r[1]-e[1];return.5*Math.abs(n*a-i*s)}function l(e,t,r){return(0,i.d)(c,t,e),(0,i.d)(u,r,e),.5*(0,i.l)((0,i.e)(c,c,u))}r(50973),new n.I(a.vt),new n.I((()=>{return e?{p0:(0,s.o8)(e.p0),p1:(0,s.o8)(e.p1),p2:(0,s.o8)(e.p2)}:{p0:(0,s.vt)(),p1:(0,s.vt)(),p2:(0,s.vt)()};var e}));const c=(0,s.vt)(),u=(0,s.vt)()},29531:function(e,t,r){r.d(t,{EJ:function(){return c},_I:function(){return a},g7:function(){return l},gr:function(){return o}});var n=r(15774),i=r(20551),s=r(32501);function a(e,t,r){const n=(0,i.f)(e,t)/(0,i.f)(e,e);return(0,i.h)(r,e,n)}function o(e,t){return(0,i.f)(e,t)/(0,i.l)(e)}function l(e,t){const r=(0,i.f)(e,t)/((0,i.l)(e)*(0,i.l)(t));return-(0,n.XM)(r)}function c(e,t,r){(0,i.n)(u,e),(0,i.n)(d,t);const s=(0,i.f)(u,d),a=(0,n.XM)(s),o=(0,i.e)(u,u,d);return(0,i.f)(o,r)<0?2*Math.PI-a:a}const u=(0,s.vt)(),d=(0,s.vt)()},50973:function(e,t,r){r.d(t,{Rc:function(){return p},J8:function(){return m},oG:function(){return d},rq:function(){return h},Km:function(){return f}}),r(58941);var n=r(29601),i=r(87725),s=r(39714),a=r(61769),o=r(1932),l=r(32501),c=r(41546);class u{constructor(e){this._create=e,this._items=new Array,this._itemsPtr=0}get(){return 0===this._itemsPtr&&(0,n.d)((()=>this._reset())),this._itemsPtr>=this._items.length&&this._items.push(this._create()),this._items[this._itemsPtr++]}_reset(){const e=2*this._itemsPtr;this._items.length>e&&(this._items.length=e),this._itemsPtr=0}static createVec2f64(){return new u(o.vt)}static createVec3f64(){return new u(l.vt)}static createVec4f64(){return new u(c.vt)}static createMat3f64(){return new u(i.vt)}static createMat4f64(){return new u(s.vt)}static createQuatf64(){return new u(a.vt)}get test(){}}const d=u.createVec2f64(),h=u.createVec3f64(),f=u.createVec4f64(),p=(u.createMat3f64(),u.createMat4f64()),m=u.createQuatf64()},65215:function(e,t,r){r.d(t,{N3:function(){return s},Om:function(){return i}});var n=r(76613);class i{constructor(e=null,t={},r,n){this.geometry=e,this.attributes=t,this.centroid=r,this.objectId=n,this.displayId=0,this.geohashX=0,this.geohashY=0}static fromJSON(e,t){const r=e.geometry?n.A.fromJSON(e.geometry):null,s=e.centroid?n.A.fromJSON(e.centroid):null,a=e.attributes[t];return new i(r,e.attributes,s,a)}weakClone(){const e=new i(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e.geohashX=this.geohashX,e.geohashY=this.geohashY,e}clone(){const e=this.geometry?.clone(),t=new i(e,{...this.attributes},this.centroid?.clone(),this.objectId);return t.displayId=this.displayId,t.geohashX=this.geohashX,t.geohashY=this.geohashY,t}}function s(e){return!!e.geometry?.coords?.length}},72887:function(e,t,r){r.d(t,{A:function(){return n}});class n{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const e=new n;return e.objectIdFieldName=this.objectIdFieldName,e.globalIdFieldName=this.globalIdFieldName,e.geohashFieldName=this.geohashFieldName,e.geometryProperties=this.geometryProperties,e.geometryType=this.geometryType,e.spatialReference=this.spatialReference,e.hasZ=this.hasZ,e.hasM=this.hasM,e.features=this.features,e.fields=this.fields,e.transform=this.transform,e.exceededTransferLimit=this.exceededTransferLimit,e.uniqueIdField=this.uniqueIdField,e.queryGeometry=this.queryGeometry,e.queryGeometryType=this.queryGeometryType,e}}},76613:function(e,t,r){r.d(t,{A:function(){return n}});class n{constructor(e=[],t=[]){this.lengths=e??[],this.coords=t??[]}static fromJSON(e){return new n(e.lengths,e.coords)}static fromRect(e){const[t,r,i,s]=e,a=i-t,o=s-r;return new n([5],[t,r,a,0,0,o,-a,0,0,-o])}get isPoint(){return 0===this.lengths.length&&this.coords.length>=2}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce(((e,t)=>e+t))}forEachVertex(e){let t=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let r=0;r<this.lengths.length;r++){const n=this.lengths[r];for(let r=0;r<n;r++)e(this.coords[2*(r+t)],this.coords[2*(r+t)+1]);t+=n}}deltaDecode(){const e=this.clone(),{coords:t,lengths:r}=e;let n=0;for(const e of r){for(let r=1;r<e;r++)t[2*(n+r)]+=t[2*(n+r)-2],t[2*(n+r)+1]+=t[2*(n+r)-1];n+=e}return e}clone(e){if(0===this.lengths.length)return new n([],[this.coords[0],this.coords[1]]);const t=2*(0===this.lengths.length?1:this.lengths.reduce(((e,t)=>e+t))),r=this.coords.slice(0,t);return e?(e.set(r),new n(this.lengths,e)):new n(Array.from(this.lengths),Array.from(r))}}},40302:function(e,t,r){function n(e,t){return e?t?4:3:t?3:2}function i(e,t,r,i){if(!t?.lengths.length)return null;e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0);const o=e.coords,l=[],c=r?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:u,coords:d}=t,h=n(r,i);let f=0;for(const e of u){const t=s(c,d,f,e,r,i);t&&l.push(t),f+=e*h}if(l.sort(((e,t)=>{let n=e[2]-t[2];return 0===n&&r&&(n=e[4]-t[4]),n})),l.length){let e=6*l[0][2];o[0]=l[0][0]/e,o[1]=l[0][1]/e,r&&(e=6*l[0][4],o[2]=0!==e?l[0][3]/e:0),(o[0]<c[0]||o[0]>c[1]||o[1]<c[2]||o[1]>c[3]||r&&(o[2]<c[4]||o[2]>c[5]))&&(o.length=0)}if(!o.length){const e=t.lengths[0]?a(d,0,u[0],r,i):null;if(!e)return null;o[0]=e[0],o[1]=e[1],r&&e.length>2&&(o[2]=e[2])}return e}function s(e,t,r,i,s,a){const o=n(s,a);let l=r,c=r+o,u=0,d=0,h=0,f=0,p=0;for(let r=0,n=i-1;r<n;r++,l+=o,c+=o){const r=t[l],n=t[l+1],i=t[l+2],a=t[c],o=t[c+1],m=t[c+2];let g=r*o-a*n;f+=g,u+=(r+a)*g,d+=(n+o)*g,s&&(g=r*m-a*i,h+=(i+m)*g,p+=g),r<e[0]&&(e[0]=r),r>e[1]&&(e[1]=r),n<e[2]&&(e[2]=n),n>e[3]&&(e[3]=n),s&&(i<e[4]&&(e[4]=i),i>e[5]&&(e[5]=i))}if(f>0&&(f*=-1),p>0&&(p*=-1),!f)return null;const m=[u,d,.5*f];return s&&(m[3]=h,m[4]=.5*p),m}function a(e,t,r,i,s){const a=n(i,s);let d=t,h=t+a,f=0,p=0,m=0,g=0;for(let t=0,n=r-1;t<n;t++,d+=a,h+=a){const t=e[d],r=e[d+1],n=e[d+2],s=e[h],a=e[h+1],_=e[h+2],y=i?l(t,r,n,s,a,_):o(t,r,s,a);if(y)if(f+=y,i){const e=u(t,r,n,s,a,_);p+=y*e[0],m+=y*e[1],g+=y*e[2]}else{const e=c(t,r,s,a);p+=y*e[0],m+=y*e[1]}}return f>0?i?[p/f,m/f,g/f]:[p/f,m/f]:r>0?i?[e[t],e[t+1],e[t+2]]:[e[t],e[t+1]]:null}function o(e,t,r,n){const i=r-e,s=n-t;return Math.sqrt(i*i+s*s)}function l(e,t,r,n,i,s){const a=n-e,o=i-t,l=s-r;return Math.sqrt(a*a+o*o+l*l)}function c(e,t,r,n){return[e+.5*(r-e),t+.5*(n-t)]}function u(e,t,r,n,i,s){return[e+.5*(n-e),t+.5*(i-t),r+.5*(s-r)]}r.d(t,{Q:function(){return i}})},75707:function(e,t,r){r.d(t,{d:function(){return ce}});var n=r(50659),i=r(39819),s=r(30905),a=r(21609),o=r(95929),l=r(60539),c=r(62938),u=r(46157),d=r(24761),h=r(87416),f=r(35068),p=r(74697),m=r(65298),g=r(57652),_=r(58081),y=r(99680),v=r(16177),T=r(55644);const b=new class{constructor(e,t){this._cache=new y.q(e),this._invalidCache=new y.q(t)}get(e,t){const r=`${t.uid}:${e}`,n=this._cache.get(r);if(n)return n;if(null!=this._invalidCache.get(r))return null;try{const n=v.WhereClause.create(e,{fieldsIndex:t});return this._cache.put(r,n),n}catch(e){return this._invalidCache.put(r,e),null}}getError(e,t){const r=`${t.uid}:${e}`;return this._invalidCache.get(r)??null}}(50,500),S="unsupported-query",A=" as ",E=new Set(["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeBigInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong"]),w=new Set(["esriFieldTypeDate","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]),I=new Set(["esriFieldTypeString","esriFieldTypeGUID","esriFieldTypeGlobalID",...E,...w]);function x(e,t,r={}){const n=M(t,e);if(!n){const r=b.getError(t,e);throw new i.A(S,"invalid SQL expression",{expression:t,error:r})}const s=r.expressionName||"expression";if(r.validateStandardized&&!n.isStandardized)throw new i.A(S,`${s} is not standard`,{expression:t});if(r.validateAggregate&&!n.isAggregate)throw new i.A(S,`${s} does not contain a valid aggregate function`,{expression:t});return n.fieldNames}function R(e,t,r,n,s){if(!r)return!0;const a="having clause",o=x(e,r,{validateAggregate:!0,expressionName:a});N(e,t,o,{expressionName:a,query:s});const l=M(r,e),c=l?.getExpressions().every((t=>{const{aggregateType:r,field:i}=t,s=e.get(i)?.name;return n.some((t=>{const{onStatisticField:n,statisticType:i}=t,a=e.get(n)?.name;return a===s&&i.toLowerCase().trim()===r}))}));if(!c)throw new i.A(S,"expressions in having clause should also exist in outStatistics",{having:r});return!0}function M(e,t){return e?b.get(e,t):null}function O(e){return/\((.*?)\)/.test(e)?e:e.split(A)[0]}function C(e){return e.split(A)[1]}function N(e,t,r,n={}){const s=new Map;if(function(e,t,r,n,i){const s=i.includes("*")?[...r,...i.filter((e=>"*"!==e))]:i;for(const i of s)if(t.get(i))L(e,t,r,n,i);else try{const s=x(t,O(i),{validateStandardized:!0});for(const i of s)L(e,t,r,n,i)}catch(t){e.set(i,{type:"expression-error",expression:i,error:t})}}(s,e,t,n.allowedFieldTypes??I,r),s.size){const e=n.expressionName??"expression";throw new i.A(S,`${e} contains invalid or missing fields`,{errors:Array.from(s.values()),query:n.query})}}function L(e,t,r,n,i){const s=t.get(i);s?r.has(s.name)?"all"!==n&&!1===n?.has(s.type)&&e.set(i,{type:"invalid-type",fieldName:s.name,fieldType:T.m.fromJSON(s.type),allowedFieldTypes:Array.from(n,(e=>T.m.fromJSON(e)))}):e.set(i,{type:"missing-field",fieldName:s.name}):e.set(i,{type:"invalid-field",fieldName:i})}var F=r(78956),D=r(74841);class P{constructor(){this._storage=new Map,this._purgeInterval=5,this._sweep=()=>{if(this._timer=void 0,!this._storage)return;const e=1e3*this._purgeInterval,t=performance.now()-e;for(const[r,n]of this._storage){if(!(n.time<t))return void(this._storage.size>0&&(this._timer=setTimeout(this._sweep,e)));this._storage.delete(r)}}}destroy(){this._storage?.clear(),this._storage=null,clearTimeout(this._timer)}get size(){return this._storage?.size??0}put(e,t){this._storage?.set(e,new U(t)),this._scheduleSweep()}get(e){if(!this._storage)return;const t=this._storage?.get(e);return t?(this._storage?.delete(e),t.time=performance.now(),this._storage?.set(e,t),t.items):void 0}clear(){this._storage?.clear()}_scheduleSweep(){this._storage&&(this._timer??=setTimeout(this._sweep,1e3*this._purgeInterval))}}let B=0;class U{constructor(e){this.items=e,this.time=performance.now(),this.id=B++}}var G=r(7121),z=r(72228),H=r(38503),V=r(87280),k=r(53743),j=r(92586),Z=r(66164),q=r(54547);class W{constructor(e,t,r){this._fieldDataCache=new Map,this._returnDistinctMap=new Map,this.returnDistinctValues=e.returnDistinctValues??!1,this.fieldsIndex=r,this.featureAdapter=t;const n=e.outFields;if(n&&!n.includes("*")){this.outFields=n;let e=0;for(const t of n){const n=O(t),i=this.fieldsIndex.get(n),s=i?null:M(n,r),a=i?i.name:C(t)||"FIELD_EXP_"+e++;this._fieldDataCache.set(t,{alias:a,clause:s})}}}countDistinctValues(e){return this.returnDistinctValues?(e.forEach((e=>this.getAttributes(e))),this._returnDistinctMap.size):e.length}getAttributes(e){const t=this._processAttributesForOutFields(e);return this._processAttributesForDistinctValues(t)}getFieldValue(e,t,r){const n=r?r.name:t;let i=null;return this._fieldDataCache.has(n)?i=this._fieldDataCache.get(n)?.clause:r||(i=M(t,this.fieldsIndex),this._fieldDataCache.set(n,{alias:n,clause:i})),r?this.featureAdapter.getAttribute(e,n):i?.calculateValue(e,this.featureAdapter)}getDataValues(e,t,r=!0){const n=t.normalizationType,i=t.normalizationTotal,s=this.fieldsIndex.get(t.field),a=(0,k.zD)(s)||(0,k.Ah)(s),o=(0,k.OH)(s);return e.map((e=>{let s=t.field&&this.getFieldValue(e,t.field,this.fieldsIndex.get(t.field));if(t.field2?(s=`${(0,Z.gJ)(s)}${t.fieldDelimiter}${(0,Z.gJ)(this.getFieldValue(e,t.field2,this.fieldsIndex.get(t.field2)))}`,t.field3&&(s=`${s}${t.fieldDelimiter}${(0,Z.gJ)(this.getFieldValue(e,t.field3,this.fieldsIndex.get(t.field3)))}`)):"string"==typeof s&&r&&(a?s=s?new Date(s).getTime():null:o&&(s=s?(0,j.rb)(s):null)),n&&Number.isFinite(s)){const r="field"===n&&t.normalizationField?this.getFieldValue(e,t.normalizationField,this.fieldsIndex.get(t.normalizationField)):null;s=(0,Z.zS)(s,n,r,i)}return s}))}async getExpressionValues(e,t,r,n,i){const{arcadeUtils:s}=await(0,q.lw)(),a=s.hasGeometryOperations(t);a&&await s.enableGeometryOperations();const o=s.createFunction(t),l=s.getViewInfo(r),c={fields:this.fieldsIndex.fields};return e.map((e=>{const t={attributes:this.featureAdapter.getAttributes(e),layer:c,geometry:a?{...(0,F.pL)(n.geometryType,n.hasZ,n.hasM,this.featureAdapter.getGeometry(e)),spatialReference:r?.spatialReference}:null},u=s.createExecContext(t,l,i);return s.executeFunction(o,u)}))}validateItem(e,t){return this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:M(t,this.fieldsIndex)}),this._fieldDataCache.get(t)?.clause?.testFeature(e,this.featureAdapter)??!1}validateItems(e,t){return this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:M(t,this.fieldsIndex)}),this._fieldDataCache.get(t)?.clause?.testSet(e,this.featureAdapter)??!1}_processAttributesForOutFields(e){const t=this.outFields;if(!t?.length)return this.featureAdapter.getAttributes(e);const r={};for(const n of t){const{alias:t,clause:i}=this._fieldDataCache.get(n);r[t]=i?i.calculateValue(e,this.featureAdapter):this.featureAdapter.getAttribute(e,t)}return r}_processAttributesForDistinctValues(e){if(null==e||!this.returnDistinctValues)return e;const t=this.outFields,r=[];if(t)for(const n of t){const{alias:t}=this._fieldDataCache.get(n);r.push(e[t])}else for(const t in e)r.push(e[t]);const n=`${(t||["*"]).join(",")}=${r.join(",")}`;let i=this._returnDistinctMap.get(n)||0;return this._returnDistinctMap.set(n,++i),i>1?null:e}}var Y=r(51376);class ${constructor(e,t,r){this.items=e,this.query=t,this.geometryType=r.geometryType,this.hasM=r.hasM,this.hasZ=r.hasZ,this.fieldsIndex=r.fieldsIndex,this.objectIdField=r.objectIdField,this.spatialReference=r.spatialReference,this.featureAdapter=r.featureAdapter}get size(){return this.items.length}createQueryResponseForCount(){const e=new W(this.query,this.featureAdapter,this.fieldsIndex);if(!this.query.outStatistics)return e.countDistinctValues(this.items);const{groupByFieldsForStatistics:t,having:r,outStatistics:n}=this.query,i=t?.length;if(!i)return 1;const s=new Map,a=new Map,o=new Set;for(const i of n){const{statisticType:n}=i,l="exceedslimit"!==n?i.onStatisticField:void 0;if(!a.has(l)){const r=[];for(const n of t){const t=this._getAttributeValues(e,n,s);r.push(t)}a.set(l,this._calculateUniqueValues(r,e.returnDistinctValues))}const c=a.get(l);for(const t in c){const{data:n,items:i}=c[t],s=n.join(",");r&&!e.validateItems(i,r)||o.add(s)}}return o.size}async createQueryResponse(){let e;if(e=this.query.outStatistics?this.query.outStatistics.some((e=>"exceedslimit"===e.statisticType))?this._createExceedsLimitQueryResponse(this.query):await this._createStatisticsQueryResponse(this.query):this._createFeatureQueryResponse(this.query),this.query.returnQueryGeometry){const t=this.query.geometry;(0,g.fn)(this.query.outSR)&&!(0,g.aI)(t.spatialReference,this.query.outSR)?e.queryGeometry=(0,F.ag)({spatialReference:this.query.outSR,...(0,D.Cv)(t,t.spatialReference,this.query.outSR)}):e.queryGeometry=(0,F.ag)({spatialReference:this.query.outSR,...t})}return e}createSnappingResponse(e,t){const r=this.featureAdapter,n=J(this.hasZ,this.hasM),{point:i,mode:s}=e,a="number"==typeof e.distance?e.distance:e.distance.x,o="number"==typeof e.distance?e.distance:e.distance.y,l={candidates:[]},c="esriGeometryPolygon"===this.geometryType,u=this._getPointCreator(s,this.spatialReference,t),d=new Q(null,0),h=new Q(null,0),f={x:0,y:0,z:0};for(const t of this.items){const s=r.getGeometry(t);if(null==s)continue;const{coords:p,lengths:m}=s;if(d.coords=p,h.coords=p,e.returnEdge){let e=0;for(let s=0;s<m.length;s++){const c=m[s];for(let s=0;s<c;s++,e+=n){const p=d;if(p.coordsIndex=e,s!==c-1){const s=h;s.coordsIndex=e+n;const c=f;X(f,i,p,s);const d=(i.x-c.x)/a,m=(i.y-c.y)/o,g=d*d+m*m;g<=1&&l.candidates.push((0,Y.P)(r.getObjectId(t),u(c),Math.sqrt(g),u(p),u(s)))}}}}if("none"!==e.vertexMode){const s=c?p.length-n:p.length;if("all"===e.vertexMode)for(let e=0;e<s;e+=n){const n=d;n.coordsIndex=e;const s=(i.x-n.x)/a,c=(i.y-n.y)/o,h=s*s+c*c;h<=1&&l.candidates.push((0,Y.k)(r.getObjectId(t),u(n),Math.sqrt(h)))}else if("ends"===e.vertexMode){const e=[0];c||e.push(p.length-n);for(const n of e){const e=d;e.coordsIndex=n;const s=(i.x-e.x)/a,c=(i.y-e.y)/o,h=s*s+c*c;h<=1&&l.candidates.push((0,Y.k)(r.getObjectId(t),u(e),Math.sqrt(h)))}}}}return l.candidates.sort(((e,t)=>e.distance-t.distance)),l}_getPointCreator(e,t,r){const n=null==r||(0,g.aI)(t,r)?e=>e:e=>(0,D.Cv)(e,t,r),{hasZ:i}=this;return"3d"===e?i?({x:e,y:t,z:r})=>n({x:e,y:t,z:r}):({x:e,y:t})=>n({x:e,y:t,z:0}):({x:e,y:t})=>n({x:e,y:t})}async createSummaryStatisticsResponse(e){const{field:t,valueExpression:r,normalizationField:n,normalizationType:i,normalizationTotal:s,minValue:a,maxValue:o,scale:l,timeZone:c,outStatisticTypes:u}=e,d=this.fieldsIndex.get(t),h=(0,k.vE)(d)||(0,k.zD)(d)||(0,k.Ah)(d),f=await this._getDataValues({field:t,valueExpression:r,normalizationField:n,normalizationType:i,normalizationTotal:s,scale:l,timeZone:c}),p=(0,Z.Vb)({normalizationType:i,normalizationField:n,minValue:a,maxValue:o}),m={value:.5,fieldType:d?.type},g=(0,k.yM)(d)?(0,Z.z9)({values:f,supportsNullCount:p,percentileParams:m,outStatisticTypes:u}):(0,Z.G_)({values:f,minValue:a,maxValue:o,useSampleStdDev:!i,supportsNullCount:p,percentileParams:m,outStatisticTypes:u});return(0,Z.oZ)(g,u,h)}async createUniqueValuesResponse(e){const{field:t,valueExpression:r,domains:n,returnAllCodedValues:i,scale:s,timeZone:a}=e,o=await this._getDataValues({field:t,field2:e.field2,field3:e.field3,fieldDelimiter:e.fieldDelimiter,valueExpression:r,scale:s,timeZone:a},!1),l=(0,Z.b3)(o);return(0,Z.lv)(l,n,i,e.fieldDelimiter)}async createClassBreaksResponse(e){const{field:t,valueExpression:r,normalizationField:n,normalizationType:i,normalizationTotal:s,classificationMethod:a,standardDeviationInterval:o,minValue:l,maxValue:c,numClasses:u,scale:d,timeZone:h}=e,f=await this._getDataValues({field:t,valueExpression:r,normalizationField:n,normalizationType:i,normalizationTotal:s,scale:d,timeZone:h}),p=(0,Z.Rw)(f,{field:t,normalizationField:n,normalizationType:i,normalizationTotal:s,classificationMethod:a,standardDeviationInterval:o,minValue:l,maxValue:c,numClasses:u});return(0,Z.jM)(p,a)}async createHistogramResponse(e){const{field:t,valueExpression:r,normalizationField:n,normalizationType:i,normalizationTotal:s,classificationMethod:a,standardDeviationInterval:o,minValue:l,maxValue:c,numBins:u,scale:d,timeZone:h}=e,f=await this._getDataValues({field:t,valueExpression:r,normalizationField:n,normalizationType:i,normalizationTotal:s,scale:d,timeZone:h});return(0,Z.$y)(f,{field:t,normalizationField:n,normalizationType:i,normalizationTotal:s,classificationMethod:a,standardDeviationInterval:o,minValue:l,maxValue:c,numBins:u})}_sortFeatures(e,t,r){if(e.length>1&&t?.length)for(const n of t.reverse()){const t=n.split(" "),i=t[0],s=this.fieldsIndex.get(i),a=!!t[1]&&"desc"===t[1].toLowerCase(),o=(0,Z.FM)(s?.type,a);e.sort(((e,t)=>{const n=r(e,i,s),a=r(t,i,s);return o(n,a)}))}}_createFeatureQueryResponse(e){const t=this.items,{geometryType:r,hasM:n,hasZ:i,objectIdField:s,spatialReference:a}=this,{outFields:o,outSR:l,quantizationParameters:c,resultRecordCount:u,resultOffset:d,returnZ:h,returnM:f}=e,p=null!=u&&t.length>(d||0)+u,m=o&&(o.includes("*")?[...this.fieldsIndex.fields]:o.map((e=>this.fieldsIndex.get(e))));return{exceededTransferLimit:p,features:this._createFeatures(e,t),fields:m,geometryType:r,hasM:n&&f,hasZ:i&&h,objectIdFieldName:s,spatialReference:(0,F.ag)(l||a),transform:c&&(0,V.VV)(c)||null}}_createFeatures(e,t){const r=new W(e,this.featureAdapter,this.fieldsIndex),{hasM:n,hasZ:i}=this,{orderByFields:s,quantizationParameters:a,returnGeometry:o,returnCentroid:l,maxAllowableOffset:c,resultOffset:u,resultRecordCount:d,returnZ:h=!1,returnM:f=!1}=e,p=i&&h,m=n&&f;let g=[],_=0;const y=[...t];if(this._sortFeatures(y,s,((e,t,n)=>r.getFieldValue(e,t,n))),this.geometryType&&(o||l)){const e=(0,V.VV)(a)??void 0,t="esriGeometryPolygon"===this.geometryType||"esriGeometryPolyline"===this.geometryType;if(o&&!l)for(const n of y){const i=this.featureAdapter.getGeometry(n),s={attributes:r.getAttributes(n),geometry:(0,F.pL)(this.geometryType,this.hasZ,this.hasM,i,c,e,p,m)};t&&i&&!s.geometry&&(s.centroid=(0,F.LQ)(this,this.featureAdapter.getCentroid(n,this),e)),g[_++]=s}else if(!o&&l)for(const t of y)g[_++]={attributes:r.getAttributes(t),centroid:(0,F.LQ)(this,this.featureAdapter.getCentroid(t,this),e)};else for(const t of y)g[_++]={attributes:r.getAttributes(t),centroid:(0,F.LQ)(this,this.featureAdapter.getCentroid(t,this),e),geometry:(0,F.pL)(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(t),c,e,p,m)}}else for(const e of y){const t=r.getAttributes(e);t&&(g[_++]={attributes:t})}const v=u||0;if(null!=d){const e=v+d;g=g.slice(v,Math.min(g.length,e))}return g}_createExceedsLimitQueryResponse(e){let t=!1,r=Number.POSITIVE_INFINITY,n=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY;for(const t of e.outStatistics??[])if("exceedslimit"===t.statisticType){r=null!=t.maxPointCount?t.maxPointCount:Number.POSITIVE_INFINITY,n=null!=t.maxRecordCount?t.maxRecordCount:Number.POSITIVE_INFINITY,i=null!=t.maxVertexCount?t.maxVertexCount:Number.POSITIVE_INFINITY;break}if("esriGeometryPoint"===this.geometryType)t=this.items.length>r;else if(this.items.length>n)t=!0;else{const e=J(this.hasZ,this.hasM),r=this.featureAdapter;t=this.items.reduce(((e,t)=>{const n=r.getGeometry(t);return e+(null!=n&&n.coords.length||0)}),0)/e>i}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(t)}}]}}async _createStatisticsQueryResponse(e){const t={attributes:{}},r=[],n=new Map,i=new Map,s=new Map,a=new Map,o=new W(e,this.featureAdapter,this.fieldsIndex),l=e.outStatistics,{groupByFieldsForStatistics:c,having:u,orderByFields:d,resultRecordCount:h}=e,f=c?.length,p=!!f,m=p?c[0]:null,g=p&&!this.fieldsIndex.get(m);for(const e of l??[]){const{outStatisticFieldName:l,statisticType:d}=e,h=e,_="exceedslimit"!==d?e.onStatisticField:void 0,y="percentile_disc"===d||"percentile_cont"===d,v="EnvelopeAggregate"===d||"CentroidAggregate"===d||"ConvexHullAggregate"===d,T=p&&1===f&&(_===m||g)&&"count"===d;if(p){if(!s.has(_)){const e=[];for(const t of c){const r=this._getAttributeValues(o,t,n);e.push(r)}s.set(_,this._calculateUniqueValues(e,!v&&o.returnDistinctValues))}const e=s.get(_);if(!e)continue;const t=Object.keys(e);for(const r of t){const{count:t,data:i,items:s,itemPositions:d}=e[r],f=i.join(",");if(!u||o.validateItems(s,u)){const e=a.get(f)||{attributes:{}};if(v){e.aggregateGeometries||(e.aggregateGeometries={});const{aggregateGeometries:t,outStatisticFieldName:r}=await this._getAggregateGeometry(h,s);e.aggregateGeometries[r]=t}else{let r=null;if(T)r=t;else{const e=this._getAttributeValues(o,_,n),t=d.map((t=>e[t]));r=y&&"statisticParameters"in h?this._getPercentileValue(h,t):this._getStatisticValue(h,t,null,o.returnDistinctValues)}e.attributes[l]=r}let r=0;c.forEach(((t,n)=>e.attributes[this.fieldsIndex.get(t)?t:"EXPR_"+ ++r]=i[n])),a.set(f,e)}}}else if(v){t.aggregateGeometries||(t.aggregateGeometries={});const{aggregateGeometries:e,outStatisticFieldName:r}=await this._getAggregateGeometry(h,this.items);t.aggregateGeometries[r]=e}else{const e=this._getAttributeValues(o,_,n);t.attributes[l]=y&&"statisticParameters"in h?this._getPercentileValue(h,e):this._getStatisticValue(h,e,i,o.returnDistinctValues)}const b="min"!==d&&"max"!==d||!(0,k.yM)(this.fieldsIndex.get(_))&&!this._isAnyDateField(_)?null:this.fieldsIndex.get(_)?.type;r.push({name:l,alias:l,type:b||"esriFieldTypeDouble"})}const _=p?Array.from(a.values()):[t];return this._sortFeatures(_,d,((e,t)=>e.attributes[t])),h&&(_.length=Math.min(h,_.length)),{fields:r,features:_}}_isAnyDateField(e){const t=this.fieldsIndex.get(e);return(0,k.vE)(t)||(0,k.zD)(t)||(0,k.Ah)(t)||(0,k.OH)(t)}async _getAggregateGeometry(e,t){const{convexHull:n,union:i}=await r.e(4696).then(r.bind(r,28356)),{statisticType:s,outStatisticFieldName:a}=e,{featureAdapter:o,spatialReference:l,geometryType:c,hasZ:u,hasM:d}=this,h=t.map((e=>(0,F.pL)(c,u,d,o.getGeometry(e)))),f=n(l,h,!0)[0],p={aggregateGeometries:null,outStatisticFieldName:null};if("EnvelopeAggregate"===s){const e=f?(0,H.v)(f):(0,H.HA)(i(l,h));p.aggregateGeometries={...e,spatialReference:l},p.outStatisticFieldName=a||"extent"}else if("CentroidAggregate"===s){const e=f?(0,z.l8)(f):(0,z.Z4)((0,H.HA)(i(l,h)));p.aggregateGeometries={x:e[0],y:e[1],spatialReference:l},p.outStatisticFieldName=a||"centroid"}else"ConvexHullAggregate"===s&&(p.aggregateGeometries=f,p.outStatisticFieldName=a||"convexHull");return p}_getStatisticValue(e,t,r,n){const{onStatisticField:i,statisticType:s}=e;let a=null;return a=r?.has(i)?r.get(i):(0,k.yM)(this.fieldsIndex.get(i))||this._isAnyDateField(i)?(0,Z.z9)({values:t,returnDistinct:n}):(0,Z.G_)({values:n?[...new Set(t)]:t,minValue:null,maxValue:null,useSampleStdDev:!0}),r&&r.set(i,a),a["var"===s?"variance":s]}_getPercentileValue(e,t){const{onStatisticField:r,statisticParameters:n,statisticType:i}=e,{value:s,orderBy:a}=n,o=this.fieldsIndex.get(r);return(0,Z.qg)(t,{value:s,orderBy:a,fieldType:o?.type,isDiscrete:"percentile_disc"===i})}_getAttributeValues(e,t,r){if(r.has(t))return r.get(t);const n=this.fieldsIndex.get(t),i=this.items.map((r=>e.getFieldValue(r,t,n)));return r.set(t,i),i}_calculateUniqueValues(e,t){const r={},n=this.items,i=n.length;for(let s=0;s<i;s++){const i=n[s],a=[];for(const t of e)a.push(t[s]);const o=a.join(",");null==r[o]?r[o]={count:1,data:a,items:[i],itemPositions:[s]}:(t||r[o].count++,r[o].items.push(i),r[o].itemPositions.push(s))}return r}async _getDataValues(e,t=!0){const r=new W(this.query,this.featureAdapter,this.fieldsIndex),{valueExpression:n,scale:i,timeZone:s}=e;return n?r.getExpressionValues(this.items,n,{viewingMode:"map",scale:i,spatialReference:this.query.outSR||this.spatialReference},{geometryType:this.geometryType,hasZ:this.hasZ,hasM:this.hasM},s):r.getDataValues(this.items,(0,a.o8)(e),t)}}function X(e,t,r,n){const i=n.x-r.x,s=n.y-r.y,a=i*i+s*s,o=(t.x-r.x)*i+(t.y-r.y)*s,l=Math.min(1,Math.max(0,o/a));e.x=r.x+i*l,e.y=r.y+s*l}function J(e,t){return e?t?4:3:t?3:2}class Q{constructor(e,t){this.coords=e,this.coordsIndex=t}get x(){return this.coords[this.coordsIndex]}get y(){return this.coords[this.coordsIndex+1]}get z(){return this.coords[this.coordsIndex+2]}}var K=r(20932),ee=r(62512);const te="unsupported-query";async function re(e,{fieldsIndex:t,geometryType:r,spatialReference:n,availableFields:s}){if((e.distance??0)<0||null!=e.geometryPrecision||e.multipatchOption&&"xyFootprint"!==e.multipatchOption||e.pixelSize||e.relationParam||e.text)throw new i.A(te,"Unsupported query options",{query:e});return ne(t,s,e),function(e,t,r){const{outStatistics:n,groupByFieldsForStatistics:s,having:a}=r,o=s?.length,l=n?.length;if(a){if(!o||!l)throw new i.A(te,"outStatistics and groupByFieldsForStatistics should be specified with having",{query:r});R(e,t,a,n,r)}if(l){if(null==(c=n)||!c.every((e=>"exceedslimit"!==e.statisticType)))return;const a=n.map((e=>e.onStatisticField)).filter(Boolean);N(e,t,a,{expressionName:"onStatisticFields",query:r}),o&&N(e,t,s,{expressionName:"groupByFieldsForStatistics",query:r});for(const s of n){const{onStatisticField:n,statisticType:a}=s;if("percentile_disc"!==a&&"percentile_cont"!==a||!("statisticParameters"in s))e.get(n)&&"count"!==a&&"min"!==a&&"max"!==a&&N(e,t,[n],{expressionName:`outStatistics with '${a}' statistic type`,allowedFieldTypes:ie,query:r});else{const{statisticParameters:e}=s;if(!e)throw new i.A(te,"statisticParameters should be set for percentile type",{definition:s,query:r})}}}var c}(t,s,e),Promise.all([(0,ee.c0)(e,r,n),(0,D.Nk)(n,e.outSR)]).then((()=>e))}function ne(e,t,r){const{outFields:n,orderByFields:s,returnDistinctValues:a,outStatistics:o}=r,l=o?o.map((e=>e.outStatisticFieldName&&e.outStatisticFieldName.toLowerCase())).filter(Boolean):[];if(s&&s.length>0){const n=" asc",i=" desc",a=s.map((e=>{const t=e.toLowerCase();return t.includes(n)?t.split(n)[0]:t.includes(i)?t.split(i)[0]:e})).filter((e=>!l.includes(e)));N(e,t,a,{expressionName:"orderByFields",query:r})}if(n&&n.length>0)N(e,t,n,{expressionName:"outFields",query:r,allowedFieldTypes:"all"});else if(a)throw new i.A(te,"outFields should be specified for returnDistinctValues",{query:r});!function(e,t,r,n){if(!r)return!0;const i="where clause";N(e,t,x(e,r,{validateStandardized:!0,expressionName:i}),{expressionName:i,query:n})}(e,t,r.where,r)}const ie=new Set([...E,...w]);async function se(e,t,r,n){let s=[];if(r.valueExpression){const{arcadeUtils:e}=await(0,q.lw)();s=e.extractFieldNames(r.valueExpression)}if(r.field&&s.push(r.field),r.field2&&s.push(r.field2),r.field3&&s.push(r.field3),r.normalizationField&&s.push(r.normalizationField),!s.length&&!r.valueExpression)throw new i.A(te,"field or valueExpression is required",{params:r});N(e,t,s,{expressionName:"statistics",query:n})}var ae=r(20973),oe=r(7103),le=r(48961);class ce{constructor(e){this._cache=new P,this._changeHandle=null,this.capabilities={query:G.F},this.geometryType=e.geometryType,this.hasM=!!e.hasM,this.hasZ=!!e.hasZ,this.objectIdField=e.objectIdField,this.spatialReference=e.spatialReference,this.definitionExpression=e.definitionExpression,this.featureStore=e.featureStore,this.aggregateAdapter=e.aggregateAdapter,this._changeHandle=this.featureStore.events.on("changed",(()=>this.clearCache())),this.timeInfo=e.timeInfo,this.fieldsIndex=(0,s.Wj)(e.fieldsIndex)?e.fieldsIndex:oe.A.fromJSON(e.fieldsIndex),!e.availableFields||1===e.availableFields.length&&"*"===e.availableFields[0]?this.availableFields=new Set(this.fieldsIndex.fields.map((e=>e.name))):this.availableFields=new Set(e.availableFields.map((e=>this.fieldsIndex.get(e)?.name)).filter((e=>null!=e))),e.scheduler&&e.priority&&(this._frameTask=e.scheduler.registerTask(e.priority))}destroy(){this._frameTask=(0,o.xt)(this._frameTask),this.clearCache(),(0,o.pR)(this._cache),this._changeHandle=(0,o.xt)(this._changeHandle)}get featureAdapter(){return this.featureStore.featureAdapter}clearCache(){this._cache.clear(),this._allFeaturesPromise=null,this._timeExtentPromise=null,this._fullExtentPromise=null}async executeQuery(e,t){const r=(0,l.Mq)(t);try{const t=await this._executeQuery(e,{},r);return await t.createQueryResponse()}catch(t){if(t!==K.v8)throw t;return new $([],e,this).createQueryResponse()}}async executeQueryForCount(e={},t){const r=(0,l.Mq)(t);try{return(await this._executeQuery(e,{returnGeometry:!1,returnCentroid:!1,outSR:null},r)).createQueryResponseForCount()}catch(e){if(e!==K.v8)throw e;return 0}}async executeQueryForExtent(e,t){const r=(0,l.Mq)(t),n=e.outSR;try{const t=await this._executeQuery(e,{returnGeometry:!0,returnCentroid:!1,outSR:null},r),i=t.size;return i?{count:i,extent:await this._getBounds(t.items,t.spatialReference,n||this.spatialReference)}:{count:0,extent:null}}catch(e){if(e===K.v8)return{count:0,extent:null};throw e}}async executeQueryForIds(e,t){return this.executeQueryForIdSet(e,t).then((e=>Array.from(e)))}async executeQueryForIdSet(e,t){const r=(0,l.Mq)(t);try{const t=await this._executeQuery(e,{returnGeometry:!0,returnCentroid:!1,outSR:null},r),n=t.items,i=new Set;return await this._reschedule((()=>{for(const e of n)i.add(t.featureAdapter.getObjectId(e))}),r),i}catch(e){if(e===K.v8)return new Set;throw e}}async executeQueryForSnapping(e,t){const r=(0,l.Mq)(t),{point:n,distance:i,returnEdge:s,vertexMode:o}=e;if(!s&&"none"===o)return{candidates:[]};let c=(0,a.o8)(e.query);c=await this._schedule((()=>(0,K.T2)(c,this.definitionExpression,this.spatialReference)),r),c=await this._reschedule((()=>re(c,{availableFields:this.availableFields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,spatialReference:this.spatialReference})),r);const u=!(0,g.aI)(n.spatialReference,this.spatialReference);u&&await(0,D.Nk)(n.spatialReference,this.spatialReference);const d="number"==typeof i?i:i.x,h="number"==typeof i?i:i.y,f={xmin:n.x-d,xmax:n.x+d,ymin:n.y-h,ymax:n.y+h,spatialReference:n.spatialReference},_=u?(0,D.Cv)(f,this.spatialReference):f;if(!_)return{candidates:[]};const y=(await(0,m.el)((0,p.rS)(n),null,{signal:r}))[0],v=(await(0,m.el)((0,p.rS)(_),null,{signal:r}))[0];if(null==y||null==v)return{candidates:[]};const T=new $(await this._reschedule((()=>this._searchFeatures(ue(v.toJSON()))),r),c,this);await this._reschedule((()=>this._executeObjectIdsQuery(T)),r),await this._reschedule((()=>this._executeTimeQuery(T)),r),await this._reschedule((()=>this._executeAttributesQuery(T)),r),await this._reschedule((()=>this._executeGeometryQueryForSnapping(T,r)),r);const b=y.toJSON(),S=u?(0,D.Cv)(b,this.spatialReference):b,A=u?Math.max(_.xmax-_.xmin,_.ymax-_.ymin)/2:i;return T.createSnappingResponse({...e,point:S,distance:A},n.spatialReference)}async executeQueryForLatestObservations(e,t){const r=(0,l.Mq)(t);if(!this.timeInfo?.trackIdField)throw new i.A("unsupported-query","Missing timeInfo or timeInfo.trackIdField",{query:e,timeInfo:this.timeInfo});try{const t=await this._executeQuery(e,{},r);return await this._reschedule((()=>this._filterLatest(t)),r),await t.createQueryResponse()}catch(t){if(t!==K.v8)throw t;return new $([],e,this).createQueryResponse()}}async executeQueryForSummaryStatistics(e={},t,r){const n=(0,l.Mq)(r),{field:i,normalizationField:s,valueExpression:a}=t;return(await this._executeQueryForStatistics(e,{field:i,normalizationField:s,valueExpression:a},n)).createSummaryStatisticsResponse(t)}async executeQueryForUniqueValues(e={},t,r){const n=(0,l.Mq)(r),{field:i,field2:s,field3:a,valueExpression:o}=t;return(await this._executeQueryForStatistics(e,{field:i,field2:s,field3:a,valueExpression:o},n)).createUniqueValuesResponse(t)}async executeQueryForClassBreaks(e={},t,r){const n=(0,l.Mq)(r),{field:i,normalizationField:s,valueExpression:a}=t;return(await this._executeQueryForStatistics(e,{field:i,normalizationField:s,valueExpression:a},n)).createClassBreaksResponse(t)}async executeQueryForHistogram(e={},t,r){const n=(0,l.Mq)(r),{field:i,normalizationField:s,valueExpression:a}=t;return(await this._executeQueryForStatistics(e,{field:i,normalizationField:s,valueExpression:a},n)).createHistogramResponse(t)}async fetchRecomputedExtents(e){const t=(0,l.Mq)(e);this._timeExtentPromise||=(0,ae.W)(this.timeInfo,this.featureStore);const[r,n]=await Promise.all([this._getFullExtent(),this._timeExtentPromise]);return(0,l.Te)(t),{fullExtent:r,timeExtent:n}}async _getBounds(e,t,r){const n=(0,d.hZ)((0,d.vt)(),d.qv);await this.featureStore.forEachBounds(e,(e=>(0,d.RF)(n,e)));const i={xmin:n[0],ymin:n[1],xmax:n[3],ymax:n[4],spatialReference:(0,F.ag)(this.spatialReference)};this.hasZ&&isFinite(n[2])&&isFinite(n[5])&&(i.zmin=n[2],i.zmax=n[5],i.hasZ=!0);const s=(0,D.Cv)(i,t,r);if(s.spatialReference=(0,F.ag)(r),s.xmax-s.xmin==0){const e=(0,c.GA)(s.spatialReference);s.xmin-=e,s.xmax+=e}if(s.ymax-s.ymin==0){const e=(0,c.GA)(s.spatialReference);s.ymin-=e,s.ymax+=e}if(this.hasZ&&null!=s.zmin&&null!=s.zmax&&s.zmax-s.zmin==0){const e=(0,c.GA)(s.spatialReference);s.zmin-=e,s.zmax+=e}return s}_getFullExtent(){return this._fullExtentPromise||="getFullExtent"in this.featureStore&&this.featureStore.getFullExtent?Promise.resolve(this.featureStore.getFullExtent(this.spatialReference)):this._getAllFeatures().then((e=>this._getBounds(e,this.spatialReference,this.spatialReference))),this._fullExtentPromise}async _schedule(e,t){return null!=this._frameTask?this._frameTask.schedule(e,t):e(le.Bb)}async _reschedule(e,t){return null!=this._frameTask?this._frameTask.reschedule(e,t):e(le.Bb)}async _getAllFeaturesQueryEngineResult(e){return new $(await this._getAllFeatures(),e,this)}async _getAllFeatures(){if(null==this._allFeaturesPromise){const e=[];this._allFeaturesPromise=(async()=>{await this.featureStore.forEach((t=>e.push(t)))})().then((()=>e))}const e=this._allFeaturesPromise,t=await e;return e===this._allFeaturesPromise?t.slice():this._getAllFeatures()}async _executeQuery(e,t,r){e=(0,a.o8)(e),e=await this._schedule((()=>(0,K.GC)(e,this.definitionExpression,this.spatialReference)),r),e=await this._reschedule((()=>re(e,{availableFields:this.availableFields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,spatialReference:this.spatialReference})),r),e={...e,...t};const n=await this._reschedule((()=>this._executeSceneFilterQuery(e,r)),r),i=await this._reschedule((()=>this._executeGeometryQuery(e,n,r)),r);return await this._reschedule((()=>this._executeAggregateIdsQuery(i)),r),await this._reschedule((()=>this._executeObjectIdsQuery(i)),r),await this._reschedule((()=>this._executeTimeQuery(i)),r),await this._reschedule((()=>this._executeAttributesQuery(i)),r),i}async _executeSceneFilterQuery(e,t){if(null==e.sceneFilter)return null;const{outSR:r,returnGeometry:n,returnCentroid:i}=e,s=this.featureStore.featureSpatialReference,a=e.sceneFilter.geometry,o=null==s||(0,g.aI)(s,a.spatialReference)?a:(0,D.Cv)(a,s);if(!o)return null;const l=n||i,c=(0,g.fn)(r)&&!(0,g.aI)(this.spatialReference,r)&&l?async e=>this._project(e,r):e=>e,u=this.featureAdapter,d=await this._reschedule((()=>this._searchFeatures(ue(o))),t);if("disjoint"===e.sceneFilter.spatialRelationship){if(!d.length)return null;const r=new Set;for(const e of d)r.add(u.getObjectId(e));const n=await this._reschedule((()=>this._getAllFeatures()),t),i=await this._reschedule((async()=>{const i=await(0,ee.xt)("esriSpatialRelDisjoint",o,this.geometryType,this.hasZ,this.hasM),s=await this._runSpatialFilter(n,(e=>!r.has(u.getObjectId(e))||i(u.getGeometry(e))),t);return new $(s,e,this)}),t);return c(i)}if(!d.length)return new $([],e,this);if(this._canExecuteSinglePass(o,e))return c(new $(d,e,this));const h=await(0,ee.xt)("esriSpatialRelContains",o,this.geometryType,this.hasZ,this.hasM),f=await this._runSpatialFilter(d,(e=>h(u.getGeometry(e))),t);return c(new $(f,e,this))}async _executeGeometryQuery(e,t,r){if(null!=t&&0===t.items.length)return t;e=null!=t?t.query:e;const{geometry:i,outSR:s,spatialRel:a,returnGeometry:o,returnCentroid:l}=e,c=this.featureStore.featureSpatialReference,u=!i||null==c||(0,g.aI)(c,i.spatialReference)?i:(0,D.Cv)(i,c),d=o||l,h=(0,g.fn)(s)&&!(0,g.aI)(this.spatialReference,s),f=null==t?this._getCacheKey(e):null,p=f?this._cache.get(f):null;if(null!=p)return new $(p,e,this);const m=async e=>(h&&d&&await this._project(e,s),f&&this._cache.put(f,e.items),e);if(!u)return m(null!=t?t:await this._getAllFeaturesQueryEngineResult(e));const _=this.featureAdapter;let y=await this._reschedule((()=>this._searchFeatures(ue(i))),r);if("esriSpatialRelDisjoint"===a){if(!y.length)return m(null!=t?t:await this._getAllFeaturesQueryEngineResult(e));const n=new Set;for(const e of y)n.add(_.getObjectId(e));const i=null!=t?t.items:await this._reschedule((()=>this._getAllFeatures()),r),s=await this._reschedule((async()=>{const t=await(0,ee.xt)(a,u,this.geometryType,this.hasZ,this.hasM),s=await this._runSpatialFilter(i,(e=>!n.has(_.getObjectId(e))||t(_.getGeometry(e))),r);return new $(s,e,this)}),r);return m(s)}if(null!=t){const e=new n.vW;y=y.filter((r=>(0,n.qh)(t.items,r,t.items.length,e)>=0))}if(!y.length){const t=new $([],e,this);return f&&this._cache.put(f,t.items),t}if(this._canExecuteSinglePass(u,e))return m(new $(y,e,this));const v=await(0,ee.xt)(a,u,this.geometryType,this.hasZ,this.hasM),T=await this._runSpatialFilter(y,(e=>v(_.getGeometry(e))),r);return m(new $(T,e,this))}async _executeGeometryQueryForSnapping(e,t){const{query:r}=e,{spatialRel:n}=r;if(!e?.items?.length||!r.geometry||!n)return;const i=await(0,ee.xt)(n,r.geometry,this.geometryType,this.hasZ,this.hasM),s=await this._runSpatialFilter(e.items,(e=>i(e.geometry)),t);e.items=s}_executeAggregateIdsQuery(e){if(0===e.items.length||!e.query.aggregateIds?.length||null==this.aggregateAdapter)return;const t=new Set;for(const r of e.query.aggregateIds)this.aggregateAdapter.getFeatureObjectIds(r).forEach((e=>t.add(e)));const r=this.featureAdapter.getObjectId;e.items=e.items.filter((e=>t.has(r(e))))}_executeObjectIdsQuery(e){if(0===e.items.length||!e.query.objectIds?.length)return;const t=new Set(e.query.objectIds),r=this.featureAdapter.getObjectId;e.items=e.items.filter((e=>t.has(r(e))))}_executeTimeQuery(e){if(0===e.items.length)return;const t=(0,ae.I)(this.timeInfo,e.query.timeExtent,this.featureAdapter);null!=t&&(e.items=e.items.filter(t))}_executeAttributesQuery(e){if(0===e.items.length)return;const t=M(e.query.where,this.fieldsIndex);if(t){if(!t.isStandardized)throw new TypeError("Where clause is not standardized");e.items=e.items.filter((e=>t.testFeature(e,this.featureAdapter)))}}async _runSpatialFilter(e,t,r){if(!t)return e;if(null==this._frameTask)return e.filter((e=>t(e)));let n=0;const i=new Array,s=async a=>{for(;n<e.length;){const o=e[n++];t(o)&&(i.push(o),a.madeProgress()),a.done&&await this._reschedule((e=>s(e)),r)}};return this._reschedule((e=>s(e)),r).then((()=>i))}_filterLatest(e){const{trackIdField:t,startTimeField:r,endTimeField:n}=this.timeInfo,i=n||r,s=new Map,a=this.featureAdapter.getAttribute;for(const r of e.items){const e=a(r,t),n=a(r,i),o=s.get(e);(!o||n>a(o,i))&&s.set(e,r)}e.items=Array.from(s.values())}_getCacheKey(e){const{geometry:t,spatialRel:r,returnGeometry:n,returnCentroid:i,outSR:s,resultType:a,cacheHint:o}=e;if("tile"!==a&&!o)return null;const l=n||i;return(0,g.fn)(s)&&!(0,g.aI)(this.spatialReference,s)&&l?JSON.stringify([t,r,s]):JSON.stringify([t,r])}_canExecuteSinglePass(e,t){const{spatialRel:r}=t;return(0,ee.tC)(e)&&("esriSpatialRelEnvelopeIntersects"===r||"esriGeometryPoint"===this.geometryType&&("esriSpatialRelIntersects"===r||"esriSpatialRelContains"===r))}async _project(e,t){if(!t||(0,g.aI)(this.spatialReference,t))return e;const r=this.featureAdapter;let n;try{const e=await this._getFullExtent();n=(0,u.getTransformation)(this.spatialReference,t,e)}catch{}const i=await(0,D.lK)(e.items.map((e=>(0,F.pL)(this.geometryType,this.hasZ,this.hasM,r.getGeometry(e)))),this.spatialReference,t,n);return e.items=i.map(((t,n)=>r.cloneWithGeometry(e.items[n],(0,_.Ux)(t,this.hasZ,this.hasM)))),e}async _searchFeatures(e){const t=new Set;await Promise.all(e.map((e=>this.featureStore.forEachInBounds(e,(e=>t.add(e))))));const r=Array.from(t.values());return t.clear(),r}async _executeQueryForStatistics(e,t,r){e=(0,a.o8)(e);try{e=await this._schedule((()=>(0,K.GC)(e,this.definitionExpression,this.spatialReference)),r),e=await this._reschedule((()=>async function(e,t,{fieldsIndex:r,geometryType:n,spatialReference:s,availableFields:a}){if((e.distance??0)<0||null!=e.geometryPrecision||e.multipatchOption||e.pixelSize||e.relationParam||e.text||e.outStatistics||e.groupByFieldsForStatistics||e.having||e.orderByFields)throw new i.A(te,"Unsupported query options",{query:e});return ne(r,a,e),Promise.all([se(r,a,t,e),(0,ee.c0)(e,n,s),(0,D.Nk)(s,e.outSR)]).then((()=>e))}(e,t,{availableFields:this.availableFields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,spatialReference:this.spatialReference})),r);const n=await this._reschedule((()=>this._executeSceneFilterQuery(e,r)),r),s=await this._reschedule((()=>this._executeGeometryQuery(e,n,r)),r);return await this._reschedule((()=>this._executeAggregateIdsQuery(s)),r),await this._reschedule((()=>this._executeObjectIdsQuery(s)),r),await this._reschedule((()=>this._executeTimeQuery(s)),r),await this._reschedule((()=>this._executeAttributesQuery(s)),r),s}catch(t){if(t!==K.v8)throw t;return new $([],e,this)}}}function ue(e){if((0,ee.tC)(e)){if((0,p.ZC)(e))return[(0,h.fA)(Math.min(e.xmin,e.xmax),Math.min(e.ymin,e.ymax),Math.max(e.xmin,e.xmax),Math.max(e.ymin,e.ymax))];if((0,p.Bi)(e))return e.rings.map((e=>(0,h.fA)(Math.min(e[0][0],e[2][0]),Math.min(e[0][1],e[2][1]),Math.max(e[0][0],e[2][0]),Math.max(e[0][1],e[2][1]))))}return[(0,f.Rg)((0,h.vt)(),e)]}},7121:function(e,t,r){r.d(t,{F:function(){return n}});const n={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsCentroid:!0,supportsCacheHint:!0,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!0,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsTopFeaturesQuery:!1,supportsQueryByAnonymous:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsCompactGeometry:!1,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}},51376:function(e,t,r){function n(e,t,r){return{objectId:e,target:t,distance:r,type:"vertex"}}function i(e,t,r,n,i,s=!1){return{objectId:e,target:t,distance:r,type:"edge",start:n,end:i,draped:s}}r.d(t,{P:function(){return i},k:function(){return n}})},78956:function(e,t,r){r.d(t,{LQ:function(){return c},ag:function(){return d},pL:function(){return u}});var n=r(58081),i=r(76613);const s=new i.A,a=new i.A,o=new i.A,l={esriGeometryPoint:n.DF,esriGeometryPolyline:n.BW,esriGeometryPolygon:n.z5,esriGeometryMultipoint:n.qK};function c(e,t,r,i=e.hasZ,s=e.hasM){if(null==t)return null;const a=e.hasZ&&i,l=e.hasM&&s;if(r){const c=(0,n.Nl)(o,t,e.hasZ,e.hasM,"esriGeometryPoint",r,i,s);return(0,n.DF)(c,a,l)}return(0,n.DF)(t,a,l)}function u(e,t,r,i,c,u,d=t,h=r){const f=t&&d,p=r&&h,m=null!=i?"coords"in i?i:i.geometry:null;if(null==m)return null;if(c){let i=(0,n.kz)(a,m,t,r,e,c,d,h);return u&&(i=(0,n.Nl)(o,i,f,p,e,u)),l[e]?.(i,f,p)??null}if(u){const i=(0,n.Nl)(o,m,t,r,e,u,d,h);return l[e]?.(i,f,p)??null}return(0,n.Q4)(s,m,t,r,d,h),l[e]?.(s,f,p)??null}function d(e){return e&&h in e?JSON.parse(JSON.stringify(e,f)):e}const h="_geVersion",f=(e,t)=>e!==h?t:void 0},74841:function(e,t,r){r.d(t,{Cv:function(){return g},Nk:function(){return f},lK:function(){return y}});var n=r(50659),i=r(60539),s=r(46157),a=r(86029),o=r(57652),l=r(1644);const c=[0,0];function u(e,t){if(!t)return null;if("x"in t){const r={x:0,y:0};return[r.x,r.y]=e(t.x,t.y,c),null!=t.z&&(r.z=t.z),null!=t.m&&(r.m=t.m),r}if("xmin"in t){const r={xmin:0,ymin:0,xmax:0,ymax:0};return[r.xmin,r.ymin]=e(t.xmin,t.ymin,c),[r.xmax,r.ymax]=e(t.xmax,t.ymax,c),t.hasZ&&(r.zmin=t.zmin,r.zmax=t.zmax,r.hasZ=!0),t.hasM&&(r.mmin=t.mmin,r.mmax=t.mmax,r.hasM=!0),r}return"rings"in t?{rings:d(t.rings,e),hasM:t.hasM,hasZ:t.hasZ}:"paths"in t?{paths:d(t.paths,e),hasM:t.hasM,hasZ:t.hasZ}:"points"in t?{points:h(t.points,e),hasM:t.hasM,hasZ:t.hasZ}:null}function d(e,t){const r=[];for(const n of e)r.push(h(n,t));return r}function h(e,t){const r=[];for(const n of e){const e=t(n[0],n[1],[0,0]);r.push(e),n.length>2&&e.push(n[2]),n.length>3&&e.push(n[3])}return r}async function f(e,t){if(!e||!t)return;const r=Array.isArray(e)?e.map((e=>null!=e.geometry?e.geometry.spatialReference:null)).filter(n.Ru):[e];await(0,s.initializeProjection)(r.map((e=>({source:e,dest:t}))))}const p=u.bind(null,l.je),m=u.bind(null,l.tD);function g(e,t,r,n){if(!e)return e;if(r||(r=t,t=e.spatialReference),!(0,o.fn)(t)||!(0,o.fn)(r)||(0,o.aI)(t,r))return e;if((0,l.y7)(t,r)){const t=(0,o.K8)(r)?p(e):m(e);return t.spatialReference=r,t}return(0,s.projectMany)(a.g,[e],t,r,null,n)[0]}const _=new class{constructor(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}async push(e,t,r,n){if(!e?.length||!t||!r||(0,o.aI)(t,r))return e;const s={geometries:e,inSpatialReference:t,outSpatialReference:r,geographicTransformation:n,resolve:(0,i.Tw)()};return this._jobs.push(s),this._timer??=setTimeout(this._process,10),s.resolve.promise}_process(){this._timer=null;const e=this._jobs.shift();if(!e)return;const{geometries:t,inSpatialReference:r,outSpatialReference:n,resolve:i,geographicTransformation:c}=e;(0,l.y7)(r,n)?(0,o.K8)(n)?i(t.map(p)):i(t.map(m)):i((0,s.projectMany)(a.g,t,r,n,c,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}};function y(e,t,r,n){return _.push(e,t,r,n)}},20932:function(e,t,r){r.d(t,{GC:function(){return f},T2:function(){return p},VY:function(){return d},v8:function(){return h}});var n=r(73037),i=r(62938),s=r(46157),a=r(38503),o=r(74697),l=r(65298),c=r(57652),u=r(74841);const d=new n.J({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),h=Object.freeze({});async function f(e,t,r){const{outFields:n,orderByFields:i,groupByFieldsForStatistics:s,outStatistics:a}=e;if(n)for(let e=0;e<n.length;e++)n[e]=n[e].trim();if(i)for(let e=0;e<i.length;e++)i[e]=i[e].trim();if(s)for(let e=0;e<s.length;e++)s[e]=s[e].trim();if(a)for(let e=0;e<a.length;e++)a[e].onStatisticField&&(a[e].onStatisticField=a[e].onStatisticField.trim());return e.geometry&&!e.outSR&&(e.outSR=e.geometry.spatialReference),p(e,t,r)}async function p(e,t,n){if(!e)return null;let{where:s}=e;if(e.where=s=s?.trim(),(!s||/^1 *= *1$/.test(s)||t&&t===s)&&(e.where=null),!e.geometry)return e;let f=await async function(e){const{distance:t,units:n}=e,s=e.geometry;if(null==t||"vertexAttributes"in s)return s;const a=s.spatialReference,o=n?d.fromJSON(n):(0,i.Ij)(a),l=a&&((0,c.EA)(a)||(0,c.K8)(a))?s:await(0,u.Nk)(a,c.KK).then((()=>(0,u.Cv)(s,c.KK)));return(await async function(){return(await r.e(4696).then(r.bind(r,28356))).geodesicBuffer}())(l.spatialReference,l,t,o)}(e);if(e.distance=0,e.units=null,"esriSpatialRelEnvelopeIntersects"===e.spatialRel){const{spatialReference:t}=e.geometry;f=(0,a.HA)(f),f.spatialReference=t}if(f){await(0,u.Nk)(f.spatialReference,n),f=function(e,t){const r=e.spatialReference;return m(e,t)&&(0,o.ZC)(e)?{spatialReference:r,rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]}:e}(f,n);const t=(await(0,l.el)((0,o.rS)(f)))[0];if(null==t)throw h;const r="quantizationParameters"in e&&e.quantizationParameters?.tolerance||"maxAllowableOffset"in e&&e.maxAllowableOffset||0,i=r&&m(f,n)?{densificationStep:8*r}:void 0,s=t.toJSON(),a=(0,u.Cv)(s,s.spatialReference,n,i);if(!a)throw h;a.spatialReference=n,e.geometry=a}return e}function m(e,t){if(!e)return!1;const r=e.spatialReference;return((0,o.ZC)(e)||(0,o.Bi)(e)||(0,o.Rg)(e))&&!(0,c.aI)(r,t)&&!(0,s.canProjectWithoutEngine)(r,t)}},62512:function(e,t,r){r.d(t,{tC:function(){return b},c0:function(){return T},xt:function(){return v}});var n=r(39819),i=r(61273),s=r(96127),a=r(74697),o=r(57652);function l(e,t){return e?t?4:3:t?3:2}function c(e,t,r,n,i,s){const a=l(i,s),{coords:o,lengths:c}=n;if(!c)return!1;for(let n=0,i=0;n<c.length;n++,i+=a)if(!u(e,t,r,o[i],o[i+1]))return!1;return!0}function u(e,t,r,n,i){if(!e)return!1;const s=l(t,r),{coords:a,lengths:o}=e;let c=!1,u=0;for(const e of o)c=d(c,a,s,u,e,n,i),u+=e*s;return c}function d(e,t,r,n,i,s,a){let o=e,l=n;for(let e=n,c=n+i*r;e<c;e+=r){l=e+r,l===c&&(l=n);const i=t[e],u=t[e+1],d=t[l],h=t[l+1];(u<a&&h>=a||h<a&&u>=a)&&i+(a-u)/(h-u)*(d-i)<s&&(o=!o)}return o}var h=r(58081),f=r(76613),p=r(78956),m=r(74841);const g="unsupported-query",_={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},y={spatialRelationship:{esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},queryGeometry:{esriGeometryPoint:!0,esriGeometryMultiPatch:!1,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},layerGeometry:{esriGeometryPoint:!0,esriGeometryMultiPatch:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1}};function v(e,t,n,o,l){if((0,a.Bi)(t)&&"esriGeometryPoint"===n&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e)){const e=(0,h.Ye)(new f.A,t,!1,!1);return Promise.resolve((t=>function(e,t,r,n){return u(e,!1,!1,n.coords[0],n.coords[1])}(e,0,0,t)))}if((0,a.Bi)(t)&&"esriGeometryMultipoint"===n){const r=(0,h.Ye)(new f.A,t,!1,!1);if("esriSpatialRelContains"===e)return Promise.resolve((e=>c(r,!1,!1,e,o,l)))}if((0,a.ZC)(t)&&"esriGeometryPoint"===n&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e))return Promise.resolve((e=>(0,i.qz)(t,(0,p.pL)(n,o,l,e))));if((0,a.ZC)(t)&&"esriGeometryMultipoint"===n&&"esriSpatialRelContains"===e)return Promise.resolve((e=>(0,i.rL)(t,(0,p.pL)(n,o,l,e))));if((0,a.ZC)(t)&&"esriSpatialRelIntersects"===e){const e="mesh"===(d=n)?s.xB:(0,s.xK)(d);return Promise.resolve((r=>e(t,(0,p.pL)(n,o,l,r))))}var d;return r.e(4696).then(r.bind(r,28356)).then((r=>{const i=r[_[e]].bind(null,t.spatialReference,t);return e=>i((0,p.pL)(n,o,l,e))}))}async function T(e,t,r){const{spatialRel:i,geometry:s}=e;if(s){if(!function(e){return null!=e&&!0===y.spatialRelationship[e]}(i))throw new n.A(g,"Unsupported query spatial relationship",{query:e});if((0,o.fn)(s.spatialReference)&&(0,o.fn)(r)){if(!function(e){return null!=e&&!0===y.queryGeometry[(0,a.$B)(e)]}(s))throw new n.A(g,"Unsupported query geometry type",{query:e});if(!function(e){return null!=e&&!0===y.layerGeometry[e]}(t))throw new n.A(g,"Unsupported layer geometry type",{query:e});if(e.outSR)return(0,m.Nk)(e.geometry?.spatialReference,e.outSR)}}}function b(e){if((0,a.ZC)(e))return!0;if((0,a.Bi)(e)){for(const t of e.rings){if(5!==t.length)return!1;if(t[0][0]!==t[1][0]||t[0][0]!==t[4][0]||t[2][0]!==t[3][0]||t[0][1]!==t[3][1]||t[0][1]!==t[4][1]||t[1][1]!==t[2][1])return!1}return!0}return!1}},20973:function(e,t,r){async function n(e,t){if(!e)return null;const r=t.featureAdapter,{startTimeField:n,endTimeField:i}=e;let s=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY;if(n&&i)await t.forEach((e=>{const t=r.getAttribute(e,n),o=r.getAttribute(e,i);null==t||isNaN(t)||(s=Math.min(s,t)),null==o||isNaN(o)||(a=Math.max(a,o))}));else{const e=n||i;await t.forEach((t=>{const n=r.getAttribute(t,e);null==n||isNaN(n)||(s=Math.min(s,n),a=Math.max(a,n))}))}return{start:s,end:a}}function i(e,t,r){if(!t||!e)return null;const{startTimeField:n,endTimeField:i}=e;if(!n&&!i)return null;const{start:s,end:a}=t;if(null===s&&null===a)return null;if(void 0===s&&void 0===a)return()=>!1;const o=r.getAttributeAsTimestamp?.bind(r)??r.getAttribute.bind(r);return n&&i?function(e,t,r,n,i){return null!=n&&null!=i?s=>{const a=e(s,t),o=e(s,r);return(null==a||a<=i)&&(null==o||o>=n)}:null!=n?t=>{const i=e(t,r);return null==i||i>=n}:null!=i?r=>{const n=e(r,t);return null==n||n<=i}:void 0}(o,n,i,s,a):function(e,t,r,n){return null!=r&&null!=n&&r===n?n=>e(n,t)===r:null!=r&&null!=n?i=>{const s=e(i,t);return null!=s&&s>=r&&s<=n}:null!=r?n=>{const i=e(n,t);return null!=i&&i>=r}:null!=n?r=>{const i=e(r,t);return null!=i&&i<=n}:void 0}(o,n||i,s,a)}r.d(t,{I:function(){return i},W:function(){return n}})},5915:function(e,t,r){function n(e){return"point"===e.type}r.d(t,{v:function(){return n}})},46460:function(e,t,r){function n(e,t,r,n){return{x:e,y:t,z:r,hasZ:null!=r,hasM:!1,spatialReference:n,type:"point"}}function i(e,t,r,n,i){e.x=t,e.y=r,e.z=n,e.hasZ=null!=n,e.spatialReference=i}r.d(t,{J:function(){return i},T:function(){return n}})},58081:function(e,t,r){r.d(t,{B2:function(){return b},BW:function(){return P},Ch:function(){return ie},DF:function(){return A},Di:function(){return j},E2:function(){return k},IE:function(){return T},Nl:function(){return K},Q4:function(){return se},Rk:function(){return oe},Ux:function(){return q},Ye:function(){return G},ZF:function(){return $},eU:function(){return z},eY:function(){return J},jH:function(){return Q},jQ:function(){return ne},kz:function(){return ee},oN:function(){return Z},q3:function(){return X},qK:function(){return F},qN:function(){return L},z5:function(){return U},zv:function(){return W}});var n=r(39819),i=r(40633),s=r(95929),a=r(24761),o=r(87416),l=r(74697),c=r(65215),u=r(72887),d=r(76613);function h(e,t){return e?t?4:3:t?3:2}const f=()=>i.A.getLogger("esri.layers.graphics.featureConversionUtils"),p={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryMultiPatch:3,esriGeometryEnvelope:0},m=(e,t,r,n,i,s)=>{e[r]=i,e[r+1]=s},g=(e,t,r,n,i,s)=>{e[r]=i,e[r+1]=s,e[r+2]=t[n+2]},_=(e,t,r,n,i,s)=>{e[r]=i,e[r+1]=s,e[r+2]=t[n+3]},y=(e,t,r,n,i,s)=>{e[r]=i,e[r+1]=s,e[r+2]=t[n+2],e[r+3]=t[n+3]};function v(e,t,r,n){if(e){if(r)return t&&n?y:g;if(t&&n)return _}else if(t&&n)return g;return m}function T({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}function b({scale:e,translate:t},r){return Math.round((t[1]-r)/e[1])}function S({scale:e,translate:t},r,n){return r*e[n]+t[n]}function A(e,t,r){return e?t?r?O(e):I(e):r?R(e):E(e):null}function E(e){const t=e.coords;return{x:t[0],y:t[1]}}function w(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e}function I(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2]}}function x(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e}function R(e){const t=e.coords;return{x:t[0],y:t[1],m:t[2]}}function M(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.m,e}function O(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2],m:t[3]}}function C(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e.coords[3]=t.m,e}function N(e,t){return e&&t?C:e?x:t?M:w}function L(e,t,r=N(null!=t.z,null!=t.m)){return r(e,t)}function F(e,t,r){if(null==e)return null;const n=h(t,r),i=[];for(let t=0;t<e.coords.length;t+=n){const r=[];for(let i=0;i<n;i++)r.push(e.coords[t+i]);i.push(r)}return t?r?{points:i,hasZ:t,hasM:r}:{points:i,hasZ:t}:r?{points:i,hasM:r}:{points:i}}function D(e,t,r=h(t.hasZ,t.hasM)){e.lengths[0]=t.points.length;const n=e.coords;let i=0;for(const e of t.points)for(let t=0;t<r;t++)n[i++]=e[t];return e}function P(e,t,r){if(!e)return null;const n=h(t,r),{coords:i,lengths:s}=e,a=[];let o=0;for(const e of s){const t=[];for(let r=0;r<e;r++){const e=[];for(let t=0;t<n;t++)e.push(i[o++]);t.push(e)}a.push(t)}return t?r?{paths:a,hasZ:t,hasM:r}:{paths:a,hasZ:t}:r?{paths:a,hasM:r}:{paths:a}}function B(e,t,r=h(t.hasZ,t.hasM)){const{lengths:n,coords:i}=e;let s=0;for(const e of t.paths){for(const t of e)for(let e=0;e<r;e++)i[s++]=t[e];n.push(e.length)}return e}function U(e,t,r){if(!e)return null;const n=h(t,r),{coords:i,lengths:s}=e,a=[];let o=0;for(const e of s){const t=[];for(let r=0;r<e;r++){const e=[];for(let t=0;t<n;t++)e.push(i[o++]);t.push(e)}a.push(t)}return t?r?{rings:a,hasZ:t,hasM:r}:{rings:a,hasZ:t}:r?{rings:a,hasM:r}:{rings:a}}function G(e,t,r=t.hasZ,n=t.hasM){return z(e,t.rings,r,n)}function z(e,t,r,n){const i=h(r,n),{lengths:s,coords:a}=e;let o=0;le(e);for(const e of t){for(const t of e)for(let e=0;e<i;e++)a[o++]=t[e];s.push(e.length)}return e}const H=[],V=[];function k(e,t,r,n,i){H[0]=e;const[s]=j(V,H,t,r,n,i);return ce(H),ce(V),s}function j(e,t,r,i,s,a){if(ce(e),!r){for(const r of t){const t=a?r.attributes[a]:void 0;e.push(new c.Om(null,r.attributes,null,t))}return e}switch(r){case"esriGeometryPoint":return function(e,t,r,n,i){const s=N(r,n);for(const{geometry:r,attributes:n}of t){const t=null!=r?s(new d.A,r):null;e.push(new c.Om(t,n,null,i?n[i]:void 0))}return e}(e,t,i,s,a);case"esriGeometryMultipoint":return function(e,t,r,n,i){const s=h(r,n);for(const{geometry:r,attributes:n}of t){const t=null!=r?D(new d.A,r,s):null;e.push(new c.Om(t,n,null,i?n[i]:void 0))}return e}(e,t,i,s,a);case"esriGeometryPolyline":return function(e,t,r,n,i){const s=h(r,n);for(const{geometry:r,attributes:n,centroid:a}of t){const t=null!=r?B(new d.A,r,s):null,o=null!=a?L(new d.A,a):null;e.push(new c.Om(t,n,o,i?n[i]:void 0))}return e}(e,t,i,s,a);case"esriGeometryPolygon":case"esriGeometryMultiPatch":return function(e,t,r,n,i){for(const{geometry:s,centroid:a,attributes:o}of t){const t=null!=s?G(new d.A,s,r,n):null,l=i?o[i]:void 0;null!=a?e.push(new c.Om(t,o,w(new d.A,a),l)):e.push(new c.Om(t,o,null,l))}return e}(e,t,i,s,a);default:f().error("convertToFeatureSet:unknown-geometry",new n.A(`Unable to parse unknown geometry type '${r}'`)),ce(e)}return e}function Z(e,t,r,n){V[0]=e,Y(H,V,t,r,n);const i=H[0];return ce(H),ce(V),i}function q(e,t,r){if(null==e)return null;const i=new d.A;return"hasZ"in e&&null==t&&(t=e.hasZ),"hasM"in e&&null==r&&(r=e.hasM),(0,l.fT)(e)?N(null!=t?t:null!=e.z,null!=r?r:null!=e.m)(i,e):(0,l.Bi)(e)?G(i,e,t,r):(0,l.Rg)(e)?B(i,e,h(t,r)):(0,l.U9)(e)?D(i,e,h(t,r)):void f().error("convertFromGeometry:unknown-geometry",new n.A(`Unable to parse unknown geometry type '${e}'`))}function W(e,t,r,i){const s=e&&("coords"in e?e:e.geometry);if(null==s)return null;switch(t){case"esriGeometryPoint":{let e=E;return r&&i?e=O:r?e=I:i&&(e=R),e(s)}case"esriGeometryMultipoint":return F(s,r,i);case"esriGeometryPolyline":return P(s,r,i);case"esriGeometryPolygon":return U(s,r,i);default:return f().error("convertToGeometry:unknown-geometry",new n.A(`Unable to parse unknown geometry type '${t}'`)),null}}function Y(e,t,r,i,s){if(ce(e),null==r)return function(e,t){for(const r of t)e.push({attributes:r.attributes});return e}(e,t);switch(r){case"esriGeometryPoint":return function(e,t,r,n){let i=E;r&&n?i=O:r?i=I:n&&(i=R);for(const r of t){const{geometry:t,attributes:n}=r,s=null!=t?i(t):null;e.push({attributes:n,geometry:s})}return e}(e,t,i,s);case"esriGeometryMultipoint":return function(e,t,r,n){for(const{geometry:i,attributes:s}of t)e.push({attributes:s,geometry:null!=i?F(i,r,n):null});return e}(e,t,i,s);case"esriGeometryPolyline":return function(e,t,r,n){for(const{geometry:i,attributes:s}of t)e.push({attributes:s,geometry:null!=i?P(i,r,n):null});return e}(e,t,i,s);case"esriGeometryPolygon":return function(e,t,r,n){for(const{geometry:i,attributes:s,centroid:a}of t){const t=null!=i?U(i,r,n):null;if(null!=a){const r=E(a);e.push({attributes:s,centroid:r,geometry:t})}else e.push({attributes:s,geometry:t})}return e}(e,t,i,s);default:f().error("convertToFeatureSet:unknown-geometry",new n.A(`Unable to parse unknown geometry type '${r}'`))}return e}function $(e){const{objectIdFieldName:t,spatialReference:r,transform:n,fields:i,hasM:s,hasZ:a,features:o,geometryType:l,exceededTransferLimit:c,uniqueIdField:u,queryGeometry:d,queryGeometryType:h}=e,f={features:Y([],o,l,a,s),fields:i,geometryType:l,objectIdFieldName:t,spatialReference:r,uniqueIdField:u,queryGeometry:W(d,h,!1,!1)};return n&&(f.transform=n),c&&(f.exceededTransferLimit=c),s&&(f.hasM=s),a&&(f.hasZ=a),f}function X(e,t){const r=new u.A,{hasM:i,hasZ:s,features:a,objectIdFieldName:o,spatialReference:l,geometryType:c,exceededTransferLimit:d,transform:h,fields:p}=e;return p&&(r.fields=p),r.geometryType=c??null,r.objectIdFieldName=o??t??null,r.spatialReference=l??null,r.objectIdFieldName?(a&&j(r.features,a,c,s,i,r.objectIdFieldName),d&&(r.exceededTransferLimit=d),i&&(r.hasM=i),s&&(r.hasZ=s),h&&(r.transform=h),r):(f().error(new n.A("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),r)}function J(e){const{transform:t,features:r,hasM:n,hasZ:i}=e;if(!t)return e;for(const e of r)null!=e.geometry&&ie(e.geometry,e.geometry,n,i,t),null!=e.centroid&&ie(e.centroid,e.centroid,n,i,t);return e.transform=null,e}function Q(e,t){const{geometryType:r,features:n,hasM:i,hasZ:s}=t;if(!e)return t;for(let t=0;t<n.length;t++){const a=n[t],o=a.weakClone();o.geometry=new d.A,K(o.geometry,a.geometry,i,s,r,e),a.centroid&&(o.centroid=new d.A,K(o.centroid,a.centroid,i,s,"esriGeometryPoint",e)),n[t]=o}return t.transform=e,t}function K(e,t,r,n,i,s,a=r,o=n){if(le(e),!t?.coords.length)return null;const l=p[i],{coords:c,lengths:u}=t,d=h(r,n),f=h(r&&a,n&&o),m=v(r,n,a,o);if(!u.length)return m(e.coords,c,0,0,T(s,c[0]),b(s,c[1])),le(e,d,0),e;let g,_,y,S,A=0,E=0,w=E;for(const t of u){if(t<l)continue;let r=0;E=w,y=g=T(s,c[A]),S=_=b(s,c[A+1]),m(e.coords,c,E,A,y,S),r++,A+=d,E+=f;for(let n=1;n<t;n++,A+=d)y=T(s,c[A]),S=b(s,c[A+1]),y===g&&S===_||(m(e.coords,c,E,A,y-g,S-_),E+=f,r++,g=y,_=S);r>=l&&(e.lengths.push(r),w=E)}return ce(e.coords,w),e.coords.length?e:null}function ee(e,t,r,n,i,s,a=r,o=n){if(le(e),!t?.coords.length)return null;const l=p[i],{coords:c,lengths:u}=t,d=h(r,n),f=h(r&&a,n&&o),m=v(r,n,a,o);if(!u.length)return m(e.coords,c,0,0,c[0],c[1]),le(e,d,0),e;let g=0;const _=s*s;for(const t of u){if(t<l){g+=t*d;continue}const r=e.coords.length/f,n=g,i=g+(t-1)*d;m(e.coords,c,e.coords.length,n,c[n],c[n+1]),re(e.coords,c,d,_,m,n,i),m(e.coords,c,e.coords.length,i,c[i],c[i+1]);const s=e.coords.length/f-r;s>=l?e.lengths.push(s):ce(e.coords,r*f),g+=t*d}return e.coords.length?e:null}function te(e,t,r,n){const i=e[t],s=e[t+1],a=e[r],o=e[r+1],l=e[n],c=e[n+1];let u=a,d=o,h=l-u,f=c-d;if(0!==h||0!==f){const e=((i-u)*h+(s-d)*f)/(h*h+f*f);e>1?(u=l,d=c):e>0&&(u+=h*e,d+=f*e)}return h=i-u,f=s-d,h*h+f*f}function re(e,t,r,n,i,s,a){let o,l=n,c=0;for(let e=s+r;e<a;e+=r)o=te(t,e,s,a),o>l&&(c=e,l=o);l>n&&(c-s>r&&re(e,t,r,n,i,s,c),i(e,t,e.length,c,t[c],t[c+1]),a-c>r&&re(e,t,r,n,i,c,a))}function ne(e,t,r,n){if(!t?.coords?.length)return null;const i=h(r,n);let s=Number.POSITIVE_INFINITY,l=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,u=Number.NEGATIVE_INFINITY;if(t&&t.coords){const e=t.coords;for(let t=0;t<e.length;t+=i){const r=e[t],n=e[t+1];s=Math.min(s,r),c=Math.max(c,r),l=Math.min(l,n),u=Math.max(u,n)}}return(0,a.is)(e)?(0,a.BI)(e,s,l,c,u):(0,o.fA)(s,l,c,u,e),e}function ie(e,t,r,n,i){const{coords:a,lengths:o}=t,l=h(r,n);if(!a.length)return e!==t&&le(e),e;(0,s.Lw)(i);const{originPosition:c,scale:u,translate:d}=i,f=ue;f.originPosition=c;const p=f.scale;p[0]=u[0]??1,p[1]=-(u[1]??1),p[2]=u[2]??1,p[3]=u[3]??1;const m=f.translate;if(m[0]=d[0]??0,m[1]=d[1]??0,m[2]=d[2]??0,m[3]=d[3]??0,!o.length){for(let t=0;t<l;++t)e.coords[t]=S(f,a[t],t);return e!==t&&le(e,l,0),e}let g=0;for(let t=0;t<o.length;t++){const r=o[t];e.lengths[t]=r;for(let t=0;t<l;++t)e.coords[g+t]=S(f,a[g+t],t);let n=e.coords[g],i=e.coords[g+1];g+=l;for(let t=1;t<r;t++,g+=l){n+=a[g]*p[0],i+=a[g+1]*p[1],e.coords[g]=n,e.coords[g+1]=i;for(let t=2;t<l;++t)e.coords[g+t]=S(f,a[g+t],t)}}return e!==t&&le(e,a.length,o.length),e}function se(e,t,r,n,i,s){if(le(e),e.lengths.push(...t.lengths),r===i&&n===s)for(let r=0;r<t.coords.length;r++)e.coords.push(t.coords[r]);else{const a=h(r,n),o=v(r,n,i,s),l=t.coords;for(let t=0;t<l.length;t+=a)o(e.coords,l,e.coords.length,t,l[t],l[t+1])}return e}function ae(e,t,r,n){let i=0,s=e[n*t],a=e[n*(t+1)];for(let o=1;o<r;o++){const r=s+e[n*(t+o)],l=a+e[n*(t+o)+1],c=(r-s)*(l+a);s=r,a=l,i+=c}return.5*i}function oe(e,t){const{coords:r,lengths:n}=e;let i=0,s=0;for(let e=0;e<n.length;e++){const a=n[e];s+=ae(r,i,a,t),i+=a}return Math.abs(s)}function le(e,t=0,r=0){ce(e.lengths,r),ce(e.coords,t)}function ce(e,t=0){e.length!==t&&(e.length=t)}const ue={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]}},45328:function(e,t,r){r.d(t,{EL:function(){return g},RS:function(){return _},gr:function(){return c},wP:function(){return d},wZ:function(){return h}}),r(50917);var n=r(59469),i=(r(58941),r(21609)),s=r(24540),a=r(74697),o=r(46460),l=r(57165);function c(e){return"declaredClass"in e}function u(e){return"declaredClass"in e}function d(e,t){return e?"declaredClass"in e?e:new n.default({layer:t,sourceLayer:t,visible:e.visible,symbol:(0,i.o8)(e.symbol),attributes:(0,i.o8)(e.attributes),geometry:h(e.geometry)}):null}function h(e){return null==e?null:c(e)?e:(0,a.rS)(function(e){const{wkid:t,wkt:r,wkt2:n,latestWkid:i}=e.spatialReference,s={wkid:t,wkt:r,wkt2:n,latestWkid:i};switch(e.type){case"point":{const{x:t,y:r,z:n,m:i}=e;return{x:t,y:r,z:n,m:i,spatialReference:s}}case"polygon":{const{rings:t,hasZ:r,hasM:n}=e;return{rings:f(t),hasZ:r,hasM:n,spatialReference:s}}case"polyline":{const{paths:t,hasZ:r,hasM:n}=e;return{paths:f(t),hasZ:r,hasM:n,spatialReference:s}}case"extent":{const{xmin:t,xmax:r,ymin:n,ymax:i,zmin:a,zmax:o,mmin:l,mmax:c,hasZ:u,hasM:d}=e;return{xmin:t,xmax:r,ymin:n,ymax:i,zmin:a,zmax:o,mmin:l,mmax:c,hasZ:u,hasM:d,spatialReference:s}}case"multipoint":{const{points:t,hasZ:r,hasM:n}=e;return{points:m(t)?p(t):t,hasZ:r,hasM:n,spatialReference:s}}default:return}}(e))}function f(e){return function(e){for(const t of e)if(0!==t.length)return m(t);return!1}(e)?e.map((e=>p(e))):e}function p(e){return e.map((e=>Array.from(e)))}function m(e){return e.length>0&&((0,s.vZ)(e[0])||(0,s.aI)(e[0]))}function g(e,t){if(!e)return null;let r;if(u(e)){if(null==t)return e.clone();if(u(t))return t.copy(e)}return null!=t?(r=t,r.x=e.x,r.y=e.y,r.spatialReference=e.spatialReference,e.hasZ?(r.z=e.z,r.hasZ=e.hasZ):(r.z=void 0,r.hasZ=!1),e.hasM?(r.m=e.m,r.hasM=!0):(r.m=void 0,r.hasM=!1)):(r=(0,o.T)(e.x,e.y,e.z,e.spatialReference),e.hasM&&(r.m=e.m,r.hasM=!0)),r}function _(e){const{wkid:t,wkt:r,wkt2:n,latestWkid:i}=e,s={wkid:t,wkt:r,wkt2:n,latestWkid:i};return l.A.fromJSON(s)}},7103:function(e,t,r){r.d(t,{A:function(){return h}});var n=r(39819),i=r(30905),s=r(40633),a=r(25738),o=r(92955),l=r(53743),c=r(21168),u=r(96285);const d=new Map;class h{static fromJSON(e){return new h(e.fields,e.timeZoneByFieldName)}static fromLayer(e){return new h(e.fields??[],g(e))}static fromLayerJSON(e){return new h(e.fields??[],g(e))}constructor(e=[],t){this._fieldsMap=new Map,this._normalizedFieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this._requiredFields=null,this.dateFields=[],this.numericFields=[],this.fields=e||[],this._timeZoneByFieldName=t?new Map(t):null;const r=[];for(const e of this.fields){const t=e?.name,n=p(t);if(t&&n){const i=f(t);this._fieldsMap.set(t,e),this._fieldsMap.set(i,e),this._normalizedFieldsMap.set(n,e),r.push(`${i}:${e.type}:${this._timeZoneByFieldName?.get(t)}`),(0,l.vE)(e)?(this.dateFields.push(e),this._dateFieldsSet.add(e)):(0,l.WA)(e)&&(this._numericFieldsSet.add(e),this.numericFields.push(e)),(0,l.te)(e)||(0,l.Xz)(e)||(e.editable=null==e.editable||!!e.editable,e.nullable=null==e.nullable||!!e.nullable)}}r.sort(),this.uid=r.join()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const e of this.fields)(0,l.te)(e)||(0,l.Xz)(e)||e.nullable||void 0!==(0,l.lD)(e)||this._requiredFields.push(e)}return this._requiredFields}equals(e){return this.uid===e?.uid}has(e){return null!=this.get(e)}get(e){if(!e)return;let t=this._fieldsMap.get(e);return t||(t=this._fieldsMap.get(f(e))??this._normalizedFieldsMap.get(p(e)),t&&this._fieldsMap.set(e,t),t)}getTimeZone(e){const t=this.get(e&&"string"!=typeof e?e.name:e);return t?this._timeZoneByFieldName?this._timeZoneByFieldName.get(t.name):"date"===t.type||"esriFieldTypeDate"===t.type?(s.A.getLogger("esri.layers.support.FieldsIndex").error(new n.A("getTimeZone:no-timezone-information",`no time zone information for field '${t.name}'`)),c.n$):m.has(t.type)?c.L5:null:null}getLuxonTimeZone(e){const t=this.getTimeZone(e);return t?t===c.L5?o.GB.instance:t===c.n$?u.mQ.utcInstance:(0,a.tE)(d,t,(()=>u.oh.create(t))):null}isDateField(e){return this._dateFieldsSet.has(this.get(e))}isTimeOnlyField(e){return(0,l.OH)(this.get(e))}isNumericField(e){return this._numericFieldsSet.has(this.get(e))}normalizeFieldName(e){return this.get(e)?.name??void 0}toJSON(){return{fields:this.fields.map((e=>(0,i.Wj)(e)?e.toJSON():e)),timeZoneByFieldName:this._timeZoneByFieldName?Array.from(this._timeZoneByFieldName.entries()):null}}}function f(e){return e.trim().toLowerCase()}function p(e){return(0,l.rS)(e)?.toLowerCase()??""}const m=new Set(["time-only","date-only","timestamp-offset","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]);function g(e){const t=new Map;if(!e.fields)return t;const r=!0===e.datesInUnknownTimezone,{timeInfo:n,editFieldsInfo:i}=e,s=(n?"startField"in n?n.startField:n.startTimeField:"")??"",a=(n?"endField"in n?n.endField:n.endTimeField:"")??"",o=function(e){return"dateFieldsTimeZone"in e}(e)?e.dateFieldsTimeZone??null:e.dateFieldsTimeReference?(0,c.ZS)(e.dateFieldsTimeReference):null,l=i?function(e){return"timeZone"in e}(i)?i.timeZone??o:i.dateFieldsTimeReference?(0,c.ZS)(i.dateFieldsTimeReference):o??c.n$:null,u=n?function(e){return"timeZone"in e}(n)?n.timeZone??o:n.timeReference?(0,c.ZS)(n.timeReference):o:null,d=new Map([[f(i?.creationDateField??""),l],[f(i?.editDateField??""),l],[f(s),u],[f(a),u]]);for(const{name:n,type:i}of e.fields)if(m.has(i))t.set(n,c.L5);else if("date"!==i&&"esriFieldTypeDate"!==i)t.set(n,null);else if(r)t.set(n,c.L5);else{const e=d.get(f(n??""))??o;t.set(n,e)}return t}},47558:function(e,t,r){r.d(t,{T:function(){return a}});var n=r(60539),i=r(85445),s=r(55213);class a{constructor(){this._tasks=new Array,this._runningTasks=(0,i.v)(0)}get length(){return this._tasks.length}get running(){return this._runningTasks.value>0}destroy(){this.cancelAll()}runTask(e){if(0===this.length)return s.G;for(;!e.done&&this._process(e);)e.madeProgress()}push(e,t,r){return++this._runningTasks.value,new Promise(((n,i)=>this._tasks.push(new o(n,i,e,t,r)))).finally((()=>--this._runningTasks.value))}unshift(e,t,r){return++this._runningTasks.value,new Promise(((n,i)=>this._tasks.unshift(new o(n,i,e,t,r)))).finally((()=>--this._runningTasks.value))}_process(e){if(0===this._tasks.length)return!1;const t=this._tasks.shift();try{const r=(0,n.G4)(t.signal);if(r&&!t.abortCallback)t.reject((0,n.NK)());else{const i=r?t.abortCallback?.((0,n.NK)()):t.callback(e);(0,n.$X)(i)?i.then(t.resolve,t.reject):t.resolve(i)}}catch(e){t.reject(e)}return!0}cancelAll(){const e=(0,n.NK)();for(const t of this._tasks)if(t.abortCallback){const r=t.abortCallback(e);t.resolve(r)}else t.reject(e);this._tasks.length=0}}class o{constructor(e,t,r,n=void 0,i=void 0){this.resolve=e,this.reject=t,this.callback=r,this.signal=n,this.abortCallback=i}}},43173:function(e,t,r){r.r(t),r.d(t,{default:function(){return M}});var n=r(53804),i=r(53216),s=r(39819),a=r(30905),o=r(21609),l=r(31609),c=r(90683),u=r(23502),d=r(67888),h=r(47332),f=r(65953),p=r(91484),m=r(51432),g=r(83525),_=r(40633),y=r(77560);r(13798),r(58941);let v=class extends g.A{constructor(e){super(e),this.portalItem=null}normalizeCtorArgs(e){return e?.portalItem&&e.path?{...e,path:T(e.path,e.portalItem)}:e}set path(e){null!=e&&(0,c.oP)(e)?_.A.getLogger(this).error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",e)}_castPath(e){return T(e,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get cdnUrl(){return this.portalItem&&this.path?`${this.portalItem.itemCdnUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(e="json",t){const r=this.cdnUrl;if(null==r)throw new s.A("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal.request(r,{responseType:e,query:{token:this.portalItem.apiKey,_ts:t?.cacheBust?Date.now():null},signal:t?.signal})}async update(e,t){const{addOrUpdateResources:n}=await r.e(4460).then(r.bind(r,55597));return await n(this.portalItem,[{resource:this,content:e,compress:t?.compress,access:t?.access}],"update",t),this}hasPath(){return null!=this.path}};function T(e,t){return null==e?e:(e=e.replace(/^\/+/,""),null!=t&&(0,c.oP)(e)&&(e=(0,c.V1)(e,t.itemUrl)),e?.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}(0,n._)([(0,u.MZ)()],v.prototype,"portalItem",void 0),(0,n._)([(0,u.MZ)({type:String,value:null})],v.prototype,"path",null),(0,n._)([(0,y.w)("path")],v.prototype,"_castPath",null),(0,n._)([(0,u.MZ)({type:String,readOnly:!0})],v.prototype,"url",null),(0,n._)([(0,u.MZ)({type:String,readOnly:!0})],v.prototype,"cdnUrl",null),(0,n._)([(0,u.MZ)({type:String,readOnly:!0})],v.prototype,"itemRelativeUrl",null),v=(0,n._)([(0,f.$)("esri.portal.PortalItemResource")],v);const b=v;let S=class extends g.A{constructor(e){super(e),this.created=null,this.rating=null}};(0,n._)([(0,u.MZ)()],S.prototype,"created",void 0),(0,n._)([(0,u.MZ)()],S.prototype,"rating",void 0),S=(0,n._)([(0,f.$)("esri.portal.PortalRating")],S);const A=S;var E,w=r(60534);const I=new Set(["3DTiles Service","CSV","Feature Collection","Feature Service","Feed","GeoJson","Group Layer","Image Service","KML","Map Service","Media Layer","Scene Service","Stream Service","Vector Tile Service","WFS","WMS","WMTS"]),x=new Set(["KML","GeoJson","CSV"]);let R=E=class extends((0,a.Te)(l.A)){static from(e){return(0,d.PZ)(E,e)}constructor(e){super(e),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.classification=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.isOrgItem=!1,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.sourceUrl=null,this.spatialReference=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}destroy(){this.portal=null}get displayName(){const e=this.type,t=this.typeKeywords||[];let r=e;return"Feature Service"===e||"Feature Collection"===e?r=t.includes("Table")?"Table":t.includes("Route Layer")?"Route Layer":t.includes("Markup")?"Markup":"Feature Layer":"Image Service"===e?r=t.includes("Elevation 3D Layer")?"Elevation Layer":t.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":"Scene Service"===e?r="Scene Layer":"Video Service"===e?r="Video Layer":"Scene Package"===e?r="Scene Layer Package":"Stream Service"===e?r="Feature Layer":"Geoprocessing Service"===e?r=t.includes("Web Tool")?"Tool":"Geoprocessing Service":"Geoenrichment Service"===e?r="GeoEnrichment Service":"Geocoding Service"===e?r="Locator":"Microsoft Powerpoint"===e?r="Microsoft PowerPoint":"GeoJson"===e?r="GeoJSON":"Globe Service"===e?r="Globe Layer":"Vector Tile Service"===e?r="Tile Layer":"netCDF"===e?r="NetCDF":"Map Service"===e?r=t.includes("Spatiotemporal")||!t.includes("Hosted Service")&&!t.includes("Tiled")||t.includes("Relational")?"Map Image Layer":"Tile Layer":e?.toLowerCase().includes("add in")?r=e.replaceAll(/(add in)/gi,"Add-In"):"datastore catalog service"===e?r="Big Data File Share":"Compact Tile Package"===e?r="Tile Package (tpkx)":"Raster function template"===e?r="Raster Function Template":"OGCFeatureServer"===e?r="OGC Feature Layer":"web mapping application"===e&&t.includes("configurableApp")?r="Instant App":"Insights Page"===e?r="Insights Report":"Excalibur Imagery Project"===e?r="Excalibur Project":"3DTiles Service"===e?r="3D tiles layer":"3DTiles Package"===e&&(r="3D tiles package"),r}readExtent(e){return e&&e.length?new p.default(e[0][0],e[0][1],e[1][0],e[1][1]):null}get iconUrl(){const e=this.type?.toLowerCase()||"",t=this.typeKeywords||[];let r,n=!1,s=!1,a=!1,o=!1,l=!1,c=!1,u=!1,d=!1;return e.indexOf("service")>0||"feature collection"===e||"kml"===e||"wms"===e||"wmts"===e||"wfs"===e?(n=t.includes("Hosted Service"),"feature service"===e||"feature collection"===e||"kml"===e||"wfs"===e?(s=t.includes("Table"),a=t.includes("Route Layer"),o=t.includes("Markup"),l=t.includes("Spatiotemporal"),c=t.includes("UtilityNetwork"),r=l&&s?"spatiotemporaltable":s?"table":a?"routelayer":o?"markup":l?"spatiotemporal":c?"utilitynetwork":n?"featureshosted":"features"):"map service"===e||"wms"===e||"wmts"===e?(l=t.includes("Spatiotemporal"),u=t.includes("Relational"),r=l||u?"mapimages":n||t.includes("Tiled")||"wmts"===e?"maptiles":"mapimages"):r="scene service"===e?t.includes("Line")?"sceneweblayerline":t.includes("3DObject")?"sceneweblayermultipatch":t.includes("Point")?"sceneweblayerpoint":t.includes("IntegratedMesh")?"sceneweblayermesh":t.includes("PointCloud")?"sceneweblayerpointcloud":t.includes("Polygon")?"sceneweblayerpolygon":t.includes("Building")?"sceneweblayerbuilding":t.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":"image service"===e?t.includes("Elevation 3D Layer")?"elevationlayer":t.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":"stream service"===e?"streamlayer":"vector tile service"===e?"vectortile":"datastore catalog service"===e?"datastorecollection":"geocoding service"===e?"geocodeservice":"video service"===e?t.includes("Live Stream")?"livestreamvideolayer":"videolayer":"geoprocessing service"===e?t.includes("Web Tool")?"tool":"layers":"geodata service"===e?"geodataservice":"3dtiles service"===e?t.includes("3DObject")?"3dobjecttileslayer":t.includes("IntegratedMesh")?"integratedmeshtileslayer":"3dtileslayer":"layers"):"web map"===e||"cityengine web scene"===e?r="maps":"web scene"===e?r=t.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":"web mapping application"===e&&t.includes("configurableApp")?r="instantapps":"web mapping application"===e||"mobile application"===e||"application"===e||"operation view"===e||"desktop application"===e?r="apps":"map document"===e||"map package"===e||"published map"===e||"scene document"===e||"globe document"===e||"basemap package"===e||"mobile basemap package"===e||"mobile map package"===e||"project package"===e||"project template"===e||"pro map"===e||"layout"===e||"layer"===e&&t.includes("ArcGIS Pro")||"explorer map"===e&&t.indexOf("Explorer Document")?r="mapsgray":"service definition"===e||"shapefile"===e||"cad drawing"===e||"geojson"===e||"netcdf"===e||"administrative report"===e?r="datafiles":"360 vr experience"===e?r="360vr":"explorer add in"===e||"desktop add in"===e||"windows viewer add in"===e||"windows viewer configuration"===e?r="appsgray":"arcgis pro add in"===e||"arcgis pro configuration"===e?r="addindesktop":"pdf"===e?r="pdf":"microsoft word"===e?r="word":"microsoft excel"===e?r="excel":"microsoft powerpoint"===e?r="ppt":"rule package"===e||"file geodatabase"===e||"sqlite geodatabase"===e||"csv collection"===e||"kml collection"===e||"windows mobile package"===e||"map template"===e||"desktop application template"===e||"gml"===e||"arcpad package"===e||"code sample"===e||"document link"===e||"earth configuration"===e||"operations dashboard add in"===e||"rules package"===e||"workflow manager package"===e||"explorer map"===e&&t.includes("Explorer Mapping Application")||t.includes("Document")?r="datafilesgray":"network analysis service"===e||"geoprocessing service"===e||"geodata service"===e||"geometry service"===e||"geoprocessing package"===e||"locator package"===e||"geoprocessing sample"===e||"workflow manager service"===e?r="toolsgray":"layer"===e||"layer package"===e||"explorer layer"===e?r="layersgray":"analysis model"===e?r="analysismodel":"scene package"===e?r="scenepackage":"3dtiles package"===e?r="3dtileslayerpackage":"3dtiles service"===e?r="3dtileslayer":"mobile scene package"===e?r="mobilescenepackage":"tile package"===e||"compact tile package"===e?r="tilepackage":"task file"===e?r="taskfile":"report template"===e?r="report-template":"statistical data collection"===e?r="statisticaldatacollection":"insights workbook"===e?r="workbook":"insights model"===e?r="insightsmodel":"insights page"===e?r="insightspage":"insights theme"===e?r="insightstheme":"hub initiative"===e?r="hubinitiative":"hub page"===e?r="hubpage":"hub site application"===e?r="hubsite":"hub event"===e?r="hubevent":"hub project"===e?r="hubproject":"relational database connection"===e?r="relationaldatabaseconnection":"big data file share"===e?r="datastorecollection":"image collection"===e?r="imagecollection":"desktop style"===e?r="desktopstyle":"style"===e?r=t.includes("Dictionary")?"dictionarystyle":"style":"dashboard"===e?r="dashboard":"raster function template"===e?r="rasterprocessingtemplate":"vector tile package"===e?r="vectortilepackage":"ortho mapping project"===e?r="orthomappingproject":"ortho mapping template"===e?r="orthomappingtemplate":"solution"===e?r="solutions":"geopackage"===e?r="geopackage":"deep learning package"===e?r="deeplearningpackage":"real time analytic"===e?r="realtimeanalytics":"reality mapping project"===e?r="realitymappingproject":"big data analytic"===e?r="bigdataanalytics":"feed"===e?r="feed":"excalibur imagery project"===e?r="excaliburimageryproject":"notebook"===e?r="notebook":"storymap"===e?r="storymap":"survey123 add in"===e?r="survey123addin":"mission"===e?r="mission":"mission report"===e?r="missionreport":"mission template"===e?r="missiontemplate":"quickcapture project"===e?r="quickcaptureproject":"pro report"===e?r="proreport":"pro report template"===e?r="proreporttemplate":"urban model"===e?r="urbanmodel":"urban project"===e?r="urbanproject":"web experience"===e?r="experiencebuilder":"web experience template"===e?r="webexperiencetemplate":"experience builder widget"===e?r="experiencebuilderwidget":"experience builder widget package"===e?r="experiencebuilderwidgetpackage":"workflow"===e?r="workflow":"kernel gateway connection"===e?r="kernelgatewayconnection":"insights script"===e?r="insightsscript":"hub initiative template"===e?r="hubinitiativetemplate":"storymap theme"===e?r="storymaptheme":"knowledge graph"===e?r="knowledgegraph":"knowledge graph layer"===e?r="knowledgegraphlayer":"knowledge studio project"===e?r="knowledgestudio":"native application"===e?r="nativeapp":"native application installer"===e?r="nativeappinstaller":"web link chart"===e?r="linkchart":"knowledge graph web investigation"===e?r="investigation":"ogcfeatureserver"===e?r="features":"pro presentation"===e?r="propresentation":"pro project"===e?r="proproject":"insights workbook package"===e?r="insightsworkbookpackage":"apache parquet"===e?r="apacheparquet":"notebook code snippet library"===e?r="notebookcodesnippets":"suitability model"===e?r="suitabilitymodel":"esri classifier definition"===e?r="classifierdefinition":"esri classification schema"===e?r="classificationschema":"insights data engineering workbook"===e?r="dataengineeringworkbook":"insights data engineering model"===e?r="dataengineeringmodel":"deep learning studio project"===e?r="deeplearningproject":"discussion"===e?r="discussion":"allsource project"===e?r="allsourceproject":"api key"===e?r="apikey":"data pipeline"===e?r="datapipelines":"group layer"===e?(d=t.includes("Map"),r=d?"layergroup2d":"layergroup"):r="media layer"===e?"onlinemedialayer":"form"===e?t.includes("Survey123")?"survey":"datafilesgray":"csv"===e?"csv":"image"===e?"image":"maps",r?(0,i.s)("esri/images/portal/"+r+"16.png"):null}get isLayer(){return null!=this.type&&I.has(this.type)}get itemCdnUrl(){return(0,w.a)(this.itemUrl)}get itemPageUrl(){const e=this.portal?.itemPageUrl;return e&&this.id?`${e}?id=${this.id}`:null}get itemUrl(){const e=this.portal?.restUrl;return e&&this.id?`${e}/content/items/${this.id}`:null}get thumbnailUrl(){const e=this.itemUrl,t=this.thumbnail;return e&&t?this.portal?.normalizeUrl(`${e}/info/${t}?f=json`)??null:null}get userItemUrl(){const e=this.portal?.restUrl;if(!e)return null;const t=this.owner||this.portal?.user?.username;return t?`${e}/content/users/${this.ownerFolder?`${t}/${this.ownerFolder}`:t}/items/${this.id}`:null}load(e){const t=this.portal??(this.portal=m.A.getDefault()),r=t.load(e).then((()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?t.request(this.itemUrl,{signal:null!=e?e.signal:null,query:{token:this.apiKey}}):{})).then((e=>{this.sourceJSON=e,this.read(e)}));return this.addResolvingPromise(r),Promise.resolve(this)}async addRating(e){const t={method:"post",query:{}};return e instanceof A&&(e=e.rating),null==e||isNaN(e)||"number"!=typeof e||(t.query.rating=e),this.portal?(await this.portal.request(this.itemUrl+"/addRating",t),new A({rating:e,created:new Date})):null}clone(){const e={access:this.access,accessInformation:this.accessInformation,applicationProxies:(0,o.o8)(this.applicationProxies),avgRating:this.avgRating,categories:(0,o.o8)(this.categories),classification:(0,o.o8)(this.classification),created:(0,o.o8)(this.created),culture:this.culture,description:this.description,extent:(0,o.o8)(this.extent),groupCategories:(0,o.o8)(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:(0,o.o8)(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:(0,o.o8)(this.screenshots),size:this.size,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:(0,o.o8)(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:(0,o.o8)(this.typeKeywords),url:this.url};this.loaded&&(e.loadStatus="loaded");const t=new E({sourceJSON:this.sourceJSON}).set(e);return t._set("isOrgItem",this.isOrgItem),t}createPostQuery(){const e=this.toJSON();for(const t of["tags","typeKeywords","categories"])e[t]=e[t]?.join(", ");for(const t of["extent","classification"]){const r=e[t];r&&(e[t]=JSON.stringify(r))}return e}async deleteRating(){await this.portal.request(this.itemUrl+"/deleteRating",{method:"post"})}fetchData(e="json",t){return this.portal.request(this.itemUrl+"/data",{responseType:e,...t,query:{token:this.apiKey}})}async fetchRating(e){const t=await this.portal.request(this.itemUrl+"/rating",{query:{token:this.apiKey},...e});return null!=t.rating?(t.created=new Date(t.created),new A(t)):null}fetchRelatedItems(e,t){return this.portal.requestToTypedArray(this.itemUrl+"/relatedItems",{query:{...e,token:this.apiKey},...t},E)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}reload(){return this.portal.request(this.itemUrl??"",{cacheBust:!0,query:{token:this.apiKey}}).then((e=>(this.applicationProxies&&!Object.hasOwn(e,"appProxies")&&(this.applicationProxies=null),this.sourceJSON=e,this.read(e),this)))}update(e){return this.id?this.load().then((()=>this.portal.signIn())).then((()=>{const t=e?.data,r={method:"post"};r.query=this.createPostQuery();for(const e in r.query)null===r.query[e]&&(r.query[e]="");return r.query.clearEmptyFields=!0,null!=t&&("string"==typeof t?r.query.text=t:"object"==typeof t&&(r.query.text=JSON.stringify(t))),this.portal.request(`${this.userItemUrl}/update`,r).then((()=>this.reload()))})):Promise.reject(new s.A("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async copy(e){if(!this.id)throw new s.A("portal:item-does-not-exist","The item does not exist yet");await this.load();const{portal:t,itemUrl:r}=this;await t.signIn();const{copyResources:n,folder:i,tags:a,title:o}=e||{},l={method:"post",query:{copyPrivateResources:"all"===n,folder:"string"==typeof i?i:i?.id,includeResources:!!n,tags:a?.join(","),title:o}},{itemId:c}=await t.request(`${r}/copy`,l);return new E({id:c,portal:t})}updateThumbnail(e){return this.id?this.load().then((()=>this.portal.signIn())).then((()=>{const t=e.thumbnail,r=e.filename,n={method:"post"};if("string"==typeof t)(0,c.DB)(t)?n.query={data:t}:n.query={url:(0,c.s2)(t)},null!=r&&(n.query.filename=r);else{const e=new FormData;null!=r?e.append("file",t,r):e.append("file",t),n.body=e}return this.portal.request(`${this.userItemUrl}/updateThumbnail`,n).then((()=>this.reload()))})):Promise.reject(new s.A("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(e={},t){const{fetchResources:n}=await r.e(4460).then(r.bind(r,55597));return n(this,e,t)}async addResource(e,t,n){const{addOrUpdateResources:i}=await r.e(4460).then(r.bind(r,55597));return e.portalItem=this,await i(this,[{resource:e,content:t,compress:n?.compress,access:n?.access}],"add",n),e}async removeResource(e,t){const{removeResource:n}=await r.e(4460).then(r.bind(r,55597));if(e.portalItem&&e.portalItem.itemUrl!==this.itemUrl)throw new s.A("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return n(this,e,t)}async removeAllResources(e){const{removeAllResources:t}=await r.e(4460).then(r.bind(r,55597));return t(this,e)}resourceFromPath(e){return new b({portalItem:this,path:e})}toJSON(){const e=this.extent,t={accessInformation:this.accessInformation,categories:(0,o.o8)(this.categories),classification:(0,o.o8)(this.classification),created:this.created?.getTime(),description:this.description,extent:e&&[[e.xmin,e.ymin],[e.xmax,e.ymax]],id:this.id,isOrgItem:this.isOrgItem,licenseInfo:this.licenseInfo,modified:this.modified?.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:(0,o.o8)(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:(0,o.o8)(this.typeKeywords),url:this.url};return(0,o.oy)(t)}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");return new E({sourceJSON:e})}_getPostQuery(){const e=this.toJSON();for(const t in e)"tags"===t&&null!==e[t]&&(e[t]=e[t].join(", ")),"typeKeywords"===t&&null!==e[t]&&(e[t]=e[t].join(", ")),"extent"===t&&e[t]&&(e[t]=JSON.stringify(e[t]));return e}};(0,n._)([(0,u.MZ)({type:["private","shared","org","public"]})],R.prototype,"access",void 0),(0,n._)([(0,u.MZ)()],R.prototype,"accessInformation",void 0),(0,n._)([(0,u.MZ)({type:String})],R.prototype,"apiKey",void 0),(0,n._)([(0,u.MZ)({json:{read:{source:"appProxies"}}})],R.prototype,"applicationProxies",void 0),(0,n._)([(0,u.MZ)()],R.prototype,"avgRating",void 0),(0,n._)([(0,u.MZ)()],R.prototype,"categories",void 0),(0,n._)([(0,u.MZ)()],R.prototype,"classification",void 0),(0,n._)([(0,u.MZ)({type:Date})],R.prototype,"created",void 0),(0,n._)([(0,u.MZ)()],R.prototype,"culture",void 0),(0,n._)([(0,u.MZ)()],R.prototype,"description",void 0),(0,n._)([(0,u.MZ)({readOnly:!0})],R.prototype,"displayName",null),(0,n._)([(0,u.MZ)({type:p.default})],R.prototype,"extent",void 0),(0,n._)([(0,h.w)("extent")],R.prototype,"readExtent",null),(0,n._)([(0,u.MZ)()],R.prototype,"groupCategories",void 0),(0,n._)([(0,u.MZ)({readOnly:!0})],R.prototype,"iconUrl",null),(0,n._)([(0,u.MZ)()],R.prototype,"id",void 0),(0,n._)([(0,u.MZ)({readOnly:!0})],R.prototype,"isLayer",null),(0,n._)([(0,u.MZ)({type:Boolean,readOnly:!0})],R.prototype,"isOrgItem",void 0),(0,n._)([(0,u.MZ)()],R.prototype,"itemControl",void 0),(0,n._)([(0,u.MZ)({readOnly:!0})],R.prototype,"itemPageUrl",null),(0,n._)([(0,u.MZ)({readOnly:!0})],R.prototype,"itemUrl",null),(0,n._)([(0,u.MZ)()],R.prototype,"licenseInfo",void 0),(0,n._)([(0,u.MZ)({type:Date})],R.prototype,"modified",void 0),(0,n._)([(0,u.MZ)()],R.prototype,"name",void 0),(0,n._)([(0,u.MZ)()],R.prototype,"numComments",void 0),(0,n._)([(0,u.MZ)()],R.prototype,"numRatings",void 0),(0,n._)([(0,u.MZ)()],R.prototype,"numViews",void 0),(0,n._)([(0,u.MZ)()],R.prototype,"owner",void 0),(0,n._)([(0,u.MZ)()],R.prototype,"ownerFolder",void 0),(0,n._)([(0,u.MZ)({type:m.A})],R.prototype,"portal",void 0),(0,n._)([(0,u.MZ)()],R.prototype,"screenshots",void 0),(0,n._)([(0,u.MZ)()],R.prototype,"size",void 0),(0,n._)([(0,u.MZ)()],R.prototype,"snippet",void 0),(0,n._)([(0,u.MZ)()],R.prototype,"sourceJSON",void 0),(0,n._)([(0,u.MZ)({type:String})],R.prototype,"sourceUrl",void 0),(0,n._)([(0,u.MZ)({type:String})],R.prototype,"spatialReference",void 0),(0,n._)([(0,u.MZ)()],R.prototype,"tags",void 0),(0,n._)([(0,u.MZ)()],R.prototype,"thumbnail",void 0),(0,n._)([(0,u.MZ)({readOnly:!0})],R.prototype,"thumbnailUrl",null),(0,n._)([(0,u.MZ)()],R.prototype,"title",void 0),(0,n._)([(0,u.MZ)()],R.prototype,"type",void 0),(0,n._)([(0,u.MZ)()],R.prototype,"typeKeywords",void 0),(0,n._)([(0,u.MZ)({type:String,json:{read(e,t){if(x.has(t.type)){const t=this.portal?.restUrl;e||=t&&this.id?`${t}/content/items/${this.id}/data`:null}return e}}})],R.prototype,"url",void 0),(0,n._)([(0,u.MZ)({readOnly:!0})],R.prototype,"userItemUrl",null),R=E=(0,n._)([(0,f.$)("esri.portal.PortalItem")],R);const M=R},70181:function(e,t,r){r.d(t,{O3:function(){return d},PU:function(){return c},YW:function(){return f},ex:function(){return o},hv:function(){return h},zp:function(){return l}});var n=r(15774),i=r(13520),s=r(33400),a=r(41546);const o=2.4;function l(e){return(0,i.PN)(e*o)}function c(e){return(0,i.Lz)(e)/o}function u(e,t,r,i){let{color:a,ratio:o}=t,{color:l,ratio:c}=r;if(c===o){const e=1e-6;1===c?o-=e:c+=e}const u=(0,n.qE)((i-o)/(c-o),0,1);(0,s.l)(e,a.toArray(),l.toArray(),u)}function d(e){const t=new Uint8ClampedArray(2048);if((e=e.filter((({ratio:e})=>e>=0&&e<=1)).sort(((e,t)=>e.ratio-t.ratio)).map((({color:e,ratio:t})=>({color:e,ratio:Math.max(t,.001)})))).length<1)return t;let r=e[0],n=e[0],i=1;const s=(0,a.vt)();for(let a=0;a<512;a++){const o=(a+.5)/512;for(;o>n.ratio&&i<e.length;)r=n,n=e[i++];u(s,r,n,o),t.set(s,4*a)}return t}function h(e,t,r){const n=Math.sqrt(e**2+t**2)/r;return n>1?0:3/(Math.PI*r**2)*(1-n**2)**2}function f(e){return"function"==typeof e?e:e?t=>+t[e]:()=>1}},26765:function(e,t,r){r.d(t,{V:function(){return s},X:function(){return i}});var n=r(74697);function i(e){return{geometryType:(0,n.$B)(e[0]),geometries:e.map((e=>e.toJSON()))}}function s(e,t,r){const i=(0,n.xD)(t);return e.map((e=>{const t=i.fromJSON(e);return t.spatialReference=r,t}))}},12873:function(e,t,r){function n(e){const t={};for(const r in e){if("declaredClass"===r)continue;const i=e[r];if(null!=i&&"function"!=typeof i)if(Array.isArray(i)){t[r]=[];for(let e=0;e<i.length;e++)t[r][e]=n(i[e])}else"object"==typeof i?i.toJSON&&(t[r]=JSON.stringify(i)):t[r]=i}return t}r.d(t,{z:function(){return n}})},45608:function(e,t,r){r.d(t,{SH:function(){return R},ae:function(){return A},cn:function(){return y}});var n=r(39819),i=r(68225),s=r(76613),a=r(38519);const o=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML","esriFieldTypeBigInteger","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"],l=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],c=["upperLeft","lowerLeft"];function u(e){return e>=o.length?null:o[e]}function d(e){return e>=l.length?null:l[e]}function h(e){return e>=c.length?null:c[e]}function f(e,t){return t>=e.geometryTypes.length?null:e.geometryTypes[t]}function p(e,t,r){const n=e.asUnsafe(),i=t.createPointGeometry(r);for(;n.next();)switch(n.tag()){case 3:{const e=n.getUInt32(),r=n.pos()+e;let s=0;for(;n.pos()<r;)t.addCoordinatePoint(i,n.getSInt64(),s++);break}default:n.skip()}return i}function m(e,t,r){const n=e.asUnsafe(),i=t.createGeometry(r),s=2+(r.hasZ?1:0)+(r.hasM?1:0);for(;n.next();)switch(n.tag()){case 2:{const e=n.getUInt32(),r=n.pos()+e;let s=0;for(;n.pos()<r;)t.addLength(i,n.getUInt32(),s++);break}case 3:{const e=n.getUInt32(),r=n.pos()+e;let a=0;for(t.allocateCoordinates(i);n.pos()<r;)t.addCoordinate(i,n.getSInt64(),a),a++,a===s&&(a=0);break}default:n.skip()}return i}function g(e){const t=e.asUnsafe(),r=new s.A;let n="esriGeometryPoint";for(;t.next();)switch(t.tag()){case 2:{const e=t.getUInt32(),n=t.pos()+e;for(;t.pos()<n;)r.lengths.push(t.getUInt32());break}case 3:{const e=t.getUInt32(),n=t.pos()+e;for(;t.pos()<n;)r.coords.push(t.getSInt64());break}case 1:n=a.z[t.getEnum()];break;default:t.skip()}return{queryGeometry:r,queryGeometryType:n}}function _(e){const t=e.asUnsafe();for(;t.next();)switch(t.tag()){case 1:return t.getString();case 2:return t.getFloat();case 3:return t.getDouble();case 4:return t.getSInt32();case 5:return t.getUInt32();case 6:return t.getInt64();case 7:return t.getUInt64();case 8:return t.getSInt64();case 9:return t.getBool();default:return t.skip(),null}return null}function y(e){const t=e.asUnsafe(),r={type:u(0)};for(;t.next();)switch(t.tag()){case 1:r.name=t.getString();break;case 2:r.type=u(t.getEnum());break;case 3:r.alias=t.getString();break;case 4:r.sqlType=d(t.getEnum());break;case 5:default:t.skip();break;case 6:r.defaultValue=t.getString()}return r}function v(e){const t={},r=e.asUnsafe();for(;r.next();)switch(r.tag()){case 1:t.name=r.getString();break;case 2:t.isSystemMaintained=r.getBool();break;default:r.skip()}return t}function T(e,t,r,n){const i=t.createFeature(r);let s=0;for(;e.next();)switch(e.tag()){case 1:{const t=n[s++].name;i.attributes[t]=e.processMessage(_);break}case 2:i.geometry=e.processMessageWithArgs(m,t,r);break;case 4:i.centroid=e.processMessageWithArgs(p,t,r);break;default:e.skip()}return i}function b(e){const t=[1,1,1,1],r=e.asUnsafe();for(;r.next();)switch(r.tag()){case 1:t[0]=r.getDouble();break;case 2:t[1]=r.getDouble();break;case 4:t[2]=r.getDouble();break;case 3:t[3]=r.getDouble();break;default:r.skip()}return t}function S(e){const t=[0,0,0,0],r=e.asUnsafe();for(;r.next();)switch(r.tag()){case 1:t[0]=r.getDouble();break;case 2:t[1]=r.getDouble();break;case 4:t[2]=r.getDouble();break;case 3:t[3]=r.getDouble();break;default:r.skip()}return t}function A(e){const t={originPosition:h(0)},r=e.asUnsafe();for(;r.next();)switch(r.tag()){case 1:t.originPosition=h(r.getEnum());break;case 2:t.scale=r.processMessage(b);break;case 3:t.translate=r.processMessage(S);break;default:r.skip()}return t}function E(e){const t={},r=e.asUnsafe();for(;r.next();)switch(r.tag()){case 1:t.shapeAreaFieldName=r.getString();break;case 2:t.shapeLengthFieldName=r.getString();break;case 3:t.units=r.getString();break;default:r.skip()}return t}function w(e,t){const r=t.createSpatialReference();for(;e.next();)switch(e.tag()){case 1:r.wkid=e.getUInt32();break;case 5:r.wkt=e.getString();break;case 2:r.latestWkid=e.getUInt32();break;case 3:r.vcsWkid=e.getUInt32();break;case 4:r.latestVcsWkid=e.getUInt32();break;default:e.skip()}return r}function I(e,t){const r=t.createFeatureResult(),n=e.asUnsafe();r.geometryType=f(t,0);let i=!1;for(;n.next();)switch(n.tag()){case 1:r.objectIdFieldName=n.getString();break;case 3:r.globalIdFieldName=n.getString();break;case 4:r.geohashFieldName=n.getString();break;case 5:r.geometryProperties=n.processMessage(E);break;case 7:r.geometryType=f(t,n.getEnum());break;case 8:r.spatialReference=n.processMessageWithArgs(w,t);break;case 10:r.hasZ=n.getBool();break;case 11:r.hasM=n.getBool();break;case 12:r.transform=n.processMessage(A);break;case 9:r.exceededTransferLimit=n.getBool();break;case 13:t.addField(r,n.processMessage(y));break;case 15:i||(t.prepareFeatures(r),i=!0),t.addFeature(r,n.processMessageWithArgs(T,t,r,r.fields));break;case 2:r.uniqueIdField=n.processMessage(v);break;default:n.skip()}return t.finishFeatureResult(r),r}function x(e,t){const r={};let n=null;for(;e.next();)switch(e.tag()){case 4:n=e.processMessageWithArgs(g);break;case 1:r.featureResult=e.processMessageWithArgs(I,t);break;default:e.skip()}return null!=n&&r.featureResult&&t.addQueryGeometry(r,n),r}function R(e,t){try{const r=2,n=new i.A(new Uint8Array(e),new DataView(e)),s={};for(;n.next();)n.tag()===r?s.queryResult=n.processMessageWithArgs(x,t):n.skip();return s}catch(e){throw new n.A("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:e})}}},38519:function(e,t,r){r.d(t,{S:function(){return c},z:function(){return l}});var n=r(62938),i=r(57652),s=r(65215),a=r(72887),o=r(76613);const l=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"];class c{constructor(e){this._options=e,this.geometryTypes=l,this._coordinatePtr=0,this._vertexDimension=0}createFeatureResult(){return new a.A}prepareFeatures(e){this._vertexDimension=2,e.hasZ&&this._vertexDimension++,e.hasM&&this._vertexDimension++}finishFeatureResult(e){if(!e?.features||!e.hasZ||!this._options.sourceSpatialReference||!e.spatialReference||(0,i.aI)(e.spatialReference,this._options.sourceSpatialReference)||e.spatialReference.vcsWkid)return;const t=(0,n.G9)(this._options.sourceSpatialReference)/(0,n.G9)(e.spatialReference);if(1!==t)for(const r of e.features){if(!(0,s.N3)(r))continue;const e=r.geometry.coords;for(let r=2;r<e.length;r+=3)e[r]*=t}}addFeature(e,t){e.features.push(t)}createFeature(){return new s.Om}createSpatialReference(){return{wkid:0}}createGeometry(){return new o.A}addField(e,t){e.fields.push(t)}allocateCoordinates(e){e.coords.length=e.lengths.reduce(((e,t)=>e+t),0)*this._vertexDimension,this._coordinatePtr=0}addCoordinate(e,t){e.coords[this._coordinatePtr++]=t}addCoordinatePoint(e,t){e.coords.push(t)}addLength(e,t){e.lengths.push(t)}addQueryGeometry(e,t){e.queryGeometry=t.queryGeometry,e.queryGeometryType=t.queryGeometryType}createPointGeometry(){return new o.A}}},55723:function(e,t,r){r.d(t,{m:function(){return i}});var n=r(45608);function i(e,t){const r=(0,n.SH)(e,t),i=r.queryResult.featureResult,s=r.queryResult.queryGeometry,a=r.queryResult.queryGeometryType;if(i&&i.features&&i.features.length&&i.objectIdFieldName){const e=i.objectIdFieldName;for(const t of i.features)t.attributes&&(t.objectId=t.attributes[e])}return i&&(i.queryGeometry=s,i.queryGeometryType=a),i}},90066:function(e,t,r){r.d(t,{IJ:function(){return p},Jf:function(){return y},Pk:function(){return g},eW:function(){return f},gW:function(){return _},kS:function(){return m}});var n=r(93040),i=r(90683),s=r(74697),a=r(65298),o=r(57652),l=r(12873),c=r(55723),u=r(45406);const d="Layer does not support extent calculation.";function h(e,t){const r=e.geometry,n=e.toJSON();delete n.compactGeometryEnabled,delete n.defaultSpatialReferenceEnabled;const i=n;let a,l,c;if(null!=r&&(l=r.spatialReference,c=(0,o.YX)(l),i.geometryType=(0,s.$B)(r),i.geometry=function(e,t){if(t&&"extent"===e.type)return`${e.xmin},${e.ymin},${e.xmax},${e.ymax}`;if(t&&"point"===e.type)return`${e.x},${e.y}`;const r=e.toJSON();return delete r.spatialReference,JSON.stringify(r)}(r,e.compactGeometryEnabled),i.inSR=c),n.groupByFieldsForStatistics&&(i.groupByFieldsForStatistics=n.groupByFieldsForStatistics.join(",")),n.objectIds&&(i.objectIds=n.objectIds.join(",")),n.orderByFields&&(i.orderByFields=n.orderByFields.join(",")),!n.outFields||!n.returnDistinctValues&&(t?.returnCountOnly||t?.returnExtentOnly||t?.returnIdsOnly)?delete i.outFields:n.outFields.includes("*")?i.outFields="*":i.outFields=n.outFields.join(","),n.outSR?(i.outSR=(0,o.YX)(n.outSR),a=e.outSpatialReference):r&&(n.returnGeometry||n.returnCentroid)&&(i.outSR=i.inSR,a=l),n.returnGeometry&&delete n.returnGeometry,n.outStatistics&&(i.outStatistics=JSON.stringify(n.outStatistics)),n.fullText&&(i.fullText=JSON.stringify(n.fullText)),n.pixelSize&&(i.pixelSize=JSON.stringify(n.pixelSize)),n.quantizationParameters&&(e.defaultSpatialReferenceEnabled&&null!=l&&null!=e.quantizationParameters?.extent&&l.equals(e.quantizationParameters.extent.spatialReference)&&delete n.quantizationParameters.extent.spatialReference,i.quantizationParameters=JSON.stringify(n.quantizationParameters)),n.parameterValues&&(i.parameterValues=JSON.stringify(n.parameterValues)),n.rangeValues&&(i.rangeValues=JSON.stringify(n.rangeValues)),n.dynamicDataSource&&(i.layer=JSON.stringify({source:n.dynamicDataSource}),delete n.dynamicDataSource),n.timeExtent){const e=n.timeExtent,{start:t,end:r}=e;null==t&&null==r||(i.time=t===r?t:`${t??"null"},${r??"null"}`),delete n.timeExtent}return e.defaultSpatialReferenceEnabled&&null!=l&&null!=a&&l.equals(a)&&(i.defaultSR=i.inSR,delete i.inSR,delete i.outSR),i}async function f(e,t,r,n){const i=null!=t.timeExtent&&t.timeExtent.isEmpty?{data:{features:[]}}:await v(e,t,"json",n);return(0,u.q)(t,r,i.data),i}async function p(e,t,r,n){if(null!=t.timeExtent&&t.timeExtent.isEmpty)return{data:r.createFeatureResult()};const i=await m(e,t,n),s=i;return s.data=(0,c.m)(i.data,r),s}function m(e,t,r){return v(e,t,"pbf",r)}function g(e,t,r){return null!=t.timeExtent&&t.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):v(e,t,"json",r,{returnIdsOnly:!0})}function _(e,t,r){return null!=t.timeExtent&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):v(e,t,"json",r,{returnIdsOnly:!0,returnCountOnly:!0})}async function y(e,t,r){if(null!=t.timeExtent&&t.timeExtent.isEmpty)return{data:{count:0,extent:null}};const n=await v(e,t,"json",r,{returnExtentOnly:!0,returnCountOnly:!0}),i=n.data;if(i.hasOwnProperty("extent"))return n;if(i.features)throw new Error(d);if(i.hasOwnProperty("count"))throw new Error(d);return n}async function v(e,t,r,s={},o={}){const c="string"==typeof e?(0,i.An)(e):e,u=t.geometry?[t.geometry]:[],d=await(0,a.el)(u,null,{signal:s.signal}),f=d?.[0];null!=f&&((t=t.clone()).geometry=f);const p=(0,l.z)({...c.query,f:r,...o,...h(t,o)});return(0,n.A)((0,i.fj)(c.path,(m=o,null==t.formatOf3DObjects||m.returnCountOnly||m.returnExtentOnly||m.returnIdsOnly?"query":"query3d")),{...s,responseType:"pbf"===r?"array-buffer":"json",query:{...p,...s.query}});var m}},45406:function(e,t,r){r.d(t,{q:function(){return i}});var n=r(6996);function i(e,t,r){if(!r?.features||!r.hasZ)return;const i=(0,n.N)(r.geometryType,t,e.outSpatialReference);if(null!=i)for(const e of r.features)i(e.geometry)}},74373:function(e,t,r){r.d(t,{A:function(){return h}});var n=r(53804),i=r(73037),s=r(30905),a=r(23502),o=(r(58941),r(40633),r(13798),r(74376)),l=r(65953);const c=new i.J({esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation",esriClassifyDefinedInterval:"defined-interval"}),u=new i.J({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:"percent-of-total",esriNormalizeByField:"field"});let d=class extends s.oY{constructor(e){super(e),this.type="class-breaks-definition",this.breakCount=null,this.classificationField=null,this.classificationMethod=null,this.normalizationField=null,this.normalizationType=null}set standardDeviationInterval(e){"standard-deviation"===this.classificationMethod&&this._set("standardDeviationInterval",e)}set definedInterval(e){"defined-interval"===this.classificationMethod&&this._set("definedInterval",e)}};(0,n._)([(0,o.e)({classBreaksDef:"class-breaks-definition"})],d.prototype,"type",void 0),(0,n._)([(0,a.MZ)({json:{write:!0}})],d.prototype,"breakCount",void 0),(0,n._)([(0,a.MZ)({json:{write:!0}})],d.prototype,"classificationField",void 0),(0,n._)([(0,a.MZ)({type:String,json:{read:c.read,write:c.write}})],d.prototype,"classificationMethod",void 0),(0,n._)([(0,a.MZ)({json:{write:!0}})],d.prototype,"normalizationField",void 0),(0,n._)([(0,a.MZ)({json:{read:u.read,write:u.write}})],d.prototype,"normalizationType",void 0),(0,n._)([(0,a.MZ)({value:null,json:{write:!0}})],d.prototype,"standardDeviationInterval",null),(0,n._)([(0,a.MZ)({value:null,json:{write:!0}})],d.prototype,"definedInterval",null),d=(0,n._)([(0,l.$)("esri.rest.support.ClassBreaksDefinition")],d);const h=d},49241:function(e,t,r){r.d(t,{t:function(){return a}});var n=r(40633);const i=()=>n.A.getLogger("esri.rest.support.generateRendererUtils");function s(e,t){return Number(e.toFixed(t))}function a(e){const{normalizationTotal:t}=e;return{classBreaks:o(e),normalizationTotal:t}}function o(e){const t=e.definition,{classificationMethod:r,normalizationType:n,definedInterval:i}=t,a=t.breakCount??1,o=[];let u=e.values;if(0===u.length)return[];u=u.sort(((e,t)=>e-t));const d=u[0],h=u[u.length-1];if("equal-interval"===r)if(u.length>=a){const e=(h-d)/a;let t=d;for(let r=1;r<a;r++){const i=s(d+r*e,6);o.push({minValue:t,maxValue:i,label:l(t,i,n)}),t=i}o.push({minValue:t,maxValue:h,label:l(t,h,n)})}else u.forEach((e=>{o.push({minValue:e,maxValue:e,label:l(e,e,n)})}));else if("natural-breaks"===r){const t=function(e){const t=[],r=[];let n=Number.MIN_VALUE,i=1,s=-1;for(let a=0;a<e.length;a++){const o=e[a];o===n?(i++,r[s]=i):null!==o&&(t.push(o),n=o,i=1,r.push(i),s++)}return{uniqueValues:t,valueFrequency:r}}(u),r=e.valueFrequency||t.valueFrequency,i=c(t.uniqueValues,r,a);let f=d;for(let e=1;e<a;e++)if(t.uniqueValues.length>e){const r=s(t.uniqueValues[i[e]],6);o.push({minValue:f,maxValue:r,label:l(f,r,n)}),f=r}o.push({minValue:f,maxValue:h,label:l(f,h,n)})}else if("quantile"===r)if(u.length>=a&&d!==h){let e=d,t=Math.ceil(u.length/a),r=0;for(let i=1;i<a;i++){let s=t+r-1;s>u.length&&(s=u.length-1),s<0&&(s=0),o.push({minValue:e,maxValue:u[s],label:l(e,u[s],n)}),e=u[s],r+=t,t=Math.ceil((u.length-r)/(a-i))}o.push({minValue:e,maxValue:h,label:l(e,h,n)})}else{let e=-1;for(let t=0;t<u.length;t++){const r=u[t];r!==e&&(e=r,o.push({minValue:e,maxValue:r,label:l(e,r,n)}),e=r)}}else if("standard-deviation"===r){const e=function(e){let t=0;for(let r=0;r<e.length;r++)t+=e[r];return t/=e.length,t}(u),t=function(e,t){let r=0;for(let n=0;n<e.length;n++){const i=e[n];r+=(i-t)*(i-t)}return r/=e.length,Math.sqrt(r)}(u,e);if(0===t)o.push({minValue:u[0],maxValue:u[0],label:l(u[0],u[0],n)});else{const r=function(e,t,r,n,i){let s=Math.max(n-e,t-n)/i/r;return s=s>=1?1:s>=.5?.5:.25,s}(d,h,a,e,t)*t;let i=0,c=d;for(let t=a;t>=1;t--){const a=s(e-(t-.5)*r,6);o.push({minValue:c,maxValue:a,label:l(c,a,n)}),c=a,i++}let u=s(e+.5*r,6);o.push({minValue:c,maxValue:u,label:l(c,u,n)}),c=u,i++;for(let t=1;t<=a;t++)u=i===2*a?h:s(e+(t+.5)*r,6),o.push({minValue:c,maxValue:u,label:l(c,u,n)}),c=u,i++}}else if("defined-interval"===r){if(!i)return o;const e=u[0],t=u[u.length-1],r=Math.ceil((t-e)/i);let a=e;for(let t=1;t<r;t++){const r=s(e+t*i,6);o.push({minValue:a,maxValue:r,label:l(a,r,n)}),a=r}o.push({minValue:a,maxValue:t,label:l(a,t,n)})}return o}function l(e,t,r){let n=null;return n=e===t?r&&"percent-of-total"===r?e+"%":e.toString():r&&"percent-of-total"===r?e+"% - "+t+"%":e+" - "+t,n}function c(e,t,r){const n=e.length,i=[];r>n&&(r=n);for(let e=0;e<r;e++)i.push(Math.round(e*n/r-1));i.push(n-1);let s=u(i,e,t,r);return function(e,t,r,n,i,s){let a=0,o=0,l=0,c=0,u=!0;for(let h=0;h<2&&u;h++){0===h&&(u=!1);for(let h=0;h<s-1;h++)for(;r[h+1]+1!==r[h+2];){r[h+1]=r[h+1]+1;const s=d(h,r,n,i);l=s.sbMean,a=s.sbSdcm;const f=d(h+1,r,n,i);if(c=f.sbMean,o=f.sbSdcm,!(a+o<t[h]+t[h+1])){r[h+1]=r[h+1]-1;break}t[h]=a,t[h+1]=o,e[h]=l,e[h+1]=c,u=!0}for(let h=s-1;h>0;h--)for(;r[h]!==r[h-1]+1;){r[h]=r[h]-1;const s=d(h-1,r,n,i);l=s.sbMean,a=s.sbSdcm;const f=d(h,r,n,i);if(c=f.sbMean,o=f.sbSdcm,!(a+o<t[h-1]+t[h])){r[h]=r[h]+1;break}t[h-1]=a,t[h]=o,e[h-1]=l,e[h]=c,u=!0}}return u}(s.mean,s.sdcm,i,e,t,r)&&(s=u(i,e,t,r)),i}function u(e,t,r,n){let i=[],s=[],a=[],o=0;const l=[],c=[];for(let i=0;i<n;i++){const n=d(i,e,t,r);l.push(n.sbMean),c.push(n.sbSdcm),o+=c[i]}let u,h=o,f=!0;for(;f||o<h;){f=!1,i=[];for(let t=0;t<n;t++)i.push(e[t]);for(let r=0;r<n;r++)for(let i=e[r]+1;i<=e[r+1];i++)if(u=t[i],r>0&&i!==e[r+1]&&Math.abs(u-l[r])>Math.abs(u-l[r-1]))e[r]=i;else if(r<n-1&&e[r]!==i-1&&Math.abs(u-l[r])>Math.abs(u-l[r+1])){e[r+1]=i-1;break}h=o,o=0,s=[],a=[];for(let i=0;i<n;i++){s.push(l[i]),a.push(c[i]);const n=d(i,e,t,r);l[i]=n.sbMean,c[i]=n.sbSdcm,o+=c[i]}}if(o>h){for(let t=0;t<n;t++)e[t]=i[t],l[t]=s[t],c[t]=a[t];o=h}return{mean:l,sdcm:c}}function d(e,t,r,n){let s=0,a=0;for(let i=t[e]+1;i<=t[e+1];i++){const e=n[i];s+=r[i]*e,a+=e}a<=0&&i().warn("Exception in Natural Breaks calculation");const o=s/a;let l=0;for(let i=t[e]+1;i<=t[e+1];i++)l+=n[i]*(r[i]-o)**2;return{sbMean:o,sbSdcm:l}}},39397:function(e,t,r){r.d(t,{Dl:function(){return a},jV:function(){return s},lF:function(){return o}}),r(25591),r(7156);var n=r(21609),i=r(90683);function s(e,t){return t?{...t,query:{...e??{},...t.query}}:{query:e}}function a(e){return"string"==typeof e?(0,i.An)(e):(0,n.o8)(e)}function o(e,t,r){const n={};for(const i in e){if("declaredClass"===i)continue;const s=e[i];if(null!=s&&"function"!=typeof s)if(Array.isArray(s))n[i]=s.map((e=>o(e)));else if("object"==typeof s)if(s.toJSON){const e=s.toJSON(r?.[i]);n[i]=t?e:JSON.stringify(e)}else n[i]=t?s:JSON.stringify(s);else n[i]=s}return n}r(48893)},92586:function(e,t,r){r.d(t,{$r:function(){return g},Jc:function(){return v},gV:function(){return _},rb:function(){return y}}),r(50917),r(39819);var n=r(13520),i=r(45139),s=r(57165),a=r(87280),o=r(57652),l=r(53743),c=r(70181),u=r(33118),d=r(66164),h=r(54547),f=r(45532);let p=null;const m=/^(?<hh>([0-1][0-9])|([2][0-3])):(?<mm>[0-5][0-9])(:(?<ss>[0-5][0-9]))?([.](?<ms>\d+))?$/;function g(e,t,r,n){const i=(0,o.d9)(r)?(0,o.Vp)(r):null,s=i?Math.round((i.valid[1]-i.valid[0])/t.scale[0]):null;return e.map((e=>{const r=new f.default(e.geometry);return(0,a.Gy)(t,r,r),e.geometry=i?function(e,t,r){return e.x<0?e.x+=t:e.x>r&&(e.x-=t),e}(r,s??0,n[0]):r,e}))}function _(e,t=18,r,i,s){const a=new Float64Array(i*s);t=Math.round((0,n.Lz)(t));let o=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY;const u=(0,c.YW)(r);for(const{geometry:r,attributes:n}of e){const{x:e,y:d}=r,h=Math.max(0,e-t),f=Math.max(0,d-t),p=Math.min(s,d+t),m=Math.min(i,e+t),g=+u(n);for(let r=f;r<p;r++)for(let n=h;n<m;n++){const s=r*i+n,u=(0,c.hv)(n-e,r-d,t)*g,h=a[s]+=u;o=Math.min(o,h),l=Math.max(l,h)}}return{min:o,max:l}}function y(e){const t=m.exec(e);if(!t)return null;const{hh:r,mm:n,ss:s,ms:a}=t.groups;return Number(r)*i.vf.hours+Number(n)*i.vf.minutes+Number(s)*i.vf.seconds+Number(a||0)}async function v(e,t,r=!0){if(!t)return[];const{field:n,field2:i,field3:a,fieldDelimiter:o,fieldInfos:c,timeZone:f}=e,m=n&&c?.find((e=>e.name.toLowerCase()===n.toLowerCase())),g=!!m&&(0,l.OH)(m),_=!!m&&(0,u.fs)(m),v=e.valueExpression,T=e.normalizationType,b=e.normalizationField,S=e.normalizationTotal,A=[],E=e.viewInfoParams;let w=null,I=null;if(v){if(!p){const{arcadeUtils:e}=await(0,h.lw)();p=e}p.hasGeometryOperations(v)&&await p.enableGeometryOperations(),w=p.createFunction(v),I=E?p.getViewInfo({viewingMode:E.viewingMode,scale:E.scale,spatialReference:new s.A(E.spatialReference)}):null}const x=e.fieldInfos,R=t[0]&&"declaredClass"in t[0]&&"esri.Graphic"===t[0].declaredClass||!x?null:{fields:x};return t.forEach((e=>{const t=e.attributes;let s;if(v){const t=R?{...e,layer:R}:e,r=p.createExecContext(t,I,f);s=p.executeFunction(w,r)}else t&&(s=t[n],i?(s=`${(0,d.gJ)(s)}${o}${(0,d.gJ)(t[i])}`,a&&(s=`${s}${o}${(0,d.gJ)(t[a])}`)):"string"==typeof s&&r&&(_?s=s?new Date(s).getTime():null:g&&(s=s?y(s):null)));if(T&&"number"==typeof s&&isFinite(s)){const e=t&&parseFloat(t[b]);s=(0,d.zS)(s,T,e,S)}A.push(s)})),A}},33118:function(e,t,r){r.d(t,{fs:function(){return a},i0:function(){return o}});var n=r(8289),i=r(53743),s=(r(54547),r(51107),r(21168));function a(e){return(0,i.vE)(e)||(0,i.zD)(e)||(0,i.Ah)(e)}function o(e,t){const{format:r,timeZoneOptions:i,fieldType:a}=t??{};let o,l;if(i&&({timeZone:o,timeZoneName:l}=(0,s.hv)(i.layerTimeZone,i.datesInUnknownTimezone,i.viewTimeZone,(0,n.J2)(r||"short-date-short-time"),a)),"string"==typeof e&&isNaN(Date.parse("time-only"===a?`1970-01-01T${e}Z`:e)))return e;switch(a){case"date-only":{const t=(0,n.J2)(r||"short-date");return"string"==typeof e?(0,n.iS)(e,{...t}):(0,n.Yq)(e,{...t,timeZone:s.n$})}case"time-only":{const t=(0,n.J2)(r||"short-time");return"string"==typeof e?(0,n.F8)(e,t):(0,n.Yq)(e,{...t,timeZone:s.n$})}case"timestamp-offset":{if(!o&&"string"==typeof e&&new Date(e).toISOString()!==e)return e;const t=r||i?(0,n.J2)(r||"short-date-short-time"):void 0,s=t?{...t,timeZone:o,timeZoneName:l}:void 0;return"string"==typeof e?(0,n.Ey)(e,s):(0,n.Yq)(e,s)}default:{const t=r||i?(0,n.J2)(r||"short-date-short-time"):void 0;return(0,n.Yq)("string"==typeof e?new Date(e):e,t?{...t,timeZone:o,timeZoneName:l}:void 0)}}}new Set(["integer","small-integer"])},66164:function(e,t,r){r.d(t,{$y:function(){return z},FM:function(){return v},G_:function(){return _},Rw:function(){return B},Vb:function(){return m},b3:function(){return L},gJ:function(){return p},jM:function(){return G},lv:function(){return D},oZ:function(){return N},qg:function(){return y},z9:function(){return g},zS:function(){return P}});var n=r(74373),i=r(49241);const s="<Null>",a="equal-interval",o=1,l=5,c=10,u=/\s*(\+|-)?((\d+(\.\d+)?)|(\.\d+))\s*/gi,d=new Set(["esriFieldTypeDate","esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong","esriFieldTypeOID","esriFieldTypeBigInteger"]),h=new Set(["esriFieldTypeTimeOnly","esriFieldTypeDateOnly"]),f=["min","max","avg","stddev","count","sum","variance","nullcount","median"];function p(e){return null==e||"string"==typeof e&&!e?s:e}function m(e){const t=null!=e.normalizationField||null!=e.normalizationType,r=null!=e.minValue||null!=e.maxValue,n=!!e.sqlExpression&&e.supportsSQLExpression;return!t&&!r&&!n}function g(e){const{outStatisticTypes:t}=e,r=e.returnDistinct?[...new Set(e.values)]:e.values,n=r.filter((e=>null!=e)).sort(),i=n.length,s={count:i,min:n[0],max:n[i-1]};return e.supportsNullCount&&(s.nullcount=r.length-i),!e.percentileParams||t?.include?.length&&!t.include.includes("median")||t?.exclude?.length&&t.exclude.includes("median")||(s.median=y(r,e.percentileParams)),s}function _(e){const{values:t,useSampleStdDev:r,supportsNullCount:n,outStatisticTypes:i}=e;let s=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,o=null,l=null,c=null,u=null,d=0;const h=null==e.minValue?-1/0:e.minValue,f=null==e.maxValue?1/0:e.maxValue;for(const e of t)Number.isFinite(e)?e>=h&&e<=f&&(o=null===o?e:o+e,s=Math.min(s,e),a=Math.max(a,e),d++):"string"==typeof e&&d++;if(d&&null!=o){l=o/d;let e=0;for(const r of t)Number.isFinite(r)&&r>=h&&r<=f&&(e+=(r-l)**2);u=r?d>1?e/(d-1):0:d>0?e/d:0,c=Math.sqrt(u)}else s=null,a=null;const p={avg:l,count:d,max:a,min:s,stddev:c,sum:o,variance:u};return n&&(p.nullcount=t.length-d),!e.percentileParams||i?.include?.length&&!i.include.includes("median")||i?.exclude?.length&&i.exclude.includes("median")||(p.median=y(t,e.percentileParams)),p}function y(e,t){const{fieldType:r,value:n,orderBy:i,isDiscrete:s}=t,a=v(r,"desc"===i);if(0===(e=[...e].filter((e=>null!=e)).sort(((e,t)=>a(e,t)))).length)return null;if(n<=0)return e[0];if(n>=1)return e[e.length-1];const o=(e.length-1)*n,l=Math.floor(o),c=l+1,u=o%1,d=e[l],h=e[c];return c>=e.length||s||"string"==typeof d||"string"==typeof h?d:d*(1-u)+h*u}function v(e,t){if(e){if(d.has(e))return O(t);if(h.has(e))return x(t,!1);if("esriFieldTypeTimestampOffset"===e)return function(e){return e?E:A}(t);const r=x(t,!0);if("esriFieldTypeString"===e)return r;if("esriFieldTypeGUID"===e||"esriFieldTypeGlobalID"===e)return(e,t)=>r(C(e),C(t))}const r=t?1:-1,n=O(t),i=x(t,!0),s=S(t);return(e,t)=>"number"==typeof e&&"number"==typeof t?n(e,t):"string"==typeof e&&"string"==typeof t?i(e,t):s(e,t)??r}const T=(e,t)=>null==e?null==t?0:1:null==t?-1:null,b=(e,t)=>null==e?null==t?0:-1:null==t?1:null;function S(e){return e?T:b}const A=(e,t)=>b(e,t)??(e===t?0:new Date(e).getTime()-new Date(t).getTime()),E=(e,t)=>T(e,t)??(e===t?0:new Date(t).getTime()-new Date(e).getTime()),w=(e,t)=>b(e,t)??(e===t?0:e<t?-1:1),I=(e,t)=>T(e,t)??(e===t?0:e<t?1:-1);function x(e,t){if(!t)return e?I:w;const r=S(e);return e?(e,t)=>{const n=r(e,t);return null!=n?n:(e=e.toUpperCase())>(t=t.toUpperCase())?-1:e<t?1:0}:(e,t)=>{const n=r(e,t);return null!=n?n:(e=e.toUpperCase())<(t=t.toUpperCase())?-1:e>t?1:0}}const R=(e,t)=>T(e,t)??t-e,M=(e,t)=>b(e,t)??e-t;function O(e){return e?R:M}function C(e){return e.slice(24,36)+e.slice(19,23)+e.slice(16,18)+e.slice(14,16)+e.slice(11,13)+e.slice(9,11)+e.slice(6,8)+e.slice(4,6)+e.slice(2,4)+e.slice(0,2)}function N(e,t,r){let n;for(n in e)t?.include?.length&&!t.include.includes(n)||t?.exclude?.length&&t.exclude.includes(n)?delete e[n]:f.includes(n)&&(Number.isFinite(e[n])||(e[n]=null));return r?(["avg","stddev","variance"].forEach((t=>{null!=e[t]&&(e[t]=Math.ceil(e[t]??0))})),e):e}function L(e){const t={};for(let r of e)(null==r||"string"==typeof r&&""===r.trim())&&(r=null),null==t[r]?t[r]={count:1,data:r}:t[r].count++;return{count:t}}function F(e){return"coded-value"!==e?.type?[]:e.codedValues.map((e=>e.code))}function D(e,t,r,n){const i=e.count,s=[];if(r&&t){const e=[],r=F(t[0]);for(const i of r)if(t[1]){const r=F(t[1]);for(const s of r)if(t[2]){const r=F(t[2]);for(const t of r)e.push(`${p(i)}${n}${p(s)}${n}${p(t)}`)}else e.push(`${p(i)}${n}${p(s)}`)}else e.push(i);for(const t of e)i.hasOwnProperty(t)||(i[t]={data:t,count:0})}for(const e in i){const t=i[e];s.push({value:t.data,count:t.count,label:t.label})}return{uniqueValueInfos:s}}function P(e,t,r,n){let i=null;switch(t){case"log":0!==e&&(i=Math.log(e)*Math.LOG10E);break;case"percent-of-total":Number.isFinite(n)&&0!==n&&(i=e/n*100);break;case"field":Number.isFinite(r)&&0!==r&&(i=e/r);break;case"natural-log":e>0&&(i=Math.log(e));break;case"square-root":e>0&&(i=e**.5)}return i}function B(e,t){const r=U({field:t.field,normalizationType:t.normalizationType,normalizationField:t.normalizationField,classificationMethod:t.classificationMethod,standardDeviationInterval:t.standardDeviationInterval,breakCount:t.numClasses||l});return e=function(e,t,r){const n=t??-1/0,i=r??1/0;return e.filter((e=>Number.isFinite(e)&&e>=n&&e<=i))}(e,t.minValue,t.maxValue),(0,i.t)({definition:r,values:e,normalizationTotal:t.normalizationTotal})}function U(e){const{breakCount:t,field:r,normalizationField:i,normalizationType:s}=e,l=e.classificationMethod||a,c="standard-deviation"===l?e.standardDeviationInterval||o:void 0,u="defined-interval"===l?e.definedInterval:void 0;return new n.A({breakCount:t,classificationField:r,classificationMethod:l,normalizationField:"field"===s?i:void 0,normalizationType:s,standardDeviationInterval:c,definedInterval:u})}function G(e,t){let r=e.classBreaks;const n=r.length,i=r[0]?.minValue,s=r[n-1]?.maxValue,a="standard-deviation"===t,o=u;return r=r.map((e=>{const t=e.label,r={minValue:e.minValue,maxValue:e.maxValue,label:t};if(a&&t){const e=t.match(o),n=e?.map((e=>+e.trim()))??[];2===n.length?(r.minStdDev=n[0],r.maxStdDev=n[1],n[0]<0&&n[1]>0&&(r.hasAvg=!0)):1===n.length&&(t.includes("<")?(r.minStdDev=null,r.maxStdDev=n[0]):t.includes(">")&&(r.minStdDev=n[0],r.maxStdDev=null))}return r})),{minValue:i,maxValue:s,classBreakInfos:r,normalizationTotal:e.normalizationTotal}}function z(e,t){const r=H(e,t);if(null==r.min&&null==r.max)return{bins:[],minValue:r.min,maxValue:r.max,normalizationTotal:t.normalizationTotal};const n=r.intervals,i=r.min??0,s=r.max??0,a=n.map(((e,t)=>({minValue:n[t][0],maxValue:n[t][1],count:0})));for(const t of e)if(null!=t&&t>=i&&t<=s){const e=V(n,t);e>-1&&a[e].count++}return{bins:a,minValue:i,maxValue:s,normalizationTotal:t.normalizationTotal}}function H(e,t){const{field:r,classificationMethod:n,standardDeviationInterval:i,normalizationType:s,normalizationField:a,normalizationTotal:o,minValue:l,maxValue:u}=t,d=t.numBins||c;let h=null,f=null,p=null;if(n&&"equal-interval"!==n||s){const{classBreaks:t}=B(e,{field:r,normalizationType:s,normalizationField:a,normalizationTotal:o,classificationMethod:n,standardDeviationInterval:i,minValue:l,maxValue:u,numClasses:d});h=t[0].minValue,f=t[t.length-1].maxValue,p=t.map((e=>[e.minValue,e.maxValue]))}else{if(null!=l&&null!=u)h=l,f=u;else{const t=_({values:e,minValue:l,maxValue:u,useSampleStdDev:!s,supportsNullCount:m({normalizationType:s,normalizationField:a,minValue:l,maxValue:u})});h=t.min??null,f=t.max??null}p=function(e,t,r){const n=(t-e)/r,i=[];let s,a=e;for(let e=1;e<=r;e++)s=a+n,s=Number(s.toFixed(16)),i.push([a,e===r?t:s]),a=s;return i}(h??0,f??0,d)}return{min:h,max:f,intervals:p}}function V(e,t){let r=-1;for(let n=e.length-1;n>=0;n--)if(t>=e[n][0]){r=n;break}return r}},11876:function(e,t,r){r.d(t,{H:function(){return a},q:function(){return s}});var n=r(53216),i=r(38225);async function s(e){if(!e)return;const t=e.includes("-vector")?e.slice(0,e.indexOf("-vector")):e.includes("-3d")?e.slice(0,e.indexOf("-3d")):e,r=await(0,i.ud)("esri/t9n/basemaps");return r[e]||r[t]}const a={satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return(0,n.s)("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return(0,n.s)("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return(0,n.s)("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return(0,n.s)("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return(0,n.s)("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return(0,n.s)("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get"dark-gray"(){return{...this["dark-gray-vector"],id:"dark-gray"}},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return(0,n.s)("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get gray(){return{...this["gray-vector"],id:"gray"}},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return(0,n.s)("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},get streets(){return{...this["streets-vector"],id:"streets"}},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return(0,n.s)("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},get topo(){return{...this["topo-vector"],id:"topo"}},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return(0,n.s)("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return(0,n.s)("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return(0,n.s)("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"topo-3d":{id:"topo-3d",is3d:!0,get thumbnailUrl(){return(0,n.s)("esri/images/basemap/topo-3d.png")},baseMapLayers:[{id:"topo-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/1e7d1784d1ef4b79ba6764d0bd6c3150/resources/styles/root.json",layerType:"VectorTileLayer",title:"Topographic",visibility:!0,opacity:1},{id:"topo-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-3d":{id:"navigation-3d",is3d:!0,get thumbnailUrl(){return(0,n.s)("esri/images/basemap/navigation-3d.jpg")},baseMapLayers:[{id:"navigation-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/ccc904ff872b4144b94934e55e32784b/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation",visibility:!0,opacity:1},{id:"navigation-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"streets-3d":{id:"streets-3d",is3d:!0,get thumbnailUrl(){return(0,n.s)("esri/images/basemap/streets-3d.png")},baseMapLayers:[{id:"streets-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/198298c4c64c4cb19de5b46aa00c198d/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"streets-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"streets-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"osm-3d":{id:"osm-3d",is3d:!0,get thumbnailUrl(){return(0,n.s)("esri/images/basemap/osm-3d.png")},baseMapLayers:[{id:"osm-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/8628d259c9d14bdc848771c23c513940/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap",visibility:!0,opacity:1},{id:"osm-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"gray-3d":{id:"gray-3d",is3d:!0,get thumbnailUrl(){return(0,n.s)("esri/images/basemap/gray-3d.png")},baseMapLayers:[{id:"gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/01a14b466345455ba4176d2e6390db92/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-dark-3d":{id:"navigation-dark-3d",itemId:"5a1365328b4943f09a54cf5fd1205707",is3d:!0,baseMapLayers:[{id:"navigation-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/451a1777ab3f4bf095fae24a117439d9/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation Dark"},{id:"navigation-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"streets-dark-3d":{id:"streets-dark-3d",itemId:"8a4efa2c20484ec9b4557895e65736ff",is3d:!0,baseMapLayers:[{id:"streets-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/bc599b6d741a4ac084b7eea7bf8c5938/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Streets Night (for 3D)"},{id:"streets-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"streets-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"dark-gray-3d":{id:"dark-gray-3d",itemId:"a8b7322a5fe94002bb0f5e0eeb0c5c18",is3d:!0,baseMapLayers:[{id:"dark-gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/4178f71acb934fb89f169e7d667c20c6/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Dark Gray Canvas (for 3D)"},{id:"dark-gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"dark-gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"arcgis-imagery":{get thumbnailUrl(){return(0,n.s)("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return(0,n.s)("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return(0,n.s)("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return(0,n.s)("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return(0,n.s)("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return(0,n.s)("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return(0,n.s)("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return(0,n.s)("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},"arcgis-topographic":{get thumbnailUrl(){return(0,n.s)("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return(0,n.s)("esri/images/basemap/oceans.jpg")},title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]},"arcgis-human-geography":{title:"Human Geography",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Base",title:"Human Geography Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Detail",title:"Human Geography Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Label",title:"Human Geography Label",isReference:!0}]},"arcgis-human-geography-dark":{title:"Human Geography (Dark)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Base",title:"Human Geography Dark Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Detail",title:"Human Geography Dark Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Label",title:"Human Geography Dark Label",isReference:!0}]}}},51107:function(e,t,r){r.d(t,{VC:function(){return u},dp:function(){return h},jj:function(){return d},ns:function(){return f}});var n=r(74756),i=r(25591),s=(r(78879),r(40633)),a=r(95929),o=(r(90683),r(67888)),l=(r(25128),r(11876));const c=()=>s.A.getLogger("esri.support.basemapUtils");function u(){return{}}function d(e){for(const t in e){const r=e[t];(0,a.pR)(r),delete e[t]}}function h(e,t){let r;if("string"==typeof e){const s=e in l.H,a=!s&&e.includes("/");if(!s&&!a){if(i.default.apiKey)c().warn(`Unable to find basemap definition for: ${e}. See available styles at https://developers.arcgis.com/rest/basemap-styles/`);else{const t=Object.entries(l.H).filter((([e,t])=>t.classic||t.is3d)).map((([e])=>`"${e}"`)).sort().join(", ");c().warn(`Unable to find basemap definition for: ${e}. Try one of these: ${t}`)}return null}t&&(r=t[e]),r||(r=s?n.default.fromId(e):new n.default({style:{id:e}}),t&&(t[e]=r))}else r=(0,o.dp)(n.default,e);return r?.destroyed&&(c().warn("The provided basemap is already destroyed",{basemap:r}),r=null),r}function f(e,t){return e.basemap?.referenceLayers?.some((e=>e.uid===t))||e.basemap?.baseLayers?.some((e=>e.uid===t))}},9030:function(e,t,r){r.d(t,{D:function(){return i}});var n=r(93040);async function i(e,t){const{data:r}=await(0,n.A)(e,{responseType:"image",...t});return r}},75302:function(e,t,r){r.d(t,{$2:function(){return w},$C:function(){return b},Hj:function(){return A},Mh:function(){return E},W$:function(){return _},pW:function(){return S},t8:function(){return T},vY:function(){return I}});var n=r(62938),i=r(73364),s=r(39714),a=r(32501),o=r(33400),l=r(41546),c=r(46157),u=r(24761),d=r(87416),h=r(72228),f=r(38441),p=r(67376),m=r(46460),g=r(45328);function _(e,t){if("point"===e.type)return v(e,t,!1);if((0,g.gr)(e))switch(e.type){case"extent":return v(e.center,t,!1);case"polygon":return v(e.centroid,t,!1);case"polyline":return v(y(e),t,!0);case"mesh":return v((0,p.MW)(e.vertexSpace,e.spatialReference)??e.extent.center,t,!1);case"multipoint":return}else switch(e.type){case"extent":return v(function(e){return(0,m.T)(.5*(e.xmax+e.xmin),.5*(e.ymax+e.ymin),null!=e.zmin&&null!=e.zmax&&isFinite(e.zmin)&&isFinite(e.zmax)?.5*(e.zmax+e.zmin):void 0,e.spatialReference)}(e),t,!0);case"polygon":return v(function(e){const t=e.rings[0];if(!t||0===t.length)return null;const r=(0,h.S8)(e.rings,!!e.hasZ);return(0,m.T)(r[0],r[1],r[2],e.spatialReference)}(e),t,!0);case"polyline":return v(y(e),t,!0);case"multipoint":return}}function y(e){const t=e.paths[0];if(!t||0===t.length)return null;const r=(0,f.$H)(t,(0,f.Yl)(t)/2);return(0,m.T)(r[0],r[1],r[2],e.spatialReference)}function v(e,t,r){const n=r?e:(0,g.EL)(e);return t&&e?(0,c.projectPoint)(e,n,t)?n:null:n}function T(e,t,r,n=0){if(e){t||(t=(0,d.vt)());const i=e;let s=.5*i.width*(r-1),a=.5*i.height*(r-1);return i.width<1e-7*i.height?s+=a/20:i.height<1e-7*i.width&&(a+=s/20),(0,o.s)(t,i.xmin-s-n,i.ymin-a-n,i.xmax+s+n,i.ymax+a+n),t}return null}function b(e,t,r=null){const n=(0,l.o8)(l.Un);return null!=e&&(n[0]=e[0],n[1]=e[1],n[2]=e[2]),null!=t?n[3]=t:null!=e&&e.length>3&&(n[3]=e[3]),r&&(n[0]*=r,n[1]*=r,n[2]*=r,n[3]*=r),n}function S(e=a.Un,t,r,n=1){const i=new Array(3);if(null==t||null==r)i[0]=1,i[1]=1,i[2]=1;else{let n,s=0;for(let a=2;a>=0;a--){const o=e[a];let l;const c=null!=o,u=0===a&&!n&&!c,d=r[a];"symbol-value"===o||u?l=0!==d?t[a]/d:1:c&&"proportional"!==o&&isFinite(o)&&(l=0!==d?o/d:1),null!=l&&(i[a]=l,n=l,s=Math.max(s,Math.abs(l)))}for(let e=2;e>=0;e--)null==i[e]?i[e]=n:0===i[e]&&(i[e]=.001*s)}for(let e=2;e>=0;e--)i[e]/=n;return(0,a.ci)(i)}function A(e){return E(function(e){return null!=e.isPrimitive}(e)?[e.width,e.depth,e.height]:e)?null:"Symbol sizes may not be negative values"}function E(e){const t=e=>null==e||e>=0;return Array.isArray(e)?e.every(t):t(e)}function w(e,t,r,n=(0,s.vt)()){return e&&(0,i.Qr)(n,n,-e/180*Math.PI),t&&(0,i.eL)(n,n,t/180*Math.PI),r&&(0,i.Z8)(n,n,r/180*Math.PI),n}function I(e,t,r){if(null!=r.minDemResolution)return r.minDemResolution;const i=(0,n.GA)(t),s=(0,u.VL)(e)*i,a=(0,u.yr)(e)*i,o=(0,u.uJ)(e)*(t.isGeographic?1:i);return 0===s&&0===a&&0===o?r.minDemResolutionForPoints:.01*Math.max(s,a,o)}},38518:function(e,t,r){r.r(t),r.d(t,{default:function(){return Xe}});var n=r(53804),i=r(48996),s=r(60539),a=r(28181),o=r(23502),l=r(58941),c=(r(40633),r(13798),r(65953)),u=r(57165),d=r(75707),h=r(7926),f=r(83525),p=r(77472),m=r(62790);let g=class extends f.A{constructor(e){super(e),this._removing=0,this._tiles=new m.A}destroy(){for(const e of this._tiles.values())e.remove();this._tiles.clear()}get updating(){if(this._removing>0)return!0;for(const e of this._tiles.values())if(!e.finished)return!0;return!1}async onTileTreeChange(e){const{added:t,removed:r}=e,n=this._tiles,i=[];for(const e of r){const t=n.get(e);null!=t&&(t.abort(),n.delete(e),i.push({tileId:e}))}for(const e of t)n.has(e.id)||n.set(e.id,(0,p.UT)((t=>this._addTile(e,t))));await this._removeTiles(i)}async _addTile(e,t){const r=await this.addTile(e,t);return(0,s.Te)(t),r}async _removeTiles(e){this._removing++,await this.removeTiles(e),this._removing--}};(0,n._)([(0,o.MZ)()],g.prototype,"updating",null),(0,n._)([(0,o.MZ)({constructOnly:!0})],g.prototype,"addTile",void 0),(0,n._)([(0,o.MZ)({constructOnly:!0})],g.prototype,"removeTiles",void 0),(0,n._)([(0,o.MZ)()],g.prototype,"_removing",void 0),g=(0,n._)([(0,c.$)("esri.views.3d.layers.graphics.pipeline.Tile3DManager")],g);var _=r(50612),y=r(40302),v=r(76613);class T{constructor(e,t){this._index=e,this._view=t}getObjectId(){return this._view.getObjectId(this._index)}getAttribute(e){return this._view.getAttribute(this._index,e)}getAttributeAsTimestamp(e){return this._view.getAttributeAsTimestamp(this._index,e)}getAttributes(){return this._view.getAttributes(this._index)}getOptimizedGeometry(){return this._view.getOptimizedGeometry(this._index)}getCentroid(e){return this._view.getCentroid(this._index,e)}getBounds(){return this._view.getBounds(this._index)}getBoundingBox(){return this._view.getBoundingBox(this._index)}cloneWithGeometry(e){return new b(this._index,this._view,e)}}class b extends T{constructor(e,t,r){super(e,t),this._geometryOverride=r}getOptimizedGeometry(){return this._geometryOverride}getCentroid(e){return(0,y.Q)(new v.A,this._geometryOverride,e.hasZ,e.hasM)}}class S{constructor(){this._storedTiles=new Map,this._pageBounds=new Map,this.events=new i.A,this.featureAdapter=A.shared}addTile(e){this._storedTiles.set(e.descriptor.id,e);for(const t of e.pages)this._addPage(t)}removeTile(e){const t=this._storedTiles,r=t.get(e);if(null!=r){t.delete(e);for(const e of r.pages)this._removePage(e)}}_addPage(e){const{featureCount:t}=e;if(0===t)return;const r=new _.w(9,(t=>e.getBounds(t))),n=new Array;for(let e=0;e<t;++e)n[e]=e;r.load(n),this._pageBounds.set(e,r),this.events.emit("changed")}_removePage(e){this._pageBounds.delete(e),this.events.emit("changed")}clear(){this._storedTiles.clear(),this._pageBounds.clear(),this.events.emit("changed")}forEach(e){for(const[t,r]of this._pageBounds)r.all((r=>e(new T(r,t))))}forEachInBounds(e,t){E.minX=e[0],E.minY=e[1],E.maxX=e[2],E.maxY=e[3];for(const[e,r]of this._pageBounds)r.search(E,(r=>t(new T(r,e))))}forEachBounds(e,t){for(const r of e)t(r.getBoundingBox())}getFullExtent(e){let t=1/0,r=1/0,n=-1/0,i=-1/0;for(const e of this._pageBounds.values()){const{minX:s,minY:a,maxX:o,maxY:l}=e.toJSON();t=Math.min(t,s),r=Math.min(r,a),n=Math.min(n,o),i=Math.min(i,l)}return{xmin:t,ymin:r,xmax:n,ymax:i,spatialReference:e}}}class A{getObjectId(e){return e.getObjectId()}getAttribute(e,t){return e.getAttribute(t)}getAttributeAsTimestamp(e,t){return e.getAttributeAsTimestamp(t)}getAttributes(e){return e.getAttributes()}getGeometry(e){return e.getOptimizedGeometry()}getCentroid(e,t){return e.getCentroid(t)}cloneWithGeometry(e,t){return e.cloneWithGeometry(t)}}A.shared=new A;const E=new _.E;var w=r(87416),I=r(90066);class x{constructor(e,t){this.descriptor=e,this.pages=t}}var R=r(39819),M=r(68225),O=r(32501),C=r(24761),N=r(87280),L=r(7103),F=r(45608);class D{constructor(e){const t=new M.A(new Uint8Array(e),new DataView(e));this._reader=t,this._index=function(e){for(;e.next();){if(2===e.tag())return P(e.getMessage());e.skip()}U()}(t)}get featureCount(){return this._index.featureIndices.length}get exceededTransferLimit(){return this._index.exceededTransferLimit}getObjectId(e){return this.getAttribute(e,this._index.objectIdFieldName)}getAttribute(e,t){const{_index:{fieldsIndex:r,attributeIndices:n}}=this,i=r.get(t)?.index;if(null==i)return;const s=n[e*r.fields.length+i],a=this._reader;return a.move(s),G(a)}getAttributeAsTimestamp(e,t){const r=this.getAttribute(e,t);return"string"==typeof r?new Date(r).getTime():"number"==typeof r||null==r?r:null}getAttributes(e){const{_index:{fieldsIndex:t,attributeIndices:r}}=this,n=e*t.fields.length,i=this._reader,s={};for(const e of t.fields){const t=r[n+e.index];i.move(t),s[e.name]=G(i)}return s}getCoordinates(e,t,r=0){const n=this._reader,{transform:i,featureIndices:s}=this._index,{scale:a,translate:o}=i;n.move(s[e]),this._readCoordinates(a,o,t,r)}getOptimizedGeometry(e){const t=(0,O.vt)();return this.getCoordinates(e,t),new v.A([],t)}getCentroid(e,{hasZ:t,hasM:r}){this.getCoordinates(e,z);const[n,i,s]=z,a=[n,i];return t&&(a[3]=s),r&&(a[t?4:3]=0),new v.A([],a)}getBounds(e){this.getCoordinates(e,z);const[t,r]=z,n=new _.E;return n.minX=t,n.minY=r,n.maxX=t,n.maxY=r,n}getBoundingBox(e){this.getCoordinates(e,z);const[t,r,n]=z;return(0,C.fA)(t,r,n,t,r,n)}readAllObjectIds(e,t=0){const r=this._reader,{_index:n,featureCount:i}=this,{objectIdFieldName:s,attributeIndices:a,fieldsIndex:o}=n,l=o.get(s).index,c=o.fields.length;for(let n=0;n<i;++n){const i=a[n*c+l];r.move(i),e[t++]=G(r)}return t}readAllCoordinates(e,t=0){const r=this._reader,{transform:n,featureIndices:i}=this._index,{scale:s,translate:a}=n;for(const n of i)r.move(n),t=this._readCoordinates(s,a,e,t);return t}_readCoordinates([e,t,r],[n,i,s],a,o){const l=this._reader,c=l.getLength(),u=l.pos()+c;for(;l.pos()<u&&l.next();)switch(l.tag()){case 2:{const c=l.getLength(),u=l.pos()+c;for(;l.pos()<u&&l.next();)3===l.tag()?(l.getUInt32(),a[o++]=n+e*l.getSInt64(),a[o++]=i+t*l.getSInt64(),a[o++]=s+r*l.getSInt64()):l.skip();break}default:l.skip()}return o}}function P(e){for(;e.next();){if(1===e.tag())return B(e.getMessage());e.skip()}U()}function B(e){let t,r,n=!1,i=!1,s=0;const a=new Array,o=new Array,l=new Array;for(;e.next();)switch(e.tag()){case 1:r=e.getString();break;case 7:0!==e.getEnum()&&U();break;case 9:n=e.getBool()??!1;break;case 12:t=(0,N.Q1)(e.processMessage(F.ae));break;case 13:{const t=e.processMessage(F.cn);t.index=s++,a.push(t);break}case 15:{o.push(e.pos());const t=e.getUInt32(),r=e.pos()+t;for(;e.pos()<r&&e.next();)1===e.tag()?(l.push(e.pos()),e.skip()):e.skip();break}case 10:i=e.getBool()??!1;break;default:e.skip()}const c=new L.A(a);return null!=t&&i&&null!=r&&c.has(r)||U(),{transform:t,exceededTransferLimit:n,fieldsIndex:c,objectIdFieldName:r,featureIndices:o,attributeIndices:l}}function U(){const e=new R.A("pbf-parsing-failed","Error while parsing PBF",new Error);throw console.error(e),e}function G(e){const t=e.getLength(),r=e.pos()+t;for(;e.pos()<r&&e.next();)switch(e.tag()){case 1:return e.getString();case 2:return e.getFloat();case 3:return e.getDouble();case 4:return e.getSInt32();case 5:return e.getUInt32();case 6:return e.getInt64();case 7:return e.getUInt64();case 8:return e.getSInt64();case 9:return e.getBool();default:return e.skip(),null}return null}const z=(0,O.vt)();class H{constructor(e,t,r,n,i){this.spatialReference=e,this.url=r,this.objectIdField=n,this.capabilities=i;const{supportsMaxRecordCountFactor:s,maxRecordCount:a}=this.capabilities.query,o=s?4:1,l=(a??8e3)*o;this._pageSize=Math.min(8e3,l);const c=t.clone();c.cacheHint=!0,c.resultType="tile",c.outSpatialReference=e,c.returnGeometry=!0,c.returnZ=!0,c.maxRecordCountFactor=o,c.num=this._pageSize,c.outFields=[n],this._baseQuery=c}async fetch(e,t){const{spatialReference:r}=this,n=(0,w.w1)(e.extent,r),i=this._baseQuery.clone();i.geometry=n;const a=new Array;let o=0,l=!1,c=1;for(;!l;){const e=[];for(let r=0;r<c;++r)e.push(this._fetchPage(i,o++,t));const r=await Promise.all(e);(0,s.Te)(t);for(const e of r){const t=0!==e.featureCount;l||=!e.exceededTransferLimit||!t,t&&a.push(e)}c=Math.min(c+1,4)}return new x(e,a)}async _fetchPage(e,t,r){const n=e.clone();n.start=t*this._pageSize;const i=(await(0,I.kS)(this.url,n,{signal:r})).data;return(0,s.Te)(r),new D(i)}}var V=r(65420),k=r(37819),j=r(61226),Z=r(95929),q=r(41546),W=r(3107),Y=r(69550),$=r(27264),X=r(67521),J=r(52798),Q=r(29165),K=r(51564),ee=r(26347);let te=class extends X.RW{constructor(e){super(e),this._hasHighlights=!1,this._glMaterials=null,this._produces=new Map,this._renderGeometries=new Map,this._vaoCache=null,this._drawParameters=new K.P,this._bufferWriter=null}get produces(){return this._produces}initialize(){this._bufferWriter=this.material.createBufferWriter(),this.material.produces.forEach(((e,t)=>{this._produces.set(t,(t=>!!(t!==$.V.Highlight&&t!==$.V.ShadowHighlight||this._hasHighlights)&&e(t)))}))}destroy(){this._glMaterials.dispose();const e=this._renderGeometries.keys();for(const t of e)this.removeRenderGeometry(t)}acquireTechniques(e){const t=this.material;if(!t.shouldRender(e))return null;const{output:r,bind:n}=e,i=t.produces.get(n.slot);if(!i?.(r))return null;if((r===$.V.Highlight||r===$.V.ShadowHighlight)&&!this._hasHighlights)return null;const s=this._glMaterials.load(e.rctx,n.slot,r);return s?.beginSlot(n)}render(e,t){const r=this._renderGeometries;if(0===r.size)return;const{bind:n}=e,i=n.slot===Q.N.OCCLUDER_MATERIAL||n.slot===Q.N.TRANSPARENT_OCCLUDER_MATERIAL?n.slot:null,s=e.rctx;s.runAppleAmdDriverHelper(),s.bindTechnique(t,n,this.material.parameters);const a=t.program;for(const[e,o]of r)this._drawParameters.origin=o.localOrigin,a.bindDraw(n,this.material.parameters,this._drawParameters),t.ensureAttributeLocations(o.vao),s.bindVAO(o.vao),s.setPipelineState(t.getPipeline(!1,i)),s.drawArrays(t.primitiveType,0,o.numElements)}initializeRenderContext(e,t){this._glMaterials=new J.c(this.material,e.materials);const r=e.renderContext.rctx.getVaoCache(this.material.vertexAttributeLocations,(0,Y.U)(this._bufferWriter.vertexBufferLayout));this._vaoCache=r}uninitializeRenderContext(){}addRenderGeometry(e,t,r){this.removeRenderGeometry(e);const n=this._bufferWriter.vertexBufferLayout.stride,i=this._vaoCache.newVao((0,ee.N)(t.data.byteLength));i.vertexBuffers.get("geometry").setSubData(new Uint8Array(t.data),0,0,t.elementCount*n);const s={localOrigin:r,vao:i,numElements:t.elementCount};return this._renderGeometries.set(e,s),s}removeRenderGeometry(e){const t=this._renderGeometries.get(e);null!=t&&(this._vaoCache.deleteVao(t.vao),this._renderGeometries.delete(e))}};(0,n._)([(0,o.MZ)({constructOnly:!0})],te.prototype,"material",void 0),te=(0,n._)([(0,c.$)("esri.views.3d.layers.graphics.pipeline.rendering.DirectRenderer")],te);var re=r(65839),ne=r(64543),ie=r(68335);let se=class{constructor(e){this._optionalFields=new Array,this._instanceIndexToFeatureId=new Map,this._featureIdToInstanceIndex=new Map,this._disposeResourceHandles=new Array,this._lodRendererResources=null,this.layerUid=e.layerUid,this.view=e.view,this.sharedResources=this.view.sharedSymbolResources,this.scheduler=this.view.resourceController.scheduler}async doLoad(e,t,r){(0,l.A)("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(re.r.OBJECTANDLAYERIDCOLOR);const n=function(e,t){const r=t.levels.map((t=>{const r=t.components.map((t=>{const r=e(t.materialId);if(!function(e){return null!=e&&"materialType"in e&&"default"===e.materialType}(r))throw new Error("LodRenderer only supports DefaultMaterial");const n=r.createBufferWriter(),i={material:r,vertexBufferLayout:n.vertexBufferLayout,buffer:t.renderGeometryBuffer.data,elementCount:t.renderGeometryBuffer.elementCount,boundingInfo:t.boundingInfo};return new ie.iC(i)}));return new ie.hr(r,t.minScreenSpaceRadius)}));return new ie.Fe(r)}((e=>t(e)),e),i=this.view._stage,a=(0,ie.lS)(n);i.addMany(a),this._addDisposeResource((()=>i.removeMany(a)));const o=(0,ie.n3)(n);i.addMany(o),this._addDisposeResource((()=>{o.forEach((e=>e.unload())),i.removeMany(o)})),await Promise.all(o.map((e=>this.view._stage.schedule((()=>e.load(i.renderView.renderingContext)),r)))),(0,s.Te)(r);const c=await this._createLodRenderer(n,r);this._lodRendererResources={lodRenderer:c,materials:a,textures:o}}addInstances(e){const t=this._lodRendererResources;if(null==t)return;const{featureIds:r,localTransforms:n,globalTransforms:i}=e,s=t.lodRenderer;if(null==s)return;const a=s.instanceData,o=r.length;for(let e=0;e<o;++e){const t=r[e],s=a.addInstance(),o=a.view,l=16*e;o.localTransform.copyFromTypedBuffer(s,n,l),o.globalTransform.copyFromTypedBuffer(s,i,l),a.updateModelTransform(s),a.setVisible(s,!0),this._instanceIndexToFeatureId.set(s,t),this._featureIdToInstanceIndex.set(t,s)}}removeInstances(e){const t=this._lodRendererResources;if(null==t)return;const r=t?.lodRenderer,n=r.instanceData,i=this._instanceIndexToFeatureId,s=this._featureIdToInstanceIndex,a=e.length;for(let t=0;t<a;++t){const r=e[t],a=s.get(r);null!=a&&(n.removeInstance(a),i.delete(a),s.delete(r))}}_addDisposeResource(e){this._disposeResourceHandles.push(e)}async _createLodRenderer(e,t){const r=this.view._stage,n={layerUid:this.layerUid,graphicUid:e=>1,notifyGraphicGeometryChanged:e=>1,notifyGraphicVisibilityChanged:e=>1},i=new ne.L({symbol:e,optionalFields:this._optionalFields,metadata:n,shaderTransformation:null},this.scheduler);return i.slicePlaneEnabled=!1,this._addDisposeResource((()=>{r.removeRenderPlugin(i),i.destroy()})),await r.addRenderPlugin(i,t),i}};se=(0,n._)([(0,c.$)("esri.views.3d.layers.graphics.pipeline.rendering.LodRenderer")],se);var ae=r(98323),oe=r(54407),le=r(42674),ce=r(6955),ue=r(27539);let de=class extends f.A{constructor(e){super(),this.view=null,this.layerUid=null,this._renderGeometries=new Map,this._materials=new Map,this._directRenderers=new Map,this._lodRenderers=new Map,this.view=e.view,this.layerUid=e.layerUid}initialize(){}destroy(){}async executeRenderCommands(e){for(const t of e)switch(t.id){case"create-material":await this._createMaterial(t);break;case"create-direct-renderer":await this._createDirectRenderer(t);break;case"add-direct-renderer-geometry":await this._addDirectRendererGeometry(t);break;case"remove-direct-renderer-geometry":await this._removeDirectRendererGeometry(t);break;case"create-lod-renderer":await this._createLodRenderer(t);break;case"add-lod-instances":await this._addLodInstances(t);break;case"remove-lod-instances":await this._removeLodInstances(t)}}async _createMaterial(e){const{view:t}=this,{sharedSymbolResources:r}=t;if(null==r)throw new Error("No shared symbol resources found!");const{textures:n}=r,i=t.state.viewingMode===V.RT.Global;let s=null;switch(e.type){case"default":s=function(e,t,r){const n={usePBR:t.physicalBasedRenderingEnabled,isSchematic:!0,mrrFactors:ue.Bt,ambient:O.Un,diffuse:O.Un,hasSlicePlane:t.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:t.castShadows,offsetTransparentBackfaces:!t.isPrimitive};return function(e){const t=e.opacity??1,r=t<1;e.transparent=r,e.opacity=t,e.cullFace=r?oe.s2.None:oe.s2.Back}(n),t.screenSizePerspectiveEnabled&&(n.screenSizePerspective=e.screenSizePerspectiveSettings),n.externalColor=q.Un,n.isInstanced=!0,new le.$U(n,{spherical:r,doublePrecisionRequiresObfuscation:!0})}(r,{physicalBasedRenderingEnabled:!0,slicePlaneEnabled:!1,castShadows:!0,isPrimitive:!0,screenSizePerspectiveEnabled:!0,doublePrecisionRequiresObfuscation:t._stage.renderView.renderingContext.driverTest.doublePrecisionRequiresObfuscation.result},i);break;case"hud":{const[e,t]=he(n,i);this.addHandles([(0,j.hA)((()=>(0,Z.Gz)(t)))]),s=e}break;default:throw new Error(`unable to create unknown material type ${e.type}`)}this._materials.set(e.materialId,s)}_getMaterial(e){return this._materials.get(e)}async _createDirectRenderer(e){const t=e.materialId,r=this._getMaterial(t);if(null==r)throw new Error(`material not found ${t}`);const{view:n}=this,i=new te({material:r});this._directRenderers.set(t,i),n._stage.addRenderPlugin(i),n._stage.renderView.renderer.updateHasFlags()}async _addDirectRendererGeometry(e){const t=e.renderGeometryId,r=e.materialId;null!=this._renderGeometries.get(t)&&await this._removeDirectRendererGeometry({renderGeometryId:t});const n=this._directRenderers.get(r);if(null==n)return void console.error("no renderer assigned to provided material");const i=n.addRenderGeometry(t,e.renderGeometryBuffer,e.localOrigin);this._renderGeometries.set(t,{renderGeometry:i,materialId:r}),this.view._stage.renderView.requestRender()}async _removeDirectRendererGeometry(e){const t=e.renderGeometryId,r=this._renderGeometries.get(t);if(null==r)return;const n=r.materialId,i=this._directRenderers.get(n);null!=i?i.removeRenderGeometry(e.renderGeometryId):console.error("no renderer assigned to provided material")}async _createLodRenderer(e){const t=new se({view:this.view,layerUid:this.layerUid}),r=new AbortController;await t.doLoad(e.lodRenderGeometry,(e=>this._getMaterial(e)),r.signal),this._lodRenderers.set(e.lodRendererId,t)}async _addLodInstances(e){const t=this._lodRenderers.get(e.lodRendererId);if(null==t)throw new Error("no lod renderer assigned to provided lod renderer Id");t.addInstances(e.data)}async _removeLodInstances(e){const t=this._lodRenderers.get(e.lodRendererId);if(null==t)throw new Error("no lod renderer assigned to provided lod renderer Id");t.removeInstances(e.featureIds)}};function he(e,t){const r={anchorPosition:W.Zd.center,occlusionTest:!0,hasSlicePlane:!1},n=r;if(n.color=[1,0,0,1],n.outlineColor=[0,0,0,1],n.outlineSize=1,null!=e){const t=e.fromData("circle-icon",(()=>(0,ae.sZ)("circle")));n.textureId=t.texture.id,n.textureIsSignedDistanceField=!0,n.sampleSignedDistanceFieldTexelCenter=(0,ae.ny)("circle")}return n.distanceFieldBoundingBox=fe,[new ce.R(r,t),null]}de=(0,n._)([(0,c.$)("esri.views.3d.layers.graphics.pipeline.rendering.FeaturePipelineRenderManager")],de);const fe=[ae.CN/2,ae.CN/2,1-ae.CN/2,1-ae.CN/2];var pe=r(73364),me=r(39714);class ge{constructor(e){this._bufferWriter=null,this._bufferWriter=e.createBufferWriter()}createBuffer(e,t){const r=this._bufferWriter;let n=null;if(e.transformation&&t)(0,pe.C)(_e,e.transformation),_e[12]-=t[0],_e[13]-=t[1],_e[14]-=t[2],n=_e;else{if(t)throw new Error("not implemented");e.transformation&&(n=e.transformation)}let i=null;n&&((0,pe.B8)(ye,_e),(0,pe.mg)(ye,ye),i=ye);const s=e.attributes,a=r.elementCount(s),o=r.vertexBufferLayout.stride/4;a>Math.floor(ve/o)&&console.warn("geometry with very large number of elements encountered");const l=r.vertexBufferLayout.createBuffer(a);return r.write(n,i,s,e.objectAndLayerIdColor,l,0),{data:l.buffer,elementCount:a}}}const _e=(0,me.vt)(),ye=(0,me.vt)(),ve=4194304;var Te,be=r(53905);class Se{constructor(e){this._context=e,this._commands=[],this._transferables=new Set}createMaterial(e){const t=this._context,r=t.generateId("material");switch(e){case"default":{const e=new le.$U({},{spherical:this._context.globalViewingMode,doublePrecisionRequiresObfuscation:!0}),n=new ge(e);t.registerRenderGeometryBufferWriter(r,n)}break;case"hud":{const e=he(null,this._context.globalViewingMode)[0],n=new ge(e);t.registerRenderGeometryBufferWriter(r,n)}}return this._commands.push({id:"create-material",type:e,materialId:r}),r}createDirectRenderer(e){const t=this._context.generateId("material-renderer");return this._commands.push({id:"create-direct-renderer",materialRendererId:t,materialId:e}),t}addDirectRendererGeometry(e,t,r){const n=t.materialId,i=this._context.getRenderGeometryBufferWriter(n);if(null==i)throw new Error(`no bufferwriter found for material ${n}`);const s=i.createBuffer(t,r);this._transferables.add(s.data),this._commands.push({id:"add-direct-renderer-geometry",renderGeometryId:e,materialId:n,renderGeometryBuffer:s,localOrigin:r})}removeDirectRendererGeometry(e){this._commands.push({id:"remove-direct-renderer-geometry",renderGeometryId:e})}createLodRenderer(e){const t=this._context.generateId("lod-renderer"),r={levels:e.levels.map((e=>({components:e.components.map((e=>{const t=e.attributes.get(re.r.POSITION);if(!t||0===t.indices.length)throw new Error("positions attribute expected");const r=(0,k.tM)(t.indices.length/3),n=new be.j(r,3,t),i=this._context.getRenderGeometryBufferWriter(e.materialId);if(null==i)throw new Error("writer not found");const s=i.createBuffer(e,null);return this._transferables.add(s.data),{materialId:e.materialId,renderGeometryBuffer:s,boundingInfo:{bbMax:n.bbMax,bbMin:n.bbMin}}})),minScreenSpaceRadius:e.minScreenSpaceRadius})))};return this._commands.push({id:"create-lod-renderer",lodRendererId:t,lodRenderGeometry:r}),t}addLodInstances(e,t){this._commands.push({id:"add-lod-instances",lodRendererId:e,data:t}),this._transferables.add(t.featureIds.buffer),this._transferables.add(t.globalTransforms.buffer),this._transferables.add(t.localTransforms.buffer)}removeLodInstances(e,t){this._commands.push({id:"remove-lod-instances",lodRendererId:e,featureIds:t}),this._transferables.add(t.buffer)}async dispatch(){const e=this._commands,t=Array.from(this._transferables);this._clearCommandBuffer(),this._context.dispatchRenderCommands(e,t)}_clearCommandBuffer(){this._commands=[],this._transferables.clear()}}class Ae{constructor(e){this._idCounter=0,this._bufferWriters=new Map,this._dispatchRenderCommandsCallback=async()=>{},this.globalViewingMode=!1,this.globalViewingMode=e.viewingMode===V.RT.Global,this._dispatchRenderCommandsCallback=e.dispatchRenderCommandsCallback}generateId(e=""){return`${e}${this._idCounter++}`}createEncoder(){return new Se(this)}async dispatchRenderCommands(e,t){this._dispatchRenderCommandsCallback(e,t)}registerRenderGeometryBufferWriter(e,t){this._bufferWriters.set(e,t)}getRenderGeometryBufferWriter(e){return this._bufferWriters.get(e)}}!function(e){e[e.OBJECT_ID=0]="OBJECT_ID",e[e.PARTITION_ID=1]="PARTITION_ID",e[e.GEOMETRY_MAP_COORDINATES=2]="GEOMETRY_MAP_COORDINATES",e[e.GEOMETRY_RENDER_COORDINATES=3]="GEOMETRY_RENDER_COORDINATES",e[e.TILE_CENTER_RENDER_COORDINATES=4]="TILE_CENTER_RENDER_COORDINATES"}(Te||(Te={}));var Ee=r(57617),we=r(68734);async function Ie(e,t){const{numFeatures:r,tile:n,partitionInfo:i}=e,{pages:s}=n;if(0===s.length||0===r)return new Uint32Array;const a=new Uint32Array(r);if(i){const e=s.reduce(((e,{featureCount:t})=>e+t),0),t=new Uint32Array(e);let n=0;for(const e of s)n=e.readAllObjectIds(t,n);const o=i.tileIndices;for(let e=0;e<r;++e){const r=t[o[e]];a[e]=r}}else{let e=0;for(const t of s)e=t.readAllObjectIds(a,e)}return a}async function xe(e,t){const{numFeatures:r,tile:n,partitionInfo:i}=e,{pages:s}=n;if(0===s.length||0===r)return new Float64Array;const a=new Float64Array(3*r);if(i){const e=s.reduce(((e,{featureCount:t})=>e+t),0),t=new Float64Array(3*e);let n=0;for(const e of s)n=e.readAllCoordinates(t,n);const o=i.tileIndices;for(let e=0;e<r;++e){const r=o[e],n=t[3*r+0],i=t[3*r+1],s=t[3*r+2];a[3*e+0]=n,a[3*e+1]=i,a[3*e+2]=s}}else{let e=0;for(const t of s)e=t.readAllCoordinates(a,e)}return a}async function Re(e,t){await e.provision([Te.GEOMETRY_MAP_COORDINATES],t);const{numFeatures:r,tile:n,mapCoordinates:i}=e,{pages:s}=n;if(0===s.length||0===r)return new Float64Array;const a=t.viewSpatialReference,o=t.renderSpatialReference,l=new Float64Array(3*r);if(!(0,Ee.projectBuffer)(i,a,0,l,o,0,r))throw new Error("Failed to project coordinates");return l}async function Me(e,t){const r=t.viewSpatialReference,n=t.renderSpatialReference,i=e.tile.descriptor.extent,s=(0,w.gX)(i),a=(0,O.vt)();return(0,we.F)([s[0],s[1],0],r,a,n),a}class Oe{constructor(e,t,r=null){this._tile=e,this._numFeatures=t,this._partitionInfo=r}get partitionInfo(){return this._partitionInfo}get tile(){return this._tile}get numFeatures(){return this._numFeatures}get tileId(){return this._tile.descriptor.id}get objectIds(){if(null==this._objectIds)throw new Error("objectIds haven't been provisioned yet");return this._objectIds}get partitionIds(){if(null==this._partitionIds)throw new Error("partitionIds haven't been provisioned yet");return this._partitionIds}get mapCoordinates(){if(null==this._mapCoordinates)throw new Error("mapCoordinates haven't been provisioned yet");return this._mapCoordinates}get renderCoordinates(){if(null==this._renderCoordinates)throw new Error("renderCoordinates haven't been provisioned yet");return this._renderCoordinates}get tileCenterRenderCoordinates(){if(null==this._tileCenterRenderCoordinates)throw new Error("tileCenterRenderCoordinates hasn't been provisioned yet");return this._tileCenterRenderCoordinates}async provision(e,t){for(const r of e)switch(r){case Te.OBJECT_ID:if(this._objectIds)return;this._objectIds=await Ie(this);break;case Te.PARTITION_ID:if(this._partitionIds)return;this._partitionIds=new Uint32Array(this._numFeatures);break;case Te.GEOMETRY_MAP_COORDINATES:if(this._mapCoordinates)return;this._mapCoordinates=await xe(this);break;case Te.GEOMETRY_RENDER_COORDINATES:if(this._renderCoordinates)return;this._renderCoordinates=await Re(this,t);break;case Te.TILE_CENTER_RENDER_COORDINATES:if(this._tileCenterRenderCoordinates)return;this._tileCenterRenderCoordinates=await Me(this,t);break;default:throw new Error("not implemented")}}dispose(){if(this.partitions){for(const e of this.partitions)e.dispose();this.partitions=void 0}}}var Ce=r(7456),Ne=r(55726),Le=r(75302);function Fe(e){const t=new Map;for(const[r,n]of e)t.set(r,{...n,indices:(0,k.Dg)(n.indices)});return t}var De=r(89932),Pe=r(8470);function Be(e,t){switch(e){case"cone":return((e,r,n=!1)=>({levels:e.map((e=>{const i=Fe(r(e.tesselation));return n&&function(e){const t=e,r=t.get(re.r.POSITION).data,n=t.get(re.r.NORMAL).data;if(n){const t=Ue(e,re.r.NORMAL).data;for(let e=0;e<n.length;e+=3){const r=n[e+1];t[e+1]=-n[e+2],t[e+2]=r}}if(r){const t=Ue(e,re.r.POSITION).data;for(let e=0;e<r.length;e+=3){const n=r[e+1];t[e+1]=-r[e+2],t[e+2]=n}}}(i),{components:[{attributes:i,objectAndLayerIdColor:void 0,transformation:null,materialId:t}],minScreenSpaceRadius:e.minScreenSpaceRadius}}))}))(Ge,(e=>(0,Pe.YG)(1,.5,e,!1)),!0);case"sphere":case"cube":case"inverted-cone":case"cylinder":case"tetrahedron":case"diamond":throw new Error("not implemented");default:return}}function Ue(e,t){let r=e.get(t);return r&&!r.exclusive&&(r={...r,exclusive:!0,data:(0,De.S)(r.data)},e.set(t,r)),r}const Ge=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];let ze=class extends f.A{constructor(e){super(),this._context=e,this.lodRendererId=null,this._loaded=!1}get loaded(){return this._loaded}async load(e){const t=Be("cone",e.createMaterial("default"));this.lodRendererId=e.createLodRenderer(t),this._loaded=!0}async add(e,t){if(null==this.lodRendererId)throw new Error("expected lod renderer id to not be null");await this._provisionFeatureData(e);const r=e.numFeatures,n=(0,C.vt)((0,Ne.Fq)("cone")),i=(0,O.ci)((0,C.Ej)(n)),s=(0,O.ci)((0,Ne.Bb)(i,{isPrimitive:!0,width:100,depth:null,height:null})),a=new Float64Array(16*r),o=new Float64Array(16*r),l=e.mapCoordinates;for(let e=0;e<r;++e){const t=e,r=l[3*e+0],n=l[3*e+1],c=l[3*e+2],u=this._computeGlobalTransform(r,n,c,this._context.viewSpatialReference,ke),d=this._computeLocalTransform(s,i,Ve);this._writeMatrixToTypedBuffer(a,t,d),this._writeMatrixToTypedBuffer(o,t,u)}const c={featureIds:new Uint32Array(e.objectIds),localTransforms:a,globalTransforms:o};t.addLodInstances(this.lodRendererId,c)}async remove(e,t){if(null==this.lodRendererId)return;const r=new Uint32Array(e.objectIds);t.removeLodInstances(this.lodRendererId,r)}async _provisionFeatureData(e){await e.provision([Te.GEOMETRY_MAP_COORDINATES,Te.OBJECT_ID],this._context)}_writeMatrixToTypedBuffer(e,t,r){let n=16*t;for(let t=0;t<16;t++)e[n++]=r[t]}_computeGlobalTransform(e,t,r,n,i){return He[0]=e,He[1]=t,He[2]=r,(0,Ce.l)(n,He,i,this._context.renderSpatialReference),i}_computeLocalTransform(e,t,r){return(0,pe.D_)(r),this._applyObjectScale(e,t,r),r}_applyObjectScale(e,t,r){const n=(0,Le.pW)(e,e,t,this._context.renderCoordsHelper.unitInMeters);1===n[0]&&1===n[1]&&1===n[2]||(0,pe.hs)(r,r,n)}};ze=(0,n._)([(0,c.$)("esri.views.3d.layers.graphics.pipeline.symbolization.TestObjectSymbol")],ze);const He=(0,O.vt)(),Ve=(0,me.vt)(),ke=(0,me.vt)();var je=r(14905);let Ze=class extends f.A{constructor(e){super(),this._context=e,this.materialId=null,this._loaded=!1}get loaded(){return this._loaded}async load(e){this.materialId=e.createMaterial("hud"),e.createDirectRenderer(this.materialId),this._loaded=!0}async add(e,t){if(null==this.materialId)throw new Error("expected material not to be null");await this._provisionFeatureData(e);const{numFeatures:r,tileId:n,renderCoordinates:i,tileCenterRenderCoordinates:s}=e,a=new Float64Array([0,0,1]),o=new Float64Array([255,255,255,255]),l=new Float64Array([24,24]),c=new Float64Array([0,0,0,1]),u=new Float64Array([0,0]),d=new Float64Array([0]),h=new Uint32Array(r);for(let e=0;e<r;++e)h[e]=e;const f=new Uint32Array(r);for(let e=0;e<r;++e)f[e]=0;const p=new je.n(i,h,3,!0),m=new je.n(a,f,3,!0),g=new je.n(u,f,2,!0),_=new je.n(o,f,4,!0),y=new je.n(d,f,1,!0),v=new je.n(l,f,2,!0),T=new je.n(c,f,4,!0),b={attributes:Fe([[re.r.POSITION,p],[re.r.NORMAL,m],[re.r.UV0,g],[re.r.COLOR,_],[re.r.ROTATION,y],[re.r.SIZE,v],[re.r.CENTEROFFSETANDDISTANCE,T]]),objectAndLayerIdColor:void 0,transformation:(0,me.vt)(),materialId:this.materialId};t.addDirectRendererGeometry(n,b,s)}async remove(e,t){t.removeDirectRendererGeometry(e.tileId)}async _provisionFeatureData(e){await e.provision([Te.GEOMETRY_RENDER_COORDINATES,Te.TILE_CENTER_RENDER_COORDINATES],this._context)}};Ze=(0,n._)([(0,c.$)("esri.views.3d.layers.graphics.pipeline.symbolization.TestSymbol")],Ze);class qe{constructor(e){this._symbols=new Map,this._context=e}async load(){this._symbols.set(0,new Ze(this._context)),this._symbols.set(1,new ze(this._context))}async add(e,t){await this._provisionFeatureData(e,this._context);const r=this._partition(e);await Promise.all(r.map((async e=>{const r=await this._provisionSymbol(e.partitionInfo?.index,t);r&&await r.add(e,t)})))}async remove(e,t){const r=e.partitions;if(!r)throw new Error("partitioned featureset expected");await Promise.all(r.map((async e=>{const r=await this._provisionSymbol(e.partitionInfo?.index,t);r&&await r.remove(e,t)})))}async _provisionFeatureData(e,t){await e.provision([Te.PARTITION_ID,Te.OBJECT_ID],t)}async _provisionSymbol(e,t){if(null==e)return null;const r=this._symbols.get(e);return r?(r.loaded||await r.load(t),r):null}_partition(e){const{numFeatures:t,objectIds:r,partitionIds:n}=e,i=[[],[]];for(let e=0;e<t;++e){const t=r[e]%2;i[t].push(e),n[e]=t}return e.partitions=i.filter((e=>e.length>0)).map(((t,r)=>{const n=t.length,i={index:r,tileIndices:new Uint32Array(t)};return new Oe(e.tile,n,i)})),e.partitions}}var We=r(12378);class Ye{constructor(e){this._tileFeatureData=new Map,this._context={viewSpatialReference:e.viewSpatialReference,renderSpatialReference:e.renderSpatialReference,renderCoordsHelper:We.d.create(e.viewingMode,e.renderSpatialReference)}}async add(e,t){this._featureRenderer||(this._featureRenderer=new qe(this._context),await this._featureRenderer.load());const r=this._addTileFeatureData(e);await this._featureRenderer.add(r,t)}async remove(e,t){const r=this._getFeatureSetFromTileId(e);r&&(this._featureRenderer&&this._featureRenderer.remove(r,t),this._removeTileFeatureData(e))}_getFeatureSetFromTileId(e){return this._tileFeatureData.get(e)}_addTileFeatureData(e){const t=e.descriptor.id,r=e.pages.reduce(((e,{featureCount:t})=>e+t),0),n=new Oe(e,r);return this._tileFeatureData.set(t,n),n}_removeTileFeatureData(e){const t=this._tileFeatureData.get(e);t&&(t.dispose(),this._tileFeatureData.delete(e))}}let $e=class extends i.A.EventedAccessor{constructor(){super(...arguments),this.remoteClient=null,this._featureStore=new S,this._tileManager=new g({addTile:(e,t)=>this._addTile(e,t),removeTiles:e=>this._removeTiles(e)}),this._renderCommandContext=null,this._fetcher=null,this._symbolizer=null,this._queryEngine=null,this._defaultQueryJSON=null}get updating(){return this._tileManager.updating}destroy(){this._featureStore.clear(),this._tileManager.destroy()}async setup({viewSpatialReference:e,renderSpatialReference:t,viewingMode:r,baseQuery:n,url:i,objectIdField:s,capabilities:o,fieldsIndex:l,timeInfo:c}){this._renderCommandContext=new Ae({viewingMode:r,dispatchRenderCommandsCallback:(e,t)=>this.remoteClient.invoke("dispatchRenderCommands",e,{transferList:t})});const f=u.A.fromJSON(e),p=u.A.fromJSON(t);return this._fetcher=new H(f,h.A.fromJSON(n),i,s,o),this._symbolizer=new Ye({viewSpatialReference:f,renderSpatialReference:p,viewingMode:r}),this._queryEngine=new d.d({hasZ:!0,hasM:!1,geometryType:"esriGeometryPoint",objectIdField:s,fieldsIndex:l,availableFields:[s],spatialReference:e,featureStore:this._featureStore,timeInfo:c}),this._defaultQueryJSON=new h.A({outSpatialReference:f}).toJSON(),this.addHandles((0,a.watch)((()=>this.updating),(async e=>{this.emit("notify-updating",{updating:e})})),a.Vh),Je}async executeQuery(e,t){return{result:await this._queryEngine.executeQuery(this._ensureQuery(e),t)}}async executeQueryForIds(e,t){const r=await this._queryEngine.executeQueryForIdSet(this._ensureQuery(e),t);return{result:Array.from(r)}}async executeQueryForCount(e,t){return{result:await this._queryEngine.executeQueryForCount(this._ensureQuery(e),t)}}async executeQueryForExtent(e,t){return{result:await this._queryEngine.executeQueryForExtent(this._ensureQuery(e),t)}}async executeQueryForLatestObservations(e,t){return{result:await this._queryEngine.executeQueryForLatestObservations(this._ensureQuery(e),t)}}async onTileTreeChange(e){return await this._tileManager.onTileTreeChange(e),Je}async _addTile(e,t){const r=await this._fetcher.fetch(e,t);(0,s.Te)(t),this._featureStore.addTile(r);const n=this._renderCommandContext.createEncoder();return await this._symbolizer.add(r,n),await n.dispatch(),r}async _removeTiles(e){const t=this._renderCommandContext.createEncoder(),r=this._featureStore,n=this._symbolizer;for(const i of e)r.removeTile(i.tileId),await n.remove(i.tileId,t);await t.dispatch()}_ensureQuery(e){return e??this._defaultQueryJSON}};(0,n._)([(0,o.MZ)()],$e.prototype,"updating",null),$e=(0,n._)([(0,c.$)("esri.views.3d.layers.graphics.pipeline.Feature3DPipelineWorker")],$e);const Xe=$e,Je={result:void 0}},3107:function(e,t,r){r.d(t,{Ir:function(){return c},QE:function(){return l},RH:function(){return u},Zd:function(){return o},cN:function(){return a},xU:function(){return d}});var n=r(13786),i=r(1932),s=r(36029);const a=Object.freeze({left:0,center:.5,right:1}),o=Object.freeze({"bottom-left":(0,i.fA)(0,0),bottom:(0,i.fA)(.5,0),"bottom-right":(0,i.fA)(1,0),left:(0,i.fA)(0,.5),center:(0,i.fA)(.5,.5),right:(0,i.fA)(1,.5),"top-left":(0,i.fA)(0,1),top:(0,i.fA)(.5,1),"top-right":(0,i.fA)(1,1)});function l(e){switch(e){case"left":return s.lV.Left;case"right":return s.lV.Right;default:return s.lV.Center}}function c(e,t){switch(t){case"bottom":return"left"===e?"bottom-left":"right"===e?"bottom-right":"bottom";case"center":return e;case"top":return"left"===e?"top-left":"right"===e?"top-right":"top"}}function u(e){return"middle"===e?"center":e}function d(e,t){switch(e){case"top":return(0,n.hZ)(t,0,s.Xd);case"bottom":return(0,n.hZ)(t,0,-s.Xd);default:return(0,n.C)(t,i.uY)}}},24129:function(e,t,r){r.d(t,{Gd:function(){return D},J_:function(){return L},VC:function(){return U},b3:function(){return B},s_:function(){return N},ul:function(){return G},wI:function(){return M}}),r(58941);var n,i,s,a=r(15774),o=r(44705),l=r(87725),c=r(73364),u=r(39714),d=r(20551),h=r(32501),f=r(85031),p=r(70974),m=r(39506);(s=n||(n={}))[s.Undefined=0]="Undefined",s[s.DefinedSize=1]="DefinedSize",s[s.DefinedScale=2]="DefinedScale",function(e){e[e.Undefined=0]="Undefined",e[e.DefinedAngle=1]="DefinedAngle"}(i||(i={}));class g{constructor(e){this.field=e}}class _ extends g{constructor(e){super(e),this.minSize=[0,0,0],this.maxSize=[0,0,0],this.offset=[0,0,0],this.factor=[0,0,0],this.type=[n.Undefined,n.Undefined,n.Undefined]}}class y extends g{constructor(e){super(e),this.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.values=[0,0,0,0,0,0,0,0]}}class v extends g{constructor(e){super(e),this.values=[0,0,0,0,0,0,0,0],this.opacityValues=[0,0,0,0,0,0,0,0]}}class T{}function b(e){return null!=e}function S(e){return"number"==typeof e}function A(e){return"string"==typeof e}function E(e,t){e&&e.push(t)}function w(e,t,r,i,s){const a=e.minSize,o=e.maxSize;if(e.useSymbolValue){const e=i.symbolSize[r];return t.minSize[r]=e,t.maxSize[r]=e,t.offset[r]=t.minSize[r],t.factor[r]=0,t.type[r]=n.DefinedSize,!0}if(b(e.field))return b(e.stops)?2===e.stops.length&&S(e.stops[0].size)&&S(e.stops[1].size)?(I(e.stops[0].size,e.stops[1].size,e.stops[0].value,e.stops[1].value,t,r),t.type[r]=n.DefinedSize,!0):(E(s,"Could not convert size info: stops only supported with 2 elements"),!1):S(a)&&S(o)&&b(e.minDataValue)&&b(e.maxDataValue)?(I(a,o,e.minDataValue,e.maxDataValue,t,r),t.type[r]=n.DefinedSize,!0):"unknown"===e.valueUnit?(E(s,"Could not convert size info: proportional size not supported"),!1):null!=f.j[e.valueUnit]?(t.minSize[r]=-1/0,t.maxSize[r]=1/0,t.offset[r]=0,t.factor[r]=1/f.j[e.valueUnit],t.type[r]=n.DefinedSize,!0):(E(s,"Could not convert size info: scale-dependent size not supported"),!1);if(!b(e.field)){if(e.stops?.[0]&&S(e.stops[0].size))return t.minSize[r]=e.stops[0].size,t.maxSize[r]=e.stops[0].size,t.offset[r]=t.minSize[r],t.factor[r]=0,t.type[r]=n.DefinedSize,!0;if(S(a))return t.minSize[r]=a,t.maxSize[r]=a,t.offset[r]=a,t.factor[r]=0,t.type[r]=n.DefinedSize,!0}return E(s,"Could not convert size info: unsupported variant of sizeInfo"),!1}function I(e,t,r,n,i,s){const a=Math.abs(n-r)>0?(t-e)/(n-r):0;i.minSize[s]=a>0?e:t,i.maxSize[s]=a>0?t:e,i.offset[s]=e-r*a,i.factor[s]=a}function x(e,t,r){e[4*t]=r.r/255,e[4*t+1]=r.g/255,e[4*t+2]=r.b/255,e[4*t+3]=r.a}function R(e,t,r){const n=2===r&&"arithmetic"===e.rotationType;t.offset[r]=n?90:0,t.factor[r]=n?-1:1,t.type[r]=1}class M{constructor(e,t=[1,1,1],r=[1,1,1],n=1,i=[0,0,0],s=[1,1,1],a=[0,0,0]){this.supports=e,this.modelSize=t,this.symbolSize=r,this.unitInMeters=n,this.anchor=i,this.scale=s,this.rotation=a}}function O(e,t,r){if(!e)return null;const i=e.reduce(((e,n)=>{if(!e)return e;if(n.valueExpression)return E(r,"Could not convert visual variables: arcade expressions not supported"),null;switch(n.type){case"size":return t.supports.size?function(e,t,r,n){if(e.normalizationField||e.valueRepresentation)return E(n,"Could not convert size info: unsupported property"),null;if(!function(e){return null==e||A(e)}(e.field))return E(n,"Could not convert size info: field is not a string"),null;if(t.size){if(e.field)if(t.size.field){if(e.field!==t.size.field)return E(n,"Could not convert size info: multiple fields in use"),null}else t.size.field=e.field}else t.size=new _(e.field);let i;switch(e.axis){case"width":return i=w(e,t.size,0,r,n),i?t:null;case"height":return i=w(e,t.size,2,r,n),i?t:null;case"depth":return i=w(e,t.size,1,r,n),i?t:null;case"width-and-depth":return i=w(e,t.size,0,r,n),i&&w(e,t.size,1,r,n),i?t:null;case null:case void 0:case"all":return i=w(e,t.size,0,r,n),i=i&&w(e,t.size,1,r,n),i=i&&w(e,t.size,2,r,n),i?t:null;default:return E(n,`Could not convert size info: unknown axis "${e.axis}""`),null}}(n,e,t,r):e;case"color":return t.supports.color?function(e,t,r){if(e.normalizationField)return E(r,"Could not convert color info: unsupported property"),null;if(A(e.field)){if(!e.stops)return E(r,"Could not convert color info: missing stops or colors"),null;{if(e.stops.length>8)return E(r,"Could not convert color info: too many color stops"),null;t.color=new y(e.field);const n=e.stops;for(let e=0;e<8;++e){const r=n[Math.min(e,n.length-1)];t.color.values[e]=r.value,x(t.color.colors,e,r.color)}}}else{if(!(e.stops&&e.stops.length>=0))return E(r,"Could not convert color info: no field and no colors/stops"),null;{const r=e.stops&&e.stops.length>=0&&e.stops[0].color;t.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let e=0;e<8;e++)t.color.values[e]=1/0,x(t.color.colors,e,r)}}return t}(n,e,r):e;case"opacity":return t.supports.opacity?function(e,t,r){if(e.normalizationField)return E(r,"Could not convert opacity info: unsupported property"),null;if(A(e.field)){if(!e.stops)return E(r,"Could not convert opacity info: missing stops or opacities"),null;{if(e.stops.length>8)return E(r,"Could not convert opacity info: too many opacity stops"),null;t.opacity=new v(e.field);const n=e.stops;for(let e=0;e<8;++e){const r=n[Math.min(e,n.length-1)];t.opacity.values[e]=r.value,t.opacity.opacityValues[e]=r.opacity}}}else{if(!(e.stops&&e.stops.length>=0))return E(r,"Could not convert opacity info: no field and no opacities/stops"),null;{const r=e.stops&&e.stops.length>=0?e.stops[0].opacity:0;t.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let e=0;e<8;e++)t.opacity.values[e]=1/0,t.opacity.opacityValues[e]=r}}return t}(n,e,r):null;case"rotation":return t.supports.rotation?function(e,t,r){if(!A(e.field))return E(r,"Could not convert rotation info: field is not a string"),null;if(t.rotation){if(e.field)if(t.rotation.field){if(e.field!==t.rotation.field)return E(r,"Could not convert rotation info: multiple fields in use"),null}else t.rotation.field=e.field}else t.rotation={field:e.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(e.axis){case"tilt":return R(e,t.rotation,0),t;case"roll":return R(e,t.rotation,1),t;case null:case void 0:case"heading":return R(e,t.rotation,2),t;default:return E(r,`Could not convert rotation info: unknown axis "${e.axis}""`),null}}(n,e,r):e;default:return null}}),new T);return!(e.length>0&&i)||i.size||i.color||i.opacity||i.rotation?i?.size&&!function(e,t,r){for(let r=0;r<3;++r){let i=t.unitInMeters;e.type[r]===n.DefinedSize&&(i*=t.modelSize[r],e.type[r]=n.DefinedScale),e.minSize[r]=e.minSize[r]/i,e.maxSize[r]=e.maxSize[r]/i,e.offset[r]=e.offset[r]/i,e.factor[r]=e.factor[r]/i}let i;if(e.type[0]!==n.Undefined)i=0;else if(e.type[1]!==n.Undefined)i=1;else{if(e.type[2]===n.Undefined)return E(r,"No size axis contains a valid size or scale"),!1;i=2}for(let t=0;t<3;++t)e.type[t]===n.Undefined&&(e.minSize[t]=e.minSize[i],e.maxSize[t]=e.maxSize[i],e.offset[t]=e.offset[i],e.factor[t]=e.factor[i],e.type[t]=e.type[i]);return!0}(i.size,t,r)?null:i:null}class C{constructor(e,t,r){this.visualVariables=e,this.materialParameters=t,this.requiresShaderTransformation=r}}function N(e,t){if(!e)return null;if(p.b.TESTS_DISABLE_FAST_UPDATES)return null;const r=O(e.visualVariables,t);return r?new C(r,P(r,t),!!r.size):null}function L(e,t,r){if(!t||!e)return!1;const n=e.visualVariables,i=O(t.visualVariables,r);return!!i&&!!(F(n.size,i.size,"size")&&F(n.color,i.color,"color")&&F(n.rotation,i.rotation,"rotation")&&F(n.opacity,i.opacity,"opacity"))&&(e.visualVariables=i,e.materialParameters=P(i,r),e.requiresShaderTransformation=!!i.size,!0)}function F(e,t,r){if(!!e!=!!t)return!1;if(e&&e.field!==t?.field)return!1;if(e&&"rotation"===r){const r=e,n=t;for(let e=0;e<3;e++)if(r.type[e]!==n.type[e]||r.offset[e]!==n.offset[e]||r.factor[e]!==n.factor[e])return!1}return!0}class D extends m.Y{constructor(e){super(),this.vvSize=e?.size??null,this.vvColor=e?.color??null,this.vvOpacity=e?.opacity??null}}function P(e,t){const r=new D(e);return r.vvSize&&(r.vvSymbolAnchor=t.anchor,(0,c.D_)(V),function(e,t,r,n=(0,u.vt)()){const i=e||0,s=t||0,a=r||0;0!==i&&(0,c.Qr)(n,n,-i/180*Math.PI),0!==s&&(0,c.eL)(n,n,s/180*Math.PI),0!==a&&(0,c.Z8)(n,n,a/180*Math.PI)}(t.rotation[2],t.rotation[0],t.rotation[1],V),r.vvSymbolRotationMatrix=r.vvSymbolRotationMatrix||(0,l.vt)(),(0,o.z0)(r.vvSymbolRotationMatrix,V)),r}function B(e,t,r){if(!e.vvSize)return r;(0,c.C)(z,r);const n=e.vvSymbolRotationMatrix;(0,c.hZ)(V,n[0],n[1],n[2],0,n[3],n[4],n[5],0,n[6],n[7],n[8],0,0,0,0,1),(0,c.lw)(z,z,V);for(let r=0;r<3;++r){const n=e.vvSize.offset[r]+t[0]*e.vvSize.factor[r];H[r]=(0,a.qE)(n,e.vvSize.minSize[r],e.vvSize.maxSize[r])}return(0,c.hs)(z,z,H),(0,c.Tl)(z,z,e.vvSymbolAnchor),z}function U(e,t,r){if(!t.vvSize)return(0,d.i)(e,1,1,1),e;for(let n=0;n<3;++n){const i=t.vvSize.offset[n]+r[0]*t.vvSize.factor[n];e[n]=(0,a.qE)(i,t.vvSize.minSize[n],t.vvSize.maxSize[n])}return e}function G(e,t){const r=null==e?0:t.attributes[e];return"number"==typeof r&&isFinite(r)?r:0}const z=(0,u.vt)(),H=(0,h.vt)(),V=(0,u.vt)()},9933:function(e,t,r){r.d(t,{Eb:function(){return a},_j:function(){return o},k5:function(){return n}});var n,i,s=r(15774);function a(e){switch(e){case"multiply":default:return n.Multiply;case"ignore":return n.Ignore;case"replace":return n.Replace;case"tint":return n.Tint}}function o(e,t,r){if(null==e||t===n.Ignore)return r[0]=255,r[1]=255,r[2]=255,void(r[3]=255);const i=(0,s.qE)(Math.round(e[3]*c),0,c),a=0===i||t===n.Tint?0:t===n.Replace?u:d;r[0]=(0,s.qE)(Math.round(e[0]*l),0,l),r[1]=(0,s.qE)(Math.round(e[1]*l),0,l),r[2]=(0,s.qE)(Math.round(e[2]*l),0,l),r[3]=i+a}(i=n||(n={}))[i.Multiply=1]="Multiply",i[i.Ignore=2]="Ignore",i[i.Replace=3]="Replace",i[i.Tint=4]="Tint";const l=255,c=85,u=c,d=2*c},12378:function(e,t,r){r.d(t,{d:function(){return x}});var n=r(15774),i=r(62938),s=r(73364),a=r(20551),o=r(61714),l=r(96611),c=r(56763),u=r(56919),d=r(68734),h=r(87416),f=r(72485),p=r(32501),m=(r(57165),r(2075)),g=r(13794);function _(e,t,r=function(e){return{operations:e,value:e.create()}}(e)){return r.operations=e,e.copy(t,r.value),r}const y=2**50;function v(e,t,r,n){return e.operations.setAltitudeAt(e.value,t,r,n)}function T(e,t,r){return e.operations.elevate(e.value,t,r.value)}const b=(0,p.vt)();(0,p.vt)();var S=r(5596),A=r(29531),E=r(50973),w=r(5915),I=r(65420);class x{constructor(e,t,r,n){this.viewingMode=e,this.spatialReference=t,this.unitInMeters=r,this._coordinateSystem=n,this._tmpCoordinateSystem=function(e){const{value:t,operations:r}=e;return{operations:r,value:r.create(t)}}(n),this.referenceEllipsoid=(0,o.tO)(t),this.sphericalPCPF=(0,l.lO)(t)}set extent(e){e&&function(e,t,r){e.operations.setExtent(e.value,t,r.value)}(this._coordinateSystem,e,this._coordinateSystem)}get extent(){return e=this._coordinateSystem,t=(0,h.vt)(),e.operations.getExtent(e.value,t),t;var e,t}getAltitude(e){return function(e,t){return e.operations.altitudeAt(e.value,t)}(this._coordinateSystem,e)}setAltitude(e,t,r=e){return v(this._coordinateSystem,r,t,e)}setAltitudeOfTransformation(e,t){var r,n,i,o;r=this._coordinateSystem,i=e,(n=t)!==(o=t)&&(0,s.C)(o,n),(0,a.i)(b,o[12],o[13],o[14]),v(r,b,i,b),o[12]=b[0],o[13]=b[1],o[14]=b[2]}worldUpAtPosition(e,t){return function(e,t,r){return e.operations.axisAt(e.value,t,f._.Z,r)}(this._coordinateSystem,e,t)}worldBasisAtPosition(e,t,r){return function(e,t,r,n){return e.operations.axisAt(e.value,t,r,n)}(this._coordinateSystem,e,t,r)}basisMatrixAtPosition(e,t){const r=this.worldBasisAtPosition(e,f._.X,E.rq.get()),n=this.worldBasisAtPosition(e,f._.Y,E.rq.get()),i=this.worldBasisAtPosition(e,f._.Z,E.rq.get());return(0,s.hZ)(t,r[0],r[1],r[2],0,n[0],n[1],n[2],0,i[0],i[1],i[2],0,0,0,0,1),t}headingAtPosition(e,t){const r=this.worldUpAtPosition(e,E.rq.get()),i=this.worldBasisAtPosition(e,f._.Y,E.rq.get()),s=(0,A.EJ)(t,i,r);return(0,n.KJ)(s)}intersectManifoldClosestSilhouette(e,t,r){return T(this._coordinateSystem,t,this._tmpCoordinateSystem),function(e,t,r){e.operations.intersectRayClosestSilhouette(e.value,t,r)}(this._tmpCoordinateSystem,e,r),r}intersectManifold(e,t,r){T(this._coordinateSystem,t,this._tmpCoordinateSystem);const n=E.rq.get();return function(e,t,r){return e.operations.intersectRay(e.value,t,r)}(this._tmpCoordinateSystem,e,n)?(0,a.c)(r,n):null}intersectInfiniteManifold(e,t,r){if(this.viewingMode===I.RT.Global)return this.intersectManifold(e,t,r);T(this._coordinateSystem,t,this._tmpCoordinateSystem);const n=this._tmpCoordinateSystem.value,i=E.rq.get();return(0,S.Ui)(n.plane,e,i)?(0,a.c)(r,i):null}toRenderCoords(e,t,r){return(0,w.v)(e)?(0,c.g)(e,t,this.spatialReference):(0,d.F)(e,t,r,this.spatialReference)}fromRenderCoords(e,t,r=null){return(0,w.v)(t)?(null!=r&&(t.spatialReference=r),(0,u.E)(e,this.spatialReference,t)?t:null):(0,d.F)(e,this.spatialReference,t,r)?t:null}static create(e,t){switch(e){case I.RT.Local:return new x(I.RT.Local,t,(0,i.GA)(t),_(m.b,(0,m.f)([0,0,0],[y,0,0],[0,y,0])));case I.RT.Global:return new x(I.RT.Global,t,1,function(e){return _(g.s,(0,g.f)(0,0,0,(0,o.tO)(e).radius))}(t))}}static renderUnitScaleFactor(e,t){return(0,i.KX)(e)/(0,i.KX)(t)}}},65856:function(e,t,r){r.d(t,{BP:function(){return l},l5:function(){return c},q3:function(){return o}});var n=r(92754),i=r(28404),s=r(90553);class a{constructor(e,t){this.layout=e,this.buffer="number"==typeof t?new ArrayBuffer(t*e.stride):t;for(const t of e.fields.keys()){const r=e.fields.get(t);this[t]=new r.constructor(this.buffer,r.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(e,t){const r=this[e];return r&&r.elementCount===t.ElementCount&&r.elementType===t.ElementType?r:null}slice(e,t){return new a(this.layout,this.buffer.slice(e*this.stride,t*this.stride))}copyFrom(e,t=0,r=0,n=e.count){const i=this.stride;if(i%4==0){const s=new Uint32Array(e.buffer,t*i,n*i/4);new Uint32Array(this.buffer,r*i,n*i/4).set(s)}else{const s=new Uint8Array(e.buffer,t*i,n*i);new Uint8Array(this.buffer,r*i,n*i).set(s)}return this}get usedMemory(){return this.byteLength}dispose(){}}class o{constructor(e){this._stride=0,this._lastAligned=0,this._fields=new Map,e&&(this._stride=e.stride,e.fields.forEach((e=>this._fields.set(e[0],{...e[1],constructor:h(e[1].constructor)}))))}freeze(){return this}vec2f(e,t){return this._appendField(e,n.gH,t),this}vec2f64(e,t){return this._appendField(e,n.si,t),this}vec3f(e,t){return this._appendField(e,n.xs,t),this}vec3f64(e,t){return this._appendField(e,n.Xm,t),this}vec4f(e,t){return this._appendField(e,n.Eq,t),this}vec4f64(e,t){return this._appendField(e,n.Aj,t),this}mat3f(e,t){return this._appendField(e,n.jZ,t),this}mat3f64(e,t){return this._appendField(e,n.j0,t),this}mat4f(e,t){return this._appendField(e,n.Sx,t),this}mat4f64(e,t){return this._appendField(e,n.E$,t),this}vec4u8(e,t){return this._appendField(e,n.XP,t),this}f32(e,t){return this._appendField(e,n.Y$,t),this}f64(e,t){return this._appendField(e,n.qB,t),this}u8(e,t){return this._appendField(e,n.SL,t),this}u16(e,t){return this._appendField(e,n.h,t),this}i8(e,t){return this._appendField(e,n.bf,t),this}vec2i8(e,t){return this._appendField(e,n.D6,t),this}vec2i16(e,t){return this._appendField(e,n.mJ,t),this}vec2u8(e,t){return this._appendField(e,n.LC,t),this}vec4u16(e,t){return this._appendField(e,n.Uz,t),this}u32(e,t){return this._appendField(e,n.P,t),this}_appendField(e,t,r){if(this._fields.has(e))return void(0,s.vA)(!1,`${e} already added to vertex buffer layout`);const n=t.ElementCount*(0,i.GJ)(t.ElementType),a=this._stride;this._stride+=n,this._fields.set(e,{size:n,constructor:t,offset:a,optional:r})}createBuffer(e){return new a(this,e)}createView(e){return new a(this,e)}clone(){const e=new o;return e._stride=this._stride,e._fields=new Map,this._fields.forEach(((t,r)=>e._fields.set(r,t))),e.BufferType=this.BufferType,e}get stride(){if(this._lastAligned!==this._fields.size){let e=1;this._fields.forEach((t=>e=Math.max(e,(0,i.GJ)(t.constructor.ElementType)))),this._stride=Math.floor((this._stride+e-1)/e)*e,this._lastAligned=this._fields.size}return this._stride}get fields(){return this._fields}}function l(){return new o}class c{constructor(e){this.fields=new Array,e.fields.forEach(((e,t)=>{const r={...e,constructor:d(e.constructor)};this.fields.push([t,r])})),this.stride=e.stride}}const u=[n.Y$,n.gH,n.xs,n.Eq,n.jZ,n.Sx,n.qB,n.si,n.Xm,n.Aj,n.j0,n.E$,n.SL,n.LC,n.eI,n.XP,n.h,n.Yi,n.nS,n.Uz,n.P,n.An,n.H$,n.ml,n.bf,n.D6,n.m8,n.TX,n.Qt,n.mJ,n.Vp,n.E7,n.My,n.UL,n.zD,n.Y4];function d(e){return`${e.ElementType}_${e.ElementCount}`}function h(e){return f.get(e)}const f=new Map;u.forEach((e=>f.set(d(e),e)))},69550:function(e,t,r){r.d(t,{U:function(){return s}});var n=r(85456),i=r(3817);function s(e,t=0){const r=e.stride;return Array.from(e.fields.keys()).map((n=>{const s=e.fields.get(n),o=s.constructor.ElementCount,l=a(s.constructor.ElementType),c=s.offset,u=s.optional?.glNormalized??!1;return new i._(n,o,l,c,r,u,t)}))}function a(e){const t=o[e];if(t)return t;throw new Error("BufferType not supported in WebGL")}const o={u8:n.pe.UNSIGNED_BYTE,u16:n.pe.UNSIGNED_SHORT,u32:n.pe.UNSIGNED_INT,i8:n.pe.BYTE,i16:n.pe.SHORT,i32:n.pe.INT,f32:n.pe.FLOAT}},70974:function(e,t,r){r.d(t,{b:function(){return l}});var n=r(53804),i=r(83525),s=r(23502),a=(r(58941),r(40633),r(13798),r(65953));let o=class extends i.A{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};(0,n._)([(0,s.MZ)()],o.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),(0,n._)([(0,s.MZ)()],o.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),(0,n._)([(0,s.MZ)()],o.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),(0,n._)([(0,s.MZ)()],o.prototype,"DECONFLICTOR_SHOW_GRID",void 0),(0,n._)([(0,s.MZ)()],o.prototype,"LABELS_SHOW_BORDER",void 0),(0,n._)([(0,s.MZ)()],o.prototype,"TEXT_SHOW_BASELINE",void 0),(0,n._)([(0,s.MZ)()],o.prototype,"TEXT_SHOW_BORDER",void 0),(0,n._)([(0,s.MZ)()],o.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),(0,n._)([(0,s.MZ)()],o.prototype,"OVERLAY_SHOW_CENTER",void 0),(0,n._)([(0,s.MZ)()],o.prototype,"SHOW_POI",void 0),(0,n._)([(0,s.MZ)()],o.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),(0,n._)([(0,s.MZ)()],o.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),(0,n._)([(0,s.MZ)()],o.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),(0,n._)([(0,s.MZ)()],o.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),(0,n._)([(0,s.MZ)()],o.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),(0,n._)([(0,s.MZ)()],o.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),(0,n._)([(0,s.MZ)()],o.prototype,"I3S_TREE_SHOW_TILES",void 0),(0,n._)([(0,s.MZ)()],o.prototype,"I3S_SHOW_MODIFICATIONS",void 0),(0,n._)([(0,s.MZ)()],o.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),(0,n._)([(0,s.MZ)()],o.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),(0,n._)([(0,s.MZ)()],o.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),(0,n._)([(0,s.MZ)()],o.prototype,"LINE_WIREFRAMES",void 0),o=(0,n._)([(0,a.$)("esri.views.3d.support.debugFlags")],o);const l=new o},98323:function(e,t,r){r.d(t,{CN:function(){return o},Q_:function(){return a},ny:function(){return l},sZ:function(){return c}}),r(58941);var n=r(5161),i=r(59552),s=r(85456);const a=128,o=.5;function l(e){return"cross"===e||"x"===e}function c(e,t=a,r=t*o,n=0){const l=function(e,t=a,r=t*o,n=0){switch(e){case"circle":default:return function(e,t){const r=e/2-.5;return p(e,h(r,r,t/2))}(t,r);case"square":return function(e,t){return u(e,t,!1)}(t,r);case"cross":return function(e,t,r=0){return d(e,t,!1,r)}(t,r,n);case"x":return function(e,t,r=0){return d(e,t,!0,r)}(t,r,n);case"kite":return function(e,t){return u(e,t,!0)}(t,r);case"triangle":return function(e,t){return p(e,f(e/2,t,t/2))}(t,r);case"arrow":return function(e,t){const r=t,n=t/2,i=e/2,s=.8*r,a=h(i,(e-t)/2-s,Math.sqrt(s*s+n*n)),o=f(i,r,n);return p(e,((e,t)=>Math.max(o(e,t),-a(e,t))))}(t,r)}}(e,t,r,n);return new i.g(l,{mipmap:!1,wrap:{s:s.pF.CLAMP_TO_EDGE,t:s.pF.CLAMP_TO_EDGE},width:t,height:t,components:4,noUnpackFlip:!0,reloadable:!0})}function u(e,t,r){return r&&(t/=Math.SQRT2),p(e,((n,i)=>{let s=n-.5*e+.25,a=.5*e-i-.75;if(r){const e=(s+a)/Math.SQRT2;a=(a-s)/Math.SQRT2,s=e}return Math.max(Math.abs(s),Math.abs(a))-.5*t}))}function d(e,t,r,n=0){t-=n,r&&(t*=Math.SQRT2);const i=.5*t;return p(e,((t,s)=>{let a,o=t-.5*e,l=.5*e-s-1;if(r){const e=(o+l)/Math.SQRT2;l=(l-o)/Math.SQRT2,o=e}return o=Math.abs(o),l=Math.abs(l),a=o>l?o>i?Math.sqrt((o-i)*(o-i)+l*l):l:l>i?Math.sqrt(o*o+(l-i)*(l-i)):o,a-=n/2,a}))}function h(e,t,r){return(n,i)=>{const s=n-e,a=i-t;return Math.sqrt(s*s+a*a)-r}}function f(e,t,r){const n=Math.sqrt(t*t+r*r);return(i,s)=>{const a=Math.abs(i-e)-r,o=s-e+t/2+.75,l=(t*a+r*o)/n,c=-o;return Math.max(l,c)}}function p(e,t){const r=new Uint8Array(4*e*e);for(let i=0;i<e;i++)for(let s=0;s<e;s++){const a=s+e*i;let o=t(s,i);o=o/e+.5,(0,n.U)(o,r,4*a)}return r}},76185:function(e,t,r){r.d(t,{VV:function(){return o},hG:function(){return s},wp:function(){return a}}),r(15774);var n=r(20551),i=r(32501);function s(e){const t=e[0]*e[0]+e[4]*e[4]+e[8]*e[8],r=e[1]*e[1]+e[5]*e[5]+e[9]*e[9],n=e[2]*e[2]+e[6]*e[6]+e[10]*e[10];return Math.sqrt(Math.max(t,r,n))}function a(e,t){const r=Math.sqrt(t[0]*t[0]+t[4]*t[4]+t[8]*t[8]),i=Math.sqrt(t[1]*t[1]+t[5]*t[5]+t[9]*t[9]),s=Math.sqrt(t[2]*t[2]+t[6]*t[6]+t[10]*t[10]);return(0,n.i)(e,r,i,s),e}function o(e,t,r){Math.abs(e[0])>Math.abs(e[1])?(0,n.i)(t,0,1,0):(0,n.i)(t,1,0,0),(0,n.e)(r,e,t),(0,n.e)(t,r,e),(0,n.n)(r,r),(0,n.n)(t,t)}(0,i.vt)(),(0,i.vt)(),(0,i.vt)(),(0,i.vt)(),(0,i.vt)()},89765:function(e,t,r){r.d(t,{ab:function(){return Te},gm:function(){return Oe}});var n=r(44705),i=r(87725),s=r(39714),a=r(32237),o=r(61769),l=r(20551),c=r(32501),u=r(33400),d=r(41546),h=r(61714),f=r(96611),p=r(7456),m=r(57617),g=r(61441),_=r(5596),y=r(57652),v=r(50973),T=r(65420),b=r(1932),S=r(14905);const A=1e-6,E=(0,c.vt)(),w=(0,c.vt)();function I(e,t,r,n,i,s,a,o,l,c){return function(e,t,r){let n=ye(e.maxVert[0],e.minVert[0]),i=0;for(let t=1;t<7;++t){const r=ye(e.maxVert[t],e.minVert[t]);r>n&&(n=r,i=t)}pe(t,e.minVert[i]),pe(r,e.maxVert[i])}(e,n,i),ye(n,i)<A?1:(he(a,n,i),ge(a,a),function(e,t,r,n){const{data:i,size:s}=e;let a=Number.NEGATIVE_INFINITY,o=0;for(let e=0;e<i.length;e+=s){P[0]=i[e]-t[0],P[1]=i[e+1]-t[1],P[2]=i[e+2]-t[2];const n=r[0]*P[0]+r[1]*P[1]+r[2]*P[2],s=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],l=P[0]*P[0]+P[1]*P[1]+P[2]*P[2]-n*n/s;l>a&&(a=l,o=e)}return pe(n,i,o),a}(t,n,a,s)<A?2:(he(o,i,s),ge(o,o),he(l,s,n),ge(l,l),me(r,o,a),ge(r,r),j(t,r,a,o,l,c),0))}const x=(0,c.vt)(),R=(0,c.vt)(),M=(0,c.vt)(),O=(0,c.vt)(),C=(0,c.vt)(),N=(0,c.vt)(),L=(0,c.vt)(),F=(0,c.vt)();function D(e,t,r,n,i,s,a,o,l){(function(e,t,r,n,i){!function(e,t,r,n,i){const{data:s,size:a}=e;pe(n,s),pe(i,n),r[0]=ve(Z,t),r[1]=r[0];for(let e=a;e<s.length;e+=a){const a=s[e]*t[0]+s[e+1]*t[1]+s[e+2]*t[2];a<r[0]&&(r[0]=a,pe(n,s,e)),a>r[1]&&(r[1]=a,pe(i,s,e))}}(e,t,B,i,n);const s=ve(r,t);B[1]-A<=s&&(n[0]=void 0),B[0]+A>=s&&(i[0]=void 0)})(e,t,r,x,R),void 0!==x[0]&&(he(M,x,r),ge(M,M),he(O,x,n),ge(O,O),he(C,x,i),ge(C,C),me(N,O,s),ge(N,N),me(L,C,a),ge(L,L),me(F,M,o),ge(F,F),j(e,N,s,O,M,l),j(e,L,a,C,O,l),j(e,F,o,M,C,l)),void 0!==R[0]&&(he(M,R,r),ge(M,M),he(O,R,n),ge(O,O),he(C,R,i),ge(C,C),me(N,O,s),ge(N,N),me(L,C,a),ge(L,L),me(F,M,o),ge(F,F),j(e,N,s,O,M,l),j(e,L,a,C,O,l),j(e,F,o,M,C,l))}const P=[0,0,0],B=(0,b.vt)(),U=(0,c.vt)(),G=(0,c.vt)(),z=(0,c.vt)(),H=(0,c.vt)(),V=(0,c.vt)(),k=(0,c.vt)();function j(e,t,r,n,i,s){if(_e(t)<A)return;me(U,r,t),me(G,n,t),me(z,i,t),q(e,t,B),V[1]=B[0],H[1]=B[1],k[1]=H[1]-V[1];const a=[r,n,i],o=[U,G,z];for(let r=0;r<3;++r){q(e,a[r],B),V[0]=B[0],H[0]=B[1],q(e,o[r],B),V[2]=B[0],H[2]=B[1],k[0]=H[0]-V[0],k[2]=H[2]-V[2];const n=ue(k);n<s.quality&&(pe(s.b0,a[r]),pe(s.b1,t),pe(s.b2,o[r]),s.quality=n)}}const Z=(0,c.vt)();function q(e,t,r){const{data:n,size:i}=e;r[0]=Number.POSITIVE_INFINITY,r[1]=Number.NEGATIVE_INFINITY;for(let e=0;e<n.length;e+=i){const i=n[e]*t[0]+n[e+1]*t[1]+n[e+2]*t[2];r[0]=Math.min(r[0],i),r[1]=Math.max(r[1],i)}}function W(e,t,r){r.center=e,r.halfSize=(0,l.h)(t,t,.5),r.quaternion=o.zK}const Y=(0,c.vt)(),$=(0,c.vt)(),X=(0,c.vt)(),J=(0,c.vt)(),Q=(0,c.vt)(),K=(0,c.vt)();function ee(e,t,r){pe(Y,t),Math.abs(t[0])>Math.abs(t[1])&&Math.abs(t[0])>Math.abs(t[2])?Y[0]=0:Math.abs(t[1])>Math.abs(t[2])?Y[1]=0:Y[2]=0,_e(Y)<A&&(Y[0]=Y[1]=Y[2]=1),me($,t,Y),ge($,$),me(X,t,$),ge(X,X),te(e,t,$,X,J,Q),he(K,Q,J),oe(t,$,X,J,Q,K,r)}function te(e,t,r,n,i,s){q(e,t,B),i[0]=B[0],s[0]=B[1],q(e,r,B),i[1]=B[0],s[1]=B[1],q(e,n,B),i[2]=B[0],s[2]=B[1]}const re=(0,c.vt)(),ne=(0,c.vt)(),ie=(0,c.vt)(),se=(0,i.fA)(1,0,0,0,1,0,0,0,1),ae=(0,o.vt)();function oe(e,t,r,n,i,s,a){se[0]=e[0],se[1]=e[1],se[2]=e[2],se[3]=t[0],se[4]=t[1],se[5]=t[2],se[6]=r[0],se[7]=r[1],se[8]=r[2],a.quaternion=function(e,t){const r=t[0]+t[4]+t[8];if(r>0){let n=Math.sqrt(r+1);e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n}else{let r=0;t[4]>t[0]&&(r=1),t[8]>t[3*r+r]&&(r=2);const n=(r+1)%3,i=(r+2)%3;let s=Math.sqrt(t[3*r+r]-t[3*n+n]-t[3*i+i]+1);e[r]=.5*s,s=.5/s,e[3]=(t[3*n+i]-t[3*i+n])*s,e[n]=(t[3*n+r]+t[3*r+n])*s,e[i]=(t[3*i+r]+t[3*r+i])*s}return e}(ae,se),de(re,n,i),fe(re,re,.5),fe(ne,e,re[0]),fe(ie,t,re[1]),de(ne,ne,ie),fe(ie,r,re[2]),a.center=(0,l.g)(ne,ne,ie),a.halfSize=(0,l.h)(re,s,.5)}class le{constructor(e){this.minVert=new Array(7),this.maxVert=new Array(7),this.buffer=new ArrayBuffer(448);let t=0;this.minProj=new Float64Array(this.buffer,t,7),t+=56,this.maxProj=new Float64Array(this.buffer,t,7),t+=56;for(let e=0;e<7;++e)this.minVert[e]=new Float64Array(this.buffer,t,3),t+=24;for(let e=0;e<7;++e)this.maxVert[e]=new Float64Array(this.buffer,t,3),t+=24;for(let e=0;e<7;++e)this.minProj[e]=Number.POSITIVE_INFINITY,this.maxProj[e]=Number.NEGATIVE_INFINITY;const r=new Array(7),n=new Array(7),{data:i,size:s}=e;for(let e=0;e<i.length;e+=s){let t=i[e];t<this.minProj[0]&&(this.minProj[0]=t,r[0]=e),t>this.maxProj[0]&&(this.maxProj[0]=t,n[0]=e),t=i[e+1],t<this.minProj[1]&&(this.minProj[1]=t,r[1]=e),t>this.maxProj[1]&&(this.maxProj[1]=t,n[1]=e),t=i[e+2],t<this.minProj[2]&&(this.minProj[2]=t,r[2]=e),t>this.maxProj[2]&&(this.maxProj[2]=t,n[2]=e),t=i[e]+i[e+1]+i[e+2],t<this.minProj[3]&&(this.minProj[3]=t,r[3]=e),t>this.maxProj[3]&&(this.maxProj[3]=t,n[3]=e),t=i[e]+i[e+1]-i[e+2],t<this.minProj[4]&&(this.minProj[4]=t,r[4]=e),t>this.maxProj[4]&&(this.maxProj[4]=t,n[4]=e),t=i[e]-i[e+1]+i[e+2],t<this.minProj[5]&&(this.minProj[5]=t,r[5]=e),t>this.maxProj[5]&&(this.maxProj[5]=t,n[5]=e),t=i[e]-i[e+1]-i[e+2],t<this.minProj[6]&&(this.minProj[6]=t,r[6]=e),t>this.maxProj[6]&&(this.maxProj[6]=t,n[6]=e)}for(let e=0;e<7;++e){let t=r[e];pe(this.minVert[e],i,t),t=n[e],pe(this.maxVert[e],i,t)}}}class ce{constructor(){this.b0=(0,c.fA)(1,0,0),this.b1=(0,c.fA)(0,1,0),this.b2=(0,c.fA)(0,0,1),this.quality=0}}function ue(e){return e[0]*e[1]+e[0]*e[2]+e[1]*e[2]}function de(e,t,r){e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2]}function he(e,t,r){e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2]}function fe(e,t,r){e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r}function pe(e,t,r=0){e[0]=t[r],e[1]=t[r+1],e[2]=t[r+2]}function me(e,t,r){const n=t[0],i=t[1],s=t[2],a=r[0],o=r[1],l=r[2];e[0]=i*l-s*o,e[1]=s*a-n*l,e[2]=n*o-i*a}function ge(e,t){const r=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(r>0){const n=1/Math.sqrt(r);e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n}}function _e(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]}function ye(e,t){const r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2];return r*r+n*n+i*i}function ve(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}class Te{constructor(e=c.uY,t=je,r=o.zK){this._data=[e[0],e[1],e[2],t[0],t[1],t[2],r[0],r[1],r[2],r[3]]}clone(){const e=new Te;return e._data=this._data.slice(),e}invalidate(){this._data[3]=-1}get isValid(){return this._data[3]>=0}static fromData(e){const t=new Te;return t._data=e.slice(),t}static fromJSON(e){return new Te(e.center,e.halfSize,e.quaternion)}copy(e){this._data=e.data.slice()}get center(){return(0,l.i)(v.rq.get(),this._data[0],this._data[1],this._data[2])}get centerX(){return this._data[0]}get centerY(){return this._data[1]}get centerZ(){return this._data[2]}getCenter(e){return e[0]=this._data[0],e[1]=this._data[1],e[2]=this._data[2],e}set center(e){this._data[0]=e[0],this._data[1]=e[1],this._data[2]=e[2]}setCenter(e,t,r){this._data[0]=e,this._data[1]=t,this._data[2]=r}get halfSize(){return(0,l.i)(v.rq.get(),this._data[3],this._data[4],this._data[5])}get halfSizeX(){return this._data[3]}get halfSizeY(){return this._data[4]}get halfSizeZ(){return this._data[5]}getHalfSize(e){return e[0]=this._data[3],e[1]=this._data[4],e[2]=this._data[5],e}set halfSize(e){this._data[3]=e[0],this._data[4]=e[1],this._data[5]=e[2]}get quaternion(){return(0,a.hZ)(v.J8.get(),this._data[6],this._data[7],this._data[8],this._data[9])}getQuaternion(e){return e[0]=this._data[6],e[1]=this._data[7],e[2]=this._data[8],e[3]=this._data[9],e}set quaternion(e){this._data[6]=e[0],this._data[7]=e[1],this._data[8]=e[2],this._data[9]=e[3]}get data(){return this._data}getCorners(e){const t=be,r=this._data;t[0]=r[6],t[1]=r[7],t[2]=r[8],t[3]=r[9];for(let n=0;n<8;++n){const i=e[n];i[0]=(1&n?-1:1)*r[3],i[1]=(2&n?-1:1)*r[4],i[2]=(4&n?-1:1)*r[5],(0,l.w)(i,i,t),i[0]+=r[0],i[1]+=r[1],i[2]+=r[2]}}doesIntersectFrustumConservativeApproximation(e){return this.intersectPlane(e[0])<=0&&this.intersectPlane(e[1])<=0&&this.intersectPlane(e[2])<=0&&this.intersectPlane(e[3])<=0&&this.intersectPlane(e[4])<=0&&this.intersectPlane(e[5])<=0}get radius(){const e=this._data[3],t=this._data[4],r=this._data[5];return Math.sqrt(e*e+t*t+r*r)}intersectSphere(e){Ee[0]=this._data[0]-e[0],Ee[1]=this._data[1]-e[1],Ee[2]=this._data[2]-e[2];const t=this.getQuaternion(Se);return(0,a.Xr)(be,t),(0,l.w)(Ee,Ee,be),(0,l.x)(Ee,Ee),we[0]=Math.min(Ee[0],this._data[3]),we[1]=Math.min(Ee[1],this._data[4]),we[2]=Math.min(Ee[2],this._data[5]),(0,l.y)(we,Ee)<e[3]*e[3]}intersectSphereWithMBS(e,t=this.radius){const r=this._data;Ee[0]=r[0]-e[0],Ee[1]=r[1]-e[1],Ee[2]=r[2]-e[2];const n=e[3],i=n+t;return!((0,l.z)(Ee)>i*i)&&(be[0]=-r[6],be[1]=-r[7],be[2]=-r[8],be[3]=r[9],(0,l.w)(Ee,Ee,be),(0,l.x)(Ee,Ee),we[0]=Math.min(Ee[0],r[3]),we[1]=Math.min(Ee[1],r[4]),we[2]=Math.min(Ee[2],r[5]),(0,l.y)(we,Ee)<n*n)}intersectPlane(e){const t=e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3],r=this.projectedRadius((0,_.Qj)(e));return t>r?1:t<-r?-1:0}intersectRay(e,t,r=0){const n=this._data,i=be;i[0]=-n[6],i[1]=-n[7],i[2]=-n[8],i[3]=n[9],Ee[0]=e[0]-n[0],Ee[1]=e[1]-n[1],Ee[2]=e[2]-n[2];const s=(0,l.w)(Ee,Ee,be),a=(0,l.w)(we,t,be);let o=-1/0,c=1/0;const u=this.getHalfSize(Be);for(let e=0;e<3;e++){const t=s[e],n=a[e],i=u[e]+r;if(Math.abs(n)>1e-6){const e=(i-t)/n,r=(-i-t)/n;o=Math.max(o,Math.min(e,r)),c=Math.min(c,Math.max(e,r))}else if(t>i||t<-i)return!1}return o<=c}projectedArea(e,t,r,i){const s=this.getQuaternion(Se);(0,a.Xr)(be,s),Ee[0]=e[0]-this._data[0],Ee[1]=e[1]-this._data[1],Ee[2]=e[2]-this._data[2],(0,l.w)(Ee,Ee,be);const o=this.getHalfSize(Be),c=Ee[0]<-o[0]?-1:Ee[0]>o[0]?1:0,d=Ee[1]<-o[1]?-1:Ee[1]>o[1]?1:0,h=Ee[2]<-o[2]?-1:Ee[2]>o[2]?1:0,f=Math.abs(c)+Math.abs(d)+Math.abs(h);if(0===f)return 1/0;const p=1===f?4:6,m=6*(c+3*d+9*h+13);(0,n.I0)(Ue,s),(0,n.hs)(Ue,Ue,o);const g=this.getCenter(De);for(let e=0;e<p;e++){const r=Me[m+e];(0,l.i)(Ee,((1&r)<<1)-1,(2&r)-1,((4&r)>>1)-1),(0,l.q)(Ee,Ee,Ue),(0,l.g)(Ie,g,Ee),Ie[3]=1,(0,u.t)(Ie,Ie,t);const n=1/Math.max(1e-6,Ie[3]);Re[2*e]=Ie[0]*n,Re[2*e+1]=Ie[1]*n}const _=2*p-2;let y=Re[0]*(Re[3]-Re[_+1])+Re[_]*(Re[1]-Re[_-1]);for(let e=2;e<_;e+=2)y+=Re[e]*(Re[e+3]-Re[e-1]);return Math.abs(y)*r*i*.125}projectedRadius(e){const t=this.getQuaternion(Se);return(0,a.Xr)(be,t),(0,l.w)(Ee,e,be),Math.abs(Ee[0]*this._data[3])+Math.abs(Ee[1]*this._data[4])+Math.abs(Ee[2]*this._data[5])}minimumDistancePlane(e){return e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3]-this.projectedRadius((0,_.Qj)(e))}maximumDistancePlane(e){return e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3]+this.projectedRadius((0,_.Qj)(e))}toAaBoundingBox(e){const t=this.getQuaternion(Se),r=(0,n.I0)(Ue,t),i=this._data[3]*Math.abs(r[0])+this._data[4]*Math.abs(r[3])+this._data[5]*Math.abs(r[6]),s=this._data[3]*Math.abs(r[1])+this._data[4]*Math.abs(r[4])+this._data[5]*Math.abs(r[7]),a=this._data[3]*Math.abs(r[2])+this._data[4]*Math.abs(r[5])+this._data[5]*Math.abs(r[8]);e[0]=this._data[0]-i,e[1]=this._data[1]-s,e[2]=this._data[2]-a,e[3]=this._data[0]+i,e[4]=this._data[1]+s,e[5]=this._data[2]+a}transform(e,t,r,n=0,i=(0,f.lO)(r),s=(0,f.lO)(t),o=(0,g.jd)(t,s)){if(r===i)t.isGeographic?function(e,t,r,n,i=(0,f.lO)(r)){const s=(0,h.tO)(r),o=1+Math.max(0,n)/(s.radius+e.centerZ);e.getCenter(Fe),Fe[2]+=n,(0,m.projectBuffer)(Fe,r,0,Fe,i,0),t.center=Fe;const c=e.getQuaternion(Se);t.quaternion=c,(0,a.Xr)(be,c),(0,l.i)(He,0,0,1),(0,l.w)(He,He,be);const u=e.getHalfSize(Be);(0,l.i)(He,u[0]*Math.abs(He[0]),u[1]*Math.abs(He[1]),u[2]*Math.abs(He[2])),(0,l.h)(He,He,s.inverseFlattening),(0,l.g)(He,u,He),t.halfSize=(0,l.h)(He,He,o)}(this,e,t,n,s):function(e,t,r,n,i=(0,f.lO)(r),s=(0,g.jd)(r,i)){e.getCorners(ze),e.getCenter(Fe),Fe[2]+=n,(0,p.l)(r,Fe,Ge,i),t.setCenter(Ge[12],Ge[13],Ge[14]);const o=2*Math.sqrt(1+Ge[0]+Ge[5]+Ge[10]);be[0]=(Ge[6]-Ge[9])/o,be[1]=(Ge[8]-Ge[2])/o,be[2]=(Ge[1]-Ge[4])/o,be[3]=.25*o;const c=e.getQuaternion(Se);t.quaternion=(0,a.lw)(be,be,c),(0,a.Xr)(be,be),(0,l.i)(Ve,0,0,0);const u=t.getCenter(Pe);for(const e of ze)e[2]+=n,s(e,0,e,0),(0,l.a)(He,e,u),(0,l.w)(He,He,be),(0,l.x)(He,He),(0,l.D)(Ve,Ve,He);t.halfSize=Ve}(this,e,t,n,s,o);else if(t.isWGS84&&(r.isWebMercator||(0,y.r1)(r)))!function(e,t,r,n,i){t.getCenter(De),De[2]+=i;const s=(0,f.lO)(r);(0,m.projectBuffer)(De,e,0,De,s,0),Ce(s,t,De,r,n)}(t,this,r,e,n);else if(t.isWebMercator&&(0,y.r1)(r))!function(e,t,r,n,i){t.getCenter(De),De[2]+=i,Ce(e,t,De,r,n)}(t,this,r,e,n);else{const i=this.getCenter(De);i[2]+=n,(0,m.projectBuffer)(i,t,0,i,r,0),e.center=i,this!==e&&(e.quaternion=this.getQuaternion(Se),e.halfSize=this.getHalfSize(Be))}}}const be=(0,o.vt)(),Se=(0,o.vt)(),Ae=(0,o.vt)(),Ee=(0,c.vt)(),we=(0,c.vt)(),Ie=(0,d.vt)();function xe(e,t=new Te){return function(e,t){const{data:r,size:n}=e,i=r.length/n;if(i<=0)return;const s=new le(e);de(E,s.minProj,s.maxProj),fe(E,E,.5),he(w,s.maxProj,s.minProj);const a=ue(w),o=new ce;o.quality=a,i<14&&(e=new S.K(new Float64Array(s.buffer,112,42),3));const l=(0,c.vt)(),u=(0,c.vt)(),d=(0,c.vt)(),h=(0,c.vt)(),f=(0,c.vt)(),p=(0,c.vt)(),m=(0,c.vt)();switch(I(s,e,m,l,u,d,h,f,p,o)){case 1:return void W(E,w,t);case 2:return void ee(e,h,t)}D(e,m,l,u,d,h,f,p,o),te(e,o.b0,o.b1,o.b2,J,Q);const g=(0,c.vt)();he(g,Q,J),o.quality=ue(g),o.quality<a?oe(o.b0,o.b1,o.b2,J,Q,g,t):W(E,w,t)}(e,t),t}const Re=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2],Me=(()=>{const e=new Int8Array(162);let t=0;const r=r=>{for(let n=0;n<r.length;n++)e[t+n]=r[n];t+=6};return r([6,2,3,1,5,4]),r([0,2,3,1,5,4]),r([0,2,3,7,5,4]),r([0,1,3,2,6,4]),r([0,1,3,2,0,0]),r([0,1,5,7,3,2]),r([0,1,3,7,6,4]),r([0,1,3,7,6,2]),r([0,1,5,7,6,2]),r([0,1,5,4,6,2]),r([0,1,5,4,0,0]),r([0,1,3,7,5,4]),r([0,2,6,4,0,0]),r([0,0,0,0,0,0]),r([1,3,7,5,0,0]),r([2,3,7,6,4,0]),r([2,3,7,6,0,0]),r([2,3,1,5,7,6]),r([0,1,5,7,6,2]),r([0,1,5,7,6,4]),r([0,1,3,7,6,4]),r([4,5,7,6,2,0]),r([4,5,7,6,0,0]),r([4,5,1,3,7,6]),r([0,2,3,7,5,4]),r([6,2,3,7,5,4]),r([6,2,3,1,5,4]),e})();function Oe(e,t,r,n,i){const s=e.getQuaternion(Se);i.quaternion=s,(0,a.Xr)(be,s);const o=e.getCenter(De),u=e.getHalfSize(Be);if(n===T.RT.Global){(0,l.w)(He,o,be),(0,l.x)(Ve,He),(0,l.A)(ke,Ve,u),(0,l.a)(ke,Ve,ke);const n=(0,l.l)(ke);(0,l.g)(ke,Ve,u);const s=(0,l.l)(ke);if(n<r)i.center=o,(0,l.i)(He,r,r,r),i.halfSize=(0,l.g)(He,u,He);else{const a=s>0?1+t/s:1,o=n>0?1+r/n:1,c=(o+a)/2,d=(o-a)/2;(0,l.h)(ke,Ve,d),i.halfSize=(0,l.b)(ke,ke,u,c),(0,l.h)(ke,Ve,c),(0,l.b)(ke,ke,u,d),(0,l.B)(He,He),(0,l.C)(He,ke,He);const h=e.getQuaternion(Ae);i.center=(0,l.w)(He,He,h)}}else{i.center=(0,l.b)(He,o,c.Cb,(r+t)/2);const e=(0,l.w)(He,c.Cb,be);(0,l.x)(e,e),i.halfSize=(0,l.b)(Ve,u,e,(r-t)/2)}return i}function Ce(e,t,r,i,s){const a=t.getQuaternion(Se),o=(0,n.I0)(Ue,a),l=t.getHalfSize(Be);for(let e=0;e<8;++e){for(let t=0;t<3;++t)Fe[t]=l[t]*(e&1<<t?-1:1);for(let t=0;t<3;++t){let n=r[t];for(let e=0;e<3;++e)n+=Fe[e]*o[3*e+t];Ne[3*e+t]=n}}(0,m.projectBuffer)(Ne,e,0,Ne,i,0,8),xe(Le,s)}const Ne=new Array(24),Le=new S.K(Ne,3),Fe=(0,c.vt)(),De=(0,c.vt)(),Pe=(0,c.vt)(),Be=(0,c.vt)(),Ue=(0,i.vt)(),Ge=(0,s.vt)(),ze=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],He=(0,c.vt)(),Ve=(0,c.vt)(),ke=(0,c.vt)(),je=(0,c.CN)(-1,-1,-1)},77222:function(e,t,r){r.d(t,{A:function(){return s}});var n=r(9933),i=r(39506);function s(e){e.vertex.code.add(i.H`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${i.H.int(n.k5.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${i.H.int(n.k5.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${i.H.int(n.k5.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${i.H.int(n.k5.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}},30087:function(e,t,r){r.d(t,{i$:function(){return c},oD:function(){return u},xJ:function(){return l}});var n=r(27264),i=r(66299),s=r(11687),a=r(39506);function o(e){e.varyings.add("linearDepth","float")}function l(e){e.vertex.uniforms.add(new s.G("nearFar",((e,t)=>t.camera.nearFar)))}function c(e){e.vertex.code.add(a.H`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}function u(e,t){const{vertex:r}=e;switch(t.output){case n.V.Color:case n.V.ColorEmission:if(t.receiveShadows)return o(e),void r.code.add(a.H`void forwardLinearDepth() { linearDepth = gl_Position.w; }`);break;case n.V.Shadow:case n.V.ShadowHighlight:case n.V.ShadowExcludeHighlight:case n.V.ViewshedShadow:return e.include(i.em,t),o(e),l(e),c(e),void r.code.add(a.H`void forwardLinearDepth() {
linearDepth = calculateLinearDepth(nearFar, vPosition_view.z);
}`)}r.code.add(a.H`void forwardLinearDepth() {}`)}},36101:function(e,t,r){r.d(t,{M:function(){return i}});var n=r(39506);function i(e){e.vertex.code.add(n.H`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}},77423:function(e,t,r){r.d(t,{c:function(){return s}});var n=r(39506),i=r(65839);function s(e,t=!0){e.attributes.add(i.r.POSITION,"vec2"),t&&e.varyings.add("uv","vec2"),e.vertex.main.add(n.H`
      gl_Position = vec4(position, 0.0, 1.0);
      ${t?n.H`uv = position * 0.5 + vec2(0.5);`:""}
  `)}},27264:function(e,t,r){var n;function i(e){return e===n.Shadow||e===n.ShadowHighlight||e===n.ShadowExcludeHighlight||e===n.ViewshedShadow}function s(e){return m(e)||e===n.Normal}function a(e){return function(e){return function(e){return u(e)||o(e)}(e)||g(e)}(e)||e===n.Normal}function o(e){return e===n.Highlight||e===n.ObjectAndLayerIdColor}function l(e){return c(e)||o(e)}function c(e){return e===n.Color}function u(e){return c(e)||_(e)}function d(e){return c(e)||e===n.ObjectAndLayerIdColor}function h(e){return c(e)||e===n.Highlight}function f(e){return h(e)||g(e)}function p(e){return c(e)||o(e)}function m(e){return p(e)||g(e)}function g(e){return e===n.Depth}function _(e){return e===n.ColorEmission}r.d(t,{CL:function(){return o},LG:function(){return _},MO:function(){return m},PJ:function(){return i},RN:function(){return u},V:function(){return n},XY:function(){return s},_o:function(){return c},aD:function(){return f},dX:function(){return p},eh:function(){return g},i3:function(){return l},iq:function(){return a},zW:function(){return d}}),function(e){e[e.Color=0]="Color",e[e.ColorEmission=1]="ColorEmission",e[e.Depth=2]="Depth",e[e.Normal=3]="Normal",e[e.Shadow=4]="Shadow",e[e.ShadowHighlight=5]="ShadowHighlight",e[e.ShadowExcludeHighlight=6]="ShadowExcludeHighlight",e[e.ViewshedShadow=7]="ViewshedShadow",e[e.Highlight=8]="Highlight",e[e.ObjectAndLayerIdColor=9]="ObjectAndLayerIdColor",e[e.COUNT=10]="COUNT"}(n||(n={}))},13668:function(e,t,r){r.d(t,{HQ:function(){return c}});var n=r(73364),i=r(39714),s=r(20551),a=r(32501),o=r(4435),l=(r(82598),r(39506));function c(e,t){!function(e,t,...r){if(!t.hasSlicePlane){const r=l.H`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;return t.hasSliceInVertexProgram&&e.vertex.code.add(r),void e.fragment.code.add(r)}const n=l.H`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,i=l.H`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,s=t.hasSliceHighlight?l.H`
        ${i}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:l.H`#define highlightSlice(_color_, _pos_) (_color_)`;t.hasSliceInVertexProgram&&e.vertex.uniforms.add(...r).code.add(n),e.fragment.uniforms.add(...r).code.add(n),e.fragment.code.add(s)}(e,t,new o.W("slicePlaneOrigin",((e,r)=>function(e,t,r){if(null==r.slicePlane)return a.uY;const n=u(e,t,r),i=d(n,r.slicePlane),o=h(e,n,r);return null!=o?(0,s.t)(m,i,o):i}(t,e,r))),new o.W("slicePlaneBasis1",((e,r)=>f(t,e,r,r.slicePlane?.basis1))),new o.W("slicePlaneBasis2",((e,r)=>f(t,e,r,r.slicePlane?.basis2))))}function u(e,t,r){return e.instancedDoublePrecision?(0,s.i)(p,r.camera.viewInverseTransposeMatrix[3],r.camera.viewInverseTransposeMatrix[7],r.camera.viewInverseTransposeMatrix[11]):t.slicePlaneLocalOrigin}function d(e,t){return null!=e?(0,s.d)(m,t.origin,e):t.origin}function h(e,t,r){return e.hasSliceTranslatedView?null!=t?(0,n.Tl)(_,r.camera.viewMatrix,t):r.camera.viewMatrix:null}function f(e,t,r,n){if(null==n||null==r.slicePlane)return a.uY;const i=u(e,t,r),o=d(i,r.slicePlane),l=h(e,i,r);return null!=l?((0,s.g)(g,n,o),(0,s.t)(m,o,l),(0,s.t)(g,g,l),(0,s.d)(g,g,m)):n}l.Y;const p=(0,a.vt)(),m=(0,a.vt)(),g=(0,a.vt)(),_=(0,i.vt)()},34178:function(e,t,r){r.d(t,{d:function(){return s}});var n=r(30087),i=r(39506);function s(e){(0,n.i$)(e),e.vertex.code.add(i.H`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`),e.vertex.code.add(i.H`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}},14812:function(e,t,r){r.d(t,{B:function(){return y}});var n=r(44705),i=r(87725),s=r(39714),a=r(20551),o=r(32501),l=r(27264),c=r(90576),u=r(20830),d=r(4435),h=r(39506),f=r(78567),p=r(70340),m=r(65839),g=r(44476);h.Y;const _=(0,i.vt)();function y(e,t){const r=t.hasModelTransformation,i=t.instancedDoublePrecision;r&&(e.vertex.uniforms.add(new p.X("model",(e=>e.modelTransformation??s.zK))),e.vertex.uniforms.add(new f.k("normalLocalOriginFromModel",(e=>((0,n.Ge)(_,e.modelTransformation??s.zK),_))))),t.instanced&&i&&(e.attributes.add(m.r.INSTANCEMODELORIGINHI,"vec3"),e.attributes.add(m.r.INSTANCEMODELORIGINLO,"vec3"),e.attributes.add(m.r.INSTANCEMODEL,"mat3"),e.attributes.add(m.r.INSTANCEMODELNORMAL,"mat3"));const o=e.vertex;i&&(o.include(c.u,t),o.uniforms.add(new d.W("viewOriginHi",((e,t)=>(0,g.Zo)((0,a.i)(v,t.camera.viewInverseTransposeMatrix[3],t.camera.viewInverseTransposeMatrix[7],t.camera.viewInverseTransposeMatrix[11]),v))),new d.W("viewOriginLo",((e,t)=>(0,g.jA)((0,a.i)(v,t.camera.viewInverseTransposeMatrix[3],t.camera.viewInverseTransposeMatrix[7],t.camera.viewInverseTransposeMatrix[11]),v))))),o.code.add(h.H`
    vec3 getVertexInLocalOriginSpace() {
      return ${r?i?"(model * vec4(instanceModel * localPosition().xyz, 1.0)).xyz":"(model * localPosition()).xyz":i?"instanceModel * localPosition().xyz":"localPosition().xyz"};
    }

    vec3 subtractOrigin(vec3 _pos) {
      ${i?h.H`
          // Negated inputs are intentionally the first two arguments. The other way around the obfuscation in dpAdd() stopped
          // working for macOS 14+ and iOS 17+.
          // Issue: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/56280
          vec3 originDelta = dpAdd(-instanceModelOriginHi, -instanceModelOriginLo, viewOriginHi, viewOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),o.code.add(h.H`
    vec3 dpNormal(vec4 _normal) {
      return normalize(${r?i?"normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz)":"normalLocalOriginFromModel * _normal.xyz":i?"instanceModelNormal * _normal.xyz":"_normal.xyz"});
    }
    `),t.output===l.V.Normal&&((0,u.S7)(o),o.code.add(h.H`
    vec3 dpNormalView(vec4 _normal) {
      return normalize((viewNormal * ${r?i?"vec4(normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz), 1.0)":"vec4(normalLocalOriginFromModel * _normal.xyz, 1.0)":i?"vec4(instanceModelNormal * _normal.xyz, 1.0)":"_normal"}).xyz);
    }
    `)),t.hasVertexTangents&&o.code.add(h.H`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${r?i?"return vec4(normalLocalOriginFromModel * (instanceModelNormal * _tangent.xyz), _tangent.w);":"return vec4(normalLocalOriginFromModel * _tangent.xyz, _tangent.w);":i?"return vec4(instanceModelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}
    }`)}const v=(0,o.vt)()},11377:function(e,t,r){r.d(t,{W:function(){return n},Y:function(){return l}});var n,i,s=r(82547),a=r(39506),o=r(65839);function l(e,t){switch(t.normalType){case n.Compressed:e.attributes.add(o.r.NORMALCOMPRESSED,"vec2"),e.vertex.code.add(a.H`vec3 decompressNormal(vec2 normal) {
float z = 1.0 - abs(normal.x) - abs(normal.y);
return vec3(normal + sign(normal) * min(z, 0.0), z);
}
vec3 normalModel() {
return decompressNormal(normalCompressed);
}`);break;case n.Attribute:e.attributes.add(o.r.NORMAL,"vec3"),e.vertex.code.add(a.H`vec3 normalModel() {
return normal;
}`);break;case n.ScreenDerivative:e.fragment.code.add(a.H`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`);break;default:(0,s.Xb)(t.normalType);case n.COUNT:}}(i=n||(n={}))[i.Attribute=0]="Attribute",i[i.Compressed=1]="Compressed",i[i.ScreenDerivative=2]="ScreenDerivative",i[i.COUNT=3]="COUNT"},27271:function(e,t,r){r.d(t,{g:function(){return a}});var n=r(27264),i=r(39506),s=r(65839);function a(e,t){if(t.output!==n.V.ObjectAndLayerIdColor)return e.vertex.code.add(i.H`void forwardObjectAndLayerIdColor() {}`),void e.fragment.code.add(i.H`void outputObjectAndLayerIdColor() {}`);const r=t.objectAndLayerIdColorInstanced;e.varyings.add("objectAndLayerIdColorVarying","vec4"),e.attributes.add(r?s.r.INSTANCEOBJECTANDLAYERIDCOLOR:s.r.OBJECTANDLAYERIDCOLOR,"vec4"),e.vertex.code.add(i.H`
    void forwardObjectAndLayerIdColor() {
      objectAndLayerIdColorVarying = ${r?"instanceObjectAndLayerIdColor":"objectAndLayerIdColor"} * 0.003921568627451;
    }`),e.fragment.code.add(i.H`void outputObjectAndLayerIdColor() {
fragColor = objectAndLayerIdColorVarying;
}`)}},91765:function(e,t,r){r.d(t,{I:function(){return s}});var n=r(39506),i=r(65839);function s(e){e.attributes.add(i.r.POSITION,"vec3"),e.vertex.code.add(n.H`vec3 positionModel() { return position; }`)}},40883:function(e,t,r){r.d(t,{K:function(){return l}});var n=r(77222),i=r(50295),s=r(39506),a=r(65839),o=r(84887);function l(e,t){t.hasSymbolColors?(e.include(n.A),e.attributes.add(a.r.SYMBOLCOLOR,"vec4"),e.varyings.add("colorMixMode","mediump float"),e.vertex.code.add(s.H`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(e.fragment.uniforms.add(new i.c("colorMixMode",(e=>o.Um[e.colorMixMode]))),e.vertex.code.add(s.H`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))}},2457:function(e,t,r){r.d(t,{I:function(){return n},U:function(){return l}});var n,i,s=r(82547),a=r(39506),o=r(65839);function l(e,t){switch(t.textureCoordinateType){case n.Default:return e.attributes.add(o.r.UV0,"vec2"),e.varyings.add("vuv0","vec2"),void e.vertex.code.add(a.H`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case n.Compressed:return e.attributes.add(o.r.UV0,"vec2"),e.varyings.add("vuv0","vec2"),void e.vertex.code.add(a.H`vec2 getUV0() {
return uv0 / 16384.0;
}
void forwardTextureCoordinates() {
vuv0 = getUV0();
}`);case n.Atlas:return e.attributes.add(o.r.UV0,"vec2"),e.varyings.add("vuv0","vec2"),e.attributes.add(o.r.UVREGION,"vec4"),e.varyings.add("vuvRegion","vec4"),void e.vertex.code.add(a.H`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);default:(0,s.Xb)(t.textureCoordinateType);case n.None:return void e.vertex.code.add(a.H`void forwardTextureCoordinates() {}`);case n.COUNT:return}}(i=n||(n={}))[i.None=0]="None",i[i.Default=1]="Default",i[i.Atlas=2]="Atlas",i[i.Compressed=3]="Compressed",i[i.COUNT=4]="COUNT"},85709:function(e,t,r){r.d(t,{c:function(){return s}});var n=r(39506),i=r(65839);function s(e,t){t.hasVertexColors?(e.attributes.add(i.r.COLOR,"vec4"),e.varyings.add("vColor","vec4"),e.vertex.code.add(n.H`void forwardVertexColor() { vColor = color; }`),e.vertex.code.add(n.H`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):e.vertex.code.add(n.H`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}},94211:function(e,t,r){r.d(t,{Mh:function(){return d},Zo:function(){return h},gy:function(){return f}});var n=r(82547),i=r(87725),s=r(41546),a=r(11377),o=r(66299),l=r(39506),c=r(31190),u=r(78567);function d(e,t){switch(t.normalType){case a.W.Attribute:case a.W.Compressed:e.include(a.Y,t),e.varyings.add("vNormalWorld","vec3"),e.varyings.add("vNormalView","vec3"),e.vertex.uniforms.add(new c.h("transformNormalGlobalFromModel",(e=>e.transformNormalGlobalFromModel)),new u.k("transformNormalViewFromGlobal",(e=>e.transformNormalViewFromGlobal))),e.vertex.code.add(l.H`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`);break;case a.W.ScreenDerivative:e.vertex.code.add(l.H`void forwardNormal() {}`);break;default:(0,n.Xb)(t.normalType);case a.W.COUNT:}}class h extends o.dO{constructor(){super(...arguments),this.transformNormalViewFromGlobal=(0,i.vt)()}}class f extends o.EM{constructor(){super(...arguments),this.transformNormalGlobalFromModel=(0,i.vt)(),this.toMapSpace=(0,s.vt)()}}},66299:function(e,t,r){r.d(t,{EM:function(){return g},dO:function(){return m},em:function(){return p}});var n=r(87725),i=r(39714),s=r(32501),a=r(91765),o=r(90576),l=r(4435),c=r(82598),u=r(39506),d=r(31190),h=r(78567),f=r(70340);function p(e,t){e.include(a.I);const r=e.vertex;r.include(o.u,t),e.varyings.add("vPositionWorldCameraRelative","vec3"),e.varyings.add("vPosition_view","vec3"),r.uniforms.add(new c.t("transformWorldFromViewTH",(e=>e.transformWorldFromViewTH)),new c.t("transformWorldFromViewTL",(e=>e.transformWorldFromViewTL)),new h.k("transformViewFromCameraRelativeRS",(e=>e.transformViewFromCameraRelativeRS)),new f.X("transformProjFromView",(e=>e.transformProjFromView)),new d.h("transformWorldFromModelRS",(e=>e.transformWorldFromModelRS)),new l.W("transformWorldFromModelTH",(e=>e.transformWorldFromModelTH)),new l.W("transformWorldFromModelTL",(e=>e.transformWorldFromModelTL))),r.code.add(u.H`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),r.code.add(u.H`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${t.spherical?u.H`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:u.H`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),e.fragment.uniforms.add(new c.t("transformWorldFromViewTL",(e=>e.transformWorldFromViewTL))),r.code.add(u.H`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),e.fragment.code.add(u.H`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}class m extends u.Y{constructor(){super(...arguments),this.transformWorldFromViewTH=(0,s.vt)(),this.transformWorldFromViewTL=(0,s.vt)(),this.transformViewFromCameraRelativeRS=(0,n.vt)(),this.transformProjFromView=(0,i.vt)()}}class g extends u.Y{constructor(){super(...arguments),this.transformWorldFromModelRS=(0,n.vt)(),this.transformWorldFromModelTH=(0,s.vt)(),this.transformWorldFromModelTL=(0,s.vt)()}}},28499:function(e,t,r){r.d(t,{r:function(){return a}});var n=r(2457),i=r(39506);function s(e){e.fragment.code.add(i.H`vec4 textureAtlasLookup(sampler2D tex, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
return textureGrad(tex, uvAtlas, dUVdx, dUVdy);
}`)}function a(e,t){const{textureCoordinateType:r}=t;if(r===n.I.None||r===n.I.COUNT)return;e.include(n.U,t);const a=r===n.I.Atlas;a&&e.include(s),e.fragment.code.add(i.H`
    vec4 textureLookup(sampler2D tex, vec2 uv) {
      return ${a?"textureAtlasLookup(tex, uv, vuvRegion)":"texture(tex, uv)"};
    }
  `)}},74603:function(e,t,r){r.d(t,{G:function(){return c},V:function(){return d}});var n=r(33400),i=r(41546),s=r(19202),a=r(20830),o=r(38917),l=r(39506);function c(e,t){const r=e.vertex;t.hasVerticalOffset?(d(r),t.hasScreenSizePerspective&&(e.include(s.Y6),(0,s.OH)(r),(0,a.yu)(e.vertex,t)),r.code.add(l.H`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${t.spherical?l.H`vec3 worldNormal = normalize(worldPos + localOrigin);`:l.H`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${t.hasScreenSizePerspective?l.H`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:l.H`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):r.code.add(l.H`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const u=(0,i.vt)();function d(e){e.uniforms.add(new o.E("verticalOffset",((e,t)=>{const{minWorldLength:r,maxWorldLength:i,screenLength:s}=e.verticalOffset,a=Math.tan(.5*t.camera.fovY)/(.5*t.camera.fullViewport[3]),o=t.camera.pixelRatio||1;return(0,n.s)(u,s*o,a,r,i)})))}},15209:function(e,t,r){r.d(t,{E:function(){return v}});var n=r(30087),i=r(27264),s=r(13668),a=r(34178),o=r(11377),l=r(27271),c=r(2457),u=r(94211),d=r(84464),h=r(84435),f=r(58766),p=r(19462),m=r(20830),g=r(39506),_=r(39838),y=r(54407);function v(e,t){const{vertex:r,fragment:v}=e,T=t.hasColorTexture&&t.alphaDiscardMode!==y.sf.Opaque,{output:b,normalType:S,hasColorTextureTransform:A}=t;switch(b){case i.V.Depth:(0,m.NB)(r,t),e.include(a.d,t),e.include(s.HQ,t),e.include(c.U,t),T&&v.uniforms.add(new _.N("tex",(e=>e.texture))),r.main.add(g.H`vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPosition(proj, view, vpos);
forwardTextureCoordinates();`),e.include(p.S,t),v.main.add(g.H`
          discardBySlice(vpos);
          ${(0,g.If)(T,g.H`vec4 texColor = texture(tex, ${A?"colorUV":"vuv0"});
                 discardOrAdjustAlpha(texColor);`)}`);break;case i.V.Shadow:case i.V.ShadowHighlight:case i.V.ShadowExcludeHighlight:case i.V.ViewshedShadow:case i.V.ObjectAndLayerIdColor:(0,m.NB)(r,t),e.include(a.d,t),e.include(c.U,t),e.include(f.A,t),e.include(d.L,t),e.include(s.HQ,t),e.include(l.g,t),(0,n.xJ)(e),e.varyings.add("depth","float"),T&&v.uniforms.add(new _.N("tex",(e=>e.texture))),r.main.add(g.H`vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
forwardTextureCoordinates();
forwardObjectAndLayerIdColor();`),e.include(p.S,t),v.main.add(g.H`
          discardBySlice(vpos);
          ${(0,g.If)(T,g.H`vec4 texColor = texture(tex, ${A?"colorUV":"vuv0"});
                 discardOrAdjustAlpha(texColor);`)}
          ${b===i.V.ObjectAndLayerIdColor?g.H`outputObjectAndLayerIdColor();`:g.H`outputDepth(depth);`}`);break;case i.V.Normal:{(0,m.NB)(r,t),e.include(a.d,t),e.include(o.Y,t),e.include(u.Mh,t),e.include(c.U,t),e.include(f.A,t),T&&v.uniforms.add(new _.N("tex",(e=>e.texture))),S===o.W.ScreenDerivative&&e.varyings.add("vPositionView","vec3");const n=S===o.W.Attribute||S===o.W.Compressed;r.main.add(g.H`
          vpos = getVertexInLocalOriginSpace();
          ${n?g.H`vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:g.H`vPositionView = (view * vec4(vpos, 1.0)).xyz;`}
          vpos = subtractOrigin(vpos);
          vpos = addVerticalOffset(vpos, localOrigin);
          gl_Position = transformPosition(proj, view, vpos);
          forwardTextureCoordinates();`),e.include(s.HQ,t),e.include(p.S,t),v.main.add(g.H`
          discardBySlice(vpos);
          ${(0,g.If)(T,g.H`vec4 texColor = texture(tex, ${A?"colorUV":"vuv0"});
                 discardOrAdjustAlpha(texColor);`)}

          ${S===o.W.ScreenDerivative?g.H`vec3 normal = screenDerivativeNormal(vPositionView);`:g.H`vec3 normal = normalize(vNormalWorld);
                     if (gl_FrontFacing == false){
                       normal = -normal;
                     }`}
          fragColor = vec4(0.5 + 0.5 * normal, 1.0);`);break}case i.V.Highlight:(0,m.NB)(r,t),e.include(a.d,t),e.include(c.U,t),e.include(f.A,t),T&&v.uniforms.add(new _.N("tex",(e=>e.texture))),r.main.add(g.H`vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPosition(proj, view, vpos);
forwardTextureCoordinates();`),e.include(s.HQ,t),e.include(p.S,t),e.include(h.Q,t),v.main.add(g.H`
          discardBySlice(vpos);
          ${(0,g.If)(T,g.H`vec4 texColor = texture(tex, ${A?"colorUV":"vuv0"});
                 discardOrAdjustAlpha(texColor);`)}
          calculateOcclusionAndOutputHighlight();`)}}},10155:function(e,t,r){r.d(t,{K:function(){return s}});var n=r(45937),i=r(39506);function s(e){e.uniforms.add(new n.e("alignPixelEnabled",((e,t)=>t.alignPixelEnabled))),e.code.add(i.H`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`),e.code.add(i.H`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`)}},1143:function(e,t,r){r.d(t,{Q:function(){return d},R:function(){return u}});var n=r(74603),i=r(19202),s=r(20830),a=r(38917),o=r(14543),l=r(39506),c=r(65839);const u=.5;function d(e,t){e.include(i.Y6),e.attributes.add(c.r.POSITION,"vec3"),e.attributes.add(c.r.NORMAL,"vec3"),e.attributes.add(c.r.CENTEROFFSETANDDISTANCE,"vec4");const r=e.vertex;(0,s.NB)(r,t),(0,s.yu)(r,t),r.uniforms.add(new a.E("viewport",((e,t)=>t.camera.fullViewport)),new o.m("polygonOffset",(e=>e.shaderPolygonOffset)),new o.m("cameraGroundRelative",((e,t)=>t.camera.aboveGround?1:-1))),t.hasVerticalOffset&&(0,n.V)(r),r.constants.add("smallOffsetAngle","float",.984807753012208),r.code.add(l.H`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),r.code.add(l.H`
    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
      float pointGroundSign = ${t.terrainDepthTest?l.H.float(0):l.H`sign(pointGroundDistance)`};
      if (pointGroundSign == 0.0) {
        pointGroundSign = cameraGroundRelative;
      }

      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground
      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise
      float groundRelative = cameraGroundRelative * pointGroundSign;

      // view angle dependent part of polygon offset emulation: we take the absolute value because the sign that is
      // dropped is instead introduced using the ground-relative position of the symbol and the camera
      if (polygonOffset > .0) {
        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
        float factor = (1.0 - tanAlpha / viewport[2]);

        // same side of the terrain
        if (groundRelative > 0.0) {
          posView *= factor;
        }
        // opposite sides of the terrain
        else {
          posView /= factor;
        }
      }

      return groundRelative;
    }
  `),t.draped&&!t.hasVerticalOffset||(0,s.S7)(r),t.draped||(r.uniforms.add(new o.m("perDistancePixelRatio",((e,t)=>Math.tan(t.camera.fovY/2)/(t.camera.fullViewport[2]/2)))),r.code.add(l.H`
    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
      float distanceToCamera = length(posView);

      // Compute offset in world units for a half pixel shift
      float pixelOffset = distanceToCamera * perDistancePixelRatio * ${l.H.float(u)};

      // Apply offset along normal in the direction away from the ground surface
      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;

      // Apply the same offset also on the view space position
      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;

      posModel += modelOffset;
      posView += viewOffset;
    }
  `)),t.screenCenterOffsetUnitsEnabled&&(0,s.Nz)(r),t.hasScreenSizePerspective&&(0,i.OH)(r),r.code.add(l.H`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      vec3 centerOffset = centerOffsetAndDistance.xyz;
      float pointGroundDistance = centerOffsetAndDistance.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${t.draped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${t.hasScreenSizePerspective&&(t.hasVerticalOffset||t.screenCenterOffsetUnitsEnabled)?"vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${t.hasVerticalOffset?t.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${t.hasVerticalOffset?l.H`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${t.screenCenterOffsetUnitsEnabled?"":l.H`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${t.screenCenterOffsetUnitsEnabled?t.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${t.screenCenterOffsetUnitsEnabled?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `)}},50399:function(e,t,r){r.d(t,{I:function(){return a}});var n=r(10155),i=r(77771),s=r(39506);function a(e,t){const{vertex:r,fragment:a}=e;e.include(i.Z,t),r.include(n.K),t.terrainDepthTest&&e.varyings.add("depth","float"),r.main.add(s.H`
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${t.terrainDepthTest?s.H`depth = projectAux.posView.z;`:""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  `),a.main.add(s.H`fragColor = vec4(1);
if(terrainDepthTest(depth)) {
fragColor.g = 0.5;
}`)}},60808:function(e,t,r){var n;r.d(t,{D:function(){return n}}),function(e){e[e.Occluded=0]="Occluded",e[e.NotOccluded=1]="NotOccluded",e[e.Both=2]="Both",e[e.COUNT=3]="COUNT"}(n||(n={}))},80231:function(e,t,r){r.d(t,{y:function(){return c}});var n=r(10155),i=r(60808),s=r(38917),a=r(14543),o=r(39506),l=r(39838);function c(e){e.vertex.uniforms.add(new a.m("renderTransparentlyOccludedHUD",((e,t)=>t.hudRenderStyle===i.D.Occluded?1:t.hudRenderStyle===i.D.NotOccluded?0:.75)),new s.E("viewport",((e,t)=>t.camera.fullViewport)),new l.N("hudVisibilityTexture",((e,t)=>t.hudVisibility?.getTexture()))),e.vertex.include(n.K),e.vertex.code.add(o.H`bool testHUDVisibility(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}},38130:function(e,t,r){r.d(t,{NL:function(){return f},ZX:function(){return n}});var n,i,s=r(27264),a=r(28499),o=r(4435),l=r(82598),c=r(39506),u=r(40075),d=r(39838),h=r(54516);function f(e,t){if(!(0,s.RN)(t.output))return;const{emissionSource:r,hasEmissiveTextureTransform:i,bindType:f}=t,p=r===n.Texture;p&&(e.include(a.r,t),e.fragment.uniforms.add(f===h.c.Pass?new d.N("texEmission",(e=>e.textureEmissive)):new u.o("texEmission",(e=>e.textureEmissive))));const m=r===n.Value||p;m&&e.fragment.uniforms.add(f===h.c.Pass?new l.t("emissionFactor",(e=>e.emissiveFactor)):new o.W("emissionFactor",(e=>e.emissiveFactor))),e.fragment.code.add(c.H`
    vec4 getEmissions() {
      vec4 emissions = ${m?"vec4(emissionFactor, 1.0)":"vec4(0.0)"};
      ${(0,c.If)(p,`emissions *= textureLookup(texEmission, ${i?"emissiveUV":"vuv0"});\n         emissions.w = emissions.rgb == vec3(0.0) ? 0.0: emissions.w;`)};
      return emissions;
    }
  `)}r(36634),(i=n||(n={}))[i.None=0]="None",i[i.Value=1]="Value",i[i.Texture=2]="Texture",i[i.COUNT=3]="COUNT"},84464:function(e,t,r){r.d(t,{L:function(){return a}});var n=r(27264),i=r(47483),s=r(39506);function a(e,t){switch(t.output){case n.V.Shadow:case n.V.ShadowHighlight:case n.V.ShadowExcludeHighlight:case n.V.ViewshedShadow:e.fragment.include(i.U),e.fragment.code.add(s.H`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 20.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
return depth + SLOPE_SCALE * m + BIAS;
}
void outputDepth(float _linearDepth) {
fragColor = floatToRgba4(_calculateFragDepth(_linearDepth));
}`)}}},84435:function(e,t,r){r.d(t,{Q:function(){return l}});var n=r(27264),i=r(12511),s=r(50295),a=r(39506),o=r(39838);function l(e,t){const{fragment:r}=e;t.output===n.V.Highlight?(r.uniforms.add(new o.N("depthTexture",((e,t)=>t.mainDepth)),new o.N("highlightTexture",((e,t)=>t.highlightMixTexture)),new s.c("highlightLevel",((e,t)=>t.highlightLevel)),new i.g("highlightMixOrigin",((e,t)=>t.highlightMixOrigin))),e.outputs.add("fragHighlight","vec2",0),r.code.add(a.H`vec2 getAccumulatedHighlight() {
return texelFetch(highlightTexture, ivec2(gl_FragCoord.xy) - highlightMixOrigin, 0).rg;
}
void outputHighlight(bool occluded) {
if (highlightLevel == 0) {
uint bits = occluded ? 3u : 1u;
fragHighlight = vec2(float(bits) / 255.0, 0.0);
} else {
int ll = (highlightLevel & 3) << 1;
int li = (highlightLevel >> 2) & 3;
uint bits;
if (occluded) {
bits = 3u << ll;
} else {
bits = 1u << ll;
}
vec2 combinedHighlight = getAccumulatedHighlight();
uint accumulatedI = uint(combinedHighlight[li] * 255.0);
combinedHighlight[li] = float(bits | accumulatedI) / 255.0;
fragHighlight = combinedHighlight;
}
}
bool isHighlightOccluded() {
float sceneDepth = texelFetch(depthTexture, ivec2(gl_FragCoord.xy), 0).x;
return gl_FragCoord.z > sceneDepth + 5e-7;
}
void calculateOcclusionAndOutputHighlight() {
outputHighlight(isHighlightOccluded());
}`),t.canHaveOverlay&&(r.constants.add("occlusionAndMask","int",85),r.code.add(a.H`void outputAllHighlights(vec2 highlightToAdd) {
if (highlightToAdd == vec2(0.0)) { discard; }
int occludedOrMask = isHighlightOccluded() ? 0xaa : 0;
ivec2 added = ivec2(highlightToAdd * 255.0);
ivec2 masked = (added & ivec2(occlusionAndMask)) | (ivec2(occludedOrMask) & (added<<1));
fragHighlight = vec2(masked) / 255.0;
}`))):r.code.add(a.H`void calculateOcclusionAndOutputHighlight() {}`)}},23397:function(e,t,r){r.d(t,{E:function(){return o}});var n=r(13786),i=r(1932),s=r(11687),a=r(39506);function o(e){e.uniforms.add(new s.G("zProjectionMap",((e,t)=>function(e){const t=e.projectionMatrix;return(0,n.hZ)(l,t[14],t[10])}(t.camera)))),e.code.add(a.H`float linearizeDepth(float depth) {
float depthNdc = depth * 2.0 - 1.0;
float c1 = zProjectionMap[0];
float c2 = zProjectionMap[1];
return -(c1 / (depthNdc + c2 + 1e-7));
}`),e.code.add(a.H`float depthFromTexture(sampler2D depthTexture, vec2 uv) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthTexture, 0)));
float depth = texelFetch(depthTexture, iuv, 0).r;
return depth;
}`),e.code.add(a.H`float linearDepthFromTexture(sampler2D depthTexture, vec2 uv) {
return linearizeDepth(depthFromTexture(depthTexture, uv));
}`)}const l=(0,i.vt)()},40602:function(e,t,r){r.d(t,{W:function(){return m}});var n=r(87725),i=r(1932),s=r(2457),a=r(28499),o=r(50865),l=r(11687),c=r(39506),u=r(78567),d=r(40075),h=r(39838),f=r(54516),p=r(65839);function m(e,t){const r=e.fragment;t.hasVertexTangents?(e.attributes.add(p.r.TANGENT,"vec4"),e.varyings.add("vTangent","vec4"),t.doubleSidedMode===o.W.WindingOrder?r.code.add(c.H`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):r.code.add(c.H`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):r.code.add(c.H`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`),t.textureCoordinateType!==s.I.None&&(e.include(a.r,t),r.uniforms.add(t.bindType===f.c.Pass?new h.N("normalTexture",(e=>e.textureNormal)):new d.o("normalTexture",(e=>e.textureNormal))),t.hasNormalTextureTransform&&(r.uniforms.add(new l.G("scale",(e=>e.scale??i.Un))),r.uniforms.add(new u.k("normalTextureTransformMatrix",(e=>e.normalTextureTransformMatrix??n.zK)))),r.code.add(c.H`vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
vec3 rawNormal = textureLookup(normalTexture, uv).rgb * 2.0 - 1.0;`),t.hasNormalTextureTransform&&r.code.add(c.H`mat3 normalTextureRotation = mat3(normalTextureTransformMatrix[0][0]/scale[0], normalTextureTransformMatrix[0][1]/scale[1], 0.0,
normalTextureTransformMatrix[1][0]/scale[0], normalTextureTransformMatrix[1][1]/scale[1], 0.0,
0.0, 0.0, 0.0 );
rawNormal.xy = (normalTextureRotation * vec3(rawNormal.x, rawNormal.y, 1.0)).xy;`),r.code.add(c.H`return tangentSpace * rawNormal;
}`))}},46042:function(e,t,r){r.d(t,{W:function(){return d}});var n=r(20551),i=r(32501),s=r(33400),a=r(41546),o=r(11520),l=r(82598),c=r(38917),u=r(39506);function d(e,t){const r=e.fragment,i=void 0!==t.lightingSphericalHarmonicsOrder?t.lightingSphericalHarmonicsOrder:2;0===i?(r.uniforms.add(new l.t("lightingAmbientSH0",((e,t)=>(0,n.i)(h,t.lighting.sh.r[0],t.lighting.sh.g[0],t.lighting.sh.b[0])))),r.code.add(u.H`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):1===i?(r.uniforms.add(new c.E("lightingAmbientSH_R",((e,t)=>(0,s.s)(f,t.lighting.sh.r[0],t.lighting.sh.r[1],t.lighting.sh.r[2],t.lighting.sh.r[3]))),new c.E("lightingAmbientSH_G",((e,t)=>(0,s.s)(f,t.lighting.sh.g[0],t.lighting.sh.g[1],t.lighting.sh.g[2],t.lighting.sh.g[3]))),new c.E("lightingAmbientSH_B",((e,t)=>(0,s.s)(f,t.lighting.sh.b[0],t.lighting.sh.b[1],t.lighting.sh.b[2],t.lighting.sh.b[3])))),r.code.add(u.H`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):2===i&&(r.uniforms.add(new l.t("lightingAmbientSH0",((e,t)=>(0,n.i)(h,t.lighting.sh.r[0],t.lighting.sh.g[0],t.lighting.sh.b[0]))),new c.E("lightingAmbientSH_R1",((e,t)=>(0,s.s)(f,t.lighting.sh.r[1],t.lighting.sh.r[2],t.lighting.sh.r[3],t.lighting.sh.r[4]))),new c.E("lightingAmbientSH_G1",((e,t)=>(0,s.s)(f,t.lighting.sh.g[1],t.lighting.sh.g[2],t.lighting.sh.g[3],t.lighting.sh.g[4]))),new c.E("lightingAmbientSH_B1",((e,t)=>(0,s.s)(f,t.lighting.sh.b[1],t.lighting.sh.b[2],t.lighting.sh.b[3],t.lighting.sh.b[4]))),new c.E("lightingAmbientSH_R2",((e,t)=>(0,s.s)(f,t.lighting.sh.r[5],t.lighting.sh.r[6],t.lighting.sh.r[7],t.lighting.sh.r[8]))),new c.E("lightingAmbientSH_G2",((e,t)=>(0,s.s)(f,t.lighting.sh.g[5],t.lighting.sh.g[6],t.lighting.sh.g[7],t.lighting.sh.g[8]))),new c.E("lightingAmbientSH_B2",((e,t)=>(0,s.s)(f,t.lighting.sh.b[5],t.lighting.sh.b[6],t.lighting.sh.b[7],t.lighting.sh.b[8])))),r.code.add(u.H`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),t.pbrMode!==o.A9.Normal&&t.pbrMode!==o.A9.Schematic||r.code.add(u.H`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}const h=(0,i.vt)(),f=(0,a.vt)()},32488:function(e,t,r){r.d(t,{n:function(){return P}});var n=r(39506),i=r(39838),s=r(53804),a=r(15774),o=r(95929),l=r(28181),c=r(38504),u=r(23502),d=(r(58941),r(40633),r(13798),r(65953)),h=r(13786),f=r(46671),p=r(98680),m=r(74174),g=r(3088),_=r(34615),y=r(82273),v=r(37739),T=r(57087);class b extends y.w{constructor(e,t,n){super(e,t,new _.$(v.S,(()=>r.e(7809).then(r.bind(r,92891)))),n)}initializePipeline(){return(0,T.Ey)({colorWrite:T.kn})}}var S=r(1932);class A extends n.Y{constructor(){super(...arguments),this.projScale=1}}class E extends A{constructor(){super(...arguments),this.intensity=1}}class w extends n.Y{}class I extends w{constructor(){super(...arguments),this.blurSize=(0,S.vt)()}}var x=r(184);class R extends y.w{constructor(e,t,n){super(e,t,new _.$(x.S,(()=>r.e(5912).then(r.bind(r,45352)))),n)}initializePipeline(){return(0,T.Ey)({colorWrite:T.kn})}}var M=r(54407),O=r(85456),C=r(12285),N=r(10956);const L=2;let F=class extends m.A{constructor(e){super(e),this.consumes={required:["normals"]},this.produces=f.OG.SSAO,this.isEnabled=()=>!1,this._enableTime=(0,c.l5)(0),this._passParameters=new E,this._drawParameters=new I}initialize(){const e=Uint8Array.from(atob("eXKEvZaUc66cjIKElE1jlJ6MjJ6Ufkl+jn2fcXp5jBx7c6KEflSGiXuXeW6OWs+tfqZ2Yot2Y7Zzfo2BhniEj3xoiXuXj4eGZpqEaHKDWjSMe7palFlzc3BziYOGlFVzg6Zzg7CUY5JrjFF7eYJ4jIKEcyyEonSXe7qUfqZ7j3xofqZ2c4R5lFZ5Y0WUbppoe1l2cIh2ezyUho+BcHN2cG6DbpqJhqp2e1GcezhrdldzjFGUcyxjc3aRjDyEc1h7Sl17c6aMjH92pb6Mjpd4dnqBjMOEhqZleIOBYzB7gYx+fnqGjJuEkWlwnCx7fGl+c4hjfGyRe5qMlNOMfnqGhIWHc6OMi4GDc6aMfqZuc6aMzqJzlKZ+lJ6Me3qRfoFue0WUhoR5UraEa6qMkXiPjMOMlJOGe7JrUqKMjK6MeYRzdod+Sl17boiPc6qEeYBlcIh2c1WEe7GDiWCDa0WMjEmMdod+Y0WcdntzhmN8WjyMjKJjiXtzgYxYaGd+a89zlEV7e2GJfnd+lF1rcK5zc4p5cHuBhL6EcXp5eYB7fnh8iX6HjIKEeaxuiYOGc66RfG2Ja5hzjlGMjEmMe9OEgXuPfHyGhPeEdl6JY02McGuMfnqGhFiMa3WJfnx2l4hwcG1uhmN8c0WMc39og1GBbrCEjE2EZY+JcIh2cIuGhIWHe0mEhIVrc09+gY5+eYBlnCyMhGCDl3drfmmMgX15aGd+gYx+fnuRfnhzY1SMsluJfnd+hm98WtNrcIuGh4SEj0qPdkqOjFF7jNNjdnqBgaqUjMt7boeBhnZ4jDR7c5pze4GGjEFrhLqMjHyMc0mUhKZze4WEa117kWlwbpqJjHZ2eX2Bc09zeId+e0V7WlF7jHJ2l72BfId8l3eBgXyBe897jGl7c66cgW+Xc76EjKNbgaSEjGx4fId8jFFjgZB8cG6DhlFziZhrcIh2fH6HgUqBgXiPY8dahGFzjEmMhEFre2dxhoBzc5SGfleGe6alc7aUeYBlhKqUdlp+cH5za4OEczxza0Gcc4J2jHZ5iXuXjH2Jh5yRjH2JcFx+hImBjH+MpddCl3dreZeJjIt8ZW18bm1zjoSEeIOBlF9oh3N7hlqBY4+UeYFwhLJjeYFwaGd+gUqBYxiEYot2fqZ2ondzhL6EYyiEY02Ea0VjgZB8doaGjHxoc66cjEGEiXuXiXWMiZhreHx8frGMe75rY02Ec5pzfnhzlEp4a3VzjM+EhFFza3mUY7Zza1V5e2iMfGyRcziEhDyEkXZ2Y4OBnCx7g5t2eyBjgV6EhEFrcIh2dod+c4Z+nJ5zjm15jEmUeYxijJp7nL6clIpjhoR5WrZraGd+fnuRa6pzlIiMg6ZzfHx5foh+eX1ufnB5eX1ufnB5aJt7UqKMjIh+e3aBfm5lbYSBhGFze6J4c39oc0mUc4Z+e0V7fKFVe0WEdoaGY02Ec4Z+Y02EZYWBfH6HgU1+gY5+hIWUgW+XjJ57ebWRhFVScHuBfJ6PhBx7WqJzlM+Ujpd4gHZziX6HjHmEgZN+lJt5boiPe2GJgX+GjIGJgHZzeaxufnB5hF2JtdN7jJ57hp57hK6ElFVzg6ZzbmiEbndzhIWHe3uJfoFue3qRhJd2j3xoc65zlE1jc3p8lE1jhniEgXJ7e657vZaUc3qBh52BhIF4aHKDa9drgY5+c52GWqZzbpqJe8tjnM+UhIeMfo2BfGl+hG1zSmmMjKJjZVaGgX15c1lze0mEp4OHa3mUhIWHhDyclJ6MeYOJkXiPc0VzhFiMlKaEboSJa5Jze41re3qRhn+HZYWBe0mEc4p5fnORbox5lEp4hGFjhGGEjJuEc1WEhLZjeHeGa7KlfHx2hLaMeX1ugY5+hIWHhKGPjMN7c1WEho1zhoBzZYx7fnhzlJt5exyUhFFziXtzfmmMa6qMYyiEiXxweV12kZSMeWqXSl17fnhzxmmMrVGEe1mcc4p5eHeGjK6MgY5+doaGa6pzlGV7g1qBh4KHkXiPeW6OaKqafqZ2eXZ5e1V7jGd7boSJc3BzhJd2e0mcYot2h1RoY8dahK6EQmWEWjx7e1l2lL6UgXyBdnR4eU9zc0VreX1umqaBhld7fo2Bc6KEc5Z+hDyEcIeBWtNrfHyGe5qMhMuMe5qMhEGEbVVupcNzg3aHhIF4boeBe0mEdlptc39ofFl5Y8uUlJOGiYt2UmGEcyxjjGx4jFF7a657ZYWBnElzhp57iXtrgZN+tfOEhIOBjE2HgU1+e8tjjKNbiWCDhE15gUqBgYN7fnqGc66ce9d7iYSBj0qPcG6DnGGcT3eGa6qMZY+JlIiMl4hwc3aRdnqBlGV7eHJ2hLZjfnuRhDyEeX6MSk17g6Z+c6aUjHmEhIF4gXyBc76EZW18fGl+fkl+jCxrhoVwhDyUhIqGlL2DlI6EhJd2tdN7eYORhEGMa2Faa6pzc3Bzc4R5lIRznM+UY9eMhDycc5Z+c4p5c4iGY117pb6MgXuPrbJafnx2eYOJeXZ5e657hDyEcziElKZjfoB5eHeGj4WRhGGEe6KGeX1utTStc76EhFGJnCyMa5hzfH6HnNeceYB7hmN8gYuMhIVrczSMgYF8h3N7c5pza5hzjJqEYIRdgYuMlL2DeYRzhGGEeX1uhLaEc4iGeZ1zdl6JhrVteX6Me2iMfm5lWqJzSpqEa6pzdnmchHx2c6OMhNdrhoR5g3aHczxzeW52gV6Ejm15frGMc0Vzc4Z+l3drfniJe+9rWq5rlF1rhGGEhoVwe9OEfoh+e7pac09+c3qBY0lrhDycdnp2lJ6MiYOGhGCDc3aRlL2DlJt5doaGdnp2gYF8gWeOjF2Uc4R5c5Z+jEmMe7KEc4mEeYJ4dmyBe0mcgXiPbqJ7eYB7fmGGiYSJjICGlF1reZ2PnElzbpqJfH6Hc39oe4WEc5eJhK6EhqyJc3qBgZB8c09+hEmEaHKDhFGJc5SGiXWMUpaEa89zc6OMnCyMiXtrho+Be5qMc7KEjJ57dmN+hKGPjICGbmiEe7prdod+hGCDdnmchBx7eX6MkXZ2hGGEa657hm98jFFjY5JreYOJgY2EjHZ2a295Y3FajJ6Mc1J+YzB7e4WBjF2Uc4R5eV12gYxzg1qBeId+c9OUc5pzjFFjgY5+hFiMlIaPhoR5lIpjjIKBlNdSe7KEeX2BfrGMhIqGc65zjE2UhK6EklZ+QmWEeziMWqZza3VzdnR4foh+gYF8n3iJiZhrnKp7gYF8eId+lJ6Me1lrcIuGjKJjhmN8c66MjFF7a6prjJ6UnJ5zezyUfruRWlF7nI5zfHyGe657h4SEe8tjhBx7jFFjc09+c39ojICMeZeJeXt+YzRzjHZ2c0WEcIeBeXZ5onSXkVR+gYJ+eYFwdldzgYF7eX2BjJ6UiXuXlE1jh4SEe1mchLJjc4Z+hqZ7eXZ5bm1zlL6Ue5p7iWeGhKqUY5pzjKJjcIeBe8t7gXyBYIRdlEp4a3mGnK6EfmmMZpqEfFl5gYxzjKZuhGFjhoKGhHx2fnx2eXuMe3aBiWeGvbKMe6KGa5hzYzB7gZOBlGV7hmN8hqZlYot2Y117a6pzc6KEfId8foB5rctrfneJfJ6PcHN2hFiMc5pzjH92c0VzgY2EcElzdmCBlFVzg1GBc65zY4OBboeBcHiBeYJ4ewxzfHx5lIRzlEmEnLKEbk1zfJ6PhmN8eYBljBiEnMOEiXxwezyUcIeBe76EdsKEeX2BdnR4jGWUrXWMjGd7fkl+j4WRlEGMa5Jzho+BhDyEfnqMeXt+g3aHlE1jczClhNN7ZW18eHx8hGFjZW18iXWMjKJjhH57gYuMcIuGWjyMe4ZtjJuExmmMj4WRdntzi4GDhFFzYIRdnGGcjJp7Y0F7e4WEkbCGiX57fnSHa657a6prhBCMe3Z+SmmMjH92eHJ2hK6EY1FzexhrvbKMnI5za4OEfnd+eXuMhImBe897hLaMjN+EfG+BeIOBhF1+eZeJi4GDkXZ2eXKEgZ6Ejpd4c2GHa1V5e5KUfqZuhCx7jKp7lLZrg11+hHx2hFWUoot2nI5zgbh5mo9zvZaUe3qRbqKMfqZ2kbCGhFiM"),(e=>e.charCodeAt(0))),t=new N.R;t.wrapMode=O.pF.CLAMP_TO_EDGE,t.pixelFormat=O.Ab.RGB,t.wrapMode=O.pF.REPEAT,t.hasMipmap=!0,t.width=32,t.height=32,this._passParameters.noiseTexture=new C.g(this.renderingContext,t,e),this.techniques.precompile(R),this.techniques.precompile(b),this.addHandles((0,l.watch)((()=>this.isEnabled()),(()=>this._enableTime=(0,c.l5)(0))))}destroy(){this._passParameters.noiseTexture=(0,o.WD)(this._passParameters.noiseTexture)}render(e){const t=this.bindParameters,r=e.find((({name:e})=>"normals"===e)),n=r?.getTexture(),i=r?.getTexture(O.nI),s=this.fboCache,o=t.camera,l=o.fullViewport[2],u=o.fullViewport[3],d=Math.round(l/L),m=Math.round(u/L),_=this.techniques.acquire(R),y=this.techniques.acquire(b);if(!_.compiled||!y.compiled)return this._enableTime=(0,c.l5)(performance.now()),this.requestRender(M.C7.UPDATE),_.release(),y.release(),s.acquire(d,m,f.OG.SSAO,p.N.RED);0===this._enableTime&&(this._enableTime=(0,c.l5)(performance.now()));const v=this.renderingContext,T=this.view.qualitySettings.fadeDuration,S=o.relativeElevation,A=(0,a.qE)((g.b-S)/(g.b-g.O),0,1),E=T>0?Math.min(T,performance.now()-this._enableTime)/T:1,w=E*A;this._passParameters.normalTexture=n,this._passParameters.depthTexture=i,this._passParameters.projScale=1/o.computeScreenPixelSizeAtDist(1),this._passParameters.intensity=4*D/(0,x.g)(o)**6*w;const I=s.acquire(l,u,"ssao input",p.N.RG);v.bindFramebuffer(I.fbo),v.setViewport(0,0,l,u),v.bindTechnique(_,t,this._passParameters,this._drawParameters),v.screen.draw(),_.release();const C=s.acquire(d,m,"ssao blur",p.N.RED);v.bindFramebuffer(C.fbo),this._drawParameters.colorTexture=I.getTexture(),(0,h.hZ)(this._drawParameters.blurSize,0,L/u),v.bindTechnique(y,t,this._passParameters,this._drawParameters),v.setViewport(0,0,d,m),v.screen.draw(),I.release();const N=s.acquire(d,m,f.OG.SSAO,p.N.RED);return v.bindFramebuffer(N.fbo),v.setViewport(0,0,l,u),v.setClearColor(1,1,1,0),v.clear(O.NV.COLOR),this._drawParameters.colorTexture=C.getTexture(),(0,h.hZ)(this._drawParameters.blurSize,L/l,0),v.bindTechnique(y,t,this._passParameters,this._drawParameters),v.setViewport(0,0,d,m),v.screen.draw(),y.release(),v.setViewport4fv(o.fullViewport),C.release(),E<1&&this.requestRender(M.C7.UPDATE),N}};(0,s._)([(0,u.MZ)()],F.prototype,"consumes",void 0),(0,s._)([(0,u.MZ)()],F.prototype,"produces",void 0),(0,s._)([(0,u.MZ)({constructOnly:!0})],F.prototype,"techniques",void 0),(0,s._)([(0,u.MZ)({constructOnly:!0})],F.prototype,"isEnabled",void 0),F=(0,s._)([(0,d.$)("esri.views.3d.webgl-engine.effects.ssao.SSAO")],F);const D=.5;function P(e,t){const r=e.fragment;t.receiveAmbientOcclusion?(r.uniforms.add(new i.N("ssaoTex",((e,t)=>t.ssao?.getTexture()))),r.constants.add("blurSizePixelsInverse","float",1/L),r.code.add(n.H`float evaluateAmbientOcclusionInverse() {
vec2 ssaoTextureSizeInverse = 1.0 / vec2(textureSize(ssaoTex, 0));
return texture(ssaoTex, gl_FragCoord.xy * blurSizePixelsInverse * ssaoTextureSizeInverse).r;
}
float evaluateAmbientOcclusion() {
return 1.0 - evaluateAmbientOcclusionInverse();
}`)):r.code.add(n.H`float evaluateAmbientOcclusionInverse() { return 1.0; }
float evaluateAmbientOcclusion() { return 0.0; }`)}},97910:function(e,t,r){r.d(t,{a8:function(){return p},eU:function(){return m},kA:function(){return g}});var n=r(82547),i=r(46042),s=r(32488),a=r(42426),o=r(51942),l=r(11520),c=r(61629),u=r(45937),d=r(14543),h=r(39506),f=r(95629);function p(e){e.constants.add("ambientBoostFactor","float",f.uH)}function m(e){e.uniforms.add(new d.m("lightingGlobalFactor",((e,t)=>t.lighting.globalFactor)))}function g(e,t){const r=e.fragment;switch(e.include(s.n,t),t.pbrMode!==l.A9.Disabled&&e.include(o.c,t),e.include(i.W,t),e.include(c.p),r.code.add(h.H`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${t.pbrMode===l.A9.Disabled?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);"}
  `),p(r),m(r),(0,a.Gc)(r),r.code.add(h.H`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${t.spherical?h.H`normalize(vPosWorld)`:h.H`vec3(0.0, 0.0, 1.0)`}, mainLightDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),(0,a.O4)(r),r.code.add(h.H`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * mainLightIntensity;
}`),t.pbrMode){case l.A9.Disabled:case l.A9.WaterOnIntegratedMesh:case l.A9.Water:e.include(a.Vt),r.code.add(h.H`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight) {
vec3 mainLighting = applyShading(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);break;case l.A9.Normal:case l.A9.Schematic:r.code.add(h.H`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec4 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),r.code.add(h.H`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),t.useFillLights?r.uniforms.add(new u.e("hasFillLights",((e,t)=>t.enableFillLights))):r.constants.add("hasFillLights","bool",!1),r.code.add(h.H`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0) ? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
float NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
vec3 mainLightIrradianceComponent = NdotL * (1.0 - shadow) * mainLightIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * mainLightIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),r.uniforms.add(new d.m("lightingSpecularStrength",((e,t)=>t.lighting.mainLight.specularStrength)),new d.m("lightingEnvironmentStrength",((e,t)=>t.lighting.mainLight.environmentStrength))).code.add(h.H`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
float NdotH = clamp(dot(normal, h), 0.0, 1.0);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(NdotH, inputs.roughness) * mainLightIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * mainLightIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
float normalDirectionModifier = mix(1., min(mix(0.1, 2.0, (inputs.NdotNG + 1.) * 0.5), 1.0), clamp(inputs.roughness * 5.0, 0.0 , 1.0));
inputs.skyRadianceToSurface = (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.groundRadianceToSurface = 0.5 * GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),r.code.add(h.H`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = _emission.rgb == vec3(0.0) ? _emission.rgb : pow(_emission.rgb, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${t.pbrMode!==l.A9.Schematic||t.hasColorTexture?h.H`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`:h.H`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `);break;case l.A9.Simplified:case l.A9.TerrainWithWater:(0,a.Gc)(r),(0,a.O4)(r),r.code.add(h.H`const float roughnessTerrain = 0.5;
const float specularityTerrain = 0.5;
const vec3 fresnelReflectionTerrain = vec3(0.04);
vec3 evaluatePBRSimplifiedLighting(vec3 n, vec3 c, float shadow, float ssao, vec3 al, vec3 vd, vec3 nup) {
vec3 viewDirection = -vd;
vec3 h = normalize(viewDirection + mainLightDirection);
float NdotL = clamp(dot(n, mainLightDirection), 0.001, 1.0);
float NdotV = clamp(abs(dot(n, viewDirection)), 0.001, 1.0);
float NdotH = clamp(dot(n, h), 0.0, 1.0);
float NdotNG = clamp(dot(n, nup), -1.0, 1.0);
vec3 albedoLinear = pow(c, vec3(GAMMA_SRGB));
float lightness = 0.3 * albedoLinear[0] + 0.5 * albedoLinear[1] + 0.2 * albedoLinear[2];
vec3 f0 = (0.85 * lightness + 0.15) * fresnelReflectionTerrain;
vec3 f90 =  vec3(clamp(dot(f0, vec3(50.0 * 0.33)), 0.0, 1.0));
vec3 mainLightIrradianceComponent = (1. - shadow) * NdotL * mainLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(n, ssao) + al;
vec3 ambientSky = ambientLightIrradianceComponent + mainLightIrradianceComponent;
vec3 indirectDiffuse = ((1.0 - NdotNG) * mainLightIrradianceComponent + (1.0 + NdotNG ) * ambientSky) * 0.5;
vec3 outDiffColor = albedoLinear * (1.0 - f0) * indirectDiffuse / PI;
vec3 mainLightRadianceComponent = normalDistribution(NdotH, roughnessTerrain) * mainLightIntensity;
vec2 dfg = prefilteredDFGAnalytical(roughnessTerrain, NdotV);
vec3 specularColor = f0 * dfg.x + f90 * dfg.y;
vec3 specularComponent = specularityTerrain * specularColor * mainLightRadianceComponent;
vec3 outColorLinear = outDiffColor + specularComponent;
vec3 outColor = pow(outColorLinear, vec3(INV_GAMMA_SRGB));
return outColor;
}`);break;default:(0,n.Xb)(t.pbrMode);case l.A9.COUNT:}}},42426:function(e,t,r){r.d(t,{Gc:function(){return s},O4:function(){return a},Vt:function(){return o}});var n=r(82598),i=r(39506);function s(e){e.uniforms.add(new n.t("mainLightDirection",((e,t)=>t.lighting.mainLight.direction)))}function a(e){e.uniforms.add(new n.t("mainLightIntensity",((e,t)=>t.lighting.mainLight.intensity)))}function o(e){s(e.fragment),a(e.fragment),e.fragment.code.add(i.H`vec3 applyShading(vec3 shadingNormalWorld, float shadow) {
float dotVal = clamp(dot(shadingNormalWorld, mainLightDirection), 0.0, 1.0);
return mainLightIntensity * ((1.0 - shadow) * dotVal);
}`)}},50865:function(e,t,r){r.d(t,{W:function(){return n},r:function(){return o}});var n,i,s=r(82547),a=r(39506);function o(e,t){const r=e.fragment;switch(r.code.add(a.H`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),t.doubleSidedMode){case n.None:r.code.add(a.H`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case n.View:r.code.add(a.H`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case n.WindingOrder:r.code.add(a.H`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:(0,s.Xb)(t.doubleSidedMode);case n.COUNT:}}(i=n||(n={}))[i.None=0]="None",i[i.View=1]="View",i[i.WindingOrder=2]="WindingOrder",i[i.COUNT=3]="COUNT"},51942:function(e,t,r){r.d(t,{c:function(){return o},f:function(){return l}});var n=r(39506);function i(e){const t=e.fragment.code;t.add(n.H`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),t.add(n.H`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),t.add(n.H`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}var s=r(11520),a=r(61629);function o(e,t){const r=e.fragment.code;e.include(a.p),t.pbrMode!==s.A9.Normal&&t.pbrMode!==s.A9.Schematic&&t.pbrMode!==s.A9.Simplified&&t.pbrMode!==s.A9.TerrainWithWater||(r.add(n.H`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),r.add(n.H`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`)),t.pbrMode!==s.A9.Normal&&t.pbrMode!==s.A9.Schematic||(e.include(i),r.add(n.H`struct PBRShadingInfo
{
float NdotV;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),r.add(n.H`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),r.add(n.H`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),r.add(n.H`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}function l(e,t){const r=e.fragment.code;e.include(a.p),r.add(n.H`
  struct PBRShadingWater
  {
      float NdotL;   // cos angle between normal and light direction
      float NdotV;   // cos angle between normal and view direction
      float NdotH;   // cos angle between normal and half vector
      float VdotH;   // cos angle between view direction and half vector
      float LdotH;   // cos angle between light direction and half vector
      float VdotN;   // cos angle between view direction and normal vector
  };

  float dtrExponent = ${t.useCustomDTRExponentForWater?"2.2":"2.0"};
  `),r.add(n.H`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),r.add(n.H`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),r.add(n.H`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),r.add(n.H`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze) * strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}`)}},11520:function(e,t,r){r.d(t,{A9:function(){return n},_Z:function(){return f}});var n,i,s=r(28499),a=r(4435),o=r(82598),l=r(39506),c=r(40075),u=r(39838),d=r(54516),h=r(36634);function f(e,t){const r=t.pbrMode,i=e.fragment;if(r!==n.Schematic&&r!==n.Disabled&&r!==n.Normal)return void i.code.add(l.H`void applyPBRFactors() {}`);if(r===n.Disabled)return void i.code.add(l.H`void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`);if(r===n.Schematic)return void i.code.add(l.H`vec3 mrr = vec3(0.0, 0.6, 0.2);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`);const{hasMetallicRoughnessTexture:h,hasMetallicRoughnessTextureTransform:f,hasOcclusionTexture:p,hasOcclusionTextureTransform:m,bindType:g}=t;(h||p)&&e.include(s.r,t),i.code.add(l.H`vec3 mrr;
float occlusion;`),h&&i.uniforms.add(g===d.c.Pass?new u.N("texMetallicRoughness",(e=>e.textureMetallicRoughness)):new c.o("texMetallicRoughness",(e=>e.textureMetallicRoughness))),p&&i.uniforms.add(g===d.c.Pass?new u.N("texOcclusion",(e=>e.textureOcclusion)):new c.o("texOcclusion",(e=>e.textureOcclusion))),i.uniforms.add(g===d.c.Pass?new o.t("mrrFactors",(e=>e.mrrFactors)):new a.W("mrrFactors",(e=>e.mrrFactors))),i.code.add(l.H`
    ${(0,l.If)(h,l.H`void applyMetallicRoughness(vec2 uv) {
            vec3 metallicRoughness = textureLookup(texMetallicRoughness, uv).rgb;
            mrr[0] *= metallicRoughness.b;
            mrr[1] *= metallicRoughness.g;
          }`)}

    ${(0,l.If)(p,"void applyOcclusion(vec2 uv) { occlusion *= textureLookup(texOcclusion, uv).r; }")}

    float getBakedOcclusion() {
      return ${p?"occlusion":"1.0"};
    }

    void applyPBRFactors() {
      mrr = mrrFactors;
      occlusion = 1.0;

      ${(0,l.If)(h,`applyMetallicRoughness(${f?"metallicRoughnessUV":"vuv0"});`)}
      ${(0,l.If)(p,`applyOcclusion(${m?"occlusionUV":"vuv0"});`)}
    }
  `)}r(27539),(i=n||(n={}))[i.Disabled=0]="Disabled",i[i.Normal=1]="Normal",i[i.Schematic=2]="Schematic",i[i.Water=3]="Water",i[i.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",i[i.Simplified=5]="Simplified",i[i.TerrainWithWater=6]="TerrainWithWater",i[i.COUNT=7]="COUNT",h.NV},61629:function(e,t,r){function n(e){const t=3.141592653589793,r=.3183098861837907;e.vertex.constants.add("PI","float",t),e.fragment.constants.add("PI","float",t),e.fragment.constants.add("LIGHT_NORMALIZATION","float",r),e.fragment.constants.add("INV_PI","float",r),e.fragment.constants.add("HALF_PI","float",1.570796326794897),e.fragment.constants.add("TWO_PI","float",6.28318530717958)}r.d(t,{p:function(){return n}})},56574:function(e,t,r){r.d(t,{Bz:function(){return f},G:function(){return h}}),r(39714),r(32501);var n=r(47483),i=r(38917),s=r(50295),a=r(39506),o=r(65312),l=r(54516);class c extends o.n{constructor(e,t,r){super(e,"mat4",l.c.Draw,((r,n,i,s)=>r.setUniformMatrix4fv(e,t(n,i,s))),r)}}class u extends o.n{constructor(e,t,r){super(e,"mat4",l.c.Pass,((r,n,i)=>r.setUniformMatrix4fv(e,t(n,i))),r)}}var d=r(39838);function h(e,t){t.receiveShadows&&(e.fragment.uniforms.add(new u("shadowMapMatrix",((e,t)=>t.shadowMap.getShadowMapMatrices(e.origin)),4)),p(e))}function f(e,t){t.receiveShadows&&(e.fragment.uniforms.add(new c("shadowMapMatrix",((e,t)=>t.shadowMap.getShadowMapMatrices(e.origin)),4)),p(e))}function p(e){const t=e.fragment;t.include(n.U),t.uniforms.add(new d.N("shadowMap",((e,t)=>t.shadowMap.depthTexture)),new s.c("numCascades",((e,t)=>t.shadowMap.numCascades)),new i.E("cascadeDistances",((e,t)=>t.shadowMap.cascadeDistances))).code.add(a.H`int chooseCascade(float depth, out mat4 mat) {
vec4 distance = cascadeDistances;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, ivec2 textureSize, vec3 lvpos) {
float xScale = float(textureSize.y) / float(textureSize.x);
return vec2((float(i) + lvpos.x) * xScale, lvpos.y);
}
float readShadowMapDepth(ivec2 uv, sampler2D _depthTex) {
return rgba4ToFloat(texelFetch(_depthTex, uv, 0));
}
float posIsInShadow(ivec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, ivec2 texSize, sampler2D _depthTex) {
vec2 st = fract(uv * vec2(texSize) + vec2(0.5));
ivec2 base = ivec2(uv * vec2(texSize) - vec2(0.5));
float s00 = posIsInShadow(ivec2(base.x, base.y), lvpos, _depthTex);
float s10 = posIsInShadow(ivec2(base.x + 1, base.y), lvpos, _depthTex);
float s11 = posIsInShadow(ivec2(base.x + 1, base.y + 1), lvpos, _depthTex);
float s01 = posIsInShadow(ivec2(base.x, base.y + 1), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= numCascades) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
ivec2 size = textureSize(shadowMap, 0);
vec2 uv = cascadeCoordinates(i, size, lvpos);
return filterShadow(uv, lvpos, size, shadowMap);
}`)}a.Y,a.Y},3088:function(e,t,r){r.d(t,{O:function(){return n},b:function(){return i}});const n=3e5,i=5e5},77771:function(e,t,r){r.d(t,{Z:function(){return a}});var n=r(23397),i=r(39506),s=r(39838);function a(e,{occlusionPass:t,terrainDepthTest:r,cullAboveTerrain:a}){r?(e.fragment.include(n.E),e.fragment.uniforms.add(new s.N("terrainDepthTexture",((e,t)=>t.terrainDepth?.attachment))).code.add(i.H`
   ${t?"bool":"void"} terrainDepthTest(float fragmentDepth) {
      float depth = texelFetch(terrainDepthTexture, ivec2(gl_FragCoord.xy), 0).r;
      float linearDepth = linearizeDepth(depth);
      ${t?i.H`return fragmentDepth < linearDepth && depth < 1.0;`:i.H`if(fragmentDepth ${a?">":"<="} linearDepth) discard;`}
    }`)):t?e.fragment.code.add(i.H`#define terrainDepthTest(fragmentDepth) false`):e.fragment.code.add(i.H`#define terrainDepthTest(fragmentDepth) {}`)}},86207:function(e,t,r){r.d(t,{MU:function(){return c},O1:function(){return u},QM:function(){return d},Sx:function(){return l},q2:function(){return o}});var n=r(87725),i=r(2457),s=r(39506),a=r(78567);function o(e,t){t.hasColorTextureTransform?(e.varyings.add("colorUV","vec2"),e.vertex.uniforms.add(new a.k("colorTextureTransformMatrix",(e=>e.colorTextureTransformMatrix??n.zK))).code.add(s.H`void forwardColorUV(){
colorUV = (colorTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):e.vertex.code.add(s.H`void forwardColorUV(){}`)}function l(e,t){t.hasNormalTextureTransform&&t.textureCoordinateType!==i.I.None?(e.varyings.add("normalUV","vec2"),e.vertex.uniforms.add(new a.k("normalTextureTransformMatrix",(e=>e.normalTextureTransformMatrix??n.zK))).code.add(s.H`void forwardNormalUV(){
normalUV = (normalTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):e.vertex.code.add(s.H`void forwardNormalUV(){}`)}function c(e,t){t.hasEmissionTextureTransform&&t.textureCoordinateType!==i.I.None?(e.varyings.add("emissiveUV","vec2"),e.vertex.uniforms.add(new a.k("emissiveTextureTransformMatrix",(e=>e.emissiveTextureTransformMatrix??n.zK))).code.add(s.H`void forwardEmissiveUV(){
emissiveUV = (emissiveTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):e.vertex.code.add(s.H`void forwardEmissiveUV(){}`)}function u(e,t){t.hasOcclusionTextureTransform&&t.textureCoordinateType!==i.I.None?(e.varyings.add("occlusionUV","vec2"),e.vertex.uniforms.add(new a.k("occlusionTextureTransformMatrix",(e=>e.occlusionTextureTransformMatrix??n.zK))).code.add(s.H`void forwardOcclusionUV(){
occlusionUV = (occlusionTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):e.vertex.code.add(s.H`void forwardOcclusionUV(){}`)}function d(e,t){t.hasMetallicRoughnessTextureTransform&&t.textureCoordinateType!==i.I.None?(e.varyings.add("metallicRoughnessUV","vec2"),e.vertex.uniforms.add(new a.k("metallicRoughnessTextureTransformMatrix",(e=>e.metallicRoughnessTextureTransformMatrix??n.zK))).code.add(s.H`void forwardMetallicRoughnessUV(){
metallicRoughnessUV = (metallicRoughnessTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):e.vertex.code.add(s.H`void forwardMetallicRoughnessUV(){}`)}},58766:function(e,t,r){r.d(t,{A:function(){return u}});var n=r(82598),i=r(30636),s=r(454),a=r(39506),o=r(78567),l=r(65839),c=r(77971);function u(e,t){const{vertex:r,attributes:u}=e;t.hasVvInstancing&&(t.vvSize||t.vvColor)&&u.add(l.r.INSTANCEFEATUREATTRIBUTE,"vec4"),t.vvSize?(r.uniforms.add(new n.t("vvSizeMinSize",(e=>e.vvSize.minSize))),r.uniforms.add(new n.t("vvSizeMaxSize",(e=>e.vvSize.maxSize))),r.uniforms.add(new n.t("vvSizeOffset",(e=>e.vvSize.offset))),r.uniforms.add(new n.t("vvSizeFactor",(e=>e.vvSize.factor))),r.uniforms.add(new o.k("vvSymbolRotationMatrix",(e=>e.vvSymbolRotationMatrix))),r.uniforms.add(new n.t("vvSymbolAnchor",(e=>e.vvSymbolAnchor))),r.code.add(a.H`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),r.code.add(a.H`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${t.hasVvInstancing?a.H`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):r.code.add(a.H`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),t.vvColor?(r.constants.add("vvColorNumber","int",c.p),r.uniforms.add(new s.x("vvColorValues",(e=>e.vvColor.values),c.p),new i.F("vvColorColors",(e=>e.vvColor.colors),c.p)),r.code.add(a.H`
      vec4 interpolateVVColor(float value) {
        if (value <= vvColorValues[0]) {
          return vvColorColors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (vvColorValues[i] >= value) {
            float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
            return mix(vvColorColors[i-1], vvColorColors[i], f);
          }
        }
        return vvColorColors[vvColorNumber - 1];
      }

      vec4 vvGetColor(vec4 featureAttribute) {
        return interpolateVVColor(featureAttribute.y);
      }

      ${t.hasVvInstancing?a.H`
            vec4 vvColor() {
              return vvGetColor(instanceFeatureAttribute);
            }`:"vec4 vvColor() { return vec4(1.0); }"}
    `)):r.code.add(a.H`vec4 vvColor() { return vec4(1.0); }`)}},28686:function(e,t,r){r.d(t,{Q:function(){return n}});const n=1/255.5},82316:function(e,t,r){r.d(t,{Ir:function(){return u}});var n=r(13786),i=r(1932),s=r(33400),a=r(41546),o=r(11687),l=r(38917),c=r(39506);function u(e){e.fragment.uniforms.add(new l.E("projInfo",((e,t)=>function(e){const t=e.projectionMatrix;return 0===t[11]?(0,s.s)(d,2/(e.fullWidth*t[0]),2/(e.fullHeight*t[5]),(1+t[12])/t[0],(1+t[13])/t[5]):(0,s.s)(d,-2/(e.fullWidth*t[0]),-2/(e.fullHeight*t[5]),(1-t[8])/t[0],(1-t[9])/t[5])}(t.camera)))),e.fragment.uniforms.add(new o.G("zScale",((e,t)=>function(e){return 0===e.projectionMatrix[11]?(0,n.hZ)(h,0,1):(0,n.hZ)(h,1,0)}(t.camera)))),e.fragment.code.add(c.H`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}const d=(0,a.vt)(),h=(0,i.vt)()},23864:function(e,t,r){r.d(t,{a:function(){return i}});var n=r(39506);function i(e){e.code.add(n.H`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}},19462:function(e,t,r){r.d(t,{S:function(){return l}});var n=r(28686),i=r(65312);r(54516),i.n;var s=r(14543),a=r(39506),o=r(54407);function l(e,t){!function(e,t,r){const i=e.fragment;switch(t.alphaDiscardMode){case o.sf.Blend:e.fragment.code.add(a.H`
        #define discardOrAdjustAlpha(color) { if (color.a < ${a.H.float(n.Q)}) { discard; } }
      `);break;case o.sf.Opaque:i.code.add(a.H`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case o.sf.Mask:i.uniforms.add(r).code.add(a.H`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case o.sf.MaskBlend:i.uniforms.add(r).code.add(a.H`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}(e,t,new s.m("textureAlphaCutoff",(e=>e.textureAlphaCutoff)))}},90576:function(e,t,r){r.d(t,{u:function(){return i}});var n=r(39506);function i({code:e},t){t.doublePrecisionRequiresObfuscation?e.add(n.H`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):e.add(n.H`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}},54613:function(e,t,r){r.d(t,{N:function(){return a}});var n=r(9933),i=r(23864),s=r(39506);function a(e){e.include(i.a),e.code.add(s.H`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in macOS using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${s.H.int(n.k5.Multiply)}) {
        return allMixed;
      }
      if (mode == ${s.H.int(n.k5.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${s.H.int(n.k5.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in macOS using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${s.H.int(n.k5.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${s.H.int(n.k5.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)}},47483:function(e,t,r){r.d(t,{U:function(){return i}});var n=r(39506);function i(e){e.code.add(n.H`const float MAX_RGBA4_FLOAT =
15.0 / 16.0 +
15.0 / 16.0 / 16.0 +
15.0 / 16.0 / 16.0 / 16.0 +
15.0 / 16.0 / 16.0 / 16.0 / 16.0;
const vec4 FIXED_POINT_FACTORS_RGBA4 = vec4(1.0, 16.0, 16.0 * 16.0, 16.0 * 16.0 * 16.0);
vec4 floatToRgba4(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA4_FLOAT);
vec4 fixedPointU4 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS_RGBA4) * 16.0);
const float toU4AsFloat = 1.0 / 15.0;
return fixedPointU4 * toU4AsFloat;
}
const vec4 RGBA4_2_FLOAT_FACTORS = vec4(
15.0 / (16.0),
15.0 / (16.0 * 16.0),
15.0 / (16.0 * 16.0 * 16.0),
15.0 / (16.0 * 16.0 * 16.0 * 16.0)
);
float rgba4ToFloat(vec4 rgba) {
return dot(rgba, RGBA4_2_FLOAT_FACTORS);
}`)}},52766:function(e,t,r){r.d(t,{W:function(){return i}});var n=r(39506);function i(e){e.code.add(n.H`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}`),e.code.add(n.H`const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`),e.code.add(n.H`const vec4 uninterpolatedRGBAToFloatFactors = vec4(
1.0 / 256.0,
1.0 / 256.0 / 256.0,
1.0 / 256.0 / 256.0 / 256.0,
1.0 / 256.0 / 256.0 / 256.0 / 256.0
);
float uninterpolatedRGBAToFloat(vec4 rgba) {
return (dot(round(rgba * 255.0), uninterpolatedRGBAToFloatFactors) - 0.5) * 2.0;
}`)}},19202:function(e,t,r){r.d(t,{OH:function(){return c},Y6:function(){return o},pM:function(){return l}});var n=r(20551),i=r(32501),s=r(82598),a=r(39506);function o(e){e.vertex.code.add(a.H`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),e.vertex.code.add(a.H`vec3 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec3 params) {
return vec3(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z
);
}`),e.vertex.code.add(a.H`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),e.vertex.code.add(a.H`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),e.vertex.code.add(a.H`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),e.vertex.code.add(a.H`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function l(e){e.uniforms.add(new s.t("screenSizePerspective",(e=>u(e.screenSizePerspective))))}function c(e){e.uniforms.add(new s.t("screenSizePerspectiveAlignment",(e=>u(e.screenSizePerspectiveAlignment||e.screenSizePerspective))))}function u(e){return(0,n.i)(d,e.parameters.divisor,e.parameters.offset,e.minScaleFactor)}const d=(0,i.vt)()},20830:function(e,t,r){r.d(t,{yu:function(){return p},Nz:function(){return v},NB:function(){return m},S7:function(){return y}});var n=r(73364),i=r(39714),s=r(20551),a=r(32501),o=r(4435),l=r(82598),c=r(14543),u=r(65312),d=r(54516);class h extends u.n{constructor(e,t){super(e,"mat4",d.c.Draw,((r,n,i)=>r.setUniformMatrix4fv(e,t(n,i))))}}var f=r(70340);function p(e,t){t.instancedDoublePrecision?e.constants.add("cameraPosition","vec3",a.uY):e.uniforms.add(new o.W("cameraPosition",((e,t)=>(0,s.i)(_,t.camera.viewInverseTransposeMatrix[3]-e.origin[0],t.camera.viewInverseTransposeMatrix[7]-e.origin[1],t.camera.viewInverseTransposeMatrix[11]-e.origin[2]))))}function m(e,t){if(!t.instancedDoublePrecision)return void e.uniforms.add(new f.X("proj",((e,t)=>t.camera.projectionMatrix)),new h("view",((e,t)=>(0,n.Tl)(g,t.camera.viewMatrix,e.origin))),new o.W("localOrigin",(e=>e.origin)));const r=e=>(0,s.i)(_,e.camera.viewInverseTransposeMatrix[3],e.camera.viewInverseTransposeMatrix[7],e.camera.viewInverseTransposeMatrix[11]);e.uniforms.add(new f.X("proj",((e,t)=>t.camera.projectionMatrix)),new f.X("view",((e,t)=>(0,n.Tl)(g,t.camera.viewMatrix,r(t)))),new l.t("localOrigin",((e,t)=>r(t))))}const g=(0,i.vt)(),_=(0,a.vt)();function y(e){e.uniforms.add(new f.X("viewNormal",((e,t)=>t.camera.viewInverseTransposeMatrix)))}function v(e){e.uniforms.add(new c.m("pixelRatio",((e,t)=>t.camera.pixelRatio/t.overlayStretch)))}},45937:function(e,t,r){r.d(t,{e:function(){return s}});var n=r(65312),i=r(54516);class s extends n.n{constructor(e,t){super(e,"bool",i.c.Pass,((r,n,i)=>r.setUniform1b(e,t(n,i))))}}},30262:function(e,t,r){r.d(t,{t:function(){return s}});var n=r(65312),i=r(54516);class s extends n.n{constructor(e,t){super(e,"vec2",i.c.Draw,((r,n,i,s)=>r.setUniform2fv(e,t(n,i,s))))}}},11687:function(e,t,r){r.d(t,{G:function(){return s}});var n=r(65312),i=r(54516);class s extends n.n{constructor(e,t){super(e,"vec2",i.c.Pass,((r,n,i)=>r.setUniform2fv(e,t(n,i))))}}},4435:function(e,t,r){r.d(t,{W:function(){return s}});var n=r(65312),i=r(54516);class s extends n.n{constructor(e,t){super(e,"vec3",i.c.Draw,((r,n,i,s)=>r.setUniform3fv(e,t(n,i,s))))}}},82598:function(e,t,r){r.d(t,{t:function(){return s}});var n=r(65312),i=r(54516);class s extends n.n{constructor(e,t){super(e,"vec3",i.c.Pass,((r,n,i)=>r.setUniform3fv(e,t(n,i))))}}},41356:function(e,t,r){r.d(t,{V:function(){return s}});var n=r(65312),i=r(54516);class s extends n.n{constructor(e,t){super(e,"vec4",i.c.Draw,((r,n,i)=>r.setUniform4fv(e,t(n,i))))}}},38917:function(e,t,r){r.d(t,{E:function(){return s}});var n=r(65312),i=r(54516);class s extends n.n{constructor(e,t){super(e,"vec4",i.c.Pass,((r,n,i)=>r.setUniform4fv(e,t(n,i))))}}},30636:function(e,t,r){r.d(t,{F:function(){return s}});var n=r(65312),i=r(54516);class s extends n.n{constructor(e,t,r){super(e,"vec4",i.c.Pass,((r,n,i)=>r.setUniform4fv(e,t(n,i))),r)}}},14543:function(e,t,r){r.d(t,{m:function(){return s}});var n=r(65312),i=r(54516);class s extends n.n{constructor(e,t){super(e,"float",i.c.Pass,((r,n,i)=>r.setUniform1f(e,t(n,i))))}}},454:function(e,t,r){r.d(t,{x:function(){return s}});var n=r(65312),i=r(54516);class s extends n.n{constructor(e,t,r){super(e,"float",i.c.Pass,((r,n,i)=>r.setUniform1fv(e,t(n,i))),r)}}},12511:function(e,t,r){r.d(t,{g:function(){return s}});var n=r(65312),i=r(54516);class s extends n.n{constructor(e,t){super(e,"ivec2",i.c.Pass,((r,n,i)=>r.setUniform2iv(e,t(n,i))))}}},50295:function(e,t,r){r.d(t,{c:function(){return s}});var n=r(65312),i=r(54516);class s extends n.n{constructor(e,t){super(e,"int",i.c.Pass,((r,n,i)=>r.setUniform1i(e,t(n,i))))}}},31190:function(e,t,r){r.d(t,{h:function(){return s}});var n=r(65312),i=r(54516);class s extends n.n{constructor(e,t){super(e,"mat3",i.c.Draw,((r,n,i)=>r.setUniformMatrix3fv(e,t(n,i))))}}},78567:function(e,t,r){r.d(t,{k:function(){return s}});var n=r(65312),i=r(54516);class s extends n.n{constructor(e,t){super(e,"mat3",i.c.Pass,((r,n,i)=>r.setUniformMatrix3fv(e,t(n,i))))}}},70340:function(e,t,r){r.d(t,{X:function(){return s}});var n=r(65312),i=r(54516);class s extends n.n{constructor(e,t){super(e,"mat4",i.c.Pass,((r,n,i)=>r.setUniformMatrix4fv(e,t(n,i))))}}},62988:function(e,t,r){r.d(t,{N5:function(){return l}});var n=r(39819),i=(r(58941),r(40633)),s=r(54516),a=r(90553);class o{constructor(){this._includedModules=new Map}include(e,t){this._includedModules.has(e)?this._includedModules.get(e):(this._includedModules.set(e,t),e(this.builder,t))}}class l extends o{constructor(){super(...arguments),this.vertex=new h,this.fragment=new h,this.attributes=new f,this.varyings=new p,this.extensions=new m,this.outputs=new g}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(e){const t=this.extensions.generateSource(e),r=this.attributes.generateSource(e),n=this.varyings.generateSource(e),i="vertex"===e?this.vertex:this.fragment,s=i.uniforms.generateSource(),a=i.code.generateSource(),o=i.main.generateSource(),l="vertex"===e?v:y,c=i.constants.generateSource(),u=this.outputs.generateSource(e);return`#version 300 es\n${t.join("\n")}\n\n${l}\n\n${c.join("\n")}\n\n${s.join("\n")}\n\n${r.join("\n")}\n\n${n.join("\n")}\n\n${u.join("\n")}\n\n${a.join("\n")}\n\n${o.join("\n")}`}generateBindPass(e){const t=new Map;this.vertex.uniforms.entries.forEach((e=>{const r=e.bind[s.c.Pass];r&&t.set(e.name,r)})),this.fragment.uniforms.entries.forEach((e=>{const r=e.bind[s.c.Pass];r&&t.set(e.name,r)}));const r=Array.from(t.values()),n=r.length;return(t,i)=>{for(let s=0;s<n;++s)r[s](e,t,i)}}generateBindDraw(e){const t=new Map;this.vertex.uniforms.entries.forEach((e=>{const r=e.bind[s.c.Draw];r&&t.set(e.name,r)})),this.fragment.uniforms.entries.forEach((e=>{const r=e.bind[s.c.Draw];r&&t.set(e.name,r)}));const r=Array.from(t.values()),n=r.length;return(t,i,s)=>{for(let a=0;a<n;++a)r[a](e,s,t,i)}}}class c{constructor(e){this._stage=e,this._entries=new Map}add(...e){for(const t of e)this._add(t);return this._stage}get(e){return this._entries.get(e)}_add(e){if(null!=e){if(this._entries.has(e.name)&&!this._entries.get(e.name).equals(e))throw new n.A(`Duplicate uniform name ${e.name} for different uniform type`);this._entries.set(e.name,e)}else i.A.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder").error(`Trying to add null Uniform from ${(new Error).stack}.`)}generateSource(){return Array.from(this._entries.values()).map((e=>null!=e.arraySize?`uniform ${e.type} ${e.name}[${e.arraySize}];`:`uniform ${e.type} ${e.name};`))}get entries(){return Array.from(this._entries.values())}}class u{constructor(e){this._stage=e,this._bodies=new Array}add(e){return this._bodies.push(e),this._stage}generateSource(){if(this._bodies.length>0)return[`void main() {\n ${this._bodies.join("\n")||""} \n}`];throw new n.A("Shader does not contain main function body.")}}class d{constructor(e){this._stage=e,this._entries=new Array}add(e){return this._entries.push(e),this._stage}generateSource(){return this._entries}}class h extends o{constructor(){super(...arguments),this.uniforms=new c(this),this.main=new u(this),this.code=new d(this),this.constants=new _(this)}get builder(){return this}}class f{constructor(){this._entries=new Array}add(e,t){this._entries.push([e,t])}generateSource(e){return"fragment"===e?[]:this._entries.map((e=>`in ${e[1]} ${e[0]};`))}}class p{constructor(){this._entries=new Map}add(e,t){this._entries.has(e)&&(0,a.vA)(this._entries.get(e)===t),this._entries.set(e,t)}generateSource(e){const t=new Array;return this._entries.forEach(((r,n)=>t.push("vertex"===e?`out ${r} ${n};`:`in ${r} ${n};`))),t}}class m{constructor(){this._entries=new Set}add(e){this._entries.add(e)}generateSource(e){const t="vertex"===e?m.ALLOWLIST_VERTEX:m.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter((e=>t.includes(e))).map((e=>`#extension ${e} : enable`))}}m.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],m.ALLOWLIST_VERTEX=[];class g{constructor(){this._entries=new Map}add(e,t,r=0){const n=this._entries.get(r);n?(0,a.vA)(n.name===e&&n.type===t,`Fragment shader output location ${r} occupied`):this._entries.set(r,{name:e,type:t})}generateSource(e){if("vertex"===e)return[];0===this._entries.size&&this._entries.set(0,{name:g.DEFAULT_NAME,type:g.DEFAULT_TYPE});const t=new Array;return this._entries.forEach(((e,r)=>t.push(`layout(location = ${r}) out ${e.type} ${e.name};`))),t}}g.DEFAULT_TYPE="vec4",g.DEFAULT_NAME="fragColor";class _{constructor(e){this._stage=e,this._entries=new Set}add(e,t,r){let n="ERROR_CONSTRUCTOR_STRING";switch(t){case"float":n=_._numberToFloatStr(r);break;case"int":n=_._numberToIntStr(r);break;case"bool":n=r.toString();break;case"vec2":n=`vec2(${_._numberToFloatStr(r[0])},                            ${_._numberToFloatStr(r[1])})`;break;case"vec3":n=`vec3(${_._numberToFloatStr(r[0])},                            ${_._numberToFloatStr(r[1])},                            ${_._numberToFloatStr(r[2])})`;break;case"vec4":n=`vec4(${_._numberToFloatStr(r[0])},                            ${_._numberToFloatStr(r[1])},                            ${_._numberToFloatStr(r[2])},                            ${_._numberToFloatStr(r[3])})`;break;case"ivec2":n=`ivec2(${_._numberToIntStr(r[0])},                             ${_._numberToIntStr(r[1])})`;break;case"ivec3":n=`ivec3(${_._numberToIntStr(r[0])},                             ${_._numberToIntStr(r[1])},                             ${_._numberToIntStr(r[2])})`;break;case"ivec4":n=`ivec4(${_._numberToIntStr(r[0])},                             ${_._numberToIntStr(r[1])},                             ${_._numberToIntStr(r[2])},                             ${_._numberToIntStr(r[3])})`;break;case"mat2":case"mat3":case"mat4":n=`${t}(${Array.prototype.map.call(r,(e=>_._numberToFloatStr(e))).join(", ")})`}return this._entries.add(`const ${t} ${e} = ${n};`),this._stage}static _numberToIntStr(e){return e.toFixed(0)}static _numberToFloatStr(e){return Number.isInteger(e)?e.toFixed(1):e.toString()}generateSource(){return Array.from(this._entries)}}const y="#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif",v="precision highp float;\nprecision highp sampler2D;"},40075:function(e,t,r){r.d(t,{o:function(){return s}});var n=r(65312),i=r(54516);class s extends n.n{constructor(e,t){super(e,"sampler2D",i.c.Draw,((r,n,i)=>r.bindTexture(e,t(n,i))))}}},39838:function(e,t,r){r.d(t,{N:function(){return s}});var n=r(65312),i=r(54516);class s extends n.n{constructor(e,t){super(e,"sampler2D",i.c.Pass,((r,n,i)=>r.bindTexture(e,t(n,i))))}}},65312:function(e,t,r){r.d(t,{n:function(){return i}});var n=r(54516);class i{constructor(e,t,r,i,s=null){if(this.name=e,this.type=t,this.arraySize=s,this.bind={[n.c.Pass]:null,[n.c.Draw]:null},i)switch(r){case n.c.Pass:this.bind[n.c.Pass]=i;break;case n.c.Draw:this.bind[n.c.Draw]=i}}equals(e){return this.type===e.type&&this.name===e.name&&this.arraySize===e.arraySize}}},39506:function(e,t,r){r.d(t,{H:function(){return i},If:function(){return s},Y:function(){return n}});const n=class{};function i(e,...t){let r="";for(let n=0;n<t.length;n++)r+=e[n]+t[n];return r+=e[e.length-1],r}function s(e,t,r=""){return e?t:r}var a;(a=i||(i={})).int=function(e){return Math.round(e).toString()},a.float=function(e){return e.toPrecision(8)}},54516:function(e,t,r){var n;r.d(t,{c:function(){return n}}),function(e){e[e.Pass=0]="Pass",e[e.Draw=1]="Draw"}(n||(n={}))},34615:function(e,t,r){r.d(t,{$:function(){return n}});class n{constructor(e,t){this._module=e,this._load=t}get(){return this._module}async reload(){return this._module=await this._load(),this._module}}},82273:function(e,t,r){r.d(t,{w:function(){return u}});var n=r(95929),i=r(40502),s=r(7187),a=r(41835);class o{constructor(e,t,r){this._context=e,this._locations=r,this._textures=new Map,this._freeTextureUnits=new s.A({deallocator:null}),this._glProgram=e.programCache.acquire(t.generate("vertex"),t.generate("fragment"),r),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bindPass=t.generateBindPass(this),this.bindDraw=t.generateBindDraw(this),this._fragmentUniforms=(0,a.en)()?t.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get hasTransformFeedbackVaryings(){return this._glProgram.hasTransformFeedbackVaryings}get compiled(){return this._glProgram.compiled}setUniform1b(e,t){this._glProgram.setUniform1i(e,t?1:0)}setUniform1i(e,t){this._glProgram.setUniform1i(e,t)}setUniform1f(e,t){this._glProgram.setUniform1f(e,t)}setUniform2fv(e,t){this._glProgram.setUniform2fv(e,t)}setUniform3fv(e,t){this._glProgram.setUniform3fv(e,t)}setUniform4fv(e,t){this._glProgram.setUniform4fv(e,t)}setUniformMatrix3fv(e,t){this._glProgram.setUniformMatrix3fv(e,t)}setUniformMatrix4fv(e,t){this._glProgram.setUniformMatrix4fv(e,t)}setUniform1fv(e,t){this._glProgram.setUniform1fv(e,t)}setUniform1iv(e,t){this._glProgram.setUniform1iv(e,t)}setUniform2iv(e,t){this._glProgram.setUniform2iv(e,t)}setUniform3iv(e,t){this._glProgram.setUniform3iv(e,t)}setUniform4iv(e,t){this._glProgram.setUniform4iv(e,t)}assertCompatibleVertexAttributeLocations(e){e.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(e,t){if(null==t?.glName){const t=this._textures.get(e);return t&&(this._context.bindTexture(null,t.unit),this._freeTextureUnit(t),this._textures.delete(e)),null}let r=this._textures.get(e);return null==r?(r=this._allocTextureUnit(t),this._textures.set(e,r)):r.texture=t,this._context.useProgram(this),this.setUniform1i(e,r.unit),this._context.bindTexture(t,r.unit),r.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach(((e,t)=>{this._context.bindTexture(e.texture,e.unit),this.setUniform1i(t,e.unit)})),this._fragmentUniforms?.forEach((e=>{"sampler2D"!==e.type&&"samplerCube"!==e.type||this._textures.has(e.name)||console.error(`Texture sampler ${e.name} has no bound texture`)}))}_allocTextureUnit(e){return{texture:e,unit:0===this._freeTextureUnits.length?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(e){this._freeTextureUnits.push(e.unit)}}var l=r(85456),c=r(57087);class u{constructor(e,t,r,s,a=i.D){this.release=s,this.locations=a,this.primitiveType=l.WR.TRIANGLES,this.key=t.key,this._program=new o(e.rctx,r.get().build(t),a),this._pipeline=this.initializePipeline(t),this.reload=async i=>{if(i&&await r.reload(),!this.key.equals(t.key))throw new Error("Configuration was changed after construction, cannot reload shader");(0,n.WD)(this._program),this._program=new o(e.rctx,r.get().build(t),a),this._pipeline=this.initializePipeline(t)}}destroy(){this._program=(0,n.WD)(this._program),this._pipeline=null}get program(){return this._program}get compiled(){return this.program.compiled}ensureAttributeLocations(e){this.program.assertCompatibleVertexAttributeLocations(e)}getPipeline(e,t){return this._pipeline}initializePipeline(e){return(0,c.Ey)({blending:c.Os,colorWrite:c.kn})}}},65875:function(e,t,r){r.d(t,{K:function(){return o},W:function(){return l}});var n=r(39819),i=r(39506),s=r(50659);class a{constructor(e){this._bits=[...e]}equals(e){return(0,s.aI)(this._bits,e.bits)}get code(){return this._code??=String.fromCharCode(...this._bits),this._code}get bits(){return this._bits}}class o extends i.Y{constructor(){super(),this._parameterBits=this._parameterBits?.map((()=>0))??[],this._parameterNames??=[]}get key(){return this._key??=new a(this._parameterBits),this._key}decode(e=this.key){const t=this._parameterBits;this._parameterBits=[...e.bits];const r=this._parameterNames.map((e=>`    ${e}: ${this[e]}`)).join("\n");return this._parameterBits=t,r}}function l(e={}){return(t,r)=>{t.hasOwnProperty("_parameterNames")||Object.defineProperty(t,"_parameterNames",{value:t._parameterNames?.slice()??[],configurable:!0,writable:!0}),t.hasOwnProperty("_parameterBits")||Object.defineProperty(t,"_parameterBits",{value:t._parameterBits?.slice()??[0],configurable:!0,writable:!0}),t._parameterNames.push(r);const i=e.count||2,s=Math.ceil(Math.log2(i)),a=t._parameterBits;let o=0;for(;a[o]+s>16;)o++,o>=a.length&&a.push(0);const l=a[o],c=(1<<s)-1<<l;a[o]+=s,e.count?Object.defineProperty(t,r,{get(){return(this._parameterBits[o]&c)>>l},set(t){if(this[r]!==t){if(this._key=null,this._parameterBits[o]=this._parameterBits[o]&~c|+t<<l&c,"number"!=typeof t)throw new n.A(`Configuration value for ${r} must be a number, got ${typeof t}`);if(null==e.count)throw new n.A(`Configuration value for ${r} must provide a count option`)}}}):Object.defineProperty(t,r,{get(){return!!((this._parameterBits[o]&c)>>l)},set(e){if(this[r]!==e&&(this._key=null,this._parameterBits[o]=this._parameterBits[o]&~c|+e<<l&c,"boolean"!=typeof e))throw new n.A(`Configuration value for ${r} must be boolean, got ${typeof e}`)}})}}},67521:function(e,t,r){r.d(t,{Cc:function(){return l},RW:function(){return o},VM:function(){return c}});var n=r(83525),i=r(27264);const s={required:[]};i.V.Depth;class a extends n.A{precompile(e){const t=this.acquireTechniques(e);return c(t),null!=t}consumes(){return s}get usedMemory(){return 0}get isDecoration(){return!1}get running(){return!1}modify(e){}get numGeometries(){return 0}get hasOccludees(){return!1}get hasEmissions(){return!1}forEachGeometry(e){}queryRenderOccludedState(e){return!1}}class o extends a{}class l extends a{}function c(e){Array.isArray(e)?e.forEach((e=>e?.release())):e?.release()}},39534:function(e,t,r){r.d(t,{E:function(){return i}});var n=r(58941);function i(){return!!(0,n.A)("enable-feature:objectAndLayerId-rendering")}},14905:function(e,t,r){r.d(t,{K:function(){return n},n:function(){return i}});class n{constructor(e,t,r=t){this.data=e,this.size=t,this.stride=r}}class i extends n{constructor(e,t,r,n=!1,i=r){super(e,r,i),this.indices=t,this.exclusive=n}}},89932:function(e,t,r){r.d(t,{S:function(){return i}});var n=r(24540);function i(e){if(e.length<n.y9)return Array.from(e);if((0,n.cy)(e))return Float64Array.from(e);if(!("BYTES_PER_ELEMENT"in e))return Array.from(e);switch(e.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(e);case 2:return(0,n.jq)(e)?Uint16Array.from(e):Int16Array.from(e);case 4:return Float32Array.from(e);default:return Float64Array.from(e)}}},53905:function(e,t,r){r.d(t,{j:function(){return o}});var n=r(7187),i=r(20551),s=r(32501),a=r(90553);class o{constructor(e,t,r){this.primitiveIndices=e,this._numIndexPerPrimitive=t,this.position=r,this._children=void 0,(0,a.vA)(e.length>=1),(0,a.vA)(3===r.size||4===r.size);const{data:n,size:o,indices:c}=r;(0,a.vA)(c.length%this._numIndexPerPrimitive==0),(0,a.vA)(c.length>=e.length*this._numIndexPerPrimitive);const u=e.length;let d=o*c[this._numIndexPerPrimitive*e[0]];l.clear(),l.push(d);const h=(0,s.fA)(n[d],n[d+1],n[d+2]),f=(0,s.o8)(h);for(let t=0;t<u;++t){const r=this._numIndexPerPrimitive*e[t];for(let e=0;e<this._numIndexPerPrimitive;++e){d=o*c[r+e],l.push(d);let t=n[d];h[0]=Math.min(t,h[0]),f[0]=Math.max(t,f[0]),t=n[d+1],h[1]=Math.min(t,h[1]),f[1]=Math.max(t,f[1]),t=n[d+2],h[2]=Math.min(t,h[2]),f[2]=Math.max(t,f[2])}}this.bbMin=h,this.bbMax=f;const p=(0,i.m)((0,s.vt)(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(f[0]-h[0],f[1]-h[1]),f[2]-h[2]);let m=this.radius*this.radius;for(let e=0;e<l.length;++e){d=l.at(e);const t=n[d]-p[0],r=n[d+1]-p[1],i=n[d+2]-p[2],s=t*t+r*r+i*i;if(s<=m)continue;const a=Math.sqrt(s),o=.5*(a-this.radius);this.radius=this.radius+o,m=this.radius*this.radius;const c=o/a;p[0]+=t*c,p[1]+=r*c,p[2]+=i*c}this.center=p,l.clear()}getChildren(){if(this._children||(0,i.s)(this.bbMin,this.bbMax)<=1)return this._children;const e=(0,i.m)((0,s.vt)(),this.bbMin,this.bbMax,.5),t=this.primitiveIndices.length,r=new Uint8Array(t),n=new Array(8);for(let e=0;e<8;++e)n[e]=0;const{data:a,size:l,indices:c}=this.position;for(let i=0;i<t;++i){let t=0;const s=this._numIndexPerPrimitive*this.primitiveIndices[i];let o=l*c[s],u=a[o],d=a[o+1],h=a[o+2];for(let e=1;e<this._numIndexPerPrimitive;++e){o=l*c[s+e];const t=a[o],r=a[o+1],n=a[o+2];t<u&&(u=t),r<d&&(d=r),n<h&&(h=n)}u<e[0]&&(t|=1),d<e[1]&&(t|=2),h<e[2]&&(t|=4),r[i]=t,++n[t]}let u=0;for(let e=0;e<8;++e)n[e]>0&&++u;if(u<2)return;const d=new Array(8);for(let e=0;e<8;++e)d[e]=n[e]>0?new Uint32Array(n[e]):void 0;for(let e=0;e<8;++e)n[e]=0;for(let e=0;e<t;++e){const t=r[e];d[t][n[t]++]=this.primitiveIndices[e]}this._children=new Array;for(let e=0;e<8;++e)void 0!==d[e]&&this._children.push(new o(d[e],this._numIndexPerPrimitive,this.position));return this._children}static prune(){l.prune()}}const l=new n.A({deallocator:null})},23545:function(e,t,r){r.d(t,{VR:function(){return i},a0:function(){return a}});var n=r(7187);class i{constructor(){this.adds=new n.A,this.removes=new n.A,this.updates=new n.A({allocator:e=>e||new s,deallocator:e=>(e.renderGeometry=null,e)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}get empty(){return 0===this.adds.length&&0===this.removes.length&&0===this.updates.length}}class s{}class a{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}}},48015:function(e,t,r){r.d(t,{J:function(){return i}});var n=r(11231);class i{constructor(){this.id=(0,n.c)()}}},40359:function(e,t,r){var n;r.d(t,{X:function(){return n}}),function(e){e[e.Layer=0]="Layer",e[e.Object=1]="Object",e[e.Mesh=2]="Mesh",e[e.Line=3]="Line",e[e.Point=4]="Point",e[e.Material=5]="Material",e[e.Texture=6]="Texture",e[e.COUNT=7]="COUNT"}(n||(n={}))},40502:function(e,t,r){r.d(t,{D:function(){return i}});var n=r(65839);const i=new Map([[n.r.POSITION,0],[n.r.NORMAL,1],[n.r.NORMALCOMPRESSED,1],[n.r.UV0,2],[n.r.COLOR,3],[n.r.COLORFEATUREATTRIBUTE,3],[n.r.SIZE,4],[n.r.TANGENT,4],[n.r.CENTEROFFSETANDDISTANCE,5],[n.r.SYMBOLCOLOR,5],[n.r.FEATUREATTRIBUTE,6],[n.r.INSTANCEFEATUREATTRIBUTE,6],[n.r.INSTANCECOLOR,7],[n.r.OBJECTANDLAYERIDCOLOR,7],[n.r.INSTANCEOBJECTANDLAYERIDCOLOR,7],[n.r.ROTATION,8],[n.r.INSTANCEMODEL,8],[n.r.INSTANCEMODELNORMAL,12],[n.r.INSTANCEMODELORIGINHI,11],[n.r.INSTANCEMODELORIGINLO,15]])},88075:function(e,t,r){r.d(t,{z:function(){return i}});var n=r(28950);function i(e){const{size:t}=e.definition,r=e.fontString(t);let i=s.get(r);if(!i){const c=(0,n.y)(o,0,0).getContext("2d");e.setFontProperties(c,t);const u=c.measureText(l);i=new a(u.actualBoundingBoxAscent,u.actualBoundingBoxDescent),s.set(r,i)}return i}const s=new Map;class a{get maxHeight(){return this.maxAscent+this.maxDescent}constructor(e,t){this.maxAscent=e,this.maxDescent=t}}const o={canvas:null},l=(()=>{let e="";for(let t=32;t<127;t++)e+=String.fromCharCode(t);return e})()},4875:function(e,t,r){r.d(t,{A:function(){return i}});var n=r(54407);class i{constructor(e){this._material=e.material,this._techniques=e.techniques,this._output=e.output}dispose(){}get _stippleTextures(){return this._techniques.context.stippleTextures}get _markerTextures(){return this._techniques.context.markerTextures}acquireTechnique(e,t){return this._techniques.acquire(e,this._material.getConfiguration(this._output,t))}ensureResources(e){return n.Am.LOADED}}},52798:function(e,t,r){r.d(t,{c:function(){return i}});var n=r(54407);class i{constructor(e,t){this._material=e,this._repository=t,this._map=new Map}dispose(){this._map.forEach(((e,t)=>{null!=e&&this._repository.release(this._material,t)}))}load(e,t,r){const i=this._material.produces.get(t);if(!i?.(r))return null;this._map.has(r)||this._map.set(r,this._repository.acquire(this._material,t,r));const s=this._map.get(r);if(null!=s){if(s.ensureResources(e)===n.Am.LOADED)return s;this._repository.requestRender()}return null}}},36634:function(e,t,r){r.d(t,{NV:function(){return u},m8:function(){return l}});var n=r(95929),i=r(60539),s=r(39506),a=r(54407),o=r(4875);class l extends o.A{constructor(e){super(e),this._numLoading=0,this._disposed=!1,this._textures=e.textures,this._textureId=e.textureId,this._acquire(e.textureId,(e=>this._texture=e)),this._acquire(e.normalTextureId,(e=>this._textureNormal=e)),this._acquire(e.emissiveTextureId,(e=>this._textureEmissive=e)),this._acquire(e.occlusionTextureId,(e=>this._textureOcclusion=e)),this._acquire(e.metallicRoughnessTextureId,(e=>this._textureMetallicRoughness=e))}dispose(){super.dispose(),this._texture=(0,n.Gz)(this._texture),this._textureNormal=(0,n.Gz)(this._textureNormal),this._textureEmissive=(0,n.Gz)(this._textureEmissive),this._textureOcclusion=(0,n.Gz)(this._textureOcclusion),this._textureMetallicRoughness=(0,n.Gz)(this._textureMetallicRoughness),this._disposed=!0}ensureResources(e){return 0===this._numLoading?a.Am.LOADED:a.Am.LOADING}get textureBindParameters(){return new u(null!=this._texture?this._texture.glTexture:null,null!=this._textureNormal?this._textureNormal.glTexture:null,null!=this._textureEmissive?this._textureEmissive.glTexture:null,null!=this._textureOcclusion?this._textureOcclusion.glTexture:null,null!=this._textureMetallicRoughness?this._textureMetallicRoughness.glTexture:null)}updateTexture(e){null!=this._texture&&e===this._texture.id||(this._texture=(0,n.Gz)(this._texture),this._textureId=e,this._acquire(this._textureId,(e=>this._texture=e)))}_acquire(e,t){if(null==e)return void t(null);const r=this._textures.acquire(e);if((0,i.$X)(r))return++this._numLoading,void r.then((e=>{if(this._disposed)return(0,n.Gz)(e),void t(null);t(e)})).finally((()=>--this._numLoading));t(r)}}class c extends s.Y{constructor(e=null){super(),this.textureEmissive=e}}class u extends c{constructor(e=null,t=null,r=null,n=null,i=null,s,a){super(r),this.texture=e,this.textureNormal=t,this.textureOcclusion=n,this.textureMetallicRoughness=i,this.scale=s,this.normalTextureTransformMatrix=a}}},89769:function(e,t,r){r.d(t,{V:function(){return v}});var n=r(39714),i=r(20551),s=r(37819),a=r(89932),o=r(53905),l=r(48015),c=r(40359),u=r(32501),d=r(67496);const h=(0,u.vt)(),f=(0,u.vt)(),p=(0,u.vt)(),m=(0,u.vt)();var g=r(84321),_=r(90553),y=r(65839);class v extends l.J{constructor(e,t,r=null,n=c.X.Mesh,i=null,a=-1){super(),this.material=e,this.mapPositions=r,this.type=n,this.objectAndLayerIdColor=i,this.edgeIndicesLength=a,this.highlights=new Set,this._highlightGroupCounts=new Map,this.visible=!0,this._attributes=new Map,this._boundingInfo=null;for(const[e,r]of t)this._attributes.set(e,{...r,indices:(0,s.Dg)(r.indices)}),e===y.r.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._attributes.get(e).indices.length:this.edgeIndicesLength)}instantiate(e={}){const t=new v(e.material||this.material,[],this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);return this._attributes.forEach(((e,r)=>{e.exclusive=!1,t._attributes.set(r,e)})),t._boundingInfo=this._boundingInfo,t.transformation=e.transformation||this.transformation,t}get attributes(){return this._attributes}getMutableAttribute(e){let t=this._attributes.get(e);return t&&!t.exclusive&&(t={...t,exclusive:!0,data:(0,a.S)(t.data)},this._attributes.set(e,t)),t}setAttributeData(e,t){const r=this._attributes.get(e);r&&this._attributes.set(e,{...r,exclusive:!0,data:t})}get indexCount(){const e=this._attributes.values().next().value.indices;return e?.length??0}get faceCount(){return this.indexCount/3}get boundingInfo(){return null==this._boundingInfo&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(e){return!!(this.type===c.X.Mesh?this._computeAttachmentOriginTriangles(e):this.type===c.X.Line?this._computeAttachmentOriginLines(e):this._computeAttachmentOriginPoints(e))&&(null!=this._transformation&&(0,i.t)(e,e,this._transformation),!0)}_computeAttachmentOriginTriangles(e){return function(e,t){if(!e)return!1;const{size:r,data:n,indices:s}=e;(0,i.i)(t,0,0,0),(0,i.i)(m,0,0,0);let a=0,o=0;for(let e=0;e<s.length-2;e+=3){const l=s[e]*r,c=s[e+1]*r,u=s[e+2]*r;(0,i.i)(h,n[l],n[l+1],n[l+2]),(0,i.i)(f,n[c],n[c+1],n[c+2]),(0,i.i)(p,n[u],n[u+1],n[u+2]);const g=(0,d.Q7)(h,f,p);g?((0,i.g)(h,h,f),(0,i.g)(h,h,p),(0,i.h)(h,h,1/3*g),(0,i.g)(t,t,h),a+=g):((0,i.g)(m,m,h),(0,i.g)(m,m,f),(0,i.g)(m,m,p),o+=3)}return!(0===o&&0===a||(0!==a?((0,i.h)(t,t,1/a),0):0===o||((0,i.h)(t,m,1/o),0)))}(this.attributes.get(y.r.POSITION),e)}_computeAttachmentOriginLines(e){const t=this.attributes.get(y.r.POSITION);return function(e,t,r){if(!e)return!1;(0,i.i)(r,0,0,0),(0,i.i)(m,0,0,0);let n=0,s=0;const{size:a,data:o,indices:l}=e,c=l.length-1,u=c+(t?2:0);for(let e=0;e<u;e+=2){const t=e<c?e+1:0,u=l[e<c?e:c]*a,d=l[t]*a;h[0]=o[u],h[1]=o[u+1],h[2]=o[u+2],f[0]=o[d],f[1]=o[d+1],f[2]=o[d+2],(0,i.h)(h,(0,i.g)(h,h,f),.5);const p=(0,i.F)(h,f);p>0?((0,i.g)(r,r,(0,i.h)(h,h,p)),n+=p):0===n&&((0,i.g)(m,m,h),s++)}return 0!==n?((0,i.h)(r,r,1/n),!0):0!==s&&((0,i.h)(r,m,1/s),!0)}(t,function(e,t){return!(!("isClosed"in e)||!e.isClosed)&&t.indices.length>2}(this.material.parameters,t),e)}_computeAttachmentOriginPoints(e){return function(e,t){if(!e)return!1;const{size:r,data:n,indices:s}=e;(0,i.i)(t,0,0,0);let a=-1,o=0;for(let e=0;e<s.length;e++){const i=s[e]*r;a!==i&&(t[0]+=n[i],t[1]+=n[i+1],t[2]+=n[i+2],o++),a=i}return o>1&&(0,i.h)(t,t,1/o),o>0}(this.attributes.get(y.r.POSITION),e)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const e=this.attributes.get(y.r.POSITION);if(!e||0===e.indices.length)return null;const t=this.type===c.X.Mesh?3:1;(0,_.vA)(e.indices.length%t==0,"Indexing error: "+e.indices.length+" not divisible by "+t);const r=(0,s.tM)(e.indices.length/t);return new o.j(r,t,e)}get transformation(){return this._transformation??n.zK}set transformation(e){this._transformation=e&&e!==n.zK?(0,n.o8)(e):null}get highlightGroups(){return this._highlightGroupCounts}get hasHighlights(){return this._highlightGroupCounts.size>0}foreachHighlightGroup(e){this._highlightGroupCounts.forEach(((t,r)=>e(r)))}allocateIdAndHighlight(e){const t=new g.h(e);return this.addHighlight(t)}addHighlight(e){this.highlights.add(e);const{highlightGroupName:t}=e,r=(this._highlightGroupCounts.get(t)??0)+1;return this._highlightGroupCounts.set(t,r),e}removeHighlight(e){if(this.highlights.delete(e)){const{highlightGroupName:t}=e,r=this._highlightGroupCounts.get(t)??0;r<=1?this._highlightGroupCounts.delete(t):this._highlightGroupCounts.set(t,r-1)}}}},8470:function(e,t,r){r.d(t,{zC:function(){return ne},C1:function(){return E},EE:function(){return X},YG:function(){return $},nW:function(){return J},td:function(){return M},_B:function(){return te},Nq:function(){return K},DJ:function(){return q},uX:function(){return Z},Z8:function(){return ee},CM:function(){return j},Gj:function(){return Y},Ho:function(){return k},Nb:function(){return Q},Xl:function(){return se},xh:function(){return re}});var n,i=r(20551),s=r(43274),a=r(32501),o=r(50240),l=r(5047),c=r(37819),u=r(5596),d=r(79578),h=r(14905);!function(e){e.length=function(e,t){const r=e[t],n=e[t+1],i=e[t+2];return Math.sqrt(r*r+n*n+i*i)},e.normalize=function(e,t){const r=e[t],n=e[t+1],i=e[t+2],s=1/Math.sqrt(r*r+n*n+i*i);e[t]*=s,e[t+1]*=s,e[t+2]*=s},e.scale=function(e,t,r){e[t]*=r,e[t+1]*=r,e[t+2]*=r},e.add=function(e,t,r,n,i,s=t){(i=i||e)[s]=e[t]+r[n],i[s+1]=e[t+1]+r[n+1],i[s+2]=e[t+2]+r[n+2]},e.subtract=function(e,t,r,n,i,s=t){(i=i||e)[s]=e[t]-r[n],i[s+1]=e[t+1]-r[n+1],i[s+2]=e[t+2]-r[n+2]}}(n||(n={}));var f=r(40359),p=r(89769),m=r(90553),g=r(65839);const _=n,y=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],v=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],T=[0,0,1,0,1,1,0,1],b=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],S=new Array(36);for(let e=0;e<6;e++)for(let t=0;t<6;t++)S[6*e+t]=e;const A=new Array(36);for(let e=0;e<6;e++)A[6*e]=0,A[6*e+1]=1,A[6*e+2]=2,A[6*e+3]=2,A[6*e+4]=3,A[6*e+5]=0;function E(e,t){Array.isArray(t)||(t=[t,t,t]);const r=new Array(24);for(let e=0;e<8;e++)r[3*e]=y[e][0]*t[0],r[3*e+1]=y[e][1]*t[1],r[3*e+2]=y[e][2]*t[2];return new p.V(e,[[g.r.POSITION,new h.n(r,b,3,!0)],[g.r.NORMAL,new h.n(v,S,3)],[g.r.UV0,new h.n(T,A,2)]])}const w=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],I=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],x=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],R=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];function M(e,t){Array.isArray(t)||(t=[t,t,t]);const r=new Array(18);for(let e=0;e<6;e++)r[3*e]=w[e][0]*t[0],r[3*e+1]=w[e][1]*t[1],r[3*e+2]=w[e][2]*t[2];return new p.V(e,[[g.r.POSITION,new h.n(r,x,3,!0)],[g.r.NORMAL,new h.n(I,R,3)]])}const O=(0,s.fA)(-.5,0,-.5),C=(0,s.fA)(.5,0,-.5),N=(0,s.fA)(0,0,.5),L=(0,s.fA)(0,.5,0),F=(0,s.vt)(),D=(0,s.vt)(),P=(0,s.vt)(),B=(0,s.vt)(),U=(0,s.vt)();(0,i.d)(F,O,L),(0,i.d)(D,O,C),(0,i.e)(P,F,D),(0,i.n)(P,P),(0,i.d)(F,C,L),(0,i.d)(D,C,N),(0,i.e)(B,F,D),(0,i.n)(B,B),(0,i.d)(F,N,L),(0,i.d)(D,N,O),(0,i.e)(U,F,D),(0,i.n)(U,U);const G=[O,C,N,L],z=[0,-1,0,P[0],P[1],P[2],B[0],B[1],B[2],U[0],U[1],U[2]],H=[0,1,2,3,1,0,3,2,1,3,0,2],V=[0,0,0,1,1,1,2,2,2,3,3,3];function k(e,t){Array.isArray(t)||(t=[t,t,t]);const r=new Array(12);for(let e=0;e<4;e++)r[3*e]=G[e][0]*t[0],r[3*e+1]=G[e][1]*t[1],r[3*e+2]=G[e][2]*t[2];return new p.V(e,[[g.r.POSITION,new h.n(r,H,3,!0)],[g.r.NORMAL,new h.n(z,V,3)]])}function j(e,t,r,n,i={uv:!0}){const s=-Math.PI,a=2*Math.PI,o=-Math.PI/2,u=Math.PI,d=Math.max(3,Math.floor(r)),f=Math.max(2,Math.floor(n)),m=(d+1)*(f+1),_=(0,l.oe)(3*m),y=(0,l.oe)(3*m),v=(0,l.oe)(2*m),T=[];let b=0;for(let e=0;e<=f;e++){const r=[],n=e/f,i=o+n*u,l=Math.cos(i);for(let e=0;e<=d;e++){const o=e/d,c=s+o*a,u=Math.cos(c)*l,h=Math.sin(i),f=-Math.sin(c)*l;_[3*b]=u*t,_[3*b+1]=h*t,_[3*b+2]=f*t,y[3*b]=u,y[3*b+1]=h,y[3*b+2]=f,v[2*b]=o,v[2*b+1]=n,r.push(b),++b}T.push(r)}const S=new Array;for(let e=0;e<f;e++)for(let t=0;t<d;t++){const r=T[e][t],n=T[e][t+1],i=T[e+1][t+1],s=T[e+1][t];0===e?(S.push(r),S.push(i),S.push(s)):e===f-1?(S.push(r),S.push(n),S.push(i)):(S.push(r),S.push(n),S.push(i),S.push(i),S.push(s),S.push(r))}const A=[[g.r.POSITION,new h.n(_,S,3,!0)],[g.r.NORMAL,new h.n(y,S,3,!0)]];return i.uv&&A.push([g.r.UV0,new h.n(v,S,2,!0)]),i.offset&&(A[0][0]=g.r.OFFSET,A.push([g.r.POSITION,new h.n(Float64Array.from(i.offset),(0,c.EH)(S.length),3,!0)])),new p.V(e,A)}function Z(e,t,r,n){const i=function(e,t,r){const n=e;let i,s;if(r)i=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],s=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const e=n*(1+Math.sqrt(5))/2;i=[-n,e,0,n,e,0,-n,-e,0,n,-e,0,0,-n,e,0,n,e,0,-n,-e,0,n,-e,e,0,-n,e,0,n,-e,0,-n,-e,0,n],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let t=0;t<i.length;t+=3)_.scale(i,t,e/_.length(i,t));let a={};function o(t,r){t>r&&([t,r]=[r,t]);const n=t.toString()+"."+r.toString();if(a[n])return a[n];let s=i.length;return i.length+=3,_.add(i,3*t,i,3*r,i,s),_.scale(i,s,e/_.length(i,s)),s/=3,a[n]=s,s}for(let e=0;e<t;e++){const e=s.length,t=new Array(4*e);for(let r=0;r<e;r+=3){const e=s[r],n=s[r+1],i=s[r+2],a=o(e,n),l=o(n,i),c=o(i,e),u=4*r;t[u]=e,t[u+1]=a,t[u+2]=c,t[u+3]=n,t[u+4]=l,t[u+5]=a,t[u+6]=i,t[u+7]=c,t[u+8]=l,t[u+9]=a,t[u+10]=l,t[u+11]=c}s=t,a={}}const c=(0,l.Wz)(i);for(let e=0;e<c.length;e+=3)_.normalize(c,e);return[[g.r.POSITION,new h.n((0,l.Wz)(i),s,3,!0)],[g.r.NORMAL,new h.n(c,s,3,!0)]]}(t,r,n);return new p.V(e,i)}function q(e,t,r,n,i,s,o,l,u,d=null){const m=r?(0,a.o8)(r):(0,a.vt)(),_=t?(0,a.o8)(t):(0,a.fA)(0,0,1),y=n?[255*n[0],255*n[1],255*n[2],n.length>3?255*n[3]:255]:[255,255,255,255],v=null!=s&&2===s.length?s:[1,1],T=null!=i?[i]:[0],b=(0,c.EH)(1),S=[[g.r.POSITION,new h.n(m,b,3,!0)],[g.r.NORMAL,new h.n(_,b,3,!0)],[g.r.COLOR,new h.n(y,b,4,!0)],[g.r.SIZE,new h.n(v,b,2)],[g.r.ROTATION,new h.n(T,b,1,!0)]];if(l&&S.push([g.r.UV0,new h.n(l,b,l.length)]),null!=o&&(o=[o[0],o[1],o[2],o[3]],S.push([g.r.CENTEROFFSETANDDISTANCE,new h.n(o,b,4)])),u){const e=[u[0],u[1],u[2],u[3]];S.push([g.r.FEATUREATTRIBUTE,new h.n(e,b,4)])}return new p.V(e,S,null,f.X.Point,d)}const W=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function Y(e,t=W){const r=new Array(12);for(let e=0;e<4;e++)for(let n=0;n<3;n++)r[3*e+n]=t[e][n];const n=[0,1,2,2,3,0],i=[0,0,0,0,0,0],s=[[g.r.POSITION,new h.n(r,n,3,!0)],[g.r.NORMAL,new h.n([0,0,1],i,3,!0)],[g.r.UV0,new h.n([0,0,1,0,1,1,0,1],n,2,!0)],[g.r.COLOR,new h.n([255,255,255,255],i,4,!0)]];return new p.V(e,s)}function $(e,t,r,n,i=!0,a=!0){let o=0;const c=t,u=e;let d=(0,s.fA)(0,o,0),f=(0,s.fA)(0,o+u,0),p=(0,s.fA)(0,-1,0),m=(0,s.fA)(0,1,0);n&&(o=u,f=(0,s.fA)(0,0,0),d=(0,s.fA)(0,o,0),p=(0,s.fA)(0,1,0),m=(0,s.fA)(0,-1,0));const _=[f,d],y=[p,m],v=r+2,T=Math.sqrt(u*u+c*c);if(n)for(let e=r-1;e>=0;e--){const t=e*(2*Math.PI/r),n=(0,s.fA)(Math.cos(t)*c,o,Math.sin(t)*c);_.push(n);const i=(0,s.fA)(u*Math.cos(t)/T,-c/T,u*Math.sin(t)/T);y.push(i)}else for(let e=0;e<r;e++){const t=e*(2*Math.PI/r),n=(0,s.fA)(Math.cos(t)*c,o,Math.sin(t)*c);_.push(n);const i=(0,s.fA)(u*Math.cos(t)/T,c/T,u*Math.sin(t)/T);y.push(i)}const b=new Array,S=new Array;if(i){for(let e=3;e<_.length;e++)b.push(1),b.push(e-1),b.push(e),S.push(0),S.push(0),S.push(0);b.push(_.length-1),b.push(2),b.push(1),S.push(0),S.push(0),S.push(0)}if(a){for(let e=3;e<_.length;e++)b.push(e),b.push(e-1),b.push(0),S.push(e),S.push(e-1),S.push(1);b.push(0),b.push(2),b.push(_.length-1),S.push(1),S.push(2),S.push(y.length-1)}const A=(0,l.oe)(3*v);for(let e=0;e<v;e++)A[3*e]=_[e][0],A[3*e+1]=_[e][1],A[3*e+2]=_[e][2];const E=(0,l.oe)(3*v);for(let e=0;e<v;e++)E[3*e]=y[e][0],E[3*e+1]=y[e][1],E[3*e+2]=y[e][2];return[[g.r.POSITION,new h.n(A,b,3,!0)],[g.r.NORMAL,new h.n(E,S,3,!0)]]}function X(e,t,r,n,i,s=!0,a=!0){return new p.V(e,$(t,r,n,i,s,a))}function J(e,t,r,n,a,o,c){const u=a?(0,s.o8)(a):(0,s.fA)(1,0,0),d=o?(0,s.o8)(o):(0,s.fA)(0,0,0);c??=!0;const f=(0,s.vt)();(0,i.n)(f,u);const m=(0,s.vt)();(0,i.h)(m,f,Math.abs(t));const _=(0,s.vt)();(0,i.h)(_,m,-.5),(0,i.g)(_,_,d);const y=(0,s.fA)(0,1,0);Math.abs(1-(0,i.f)(f,y))<.2&&(0,i.i)(y,0,0,1);const v=(0,s.vt)();(0,i.e)(v,f,y),(0,i.n)(v,v),(0,i.e)(y,v,f);const T=2*n+(c?2:0),b=n+(c?2:0),S=(0,l.oe)(3*T),A=(0,l.oe)(3*b),E=(0,l.oe)(2*T),w=new Array(3*n*(c?4:2)),I=new Array(3*n*(c?4:2));c&&(S[3*(T-2)]=_[0],S[3*(T-2)+1]=_[1],S[3*(T-2)+2]=_[2],E[2*(T-2)]=0,E[2*(T-2)+1]=0,S[3*(T-1)]=S[3*(T-2)]+m[0],S[3*(T-1)+1]=S[3*(T-2)+1]+m[1],S[3*(T-1)+2]=S[3*(T-2)+2]+m[2],E[2*(T-1)]=1,E[2*(T-1)+1]=1,A[3*(b-2)]=-f[0],A[3*(b-2)+1]=-f[1],A[3*(b-2)+2]=-f[2],A[3*(b-1)]=f[0],A[3*(b-1)+1]=f[1],A[3*(b-1)+2]=f[2]);const x=(e,t,r)=>{w[e]=t,I[e]=r};let R=0;const M=(0,s.vt)(),O=(0,s.vt)();for(let e=0;e<n;e++){const t=e*(2*Math.PI/n);(0,i.h)(M,y,Math.sin(t)),(0,i.h)(O,v,Math.cos(t)),(0,i.g)(M,M,O),A[3*e]=M[0],A[3*e+1]=M[1],A[3*e+2]=M[2],(0,i.h)(M,M,r),(0,i.g)(M,M,_),S[3*e]=M[0],S[3*e+1]=M[1],S[3*e+2]=M[2],E[2*e]=e/n,E[2*e+1]=0,S[3*(e+n)]=S[3*e]+m[0],S[3*(e+n)+1]=S[3*e+1]+m[1],S[3*(e+n)+2]=S[3*e+2]+m[2],E[2*(e+n)]=e/n,E[2*e+1]=1;const s=(e+1)%n;x(R++,e,e),x(R++,e+n,e),x(R++,s,s),x(R++,s,s),x(R++,e+n,e),x(R++,s+n,s)}if(c){for(let e=0;e<n;e++){const t=(e+1)%n;x(R++,T-2,b-2),x(R++,e,b-2),x(R++,t,b-2)}for(let e=0;e<n;e++){const t=(e+1)%n;x(R++,e+n,b-1),x(R++,T-1,b-1),x(R++,t+n,b-1)}}const C=[[g.r.POSITION,new h.n(S,w,3,!0)],[g.r.NORMAL,new h.n(A,I,3,!0)],[g.r.UV0,new h.n(E,w,2,!0)]];return new p.V(e,C)}function Q(e,t,r,n,i,s){n=n||10,i=null==i||i,(0,m.vA)(t.length>1);const a=[],o=[];for(let e=0;e<n;e++){a.push([0,-e-1,-(e+1)%n-1]);const t=e/n*2*Math.PI;o.push([Math.cos(t)*r,Math.sin(t)*r])}return K(e,o,t,[[0,0,0]],a,i,s)}function K(e,t,r,n,o,c,f=(0,s.fA)(0,0,0)){const m=t.length,_=(0,l.oe)(r.length*m*3+(6*n.length||0)),y=(0,l.oe)(r.length*m*3+(n?6:0)),v=new Array,T=new Array;let b=0,S=0;const A=(0,a.vt)(),E=(0,a.vt)(),w=(0,a.vt)(),I=(0,a.vt)(),x=(0,a.vt)(),R=(0,a.vt)(),M=(0,a.vt)(),O=(0,a.vt)(),C=(0,a.vt)(),N=(0,a.vt)(),L=(0,a.vt)(),F=(0,a.vt)(),D=(0,a.vt)(),P=(0,u.vt)();(0,i.i)(C,0,1,0),(0,i.d)(E,r[1],r[0]),(0,i.n)(E,E),c?((0,i.g)(O,r[0],f),(0,i.n)(w,O)):(0,i.i)(w,0,0,1),se(E,w,C,C,x,w,ae),(0,i.c)(I,w),(0,i.c)(F,x);for(let e=0;e<n.length;e++)(0,i.h)(R,x,n[e][0]),(0,i.h)(O,w,n[e][2]),(0,i.g)(R,R,O),(0,i.g)(R,R,r[0]),_[b++]=R[0],_[b++]=R[1],_[b++]=R[2];y[S++]=-E[0],y[S++]=-E[1],y[S++]=-E[2];for(let e=0;e<o.length;e++)v.push(o[e][0]>0?o[e][0]:-o[e][0]-1+n.length),v.push(o[e][1]>0?o[e][1]:-o[e][1]-1+n.length),v.push(o[e][2]>0?o[e][2]:-o[e][2]-1+n.length),T.push(0),T.push(0),T.push(0);let B=n.length;const U=n.length-1;for(let e=0;e<r.length;e++){let n=!1;e>0&&((0,i.c)(A,E),e<r.length-1?((0,i.d)(E,r[e+1],r[e]),(0,i.n)(E,E)):n=!0,(0,i.g)(N,A,E),(0,i.n)(N,N),(0,i.g)(L,r[e-1],I),(0,u.O_)(r[e],N,P),(0,u.Ui)(P,(0,d.LV)(L,A),O)?((0,i.d)(O,O,r[e]),(0,i.n)(w,O),(0,i.e)(x,N,w),(0,i.n)(x,x)):se(N,I,F,C,x,w,ae),(0,i.c)(I,w),(0,i.c)(F,x)),c&&((0,i.g)(O,r[e],f),(0,i.n)(D,O));for(let s=0;s<m;s++)if((0,i.h)(R,x,t[s][0]),(0,i.h)(O,w,t[s][1]),(0,i.g)(R,R,O),(0,i.n)(M,R),y[S++]=M[0],y[S++]=M[1],y[S++]=M[2],(0,i.g)(R,R,r[e]),_[b++]=R[0],_[b++]=R[1],_[b++]=R[2],!n){const e=(s+1)%m;v.push(B+s),v.push(B+m+s),v.push(B+e),v.push(B+e),v.push(B+m+s),v.push(B+m+e);for(let e=0;e<6;e++){const t=v.length-6;T.push(v[t+e]-U)}}B+=m}const G=r[r.length-1];for(let e=0;e<n.length;e++)(0,i.h)(R,x,n[e][0]),(0,i.h)(O,w,n[e][1]),(0,i.g)(R,R,O),(0,i.g)(R,R,G),_[b++]=R[0],_[b++]=R[1],_[b++]=R[2];const z=S/3;y[S++]=E[0],y[S++]=E[1],y[S++]=E[2];const H=B-m;for(let e=0;e<o.length;e++)v.push(o[e][0]>=0?B+o[e][0]:-o[e][0]-1+H),v.push(o[e][2]>=0?B+o[e][2]:-o[e][2]-1+H),v.push(o[e][1]>=0?B+o[e][1]:-o[e][1]-1+H),T.push(z),T.push(z),T.push(z);const V=[[g.r.POSITION,new h.n(_,v,3,!0)],[g.r.NORMAL,new h.n(y,T,3,!0)]];return new p.V(e,V)}function ee(e,t,r,n){(0,m.vA)(t.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),(0,m.vA)(3===t[0].length,"createPolylineGeometry(): malformed vertex"),(0,m.vA)(null==r||r.length===t.length,"createPolylineGeometry: need same number of points and normals"),(0,m.vA)(null==r||3===r[0].length,"createPolylineGeometry(): malformed normal");const i=(0,o.jh)(3*t.length),s=new Array(2*(t.length-1));let a=0,u=0;for(let e=0;e<t.length;e++){for(let r=0;r<3;r++)i[a++]=t[e][r];e>0&&(s[u++]=e-1,s[u++]=e)}const d=[[g.r.POSITION,new h.n(i,s,3,!0)]];if(r){const e=(0,l.oe)(3*r.length);let n=0;for(let i=0;i<t.length;i++)for(let t=0;t<3;t++)e[n++]=r[i][t];d.push([g.r.NORMAL,new h.n(e,s,3,!0)])}return n&&d.push([g.r.COLOR,new h.n(n,(0,c.tM)(n.length/4),4)]),new p.V(e,d,null,f.X.Line)}function te(e,t,r,n,i,s=0){const a=new Array(18),o=[[-r,s,i/2],[n,s,i/2],[0,t+s,i/2],[-r,s,-i/2],[n,s,-i/2],[0,t+s,-i/2]];for(let e=0;e<6;e++)a[3*e]=o[e][0],a[3*e+1]=o[e][1],a[3*e+2]=o[e][2];return new p.V(e,[[g.r.POSITION,new h.n(a,[0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5],3,!0)]])}function re(e,t){const r=e.getMutableAttribute(g.r.POSITION).data;for(let e=0;e<r.length;e+=3){const n=r[e],s=r[e+1],a=r[e+2];(0,i.i)(oe,n,s,a),(0,i.t)(oe,oe,t),r[e]=oe[0],r[e+1]=oe[1],r[e+2]=oe[2]}}function ne(e,t=e){const r=e.attributes,n=r.get(g.r.POSITION).data,i=r.get(g.r.NORMAL).data;if(i){const e=t.getMutableAttribute(g.r.NORMAL).data;for(let t=0;t<i.length;t+=3){const r=i[t+1];e[t+1]=-i[t+2],e[t+2]=r}}if(n){const e=t.getMutableAttribute(g.r.POSITION).data;for(let t=0;t<n.length;t+=3){const r=n[t+1];e[t+1]=-n[t+2],e[t+2]=r}}}function ie(e,t,r,n,s){return!(Math.abs((0,i.f)(t,e))>s||((0,i.e)(r,e,t),(0,i.n)(r,r),(0,i.e)(n,r,e),(0,i.n)(n,n),0))}function se(e,t,r,n,i,s,a){return ie(e,t,i,s,a)||ie(e,r,i,s,a)||ie(e,n,i,s,a)}const ae=.99619469809,oe=(0,a.vt)()},49845:function(e,t,r){r.d(t,{G7:function(){return S},hz:function(){return y}});var n=r(73364),i=r(39714),s=r(20551),a=r(32501),o=r(33400),l=r(41546),c=r(79578),u=r(65420),d=r(38177),h=r(50456),f=r(59356),p=r(22323);const m=1e-5;class g{constructor(e){this.options=new d.H6,this._results=new v,this.transform=new p.dg,this.tolerance=m,this.verticalOffset=null,this._ray=(0,c.vt)(),this._rayEnd=(0,a.vt)(),this._rayBeginTransformed=(0,a.vt)(),this._rayEndTransformed=(0,a.vt)(),this.viewingMode=e??u.RT.Global}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(e,t,r){this.resetWithRay((0,c.Cr)(e,t,this._ray),r)}resetWithRay(e,t){this.camera=t,e!==this._ray&&(0,c.C)(e,this._ray),0!==this.options.verticalOffset?this.viewingMode===u.RT.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,(0,s.g)(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(e=null,t,r,n,i){this.point=t,this.filterPredicate=n,this.tolerance=r??m;const s=(0,p.ou)(this.verticalOffset);if(e&&e.length>0){const t=i?e=>{i(e)&&this.intersectObject(e)}:e=>{this.intersectObject(e)};for(const r of e){const e=r.getSpatialQueryAccelerator?.();null!=e?(null!=s?e.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,t,s):e.forEachAlongRay(this._ray.origin,this._ray.direction,t),this.options.selectionMode&&this.options.hud&&e.forEachDegenerateObject(t)):r.objects.forAll((e=>t(e)))}}this.sortResults()}intersectObject(e){const t=e.geometries;if(!t)return;const r=e.effectiveTransformation,n=(0,p.ou)(this.verticalOffset);for(const a of t){if(!a.visible)continue;const{material:t,id:o}=a;if(!t.visible)continue;this.transform.setAndInvalidateLazyTransforms(r,a.transformation),(0,s.t)(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),(0,s.t)(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const l=this.transform.transform;null!=n&&(n.objectTransform=this.transform),t.intersect(a,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,((t,r,n,s,a,c)=>{if(t>=0){if(null!=this.filterPredicate&&!this.filterPredicate(this._ray.origin,this._rayEnd,t))return;const u=s?this._results.hud:this._results,f=s?s=>{const l=new h.B$(e,o,n,c);s.set(d.dz.HUD,l,t,r,i.zK,a)}:i=>i.set(d.dz.OBJECT,{object:e,geometryId:o,triangleNr:n},t,r,l,a);if((null==u.min.drapedLayerOrder||a>=u.min.drapedLayerOrder)&&(null==u.min.dist||t<u.min.dist)&&f(u.min),this.options.store!==d.oH.MIN&&(null==u.max.drapedLayerOrder||a<u.max.drapedLayerOrder)&&(null==u.max.dist||t>u.max.dist)&&f(u.max),this.options.store===d.oH.ALL)if(s){const e=new b(this._ray);f(e),this._results.hud.all.push(e)}else{const e=new T(this._ray);f(e),this._results.all.push(e)}}}))}}sortResults(e=this._results.all){e.sort(((e,t)=>e.dist!==t.dist?(e.dist??0)-(t.dist??0):e.drapedLayerOrder!==t.drapedLayerOrder?_(e.drapedLayerOrder,t.drapedLayerOrder):_(e.drapedLayerGraphicOrder,t.drapedLayerGraphicOrder)))}}function _(e,t){return(t??-Number.MAX_VALUE)-(e??-Number.MAX_VALUE)}function y(e){return new g(e)}class v{constructor(){this.min=new T((0,c.vt)()),this.max=new T((0,c.vt)()),this.hud={min:new b((0,c.vt)()),max:new b((0,c.vt)()),all:new Array},this.ground=new T((0,c.vt)()),this.all=[]}init(e){this.min.init(e),this.max.init(e),this.ground.init(e),this.all.length=0,this.hud.min.init(e),this.hud.max.init(e),this.hud.all.length=0}}class T{get ray(){return this._ray}get distanceInRenderSpace(){return null!=this.dist?((0,s.h)(A,this.ray.direction,this.dist),(0,s.l)(A)):null}getIntersectionPoint(e){return!!(0,f.i3)(this)&&((0,s.h)(A,this.ray.direction,this.dist),(0,s.g)(e,this.ray.origin,A),!0)}getTransformedNormal(e){return(0,s.c)(E,this.normal),E[3]=0,(0,o.t)(E,E,this.transformation),(0,s.c)(e,E),(0,s.n)(e,e)}constructor(e){this.intersector=d.dz.OBJECT,this.normal=(0,a.vt)(),this.transformation=(0,i.vt)(),this._ray=(0,c.vt)(),this.init(e)}init(e){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=d.dz.OBJECT,(0,c.C)(e,this._ray)}set(e,t,r,o,l,c,u){this.intersector=e,this.dist=r,(0,s.c)(this.normal,o??a.Cb),(0,n.C)(this.transformation,l??i.zK),this.target=t,this.drapedLayerOrder=c,this.drapedLayerGraphicOrder=u}copy(e){(0,c.C)(e.ray,this._ray),this.intersector=e.intersector,this.dist=e.dist,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,(0,s.c)(this.normal,e.normal),(0,n.C)(this.transformation,e.transformation)}}class b extends T{constructor(){super(...arguments),this.intersector=d.dz.HUD}}function S(e){return new T(e)}const A=(0,a.vt)(),E=(0,l.vt)()},38177:function(e,t,r){var n,i;r.d(t,{H6:function(){return s},dz:function(){return n},oH:function(){return i}}),function(e){e[e.OBJECT=0]="OBJECT",e[e.HUD=1]="HUD",e[e.TERRAIN=2]="TERRAIN",e[e.OVERLAY=3]="OVERLAY",e[e.I3S=4]="I3S",e[e.PCL=5]="PCL",e[e.LOD=6]="LOD",e[e.VOXEL=7]="VOXEL",e[e.TILES3D=8]="TILES3D"}(n||(n={}));class s{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.filteredLayerUids=[],this.store=i.ALL,this.normalRequired=!0,this.excludeLabels=!1}}!function(e){e[e.MIN=0]="MIN",e[e.MINMAX=1]="MINMAX",e[e.ALL=2]="ALL"}(i||(i={}))},50456:function(e,t,r){r.d(t,{B$:function(){return s},HE:function(){return a},R6:function(){return o}});var n=r(32501);class i{constructor(e,t,r){this.object=e,this.geometryId=t,this.triangleNr=r}}class s extends i{constructor(e,t,r,i){super(e,t,r),this.center=null!=i?(0,n.o8)(i):null}}class a{constructor(e){this.layerUid=e}}class o extends a{constructor(e,t){super(e),this.graphicUid=t}}},24100:function(e,t,r){r.d(t,{im:function(){return d},m$:function(){return n},qA:function(){return h}});var n,i,s=r(32501),a=r(39506),o=r(48015),l=r(40359),c=r(40502),u=r(84887);class d extends o.J{constructor(e,t){super(),this.type=l.X.Material,this.supportsEdges=!1,this._renderPriority=0,this.vertexAttributeLocations=c.D,this._pp0=(0,s.fA)(0,0,1),this._pp1=(0,s.fA)(0,0,0),this._parameters=new t,(0,u.MB)(this._parameters,e),this.validateParameters(this._parameters)}get parameters(){return this._parameters}update(e){return!1}setParameters(e,t=!0){(0,u.MB)(this._parameters,e)&&(this.validateParameters(this._parameters),t&&this._parametersChanged())}validateParameters(e){}shouldRender(e){return this.visible&&this.isVisibleForOutput(e.output)&&(!this.parameters.isDecoration||e.bind.decorations)&&!!(this.parameters.renderOccluded&e.renderOccludedMask)}isVisibleForOutput(e){return!0}get renderPriority(){return this._renderPriority}set renderPriority(e){e!==this._renderPriority&&(this._renderPriority=e,this._parametersChanged())}_parametersChanged(){this.repository?.materialChanged(this)}queryRenderOccludedState(e){return this.visible&&this.parameters.renderOccluded===e}get hasEmissions(){return!1}intersectDraped(e,t,r,n,i,s){return this._pp0[0]=this._pp1[0]=n[0],this._pp0[1]=this._pp1[1]=n[1],this.intersect(e,t,r,this._pp0,this._pp1,i)}}(i=n||(n={}))[i.None=0]="None",i[i.Occlude=1]="Occlude",i[i.Transparent=2]="Transparent",i[i.OccludeAndTransparent=4]="OccludeAndTransparent",i[i.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",i[i.Opaque=16]="Opaque";class h extends a.Y{constructor(){super(...arguments),this.renderOccluded=n.Occlude,this.isDecoration=!1}}},96253:function(e,t,r){var n,i;r.d(t,{k:function(){return i},q:function(){return n}}),function(e){e[e.ADD=0]="ADD",e[e.UPDATE=1]="UPDATE",e[e.REMOVE=2]="REMOVE"}(n||(n={})),function(e){e[e.NONE=0]="NONE",e[e.VISIBILITY=1]="VISIBILITY",e[e.GEOMETRY=2]="GEOMETRY",e[e.TRANSFORMATION=4]="TRANSFORMATION",e[e.HIGHLIGHT=8]="HIGHLIGHT",e[e.OCCLUDEE=16]="OCCLUDEE"}(i||(i={}))},54840:function(e,t,r){var n;r.d(t,{Y:function(){return n}}),function(e){e[e.NONE=0]="NONE",e[e.ColorAlpha=1]="ColorAlpha",e[e.FrontFace=2]="FrontFace",e[e.COUNT=3]="COUNT"}(n||(n={}))},84321:function(e,t,r){r.d(t,{h:function(){return a},p:function(){return o}});var n=r(11231),i=r(54407);class s{constructor(){this.uid=(0,n.c)()}}class a extends s{constructor(e){super(),this.highlightGroupName=e,this.channel=i.Mg.Highlight}}class o extends s{constructor(){super(...arguments),this.channel=i.Mg.MaskOccludee}}},35363:function(e,t,r){r.d(t,{A:function(){return k}});var n,i,s=r(56996),a=r(7187),o=r(20551),l=r(32501),c=r(69508),u=r(79578),d=r(13794),h=r(90553);class f{get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}constructor(e,t){this.objectToBoundingSphere=e,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new p,this._objectCount=0,t&&(void 0!==t.maximumObjectsPerNode&&(this._maximumObjectsPerNode=t.maximumObjectsPerNode),void 0!==t.maximumDepth&&(this._maximumDepth=t.maximumDepth))}destroy(){this._degenerateObjects.clear(),p.clearPool(),O[0]=null,D.prune(),H.prune()}add(e,t=e.length){this._objectCount+=t,this._grow(e,t);const r=p.acquire();for(let n=0;n<t;n++){const t=e[n];this._isDegenerate(t)?this._degenerateObjects.add(t):(r.init(this._root),this._add(t,r))}p.release(r)}remove(e,t=null){this._objectCount-=e.length;const r=p.acquire();for(const n of e){const e=t??(0,d.e)(this.objectToBoundingSphere(n),P);I(e[3])?(r.init(this._root),_(n,e,r)):this._degenerateObjects.delete(n)}p.release(r),this._shrink()}update(e,t){if(!I(t[3])&&this._isDegenerate(e))return;const r=function(e){return O[0]=e,O}(e);this.remove(r,t),this.add(r)}forEachAlongRay(e,t,r){const n=(0,u.LV)(e,t);m(this._root,(e=>{if(!function(e,t){return S((0,d.a)(t.bounds),2*-t.halfSize,L),S((0,d.a)(t.bounds),2*t.halfSize,F),(0,h.O_)(e.origin,e.direction,L,F)}(n,e))return!1;const t=e.node;return t.terminals.forAll((e=>{this._intersectsObject(n,e)&&r(e)})),null!==t.residents&&t.residents.forAll((e=>{this._intersectsObject(n,e)&&r(e)})),!0}))}forEachAlongRayWithVerticalOffset(e,t,r,n){const i=(0,u.LV)(e,t);m(this._root,(e=>{if(!function(e,t,r){return S((0,d.a)(t.bounds),2*-t.halfSize,L),S((0,d.a)(t.bounds),2*t.halfSize,F),r.applyToMinMax(L,F),(0,h.O_)(e.origin,e.direction,L,F)}(i,e,n))return!1;const t=e.node;return t.terminals.forAll((e=>{this._intersectsObjectWithOffset(i,e,n)&&r(e)})),null!==t.residents&&t.residents.forAll((e=>{this._intersectsObjectWithOffset(i,e,n)&&r(e)})),!0}))}forEach(e){m(this._root,(t=>{const r=t.node;return r.terminals.forAll(e),null!==r.residents&&r.residents.forAll(e),!0})),this._degenerateObjects.forEach(e)}forEachDegenerateObject(e){this._degenerateObjects.forEach(e)}findClosest(e,t,r,n=()=>!0,i=1/0){let s=1/0,a=1/0,l=null;const u=E(e,t),h=o=>{if(--i,!n(o))return;const u=this.objectToBoundingSphere(o);if(!(0,c.m7)(r,u))return;const h=w(e,t,(0,d.a)(u)),f=h-u[3],p=h+u[3];f<s&&(s=f,a=p,l=o)};return g(this._root,(n=>{if(i<=0||!(0,c.m7)(r,n.bounds))return!1;if((0,o.h)(N,u,n.halfSize),(0,o.g)(N,N,(0,d.a)(n.bounds)),w(e,t,N)>a)return!1;const s=n.node;return s.terminals.forAll((e=>h(e))),null!==s.residents&&s.residents.forAll((e=>h(e))),!0}),e,t),l}forEachInDepthRange(e,t,r,n,i,s,a){let l=-1/0,u=1/0;const h={setRange:e=>{r===f.DepthOrder.FRONT_TO_BACK?(l=Math.max(l,e.near),u=Math.min(u,e.far)):(l=Math.max(l,-e.far),u=Math.min(u,-e.near))}};h.setRange(n);const p=w(t,r,e),m=E(t,r),_=E(t,-r),y=e=>{if(!a(e))return;const n=this.objectToBoundingSphere(e),o=(0,d.a)(n),f=w(t,r,o)-p,m=f-n[3],g=f+n[3];m>u||g<l||!(0,c.m7)(s,n)||i(e,h)};g(this._root,(e=>{if(!(0,c.m7)(s,e.bounds))return!1;if((0,o.h)(N,m,e.halfSize),(0,o.g)(N,N,(0,d.a)(e.bounds)),w(t,r,N)-p>u)return!1;if((0,o.h)(N,_,e.halfSize),(0,o.g)(N,N,(0,d.a)(e.bounds)),w(t,r,N)-p<l)return!1;const n=e.node;return n.terminals.forAll((e=>y(e))),null!==n.residents&&n.residents.forAll((e=>y(e))),!0}),t,r)}forEachNode(e){m(this._root,(t=>e(t.node,t.bounds,t.halfSize,t.depth)))}forEachNeighbor(e,t){const r=(0,d.g)(t),n=(0,d.a)(t),i=t=>{const i=this.objectToBoundingSphere(t),s=(0,d.g)(i),a=r+s;return!((0,o.s)((0,d.a)(i),n)-a*a<=0)||e(t)};let s=!0;const a=e=>{s&&(s=i(e))};m(this._root,(e=>{const t=(0,d.g)(e.bounds),i=r+t;if((0,o.s)((0,d.a)(e.bounds),n)-i*i>0)return!1;const l=e.node;return l.terminals.forAll(a),s&&null!==l.residents&&l.residents.forAll(a),s})),s&&this.forEachDegenerateObject(a)}_intersectsObject(e,t){const r=this.objectToBoundingSphere(t);return!(r[3]>0)||(0,d.k)(r,e)}_intersectsObjectWithOffset(e,t,r){const n=this.objectToBoundingSphere(t);return!(n[3]>0)||(0,d.k)(r.applyToBoundingSphere(n),e)}_add(e,t){t.advanceTo(this.objectToBoundingSphere(e))?t.node.terminals.push(e):(t.node.residents.push(e),t.node.residents.length>this._maximumObjectsPerNode&&t.depth<this._maximumDepth&&this._split(t))}_split(e){const t=e.node.residents;e.node.residents=null;for(let r=0;r<t.length;r++){const n=p.acquire().init(e);this._add(t.at(r),n),p.release(n)}}_grow(e,t){if(0!==t&&(A(e,t,(e=>this.objectToBoundingSphere(e)),B),I(B[3])&&!this._fitsInsideTree(B)))if(v(this._root.node))(0,d.e)(B,this._root.bounds),this._root.halfSize=1.25*this._root.bounds[3],this._root.updateBoundsRadiusFromHalfSize();else{const e=this._rootBoundsForRootAsSubNode(B);this._placingRootViolatesMaxDepth(e)?this._rebuildTree(B,e):this._growRootAsSubNode(e),p.release(e)}}_rebuildTree(e,t){(0,o.c)((0,d.a)(U),(0,d.a)(t.bounds)),U[3]=t.halfSize,A([e,U],2,(e=>e),G);const r=p.acquire().init(this._root);this._root.initFrom(null,G,G[3]),this._root.increaseHalfSize(1.25),m(r,(e=>(this.add(e.node.terminals.data,e.node.terminals.length),null!==e.node.residents&&this.add(e.node.residents.data,e.node.residents.length),!0))),p.release(r)}_placingRootViolatesMaxDepth(e){const t=Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E;let r=0;return m(this._root,(e=>(r=Math.max(r,e.depth),r+t<=this._maximumDepth))),r+t>this._maximumDepth}_rootBoundsForRootAsSubNode(e){const t=e[3],r=e;let n=-1/0;const i=this._root.bounds,s=this._root.halfSize;for(let e=0;e<3;e++){const a=i[e]-s-(r[e]-t),o=r[e]+t-(i[e]+s),l=Math.max(0,Math.ceil(a/(2*s))),c=Math.max(0,Math.ceil(o/(2*s)))+1,u=2**Math.ceil(Math.log(l+c)*Math.LOG2E);n=Math.max(n,u),z[e].min=l,z[e].max=c}for(let e=0;e<3;e++){let t=z[e].min,r=z[e].max;const a=(n-(t+r))/2;t+=Math.ceil(a),r+=Math.floor(a);const o=i[e]-s-t*s*2;C[e]=o+(r+t)*s}const a=n*s;return C[3]=a*M,p.acquire().initFrom(null,C,a,0)}_growRootAsSubNode(e){const t=this._root.node;(0,o.c)((0,d.a)(B),(0,d.a)(this._root.bounds)),B[3]=this._root.halfSize,this._root.init(e),e.advanceTo(B,null,!0),e.node.children=t.children,e.node.residents=t.residents,e.node.terminals=t.terminals}_shrink(){for(;;){const e=this._findShrinkIndex();if(-1===e)break;this._root.advance(e),this._root.depth=0}}_findShrinkIndex(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;let e=null;const t=this._root.node.children;let r=0,n=0;for(;n<t.length&&null==e;)r=n++,e=t[r];for(;n<t.length;)if(t[n++])return-1;return r}_isDegenerate(e){return!I(this.objectToBoundingSphere(e)[3])}_fitsInsideTree(e){const t=this._root.bounds,r=this._root.halfSize;return e[3]<=r&&e[0]>=t[0]-r&&e[0]<=t[0]+r&&e[1]>=t[1]-r&&e[1]<=t[1]+r&&e[2]>=t[2]-r&&e[2]<=t[2]+r}toJSON(){const{maximumDepth:e,maximumObjectsPerNode:t,_objectCount:r}=this,n=this._nodeToJSON(this._root.node);return{maximumDepth:e,maximumObjectsPerNode:t,objectCount:r,root:{bounds:this._root.bounds,halfSize:this._root.halfSize,depth:this._root.depth,node:n}}}_nodeToJSON(e){const t=e.children.map((e=>e?this._nodeToJSON(e):null)),r=e.residents?.map((e=>this.objectToBoundingSphere(e))),n=e.terminals?.map((e=>this.objectToBoundingSphere(e)));return{children:t,residents:r,terminals:n}}static fromJSON(e){const t=new f((e=>e),{maximumDepth:e.maximumDepth,maximumObjectsPerNode:e.maximumObjectsPerNode});return t._objectCount=e.objectCount,t._root.initFrom(e.root.node,e.root.bounds,e.root.halfSize,e.root.depth),t}}class p{constructor(){this.bounds=(0,d.c)(),this.halfSize=0,this.initFrom(null,null,0,0)}init(e){return this.initFrom(e.node,e.bounds,e.halfSize,e.depth)}initFrom(e,t,r,n=this.depth){return this.node=null!=e?e:p.createEmptyNode(),t&&(0,d.e)(t,this.bounds),this.halfSize=r,this.depth=n,this}increaseHalfSize(e){this.halfSize*=e,this.updateBoundsRadiusFromHalfSize()}updateBoundsRadiusFromHalfSize(){this.bounds[3]=this.halfSize*M}advance(e){let t=this.node.children[e];t||(t=p.createEmptyNode(),this.node.children[e]=t),this.node=t,this.halfSize/=2,this.depth++;const r=x[e];return this.bounds[0]+=r[0]*this.halfSize,this.bounds[1]+=r[1]*this.halfSize,this.bounds[2]+=r[2]*this.halfSize,this.updateBoundsRadiusFromHalfSize(),this}advanceTo(e,t,r=!1){for(;;){if(this.isTerminalFor(e))return t&&t(this,-1),!0;if(this.isLeaf()){if(!r)return t&&t(this,-1),!1;this.node.residents=null}const n=this._childIndex(e);t&&t(this,n),this.advance(n)}}isLeaf(){return null!=this.node.residents}isTerminalFor(e){return e[3]>this.halfSize/2}_childIndex(e){const t=this.bounds;return(t[0]<e[0]?1:0)+(t[1]<e[1]?2:0)+(t[2]<e[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new a.A({shrink:!0}),residents:new a.A({shrink:!0})}}static acquire(){return p._pool.acquire()}static release(e){p._pool.release(e)}static clearPool(){p._pool.prune()}}function m(e,t){let r=p.acquire().init(e);const n=[r];for(;0!==n.length;){if(r=n.pop(),t(r)&&!r.isLeaf())for(let e=0;e<r.node.children.length;e++)r.node.children[e]&&n.push(p.acquire().init(r).advance(e));p.release(r)}}function g(e,t,r,n=f.DepthOrder.FRONT_TO_BACK){let i=p.acquire().init(e);const s=[i];for(function(e,t,r){if(!H.length)for(let e=0;e<8;++e)H.push({index:0,distance:0});for(let r=0;r<8;++r){const n=x[r];H.data[r].index=r,H.data[r].distance=w(e,t,n)}H.sort(((e,t)=>e.distance-t.distance));for(let e=0;e<8;++e)r[e]=H.data[e].index}(r,n,V);0!==s.length;){if(i=s.pop(),t(i)&&!i.isLeaf())for(let e=7;e>=0;--e){const t=V[e];i.node.children[t]&&s.push(p.acquire().init(i).advance(t))}p.release(i)}}function _(e,t,r){D.clear();const n=r.advanceTo(t,((e,t)=>{D.push(e.node),D.push(t)}))?r.node.terminals:r.node.residents;if(n.removeUnordered(e),0===n.length)for(let e=D.length-2;e>=0&&y(D.data[e],D.data[e+1]);e-=2);}function y(e,t){return t>=0&&(e.children[t]=null),!!v(e)&&(null===e.residents&&(e.residents=new a.A({shrink:!0})),!0)}function v(e){if(0!==e.terminals.length)return!1;if(null!==e.residents)return 0===e.residents.length;for(let t=0;t<e.children.length;t++)if(e.children[t])return!1;return!0}function T(e,t){e[0]=Math.min(e[0],t[0]-t[3]),e[1]=Math.min(e[1],t[1]-t[3]),e[2]=Math.min(e[2],t[2]-t[3])}function b(e,t){e[0]=Math.max(e[0],t[0]+t[3]),e[1]=Math.max(e[1],t[1]+t[3]),e[2]=Math.max(e[2],t[2]+t[3])}function S(e,t,r){r[0]=e[0]+t,r[1]=e[1]+t,r[2]=e[2]+t}function A(e,t,r,n){if(1===t){const t=r(e[0]);(0,d.e)(t,n)}else{L[0]=1/0,L[1]=1/0,L[2]=1/0,F[0]=-1/0,F[1]=-1/0,F[2]=-1/0;for(let n=0;n<t;n++){const t=r(e[n]);I(t[3])&&(T(L,t),b(F,t))}(0,o.m)((0,d.a)(n),L,F,.5),n[3]=Math.max(F[0]-L[0],F[1]-L[1],F[2]-L[2])/2}}function E(e,t){let r,n=1/0;for(let i=0;i<8;++i){const s=w(e,t,R[i]);s<n&&(n=s,r=R[i])}return r}function w(e,t,r){return t*(e[0]*r[0]+e[1]*r[1]+e[2]*r[2])}function I(e){return!isNaN(e)&&e!==-1/0&&e!==1/0&&e>0}p._pool=new s.A(p),n=f||(f={}),(i=n.DepthOrder||(n.DepthOrder={}))[i.FRONT_TO_BACK=1]="FRONT_TO_BACK",i[i.BACK_TO_FRONT=-1]="BACK_TO_FRONT";const x=[(0,l.fA)(-1,-1,-1),(0,l.fA)(1,-1,-1),(0,l.fA)(-1,1,-1),(0,l.fA)(1,1,-1),(0,l.fA)(-1,-1,1),(0,l.fA)(1,-1,1),(0,l.fA)(-1,1,1),(0,l.fA)(1,1,1)],R=[(0,l.fA)(-1,-1,-1),(0,l.fA)(-1,-1,1),(0,l.fA)(-1,1,-1),(0,l.fA)(-1,1,1),(0,l.fA)(1,-1,-1),(0,l.fA)(1,-1,1),(0,l.fA)(1,1,-1),(0,l.fA)(1,1,1)],M=Math.sqrt(3),O=[null],C=(0,d.c)(),N=(0,l.vt)(),L=(0,l.vt)(),F=(0,l.vt)(),D=new a.A,P=(0,d.c)(),B=(0,d.c)(),U=(0,d.c)(),G=(0,d.c)(),z=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],H=new a.A,V=[0,0,0,0,0,0,0,0],k=f},46921:function(e,t,r){r.d(t,{K_:function(){return p},SE:function(){return h},Yf:function(){return c},aB:function(){return f},ez:function(){return l},m6:function(){return m},xt:function(){return d},z5:function(){return u}});var n=r(27264),i=r(54840),s=r(85456),a=r(57087);const o=(0,a.p3)(s.dn.ONE,s.dn.ZERO,s.dn.ONE,s.dn.ONE_MINUS_SRC_ALPHA);function l(e){return e===i.Y.FrontFace?null:o}function c(e){switch(e){case i.Y.NONE:return a.Ky;case i.Y.ColorAlpha:return o;case i.Y.FrontFace:case i.Y.COUNT:return null}}function u(e){if(e.draped)return null;switch(e.oitPass){case i.Y.NONE:case i.Y.FrontFace:return e.writeDepth?a.Uy:null;case i.Y.ColorAlpha:case i.Y.COUNT:return null}}const d=5e5,h={factor:-1,units:-2};function f(e){return e?h:null}function p(e,t=s.MT.LESS){return e===i.Y.NONE||e===i.Y.FrontFace?t:s.MT.LEQUAL}function m(e,t){const r=(0,n.LG)(t);return e===i.Y.ColorAlpha?r?{buffers:[s.Nm.COLOR_ATTACHMENT0,s.Nm.COLOR_ATTACHMENT1,s.Nm.COLOR_ATTACHMENT2]}:{buffers:[s.Nm.COLOR_ATTACHMENT0,s.Nm.COLOR_ATTACHMENT1]}:r?{buffers:[s.Nm.COLOR_ATTACHMENT0,s.Nm.COLOR_ATTACHMENT1]}:null}},45079:function(e,t,r){r.d(t,{JG:function(){return c},Uy:function(){return d},Wb:function(){return E},Z$:function(){return m}});var n=r(20551),i=r(32501),s=r(24761),a=r(40359),o=r(90553),l=r(65839);class c{constructor(e=!1,t=!0){this.isVerticalRay=e,this.normalRequired=t}}const u=(0,s.vt)();function d(e,t,r,i,s,u){if(!e.visible)return;const d=(0,n.a)(x,i,r),h=(e,t,r)=>{u(e,r,t,!1)},p=new c(!1,t.options.normalRequired);if(e.boundingInfo){(0,o.vA)(e.type===a.X.Mesh);const n=t.tolerance;f(e.boundingInfo,r,d,n,s,p,h)}else{const t=e.attributes.get(l.r.POSITION),n=t.indices;g(r,d,0,n.length/3,n,t.data,t.stride,s,p,h)}}const h=(0,i.vt)();function f(e,t,r,i,a,o,l){if(null==e)return;const c=function(e,t){return(0,n.i)(t,1/e[0],1/e[1],1/e[2])}(r,h);if((0,s.Ne)(u,e.bbMin),(0,s.vI)(u,e.bbMax),null!=a&&a.applyToAabb(u),E(u,t,c,i)){const{primitiveIndices:n,position:s}=e,c=n?n.length:s.indices.length/3;if(c>w){const n=e.getChildren();if(void 0!==n){for(const e of n)f(e,t,r,i,a,o,l);return}}!function(e,t,r,n,i,s,a,o,l,c,u){const d=e[0],h=e[1],f=e[2],m=t[0],g=t[1],_=t[2],{normalRequired:y}=c;for(let e=0;e<n;++e){const t=o[e],r=3*t,n=a*i[r];let c=s[n],v=s[n+1],b=s[n+2];const S=a*i[r+1];let A=s[S],E=s[S+1],w=s[S+2];const x=a*i[r+2];let R=s[x],M=s[x+1],O=s[x+2];null!=l&&([c,v,b]=l.applyToVertex(c,v,b,e),[A,E,w]=l.applyToVertex(A,E,w,e),[R,M,O]=l.applyToVertex(R,M,O,e));const C=A-c,N=E-v,L=w-b,F=R-c,D=M-v,P=O-b,B=g*P-D*_,U=_*F-P*m,G=m*D-F*g,z=C*B+N*U+L*G;if(Math.abs(z)<=I)continue;const H=d-c,V=h-v,k=f-b,j=H*B+V*U+k*G;if(z>0){if(j<0||j>z)continue}else if(j>0||j<z)continue;const Z=V*L-N*k,q=k*C-L*H,W=H*N-C*V,Y=m*Z+g*q+_*W;if(z>0){if(Y<0||j+Y>z)continue}else if(Y>0||j+Y<z)continue;const $=(F*Z+D*q+P*W)/z;$>=0&&u($,t,y?T(C,N,L,F,D,P,p):null)}}(t,r,0,c,s.indices,s.data,s.stride,n,a,o,l)}}const p=(0,i.vt)();function m(e,t,r,i,s,a,o,l,c){const{data:u,stride:d}=a;g(e,(0,n.a)(x,t,e),r,i,s,u,d,o,l,c)}function g(e,t,r,i,s,a,o,l,c,u){const d=t,h=R,f=Math.abs(d[0]),p=Math.abs(d[1]),m=Math.abs(d[2]),g=f>=p?f>=m?0:2:p>=m?1:2,T=g,S=d[T]<0?2:1,A=(g+S)%3,E=(g+(3-S))%3,w=d[A]/d[T],I=d[E]/d[T],x=1/d[T],M=_,O=y,C=v,{normalRequired:N}=c;for(let t=r;t<i;++t){const r=3*t,i=o*s[r];(0,n.i)(h[0],a[i+0],a[i+1],a[i+2]);const c=o*s[r+1];(0,n.i)(h[1],a[c+0],a[c+1],a[c+2]);const d=o*s[r+2];(0,n.i)(h[2],a[d+0],a[d+1],a[d+2]),l&&((0,n.c)(h[0],l.applyToVertex(h[0][0],h[0][1],h[0][2],t)),(0,n.c)(h[1],l.applyToVertex(h[1][0],h[1][1],h[1][2],t)),(0,n.c)(h[2],l.applyToVertex(h[2][0],h[2][1],h[2][2],t))),(0,n.a)(M,h[0],e),(0,n.a)(O,h[1],e),(0,n.a)(C,h[2],e);const f=M[A]-w*M[T],p=M[E]-I*M[T],m=O[A]-w*O[T],g=O[E]-I*O[T],_=C[A]-w*C[T],y=C[E]-I*C[T],v=_*g-y*m,S=f*y-p*_,R=m*p-g*f;if((v<0||S<0||R<0)&&(v>0||S>0||R>0))continue;const L=v+S+R;if(0===L)continue;const F=v*(x*M[T])+S*(x*O[T])+R*(x*C[T]);if(F*Math.sign(L)<0)continue;const D=F/L;D>=0&&u(D,t,N?b(h):null)}}const _=(0,i.vt)(),y=(0,i.vt)(),v=(0,i.vt)();function T(e,t,r,i,s,a,o){return(0,n.i)(S,e,t,r),(0,n.i)(A,i,s,a),(0,n.e)(o,S,A),(0,n.n)(o,o),o}function b(e){return(0,n.a)(S,e[1],e[0]),(0,n.a)(A,e[2],e[0]),(0,n.e)(p,S,A),(0,n.n)(p,p),p}const S=(0,i.vt)(),A=(0,i.vt)();function E(e,t,r,n){return function(e,t,r,n){const i=(e[0]-n-t[0])*r[0],s=(e[3]+n-t[0])*r[0];let a=Math.min(i,s),o=Math.max(i,s);const l=(e[1]-n-t[1])*r[1],c=(e[4]+n-t[1])*r[1];if(o=Math.min(o,Math.max(l,c)),o<0)return!1;if(a=Math.max(a,Math.min(l,c)),a>o)return!1;const u=(e[2]-n-t[2])*r[2],d=(e[5]+n-t[2])*r[2];return o=Math.min(o,Math.max(u,d)),!(o<0)&&(a=Math.max(a,Math.min(u,d)),!(a>o)&&a<1/0)}(e,t,r,n)}const w=1e3,I=1e-7,x=(0,i.vt)(),R=[(0,i.vt)(),(0,i.vt)(),(0,i.vt)()]},29165:function(e,t,r){var n;r.d(t,{N:function(){return n}}),function(e){e[e.INTEGRATED_MESH=0]="INTEGRATED_MESH",e[e.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",e[e.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",e[e.OPAQUE_MATERIAL_WITHOUT_NORMALS=3]="OPAQUE_MATERIAL_WITHOUT_NORMALS",e[e.TRANSPARENT_MATERIAL=4]="TRANSPARENT_MATERIAL",e[e.TRANSPARENT_MATERIAL_WITHOUT_NORMALS=5]="TRANSPARENT_MATERIAL_WITHOUT_NORMALS",e[e.TRANSPARENT_TERRAIN=6]="TRANSPARENT_TERRAIN",e[e.TRANSPARENT_MATERIAL_WITHOUT_DEPTH=7]="TRANSPARENT_MATERIAL_WITHOUT_DEPTH",e[e.OCCLUDED_TERRAIN=8]="OCCLUDED_TERRAIN",e[e.OCCLUDER_MATERIAL=9]="OCCLUDER_MATERIAL",e[e.TRANSPARENT_OCCLUDER_MATERIAL=10]="TRANSPARENT_OCCLUDER_MATERIAL",e[e.OCCLUSION_PIXELS=11]="OCCLUSION_PIXELS",e[e.HUD_MATERIAL=12]="HUD_MATERIAL",e[e.LABEL_MATERIAL=13]="LABEL_MATERIAL",e[e.LINE_CALLOUTS=14]="LINE_CALLOUTS",e[e.LINE_CALLOUTS_HUD_DEPTH=15]="LINE_CALLOUTS_HUD_DEPTH",e[e.DRAPED_MATERIAL=16]="DRAPED_MATERIAL",e[e.DRAPED_WATER=17]="DRAPED_WATER",e[e.VOXEL=18]="VOXEL",e[e.MAX_SLOTS=19]="MAX_SLOTS"}(n||(n={}))},6200:function(e,t,r){r.d(t,{I$:function(){return d},a9:function(){return u},m:function(){return s},mK:function(){return h},qh:function(){return c},r8:function(){return l},sf:function(){return a},v0:function(){return o}});var n=r(54407),i=r(85456);const s={func:i.MT.LESS},a={func:i.MT.ALWAYS},o={mask:255},l={mask:0},c={function:{func:i.MT.ALWAYS,ref:n.dd.OutlineVisualElementMask,mask:n.dd.OutlineVisualElementMask},operation:{fail:i.eA.KEEP,zFail:i.eA.KEEP,zPass:i.eA.ZERO}},u={function:{func:i.MT.ALWAYS,ref:n.dd.OutlineVisualElementMask,mask:n.dd.OutlineVisualElementMask},operation:{fail:i.eA.KEEP,zFail:i.eA.KEEP,zPass:i.eA.REPLACE}},d={function:{func:i.MT.EQUAL,ref:n.dd.OutlineVisualElementMask,mask:n.dd.OutlineVisualElementMask},operation:{fail:i.eA.KEEP,zFail:i.eA.KEEP,zPass:i.eA.KEEP}},h={function:{func:i.MT.NOTEQUAL,ref:n.dd.OutlineVisualElementMask,mask:n.dd.OutlineVisualElementMask},operation:{fail:i.eA.KEEP,zFail:i.eA.KEEP,zPass:i.eA.KEEP}}},28950:function(e,t,r){function n(e,t,r){return e.canvas||(e.canvas=document.createElement("canvas")),e.canvas.width=t,e.canvas.height=r,e.canvas}r.d(t,{y:function(){return n}})},36029:function(e,t,r){r.d(t,{Js:function(){return l},Xd:function(){return o},lV:function(){return u}});var n=r(15774),i=r(70974),s=r(88075),a=r(28950);const o=1;class l{constructor(e,t,r,n){this.text=e,this._alignment=t,this._parameters=r,this._maxSize=n,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._metricsCached=null,this.key=`${e}--${this._parameters.key}-${this._alignment}`,this._lines=e.replaceAll(" ","").split(/\r?\n/)}get displayWidth(){return Math.ceil(this._displayWidth+2*this._horizontalPadding)}get displayHeight(){let e=this._metrics.firstLineAscent;for(let t=0;t<this._lines.length-1;t++)e+=this._lineSpacing;return e+=this._metrics.lastLineDescent,Math.ceil(e+2*this._haloSize+2*this._verticalPadding)}get renderedWidth(){return this._toRoundedRenderUnit(this.displayWidth)}get renderedHeight(){return this._toRoundedRenderUnit(this.displayHeight)}get firstRenderedBaselinePosition(){return this._toRenderUnit(this._firstLineYOffset+this._metrics.firstLineAscent)}get _firstLineYOffset(){return this._verticalPadding+this._haloSize}get _metrics(){if(null==this._metricsCached){const e=(0,a.y)(h,p,p).getContext("2d"),t=this._parameters.definition.pixelRatio,r=this._fontSize*t;this._parameters.setFontProperties(e,r);let n=2*this._haloSize;const i=this._parameters.definition.font;"italic"!==i.style&&"oblique"!==i.style&&"bold"!==i.weight&&"bolder"!==i.weight||(n+=.3*e.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let o=0,l=0,c=0,u=0,d=0;this._lines.forEach(((r,i)=>{const s=e.measureText(r),a=s.width/t,h=a+n;this._textWidths.push(a),this._lineWidths.push(h),o=Math.max(o,h),u=Math.max(u,s.actualBoundingBoxAscent/t),d=Math.max(d,s.actualBoundingBoxDescent/t),0===i&&(l=s.actualBoundingBoxAscent/t),i===this._lines.length-1&&(c=s.actualBoundingBoxDescent/t)}));const f=(0,s.z)(this._parameters),m=Math.max(u,f.maxAscent),_=Math.max(d,f.maxDescent),y=l,v="underline"===this._parameters.definition.font.decoration?_:c,T=o;this._metricsCached=new g(y,v,m,_,T)}return this._metricsCached}get _lineSpacing(){return(this._midLineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}get _midLineHeight(){return this._metrics.midLineHeight}get _linePadding(){return this._midLineHeight*f}get _midLineAscent(){return this._metrics.maxLineAscent}get _renderedFontSize(){return this._toRenderUnit(this._fontSize)}get _fontSize(){return this._parameters.definition.size}get _renderedHaloSize(){return this._toRenderUnit(this._haloSize)}get _haloSize(){return this._parameters.haloSize}get _horizontalPadding(){return this._hasBackground?this._parameters.definition.background.padding[0]:0}get _verticalPadding(){return Math.max(this._hasBackground?this._parameters.definition.background.padding[1]:0,o)}get _hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(null==this._renderPixelRatio){const e=this._parameters.definition.pixelRatio;this._renderPixelRatio=Math.min(e,Math.min(this._maxSize[0]/this.displayWidth,this._maxSize[1]/this.displayHeight))}return this._renderPixelRatio}_getLineXOffset(e){switch(this._alignment){case u.Left:return this._horizontalPadding;case u.Center:return(this.displayWidth-this._lineWidths[e])/2;case u.Right:return this.displayWidth-this._horizontalPadding-this._lineWidths[e]}}render(e,t,r){e.save();const n=t/=this.renderPixelRatio,s=r/=this.renderPixelRatio,a=this._haloSize,o=this._firstLineYOffset+this._metrics.firstLineAscent;t+=a,r+=o;const l=this._haloSize>0;l&&this._renderHalo(e,n,s,a,o),this._parameters.setFontProperties(e,this._renderedFontSize);for(let n=0;n<this._lines.length;++n){const i=this._lines[n],s=this._getLineXOffset(n);l&&(e.globalCompositeOperation="destination-out",e.fillStyle="rgb(0, 0, 0)",this._fillText(e,i,t+s,r),this._renderLineDecoration(e,t+s,r,this._textWidths[n])),e.globalCompositeOperation="source-over",e.fillStyle=this._parameters.textStyle,this._fillText(e,i,t+this._getLineXOffset(n),r),this._renderLineDecoration(e,t+s,r,this._textWidths[n]),r+=this._lineSpacing}if(i.b.TEXT_SHOW_BASELINE){e.strokeStyle=m,e.setLineDash([2,2]),e.lineWidth=1;let t=s+o;for(let r=0;r<this._lines.length;++r)this._drawLine(e,[n,t],[n+this.displayWidth,t]),t+=this._lineSpacing}if(i.b.TEXT_SHOW_BORDER&&(e.strokeStyle=m,e.setLineDash([]),e.lineWidth=1,this._drawBox(e,[n,s],[this.displayWidth,this.displayHeight])),this._hasBackground){const t=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(e,n,s,t),e.globalCompositeOperation="destination-over",e.fillStyle=this._parameters.backgroundStyle,e.fill()}e.restore()}_renderLineDecoration(e,t,r,n,i=!1){if("none"===this._parameters.definition.font.decoration||0===n)return;const s=Math.max(this._parameters.definition.size/16,1);switch(this._parameters.definition.font.decoration){case"underline":r+=2*s;break;case"line-through":r-=.33*this._midLineAscent}const a=i?this._haloSize:0;e.strokeStyle=i?this._parameters.haloStyle:this._parameters.textStyle,e.lineWidth=this._toRenderUnit(s+2*a),e.beginPath(),e.moveTo(this._toRenderUnit(t-a),this._toRenderUnit(r)),e.lineTo(this._toRenderUnit(t+n+a),this._toRenderUnit(r)),e.stroke()}_roundedRect(e,t,r,i){t=this._toRenderUnit(t),r=this._toRenderUnit(r);const s=this.renderedWidth,a=this.renderedHeight;0!==i?(i=(0,n.qE)(i,0,Math.floor(a/2)),e.beginPath(),e.moveTo(t,r+i),e.arcTo(t,r,t+i,r,i),e.lineTo(t+s-i,r),e.arcTo(t+s,r,t+s,r+i,i),e.lineTo(t+s,r+a-i),e.arcTo(t+s,r+a,t+s-i,r+a,i),e.lineTo(t+i,r+a),e.arcTo(t,r+a,t,r+a-i,i),e.closePath()):e.rect(t,r,s,a)}_renderHalo(e,t,r,n,i){const s=this.renderedWidth,o=this.renderedHeight,l=(0,a.y)(h,Math.max(s,p),Math.max(o,p)),c=l.getContext("2d");c.clearRect(0,0,s,o),this._parameters.setFontProperties(c,this._renderedFontSize),c.fillStyle=this._parameters.haloStyle,c.strokeStyle=this._parameters.haloStyle;const u=this._renderedHaloSize<3;c.lineJoin=u?"miter":"round",u?this._renderHaloEmulated(c,n,i):this._renderHaloNative(c,n,i);let d=i;for(let e=0;e<this._lines.length;++e){const t=this._getLineXOffset(e);this._renderLineDecoration(c,n+t,d,this._textWidths[e],!0),d+=this._lineSpacing}e.globalAlpha=this._parameters.definition.halo.color[3],e.drawImage(l,0,0,s,o,this._toRenderUnit(t),this._toRenderUnit(r),s,o),e.globalAlpha=1}_renderHaloEmulated(e,t,r){for(let n=0;n<this._lines.length;++n){const i=this._lines[n],s=this._getLineXOffset(n);for(const[n,a]of c)this._fillText(e,i,t+s+this._haloSize*n,r+this._haloSize*a);r+=this._lineSpacing}}_renderHaloNative(e,t,r){const n=2*this._haloSize;for(let i=0;i<this._lines.length;++i){const s=this._lines[i],a=this._getLineXOffset(i),o=5,l=.1;for(let i=0;i<o;i++){const c=1-(o-1)*l+i*l;e.lineWidth=this._toRenderUnit(c*n),this._strokeText(e,s,t+a,r)}r+=this._lineSpacing}}get _displayWidth(){return this._metrics.displayWidth}_toRenderUnit(e){return e*this.renderPixelRatio}_toRoundedRenderUnit(e){return Math.round(e*this.renderPixelRatio)}_fillText(e,t,r,n){e.fillText(t,this._toRenderUnit(r),this._toRenderUnit(n))}_strokeText(e,t,r,n){e.strokeText(t,this._toRenderUnit(r),this._toRenderUnit(n))}_drawLine(e,t,r){e.beginPath(),e.moveTo(this._toRoundedRenderUnit(t[0])+.5,this._toRoundedRenderUnit(t[1])+.5),e.lineTo(this._toRoundedRenderUnit(r[0])+.5,this._toRoundedRenderUnit(r[1])+.5),e.stroke()}_drawBox(e,t,r){const n=this._toRenderUnit(t[0]),i=this._toRenderUnit(t[1]),s=this._toRenderUnit(r[0]),a=this._toRenderUnit(r[1]),o=Math.floor(n)+.5,l=Math.ceil(n+s)-.5,c=Math.floor(i)+.5,u=Math.ceil(i+a)-.5;e.beginPath(),e.moveTo(o,c),e.lineTo(l,c),e.lineTo(l,u),e.lineTo(o,u),e.lineTo(o,c),e.stroke()}}const c=[];{const e=16;for(let t=0;t<360;t+=360/e)c.push([Math.cos(Math.PI*t/180),Math.sin(Math.PI*t/180)])}var u,d;(d=u||(u={}))[d.Left=0]="Left",d[d.Center=1]="Center",d[d.Right=2]="Right";const h={canvas:null},f=.2,p=512,m="rgb(255, 0, 255, 0.5)";class g{get firstLineHeight(){return this.firstLineAscent+this.maxLineDescent}get midLineHeight(){return this.maxLineAscent+this.maxLineDescent}get lastLineHeight(){return this.maxLineAscent+this.lastLineDescent}constructor(e,t,r,n,i){this.firstLineAscent=e,this.lastLineDescent=t,this.maxLineAscent=r,this.maxLineDescent=n,this.displayWidth=i}}},59552:function(e,t,r){r.d(t,{g:function(){return G}}),r(58941);var n=r(39819),i=r(48996),s=r(95929),a=r(60539),o=r(24540),l=r(90683),c=r(9030),u=r(86419),d=r(54407),h=r(53216);let f;var p,m;(m=p||(p={}))[m.ETC1_RGB=0]="ETC1_RGB",m[m.ETC2_RGBA=1]="ETC2_RGBA",m[m.BC1_RGB=2]="BC1_RGB",m[m.BC3_RGBA=3]="BC3_RGBA",m[m.BC4_R=4]="BC4_R",m[m.BC5_RG=5]="BC5_RG",m[m.BC7_M6_RGB=6]="BC7_M6_RGB",m[m.BC7_M5_RGBA=7]="BC7_M5_RGBA",m[m.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",m[m.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",m[m.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",m[m.ATC_RGB=11]="ATC_RGB",m[m.ATC_RGBA=12]="ATC_RGBA",m[m.FXT1_RGB=17]="FXT1_RGB",m[m.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",m[m.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",m[m.ETC2_EAC_R11=20]="ETC2_EAC_R11",m[m.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",m[m.RGBA32=13]="RGBA32",m[m.RGB565=14]="RGB565",m[m.BGR565=15]="BGR565",m[m.RGBA4444=16]="RGBA4444";var g=r(85456),_=r(12285),y=r(93380);let v=null,T=null;async function b(){return null==T&&(f??=(async()=>{const e=await r.e(5090).then(r.bind(r,90830)),t=await e.default({locateFile:e=>(0,h.s)(`esri/libs/basisu/${e}`)});return t.initializeBasis(),t})(),T=f,v=await T),T}function S(e,t,r,n,i){const s=(0,y.IB)(t?g.CQ.COMPRESSED_RGBA8_ETC2_EAC:g.CQ.COMPRESSED_RGB8_ETC2),a=i&&e>1?(4**e-1)/(3*4**(e-1)):1;return Math.ceil(r*n*s*a)}function A(e){return e.getNumImages()>=1&&!e.isUASTC()}function E(e){return e.getFaces()>=1&&e.isETC1S()}function w(e,t,r,n,i,s,a,o){const{compressedTextureETC:l,compressedTextureS3TC:c}=e.capabilities,[u,d]=l?n?[p.ETC2_RGBA,g.CQ.COMPRESSED_RGBA8_ETC2_EAC]:[p.ETC1_RGB,g.CQ.COMPRESSED_RGB8_ETC2]:c?n?[p.BC3_RGBA,g.CQ.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[p.BC1_RGB,g.CQ.COMPRESSED_RGB_S3TC_DXT1_EXT]:[p.RGBA32,g.Ab.RGBA],h=t.hasMipmap?r:Math.min(1,r),f=[];for(let e=0;e<h;e++)f.push(new Uint8Array(a(e,u))),o(e,u,f[e]);return t.internalFormat=d,t.hasMipmap=f.length>1,t.samplingMode=t.hasMipmap?g.Cj.LINEAR_MIPMAP_LINEAR:g.Cj.LINEAR,t.width=i,t.height=s,new _.g(e,t,{type:"compressed",levels:f})}var I=r(48015),x=r(40359),R=r(40633);const M=()=>R.A.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil");function O(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}const C=O("DXT1"),N=O("DXT3"),L=O("DXT5");var F,D,P=r(12569),B=r(90553),U=r(10956);class G extends I.J{get parameters(){return this._parameters}constructor(e,t){super(),this._data=e,this.type=x.X.Texture,this._glTexture=null,this._loadingPromise=null,this._loadingController=null,this.events=new i.A,this._parameters={...H,...t},this._startPreload(e)}dispose(){this.unload(),this._data=this.frameUpdate=void 0}_startPreload(e){null!=e&&(e instanceof HTMLVideoElement?(this.frameUpdate=t=>this._frameUpdate(e,t),this._startPreloadVideoElement(e)):e instanceof HTMLImageElement&&this._startPreloadImageElement(e))}_startPreloadVideoElement(e){if(!((0,l.w8)(e.src)||"auto"===e.preload&&e.crossOrigin)){e.preload="auto",e.crossOrigin="anonymous";const t=!e.paused;if(e.src=e.src,t&&e.autoplay){const t=()=>{e.removeEventListener("canplay",t),e.play()};e.addEventListener("canplay",t)}}}_startPreloadImageElement(e){(0,l.DB)(e.src)||(0,l.w8)(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)}_createDescriptor(e){const t=new U.R;return t.wrapMode=this._parameters.wrap??g.pF.REPEAT,t.flipped=!this._parameters.noUnpackFlip,t.samplingMode=this._parameters.mipmap?g.Cj.LINEAR_MIPMAP_LINEAR:g.Cj.LINEAR,t.hasMipmap=!!this._parameters.mipmap,t.preMultiplyAlpha=!!this._parameters.preMultiplyAlpha,t.maxAnisotropy=this._parameters.maxAnisotropy??(this._parameters.mipmap?e.parameters.maxMaxAnisotropy:1),t}get glTexture(){return this._glTexture}get memoryEstimate(){return this._glTexture?.usedMemory||function(e,t){if(null==e)return 0;if((0,o.mw)(e)||(0,o.mg)(e))return t.encoding===d.JS.KTX2_ENCODING?function(e,t){if(null==v)return e.byteLength;const r=new v.KTX2File(new Uint8Array(e)),n=E(r)?S(r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),t):0;return r.close(),r.delete(),n}(e,!!t.mipmap):t.encoding===d.JS.BASIS_ENCODING?function(e,t){if(null==v)return e.byteLength;const r=new v.BasisFile(new Uint8Array(e)),n=A(r)?S(r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),t):0;return r.close(),r.delete(),n}(e,!!t.mipmap):e.byteLength;const{width:r,height:n}=e instanceof Image||e instanceof ImageData||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement?z(e):t;return(t.mipmap?4/3:1)*r*n*(t.components||4)||0}(this._data,this._parameters)}load(e){if(this._glTexture)return this._glTexture;if(this._loadingPromise)return this._loadingPromise;const t=this._data;return null==t?(this._glTexture=new _.g(e,this._createDescriptor(e),null),this._glTexture):(this._parameters.reloadable||(this._data=void 0),"string"==typeof t?this._loadFromURL(e,t):t instanceof Image?this._loadFromImageElement(e,t):t instanceof HTMLVideoElement?this._loadFromVideoElement(e,t):t instanceof ImageData||t instanceof HTMLCanvasElement?this._loadFromImage(e,t):(0,o.mg)(t)&&this._parameters.encoding===d.JS.DDS_ENCODING?this._loadFromDDSData(e,t):(0,o.mw)(t)&&this._parameters.encoding===d.JS.DDS_ENCODING?this._loadFromDDSData(e,new Uint8Array(t)):((0,o.mw)(t)||(0,o.mg)(t))&&this._parameters.encoding===d.JS.KTX2_ENCODING?this._loadFromKTX2(e,t):((0,o.mw)(t)||(0,o.mg)(t))&&this._parameters.encoding===d.JS.BASIS_ENCODING?this._loadFromBasis(e,t):(0,o.mg)(t)?this._loadFromPixelData(e,t):(0,o.mw)(t)?this._loadFromPixelData(e,new Uint8Array(t)):null)}_frameUpdate(e,t){return null==this._glTexture||e.readyState<F.HAVE_CURRENT_DATA||t===e.currentTime?t:(this._glTexture.setData(e),this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this._parameters.updateCallback&&this._parameters.updateCallback(),e.currentTime)}_loadFromDDSData(e,t){return this._glTexture=function(e,t,r){const n=function(e,t){const r=new Int32Array(e.buffer,e.byteOffset,31);if(542327876!==r[0])return M().error("Invalid magic number in DDS header"),null;if(!(4&r[20]))return M().error("Unsupported format, must contain a FourCC code"),null;const n=r[21];let i,s;switch(n){case C:i=8,s=g.CQ.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case N:i=16,s=g.CQ.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case L:i=16,s=g.CQ.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return M().error("Unsupported FourCC code:",function(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}(n)),null}let a=1,o=r[4],l=r[3];(3&o||3&l)&&(M().warn("Rounding up compressed texture size to nearest multiple of 4."),o=o+3&-4,l=l+3&-4);const c=o,u=l;let d,h;131072&r[2]&&!1!==t&&(a=Math.max(1,r[7]));let f=e.byteOffset+r[1]+4;const p=[];for(let t=0;t<a;++t)h=(o+3>>2)*(l+3>>2)*i,d=new Uint8Array(e.buffer,f,h),p.push(d),f+=h,o=Math.max(1,o>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:p},internalFormat:s,width:c,height:u}}(r,t.hasMipmap??!1);if(null==n)throw new Error("DDS texture data is null");const{textureData:i,internalFormat:s,width:a,height:o}=n;return t.samplingMode=i.levels.length>1?g.Cj.LINEAR_MIPMAP_LINEAR:g.Cj.LINEAR,t.hasMipmap=i.levels.length>1,t.internalFormat=s,t.width=a,t.height=o,new _.g(e,t,i)}(e,this._createDescriptor(e),t),this._glTexture}_loadFromKTX2(e,t){return this._loadAsync((()=>async function(e,t,r){null==v&&(v=await b());const n=new v.KTX2File(new Uint8Array(r));if(!E(n))return null;n.startTranscoding();const i=w(e,t,n.getLevels(),n.getHasAlpha(),n.getWidth(),n.getHeight(),((e,t)=>n.getImageTranscodedSizeInBytes(e,0,0,t)),((e,t,r)=>n.transcodeImage(r,e,0,0,t,0,-1,-1)));return n.close(),n.delete(),i}(e,this._createDescriptor(e),t).then((e=>(this._glTexture=e,e)))))}_loadFromBasis(e,t){return this._loadAsync((()=>async function(e,t,r){null==v&&(v=await b());const n=new v.BasisFile(new Uint8Array(r));if(!A(n))return null;n.startTranscoding();const i=w(e,t,n.getNumLevels(0),n.getHasAlpha(),n.getImageWidth(0,0),n.getImageHeight(0,0),((e,t)=>n.getImageTranscodedSizeInBytes(0,e,t)),((e,t,r)=>n.transcodeImage(r,0,e,t,0,0)));return n.close(),n.delete(),i}(e,this._createDescriptor(e),t).then((e=>(this._glTexture=e,e)))))}_loadFromPixelData(e,t){(0,B.vA)(this._parameters.width>0&&this._parameters.height>0);const r=this._createDescriptor(e);return r.pixelFormat=1===this._parameters.components?g.Ab.LUMINANCE:3===this._parameters.components?g.Ab.RGB:g.Ab.RGBA,r.width=this._parameters.width??0,r.height=this._parameters.height??0,this._glTexture=new _.g(e,r,t),this._glTexture}_loadFromURL(e,t){return this._loadAsync((async r=>{const n=await(0,c.D)(t,{signal:r});return(0,a.Te)(r),this._loadFromImage(e,n)}))}_loadFromImageElement(e,t){return t.complete?this._loadFromImage(e,t):this._loadAsync((async r=>{const n=await(0,u.Sx)(t,t.src,!1,r);return(0,a.Te)(r),this._loadFromImage(e,n)}))}_loadFromVideoElement(e,t){return t.readyState>=F.HAVE_CURRENT_DATA?this._loadFromImage(e,t):this._loadFromVideoElementAsync(e,t)}_loadFromVideoElementAsync(e,t){return this._loadAsync((r=>new Promise(((i,o)=>{const l=()=>{t.removeEventListener("loadeddata",c),t.removeEventListener("error",u),(0,s.xt)(d)},c=()=>{t.readyState>=F.HAVE_CURRENT_DATA&&(l(),i(this._loadFromImage(e,t)))},u=e=>{l(),o(e||new n.A("Failed to load video"))};t.addEventListener("loadeddata",c),t.addEventListener("error",u);const d=(0,a.u7)(r,(()=>u((0,a.NK)())))}))))}_loadFromImage(e,t){let r=t;if(!(r instanceof HTMLVideoElement)){const{maxTextureSize:t}=e.parameters;r=this._parameters.downsampleUncompressed?(0,P.IR)(r,t):(0,P.vM)(r,t)}const n=z(r);this._parameters.width=n.width,this._parameters.height=n.height;const i=this._createDescriptor(e);return i.pixelFormat=3===this._parameters.components?g.Ab.RGB:g.Ab.RGBA,i.width=n.width,i.height=n.height,this._glTexture=new _.g(e,i,r),this._glTexture}_loadAsync(e){const t=new AbortController;this._loadingController=t;const r=e(t.signal);this._loadingPromise=r;const n=()=>{this._loadingController===t&&(this._loadingController=null),this._loadingPromise===r&&(this._loadingPromise=null)};return r.then(n,n),r}unload(){if(this._glTexture=(0,s.WD)(this._glTexture),null!=this._loadingController){const e=this._loadingController;this._loadingController=null,this._loadingPromise=null,e.abort()}this.events.emit("unloaded")}}function z(e){return e instanceof HTMLVideoElement?{width:e.videoWidth,height:e.videoHeight}:e}(D=F||(F={}))[D.HAVE_NOTHING=0]="HAVE_NOTHING",D[D.HAVE_METADATA=1]="HAVE_METADATA",D[D.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",D[D.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",D[D.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA";const H={wrap:{s:g.pF.REPEAT,t:g.pF.REPEAT},mipmap:!0,noUnpackFlip:!1,preMultiplyAlpha:!1,downsampleUncompressed:!1}},90553:function(e,t,r){r.d(t,{L:function(){return l},MX:function(){return a},O_:function(){return o},kL:function(){return c},vA:function(){return s},zH:function(){return u}});var n=r(1932);r(33400),(0,r(41546).vt)();class i{constructor(e){this.message=e}toString(){return`AssertException: ${this.message}`}}function s(e,t="Assertion"){if(!e){const e=new Error(t).stack;throw new i(`${t} at ${e}`)}}function a(e,t){e||(t=t||"",console.warn("Verify failed: "+t+"\n"+new Error("verify").stack))}function o(e,t,r,n){let i,s=(r[0]-e[0])/t[0],a=(n[0]-e[0])/t[0];s>a&&(i=s,s=a,a=i);let o=(r[1]-e[1])/t[1],l=(n[1]-e[1])/t[1];if(o>l&&(i=o,o=l,l=i),s>l||o>a)return!1;o>s&&(s=o),l<a&&(a=l);let c=(r[2]-e[2])/t[2],u=(n[2]-e[2])/t[2];return c>u&&(i=c,c=u,u=i),!(s>u||c>a||(u<a&&(a=u),a<0))}function l(e,t,r,i,s,a=(0,n.vt)()){const o=(i[s]-r[s])*(t[0]-e[0])-(i[0]-r[0])*(t[s]-e[s]),l=(i[0]-r[0])*(e[s]-r[s])-(i[s]-r[s])*(e[0]-r[0]);if(0===o)return!1;const c=l/o;return a[0]=e[0]+c*(t[0]-e[0]),a[1]=e[s]+c*(t[s]-e[s]),!0}function c(e,t){return Math.log(e)/Math.log(t)}function u(e){return 1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&1===e[15]}},69445:function(e,t,r){r.d(t,{Z:function(){return i}});var n=r(81438);class i extends n.Z{}},65839:function(e,t,r){var n;function i(e){return e===n.POSITION}r.d(t,{b:function(){return i},r:function(){return n}}),function(e){e.POSITION="position",e.NORMAL="normal",e.NORMALCOMPRESSED="normalCompressed",e.UV0="uv0",e.COLOR="color",e.SYMBOLCOLOR="symbolColor",e.SIZE="size",e.ROTATION="rotation",e.TANGENT="tangent",e.OFFSET="offset",e.PERSPECTIVEDIVIDE="perspectiveDivide",e.CENTEROFFSETANDDISTANCE="centerOffsetAndDistance",e.LENGTH="length",e.PREVPOSITION="prevPosition",e.NEXTPOSITION="nextPosition",e.SUBDIVISIONFACTOR="subdivisionFactor",e.COLORFEATUREATTRIBUTE="colorFeatureAttribute",e.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",e.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",e.DISTANCETOSTART="distanceToStart",e.UVMAPSPACE="uvMapSpace",e.BOUNDINGRECT="boundingRect",e.UVREGION="uvRegion",e.PROFILERIGHT="profileRight",e.PROFILEUP="profileUp",e.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",e.FEATUREVALUE="featureValue",e.INSTANCEMODELORIGINHI="instanceModelOriginHi",e.INSTANCEMODELORIGINLO="instanceModelOriginLo",e.INSTANCEMODEL="instanceModel",e.INSTANCEMODELNORMAL="instanceModelNormal",e.INSTANCECOLOR="instanceColor",e.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",e.LOCALTRANSFORM="localTransform",e.GLOBALTRANSFORM="globalTransform",e.BOUNDINGSPHERE="boundingSphere",e.MODELORIGIN="modelOrigin",e.MODELSCALEFACTORS="modelScaleFactors",e.FEATUREATTRIBUTE="featureAttribute",e.STATE="state",e.LODLEVEL="lodLevel",e.POSITION0="position0",e.POSITION1="position1",e.NORMAL2COMPRESSED="normal2Compressed",e.COMPONENTINDEX="componentIndex",e.VARIANTOFFSET="variantOffset",e.VARIANTSTROKE="variantStroke",e.VARIANTEXTENSION="variantExtension",e.SIDENESS="sideness",e.START="start",e.END="end",e.UP="up",e.START_UP="startUp",e.END_UP="endUp",e.EXTRUDE="extrude",e.OBJECTANDLAYERIDCOLOR="objectAndLayerIdColor",e.INSTANCEOBJECTANDLAYERIDCOLOR="instanceObjectAndLayerIdColor"}(n||(n={}))},54407:function(e,t,r){var n,i,s,a,o,l,c,u;r.d(t,{Am:function(){return a},C7:function(){return s},JS:function(){return u},Mg:function(){return l},dd:function(){return o},it:function(){return i},s2:function(){return n},sf:function(){return c}}),function(e){e[e.None=0]="None",e[e.Front=1]="Front",e[e.Back=2]="Back",e[e.COUNT=3]="COUNT"}(n||(n={})),function(e){e[e.Less=0]="Less",e[e.Lequal=1]="Lequal",e[e.COUNT=2]="COUNT"}(i||(i={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.UPDATE=1]="UPDATE"}(s||(s={})),function(e){e[e.NOT_LOADED=0]="NOT_LOADED",e[e.LOADING=1]="LOADING",e[e.LOADED=2]="LOADED"}(a||(a={})),function(e){e[e.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",e[e.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(o||(o={})),function(e){e[e.Highlight=0]="Highlight",e[e.MaskOccludee=1]="MaskOccludee"}(l||(l={})),function(e){e[e.Blend=0]="Blend",e[e.Opaque=1]="Opaque",e[e.Mask=2]="Mask",e[e.MaskBlend=3]="MaskBlend",e[e.COUNT=4]="COUNT"}(c||(c={})),function(e){e.DDS_ENCODING="image/vnd-ms.dds",e.KTX2_ENCODING="image/ktx2",e.BASIS_ENCODING="image/x.basis"}(u||(u={}))},59356:function(e,t,r){r.d(t,{i3:function(){return i}}),r(20551);var n=r(32501);function i(e){return null!=e?.dist}r(2075),r(38177),(0,n.vt)()},84363:function(e,t,r){r.d(t,{h:function(){return i}}),r(38177);var n=r(50456);r(59356);class i extends n.R6{constructor(e,t,r,n,i,s){super(e,t),this.layerUid=e,this.graphicUid=t,this.geometryId=r,this.triangleNr=n,this.baseBoundingSphere=i,this.numLodLevels=s}}},64543:function(e,t,r){r.d(t,{L:function(){return ue}});var n=r(53804),i=r(50659),s=r(39819),a=r(25738),o=r(95929),l=r(60539),c=r(23502),u=(r(58941),r(40633),r(65953)),d=r(39714),h=r(20551),f=r(32501),p=r(41546),m=r(70974),g=r(69550),_=r(65856),y=r(65631),v=r(27264),T=r(67521),b=r(40502),S=r(38177),A=r(35363),E=r(29165),w=r(90553),I=r(65839),x=r(83525),R=r(48996),M=r(44705),O=r(87725),C=r(73364),N=r(92754),L=r(76185),F=r(86305),D=r(85456);class P{constructor(e,t,r){this._elementSize=t,this._buffer=F.g.createVertex(e,D._U.STATIC_DRAW),this.resize(r)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get usedMemory(){return this._array.byteLength+this._buffer.usedMemory}copyRange(e,t,r,n=0){const i=new Uint8Array(this.array,e*this.elementSize,(t-e)*this.elementSize);new Uint8Array(r.array,n*this.elementSize).set(i)}transferAll(){this._buffer.setData(this._array)}transferRange(e,t){const r=e*this._elementSize,n=t*this._elementSize;this._buffer.setSubData(new Uint8Array(this._array),r,r,n)}resize(e){const t=e*this._elementSize,r=new ArrayBuffer(t);this._array&&(e>=this._capacity?new Uint8Array(r).set(new Uint8Array(this._array)):new Uint8Array(r).set(new Uint8Array(this._array).subarray(0,e*this._elementSize))),this._array=r,this._buffer.setSize(t),this._capacity=e}}class B{constructor(e){this.modelOriginHi=e.getField(I.r.INSTANCEMODELORIGINHI,N.xs),this.modelOriginLo=e.getField(I.r.INSTANCEMODELORIGINLO,N.xs),this.model=e.getField(I.r.INSTANCEMODEL,N.jZ),this.modelNormal=e.getField(I.r.INSTANCEMODELNORMAL,N.jZ),this.featureAttribute=e.getField(I.r.INSTANCEFEATUREATTRIBUTE,N.Eq),this.color=e.getField(I.r.INSTANCECOLOR,N.XP),this.objectAndLayerIdColor=e.getField(I.r.INSTANCEOBJECTANDLAYERIDCOLOR,N.XP)}}class U{constructor(e,t){this._rctx=e,this._instanceBufferLayout=t,this._headIndex=0,this._tailIndex=0,this._firstIndex=null,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const e=this._headIndex,t=this._tailIndex;return e>=t?e-t:e+this._capacity-t}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get usedMemory(){return this._buffer?.usedMemory??0}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCycle(){this._captureFirstIndex=!0}beginUpdate(){(0,w.vA)(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){(0,w.vA)(this._updating,"not updating"),this.size<i.$U*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){(0,w.vA)(this._updating,"not updating"),this.isFull&&this._grow();const e=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=e,this._captureFirstIndex=!1),this._incrementHead(),(0,w.vA)(this._headIndex!==this._tailIndex,"invalid pointers"),e}freeTail(){(0,w.vA)(this._updating,"not updating"),(0,w.vA)(this.size>0,"invalid size");const e=this._tailIndex===this._firstIndex;this._incrementTail(),e&&(this._firstIndex=this._tailIndex)}_grow(){const e=Math.max(G,Math.floor(this._capacity*i.Ji));this._resize(e)}_shrink(){const e=Math.max(G,Math.floor(this._capacity*i.He));this._resize(e)}_resize(e){if((0,w.vA)(this._updating,"not updating"),e===this._capacity)return;const t=new P(this._rctx,this._instanceBufferLayout.stride,e);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const e=this.size,r=this._compactInstances(t);(0,w.vA)(r===e,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=r,this._prevHeadIndex=0}this._resized=!0,this._capacity=e,this._buffer=t,this._view=new B(this._instanceBufferLayout.createView(this._buffer.array))}_compactInstances(e){const t=this._headIndex,r=this._tailIndex;return r<t?(this._buffer.copyRange(r,t,e),t-r):r>t?(this._buffer.copyRange(r,this._capacity,e),t>0&&this._buffer.copyRange(0,t,e,this._capacity-r),t+(this._capacity-r)):0}_incrementHead(e=1){this._headIndex=(this._headIndex+e)%this._capacity}_incrementTail(e=1){this._tailIndex=(this._tailIndex+e)%this._capacity}_transferRange(e,t){e<t?this._buffer.transferRange(e,t):e>t&&(t>0&&this._buffer.transferRange(0,t),this._buffer.transferRange(e,this._capacity))}}const G=64;var z,H;(H=z||(z={}))[H.ALLOCATED=1]="ALLOCATED",H[H.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",H[H.VISIBLE=4]="VISIBLE",H[H.HIGHLIGHT=8]="HIGHLIGHT",H[H.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",H[H.REMOVE=32]="REMOVE",H[H.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",H[H.ACTIVE=18]="ACTIVE";class V{constructor(e){this.localTransform=e.getField(I.r.LOCALTRANSFORM,N.E$),this.globalTransform=e.getField(I.r.GLOBALTRANSFORM,N.E$),this.modelOrigin=e.getField(I.r.MODELORIGIN,N.Xm),this.model=e.getField(I.r.INSTANCEMODEL,N.jZ),this.modelNormal=e.getField(I.r.INSTANCEMODELNORMAL,N.jZ),this.modelScaleFactors=e.getField(I.r.MODELSCALEFACTORS,N.gH),this.boundingSphere=e.getField(I.r.BOUNDINGSPHERE,N.Aj),this.featureAttribute=e.getField(I.r.FEATUREATTRIBUTE,N.Eq),this.color=e.getField(I.r.COLOR,N.XP),this.objectAndLayerIdColor=e.getField(I.r.OBJECTANDLAYERIDCOLOR,N.XP),this.state=e.getField(I.r.STATE,N.SL),this.lodLevel=e.getField(I.r.LODLEVEL,N.SL)}}let k=class extends x.A{constructor(e,t){super(e),this.events=new R.A,this._capacity=0,this._size=0,this._next=0,this._highlightGroupMap=new Map,this._highlightGroupMapPrev=new Map,this._layout=function(e){let t=(0,_.BP)().mat4f64(I.r.LOCALTRANSFORM).mat4f64(I.r.GLOBALTRANSFORM).vec4f64(I.r.BOUNDINGSPHERE).vec3f64(I.r.MODELORIGIN).mat3f(I.r.INSTANCEMODEL).mat3f(I.r.INSTANCEMODELNORMAL).vec2f(I.r.MODELSCALEFACTORS);return e.includes(I.r.FEATUREATTRIBUTE)&&(t=t.vec4f(I.r.FEATUREATTRIBUTE)),e.includes(I.r.COLOR)&&(t=t.vec4u8(I.r.COLOR)),e.includes(I.r.OBJECTANDLAYERIDCOLOR)&&(t=t.vec4u8(I.r.OBJECTANDLAYERIDCOLOR)),t=t.u8(I.r.STATE).u8(I.r.LODLEVEL),t}(t),this._capacity=G,this._buffer=this._layout.createBuffer(this._capacity),this._view=new V(this._buffer)}get capacity(){return this._capacity}get size(){return this._size}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const e=this._findSlot();return this._view.state.set(e,z.ALLOCATED),this._size++,this.events.emit("instances-changed"),e}removeInstance(e){const t=this._view.state;(0,w.vA)(e>=0&&e<this._capacity&&!!(t.get(e)&z.ALLOCATED),"invalid instance handle"),this._getStateFlag(e,z.ACTIVE)?this._setStateFlags(e,z.REMOVE):this.freeInstance(e),this.events.emit("instances-changed")}freeInstance(e){const t=this._view.state;(0,w.vA)(e>=0&&e<this._capacity&&!!(t.get(e)&z.ALLOCATED),"invalid instance handle"),t.set(e,0),this._size--}setLocalTransform(e,t,r=!0){this._view.localTransform.setMat(e,t),r&&this.updateModelTransform(e)}getLocalTransform(e,t){this._view.localTransform.getMat(e,t)}setGlobalTransform(e,t,r=!0){this._view.globalTransform.setMat(e,t),r&&this.updateModelTransform(e)}getGlobalTransform(e,t){this._view.globalTransform.getMat(e,t)}updateModelTransform(e){const t=this._view,r=j,n=Z;t.localTransform.getMat(e,q),t.globalTransform.getMat(e,W);const i=(0,C.lw)(W,W,q);(0,h.i)(r,i[12],i[13],i[14]),t.modelOrigin.setVec(e,r),(0,M.z0)(n,i),t.model.setMat(e,n);const s=(0,L.wp)(j,i);s.sort(),t.modelScaleFactors.set(e,0,s[1]),t.modelScaleFactors.set(e,1,s[2]),(0,M.B8)(n,n),(0,M.mg)(n,n),t.modelNormal.setMat(e,n),this._setStateFlags(e,z.TRANSFORM_CHANGED),this.events.emit("instance-transform-changed",{index:e})}getModelTransform(e,t){const r=this._view;r.model.getMat(e,Z),r.modelOrigin.getVec(e,j),t[0]=Z[0],t[1]=Z[1],t[2]=Z[2],t[3]=0,t[4]=Z[3],t[5]=Z[4],t[6]=Z[5],t[7]=0,t[8]=Z[6],t[9]=Z[7],t[10]=Z[8],t[11]=0,t[12]=j[0],t[13]=j[1],t[14]=j[2],t[15]=1}applyShaderTransformation(e,t){null!=this.shaderTransformation&&this.shaderTransformation.applyTransform(this,e,t)}getCombinedModelTransform(e,t){return this.getModelTransform(e,t),null!=this.shaderTransformation&&this.shaderTransformation.applyTransform(this,e,t),t}getCombinedLocalTransform(e,t){this._view.localTransform.getMat(e,t),null!=this.shaderTransformation&&this.shaderTransformation.applyTransform(this,e,t)}getCombinedMaxScaleFactor(e){let t=this._view.modelScaleFactors.get(e,1);return null!=this.shaderTransformation&&(this.shaderTransformation.scaleFactor(j,this,e),t*=Math.max(j[0],j[1],j[2])),t}getCombinedMedianScaleFactor(e){let t=this._view.modelScaleFactors.get(e,0);return null!=this.shaderTransformation&&(this.shaderTransformation.scaleFactor(j,this,e),t*=function(e,t,r){return Math.max(Math.min(e,t),Math.min(Math.max(e,t),r))}(j[0],j[1],j[2])),t}getModel(e,t){this._view.model.getMat(e,t)}setFeatureAttribute(e,t){this._view.featureAttribute.setVec(e,t)}getFeatureAttribute(e,t){this._view.featureAttribute.getVec(e,t)}setColor(e,t){this._view.color.setVec(e,t)}setObjectAndLayerIdColor(e,t){this._view.objectAndLayerIdColor.setVec(e,t)}setVisible(e,t){t!==this.getVisible(e)&&(this._setStateFlag(e,z.VISIBLE,t),this.events.emit("instance-visibility-changed",{index:e}))}getVisible(e){return this._getStateFlag(e,z.VISIBLE)}setHighlight(e,t,r){let n=this._highlightGroupMap.get(e);t?(n||(n=new Set,this._highlightGroupMap.set(e,n)),n.add(r)&&(this._setStateFlag(e,z.HIGHLIGHT,!0),this.events.emit("instance-highlight-changed"))):n?.delete(r)&&(0===n.size&&(this._highlightGroupMap.delete(e),this._setStateFlag(e,z.HIGHLIGHT,!1)),this.events.emit("instance-highlight-changed"))}getHighlight(e){return this._getStateFlag(e,z.HIGHLIGHT)}foreachHighlightGroupPrev(e,t){this._highlightGroupMapPrev.get(e)?.forEach(t),this._highlightGroupMapPrev.delete(e)}foreachHighlightGroup(e,t){const r=this._highlightGroupMap.get(e);r?.forEach(t),r?this._highlightGroupMapPrev.set(e,new Set(r)):this._highlightGroupMapPrev.delete(e)}getState(e){return this._view.state.get(e)}getLodLevel(e){return this._view.lodLevel.get(e)}countFlags(e){let t=0;for(let r=0;r<this._capacity;++r)this.getState(r)&e&&++t;return t}_setStateFlags(e,t){const r=this._view.state;t=r.get(e)|t,r.set(e,t)}_clearStateFlags(e,t){const r=this._view.state;t=r.get(e)&~t,r.set(e,t)}_setStateFlag(e,t,r){r?this._setStateFlags(e,t):this._clearStateFlags(e,t)}_getStateFlag(e,t){return!!(this._view.state.get(e)&t)}_grow(){this._capacity=Math.max(G,Math.floor(this._capacity*i.Ji)),this._buffer=this._layout.createBuffer(this._capacity).copyFrom(this._buffer),this._view=new V(this._buffer)}_findSlot(){const e=this._view.state;let t=this._next;for(;e.get(t)&z.ALLOCATED;)t=t+1===this._capacity?0:t+1;return this._next=t+1===this._capacity?0:t+1,t}};(0,n._)([(0,c.MZ)({constructOnly:!0})],k.prototype,"shaderTransformation",void 0),(0,n._)([(0,c.MZ)()],k.prototype,"_size",void 0),(0,n._)([(0,c.MZ)({readOnly:!0})],k.prototype,"size",null),k=(0,n._)([(0,u.$)("esri.views.3d.webgl-engine.lib.lodRendering.InstanceData")],k);const j=(0,f.vt)(),Z=(0,O.vt)(),q=(0,d.vt)(),W=(0,d.vt)();var Y=r(13794);class $ extends A.A{constructor(e,t){super((e=>(0,Y.w)(this._instanceData.view.boundingSphere.getVec(e,this._tmpSphere))),{maximumDepth:25}),this._instanceData=e,this._boundingSphere=t,this._tmpSphere=(0,Y.c)(),this._tmpMat4=(0,d.vt)()}addInstance(e){const t=this._instanceData.view.boundingSphere,r=this._instanceData.getCombinedModelTransform(e,this._tmpMat4);(0,h.t)((0,Y.a)(this._tmpSphere),this._boundingSphere.center,r),this._tmpSphere[3]=this._boundingSphere.radius*(0,L.hG)(r),t.setVec(e,this._tmpSphere),this.add([e])}removeInstance(e){this.remove([e])}}class X{constructor(e,t){this._worldSpaceRadius=e,this._minScreenSpaceRadii=t}selectLevel(e,t,r){const n=r.computeScreenPixelSizeAt(e),i=this._worldSpaceRadius*t/n;let s=0;for(let e=1;e<this._minScreenSpaceRadii.length;++e)i>=this._minScreenSpaceRadii[e]&&(s=e);return s}}var J=r(24761),Q=r(48015),K=r(52798),ee=r(49845),te=r(69445),re=r(84363);class ne{constructor(e,t){const r=e.renderContext.rctx,n=t.geometry;let i=null;i=n instanceof Q.J?function(e,t,r,n=null){const i=e.createBufferWriter(),s=i.vertexBufferLayout,a=i.elementCount(t),o=s.createBuffer(a);return i.write(null,null,t,n,o,0),{material:e,vertexBufferLayout:s,buffer:o.buffer,elementCount:a,boundingInfo:r}}(n.material,n.attributes,n.boundingInfo):n;const s=i.material;this._materials=e.materials,s.setParameters({instancedDoublePrecision:!0}),this.geometry=n,this.material=s,this.glMaterials=new K.c(s,this._materials),this.vertexBufferLayout=i.vertexBufferLayout,this.vbo=F.g.createVertex(r,D._U.STATIC_DRAW,i.buffer),this.vao=new te.Z(r,b.D,new Map([["geometry",(0,g.U)(i.vertexBufferLayout)]]),new Map([["geometry",this.vbo]])),this.vertexCount=i.elementCount}destroy(){this.glMaterials.dispose(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(e,t,r,n,i,s,a,o){if(!(this.geometry instanceof Q.J))return;const l=this.geometry.id;this.material.intersect(this.geometry,e.transform.transform,e,r,n,((r,n,c,u,d)=>{if(r>=0){if(null!=t&&!t(e.rayBegin,e.rayEnd,r))return;const u=new re.h(s.layerUid,s.graphicUid(i),l,c,a,o);if((null==e.results.min.drapedLayerOrder||d>=e.results.min.drapedLayerOrder)&&(null==e.results.min.dist||r<e.results.min.dist)&&e.results.min.set(S.dz.LOD,u,r,n,e.transform.transform,d),e.options.store!==S.oH.MIN&&(null==e.results.max.drapedLayerOrder||d>=e.results.max.drapedLayerOrder)&&(null==e.results.max.dist||r>e.results.max.dist)&&e.results.max.set(S.dz.LOD,u,r,n,e.transform.transform,d),e.options.store===S.oH.ALL){const t=(0,ee.G7)(e.results.min.ray);t.set(S.dz.LOD,u,r,n,e.transform.transform,d),e.results.all.push(t)}}}))}}class ie{static async create(e,t,r){const n=await Promise.allSettled(t.components.map((t=>e.controller.schedule((()=>new ne(e,t)),r)))),s=n.map((e=>"fulfilled"===e.status?e.value:null)).filter(i.Ru);if((0,l.G4)(r)||s.length!==n.length){s.forEach((e=>e.destroy())),(0,l.Te)(r);for(const e of n)if("rejected"===e.status)throw e.reason}return new ie(t.minScreenSpaceRadius,s)}constructor(e,t){this.minScreenSpaceRadius=e,this.components=t}destroy(){this.components.forEach((e=>e.destroy()))}intersect(e,t,r,n,i,s,a){this.components.forEach((o=>o.intersect(e,t,r,n,i,s,this.boundingSphere,a)))}get boundingBox(){if(null==this._boundingBox){const e=(0,J.Ie)();this.components.forEach((t=>{null!=t.boundingInfo&&((0,J.iT)(e,t.boundingInfo.bbMin),(0,J.iT)(e,t.boundingInfo.bbMax))})),this._boundingBox=e}return this._boundingBox}get boundingSphere(){if(null==this._boundingSphere){const e=this.boundingBox,t=(0,f.vt)();(0,J.gX)(e,t),this._boundingSphere={center:t,radius:.5*(0,J._F)(e)}}return this._boundingSphere}get triangleCount(){return this.components.reduce(((e,t)=>e+t.triangleCount),0)}}var se=r(84887),ae=r(84738),oe=r(77032),le=r(48961),ce=r(93380);let ue=class extends T.Cc{constructor(e,t){super(e),this.type=S.dz.LOD,this.isGround=!1,this._levels=[],this._defaultRenderInstanceData=new Array,this._highlightRenderInstanceDataMap=new Map,this._instanceIndex=0,this._cycleStartIndex=0,this._slicePlane=!1,this._camera=new y.A,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.produces=new Map([[E.N.OPAQUE_MATERIAL,e=>this._produces(e)],[E.N.TRANSPARENT_MATERIAL,e=>!!this._hasTransparentLevels()&&this._produces(e)]]),this._instanceData=new k({shaderTransformation:e.shaderTransformation},e.optionalFields),this.addHandles(t.registerTask(le.W6.LOD_RENDERER,this))}initialize(){this._instanceBufferLayout=function(e){let t=(0,_.BP)().vec3f(I.r.INSTANCEMODELORIGINHI).vec3f(I.r.INSTANCEMODELORIGINLO).mat3f(I.r.INSTANCEMODEL).mat3f(I.r.INSTANCEMODELNORMAL);return null!=e&&e.includes("featureAttribute")&&(t=t.vec4f(I.r.INSTANCEFEATUREATTRIBUTE)),null!=e&&e.includes("color")&&(t=t.vec4u8(I.r.INSTANCECOLOR)),null!=e&&e.includes("objectAndLayerIdColor")&&(t=t.vec4u8(I.r.INSTANCEOBJECTANDLAYERIDCOLOR)),t}(this.optionalFields),this._glInstanceBufferLayout=(0,g.U)(this._instanceBufferLayout,1),this.addHandles([this._instanceData.events.on("instances-changed",(()=>this._requestUpdateCycle())),this._instanceData.events.on("instance-transform-changed",(({index:e})=>{this._requestUpdateCycle(),this.metadata.notifyGraphicGeometryChanged(e)})),this._instanceData.events.on("instance-visibility-changed",(({index:e})=>{this._requestUpdateCycle(!0),this.metadata.notifyGraphicVisibilityChanged(e)})),this._instanceData.events.on("instance-highlight-changed",(()=>this._requestUpdateCycle(!0)))])}get _allRenderInstanceData(){const e=[this._defaultRenderInstanceData];for(const t of this._highlightRenderInstanceDataMap)e.push(t[1]);return e}get _enableLevelSelection(){return this.symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(e){this._slicePlane=e}get layerUid(){return this.metadata.layerUid}get instanceData(){return this._instanceData}get hasEmissions(){return this.baseMaterial.hasEmissions}get usedMemory(){return this._allRenderInstanceData.reduce(((e,t)=>t.reduce(((e,t)=>e+t.usedMemory),e)),0)}get renderStats(){const e=this._instanceData.size,t=[];return this._levels.forEach(((e,r)=>{const n=this._allRenderInstanceData[0][r].size+this._allRenderInstanceData[1][r].size,i=e.triangleCount;t.push({renderedInstances:n,renderedTriangles:n*i,trianglesPerInstance:i})})),{totalInstances:e,renderedInstances:t.reduce(((e,t)=>e+t.renderedInstances),0),renderedTriangles:t.reduce(((e,t)=>e+t.renderedTriangles),0),levels:t}}_createRenderInstanceDataArray(e=[]){const{rctx:t}=this._context.renderContext;return this.symbol.levels.map((r=>{e.push(new U(t,this._instanceBufferLayout))})),e}async initializeRenderContext(e,t){this._context=e,this._createRenderInstanceDataArray(this._defaultRenderInstanceData);const r=await Promise.allSettled(this.symbol.levels.map((r=>ie.create(e,r,t)))),n=r.map((e=>"fulfilled"===e.status?e.value:null)).filter(i.Ru);if((0,l.G4)(t)||n.length!==r.length){n.forEach((e=>e.destroy())),(0,l.Te)(t);for(const e of r)if("rejected"===e.status)throw e.reason}this._levels=n,this._levelSelector=(e=>{const t=e.baseBoundingSphere.radius,r=e.levels.map((e=>e.minScreenSpaceRadius));return new X(t,r)})(this)}uninitializeRenderContext(){this._invalidateOctree(),this._levels.forEach((e=>e.destroy())),this._defaultRenderInstanceData.forEach((e=>e.destroy())),this._highlightRenderInstanceDataMap.forEach((e=>e.forEach((e=>e.destroy()))))}_hasTransparentLevels(){return this._levels.some((e=>e.components.some((e=>{const t=e.material.produces.get(E.N.TRANSPARENT_MATERIAL);return t?.(v.V.Color)}))))}hasHighlights(){return(0,a.Bs)(this._highlightRenderInstanceDataMap,(e=>e.some((e=>e.size>0))))}_produces(e){return e!==v.V.Highlight&&e!==v.V.ShadowHighlight||this.hasHighlights()}prepareRender(e){if(!m.b.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){const t=e.bind.contentCamera.equals(this._camera);this._camera.copyFrom(e.bind.contentCamera),t||this._requestUpdateCycle()}this._needFullCycle&&(this.runTask(le.Bb),this._needFullCycle=!1)}}acquireTechniques(e){if(!this.baseMaterial.visible||!this.baseMaterial.isVisibleForOutput(e.output))return null;const t=this._getInstanceDatas(e);if(!t)return null;const r=new Array,n=this.levels;return t.forEach((t=>n.forEach((({components:n},i)=>n.forEach((n=>r.push(this._beginComponent(e,t[i],n)))))))),r}render(e,t){const r=this._getInstanceDatas(e);if(!r||null==t)return;let n=0;e.rctx.bindVAO();const i=this.levels;r.forEach((r=>i.forEach((({components:i},s)=>i.forEach((i=>this._renderComponent(e,t[n++],r[s],i,s)))))))}_getInstanceDatas(e){const{output:t,bind:r}=e,n=t===v.V.Highlight,i=!n&&t!==v.V.ShadowHighlight,s=t!==v.V.ShadowExcludeHighlight;if(i)return s?this._allRenderInstanceData:[this._defaultRenderInstanceData];if(s){if(n){const{highlightGroupName:e}=r;if(!e)return null;const t=this._highlightRenderInstanceDataMap.get(e);return t?[t]:null}const e=[];for(const t of this._highlightRenderInstanceDataMap)e.push(t[1]);return e}return null}intersect(e,t,r,n){if(!this.baseMaterial.visible||null==this._octree)return;const i=(0,f.vt)();(0,h.d)(i,n,r);const s=i=>{this._instanceData.getCombinedModelTransform(i,pe),e.transform.set(pe),(0,h.t)(me,r,e.transform.inverse),(0,h.t)(ge,n,e.transform.inverse);const s=this._instanceData.getState(i),a=this._instanceData.getLodLevel(i),o=this._levels.length;(0,w.vA)(!!(s&z.ACTIVE),"invalid instance state"),(0,w.vA)(a>=0&&a<o,"invaid lod level"),this._levels[a].intersect(e,t,me,ge,i,this.metadata,o)};this.baseMaterial.parameters.verticalOffset?this._octree.forEach(s):this._octree.forEachAlongRay(r,i,s)}notifyShaderTransformationChanged(){this._invalidateOctree(),this._requestUpdateCycle()}get _octree(){if(null==this._octreeCached){const e=this._instanceData,t=e.view?.state;if(!t)return null;this._octreeCached=new $(e,this.baseBoundingSphere);for(let r=0;r<e.capacity;++r)t.get(r)&z.ACTIVE&&this._octreeCached.addInstance(r)}return this._octreeCached}_invalidateOctree(){this._octreeCached=(0,o.pR)(this._octreeCached)}queryDepthRange(e){if(null==this._octree)return{near:1/0,far:-1/0};const t=e.viewForward,r=this._octree.findClosest(t,A.A.DepthOrder.FRONT_TO_BACK,e.frustum),n=this._octree.findClosest(t,A.A.DepthOrder.BACK_TO_FRONT,e.frustum);if(null==r||null==n)return{near:1/0,far:-1/0};const i=e.eye,s=this._instanceData.view;s.boundingSphere.getVec(r,fe),(0,h.d)(fe,fe,i);const a=(0,h.f)(fe,t)-fe[3];s.boundingSphere.getVec(n,fe),(0,h.d)(fe,fe,i);const o=(0,h.f)(fe,t)+fe[3];return{near:Math.max(e.near,a),far:Math.min(e.far,o)}}_requestUpdateCycle(e=!1){this._updateCyclesWithStaticCamera=-1,this._cycleStartIndex=this._instanceIndex,e&&(this._needFullCycle=!0,this._context.requestRender())}_startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._allRenderInstanceData.forEach((e=>e.forEach((e=>e.startUpdateCycle()))))}get running(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}runTask(e){const{_enableLevelSelection:t,_camera:r,_levelSelector:n}=this;this._allRenderInstanceData.forEach((e=>e.forEach((e=>e.beginUpdate()))));const i=this._instanceData,a=i.view;let o=i.size;const l=i.capacity;let c=this._instanceIndex;const u=Math.ceil(l/500);for(let d=0;d<o&&!e.done;++d){c===this._cycleStartIndex&&this._startUpdateCycle();const d=a.state.get(c);let h=0;if(!(d&z.ALLOCATED)){c=c+1===l?0:c+1,o++;continue}const f=a.lodLevel.get(c);if(d&z.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[f].freeTail(),d&z.HIGHLIGHT_ACTIVE&&i.foreachHighlightGroupPrev(c,(e=>{const t=this._highlightRenderInstanceDataMap.get(e);if(!t)throw new s.A("Internal error in lodRenderer");t[f].freeTail()})),d&z.REMOVE)i.freeInstance(c);else if(d&z.VISIBLE){let e=0;t&&(a.modelOrigin.getVec(c,he),e=n.selectLevel(he,i.getCombinedMedianScaleFactor(c),r)),h=d&~(z.ACTIVE|z.TRANSFORM_CHANGED),e>=0&&(d&z.HIGHLIGHT?(i.foreachHighlightGroup(c,(t=>{let r=this._highlightRenderInstanceDataMap.get(t);if(r||(r=this._createRenderInstanceDataArray(),r.forEach((e=>e.beginUpdate())),this._highlightRenderInstanceDataMap.set(t,r)),e>=r.length)throw new s.A(`LodRenderer internal error - missing lodLevel ${e}`);de(r[e],a,c)})),h|=z.HIGHLIGHT_ACTIVE):(de(this._defaultRenderInstanceData[e],a,c),h|=z.DEFAULT_ACTIVE)),a.state.set(c,h),a.lodLevel.set(c,e)}else h=d&~(z.ACTIVE|z.TRANSFORM_CHANGED),a.state.set(c,h);if(null!=this._octreeCached){const e=!!(d&z.ACTIVE),t=!!(h&z.ACTIVE);!e&&t?this._octreeCached.addInstance(c):e&&!t?this._octreeCached.removeInstance(c):e&&t&&d&z.TRANSFORM_CHANGED&&(this._octreeCached.removeInstance(c),this._octreeCached.addInstance(c))}c=c+1===l?0:c+1,c%u==0&&e.madeProgress()}this._instanceIndex=c,this._allRenderInstanceData.forEach((e=>e.forEach((e=>e.endUpdate())))),this._context.requestRender()}_beginComponent(e,t,r){if(0===t.size)return null;const n=r.glMaterials.load(e.rctx,e.bind.slot,e.output);return n?.beginSlot(e.bind)}_renderComponent(e,t,r,n,i){if(!t)return;const{bind:s,rctx:a}=e;a.runAppleAmdDriverHelper();const o=a.bindTechnique(t,s,n.material.parameters,ye);a.bindVAO(n.vao),t.ensureAttributeLocations(n.vao),m.b.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&e.output===v.V.Color&&(o.setUniform4fv("externalColor",_e[Math.min(i,_e.length-1)]),o.setUniform1i("colorMixMode",se.Um.replace));const l=r.capacity,c=r.headIndex,u=r.tailIndex,d=r.firstIndex,h=this._glInstanceBufferLayout,f=(e,i)=>{(0,ce.yu)(a,b.D,r.buffer,h,e),a.drawArraysInstanced(t.primitiveType,0,n.vertexCount,i-e),(0,ce.Hi)(a,b.D,r.buffer,h)};n.material.parameters.transparent&&null!=d?c>u?((0,w.vA)(d>=u&&d<=c,"invalid firstIndex"),f(d,c),f(u,d)):c<u&&(d<=c?((0,w.vA)(d>=0&&d<=c,"invalid firstIndex"),f(d,c),f(u,l),f(0,d)):((0,w.vA)(d>=u&&d<=l,"invalid firstIndex"),f(d,l),f(0,c),f(u,d))):c>u?f(u,c):c<u&&(f(0,c),f(u,l)),a.bindVAO(null)}};function de(e,t,r){const n=e.allocateHead();!function(e,t,r,n){(0,ae.Vk)(e.modelOrigin,t,r.modelOriginHi,r.modelOriginLo,n),r.model.copyFrom(n,e.model,t),r.modelNormal.copyFrom(n,e.modelNormal,t),e.color&&r.color&&r.color.copyFrom(n,e.color,t),e.objectAndLayerIdColor&&r.objectAndLayerIdColor&&r.objectAndLayerIdColor.copyFrom(n,e.objectAndLayerIdColor,t),e.featureAttribute&&r.featureAttribute&&r.featureAttribute.copyFrom(n,e.featureAttribute,t)}(t,r,e.view,n)}(0,n._)([(0,c.MZ)({constructOnly:!0})],ue.prototype,"symbol",void 0),(0,n._)([(0,c.MZ)({constructOnly:!0})],ue.prototype,"optionalFields",void 0),(0,n._)([(0,c.MZ)({constructOnly:!0})],ue.prototype,"metadata",void 0),(0,n._)([(0,c.MZ)({constructOnly:!0})],ue.prototype,"shaderTransformation",void 0),(0,n._)([(0,c.MZ)()],ue.prototype,"_instanceData",void 0),(0,n._)([(0,c.MZ)()],ue.prototype,"_cycleStartIndex",void 0),(0,n._)([(0,c.MZ)({readOnly:!0})],ue.prototype,"_enableLevelSelection",null),(0,n._)([(0,c.MZ)()],ue.prototype,"_updateCyclesWithStaticCamera",void 0),(0,n._)([(0,c.MZ)({readOnly:!0})],ue.prototype,"running",null),ue=(0,n._)([(0,u.$)("esri.views.3d.webgl-engine.lib.lodRendering.LodRenderer")],ue);const he=(0,f.vt)(),fe=(0,p.vt)(),pe=(0,d.vt)(),me=(0,f.vt)(),ge=(0,f.vt)(),_e=[(0,p.fA)(1,0,1,1),(0,p.fA)(0,0,1,1),(0,p.fA)(0,1,0,1),(0,p.fA)(1,1,0,1),(0,p.fA)(1,0,0,1)],ye=new oe.V},68335:function(e,t,r){r.d(t,{Fe:function(){return l},XT:function(){return d},hr:function(){return o},iC:function(){return a},lS:function(){return c},n3:function(){return u}});var n=r(50659),i=r(48015),s=r(65839);class a{constructor(e,t=null){this.geometry=e,this.textures=t}get material(){return this.geometry.material}get numTriangles(){return this.geometry instanceof i.J?this.geometry.indexCount/3:this.geometry.elementCount/3}}class o{constructor(e,t,r){this.components=e,this.minScreenSpaceRadius=t,this.pivotOffset=r;const a=(0,n.Am)(this.components.map((e=>e.geometry)));this.numVertices=a.reduce(((e,t)=>e+function(e){return e instanceof i.J?e.attributes.get(s.r.POSITION).indices.length:e.elementCount}(t)),0)}}class l{constructor(e){this.levels=e,this.levels.sort(((e,t)=>e.minScreenSpaceRadius===t.minScreenSpaceRadius?e.numVertices-t.numVertices:e.minScreenSpaceRadius-t.minScreenSpaceRadius))}}function c(e){const t=[];return e.levels.forEach((e=>e.components.forEach((e=>t.push(e.geometry.material))))),(0,n.Am)(t)}function u(e){const t=new Array;return e.levels.forEach((e=>e.components.forEach((e=>{null!=e.textures&&t.push(...e.textures)})))),(0,n.Am)(t)}function d(e){const t=new Array;return e.levels.forEach((e=>e.components.forEach((e=>{e.geometry instanceof i.J&&t.push(e.geometry)})))),(0,n.Am)(t)}},57701:function(e,t,r){r.d(t,{$T:function(){return o},zj:function(){return i}});var n,i,s,a=r(23545);function o(e){const t=new Map,r=e=>{let r=t.get(e);return r||(r=new a.a0,t.set(e,r)),r};return e.removes.forAll((e=>{l(e)&&r(e.material).removes.push(e)})),e.adds.forAll((e=>{l(e)&&r(e.material).adds.push(e)})),e.updates.forAll((e=>{l(e.renderGeometry)&&r(e.renderGeometry.material).updates.push(e)})),t}function l(e){return e.geometry.indexCount>=1}(s=n||(n={}))[s.Default=0]="Default",s[s.Screenshot=1]="Screenshot",s[s.ObjectAndLayerID=2]="ObjectAndLayerID",function(e){e[e.TOP=0]="TOP",e[e.RIGHT=1]="RIGHT",e[e.BOTTOM=2]="BOTTOM",e[e.LEFT=3]="LEFT"}(i||(i={}))},54035:function(e,t,r){r.d(t,{MD:function(){return l},cJ:function(){return o},hs:function(){return c},m0:function(){return a}});var n=r(15774),i=(r(2075),r(13794));function s(e,t,r){const n=r.parameters;return u.scale=Math.min(n.divisor/(t-n.offset),1),u.factor=function(e){return Math.abs(e*e*e)}(e),u}function a(e,t){return(0,n.Cc)(e*Math.max(t.scale,t.minScaleFactor),e,t.factor)}function o(e,t,r,n){n.scale=function(e,t,r){const n=s(e,t,r);return n.minScaleFactor=0,a(1,n)}(e,t,r),n.factor=0,n.minScaleFactor=r.minScaleFactor}function l(e,t,r=[0,0]){const n=Math.min(Math.max(t.scale,t.minScaleFactor),1);return r[0]=e[0]*n,r[1]=e[1]*n,r}function c(e,t,r,n){return a(e,s(t,r,n))}r(65420),(0,n.kU)(10),(0,n.kU)(12),(0,n.kU)(70),(0,n.kU)(40);const u={scale:0,factor:0,minScaleFactor:0};(0,i.c)()},12569:function(e,t,r){r.d(t,{IR:function(){return o},Mv:function(){return s},uT:function(){return a},vM:function(){return l}});var n=r(39819);const i=16;function s(e){return Math.ceil(e/i)*i}function a(e){return Math.floor(e/i)*i}function o(e,t){let r=e.width*e.height;if(r<4096)return e instanceof ImageData?u(e):e;let n=e.width,i=e.height;do{n=Math.ceil(n/2),i=Math.ceil(i/2),r=n*i}while(r>1048576||null!=t&&(n>t||i>t));return c(e,n,i)}function l(e,t){const r=Math.max(e.width,e.height);if(r<=t)return e;const n=t/r;return c(e,Math.round(e.width*n),Math.round(e.height*n))}function c(e,t,r){if(e instanceof ImageData)return c(u(e),t,r);const n=document.createElement("canvas");return n.width=t,n.height=r,n.getContext("2d").drawImage(e,0,0,n.width,n.height),n}function u(e){const t=document.createElement("canvas");t.width=e.width,t.height=e.height;const r=t.getContext("2d");if(null==r)throw new n.A("Failed to create 2d context from HTMLCanvasElement");return r.putImageData(e,0,0),t}},22323:function(e,t,r){r.d(t,{dg:function(){return h},ou:function(){return m}});var n=r(44705),i=r(87725),s=r(73364),a=r(39714),o=r(20551),l=r(32501),c=r(13794),u=r(65420),d=r(89765);class h{constructor(){this._transform=(0,a.vt)(),this._transformInverse=new f({value:this._transform},s.B8,a.vt),this._transformInverseTranspose=new f(this._transformInverse,s.mg,a.vt),this._transformTranspose=new f({value:this._transform},s.mg,a.vt),this._transformInverseRotation=new f({value:this._transform},n.dR,i.vt)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(e){(0,s.C)(this._transform,e)}multiplyTransform(e){(0,s.lw)(this._transform,this._transform,e)}set(e){(0,s.C)(this._transform,e),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(e,t){this.setTransformMatrix(e),this.multiplyTransform(t),this._invalidateLazyTransforms()}}class f{constructor(e,t,r){this._original=e,this._update=t,this._dirty=!0,this._transform=r()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}}const p=new class{constructor(e=0){this.offset=e,this.sphere=(0,c.c)(),this.tmpVertex=(0,l.vt)()}applyToVertex(e,t,r){const n=this.objectTransform.transform,i=(0,o.i)(g,e,t,r),s=(0,o.t)(i,i,n),a=this.offset/(0,o.l)(s);(0,o.b)(s,s,s,a);const l=this.objectTransform.inverse;return(0,o.t)(this.tmpVertex,s,l),this.tmpVertex}applyToMinMax(e,t){const r=this.offset/(0,o.l)(e);(0,o.b)(e,e,e,r);const n=this.offset/(0,o.l)(t);(0,o.b)(t,t,t,n)}applyToAabb(e){const t=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*t,e[1]+=e[1]*t,e[2]+=e[2]*t;const r=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*r,e[4]+=e[4]*r,e[5]+=e[5]*r,e}applyToBoundingSphere(e){const t=(0,o.l)((0,c.a)(e)),r=this.offset/t;return(0,o.b)((0,c.a)(this.sphere),(0,c.a)(e),(0,c.a)(e),r),this.sphere[3]=e[3]+e[3]*this.offset/t,this.sphere}};function m(e){return null!=e?(p.offset=e,p):null}new class{constructor(e=0){this.componentLocalOriginLength=0,this._totalOffset=0,this._offset=0,this._tmpVertex=(0,l.vt)(),this._tmpMbs=(0,c.c)(),this._tmpObb=new d.ab,this._resetOffset(e)}_resetOffset(e){this._offset=e,this._totalOffset=e}set offset(e){this._resetOffset(e)}get offset(){return this._offset}set componentOffset(e){this._totalOffset=this._offset+e}set localOrigin(e){this.componentLocalOriginLength=(0,o.l)(e)}applyToVertex(e,t,r){const n=(0,o.i)(g,e,t,r),i=(0,o.i)(_,e,t,r+this.componentLocalOriginLength),s=this._totalOffset/(0,o.l)(i);return(0,o.b)(this._tmpVertex,n,i,s),this._tmpVertex}applyToAabb(e){const t=this.componentLocalOriginLength,r=e[0],n=e[1],i=e[2]+t,s=e[3],a=e[4],o=e[5]+t,l=Math.abs(r),c=Math.abs(n),u=Math.abs(i),d=Math.abs(s),h=Math.abs(a),f=Math.abs(o),p=.5*(1+Math.sign(r*s))*Math.min(l,d),m=.5*(1+Math.sign(n*a))*Math.min(c,h),g=.5*(1+Math.sign(i*o))*Math.min(u,f),_=Math.max(l,d),y=Math.max(c,h),v=Math.max(u,f),T=Math.sqrt(p*p+m*m+g*g),b=Math.sign(l+r),S=Math.sign(c+n),A=Math.sign(u+i),E=Math.sign(d+s),w=Math.sign(h+a),I=Math.sign(f+o),x=this._totalOffset;if(T<x)return e[0]-=(1-b)*x,e[1]-=(1-S)*x,e[2]-=(1-A)*x,e[3]+=E*x,e[4]+=w*x,e[5]+=I*x,e;const R=x/Math.sqrt(_*_+y*y+v*v),M=x/T,O=M-R,C=-O;return e[0]+=r*(b*C+M),e[1]+=n*(S*C+M),e[2]+=i*(A*C+M),e[3]+=s*(E*O+R),e[4]+=a*(w*O+R),e[5]+=o*(I*O+R),e}applyToMbs(e){const t=(0,o.l)((0,c.a)(e)),r=this._totalOffset/t;return(0,o.b)((0,c.a)(this._tmpMbs),(0,c.a)(e),(0,c.a)(e),r),this._tmpMbs[3]=e[3]+e[3]*this._totalOffset/t,this._tmpMbs}applyToObb(e){return(0,d.gm)(e,this._totalOffset,this._totalOffset,u.RT.Global,this._tmpObb),this._tmpObb}},new class{constructor(e=0){this.offset=e,this.tmpVertex=(0,l.vt)()}applyToVertex(e,t,r){const n=(0,o.i)(g,e,t,r),i=(0,o.g)(_,n,this.localOrigin),s=this.offset/(0,o.l)(i);return(0,o.b)(this.tmpVertex,n,i,s),this.tmpVertex}applyToAabb(e){const t=y,r=v,n=T;for(let i=0;i<3;++i)t[i]=e[0+i]+this.localOrigin[i],r[i]=e[3+i]+this.localOrigin[i],n[i]=t[i];const i=this.applyToVertex(t[0],t[1],t[2]);for(let t=0;t<3;++t)e[t]=i[t],e[t+3]=i[t];const s=t=>{const r=this.applyToVertex(t[0],t[1],t[2]);for(let t=0;t<3;++t)e[t]=Math.min(e[t],r[t]),e[t+3]=Math.max(e[t+3],r[t])};for(let e=1;e<8;++e){for(let i=0;i<3;++i)n[i]=e&1<<i?r[i]:t[i];s(n)}let a=0;for(let e=0;e<3;++e)t[e]*r[e]<0&&(a|=1<<e);if(0!==a&&7!==a)for(let e=0;e<8;++e)if(!(a&e)){for(let i=0;i<3;++i)n[i]=a&1<<i?0:e&1<<i?t[i]:r[i];s(n)}for(let t=0;t<3;++t)e[t]-=this.localOrigin[t],e[t+3]-=this.localOrigin[t];return e}};const g=(0,l.vt)(),_=(0,l.vt)(),y=(0,l.vt)(),v=(0,l.vt)(),T=(0,l.vt)()},35910:function(e,t,r){r.d(t,{$p:function(){return i},Qx:function(){return a},_y:function(){return s},e_:function(){return o}});var n=r(32501);class i{constructor(e=(0,n.Ul)()){this.intensity=e}}class s{constructor(e=(0,n.Ul)(),t=(0,n.fA)(.57735,.57735,.57735)){this.intensity=e,this.direction=t}}class a{constructor(e=(0,n.Ul)(),t=(0,n.fA)(.57735,.57735,.57735),r=!0,i=1,s=1){this.intensity=e,this.direction=t,this.castShadows=r,this.specularStrength=i,this.environmentStrength=s}}class o{constructor(){this.r=[0],this.g=[0],this.b=[0]}}},95629:function(e,t,r){r.d(t,{TA:function(){return w},uH:function(){return E}});var n=r(15774),i=r(20551),s=r(32501),a=r(35910);function o(e,t,r){(r=r||e).length=e.length;for(let n=0;n<e.length;n++)r[n]=e[n]*t[n];return r}function l(e,t,r){(r=r||e).length=e.length;for(let n=0;n<e.length;n++)r[n]=e[n]*t;return r}function c(e,t,r){(r=r||e).length=e.length;for(let n=0;n<e.length;n++)r[n]=e[n]+t[n];return r}function u(e){return(e+1)*(e+1)}function d(e,t,r){const n=e[0],i=e[1],s=e[2],a=r||[];return a.length=u(t),t>=0&&(a[0]=.28209479177),t>=1&&(a[1]=.4886025119*n,a[2]=.4886025119*s,a[3]=.4886025119*i),t>=2&&(a[4]=1.09254843059*n*i,a[5]=1.09254843059*i*s,a[6]=.31539156525*(3*s*s-1),a[7]=1.09254843059*n*s,a[8]=.54627421529*(n*n-i*i)),a}function h(e,t){const r=u(e),n=t||{r:[],g:[],b:[]};n.r.length=n.g.length=n.b.length=r;for(let e=0;e<r;e++)n.r[e]=n.g[e]=n.b[e]=0;return n}function f(e,t){const r=function(e){return(0,n.qE)(Math.floor(Math.sqrt(e)-1),0,2)}(t.r.length);for(const n of e)(0,i.v)(T,n.direction),d(T,r,y),o(y,b),l(y,n.intensity[0],v),c(t.r,v),l(y,n.intensity[1],v),c(t.g,v),l(y,n.intensity[2],v),c(t.b,v);return t}function p(e,t){d(T,0,y);for(const r of e)t.r[0]+=y[0]*b[0]*r.intensity[0]*4*Math.PI,t.g[0]+=y[0]*b[0]*r.intensity[1]*4*Math.PI,t.b[0]+=y[0]*b[0]*r.intensity[2]*4*Math.PI;return t}const m=[],g=[],_=[],y=[0],v=[0],T=(0,s.vt)(),b=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];class S{constructor(){this.color=(0,s.vt)(),this.intensity=1}}class A{constructor(){this.direction=(0,s.vt)(),this.ambient=new S,this.diffuse=new S}}const E=.4;class w{constructor(){this._shOrder=2,this._legacy=new A,this.globalFactor=.5,this.noonFactor=.5,this._sphericalHarmonics=new a.e_,this._mainLight=new a.Qx((0,s.vt)(),(0,s.fA)(1,0,0),!1)}get legacy(){return this._legacy}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}set(e){(function(e,t,r,n){h(t,n),(0,i.i)(r.intensity,0,0,0);let s=!1;const o=m,l=g,u=_;o.length=0,l.length=0,u.length=0;for(const t of e)t instanceof a.Qx&&!s?((0,i.c)(r.direction,t.direction),(0,i.c)(r.intensity,t.intensity),r.specularStrength=t.specularStrength,r.environmentStrength=t.environmentStrength,r.castShadows=t.castShadows,s=!0):t instanceof a.Qx||t instanceof a._y?o.push(t):t instanceof a.$p?l.push(t):t instanceof a.e_&&u.push(t);f(o,n),p(l,n);for(const e of u)c(n.r,e.r),c(n.g,e.g),c(n.b,e.b)})(e,this._shOrder,this._mainLight,this._sphericalHarmonics),(0,i.c)(this._legacy.direction,this._mainLight.direction);const t=1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*t,this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*t,this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*t,(0,i.h)(this._legacy.diffuse.color,this._mainLight.intensity,t),(0,i.c)(I,this._legacy.diffuse.color),(0,i.h)(I,I,E*this.globalFactor),(0,i.g)(this._legacy.ambient.color,this._legacy.ambient.color,I)}copyFrom(e){this._sphericalHarmonics.r=Array.from(e.sh.r),this._sphericalHarmonics.g=Array.from(e.sh.g),this._sphericalHarmonics.b=Array.from(e.sh.b),(0,i.c)(this._mainLight.direction,e.mainLight.direction),(0,i.c)(this._mainLight.intensity,e.mainLight.intensity),this._mainLight.castShadows=e.mainLight.castShadows,this._mainLight.specularStrength=e.mainLight.specularStrength,this._mainLight.environmentStrength=e.mainLight.environmentStrength,this.globalFactor=e.globalFactor,this.noonFactor=e.noonFactor}lerpLighting(e,t,r){if((0,i.m)(this._mainLight.intensity,e.mainLight.intensity,t.mainLight.intensity,r),this._mainLight.environmentStrength=(0,n.Cc)(e.mainLight.environmentStrength,t.mainLight.environmentStrength,r),this._mainLight.specularStrength=(0,n.Cc)(e.mainLight.specularStrength,t.mainLight.specularStrength,r),(0,i.c)(this._mainLight.direction,t.mainLight.direction),this._mainLight.castShadows=t.mainLight.castShadows,this.globalFactor=(0,n.Cc)(e.globalFactor,t.globalFactor,r),this.noonFactor=(0,n.Cc)(e.noonFactor,t.noonFactor,r),e.sh.r.length===t.sh.r.length)for(let i=0;i<t.sh.r.length;i++)this._sphericalHarmonics.r[i]=(0,n.Cc)(e.sh.r[i],t.sh.r[i],r),this._sphericalHarmonics.g[i]=(0,n.Cc)(e.sh.g[i],t.sh.g[i],r),this._sphericalHarmonics.b[i]=(0,n.Cc)(e.sh.b[i],t.sh.b[i],r);else for(let e=0;e<t.sh.r.length;e++)this._sphericalHarmonics.r[e]=t.sh.r[e],this._sphericalHarmonics.g[e]=t.sh.g[e],this._sphericalHarmonics.b[e]=t.sh.b[e]}}const I=(0,s.vt)()},84264:function(e,t,r){r.d(t,{Z:function(){return s}});var n=r(65839),i=r(93678);class s{constructor(e){this.vertexBufferLayout=e}elementCount(e){return e.get(n.r.POSITION).indices.length}write(e,t,r,n,s,a){(0,i.SA)(r,n,this.vertexBufferLayout,e,t,s,a)}}},42674:function(e,t,r){r.d(t,{$U:function(){return L}});var n=r(20551),i=r(32501),s=r(65420),a=r(65856),o=r(27264),l=r(11377),c=r(38130),u=r(50865),d=r(11520),h=r(28686),f=r(39534),p=r(54407),m=r(36634),g=r(24100),_=r(46921),y=r(45079),v=r(29165),T=r(65839),b=r(22323),S=r(84264),A=r(84887),E=r(77032),w=r(53804),I=r(2457),x=r(65875),R=r(22095);class M extends R.E{constructor(e,t){super(),this.spherical=e,this.doublePrecisionRequiresObfuscation=t,this.alphaDiscardMode=p.sf.Opaque,this.doubleSidedMode=u.W.None,this.pbrMode=d.A9.Disabled,this.cullFace=p.s2.None,this.normalType=l.W.Attribute,this.customDepthTest=p.it.Less,this.emissionSource=c.ZX.None,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.hasColorTexture=!1,this.hasMetallicRoughnessTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.vvSize=!1,this.vvColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instanced=!1,this.instancedColor=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.snowCover=!1,this.hasColorTextureTransform=!1,this.hasEmissionTextureTransform=!1,this.hasNormalTextureTransform=!1,this.hasOcclusionTextureTransform=!1,this.hasMetallicRoughnessTextureTransform=!1,this.occlusionPass=!1,this.hasVvInstancing=!0,this.useCustomDTRExponentForWater=!1,this.useFillLights=!0}get textureCoordinateType(){return this.hasColorTexture||this.hasMetallicRoughnessTexture||this.emissionSource===c.ZX.Texture||this.hasOcclusionTexture||this.hasNormalTexture?I.I.Default:I.I.None}get objectAndLayerIdColorInstanced(){return this.instanced}get discardInvisibleFragments(){return this.transparent}}(0,w._)([(0,x.W)({count:p.sf.COUNT})],M.prototype,"alphaDiscardMode",void 0),(0,w._)([(0,x.W)({count:u.W.COUNT})],M.prototype,"doubleSidedMode",void 0),(0,w._)([(0,x.W)({count:d.A9.COUNT})],M.prototype,"pbrMode",void 0),(0,w._)([(0,x.W)({count:p.s2.COUNT})],M.prototype,"cullFace",void 0),(0,w._)([(0,x.W)({count:l.W.COUNT})],M.prototype,"normalType",void 0),(0,w._)([(0,x.W)({count:p.it.COUNT})],M.prototype,"customDepthTest",void 0),(0,w._)([(0,x.W)({count:c.ZX.COUNT})],M.prototype,"emissionSource",void 0),(0,w._)([(0,x.W)()],M.prototype,"hasVertexColors",void 0),(0,w._)([(0,x.W)()],M.prototype,"hasSymbolColors",void 0),(0,w._)([(0,x.W)()],M.prototype,"hasVerticalOffset",void 0),(0,w._)([(0,x.W)()],M.prototype,"hasSlicePlane",void 0),(0,w._)([(0,x.W)()],M.prototype,"hasSliceHighlight",void 0),(0,w._)([(0,x.W)()],M.prototype,"hasColorTexture",void 0),(0,w._)([(0,x.W)()],M.prototype,"hasMetallicRoughnessTexture",void 0),(0,w._)([(0,x.W)()],M.prototype,"hasOcclusionTexture",void 0),(0,w._)([(0,x.W)()],M.prototype,"hasNormalTexture",void 0),(0,w._)([(0,x.W)()],M.prototype,"hasScreenSizePerspective",void 0),(0,w._)([(0,x.W)()],M.prototype,"hasVertexTangents",void 0),(0,w._)([(0,x.W)()],M.prototype,"hasOccludees",void 0),(0,w._)([(0,x.W)()],M.prototype,"hasModelTransformation",void 0),(0,w._)([(0,x.W)()],M.prototype,"offsetBackfaces",void 0),(0,w._)([(0,x.W)()],M.prototype,"vvSize",void 0),(0,w._)([(0,x.W)()],M.prototype,"vvColor",void 0),(0,w._)([(0,x.W)()],M.prototype,"receiveShadows",void 0),(0,w._)([(0,x.W)()],M.prototype,"receiveAmbientOcclusion",void 0),(0,w._)([(0,x.W)()],M.prototype,"textureAlphaPremultiplied",void 0),(0,w._)([(0,x.W)()],M.prototype,"instanced",void 0),(0,w._)([(0,x.W)()],M.prototype,"instancedColor",void 0),(0,w._)([(0,x.W)()],M.prototype,"writeDepth",void 0),(0,w._)([(0,x.W)()],M.prototype,"transparent",void 0),(0,w._)([(0,x.W)()],M.prototype,"enableOffset",void 0),(0,w._)([(0,x.W)()],M.prototype,"terrainDepthTest",void 0),(0,w._)([(0,x.W)()],M.prototype,"cullAboveTerrain",void 0),(0,w._)([(0,x.W)()],M.prototype,"snowCover",void 0),(0,w._)([(0,x.W)()],M.prototype,"hasColorTextureTransform",void 0),(0,w._)([(0,x.W)()],M.prototype,"hasEmissionTextureTransform",void 0),(0,w._)([(0,x.W)()],M.prototype,"hasNormalTextureTransform",void 0),(0,w._)([(0,x.W)()],M.prototype,"hasOcclusionTextureTransform",void 0),(0,w._)([(0,x.W)()],M.prototype,"hasMetallicRoughnessTextureTransform",void 0);var O=r(34615),C=r(93776);class N extends E.R5{constructor(e,t,n){super(e,t,n,new O.$(C.R,(()=>r.e(5873).then(r.bind(r,90912))))),this.type="RealisticTreeTechnique"}}class L extends g.im{constructor(e,t){super(e,D),this.materialType="default",this.supportsEdges=!0,this.produces=new Map([[v.N.OPAQUE_MATERIAL,e=>((0,o.iq)(e)||(0,o.PJ)(e))&&!this.parameters.transparent],[v.N.TRANSPARENT_MATERIAL,e=>((0,o.iq)(e)||(0,o.PJ)(e))&&this.parameters.transparent&&this.parameters.writeDepth],[v.N.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,e=>((0,o.XY)(e)||(0,o.PJ)(e))&&this.parameters.transparent&&!this.parameters.writeDepth]]),this._vertexBufferLayout=function(e){const t=(0,a.BP)().vec3f(T.r.POSITION);return e.normalType===l.W.Compressed?t.vec2i16(T.r.NORMALCOMPRESSED,{glNormalized:!0}):t.vec3f(T.r.NORMAL),e.hasVertexTangents&&t.vec4f(T.r.TANGENT),(e.textureId||e.normalTextureId||e.metallicRoughnessTextureId||e.emissiveTextureId||e.occlusionTextureId)&&t.vec2f(T.r.UV0),e.hasVertexColors&&t.vec4u8(T.r.COLOR),e.hasSymbolColors&&t.vec4u8(T.r.SYMBOLCOLOR),(0,f.E)()&&t.vec4u8(T.r.OBJECTANDLAYERIDCOLOR),t}(this.parameters),this._configuration=new M(t.spherical,t.doublePrecisionRequiresObfuscation)}isVisibleForOutput(e){return e!==o.V.Shadow&&e!==o.V.ShadowExcludeHighlight&&e!==o.V.ShadowHighlight||this.parameters.castShadows}get visible(){const e=this.parameters;if(e.layerOpacity<h.Q)return!1;const{hasInstancedColor:t,hasVertexColors:r,hasSymbolColors:n,vvColor:i}=e,s=t||i||n,a="replace"===e.colorMixMode,o=e.opacity>=h.Q;if(r&&s)return a||o;const l=e.externalColor&&e.externalColor[3]>=h.Q;return r?a?l:o:s?a||o:a?l:o}get hasEmissions(){return!!this.parameters.emissiveTextureId||!(0,n.p)(this.parameters.emissiveFactor,i.uY)}getConfiguration(e,t){const r=this.parameters,{treeRendering:n,doubleSided:i,doubleSidedType:s}=r;return this._configuration.output=e,this._configuration.hasNormalTexture=!n&&!!r.normalTextureId,this._configuration.hasColorTexture=!!r.textureId,this._configuration.hasVertexTangents=!n&&r.hasVertexTangents,this._configuration.instanced=r.isInstanced,this._configuration.instancedDoublePrecision=r.instancedDoublePrecision,this._configuration.vvSize=!!r.vvSize,this._configuration.hasVerticalOffset=null!=r.verticalOffset,this._configuration.hasScreenSizePerspective=null!=r.screenSizePerspective,this._configuration.hasSlicePlane=r.hasSlicePlane,this._configuration.hasSliceHighlight=r.hasSliceHighlight,this._configuration.alphaDiscardMode=r.textureAlphaMode,this._configuration.normalType=n?l.W.Attribute:r.normalType,this._configuration.transparent=r.transparent,this._configuration.writeDepth=r.writeDepth,null!=r.customDepthTest&&(this._configuration.customDepthTest=r.customDepthTest),this._configuration.hasOccludees=t.hasOccludees,this._configuration.cullFace=r.hasSlicePlane?p.s2.None:r.cullFace,this._configuration.terrainDepthTest=t.terrainDepthTest,this._configuration.cullAboveTerrain=t.cullAboveTerrain,this._configuration.hasModelTransformation=!n&&null!=r.modelTransformation,this._configuration.hasVertexColors=r.hasVertexColors,this._configuration.hasSymbolColors=r.hasSymbolColors,this._configuration.doubleSidedMode=n?u.W.WindingOrder:i&&"normal"===s?u.W.View:i&&"winding-order"===s?u.W.WindingOrder:u.W.None,this._configuration.instancedColor=r.hasInstancedColor,this._configuration.receiveShadows=r.receiveShadows&&r.receiveShadows,this._configuration.receiveAmbientOcclusion=r.receiveAmbientOcclusion&&null!=t.ssao,this._configuration.vvColor=!!r.vvColor,this._configuration.textureAlphaPremultiplied=!!r.textureAlphaPremultiplied,this._configuration.pbrMode=r.usePBR?r.isSchematic?d.A9.Schematic:d.A9.Normal:d.A9.Disabled,this._configuration.hasMetallicRoughnessTexture=!n&&!!r.metallicRoughnessTextureId,this._configuration.emissionSource=n?c.ZX.None:null!=r.emissiveTextureId?c.ZX.Texture:r.usePBR?c.ZX.Value:c.ZX.None,this._configuration.hasOcclusionTexture=!n&&!!r.occlusionTextureId,this._configuration.offsetBackfaces=!(!r.transparent||!r.offsetTransparentBackfaces),this._configuration.oitPass=t.oitPass,this._configuration.enableOffset=t.camera.relativeElevation<_.xt,this._configuration.snowCover=function(e){return null!=e.weather&&e.weatherVisible&&"snowy"===e.weather.type&&"enabled"===e.weather.snowCover}(t),this._configuration.hasColorTextureTransform=!!r.colorTextureTransformMatrix,this._configuration.hasNormalTextureTransform=!!r.normalTextureTransformMatrix,this._configuration.hasEmissionTextureTransform=!!r.emissiveTextureTransformMatrix,this._configuration.hasOcclusionTextureTransform=!!r.occlusionTextureTransformMatrix,this._configuration.hasMetallicRoughnessTextureTransform=!!r.metallicRoughnessTextureTransformMatrix,this._configuration}intersect(e,t,r,i,a,o){if(null!=this.parameters.verticalOffset){const e=r.camera;(0,n.i)(H,t[12],t[13],t[14]);let o=null;switch(r.viewingMode){case s.RT.Global:o=(0,n.n)(G,H);break;case s.RT.Local:o=(0,n.c)(G,U)}let l=0;const c=(0,n.d)(V,H,e.eye),u=(0,n.l)(c),d=(0,n.h)(c,c,1/u);let h=null;this.parameters.screenSizePerspective&&(h=(0,n.f)(o,d)),l+=(0,A.kE)(e,u,this.parameters.verticalOffset,h??0,this.parameters.screenSizePerspective),(0,n.h)(o,o,l),(0,n.q)(z,o,r.transform.inverseRotation),i=(0,n.d)(P,i,z),a=(0,n.d)(B,a,z)}(0,y.Uy)(e,r,i,a,(0,b.ou)(r.verticalOffset),o)}createGLMaterial(e){return new F(e)}createBufferWriter(){return new S.Z(this._vertexBufferLayout)}}class F extends m.m8{constructor(e){super({...e,...e.material.parameters})}beginSlot(e){this._material.setParameters({receiveShadows:e.shadowMap.enabled});const t=this._material.parameters;this.updateTexture(t.textureId);const r=e.camera.viewInverseTransposeMatrix;return(0,n.i)(t.origin,r[3],r[7],r[11]),this._material.setParameters(this.textureBindParameters),this.acquireTechnique(t.treeRendering?N:E.R5,e)}}class D extends E.uD{constructor(){super(...arguments),this.initTextureTransparent=!1,this.treeRendering=!1,this.hasVertexTangents=!1}}const P=(0,i.vt)(),B=(0,i.vt)(),U=(0,i.fA)(0,0,1),G=(0,i.vt)(),z=(0,i.vt)(),H=(0,i.vt)(),V=(0,i.vt)()},22095:function(e,t,r){r.d(t,{E:function(){return c}});var n=r(53804),i=r(27264),s=r(65875);class a extends s.K{constructor(){super(...arguments),this.instancedDoublePrecision=!1,this.hasModelTransformation=!1}}(0,n._)([(0,s.W)()],a.prototype,"instancedDoublePrecision",void 0),(0,n._)([(0,s.W)()],a.prototype,"hasModelTransformation",void 0);var o=r(54516),l=r(54840);class c extends a{constructor(){super(...arguments),this.output=i.V.Color,this.oitPass=l.Y.NONE,this.hasSliceHighlight=!0,this.hasSliceInVertexProgram=!1,this.bindType=o.c.Pass,this.writeDepth=!0}}(0,n._)([(0,s.W)({count:i.V.COUNT})],c.prototype,"output",void 0),(0,n._)([(0,s.W)({count:l.Y.COUNT})],c.prototype,"oitPass",void 0)},51564:function(e,t,r){r.d(t,{P:function(){return s}});var n=r(32501),i=r(94211);class s extends i.gy{constructor(e=(0,n.vt)()){super(),this.origin=e}get slicePlaneLocalOrigin(){return this.origin}}},6955:function(e,t,r){r.d(t,{R:function(){return q}});var n=r(15774),i=r(44705),s=r(87725),a=r(73364),o=r(39714),l=r(13786),c=r(1932),u=r(20551),d=r(32501),h=r(41546);var f=r(87416),p=r(92754),m=r(24129),g=r(70974),_=r(65856),y=r(27264),v=r(1143),T=r(28686),b=r(39534),S=r(36634),A=r(24100),E=r(29165),w=r(54035),I=r(90553),x=r(65839);class R{constructor(){this.scale=0,this.factor=0,this.minScaleFactor=0}}var M=r(93678),O=r(84887),C=r(88008),N=r(34615),L=r(82273),F=r(54840),D=r(46921),P=r(85456),B=r(57087);class U extends L.w{constructor(e,t,n){super(e,t,new N.$(C.H,(()=>r.e(8121).then(r.bind(r,47416)))),n),this.primitiveType=t.occlusionPass?P.WR.POINTS:P.WR.TRIANGLES}initializePipeline(e){const{oitPass:t,hasPolygonOffset:r,draped:n,output:i,depthTestEnabled:s}=e,a=t===F.Y.NONE,o=r?G:null,l=t===F.Y.ColorAlpha,c=n||!s||l||i===y.V.Highlight?null:B.Uy;return(0,B.Ey)({blending:i===y.V.Color?a?B.Os:(0,D.ez)(t):null,depthTest:s&&!n?{func:P.MT.LEQUAL}:null,depthWrite:c,drawBuffers:(0,D.m6)(t,i),colorWrite:B.kn,polygonOffset:o})}}const G={factor:0,units:-4};var z=r(53804),H=r(2457),V=r(38130),k=r(65875),j=r(22095);class Z extends j.E{constructor(e){super(),this.spherical=e,this.screenCenterOffsetUnitsEnabled=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.hasRotation=!1,this.debugDrawLabelBorder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthTestEnabled=!0,this.pixelSnappingEnabled=!0,this.draped=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.occlusionPass=!1,this.occludedFragmentFade=!1,this.objectAndLayerIdColorInstanced=!1,this.horizonCullingEnabled=!0,this.textureCoordinateType=H.I.None,this.emissionSource=V.ZX.None,this.discardInvisibleFragments=!0,this.hasSliceInVertexProgram=!0,this.hasVvInstancing=!1}}(0,z._)([(0,k.W)()],Z.prototype,"screenCenterOffsetUnitsEnabled",void 0),(0,z._)([(0,k.W)()],Z.prototype,"occlusionTestEnabled",void 0),(0,z._)([(0,k.W)()],Z.prototype,"signedDistanceFieldEnabled",void 0),(0,z._)([(0,k.W)()],Z.prototype,"sampleSignedDistanceFieldTexelCenter",void 0),(0,z._)([(0,k.W)()],Z.prototype,"vvSize",void 0),(0,z._)([(0,k.W)()],Z.prototype,"vvColor",void 0),(0,z._)([(0,k.W)()],Z.prototype,"hasVerticalOffset",void 0),(0,z._)([(0,k.W)()],Z.prototype,"hasScreenSizePerspective",void 0),(0,z._)([(0,k.W)()],Z.prototype,"hasRotation",void 0),(0,z._)([(0,k.W)()],Z.prototype,"debugDrawLabelBorder",void 0),(0,z._)([(0,k.W)()],Z.prototype,"hasSlicePlane",void 0),(0,z._)([(0,k.W)()],Z.prototype,"hasPolygonOffset",void 0),(0,z._)([(0,k.W)()],Z.prototype,"depthTestEnabled",void 0),(0,z._)([(0,k.W)()],Z.prototype,"pixelSnappingEnabled",void 0),(0,z._)([(0,k.W)()],Z.prototype,"draped",void 0),(0,z._)([(0,k.W)()],Z.prototype,"terrainDepthTest",void 0),(0,z._)([(0,k.W)()],Z.prototype,"cullAboveTerrain",void 0),(0,z._)([(0,k.W)()],Z.prototype,"occlusionPass",void 0),(0,z._)([(0,k.W)()],Z.prototype,"occludedFragmentFade",void 0),(0,z._)([(0,k.W)()],Z.prototype,"objectAndLayerIdColorInstanced",void 0),(0,z._)([(0,k.W)()],Z.prototype,"horizonCullingEnabled",void 0);class q extends A.im{constructor(e,t){super(e,me),this.produces=new Map([[E.N.HUD_MATERIAL,e=>(0,y.dX)(e)&&!this.parameters.drawInSecondSlot],[E.N.LABEL_MATERIAL,e=>(0,y.dX)(e)&&this.parameters.drawInSecondSlot],[E.N.OCCLUSION_PIXELS,()=>this.parameters.occlusionTest],[E.N.DRAPED_MATERIAL,e=>this.parameters.draped&&(0,y.dX)(e)]]),this._visible=!0,this._configuration=new Z(t)}getConfiguration(e,t){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits,this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.draped=this.parameters.draped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.sampleSignedDistanceFieldTexelCenter=this.parameters.sampleSignedDistanceFieldTexelCenter,this._configuration.hasRotation=this.parameters.hasRotation,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.occlusionPass=t.slot===E.N.OCCLUSION_PIXELS,this._configuration.occludedFragmentFade=this.parameters.occludedFragmentFade,this._configuration.horizonCullingEnabled=this.parameters.horizonCullingEnabled,this._configuration.depthTestEnabled=this.parameters.depthEnabled||t.slot===E.N.OCCLUSION_PIXELS,e===y.V.Color&&(this._configuration.debugDrawLabelBorder=!!g.b.LABELS_SHOW_BORDER),this._configuration.oitPass=t.oitPass,this._configuration.terrainDepthTest=t.terrainDepthTest,this._configuration.cullAboveTerrain=t.cullAboveTerrain,this._configuration}intersect(e,t,r,n,s,o){const{options:{selectionMode:l,hud:c,excludeLabels:h},point:f,camera:p}=r,{parameters:m}=this;if(!l||!c||h&&m.isLabel||!e.visible||!f)return;const{scaleX:g,scaleY:_}=this._getScreenScale(e,p.pixelRatio);(0,i.z0)(ie,t),e.attributes.has(x.r.FEATUREATTRIBUTE)&&function(e){const t=e[0],r=e[1],n=e[2],i=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8],u=1/Math.sqrt(t*t+r*r+n*n),d=1/Math.sqrt(i*i+s*s+a*a),h=1/Math.sqrt(o*o+l*l+c*c);e[0]=t*u,e[1]=r*u,e[2]=n*u,e[3]=i*d,e[4]=s*d,e[5]=a*d,e[6]=o*h,e[7]=l*h,e[8]=c*h}(ie);const y=e.attributes.get(x.r.POSITION),v=e.attributes.get(x.r.SIZE),T=e.attributes.get(x.r.NORMAL),b=e.attributes.get(x.r.ROTATION),S=e.attributes.get(x.r.CENTEROFFSETANDDISTANCE);(0,I.vA)(y.size>=3);const A=(0,C.c)(m),E="screen"===this.parameters.centerOffsetUnits;for(let e=0;e<y.data.length/y.size;e++){const n=e*y.size;(0,u.i)(J,y.data[n],y.data[n+1],y.data[n+2]),(0,u.t)(J,J,t),(0,u.t)(J,J,p.viewMatrix);const i=e*S.size;if((0,u.i)(oe,S.data[i],S.data[i+1],S.data[i+2]),!E&&(J[0]+=oe[0],J[1]+=oe[1],0!==oe[2])){const e=oe[2];(0,u.n)(oe,J),(0,u.d)(J,J,(0,u.h)(oe,oe,e))}const s=e*T.size;if((0,u.i)(Q,T.data[s],T.data[s+1],T.data[s+2]),Y(Q,ie,p,ue),this._applyVerticalOffsetTransformationView(J,ue,p,X),p.applyProjection(J,K),K[0]>-1){E&&(oe[0]||oe[1])&&(K[0]+=oe[0]*p.pixelRatio,0!==oe[1]&&(K[1]+=(0,w.m0)(oe[1],X.factorAlignment)*p.pixelRatio),p.unapplyProjection(K,J)),K[0]+=this.parameters.screenOffset[0]*p.pixelRatio,K[1]+=this.parameters.screenOffset[1]*p.pixelRatio,K[0]=Math.floor(K[0]),K[1]=Math.floor(K[1]);const t=e*v.size;fe[0]=v.data[t],fe[1]=v.data[t+1],(0,w.MD)(fe,X.factor,fe);const n=de*p.pixelRatio;let i=0;m.textureIsSignedDistanceField&&(i=Math.min(m.outlineSize,.5*fe[0])*p.pixelRatio/2),fe[0]*=g,fe[1]*=_;const s=e*b.size,l=m.rotation+b.data[s];if($(f,K[0],K[1],fe,n,i,l,m,A)){const e=r.ray;if((0,u.t)(te,J,(0,a.B8)(ae,p.viewMatrix)),K[0]=f[0],K[1]=f[1],p.unprojectFromRenderScreen(K,J)){const t=(0,d.vt)();(0,u.c)(t,e.direction);const r=1/(0,u.l)(t);(0,u.h)(t,t,r),o((0,u.j)(e.origin,J)*r,t,-1,!0,1,te)}}}}}intersectDraped(e,t,r,n,i,s){const a=e.attributes.get(x.r.POSITION),o=e.attributes.get(x.r.SIZE),l=e.attributes.get(x.r.ROTATION),c=this.parameters,u=(0,C.c)(c),{scaleX:d,scaleY:h}=this._getScreenScale(e,e.screenToWorldRatio),f=he*e.screenToWorldRatio;for(let t=0;t<a.data.length/a.size;t++){const r=t*a.size,p=a.data[r],m=a.data[r+1],g=t*o.size;fe[0]=o.data[g],fe[1]=o.data[g+1];let _=0;c.textureIsSignedDistanceField&&(_=Math.min(c.outlineSize,.5*fe[0])*e.screenToWorldRatio/2),fe[0]*=d,fe[1]*=h;const y=t*l.size,v=c.rotation+l.data[y];$(n,p,m,fe,f,_,v,c,u)&&i(s.dist,s.normal,-1,!1)}}createBufferWriter(){return new ye}_updateScaleInfo(e,t,r){const n=this.parameters;null!=n.screenSizePerspective?(0,w.cJ)(r,t,n.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minScaleFactor=0),null!=n.screenSizePerspectiveAlignment?(0,w.cJ)(r,t,n.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minScaleFactor=e.factor.minScaleFactor)}applyShaderOffsetsView(e,t,r,n,i,s,a){const o=Y(t,r,i,ue);return this._applyVerticalGroundOffsetView(e,o,i,a),this._applyVerticalOffsetTransformationView(a,o,i,s),this._applyPolygonOffsetView(a,o,n[3],i,a),this._applyCenterOffsetView(a,n,a),a}applyShaderOffsetsNDC(e,t,r,n,i){return this._applyCenterOffsetNDC(e,t,r,n),null!=i&&(0,u.c)(i,n),this._applyPolygonOffsetNDC(n,t,r,n),n}_applyPolygonOffsetView(e,t,r,i,s){const a=i.aboveGround?1:-1;let o=Math.sign(r);0===o&&(o=a);const l=a*o;if(this.parameters.shaderPolygonOffset<=0)return(0,u.c)(s,e);const c=(0,n.qE)(Math.abs(t.cosAngle),.01,1),d=1-Math.sqrt(1-c*c)/c/i.viewport[2];return(0,u.h)(s,e,l>0?d:1/d),s}_applyVerticalGroundOffsetView(e,t,r,n){const i=(0,u.l)(e),s=r.aboveGround?1:-1,a=r.computeRenderPixelSizeAtDist(i)*v.R,o=(0,u.h)(J,t.normal,s*a);return(0,u.g)(n,e,o),n}_applyVerticalOffsetTransformationView(e,t,r,n){const i=this.parameters;if(!i.verticalOffset?.screenLength){if(i.screenSizePerspective||i.screenSizePerspectiveAlignment){const r=(0,u.l)(e);this._updateScaleInfo(n,r,t.cosAngle)}else n.factor.scale=1,n.factorAlignment.scale=1;return e}const s=(0,u.l)(e),a=i.screenSizePerspectiveAlignment??i.screenSizePerspective,o=(0,O.kE)(r,s,i.verticalOffset,t.cosAngle,a);return this._updateScaleInfo(n,s,t.cosAngle),(0,u.h)(t.normal,t.normal,o),(0,u.g)(e,e,t.normal)}_applyCenterOffsetView(e,t,r){const n="screen"!==this.parameters.centerOffsetUnits;return r!==e&&(0,u.c)(r,e),n&&(r[0]+=t[0],r[1]+=t[1],t[2]&&((0,u.n)(Q,r),(0,u.g)(r,r,(0,u.h)(Q,Q,t[2])))),r}_applyCenterOffsetNDC(e,t,r,n){const i="screen"!==this.parameters.centerOffsetUnits;return n!==e&&(0,u.c)(n,e),i||(n[0]+=t[0]/r.fullWidth*2,n[1]+=t[1]/r.fullHeight*2),n}_applyPolygonOffsetNDC(e,t,r,n){const i=this.parameters.shaderPolygonOffset;if(e!==n&&(0,u.c)(n,e),i){const e=r.aboveGround?1:-1,s=e*Math.sign(t[3]);n[2]-=(s||e)*i}return n}set visible(e){this._visible=e}get visible(){const{color:e,outlineSize:t,outlineColor:r}=this.parameters,n=e[3]>=T.Q||t>=T.Q&&r[3]>=T.Q;return this._visible&&n}createGLMaterial(e){return new W(e)}calculateRelativeScreenBounds(e,t,r=(0,f.vt)()){return function(e,t,r,n){n[0]=e.anchorPosition[0]*-t[0]+e.screenOffset[0]*r,n[1]=e.anchorPosition[1]*-t[1]+e.screenOffset[1]*r}(this.parameters,e,t,r),r[2]=r[0]+e[0],r[3]=r[1]+e[1],r}_getScreenScale(e,t){const r=e.attributes.get(x.r.FEATUREATTRIBUTE);if(null==r)return{scaleX:t,scaleY:t};const n=(0,h.ci)(r.data,ce);return(0,m.VC)(le,this.parameters,n),{scaleX:le[0]*t,scaleY:le[1]*t}}}class W extends S.m8{constructor(e){super({...e,...e.material.parameters})}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.acquireTechnique(U,e)}}function Y(e,t,r,n){return function(e){return(t=e)instanceof Float32Array&&t.length>=16||function(e){return Array.isArray(e)&&e.length>=16}(e);var t}(t)&&(t=(0,i.z0)(se,t)),(0,u.q)(n.normal,e,t),(0,u.t)(n.normal,n.normal,r.viewInverseTransposeMatrix),n.cosAngle=(0,u.f)(ee,pe),n}function $(e,t,r,i,s,a,o,c,u){let d=t-s-i[0]*u[0],h=d+i[0]+2*s,f=r-s-i[1]*u[1],p=f+i[1]+2*s;const m=c.distanceFieldBoundingBox;return c.textureIsSignedDistanceField&&null!=m&&(d+=i[0]*m[0],f+=i[1]*m[1],h-=i[0]*(1-m[2]),p-=i[1]*(1-m[3]),d-=a,h+=a,f-=a,p+=a),(0,l.hZ)(ne,t,r),(0,l.e$)(re,e,ne,(0,n.kU)(o)),re[0]>d&&re[0]<h&&re[1]>f&&re[1]<p}const X=new class{constructor(){this.factor=new R,this.factorAlignment=new R}},J=(0,d.vt)(),Q=(0,d.vt)(),K=(0,h.vt)(),ee=(0,d.vt)(),te=(0,d.vt)(),re=(0,c.vt)(),ne=(0,c.vt)(),ie=(0,s.vt)(),se=(0,s.vt)(),ae=(0,o.vt)(),oe=(0,d.vt)(),le=(0,d.vt)(),ce=(0,h.vt)(),ue={normal:ee,cosAngle:0},de=1,he=2,fe=[0,0],pe=(0,d.fA)(0,0,1);class me extends S.NV{constructor(){super(...arguments),this.renderOccluded=A.m$.Occlude,this.isDecoration=!1,this.color=(0,h.CN)(1,1,1,1),this.polygonOffset=!1,this.anchorPosition=(0,c.fA)(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.outlineColor=(0,h.CN)(1,1,1,1),this.outlineSize=0,this.rotation=0,this.hasRotation=!1,this.vvSizeEnabled=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.occludedFragmentFade=!1,this.horizonCullingEnabled=!1,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.draped=!1,this.isLabel=!1}}const ge=(0,_.BP)().vec3f(x.r.POSITION).vec3f(x.r.NORMAL).vec2f(x.r.UV0).vec4u8(x.r.COLOR).vec2f(x.r.SIZE).f32(x.r.ROTATION).vec4f(x.r.CENTEROFFSETANDDISTANCE).vec4f(x.r.FEATUREATTRIBUTE),_e=ge.clone().vec4u8(x.r.OBJECTANDLAYERIDCOLOR);class ye{constructor(){this.vertexBufferLayout=(0,b.E)()?_e:ge}elementCount(e){return 6*e.get(x.r.POSITION).indices.length}write(e,t,r,n,i,s){(0,M.Hk)(r.get(x.r.POSITION),e,i.position,s,6),(0,M.p1)(r.get(x.r.NORMAL),t,i.normal,s,6);const a=r.get(x.r.UV0)?.data;let o=0,l=0,c=1,u=1;a&&a.length>=4&&(o=a[0],l=a[1],c=a[2],u=a[3]),c=Math.min(1.99999,c+1),u=Math.min(1.99999,u+1);let d=r.get(x.r.POSITION).indices.length,h=s;const f=i.uv0;for(let e=0;e<d;++e)f.set(h,0,o),f.set(h,1,l),h++,f.set(h,0,c),f.set(h,1,l),h++,f.set(h,0,c),f.set(h,1,u),h++,f.set(h,0,c),f.set(h,1,u),h++,f.set(h,0,o),f.set(h,1,u),h++,f.set(h,0,o),f.set(h,1,l),h++;(0,M.tb)(r.get(x.r.COLOR),4,i.color,s,6);const{data:m,indices:g}=r.get(x.r.SIZE);d=g.length;const _=i.size;h=s;for(let e=0;e<d;++e){const t=m[2*g[e]],r=m[2*g[e]+1];for(let e=0;e<6;++e)_.set(h,0,t),_.set(h,1,r),h++}if((0,M.uO)(r.get(x.r.ROTATION),i.rotation,s,6),r.get(x.r.CENTEROFFSETANDDISTANCE)?(0,M.Ut)(r.get(x.r.CENTEROFFSETANDDISTANCE),i.centerOffsetAndDistance,s,6):(0,M.Pq)(i.centerOffsetAndDistance,s,6*d),r.get(x.r.FEATUREATTRIBUTE)?(0,M.Ut)(r.get(x.r.FEATUREATTRIBUTE),i.featureAttribute,s,6):(0,M.Pq)(i.featureAttribute,s,6*d),null!=n){const e=r.get(x.r.POSITION)?.indices;if(e){const t=e.length,r=i.getField(x.r.OBJECTANDLAYERIDCOLOR,p.XP);(0,M.tH)(n,r,t,s,6)}}}}},77971:function(e,t,r){r.d(t,{S:function(){return s},p:function(){return a}});var n=r(24129),i=r(24100);class s extends n.Gd{constructor(){super(...arguments),this.renderOccluded=i.m$.Occlude,this.isDecoration=!1}}const a=8},84887:function(e,t,r){r.d(t,{MB:function(){return o},Um:function(){return l},kE:function(){return a}});var n=r(50659),i=r(15774),s=r(54035);function a(e,t,r,n,a){let o=(r.screenLength||0)*e.pixelRatio;null!=a&&(o=(0,s.hs)(o,n,t,a));const l=o*Math.tan(.5*e.fovY)/(.5*e.fullHeight);return(0,i.qE)(l*t,r.minWorldLength||0,null!=r.maxWorldLength?r.maxWorldLength:1/0)}function o(e,t){let r=!1;for(const i in t){const s=t[i];void 0!==s&&(Array.isArray(s)?Array.isArray(e[i])&&(0,n.aI)(s,e[i])||(e[i]=s.slice(),r=!0):e[i]!==s&&(r=!0,e[i]=s))}return r}const l={multiply:1,ignore:2,replace:3,tint:4}},93678:function(e,t,r){r.d(t,{Hk:function(){return h},Pq:function(){return d},SA:function(){return g},Ut:function(){return u},p1:function(){return f},tH:function(){return m},tb:function(){return p},uO:function(){return o},zC:function(){return _}});var n=r(73364),i=r(92754),s=r(90553),a=r(65839);function o(e,t,r,n=1){const{data:i,indices:s}=e,a=t.typedBuffer,o=t.typedBufferStride,l=s.length;if(r*=o,1===n)for(let e=0;e<l;++e)a[r]=i[s[e]],r+=o;else for(let e=0;e<l;++e){const t=i[s[e]];for(let e=0;e<n;e++)a[r]=t,r+=o}}function l(e,t,r){const{data:n,indices:i}=e,s=t.typedBuffer,a=t.typedBufferStride,o=i.length;r*=a;for(let e=0;e<o;++e){const t=2*i[e];s[r]=n[t],s[r+1]=n[t+1],r+=a}}function c(e,t,r,n){const{data:i,indices:s}=e,a=t.typedBuffer,o=t.typedBufferStride,l=s.length;if(r*=o,null==n||1===n)for(let e=0;e<l;++e){const t=3*s[e];a[r]=i[t],a[r+1]=i[t+1],a[r+2]=i[t+2],r+=o}else for(let e=0;e<l;++e){const t=3*s[e];for(let e=0;e<n;++e)a[r]=i[t],a[r+1]=i[t+1],a[r+2]=i[t+2],r+=o}}function u(e,t,r,n=1){const{data:i,indices:s}=e,a=t.typedBuffer,o=t.typedBufferStride,l=s.length;if(r*=o,1===n)for(let e=0;e<l;++e){const t=4*s[e];a[r]=i[t],a[r+1]=i[t+1],a[r+2]=i[t+2],a[r+3]=i[t+3],r+=o}else for(let e=0;e<l;++e){const t=4*s[e];for(let e=0;e<n;++e)a[r]=i[t],a[r+1]=i[t+1],a[r+2]=i[t+2],a[r+3]=i[t+3],r+=o}}function d(e,t,r){const n=e.typedBuffer,i=e.typedBufferStride;t*=i;for(let e=0;e<r;++e)n[t]=0,n[t+1]=0,n[t+2]=0,n[t+3]=0,t+=i}function h(e,t,r,i,s=1){if(!t)return void c(e,r,i,s);const{data:a,indices:o}=e,l=r.typedBuffer,u=r.typedBufferStride,d=o.length,h=t[0],f=t[1],p=t[2],m=t[4],g=t[5],_=t[6],y=t[8],v=t[9],T=t[10],b=t[12],S=t[13],A=t[14];i*=u;let E=0,w=0,I=0;const x=(0,n.tZ)(t)?e=>{E=a[e]+b,w=a[e+1]+S,I=a[e+2]+A}:e=>{const t=a[e],r=a[e+1],n=a[e+2];E=h*t+m*r+y*n+b,w=f*t+g*r+v*n+S,I=p*t+_*r+T*n+A};if(1===s)for(let e=0;e<d;++e)x(3*o[e]),l[i]=E,l[i+1]=w,l[i+2]=I,i+=u;else for(let e=0;e<d;++e){x(3*o[e]);for(let e=0;e<s;++e)l[i]=E,l[i+1]=w,l[i+2]=I,i+=u}}function f(e,t,r,i,s=1){if(!t)return void c(e,r,i,s);const{data:a,indices:o}=e,l=t,u=r.typedBuffer,d=r.typedBufferStride,h=o.length,f=l[0],p=l[1],m=l[2],g=l[4],_=l[5],y=l[6],v=l[8],T=l[9],b=l[10],S=!(0,n.ut)(l),A=1e-6,E=1-A;i*=d;let w=0,I=0,x=0;const R=(0,n.tZ)(l)?e=>{w=a[e],I=a[e+1],x=a[e+2]}:e=>{const t=a[e],r=a[e+1],n=a[e+2];w=f*t+g*r+v*n,I=p*t+_*r+T*n,x=m*t+y*r+b*n};if(1===s)if(S)for(let e=0;e<h;++e){R(3*o[e]);const t=w*w+I*I+x*x;if(t<E&&t>A){const e=1/Math.sqrt(t);u[i]=w*e,u[i+1]=I*e,u[i+2]=x*e}else u[i]=w,u[i+1]=I,u[i+2]=x;i+=d}else for(let e=0;e<h;++e)R(3*o[e]),u[i]=w,u[i+1]=I,u[i+2]=x,i+=d;else for(let e=0;e<h;++e){if(R(3*o[e]),S){const e=w*w+I*I+x*x;if(e<E&&e>A){const t=1/Math.sqrt(e);w*=t,I*=t,x*=t}}for(let e=0;e<s;++e)u[i]=w,u[i+1]=I,u[i+2]=x,i+=d}}function p(e,t,r,n,i=1){const{data:s,indices:a}=e,o=r.typedBuffer,l=r.typedBufferStride,c=a.length;if(n*=l,t!==s.length||4!==t)if(1!==i)if(4!==t)for(let e=0;e<c;++e){const t=3*a[e];for(let e=0;e<i;++e)o[n]=s[t],o[n+1]=s[t+1],o[n+2]=s[t+2],o[n+3]=255,n+=l}else for(let e=0;e<c;++e){const t=4*a[e];for(let e=0;e<i;++e)o[n]=s[t],o[n+1]=s[t+1],o[n+2]=s[t+2],o[n+3]=s[t+3],n+=l}else{if(4===t){for(let e=0;e<c;++e){const t=4*a[e];o[n]=s[t],o[n+1]=s[t+1],o[n+2]=s[t+2],o[n+3]=s[t+3],n+=l}return}for(let e=0;e<c;++e){const t=3*a[e];o[n]=s[t],o[n+1]=s[t+1],o[n+2]=s[t+2],o[n+3]=255,n+=l}}else{o[n]=s[0],o[n+1]=s[1],o[n+2]=s[2],o[n+3]=s[3];const e=new Uint32Array(r.typedBuffer.buffer,r.start),t=l/4,a=e[n/=4];n+=t;const u=c*i;for(let r=1;r<u;++r)e[n]=a,n+=t}}function m(e,t,r,n,i=1){const s=t.typedBuffer,a=t.typedBufferStride;if(n*=a,1===i)for(let t=0;t<r;++t)s[n]=e[0],s[n+1]=e[1],s[n+2]=e[2],s[n+3]=e[3],n+=a;else for(let t=0;t<r;++t)for(let t=0;t<i;++t)s[n]=e[0],s[n+1]=e[1],s[n+2]=e[2],s[n+3]=e[3],n+=a}function g(e,t,r,n,s,o,l){for(const c of r.fields.keys()){const r=e.get(c),u=r?.indices;if(r&&u)_(c,r,n,s,o,l);else if(c===a.r.OBJECTANDLAYERIDCOLOR&&null!=t){const r=e.get(a.r.POSITION)?.indices;if(r){const e=r.length;m(t,o.getField(c,i.XP),e,l)}}}}function _(e,t,r,o,c,d){switch(e){case a.r.POSITION:{(0,s.vA)(3===t.size);const n=c.getField(e,i.xs);(0,s.vA)(!!n,`No buffer view for ${e}`),n&&h(t,r,n,d);break}case a.r.NORMAL:{(0,s.vA)(3===t.size);const r=c.getField(e,i.xs);(0,s.vA)(!!r,`No buffer view for ${e}`),r&&f(t,o,r,d);break}case a.r.NORMALCOMPRESSED:{(0,s.vA)(2===t.size);const r=c.getField(e,i.mJ);(0,s.vA)(!!r,`No buffer view for ${e}`),r&&l(t,r,d);break}case a.r.UV0:{(0,s.vA)(2===t.size);const r=c.getField(e,i.gH);(0,s.vA)(!!r,`No buffer view for ${e}`),r&&l(t,r,d);break}case a.r.COLOR:case a.r.SYMBOLCOLOR:{const r=c.getField(e,i.XP);(0,s.vA)(!!r,`No buffer view for ${e}`),(0,s.vA)(3===t.size||4===t.size),!r||3!==t.size&&4!==t.size||p(t,t.size,r,d);break}case a.r.COLORFEATUREATTRIBUTE:{const r=c.getField(e,i.Y$);(0,s.vA)(!!r,`No buffer view for ${e}`),(0,s.vA)(1===t.size),r&&1===t.size&&function(e,t,r){const{data:n,indices:i}=e,s=t.typedBuffer,a=t.typedBufferStride,o=i.length,l=n[0];r*=a;for(let e=0;e<o;++e)s[r]=l,r+=a}(t,r,d);break}case a.r.TANGENT:{(0,s.vA)(4===t.size);const a=c.getField(e,i.Eq);(0,s.vA)(!!a,`No buffer view for ${e}`),a&&function(e,t,r,i,s=1){if(!t)return void u(e,r,i,s);const{data:a,indices:o}=e,l=t,c=r.typedBuffer,d=r.typedBufferStride,h=o.length,f=l[0],p=l[1],m=l[2],g=l[4],_=l[5],y=l[6],v=l[8],T=l[9],b=l[10],S=!(0,n.ut)(l),A=1e-6,E=1-A;if(i*=d,1===s)for(let e=0;e<h;++e){const t=4*o[e],r=a[t],n=a[t+1],s=a[t+2],l=a[t+3];let u=f*r+g*n+v*s,h=p*r+_*n+T*s,w=m*r+y*n+b*s;if(S){const e=u*u+h*h+w*w;if(e<E&&e>A){const t=1/Math.sqrt(e);u*=t,h*=t,w*=t}}c[i]=u,c[i+1]=h,c[i+2]=w,c[i+3]=l,i+=d}else for(let e=0;e<h;++e){const t=4*o[e],r=a[t],n=a[t+1],l=a[t+2],u=a[t+3];let h=f*r+g*n+v*l,w=p*r+_*n+T*l,I=m*r+y*n+b*l;if(S){const e=h*h+w*w+I*I;if(e<E&&e>A){const t=1/Math.sqrt(e);h*=t,w*=t,I*=t}}for(let e=0;e<s;++e)c[i]=h,c[i+1]=w,c[i+2]=I,c[i+3]=u,i+=d}}(t,r,a,d);break}case a.r.PROFILERIGHT:case a.r.PROFILEUP:case a.r.PROFILEVERTEXANDNORMAL:case a.r.FEATUREVALUE:{(0,s.vA)(4===t.size);const r=c.getField(e,i.Eq);(0,s.vA)(!!r,`No buffer view for ${e}`),r&&u(t,r,d)}}}},27539:function(e,t,r){r.d(t,{Bt:function(){return o},Jr:function(){return s},SY:function(){return l},mb:function(){return a}});var n=r(20551),i=r(32501);function s({normalTexture:e,metallicRoughnessTexture:t,metallicFactor:r,roughnessFactor:s,emissiveTexture:a,emissiveFactor:o,occlusionTexture:l}){return null==e&&null==t&&null==a&&(null==o||(0,n.p)(o,i.uY))&&null==l&&(null==s||1===s)&&(null==r||1===r)}const a=(0,i.CN)(1,1,.5),o=(0,i.CN)(0,.6,.2),l=(0,i.CN)(0,1,.2)},26347:function(e,t,r){r.d(t,{y:function(){return O},N:function(){return k}});var n=r(53804),i=r(50659),s=(r(58941),r(15774)),a=r(95929),o=r(7970),l=r(7187),c=r(17660),u=r(23502),d=(r(40633),r(65953)),h=r(73364),f=r(39714),p=r(69550),m=r(27264),g=r(67521),_=r(52798),y=r(96253),v=r(29165),T=r(90553),b=r(51564);class S{constructor(e=0,t=0){this.from=e,this.to=t}get numElements(){return this.to-this.from}}function A(e){const t=new Map;e.forAll((e=>t.set(e.from,e)));let r=!0;for(;r;){r=!1;for(let n=0;n<e.length;++n){const i=e.data[n],s=t.get(i.to);if(!s)return;i.to=s.to,t.delete(s.from),e.removeUnordered(s),r=!0}}}class E extends S{constructor(e,t,r){super(t,r),this.geometry=e}get isVisible(){return this.geometry.visible}get hasHighlights(){return this.isVisible&&this.geometry.hasHighlights}foreachHighlightGroup(e){this.isVisible&&this.geometry.foreachHighlightGroup(e)}get hasOccludees(){return null!=this.geometry.occludees}}class w{constructor(){this.first=0,this.count=0}}class I{constructor(){this._numElements=0,this._instances=new Map,this.holes=new l.A({allocator:e=>e||new S,deallocator:null}),this.hasHiddenInstances=!1,this.hasOccludees=!1,this.drawCommandsDirty=!0,this.highlightGroups=new Set,this.drawCommandsDefault=x(),this.drawCommandsHighlights=new Map,this.drawCommandsOccludees=x(),this.drawCommandsShadowHighlightRest=x()}get numElements(){return this._numElements}get instances(){return this._instances}get hasHighlights(){return this.highlightGroups.size>0}resetInstanceSummary(){this.hasHiddenInstances=!1,this.hasOccludees=!1,this.highlightGroups.clear()}updateIfDrawCommandsDirty(e){if(this.drawCommandsDirty){this.resetInstanceSummary();for(const e of this.instances.values())this.updateDrawState(e);this.updateDrawCommands(e)}}addInstance(e,t){this.deleteInstance(e),this._instances.set(e,t),this._numElements+=t.numElements}deleteInstance(e){const t=this._instances.get(e);t&&(this._numElements-=t.numElements,this._instances.delete(e))}updateInstance(e,t,r){const n=this._instances.get(e);n&&(this._numElements-=n.numElements,n.from=t,n.to=r,this._numElements+=n.numElements)}updateDrawState(e){e.isVisible?(e.foreachHighlightGroup((e=>this.highlightGroups.add(e))),e.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0}updateDrawCommands(e){if(this.drawCommandsDefault.clear(),this.drawCommandsHighlights.clear(),this.drawCommandsOccludees.clear(),this.drawCommandsShadowHighlightRest.clear(),this.drawCommandsDirty=!1,0===this._instances.size)return;if(!this.needsMultipleCommands()){const t=this.drawCommandsDefault.pushNew(),r=this.holes.front();return null!=this.vao&&1===this.holes.length&&r.to===Math.floor(this.vao.byteSize/e)?(t.first=0,void(t.count=r.from)):(t.first=1/0,t.count=0,this._instances.forEach((e=>{t.first=Math.min(t.first,e.from),t.count=Math.max(t.count,e.to)})),void(t.count-=t.first))}const t=Array.from(this._instances.values()).sort(((e,t)=>e.from===t.from?e.to-t.to:e.from-t.from)),{drawCommandsHighlights:r}=this;for(const e of t)e.isVisible&&(R(e.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,e),e.hasHighlights?e.foreachHighlightGroup((t=>{let n=r.get(t);n||(n=x(),r.set(t,n)),R(n,e)})):R(this.drawCommandsShadowHighlightRest,e))}needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}}function x(){return new l.A({allocator:e=>e||new w,deallocator:e=>e})}function R(e,t){const r=e.back();if(null==r){const r=e.pushNew();return r.first=t.from,void(r.count=t.numElements)}if(function(e,t){return e.first+e.count>=t.from}(r,t)){const e=t.from-r.first+t.numElements;r.count=e}else{const r=e.pushNew();r.first=t.from,r.count=t.numElements}}class M{constructor(e){this.origin=e,this.buffers=new Array}dispose(){this.buffers.forEach((e=>e.vao.dispose())),this.buffers.length=0}findBuffer(e){return this.buffers.find((t=>t.instances.has(e)))}}let O=class extends g.RW{get _hasAnyHighlight(){return this._highlightGroups.size>0}constructor(e){super(e),this._dataByOrigin=new Map,this._drawParameters=new b.P,this._highlightGroups=new Set,this.drapedPriority=0,this._produces=new Map,this._hasOccludees=!1}destroy(){this._glMaterials=(0,a.WD)(this._glMaterials),this._dataByOrigin.forEach((e=>e.dispose())),this._dataByOrigin.clear(),this._vaoCache=null}initialize(){this.material.produces.forEach(((e,t)=>{this._produces.set(t,(t=>!(0===this._dataByOrigin.size||!(t!==m.V.Highlight&&t!==m.V.ShadowHighlight||this._hasAnyHighlight))&&e(t)))}))}initializeRenderContext(e,t){this._glMaterials=new _.c(this.material,t??e.materials),this._bufferWriter=this.material.createBufferWriter(),this._vaoCache=e.renderContext.rctx.getVaoCache(this.material.vertexAttributeLocations,(0,p.U)(this._bufferWriter.vertexBufferLayout))}uninitializeRenderContext(){}get produces(){return this._produces}get hasOccludees(){return this._hasOccludees}get hasEmissions(){return this.material.hasEmissions}get isDecoration(){return this.material.parameters.isDecoration}queryRenderOccludedState(e){return this.material.queryRenderOccludedState(e)}get numGeometries(){let e=0;return this._dataByOrigin.forEach((t=>e+=t.buffers.reduce(((e,t)=>e+t.instances.size),0))),e}get usedMemory(){let e=0;return this._dataByOrigin.forEach((t=>e+=t.buffers.reduce(((e,t)=>e+t.vao.usedMemory),0))),e}forEachGeometry(e){this._dataByOrigin.forEach((t=>t.buffers.forEach((t=>t.instances.forEach((({geometry:t})=>e(t)))))))}modify(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateDrawCommands()}_updateGeometries(e){const t=this._bufferWriter;if(null==t)return;const r=t.vertexBufferLayout.stride/4;for(const n of e){const e=n.renderGeometry,i=this._dataByOrigin.get(e.localOrigin.id),s=i?.findBuffer(e.id);if(null==s)return;const a=s.instances.get(e.id);if(n.updateType&(y.k.GEOMETRY|y.k.TRANSFORMATION)){const n=V(t.elementCount(a.geometry.geometry.attributes)*r),i=t.vertexBufferLayout.createView(n.buffer);this._writeGeometry(e,i,0),s.vao.vertexBuffers.get("geometry").setSubData(n,a.from*r,0,a.numElements*r)}n.updateType&(y.k.HIGHLIGHT|y.k.OCCLUDEE|y.k.VISIBILITY)&&(s.drawCommandsDirty=!0)}}_computeDeltas(e,t){const r=new o.O;for(const t of e){const e=t.localOrigin;if(null==e)continue;let n=r.get(e.id,null);null==n&&(n=new C(e.vec3),r.set(e.id,null,n)),n.changes.push(t)}for(const e of t){const t=e.localOrigin;if(null==t)continue;const n=this._dataByOrigin.get(t.id),i=n?.findBuffer(e.id);if(null==i)continue;let s=r.get(t.id,i);null==s&&(s=new C(t.vec3),r.set(t.id,i,s)),s.changes.push(e)}return r}_addAndRemoveGeometries(e,t){if(null==this._bufferWriter||null==this._vaoCache)return;const{_bufferWriter:r,_dataByOrigin:n}=this,s=r.vertexBufferLayout.stride/4,a=this._computeDeltas(e,t);a.forEach(((e,t)=>{const o=e.get(null),l=o?.changes??[];a.delete(t,null);let c=n.get(t);if(e.forEach(((e,o)=>{if(a.delete(t,o),null==o)return void(0,T.vA)(!1,"No VAO for removed geometries");if(o.instances.size===e.changes.length)return this._vaoCache.deleteVao(o.vao),(0,i.Xy)(c.buffers,o),void(0===c.buffers.length&&0===l.length&&n.delete(t));const u=o.numElements,d=o.vao.byteSize/4,h=l.reduce(((e,t)=>e+r.elementCount(t.geometry.attributes)),0),f=e.changes.reduce(((e,t)=>e+r.elementCount(t.geometry.attributes)),0),p=Math.min((u+h-f)*s,z),m=p>d;p>P&&p<d/2?(e.changes.forEach((({id:e})=>o.deleteInstance(e))),o.instances.forEach((({geometry:e})=>l.push(e))),this._vaoCache.deleteVao(o.vao),(0,i.Xy)(c.buffers,o)):m?this._applyAndRebuild(o,l,e):this._applyRemoves(o,e)})),l.length>0)for(null==c&&(c=new M(o.origin),n.set(t,c)),c.buffers.forEach((e=>this._applyAdds(e,l)));l.length>0;)c.buffers.push(this._applyAndRebuild(new I,l,null))}))}_updateDrawCommands(){this._highlightGroups.clear(),this._hasOccludees=!1,this._dataByOrigin.forEach((e=>{e.buffers.forEach((e=>{e.updateIfDrawCommandsDirty(this._bufferWriter.vertexBufferLayout.stride),e.hasHighlights&&(0,c.FB)(this._highlightGroups,e.highlightGroups),this._hasOccludees=this._hasOccludees||e.hasOccludees}))}))}_applyAndRebuild(e,t,r){if(r)for(const t of r.changes)e.deleteInstance(t.id);const n=this._bufferWriter,i=n.vertexBufferLayout.stride,s=i/4,a=Math.floor(z/s);let o=e.numElements;for(;t.length>0;){const r=t.pop(),i=n.elementCount(r.geometry.attributes);if(o+i>a&&o>0){t.push(r);break}o+=i;const s=new E(r,0,0);(0,T.vA)(null==e.instances.get(r.id)),e.addInstance(r.id,s)}const l=o*s,c=V(l),u=n.vertexBufferLayout.createView(c.buffer);let d=0;e.resetInstanceSummary(),e.instances.forEach(((t,r)=>{this._writeGeometry(t.geometry,u,d);const i=d;d+=n.elementCount(t.geometry.geometry.attributes),e.updateInstance(r,i,d),e.updateDrawState(t)})),this._vaoCache.deleteVao(e.vao),e.vao=this._vaoCache.newVao(k(l)),e.vao.vertexBuffers.get("geometry").setSubData(c,0,0,d*s),e.holes.clear();const h=e.holes.pushNew();return h.from=d,h.to=Math.floor(e.vao.byteSize/i),e.updateDrawCommands(i),e}_applyRemoves(e,t){if(0===t.changes.length||null==this._bufferWriter)return;for(const r of t.changes){const t=r.id,n=e.instances.get(t);if(!n)continue;e.deleteInstance(t);const i=D.back();if(i){if(i.to===n.from){i.to=n.to;continue}if(i.from===n.to){i.from=n.from;continue}}const s=D.pushNew();s.from=n.from,s.to=n.to}A(D);const r=this._bufferWriter.vertexBufferLayout.stride/4,n=D.reduce(((e,t)=>Math.max(e,t.numElements)),0)*r,i=V(n);i.fill(0,0,n);const s=e.vao.vertexBuffers.get("geometry");D.forAll((e=>s.setSubData(i,e.from*r,0,e.numElements*r))),e.holes.pushArray(D.data,D.length),D.forAll(((e,t)=>D.data[t]=null)),D.clear(),e.drawCommandsDirty=!0}_applyAdds(e,t){if(0===t.length||null==this._bufferWriter)return;if(!function(e){return null!=e.vao}(e))return void this._applyAndRebuild(e,t,null);const r=this._bufferWriter,n=r.vertexBufferLayout.stride/4,s=e.numElements,a=t.reduce(((e,t)=>e+r.elementCount(t.geometry.attributes)),0),o=Math.min((s+a)*n,z),l=4*o;if(e.vao.byteSize<k(z-P)&&l>e.vao.byteSize)return void this._applyAndRebuild(e,t,null);A(e.holes);const c=new Array;for(const n of t){const t=r.elementCount(n.geometry.attributes),i=N(e.holes,t);c.push(i)}const u=e.vao.vertexBuffers.get("geometry");let d=0,h=0,f=0;const p=V(o),m=r.vertexBufferLayout.createView(p.buffer);t.forEach(((t,i)=>{const s=c[i];if(null==s)return;if(f!==s){const e=f-h;e>0&&u.setSubData(p,h*n,0,e*n),h=s,d=0}const a=r.elementCount(t.geometry.attributes);this._writeGeometry(t,m,d),d+=a,f=s+a;const o=new E(t,s,s+a);(0,T.vA)(null==e.instances.get(t.id)),e.addInstance(t.id,o),e.drawCommandsDirty=!0}));const g=f-h;g>0&&u.setSubData(p,h*n,0,g*n),(0,i.$i)(t,((e,t)=>null==c[t]))}_writeGeometry(e,t,r){null!=this._bufferWriter&&((0,h.C)(L,e.transformation),L[12]-=e.localOrigin.vec3[0],L[13]-=e.localOrigin.vec3[1],L[14]-=e.localOrigin.vec3[2],(0,h.B8)(F,L),(0,h.mg)(F,F),this._bufferWriter.write(L,F,e.geometry.attributes,e.geometry.objectAndLayerIdColor,t,r))}updateAnimation(e){return this.material.update(e)}acquireTechniques(e){if(!this.material.shouldRender(e))return null;const{output:t,bind:r}=e,n=this.material.produces.get(r.slot);if(!n?.(t))return null;const{highlightGroupName:i,slot:s}=r,a=t===m.V.ShadowHighlight,o=t===m.V.Highlight,l=o||a,c=e=>l&&(0===this._highlightGroups.size||o&&!!i&&!e.has(i));if(c(this._highlightGroups))return null;const u=t===m.V.ShadowExcludeHighlight,d=!(l||u);for(const{buffers:n}of this._dataByOrigin.values())for(const o of n){if(c(o.highlightGroups))continue;const n=a?o.drawCommandsHighlights.size>0:l?i?o.drawCommandsHighlights.get(i):o.drawCommandsHighlights.size>0:((u&&o.needsMultipleCommands()?o.drawCommandsShadowHighlightRest:o.drawCommandsDefault)||null)?.length??!1,h=d&&o.drawCommandsOccludees||null;if(n||h?.length){const n=this._glMaterials.load(e.rctx,s,t),i=n?.beginSlot(r);if(i)return i}}return null}render(e,t){const{output:r,bind:n}=e,{slot:i,highlightGroupName:s}=n,a=r===m.V.Highlight;if(a&&!s)return;const o=r===m.V.ShadowHighlight,l=a||o,c=r===m.V.ShadowExcludeHighlight,u=!(l||c),d=i===v.N.OCCLUDER_MATERIAL||i===v.N.TRANSPARENT_OCCLUDER_MATERIAL?i:null,{rctx:h}=e;h.runAppleAmdDriverHelper();const f=h.bindTechnique(t,n,this.material.parameters);for(const e of this._dataByOrigin.values())for(const r of e.buffers){if(a&&(!r.hasHighlights||!r.drawCommandsHighlights.has(s)))continue;if(o&&!r.hasHighlights)continue;const i=()=>{const e=[];for(const t of r.drawCommandsHighlights.values())e.push(t);return e},p=l&&!o?r.drawCommandsHighlights.get(s)??null:null,m=o?i():l?p?[p]:j:(c&&r.needsMultipleCommands()?[r.drawCommandsShadowHighlightRest]:[r.drawCommandsDefault])||j,g=m.some((e=>e.length>0)),_=u&&r.drawCommandsOccludees||null;if(g||_?.length){if(this._drawParameters.origin=e.origin,f.bindDraw(n,this.material.parameters,this._drawParameters),t.ensureAttributeLocations(r.vao),h.bindVAO(r.vao),g)for(const e of m)h.setPipelineState(t.getPipeline(!1,d)),e.forAll((e=>h.drawArrays(t.primitiveType,e.first,e.count)));_?.length&&(h.setPipelineState(t.getPipeline(!0,d)),_.forAll((e=>h.drawArrays(t.primitiveType,e.first,e.count))))}}}get test(){}};(0,n._)([(0,u.MZ)({constructOnly:!0})],O.prototype,"material",void 0),O=(0,n._)([(0,d.$)("esri.views.3d.webgl-engine.materials.renderers.MergedRenderer")],O);class C{constructor(e){this.origin=e,this.changes=new Array}}function N(e,t){const r=e.find((e=>e.numElements>=t));if(null==r)return null;const n=r.from;return r.from+=t,r.from>=r.to&&e.removeUnordered(r),n}const L=(0,f.vt)(),F=(0,f.vt)(),D=new l.A({allocator:e=>e||new S,deallocator:null}),P=65536,B=4*P,U=1024,G=16777216,z=G/4;let H=new Float32Array(P);function V(e){return H.length<e&&(H=new Float32Array(e)),H}function k(e){const t=4*e;return t<=U?U:t<B?(0,s.cU)(t):Math.max(Math.min(Math.ceil(1.5*t/B)*B,G),t)}const j=[]},84738:function(e,t,r){r.d(t,{Ci:function(){return s},PC:function(){return a},Vk:function(){return o}});var n=r(32501),i=r(44476);function s(e,t){return null==e&&(e=[]),e.push(t),e}function a(e,t){if(null==e)return null;const r=e.filter((e=>e!==t));return 0===r.length?null:r}function o(e,t,r,n,s){l[0]=e.get(t,0),l[1]=e.get(t,1),l[2]=e.get(t,2),(0,i.jS)(l,c,3),r.set(s,0,c[0]),n.set(s,0,c[1]),r.set(s,1,c[2]),n.set(s,1,c[3]),r.set(s,2,c[4]),n.set(s,2,c[5])}const l=(0,n.vt)(),c=new Float32Array(6)},77032:function(e,t,r){r.d(t,{R5:function(){return S},V:function(){return b},uD:function(){return T}});var n=r(32501),i=r(41546),s=r(27264),a=r(11377),o=r(94211),l=r(28686),c=r(34615),u=r(82273),d=r(54407),h=r(24100),f=r(54840),p=r(46921),m=r(6200),g=r(27539),_=r(62480),y=r(85456),v=r(57087);class T extends o.Zo{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=g.mb,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=d.s2.Back,this.isInstanced=!1,this.hasInstancedColor=!1,this.emissiveFactor=n.uY,this.instancedDoublePrecision=!1,this.normalType=a.W.Attribute,this.receiveShadows=!0,this.receiveAmbientOcclusion=!0,this.castShadows=!0,this.ambient=(0,n.CN)(.2,.2,.2),this.diffuse=(0,n.CN)(.8,.8,.8),this.externalColor=(0,i.fA)(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=(0,n.vt)(),this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.offsetTransparentBackfaces=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.modelTransformation=null,this.transparent=!1,this.writeDepth=!0,this.customDepthTest=d.it.Less,this.textureAlphaMode=d.sf.Blend,this.textureAlphaCutoff=l.Q,this.textureAlphaPremultiplied=!1,this.renderOccluded=h.m$.Occlude,this.isDecoration=!1}}class b extends o.gy{constructor(){super(...arguments),this.origin=(0,n.vt)(),this.slicePlaneLocalOrigin=this.origin}}class S extends u.w{constructor(e,t,n,i=new c.$(_.D,(()=>r.e(2529).then(r.bind(r,576))))){super(e,t,i,n),this.type="DefaultMaterialTechnique"}_makePipeline(e,t){const{oitPass:r,output:n,transparent:i,cullFace:a,customDepthTest:o,hasOccludees:l,enableOffset:c}=e,u=r===f.Y.NONE,d=r===f.Y.FrontFace;return(0,v.Ey)({blending:(0,s.RN)(n)&&i?(0,p.Yf)(r):null,culling:E(e)?(0,v.Xt)(a):null,depthTest:{func:(0,p.K_)(r,A(o))},depthWrite:(0,p.z5)(e),drawBuffers:n===s.V.Depth?{buffers:[y.Hr.NONE]}:(0,p.m6)(r,n),colorWrite:v.kn,stencilWrite:l?m.v0:null,stencilTest:l?t?m.a9:m.qh:null,polygonOffset:u||d?null:(0,p.aB)(c)})}initializePipeline(e){return this._occludeePipelineState=this._makePipeline(e,!0),this._makePipeline(e,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}}function A(e){return e===d.it.Lequal?y.MT.LEQUAL:y.MT.LESS}function E(e){return e.cullFace!==d.s2.None||!e.hasSlicePlane&&!e.transparent&&!e.doubleSidedMode}},25124:function(e,t,r){r.d(t,{z:function(){return u}});var n=r(27264),i=r(38130),s=r(84435),a=r(28686),o=r(23864),l=r(39506),c=r(54840);function u(e,t){e.include(s.Q,t),e.include(i.NL,t),e.fragment.include(o.a);const r=t.output===n.V.ObjectAndLayerIdColor,u=(0,n.LG)(t.output),d=(0,n.RN)(t.output)&&t.oitPass===c.Y.ColorAlpha,h=(0,n.RN)(t.output)&&t.oitPass!==c.Y.ColorAlpha,f=t.discardInvisibleFragments;let p=0;(h||u||d)&&e.outputs.add("fragColor","vec4",p++),u&&e.outputs.add("fragEmission","vec4",p++),d&&e.outputs.add("fragAlpha","float",p++),e.fragment.code.add(l.H`
    void outputColorHighlightOID(vec4 finalColor, const in vec3 vWorldPosition) {
      ${(0,l.If)(r,l.H`finalColor.a = 1.0;`)}

      ${(0,l.If)(f,l.H`if (finalColor.a < ${l.H.float(a.Q)}){
              discard;
              return;
            }`)}

      finalColor = highlightSlice(finalColor, vWorldPosition);
      ${(0,l.If)(d,l.H`fragColor = premultiplyAlpha(finalColor);
             fragAlpha = finalColor.a;`)}
      ${(0,l.If)(h,"fragColor = finalColor;")}
      ${(0,l.If)(u,"fragEmission = getEmissions();")}
      calculateOcclusionAndOutputHighlight();
      ${(0,l.If)(r,"outputObjectAndLayerIdColor();")}
    }
  `)}},46671:function(e,t,r){var n,i,s;r.d(t,{OG:function(){return i},hM:function(){return n}}),r(39714),r(7456),r(57617),(s=n||(n={})).OPAQUE="opaque-color",s.TRANSPARENT="transparent-color",s.COMPOSITE="composite-color",s.FINAL="final-color",function(e){e.SSAO="ssao",e.LASERLINES="laserline-color",e.ANTIALIASING="aa-color",e.HIGHLIGHTS="highlight-color",e.MAGNIFIER="magnifier-color",e.OCCLUDED="occluded-color",e.VIEWSHED="viewshed-color",e.OPAQUE_ENVIRONMENT="opaque-environment-color",e.TRANSPARENT_ENVIRONMENT="transparent-environment-color"}(i||(i={}))},65631:function(e,t,r){r.d(t,{A:function(){return w}});var n,i=r(53804),s=r(83525),a=r(40633),o=r(15774),l=r(13520),c=r(23502),u=(r(58941),r(13798),r(65953)),d=r(73364),h=r(39714),f=r(13786),p=r(1932),m=r(20551),g=r(32501),_=r(33400),y=r(41546),v=r(69508),T=r(79578),b=r(29531),S=r(65420),A=r(57701);let E=n=class extends s.A{constructor(e){super(e),this._ray=(0,T.vt)(),this._viewport=(0,y.fA)(0,0,1,1),this._padding=(0,y.fA)(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=(0,p.fA)(1,1e3),this._viewDirty=!0,this._viewMatrix=(0,h.vt)(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=(0,h.vt)(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=(0,h.vt)(),this._frustumDirty=!0,this._frustum=(0,v.vt)(),this._fullViewport=(0,y.vt)(),this._pixelRatio=1,this.row=0,this.column=0,this._rows=1,this._columns=1,this._center=(0,g.vt)(),this._up=(0,g.vt)(),this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(e){this._pixelRatio=e>0?e:1}get rows(){return this._rows}set rows(e){this._rows=Math.max(1,e)}get columns(){return this._columns}set columns(e){this._columns=Math.max(1,e)}get eye(){return this._ray.origin}set eye(e){this._compareAndSetView(e,this._ray.origin)}get center(){return this._center}set center(e){this._compareAndSetView(e,this._center,"_center")}get ray(){return(0,m.d)(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(e){this._compareAndSetView(e,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(e){(0,d.C)(this._viewMatrix,e),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),(0,m.i)((0,g.vt)(),-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10])}get viewUp(){return this._ensureViewClean(),(0,m.i)((0,g.vt)(),this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9])}get viewRight(){return this._ensureViewClean(),(0,m.i)((0,g.vt)(),this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8])}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(e){this._nearFar[0]!==e&&(this._nearFar[0]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(e){this._nearFar[1]!==e&&(this._nearFar[1]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(e){this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]}get screenViewport(){if(1===this.pixelRatio)return this._viewport;const e=(0,_.d)((0,y.vt)(),this._viewport,1/this.pixelRatio),t=this._get("screenViewport");return t&&(0,_.e)(e,t)?t:e}get screenPadding(){if(1===this.pixelRatio)return this._padding;const e=(0,_.d)((0,y.vt)(),this._padding,1/this.pixelRatio),t=this._get("screenPadding");return t&&(0,_.e)(e,t)?t:e}get x(){return this._viewport[0]}set x(e){e+=this._padding[A.zj.LEFT],this._viewport[0]!==e&&(this._viewport[0]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(e){e+=this._padding[A.zj.BOTTOM],this._viewport[1]!==e&&(this._viewport[1]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(e){this._viewport[2]!==e&&(this._viewport[2]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(e){this._viewport[3]!==e&&(this._viewport[3]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[A.zj.RIGHT]+this._padding[A.zj.LEFT]}set fullWidth(e){this.width=e-(this._padding[A.zj.RIGHT]+this._padding[A.zj.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[A.zj.TOP]+this._padding[A.zj.BOTTOM]}set fullHeight(e){this.height=e-(this._padding[A.zj.TOP]+this._padding[A.zj.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[A.zj.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[A.zj.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(e){(0,_.a)(this._padding,e)||(this._viewport[0]+=e[A.zj.LEFT]-this._padding[A.zj.LEFT],this._viewport[1]+=e[A.zj.BOTTOM]-this._padding[A.zj.BOTTOM],this._viewport[2]-=e[A.zj.RIGHT]+e[A.zj.LEFT]-(this._padding[A.zj.RIGHT]+this._padding[A.zj.LEFT]),this._viewport[3]-=e[A.zj.TOP]+e[A.zj.BOTTOM]-(this._padding[A.zj.TOP]+this._padding[A.zj.BOTTOM]),(0,_.c)(this._padding,e),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&((0,d.lw)(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){return this._projectionMatrixInternal}get inverseProjectionMatrix(){return(0,d.B8)((0,h.vt)(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||(0,h.vt)()}get fov(){return this._fov}set fov(e){this._fov=e,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return e=this._fov,t=this.width,r=this.height,2*Math.atan(t*Math.tan(.5*e)/Math.sqrt(t*t+r*r));var e,t,r}set fovX(e){this._fov=function(e,t,r){return 2*Math.atan(Math.sqrt(t*t+r*r)*Math.tan(.5*e)/t)}(e,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return e=this._fov,t=this.width,r=this.height,2*Math.atan(r*Math.tan(.5*e)/Math.sqrt(t*t+r*r));var e,t,r}set fovY(e){this._fov=function(e,t,r){return 2*Math.atan(Math.sqrt(t*t+r*r)*Math.tan(.5*e)/r)}(e,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return(0,m.j)(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&((0,d.B8)(this._viewInverseTransposeMatrix,this.viewMatrix),(0,d.mg)(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(e){const t=2*e-1;return 2*this.near*this.far/(this.far+this.near-t*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return null!=this.relativeElevation&&this.relativeElevation>=0}get _projectionMatrixInternal(){const e=this.width,t=this.height,r=this.near*Math.tan(this.fovY/2)*2,n=r*this._aspect,i=r/this.rows,s=n/this.columns,a=-n/2+this.column*s,o=a+s,l=-r/2+this.row*i,c=l+i,u=(0,d.$h)((0,h.vt)(),a*(1+2*this._padding[A.zj.LEFT]/e),o*(1+2*this._padding[A.zj.RIGHT]/e),l*(1+2*this._padding[A.zj.BOTTOM]/t),c*(1+2*this._padding[A.zj.TOP]/t),this.near,this.far),f=this._get("projectionMatrix");return f&&(0,d.aI)(f,u)?f:u}copyFrom(e){(0,m.c)(this._ray.origin,e.eye),this.center=e.center,this.up=e.up,(0,_.c)(this._viewport,e.viewport),this.notifyChange("_viewport"),(0,_.c)(this._padding,e.padding),this.notifyChange("_padding"),(0,f.C)(this._nearFar,e.nearFar),this.notifyChange("_nearFar"),this._fov=e.fov,this.row=e.row,this.column=e.column,this.rows=e.rows,this.columns=e.columns,this.relativeElevation=e.relativeElevation;const t=e;return this._viewDirty=t._viewDirty,this._viewDirty||((0,d.C)(this._viewMatrix,e.viewMatrix),this.notifyChange("_viewMatrix")),this._viewProjectionDirty=!0,this._frustumDirty=t._frustumDirty,this._frustumDirty||((0,v.C)(this._frustum,e.frustum),this._frustumDirty=!1),t._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:((0,d.C)(this._viewInverseTransposeMatrix,e.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),(0,_.c)(this._fullViewport,e.fullViewport),this.pixelRatio=e.pixelRatio,this}copyViewFrom(e){this.eye=e.eye,this.center=e.center,this.up=e.up,this.fov=e.fov}clone(){return(new n).copyFrom(this)}equals(e){return(0,m.p)(this.eye,e.eye)&&(0,m.p)(this.center,e.center)&&(0,m.p)(this.up,e.up)&&(0,_.a)(this._viewport,e.viewport)&&(0,_.a)(this._padding,e.padding)&&(0,f.t2)(this.nearFar,e.nearFar)&&this._fov===e.fov&&this.pixelRatio===e.pixelRatio&&this.relativeElevation===e.relativeElevation&&this.row===e.row&&this.column===e.column&&this.rows===e.rows&&this.columns===e.columns}almostEquals(e){const t=Math.max(1,1/this.pixelRatio,1/e.pixelRatio);if(Math.abs(e.fov-this._fov)>=.001||(0,_.f)(e.screenPadding,this.screenPadding)>=t||(0,_.f)(this.screenViewport,e.screenViewport)>=t||this.row!==e.row||this.column!==e.column||this.rows!==e.rows||this.columns!==e.columns)return!1;(0,m.a)(R,e.eye,e.center),(0,m.a)(M,this.eye,this.center);const r=(0,m.f)(R,M),n=(0,m.z)(R),i=(0,m.z)(M),s=5e-4;return r*r>=(1-1e-10)*n*i&&(0,m.y)(e.eye,this.eye)<Math.max(n,i)*s*s}computeRenderPixelSizeAt(e){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(e))}computeRenderPixelSizeAtDist(e){return e*this.perRenderPixelRatio}computeScreenPixelSizeAt(e){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(e))}_viewDirectionDistance(e){return Math.abs((0,b.gr)(this.viewForward,(0,m.d)(R,e,this.eye)))}computeScreenPixelSizeAtDist(e){return e*this.perScreenPixelRatio}computeDistanceFromRadius(e,t){return e/Math.tan(Math.min(this.fovX,this.fovY)/(2*(t||1)))}getScreenCenter(e=(0,l.gs)()){return e[0]=(this.padding[A.zj.LEFT]+this.width/2)/this.pixelRatio,e[1]=(this.padding[A.zj.TOP]+this.height/2)/this.pixelRatio,e}getRenderCenter(e,t=.5,r=.5){return e[0]=this.padding[A.zj.LEFT]+this.width*t,e[1]=this.padding[A.zj.BOTTOM]+this.height*r,e[2]=.5,e}setGLViewport(e){const t=this.viewport,r=this.padding;e.setViewport(t[0]-r[3],t[1]-r[2],t[2]+r[1]+r[3],t[3]+r[0]+r[2])}applyProjection(e,t){e!==I&&(0,m.c)(I,e),I[3]=1,(0,_.t)(I,I,this.projectionMatrix);const r=Math.abs(I[3]);(0,m.h)(I,I,1/r);const n=this.fullViewport;t[0]=(0,o.Cc)(0,n[0]+n[2],.5+.5*I[0]),t[1]=(0,o.Cc)(0,n[1]+n[3],.5+.5*I[1]),t[2]=.5*(I[2]+1),t[3]=r}unapplyProjection(e,t){const r=this.fullViewport;I[0]=(e[0]/(r[0]+r[2])*2-1)*e[3],I[1]=(e[1]/(r[1]+r[3])*2-1)*e[3],I[2]=(2*e[2]-1)*e[3],I[3]=e[3],null!=this.inverseProjectionMatrix&&((0,_.t)(I,I,this.inverseProjectionMatrix),t[0]=I[0],t[1]=I[1],t[2]=I[2])}projectToScreen(e,t){return this.projectToRenderScreen(e,O),this.renderToScreen(O,t),t}projectToRenderScreen(e,t){if(I[0]=e[0],I[1]=e[1],I[2]=e[2],I[3]=1,(0,_.t)(I,I,this.viewProjectionMatrix),0===I[3])return null;const r=I;(0,m.h)(r,r,1/Math.abs(I[3]));const n=this.fullViewport,i=(0,o.Cc)(0,n[0]+n[2],.5+.5*r[0]),s=(0,o.Cc)(0,n[1]+n[3],.5+.5*r[1]);return"x"in t?(t.x=i,t.y=s):(t[0]=i,t[1]=s,t.length>2&&(t[2]=.5*(r[2]+1))),t}unprojectFromScreen(e,t){return this.unprojectFromRenderScreen(this.screenToRender(e,O),t)}unprojectFromRenderScreen(e,t){if((0,d.lw)(x,this.projectionMatrix,this.viewMatrix),!(0,d.B8)(x,x))return null;const r=this.fullViewport;return I[0]=2*(e[0]-r[0])/r[2]-1,I[1]=2*(e[1]-r[1])/r[3]-1,I[2]=2*e[2]-1,I[3]=1,(0,_.t)(I,I,x),0===I[3]?null:(t[0]=I[0]/I[3],t[1]=I[1]/I[3],t[2]=I[2]/I[3],t)}constrainWindowSize(e,t,r,n){const i=e*this.pixelRatio,s=t*this.pixelRatio,a=Math.max(i-r/2,0),o=Math.max(this.fullHeight-s-n/2,0),l=-Math.min(i-r/2,0),c=-Math.min(this.fullHeight-s-n/2,0),u=r-l- -Math.min(this.fullWidth-i-r/2,0),d=n-c- -Math.min(s-n/2,0);return[Math.round(a),Math.round(o),Math.round(u),Math.round(d)]}computeUp(e){e===S.RT.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(e,t){const r=e[0]*this.pixelRatio,n=this.fullHeight-e[1]*this.pixelRatio;return t[0]=r,t[1]=n,t}renderToScreen(e,t){const r=e[0]/this.pixelRatio,n=(this.fullHeight-e[1])/this.pixelRatio;t[0]=r,t[1]=n}_computeUpGlobal(){(0,m.d)(R,this.center,this.eye);const e=(0,m.l)(this.center);e<1?((0,m.i)(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs((0,m.f)(R,this.center))>.9999*(0,m.l)(R)*e||((0,m.e)(this._up,R,this.center),(0,m.e)(this._up,this._up,R),(0,m.n)(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){(0,m.o)(R,this.eye,this.center),Math.abs(R[2])<=.9999&&((0,m.h)(R,R,R[2]),(0,m.i)(this._up,-R[0],-R[1],1-R[2]),(0,m.n)(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(e,t,r=""){"number"==typeof e[0]&&isFinite(e[0])&&"number"==typeof e[1]&&isFinite(e[1])&&"number"==typeof e[2]&&isFinite(e[2])?(0,m.p)(e,t)||((0,m.c)(t,e),this._markViewDirty(),r.length&&this.notifyChange(r)):a.A.getLogger("esri.views.3d.webgl-engine.lib.RenderCamera").warn("RenderCamera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&((0,v.ui)(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&((0,d.t5)(this._viewMatrix,this.eye,this.center,this.up),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};(0,i._)([(0,c.MZ)()],E.prototype,"_viewport",void 0),(0,i._)([(0,c.MZ)()],E.prototype,"_padding",void 0),(0,i._)([(0,c.MZ)()],E.prototype,"_fov",void 0),(0,i._)([(0,c.MZ)()],E.prototype,"_nearFar",void 0),(0,i._)([(0,c.MZ)()],E.prototype,"_viewDirty",void 0),(0,i._)([(0,c.MZ)()],E.prototype,"_viewMatrix",void 0),(0,i._)([(0,c.MZ)()],E.prototype,"_pixelRatio",void 0),(0,i._)([(0,c.MZ)()],E.prototype,"pixelRatio",null),(0,i._)([(0,c.MZ)()],E.prototype,"row",void 0),(0,i._)([(0,c.MZ)()],E.prototype,"column",void 0),(0,i._)([(0,c.MZ)()],E.prototype,"_rows",void 0),(0,i._)([(0,c.MZ)()],E.prototype,"rows",null),(0,i._)([(0,c.MZ)()],E.prototype,"_columns",void 0),(0,i._)([(0,c.MZ)()],E.prototype,"columns",null),(0,i._)([(0,c.MZ)()],E.prototype,"eye",null),(0,i._)([(0,c.MZ)()],E.prototype,"center",null),(0,i._)([(0,c.MZ)()],E.prototype,"_center",void 0),(0,i._)([(0,c.MZ)()],E.prototype,"up",null),(0,i._)([(0,c.MZ)()],E.prototype,"_up",void 0),(0,i._)([(0,c.MZ)()],E.prototype,"viewMatrix",null),(0,i._)([(0,c.MZ)({readOnly:!0})],E.prototype,"viewForward",null),(0,i._)([(0,c.MZ)({readOnly:!0})],E.prototype,"viewUp",null),(0,i._)([(0,c.MZ)({readOnly:!0})],E.prototype,"viewRight",null),(0,i._)([(0,c.MZ)({readOnly:!0})],E.prototype,"nearFar",null),(0,i._)([(0,c.MZ)()],E.prototype,"near",null),(0,i._)([(0,c.MZ)()],E.prototype,"far",null),(0,i._)([(0,c.MZ)()],E.prototype,"viewport",null),(0,i._)([(0,c.MZ)({readOnly:!0})],E.prototype,"screenViewport",null),(0,i._)([(0,c.MZ)({readOnly:!0})],E.prototype,"screenPadding",null),(0,i._)([(0,c.MZ)()],E.prototype,"x",null),(0,i._)([(0,c.MZ)()],E.prototype,"y",null),(0,i._)([(0,c.MZ)()],E.prototype,"width",null),(0,i._)([(0,c.MZ)()],E.prototype,"height",null),(0,i._)([(0,c.MZ)()],E.prototype,"fullWidth",null),(0,i._)([(0,c.MZ)()],E.prototype,"fullHeight",null),(0,i._)([(0,c.MZ)({readOnly:!0})],E.prototype,"_aspect",null),(0,i._)([(0,c.MZ)()],E.prototype,"padding",null),(0,i._)([(0,c.MZ)({readOnly:!0})],E.prototype,"projectionMatrix",null),(0,i._)([(0,c.MZ)({readOnly:!0})],E.prototype,"inverseProjectionMatrix",null),(0,i._)([(0,c.MZ)()],E.prototype,"fov",null),(0,i._)([(0,c.MZ)()],E.prototype,"fovX",null),(0,i._)([(0,c.MZ)()],E.prototype,"fovY",null),(0,i._)([(0,c.MZ)()],E.prototype,"viewInverseTransposeMatrix",null),(0,i._)([(0,c.MZ)({readOnly:!0})],E.prototype,"_projectionMatrixInternal",null),(0,i._)([(0,c.MZ)()],E.prototype,"relativeElevation",void 0),E=n=(0,i._)([(0,u.$)("esri.views.3d.webgl.RenderCamera")],E);const w=E,I=(0,y.vt)(),x=(0,h.vt)(),R=(0,g.vt)(),M=(0,g.vt)(),O=(0,l.r_)()},74174:function(e,t,r){r.d(t,{A:function(){return h}});var n=r(53804),i=r(83525),s=r(39819),a=r(28181),o=r(23502),l=r(65953),c=r(46671),u=r(54407);let d=class extends i.A{constructor(e){super(e),this.view=null,this.consumes={required:[]},this.produces=c.hM.COMPOSITE,this.requireGeometryDepth=!1,this._dirty=!0}initialize(){this.addHandles([(0,a.watch)((()=>this.view.ready),(e=>{e&&this.view._stage?.renderer.addRenderNode(this)}),a.Vh)])}destroy(){this.view._stage?.renderer?.removeRenderNode(this)}precompile(){}render(){throw new s.A("RenderNode:render-function-not-implemented","render() is not implemented.")}get camera(){return this.view.state.camera.clone()}get sunLight(){return this.bindParameters.lighting.legacy}get gl(){return this.view._stage.renderView.renderingContext.gl}acquireOutputFramebuffer(){const e=this._frameBuffer?.getTexture()?.descriptor,t=this.view._stage.renderer.fboCache.acquire(e?.width??640,e?.height??480,this.produces);return t.fbo?.initializeAndBind(),t}bindRenderTarget(){return this._frameBuffer?.fbo?.initializeAndBind(),this._frameBuffer}requestRender(e){e===u.C7.UPDATE&&this.view._stage?.renderView.requestRender(e),this._dirty=!0}resetWebGLState(){this.renderingContext.resetState(),this.renderingContext.bindFramebuffer(this._frameBuffer?.fbo)}get fboCache(){return this.view._stage.renderer.fboCache}get bindParameters(){return this.renderContext.bind}get renderingContext(){return this.view._stage.renderView.renderingContext}get renderContext(){return this.view._stage?.renderer.renderContext}updateAnimation(e){return!!this._dirty&&(this._dirty=!1,!0)}doRender(e){this._frameBuffer=e.find((({name:e})=>e===this.produces));try{return this.render(e)}finally{this._frameBuffer=null}}};(0,n._)([(0,o.MZ)({constructOnly:!0})],d.prototype,"view",void 0),(0,n._)([(0,o.MZ)({constructOnly:!0})],d.prototype,"consumes",void 0),(0,n._)([(0,o.MZ)()],d.prototype,"produces",void 0),d=(0,n._)([(0,l.$)("esri.views.3d.webgl.RenderNode")],d);const h=d},98680:function(e,t,r){var n,i;r.d(t,{N:function(){return n},z:function(){return i}}),function(e){e[e.RED=0]="RED",e[e.RG=1]="RG",e[e.RGBA4=2]="RGBA4",e[e.RGBA=3]="RGBA",e[e.RGBA_MIPMAP=4]="RGBA_MIPMAP",e[e.R16F=5]="R16F",e[e.RGBA16F=6]="RGBA16F"}(n||(n={})),function(e){e[e.DEPTH_STENCIL_TEXTURE=0]="DEPTH_STENCIL_TEXTURE",e[e.DEPTH16_BUFFER=1]="DEPTH16_BUFFER"}(i||(i={}))},65420:function(e,t,r){var n;r.d(t,{RT:function(){return n}}),function(e){e[e.Global=1]="Global",e[e.Local=2]="Local"}(n||(n={}))},81197:function(e,t,r){var n;r.d(t,{M:function(){return n}}),function(e){e[e.ANIMATING=0]="ANIMATING",e[e.INTERACTING=1]="INTERACTING",e[e.IDLE=2]="IDLE"}(n||(n={}))},48961:function(e,t,r){r.d(t,{Bb:function(){return R},W6:function(){return n},mj:function(){return y},nu:function(){return M}});var n,i,s=r(14606),a=(r(58941),r(40633)),o=r(95929),l=r(69739),c=r(7187),u=r(60539),d=r(28181),h=r(85445),f=r(38504),p=r(47558),m=r(16164),g=r(81197),_=r(55213);function y(){return new I.Scheduler}(i=n||(n={})).RESOURCE_CONTROLLER_IMMEDIATE="immediate",i.RESOURCE_CONTROLLER="schedule",i.SLIDE="slide",i.STREAM_DATA_LOADER="stream loader",i.ELEVATION_QUERY="elevation query",i.TERRAIN_SURFACE="terrain",i.SURFACE_GEOMETRY_UPDATES="surface geometry updates",i.LOD_RENDERER="LoD renderer",i.GRAPHICS_CORE="Graphics3D",i.I3S_CONTROLLER="I3S",i.POINT_CLOUD_LAYER="point cloud",i.FEATURE_TILE_FETCHER="feature fetcher",i.OVERLAY="overlay",i.STAGE="stage",i.GRAPHICS_DECONFLICTOR="graphics deconflictor",i.FILTER_VISIBILITY="Graphics3D filter visibility",i.SCALE_VISIBILITY="Graphics3D scale visibility",i.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",i.POINT_OF_INTEREST_FREQUENT="POI frequent",i.POINT_OF_INTEREST_INFREQUENT="POI infrequent",i.LABELER="labeler",i.FEATURE_QUERY_ENGINE="feature query",i.FEATURE_TILE_TREE="feature tile tree",i.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",i.ELEVATION_ALIGNMENT="elevation alignment",i.ELEVATION_ALIGNMENT_SCENE="elevation alignment scene",i.TEXT_TEXTURE_ATLAS="text texture atlas",i.TEXTURE_UNLOAD="texture unload",i.LINE_OF_SIGHT_TOOL="line of sight tool",i.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",i.ELEVATION_PROFILE="elevation profile",i.SNAPPING="snapping",i.SHADOW_ACCUMULATOR="shadow accumulator",i.CLOUDS_GENERATOR="clouds generator",i.MAPVIEW_FETCH_QUEUE="mapview fetch queue",i.MAPVIEW_LAYERVIEW_UPDATE="mapview layerview update",i.MAPVIEW_VECTOR_TILE_PARSING_QUEUE="mapview vector tile parsing queue",i[i.NONE=0]="NONE",i[i.TEST_PRIO=1]="TEST_PRIO";const v=new Map([[n.RESOURCE_CONTROLLER_IMMEDIATE,0],[n.RESOURCE_CONTROLLER,4],[n.SLIDE,0],[n.STREAM_DATA_LOADER,0],[n.ELEVATION_QUERY,0],[n.TERRAIN_SURFACE,1],[n.SURFACE_GEOMETRY_UPDATES,1],[n.LOD_RENDERER,2],[n.GRAPHICS_CORE,2],[n.I3S_CONTROLLER,2],[n.POINT_CLOUD_LAYER,2],[n.FEATURE_TILE_FETCHER,2],[n.CLOUDS_GENERATOR,2],[n.OVERLAY,4],[n.STAGE,4],[n.GRAPHICS_DECONFLICTOR,4],[n.FILTER_VISIBILITY,4],[n.SCALE_VISIBILITY,4],[n.FRUSTUM_VISIBILITY,4],[n.POINT_OF_INTEREST_FREQUENT,6],[n.POINT_OF_INTEREST_INFREQUENT,30],[n.LABELER,8],[n.FEATURE_QUERY_ENGINE,8],[n.FEATURE_TILE_TREE,16],[n.FEATURE_TILE_TREE_ACTIVE,0],[n.ELEVATION_ALIGNMENT,12],[n.ELEVATION_ALIGNMENT_SCENE,14],[n.TEXT_TEXTURE_ATLAS,12],[n.TEXTURE_UNLOAD,12],[n.LINE_OF_SIGHT_TOOL,16],[n.LINE_OF_SIGHT_TOOL_INTERACTIVE,0],[n.SNAPPING,0],[n.SHADOW_ACCUMULATOR,30],[n.MAPVIEW_FETCH_QUEUE,0],[n.MAPVIEW_LAYERVIEW_UPDATE,2],[n.MAPVIEW_VECTOR_TILE_PARSING_QUEUE,0]]);function T(e){return v.has(e)?v.get(e):"number"==typeof e?e:1}const b=(0,f.l5)(6.5),S=(0,f.l5)(1),A=(0,f.l5)(30),E=(0,f.l5)(1e3/30),w=(0,f.l5)(100);var I,x;!function(e){e.Scheduler=class{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some((e=>e.needsUpdate))}constructor(){this._updating=(0,h.v)(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new l.A("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new r,this._state=g.M.INTERACTING,this._tasks=new c.A,this._runQueue=new c.A,this._load=0,this._idleStateCallbacks=new c.A,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=(0,d.watch)((()=>m.A.SCHEDULER_LOG_SLOW_TASKS),(e=>this._debug=e),d.Vh);for(const e of Object.keys(n))this.performanceInfo.tasks.set(n[e],new l.A(n[e]))}destroy(){this._tasks.toArray().forEach((e=>e.remove())),this._tasks.clear(),(0,o.xt)(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(e){this._updatingChanged(),e&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask((()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this.frame())})))}registerTask(e,r){const n=new t(this,e,r);return this._tasks.push(n),this._updatingChanged(),this.performanceInfo.tasks.has(e)||this.performanceInfo.tasks.set(e,new l.A(e)),n}registerIdleStateCallbacks(e,t){const r={idleBegin:e,idleEnd:t};this._idleStateCallbacks.push(r),this.state===g.M.IDLE&&this._idleUpdatesStartFired&&r.idleBegin();const n=this;return{remove:()=>this._removeIdleStateCallbacks(r),set idleBegin(e){n._idleUpdatesStartFired&&(r.idleEnd(),n._state===g.M.IDLE&&e()),r.idleBegin=e},set idleEnd(e){r.idleEnd=e}}}get load(){return this._load}set state(e){this._state!==e&&(this._state=e,this.state!==g.M.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll((e=>e.idleEnd()))))}get state(){return this._state}updateBudget(e){this._test&&(this._test.usedBudget=0),++this._frameNumber;let t=b,r=e.frameDuration,n=S;switch(this.state){case g.M.IDLE:t=(0,f.l5)(0),r=(0,f.l5)(Math.max(w,e.frameDuration)),n=A;break;case g.M.INTERACTING:r=(0,f.l5)(Math.max(E,e.frameDuration));case g.M.ANIMATING:}return r=(0,f.l5)(r-e.elapsedFrameTime-t),this.state!==g.M.IDLE&&r<S&&!this._forceTask?(this._forceTask=!0,!1):(r=(0,f.l5)(Math.max(r,n)),this._budget.reset(r,this.state),this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case g.M.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll((e=>e.idleBegin()))),this._runIdle();break;case g.M.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test&&(this._test.usedBudget=this._budget.elapsed)}stopFrame(){this._budget.reset((0,f.l5)(0),this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(e){this._idleUpdatesStartFired&&e.idleEnd(),this._idleStateCallbacks.removeUnordered(e)}removeTask(e){this._tasks.removeUnordered(e),this._runQueue.removeUnordered(e),this._updatingChanged()}_updateTask(e){this._tasks.forAll((t=>{t.name===e&&t.setPriority(e)}))}_getState(e){if(this._runQueue.some((t=>t.name===e)))return x.SCHEDULED;let t=x.IDLE;return this._tasks.forAll((r=>{r.name===e&&r.needsUpdate&&(r.schedulePriority<=1?t=x.READY:t!==x.READY&&(t=x.WAITING))})),t}_getRuntime(e){let t=0;return this._tasks.forAll((r=>{r.name===e&&(t+=r.runtime)})),t}_resetRuntimes(){this._tasks.forAll((e=>e.runtime=0))}_getRunning(){const e=new Map;if(this._tasks.forAll((t=>{t.needsUpdate&&e.set(t.name,(e.get(t.name)||0)+1)})),0===e.size)return null;let t="";return e.forEach(((e,r)=>{t+=e>1?` ${e}x ${r}`:` ${r}`})),t}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const e=this._tasks.reduce(((e,t)=>t.needsUpdate?++e:e),0);this._load=.9*this._load+e*(1-.9)}_schedule(){for(this._runQueue.filterInPlace((e=>!!e.needsUpdate||(e.schedulePriority=e.basePriority,!1))),this._tasks.forAll((e=>{0===e.basePriority&&e.needsUpdate&&!this._runQueue.includes(e)&&e.blockFrame!==this._frameNumber&&this._runQueue.unshift(e)}));0===this._runQueue.length;){let e=!1,t=0;if(this._tasks.forAll((r=>{r.needsUpdate&&0!==r.schedulePriority&&0!==r.basePriority&&r.blockFrame!==this._frameNumber&&(e=!0,t=Math.max(t,r.basePriority),1===r.schedulePriority?(r.schedulePriority=0,this._runQueue.push(r)):--r.schedulePriority)})),!e)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){const e=this._budget.now();this._startFrameTaskTimes();do{for(;this._runQueue.length>0;){const t=this._budget.now(),r=this._runQueue.pop();this._budget.resetProgress();try{r.task.runTask(this._budget)===_.G&&(r.blockFrame=this._frameNumber)}catch(e){a.A.getLogger("esri.views.support.Scheduler").error(`Exception in task "${r.name}"`,e),r.blockFrame=this._frameNumber}!this._budget.hasProgressed&&r.blockFrame!==this._frameNumber&&r.needsUpdate&&(r.name,n.I3S_CONTROLLER,r.blockFrame=this._frameNumber),r.schedulePriority=r.basePriority;const i=this._budget.now()-t;if(r.runtime+=i,this._frameTaskTimes.set(r.priority,this._frameTaskTimes.get(r.priority)+i),this._budget.remaining<=0)return this._updatingChanged(),void this._recordFrameTaskTimes(this._budget.now()-e)}}while(this._schedule());this._updatingChanged(),this._recordFrameTaskTimes(this._budget.now()-e)}_startFrameTaskTimes(){for(const e of Object.keys(n))this._frameTaskTimes.set(n[e],0)}_recordFrameTaskTimes(e){this._frameTaskTimes.forEach(((e,t)=>this.performanceInfo.tasks.get(t).push(e))),this.performanceInfo.total.push(e)}get test(){return this._test}};class t{get task(){return this._task.value}get updating(){return this._queue.running}constructor(e,t,r){this._scheduler=e,this.name=t,this.blockFrame=0,this.runtime=0,this._queue=new p.T,this._handles=new s.A,this._basePriority=T(t),this.schedulePriority=this._basePriority,this._task=(0,h.v)(null!=r?r:this._queue),this._handles.add((0,d.when)((()=>this.task.running),(t=>e.taskRunningChanged(t))))}remove(){this.processQueue(R),this._scheduler.removeTask(this),this.schedule=M.schedule,this.reschedule=M.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(e){if(this.name===e)return;this.name=e;const t=T(e);0!==this._basePriority&&0===this.schedulePriority||(this.schedulePriority=t),this._basePriority=t}get priority(){return this.name}set priority(e){this.setPriority(e)}get needsUpdate(){return this.updating||this.task.running}schedule(e,t,r){return this._queue.push(e,t,r)}reschedule(e,t,r){return this._queue.unshift(e,t,r)}processQueue(e){return this._queue.runTask(e)}}class r{constructor(){this._begin="undefined"!=typeof performance?performance.now():0,this._budget=0,this._state=g.M.IDLE,this._done=!1,this._progressed=!1,this._enabled=!0}run(e){return!this.done&&(!0===e()&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get state(){return this._state}get enabled(){return this._enabled}set enabled(e){this._enabled=e}reset(e,t){this._begin=this.now(),this._budget=e,this._state=t,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return this.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}e.Budget=r}(I||(I={})),function(e){e.SCHEDULED="s",e.READY="r",e.WAITING="w",e.IDLE="i"}(x||(x={}));const R=(()=>{const e=new I.Budget;return e.enabled=!1,e})(),M=new class{remove(){}processQueue(){}schedule(e,t,r){try{if((0,u.G4)(t)){const e=(0,u.NK)();return r?Promise.resolve(r(e)):Promise.reject(e)}return(0,u.z7)(e(R))}catch(e){return Promise.reject(e)}}reschedule(e,t,r){return this.schedule(e,t,r)}}},55213:function(e,t,r){r.d(t,{G:function(){return n}});const n=Symbol("Yield")},16164:function(e,t,r){r.d(t,{A:function(){return l}});var n=r(53804),i=r(83525),s=r(23502),a=(r(58941),r(40633),r(13798),r(65953));let o=class extends i.A{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};(0,n._)([(0,s.MZ)()],o.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),(0,n._)([(0,s.MZ)()],o.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),o=(0,n._)([(0,a.$)("esri.views.support.debugFlags")],o);const l=new o},86305:function(e,t,r){r.d(t,{g:function(){return c}});var n=r(50659),i=(r(58941),r(40633)),s=r(24540),a=r(41835),o=r(85456);const l=()=>i.A.getLogger("esri.views.webgl.BufferObject");class c{static createIndex(e,t,r){return new c(e,o.NZ.ELEMENT_ARRAY_BUFFER,t,r)}static createVertex(e,t,r){return new c(e,o.NZ.ARRAY_BUFFER,t,r)}static createUniform(e,t,r){return new c(e,o.NZ.UNIFORM_BUFFER,t,r)}static createPixelPack(e,t=o._U.STREAM_READ,r){const n=new c(e,o.NZ.PIXEL_PACK_BUFFER,t);return r&&n.setSize(r),n}static createPixelUnpack(e,t=o._U.STREAM_DRAW,r){return new c(e,o.NZ.PIXEL_UNPACK_BUFFER,t,r)}static createTransformFeedback(e,t=o._U.STATIC_DRAW,r){const n=new c(e,o.NZ.TRANSFORM_FEEDBACK_BUFFER,t);return n.setSize(r),n}constructor(e,t,r,n){this._context=e,this.bufferType=t,this.usage=r,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(o.vt.BufferObject,this),this._glName=this._context.gl.createBuffer(),(0,a.Y2)(this._context.gl),n&&this.setData(n)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get usedMemory(){if(this.bufferType===o.NZ.ELEMENT_ARRAY_BUFFER){if(this._indexType===o.pe.UNSIGNED_INT)return 4*this._size;if(this._indexType===o.pe.UNSIGNED_SHORT)return 2*this._size}return this._size}get _isVAOAware(){return this.bufferType===o.NZ.ELEMENT_ARRAY_BUFFER||this.bufferType===o.NZ.ARRAY_BUFFER}dispose(){this._context?.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(o.vt.BufferObject,this),this._context=null):this._glName&&l().warn("Leaked WebGL buffer object")}setSize(e,t=null){if(this.bufferType===o.NZ.ELEMENT_ARRAY_BUFFER&&null!=t)switch(this._indexType=t,t){case o.pe.UNSIGNED_SHORT:e*=2;break;case o.pe.UNSIGNED_INT:e*=4}this._setBufferData(e)}setData(e){if(!e)return;let t=e.byteLength;this.bufferType===o.NZ.ELEMENT_ARRAY_BUFFER&&((0,s.mg)(e)?this._indexType=o.pe.UNSIGNED_BYTE:(0,s.jq)(e)?(t/=2,this._indexType=o.pe.UNSIGNED_SHORT):(0,s.XJ)(e)&&(t/=4,this._indexType=o.pe.UNSIGNED_INT)),this._setBufferData(t,e)}_setBufferData(e,t=null){this._size=e;const r=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const n=this._context.gl;null!=t?n.bufferData(this.bufferType,t,this.usage):n.bufferData(this.bufferType,e,this.usage),(0,a.Y2)(n),this._isVAOAware&&this._context.bindVAO(r)}setSubData(e,t,r,n){if(!e)return;const i=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const{gl:s}=this._context;s.bufferSubData(this.bufferType,t*e.BYTES_PER_ELEMENT,e,r,n-r),(0,a.Y2)(s),this._isVAOAware&&this._context.bindVAO(i)}getSubData(e,t=0,r,i){if(r<0||i<0)return;const s=function(e){return(0,n.Xj)(e)}(e)?e.BYTES_PER_ELEMENT:1;if(s*((r??0)+(i??0))>e.byteLength)return;t+s*(i??0)>this.usedMemory&&l().warn("Potential problem getting subdata: requested data exceeds buffer size!");const a=this._context.gl;this.bufferType===o.NZ.TRANSFORM_FEEDBACK_BUFFER?(this._context.bindBuffer(this,o.NZ.TRANSFORM_FEEDBACK_BUFFER),a.getBufferSubData(o.NZ.TRANSFORM_FEEDBACK_BUFFER,t,e,r,i),this._context.unbindBuffer(o.NZ.TRANSFORM_FEEDBACK_BUFFER)):(this._context.bindBuffer(this,o.NZ.COPY_READ_BUFFER),a.getBufferSubData(o.NZ.COPY_READ_BUFFER,t,e,r,i),this._context.unbindBuffer(o.NZ.COPY_READ_BUFFER))}async getSubDataAsync(e,t=0,r,n){await this._context.clientWaitAsync(),this.getSubData(e,t,r,n)}}},69452:function(e,t,r){var n;r.d(t,{p:function(){return n}}),function(e){e[e.Texture=0]="Texture",e[e.RenderBuffer=1]="RenderBuffer"}(n||(n={}))},12285:function(e,t,r){r.d(t,{g:function(){return c}});var n=r(39819),i=(r(58941),r(41835)),s=r(85456),a=r(69452),o=r(10956),l=r(31516);let c=class e{constructor(e,t=null,r=null){if(this.type=a.p.Texture,this._glName=null,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._wasImmutablyAllocated=!1,"context"in e)this._descriptor=e,r=t;else{const r=l.z.validate(e,t);if(!r)throw new n.A("Texture descriptor invalid");this._descriptor=r}this._descriptor.target===s.Ap.TEXTURE_CUBE_MAP?this._setDataCubeMap(r):this.setData(r)}get glName(){return this._glName}get descriptor(){return this._descriptor}get usedMemory(){return(0,o.e)(this._descriptor)}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._glName&&this._descriptor.context.instanceCounter.decrement(s.vt.Texture,this),this._descriptor.context.gl&&this._glName&&(this._descriptor.context.unbindTexture(this),this._descriptor.context.gl.deleteTexture(this._glName),this._glName=null)}release(){this.dispose()}resize(e,t){const r=this._descriptor;if(r.width!==e||r.height!==t){if(this._wasImmutablyAllocated)throw new n.A("Immutable textures can't be resized!");r.width=e,r.height=t,this._descriptor.target===s.Ap.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(e=null){for(let t=s.Ap.TEXTURE_CUBE_MAP_POSITIVE_X;t<=s.Ap.TEXTURE_CUBE_MAP_NEGATIVE_Z;t++)this._setData(e,t)}setData(e){this._setData(e)}_setData(t,r){const a=this._descriptor.context?.gl;if(!a)return;(0,i.Y2)(a),this._glName||(this._glName=a.createTexture(),this._glName&&this._descriptor.context.instanceCounter.increment(s.vt.Texture,this));const o=this._descriptor,l=r??o.target,c=m(l),_=this._descriptor.context.bindTexture(this,e.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(e.TEXTURE_UNIT_FOR_UPDATES),u(o),this._configurePixelStorage(),(0,i.Y2)(a);const y=this._deriveInternalFormat();if(p(t)){let e="width"in t?t.width:t.codedWidth,r="height"in t?t.height:t.codedHeight;const n=1;t instanceof HTMLVideoElement&&(e=t.videoWidth,r=t.videoHeight),o.width&&o.height,c&&o.depth,o.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(l,y,o.hasMipmap,e,r,n),this._texImage(l,0,y,e,r,n,t),(0,i.Y2)(a),o.hasMipmap&&(this.generateMipmap(),(0,i.Y2)(a)),o.width||(o.width=e),o.height||(o.height=r),c&&!o.depth&&(o.depth=n)}else{const{width:e,height:r,depth:u}=o;if(null==e||null==r)throw new n.A("Width and height must be specified!");if(c&&null==u)throw new n.A("Depth must be specified!");if(o.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(l,y,o.hasMipmap,e,r,u),f(t)){const i=t.levels,c=g(l,e,r,u),d=Math.min(c-1,i.length-1);a.texParameteri(o.target,this._descriptor.context.gl.TEXTURE_MAX_LEVEL,d);const h=y;if(!(h in s.CQ))throw new n.A("Attempting to use compressed data with an uncompressed format!");this._forEachMipmapLevel(((e,t,r,n)=>{const s=i[Math.min(e,i.length-1)];this._compressedTexImage(l,e,h,t,r,n,s)}),d)}else this._texImage(l,0,y,e,r,u,t),(0,i.Y2)(a),o.hasMipmap&&this.generateMipmap()}d(a,this._descriptor),h(a,this._descriptor),function(e,t){const r=e.capabilities.textureFilterAnisotropic;r&&e.gl.texParameterf(t.target,r.TEXTURE_MAX_ANISOTROPY,t.maxAnisotropy??1)}(this._descriptor.context,this._descriptor),(0,i.Y2)(a),this._descriptor.context.bindTexture(_,e.TEXTURE_UNIT_FOR_UPDATES)}updateData(t,r,i,s,a,o,l=0){o||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const c=this._descriptor,u=this._deriveInternalFormat(),{context:d,pixelFormat:h,dataType:m,target:g,isImmutable:_}=c;if(_&&!this._wasImmutablyAllocated)throw new n.A("Cannot update immutable texture before allocation!");const y=d.bindTexture(this,e.TEXTURE_UNIT_FOR_UPDATES,!0);(r<0||i<0||r+s>c.width||i+a>c.height)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage();const{gl:v}=d;l&&v.pixelStorei(v.UNPACK_SKIP_ROWS,l),p(o)?v.texSubImage2D(g,t,r,i,s,a,h,m,o):f(o)?v.compressedTexSubImage2D(g,t,r,i,s,a,u,o.levels[t]):v.texSubImage2D(g,t,r,i,s,a,h,m,o),l&&v.pixelStorei(v.UNPACK_SKIP_ROWS,0),d.bindTexture(y,e.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(t,r,i,s,a,o,l,c){c||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const u=this._descriptor,d=this._deriveInternalFormat(),{context:h,pixelFormat:p,dataType:g,isImmutable:_,target:y}=u;if(_&&!this._wasImmutablyAllocated)throw new n.A("Cannot update immutable texture before allocation!");m(y)||console.warn("Attempting to set 3D texture data on a non-3D texture");const v=h.bindTexture(this,e.TEXTURE_UNIT_FOR_UPDATES);h.setActiveTexture(e.TEXTURE_UNIT_FOR_UPDATES),(r<0||i<0||s<0||r+a>u.width||i+o>u.height||s+l>u.depth)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage();const{gl:T}=h;if(f(c))c=c.levels[t],T.compressedTexSubImage3D(y,t,r,i,s,a,o,l,d,c);else{const e=c;T.texSubImage3D(y,t,r,i,s,a,o,l,p,g,e)}h.bindTexture(v,e.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const t=this._descriptor;if(!t.hasMipmap){if(this._wasImmutablyAllocated)throw new n.A("Cannot add mipmaps to immutable texture after allocation");t.hasMipmap=!0,this._samplingModeDirty=!0,u(t)}t.samplingMode===s.Cj.LINEAR?(this._samplingModeDirty=!0,t.samplingMode=s.Cj.LINEAR_MIPMAP_NEAREST):t.samplingMode===s.Cj.NEAREST&&(this._samplingModeDirty=!0,t.samplingMode=s.Cj.NEAREST_MIPMAP_NEAREST);const r=this._descriptor.context.bindTexture(this,e.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(e.TEXTURE_UNIT_FOR_UPDATES),this._descriptor.context.gl.generateMipmap(t.target),this._descriptor.context.bindTexture(r,e.TEXTURE_UNIT_FOR_UPDATES)}clearMipmap(){const e=this._descriptor;if(e.hasMipmap){if(this._wasImmutablyAllocated)throw new n.A("Cannot delete mipmaps to immutable texture after allocation");e.hasMipmap=!1,this._samplingModeDirty=!0,u(e)}e.samplingMode===s.Cj.LINEAR_MIPMAP_NEAREST?(this._samplingModeDirty=!0,e.samplingMode=s.Cj.LINEAR):e.samplingMode===s.Cj.NEAREST_MIPMAP_NEAREST&&(this._samplingModeDirty=!0,e.samplingMode=s.Cj.NEAREST)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,u(this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const e=this._descriptor,t=e.context.gl;this._samplingModeDirty&&(d(t,e),this._samplingModeDirty=!1),this._wrapModeDirty&&(h(t,e),this._wrapModeDirty=!1)}_deriveInternalFormat(){if(null!=this._descriptor.internalFormat)return this._descriptor.internalFormat===s.Ab.DEPTH_STENCIL&&(this._descriptor.internalFormat=s.Ab.DEPTH24_STENCIL8),this._descriptor.internalFormat;switch(this._descriptor.dataType){case s.ld.FLOAT:switch(this._descriptor.pixelFormat){case s.Ab.RGBA:return this._descriptor.internalFormat=s.H0.RGBA32F;case s.Ab.RGB:return this._descriptor.internalFormat=s.H0.RGB32F;default:throw new n.A("Unable to derive format")}case s.ld.UNSIGNED_BYTE:switch(this._descriptor.pixelFormat){case s.Ab.RGBA:return this._descriptor.internalFormat=s.H0.RGBA8;case s.Ab.RGB:return this._descriptor.internalFormat=s.H0.RGB8}}return this._descriptor.internalFormat=this._descriptor.pixelFormat===s.Ab.DEPTH_STENCIL?s.Ab.DEPTH24_STENCIL8:this._descriptor.pixelFormat}_configurePixelStorage(){const e=this._descriptor.context.gl,{unpackAlignment:t,flipped:r,preMultiplyAlpha:n}=this._descriptor;e.pixelStorei(e.UNPACK_ALIGNMENT,t),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r?1:0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n?1:0)}_texStorage(e,t,r,i,a,o){const{gl:l}=this._descriptor.context;if(!(t in s.H0))throw new n.A("Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const c=r?g(e,i,a,o):1;if(m(e)){if(null==o)throw new n.A("Missing depth dimension for 3D texture upload");l.texStorage3D(e,c,t,i,a,o)}else l.texStorage2D(e,c,t,i,a);this._wasImmutablyAllocated=!0}_texImage(e,t,r,i,s,a,o){const l=this._descriptor.context.gl,c=m(e),{isImmutable:u,pixelFormat:d,dataType:h}=this._descriptor;if(u){if(null!=o){const r=o;if(c){if(null==a)throw new n.A("Missing depth dimension for 3D texture upload");l.texSubImage3D(e,t,0,0,0,i,s,a,d,h,r)}else l.texSubImage2D(e,t,0,0,i,s,d,h,r)}}else{const u=o;if(c){if(null==a)throw new n.A("Missing depth dimension for 3D texture upload");l.texImage3D(e,t,r,i,s,a,0,d,h,u)}else l.texImage2D(e,t,r,i,s,0,d,h,u)}}_compressedTexImage(e,t,r,i,s,a,o){const l=this._descriptor.context.gl,c=m(e);if(this._descriptor.isImmutable){if(null!=o)if(c){if(null==a)throw new n.A("Missing depth dimension for 3D texture upload");l.compressedTexSubImage3D(e,t,0,0,0,i,s,a,r,o)}else l.compressedTexSubImage2D(e,t,0,0,i,s,r,o)}else if(c){if(null==a)throw new n.A("Missing depth dimension for 3D texture upload");l.compressedTexImage3D(e,t,r,i,s,a,0,o)}else l.compressedTexImage2D(e,t,r,i,s,0,o)}_forEachMipmapLevel(e,t=1/0){let{width:r,height:i,depth:a,hasMipmap:o,target:l}=this._descriptor;const c=l===s.Ap.TEXTURE_3D;if(null==r||null==i||c&&null==a)throw new n.A("Missing texture dimensions for mipmap calculation");for(let n=0;e(n,r,i,a),o&&(1!==r||1!==i||c&&1!==a)&&!(n>=t);++n)r=Math.max(1,r>>1),i=Math.max(1,i>>1),c&&(a=Math.max(1,a>>1))}};function u(e){(null!=e.width&&e.width<0||null!=e.height&&e.height<0||null!=e.depth&&e.depth<0)&&console.error("Negative dimension parameters are not allowed!")}function d(e,t){let r=t.samplingMode,n=t.samplingMode;r===s.Cj.LINEAR_MIPMAP_NEAREST||r===s.Cj.LINEAR_MIPMAP_LINEAR?(r=s.Cj.LINEAR,t.hasMipmap||(n=s.Cj.LINEAR)):r!==s.Cj.NEAREST_MIPMAP_NEAREST&&r!==s.Cj.NEAREST_MIPMAP_LINEAR||(r=s.Cj.NEAREST,t.hasMipmap||(n=s.Cj.NEAREST)),e.texParameteri(t.target,e.TEXTURE_MAG_FILTER,r),e.texParameteri(t.target,e.TEXTURE_MIN_FILTER,n)}function h(e,t){"number"==typeof t.wrapMode?(e.texParameteri(t.target,e.TEXTURE_WRAP_S,t.wrapMode),e.texParameteri(t.target,e.TEXTURE_WRAP_T,t.wrapMode)):(e.texParameteri(t.target,e.TEXTURE_WRAP_S,t.wrapMode.s),e.texParameteri(t.target,e.TEXTURE_WRAP_T,t.wrapMode.t))}function f(e){return null!=e&&"type"in e&&"compressed"===e.type}function p(e){return null!=e&&!f(e)&&!function(e){return null!=e&&"byteLength"in e}(e)}function m(e){return e===s.Ap.TEXTURE_3D||e===s.Ap.TEXTURE_2D_ARRAY}function g(e,t,r,n=1){let i=Math.max(t,r);return e===s.Ap.TEXTURE_3D&&(i=Math.max(i,n)),Math.round(Math.log(i)/Math.LN2)+1}c.TEXTURE_UNIT_FOR_UPDATES=0},10956:function(e,t,r){r.d(t,{R:function(){return s},e:function(){return a}});var n=r(85456),i=r(93380);class s{constructor(e=0,t=e){this.width=e,this.height=t,this.target=n.Ap.TEXTURE_2D,this.pixelFormat=n.Ab.RGBA,this.dataType=n.ld.UNSIGNED_BYTE,this.samplingMode=n.Cj.LINEAR,this.wrapMode=n.pF.REPEAT,this.maxAnisotropy=1,this.flipped=!1,this.hasMipmap=!1,this.isOpaque=!1,this.unpackAlignment=4,this.preMultiplyAlpha=!1,this.depth=1,this.isImmutable=!1}}function a(e){return e.width<=0||e.height<=0?0:Math.round(e.width*e.height*(e.hasMipmap?4/3:1)*(null==e.internalFormat?4:(0,i.IB)(e.internalFormat))*(e.target===n.Ap.TEXTURE_CUBE_MAP?6:1))}},93380:function(e,t,r){r.d(t,{Hi:function(){return l},IB:function(){return c},WH:function(){return a},yu:function(){return o}}),r(58941);var n=r(41835),i=r(85456),s=r(48347);function a(e){const t=e.gl;switch(t.getError()){case t.NO_ERROR:return null;case t.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case t.INVALID_VALUE:return"An unacceptable value has been specified for an argument";case t.INVALID_OPERATION:return"The specified command is not allowed for the current state";case t.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case t.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case t.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function o(e,t,r,i,o=0){const l=e.gl;e.bindBuffer(r);for(const r of i){const i=t.get(r.name);if(null==i){console.warn(`There is no location for vertex attribute '${r.name}' defined.`);continue}const c=o*r.stride;if(r.count<=4)l.vertexAttribPointer(i,r.count,r.type,r.normalized,r.stride,r.offset+c),l.enableVertexAttribArray(i),r.divisor>0&&e.gl.vertexAttribDivisor(i,r.divisor);else if(9===r.count)for(let t=0;t<3;t++)l.vertexAttribPointer(i+t,3,r.type,r.normalized,r.stride,r.offset+12*t+c),l.enableVertexAttribArray(i+t),r.divisor>0&&e.gl.vertexAttribDivisor(i+t,r.divisor);else if(16===r.count)for(let t=0;t<4;t++)l.vertexAttribPointer(i+t,4,r.type,r.normalized,r.stride,r.offset+16*t+c),l.enableVertexAttribArray(i+t),r.divisor>0&&e.gl?.vertexAttribDivisor(i+t,r.divisor);else console.error("Unsupported vertex attribute element count: "+r.count);if((0,n.en)()){const t=a(e),n=(0,s._)(r.type),i=r.offset,o=Math.round(n/i)!==n/i?`. Offset not a multiple of stride. DataType requires ${n} bytes, but descriptor has an offset of ${i}`:"";t&&console.error(`Unable to bind vertex attribute "${r.name}" with baseInstanceOffset ${c}${o}:`,t,r)}}}function l(e,t,r,n){const s=e.gl;e.bindBuffer(r);for(const r of n){const n=t.get(r.name);if(r.count<=4)s.disableVertexAttribArray(n),r.divisor&&r.divisor>0&&e.gl?.vertexAttribDivisor(n,0);else if(9===r.count)for(let t=0;t<3;t++)s.disableVertexAttribArray(n+t),r.divisor&&r.divisor>0&&e.gl?.vertexAttribDivisor(n+t,0);else if(16===r.count)for(let t=0;t<4;t++)s.disableVertexAttribArray(n+t),r.divisor&&r.divisor>0&&e.gl?.vertexAttribDivisor(n+t,0);else console.error("Unsupported vertex attribute element count: "+r.count)}e.unbindBuffer(i.NZ.ARRAY_BUFFER)}function c(e){switch(e){case i.Ab.ALPHA:case i.Ab.LUMINANCE:case i.Ab.RED:case i.Ab.RED_INTEGER:case i.H0.R8:case i.H0.R8I:case i.H0.R8UI:case i.H0.R8_SNORM:case i.yQ.STENCIL_INDEX8:return 1;case i.Ab.LUMINANCE_ALPHA:case i.Ab.RG:case i.Ab.RG_INTEGER:case i.H0.RGBA4:case i.H0.R16F:case i.H0.R16I:case i.H0.R16UI:case i.H0.RG8:case i.H0.RG8I:case i.H0.RG8UI:case i.H0.RG8_SNORM:case i.H0.RGB565:case i.H0.RGB5_A1:case i.yQ.DEPTH_COMPONENT16:return 2;case i.Ab.DEPTH_COMPONENT:case i.Ab.RGB:case i.Ab.RGB_INTEGER:case i.H0.RGB8:case i.H0.RGB8I:case i.H0.RGB8UI:case i.H0.RGB8_SNORM:case i.H0.SRGB8:case i.yQ.DEPTH_COMPONENT24:return 3;case i.Ab.DEPTH_STENCIL:case i.Ab.DEPTH24_STENCIL8:case i.Ab.RGBA:case i.Ab.RGBA_INTEGER:case i.H0.RGBA8:case i.H0.R32F:case i.H0.R11F_G11F_B10F:case i.H0.RG16F:case i.H0.R32I:case i.H0.R32UI:case i.H0.RG16I:case i.H0.RG16UI:case i.H0.RGBA8I:case i.H0.RGBA8UI:case i.H0.RGBA8_SNORM:case i.H0.SRGB8_ALPHA8:case i.H0.RGB9_E5:case i.H0.RGB10_A2UI:case i.H0.RGB10_A2:case i.yQ.DEPTH_STENCIL:case i.yQ.DEPTH_COMPONENT32F:case i.yQ.DEPTH24_STENCIL8:return 4;case i.yQ.DEPTH32F_STENCIL8:return 5;case i.H0.RGB16F:case i.H0.RGB16I:case i.H0.RGB16UI:return 6;case i.H0.RG32F:case i.H0.RG32I:case i.H0.RG32UI:case i.H0.RGBA16F:case i.H0.RGBA16I:case i.H0.RGBA16UI:return 8;case i.H0.RGB32F:case i.H0.RGB32I:case i.H0.RGB32UI:return 12;case i.H0.RGBA32F:case i.H0.RGBA32I:case i.H0.RGBA32UI:return 16;case i.CQ.COMPRESSED_RGB_S3TC_DXT1_EXT:case i.CQ.COMPRESSED_RGBA_S3TC_DXT1_EXT:return.5;case i.CQ.COMPRESSED_RGBA_S3TC_DXT3_EXT:case i.CQ.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case i.CQ.COMPRESSED_R11_EAC:case i.CQ.COMPRESSED_SIGNED_R11_EAC:case i.CQ.COMPRESSED_RGB8_ETC2:case i.CQ.COMPRESSED_SRGB8_ETC2:case i.CQ.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case i.CQ.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return.5;case i.CQ.COMPRESSED_RG11_EAC:case i.CQ.COMPRESSED_SIGNED_RG11_EAC:case i.CQ.COMPRESSED_RGBA8_ETC2_EAC:case i.CQ.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}},31516:function(e,t,r){r.d(t,{z:function(){return s}});var n=r(85456),i=r(10956);class s extends i.R{constructor(e,t){switch(super(),this.context=e,Object.assign(this,t),this.internalFormat){case n.H0.R16F:case n.H0.R16I:case n.H0.R16UI:case n.H0.R32F:case n.H0.R32I:case n.H0.R32UI:case n.H0.R8_SNORM:case n.H0.R8:case n.H0.R8I:case n.H0.R8UI:this.pixelFormat=n.Ab.RED}}static validate(e,t){return new s(e,t)}}},81438:function(e,t,r){r.d(t,{Z:function(){return c}});var n=r(40633),i=r(95929),s=r(24540),a=r(85456),o=r(93380);const l=()=>n.A.getLogger("esri.views.webgl.VertexArrayObject");let c=class{constructor(e,t,r,n,i=null){this._context=e,this._locations=t,this._layout=r,this._buffers=n,this._indexBuffer=i,this._glName=null,this._initialized=!1}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get byteSize(){return Array.from(this._buffers.values()).reduce(((e,t)=>e+t.usedMemory),null!=this._indexBuffer?this._indexBuffer.usedMemory:0)}get layout(){return this._layout}get locations(){return this._locations}get usedMemory(){return this.byteSize+(Object.keys(this._buffers).length+(this._indexBuffer?1:0))*s.zQ}dispose(){this._context?(this._context.getBoundVAO()===this&&this._context.bindVAO(null),this._buffers.forEach((e=>e.dispose())),this._buffers.clear(),this._indexBuffer=(0,i.WD)(this._indexBuffer),this.disposeVAOOnly()):(this._glName||Object.getOwnPropertyNames(this._buffers).length>0)&&l().warn("Leaked WebGL VAO")}disposeVAOOnly(){this._glName&&(this._context.gl.deleteVertexArray(this._glName),this._glName=null,this._context.instanceCounter.decrement(a.vt.VertexArrayObject,this)),this._context=null}initialize(){if(this._initialized)return;const{gl:e}=this._context,t=e.createVertexArray();e.bindVertexArray(t),this._bindLayout(),e.bindVertexArray(null),this._glName=t,this._context.instanceCounter.increment(a.vt.VertexArrayObject,this),this._initialized=!0}bind(){this.initialize(),this._context.gl.bindVertexArray(this.glName)}_bindLayout(){const{_buffers:e,_layout:t,_indexBuffer:r}=this;e||l().error("Vertex buffer dictionary is empty!");const n=this._context.gl;this._buffers.forEach(((e,r)=>{const n=t.get(r);n?(0,o.yu)(this._context,this._locations,e,n):l().error("Vertex element descriptor is empty!")})),null!=r&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,r.glName)}unbind(){this.initialize(),this._context.gl.bindVertexArray(null)}}},3817:function(e,t,r){r.d(t,{_:function(){return n}});class n{constructor(e,t,r,n,i,s=!1,a=0){this.name=e,this.count=t,this.type=r,this.offset=n,this.stride=i,this.normalized=s,this.divisor=a}}},41835:function(e,t,r){r.d(t,{Xc:function(){return c},Y2:function(){return u},en:function(){return l}});var n=r(39819),i=r(58941),s=r(40633);const a=()=>s.A.getLogger("esri.views.webgl.checkWebGLError"),o=!!(0,i.A)("enable-feature:webgl-debug");function l(){return o}function c(){return o}function u(e){if(l()){const t=e.getError();if(t){const r=function(e,t){switch(t){case e.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case e.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case e.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case e.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case e.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case e.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}(e,t),i=(new Error).stack;a().error(new n.A("webgl-error","WebGL error occurred",{message:r,stack:i}))}}}},44476:function(e,t,r){function n(e,t,r){for(let n=0;n<r;++n)t[2*n]=e[n],t[2*n+1]=e[n]-t[2*n]}function i(e,t){const r=e.length;for(let n=0;n<r;++n)a[0]=e[n],t[n]=a[0];return t}function s(e,t){const r=e.length;for(let n=0;n<r;++n)a[0]=e[n],a[1]=e[n]-a[0],t[n]=a[1];return t}r.d(t,{Zo:function(){return i},jA:function(){return s},jS:function(){return n}});const a=new Float32Array(2)},85456:function(e,t,r){var n,i,s,a,o,l,c,u,d,h,f,p,m,g,_,y,v,T,b,S;r.d(t,{Ab:function(){return g},Ac:function(){return c},Ap:function(){return m},CQ:function(){return R},Cj:function(){return f},Co:function(){return b},H0:function(){return _},Hr:function(){return I},MT:function(){return d},NV:function(){return n},NZ:function(){return o},Nm:function(){return w},R:function(){return S},Tb:function(){return a},WR:function(){return i},Y7:function(){return l},_U:function(){return T},dn:function(){return s},eA:function(){return h},ld:function(){return y},nI:function(){return x},pF:function(){return p},pe:function(){return u},sS:function(){return N},tx:function(){return L},vt:function(){return E},xM:function(){return A},xV:function(){return M},yQ:function(){return v}}),function(e){e[e.DEPTH=256]="DEPTH",e[e.STENCIL=1024]="STENCIL",e[e.COLOR=16384]="COLOR"}(n||(n={})),function(e){e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(i||(i={})),function(e){e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(s||(s={})),function(e){e[e.ADD=32774]="ADD",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX",e[e.SUBTRACT=32778]="SUBTRACT",e[e.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"}(a||(a={})),function(e){e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",e[e.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER"}(o||(o={})),function(e){e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(l||(l={})),function(e){e[e.CW=2304]="CW",e[e.CCW=2305]="CCW"}(c||(c={})),function(e){e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.HALF_FLOAT=5131]="HALF_FLOAT"}(u||(u={})),function(e){e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS"}(d||(d={})),function(e){e[e.ZERO=0]="ZERO",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP"}(h||(h={})),function(e){e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(f||(f={})),function(e){e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.REPEAT=10497]="REPEAT",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(p||(p={})),function(e){e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"}(m||(m={})),function(e){e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.RED=6403]="RED",e[e.RG=33319]="RG",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER"}(g||(g={})),function(e){e[e.RGBA4=32854]="RGBA4",e[e.R16F=33325]="R16F",e[e.RG16F=33327]="RG16F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.R32F=33326]="R32F",e[e.RG32F=33328]="RG32F",e[e.RGBA32F=34836]="RGBA32F",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB5_A1=32855]="RGB5_A1",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.RGB16F=34843]="RGB16F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.RGB565=36194]="RGB565",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2=32857]="RGB10_A2",e[e.RGB10_A2UI=36975]="RGB10_A2UI"}(_||(_={})),function(e){e[e.FLOAT=5126]="FLOAT",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.INT=5124]="INT",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"}(y||(y={})),function(e){e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"}(v||(v={})),function(e){e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_READ=35045]="STATIC_READ",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.STREAM_COPY=35042]="STREAM_COPY"}(T||(T={})),function(e){e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER"}(b||(b={})),function(e){e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"}(S||(S={}));const A=33984;var E,w,I;!function(e){e[e.Texture=0]="Texture",e[e.BufferObject=1]="BufferObject",e[e.VertexArrayObject=2]="VertexArrayObject",e[e.Shader=3]="Shader",e[e.Program=4]="Program",e[e.FramebufferObject=5]="FramebufferObject",e[e.Renderbuffer=6]="Renderbuffer",e[e.TransformFeedback=7]="TransformFeedback",e[e.Sync=8]="Sync",e[e.UNCOUNTED=9]="UNCOUNTED",e[e.LinesOfCode=9]="LinesOfCode",e[e.Uniform=10]="Uniform",e[e.COUNT=11]="COUNT"}(E||(E={})),function(e){e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"}(w||(w={})),function(e){e[e.NONE=0]="NONE",e[e.BACK=1029]="BACK"}(I||(I={}));const x=33306;var R,M,O,C,N,L,F;!function(e){e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"}(R||(R={})),function(e){e[e.FLOAT=5126]="FLOAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT=5124]="INT",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"}(M||(M={})),function(e){e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS"}(O||(O={})),function(e){e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED"}(C||(C={})),function(e){e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED"}(N||(N={})),function(e){e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"}(L||(L={})),function(e){e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"}(F||(F={}))},48347:function(e,t,r){r.d(t,{_:function(){return i}});var n=r(85456);function i(e){switch(e){case n.pe.BYTE:case n.pe.UNSIGNED_BYTE:return 1;case n.pe.SHORT:case n.pe.UNSIGNED_SHORT:case n.pe.HALF_FLOAT:return 2;case n.pe.FLOAT:case n.pe.INT:case n.pe.UNSIGNED_INT:return 4}}},57087:function(e,t,r){r.d(t,{Ey:function(){return E},Ky:function(){return c},Ms:function(){return q},Os:function(){return l},Uy:function(){return f},Xt:function(){return h},gh:function(){return o},hG:function(){return d},kn:function(){return p},p3:function(){return a}});var n=r(54407),i=r(85456);function s(e,t,r=i.Tb.ADD,n=[0,0,0,0]){return{srcRgb:e,srcAlpha:e,dstRgb:t,dstAlpha:t,opRgb:r,opAlpha:r,color:{r:n[0],g:n[1],b:n[2],a:n[3]}}}function a(e,t,r,n,s=i.Tb.ADD,a=i.Tb.ADD,o=[0,0,0,0]){return{srcRgb:e,srcAlpha:t,dstRgb:r,dstAlpha:n,opRgb:s,opAlpha:a,color:{r:o[0],g:o[1],b:o[2],a:o[3]}}}const o=s(i.dn.ZERO,i.dn.ONE_MINUS_SRC_ALPHA),l=(s(i.dn.ONE,i.dn.ZERO),s(i.dn.ONE,i.dn.ONE),s(i.dn.ONE,i.dn.ONE_MINUS_SRC_ALPHA)),c=a(i.dn.SRC_ALPHA,i.dn.ONE,i.dn.ONE_MINUS_SRC_ALPHA,i.dn.ONE_MINUS_SRC_ALPHA),u={face:i.Y7.BACK,mode:i.Ac.CCW},d={face:i.Y7.FRONT,mode:i.Ac.CCW},h=e=>e===n.s2.Back?u:e===n.s2.Front?d:null,f={zNear:0,zFar:1},p={r:!0,g:!0,b:!0,a:!0};function m(e){return x.intern(e)}function g(e){return M.intern(e)}function _(e){return C.intern(e)}function y(e){return L.intern(e)}function v(e){return D.intern(e)}function T(e){return B.intern(e)}function b(e){return G.intern(e)}function S(e){return H.intern(e)}function A(e){return k.intern(e)}function E(e){return Z.intern(e)}class w{constructor(e,t){this._makeKey=e,this._makeRef=t,this._interns=new Map}intern(e){if(!e)return null;const t=this._makeKey(e),r=this._interns;return r.has(t)||r.set(t,this._makeRef(e)),r.get(t)??null}}function I(e){return"["+e.join(",")+"]"}const x=new w(R,(e=>({__tag:"Blending",...e})));function R(e){return e?I([e.srcRgb,e.srcAlpha,e.dstRgb,e.dstAlpha,e.opRgb,e.opAlpha,e.color.r,e.color.g,e.color.b,e.color.a]):null}const M=new w(O,(e=>({__tag:"Culling",...e})));function O(e){return e?I([e.face,e.mode]):null}const C=new w(N,(e=>({__tag:"PolygonOffset",...e})));function N(e){return e?I([e.factor,e.units]):null}const L=new w(F,(e=>({__tag:"DepthTest",...e})));function F(e){return e?I([e.func]):null}const D=new w(P,(e=>({__tag:"StencilTest",...e})));function P(e){return e?I([e.function.func,e.function.ref,e.function.mask,e.operation.fail,e.operation.zFail,e.operation.zPass]):null}const B=new w(U,(e=>({__tag:"DepthWrite",...e})));function U(e){return e?I([e.zNear,e.zFar]):null}const G=new w(z,(e=>({__tag:"ColorWrite",...e})));function z(e){return e?I([e.r,e.g,e.b,e.a]):null}const H=new w(V,(e=>({__tag:"StencilWrite",...e})));function V(e){return e?I([e.mask]):null}const k=new w(j,(e=>({__tag:"DrawBuffers",...e})));function j(e){return e?I(e.buffers):null}const Z=new w((function(e){return e?I([R(e.blending),O(e.culling),N(e.polygonOffset),F(e.depthTest),P(e.stencilTest),U(e.depthWrite),z(e.colorWrite),V(e.stencilWrite),j(e.drawBuffers)]):null}),(e=>({blending:m(e.blending),culling:g(e.culling),polygonOffset:_(e.polygonOffset),depthTest:y(e.depthTest),stencilTest:v(e.stencilTest),depthWrite:T(e.depthWrite),colorWrite:b(e.colorWrite),stencilWrite:S(e.stencilWrite),drawBuffers:A(e.drawBuffers)})));class q{constructor(e){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._drawBuffersInvalid=!0,this._stateSetters=e}setPipeline(e){(this._pipelineInvalid||e!==this._pipeline)&&(this._setBlending(e.blending),this._setCulling(e.culling),this._setPolygonOffset(e.polygonOffset),this._setDepthTest(e.depthTest),this._setStencilTest(e.stencilTest),this._setDepthWrite(e.depthWrite),this._setColorWrite(e.colorWrite),this._setStencilWrite(e.stencilWrite),this._setDrawBuffers(e.drawBuffers),this._pipeline=e),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDrawBuffers(){this._drawBuffersInvalid=!0,this._pipelineInvalid=!0}_setBlending(e){this._blending=this._setSubState(e,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(e){this._culling=this._setSubState(e,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(e){this._polygonOffset=this._setSubState(e,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(e){this._depthTest=this._setSubState(e,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(e){this._stencilTest=this._setSubState(e,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(e){this._depthWrite=this._setSubState(e,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(e){this._colorWrite=this._setSubState(e,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(e){this._stencilWrite=this._setSubState(e,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setDrawBuffers(e){this._drawBuffers=this._setSubState(e,this._drawBuffers,this._drawBuffersInvalid,this._stateSetters.setDrawBuffers),this._drawBuffersInvalid=!1}_setSubState(e,t,r,n){return(r||e!==t)&&(n(e),this._pipelineInvalid=!0),e}}},84624:function(e,t,r){r.d(t,{CJ:function(){return h}});var n=r(39819),i=r(21609),s=r(34194),a=r(47527),o=r(11432);const l=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wms","wmts"]),c=new Set(["catalog","csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","knowledge-graph","map-image","map-notes","media","ogc-feature","oriented-imagery","route","stream","subtype-group","tile","unknown","unsupported","vector-tile","web-tile","wfs","wms","wmts"]);function u(e,t){if(t.restrictedWebMapWriting){const r=function(e){return"basemap"===e.layerContainerType?l:"operational-layers"===e.layerContainerType?c:null}(t);return null==r||r.has(e.type)&&!(0,o.Ov)(e)}return!0}function d(e,t){"maxScale"in e&&(t.maxScale=(0,a.B)(e.maxScale)??void 0),"minScale"in e&&(t.minScale=(0,a.B)(e.minScale)??void 0)}function h(e,t,r){if(!e.persistenceEnabled)return null;if(!("write"in e)||!e.write)return r?.messages&&r.messages.push(new n.A("layer:unsupported",`Layers (${e.title}, ${e.id}) of type '${e.declaredClass}' cannot be persisted`,{layer:e})),null;if((0,o.Ov)(e)&&!e.isTable)t=e.resourceInfo;else if(u(e,r)){const t={};return e.write(t,r)?t:null}return null!=t&&function(e,t){if(function(e,t){if(t)if((0,o.Ov)(e)){const r=(0,s.wc)("featureCollection.layers",t),n=r?.[0]?.layerDefinition;n&&d(e,n)}else"group"!==e.type&&d(e,t)}(e,t),t&&(t.id=e.id,"blendMode"in e&&(t.blendMode=e.blendMode,"normal"===t.blendMode&&delete t.blendMode),t.opacity=(0,a.B)(e.opacity)??void 0,t.title=e.title||"Layer",t.visibility=e.visible,"legendEnabled"in e&&"wmts"!==e.type))if((0,o.Ov)(e)){const r=t.featureCollection;r&&(r.showLegend=e.legendEnabled)}else t.showLegend=e.legendEnabled}(e,t=(0,i.o8)(t)),t}}}]);
//# sourceMappingURL=views-3d-layers-graphics-pipeline-Feature3DPipelineWorker.js.map