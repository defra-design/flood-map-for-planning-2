/*! For license information please see views-3d-interactive-editingTools.js.LICENSE.txt */
(self.webpackChunkdefra=self.webpackChunkdefra||[]).push([[4602],{54140:function(e){function t(e){return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}))}t.keys=function(){return[]},t.resolve=t,t.id=54140,e.exports=t},54038:function(e,t,n){"use strict";n.d(t,{i:function(){return r}});var i=n(3102);const r=()=>i.L2.isBrowser&&"undefined"!=typeof navigator&&"undefined"!=typeof window&&"undefined"!=typeof location&&"undefined"!=typeof document&&window.location===location&&window.document===document},67646:function(e,t,n){"use strict";n.d(t,{f:function(){return o},s:function(){return c}});var i=n(3102);const r=globalThis.calciteConfig,o=r?.focusTrapStack||[],s=(i.L2.isTesting&&i.L2.isBrowser,"2.13.2"),a="2024-10-24",l="e38e2977d";function c(){if(r&&r.version)return;console.info(`Using Calcite Components ${s} [Date: ${a}, Revision: ${l}]`);const e=r||globalThis.calciteConfig||{};Object.defineProperty(e,"version",{value:s,writable:!1}),globalThis.calciteConfig=e}},96367:function(e,t,n){"use strict";n.d(t,{C:function(){return o},D:function(){return s},a:function(){return i},d:function(){return r}});const i="calcite-mode-auto",r="calcite-mode-dark",o={autoMode:i,darkMode:r,lightMode:"calcite-mode-light",rtl:"calcite--rtl",calciteAnimate:"calcite-animate",calciteAnimateIn:"calcite-animate__in",calciteAnimateInUp:"calcite-animate__in-up",calciteAnimateInDown:"calcite-animate__in-down",calciteAnimateInRight:"calcite-animate__in-right",calciteAnimateInLeft:"calcite-animate__in-left",calciteAnimateInScale:"calcite-animate__in-scale"},s={filter:250,nextTick:0,resize:150,reposition:100}},3102:function(e,t,n){"use strict";n.d(t,{L2:function(){return s},FK:function(){return Mt},wt:function(){return S},xr:function(){return ie},lh:function(){return he},$x:function(){return tt},OX:function(){return k},h:function(){return te},w$:function(){return At},gv:function(){return V},Qu:function(){return B}});var i={allRenderFn:!1,cmpDidLoad:!0,cmpDidUnload:!1,cmpDidUpdate:!0,cmpDidRender:!0,cmpWillLoad:!0,cmpWillUpdate:!0,cmpWillRender:!0,connectedCallback:!0,disconnectedCallback:!0,element:!0,event:!0,hasRenderFn:!0,lifecycle:!0,hostListener:!0,hostListenerTargetWindow:!0,hostListenerTargetDocument:!0,hostListenerTargetBody:!0,hostListenerTargetParent:!1,hostListenerTarget:!0,member:!0,method:!0,mode:!0,observeAttribute:!0,prop:!0,propMutable:!0,reflect:!0,scoped:!0,shadowDom:!0,slot:!0,cssAnnotations:!0,state:!0,style:!0,formAssociated:!1,svg:!0,updatable:!0,vdomAttribute:!0,vdomXlink:!0,vdomClass:!0,vdomFunctional:!0,vdomKey:!0,vdomListener:!0,vdomRef:!0,vdomPropOrAttr:!0,vdomRender:!0,vdomStyle:!0,vdomText:!0,watchCallback:!0,taskQueue:!0,hotModuleReplacement:!1,isDebug:!1,isDev:!1,isTesting:!1,hydrateServerSide:!1,hydrateClientSide:!1,lifecycleDOMEvents:!1,lazyLoad:!1,profile:!1,slotRelocation:!0,appendChildSlotFix:!1,cloneNodeFix:!1,hydratedAttribute:!1,hydratedClass:!0,scriptDataOpts:!1,scopedSlotTextContentFix:!1,shadowDomShim:!1,slotChildNodesFix:!1,invisiblePrehydration:!0,propBoolean:!0,propNumber:!0,propString:!0,constructableCSS:!0,cmpShouldUpdate:!0,devTools:!1,shadowDelegatesFocus:!0,initializeNextTick:!1,asyncLoading:!1,asyncQueue:!1,transformTagName:!1,attachStyles:!0,experimentalSlotFixes:!1},r="app",o=Object.defineProperty,s={isDev:!!i.isDev,isBrowser:!0,isServer:!1,isTesting:!!i.isTesting},a=i.hotModuleReplacement?window.__STENCIL_HOSTREFS__||(window.__STENCIL_HOSTREFS__=new WeakMap):new WeakMap,l=e=>a.get(e),c=(e,t)=>t in e,u=(e,t)=>(0,console.error)(e,t),h=i.isTesting?["STENCIL:"]:["%cstencil","color: white;background:#4c47ff;font-weight: bold; font-size:10px; padding:2px 6px; border-radius: 5px"],d=(...e)=>console.error(...h,...e),p=(...e)=>console.warn(...h,...e),f=new Map,g=new Map,m=[],_="s-id",v="sty-id",y="c-id",b="http://www.w3.org/1999/xlink",T=["formAssociatedCallback","formResetCallback","formDisabledCallback","formStateRestoreCallback"],x="undefined"!=typeof window?window:{},w=x.document||{head:{}},S=x.HTMLElement||class{},E={$flags$:0,$resourcesUrl$:"",jmp:e=>e(),raf:e=>requestAnimationFrame(e),ael:(e,t,n,i)=>e.addEventListener(t,n,i),rel:(e,t,n,i)=>e.removeEventListener(t,n,i),ce:(e,t)=>new CustomEvent(e,t)},A=i.shadowDom,M=(()=>{let e=!1;try{w.addEventListener("e",null,Object.defineProperty({},"passive",{get(){e=!0}}))}catch(e){}return e})(),O=!!i.constructableCSS&&(()=>{try{return new CSSStyleSheet,"function"==typeof(new CSSStyleSheet).replaceSync}catch(e){}return!1})(),R=0,C=!1,I=[],P=[],D=[],L=(e,t)=>n=>{e.push(n),C||(C=!0,t&&4&E.$flags$?H(z):E.raf(z))},N=e=>{for(let t=0;t<e.length;t++)try{e[t](performance.now())}catch(e){u(e)}e.length=0},F=(e,t)=>{let n=0,i=0;for(;n<e.length&&(i=performance.now())<t;)try{e[n++](i)}catch(e){u(e)}n===e.length?e.length=0:0!==n&&e.splice(0,n)},z=()=>{if(i.asyncQueue&&R++,N(I),i.asyncQueue){const e=2==(6&E.$flags$)?performance.now()+14*Math.ceil(.1*R):1/0;F(P,e),F(D,e),P.length>0&&(D.push(...P),P.length=0),(C=I.length+P.length+D.length>0)?E.raf(z):R=0}else N(P),(C=I.length>0)&&E.raf(z)},H=e=>Promise.resolve(void 0).then(e),V=L(I,!1),U=L(P,!0),k=e=>{const t=new URL(e,E.$resourcesUrl$);return t.origin!==x.location.origin?t.href:t.pathname},B=e=>E.$resourcesUrl$=e,G={},$=e=>"object"==(e=typeof e)||"function"===e;((e,t)=>{for(var n in t)o(e,n,{get:t[n],enumerable:!0})})({},{err:()=>Z,map:()=>W,ok:()=>j,unwrap:()=>Q,unwrapErr:()=>K});var j=e=>({isOk:!0,isErr:!1,value:e}),Z=e=>({isOk:!1,isErr:!0,value:e});function W(e,t){if(e.isOk){const n=t(e.value);return n instanceof Promise?n.then((e=>j(e))):j(n)}if(e.isErr){const t=e.value;return Z(t)}throw"should never get here"}var q,Y,X,Q=e=>{if(e.isOk)return e.value;throw e.value},K=e=>{if(e.isErr)return e.value;throw e.value},J=0,ee=(e,t="")=>{if(i.profile&&performance.mark){const n=`st:${e}:${t}:${J++}`;return performance.mark(n),()=>performance.measure(`[Stencil] ${e}() <${t}>`,n)}return()=>{}},te=(e,t,...n)=>{let r=null,o=null,s=null,a=!1,l=!1;const c=[],u=t=>{for(let n=0;n<t.length;n++)r=t[n],Array.isArray(r)?u(r):null!=r&&"boolean"!=typeof r&&((a="function"!=typeof e&&!$(r))?r=String(r):i.isDev&&"function"!=typeof e&&void 0===r.$flags$&&d("vNode passed as children has unexpected type.\nMake sure it's using the correct h() function.\nEmpty objects can also be the cause, look for JSX comments that became objects."),a&&l?c[c.length-1].$text$+=r:c.push(a?ne(null,r):r),l=a)};if(u(n),t&&(i.isDev&&"input"===e&&le(t),i.vdomKey&&t.key&&(o=t.key),i.slotRelocation&&t.name&&(s=t.name),i.vdomClass)){const e=t.className||t.class;e&&(t.class="object"!=typeof e?e:Object.keys(e).filter((t=>e[t])).join(" "))}if(i.isDev&&c.some(re)&&d("The <Host> must be the single root component. Make sure:\n- You are NOT using hostData() and <Host> in the same component.\n- <Host> is used once, and it's the single root component of the render() function."),i.vdomFunctional&&"function"==typeof e)return e(null===t?{}:t,c,oe);const h=ne(e,null);return h.$attrs$=t,c.length>0&&(h.$children$=c),i.vdomKey&&(h.$key$=o),i.slotRelocation&&(h.$name$=s),h},ne=(e,t)=>{const n={$flags$:0,$tag$:e,$text$:t,$elm$:null,$children$:null};return i.vdomAttribute&&(n.$attrs$=null),i.vdomKey&&(n.$key$=null),i.slotRelocation&&(n.$name$=null),n},ie={},re=e=>e&&e.$tag$===ie,oe={forEach:(e,t)=>e.map(se).forEach(t),map:(e,t)=>e.map(se).map(t).map(ae)},se=e=>({vattrs:e.$attrs$,vchildren:e.$children$,vkey:e.$key$,vname:e.$name$,vtag:e.$tag$,vtext:e.$text$}),ae=e=>{if("function"==typeof e.vtag){const t={...e.vattrs};return e.vkey&&(t.key=e.vkey),e.vname&&(t.name=e.vname),te(e.vtag,t,...e.vchildren||[])}const t=ne(e.vtag,e.vtext);return t.$attrs$=e.vattrs,t.$children$=e.vchildren,t.$key$=e.vkey,t.$name$=e.vname,t},le=e=>{const t=Object.keys(e),n=t.indexOf("value");if(-1===n)return;const i=t.indexOf("type"),r=t.indexOf("min"),o=t.indexOf("max"),s=t.indexOf("step");(n<i||n<r||n<o||n<s)&&p('The "value" prop of <input> should be set after "min", "max", "type" and "step"')},ce=(e,t,n,r,o,s,a)=>{let l,c,u,h;if(1===s.nodeType){if(l=s.getAttribute(y),l&&(c=l.split("."),c[0]!==a&&"0"!==c[0]||(u={$flags$:0,$hostId$:c[0],$nodeId$:c[1],$depth$:c[2],$index$:c[3],$tag$:s.tagName.toLowerCase(),$elm$:s,$attrs$:null,$children$:null,$key$:null,$name$:null,$text$:null},t.push(u),s.removeAttribute(y),e.$children$||(e.$children$=[]),e.$children$[u.$index$]=u,e=u,r&&"0"===u.$depth$&&(r[u.$index$]=u.$elm$))),s.shadowRoot)for(h=s.shadowRoot.childNodes.length-1;h>=0;h--)ce(e,t,n,r,o,s.shadowRoot.childNodes[h],a);for(h=s.childNodes.length-1;h>=0;h--)ce(e,t,n,r,o,s.childNodes[h],a)}else if(8===s.nodeType)c=s.nodeValue.split("."),c[1]!==a&&"0"!==c[1]||(l=c[0],u={$flags$:0,$hostId$:c[1],$nodeId$:c[2],$depth$:c[3],$index$:c[4],$elm$:s,$attrs$:null,$children$:null,$key$:null,$name$:null,$tag$:null,$text$:null},"t"===l?(u.$elm$=s.nextSibling,u.$elm$&&3===u.$elm$.nodeType&&(u.$text$=u.$elm$.textContent,t.push(u),s.remove(),e.$children$||(e.$children$=[]),e.$children$[u.$index$]=u,r&&"0"===u.$depth$&&(r[u.$index$]=u.$elm$))):u.$hostId$===a&&("s"===l?(u.$tag$="slot",c[5]?s["s-sn"]=u.$name$=c[5]:s["s-sn"]="",s["s-sr"]=!0,i.shadowDom&&r&&(u.$elm$=w.createElement(u.$tag$),u.$name$&&u.$elm$.setAttribute("name",u.$name$),s.parentNode.insertBefore(u.$elm$,s),s.remove(),"0"===u.$depth$&&(r[u.$index$]=u.$elm$)),n.push(u),e.$children$||(e.$children$=[]),e.$children$[u.$index$]=u):"r"===l&&(i.shadowDom&&r?s.remove():i.slotRelocation&&(o["s-cr"]=s,s["s-cn"]=!0))));else if(e&&"style"===e.$tag$){const t=ne(null,s.textContent);t.$elm$=s,t.$index$="0",e.$children$=[t]}},ue=(e,t)=>{if(1===e.nodeType){let n=0;if(e.shadowRoot)for(;n<e.shadowRoot.childNodes.length;n++)ue(e.shadowRoot.childNodes[n],t);for(n=0;n<e.childNodes.length;n++)ue(e.childNodes[n],t)}else if(8===e.nodeType){const n=e.nodeValue.split(".");"o"===n[0]&&(t.set(n[1]+"."+n[2],e),e.nodeValue="",e["s-en"]=n[3])}},he=(e,t,n)=>{const r=(e=>i.lazyLoad?l(e).$hostElement$:e)(e);return{emit:e=>(i.isDev&&!r.isConnected&&p(`The "${t}" event was emitted, but the dispatcher node is no longer connected to the dom.`),de(r,t,{bubbles:!!(4&n),composed:!!(2&n),cancelable:!!(1&n),detail:e}))}},de=(e,t,n)=>{const i=E.ce(t,n);return e.dispatchEvent(i),i},pe=new WeakMap,fe=(e,t,n)=>{var r;const o=ge(t,n),s=g.get(o);if(!i.attachStyles)return o;if(e=11===e.nodeType?e:w,s)if("string"==typeof s){e=e.head||e;let n,a=pe.get(e);if(a||pe.set(e,a=new Set),!a.has(o)){if(i.hydrateClientSide&&e.host&&(n=e.querySelector(`[${v}="${o}"]`)))n.innerHTML=s;else{n=w.createElement("style"),n.innerHTML=s;const a=null!=(r=E.$nonce$)?r:function(e){var t,n,i;return null!=(i=null==(n=null==(t=e.head)?void 0:t.querySelector('meta[name="csp-nonce"]'))?void 0:n.getAttribute("content"))?i:void 0}(w);null!=a&&n.setAttribute("nonce",a),(i.hydrateServerSide||i.hotModuleReplacement)&&2&t.$flags$&&n.setAttribute(v,o),(!(1&t.$flags$)||1&t.$flags$&&"HEAD"!==e.nodeName)&&e.insertBefore(n,e.querySelector("link"))}4&t.$flags$&&(n.innerHTML+="slot-fb{display:contents}slot-fb[hidden]{display:none}"),a&&a.add(o)}}else i.constructableCSS&&!e.adoptedStyleSheets.includes(s)&&(e.adoptedStyleSheets=[...e.adoptedStyleSheets,s]);return o},ge=(e,t)=>"sc-"+(i.mode&&t&&32&e.$flags$?e.$tagName$+"-"+t:e.$tagName$),me=(e,t,n,r,o,s)=>{if(n!==r){let a=c(e,t),l=t.toLowerCase();if(i.vdomClass&&"class"===t){const t=e.classList,i=ve(n),o=ve(r);t.remove(...i.filter((e=>e&&!o.includes(e)))),t.add(...o.filter((e=>e&&!i.includes(e))))}else if(i.vdomStyle&&"style"===t){if(i.updatable)for(const t in n)r&&null!=r[t]||(!i.hydrateServerSide&&t.includes("-")?e.style.removeProperty(t):e.style[t]="");for(const t in r)n&&r[t]===n[t]||(!i.hydrateServerSide&&t.includes("-")?e.style.setProperty(t,r[t]):e.style[t]=r[t])}else if(i.vdomKey&&"key"===t);else if(i.vdomRef&&"ref"===t)r&&r(e);else if(!i.vdomListener||(i.lazyLoad?a:e.__lookupSetter__(t))||"o"!==t[0]||"n"!==t[1]){if(i.vdomPropOrAttr){const c=$(r);if((a||c&&null!==r)&&!o)try{if(e.tagName.includes("-"))e[t]=r;else{const i=null==r?"":r;"list"===t?a=!1:null!=n&&e[t]==i||(e[t]=i)}}catch(e){}let u=!1;i.vdomXlink&&l!==(l=l.replace(/^xlink\:?/,""))&&(t=l,u=!0),null==r||!1===r?!1===r&&""!==e.getAttribute(t)||(i.vdomXlink&&u?e.removeAttributeNS(b,t):e.removeAttribute(t)):(!a||4&s||o)&&!c&&(r=!0===r?"":r,i.vdomXlink&&u?e.setAttributeNS(b,t,r):e.setAttribute(t,r))}}else if(t="-"===t[2]?t.slice(3):c(x,l)?l.slice(2):l[2]+t.slice(3),n||r){const i=t.endsWith(ye);t=t.replace(be,""),n&&E.rel(e,t,n,i),r&&E.ael(e,t,r,i)}}},_e=/\s/,ve=e=>e?e.split(_e):[],ye="Capture",be=new RegExp(ye+"$"),Te=(e,t,n)=>{const r=11===t.$elm$.nodeType&&t.$elm$.host?t.$elm$.host:t.$elm$,o=e&&e.$attrs$||G,s=t.$attrs$||G;if(i.updatable)for(const e of xe(Object.keys(o)))e in s||me(r,e,o[e],void 0,n,t.$flags$);for(const e of xe(Object.keys(s)))me(r,e,o[e],s[e],n,t.$flags$)};function xe(e){return e.includes("ref")?[...e.filter((e=>"ref"!==e)),"ref"]:e}var we=!1,Se=!1,Ee=!1,Ae=!1,Me=(e,t,n,r)=>{var o;const s=t.$children$[n];let a,l,c,u=0;if(i.slotRelocation&&!we&&(Ee=!0,"slot"===s.$tag$&&(q&&r.classList.add(q+"-s"),s.$flags$|=s.$children$?2:1)),i.isDev&&s.$elm$&&d(`The JSX ${null!==s.$text$?`"${s.$text$}" text`:`"${s.$tag$}" element`} node should not be shared within the same renderer. The renderer caches element lookups in order to improve performance. However, a side effect from this is that the exact same JSX node should not be reused. For more information please see https://stenciljs.com/docs/templating-jsx#avoid-shared-jsx-nodes`),i.vdomText&&null!==s.$text$)a=s.$elm$=w.createTextNode(s.$text$);else if(i.slotRelocation&&1&s.$flags$)a=s.$elm$=i.isDebug||i.hydrateServerSide?je(s):w.createTextNode("");else{if(i.svg&&!Ae&&(Ae="svg"===s.$tag$),a=s.$elm$=i.svg?w.createElementNS(Ae?"http://www.w3.org/2000/svg":"http://www.w3.org/1999/xhtml",!we&&i.slotRelocation&&2&s.$flags$?"slot-fb":s.$tag$):w.createElement(!we&&i.slotRelocation&&2&s.$flags$?"slot-fb":s.$tag$),i.svg&&Ae&&"foreignObject"===s.$tag$&&(Ae=!1),i.vdomAttribute&&Te(null,s,Ae),!!a.getRootNode().querySelector("body")&&i.scoped&&null!=q&&a["s-si"]!==q&&a.classList.add(a["s-si"]=q),i.scoped&&Ge(a,r),s.$children$)for(u=0;u<s.$children$.length;++u)l=Me(e,s,u,a),l&&a.appendChild(l);i.svg&&("svg"===s.$tag$?Ae=!1:"foreignObject"===a.tagName&&(Ae=!0))}return a["s-hn"]=X,i.slotRelocation&&3&s.$flags$&&(a["s-sr"]=!0,a["s-cr"]=Y,a["s-sn"]=s.$name$||"",a["s-rf"]=null==(o=s.$attrs$)?void 0:o.ref,c=e&&e.$children$&&e.$children$[n],c&&c.$tag$===s.$tag$&&e.$elm$&&(i.experimentalSlotFixes?Oe(e.$elm$):Re(e.$elm$,!1))),a},Oe=e=>{E.$flags$|=1;const t=e.closest(X.toLowerCase());if(null!=t){const n=Array.from(t.childNodes).find((e=>e["s-cr"])),i=Array.from(e.childNodes);for(const e of n?i.reverse():i)null!=e["s-sh"]&&(ke(t,e,null!=n?n:null),e["s-sh"]=void 0,Ee=!0)}E.$flags$&=-2},Re=(e,t)=>{E.$flags$|=1;const n=Array.from(e.childNodes);if(e["s-sr"]&&i.experimentalSlotFixes){let t=e;for(;t=t.nextSibling;)t&&t["s-sn"]===e["s-sn"]&&t["s-sh"]===X&&n.push(t)}for(let e=n.length-1;e>=0;e--){const i=n[e];i["s-hn"]!==X&&i["s-ol"]&&(ke(Le(i),i,De(i)),i["s-ol"].remove(),i["s-ol"]=void 0,i["s-sh"]=void 0,Ee=!0),t&&Re(i,t)}E.$flags$&=-2},Ce=(e,t,n,r,o,s)=>{let a,l=i.slotRelocation&&e["s-cr"]&&e["s-cr"].parentNode||e;for(i.shadowDom&&l.shadowRoot&&l.tagName===X&&(l=l.shadowRoot);o<=s;++o)r[o]&&(a=Me(null,n,o,e),a&&(r[o].$elm$=a,ke(l,a,i.slotRelocation?De(t):t)))},Ie=(e,t,n)=>{for(let r=t;r<=n;++r){const t=e[r];if(t){const e=t.$elm$;Ue(t),e&&(i.slotRelocation&&(Se=!0,e["s-ol"]?e["s-ol"].remove():Re(e,!0)),e.remove())}}},Pe=(e,t,n=!1)=>!(e.$tag$!==t.$tag$||(i.slotRelocation&&"slot"===e.$tag$?"$nodeId$"in e&&n&&8!==e.$elm$.nodeType||e.$name$!==t.$name$:i.vdomKey&&!n&&e.$key$!==t.$key$)),De=e=>e&&e["s-ol"]||e,Le=e=>(e["s-ol"]?e["s-ol"]:e).parentNode,Ne=(e,t,n=!1)=>{const r=t.$elm$=e.$elm$,o=e.$children$,s=t.$children$,a=t.$tag$,l=t.$text$;let c;i.vdomText&&null!==l?i.vdomText&&i.slotRelocation&&(c=r["s-cr"])?c.parentNode.textContent=l:i.vdomText&&e.$text$!==l&&(r.data=l):(i.svg&&(Ae="svg"===a||"foreignObject"!==a&&Ae),(i.vdomAttribute||i.reflect)&&(i.slot&&"slot"===a&&!we?i.experimentalSlotFixes&&e.$name$!==t.$name$&&(t.$elm$["s-sn"]=t.$name$||"",Oe(t.$elm$.parentElement)):Te(e,t,Ae)),i.updatable&&null!==o&&null!==s?((e,t,n,r,o=!1)=>{let s,a,l=0,c=0,u=0,h=0,d=t.length-1,p=t[0],f=t[d],g=r.length-1,m=r[0],_=r[g];for(;l<=d&&c<=g;)if(null==p)p=t[++l];else if(null==f)f=t[--d];else if(null==m)m=r[++c];else if(null==_)_=r[--g];else if(Pe(p,m,o))Ne(p,m,o),p=t[++l],m=r[++c];else if(Pe(f,_,o))Ne(f,_,o),f=t[--d],_=r[--g];else if(Pe(p,_,o))!i.slotRelocation||"slot"!==p.$tag$&&"slot"!==_.$tag$||Re(p.$elm$.parentNode,!1),Ne(p,_,o),ke(e,p.$elm$,f.$elm$.nextSibling),p=t[++l],_=r[--g];else if(Pe(f,m,o))!i.slotRelocation||"slot"!==p.$tag$&&"slot"!==_.$tag$||Re(f.$elm$.parentNode,!1),Ne(f,m,o),ke(e,f.$elm$,p.$elm$),f=t[--d],m=r[++c];else{if(u=-1,i.vdomKey)for(h=l;h<=d;++h)if(t[h]&&null!==t[h].$key$&&t[h].$key$===m.$key$){u=h;break}i.vdomKey&&u>=0?(a=t[u],a.$tag$!==m.$tag$?s=Me(t&&t[c],n,u,e):(Ne(a,m,o),t[u]=void 0,s=a.$elm$),m=r[++c]):(s=Me(t&&t[c],n,c,e),m=r[++c]),s&&(i.slotRelocation?ke(Le(p.$elm$),s,De(p.$elm$)):ke(p.$elm$.parentNode,s,p.$elm$))}l>d?Ce(e,null==r[g+1]?null:r[g+1].$elm$,n,r,c,g):i.updatable&&c>g&&Ie(t,l,d)})(r,o,t,s,n):null!==s?(i.updatable&&i.vdomText&&null!==e.$text$&&(r.textContent=""),Ce(r,null,t,s,0,s.length-1)):!n&&i.updatable&&null!==o&&Ie(o,0,o.length-1),i.svg&&Ae&&"svg"===a&&(Ae=!1))},Fe=e=>{const t=e.childNodes;for(const e of t)if(1===e.nodeType){if(e["s-sr"]){const n=e["s-sn"];e.hidden=!1;for(const i of t)if(i!==e)if(i["s-hn"]!==e["s-hn"]||""!==n){if(1===i.nodeType&&(n===i.getAttribute("slot")||n===i["s-sn"])||3===i.nodeType&&n===i["s-sn"]){e.hidden=!0;break}}else if(1===i.nodeType||3===i.nodeType&&""!==i.textContent.trim()){e.hidden=!0;break}}Fe(e)}},ze=[],He=e=>{let t,n,r;for(const o of e.childNodes){if(o["s-sr"]&&(t=o["s-cr"])&&t.parentNode){n=t.parentNode.childNodes;const e=o["s-sn"];for(r=n.length-1;r>=0;r--)if(t=n[r],!(t["s-cn"]||t["s-nr"]||t["s-hn"]===o["s-hn"]||i.experimentalSlotFixes&&t["s-sh"]&&t["s-sh"]===o["s-hn"]))if(Ve(t,e)){let n=ze.find((e=>e.$nodeToRelocate$===t));Se=!0,t["s-sn"]=t["s-sn"]||e,n?(n.$nodeToRelocate$["s-sh"]=o["s-hn"],n.$slotRefNode$=o):(t["s-sh"]=o["s-hn"],ze.push({$slotRefNode$:o,$nodeToRelocate$:t})),t["s-sr"]&&ze.map((e=>{Ve(e.$nodeToRelocate$,t["s-sn"])&&(n=ze.find((e=>e.$nodeToRelocate$===t)),n&&!e.$slotRefNode$&&(e.$slotRefNode$=n.$slotRefNode$))}))}else ze.some((e=>e.$nodeToRelocate$===t))||ze.push({$nodeToRelocate$:t})}1===o.nodeType&&He(o)}},Ve=(e,t)=>1===e.nodeType?null===e.getAttribute("slot")&&""===t||e.getAttribute("slot")===t:e["s-sn"]===t||""===t,Ue=e=>{i.vdomRef&&(e.$attrs$&&e.$attrs$.ref&&e.$attrs$.ref(null),e.$children$&&e.$children$.map(Ue))},ke=(e,t,n)=>{const r=null==e?void 0:e.insertBefore(t,n);return i.scoped&&Ge(t,e),r},Be=e=>{const t=[];return e&&t.push(...e["s-scs"]||[],e["s-si"],e["s-sc"],...Be(e.parentElement)),t},Ge=(e,t,n=!1)=>{var i;if(e&&t&&1===e.nodeType){const r=new Set(Be(t).filter(Boolean));if(r.size&&(null==(i=e.classList)||i.add(...e["s-scs"]=[...r]),e["s-ol"]||n))for(const t of Array.from(e.childNodes))Ge(t,e,!0)}},$e=(e,t,n=!1)=>{var r,o,s,a,l;const c=e.$hostElement$,u=e.$cmpMeta$,h=e.$vnode$||ne(null,null),d=re(t)?t:te(null,null,t);if(X=c.tagName,i.isDev&&Array.isArray(t)&&t.some(re))throw new Error(`The <Host> must be the single root component.\nLooks like the render() function of "${X.toLowerCase()}" is returning an array that contains the <Host>.\n\nThe render() function should look like this instead:\n\nrender() {\n  // Do not return an array\n  return (\n    <Host>{content}</Host>\n  );\n}\n  `);if(i.reflect&&u.$attrsToReflect$&&(d.$attrs$=d.$attrs$||{},u.$attrsToReflect$.map((([e,t])=>d.$attrs$[t]=c[e]))),n&&d.$attrs$)for(const e of Object.keys(d.$attrs$))c.hasAttribute(e)&&!["key","ref","style","class"].includes(e)&&(d.$attrs$[e]=c[e]);if(d.$tag$=null,d.$flags$|=4,e.$vnode$=d,d.$elm$=h.$elm$=i.shadowDom&&c.shadowRoot||c,(i.scoped||i.shadowDom)&&(q=c["s-sc"]),we=A&&!!(1&u.$flags$),i.slotRelocation&&(Y=c["s-cr"],Se=!1),Ne(h,d,n),i.slotRelocation){if(E.$flags$|=1,Ee){He(d.$elm$);for(const e of ze){const t=e.$nodeToRelocate$;if(!t["s-ol"]){const e=i.isDebug||i.hydrateServerSide?Ze(t):w.createTextNode("");e["s-nr"]=t,ke(t.parentNode,t["s-ol"]=e,t)}}for(const e of ze){const t=e.$nodeToRelocate$,l=e.$slotRefNode$;if(l){const e=l.parentNode;let n=l.nextSibling;if(!i.experimentalSlotFixes||n&&1===n.nodeType){let i=null==(r=t["s-ol"])?void 0:r.previousSibling;for(;i;){let r=null!=(o=i["s-nr"])?o:null;if(r&&r["s-sn"]===t["s-sn"]&&e===r.parentNode){for(r=r.nextSibling;r===t||(null==r?void 0:r["s-sr"]);)r=null==r?void 0:r.nextSibling;if(!r||!r["s-nr"]){n=r;break}}i=i.previousSibling}}(!n&&e!==t.parentNode||t.nextSibling!==n)&&t!==n&&(i.experimentalSlotFixes||t["s-hn"]||!t["s-ol"]||(t["s-hn"]=t["s-ol"].parentNode.nodeName),ke(e,t,n),1===t.nodeType&&(t.hidden=null!=(s=t["s-ih"])&&s)),t&&"function"==typeof l["s-rf"]&&l["s-rf"](t)}else 1===t.nodeType&&(n&&(t["s-ih"]=null!=(a=t.hidden)&&a),t.hidden=!0)}}Se&&Fe(d.$elm$),E.$flags$&=-2,ze.length=0}if(i.experimentalScopedSlotChanges&&2&u.$flags$)for(const e of d.$elm$.childNodes)e["s-hn"]===X||e["s-sh"]||(n&&null==e["s-ih"]&&(e["s-ih"]=null!=(l=e.hidden)&&l),e.hidden=!0);Y=void 0},je=e=>w.createComment(`<slot${e.$name$?' name="'+e.$name$+'"':""}> (host=${X.toLowerCase()})`),Ze=e=>w.createComment("org-location for "+(e.localName?`<${e.localName}> (host=${e["s-hn"]})`:`[${e.textContent}]`)),We=(e,t)=>{i.asyncLoading&&t&&!e.$onRenderResolve$&&t["s-p"]&&t["s-p"].push(new Promise((t=>e.$onRenderResolve$=t)))},qe=(e,t)=>{if(i.taskQueue&&i.updatable&&(e.$flags$|=16),i.asyncLoading&&4&e.$flags$)return void(e.$flags$|=512);We(e,e.$ancestorComponent$);const n=()=>Ye(e,t);return i.taskQueue?U(n):n()},Ye=(e,t)=>{const n=e.$hostElement$,r=ee("scheduleUpdate",e.$cmpMeta$.$tagName$),o=i.lazyLoad?e.$lazyInstance$:n;if(!o)throw new Error(`Can't render component <${n.tagName.toLowerCase()} /> with invalid Stencil runtime! Make sure this imported component is compiled with a \`externalRuntime: true\` flag. For more information, please refer to https://stenciljs.com/docs/custom-elements#externalruntime`);let s;return t?(i.lazyLoad&&i.hostListener&&(e.$flags$|=256,e.$queuedListeners$&&(e.$queuedListeners$.map((([e,t])=>it(o,e,t))),e.$queuedListeners$=void 0)),rt(n,"componentWillLoad"),i.cmpWillLoad&&(s=it(o,"componentWillLoad"))):(rt(n,"componentWillUpdate"),i.cmpWillUpdate&&(s=it(o,"componentWillUpdate"))),rt(n,"componentWillRender"),i.cmpWillRender&&(s=Xe(s,(()=>it(o,"componentWillRender")))),r(),Xe(s,(()=>Ke(e,o,t)))},Xe=(e,t)=>Qe(e)?e.then(t).catch((e=>{console.error(e),t()})):t(),Qe=e=>e instanceof Promise||e&&e.then&&"function"==typeof e.then,Ke=async(e,t,n)=>{var r;const o=e.$hostElement$,s=ee("update",e.$cmpMeta$.$tagName$),a=o["s-rc"];i.style&&n&&(e=>{const t=e.$cmpMeta$,n=e.$hostElement$,r=t.$flags$,o=ee("attachStyles",t.$tagName$),s=fe(i.shadowDom&&A&&n.shadowRoot?n.shadowRoot:n.getRootNode(),t,e.$modeName$);(i.shadowDom||i.scoped)&&i.cssAnnotations&&10&r&&2&r&&(n["s-sc"]=s,n.classList.add(s+"-h"),i.scoped&&2&r&&n.classList.add(s+"-s")),o()})(e);const l=ee("render",e.$cmpMeta$.$tagName$);if(i.isDev&&(e.$flags$|=1024),i.hydrateServerSide?await Je(e,t,o,n):Je(e,t,o,n),i.isDev&&(e.$renderCount$=void 0===e.$renderCount$?1:e.$renderCount$+1,e.$flags$&=-1025),i.hydrateServerSide)try{st(o),n&&(1&e.$cmpMeta$.$flags$?o["s-en"]="":2&e.$cmpMeta$.$flags$&&(o["s-en"]="c"))}catch(e){u(e,o)}if(i.asyncLoading&&a&&(a.map((e=>e())),o["s-rc"]=void 0),l(),s(),i.asyncLoading){const t=null!=(r=o["s-p"])?r:[],n=()=>et(e);0===t.length?n():(Promise.all(t).then(n),e.$flags$|=4,t.length=0)}else et(e)},Je=(e,t,n,r)=>{const o=!!i.allRenderFn,s=!!i.lazyLoad,a=!!i.taskQueue,l=!!i.updatable;try{if(t=(o||t.render)&&t.render(),l&&a&&(e.$flags$&=-17),(l||s)&&(e.$flags$|=2),i.hasRenderFn||i.reflect)if(i.vdomRender||i.reflect){if(i.hydrateServerSide)return Promise.resolve(t).then((t=>$e(e,t,r)));$e(e,t,r)}else{const i=n.shadowRoot;1&e.$cmpMeta$.$flags$?i.textContent=t:n.textContent=t}}catch(t){u(t,e.$hostElement$)}return null},et=e=>{const t=e.$cmpMeta$.$tagName$,n=e.$hostElement$,r=ee("postUpdate",t),o=i.lazyLoad?e.$lazyInstance$:n,s=e.$ancestorComponent$;i.cmpDidRender&&(i.isDev&&(e.$flags$|=1024),it(o,"componentDidRender"),i.isDev&&(e.$flags$&=-1025)),rt(n,"componentDidRender"),64&e.$flags$?(i.cmpDidUpdate&&(i.isDev&&(e.$flags$|=1024),it(o,"componentDidUpdate"),i.isDev&&(e.$flags$&=-1025)),rt(n,"componentDidUpdate"),r()):(e.$flags$|=64,i.asyncLoading&&i.cssAnnotations&&ot(n),i.cmpDidLoad&&(i.isDev&&(e.$flags$|=2048),it(o,"componentDidLoad"),i.isDev&&(e.$flags$&=-2049)),rt(n,"componentDidLoad"),r(),i.asyncLoading&&(e.$onReadyResolve$(n),s||nt(t))),i.method&&i.lazyLoad&&e.$onInstanceResolve$(n),i.asyncLoading&&(e.$onRenderResolve$&&(e.$onRenderResolve$(),e.$onRenderResolve$=void 0),512&e.$flags$&&H((()=>qe(e,!1))),e.$flags$&=-517)},tt=e=>{if(i.updatable&&(s.isBrowser||s.isTesting)){const t=l(e),n=t.$hostElement$.isConnected;return n&&2==(18&t.$flags$)&&qe(t,!1),n}return!1},nt=e=>{i.cssAnnotations&&ot(w.documentElement),i.asyncQueue&&(E.$flags$|=2),H((()=>de(x,"appload",{detail:{namespace:r}}))),i.profile&&performance.measure&&performance.measure(`[Stencil] ${r} initial load (by ${e})`,"st:app:start")},it=(e,t,n)=>{if(e&&e[t])try{return e[t](n)}catch(e){u(e)}},rt=(e,t)=>{i.lifecycleDOMEvents&&de(e,"stencil_"+t,{bubbles:!0,composed:!0,detail:{namespace:r}})},ot=e=>{var t,n;return i.hydratedClass?e.classList.add(null!=(t=i.hydratedSelectorName)?t:"hydrated"):i.hydratedAttribute?e.setAttribute(null!=(n=i.hydratedSelectorName)?n:"hydrated",""):void 0},st=e=>{const t=e.children;if(null!=t)for(let e=0,n=t.length;e<n;e++){const n=t[e];"function"==typeof n.connectedCallback&&n.connectedCallback(),st(n)}},at=(e,t,n)=>{var r,o;const s=e.prototype;if(i.formAssociated&&64&t.$flags$&&1&n&&T.forEach((e=>Object.defineProperty(s,e,{value(...t){const n=l(this),r=i.lazyLoad?n.$hostElement$:this,o=i.lazyLoad?n.$lazyInstance$:r;if(o){const n=o[e];"function"==typeof n&&n.call(o,...t)}else n.$onReadyPromise$.then((n=>{const i=n[e];"function"==typeof i&&i.call(n,...t)}))}}))),i.member&&t.$members$||i.watchCallback&&(t.$watchers$||e.watchers)){i.watchCallback&&e.watchers&&!t.$watchers$&&(t.$watchers$=e.watchers);const a=Object.entries(null!=(r=t.$members$)?r:{});if(a.map((([e,[r]])=>{(i.prop||i.state)&&(31&r||(!i.lazyLoad||2&n)&&32&r)?Object.defineProperty(s,e,{get(){return t=e,l(this).$instanceValues$.get(t);var t},set(o){if(i.isDev){const i=l(this);1&n||0!==(i&&8&i.$flags$)||!(31&r)||1024&r||p(`@Prop() "${e}" on <${t.$tagName$}> is immutable but was modified from within the component.\nMore information: https://stenciljs.com/docs/properties#prop-mutability`)}((e,t,n,r)=>{const o=l(e);if(i.lazyLoad&&!o)throw new Error(`Couldn't find host element for "${r.$tagName$}" as it is unknown to this Stencil runtime. This usually happens when integrating a 3rd party Stencil component with another Stencil component or application. Please reach out to the maintainers of the 3rd party Stencil component or report this on the Stencil Discord server (https://chat.stenciljs.com) or comment on this similar [GitHub issue](https://github.com/ionic-team/stencil/issues/5457).`);const s=i.lazyLoad?o.$hostElement$:e,a=o.$instanceValues$.get(t),c=o.$flags$,h=i.lazyLoad?o.$lazyInstance$:s;var d,f;d=n,f=r.$members$[t][0],n=null==d||$(d)?d:i.propBoolean&&4&f?"false"!==d&&(""===d||!!d):i.propNumber&&2&f?parseFloat(d):i.propString&&1&f?String(d):d;const g=Number.isNaN(a)&&Number.isNaN(n);if((!i.lazyLoad||!(8&c)||void 0===a)&&n!==a&&!g&&(o.$instanceValues$.set(t,n),i.isDev&&(1024&o.$flags$?p(`The state/prop "${t}" changed during rendering. This can potentially lead to infinite-loops and other bugs.`,"\nElement",s,"\nNew value",n,"\nOld value",a):2048&o.$flags$&&p(`The state/prop "${t}" changed during "componentDidLoad()", this triggers extra re-renders, try to setup on "componentWillLoad()"`,"\nElement",s,"\nNew value",n,"\nOld value",a)),!i.lazyLoad||h)){if(i.watchCallback&&r.$watchers$&&128&c){const e=r.$watchers$[t];e&&e.map((e=>{try{h[e](n,a,t)}catch(e){u(e,s)}}))}if(i.updatable&&2==(18&c)){if(i.cmpShouldUpdate&&h.componentShouldUpdate&&!1===h.componentShouldUpdate(n,a,t))return;qe(o,!1)}}})(this,e,o,t)},configurable:!0,enumerable:!0}):i.lazyLoad&&i.method&&1&n&&64&r&&Object.defineProperty(s,e,{value(...t){var n;const i=l(this);return null==(n=null==i?void 0:i.$onInstancePromise$)?void 0:n.then((()=>{var n;return null==(n=i.$lazyInstance$)?void 0:n[e](...t)}))}})})),i.observeAttribute&&(!i.lazyLoad||1&n)){const n=new Map;s.attributeChangedCallback=function(e,r,o){E.jmp((()=>{var a;const c=n.get(e);if(this.hasOwnProperty(c))o=this[c],delete this[c];else{if(s.hasOwnProperty(c)&&"number"==typeof this[c]&&this[c]==o)return;if(null==c){const n=l(this),s=null==n?void 0:n.$flags$;if(s&&!(8&s)&&128&s&&o!==r){const s=i.lazyLoad?n.$hostElement$:this,l=i.lazyLoad?n.$lazyInstance$:s,c=null==(a=t.$watchers$)?void 0:a[e];null==c||c.forEach((t=>{null!=l[t]&&l[t].call(l,o,r,e)}))}return}}this[c]=(null!==o||"boolean"!=typeof this[c])&&o}))},e.observedAttributes=Array.from(new Set([...Object.keys(null!=(o=t.$watchers$)?o:{}),...a.filter((([e,t])=>15&t[0])).map((([e,r])=>{var o;const s=r[1]||e;return n.set(s,e),i.reflect&&512&r[0]&&(null==(o=t.$attrsToReflect$)||o.push([e,s])),s}))]))}}return e},lt=async(e,t,r,o)=>{let s;if(!(32&t.$flags$)){t.$flags$|=32;const c=r.$lazyBundleId$;if((i.lazyLoad||i.hydrateClientSide)&&c){const e=((e,t,r)=>{const o=e.$tagName$.replace(/-/g,"_"),s=e.$lazyBundleId$;if(i.isDev&&"string"!=typeof s)return void d(`Trying to lazily load component <${e.$tagName$}> with style mode "${t.$modeName$}", but it does not exist.`);if(!s)return;const a=!i.hotModuleReplacement&&f.get(s);return a?a[o]:n(54140)(`./${s}.entry.js${i.hotModuleReplacement&&r?"?s-hmr="+r:""}`).then((e=>(i.hotModuleReplacement||f.set(s,e),e[o])),u)})(r,t,o);if(e&&"then"in e){const n=(a=`st:load:${r.$tagName$}:${t.$modeName$}`,l=`[Stencil] Load module for <${r.$tagName$}>`,i.profile&&performance.mark?(0===performance.getEntriesByName(a,"mark").length&&performance.mark(a),()=>{0===performance.getEntriesByName(l,"measure").length&&performance.measure(l,a)}):()=>{});s=await e,n()}else s=e;if(!s)throw new Error(`Constructor for "${r.$tagName$}#${t.$modeName$}" was not found`);i.member&&!s.isProxied&&(i.watchCallback&&(r.$watchers$=s.watchers),at(s,r,2),s.isProxied=!0);const c=ee("createInstance",r.$tagName$);i.member&&(t.$flags$|=8);try{new s(t)}catch(e){u(e)}i.member&&(t.$flags$&=-9),i.watchCallback&&(t.$flags$|=128),c(),ct(t.$lazyInstance$)}else{s=e.constructor;const n=e.localName;customElements.whenDefined(n).then((()=>t.$flags$|=128))}if(i.style&&s&&s.style){let o;"string"==typeof s.style?o=s.style:i.mode&&"string"!=typeof s.style&&(t.$modeName$=(e=>m.map((t=>t(e))).find((e=>!!e)))(e),t.$modeName$&&(o=s.style[t.$modeName$]),i.hydrateServerSide&&t.$modeName$&&e.setAttribute("s-mode",t.$modeName$));const a=ge(r,t.$modeName$);if(!g.has(a)){const e=ee("registerStyles",r.$tagName$);!i.hydrateServerSide&&i.shadowDom&&i.shadowDomShim&&8&r.$flags$&&(o=await n.e(4060).then(n.bind(n,64060)).then((e=>e.scopeCss(o,a)))),((e,t,n)=>{let i=g.get(e);O&&n?(i=i||new CSSStyleSheet,"string"==typeof i?i=t:i.replaceSync(t)):i=t,g.set(e,i)})(a,o,!!(1&r.$flags$)),e()}}}var a,l;const c=t.$ancestorComponent$,h=()=>qe(t,!0);i.asyncLoading&&c&&c["s-rc"]?c["s-rc"].push(h):h()},ct=e=>{i.lazyLoad&&i.connectedCallback&&it(e,"connectedCallback")},ut=e=>{const t=e["s-cr"]=w.createComment(i.isDebug?`content-ref (host=${e.localName})`:"");t["s-cn"]=!0,ke(e,t,e.firstChild)},ht=e=>{i.lazyLoad&&i.disconnectedCallback&&it(e,"disconnectedCallback"),i.cmpDidUnload&&it(e,"componentDidUnload")},dt=e=>{const t=e.cloneNode;e.cloneNode=function(e){const n=this,r=!!i.shadowDom&&n.shadowRoot&&A,o=t.call(n,!!r&&e);if(i.slot&&!r&&e){let e,t,r=0;const s=["s-id","s-cr","s-lr","s-rc","s-sc","s-p","s-cn","s-sr","s-sn","s-hn","s-ol","s-nr","s-si","s-rf","s-scs"];for(;r<n.childNodes.length;r++)e=n.childNodes[r]["s-nr"],t=s.every((e=>!n.childNodes[r][e])),e&&(i.appendChildSlotFix&&o.__appendChild?o.__appendChild(e.cloneNode(!0)):o.appendChild(e.cloneNode(!0))),t&&o.appendChild(n.childNodes[r].cloneNode(!0))}return o}},pt=e=>{e.__appendChild=e.appendChild,e.appendChild=function(e){const t=e["s-sn"]=wt(e),n=St(this.childNodes,t,this.tagName);if(n){const i=Et(n,t),r=i[i.length-1],o=ke(r.parentNode,e,r.nextSibling);return Fe(this),o}return this.__appendChild(e)}},ft=e=>{e.__removeChild=e.removeChild,e.removeChild=function(e){if(e&&void 0!==e["s-sn"]){const t=St(this.childNodes,e["s-sn"],this.tagName);if(t){const n=Et(t,e["s-sn"]).find((t=>t===e));if(n)return n.remove(),void Fe(this)}}return this.__removeChild(e)}},gt=e=>{const t=e.prepend;e.prepend=function(...e){e.forEach((e=>{"string"==typeof e&&(e=this.ownerDocument.createTextNode(e));const n=e["s-sn"]=wt(e),i=St(this.childNodes,n,this.tagName);if(i){const t=document.createTextNode("");t["s-nr"]=e,i["s-cr"].parentNode.__appendChild(t),e["s-ol"]=t;const r=Et(i,n)[0];return ke(r.parentNode,e,r.nextSibling)}return 1===e.nodeType&&e.getAttribute("slot")&&(e.hidden=!0),t.call(this,e)}))}},mt=e=>{e.append=function(...e){e.forEach((e=>{"string"==typeof e&&(e=this.ownerDocument.createTextNode(e)),this.appendChild(e)}))}},_t=e=>{const t=e.insertAdjacentHTML;e.insertAdjacentHTML=function(e,n){if("afterbegin"!==e&&"beforeend"!==e)return t.call(this,e,n);const i=this.ownerDocument.createElement("_");let r;if(i.innerHTML=n,"afterbegin"===e)for(;r=i.firstChild;)this.prepend(r);else if("beforeend"===e)for(;r=i.firstChild;)this.append(r)}},vt=e=>{e.insertAdjacentText=function(e,t){this.insertAdjacentHTML(e,t)}},yt=e=>{const t=e.insertAdjacentElement;e.insertAdjacentElement=function(e,n){return"afterbegin"!==e&&"beforeend"!==e?t.call(this,e,n):"afterbegin"===e?(this.prepend(n),n):"beforeend"===e?(this.append(n),n):n}},bt=e=>{const t=Object.getOwnPropertyDescriptor(Node.prototype,"textContent");Object.defineProperty(e,"__textContent",t),i.experimentalScopedSlotChanges?Object.defineProperty(e,"textContent",{get(){return" "+xt(this.childNodes).map((e=>{var t,n;const i=[];let r=e.nextSibling;for(;r&&r["s-sn"]===e["s-sn"];)3!==r.nodeType&&1!==r.nodeType||i.push(null!=(n=null==(t=r.textContent)?void 0:t.trim())?n:""),r=r.nextSibling;return i.filter((e=>""!==e)).join(" ")})).filter((e=>""!==e)).join(" ")+" "},set(e){xt(this.childNodes).forEach((t=>{let n=t.nextSibling;for(;n&&n["s-sn"]===t["s-sn"];){const e=n;n=n.nextSibling,e.remove()}if(""===t["s-sn"]){const n=this.ownerDocument.createTextNode(e);n["s-sn"]="",ke(t.parentElement,n,t.nextSibling)}else t.remove()}))}}):Object.defineProperty(e,"textContent",{get(){var e;const t=St(this.childNodes,"",this.tagName);return 3===(null==(e=null==t?void 0:t.nextSibling)?void 0:e.nodeType)?t.nextSibling.textContent:t?t.textContent:this.__textContent},set(e){var t;const n=St(this.childNodes,"",this.tagName);if(3===(null==(t=null==n?void 0:n.nextSibling)?void 0:t.nodeType))n.nextSibling.textContent=e;else if(n)n.textContent=e;else{this.__textContent=e;const t=this["s-cr"];t&&ke(this,t,this.firstChild)}}})},Tt=(e,t)=>{class n extends Array{item(e){return this[e]}}if(8&t.$flags$){const t=e.__lookupGetter__("childNodes");Object.defineProperty(e,"children",{get(){return this.childNodes.map((e=>1===e.nodeType))}}),Object.defineProperty(e,"childElementCount",{get(){return e.children.length}}),Object.defineProperty(e,"childNodes",{get(){const e=t.call(this);if(!(1&E.$flags$)&&2&l(this).$flags$){const t=new n;for(let n=0;n<e.length;n++){const i=e[n]["s-nr"];i&&t.push(i)}return t}return n.from(e)}})}},xt=e=>{const t=[];for(const n of Array.from(e))n["s-sr"]&&t.push(n),t.push(...xt(n.childNodes));return t},wt=e=>e["s-sn"]||1===e.nodeType&&e.getAttribute("slot")||"",St=(e,t,n)=>{let i,r=0;for(;r<e.length;r++){if(i=e[r],i["s-sr"]&&i["s-sn"]===t&&i["s-hn"]===n)return i;if(i=St(i.childNodes,t,n),i)return i}return null},Et=(e,t)=>{const n=[e];for(;(e=e.nextSibling)&&e["s-sn"]===t;)n.push(e);return n},At=(e,t)=>{const n={$flags$:t[0],$tagName$:t[1]};var r,o;i.member&&(n.$members$=t[2]),i.hostListener&&(n.$listeners$=t[3]),i.watchCallback&&(n.$watchers$=e.$watchers$),i.reflect&&(n.$attrsToReflect$=[]),i.shadowDom&&!A&&1&n.$flags$&&(n.$flags$|=8),i.experimentalSlotFixes?i.scoped&&2&n.$flags$&&(r=e.prototype,o=n,dt(r),pt(r),mt(r),gt(r),yt(r),_t(r),vt(r),bt(r),Tt(r,o),ft(r)):(i.slotChildNodesFix&&Tt(e.prototype,n),i.cloneNodeFix&&dt(e.prototype),i.appendChildSlotFix&&pt(e.prototype),i.scopedSlotTextContentFix&&2&n.$flags$&&bt(e.prototype));const s=e.prototype.connectedCallback,c=e.prototype.disconnectedCallback;return Object.assign(e.prototype,{__registerHost(){((e,t)=>{const n={$flags$:0,$hostElement$:e,$cmpMeta$:t,$instanceValues$:new Map};i.isDev&&(n.$renderCount$=0),i.method&&i.lazyLoad&&(n.$onInstancePromise$=new Promise((e=>n.$onInstanceResolve$=e))),i.asyncLoading&&(n.$onReadyPromise$=new Promise((e=>n.$onReadyResolve$=e)),e["s-p"]=[],e["s-rc"]=[]),a.set(e,n)})(this,n)},connectedCallback(){const e=l(this);Ot(this,e,n.$listeners$,!1),(e=>{if(!(1&E.$flags$)){const t=l(e),n=t.$cmpMeta$,r=ee("connectedCallback",n.$tagName$);if(i.hostListenerTargetParent&&Ot(e,t,n.$listeners$,!0),1&t.$flags$)Ot(e,t,n.$listeners$,!1),(null==t?void 0:t.$lazyInstance$)?ct(t.$lazyInstance$):(null==t?void 0:t.$onReadyPromise$)&&t.$onReadyPromise$.then((()=>ct(t.$lazyInstance$)));else{let r;if(t.$flags$|=1,i.hydrateClientSide&&(r=e.getAttribute(_),r)){if(i.shadowDom&&A&&1&n.$flags$){const t=i.mode?fe(e.shadowRoot,n,e.getAttribute("s-mode")):fe(e.shadowRoot,n);e.classList.remove(t+"-h",t+"-s")}((e,t,n,r)=>{const o=ee("hydrateClient",t),s=e.shadowRoot,a=[],l=i.shadowDom&&s?[]:null,c=r.$vnode$=ne(t,null);E.$orgLocNodes$||ue(w.body,E.$orgLocNodes$=new Map),e[_]=n,e.removeAttribute(_),ce(c,a,[],l,e,e,n),a.map((e=>{const n=e.$hostId$+"."+e.$nodeId$,i=E.$orgLocNodes$.get(n),r=e.$elm$;i&&A&&""===i["s-en"]&&i.parentNode.insertBefore(r,i.nextSibling),s||(r["s-hn"]=t,i&&(r["s-ol"]=i,r["s-ol"]["s-nr"]=r)),E.$orgLocNodes$.delete(n)})),i.shadowDom&&s&&l.map((e=>{e&&s.appendChild(e)})),o()})(e,n.$tagName$,r,t)}if(i.slotRelocation&&!r&&(i.hydrateServerSide||(i.slot||i.shadowDom)&&12&n.$flags$)&&ut(e),i.asyncLoading){let n=e;for(;n=n.parentNode||n.host;)if(i.hydrateClientSide&&1===n.nodeType&&n.hasAttribute("s-id")&&n["s-p"]||n["s-p"]){We(t,t.$ancestorComponent$=n);break}}i.prop&&!i.hydrateServerSide&&n.$members$&&Object.entries(n.$members$).map((([t,[n]])=>{if(31&n&&e.hasOwnProperty(t)){const n=e[t];delete e[t],e[t]=n}})),i.initializeNextTick?H((()=>lt(e,t,n))):lt(e,t,n)}r()}})(this),i.connectedCallback&&s&&s.call(this)},disconnectedCallback(){(async e=>{if(!(1&E.$flags$)){const t=l(e);i.hostListener&&t.$rmListeners$&&(t.$rmListeners$.map((e=>e())),t.$rmListeners$=void 0),i.lazyLoad?(null==t?void 0:t.$lazyInstance$)?ht(t.$lazyInstance$):(null==t?void 0:t.$onReadyPromise$)&&t.$onReadyPromise$.then((()=>ht(t.$lazyInstance$))):ht(e)}})(this),i.disconnectedCallback&&c&&c.call(this)},__attachShadow(){if(A)if(this.shadowRoot){if("open"!==this.shadowRoot.mode)throw new Error(`Unable to re-use existing shadow root for ${n.$tagName$}! Mode is set to ${this.shadowRoot.mode} but Stencil only supports open shadow roots.`)}else i.shadowDelegatesFocus?this.attachShadow({mode:"open",delegatesFocus:!!(16&n.$flags$)}):this.attachShadow({mode:"open"});else this.shadowRoot=this}}),e.is=n.$tagName$,at(e,n,3)},Mt=(e,t)=>t,Ot=(e,t,n,r)=>{i.hostListener&&n&&(i.hostListenerTargetParent&&(n=r?n.filter((([e])=>32&e)):n.filter((([e])=>!(32&e)))),n.map((([n,r,o])=>{const s=i.hostListenerTarget?Ct(e,n):e,a=Rt(t,o),l=It(n);E.ael(s,r,a,l),(t.$rmListeners$=t.$rmListeners$||[]).push((()=>E.rel(s,r,a,l)))})))},Rt=(e,t)=>n=>{var r;try{i.lazyLoad?256&e.$flags$?null==(r=e.$lazyInstance$)||r[t](n):(e.$queuedListeners$=e.$queuedListeners$||[]).push([t,n]):e.$hostElement$[t](n)}catch(e){u(e)}},Ct=(e,t)=>i.hostListenerTargetDocument&&4&t?w:i.hostListenerTargetWindow&&8&t?x:i.hostListenerTargetBody&&16&t?w.body:i.hostListenerTargetParent&&32&t&&e.parentElement?e.parentElement:e,It=e=>M?{passive:!!(1&e),capture:!!(2&e)}:!!(2&e)},38474:function(e,t,n){"use strict";n.d(t,{C:function(){return v},b:function(){return _}});var i=n(27264),r=n(13668),o=n(34178),s=n(27271),a=n(85709),l=n(77771),c=n(58766),u=n(23864),h=n(20830),d=n(38917),p=n(39506),f=n(62988),g=n(65839),m=n(25124);function _(e){const t=new f.N5,{vertex:n,fragment:_,attributes:v,varyings:y}=t;(0,h.NB)(n,e),t.include(o.d,e),t.include(a.c,e),t.include(c.A,e),t.include(s.g,e),t.include(r.HQ,e),t.include(m.z,e),v.add(g.r.POSITION,"vec3"),e.vvColor&&v.add(g.r.COLORFEATUREATTRIBUTE,"float"),y.add("vColor","vec4"),y.add("vpos","vec3");const b=e.terrainDepthTest&&e.output===i.V.Color;return b&&y.add("depth","float"),n.uniforms.add(new d.E("eColor",(e=>e.color))),n.main.add(p.H`
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();

      ${e.hasVertexColors?"vColor *= eColor;":e.vvColor?"vColor = eColor * interpolateVVColor(colorFeatureAttribute);":"vColor = eColor;"}
      ${b?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = transformPosition(proj, view, vpos);`),t.include(r.HQ,e),b&&t.include(l.Z,e),_.include(u.a),_.main.add(p.H`
    discardBySlice(vpos);
    ${b?"terrainDepthTest(depth);":""}
    vec4 fColor = vColor;
    outputColorHighlightOID(fColor, vpos);`),t}const v=Object.freeze(Object.defineProperty({__proto__:null,build:_},Symbol.toStringTag,{value:"Module"}))},1092:function(e,t,n){"use strict";n.d(t,{C:function(){return d},a:function(){return f},b:function(){return p}});var i=n(77423),r=n(23397),o=n(52766),s=n(11687),a=n(14543),l=n(39506),c=n(62988),u=n(39838),h=n(54204);class d extends l.Y{constructor(){super(...arguments),this.opacity=1}}function p(e){const t=new c.N5;t.include(i.c),t.fragment.uniforms.add(new u.N("tex",(e=>e.texture))),e.hasOpacityFactor&&t.fragment.uniforms.add(new a.m("opacity",(e=>e.opacity)));const n=e.blitMode===h.d.Depth;return n&&(t.fragment.uniforms.add(new s.G("nearFar",((e,t)=>t.camera.nearFar))),t.fragment.include(r.E),t.fragment.include(o.W)),t.fragment.main.add(l.H`
    ${n?l.H`
          float normalizedLinearDepth = (-linearDepthFromTexture(tex, uv) - nearFar[0]) / (nearFar[1] - nearFar[0]);
          fragColor = float2rgba(normalizedLinearDepth);`:l.H`
          fragColor = texture(tex, uv) ${e.hasOpacityFactor?"* opacity":""};`}`),t}const f=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:d,build:p},Symbol.toStringTag,{value:"Module"}))},88008:function(e,t,n){"use strict";n.d(t,{H:function(){return N},b:function(){return I},c:function(){return D},s:function(){return C}});var i=n(13786),r=n(1932),o=n(41546),s=n(43587),a=n(27264),l=n(13668),c=n(27271),u=n(10155),h=n(1143),d=n(50399),p=n(80231),f=n(84435),g=n(58766),m=n(28686),_=n(23864),v=n(52766),y=n(19202),b=n(20830),T=n(11687),x=n(41356),w=n(38917),S=n(14543),E=n(39506),A=n(62988),M=n(39838),O=n(54840),R=n(65839);const C={occludedFadeFactor:.6};function I(e){const t=new A.N5,n=e.signedDistanceFieldEnabled;if(t.include(h.Q,e),t.include(l.HQ,e),e.occlusionPass)return t.include(d.I,e),t;const{vertex:r,fragment:I}=t;t.include(y.Y6),t.include(g.A,e),t.include(c.g,e),t.include(p.y),I.include(v.W),I.include(_.a),t.varyings.add("vcolor","vec4"),t.varyings.add("vtc","vec2"),t.varyings.add("vsize","vec2"),t.varyings.add("voccluded","float"),r.uniforms.add(new w.E("viewport",((e,t)=>t.camera.fullViewport)),new T.G("screenOffset",((e,t)=>(0,i.hZ)(L,2*e.screenOffset[0]*t.camera.pixelRatio,2*e.screenOffset[1]*t.camera.pixelRatio))),new T.G("anchorPosition",(e=>D(e))),new w.E("materialColor",(e=>e.color)),new S.m("materialRotation",(e=>e.rotation))),(0,b.Nz)(r),n&&(r.uniforms.add(new w.E("outlineColor",(e=>e.outlineColor))),I.uniforms.add(new w.E("outlineColor",(e=>P(e)?e.outlineColor:o.uY)),new S.m("outlineSize",(e=>P(e)?e.outlineSize:0)))),e.horizonCullingEnabled&&r.uniforms.add(new x.V("pointDistanceSphere",((e,t)=>{const n=t.camera.eye,i=e.origin;return(0,o.fA)(i[0]-n[0],i[1]-n[1],i[2]-n[2],s.$O.radius)}))),e.pixelSnappingEnabled&&r.include(u.K),e.hasScreenSizePerspective&&((0,y.pM)(r),(0,y.OH)(r)),e.debugDrawLabelBorder&&t.varyings.add("debugBorderCoords","vec4"),t.attributes.add(R.r.UV0,"vec2"),t.attributes.add(R.r.COLOR,"vec4"),t.attributes.add(R.r.SIZE,"vec2"),t.attributes.add(R.r.ROTATION,"float"),t.attributes.add(R.r.FEATUREATTRIBUTE,"vec4"),r.code.add(e.horizonCullingEnabled?E.H`bool behindHorizon(vec3 posModel) {
vec3 camToEarthCenter = pointDistanceSphere.xyz - localOrigin;
vec3 camToPos = pointDistanceSphere.xyz + posModel;
float earthRadius = pointDistanceSphere.w;
float a = dot(camToPos, camToPos);
float b = dot(camToPos, camToEarthCenter);
float c = dot(camToEarthCenter, camToEarthCenter) - earthRadius * earthRadius;
return  b > 0.0 && b < a && b * b  > a * c;
}`:E.H`bool behindHorizon(vec3 posModel) { return false; }`),r.main.add(E.H`
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }

      if (behindHorizon(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }

      vec2 inputSize;
      ${(0,E.If)(e.hasScreenSizePerspective,E.H`
          inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
          vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);`,E.H`
          inputSize = size;
          vec2 screenOffsetScaled = screenOffset;`)}
      ${(0,E.If)(e.vvSize,E.H`inputSize *= vvScale(featureAttribute).xx;`)}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);
      bool visible = testHUDVisibility(posProj);
      voccluded = visible ? 0.0 : 1.0;
    `);const N=E.H`
      vec2 uv01 = floor(uv0);
      vec2 uv = uv0 - uv01;
      quadOffset.xy = (uv01 - anchorPosition) * 2.0 * combinedSize;

      ${(0,E.If)(e.hasRotation,E.H`
          float angle = radians(materialRotation + rotation);
          float cosAngle = cos(angle);
          float sinAngle = sin(angle);
          mat2 rotate = mat2(cosAngle, -sinAngle, sinAngle,  cosAngle);

          quadOffset.xy = rotate * quadOffset.xy;
        `)}

      quadOffset.xy = (quadOffset.xy + screenOffsetScaled) / viewport.zw * posProj.w;
  `,F=e.pixelSnappingEnabled?n?E.H`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:E.H`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:E.H`posProj += quadOffset;`;r.main.add(E.H`
    ${(0,E.If)(e.occlusionTestEnabled,E.H`
      if (!visible) {
        vtc = vec2(0.0);
        ${(0,E.If)(e.debugDrawLabelBorder,"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);")}
        return;
      }`)}
    ${N}
    ${e.vvColor?"vcolor = interpolateVVColor(featureAttribute.y) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    ${(0,E.If)(e.output===a.V.ObjectAndLayerIdColor,E.H`vcolor.a = 1.0;`)}

    bool alphaDiscard = vcolor.a < ${E.H.float(m.Q)};
    ${(0,E.If)(n,`alphaDiscard = alphaDiscard && outlineColor.a < ${E.H.float(m.Q)};`)}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${F}
      gl_Position = posProj;
    }

    vtc = uv;

    ${(0,E.If)(e.debugDrawLabelBorder,E.H`debugBorderCoords = vec4(uv01, 1.5 / combinedSize);`)}
    vsize = inputSize;
  `),I.uniforms.add(new M.N("tex",(e=>e.texture))),e.occludedFragmentFade&&(I.uniforms.add(new M.N("depthMap",((e,t)=>t.mainDepth))),I.uniforms.add(new S.m("fadeFactor",(()=>C.occludedFadeFactor))));const z=e.debugDrawLabelBorder?E.H`(isBorder > 0.0 ? 0.0 : ${E.H.float(m.Q)})`:E.H.float(m.Q),H=e.output===a.V.Highlight,V=E.H`
    ${(0,E.If)(e.debugDrawLabelBorder,E.H`float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`)}

    ${(0,E.If)(e.sampleSignedDistanceFieldTexelCenter,E.H`
      float txSize = float(textureSize(tex, 0).x);
      float texelSize = 1.0 / txSize;

      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;`,E.H`vec2 samplePos = vtc;`)}

    ${n?E.H`
      vec4 fillPixelColor = vcolor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${z} ||
          fillPixelColor.a + outlinePixelColor.a < ${E.H.float(m.Q)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        ${(0,E.If)(!H,E.H`fragColor = vec4(compositeColor, compositeAlpha);`)}
      } else {
        if (fillAlphaFactor < ${z}) {
          discard;
        }

        ${(0,E.If)(!H,E.H`fragColor = premultiplyAlpha(fillPixelColor);`)}
      }

      // visualize SDF:
      // fragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:E.H`
          vec4 texColor = texture(tex, vtc, -0.5);
          if (texColor.a < ${z}) {
            discard;
          }
          ${(0,E.If)(!H,E.H`fragColor = texColor * premultiplyAlpha(vcolor);`)}
          `}

    ${(0,E.If)(e.occludedFragmentFade&&!H,E.H`
        float zSample = texelFetch(depthMap, ivec2(gl_FragCoord.xy), 0).x;
        if (zSample < gl_FragCoord.z) {
          fragColor *= fadeFactor;
        }
        `)}

    ${(0,E.If)(!H&&e.debugDrawLabelBorder,E.H`fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`)}
  `;switch(e.output){case a.V.Color:e.oitPass===O.Y.ColorAlpha&&(t.outputs.add("fragColor","vec4",0),t.outputs.add("fragAlpha","float",1)),I.main.add(E.H`
        ${V}
        ${(0,E.If)(e.oitPass===O.Y.FrontFace,E.H`fragColor.rgb /= fragColor.a;`)}
        ${(0,E.If)(e.oitPass===O.Y.ColorAlpha,E.H`fragAlpha = fragColor.a;`)}`);break;case a.V.ObjectAndLayerIdColor:I.main.add(E.H`
        ${V}
        outputObjectAndLayerIdColor();`);break;case a.V.Highlight:t.include(f.Q,e),I.main.add(E.H`
        ${V}
        outputHighlight(voccluded == 1.0);`)}return t}function P(e){return e.outlineColor[3]>0&&e.outlineSize>0}function D(e,t=L){return e.textureIsSignedDistanceField?function(e,t,n){null!=t?(0,i.hZ)(n,e[0]*(t[2]-t[0])+t[0],e[1]*(t[3]-t[1])+t[1]):(0,i.hZ)(n,0,0)}(e.anchorPosition,e.distanceFieldBoundingBox,t):(0,i.C)(t,e.anchorPosition),t}const L=(0,r.vt)(),N=Object.freeze(Object.defineProperty({__proto__:null,build:I,calculateAnchorPosForRendering:D,shaderSettings:C},Symbol.toStringTag,{value:"Module"}))},82186:function(e,t,n){"use strict";n.d(t,{H:function(){return h},b:function(){return u}});var i=n(28721),r=n(74571),o=n(14543),s=n(50295),a=n(39506),l=n(62988),c=n(39838);function u(){const e=new l.N5;e.include(i.Q);const{fragment:t}=e;return t.uniforms.add(new c.N("highlightTexture",(e=>e.highlightTexture)),new c.N("highlightOptionsTexture",(e=>e.highlightOptionsTexture)),new o.m("pixelRatio",(e=>e.pixelRatio)),new o.m("occludedIntensityFactor",(e=>e.occludedFactor)),new s.c("maxHighlightLevel",(e=>e.maxHighlightLevel))),t.constants.add("pixelSampleScale","float",1),e.include(r.y),t.code.add(a.H`const float pascal17[9] = float[9](12870.0, 11440.0, 8008.0, 4368.0, 1820.0, 560.0, 120.0, 16.0, 1.0);
const float denom17 =  65536.0;
float colorWeight[16] = float[16](0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0);
float colorOcclusion[16] = float[16](0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0);
float weights[16] = float[16](0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0);
void applyTexel(vec2 texel, float weight) {
if (texel != vec2(0.0)){
int maxChannel = (maxHighlightLevel >> 2) & 1;
for (int channelIndex = 0; channelIndex <= maxChannel; ++channelIndex){
uint channel = readChannel(texel, channelIndex << 2);
int firstIndex = channelIndex << 2;
int maxIndex  = min(firstIndex + 3, maxHighlightLevel);
for (int highlightIndex = firstIndex; highlightIndex <= maxIndex; ++highlightIndex ) {
uint v = readChannelBits(channel, highlightIndex);
if ((v & 1u) == 1u){
colorWeight[highlightIndex] += weight;
if ((v & 2u) == 2u){
colorOcclusion[highlightIndex] += weight;
}
}
}
}
}
}
vec2 readTexel(ivec2 iuv, int du, int dv) {
return texelFetch(highlightTexture, iuv + ivec2(du, dv), 0).rg;
}
void readAndApplyTexel(ivec2 iuv, int du, int dv, float weight) {
vec2 texel = readTexel(iuv, du, dv);
applyTexel(texel, weight);
}
void readAndApply2TexelsU(ivec2 iuv, int du, int dv, float weight) {
readAndApplyTexel(iuv, -du, dv, weight);
readAndApplyTexel(iuv, +du, dv, weight);
}
float getWeight(int pixelDistance) {
float scaledDistance = float(pixelDistance) * pixelSampleScale / pixelRatio;
float d0f = floor(scaledDistance);
int d0 = int(d0f);
if (d0 >= 8){
return 0.0;
}
float w0 = pascal17[d0];
float w1 = pascal17[d0+1];
float f =  scaledDistance - d0f;
return mix(w0, w1, f);
}`),t.main.add(a.H`vec2 highlightTextureSize = vec2(textureSize(highlightTexture,0));
ivec2 iuv = ivec2(sUV * highlightTextureSize);
vec2 centerTexel = texelFetch(highlightTexture, iuv, 0).rg;
bool outlinePossible = false;
if (vOutlinePossible > 0.0){
for (int highlightLevel=0; highlightLevel<= maxHighlightLevel; ++highlightLevel) {
if ((readLevelBits(centerTexel,highlightLevel) & 1u) == 0u) {
outlinePossible = true;
break;
}
}
}
if (outlinePossible) {
int maxPixelDistance = clamp(int(8.0 * pixelRatio / pixelSampleScale), 2, 16);
float weightSum = 0.0;
for(int y = 0; y <= maxPixelDistance; ++y) {
float w = getWeight(y);
weights[y] = w;
weightSum += w * (y == 0 ? 1.0 : 2.0);
}
for(int y = 0; y <= maxPixelDistance; ++y) {
weights[y] = weights[y] / weightSum;
}
float weight0 = weights[0];
applyTexel(centerTexel, weight0 * weight0);
for(int y = 0; y <= maxPixelDistance; y += 1) {
float yFactor = weights[y];
if (y != 0) {
float xFactor = weight0;
float weight = xFactor * yFactor;
if (weight > 0.0) {
readAndApplyTexel(iuv, 0, +y, weight);
readAndApplyTexel(iuv, 0, -y, weight);
}
}
for(int x = 1; x <= maxPixelDistance; x += 1) {
float xFactor = weights[x];
float weight = xFactor * yFactor;
if (weight > 0.0) {
readAndApply2TexelsU(iuv, x, +y, weight);
if (y != 0){
readAndApply2TexelsU(iuv, x, -y, weight);
}
}
}
}
} else {
applyTexel(centerTexel, 1.0);
}
int frontColorIndex = 999;
int maxColorIndex = 0;
for (int i = 0; i <= maxHighlightLevel; ++i) {
if (colorWeight[i] > 0.0){
frontColorIndex = min(frontColorIndex, i);
maxColorIndex = max(maxColorIndex, i);
}
}
if (frontColorIndex == 999){
fragColor = vec4(0.0);
return;
}
vec4 accumulatedColor = vec4(0.0);
for (int curColorIndex = frontColorIndex; curColorIndex <= maxColorIndex; ++curColorIndex) {
float curColorWeight = colorWeight[curColorIndex];
if (curColorWeight <= 0.01){
continue;
}
uint vc = readLevelBits(centerTexel, curColorIndex);
bool centerFilled = (vc & 1u) == 1u;
bool centerOccluded = (vc & 3u) == 3u;
float curColorOcclusion = colorOcclusion[curColorIndex];
bool occluded = centerFilled ? centerOccluded : curColorOcclusion > 0.5 * curColorWeight;
int colorChannel = centerFilled ? 0 : 1;
vec4 colorBase = texelFetch(highlightOptionsTexture, ivec2(curColorIndex, colorChannel), 0);
float occlusionFactor = occluded ? occludedIntensityFactor : 1.0;
float outlineFactor = centerFilled ? 1.0 : smoothstep(0.0, 0.03, curColorWeight);
float intensity = colorBase.a * occlusionFactor * outlineFactor;
vec3 currentColor = colorBase.rgb;
float a0 = accumulatedColor.a;
float a1 = intensity;
float alpha = clamp(a0 + a1 - a0 * a1, 0.0, 1.0);
if (alpha > 0.001){
vec3 blendedColor = ((1.0 - a1) * a0 * accumulatedColor.rgb + a1 * currentColor) / alpha;
accumulatedColor = vec4(blendedColor, alpha);
}
}
fragColor = accumulatedColor;`),e}const h=Object.freeze(Object.defineProperty({__proto__:null,build:u},Symbol.toStringTag,{value:"Module"}))},40434:function(e,t,n){"use strict";n.d(t,{H:function(){return a},a:function(){return d},b:function(){return h},c:function(){return l},g:function(){return c},o:function(){return u}});var i=n(77423),r=n(39506),o=n(62988),s=n(40075);class a extends r.Y{}function l(){const e=new o.N5,{outputs:t,fragment:n}=e;return e.include(i.c),n.uniforms.add(new s.o("textureInput",(e=>e.input))),n.constants.add("outlineWidth","int",Math.ceil(u)),n.constants.add("cellSize","int",c),t.add("fragGrid","vec2"),n.main.add(r.H`vec2 inputTextureSize = vec2(textureSize(textureInput, 0));
vec2 cellBottomLeftCornerInput = floor(gl_FragCoord.xy) * vec2(cellSize);
vec2 coordMid =  (cellBottomLeftCornerInput + 0.5 * vec2(cellSize)) / inputTextureSize;
vec2 commonValue = texture(textureInput, coordMid).rg;
int margin = outlineWidth;
float marginSquare = float(margin*margin);
for(int y = -margin; y <= cellSize + margin; y+=2) {
int dy = y < 0 ? -y : y > cellSize ? y-cellSize : 0;
int xMargin = dy > 0 ? int(ceil(sqrt(marginSquare - float(dy*dy)))) : margin;
for(int x = -xMargin; x <= cellSize + xMargin; x+=2) {
vec2 coord = (cellBottomLeftCornerInput + vec2(x, y)) / inputTextureSize;
vec2 value = texture(textureInput, coord).rg;
if (value != commonValue){
fragGrid = vec2(1.0, 1.0);
return;
}
}
}
bool hasAny = commonValue != vec2(0.0);
fragGrid = vec2(hasAny ? 1.0 : 0.0, 0.0);`),e}const c=32,u=9,h=.4,d=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:a,blurSize:h,build:l,gridCellPixelSize:c,outlineSize:u},Symbol.toStringTag,{value:"Module"}))},46655:function(e,t,n){"use strict";n.d(t,{H:function(){return u},b:function(){return c}});var i=n(28721),r=n(74571),o=n(50295),s=n(39506),a=n(62988),l=n(39838);function c(){const e=new a.N5;e.include(i.Q),e.include(r.y);const{fragment:t}=e;return e.outputs.add("fragSingleHighlight","vec2",0),t.uniforms.add(new l.N("highlightTexture",(e=>e.highlightTexture)),new o.c("maxHighlightLevel",(e=>e.maxHighlightLevel)),new o.c("highlightLevel",(e=>e.highlightLevel))),e.include(r.y),t.main.add(s.H`ivec2 iuv = ivec2(gl_FragCoord.xy);
vec2 inputTexel = texelFetch(highlightTexture, iuv, 0).rg;
uint bits = readLevelBits(inputTexel, highlightLevel);
bool hasHighlight = (bits & 1u) == 1u;
bool hasOccluded  = (bits & 2u) == 2u;
fragSingleHighlight = vec2(hasHighlight ? 1.0 : 0.0, hasOccluded ? 1.0 : 0.0);`),e}const u=Object.freeze(Object.defineProperty({__proto__:null,build:c},Symbol.toStringTag,{value:"Module"}))},72468:function(e,t,n){"use strict";n.d(t,{I:function(){return _},b:function(){return m}});var i=n(27264),r=n(13668),o=n(34178),s=n(27271),a=n(77771),l=n(23864),c=n(20830),u=n(14543),h=n(39506),d=n(62988),p=n(39838),f=n(65839),g=n(25124);function m(e){const t=new d.N5,{vertex:n,fragment:m}=t;return(0,c.NB)(n,e),t.include(o.d,e),t.include(a.Z,e),t.include(r.HQ,e),t.include(s.g,e),t.include(g.z,e),t.attributes.add(f.r.POSITION,"vec3"),t.attributes.add(f.r.UV0,"vec2"),e.perspectiveInterpolation&&t.attributes.add(f.r.PERSPECTIVEDIVIDE,"float"),t.varyings.add("vpos","vec3"),e.terrainDepthTest&&t.varyings.add("depth","float"),n.main.add(h.H`
    vpos = position;
    ${e.terrainDepthTest?"depth = (view * vec4(vpos, 1.0)).z;":""}
    vTexCoord = uv0;
    gl_Position = transformPosition(proj, view, vpos);
    ${e.perspectiveInterpolation?"gl_Position *= perspectiveDivide;":""}`),m.uniforms.add(new p.N("tex",(e=>e.texture)),new u.m("opacity",(e=>e.opacity))),t.varyings.add("vTexCoord","vec2"),m.include(l.a),m.main.add(h.H`
    discardBySlice(vpos);
    ${e.terrainDepthTest?"terrainDepthTest(depth);":""}
    ${e.output===i.V.ObjectAndLayerIdColor?"fragColor = vec4(0, 0, 0, 1);\n           return;":""}
    vec4 finalColor = texture(tex, vTexCoord) * opacity;
    outputColorHighlightOID(finalColor, vpos);`),t}const _=Object.freeze(Object.defineProperty({__proto__:null,build:m},Symbol.toStringTag,{value:"Module"}))},58054:function(e,t,n){"use strict";n.d(t,{L:function(){return _},b:function(){return f}});var i=n(73364),r=n(39714),o=n(13786),s=n(1932),a=n(68561),l=n(11687),c=n(14543),u=n(39506),h=n(70340),d=n(62988),p=n(65839);function f(e){const t=new d.N5;t.include(a.K,e);const{vertex:n,fragment:r}=t;n.uniforms.add(new h.X("modelView",((e,{camera:t})=>(0,i.Tl)(m,t.viewMatrix,e.origin))),new h.X("proj",((e,{camera:t})=>t.projectionMatrix)),new c.m("glowWidth",((e,{camera:t})=>e.glowWidth*t.pixelRatio)),new l.G("pixelToNDC",((e,{camera:t})=>(0,o.hZ)(g,2/t.fullViewport[2],2/t.fullViewport[3])))),t.attributes.add(p.r.START,"vec3"),t.attributes.add(p.r.END,"vec3"),e.spherical&&(t.attributes.add(p.r.START_UP,"vec3"),t.attributes.add(p.r.END_UP,"vec3")),t.attributes.add(p.r.EXTRUDE,"vec2"),t.varyings.add("uv","vec2"),t.varyings.add("vViewStart","vec3"),t.varyings.add("vViewEnd","vec3"),t.varyings.add("vViewSegmentNormal","vec3"),t.varyings.add("vViewStartNormal","vec3"),t.varyings.add("vViewEndNormal","vec3");const s=!e.spherical;return n.main.add(u.H`
    vec3 pos = mix(start, end, extrude.x);

    vec4 viewPos = modelView * vec4(pos, 1);
    vec4 projPos = proj * viewPos;
    vec2 ndcPos = projPos.xy / projPos.w;

    // in planar we hardcode the up vectors to be Z-up */
    ${(0,u.If)(s,u.H`vec3 startUp = vec3(0, 0, 1);`)}
    ${(0,u.If)(s,u.H`vec3 endUp = vec3(0, 0, 1);`)}

    // up vector corresponding to the location of the vertex, selecting either startUp or endUp */
    vec3 up = extrude.y * mix(startUp, endUp, extrude.x);
    vec3 viewUp = (modelView * vec4(up, 0)).xyz;

    vec4 projPosUp = proj * vec4(viewPos.xyz + viewUp, 1);
    vec2 projUp = normalize(projPosUp.xy / projPosUp.w - ndcPos);

    // extrude ndcPos along projUp to the edge of the screen
    vec2 lxy = abs(sign(projUp) - ndcPos);
    ndcPos += length(lxy) * projUp;

    vViewStart = (modelView * vec4(start, 1)).xyz;
    vViewEnd = (modelView * vec4(end, 1)).xyz;

    vec3 viewStartEndDir = vViewEnd - vViewStart;

    vec3 viewStartUp = (modelView * vec4(startUp, 0)).xyz;

    // the normal of the plane that aligns with the segment and the up vector
    vViewSegmentNormal = normalize(cross(viewStartUp, viewStartEndDir));

    // the normal orthogonal to the segment normal and the start up vector
    vViewStartNormal = -normalize(cross(vViewSegmentNormal, viewStartUp));

    // the normal orthogonal to the segment normal and the end up vector
    vec3 viewEndUp = (modelView * vec4(endUp, 0)).xyz;
    vViewEndNormal = normalize(cross(vViewSegmentNormal, viewEndUp));

    // Add enough padding in the X screen space direction for "glow"
    float xPaddingPixels = sign(dot(vViewSegmentNormal, viewPos.xyz)) * (extrude.x * 2.0 - 1.0) * glowWidth;
    ndcPos.x += xPaddingPixels * pixelToNDC.x;

    // uv is used to read back depth to reconstruct the position at the fragment
    uv = ndcPos * 0.5 + 0.5;

    gl_Position = vec4(ndcPos, 0, 1);
  `),r.uniforms.add(new c.m("perScreenPixelRatio",((e,t)=>t.camera.perScreenPixelRatio))),r.code.add(u.H`float planeDistance(vec3 planeNormal, vec3 planeOrigin, vec3 pos) {
return dot(planeNormal, pos - planeOrigin);
}
float segmentDistancePixels(vec3 segmentNormal, vec3 startNormal, vec3 endNormal, vec3 pos, vec3 start, vec3 end) {
float distSegmentPlane = planeDistance(segmentNormal, start, pos);
float distStartPlane = planeDistance(startNormal, start, pos);
float distEndPlane = planeDistance(endNormal, end, pos);
float dist = max(max(distStartPlane, distEndPlane), abs(distSegmentPlane));
float width = fwidth(distSegmentPlane);
float maxPixelDistance = length(pos) * perScreenPixelRatio * 2.0;
float pixelDist = dist / min(width, maxPixelDistance);
return abs(pixelDist);
}`),r.main.add(u.H`fragColor = vec4(0.0);
vec3 dEndStart = vViewEnd - vViewStart;
if (dot(dEndStart, dEndStart) < 1e-5) {
return;
}
vec3 pos;
vec3 normal;
float angleCutoffAdjust;
float depthDiscontinuityAlpha;
if (!laserlineReconstructFromDepth(pos, normal, angleCutoffAdjust, depthDiscontinuityAlpha)) {
return;
}
float distance = segmentDistancePixels(
vViewSegmentNormal,
vViewStartNormal,
vViewEndNormal,
pos,
vViewStart,
vViewEnd
);
vec4 color = laserlineProfile(distance);
float alpha = (1.0 - smoothstep(0.995 - angleCutoffAdjust, 0.999 - angleCutoffAdjust, abs(dot(normal, vViewSegmentNormal))));
fragColor = laserlineOutput(color * alpha * depthDiscontinuityAlpha);`),t}const g=(0,s.vt)(),m=(0,r.vt)(),_=Object.freeze(Object.defineProperty({__proto__:null,build:f},Symbol.toStringTag,{value:"Module"}))},96500:function(e,t,n){"use strict";n.d(t,{L:function(){return D},b:function(){return x},d:function(){return T}});var i=n(15774),r=n(13786),o=n(1932),s=n(20551),a=n(32501),l=n(33400),c=n(41546),u=n(73313),h=n(5596),d=n(13794),p=n(68561),f=n(77423),g=n(11687),m=n(82598),_=n(38917),v=n(14543),y=n(39506),b=n(62988);const T=(0,i.kU)(6);function x(e){const t=new b.N5;t.include(f.c),t.include(p.K,e);const n=t.fragment;if(e.lineVerticalPlaneEnabled||e.heightManifoldEnabled)if(n.uniforms.add(new v.m("maxPixelDistance",((t,n)=>e.heightManifoldEnabled?2*n.camera.computeScreenPixelSizeAt(t.heightManifoldTarget):2*n.camera.computeScreenPixelSizeAt(t.lineVerticalPlaneSegment.origin)))),n.code.add(y.H`float planeDistancePixels(vec4 plane, vec3 pos) {
float dist = dot(plane.xyz, pos) + plane.w;
float width = fwidth(dist);
dist /= min(width, maxPixelDistance);
return abs(dist);
}`),e.spherical){const e=(e,t,n)=>(0,s.t)(e,t.heightManifoldTarget,n.camera.viewMatrix),t=(e,t)=>(0,s.t)(e,[0,0,0],t.camera.viewMatrix);n.uniforms.add(new _.E("heightManifoldOrigin",((n,i)=>(e(A,n,i),t(R,i),(0,s.d)(R,R,A),(0,s.n)(M,R),M[3]=(0,s.l)(R),M))),new m.t("globalOrigin",((e,n)=>t(A,n))),new v.m("cosSphericalAngleThreshold",((e,t)=>1-Math.max(2,(0,s.j)(t.camera.eye,e.heightManifoldTarget)*t.camera.perRenderPixelRatio)/(0,s.l)(e.heightManifoldTarget)))),n.code.add(y.H`float globeDistancePixels(float posInGlobalOriginLength) {
float dist = abs(posInGlobalOriginLength - heightManifoldOrigin.w);
float width = fwidth(dist);
dist /= min(width, maxPixelDistance);
return abs(dist);
}
float heightManifoldDistancePixels(vec4 heightPlane, vec3 pos) {
vec3 posInGlobalOriginNorm = normalize(globalOrigin - pos);
float cosAngle = dot(posInGlobalOriginNorm, heightManifoldOrigin.xyz);
vec3 posInGlobalOrigin = globalOrigin - pos;
float posInGlobalOriginLength = length(posInGlobalOrigin);
float sphericalDistance = globeDistancePixels(posInGlobalOriginLength);
float planarDistance = planeDistancePixels(heightPlane, pos);
return cosAngle < cosSphericalAngleThreshold ? sphericalDistance : planarDistance;
}`)}else n.code.add(y.H`float heightManifoldDistancePixels(vec4 heightPlane, vec3 pos) {
return planeDistancePixels(heightPlane, pos);
}`);if(e.pointDistanceEnabled&&(n.uniforms.add(new v.m("maxPixelDistance",((e,t)=>2*t.camera.computeScreenPixelSizeAt(e.pointDistanceTarget)))),n.code.add(y.H`float sphereDistancePixels(vec4 sphere, vec3 pos) {
float dist = distance(sphere.xyz, pos) - sphere.w;
float width = fwidth(dist);
dist /= min(width, maxPixelDistance);
return abs(dist);
}`)),e.intersectsLineEnabled&&(n.uniforms.add(new v.m("perScreenPixelRatio",((e,t)=>t.camera.perScreenPixelRatio))),n.code.add(y.H`float lineDistancePixels(vec3 start, vec3 dir, float radius, vec3 pos) {
float dist = length(cross(dir, pos - start)) / (length(pos) * perScreenPixelRatio);
return abs(dist) - radius;
}`)),(e.lineVerticalPlaneEnabled||e.intersectsLineEnabled)&&n.code.add(y.H`bool pointIsWithinLine(vec3 pos, vec3 start, vec3 end) {
vec3 dir = end - start;
float t2 = dot(dir, pos - start);
float l2 = dot(dir, dir);
return t2 >= 0.0 && t2 <= l2;
}`),n.main.add(y.H`vec3 pos;
vec3 normal;
float angleCutoffAdjust;
float depthDiscontinuityAlpha;
if (!laserlineReconstructFromDepth(pos, normal, angleCutoffAdjust, depthDiscontinuityAlpha)) {
fragColor = vec4(0.0);
return;
}
vec4 color = vec4(0.0);`),e.heightManifoldEnabled){n.uniforms.add(new g.G("angleCutoff",(e=>w(e))),new _.E("heightPlane",((e,t)=>S(e.heightManifoldTarget,e.renderCoordsHelper.worldUpAtPosition(e.heightManifoldTarget,A),t.camera.viewMatrix))));const t=e.spherical?y.H`normalize(globalOrigin - pos)`:y.H`heightPlane.xyz`;n.main.add(y.H`
      vec2 angleCutoffAdjusted = angleCutoff - angleCutoffAdjust;
      // Fade out laserlines on flat surfaces
      float heightManifoldAlpha = 1.0 - smoothstep(angleCutoffAdjusted.x, angleCutoffAdjusted.y, abs(dot(normal, ${t})));
      vec4 heightManifoldColor = laserlineProfile(heightManifoldDistancePixels(heightPlane, pos));
      color = max(color, heightManifoldColor * heightManifoldAlpha);`)}return e.pointDistanceEnabled&&(n.uniforms.add(new g.G("angleCutoff",(e=>w(e))),new _.E("pointDistanceSphere",((e,t)=>function(e,t){return(0,s.t)((0,d.a)(P),e.pointDistanceOrigin,t.camera.viewMatrix),P[3]=(0,s.j)(e.pointDistanceOrigin,e.pointDistanceTarget),P}(e,t)))),n.main.add(y.H`float pointDistanceSphereDistance = sphereDistancePixels(pointDistanceSphere, pos);
vec4 pointDistanceSphereColor = laserlineProfile(pointDistanceSphereDistance);
float pointDistanceSphereAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, normalize(pos - pointDistanceSphere.xyz))));
color = max(color, pointDistanceSphereColor * pointDistanceSphereAlpha);`)),e.lineVerticalPlaneEnabled&&(n.uniforms.add(new g.G("angleCutoff",(e=>w(e))),new _.E("lineVerticalPlane",((e,t)=>function(e,t){const n=(0,u.sd)(e.lineVerticalPlaneSegment,.5,A),i=e.renderCoordsHelper.worldUpAtPosition(n,O),r=(0,s.n)(R,e.lineVerticalPlaneSegment.vector),o=(0,s.e)(A,i,r);return(0,s.n)(o,o),S(e.lineVerticalPlaneSegment.origin,o,t.camera.viewMatrix)}(e,t))),new m.t("lineVerticalStart",((e,t)=>function(e,t){const n=(0,s.c)(A,e.lineVerticalPlaneSegment.origin);return e.renderCoordsHelper.setAltitude(n,0),(0,s.t)(n,n,t.camera.viewMatrix)}(e,t))),new m.t("lineVerticalEnd",((e,t)=>function(e,t){const n=(0,s.g)(A,e.lineVerticalPlaneSegment.origin,e.lineVerticalPlaneSegment.vector);return e.renderCoordsHelper.setAltitude(n,0),(0,s.t)(n,n,t.camera.viewMatrix)}(e,t)))),n.main.add(y.H`if (pointIsWithinLine(pos, lineVerticalStart, lineVerticalEnd)) {
float lineVerticalDistance = planeDistancePixels(lineVerticalPlane, pos);
vec4 lineVerticalColor = laserlineProfile(lineVerticalDistance);
float lineVerticalAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, lineVerticalPlane.xyz)));
color = max(color, lineVerticalColor * lineVerticalAlpha);
}`)),e.intersectsLineEnabled&&(n.uniforms.add(new g.G("angleCutoff",(e=>w(e))),new m.t("intersectsLineStart",((e,t)=>(0,s.t)(A,e.lineStartWorld,t.camera.viewMatrix))),new m.t("intersectsLineEnd",((e,t)=>(0,s.t)(A,e.lineEndWorld,t.camera.viewMatrix))),new m.t("intersectsLineDirection",((e,t)=>((0,s.c)(M,e.intersectsLineSegment.vector),M[3]=0,(0,s.n)(A,(0,l.t)(M,M,t.camera.viewMatrix))))),new v.m("intersectsLineRadius",(e=>e.intersectsLineRadius))),n.main.add(y.H`if (pointIsWithinLine(pos, intersectsLineStart, intersectsLineEnd)) {
float intersectsLineDistance = lineDistancePixels(intersectsLineStart, intersectsLineDirection, intersectsLineRadius, pos);
vec4 intersectsLineColor = laserlineProfile(intersectsLineDistance);
float intersectsLineAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, 1.0 - abs(dot(normal, intersectsLineDirection)));
color = max(color, intersectsLineColor * intersectsLineAlpha);
}`)),n.main.add(y.H`fragColor = laserlineOutput(color * depthDiscontinuityAlpha);`),t}function w(e){return(0,r.hZ)(E,Math.cos(e.angleCutoff),Math.cos(Math.max(0,e.angleCutoff-(0,i.kU)(2))))}function S(e,t,n){return(0,s.t)(C,e,n),(0,s.c)(M,t),M[3]=0,(0,l.t)(M,M,n),(0,h.O_)(C,M,I)}const E=(0,o.vt)(),A=(0,a.vt)(),M=(0,c.vt)(),O=(0,a.vt)(),R=(0,a.vt)(),C=(0,a.vt)(),I=(0,h.vt)(),P=(0,d.c)(),D=Object.freeze(Object.defineProperty({__proto__:null,build:x,defaultAngleCutoff:T},Symbol.toStringTag,{value:"Module"}))},94010:function(e,t,n){"use strict";n.d(t,{O:function(){return u},a:function(){return d},b:function(){return h}});var i=n(86398),r=n(77423),o=n(14543),s=n(50295),a=n(39506),l=n(62988),c=n(39838);class u extends a.Y{constructor(){super(...arguments),this.overlayIndex=i.vr.INNER,this.opacity=1}}function h(){const e=new l.N5;return e.include(r.c),e.fragment.uniforms.add(new c.N("tex",(e=>e.texture))),e.fragment.uniforms.add(new s.c("overlayIdx",(e=>e.overlayIndex))),e.fragment.uniforms.add(new o.m("opacity",(e=>e.opacity))),e.fragment.main.add(a.H`vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
fragColor = texture(tex, overlayUV) * opacity;`),e}const d=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:u,build:h},Symbol.toStringTag,{value:"Module"}))},35904:function(e,t,n){"use strict";n.d(t,{R:function(){return A},b:function(){return E},r:function(){return S}});var i=n(27264),r=n(13668),o=n(27271),s=n(55123),a=n(31166),l=n(91981),c=n(61629),u=n(77771),h=n(28686),d=n(23864),p=n(20830),f=n(11687),g=n(38917),m=n(14543),_=n(39506),v=n(70340),y=n(62988),b=n(65839),T=n(50678),x=n(25124),w=n(95736);const S=1;function E(e){const t=new y.N5,{attributes:n,varyings:E,vertex:A,fragment:M}=t,{applyMarkerOffset:O,draped:R,output:C,capType:I,stippleEnabled:P,falloffEnabled:D,roundJoins:L,wireframe:N,innerColorEnabled:F}=e;t.include(c.p),t.include(s.s,e),t.include(a.q,e),t.include(o.g,e);const z=O&&!R;z&&(A.uniforms.add(new m.m("markerScale",(e=>e.markerScale))),t.include(l.r,{space:T.lM.World})),(0,p.NB)(A,e),A.uniforms.add(new v.X("inverseProjectionMatrix",((e,t)=>t.camera.inverseProjectionMatrix)),new f.G("nearFar",((e,t)=>t.camera.nearFar)),new m.m("miterLimit",(e=>"miter"!==e.join?0:e.miterLimit)),new g.E("viewport",((e,t)=>t.camera.fullViewport))),A.constants.add("LARGE_HALF_FLOAT","float",65500),n.add(b.r.POSITION,"vec3"),n.add(b.r.PREVPOSITION,"vec3"),n.add(b.r.NEXTPOSITION,"vec3"),n.add(b.r.SUBDIVISIONFACTOR,"float"),n.add(b.r.UV0,"vec2"),E.add("vColor","vec4"),E.add("vpos","vec3"),E.add("vLineDistance","float"),E.add("vLineWidth","float");const H=e.terrainDepthTest&&C===i.V.Color;H&&E.add("depth","float");const V=P;V&&E.add("vLineSizeInv","float");const U=I===w.x.ROUND,k=P&&U,B=D||k;B&&E.add("vLineDistanceNorm","float"),U&&(E.add("vSegmentSDF","float"),E.add("vReverseSegmentSDF","float")),A.code.add(_.H`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),A.code.add(_.H`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),A.code.add(_.H`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${H?"depth = pos.z;":""}

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `),(0,p.Nz)(A),A.constants.add("aaWidth","float",P?0:1).main.add(_.H`
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;
      float lineSize = getSize();

      if (lineSize < 1.0) {
        coverage = lineSize; // convert sub-pixel coverage to alpha
        lineSize = 1.0;
      }
      lineSize += aaWidth;

      float lineWidth = lineSize * pixelRatio;
      vLineWidth = lineWidth;
      ${V?_.H`vLineSizeInv = 1.0 / lineSize;`:""}

      vec4 pos  = view * vec4(position, 1.0);
      vec4 prev = view * vec4(prevPosition, 1.0);
      vec4 next = view * vec4(nextPosition, 1.0);
  `),z&&A.main.add(_.H`vec4 other = isStartVertex ? next : prev;
bool markersHidden = areWorldMarkersHidden(pos, other);
if(!isJoin && !markersHidden) {
pos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;
}`),A.main.add(_.H`clipAndTransform(pos, prev, next, isStartVertex);
vec2 left = (pos.xy - prev.xy);
vec2 right = (next.xy - pos.xy);
float leftLen = length(left);
float rightLen = length(right);`),(P||U)&&A.main.add(_.H`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${U?_.H`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),A.main.add(_.H`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),L?A.main.add(_.H`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${P?_.H`min(1.0, subdivisionFactor * ${_.H.float((S+2)/(S+1))})`:_.H`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):A.main.add(_.H`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);const G=I!==w.x.BUTT;return A.main.add(_.H`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${G?_.H`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),A.main.add(_.H`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;
    float lineDistNorm = sign(uv0.y) * pos.w;

    vLineDistance =  lineWidth * lineDistNorm;
    ${B?_.H`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),U&&A.main.add(_.H`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),P&&(R?A.uniforms.add(new m.m("worldToScreenRatio",((e,t)=>1/t.screenToPCSRatio))):A.main.add(_.H`vec3 segmentCenter = mix((nextPosition + position) * 0.5, (position + prevPosition) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),A.main.add(_.H`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(nextPosition - position, position - prevPosition, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),R?A.main.add(_.H`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):A.main.add(_.H`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),A.uniforms.add(new m.m("stipplePatternPixelSize",(e=>(0,a.h)(e)))),A.main.add(_.H`float patternLength = lineSize * stipplePatternPixelSize;
vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);
vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);
if (segmentLengthScreenDouble >= 0.001) {
vec2 stippleDisplacement = pos.xy - segmentOrigin;
float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);
vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
}
vStippleDistanceLimits *= pos.w;
vStippleDistance *= pos.w;
vStippleDistanceLimits = isJoin ?
vStippleDistanceLimits :
isStartVertex ?
vec2(-1e34, vStippleDistanceLimits.y) :
vec2(vStippleDistanceLimits.x, 1e34);`)),A.main.add(_.H`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${N&&!R?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
      forwardObjectAndLayerIdColor();
    }`),H&&t.include(u.Z,e),t.include(r.HQ,e),t.include(x.z,e),M.include(d.a),M.main.add(_.H`
    discardBySlice(vpos);
    ${H?"terrainDepthTest(depth);":""}
  `),N?M.main.add(_.H`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(U&&M.main.add(_.H`
        float sdf = min(vSegmentSDF, vReverseSegmentSDF);
        vec2 fragmentPosition = vec2(
          min(sdf, 0.0),
          vLineDistance
        ) * gl_FragCoord.w;

        float fragmentRadius = length(fragmentPosition);
        float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
        float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

        if (capCoverage < ${_.H.float(h.Q)}) {
          discard;
        }
      `),k?M.main.add(_.H`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${_.H.float(h.Q)}, stippleCoverage);
      `):M.main.add(_.H`float stippleAlpha = getStippleAlpha();`),C!==i.V.ObjectAndLayerIdColor&&M.main.add(_.H`discardByStippleAlpha(stippleAlpha, ${_.H.float(h.Q)});`),M.uniforms.add(new g.E("intrinsicColor",(e=>e.color))),M.main.add(_.H`vec4 color = intrinsicColor * vColor;`),F&&(M.uniforms.add(new g.E("innerColor",(e=>e.innerColor??e.color)),new m.m("innerWidth",((e,t)=>e.innerWidth*t.camera.pixelRatio))),M.main.add(_.H`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),M.main.add(_.H`vec4 finalColor = blendStipple(color, stippleAlpha);`),D&&(M.uniforms.add(new m.m("falloff",(e=>e.falloff))),M.main.add(_.H`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`)),P||M.main.add(_.H`float featherStartDistance = max(vLineWidth - 2.0, 0.0);
float value = abs(vLineDistance) * gl_FragCoord.w;
float feather = (value - featherStartDistance) / (vLineWidth - featherStartDistance);
finalColor.a *= 1.0 - clamp(feather, 0.0, 1.0);`)),M.main.add(_.H`outputColorHighlightOID(finalColor, vpos);`),t}const A=Object.freeze(Object.defineProperty({__proto__:null,build:E,ribbonlineNumRoundJoinSubdivisions:S},Symbol.toStringTag,{value:"Module"}))},60593:function(e,t,n){"use strict";n.d(t,{S:function(){return b},b:function(){return _}});var i=n(41546),r=n(88416),o=n(27264),s=n(13668),a=n(34178),l=n(77771),c=n(23864),u=n(20830),h=n(82598),d=n(38917),p=n(39506),f=n(62988),g=n(65839),m=n(25124);function _(e){const t=new f.N5,n=e.terrainDepthTest&&e.output===o.V.Color;t.include(a.d,e),t.include(r.L,e),t.include(s.HQ,e),t.include(m.z,e);const{vertex:i,fragment:_}=t;return _.include(c.a),(0,u.NB)(i,e),_.uniforms.add(new d.E("uColor",(e=>e.color))),t.attributes.add(g.r.POSITION,"vec3"),t.varyings.add("vWorldPosition","vec3"),n&&t.varyings.add("depth","float"),e.screenSizeEnabled&&t.attributes.add(g.r.OFFSET,"vec3"),e.shadingEnabled&&((0,u.S7)(i),t.attributes.add(g.r.NORMAL,"vec3"),t.varyings.add("vViewNormal","vec3"),_.uniforms.add(new h.t("shadingDirection",(e=>e.shadingDirection))),_.uniforms.add(new d.E("shadedColor",(e=>v(e.shadingTint,e.color))))),i.main.add(p.H`
      vWorldPosition = ${e.screenSizeEnabled?p.H`screenSizeScaling(offset, position)`:p.H`position`};
      ${e.shadingEnabled?p.H`vec3 worldNormal = normal;
                 vViewNormal = (viewNormal * vec4(worldNormal, 1)).xyz;`:""}
      ${n?p.H`depth = (view * vec4(vWorldPosition, 1.0)).z;`:""}
      gl_Position = transformPosition(proj, view, vWorldPosition);
  `),n&&t.include(l.Z,e),_.main.add(p.H`
      discardBySlice(vWorldPosition);
      ${n?p.H`terrainDepthTest(depth);`:""}
      ${e.shadingEnabled?p.H`vec3 viewNormalNorm = normalize(vViewNormal);
             float shadingFactor = 1.0 - clamp(-dot(viewNormalNorm, shadingDirection), 0.0, 1.0);
             vec4 finalColor = mix(uColor, shadedColor, shadingFactor);`:p.H`vec4 finalColor = uColor;`}
      outputColorHighlightOID(finalColor, vWorldPosition);`),t}function v(e,t){const n=1-e[3],i=e[3]+t[3]*n;return 0===i?(y[3]=i,y):(y[0]=(e[0]*e[3]+t[0]*t[3]*n)/i,y[1]=(e[1]*e[3]+t[1]*t[3]*n)/i,y[2]=(e[2]*e[3]+t[2]*t[3]*n)/i,y[3]=t[3],y)}const y=(0,i.vt)(),b=Object.freeze(Object.defineProperty({__proto__:null,build:_},Symbol.toStringTag,{value:"Module"}))},966:function(e,t,n){"use strict";n.d(t,{S:function(){return p},b:function(){return d}});var i=n(28721),r=n(74571),o=n(30262),s=n(14543),a=n(50295),l=n(39506),c=n(62988),u=n(39838),h=n(40434);function d(){const e=new c.N5;e.include(i.Q);const{fragment:t}=e;return t.uniforms.add(new u.N("blurInput",(e=>e.singleHighlightBlurTexture)),new o.t("blurSize",(e=>e.blurSize)),new u.N("highlightTexture",(e=>e.highlightTexture)),new u.N("highlightOptionsTexture",(e=>e.highlightOptionsTexture)),new a.c("highlightLevel",(e=>e.highlightLevel)),new s.m("occludedIntensityFactor",(e=>e.occludedFactor))),t.constants.add("inner","float",1-(h.o-h.b)/h.o),e.include(r.y),t.main.add(l.H`vec2 highlightTextureSize = vec2(textureSize(highlightTexture,0));
vec2 uv = sUV;
vec2 center = texture(blurInput, uv).rg;
vec2 blurredHighlightValue = (vOutlinePossible == 0.0)
? center
: center * 0.204164
+ texture(blurInput, uv + blurSize * 1.407333).rg * 0.304005
+ texture(blurInput, uv - blurSize * 1.407333).rg * 0.304005
+ texture(blurInput, uv + blurSize * 3.294215).rg * 0.093913
+ texture(blurInput, uv - blurSize * 3.294215).rg * 0.093913;
float highlightIntensity = blurredHighlightValue.r;
float occlusionWeight = blurredHighlightValue.g;
if (highlightIntensity <= 0.01) {
discard;
}
vec4 fillColor    = texelFetch(highlightOptionsTexture, ivec2(highlightLevel, 0), 0);
vec4 outlineColor = texelFetch(highlightOptionsTexture, ivec2(highlightLevel, 1), 0);
vec2 centerTexel = texelFetch(highlightTexture, ivec2(uv * highlightTextureSize), 0).rg;
uint centerBits = readLevelBits(centerTexel, highlightLevel);
bool centerFilled = (centerBits & 1u) == 1u;
bool centerOccluded = (centerBits & 3u) == 3u;
bool occluded = centerOccluded || (0.5 * highlightIntensity < occlusionWeight);
float occlusionFactor = occluded ? occludedIntensityFactor : 1.0;
float outlineFactor = centerFilled ? 1.0 : smoothstep(0.0, inner, highlightIntensity);
float fillFactor = centerFilled ? 1.0 : 0.0;
vec4 baseColor = mix(outlineColor, fillColor, fillFactor);
float intensity = baseColor.a * occlusionFactor * outlineFactor;
fragColor = vec4(baseColor.rgb, intensity);`),e}const p=Object.freeze(Object.defineProperty({__proto__:null,build:d},Symbol.toStringTag,{value:"Module"}))},2963:function(e,t,n){"use strict";n.d(t,{S:function(){return c},a:function(){return h},b:function(){return u}});var i=n(1932),r=n(28721),o=n(30262),s=n(39506),a=n(62988),l=n(40075);class c extends s.Y{constructor(){super(...arguments),this.blurSize=(0,i.vt)()}}function u(){const e=new a.N5;return e.include(r.Q),e.fragment.uniforms.add(new o.t("blurSize",(e=>e.blurSize)),new l.o("blurInput",(e=>e.blurInput))),e.outputs.add("fragSingleHighlight","vec2",0),e.fragment.main.add(s.H`vec2 highlightTextureSize = vec2(textureSize(blurInput,0));
vec2 uv = sUV;
vec2 center = texture(blurInput, uv).rg;
if (vOutlinePossible == 0.0) {
fragSingleHighlight = center;
} else {
vec2 sum = center * 0.204164;
sum += texture(blurInput, uv + blurSize * 1.407333).rg * 0.304005;
sum += texture(blurInput, uv - blurSize * 1.407333).rg * 0.304005;
sum += texture(blurInput, uv + blurSize * 3.294215).rg * 0.093913;
sum += texture(blurInput, uv - blurSize * 3.294215).rg * 0.093913;
fragSingleHighlight = sum;
}`),e}const h=Object.freeze(Object.defineProperty({__proto__:null,SingleHighlightBlurDrawParameters:c,build:u},Symbol.toStringTag,{value:"Module"}))},29829:function(e,t,n){"use strict";n.d(t,{S:function(){return u},b:function(){return c}});var i=n(20830),r=n(38917),o=n(14543),s=n(39506),a=n(62988),l=n(65839);function c(e){const t=new a.N5,{vertex:n,fragment:c,attributes:u,varyings:h}=t;return(0,i.NB)(n,e),u.add(l.r.POSITION,"vec3"),u.add(l.r.UV0,"vec2"),h.add("vUV","vec2"),n.main.add(s.H`vUV = uv0;
gl_Position = proj * view * vec4(position, 1.0);`),c.uniforms.add(new r.E("backgroundColor",(e=>e.backgroundColor)),new r.E("gridColor",(e=>e.gridColor)),new o.m("gridWidth",(e=>e.gridWidth))).main.add(s.H`const float LINE_WIDTH = 1.0;
vec2 uvScaled = vUV * gridWidth;
vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));
vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);
grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);
grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);
float gridFade = max(grid.x, grid.y);
float gridAlpha = gridColor.a * gridFade;
fragColor =
vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +
vec4(gridColor.rgb, 1.0) * gridAlpha;`),t}const u=Object.freeze(Object.defineProperty({__proto__:null,build:c},Symbol.toStringTag,{value:"Module"}))},55747:function(e,t,n){"use strict";n.d(t,{T:function(){return c},a:function(){return h},b:function(){return u}});var i=n(32501),r=n(77423),o=n(82598),s=n(39506),a=n(62988),l=n(39838);class c extends s.Y{constructor(){super(...arguments),this.color=(0,i.fA)(1,1,1)}}function u(){const e=new a.N5;return e.include(r.c),e.fragment.uniforms.add(new l.N("tex",(e=>e.texture)),new o.t("uColor",(e=>e.color))),e.fragment.main.add(s.H`vec4 texColor = texture(tex, uv);
fragColor = texColor * vec4(uColor, 1.0);`),e}const h=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:c,build:u},Symbol.toStringTag,{value:"Module"}))},2075:function(e,t,n){"use strict";n.d(t,{a:function(){return v},b:function(){return j},c:function(){return y},f:function(){return b},g:function(){return w},h:function(){return C},u:function(){return T}}),n(58941);var i=n(40633),r=n(15774),o=n(89736),s=n(73364),a=n(39714),l=n(20551),c=n(32501),u=n(87416),h=n(72485),d=n(73313),p=n(5596),f=n(79578),g=n(29531),m=n(50973);const _=()=>i.A.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");function v(e=z){return{plane:(0,p.vt)(e.plane),origin:(0,c.o8)(e.origin),basis1:(0,c.o8)(e.basis1),basis2:(0,c.o8)(e.basis2)}}function y(e,t=v()){return b(e.origin,e.basis1,e.basis2,t)}function b(e,t,n,i=v()){return(0,l.c)(i.origin,e),(0,l.c)(i.basis1,t),(0,l.c)(i.basis2,n),T(i),function(e,t){Math.abs((0,l.f)(e.basis1,e.basis2)/((0,l.l)(e.basis1)*(0,l.l)(e.basis2)))>1e-6&&_().warn(t,"Provided basis vectors are not perpendicular"),Math.abs((0,l.f)(e.basis1,P(e)))>1e-6&&_().warn(t,"Basis vectors and plane normal are not perpendicular"),Math.abs(-(0,l.f)(P(e),e.origin)-e.plane[3])>1e-6&&_().warn(t,"Plane offset is not consistent with plane origin")}(i,"fromValues()"),i}function T(e){(0,p.mR)(e.basis2,e.basis1,e.origin,e.plane)}function x(e,t,n){e!==n&&y(e,n);const i=(0,l.h)(m.rq.get(),P(e),t);return(0,l.g)(n.origin,n.origin,i),n.plane[3]-=t,n}function w(e,t=v()){const n=(e[2]-e[0])/2,i=(e[3]-e[1])/2;return(0,l.i)(t.origin,e[0]+n,e[1]+i,0),(0,l.i)(t.basis1,n,0,0),(0,l.i)(t.basis2,0,i,0),(0,p.fA)(0,0,1,0,t.plane),t}function S(e,t,n){return!!(0,p.Ui)(e.plane,t,n)&&D(e,n)}function E(e,t,n){const i=H.get();F(e,t,i,H.get());let o=Number.POSITIVE_INFINITY;for(const s of B){const a=N(e,s,V.get()),c=m.rq.get();if((0,p.T7)(i,a,c)){const e=(0,l.o)(m.rq.get(),t.origin,c),i=Math.abs((0,r.XM)((0,l.f)(t.direction,e)));i<o&&(o=i,(0,l.c)(n,c))}}return o===Number.POSITIVE_INFINITY?A(e,t,n):n}function A(e,t,n){if(S(e,t,n))return n;const i=H.get(),r=H.get();F(e,t,i,r);let o=Number.POSITIVE_INFINITY;for(const s of B){const a=N(e,s,V.get()),c=m.rq.get();if((0,p.gv)(i,a,c)){const e=(0,f.kb)(t,c);if(!(0,p.Tj)(r,c))continue;e<o&&(o=e,(0,l.c)(n,c))}}return R(e,t.origin)<o&&M(e,t.origin,n),n}function M(e,t,n){const i=(0,p._I)(e.plane,t,m.rq.get()),r=(0,d.H6)(L(e,e.basis1),i,-1,1,m.rq.get()),o=(0,d.H6)(L(e,e.basis2),i,-1,1,m.rq.get());return(0,l.d)(n,(0,l.g)(m.rq.get(),r,o),e.origin),n}function O(e,t,n){const{origin:i,basis1:r,basis2:o}=e,s=(0,l.d)(m.rq.get(),t,i),a=(0,g.gr)(r,s),c=(0,g.gr)(o,s),u=(0,g.gr)(P(e),s);return(0,l.i)(n,a,c,u)}function R(e,t){const n=O(e,t,m.rq.get()),{basis1:i,basis2:r}=e,o=(0,l.l)(i),s=(0,l.l)(r),a=Math.max(Math.abs(n[0])-o,0),c=Math.max(Math.abs(n[1])-s,0),u=n[2];return a*a+c*c+u*u}function C(e,t){return Math.sqrt(R(e,t))}function I(e,t){const n=-e.plane[3];return(0,g.gr)(P(e),t)-n}function P(e){return(0,p.Qj)(e.plane)}function D(e,t){const n=(0,l.d)(m.rq.get(),t,e.origin),i=(0,l.k)(e.basis1),r=(0,l.k)(e.basis2),o=(0,l.f)(e.basis1,n),s=(0,l.f)(e.basis2,n);return-o-i<0&&o-i<0&&-s-r<0&&s-r<0}function L(e,t){const n=V.get();return(0,l.c)(n.origin,e.origin),(0,l.c)(n.vector,t),n}function N(e,t,n){const{basis1:i,basis2:r,origin:o}=e,s=(0,l.h)(m.rq.get(),i,t.origin[0]),a=(0,l.h)(m.rq.get(),r,t.origin[1]);(0,l.g)(n.origin,s,a),(0,l.g)(n.origin,n.origin,o);const c=(0,l.h)(m.rq.get(),i,t.direction[0]),u=(0,l.h)(m.rq.get(),r,t.direction[1]);return(0,l.h)(n.vector,(0,l.g)(c,c,u),2),n}function F(e,t,n,i){const r=P(e);(0,p.mR)(r,t.direction,t.origin,n),(0,p.mR)((0,p.Qj)(n),r,t.origin,i)}const z={plane:(0,p.vt)(),origin:(0,c.fA)(0,0,0),basis1:(0,c.fA)(1,0,0),basis2:(0,c.fA)(0,1,0)},H=new o.I(p.vt),V=new o.I(d.vt),U=(0,c.vt)(),k=new o.I((()=>v())),B=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],G=(0,a.vt)(),$=(0,a.vt)(),j=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:class{constructor(){this.plane=(0,p.vt)(),this.origin=(0,c.vt)(),this.basis1=(0,c.vt)(),this.basis2=(0,c.vt)()}},altitudeAt:I,axisAt:function(e,t,n,i){return function(e,t,n){switch(t){case h._.X:(0,l.c)(n,e.basis1),(0,l.n)(n,n);break;case h._.Y:(0,l.c)(n,e.basis2),(0,l.n)(n,n);break;case h._.Z:(0,l.c)(n,P(e))}return n}(e,n,i)},cameraFrustumCoverage:function(e,t){return(t-e)/t},closestPoint:A,closestPointOnSilhouette:E,copy:y,copyWithoutVerify:function(e,t){(0,l.c)(t.origin,e.origin),(0,l.c)(t.basis1,e.basis1),(0,l.c)(t.basis2,e.basis2),(0,p.C)(t.plane,e.plane)},create:v,distance:C,distance2:R,distanceToSilhouette:function(e,t){let n=Number.NEGATIVE_INFINITY;for(const i of B){const r=N(e,i,V.get()),o=(0,d.kb)(r,t);o>n&&(n=o)}return Math.sqrt(n)},elevate:x,equals:function(e,t){return(0,l.p)(e.basis1,t.basis1)&&(0,l.p)(e.basis2,t.basis2)&&(0,l.p)(e.origin,t.origin)},extrusionContainsPoint:function(e,t){return(0,p.Tj)(e.plane,t)&&D(e,t)},fromAABoundingRect:w,fromValues:b,getExtent:function(e,t){const n=e.basis1[0],i=e.basis2[1],[r,o]=e.origin;return(0,u.fA)(r-n,o-i,r+n,o+i,t)},intersectRay:S,intersectRayClosestSilhouette:function(e,t,n){if(S(e,t,n))return n;const i=E(e,t,m.rq.get());return(0,l.g)(n,t.origin,(0,l.h)(m.rq.get(),t.direction,(0,l.j)(t.origin,i)/(0,l.l)(t.direction))),n},normal:P,projectPoint:M,projectPointLocal:O,rotate:function(e,t,n,i){return e!==i&&y(e,i),(0,s.$0)($,t,n),(0,l.t)(i.basis1,e.basis1,$),(0,l.t)(i.basis2,e.basis2,$),T(i),i},setAltitudeAt:function(e,t,n,i){const r=I(e,t),o=(0,l.h)(U,P(e),n-r);return(0,l.g)(i,t,o),i},setExtent:function(e,t,n){return w(t,n),x(n,I(e,e.origin),n),n},transform:function(e,t,n){return e!==n&&y(e,n),(0,s.B8)(G,t),(0,s.mg)(G,G),(0,l.t)(n.basis1,e.basis1,G),(0,l.t)(n.basis2,e.basis2,G),(0,l.t)((0,p.Qj)(n.plane),(0,p.Qj)(e.plane),G),(0,l.t)(n.origin,e.origin,t),(0,p.mP)(n.plane,n.plane,n.origin),n},up:z,updateUnboundedPlane:T,wrap:function(e,t,n){const i=k.get();return i.origin=e,i.basis1=t,i.basis2=n,i.plane=(0,p.LV)(0,0,0,0),T(i),i}},Symbol.toStringTag,{value:"Module"}))},59122:function(e,t,n){"use strict";function i(e,t,n){n=n||2;var i,o,a,l,c,u,d,p=t&&t.length,f=p?t[0]*n:e.length,g=r(e,0,f,n,!0),m=[];if(!g||g.next===g.prev)return m;if(p&&(g=h(e,t,g,n)),e.length>80*n){i=a=e[0],o=l=e[1];for(var _=n;_<f;_+=n)(c=e[_])<i&&(i=c),(u=e[_+1])<o&&(o=u),c>a&&(a=c),u>l&&(l=u);d=0!==(d=Math.max(a-i,l-o))?1/d:0}return s(g,m,n,i,o,d),m}function r(e,t,n,i,r){var o,s;if(r===I(e,t,n,i)>0)for(o=t;o<n;o+=i)s=O(o,e[o],e[o+1],s);else for(o=n-i;o>=t;o-=i)s=O(o,e[o],e[o+1],s);if(s&&x(s,s.next)){var a=s.next;R(s),s=a}return s}function o(e,t){if(!e)return e;t||(t=e);var n,i=e;do{if(n=!1,i.steiner||!x(i,i.next)&&0!==T(i.prev,i,i.next))i=i.next;else{var r=i.prev;if(R(i),(i=t=r)===i.next)break;n=!0}}while(n||i!==t);return t}function s(e,t,n,i,r,h,d){if(e){!d&&h&&m(e,i,r,h);for(var p,f,g=e;e.prev!==e.next;)if(p=e.prev,f=e.next,h?l(e,i,r,h):a(e))t.push(p.i/n),t.push(e.i/n),t.push(f.i/n),R(e),e=f.next,g=f.next;else if((e=f)===g){d?1===d?s(e=c(o(e),t,n),t,n,i,r,h,2):2===d&&u(e,t,n,i,r,h):s(o(e),t,n,i,r,h,1);break}}}function a(e){var t=e.prev,n=e,i=e.next;if(T(t,n,i)>=0)return!1;for(var r=e.next.next;r!==e.prev;){if(y(t.x,t.y,n.x,n.y,i.x,i.y,r.x,r.y)&&T(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function l(e,t,n,i){var r=e.prev,o=e,s=e.next;if(T(r,o,s)>=0)return!1;for(var a=r.x<o.x?r.x<s.x?r.x:s.x:o.x<s.x?o.x:s.x,l=r.y<o.y?r.y<s.y?r.y:s.y:o.y<s.y?o.y:s.y,c=r.x>o.x?r.x>s.x?r.x:s.x:o.x>s.x?o.x:s.x,u=r.y>o.y?r.y>s.y?r.y:s.y:o.y>s.y?o.y:s.y,h=_(a,l,t,n,i),d=_(c,u,t,n,i),p=e.prevZ,f=e.nextZ;p&&p.z>=h&&f&&f.z<=d;){if(p!==e.prev&&p!==e.next&&y(r.x,r.y,o.x,o.y,s.x,s.y,p.x,p.y)&&T(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,f!==e.prev&&f!==e.next&&y(r.x,r.y,o.x,o.y,s.x,s.y,f.x,f.y)&&T(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;p&&p.z>=h;){if(p!==e.prev&&p!==e.next&&y(r.x,r.y,o.x,o.y,s.x,s.y,p.x,p.y)&&T(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;f&&f.z<=d;){if(f!==e.prev&&f!==e.next&&y(r.x,r.y,o.x,o.y,s.x,s.y,f.x,f.y)&&T(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function c(e,t,n){var i=e;do{var r=i.prev,s=i.next.next;!x(r,s)&&w(r,i,i.next,s)&&A(r,s)&&A(s,r)&&(t.push(r.i/n),t.push(i.i/n),t.push(s.i/n),R(i),R(i.next),i=e=s),i=i.next}while(i!==e);return o(i)}function u(e,t,n,i,r,a){var l=e;do{for(var c=l.next.next;c!==l.prev;){if(l.i!==c.i&&b(l,c)){var u=M(l,c);return l=o(l,l.next),u=o(u,u.next),s(l,t,n,i,r,a),void s(u,t,n,i,r,a)}c=c.next}l=l.next}while(l!==e)}function h(e,t,n,i){var s,a,l,c=[];for(s=0,a=t.length;s<a;s++)(l=r(e,t[s]*i,s<a-1?t[s+1]*i:e.length,i,!1))===l.next&&(l.steiner=!0),c.push(v(l));for(c.sort(d),s=0;s<c.length;s++)n=o(n=f(c[s],n),n.next);return n}function d(e,t){return e.x-t.x}function p(e){if(e.next.prev===e)return e;let t=e;for(;;){const n=t.next;if(n.prev===t||n===t||n===e)break;t=n}return t}function f(e,t){var n=function(e,t){var n,i=t,r=e.x,o=e.y,s=-1/0;do{if(o<=i.y&&o>=i.next.y&&i.next.y!==i.y){var a=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=r&&a>s){if(s=a,a===r){if(o===i.y)return i;if(o===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!n)return null;if(r===s)return n;var l,c=n,u=n.x,h=n.y,d=1/0;i=n;do{r>=i.x&&i.x>=u&&r!==i.x&&y(o<h?r:s,o,u,h,o<h?s:r,o,i.x,i.y)&&(l=Math.abs(o-i.y)/(r-i.x),A(i,e)&&(l<d||l===d&&(i.x>n.x||i.x===n.x&&g(n,i)))&&(n=i,d=l)),i=i.next}while(i!==c);return n}(e,t);if(!n)return t;var i=M(n,e),r=o(n,n.next);let s=p(i);return o(s,s.next),r=p(r),p(t===n?r:t)}function g(e,t){return T(e.prev,e,t.prev)<0&&T(t.next,e,e.next)<0}function m(e,t,n,i){var r=e;do{null===r.z&&(r.z=_(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){var t,n,i,r,o,s,a,l,c=1;do{for(n=e,e=null,o=null,s=0;n;){for(s++,i=n,a=0,t=0;t<c&&(a++,i=i.nextZ);t++);for(l=c;a>0||l>0&&i;)0!==a&&(0===l||!i||n.z<=i.z)?(r=n,n=n.nextZ,a--):(r=i,i=i.nextZ,l--),o?o.nextZ=r:e=r,r.prevZ=o,o=r;n=i}o.nextZ=null,c*=2}while(s>1)}(r)}function _(e,t,n,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function v(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function y(e,t,n,i,r,o,s,a){return(r-s)*(t-a)-(e-s)*(o-a)>=0&&(e-s)*(i-a)-(n-s)*(t-a)>=0&&(n-s)*(o-a)-(r-s)*(i-a)>=0}function b(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&w(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(A(e,t)&&A(t,e)&&function(e,t){var n=e,i=!1,r=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&r<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)&&(T(e.prev,e,t.prev)||T(e,t.prev,t))||x(e,t)&&T(e.prev,e,e.next)>0&&T(t.prev,t,t.next)>0)}function T(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function x(e,t){return e.x===t.x&&e.y===t.y}function w(e,t,n,i){var r=E(T(e,t,n)),o=E(T(e,t,i)),s=E(T(n,i,e)),a=E(T(n,i,t));return r!==o&&s!==a||!(0!==r||!S(e,n,t))||!(0!==o||!S(e,i,t))||!(0!==s||!S(n,e,i))||!(0!==a||!S(n,t,i))}function S(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function E(e){return e>0?1:e<0?-1:0}function A(e,t){return T(e.prev,e,e.next)<0?T(e,t,e.next)>=0&&T(e,e.prev,t)>=0:T(e,t,e.prev)<0||T(e,e.next,t)<0}function M(e,t){var n=new C(e.i,e.x,e.y),i=new C(t.i,t.x,t.y),r=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,o.next=i,i.prev=o,i}function O(e,t,n,i){var r=new C(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function R(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function C(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function I(e,t,n,i){for(var r=0,o=t,s=n-i;o<n;o+=i)r+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return r}n.d(t,{e:function(){return i}}),i.deviation=function(e,t,n,i){var r=t&&t.length,o=r?t[0]*n:e.length,s=Math.abs(I(e,0,o,n));if(r)for(var a=0,l=t.length;a<l;a++){var c=t[a]*n,u=a<l-1?t[a+1]*n:e.length;s-=Math.abs(I(e,c,u,n))}var h=0;for(a=0;a<i.length;a+=3){var d=i[a]*n,p=i[a+1]*n,f=i[a+2]*n;h+=Math.abs((e[d]-e[f])*(e[p+1]-e[d+1])-(e[d]-e[p])*(e[f+1]-e[d+1]))}return 0===s&&0===h?0:Math.abs((h-s)/s)},i.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},i=0,r=0;r<e.length;r++){for(var o=0;o<e[r].length;o++)for(var s=0;s<t;s++)n.vertices.push(e[r][o][s]);r>0&&(i+=e[r-1].length,n.holes.push(i))}return n}},69296:function(e,t,n){"use strict";var i;n.d(t,{u:function(){return i}}),function(e){e[e.KILOBYTES=1024]="KILOBYTES",e[e.MEGABYTES=1048576]="MEGABYTES",e[e.GIGABYTES=1073741824]="GIGABYTES"}(i||(i={}))},99680:function(e,t,n){"use strict";n.d(t,{q:function(){return r}});var i=n(85408);class r{constructor(e,t){this._storage=new i.F,this.id="",this.name="",this.size=0,this._storage.maxSize=e,this._storage.register(this),t&&this._storage.registerRemoveFunc("",t)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(e,t,n=1){this._storage.put(this,e,t,n,1)}pop(e){return this._storage.pop(this,e)}get(e){return this._storage.get(this,e)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}resetHitRate(){}}},92709:function(e,t,n){"use strict";n.d(t,{T:function(){return i},d:function(){return g}});const i={Base64:0,Hex:1,String:2,Raw:3},r=8,o=(1<<r)-1;function s(e,t){const n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function a(e){const t=[];for(let n=0,i=e.length*r;n<i;n+=r)t[n>>5]|=(e.charCodeAt(n/r)&o)<<n%32;return t}function l(e){const t=[];for(let n=0,i=32*e.length;n<i;n+=r)t.push(String.fromCharCode(e[n>>5]>>>n%32&o));return t.join("")}function c(e,t,n,i,r,o){return s(function(e,t){return e<<t|e>>>32-t}(s(s(t,e),s(i,o)),r),n)}function u(e,t,n,i,r,o,s){return c(t&n|~t&i,e,t,r,o,s)}function h(e,t,n,i,r,o,s){return c(t&i|n&~i,e,t,r,o,s)}function d(e,t,n,i,r,o,s){return c(t^n^i,e,t,r,o,s)}function p(e,t,n,i,r,o,s){return c(n^(t|~i),e,t,r,o,s)}function f(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;let n=1732584193,i=-271733879,r=-1732584194,o=271733878;for(let t=0;t<e.length;t+=16){const a=n,l=i,c=r,f=o;n=u(n,i,r,o,e[t],7,-680876936),o=u(o,n,i,r,e[t+1],12,-389564586),r=u(r,o,n,i,e[t+2],17,606105819),i=u(i,r,o,n,e[t+3],22,-1044525330),n=u(n,i,r,o,e[t+4],7,-176418897),o=u(o,n,i,r,e[t+5],12,1200080426),r=u(r,o,n,i,e[t+6],17,-1473231341),i=u(i,r,o,n,e[t+7],22,-45705983),n=u(n,i,r,o,e[t+8],7,1770035416),o=u(o,n,i,r,e[t+9],12,-1958414417),r=u(r,o,n,i,e[t+10],17,-42063),i=u(i,r,o,n,e[t+11],22,-1990404162),n=u(n,i,r,o,e[t+12],7,1804603682),o=u(o,n,i,r,e[t+13],12,-40341101),r=u(r,o,n,i,e[t+14],17,-1502002290),i=u(i,r,o,n,e[t+15],22,1236535329),n=h(n,i,r,o,e[t+1],5,-165796510),o=h(o,n,i,r,e[t+6],9,-1069501632),r=h(r,o,n,i,e[t+11],14,643717713),i=h(i,r,o,n,e[t],20,-373897302),n=h(n,i,r,o,e[t+5],5,-701558691),o=h(o,n,i,r,e[t+10],9,38016083),r=h(r,o,n,i,e[t+15],14,-660478335),i=h(i,r,o,n,e[t+4],20,-405537848),n=h(n,i,r,o,e[t+9],5,568446438),o=h(o,n,i,r,e[t+14],9,-1019803690),r=h(r,o,n,i,e[t+3],14,-187363961),i=h(i,r,o,n,e[t+8],20,1163531501),n=h(n,i,r,o,e[t+13],5,-1444681467),o=h(o,n,i,r,e[t+2],9,-51403784),r=h(r,o,n,i,e[t+7],14,1735328473),i=h(i,r,o,n,e[t+12],20,-1926607734),n=d(n,i,r,o,e[t+5],4,-378558),o=d(o,n,i,r,e[t+8],11,-2022574463),r=d(r,o,n,i,e[t+11],16,1839030562),i=d(i,r,o,n,e[t+14],23,-35309556),n=d(n,i,r,o,e[t+1],4,-1530992060),o=d(o,n,i,r,e[t+4],11,1272893353),r=d(r,o,n,i,e[t+7],16,-155497632),i=d(i,r,o,n,e[t+10],23,-1094730640),n=d(n,i,r,o,e[t+13],4,681279174),o=d(o,n,i,r,e[t],11,-358537222),r=d(r,o,n,i,e[t+3],16,-722521979),i=d(i,r,o,n,e[t+6],23,76029189),n=d(n,i,r,o,e[t+9],4,-640364487),o=d(o,n,i,r,e[t+12],11,-421815835),r=d(r,o,n,i,e[t+15],16,530742520),i=d(i,r,o,n,e[t+2],23,-995338651),n=p(n,i,r,o,e[t],6,-198630844),o=p(o,n,i,r,e[t+7],10,1126891415),r=p(r,o,n,i,e[t+14],15,-1416354905),i=p(i,r,o,n,e[t+5],21,-57434055),n=p(n,i,r,o,e[t+12],6,1700485571),o=p(o,n,i,r,e[t+3],10,-1894986606),r=p(r,o,n,i,e[t+10],15,-1051523),i=p(i,r,o,n,e[t+1],21,-2054922799),n=p(n,i,r,o,e[t+8],6,1873313359),o=p(o,n,i,r,e[t+15],10,-30611744),r=p(r,o,n,i,e[t+6],15,-1560198380),i=p(i,r,o,n,e[t+13],21,1309151649),n=p(n,i,r,o,e[t+4],6,-145523070),o=p(o,n,i,r,e[t+11],10,-1120210379),r=p(r,o,n,i,e[t+2],15,718787259),i=p(i,r,o,n,e[t+9],21,-343485551),n=s(n,a),i=s(i,l),r=s(r,c),o=s(o,f)}return[n,i,r,o]}function g(e,t=i.Hex){const n=t||i.Base64,o=f(a(e),e.length*r);switch(n){case i.Raw:return o;case i.Hex:return function(e){const t="0123456789abcdef",n=[];for(let i=0,r=4*e.length;i<r;i++)n.push(t.charAt(e[i>>2]>>i%4*8+4&15)+t.charAt(e[i>>2]>>i%4*8&15));return n.join("")}(o);case i.String:return l(o);case i.Base64:return function(e){const t=[];for(let n=0,i=4*e.length;n<i;n+=3){const i=(e[n>>2]>>n%4*8&255)<<16|(e[n+1>>2]>>(n+1)%4*8&255)<<8|e[n+2>>2]>>(n+2)%4*8&255;for(let r=0;r<4;r++)8*n+6*r>32*e.length?t.push("="):t.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(i>>6*(3-r)&63))}return t.join("")}(o)}}},85408:function(e,t,n){"use strict";n.d(t,{F:function(){return l},Ti:function(){return r}});var i=n(7187);const r=-3,o=r-1;var s,a;(a=s||(s={}))[a.ALL=0]="ALL",a[a.SOME=1]="SOME";class l{get size(){return this._size}constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new i.A,this._users=new i.A}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(e){this._users.push(e)}deregister(e){this._users.removeUnordered(e)}registerRemoveFunc(e,t){this._removeFuncs.push([e,t])}deregisterRemoveFunc(e){this._removeFuncs.filterInPlace((t=>t[0]!==e))}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,-1),this._checkSize()}getSize(e,t){const n=this._db.get(e.id+t);return n?.size??0}put(e,t,n,i,a){t=e.id+t;const l=this._db.get(t);if(l&&(this._size-=l.size,e.size-=l.size,this._db.delete(t),l.entry!==n&&this._notifyRemove(t,l.entry,l.size,s.ALL)),i>this._maxSize)return void this._notifyRemove(t,n,i,s.ALL);if(void 0===n)return void console.warn("Refusing to cache undefined entry ");if(!i||i<0)return console.warn(`Refusing to cache entry with size ${i} for key ${t}`),void this._notifyRemove(t,n,0,s.ALL);const u=1+Math.max(a,o)-r;this._db.set(t,new c(n,i,u)),this._size+=i,e.size+=i,this._checkSize()}updateSize(e,t,n,i){t=e.id+t;const r=this._db.get(t);if(r&&r.entry===n){for(this._size-=r.size,e.size-=r.size;i>this._maxSize;){const e=this._notifyRemove(t,n,i,s.SOME);if(!(null!=e&&e>0))return void this._db.delete(t);i=e}r.size=i,this._size+=i,e.size+=i,this._checkSize()}}pop(e,t){t=e.id+t;const n=this._db.get(t);if(n)return this._size-=n.size,e.size-=n.size,this._db.delete(t),++this._hit,n.entry;++this._miss}get(e,t){t=e.id+t;const n=this._db.get(t);if(void 0!==n)return this._db.delete(t),n.lives=n.lifetime,this._db.set(t,n),++this._hit,n.entry;++this._miss}peek(e,t){const n=this._db.get(e.id+t);return n?++this._hit:++this._miss,n?.entry}get performanceInfo(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},t={},n=new Array;this._db.forEach(((e,i)=>{const r=e.lifetime;n[r]=(n[r]||0)+e.size,this._users.forAll((n=>{const{id:r,name:o}=n;if(i.startsWith(r)){const n=t[o]||0;t[o]=n+e.size}}))}));const i={};this._users.forAll((e=>{const n=e.name;if("hitRate"in e&&"number"==typeof e.hitRate&&!isNaN(e.hitRate)&&e.hitRate>0){const r=t[n]||0;t[n]=r,i[n]=Math.round(100*e.hitRate)+"%"}else i[n]="0%"}));const o=Object.keys(t);o.sort(((e,n)=>t[n]-t[e])),o.forEach((n=>e[n]=Math.round(t[n]/2**20)+"MB / "+i[n]));for(let t=n.length-1;t>=0;--t){const i=n[t];i&&(e["Priority "+(t+r-1)]=Math.round(i/this._size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forAll((e=>e.resetHitRate()))}clear(e){const t=e.id;this._db.forEach(((e,n)=>{n.startsWith(t)&&(this._size-=e.size,this._db.delete(n),this._notifyRemove(n,e.entry,e.size,s.ALL))})),e.size=0}clearAll(){this._db.forEach(((e,t)=>this._notifyRemove(t,e.entry,e.size,s.ALL))),this._users.forAll((e=>e.size=0)),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,t,n,i){let r;return this._removeFuncs.some((o=>{if(e.startsWith(o[0])){const e=o[1](t,i,n);return"number"==typeof e&&(r=e),!0}return!1})),r}_checkSize(){this._users.forAll((e=>this._checkSizeLimits(e))),this._checkSizeLimits()}_checkSizeLimits(e){const t=e??this;if(t.maxSize<0||t.size<=t.maxSize)return;const n=e?.id;let i=!0;for(;i;){i=!1;for(const[r,o]of this._db)if(0===o.lifetime&&(!n||r.startsWith(n))){if(this._purgeItem(r,o,e),t.size<=.9*t.maxSize)return;i||=this._db.has(r)}}for(const[i,r]of this._db)if((!n||i.startsWith(n))&&(this._purgeItem(i,r,e),t.size<=.9*t.maxSize))return}_purgeItem(e,t,n=this._users.find((t=>e.startsWith(t.id)))){if(this._db.delete(e),t.lives<=1){this._size-=t.size,n&&(n.size-=t.size);const i=this._notifyRemove(e,t.entry,t.size,s.SOME);null!=i&&i>0&&(this._size+=i,n&&(n.size+=i),t.lives=t.lifetime,t.size=i,this._db.set(e,t))}else--t.lives,this._db.set(e,t)}}class c{constructor(e,t,n){this.entry=e,this.size=t,this.lifetime=n,this.lives=n}}},7970:function(e,t,n){"use strict";n.d(t,{O:function(){return i}});class i{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return 0===this._outer.size}get(e,t){return this._outer.get(e)?.get(t)}getInner(e){return this._outer.get(e)}set(e,t,n){const i=this._outer.get(e);i?i.set(t,n):this._outer.set(e,new Map([[t,n]]))}delete(e,t){const n=this._outer.get(e);n&&(n.delete(t),0===n.size&&this._outer.delete(e))}forEach(e){this._outer.forEach(((t,n)=>e(t,n)))}forAll(e){for(const t of this._outer.values())for(const n of t.values())e(n)}}},85876:function(e,t,n){"use strict";n.d(t,{A:function(){return o}});var i=n(44567),r=n(87085);class o{constructor(e){this._observable=new r.I,this._set=new Set(e)}get size(){return(0,i.gc)(this._observable),this._set.size}add(e){const t=this._set.size;return this._set.add(e),this._set.size!==t&&this._observable.notify(),this}clear(){this._set.size>0&&(this._set.clear(),this._observable.notify())}delete(e){const t=this._set.delete(e);return t&&this._observable.notify(),t}entries(){return(0,i.gc)(this._observable),this._set.entries()}forEach(e,t){(0,i.gc)(this._observable),this._set.forEach(((n,i)=>e.call(t,n,i,this)),t)}has(e){return(0,i.gc)(this._observable),this._set.has(e)}keys(){return(0,i.gc)(this._observable),this._set.keys()}values(){return(0,i.gc)(this._observable),this._set.values()}[Symbol.iterator](){return(0,i.gc)(this._observable),this._set[Symbol.iterator]()}get[Symbol.toStringTag](){return this._set[Symbol.toStringTag]}}},84016:function(e,t,n){"use strict";n.d(t,{O:function(){return r}});var i=n(25591);const r=()=>i.default.respectPrefersReducedMotion&&window.matchMedia("(prefers-reduced-motion: reduce)").matches},18627:function(e,t,n){"use strict";n.d(t,{P:function(){return p}});var i=n(39819),r=n(92709),o=n(73888),s=n(90683),a=n(66110),l=n(75779),c=n(72977),u=n(23502),h=n(82465),d=n(60534);function p(e){const t=e?.origins??[void 0];return(n,i)=>{const r=function(e,t,n){if("resource"===e?.type)return function(e,t,n){const i=(0,l.z4)(t,n);return{type:String,read:(e,t,n)=>{const r=(0,d.r)(e,t,n);return i.type===String?r:"function"==typeof i.type?new i.type({url:r}):void 0},write:{writer(t,r,a,l){if(!l?.resources)return"string"==typeof t?void(r[a]=(0,d.t)(t,l)):void(r[a]=t.write({},l));const u=function(e){return null==e?null:"string"==typeof e?e:e.url}(t),p=(0,d.t)(u,{...l,verifyItemRelativeUrls:l?.verifyItemRelativeUrls?{writtenUrls:l.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},d.M.NO),_=i.type!==String&&(!(0,o.H)(this)||l?.origin&&this.originIdOf(n)>(0,c.aB)(l.origin)),v={object:this,propertyName:n,value:t,targetUrl:p,dest:r,targetPropertyName:a,context:l,params:e};l?.portalItem&&p&&!(0,s.oP)(p)?_&&e?.contentAddressed?f(v):_?function(e){const{context:t,targetUrl:n,params:i,value:r,dest:o,targetPropertyName:a}=e;if(!t.portalItem)return;const l=t.portalItem.resourceFromPath(n),c=m(r,n,t),u=(0,h.n)(c),d=(0,s.Zo)(l.path),p=i?.compress??!1;u===d?(t.resources&&g({...e,resource:l,content:c,compress:p,updates:t.resources.toUpdate}),o[a]=n):f(e)}(v):function({context:e,targetUrl:t,dest:n,targetPropertyName:i}){e.portalItem&&e.resources&&(e.resources.toKeep.push({resource:e.portalItem.resourceFromPath(t),compress:!1}),n[i]=t)}(v):l?.portalItem&&(null==p||null!=(0,d.i)(p)||(0,s.w8)(p)||_)?f(v):r[a]=p}}}}(e,t,n);switch(e?.type??"other"){case"other":return{read:!0,write:!0};case"url":{const{read:e,write:t}=d.b;return{read:e,write:t}}}}(e,n,i);for(const e of t){const t=(0,u.rM)(n,e,i);for(const e in r)t[e]=r[e]}}}function f(e){const{targetUrl:t,params:n,value:o,context:l,dest:c,targetPropertyName:u}=e;if(!l.portalItem)return;const p=(0,d.p)(t),f=m(o,t,l);if(n?.contentAddressed&&"json"!==f.type)return void l.messages?.push(new i.A("persistable:contentAddressingUnsupported",`Property "${u}" is trying to serializing a resource with content of type ${f.type} with content addressing. Content addressing is only supported for json resources.`,{content:f}));const _=n?.contentAddressed&&"json"===f.type?(0,r.d)(f.jsonString):p?.filename??(0,a.lk)(),v=(0,s.fj)(n?.prefix??p?.prefix,_),y=`${v}.${(0,h.n)(f)}`;if(n?.contentAddressed&&l.resources&&"json"===f.type){const e=l.resources.toKeep.find((({resource:e})=>e.path===y))??l.resources.toAdd.find((({resource:e})=>e.path===y));if(e)return void(c[u]=e.resource.itemRelativeUrl)}const b=l.portalItem.resourceFromPath(y);(0,s.w8)(t)&&l.resources&&l.resources.pendingOperations.push((0,s.tk)(t).then((e=>{b.path=`${v}.${(0,h.n)({type:"blob",blob:e})}`,c[u]=b.itemRelativeUrl})).catch((()=>{})));const T=n?.compress??!1;l.resources&&g({...e,resource:b,content:f,compress:T,updates:l.resources.toAdd}),c[u]=b.itemRelativeUrl}function g({object:e,propertyName:t,updates:n,resource:i,content:r,compress:o}){n.push({resource:i,content:r,compress:o,finish:n=>{!function(e,t,n){"string"==typeof e[t]?e[t]=n.url:e[t].url=n.url}(e,t,n)}})}function m(e,t,n){return"string"==typeof e?{type:"url",url:t}:{type:"json",jsonString:JSON.stringify(e.toJSON(n))}}},72952:function(e,t,n){"use strict";n.d(t,{EB:function(){return p},Im:function(){return m},Mj:function(){return d},Ui:function(){return g},w2:function(){return f}});var i=n(83525),r=n(78879),o=n(63693);const s=new Set(["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"]);function a(e){return e instanceof i.A}function l(e){return e instanceof r.A?Object.keys(e.items):a(e)?(0,o.oY)(e).keys():e?Object.keys(e):[]}function c(e,t){return e instanceof r.A?e.items[t]:e[t]}function u(e){return e?e.declaredClass:null}function h(e,t){const n=e.diff;if(n&&"function"==typeof n)return n(e,t);const i=l(e),r=l(t);if(0===i.length&&0===r.length)return;if(!i.length||!r.length||function(e,t){return!(!Array.isArray(e)||!Array.isArray(t))&&e.length!==t.length}(e,t))return{type:"complete",oldValue:e,newValue:t};const o=r.filter((e=>!i.includes(e))),d=i.filter((e=>!r.includes(e))),p=i.filter((n=>r.includes(n)&&c(e,n)!==c(t,n))).concat(o,d).sort(),f=u(e);if(f&&s.has(f)&&p.length)return{type:"complete",oldValue:e,newValue:t};let g;const m=a(e)&&a(t);for(const i of p){const r=c(e,i),o=c(t,i);let s;if((m||"function"!=typeof r&&"function"!=typeof o)&&r!==o&&(null!=r||null!=o)){if(n&&n[i]&&"function"==typeof n[i])s=n[i]?.(r,o);else if(r instanceof Date&&o instanceof Date){if(r.getTime()===o.getTime())continue;s={type:"complete",oldValue:r,newValue:o}}else s="object"==typeof r&&"object"==typeof o&&u(r)===u(o)?h(r,o):{type:"complete",oldValue:r,newValue:o};null!=s&&(null!=g?g.diff[i]=s:g={type:"partial",diff:{[i]:s}})}}return g}function d(e,t){return p(e,t)}function p(e,t){if(null==e)return!1;const n=t.split(".");let i=e;for(const e of n){if("complete"===i.type)return!0;if("partial"!==i.type)return!1;{const t=i.diff[e];if(!t)return!1;i=t}}return!0}function f(e,t){if(!e)return!1;if("partial"===e.type){const n=Object.keys(e.diff);return 1===n.length&&n[0]===t}return!1}function g(e,t){if("function"!=typeof e&&"function"!=typeof t&&(null!=e||null!=t))return null==e||null==t||"object"==typeof e&&"object"==typeof t&&u(e)!==u(t)?{type:"complete",oldValue:e,newValue:t}:h(e,t)}function m(e){if(null==e)return!0;switch(e.type){case"complete":return!1;case"collection":{const t=e;for(const e of t.added)if(!m(e))return!1;for(const e of t.removed)if(!m(e))return!1;for(const e of t.changed)if(!m(e))return!1;return!0}case"partial":for(const t in e.diff)if(!m(e.diff[t]))return!1;return!0}}},75505:function(e,t,n){"use strict";n.d(t,{$:function(){return v},IB:function(){return a},Iy:function(){return P},N2:function(){return y},QP:function(){return R},RH:function(){return T},Vl:function(){return O},Ws:function(){return x},ZD:function(){return b},_L:function(){return M},bJ:function(){return E},e$:function(){return A},f6:function(){return I},pW:function(){return w},pf:function(){return C}});var i=n(52874),r=n(50659),o=n(21609),s=(n(33400),n(41546));function a(e){return"r"in e&&"g"in e&&"b"in e}function l(e){return"h"in e&&"s"in e&&"v"in e}function c(e){return"l"in e&&"a"in e&&"b"in e}function u(e){return"l"in e&&"c"in e&&"h"in e}const h=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],d=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function p(e,t){const n=[];let i,r;if(e[0].length!==t.length)throw new Error("dimensions do not match");const o=e.length,s=e[0].length;let a=0;for(i=0;i<o;i++){for(a=0,r=0;r<s;r++)a+=e[i][r]*t[r];n.push(a)}return n}function f(e){const t=[e.r/255,e.g/255,e.b/255].map((e=>e<=.04045?e/12.92:((e+.055)/1.055)**2.4)),n=p(h,t);return{x:100*n[0],y:100*n[1],z:100*n[2]}}function g(e){const t=p(d,[e.x/100,e.y/100,e.z/100]).map((e=>{const t=e<=.0031308?12.92*e:1.055*e**(1/2.4)-.055;return Math.min(1,Math.max(t,0))}));return{r:Math.round(255*t[0]),g:Math.round(255*t[1]),b:Math.round(255*t[2])}}function m(e){const t=[e.x/95.047,e.y/100,e.z/108.883].map((e=>e>(6/29)**3?e**(1/3):1/3*(29/6)**2*e+4/29));return{l:116*t[1]-16,a:500*(t[0]-t[1]),b:200*(t[1]-t[2])}}function _(e){const t=e.l,n=[(t+16)/116+e.a/500,(t+16)/116,(t+16)/116-e.b/200].map((e=>e>6/29?e**3:3*(6/29)**2*(e-4/29)));return{x:95.047*n[0],y:100*n[1],z:108.883*n[2]}}function v(e){return a(e)?e:u(e)?function(e){return g(_(function(e){const t=e.l,n=e.c,i=e.h;return{l:t,a:n*Math.cos(i),b:n*Math.sin(i)}}(e)))}(e):c(e)?function(e){return g(_(e))}(e):function(e){return"x"in e&&"y"in e&&"z"in e}(e)?g(e):l(e)?function(e){const t=(e.h+360)%360/60,n=e.s/100,i=e.v/100*255,r=i*n,o=r*(1-Math.abs(t%2-1));let s;switch(Math.floor(t)){case 0:s={r:r,g:o,b:0};break;case 1:s={r:o,g:r,b:0};break;case 2:s={r:0,g:r,b:o};break;case 3:s={r:0,g:o,b:r};break;case 4:s={r:o,g:0,b:r};break;case 5:case 6:s={r:r,g:0,b:o};break;default:s={r:0,g:0,b:0}}return s.r=Math.round(s.r+i-r),s.g=Math.round(s.g+i-r),s.b=Math.round(s.b+i-r),s}(e):e}function y(e){return l(e)?e:function(e){const t=e.r,n=e.g,i=e.b,r=Math.max(t,n,i),o=r-Math.min(t,n,i);let s=r,a=0===o?0:r===t?(n-i)/o%6:r===n?(i-t)/o+2:(t-n)/o+4,l=0===o?0:o/s;return a<0&&(a+=6),a*=60,l*=100,s*=100/255,{h:a,s:l,v:s}}(v(e))}function b(e){return c(e)?e:function(e){return m(f(e))}(v(e))}function T(e){return u(e)?e:function(e){return function(e){const t=e.l,n=e.a,i=e.b,r=Math.sqrt(n*n+i*i);let o=Math.atan2(i,n);return o=o>0?o:o+2*Math.PI,{l:t,c:r,h:o}}(m(f(e)))}(v(e))}function x(e,t){const{r:n,g:r,b:o}=t?.ignoreAlpha?e:function(e){let{r:t,g:n,b:r,a:o}=e;return o<1&&(t=Math.round(o*t+255*(1-o)),n=Math.round(o*n+255*(1-o)),r=Math.round(o*r+255*(1-o))),new i.A({r:t,g:n,b:r})}(e);return.2126*n+.7152*r+.0722*o}var w,S;function E(e,t=w.High){return x(e,{ignoreAlpha:!0})>t?new i.A([0,0,0,e.a]):new i.A([255,255,255,e.a])}function A(e,t){const n=b(e);n.l*=1-t;const i=v(n),r=e.clone();return r.setColor(i),r.a=e.a,r}function M(e,t){const n=e.clone();return n.a*=t,n}function O(e,t){const n=y(e);n.s*=t;const i=v(n),r=e.clone();return r.setColor(i),r.a=e.a,r}function R(e){return i.A.toUnitRGBA(e)}function C(e){return(0,s.fA)(e[0],e[1],e[2],e.length>3?e[3]:1)}function I(e,t){const n=i.A.toUnitRGBA(e);return n[3]*=t,n}function P(e,t,n={}){if(0===e.length||t<=0)return[];if(1===(e=e.map((e=>"string"==typeof e?new i.A(e):e))).length||1===t){const n=[],i=e[0];for(let e=0;e<t;e++)n.push(i.clone());return n}if(n.shuffle&&(e=(0,r.k4)((0,o.o8)(e),n.seed)),e.length>=t){const n=[],i=(e.length-1)/(t-1);for(let r=0;r<t;r++){const t=Math.round(r*i);n.push(e[t].clone())}return n}return function(e,t,n={}){const i=[],o=e.length-1,s=Math.ceil((t-e.length)/o);e:for(let r=0;r<o;r++){const o=e[r],a=e[r+1];for(let r=1;r<=s;r++){const l=r/(s+1);if(i.push(L(o,a,l,n)),i.length+e.length===t)break e}}return[...e.map((e=>e.clone())),...(0,r.k4)(i,n.seed??1)]}(e,t,n)}(S=w||(w={}))[S.Low=160]="Low",S[S.High=225]="High";const D=(e,t)=>{const n=Math.floor(10*t())-5;return Math.min(255,Math.max(0,e+n))};function L(e,t,n,o={}){const s=e.r,a=e.g,l=e.b,c=t.r,u=t.g,h=t.b,d=Math.round(s+(c-s)*n),p=Math.round(a+(u-a)*n),f=Math.round(l+(h-l)*n);if(!o.offset)return new i.A([d,p,f]);const g=(0,r.Mo)(o.seed);return new i.A([D(d,g),D(p,g),D(f,g)])}},88264:function(e,t,n){"use strict";function i(e){return"string"==typeof e?document.getElementById(e):e??null}function r(e,t){for(;;){const n=e.firstChild;if(!n)break;t.appendChild(n)}}n.d(t,{$:function(){return i},y:function(){return r}})},5161:function(e,t,n){"use strict";n.d(t,{T:function(){return o},U:function(){return r}});var i=n(15774);function r(e,t,n=0){const r=(0,i.qE)(e,0,l);for(let e=0;e<4;e++)t[n+e]=Math.floor(256*c(r*s[e]))}function o(e,t=0){let n=0;for(let i=0;i<4;i++)n+=e[t+i]*a[i];return n}const s=[1,256,65536,16777216],a=[1/256,1/65536,1/16777216,1/4294967296],l=o(new Uint8ClampedArray([255,255,255,255]));function c(e){return e-Math.floor(e)}},12978:function(e,t,n){"use strict";function i(){return[1,0,0,1,0,0]}function r(e){return[e[0],e[1],e[2],e[3],e[4],e[5]]}n.d(t,{o8:function(){return r},vt:function(){return i}});Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:[1,0,0,1,0,0],clone:r,create:i,createView:function(e,t){return new Float64Array(e,t,6)},fromValues:function(e,t,n,i,r,o){return[e,t,n,i,r,o]}},Symbol.toStringTag,{value:"Module"}))},43274:function(e,t,n){"use strict";function i(){return new Float32Array(3)}function r(e){const t=new Float32Array(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function o(e,t,n){const i=new Float32Array(3);return i[0]=e,i[1]=t,i[2]=n,i}function s(){return i()}function a(){return o(1,1,1)}function l(){return o(1,0,0)}function c(){return o(0,1,0)}function u(){return o(0,0,1)}n.d(t,{fA:function(){return o},o8:function(){return r},vt:function(){return i}});const h=s(),d=a(),p=l(),f=c(),g=u();Object.freeze(Object.defineProperty({__proto__:null,ONES:d,UNIT_X:p,UNIT_Y:f,UNIT_Z:g,ZEROS:h,clone:r,create:i,createView:function(e,t){return new Float32Array(e,t,3)},fromValues:o,ones:a,unitX:l,unitY:c,unitZ:u,zeros:s},Symbol.toStringTag,{value:"Module"}))},67348:function(e,t,n){"use strict";n.d(t,{$0:function(){return h},B8:function(){return s},CV:function(){return d},D_:function(){return r},Tl:function(){return u},e$:function(){return l},hZ:function(){return o},hs:function(){return c},kN:function(){return p},lw:function(){return a}});var i=n(8527);function r(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function o(e,t,n,i,r,o,s){return e[0]=t,e[1]=n,e[2]=i,e[3]=r,e[4]=o,e[5]=s,e}function s(e,t){const n=t[0],i=t[1],r=t[2],o=t[3],s=t[4],a=t[5];let l=n*o-i*r;return l?(l=1/l,e[0]=o*l,e[1]=-i*l,e[2]=-r*l,e[3]=n*l,e[4]=(r*a-o*s)*l,e[5]=(i*s-n*a)*l,e):null}function a(e,t,n){const i=t[0],r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=n[0],u=n[1],h=n[2],d=n[3],p=n[4],f=n[5];return e[0]=i*c+o*u,e[1]=r*c+s*u,e[2]=i*h+o*d,e[3]=r*h+s*d,e[4]=i*p+o*f+a,e[5]=r*p+s*f+l,e}function l(e,t,n){const i=t[0],r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=Math.sin(n),u=Math.cos(n);return e[0]=i*u+o*c,e[1]=r*u+s*c,e[2]=i*-c+o*u,e[3]=r*-c+s*u,e[4]=a,e[5]=l,e}function c(e,t,n){const i=t[0],r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=n[0],u=n[1];return e[0]=i*c,e[1]=r*c,e[2]=o*u,e[3]=s*u,e[4]=a,e[5]=l,e}function u(e,t,n){const i=t[0],r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=n[0],u=n[1];return e[0]=i,e[1]=r,e[2]=o,e[3]=s,e[4]=i*c+o*u+a,e[5]=r*c+s*u+l,e}function h(e,t){const n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=n,e[2]=-n,e[3]=i,e[4]=0,e[5]=0,e}function d(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e}function p(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e}function f(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e}const g=a,m=f;Object.freeze(Object.defineProperty({__proto__:null,add:function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},determinant:function(e){return e[0]*e[3]-e[1]*e[2]},equals:function(e,t){const n=e[0],r=e[1],o=e[2],s=e[3],a=e[4],l=e[5],c=t[0],u=t[1],h=t[2],d=t[3],p=t[4],f=t[5],g=(0,i.FD)();return Math.abs(n-c)<=g*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(r-u)<=g*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(o-h)<=g*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(s-d)<=g*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(a-p)<=g*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(l-f)<=g*Math.max(1,Math.abs(l),Math.abs(f))},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},frob:function(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+1)},fromRotation:h,fromScaling:d,fromTranslation:p,identity:r,invert:s,mul:g,multiply:a,multiplyScalar:function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e},multiplyScalarAndAdd:function(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e[3]=t[3]+n[3]*i,e[4]=t[4]+n[4]*i,e[5]=t[5]+n[5]*i,e},rotate:l,scale:c,set:o,str:function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},sub:m,subtract:f,translate:u},Symbol.toStringTag,{value:"Module"}))},32237:function(e,t,n){"use strict";n.d(t,{A6:function(){return m},B8:function(){return p},Xd:function(){return u},Xr:function(){return f},Yc:function(){return I},hZ:function(){return v},lw:function(){return h},t2:function(){return R},x8:function(){return c}});var i=n(87725),r=n(61769),o=n(32501),s=n(8527),a=n(20551),l=n(33400);function c(e,t,n){n*=.5;const i=Math.sin(n);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(n),e}function u(e,t){const n=2*Math.acos(t[3]),i=Math.sin(n/2);return i>(0,s.FD)()?(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i):(e[0]=1,e[1]=0,e[2]=0),n}function h(e,t,n){const i=t[0],r=t[1],o=t[2],s=t[3],a=n[0],l=n[1],c=n[2],u=n[3];return e[0]=i*u+s*a+r*c-o*l,e[1]=r*u+s*l+o*a-i*c,e[2]=o*u+s*c+i*l-r*a,e[3]=s*u-i*a-r*l-o*c,e}function d(e,t,n,i){const r=t[0],o=t[1],a=t[2],l=t[3];let c,u,h,d,p,f=n[0],g=n[1],m=n[2],_=n[3];return u=r*f+o*g+a*m+l*_,u<0&&(u=-u,f=-f,g=-g,m=-m,_=-_),1-u>(0,s.FD)()?(c=Math.acos(u),h=Math.sin(c),d=Math.sin((1-i)*c)/h,p=Math.sin(i*c)/h):(d=1-i,p=i),e[0]=d*r+p*f,e[1]=d*o+p*g,e[2]=d*a+p*m,e[3]=d*l+p*_,e}function p(e,t){const n=t[0],i=t[1],r=t[2],o=t[3],s=n*n+i*i+r*r+o*o,a=s?1/s:0;return e[0]=-n*a,e[1]=-i*a,e[2]=-r*a,e[3]=o*a,e}function f(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function g(e,t){const n=t[0]+t[4]+t[8];let i;if(n>0)i=Math.sqrt(n+1),e[3]=.5*i,i=.5/i,e[0]=(t[5]-t[7])*i,e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i;else{let n=0;t[4]>t[0]&&(n=1),t[8]>t[3*n+n]&&(n=2);const r=(n+1)%3,o=(n+2)%3;i=Math.sqrt(t[3*n+n]-t[3*r+r]-t[3*o+o]+1),e[n]=.5*i,i=.5/i,e[3]=(t[3*r+o]-t[3*o+r])*i,e[r]=(t[3*r+n]+t[3*n+r])*i,e[o]=(t[3*o+n]+t[3*n+o])*i}return e}function m(e,t,n,i){const r=.5*Math.PI/180;t*=r,n*=r,i*=r;const o=Math.sin(t),s=Math.cos(t),a=Math.sin(n),l=Math.cos(n),c=Math.sin(i),u=Math.cos(i);return e[0]=o*l*u-s*a*c,e[1]=s*a*u+o*l*c,e[2]=s*l*c-o*a*u,e[3]=s*l*u+o*a*c,e}const _=l.c,v=l.s,y=l.g,b=h,T=l.d,x=l.h,w=l.l,S=l.j,E=S,A=l.b,M=A,O=l.n,R=l.a,C=l.e;function I(e,t,n){const i=(0,a.f)(t,n);return i<-.999999?((0,a.e)(P,D,t),(0,a.G)(P)<1e-6&&(0,a.e)(P,L,t),(0,a.n)(P,P),c(e,P,Math.PI),e):i>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):((0,a.e)(P,t,n),e[0]=P[0],e[1]=P[1],e[2]=P[2],e[3]=1+i,O(e,e))}const P=(0,o.vt)(),D=(0,o.fA)(1,0,0),L=(0,o.fA)(0,1,0),N=(0,r.vt)(),F=(0,r.vt)(),z=(0,i.vt)();Object.freeze(Object.defineProperty({__proto__:null,add:y,calculateW:function(e,t){const n=t[0],i=t[1],r=t[2];return e[0]=n,e[1]=i,e[2]=r,e[3]=Math.sqrt(Math.abs(1-n*n-i*i-r*r)),e},conjugate:f,copy:_,dot:x,equals:C,exactEquals:R,fromEuler:m,fromMat3:g,getAxisAngle:u,identity:function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},invert:p,len:E,length:S,lerp:w,mul:b,multiply:h,normalize:O,random:function(e){const t=s.Ov,n=t(),i=t(),r=t(),o=Math.sqrt(1-n),a=Math.sqrt(n);return e[0]=o*Math.sin(2*Math.PI*i),e[1]=o*Math.cos(2*Math.PI*i),e[2]=a*Math.sin(2*Math.PI*r),e[3]=a*Math.cos(2*Math.PI*r),e},rotateX:function(e,t,n){n*=.5;const i=t[0],r=t[1],o=t[2],s=t[3],a=Math.sin(n),l=Math.cos(n);return e[0]=i*l+s*a,e[1]=r*l+o*a,e[2]=o*l-r*a,e[3]=s*l-i*a,e},rotateY:function(e,t,n){n*=.5;const i=t[0],r=t[1],o=t[2],s=t[3],a=Math.sin(n),l=Math.cos(n);return e[0]=i*l-o*a,e[1]=r*l+s*a,e[2]=o*l+i*a,e[3]=s*l-r*a,e},rotateZ:function(e,t,n){n*=.5;const i=t[0],r=t[1],o=t[2],s=t[3],a=Math.sin(n),l=Math.cos(n);return e[0]=i*l+r*a,e[1]=r*l-i*a,e[2]=o*l+s*a,e[3]=s*l-o*a,e},rotationTo:I,scale:T,set:v,setAxes:function(e,t,n,i){const r=z;return r[0]=n[0],r[3]=n[1],r[6]=n[2],r[1]=i[0],r[4]=i[1],r[7]=i[2],r[2]=-t[0],r[5]=-t[1],r[8]=-t[2],O(e,g(e,r))},setAxisAngle:c,slerp:d,sqlerp:function(e,t,n,i,r,o){return d(N,t,r,o),d(F,n,i,o),d(e,N,F,2*o*(1-o)),e},sqrLen:M,squaredLength:A,str:function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}},Symbol.toStringTag,{value:"Module"}))},7213:function(e,t,n){"use strict";function i(e){let t,n,i=[],r=!1;return function(...o){return r&&t===this&&function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(o,i)||(n=e.apply(this,o),t=this,i=o,r=!0),n}}n.d(t,{B:function(){return i}})},73888:function(e,t,n){"use strict";function i(e){return e&&"getAtOrigin"in e&&"originOf"in e}n.d(t,{H:function(){return i}})},88226:function(e,t,n){"use strict";n.d(t,{Jd:function(){return p},Nk:function(){return l},OM:function(){return d},Oo:function(){return h},ix:function(){return c},yh:function(){return u}});var i=n(16691),r=n(56275),o=n(15999);function s(e,t,n,i=2,s="abbr"){return(0,o.zJ)(e,(0,r.kM)(t,n).value,n,i,s)}function a(e,t,n,i=2,s="abbr"){return(0,o.nD)(e,(0,r.kM)(t,n).value,n,i,s)}function l(e,t,n,r=i.ie,s=!0){return(0,o.Me)(e.value,e.unit,e.rotationType,t,n,r,s)}function c(e,t,n,i,r="abbr"){switch(i=i??2,n){case"imperial":return function(e,t,n=2,i="abbr"){return(0,o.tr)(e,t.value,t.unit,n,i)}(e,t,i,r);case"metric":return function(e,t,n=2,i="abbr"){return(0,o.Ee)(e,t.value,t.unit,n,i)}(e,t,i,r);default:return s(e,t,n,i,r)}}function u(e,t,n,i=2,r="abbr"){switch(n){case"imperial":return function(e,t,n=2,i="abbr"){return(0,o.J1)(e,t.value,t.unit,n,i)}(e,t,i,r);case"metric":return function(e,t,n=2,i="abbr"){return(0,o.Mm)(e,t.value,t.unit,n,i)}(e,t,i,r);default:return a(e,t,n,i,r)}}function h(e,t,n,i=2,r="abbr"){switch(n){case"imperial":return function(e,t,n=2,i="abbr"){return(0,o.t_)(e,t.value,t.unit,n,i)}(e,t,i,r);case"metric":return function(e,t,n=2,i="abbr"){return(0,o.W4)(e,t.value,t.unit,n,i)}(e,t,i,r);default:return s(e,t,n,i,r)}}function d(e,t,n,i=2,r="abbr"){switch(n){case"imperial":return function(e,t,n=2,i="abbr"){return(0,o.LF)(e,t.value,t.unit,n,i)}(e,t,i,r);case"metric":return function(e,t,n=2,i="abbr"){return(0,o.e_)(e,t.value,t.unit,n,i)}(e,t,i,r);default:return a(e,t,n,i,r)}}function p(e,t,n,i=2,r="abbr"){switch(n){case"imperial":return function(e,t,n=2,i="abbr"){return(0,o.Sz)(e,t.value,t.unit,n,i)}(e,t,i,r);case"metric":return function(e,t,n=2,i="abbr"){return(0,o.zq)(e,t.value,t.unit,n,i)}(e,t,i,r);default:return s(e,t,n,i,r)}}},20248:function(e,t,n){"use strict";n.d(t,{U:function(){return u}});var i=n(53804),r=n(83525),o=n(61226),s=n(28181),a=n(74087),l=n(23502),c=n(65953);let u=class extends r.A{constructor(){super(...arguments),this.updating=!1,this._handleId=0,this._scheduleHandleId=0,this._pendingPromises=new Set}destroy(){this.removeAll()}add(e,t,n={}){return this._installWatch(e,t,n,s.watch)}addWhen(e,t,n={}){return this._installWatch(e,t,n,s.when)}addOnCollectionChange(e,t,{initial:n=!1,final:i=!1}={}){const r=++this._handleId;return this.addHandles([(0,s.on)(e,"after-changes",this._createSyncUpdatingCallback(),s.OH),(0,s.on)(e,"change",t,{onListenerAdd:n?e=>t({added:e.toArray(),removed:[]}):void 0,onListenerRemove:i?e=>t({added:[],removed:e.toArray()}):void 0})],r),(0,o.hA)((()=>this.removeHandles(r)))}addPromise(e){if(null==e)return e;const t=++this._handleId;this.addHandles((0,o.hA)((()=>{this._pendingPromises.delete(e)&&(0!==this._pendingPromises.size||this.hasHandles(h)||this._set("updating",!1))})),t),this._pendingPromises.add(e),this._set("updating",!0);const n=()=>this.removeHandles(t);return e.then(n,n),e}removeAll(){this._pendingPromises.clear(),this.removeAllHandles(),this._set("updating",!1)}_installWatch(e,t,n={},i){const r=++this._handleId;n.sync||this._installSyncUpdatingWatch(e,r);const s=i(e,t,n);return this.addHandles(s,r),(0,o.hA)((()=>this.removeHandles(r)))}_installSyncUpdatingWatch(e,t){const n=this._createSyncUpdatingCallback(),i=(0,s.watch)(e,n,{sync:!0,equals:()=>!1});return this.addHandles(i,t),i}_createSyncUpdatingCallback(){return()=>{this.removeHandles(h),++this._scheduleHandleId;const e=this._scheduleHandleId;this._get("updating")||this._set("updating",!0),this.addHandles((0,a._)((()=>{e===this._scheduleHandleId&&(this._set("updating",this._pendingPromises.size>0),this.removeHandles(h))})),h)}}};(0,i._)([(0,l.MZ)({readOnly:!0})],u.prototype,"updating",void 0),u=(0,i._)([(0,c.$)("esri.core.support.UpdatingHandles")],u);const h=-42},15999:function(e,t,n){"use strict";n.d(t,{Cq:function(){return u},Ee:function(){return p},J1:function(){return v},LF:function(){return b},Me:function(){return S},Mm:function(){return f},Sz:function(){return x},W4:function(){return g},e_:function(){return m},nD:function(){return d},t_:function(){return y},tr:function(){return _},v7:function(){return M},zJ:function(){return h},zq:function(){return T}});var i=n(69296),r=n(16691),o=n(15774),s=n(56275),a=n(50944),l=n(62938),c=n(2900);function u(e,t,n){return e.units[t][n]}function h(e,t,n,i=2,r="abbr"){return`${(0,c.ZV)(t,{minimumFractionDigits:i,maximumFractionDigits:i,signDisplay:t>0?"never":"exceptZero"})} ${u(e,n,r)}`}function d(e,t,n,i=2,r="abbr"){return`${(0,c.ZV)(t,{minimumFractionDigits:i,maximumFractionDigits:i,signDisplay:"exceptZero"})} ${u(e,n,r)}`}function p(e,t,n,i=2,r="abbr"){const o=(0,l.x0)(t,n);return h(e,(0,l.oU)(t,n,o),o,i,r)}function f(e,t,n,i=2,r="abbr"){const o=(0,l.x0)(t,n);return d(e,(0,l.oU)(t,n,o),o,i,r)}function g(e,t,n,i=2,r="abbr"){const o=(0,l.x$)(t,n);return h(e,(0,l.oU)(t,n,o),o,i,r)}function m(e,t,n,i=2,r="abbr"){const o=(0,l.x$)(t,n);return d(e,(0,l.oU)(t,n,o),o,i,r)}function _(e,t,n,i=2,r="abbr"){const o=(0,l.OU)(t,n);return h(e,(0,l.oU)(t,n,o),o,i,r)}function v(e,t,n,i=2,r="abbr"){const o=(0,l.OU)(t,n);return d(e,(0,l.oU)(t,n,o),o,i,r)}function y(e,t,n,i=2,r="abbr"){const o=(0,l.y7)(t,n);return h(e,(0,l.oU)(t,n,o),o,i,r)}function b(e,t,n,i=2,r="abbr"){const o=(0,l.y7)(t,n);return d(e,(0,l.oU)(t,n,o),o,i,r)}function T(e,t,n,i=2,r="abbr"){const o=(0,l.wv)(t,n);return h(e,(0,l.oU)(t,n,o),o,i,r)}function x(e,t,n,i=2,r="abbr"){const o=(0,l.TL)(t,n);return h(e,(0,l.oU)(t,n,o),o,i,r)}const w=(e,t)=>({style:"unit",unitDisplay:"narrow",unit:"degree",maximumFractionDigits:t,minimumFractionDigits:t,signDisplay:e>0?"never":"exceptZero"});function S(e,t,n,i,o,a=r.ie,u=!0){let h=a.normalize((0,s.g2)((0,l.oU)(e,t,"degrees"),n,i),0,u);const d=w(h,o??2);return h=function(e,t){const n=JSON.stringify(t);let i=E.get(n);return i||(i=new Intl.NumberFormat("en-US",t),E.set(n,i)),/^[-+]?360\.?0*°?$/.test(i.format(e))?0:e}(h,d),(0,c.ZV)(h,d)}const E=new Map;const A=["B","kB","MB","GB","TB"];function M(e,t){let n=0===(t=Math.round(t))?0:Math.floor(Math.log(t)/Math.log(i.u.KILOBYTES));n=(0,o.qE)(n,0,A.length-1);const r=(0,c.ZV)(t/i.u.KILOBYTES**n,{maximumFractionDigits:2});return(0,a.HC)(e.units.bytes[A[n]],{fileSize:r})}},66110:function(e,t,n){"use strict";n.d(t,{AG:function(){return a},lk:function(){return r},vD:function(){return s},yS:function(){return o}});const i="randomUUID"in crypto;function r(){if(i)return crypto.randomUUID();const e=crypto.getRandomValues(new Uint16Array(8));e[3]=4095&e[3]|16384,e[4]=16383&e[4]|32768;const t=t=>e[t].toString(16).padStart(4,"0");return t(0)+t(1)+"-"+t(2)+"-"+t(3)+"-"+t(4)+"-"+t(5)+t(6)+t(7)}function o(){return`{${r().toUpperCase()}}`}function s(){return`{${r()}}`}function a(e){const t=e.toUpperCase();return"{"!==e[0]?`{${t}}`:t}},6338:function(e,t,n){"use strict";n.d(t,{Hh:function(){return c},mT:function(){return h},o6:function(){return u},s1:function(){return l},ts:function(){return d}});var i=n(39819),r=n(38305),o=n(45532),s=n(57165),a=n(2900);function l(){return(0,r.i)()}function c(){return(0,r.l)()}function u(e,t){const n=[];e=(e=(e=e.replaceAll(/[\u00B0\u00BA]/g,"^")).replaceAll("′","'")).replaceAll("″",'"');const a=function(e){let t=null;if(e||(e=s.A.WGS84),e.wkid){if(t=r.P.geogcs(e.wkid),!t)throw new i.A("coordinate-formatter:invalid-spatial-reference","wkid is not valid")}else{if(!e.wkt2&&!e.wkt)throw new i.A("coordinate-formatter:invalid-spatial-reference","wkid and wkt are missing");if(t=r.P.fromString(r.a.PE_TYPE_GEOGCS,e.wkt2||e.wkt),!t)throw new i.A("coordinate-formatter:invalid-spatial-reference","wkt is not valid")}return t}(t);return r.c.dmsToGeog(a,1,[e],n)?new o.default(n[0][0],n[0][1],t||s.A.WGS84):null}function h(e){return e&&l()?(0,a.$J)(e)??u(`0° 0' 0" N | ${e}`)?.longitude??u(`0 | ${e}`)?.longitude??null:null}function d(e){return e&&l()?(0,a.$J)(e)??u(`${e} | 0° 0' 0" E`)?.latitude??u(`${e} | 0`)?.latitude??null:null}},7456:function(e,t,n){"use strict";n.d(t,{l:function(){return c}});var i=n(15774),r=n(73364),o=n(32501),s=n(46098),a=n(61441),l=n(57652);function c(e,t,n,i){if(null==e||null==i)return!1;const o=(0,a.Qk)(e,a.Wv),c=(0,a.Qk)(i,a.zp);if(o===c&&!u(c)&&(o!==a.rz.UNKNOWN||(0,l.aI)(e,i)))return(0,r.kN)(n,t),!0;if(u(c)){const e=a.w5[o][a.rz.LON_LAT],i=a.w5[a.rz.LON_LAT][c];return null!=e&&null!=i&&(e(t,0,d,0),i(d,0,p,0),(0,s.z)(h*d[0],h*d[1],n),n[12]=p[0],n[13]=p[1],n[14]=p[2],!0)}const f=u(o);if((c===a.rz.WEB_MERCATOR||c===a.rz.PLATE_CARREE||c===a.rz.WGS84||c===a.rz.CGCS2000)&&(o===a.rz.WGS84||f||o===a.rz.WEB_MERCATOR||o===a.rz.CGCS2000)){const e=a.w5[o][a.rz.LON_LAT],i=a.w5[a.rz.LON_LAT][c];return null!=e&&null!=i&&(e(t,0,d,0),i(d,0,p,0),f?(0,s.Z)(h*d[0],h*d[1],n):(0,r.D_)(n),n[12]=p[0],n[13]=p[1],n[14]=p[2],!0)}return!1}function u(e){return e===a.rz.SPHERICAL_ECEF||e===a.rz.SPHERICAL_MARS_PCPF||e===a.rz.SPHERICAL_MOON_PCPF||e===a.rz.WGS84_ECEF}const h=(0,i.kU)(1),d=(0,o.vt)(),p=(0,o.vt)()},46098:function(e,t,n){"use strict";n.d(t,{Z:function(){return o},z:function(){return r}});var i=n(73364);function r(e,t,n){const i=Math.sin(e),r=Math.cos(e),o=Math.sin(t),s=Math.cos(t),a=n;return a[0]=-i,a[4]=-o*r,a[8]=s*r,a[12]=0,a[1]=r,a[5]=-o*i,a[9]=s*i,a[13]=0,a[2]=0,a[6]=s,a[10]=o,a[14]=0,a[3]=0,a[7]=0,a[11]=0,a[15]=1,a}function o(e,t,n){return r(e,t,n),(0,i.mg)(n,n),n}},56919:function(e,t,n){"use strict";n.d(t,{E:function(){return o}});var i=n(32501),r=(n(46157),n(68734));function o(e,t,n){return!!(0,r.F)(e,t,s,n.spatialReference)&&(n.x=s[0],n.y=s[1],n.z=s[2],!0)}const s=(0,i.vt)()},96611:function(e,t,n){"use strict";n.d(t,{Y0:function(){return c},lO:function(){return u}});var i=n(61714),r=n(57165),o=n(57652);const s=new r.A(i.fv),a=new r.A(i.FY),l=new r.A(i.LJ),c=new r.A(i.Ro);function u(e){const t=h.get(e);if(t)return t;let n=s;if(e)if(e===a)n=a;else if(e===l)n=l;else{const t=e.wkid,i=e.latestWkid;if(null!=t||null!=i)(0,o.tl)(t)||(0,o.tl)(i)?n=a:((0,o.ZL)(t)||(0,o.ZL)(i))&&(n=l);else{const t=e.wkt2??e.wkt;if(t){const e=t.toUpperCase();e===d?n=a:e===p&&(n=l)}}}return h.set(e,n),n}const h=new Map,d=a.wkt.toUpperCase(),p=l.wkt.toUpperCase()},5047:function(e,t,n){"use strict";n.d(t,{AK:function(){return s},Wz:function(){return o},oe:function(){return r}});var i=n(24540);function r(e,t=!1){return e<=i.y9?t?new Array(e).fill(0):new Array(e):new Float32Array(e)}function o(e){return((0,i.cy)(e)?e.length:e.byteLength/8)<=i.y9?Array.from(e):new Float32Array(e)}function s(e,t,n){return Array.isArray(e)?e.slice(t,t+n):e.subarray(t,t+n)}},37819:function(e,t,n){"use strict";n.d(t,{Dg:function(){return r},EH:function(){return d},JH:function(){return s},my:function(){return o},tM:function(){return u}});var i=n(24540);function r(e){if((0,i.cy)(e)){if(e.length<i.y9)return e}else if(e.length<i.y9)return Array.from(e);let t=!0,n=!0;return e.some(((e,i)=>(t=t&&0===e,n=n&&e===i,!t&&!n))),t?d(e.length):n?u(e.length):(0,i.cy)(e)||e.BYTES_PER_ELEMENT!==Uint16Array.BYTES_PER_ELEMENT?function(e){let t=!0;for(const n of e){if(n>=65536)return(0,i.cy)(e)?new Uint32Array(e):e;n>=256&&(t=!1)}return t?new Uint8Array(e):new Uint16Array(e)}(e):e}function o(e){return e<=i.y9?new Array(e):e<=65536?new Uint16Array(e):new Uint32Array(e)}function s(e){return e<=i.y9?new Array(e):new Uint32Array(e)}let a=(()=>{const e=new Uint32Array(131072);for(let t=0;t<e.length;++t)e[t]=t;return e})();const l=[0],c=(()=>{const e=new Uint16Array(65536);for(let t=0;t<e.length;++t)e[t]=t;return e})();function u(e){if(1===e)return l;if(e<i.y9)return Array.from(new Uint16Array(c.buffer,0,e));if(e<c.length)return new Uint16Array(c.buffer,0,e);if(e>a.length){const t=Math.max(2*a.length,e);a=new Uint32Array(t);for(let e=0;e<a.length;e++)a[e]=e}return new Uint32Array(a.buffer,0,e)}let h=new Uint8Array(65536);function d(e){if(1===e)return l;if(e<i.y9)return new Array(e).fill(0);if(e>h.length){const t=Math.max(2*h.length,e);h=new Uint8Array(t)}return new Uint8Array(h.buffer,0,e)}},65907:function(e,t,n){"use strict";n.d(t,{A:function(){return h}});var i,r=n(53804),o=n(75743),s=n(30905),a=n(23502),l=(n(58941),n(40633),n(13798),n(74376)),c=n(65953);let u=i=class extends((0,o.O)(s.oY)){constructor(e){super(e),this.type="georeferenced",this.origin=null}};u.absolute=new i,(0,r._)([(0,l.e)({georeferenced:"georeferenced"},{readOnly:!0})],u.prototype,"type",void 0),(0,r._)([(0,a.MZ)({type:[Number],nonNullable:!1,json:{write:!0}})],u.prototype,"origin",void 0),u=i=(0,r._)([(0,c.$)("esri.geometry.support.MeshGeoreferencedVertexSpace")],u);const h=u},20460:function(e,t,n){"use strict";n.d(t,{A:function(){return h}});var i=n(53804),r=n(75743),o=n(30905),s=n(23502),a=(n(58941),n(40633),n(13798),n(74376)),l=n(65953),c=n(32501);let u=class extends((0,r.O)(o.oY)){constructor(e){super(e),this.type="local",this.origin=(0,c.vt)()}};(0,i._)([(0,a.e)({local:"local"},{readOnly:!0})],u.prototype,"type",void 0),(0,i._)([(0,s.MZ)({type:[Number],nonNullable:!0,json:{write:!0}})],u.prototype,"origin",void 0),u=(0,i._)([(0,l.$)("esri.geometry.support.MeshLocalVertexSpace")],u);const h=u},36405:function(e,t,n){"use strict";n.d(t,{A:function(){return m}});var i,r=n(53804),o=n(30905),s=n(23502),a=(n(58941),n(40633),n(13798),n(65953)),l=n(73364),c=n(39714),u=n(32237),h=n(61769),d=n(32501),p=n(26133);let f=i=class extends o.oY{constructor(e){super(e),this.translation=(0,d.vt)(),this.rotationAxis=(0,d.ci)(p.up),this.rotationAngle=0,this.scale=(0,d.fA)(1,1,1)}get rotation(){return(0,p.i4)(this.rotationAxis,this.rotationAngle)}set rotation(e){this.rotationAxis=(0,d.o8)((0,p.yo)(e)),this.rotationAngle=(0,p.g7)(e)}get localMatrix(){const e=(0,c.vt)();return(0,u.x8)(g,(0,p.yo)(this.rotation),(0,p.$I)(this.rotation)),(0,l.o1)(e,g,this.translation,this.scale),e}get localMatrixInverse(){return(0,l.B8)((0,c.vt)(),this.localMatrix)}equals(e){return this===e||null!=e&&(0,l.t2)(this.localMatrix,e.localMatrix)}clone(){const e={translation:(0,d.o8)(this.translation),rotationAxis:(0,d.o8)(this.rotationAxis),rotationAngle:this.rotationAngle,scale:(0,d.o8)(this.scale)};return new i(e)}};(0,r._)([(0,s.MZ)({type:[Number],nonNullable:!0,json:{write:!0}})],f.prototype,"translation",void 0),(0,r._)([(0,s.MZ)({type:[Number],nonNullable:!0,json:{write:!0}})],f.prototype,"rotationAxis",void 0),(0,r._)([(0,s.MZ)({type:Number,nonNullable:!0,json:{write:!0}})],f.prototype,"rotationAngle",void 0),(0,r._)([(0,s.MZ)({type:[Number],nonNullable:!0,json:{write:!0}})],f.prototype,"scale",void 0),(0,r._)([(0,s.MZ)()],f.prototype,"rotation",null),(0,r._)([(0,s.MZ)()],f.prototype,"localMatrix",null),(0,r._)([(0,s.MZ)()],f.prototype,"localMatrixInverse",null),f=i=(0,r._)([(0,a.$)("esri.geometry.support.MeshTransform")],f);const g=(0,h.vt)(),m=f},26133:function(e,t,n){"use strict";n.d(t,{$I:function(){return _},AU:function(){return f},Cr:function(){return h},g7:function(){return m},i4:function(){return u},ui:function(){return d},up:function(){return y},vt:function(){return c},yo:function(){return g}});var i=n(15774),r=n(73364),o=n(32237),s=n(61769),a=n(20551),l=n(32501);function c(e=y){return[e[0],e[1],e[2],e[3]]}function u(e,t,n=c()){return(0,a.c)(n,e),n[3]=t,n}function h(e,t,n){return(0,a.e)(n,e,t),(0,a.n)(n,n),n[3]=-(0,a.r)(e,t),n}function d(e,t=c()){const n=(0,r.l)(b,e);return v(t,(0,i.KJ)((0,o.Xd)(t,n))),t}function p(e,t,n=c()){return(0,o.x8)(b,e,_(e)),(0,o.x8)(T,t,_(t)),(0,o.lw)(b,T,b),v(n,(0,i.KJ)((0,o.Xd)(n,b)))}function f(e,t,n,i=c()){return u(l.Cw,e,x),u(l.JP,t,w),u(l.Cb,n,S),p(x,w,x),p(x,S,i),i}function g(e){return e}function m(e){return e[3]}function _(e){return(0,i.kU)(e[3])}function v(e,t){return e[3]=t,e}const y=[0,0,1,0],b=(0,s.vt)(),T=(0,s.vt)(),x=(c(),c()),w=c(),S=c()},92754:function(e,t,n){"use strict";n.d(t,{Y$:function(){return d},qB:function(){return b},Qt:function(){return U},My:function(){return $},bf:function(){return F},jZ:function(){return m},j0:function(){return _},Sx:function(){return v},E$:function(){return y},h:function(){return O},P:function(){return P},SL:function(){return S},gH:function(){return p},si:function(){return T},mJ:function(){return k},UL:function(){return j},D6:function(){return z},Yi:function(){return R},An:function(){return D},LC:function(){return E},xs:function(){return f},Xm:function(){return x},Vp:function(){return B},zD:function(){return Z},m8:function(){return H},nS:function(){return C},H$:function(){return L},eI:function(){return A},Eq:function(){return g},Aj:function(){return w},E7:function(){return G},Y4:function(){return W},TX:function(){return V},Uz:function(){return I},ml:function(){return N},XP:function(){return M}});class i{constructor(e,t,n=0,i,r){this.TypedArrayConstructor=e,this.elementCount=9;const o=this.TypedArrayConstructor;void 0===i&&(i=9*o.BYTES_PER_ELEMENT);const s=0===t.byteLength?0:n;this.typedBuffer=null==r?new o(t,s):new o(t,s,(r-n)/o.BYTES_PER_ELEMENT),this.typedBufferStride=i/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,n=this.count-t){const i=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,i,this.stride,i+n*this.stride)}getMat(e,t){let n=e*this.typedBufferStride;for(let e=0;e<9;e++)t[e]=this.typedBuffer[n++];return t}setMat(e,t){let n=e*this.typedBufferStride;for(let e=0;e<9;e++)this.typedBuffer[n++]=t[e]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,n){this.typedBuffer[e*this.typedBufferStride+t]=n}copyFrom(e,t,n){const i=this.typedBuffer,r=t.typedBuffer;let o=e*this.typedBufferStride,s=n*t.typedBufferStride;for(let e=0;e<9;++e)i[o++]=r[s++]}get buffer(){return this.typedBuffer.buffer}}i.ElementCount=9;class r{constructor(e,t,n=0,i,r){this.TypedArrayConstructor=e,this.elementCount=16;const o=this.TypedArrayConstructor;void 0===i&&(i=16*o.BYTES_PER_ELEMENT);const s=0===t.byteLength?0:n;this.typedBuffer=null==r?new o(t,s):new o(t,s,(r-n)/o.BYTES_PER_ELEMENT),this.typedBufferStride=i/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,n=this.count-t){const i=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,i,this.stride,i+n*this.stride)}getMat(e,t){let n=e*this.typedBufferStride;for(let e=0;e<16;e++)t[e]=this.typedBuffer[n++];return t}setMat(e,t){let n=e*this.typedBufferStride;for(let e=0;e<16;e++)this.typedBuffer[n++]=t[e]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,n){this.typedBuffer[e*this.typedBufferStride+t]=n}copyFrom(e,t,n){this.copyFromTypedBuffer(e,t.typedBuffer,n*t.typedBufferStride)}copyFromTypedBuffer(e,t,n){const i=this.typedBuffer;let r=e*this.typedBufferStride;for(let e=0;e<16;++e)i[r++]=t[n++]}get buffer(){return this.typedBuffer.buffer}}r.ElementCount=16;class o{constructor(e,t,n=0,i,r){this.TypedArrayConstructor=e,this.elementCount=1;const o=this.TypedArrayConstructor;void 0===i&&(i=o.BYTES_PER_ELEMENT);const s=0===t.byteLength?0:n;this.typedBuffer=null==r?new o(t,s):new o(t,s,(r-n)/o.BYTES_PER_ELEMENT),this.stride=i,this.typedBufferStride=i/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride)}sliceBuffer(e,t,n=this.count-t){const i=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,i,this.stride,i+n*this.stride)}get(e){return this.typedBuffer[e*this.typedBufferStride]}set(e,t){this.typedBuffer[e*this.typedBufferStride]=t}get buffer(){return this.typedBuffer.buffer}}o.ElementCount=1;var s=n(13786);class a{constructor(e,t,n=0,i,r){this.TypedArrayConstructor=e,this.elementCount=2;const o=this.TypedArrayConstructor;void 0===i&&(i=2*o.BYTES_PER_ELEMENT);const s=0===t.byteLength?0:n;this.typedBuffer=null==r?new o(t,s):new o(t,s,(r-n)/o.BYTES_PER_ELEMENT),this.typedBufferStride=i/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,n=this.count-t){const i=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,i,this.stride,i+n*this.stride)}getVec(e,t){return e*=this.typedBufferStride,(0,s.hZ)(t,this.typedBuffer[e],this.typedBuffer[e+1])}setVec(e,t){e*=this.typedBufferStride,this.typedBuffer[e++]=t[0],this.typedBuffer[e]=t[1]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,n){this.typedBuffer[e*this.typedBufferStride+t]=n}setValues(e,t,n){e*=this.typedBufferStride,this.typedBuffer[e++]=t,this.typedBuffer[e]=n}copyFrom(e,t,n){const i=this.typedBuffer,r=t.typedBuffer;let o=e*this.typedBufferStride,s=n*t.typedBufferStride;i[o++]=r[s++],i[o]=r[s]}get buffer(){return this.typedBuffer.buffer}}a.ElementCount=2;var l=n(20551);class c{constructor(e,t,n=0,i,r){this.TypedArrayConstructor=e,this.elementCount=3;const o=this.TypedArrayConstructor;void 0===i&&(i=3*o.BYTES_PER_ELEMENT);const s=0===t.byteLength?0:n;this.typedBuffer=null==r?new o(t,s):new o(t,s,(r-n)/o.BYTES_PER_ELEMENT),this.typedBufferStride=i/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,n=this.count-t){const i=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,i,this.stride,i+n*this.stride)}getVec(e,t){return e*=this.typedBufferStride,(0,l.i)(t,this.typedBuffer[e],this.typedBuffer[e+1],this.typedBuffer[e+2])}setVec(e,t){e*=this.typedBufferStride,this.typedBuffer[e++]=t[0],this.typedBuffer[e++]=t[1],this.typedBuffer[e]=t[2]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,n){this.typedBuffer[e*this.typedBufferStride+t]=n}setValues(e,t,n,i){e*=this.typedBufferStride,this.typedBuffer[e++]=t,this.typedBuffer[e++]=n,this.typedBuffer[e]=i}copyFrom(e,t,n){const i=this.typedBuffer,r=t.typedBuffer;let o=e*this.typedBufferStride,s=n*t.typedBufferStride;i[o++]=r[s++],i[o++]=r[s++],i[o]=r[s]}get buffer(){return this.typedBuffer.buffer}}c.ElementCount=3;var u=n(33400);class h{constructor(e,t,n=0,i,r){this.TypedArrayConstructor=e,this.start=n,this.elementCount=4;const o=this.TypedArrayConstructor;void 0===i&&(i=4*o.BYTES_PER_ELEMENT);const s=0===t.byteLength?0:n;this.typedBuffer=null==r?new o(t,s):new o(t,s,(r-n)/o.BYTES_PER_ELEMENT),this.typedBufferStride=i/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,n=this.count-t){const i=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,i,this.stride,i+n*this.stride)}getVec(e,t){return e*=this.typedBufferStride,(0,u.s)(t,this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e])}setVec(e,t){e*=this.typedBufferStride,this.typedBuffer[e++]=t[0],this.typedBuffer[e++]=t[1],this.typedBuffer[e++]=t[2],this.typedBuffer[e]=t[3]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,n){this.typedBuffer[e*this.typedBufferStride+t]=n}setValues(e,t,n,i,r){e*=this.typedBufferStride,this.typedBuffer[e++]=t,this.typedBuffer[e++]=n,this.typedBuffer[e++]=i,this.typedBuffer[e]=r}copyFrom(e,t,n){const i=this.typedBuffer,r=t.typedBuffer;let o=e*this.typedBufferStride,s=n*t.typedBufferStride;i[o++]=r[s++],i[o++]=r[s++],i[o++]=r[s++],i[o]=r[s]}get buffer(){return this.typedBuffer.buffer}}h.ElementCount=4;class d extends o{constructor(e,t=0,n,i){super(Float32Array,e,t,n,i),this.elementType="f32"}static fromTypedArray(e,t){return new d(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}d.ElementType="f32";class p extends a{constructor(e,t=0,n,i){super(Float32Array,e,t,n,i),this.elementType="f32"}slice(e,t){return this.sliceBuffer(p,e,t)}static fromTypedArray(e,t){return new p(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}p.ElementType="f32";class f extends c{constructor(e,t=0,n,i){super(Float32Array,e,t,n,i),this.elementType="f32"}slice(e,t){return this.sliceBuffer(f,e,t)}static fromTypedArray(e,t){return new f(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}f.ElementType="f32";class g extends h{constructor(e,t=0,n,i){super(Float32Array,e,t,n,i),this.elementType="f32"}slice(e,t){return this.sliceBuffer(g,e,t)}static fromTypedArray(e,t){return new g(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}g.ElementType="f32";class m extends i{constructor(e,t=0,n,i){super(Float32Array,e,t,n,i),this.elementType="f32"}slice(e,t){return this.sliceBuffer(m,e,t)}static fromTypedArray(e,t){return new m(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}m.ElementType="f32";class _ extends i{constructor(e,t=0,n,i){super(Float64Array,e,t,n,i),this.elementType="f64"}slice(e,t){return this.sliceBuffer(_,e,t)}static fromTypedArray(e,t){return new _(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}_.ElementType="f64";class v extends r{constructor(e,t=0,n,i){super(Float32Array,e,t,n,i),this.elementType="f32"}slice(e,t){return this.sliceBuffer(v,e,t)}static fromTypedArray(e,t){return new v(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}v.ElementType="f32";class y extends r{constructor(e,t=0,n,i){super(Float64Array,e,t,n,i),this.elementType="f64"}slice(e,t){return this.sliceBuffer(y,e,t)}static fromTypedArray(e,t){return new y(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}y.ElementType="f64";class b extends o{constructor(e,t=0,n,i){super(Float64Array,e,t,n,i),this.elementType="f64"}slice(e,t){return this.sliceBuffer(b,e,t)}static fromTypedArray(e,t){return new b(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}b.ElementType="f64";class T extends a{constructor(e,t=0,n,i){super(Float64Array,e,t,n,i),this.elementType="f64"}slice(e,t){return this.sliceBuffer(T,e,t)}static fromTypedArray(e,t){return new T(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}T.ElementType="f64";class x extends c{constructor(e,t=0,n,i){super(Float64Array,e,t,n,i),this.elementType="f64"}slice(e,t){return this.sliceBuffer(x,e,t)}static fromTypedArray(e,t){return new x(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}x.ElementType="f64";class w extends h{constructor(e,t=0,n,i){super(Float64Array,e,t,n,i),this.elementType="f64"}slice(e,t){return this.sliceBuffer(w,e,t)}static fromTypedArray(e,t){return new w(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}w.ElementType="f64";class S extends o{constructor(e,t=0,n,i){super(Uint8Array,e,t,n,i),this.elementType="u8"}slice(e,t){return this.sliceBuffer(S,e,t)}static fromTypedArray(e,t){return new S(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}S.ElementType="u8";class E extends a{constructor(e,t=0,n,i){super(Uint8Array,e,t,n,i),this.elementType="u8"}slice(e,t){return this.sliceBuffer(E,e,t)}static fromTypedArray(e,t){return new E(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}E.ElementType="u8";class A extends c{constructor(e,t=0,n,i){super(Uint8Array,e,t,n,i),this.elementType="u8"}slice(e,t){return this.sliceBuffer(A,e,t)}static fromTypedArray(e,t){return new A(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}A.ElementType="u8";class M extends h{constructor(e,t=0,n,i){super(Uint8Array,e,t,n,i),this.elementType="u8"}slice(e,t){return this.sliceBuffer(M,e,t)}static fromTypedArray(e,t){return new M(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}M.ElementType="u8";class O extends o{constructor(e,t=0,n,i){super(Uint16Array,e,t,n,i),this.elementType="u16"}slice(e,t){return this.sliceBuffer(O,e,t)}static fromTypedArray(e,t){return new O(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}O.ElementType="u16";class R extends a{constructor(e,t=0,n,i){super(Uint16Array,e,t,n,i),this.elementType="u16"}slice(e,t){return this.sliceBuffer(R,e,t)}static fromTypedArray(e,t){return new R(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}R.ElementType="u16";class C extends c{constructor(e,t=0,n,i){super(Uint16Array,e,t,n,i),this.elementType="u16"}slice(e,t){return this.sliceBuffer(C,e,t)}static fromTypedArray(e,t){return new C(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}C.ElementType="u16";class I extends h{constructor(e,t=0,n,i){super(Uint16Array,e,t,n,i),this.elementType="u16"}slice(e,t){return this.sliceBuffer(I,e,t)}static fromTypedArray(e,t){return new I(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}I.ElementType="u16";class P extends o{constructor(e,t=0,n,i){super(Uint32Array,e,t,n,i),this.elementType="u32"}slice(e,t){return this.sliceBuffer(P,e,t)}static fromTypedArray(e,t){return new P(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}P.ElementType="u32";class D extends a{constructor(e,t=0,n,i){super(Uint32Array,e,t,n,i),this.elementType="u32"}slice(e,t){return this.sliceBuffer(D,e,t)}static fromTypedArray(e,t){return new D(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}D.ElementType="u32";class L extends c{constructor(e,t=0,n,i){super(Uint32Array,e,t,n,i),this.elementType="u32"}slice(e,t){return this.sliceBuffer(L,e,t)}static fromTypedArray(e,t){return new L(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}L.ElementType="u32";class N extends h{constructor(e,t=0,n,i){super(Uint32Array,e,t,n,i),this.elementType="u32"}slice(e,t){return this.sliceBuffer(N,e,t)}static fromTypedArray(e,t){return new N(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}N.ElementType="u32";class F extends o{constructor(e,t=0,n,i){super(Int8Array,e,t,n,i),this.elementType="i8"}slice(e,t){return this.sliceBuffer(F,e,t)}static fromTypedArray(e,t){return new F(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}F.ElementType="i8";class z extends a{constructor(e,t=0,n,i){super(Int8Array,e,t,n,i),this.elementType="i8"}slice(e,t){return this.sliceBuffer(z,e,t)}static fromTypedArray(e,t){return new z(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}z.ElementType="i8";class H extends c{constructor(e,t=0,n,i){super(Int8Array,e,t,n,i),this.elementType="i8"}slice(e,t){return this.sliceBuffer(H,e,t)}static fromTypedArray(e,t){return new H(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}H.ElementType="i8";class V extends h{constructor(e,t=0,n,i){super(Int8Array,e,t,n,i),this.elementType="i8"}slice(e,t){return this.sliceBuffer(V,e,t)}static fromTypedArray(e,t){return new V(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}V.ElementType="i8";class U extends o{constructor(e,t=0,n,i){super(Int16Array,e,t,n,i),this.elementType="i16"}slice(e,t){return this.sliceBuffer(U,e,t)}static fromTypedArray(e,t){return new U(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}U.ElementType="i16";class k extends a{constructor(e,t=0,n,i){super(Int16Array,e,t,n,i),this.elementType="i16"}slice(e,t){return this.sliceBuffer(k,e,t)}static fromTypedArray(e,t){return new k(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}k.ElementType="i16";class B extends c{constructor(e,t=0,n,i){super(Int16Array,e,t,n,i),this.elementType="i16"}slice(e,t){return this.sliceBuffer(B,e,t)}static fromTypedArray(e,t){return new B(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}B.ElementType="i16";class G extends h{constructor(e,t=0,n,i){super(Int16Array,e,t,n,i),this.elementType="i16"}slice(e,t){return this.sliceBuffer(G,e,t)}static fromTypedArray(e,t){return new G(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}G.ElementType="i16";class $ extends o{constructor(e,t=0,n,i){super(Int32Array,e,t,n,i),this.elementType="i32"}slice(e,t){return this.sliceBuffer($,e,t)}static fromTypedArray(e,t){return new $(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}$.ElementType="i32";class j extends a{constructor(e,t=0,n,i){super(Int32Array,e,t,n,i),this.elementType="i32"}slice(e,t){return this.sliceBuffer(j,e,t)}static fromTypedArray(e,t){return new j(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}j.ElementType="i32";class Z extends c{constructor(e,t=0,n,i){super(Int32Array,e,t,n,i),this.elementType="i32"}slice(e,t){return this.sliceBuffer(Z,e,t)}static fromTypedArray(e,t){return new Z(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}Z.ElementType="i32";class W extends h{constructor(e,t=0,n,i){super(Int32Array,e,t,n,i),this.elementType="i32"}slice(e,t){return this.sliceBuffer(W,e,t)}static fromTypedArray(e,t){return new W(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}W.ElementType="i32"},28404:function(e,t,n){"use strict";function i(e){switch(e){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8}}n.d(t,{GJ:function(){return i}})},91912:function(e,t,n){"use strict";n.d(t,{$e:function(){return a},j1:function(){return l},mO:function(){return c},vt:function(){return s}});var i=n(89736),r=n(20551),o=n(79578);function s(e){return e?{ray:(0,o.vt)(e.ray),c0:e.c0,c1:e.c1}:{ray:(0,o.vt)(),c0:0,c1:Number.MAX_VALUE}}function a(e,t=s()){return(0,o.C)(e,t.ray),t.c0=0,t.c1=Number.MAX_VALUE,t}function l(e,t){return u(e,e.c0,t)}function c(e,t){return u(e,e.c1,t)}function u(e,t,n){return(0,r.g)(n,e.ray.origin,(0,r.h)(n,e.ray.direction,t))}new i.I((()=>s()))},69508:function(e,t,n){"use strict";n.d(t,{C:function(){return m},FB:function(){return i},ig:function(){return y},m7:function(){return v},ui:function(){return _},vt:function(){return g}});var i,r,o,s=n(89736),a=n(73364),l=n(20551),c=n(32501),u=n(33400),h=n(41546),d=n(91912),p=n(5596),f=n(50973);function g(e){return e?[(0,p.vt)(e[0]),(0,p.vt)(e[1]),(0,p.vt)(e[2]),(0,p.vt)(e[3]),(0,p.vt)(e[4]),(0,p.vt)(e[5])]:[(0,p.vt)(),(0,p.vt)(),(0,p.vt)(),(0,p.vt)(),(0,p.vt)(),(0,p.vt)()]}function m(e,t){for(let n=0;n<b;n++)(0,p.C)(e[n],t[n]);return e}function _(e,t,n,o=w){const s=(0,a.lw)(f.Rc.get(),t,e);(0,a.B8)(s,s);for(let e=0;e<T;++e){const t=(0,u.t)(f.Km.get(),x[e],s);(0,l.i)(o[e],t[0]/t[3],t[1]/t[3],t[2]/t[3])}!function(e,t){(0,p.Cr)(t[r.FAR_BOTTOM_LEFT],t[r.NEAR_BOTTOM_LEFT],t[r.NEAR_TOP_LEFT],e[i.LEFT]),(0,p.Cr)(t[r.NEAR_BOTTOM_RIGHT],t[r.FAR_BOTTOM_RIGHT],t[r.FAR_TOP_RIGHT],e[i.RIGHT]),(0,p.Cr)(t[r.FAR_BOTTOM_LEFT],t[r.FAR_BOTTOM_RIGHT],t[r.NEAR_BOTTOM_RIGHT],e[i.BOTTOM]),(0,p.Cr)(t[r.NEAR_TOP_LEFT],t[r.NEAR_TOP_RIGHT],t[r.FAR_TOP_RIGHT],e[i.TOP]),(0,p.Cr)(t[r.NEAR_BOTTOM_LEFT],t[r.NEAR_BOTTOM_RIGHT],t[r.NEAR_TOP_RIGHT],e[i.NEAR]),(0,p.Cr)(t[r.FAR_BOTTOM_RIGHT],t[r.FAR_BOTTOM_LEFT],t[r.FAR_TOP_LEFT],e[i.FAR])}(n,o)}function v(e,t){for(let n=0;n<b;n++){const i=e[n];if(i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]>=t[3])return!1}return!0}function y(e,t){for(let n=0;n<b;n++){const i=e[n];if(!(0,p.b6)(i,t))return!1}return!0}(o=i||(i={}))[o.LEFT=0]="LEFT",o[o.RIGHT=1]="RIGHT",o[o.BOTTOM=2]="BOTTOM",o[o.TOP=3]="TOP",o[o.NEAR=4]="NEAR",o[o.FAR=5]="FAR",function(e){e[e.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",e[e.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",e[e.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",e[e.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",e[e.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",e[e.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",e[e.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",e[e.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(r||(r={})),r.FAR_BOTTOM_RIGHT,r.NEAR_BOTTOM_RIGHT,r.NEAR_BOTTOM_LEFT,r.FAR_BOTTOM_LEFT,r.NEAR_BOTTOM_LEFT,r.NEAR_BOTTOM_RIGHT,r.NEAR_TOP_RIGHT,r.NEAR_TOP_LEFT,r.FAR_BOTTOM_RIGHT,r.FAR_BOTTOM_LEFT,r.FAR_TOP_LEFT,r.FAR_TOP_RIGHT,r.NEAR_BOTTOM_RIGHT,r.FAR_BOTTOM_RIGHT,r.FAR_TOP_RIGHT,r.NEAR_TOP_RIGHT,r.FAR_BOTTOM_LEFT,r.NEAR_BOTTOM_LEFT,r.NEAR_TOP_LEFT,r.FAR_TOP_LEFT,r.FAR_TOP_LEFT,r.NEAR_TOP_LEFT,r.NEAR_TOP_RIGHT,r.FAR_TOP_RIGHT;const b=6,T=8,x=[(0,h.fA)(-1,-1,-1,1),(0,h.fA)(1,-1,-1,1),(0,h.fA)(1,1,-1,1),(0,h.fA)(-1,1,-1,1),(0,h.fA)(-1,-1,1,1),(0,h.fA)(1,-1,1,1),(0,h.fA)(1,1,1,1),(0,h.fA)(-1,1,1,1)],w=(new s.I(d.vt),[(0,c.vt)(),(0,c.vt)(),(0,c.vt)(),(0,c.vt)(),(0,c.vt)(),(0,c.vt)(),(0,c.vt)(),(0,c.vt)()])},73313:function(e,t,n){"use strict";n.d(t,{C:function(){return c},Cr:function(){return h},H6:function(){return g},_I:function(){return p},dz:function(){return m},fA:function(){return u},kb:function(){return d},ld:function(){return _},sd:function(){return f},vt:function(){return l}});var i=n(15774),r=n(89736),o=n(20551),s=n(32501),a=n(50973);function l(e){return e?{origin:(0,s.o8)(e.origin),vector:(0,s.o8)(e.vector)}:{origin:(0,s.vt)(),vector:(0,s.vt)()}}function c(e,t=l()){return u(e.origin,e.vector,t)}function u(e,t,n=l()){return(0,o.c)(n.origin,e),(0,o.c)(n.vector,t),n}function h(e,t,n=l()){return(0,o.c)(n.origin,e),(0,o.d)(n.vector,t,e),n}function d(e,t){const n=(0,o.d)(a.rq.get(),t,e.origin),r=(0,o.f)(e.vector,n),s=(0,o.f)(e.vector,e.vector),l=(0,i.qE)(r/s,0,1),c=(0,o.d)(a.rq.get(),(0,o.h)(a.rq.get(),e.vector,l),n);return(0,o.f)(c,c)}function p(e,t,n){return g(e,t,0,1,n)}function f(e,t,n){return(0,o.g)(n,e.origin,(0,o.h)(n,e.vector,t))}function g(e,t,n,r,s){const{vector:l,origin:c}=e,u=(0,o.d)(a.rq.get(),t,c),h=(0,o.f)(l,u)/(0,o.k)(l);return(0,o.h)(s,l,(0,i.qE)(h,n,r)),(0,o.g)(s,s,e.origin)}function m(e,t){if(v(e,function(e,t){const n=b.get();return n.origin=e,n.vector=t,n}(t.origin,t.direction),!1,y)){const{tA:t,pB:n,distance2:i}=y;if(t>=0&&t<=1)return i;if(t<0)return(0,o.s)(e.origin,n);if(t>1)return(0,o.s)((0,o.g)(a.rq.get(),e.origin,e.vector),n)}return null}function _(e,t,n){return!!v(e,t,!0,y)&&((0,o.c)(n,y.pA),!0)}function v(e,t,n,r){const s=1e-6,l=e.origin,c=(0,o.g)(a.rq.get(),l,e.vector),u=t.origin,h=(0,o.g)(a.rq.get(),u,t.vector),d=a.rq.get(),p=a.rq.get();if(d[0]=l[0]-u[0],d[1]=l[1]-u[1],d[2]=l[2]-u[2],p[0]=h[0]-u[0],p[1]=h[1]-u[1],p[2]=h[2]-u[2],Math.abs(p[0])<s&&Math.abs(p[1])<s&&Math.abs(p[2])<s)return!1;const f=a.rq.get();if(f[0]=c[0]-l[0],f[1]=c[1]-l[1],f[2]=c[2]-l[2],Math.abs(f[0])<s&&Math.abs(f[1])<s&&Math.abs(f[2])<s)return!1;const g=d[0]*p[0]+d[1]*p[1]+d[2]*p[2],m=p[0]*f[0]+p[1]*f[1]+p[2]*f[2],_=d[0]*f[0]+d[1]*f[1]+d[2]*f[2],v=p[0]*p[0]+p[1]*p[1]+p[2]*p[2],y=(f[0]*f[0]+f[1]*f[1]+f[2]*f[2])*v-m*m;if(Math.abs(y)<s)return!1;let b=(g*m-_*v)/y,T=(g+m*b)/v;n&&(b=(0,i.qE)(b,0,1),T=(0,i.qE)(T,0,1));const x=a.rq.get(),w=a.rq.get();return x[0]=l[0]+b*f[0],x[1]=l[1]+b*f[1],x[2]=l[2]+b*f[2],w[0]=u[0]+T*p[0],w[1]=u[1]+T*p[1],w[2]=u[2]+T*p[2],r.tA=b,r.tB=T,r.pA=x,r.pB=w,r.distance2=(0,o.s)(x,w),!0}const y={tA:0,tB:0,pA:(0,s.vt)(),pB:(0,s.vt)(),distance2:0},b=new r.I((()=>l()))},61003:function(e,t,n){"use strict";n.d(t,{b:function(){return o}});var i=n(15774),r=n(37819);function o(e,t,n){const o=Array.isArray(e),u=o?e.length/t:e.byteLength/(4*t),h=o?e:new Uint32Array(e,0,u*t),d=n?.minReduction??0,p=n?.originalIndices||null,f=p?p.length:0,g=n?.componentOffsets||null;let m=0;if(g)for(let e=0;e<g.length-1;e++){const t=g[e+1]-g[e];t>m&&(m=t)}else m=u;const _=Math.floor(1.1*m)+1;(null==c||c.length<2*_)&&(c=new Uint32Array((0,i.cU)(2*_)));for(let e=0;e<2*_;e++)c[e]=0;let v=0;const y=!!g&&!!p,b=y?f:u;let T=(0,r.my)(u);const x=new Uint32Array(f),w=1.96;let S=0!==d?Math.ceil(4*w*w/(d*d)*d*(1-d)):b,E=1,A=g?g[1]:b;for(let e=0;e<b;e++){if(e===S){const t=1-v/e;if(t+w*Math.sqrt(t*(1-t)/e)<d)return null;S*=2}if(e===A){for(let e=0;e<2*_;e++)c[e]=0;if(p)for(let e=g[E-1];e<g[E];e++)x[e]=T[p[e]];A=g[++E]}const n=y?p[e]:e,i=n*t,r=l(h,i,t);let o=r%_,a=v;for(;0!==c[2*o+1];){if(c[2*o]===r){const e=c[2*o+1]-1;if(s(h,i,e*t,t)){a=T[e];break}}o++,o>=_&&(o-=_)}a===v&&(c[2*o]=r,c[2*o+1]=n+1,v++),T[n]=a}if(0!==d&&1-v/u<d)return null;if(y){for(let e=g[E-1];e<x.length;e++)x[e]=T[p[e]];T=(0,r.Dg)(x)}const M=o?new Array(v):new Uint32Array(v*t);v=0;for(let e=0;e<b;e++)T[e]===v&&(a(h,(y?p[e]:e)*t,M,v*t,t),v++);if(p&&!y){const e=new Uint32Array(f);for(let t=0;t<e.length;t++)e[t]=T[p[t]];T=(0,r.Dg)(e)}return{buffer:Array.isArray(M)?M:M.buffer,indices:T,uniqueCount:v}}function s(e,t,n,i){for(let r=0;r<i;r++)if(e[t+r]!==e[n+r])return!1;return!0}function a(e,t,n,i,r){for(let o=0;o<r;o++)n[i+o]=e[t+o]}function l(e,t,n){let i=0;for(let r=0;r<n;r++)i=e[t+r]+i|0,i=i+(i<<11)+(i>>>2)|0;return i>>>0}let c=null},67376:function(e,t,n){"use strict";n.d(t,{CK:function(){return d},E9:function(){return u},Hq:function(){return h},MW:function(){return p},TE:function(){return f},yJ:function(){return g}});var i=n(88022),r=n(40633),o=n(20551),s=n(45532),a=n(65907),l=n(20460);function c(){return r.A.getLogger("esri.geometry.Mesh")}function u(e){return!h(e)}function h(e){return null!=e.origin}function d(e){return h(e.vertexSpace)}function p(e,t){if(!h(e))return null;const[n,i,r]=e.origin;return new s.default({x:n,y:i,z:r,spatialReference:t})}function f(e,t){const{x:n,y:r,z:o,spatialReference:s}=e,u=[n,r,o??0];return void 0!==t?.geographic&&((0,i.io)(c(),"option: geographic",{replacement:"Use the `vertexSpace` option instead.",version:"4.29",warnOnce:!0}),t.vertexSpace&&c().warn("Deprecated geographic flag ignored since vertexSpace option is provided.")),"local"===(t?.vertexSpace??(h=t?.geographic,null==h?void 0:h?"local":"georeferenced")??function(e){return e.isGeographic||e.isWebMercator?"local":"georeferenced"}(s))?new l.A({origin:u}):new a.A({origin:u});var h}function g(e,t){return e.type===t.type&&(e.origin===t.origin||null!=e.origin&&null!=t.origin&&(0,o.p)(e.origin,t.origin))}},6527:function(e,t,n){"use strict";n.d(t,{S:function(){return l}});var i=n(15774),r=n(62938),o=n(20551),s=n(72485),a=n(5596);function l(e,t,n){const l=function(e,t,n,i){const s=(e=>!Array.isArray(e[0]))(t)?(e,n)=>t[3*e+n]:(e,n)=>t[e][n],l=i?(0,r.GA)(i)/(0,r.G9)(i):1;return(0,a.lU)(e,((e,t)=>(0,o.i)(e,s(t,0)*l,s(t,1)*l,s(t,2))),n)}(c,e,t,n)?(0,a.Qj)(c):[0,0,1];return Math.abs(l[2])>Math.cos((0,i.kU)(80))?s._.Z:Math.abs(l[1])>Math.abs(l[0])?s._.Y:s._.X}const c=(0,a.vt)()},67496:function(e,t,n){"use strict";n.d(t,{Fm:function(){return a},Q7:function(){return l}});var i=n(89736),r=n(20551),o=n(32501),s=n(73313);function a(e,t,n){const i=t[0]-e[0],r=t[1]-e[1],o=n[0]-e[0],s=n[1]-e[1];return.5*Math.abs(i*s-r*o)}function l(e,t,n){return(0,r.d)(c,t,e),(0,r.d)(u,n,e),.5*(0,r.l)((0,r.e)(c,c,u))}n(50973),new i.I(s.vt),new i.I((()=>{return e?{p0:(0,o.o8)(e.p0),p1:(0,o.o8)(e.p1),p2:(0,o.o8)(e.p2)}:{p0:(0,o.vt)(),p1:(0,o.vt)(),p2:(0,o.vt)()};var e}));const c=(0,o.vt)(),u=(0,o.vt)()},82588:function(e,t,n){"use strict";n.d(t,{Wq:function(){return i},lO:function(){return d},oR:function(){return p}});var i,r,o=n(59122),s=n(72485),a=n(38441),l=n(50240),c=n(37819),u=n(6527),h=n(61003);function d(e){const t=p(e.rings,e.hasZ,i.CCW_IS_HOLE,e.spatialReference),n=new Array;let r=0,s=0;for(const e of t.polygons){const i=e.count,a=e.index,u=(0,l.l5)(t.position,3*a,3*i),h=e.holeIndices.map((e=>e-a)),d=(0,c.Dg)((0,o.e)(u,h,3));n.push({position:u,faces:d}),r+=u.length,s+=d.length}const a=function(e,t,n){if(1===e.length)return e[0];const i=(0,l.jh)(t),r=new Array(n);let o=0,s=0,a=0;for(const t of e){for(let e=0;e<t.position.length;e++)i[o++]=t.position[e];for(const e of t.faces)r[s++]=e+a;a=o/3}return{position:i,faces:(0,c.Dg)(r)}}(n,r,s),u=Array.isArray(a.position)?(0,h.b)(a.position,3,{originalIndices:a.faces}):(0,h.b)(a.position.buffer,6,{originalIndices:a.faces});return a.position=(0,l.xm)(new Float64Array(u.buffer)),a.faces=u.indices,a}function p(e,t,n,r){const o=e.length,s=new Array(o),a=new Array(o),c=new Array(o);let u=0;for(let t=0;t<o;++t)u+=e[t].length;let h=0,d=0,p=0;const m=(0,l.jh)(3*u);let _=0;for(let l=o-1;l>=0;l--){const u=e[l],v=n===i.CCW_IS_HOLE&&g(u,t,r);if(v&&1!==o)s[h++]=u;else{let e=u.length;for(let t=0;t<h;++t)e+=s[t].length;const n={index:_,pathLengths:new Array(h+1),count:e,holeIndices:new Array(h)};n.pathLengths[0]=u.length,u.length>0&&(c[p++]={index:_,count:u.length}),_=v?f(u,u.length-1,-1,m,_,u.length,t):f(u,0,1,m,_,u.length,t);for(let e=0;e<h;++e){const i=s[e];n.holeIndices[e]=_,n.pathLengths[e+1]=i.length,i.length>0&&(c[p++]={index:_,count:i.length}),_=f(i,0,1,m,_,i.length,t)}h=0,n.count>0&&(a[d++]=n)}}for(let e=0;e<h;++e){const n=s[e];n.length>0&&(c[p++]={index:_,count:n.length}),_=f(n,0,1,m,_,n.length,t)}return a.length=d,c.length=p,{position:m,polygons:a,outlines:c}}function f(e,t,n,i,r,o,s){r*=3;for(let a=0;a<o;++a){const o=e[t];i[r++]=o[0],i[r++]=o[1],i[r++]=s&&o[2]?o[2]:0,t+=n}return r/3}function g(e,t,n){if(!t)return!(0,a.$3)(e);const i=e.length-1;switch((0,u.S)(e,i,n)){case s._.X:return!(0,a.$3)(e,s._.Y,s._.Z);case s._.Y:return!(0,a.$3)(e,s._.X,s._.Z);case s._.Z:return!(0,a.$3)(e,s._.X,s._.Y)}}(r=i||(i={}))[r.NONE=0]="NONE",r[r.CCW_IS_HOLE=1]="CCW_IS_HOLE"},42413:function(e,t,n){"use strict";n.d(t,{CI:function(){return o},fk:function(){return s}}),n(58941);var i=n(15774),r=n(57652);function o(e,t){return e===t||null!=e&&null!=t&&(0,r.aI)(e.spatialReference,t.spatialReference)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.m===t.m}function s(e,t,n){return e===t||null!=e&&null!=t&&(0,r.aI)(e.spatialReference,t.spatialReference)&&(0,i.Sp)(e.x,t.x,n)&&(0,i.Sp)(e.y,t.y,n)&&(0,i.Sp)(e.z??0,t.z??0,n)&&(0,i.Sp)(e.m??0,t.m??0,n)}},5915:function(e,t,n){"use strict";function i(e){return"point"===e.type}n.d(t,{v:function(){return i}})},45328:function(e,t,n){"use strict";n.d(t,{EL:function(){return m},RS:function(){return _},gr:function(){return c},wP:function(){return h},wZ:function(){return d}}),n(50917);var i=n(59469),r=(n(58941),n(21609)),o=n(24540),s=n(74697),a=n(46460),l=n(57165);function c(e){return"declaredClass"in e}function u(e){return"declaredClass"in e}function h(e,t){return e?"declaredClass"in e?e:new i.default({layer:t,sourceLayer:t,visible:e.visible,symbol:(0,r.o8)(e.symbol),attributes:(0,r.o8)(e.attributes),geometry:d(e.geometry)}):null}function d(e){return null==e?null:c(e)?e:(0,s.rS)(function(e){const{wkid:t,wkt:n,wkt2:i,latestWkid:r}=e.spatialReference,o={wkid:t,wkt:n,wkt2:i,latestWkid:r};switch(e.type){case"point":{const{x:t,y:n,z:i,m:r}=e;return{x:t,y:n,z:i,m:r,spatialReference:o}}case"polygon":{const{rings:t,hasZ:n,hasM:i}=e;return{rings:p(t),hasZ:n,hasM:i,spatialReference:o}}case"polyline":{const{paths:t,hasZ:n,hasM:i}=e;return{paths:p(t),hasZ:n,hasM:i,spatialReference:o}}case"extent":{const{xmin:t,xmax:n,ymin:i,ymax:r,zmin:s,zmax:a,mmin:l,mmax:c,hasZ:u,hasM:h}=e;return{xmin:t,xmax:n,ymin:i,ymax:r,zmin:s,zmax:a,mmin:l,mmax:c,hasZ:u,hasM:h,spatialReference:o}}case"multipoint":{const{points:t,hasZ:n,hasM:i}=e;return{points:g(t)?f(t):t,hasZ:n,hasM:i,spatialReference:o}}default:return}}(e))}function p(e){return function(e){for(const t of e)if(0!==t.length)return g(t);return!1}(e)?e.map((e=>f(e))):e}function f(e){return e.map((e=>Array.from(e)))}function g(e){return e.length>0&&((0,o.vZ)(e[0])||(0,o.aI)(e[0]))}function m(e,t){if(!e)return null;let n;if(u(e)){if(null==t)return e.clone();if(u(t))return t.copy(e)}return null!=t?(n=t,n.x=e.x,n.y=e.y,n.spatialReference=e.spatialReference,e.hasZ?(n.z=e.z,n.hasZ=e.hasZ):(n.z=void 0,n.hasZ=!1),e.hasM?(n.m=e.m,n.hasM=!0):(n.m=void 0,n.hasM=!1)):(n=(0,a.T)(e.x,e.y,e.z,e.spatialReference),e.hasM&&(n.m=e.m,n.hasM=!0)),n}function _(e){const{wkid:t,wkt:n,wkt2:i,latestWkid:r}=e,o={wkid:t,wkt:n,wkt2:i,latestWkid:r};return l.A.fromJSON(o)}},14921:function(e,t,n){"use strict";var i;n.d(t,{$:function(){return i}}),function(e){e[e.EnableFastUpdates=0]="EnableFastUpdates",e[e.DisableFastUpdates=1]="DisableFastUpdates",e[e.UpdateFastLocalOrigin=2]="UpdateFastLocalOrigin"}(i||(i={}))},47558:function(e,t,n){"use strict";n.d(t,{T:function(){return s}});var i=n(60539),r=n(85445),o=n(55213);class s{constructor(){this._tasks=new Array,this._runningTasks=(0,r.v)(0)}get length(){return this._tasks.length}get running(){return this._runningTasks.value>0}destroy(){this.cancelAll()}runTask(e){if(0===this.length)return o.G;for(;!e.done&&this._process(e);)e.madeProgress()}push(e,t,n){return++this._runningTasks.value,new Promise(((i,r)=>this._tasks.push(new a(i,r,e,t,n)))).finally((()=>--this._runningTasks.value))}unshift(e,t,n){return++this._runningTasks.value,new Promise(((i,r)=>this._tasks.unshift(new a(i,r,e,t,n)))).finally((()=>--this._runningTasks.value))}_process(e){if(0===this._tasks.length)return!1;const t=this._tasks.shift();try{const n=(0,i.G4)(t.signal);if(n&&!t.abortCallback)t.reject((0,i.NK)());else{const r=n?t.abortCallback?.((0,i.NK)()):t.callback(e);(0,i.$X)(r)?r.then(t.resolve,t.reject):t.resolve(r)}}catch(e){t.reject(e)}return!0}cancelAll(){const e=(0,i.NK)();for(const t of this._tasks)if(t.abortCallback){const n=t.abortCallback(e);t.resolve(n)}else t.reject(e);this._tasks.length=0}}class a{constructor(e,t,n,i=void 0,r=void 0){this.resolve=e,this.reject=t,this.callback=n,this.signal=i,this.abortCallback=r}}},92781:function(e,t,n){"use strict";n.d(t,{R:function(){return o},t:function(){return s}});var i=n(77528);const r={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(e,t,n)=>{"-"===t.charAt(0)?e.style.setProperty(t,n):e.style[t]=n}};let o=e=>(0,i.X$)(r,e),s={create:(e,t)=>(t=o(t),(0,i.dj)(e,document.createElement("div"),void 0,t),(0,i.Av)(e,t)),append:(e,t,n)=>(n=o(n),(0,i.dj)(t,e,void 0,n),(0,i.Av)(t,n)),insertBefore:(e,t,n)=>(n=o(n),(0,i.dj)(t,e.parentNode,e,n),(0,i.Av)(t,n)),merge:(e,t,n)=>(n=o(n),t.domNode=e,(0,i.OM)(e,t,n),(0,i.Av)(t,n)),replace:(e,t,n)=>(n=o(n),(0,i.dj)(t,e.parentNode,e,n),e.parentNode.removeChild(e),(0,i.Av)(t,n))}},77528:function(e,t,n){"use strict";n.d(t,{Av:function(){return O},OM:function(){return w},X$:function(){return l},dj:function(){return S}});var i=n(10362);const r="http://www.w3.org/",o=`${r}2000/svg`,s=`${r}1999/xlink`;let a=[],l=(e,t)=>{let n={};return Object.keys(e).forEach((t=>{n[t]=e[t]})),t&&Object.keys(t).forEach((e=>{n[e]=t[e]})),n},c=(e,t)=>e.vnodeSelector===t.vnodeSelector&&(e.properties&&t.properties?e.properties.key===t.properties.key&&e.properties.bind===t.properties.bind:!e.properties&&!t.properties),u=e=>{if("string"!=typeof e)throw new Error("Style values must be strings")},h=(e,t,n)=>{if(""!==t.vnodeSelector)for(let i=n;i<e.length;i++)if(c(e[i],t))return i;return-1},d=(e,t,n,i)=>{let r=e[t];if(""===r.vnodeSelector)return;let o=r.properties;if(!(o?void 0===o.key?o.bind:o.key:void 0))for(let o=0;o<e.length;o++)if(o!==t){let t=e[o];if(c(t,r))throw new Error(`${n.vnodeSelector} had a ${r.vnodeSelector} child ${"added"===i?i:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}},p=e=>{if(e.properties){let t=e.properties.enterAnimation;t&&t(e.domNode,e.properties)}},f=[],g=!1,m=e=>{(e.children||[]).forEach(m),e.properties&&e.properties.afterRemoved&&e.properties.afterRemoved.apply(e.properties.bind||e.properties,[e.domNode])},_=()=>{g=!1,f.forEach(m),f.length=0},v=e=>{f.push(e),g||(g=!0,"undefined"!=typeof window&&"requestIdleCallback"in window?window.requestIdleCallback(_,{timeout:16}):setTimeout(_,16))},y=e=>{let t=e.domNode;if(e.properties){let n=e.properties.exitAnimation;if(n){t.style.pointerEvents="none";let i=()=>{t.parentNode&&(t.parentNode.removeChild(t),v(e))};return void n(t,i,e.properties)}}t.parentNode&&(t.parentNode.removeChild(t),v(e))},b=(e,t,n)=>{if(!t)return;let r=n.eventHandlerInterceptor,a=Object.keys(t),l=a.length;for(let c=0;c<l;c++){let l=a[c],h=t[l];if("className"===l)throw new Error('Property "className" is not supported, use "class".');if("class"===l)E(e,h,!0);else if("classes"===l){let t=Object.keys(h),n=t.length;for(let i=0;i<n;i++){let n=t[i];h[n]&&e.classList.add(n)}}else if("styles"===l){let t=Object.keys(h),i=t.length;for(let r=0;r<i;r++){let i=t[r],o=h[i];o&&(u(o),n.styleApplyer(e,i,o))}}else if("key"!==l&&null!=h){let a=typeof h;"function"===a?(0===l.lastIndexOf("on",0)&&(r&&(h=r(l,h,e,t)),"oninput"===l&&function(){let e=h;h=function(t){e.apply(this,[t]),t.target["oninput-value"]=t.target.value}}()),e[l]=h):n.namespace===o?"href"===l?e.setAttributeNS(s,l,h):e.setAttribute(l,h):"string"===a&&"value"!==l?"innerHTML"===l?e[l]=i.W5.sanitize(h):T(e)&&l in e?e[l]=h:e.setAttribute(l,h):e[l]=h}}};function T(e){if(!(e instanceof Element&&e.tagName.includes("-")))return!1;const t=window.customElements.get(e.tagName.toLowerCase());return!!t&&e instanceof t}let x,w=(e,t,n)=>{((e,t,n)=>{if(t)for(let i of t)S(i,e,void 0,n)})(e,t.children,n),t.text&&(e.textContent=t.text),b(e,t.properties,n),t.properties&&t.properties.afterCreate&&t.properties.afterCreate.apply(t.properties.bind||t.properties,[e,n,t.vnodeSelector,t.properties,t.children])},S=(e,t,n,i)=>{let r,s=0,a=e.vnodeSelector,c=t.ownerDocument;if(""===a)r=e.domNode=c.createTextNode(e.text),void 0!==n?t.insertBefore(r,n):t.appendChild(r);else{for(let u=0;u<=a.length;++u){let h=a.charAt(u);if(u===a.length||"."===h||"#"===h){let h=a.charAt(s-1),d=a.slice(s,u);"."===h?r.classList.add(d):"#"===h?r.id=d:("svg"===d&&(i=l(i,{namespace:o})),void 0!==i.namespace?r=e.domNode=c.createElementNS(i.namespace,d):(r=e.domNode=e.domNode||c.createElement(d),"input"===d&&e.properties&&void 0!==e.properties.type&&r.setAttribute("type",e.properties.type)),void 0!==n?t.insertBefore(r,n):r.parentNode!==t&&t.appendChild(r)),s=u+1}}w(r,e,i)}},E=(e,t,n)=>{t&&t.split(" ").forEach((t=>{t&&e.classList.toggle(t,n)}))},A=(e,t,n,r)=>{if(!n)return;let a=!1,l=Object.keys(n),c=l.length;for(let h=0;h<c;h++){let c=l[h],d=n[c],p=t[c];if("class"===c)p!==d&&(E(e,p,!1),E(e,d,!0));else if("classes"===c){let t=e.classList,n=Object.keys(d),i=n.length;for(let e=0;e<i;e++){let i=n[e],r=!!d[i];r!==!!p[i]&&(a=!0,r?t.add(i):t.remove(i))}}else if("styles"===c){let t=Object.keys(d),n=t.length;for(let i=0;i<n;i++){let n=t[i],o=d[n];o!==p[n]&&(a=!0,o?(u(o),r.styleApplyer(e,n,o)):r.styleApplyer(e,n,""))}}else if(d||"string"!=typeof p||(d=""),"value"!==c||T(e)){if(d!==p){let t=typeof d;"function"===t&&r.eventHandlerInterceptor||(r.namespace===o?"href"===c?e.setAttributeNS(s,c,d):e.setAttribute(c,d):"string"===t?"innerHTML"===c?e[c]=i.W5.sanitize(d):"role"===c&&""===d?e.removeAttribute(c):T(e)&&c in e?e[c]=d:e.setAttribute(c,d):e[c]!==d&&(e[c]=d),a=!0)}}else{let t=e[c];t!==d&&(e["oninput-value"]?t===e["oninput-value"]:d!==p)&&(e[c]=d,e["oninput-value"]=void 0),d!==p&&(a=!0)}}return a},M=(e,t,n,i,r)=>{if(n===i)return!1;i=i||a;let o,s=(n=n||a).length,l=i.length,u=0,f=0,g=!1;for(;f<l;){let a=u<s?n[u]:void 0,l=i[f];if(void 0!==a&&c(a,l))g=x(a,l,r)||g,u++;else{let a=h(n,l,u+1);if(a>=0){for(o=u;o<a;o++)y(n[o]),d(n,o,e,"removed");g=x(n[a],l,r)||g,u=a+1}else S(l,t,u<s?n[u].domNode:void 0,r),p(l),d(i,f,e,"added")}f++}if(s>u)for(o=u;o<s;o++)y(n[o]),d(n,o,e,"removed");return g};x=(e,t,n)=>{let i=e.domNode,r=!1;if(e===t)return!1;let s=!1;if(""===t.vnodeSelector){if(t.text!==e.text){let e=i.ownerDocument.createTextNode(t.text);return i.parentNode.replaceChild(e,i),t.domNode=e,r=!0,r}t.domNode=i}else 0===t.vnodeSelector.lastIndexOf("svg",0)&&(n=l(n,{namespace:o})),e.text!==t.text&&(s=!0,void 0===t.text?i.removeChild(i.firstChild):i.textContent=t.text),t.domNode=i,s=M(t,i,e.children,t.children,n)||s,s=A(i,e.properties,t.properties,n)||s,t.properties&&t.properties.afterUpdate&&t.properties.afterUpdate.apply(t.properties.bind||t.properties,[i,n,t.vnodeSelector,t.properties,t.children]);return s&&t.properties&&t.properties.updateAnimation&&t.properties.updateAnimation(i,t.properties,e.properties),r};let O=(e,t)=>({getLastRender:()=>e,update:n=>{if(e.vnodeSelector!==n.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let i=e;e=n,x(i,n,t)},domNode:e.domNode})},81401:function(e,t,n){"use strict";n.d(t,{F:function(){return a}});var i=n(92781);let r;r=Array.prototype.find?(e,t)=>e.find(t):(e,t)=>e.filter(t)[0];let o=(e,t)=>{let n=e;return t.forEach((e=>{n=n&&n.children?r(n.children,(t=>t.domNode===e)):void 0})),n},s=(e,t,n)=>{let i=function(i){n("domEvent",i);let r=t(),s=((e,t)=>{let n=[];for(;e&&e!==t;)n.push(e),e=e.parentNode;return n})(i.currentTarget,r.domNode);s.reverse();let a,l=o(r.getLastRender(),s);return e.scheduleRender(),l&&(a=l.properties[`on${i.type}`].apply(l.properties.bind||this,arguments)),n("domEventProcessed",i),a};return(e,t,n,r)=>i},a=e=>{let t,n,r=(0,i.R)(e),o=r.performanceLogger,a=!0,l=!1,c=[],u=[],h=(e,n,i)=>{let a;r.eventHandlerInterceptor=s(t,(()=>a),o),a=e(n,i(),r),c.push(a),u.push(i)},d=()=>{if(n=void 0,a){a=!1,o("renderStart",void 0);for(let e=0;e<c.length;e++){let t=u[e]();o("rendered",void 0),c[e].update(t),o("patched",void 0)}o("renderDone",void 0),a=!0}};return t={renderNow:d,scheduleRender:()=>{n||l||(n=requestAnimationFrame(d))},stop:()=>{n&&(cancelAnimationFrame(n),n=void 0),l=!0},resume:()=>{l=!1,a=!0,t.scheduleRender()},append:(e,t)=>{h(i.t.append,e,t)},insertBefore:(e,t)=>{h(i.t.insertBefore,e,t)},merge:(e,t)=>{h(i.t.merge,e,t)},replace:(e,t)=>{h(i.t.replace,e,t)},detach:e=>{for(let t=0;t<u.length;t++)if(u[t]===e)return u.splice(t,1),c.splice(t,1)[0];throw new Error("renderFunction was not found")}},t}},82465:function(e,t,n){"use strict";n.d(t,{n:function(){return r}});var i=n(90683);function r(e){return o[function(e){return"json"===e.type?"application/json":"blob"===e.type?e.blob.type:function(e){const t=(0,i.Zo)(e);return l[t]||s}(e.url)}(e)]||a}const o={},s="text/plain",a=o[s],l={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip","bin.gz":"application/octet-stream"};for(const e in l)o[l[e]]=e},82418:function(e,t,n){"use strict";function i(e,t){return t?"xoffset"in t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):"yoffset"in t&&t.yoffset?Math.max(e,Math.abs(t.yoffset||0)):e:e}function r(e,t){return"number"==typeof e?e:e?.stops?.length?function(e){let t=0,n=0;for(let i=0;i<e.length;i++){const r=e[i].size;"number"==typeof r&&(t+=r,n++)}return t/n}(e.stops):t}function o(e,t){if(!t)return e;const n=t.filter((e=>"size"===e.type)).map((t=>{const{maxSize:n,minSize:i}=t;return(r(n,e)+r(i,e))/2}));let i=0;const o=n.length;if(0===o)return e;for(let e=0;e<o;e++)i+=n[e];const s=Math.floor(i/o);return Math.max(s,e)}function s(e){const t=e?.renderer,n=e?.pointerType,r="touch"===n?9:6;if(!t)return r;const s="visualVariables"in t?o(r,t.visualVariables):r;if("simple"===t.type)return i(s,t.symbol);if("unique-value"===t.type){let e=s;return t.uniqueValueInfos?.forEach((t=>{e=i(e,t.symbol)})),e}if("class-breaks"===t.type){let e=s;return t.classBreakInfos.forEach((t=>{e=i(e,t.symbol)})),e}return"dot-density"===t.type||t.type,s}n.d(t,{o:function(){return s}})},76722:function(e,t,n){"use strict";n.d(t,{c:function(){return o}});var i=n(62938),r=n(51432);function o(e){const t="metric";if(null==e)return t;const n=e.map,o=(n&&"portalItem"in n?n.portalItem?.portal:null)??r.A.getDefault();switch(o.user?.units??o.units){case t:return t;case"english":return"imperial"}return(0,i.jM)(e.spatialReference)??t}},9030:function(e,t,n){"use strict";n.d(t,{D:function(){return r}});var i=n(93040);async function r(e,t){const{data:n}=await(0,i.A)(e,{responseType:"image",...t});return n}},93839:function(e,t,n){"use strict";n.d(t,{fJ:function(){return o},g4:function(){return r},hY:function(){return s}});const i="calcite-mode-";function r(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-mode-name").replaceAll(/\s|'|"/g,"").startsWith("dark")}function o(){return`${i}${r()?"dark":"light"}`}function s(e){a(e),e.classList.add(o())}function a(e){Array.from(e.classList).forEach((t=>{t.startsWith(i)&&e.classList.remove(t)}))}},38821:function(e,t,n){"use strict";n.d(t,{D:function(){return o},K:function(){return r}});var i=n(33389);const r={color:[128,128,128,1],outlinecolor:[0,0,0,1],backgroundcolor:[128,128,128,1],borderlinecolor:[0,0,0,1],tintcolor:[255,255,255,1]},o={CIMVectorMarker:{scalesymbolsproportionally:!1,respectframe:!0,anchorpointunits:"Relative",offsetx:0,offsety:0,rotateclockwise:!1,rotation:0,size:10,enable:!0,colorlocked:!1},CIMPictureMarker:{scalex:1,texturefilter:"Draft",anchorpointunits:"Relative",offsetx:0,offsety:0,rotateclockwise:!1,rotation:0,size:10,enable:!0,colorlocked:!1},CIMTextSymbol:{angle:0,anglex:0,angley:0,halosize:1,height:10,horizontalalignment:"Left",kerning:!0,letterspacing:0,letterwidth:100,ligatures:!0,linegap:0,offsetx:0,offsety:0,strikethrough:!1,textcase:"Normal",textstring:"",underline:!1,verticalalignment:"Bottom",enable:!0,colorlocked:!1},CIMSolidStroke:{capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMPictureStroke:{texturefilter:"Draft",capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMGradientStroke:{capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMSolidFill:{enable:!0,colorlocked:!1},CIMPictureFill:{offsetx:0,offsety:0,rotation:0,scalex:1,height:10,texturefilter:"Draft",enable:!0,colorlocked:!1},CIMHatchFill:{offsetx:0,offsety:0,rotation:0,separation:4,enable:!0,colorlocked:!1},CIMGeometricEffectAddControlPoints:{angletolerance:120},CIMGeometricEffectArrow:{arrowtype:"OpenEnded",width:5},CIMGeometricEffectBuffer:{size:1},CIMGeometricEffectCut:{begincut:1,endcut:1,middlecut:0,invert:!1},CIMGeometricEffectDashes:{customendingoffset:0,linedashending:"NoConstraint",offsetalongline:0},CIMGeometricEffectDonut:{method:"Mitered",option:"Accurate",width:2},CIMGeometricEffectJog:{angle:225,length:20,position:50},CIMGeometricEffectControlMeasureLine:{rule:"FullGeometry"},CIMGeometricEffectMove:{offsetx:1,offsety:-1},CIMGeometricEffectOffset:{method:"Square",offset:1,option:"Fast"},CIMGeometricEffectRotate:{angle:15},CIMGeometricEffectScale:{xscalefactor:1.15,yscalefactor:1.15},CIMGeometricEffectWave:{amplitude:2,period:3,seed:1,waveform:"Sinus"},CIMMarkerPlacementAlongLine:{customendingoffset:0,endings:"WithHalfGap",offsetalongline:0,placeperpart:!0,angletoline:!0,offset:0},CIMMarkerPlacementAtExtremities:{extremityplacement:"Both",offsetalongline:0,angletoline:!0,offset:0},CIMMarkerPlacementAtRatioPositions:{beginposition:0,endposition:0,flipfirst:!0,angletoline:!0,offset:0},CIMMarkerPlacementInsidePolygon:{gridangle:0,gridtype:"Fixed",offsetx:0,offsety:0,randomness:100,seed:0,shiftoddrows:!1,stepx:16,stepy:16,clipping:"ClipAtBoundary"},CIMMarkerPlacementOnLine:{relativeto:"LineMiddle",startpointoffset:0,angletoline:!0,offset:0},CIMMarkerPlacementOnVertices:{placeperpart:!0,placeoncontrolpoints:!0,placeonendpoints:!0,placeonregularvertices:!0,angletoline:!0,offset:0},CIMMarkerPlacementPolygonCenter:{method:"OnPolygon",offsetx:0,offsety:0,clipatboundary:!1},CIMAnimatedSymbolProperties:{playanimation:!1,reverseanimation:!1,randomizestarttime:!1,randomizestartseed:0,starttimeoffset:0,duration:3,endingduration:3,useendingduration:!1,repeattype:i.fu.Loop,repeatdelay:0,easing:i.Hz.Linear},CIMSymbolAnimationSize:{tosize:10},CIMSymbolAnimationScale:{scalefactor:1},CIMSymbolAnimationColor:{tocolor:[255,255,255,1]},CIMSymbolAnimationTransparency:{totransparency:0},CIMSymbolAnimationRotation:{torotation:0},CIMSymbolAnimationOffset:{offsetx:0,offsety:0}}},33389:function(e,t,n){"use strict";var i,r,o,s,a,l,c,u,h,d,p,f,g,m,_,v,y,b,T,x,w,S,E,A,M,O,R,C,I,P,D,L,N,F,z,H,V,U,k,B,G,$,j,Z,W,q,Y,X,Q,K,J,ee,te,ne,ie,re,oe,se,ae,le,ce,ue;n.d(t,{$2:function(){return a},C1:function(){return o},Hz:function(){return f},JO:function(){return r},M1:function(){return E},O$:function(){return se},Q1:function(){return Y},TZ:function(){return y},WE:function(){return I},Y:function(){return c},YI:function(){return Q},bj:function(){return u},e_:function(){return q},f0:function(){return oe},fu:function(){return p},g7:function(){return h},ip:function(){return X},mU:function(){return P},oF:function(){return w},uQ:function(){return S},uT:function(){return V},vG:function(){return le},wd:function(){return G},xR:function(){return i},xn:function(){return b},xw:function(){return O},yS:function(){return U}}),function(e){e[e.BUTT=0]="BUTT",e[e.ROUND=1]="ROUND",e[e.SQUARE=2]="SQUARE",e[e.UNKNOWN=4]="UNKNOWN"}(i||(i={})),function(e){e[e.BEVEL=0]="BEVEL",e[e.ROUND=1]="ROUND",e[e.MITER=2]="MITER",e[e.UNKNOWN=4]="UNKNOWN"}(r||(r={})),function(e){e[e.SCREEN=0]="SCREEN",e[e.MAP=1]="MAP"}(o||(o={})),function(e){e[e.Tint=0]="Tint",e[e.Ignore=1]="Ignore",e[e.Multiply=99]="Multiply"}(s||(s={})),function(e){e.Both="Both",e.JustBegin="JustBegin",e.JustEnd="JustEnd",e.None="None"}(a||(a={})),function(e){e[e.Mosaic=0]="Mosaic",e[e.Centered=1]="Centered"}(l||(l={})),function(e){e[e.Normal=0]="Normal",e[e.Superscript=1]="Superscript",e[e.Subscript=2]="Subscript"}(c||(c={})),function(e){e[e.MSSymbol=0]="MSSymbol",e[e.Unicode=1]="Unicode"}(u||(u={})),function(e){e[e.Unspecified=0]="Unspecified",e[e.TrueType=1]="TrueType",e[e.PSOpenType=2]="PSOpenType",e[e.TTOpenType=3]="TTOpenType",e[e.Type1=4]="Type1"}(h||(h={})),function(e){e[e.Display=0]="Display",e[e.Map=1]="Map"}(d||(d={})),function(e){e.None="None",e.Loop="Loop",e.Oscillate="Oscillate"}(p||(p={})),function(e){e.Linear="Linear",e.EaseIn="EaseIn",e.EaseOut="EaseOut",e.EaseInOut="EaseInOut"}(f||(f={})),function(e){e[e.Z=0]="Z",e[e.X=1]="X",e[e.Y=2]="Y"}(g||(g={})),function(e){e[e.XYZ=0]="XYZ",e[e.ZXY=1]="ZXY",e[e.YXZ=2]="YXZ"}(m||(m={})),function(e){e[e.Rectangle=0]="Rectangle",e[e.RoundedRectangle=1]="RoundedRectangle",e[e.Oval=2]="Oval"}(_||(_={})),function(e){e[e.None=0]="None",e[e.Alpha=1]="Alpha",e[e.Screen=2]="Screen",e[e.Multiply=3]="Multiply",e[e.Add=4]="Add"}(v||(v={})),function(e){e[e.TTB=0]="TTB",e[e.RTL=1]="RTL",e[e.BTT=2]="BTT"}(y||(y={})),function(e){e[e.None=0]="None",e[e.SignPost=1]="SignPost",e[e.FaceNearPlane=2]="FaceNearPlane"}(b||(b={})),function(e){e[e.Float=0]="Float",e[e.String=1]="String",e[e.Boolean=2]="Boolean"}(T||(T={})),function(e){e[e.Intersect=0]="Intersect",e[e.Subtract=1]="Subtract"}(x||(x={})),function(e){e.OpenEnded="OpenEnded",e.Block="Block",e.Crossed="Crossed"}(w||(w={})),function(e){e.FullGeometry="FullGeometry",e.PerpendicularFromFirstSegment="PerpendicularFromFirstSegment",e.ReversedFirstSegment="ReversedFirstSegment",e.PerpendicularToSecondSegment="PerpendicularToSecondSegment",e.SecondSegmentWithTicks="SecondSegmentWithTicks",e.DoublePerpendicular="DoublePerpendicular",e.OppositeToFirstSegment="OppositeToFirstSegment",e.TriplePerpendicular="TriplePerpendicular",e.HalfCircleFirstSegment="HalfCircleFirstSegment",e.HalfCircleSecondSegment="HalfCircleSecondSegment",e.HalfCircleExtended="HalfCircleExtended",e.OpenCircle="OpenCircle",e.CoverageEdgesWithTicks="CoverageEdgesWithTicks",e.GapExtentWithDoubleTicks="GapExtentWithDoubleTicks",e.GapExtentMidline="GapExtentMidline",e.Chevron="Chevron",e.PerpendicularWithArc="PerpendicularWithArc",e.ClosedHalfCircle="ClosedHalfCircle",e.TripleParallelExtended="TripleParallelExtended",e.ParallelWithTicks="ParallelWithTicks",e.Parallel="Parallel",e.PerpendicularToFirstSegment="PerpendicularToFirstSegment",e.ParallelOffset="ParallelOffset",e.OffsetOpposite="OffsetOpposite",e.OffsetSame="OffsetSame",e.CircleWithArc="CircleWithArc",e.DoubleJog="DoubleJog",e.PerpendicularOffset="PerpendicularOffset",e.LineExcludingLastSegment="LineExcludingLastSegment",e.MultivertexArrow="MultivertexArrow",e.CrossedArrow="CrossedArrow",e.ChevronArrow="ChevronArrow",e.ChevronArrowOffset="ChevronArrowOffset",e.PartialFirstSegment="PartialFirstSegment",e.Arch="Arch",e.CurvedParallelTicks="CurvedParallelTicks",e.Arc90Degrees="Arc90Degrees",e.TipWithPerpendicularAndTicks="TipWithPerpendicularAndTicks",e.ConcentricCircles="ConcentricCircles",e.DoubleJogArrow="DoubleJogArrow",e.LinkedChevrons="LinkedChevrons",e.SegmentThenHalfCircle="SegmentThenHalfCircle",e.LineWithStraightTicks="LineWithStraightTicks",e.DoubleCurve="DoubleCurve",e.ParallelWithTicksByWidth="ParallelWithTicksByWidth",e.EnclosingRoundedRectangle="EnclosingRoundedRectangle"}(S||(S={})),function(e){e.Mitered="Mitered",e.Bevelled="Bevelled",e.Rounded="Rounded",e.Square="Square",e.TrueBuffer="TrueBuffer"}(E||(E={})),function(e){e.ClosePath="ClosePath",e.ConvexHull="ConvexHull",e.RectangularBox="RectangularBox"}(A||(A={})),function(e){e.BeginningOfLine="BeginningOfLine",e.EndOfLine="EndOfLine"}(M||(M={})),function(e){e.Mitered="Mitered",e.Bevelled="Bevelled",e.Rounded="Rounded",e.Square="Square"}(O||(O={})),function(e){e.Fast="Fast",e.Accurate="Accurate"}(R||(R={})),function(e){e.BeginningOfLine="BeginningOfLine",e.EndOfLine="EndOfLine"}(C||(C={})),function(e){e.Sinus="Sinus",e.Square="Square",e.Triangle="Triangle",e.Random="Random"}(I||(I={})),function(e){e[e.None=0]="None",e[e.Default=1]="Default",e[e.Force=2]="Force"}(P||(P={})),function(e){e[e.Buffered=0]="Buffered",e[e.Left=1]="Left",e[e.Right=2]="Right",e[e.AlongLine=3]="AlongLine"}(D||(D={})),function(e){e[e.Linear=0]="Linear",e[e.Rectangular=1]="Rectangular",e[e.Circular=2]="Circular",e[e.Buffered=3]="Buffered"}(L||(L={})),function(e){e[e.Discrete=0]="Discrete",e[e.Continuous=1]="Continuous"}(N||(N={})),function(e){e[e.AcrossLine=0]="AcrossLine",e[e.AloneLine=1]="AloneLine"}(F||(F={})),function(e){e[e.Left=0]="Left",e[e.Right=1]="Right",e[e.Center=2]="Center",e[e.Justify=3]="Justify"}(z||(z={})),function(e){e[e.Base=0]="Base",e[e.MidPoint=1]="MidPoint",e[e.ThreePoint=2]="ThreePoint",e[e.FourPoint=3]="FourPoint",e[e.Underline=4]="Underline",e[e.CircularCW=5]="CircularCW",e[e.CircularCCW=6]="CircularCCW"}(H||(H={})),function(e){e.Butt="Butt",e.Round="Round",e.Square="Square"}(V||(V={})),function(e){e.NoConstraint="NoConstraint",e.HalfPattern="HalfPattern",e.HalfGap="HalfGap",e.FullPattern="FullPattern",e.FullGap="FullGap",e.Custom="Custom"}(U||(U={})),function(e){e[e.None=-1]="None",e[e.Custom=0]="Custom",e[e.Circle=1]="Circle",e[e.OpenArrow=2]="OpenArrow",e[e.ClosedArrow=3]="ClosedArrow",e[e.Diamond=4]="Diamond"}(k||(k={})),function(e){e[e.ExtraLeading=0]="ExtraLeading",e[e.Multiple=1]="Multiple",e[e.Exact=2]="Exact"}(B||(B={})),function(e){e.Bevel="Bevel",e.Round="Round",e.Miter="Miter"}(G||(G={})),function(e){e[e.Default=0]="Default",e[e.String=1]="String",e[e.Numeric=2]="Numeric"}($||($={})),function(e){e[e.InsidePolygon=0]="InsidePolygon",e[e.PolygonCenter=1]="PolygonCenter",e[e.RandomlyInsidePolygon=2]="RandomlyInsidePolygon"}(j||(j={})),function(e){e[e.Tint=0]="Tint",e[e.Replace=1]="Replace",e[e.Multiply=2]="Multiply"}(Z||(Z={})),function(e){e[e.ClipAtBoundary=0]="ClipAtBoundary",e[e.RemoveIfCenterOutsideBoundary=1]="RemoveIfCenterOutsideBoundary",e[e.DoNotTouchBoundary=2]="DoNotTouchBoundary",e[e.DoNotClip=3]="DoNotClip"}(W||(W={})),function(e){e.NoConstraint="NoConstraint",e.WithMarkers="WithMarkers",e.WithFullGap="WithFullGap",e.WithHalfGap="WithHalfGap",e.Custom="Custom"}(q||(q={})),function(e){e.Fixed="Fixed",e.Random="Random",e.RandomFixedQuantity="RandomFixedQuantity"}(Y||(Y={})),function(e){e.LineMiddle="LineMiddle",e.LineBeginning="LineBeginning",e.LineEnd="LineEnd",e.SegmentMidpoint="SegmentMidpoint"}(X||(X={})),function(e){e.OnPolygon="OnPolygon",e.CenterOfMass="CenterOfMass",e.BoundingBoxCenter="BoundingBoxCenter"}(Q||(Q={})),function(e){e[e.Low=0]="Low",e[e.Medium=1]="Medium",e[e.High=2]="High"}(K||(K={})),function(e){e[e.MarkerCenter=0]="MarkerCenter",e[e.MarkerBounds=1]="MarkerBounds"}(J||(J={})),function(e){e[e.None=0]="None",e[e.PropUniform=1]="PropUniform",e[e.PropNonuniform=2]="PropNonuniform",e[e.DifUniform=3]="DifUniform",e[e.DifNonuniform=4]="DifNonuniform"}(ee||(ee={})),function(e){e.Tube="Tube",e.Strip="Strip",e.Wall="Wall"}(te||(te={})),function(e){e[e.Random=0]="Random",e[e.Increasing=1]="Increasing",e[e.Decreasing=2]="Decreasing",e[e.IncreasingThenDecreasing=3]="IncreasingThenDecreasing"}(ne||(ne={})),function(e){e[e.Relative=0]="Relative",e[e.Absolute=1]="Absolute"}(ie||(ie={})),function(e){e[e.Normal=0]="Normal",e[e.LowerCase=1]="LowerCase",e[e.Allcaps=2]="Allcaps"}(re||(re={})),function(e){e[e.LTR=0]="LTR",e[e.RTL=1]="RTL"}(oe||(oe={})),function(e){e.Draft="Draft",e.Picture="Picture",e.Text="Text"}(se||(se={})),function(e){e[e.Top=0]="Top",e[e.Center=1]="Center",e[e.Baseline=2]="Baseline",e[e.Bottom=3]="Bottom"}(ae||(ae={})),function(e){e[e.Right=0]="Right",e[e.Upright=1]="Upright"}(le||(le={})),function(e){e[e.Small=0]="Small",e[e.Medium=1]="Medium",e[e.Large=2]="Large"}(ce||(ce={})),function(e){e[e.Calm=0]="Calm",e[e.Rippled=1]="Rippled",e[e.Slight=2]="Slight",e[e.Moderate=3]="Moderate"}(ue||(ue={}))},7590:function(e,t,n){"use strict";n.d(t,{$w:function(){return _},Bu:function(){return C},DW:function(){return A},FH:function(){return U},FM:function(){return c},G9:function(){return o},GV:function(){return y},Go:function(){return u},K3:function(){return V},Kn:function(){return S},MM:function(){return p},MO:function(){return G},Nl:function(){return I},Ny:function(){return b},O2:function(){return P},UE:function(){return D},YC:function(){return B},YF:function(){return N},ZO:function(){return z},_1:function(){return O},_H:function(){return x},_W:function(){return v},_d:function(){return E},bs:function(){return k},dI:function(){return Y},e6:function(){return h},gQ:function(){return l},iA:function(){return H},jn:function(){return g},lW:function(){return d},mA:function(){return f},n5:function(){return L},pM:function(){return M},pV:function(){return w},pk:function(){return $},rB:function(){return j},s4:function(){return r},xo:function(){return R},yH:function(){return T},zb:function(){return F},zr:function(){return m}});var i=n(38821);function r(e,t,n,i){return function(e){return"function"==typeof e}(e)?e(t,n,i):e}function o(e){return[e.r,e.g,e.b,e.a]}const s=" /-,\n";function a(e){let t=e.length;for(;t--;)if(!s.includes(e.charAt(t)))return!1;return!0}function l(e,t){const n=[];let i=0,r=-1;do{if(r=e.indexOf("[",i),r>=i){if(r>i){const t=e.slice(i,r);n.push([t,null,a(t)])}if(i=r+1,r=e.indexOf("]",i),r>=i){if(r>i){const o=t[e.slice(i,r)];o&&n.push([null,o,!1])}i=r+1}}}while(-1!==r);if(i<e.length){const t=e.slice(i);n.push([t,null,a(t)])}return n}function c(e,t,n,i){let r="",o=null;for(const i of t){const[t,s,a]=i;if(t)a?o=t:(o&&(r+=o,o=null),r+=t);else{let t=s;null!=n&&(t=G(s,n));const i=e.attributes[t];i&&(o&&(r+=o,o=null),r+=i)}}return function(e,t){switch("string"!=typeof e&&(e=String(e)),t){case"LowerCase":return e.toLowerCase();case"Allcaps":return e.toUpperCase();default:return e}}(r,i)}function u(e,t,n,i,r,o,s=!0){const a=t/r,l=n/o,c=Math.ceil(a/2),u=Math.ceil(l/2);for(let n=0;n<o;n++)for(let h=0;h<r;h++){const d=4*(h+(s?o-n-1:n)*r);let p=0,f=0,g=0,m=0,_=0,v=0,y=0;const b=(n+.5)*l;for(let i=Math.floor(n*l);i<(n+1)*l;i++){const n=Math.abs(b-(i+.5))/u,r=(h+.5)*a,o=n*n;for(let n=Math.floor(h*a);n<(h+1)*a;n++){let s=Math.abs(r-(n+.5))/c;const a=Math.sqrt(o+s*s);a>=-1&&a<=1&&(p=2*a*a*a-3*a*a+1,p>0&&(s=4*(n+i*t),y+=p*e[s+3],g+=p,e[s+3]<255&&(p=p*e[s+3]/250),m+=p*e[s],_+=p*e[s+1],v+=p*e[s+2],f+=p))}}i[d]=m/f,i[d+1]=_/f,i[d+2]=v/f,i[d+3]=y/g}}function h(e){return e?[e[0],e[1],e[2],e[3]/255]:[0,0,0,0]}function d(e){return e.data?.symbol??null}function p(e){return"CIMVectorMarker"===e.type||"CIMPictureMarker"===e.type||"CIMBarChartMarker"===e.type||"CIMCharacterMarker"===e.type||"CIMPieChartMarker"===e.type||"CIMStackedBarChartMarker"===e.type}function f(e){return"CIMGradientStroke"===e.type||"CIMPictureStroke"===e.type||"CIMSolidStroke"===e.type}function g(e){return null!=e&&("CIMGradientFill"===e.type||"CIMHatchFill"===e.type||"CIMPictureFill"===e.type||"CIMSolidFill"===e.type||"CIMWaterFill"===e.type)}function m(e){return null!=e&&("CIMMarkerPlacementAlongLineRandomSize"===e.type||"CIMMarkerPlacementAlongLineSameSize"===e.type||"CIMMarkerPlacementAlongLineVariableSize"===e.type||"CIMMarkerPlacementAtExtremities"===e.type||"CIMMarkerPlacementAtMeasuredUnits"===e.type||"CIMMarkerPlacementAtRatioPositions"===e.type||"CIMMarkerPlacementOnLine"===e.type||"CIMMarkerPlacementOnVertices"===e.type)}const _=(e,t=0)=>null==e||isNaN(e)?t:e,v=(e,t)=>null!=e?e:t,y=(e,t)=>e??t,b=e=>e.tintColor?h(e.tintColor):[255,255,255,1],T=e=>{if(!e)return!1;for(const t of e)switch(t.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":case"CIMGeometricEffectDonut":return!0}return!1};function x(){return n.e(4696).then(n.bind(n,28356))}function w(e){if(!e)return"normal";switch(e.toLowerCase()){case"italic":return"italic";case"oblique":return"oblique";default:return"normal"}}function S(e){if(!e)return"normal";switch(e.toLowerCase()){case"bold":return"bold";case"bolder":return"bolder";case"lighter":return"lighter";default:return"normal"}}function E(e){let t="normal",n="normal";if(e){const i=e.toLowerCase();i.includes("italic")?t="italic":i.includes("oblique")&&(t="oblique"),i.includes("bold")?n="bold":i.includes("light")&&(n="lighter")}return{style:t,weight:n}}function A(e){return e.underline?"underline":e.strikethrough?"line-through":"none"}function M(e){if(!e)return null;switch(e.type){case"CIMPolygonSymbol":if(e.symbolLayers)for(const t of e.symbolLayers){const e=M(t);if(null!=e)return e}break;case"CIMTextSymbol":return M(e.symbol);case"CIMSolidFill":return e.color}return null}function O(e){if(e)switch(e.type){case"CIMPolygonSymbol":case"CIMLineSymbol":{const t=e.symbolLayers;if(t)for(const e of t){const t=O(e);if(null!=t)return t}break}case"CIMTextSymbol":return O(e.symbol);case"CIMSolidStroke":return e.color}}function R(e){if(e)switch(e.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(e.symbolLayers)for(const t of e.symbolLayers){const e=R(t);if(void 0!==e)return e}break;case"CIMTextSymbol":return R(e.symbol);case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return e.width}}function C(e){switch(e){case"Left":default:return"left";case"Right":return"right";case"Center":case"Justify":return"center"}}function I(e){switch(e){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function P(e){return(e?Object.keys(e):[]).map((t=>({name:t,alias:t,type:"string"==typeof e[t]?"esriFieldTypeString":"esriFieldTypeDouble"})))}const D=e=>e.includes("data:image/svg+xml");function L(e){if(!e)return null;switch(e.type){case"CIMPointSymbol":case"CIMTextSymbol":return"esriGeometryPoint";case"CIMLineSymbol":return"esriGeometryPolyline";case"CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}}function N(e){return e?e.charAt(0).toLowerCase()+e.slice(1):e}function F(e,t,n,i,r,o,s=!0){const{infos:a}=o;let l=1,c=0,u=0,h=0,d=1;for(const{absoluteAnchorPoint:e,offsetX:t,offsetY:n,rotation:i,size:r,frameHeight:o,rotateClockWise:p,scaleSymbolsProportionally:f}of a)d=e?1:l,u=W(t,n,c,d,u),h=Z(t,n,c,d,h),o&&(f||s)&&(l*=r/o),c=q(i,p,c);const p=W(i,r,c,d,u),f=Z(i,r,c,d,h);return{size:e*l,rotation:q(t,n,c),offsetX:p,offsetY:f}}function z(e){if(null==e)return!1;if(Array.isArray(e))return e.every((e=>z(e)));switch(typeof e){case"string":return!!e;case"number":return!isNaN(e)}}function H(e,t){if("color"===t||"outlinecolor"===t||"backgroundcolor"===t||"borderlinecolor"===t||"tintcolor"===t)return[...i.K[t]];const n=i.D[e];if(!n)throw new Error(`InternalError: default value for type ${e}.`);return n[t]}function V(e){return"string"==typeof e?function(e){return e.split(" ").map((e=>Number(e)))}(e):e}function U(e){return e?.dashTemplate&&(e.dashTemplate=V(e.dashTemplate)),e}function k(e){if(null==e)return"Normal";switch(e.type){case"CIMTextSymbol":return e.textCase??"Normal";case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const t=e.symbolLayers;if(!t)return"Normal";for(const e of t)if("CIMVectorMarker"===e.type)return k(e)}break;case"CIMVectorMarker":{const t=e.markerGraphics;if(!t)return"Normal";for(const e of t)if(e.symbol)return k(e.symbol)}}return"Normal"}function B(e){if(e)switch(e.type){case"CIMTextSymbol":return e.height;case"CIMPointSymbol":{let t=0;if(e.symbolLayers)for(const n of e.symbolLayers)if(n)switch(n.type){case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":{const e=n.size??i.D.CIMVectorMarker.size;e>t&&(t=e);break}}return t}case"CIMLineSymbol":case"CIMPolygonSymbol":{let t=0;if(e.symbolLayers)for(const n of e.symbolLayers)if(n)switch(n.type){case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":{const e=n.width;null!=e&&e>t&&(t=e);break}case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":if(n.markerPlacement&&m(n.markerPlacement)){const e=n.size??i.D.CIMVectorMarker.size;e>t&&(t=e)}break;case"CIMPictureFill":{const e=n.height;null!=e&&e>t&&(t=e)}}return t}}}function G(e,t){if(null!==t){const n=t.get(e);return n?n.name:e}return e}function $(e){return e.map((e=>({...e,propertyName:N(e.propertyName)})))}function j(e){const t={};for(const n in e){const i=e[n];t[N(n)]=i}return t}function Z(e,t,n,i,r){const o=n*Math.PI/180;if(o){const n=Math.cos(o);return(Math.sin(o)*e+n*t)*i+r}return t*i+r}function W(e,t,n,i,r){const o=n*Math.PI/180;return o?(Math.cos(o)*e-Math.sin(o)*t)*i+r:e*i+r}function q(e,t,n){return t?n-e:n+e}function Y(e,t,n){const i="Color"===n||"TintColor"===n||"ToColor"===n,r="Rotation"===n||"Angle"===n||"ToRotation"===n;let o=t[N(n)];if(null!=o&&(i?o=[o[0]/255,o[1]/255,o[2]/255,o[3]/255]:r&&(o*=Math.PI/180)),null==o&&(o=H(t.type,n.toLowerCase()),null!=o&&(i?o=[o[0]/255,o[1]/255,o[2]/255,o[3]]:r&&(o*=Math.PI/180))),null!=t.primitiveName){const s=e[t.primitiveName];if(null!=s){const e=s[n];null==e||("string"==typeof e||"number"==typeof e||Array.isArray(e)?(o=e,null!=o&&(i?o=[o[0]/255,o[1]/255,o[2]/255,o[3]/255]:r&&(o*=Math.PI/180))):(o={valueExpressionInfo:e,defaultValue:o},null!=o&&(i?o={type:"Process",op:"ArcadeColor",value:o}:r&&(o={type:"Process",op:"Divide",left:o,right:180/Math.PI}))))}}if(null==o)throw new Error(`Failed to derive a value or an expression for "${n}".`);return o}},77927:function(e,t,n){"use strict";n.d(t,{Fe:function(){return h},Km:function(){return o},Nk:function(){return l}});var i=n(52874),r=n(7590);function o(e,t,n,i){if(e)if("CIMTextSymbol"!==e.type){if(n&&e.effects)for(const n of e.effects)a(n,t);if(e.symbolLayers)for(const n of e.symbolLayers)switch(n.type){case"CIMPictureMarker":case"CIMVectorMarker":s(n,t,i);break;case"CIMPictureStroke":case"CIMSolidStroke":!i?.preserveOutlineWidth&&n.width&&(n.width*=t);break;case"CIMPictureFill":n.height&&(n.height*=t),n.offsetX&&(n.offsetX*=t),n.offsetY&&(n.offsetY*=t);break;case"CIMHatchFill":o(n.lineSymbol,t,!0,{...i,preserveOutlineWidth:!1}),n.offsetX&&(n.offsetX*=t),n.offsetY&&(n.offsetY*=t),n.separation&&(n.separation*=t)}}else null!=e.height&&(e.height*=t)}function s(e,t,n){if(e&&(e.markerPlacement&&function(e,t){switch((0,r.zr)(e)&&e.offset&&(e.offset*=t),e.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(e.customEndingOffset&&(e.customEndingOffset*=t),e.offsetAlongLine&&(e.offsetAlongLine*=t),e.placementTemplate&&e.placementTemplate.length){const n=e.placementTemplate.map((e=>e*t));e.placementTemplate=n}break;case"CIMMarkerPlacementAlongLineVariableSize":if(e.maxRandomOffset&&(e.maxRandomOffset*=t),e.placementTemplate&&e.placementTemplate.length){const n=e.placementTemplate.map((e=>e*t));e.placementTemplate=n}break;case"CIMMarkerPlacementOnLine":e.startPointOffset&&(e.startPointOffset*=t);break;case"CIMMarkerPlacementAtExtremities":e.offsetAlongLine&&(e.offsetAlongLine*=t);break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":e.beginPosition&&(e.beginPosition*=t),e.endPosition&&(e.endPosition*=t);break;case"CIMMarkerPlacementPolygonCenter":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t);break;case"CIMMarkerPlacementInsidePolygon":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t),e.stepX&&(e.stepX*=t),e.stepY&&(e.stepY*=t)}}(e.markerPlacement,t),e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t),e.anchorPoint&&"Absolute"===e.anchorPointUnits&&(e.anchorPoint={x:e.anchorPoint.x*t,y:e.anchorPoint.y*t}),e.size=null!=e.size?e.size*t:0,"CIMVectorMarker"===e.type&&e.markerGraphics))for(const i of e.markerGraphics)e.scaleSymbolsProportionally||o(i.symbol,t,!0,n)}function a(e,t){switch(e.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":e.width&&(e.width*=t);break;case"CIMGeometricEffectBuffer":e.size&&(e.size*=t);break;case"CIMGeometricEffectCut":e.beginCut&&(e.beginCut*=t),e.endCut&&(e.endCut*=t),e.middleCut&&(e.middleCut*=t);break;case"CIMGeometricEffectDashes":if(e.customEndingOffset&&(e.customEndingOffset*=t),e.offsetAlongLine&&(e.offsetAlongLine*=t),e.dashTemplate&&e.dashTemplate.length){const n=e.dashTemplate.map((e=>e*t));e.dashTemplate=n}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":e.length&&(e.length*=t);break;case"CIMGeometricEffectMove":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t);break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":e.offset&&(e.offset*=t);break;case"CIMGeometricEffectRegularPolygon":e.radius&&(e.radius*=t);break;case"CIMGeometricEffectTaperedPolygon":e.fromWidth&&(e.fromWidth*=t),e.length&&(e.length*=t),e.toWidth&&(e.toWidth*=t);break;case"CIMGeometricEffectWave":e.amplitude&&(e.amplitude*=t),e.period&&(e.period*=t)}}function l(e){const t=[];return c((0,r.lW)(e),t),t.length?new i.A((0,r.e6)(t[0])):null}function c(e,t){if(!e)return;let n;n="CIMTextSymbol"===e.type?e.symbol:e;const i="CIMPolygonSymbol"===e.type;if(n?.symbolLayers)for(const e of n.symbolLayers)if(!(e.colorLocked||i&&((0,r.mA)(e)||(0,r.MM)(e)&&e.markerPlacement&&(0,r.zr)(e.markerPlacement))))switch(e.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":e.tintColor&&u(t,e.tintColor);break;case"CIMVectorMarker":e.markerGraphics?.forEach((e=>{c(e.symbol,t)}));break;case"CIMSolidStroke":case"CIMSolidFill":u(t,e.color);break;case"CIMHatchFill":c(e.lineSymbol,t)}}function u(e,t){for(const n of e)if(n.join(".")===t.join("."))return;e.push(t)}function h(e,t,n){t instanceof i.A||(t=new i.A(t));const o=(0,r.lW)(e);o&&d(o,t,n)}function d(e,t,n){if(!e)return;let i;i="CIMTextSymbol"===e.type?e.symbol:e;const o="CIMPolygonSymbol"===i?.type;if(i?.symbolLayers)for(const e of i.symbolLayers){if(e.colorLocked)continue;if(o)if(n){const{layersToColor:t}=n;if(((0,r.mA)(e)||(0,r.MM)(e)&&e.markerPlacement&&(0,r.zr)(e.markerPlacement))&&"fill"===t||(0,r.jn)(e)&&"outline"===t)continue}else if((0,r.mA)(e)||(0,r.MM)(e)&&e.markerPlacement&&(0,r.zr)(e.markerPlacement))continue;const i=t.toArray();switch(e.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":e.tintColor=i;break;case"CIMVectorMarker":e.markerGraphics?.forEach((e=>{d(e.symbol,t,n)}));break;case"CIMSolidStroke":case"CIMSolidFill":e.color=i;break;case"CIMHatchFill":d(e.lineSymbol,t,n)}}}},74661:function(e,t,n){"use strict";n.d(t,{A7:function(){return c},Cx:function(){return u},Hk:function(){return h},JJ:function(){return g},SF:function(){return d},UK:function(){return l},jM:function(){return p},x3:function(){return f}}),n(58941);var i=n(8740),r=n(22198),o=n(90363),s=n(90972),a=n(6259);const l=o.A.fromJSON(a.Cb),c=r.A.fromJSON(a.yM),u=i.A.fromJSON(a.WR),h=s.A.fromJSON(a.JZ);function d(e){if(null==e)return null;switch(e.type){case"mesh":return null;case"point":case"multipoint":return l;case"polyline":return c;case"polygon":case"extent":return u}return null}const p=o.A.fromJSON(a.nC),f=r.A.fromJSON(a.HW),g=i.A.fromJSON(a.b6)},6259:function(e,t,n){"use strict";n.d(t,{Cb:function(){return o},HW:function(){return u},JR:function(){return r},JZ:function(){return l},WR:function(){return a},b6:function(){return h},fT:function(){return i},nC:function(){return c},yM:function(){return s}});const i=[252,146,31,255],r=[153,153,153,255],o={type:"esriSMS",style:"esriSMSCircle",size:6,color:i,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},s={type:"esriSLS",style:"esriSLSSolid",width:.75,color:i},a={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},l={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},c={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},u={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},h={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null}},31827:function(e,t,n){"use strict";n.d(t,{$4:function(){return y},O0:function(){return b},O1:function(){return T},Sw:function(){return x},eH:function(){return _},rc:function(){return v}});var i=n(53216),r=n(52874),o=n(93040),s=n(99680),a=n(13520),l=n(77927);const c="picture-fill",u="simple-fill",h="simple-line",d="simple-marker",p="text",f="cim",g=new Map([["dash",[4,3]],["dashdot",[4,3,1,3]],["dot",[1,3]],["longdash",[8,3]],["longdashdot",[8,3,1,3]],["longdashdotdot",[8,3,1,3,1,3]],["shortdash",[4,1]],["shortdashdot",[4,1,1,1]],["shortdashdotdot",[4,1,1,1,1,1]],["shortdot",[1,1]],["solid",[]]]),m=new s.q(1e3);function _(e){const t=e.style;let n=null;if(e)switch(e.type){case d:"cross"!==t&&"x"!==t&&(n=e.color);break;case u:t&&"solid"!==t?"none"!==t&&(n={type:"pattern",x:0,y:0,src:(0,i.s)(`esri/symbols/patterns/${t}.png`),width:5,height:5}):n=e.color;break;case c:n={type:"pattern",src:e.url,width:(0,a.Lz)(e.width)*e.xscale,height:(0,a.Lz)(e.height)*e.yscale,x:(0,a.Lz)(e.xoffset),y:(0,a.Lz)(e.yoffset)};break;case p:n=e.color;break;case f:n=(0,l.Nk)(e)}return n}function v(e,t){const n=e+"-"+t;return void 0!==m.get(n)?Promise.resolve(m.get(n)):(0,o.A)(e,{responseType:"image"}).then((e=>{const i=e.data,r=i.naturalWidth,o=i.naturalHeight,s=document.createElement("canvas");s.width=r,s.height=o;const a=s.getContext("2d");a.fillStyle=t,a.fillRect(0,0,r,o),a.globalCompositeOperation="destination-in",a.drawImage(i,0,0);const l=s.toDataURL();return m.put(n,l),l}))}function y(e){if(!e)return null;let t=null;switch(e.type){case u:case c:case d:t=y(e.outline);break;case h:{const n=(0,a.Lz)(e.width);null!=e.style&&"none"!==e.style&&0!==n&&(t={color:e.color,style:T(e.style),width:n,cap:e.cap,join:"miter"===e.join?(0,a.Lz)(e.miterLimit):e.join},t.dashArray=b(t).join(",")||"none");break}default:t=null}return t}function b(e){if(!e?.style)return[];const{dashArray:t,style:n,width:i}=e;if("string"==typeof t&&"none"!==t)return t.split(",").map((e=>Number(e)));const r=i??0,o=g.has(n)?g.get(n).map((e=>e*r)):[];if("butt"!==e.cap)for(const[e,t]of o.entries())o[e]=e%2==1?t+r:Math.max(t-r,1);return o}const T=(()=>{const e={};return t=>{if(e[t])return e[t];const n=t.replaceAll("-","");return e[t]=n,n}})(),x=new r.A([128,128,128])},89814:function(e,t,n){"use strict";n.d(t,{$d:function(){return f},GG:function(){return w},N7:function(){return g},Sx:function(){return m},UQ:function(){return x},di:function(){return S},dt:function(){return v},f3:function(){return E},k_:function(){return p},yG:function(){return A}});var i=n(52874),r=n(10748),o=n(77472),s=(n(58941),n(13520)),a=n(32501),l=n(60318),c=n(77927),u=n(31827),h=n(13109);const d=new i.A("white");function p(e){if(!e)return 0;if((0,r.wk)(e)){const t=function(e){const t=e.symbolLayers?.at(-1);if(t&&"outline"in t)return t?.outline?.size}(e);return null!=t?t:0}return(0,s.PN)((0,u.$4)(e)?.width)}function f(e){if(null==e||!("symbolLayers"in e)||null==e.symbolLayers)return!1;switch(e.type){case"point-3d":return e.symbolLayers.some((e=>"object"===e.type));case"line-3d":return e.symbolLayers.some((e=>"path"===e.type));case"polygon-3d":return e.symbolLayers.some((e=>"object"===e.type||"extrude"===e.type));default:return!1}}function g(e){return e.resource?.href??""}function m(e,t){if(!e)return null;let n=null;return(0,r.wk)(e)?n=function(e){const t=e.symbolLayers;if(!t)return null;let n=null;return t.forEach((e=>{"object"===e.type&&e.resource?.href||(n="water"===e.type?e.color:e.material?e.material.color:null)})),n?new i.A(n):null}(e):(0,r.$y)(e)&&(n="cim"===e.type?(0,c.Nk)(e):e.color?new i.A(e.color):null),n?_(n,t):null}function _(e,t){if(null==t||null==e)return e;const n=e.toRgba();return n[3]=n[3]*t,new i.A(n)}function v(e,t,n){var o,s,a;e&&(t||null!=n)&&(t&&(t=new i.A(t)),(0,r.wk)(e)?function(e,t,n){const i=e.symbolLayers;if(!i)return;const r=e=>_(t=t??e??(null!=n?d:null),n);i.forEach((e=>{if("object"!==e.type||!e.resource?.href||t)if("water"===e.type)e.color=r(e.color);else{const t=null!=e.material?e.material.color:null,i=r(t);null==e.material?e.material=new h.N({color:i}):e.material.color=i,null!=n&&"outline"in e&&null!=e.outline?.color&&(e.outline.color=_(e.outline.color,n))}}))}(e,t,n):(0,r.$y)(e)&&(o=e,a=n,(s=(s=t)??o.color)&&(o.color=_(s,a)),null!=a&&"outline"in o&&o.outline?.color&&(o.outline.color=_(o.outline.color,a))))}function y(e){for(const t of e)if("number"==typeof t)return t;return null}function b(e,t,n){for(let i=0;i<3;i++){const r=e[i];switch(r){case"symbol-value":{const e=n[i];return null!=e?e/t[i]:1}case"proportional":break;default:if(r&&t[i])return r/t[i]}}return 1}function T(e,t,n,i){switch(e){case"proportional":return n*i;case"symbol-value":return null!=t?t:n;default:return e}}async function x(e,t){if(e&&t)return(0,r.wk)(e)?async function(e,t){const i=e.symbolLayers;i&&await(0,o.jJ)(i,(async e=>async function(e,t){switch(e.type){case"extrude":!function(e,t){e.size="number"==typeof t[2]?t[2]:0}(e,t);break;case"icon":case"line":case"text":!function(e,t){const n=y(t);null!=n&&(e.size=n)}(e,t);break;case"path":!function(e,t){const n=b(t,a.Un,[e.width,void 0,e.height]);e.width=T(t[0],e.width,1,n),e.height=T(t[2],e.height,1,n)}(e,t);break;case"object":await async function(e,t){const{resourceSize:i,symbolSize:r}=await async function(e){const{computeObjectLayerResourceSize:t}=await n.e(7269).then(n.bind(n,9141)),i=await t(e,10),{width:r,height:o,depth:s}=e,a=[r,s,o];let l=1;for(let e=0;e<3;e++){const t=a[e];if(null!=t){l=t/i[e];break}}for(let e=0;e<3;e++)null==a[e]&&(a[e]=i[e]*l);return{resourceSize:i,symbolSize:a}}(e),o=b(t,i,r);e.width=T(t[0],r[0],i[0],o),e.depth=T(t[1],r[1],i[1],o),e.height=T(t[2],r[2],i[2],o)}(e,t)}}(e,t)))}(e,t):void((0,r.$y)(e)&&function(e,t){const n=y(t);if(null!=n)switch(e.type){case"simple-marker":e.size=n;break;case"picture-marker":{const t=e.width/e.height;t>1?(e.width=n,e.height=n*t):(e.width=n*t,e.height=n);break}case"simple-line":e.width=n;break;case"text":e.font.size=n}}(e,t))}function w(e,t,n){if(e&&null!=t)if((0,r.wk)(e)){const i=e.symbolLayers;i&&i.forEach((e=>{if("object"===e.type)switch(n){case"tilt":e.tilt=(e.tilt??0)+t;break;case"roll":e.roll=(e.roll??0)+t;break;default:e.heading=(e.heading??0)+t}"icon"===e.type&&(e.angle+=t)}))}else(0,r.$y)(e)&&("simple-marker"!==e.type&&"picture-marker"!==e.type&&"text"!==e.type||(e.angle+=t))}function S(e){if(!e)return null;const t=e.effects.filter((e=>"bloom"!==e.type)).map((e=>e.toJSON()));return(0,l.zu)(t)}function E(e){return null!=e&&"polygon-3d"===e.type&&e.symbolLayers.some((e=>"extrude"===e.type))}async function A(e,t){return await e.fetchSymbol(t)||e.fetchCIMSymbol(t)}},1616:function(e,t,n){"use strict";var i,r;function o(e){return null!=e&&!e.running}n.d(t,{c:function(){return r},pi:function(){return o},tf:function(){return i}}),function(e){e[e.Idle=0]="Idle",e[e.Rendering=1]="Rendering",e[e.Ready=2]="Ready",e[e.Fading=3]="Fading"}(i||(i={})),function(e){e[e.RG=0]="RG",e[e.BA=1]="BA",e[e.COUNT=2]="COUNT"}(r||(r={}))},75256:function(e,t,n){"use strict";n.d(t,{c:function(){return i},n:function(){return m}});var i,r,o=n(82547),s=n(15774),a=n(85445),l=n(73364),c=n(39714),u=n(20551),h=n(32501),d=n(26133),p=n(43587),f=n(1616),g=n(58192);class m{constructor(){this.startTime=0,this._data=(0,a.v)(null),this._readChannels=f.c.RG,this.parallax=new _,this.parallaxNew=new _,this._anchorPoint=(0,h.vt)(),this._fadeState=(0,a.v)(i.HIDE),this._fadeFactor=(0,a.v)(1)}get data(){return this._data.value}set data(e){this._data.value=e}get readChannels(){return this._readChannels}get fadeState(){return this._fadeState.value}get fadeFactor(){return this._fadeFactor.value}get opacity(){switch(this.fadeState){case i.HIDE:return 0;case i.FADE_OUT:return 1-this.fadeFactor;case i.FADE_IN:return this.fadeFactor;case i.SHOW:case i.CROSS_FADE:return 1}}fade(e,t,n){this.isFading&&this.fadeFactor<1&&(this._fadeFactor.value=n?(0,s.qE)((t-this.startTime)/(T*n),0,1):1,1===this.fadeFactor&&this._endFade()),this._evaluateState(e,t),this._updateParallax(e)}_evaluateState(e,t){const n=e.relativeElevation,r=this._updateAnchorPoint(e);(n>1.7*g.zF||n<-g.zF||r>w)&&this.opacity>0?this._startFade(i.HIDE,t):this.isFading||(n>g.zF||n<-.35*g.zF||r>x*w?this.opacity>0&&this._startFade(i.FADE_OUT,t):(0,f.pi)(this.data)&&(0===this.opacity?this._startFade(i.FADE_IN,t):this.data.state===f.tf.Ready&&(this.fadeState===i.SHOW?this._startFade(i.CROSS_FADE,t):this._startFade(i.SHOW,t))))}_updateParallax(e){const t=(0,u.k)(e.eye);this.parallax.radiusCurvatureCorrection=.84*Math.sqrt(Math.max(t-p.$O.radius*p.$O.radius,0))/Math.sqrt(t),(0,d.Cr)(v,this.parallax.anchorPoint,y),(0,l.e$)(this.parallax.transform,c.zK,y[3],(0,d.yo)(y)),(0,d.Cr)(v,this.parallaxNew.anchorPoint,y),(0,l.e$)(this.parallaxNew.transform,c.zK,y[3],(0,d.yo)(y))}_updateAnchorPoint(e){return(0,u.n)(this._anchorPoint,e.eye),(0,u.h)(this._anchorPoint,this._anchorPoint,p.$O.radius),this.fadeState===i.HIDE&&this.data?.state===f.tf.Ready?((0,u.c)(this.parallax.anchorPoint,this._anchorPoint),0):(0,u.l)((0,u.d)(b,this.parallax.anchorPoint,this._anchorPoint))}requestFade(){this._fadeFactor.value=0}_startFade(e,t){switch(this._fadeState.value=e,this.startTime=t,e){case i.CROSS_FADE:this.requestFade(),this._switchReadChannels(),(0,u.c)(this.parallaxNew.anchorPoint,this._anchorPoint);break;case i.FADE_IN:this.requestFade(),this._switchReadChannels(),(0,u.c)(this.parallax.anchorPoint,this._anchorPoint),(0,u.c)(this.parallaxNew.anchorPoint,this._anchorPoint);break;case i.FADE_OUT:this.requestFade();break;case i.SHOW:this._switchReadChannels(),(0,u.c)(this.parallax.anchorPoint,this._anchorPoint),(0,u.c)(this.parallaxNew.anchorPoint,this._anchorPoint),this._endFade();break;case i.HIDE:this._endFade()}}_endFade(){switch(this._fadeFactor.value=1,this.data&&this.data.state!==f.tf.Ready&&(this.data.state=f.tf.Idle),this.fadeState){case i.CROSS_FADE:(0,u.c)(this.parallax.anchorPoint,this.parallaxNew.anchorPoint),this._fadeState.value=i.SHOW;break;case i.FADE_IN:this._fadeState.value=i.SHOW;break;case i.FADE_OUT:this._fadeState.value=i.HIDE;break;case i.SHOW:case i.HIDE:break;default:(0,o.Xb)(this.fadeState)}}_switchReadChannels(){this.data?.state===f.tf.Ready&&(this._readChannels=1-this._readChannels,this.data.state=f.tf.Fading)}get isFading(){return this.fadeState===i.FADE_OUT||this.fadeState===i.FADE_IN||this.fadeState===i.CROSS_FADE}}(r=i||(i={}))[r.HIDE=0]="HIDE",r[r.FADE_IN=1]="FADE_IN",r[r.SHOW=2]="SHOW",r[r.CROSS_FADE=3]="CROSS_FADE",r[r.FADE_OUT=4]="FADE_OUT";class _{constructor(){this.anchorPoint=(0,h.vt)(),this.radiusCurvatureCorrection=0,this.transform=(0,c.vt)()}}const v=(0,h.fA)(0,0,1),y=(0,d.vt)(),b=(0,h.vt)(),T=1.25,x=.5,w=2e5},58192:function(e,t,n){"use strict";n.d(t,{k9:function(){return S},zF:function(){return w}});var i,r=n(53804),o=n(30905),s=n(23502),a=(n(58941),n(40633),n(13798),n(74376)),l=n(65953);let c=i=class extends o.oY{constructor(e){super(e),this.type="cloudy",this.cloudCover=.5}clone(){return new i({cloudCover:this.cloudCover})}};(0,r._)([(0,a.e)({cloudy:"cloudy"})],c.prototype,"type",void 0),(0,r._)([(0,s.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"cloudCover",void 0),c=i=(0,r._)([(0,l.$)("esri.views.3d.environment.CloudyWeather")],c);const u=c;var h;let d=h=class extends o.oY{constructor(e){super(e),this.type="foggy",this.fogStrength=.5}clone(){return new h({fogStrength:this.fogStrength})}};(0,r._)([(0,a.e)({foggy:"foggy"})],d.prototype,"type",void 0),(0,r._)([(0,s.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],d.prototype,"fogStrength",void 0),d=h=(0,r._)([(0,l.$)("esri.views.3d.environment.FoggyWeather")],d);const p=d;var f;let g=f=class extends o.oY{constructor(e){super(e),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new f({cloudCover:this.cloudCover,precipitation:this.precipitation})}};(0,r._)([(0,a.e)({rainy:"rainy"})],g.prototype,"type",void 0),(0,r._)([(0,s.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],g.prototype,"cloudCover",void 0),(0,r._)([(0,s.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],g.prototype,"precipitation",void 0),g=f=(0,r._)([(0,l.$)("esri.views.3d.environment.RainyWeather")],g);const m=g;var _;let v=_=class extends o.oY{constructor(e){super(e),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new _({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};(0,r._)([(0,a.e)({snowy:"snowy"})],v.prototype,"type",void 0),(0,r._)([(0,s.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],v.prototype,"cloudCover",void 0),(0,r._)([(0,s.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],v.prototype,"precipitation",void 0),(0,r._)([(0,s.MZ)({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],v.prototype,"snowCover",void 0),v=_=(0,r._)([(0,l.$)("esri.views.3d.environment.SnowyWeather")],v);const y=v;var b;let T=b=class extends o.oY{constructor(e){super(e),this.type="sunny",this.cloudCover=.5}clone(){return new b({cloudCover:this.cloudCover})}};(0,r._)([(0,a.e)({sunny:"sunny"})],T.prototype,"type",void 0),(0,r._)([(0,s.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],T.prototype,"cloudCover",void 0),T=b=(0,r._)([(0,l.$)("esri.views.3d.environment.SunnyWeather")],T);const x={key:"type",base:T,typeMap:{sunny:T,cloudy:u,rainy:m,snowy:y,foggy:p}};Object.keys(x.typeMap);const w=1e4,S=1e5},53202:function(e,t,n){"use strict";n.r(t),n.d(t,{DrawGraphicTool3D:function(){return li},ExtentTransformTool:function(){return La},ManipulatedObject3DGraphic:function(){return Va},MoveTool3D:function(){return Mo},ReshapeTool3D:function(){return as},TransformTool3D:function(){return As}});var i=n(53804),r=n(75505),o=n(61226),s=n(95929),a=n(28181),l=n(23502),c=n(58941),u=(n(40633),n(13798),n(65953)),h=n(20551),d=n(32501),p=n(68945),f=n(6422),g=n(13520),m=(n(39819),n(15263)),_=n(52874),v=(n(64122),n(83525)),y=n(77472),b=n(15774),T=n(88226),x=n(62938),w=n(13786),S=n(1932),E=n(38441),A=n(50973),M=n(38225),O=n(76722);n(77528);let R=(e,t,n)=>{for(let i=0,r=t.length;i<r;i++){let r=t[i];Array.isArray(r)?R(e,r,n):null!=r&&!1!==r&&("string"==typeof r&&(r={vnodeSelector:"",properties:void 0,children:void 0,text:r.toString(),domNode:null}),n.push(r))}};n(81401);const C={bottom:"esri-text-overlay-item-anchor-bottom","bottom-right":"esri-text-overlay-item-anchor-bottom-right","bottom-left":"esri-text-overlay-item-anchor-bottom-left",top:"esri-text-overlay-item-anchor-top","top-right":"esri-text-overlay-item-anchor-top-right","top-left":"esri-text-overlay-item-anchor-top-left",center:"esri-text-overlay-item-anchor-center",right:"esri-text-overlay-item-anchor-right",left:"esri-text-overlay-item-anchor-left"};let I=class extends v.A{get position(){return[this.x,this.y]}set position(e){this._set("x",e[0]),this._set("y",e[1])}get _textShadowColor(){const{textColor:e,backgroundColor:t}=this,n=t.clone();return n.a*=e.a,n}get _textShadow(){const e=this._textShadowColor.toCss(!0);return`0 0 ${this._textShadowSize}px ${e}`}get padding(){return.5*this.fontSize}get borderRadius(){return this.padding}set borderRadius(e){this._overrideIfSome("borderRadius",e)}constructor(e){super(e),this.x=0,this.y=0,this.text="-",this.fontSize=14,this.anchor="center",this.visible=!0,this.isDecoration=!0,this.backgroundColor=new _.A([0,0,0,.6]),this.textColor=new _.A([255,255,255]),this._textShadowSize=1}render(){return function(e,t,n){if(Array.isArray(t))n=t,t=void 0;else if(t&&("string"==typeof t||t.hasOwnProperty("vnodeSelector"))||n&&("string"==typeof n||n.hasOwnProperty("vnodeSelector")))throw new Error("h called with invalid arguments");let i,r;return n&&1===n.length&&"string"==typeof n[0]?i=n[0]:n&&(r=[],R("div",n,r),0===r.length&&(r=void 0)),{vnodeSelector:"div",properties:t,children:r,text:""===i?void 0:i,domNode:null}}(0,{classes:this._cssClasses(),styles:{left:Math.floor(this.x)+"px",top:Math.floor(this.y)+"px",visibility:this.visible?"visible":"hidden",fontSize:this.fontSize+"px",lineHeight:this.fontSize+"px",backgroundColor:this.backgroundColor.toCss(!0),color:this.textColor.toCss(!0),padding:this.padding+"px",borderRadius:this.borderRadius+"px",textShadow:this._textShadow}},[this.text])}renderCanvas(e){if(!this.visible)return;const t=e.font.replace(/^(.*?)px/,"");e.font=`${this.fontSize}px ${t}`;const{padding:n,borderRadius:i}=this,r=e.measureText(this.text).width,o=""!==this.text?this.fontSize:0,s=P[this.anchor];e.textAlign="center",e.textBaseline="middle";const a=r+2*n,l=o+2*n,c=this.x+s.x*a,u=this.y+s.y*l;this._roundedRect(e,c,u,a,l,i),e.fillStyle=this.backgroundColor.toCss(!0),e.fill();const h=this.x+(s.x+.5)*a,d=this.y+(s.y+.5)*l;this._renderTextShadow(e,this.text,h,d),e.fillStyle=this.textColor.toCss(!0),e.fillText(this.text,h,d)}_renderTextShadow(e,t,n,i){e.lineJoin="miter",e.fillStyle=`rgba(${this._textShadowColor.r}, ${this._textShadowColor.g}, ${this._textShadowColor.b}, ${1/D.length})`;const r=this._textShadowSize;for(const[o,s]of D)e.fillText(t,n+r*o,i+r*s)}_roundedRect(e,t,n,i,r,o){o=Math.min(o,r/2,i/2),e.beginPath(),e.moveTo(t,n+o),e.arcTo(t,n,t+o,n,o),e.lineTo(t+i-o,n),e.arcTo(t+i,n,t+i,n+o,o),e.lineTo(t+i,n+r-o),e.arcTo(t+i,n+r,t+i-o,n+r,o),e.lineTo(t+o,n+r),e.arcTo(t,n+r,t,n+r-o,o),e.closePath()}_cssClasses(){const e={"esri-text-overlay-item":!0};let t;for(t in C)e[C[t]]=this.anchor===t;return e}};(0,i._)([(0,l.MZ)()],I.prototype,"x",void 0),(0,i._)([(0,l.MZ)()],I.prototype,"y",void 0),(0,i._)([(0,l.MZ)()],I.prototype,"position",null),(0,i._)([(0,l.MZ)()],I.prototype,"text",void 0),(0,i._)([(0,l.MZ)()],I.prototype,"fontSize",void 0),(0,i._)([(0,l.MZ)()],I.prototype,"anchor",void 0),(0,i._)([(0,l.MZ)()],I.prototype,"visible",void 0),(0,i._)([(0,l.MZ)()],I.prototype,"isDecoration",void 0),(0,i._)([(0,l.MZ)()],I.prototype,"backgroundColor",void 0),(0,i._)([(0,l.MZ)()],I.prototype,"textColor",void 0),(0,i._)([(0,l.MZ)()],I.prototype,"_textShadowSize",void 0),(0,i._)([(0,l.MZ)()],I.prototype,"_textShadowColor",null),(0,i._)([(0,l.MZ)()],I.prototype,"_textShadow",null),(0,i._)([(0,l.MZ)()],I.prototype,"padding",null),(0,i._)([(0,l.MZ)()],I.prototype,"borderRadius",null),I=(0,i._)([(0,u.$)("esri.views.overlay.TextOverlayItem")],I);const P={bottom:{x:-.5,y:-1,textAlign:"center",textBaseline:"bottom"},"bottom-left":{x:0,y:-1,textAlign:"left",textBaseline:"bottom"},"bottom-right":{x:-1,y:-1,textAlign:"right",textBaseline:"bottom"},center:{x:-.5,y:-.5,textAlign:"center",textBaseline:"middle"},left:{x:0,y:-.5,textAlign:"left",textBaseline:"middle"},right:{x:-1,y:-.5,textAlign:"right",textBaseline:"middle"},top:{x:-.5,y:0,textAlign:"center",textBaseline:"top"},"top-left":{x:0,y:0,textAlign:"left",textBaseline:"top"},"top-right":{x:-1,y:0,textAlign:"right",textBaseline:"top"}},D=[];{const e=16;for(let t=0;t<360;t+=360/e)D.push([Math.cos(Math.PI*t/180),Math.sin(Math.PI*t/180)])}const L=I;var N=n(9862),F=n(22739);const z={default:15,far:25};let H=class extends v.A{constructor(e){super(e),this.context=null,this.stagedVertex=null,this.visible=!0,this.edgeDistance="default",this._messageUnitsTask=null,this._labelInfos=[],this._nextLabelIndex=0}initialize(){this.addHandles([(0,a.watch)((()=>[null!=this.context&&this.getCameraOrExtent(this.context),this.visible,this._edgeDistancePixels,this.stagedVertex,this._messagesUnits]),(()=>this._update())),...["vertex-add","vertex-update","vertex-remove"].map((e=>(0,a.on)((()=>this.context?.editGeometryOperations),e,(()=>this._update())))),(0,a.watch)((()=>this._colors),(e=>this._updateStyle(e))),(0,F.oQ)((()=>this._refreshMessages())),(0,o.hA)((()=>this._messageUnitsTask?.abort()))]),this._refreshMessages()}destroy(){for(this._nextLabelIndex=0;this._labelInfos.length;)this._destroyLabel(this._labelInfos.pop())}get updating(){return null==this._messagesUnits}get test(){}get _messagesUnits(){return this._messageUnitsTask?.value}get _edgeDistancePixels(){return z[this.edgeDistance]}get _colors(){const e=this.context?.view.effectiveTheme.textColor??_.A.fromArray([255,255,255]);return{textColor:e,backgroundColor:(0,r._L)((0,r.bJ)(e,r.pW.Low),.6)}}_update(){if(this.destroyed)return;this._nextLabelIndex=0;const{context:e,stagedVertex:t}=this;if(!e)return this._destroyUnusedLabels();const{editGeometryOperations:n}=e,{components:i,geometry:r,coordinateHelper:o}=n.data;if(!r)return this._destroyUnusedLabels();const s=i.length;for(let i=0;i<s;++i){const a=V(r,n,t,o,i);if(a.length<2||!U(a,e.view,e.elevationInfo,o.spatialReference))continue;const l=1===s&&!(0,E.$3)(a);let c=$,u=j;this.toScreenPointArray(e,a[0],c);for(let t=1;t<a.length;++t){const n=a[t-1],i=a[t];this.toScreenPointArray(e,i,u),this._addLabel(e,n,c,i,u,l),[c,u]=[u,c]}}this._destroyUnusedLabels()}_updateStyle({textColor:e,backgroundColor:t}){const n=this._nextLabelIndex,i=this._labelInfos;for(let r=0;r<n;++r){const{label:n}=i[r];n.textColor=e,n.backgroundColor=t}}_addLabel(e,t,n,i,r,o){const{label:s}=this._getOrCreateLabel(e);if(!this.visible||(0,w.hG)(n,r)<3025)return void(s.visible=!1);const{spatialReference:a}=e.editGeometryOperations.data,l=(0,N.Do)(t,i,a),c=this._messagesUnits,u=(0,O.c)(e.view);s.text=null!=c&&null!=l?(0,T.ix)(c,l,u):"",s.visible=!0;const h=r[0]-n[0],d=r[1]-n[1];o?(0,w.hZ)(B,-d,h):(0,w.hZ)(B,d,-h),(0,w.S8)(B,B),(0,w.hs)(B,B,this._edgeDistancePixels),(0,w.Cc)(G,n,r,.5),(0,w.WQ)(G,G,B),s.position=[G[0],G[1]],Math.abs(B[0])>Math.abs(B[1])?s.anchor=B[0]>0?"left":"right":s.anchor=-B[1]<0?"top":"bottom"}_getOrCreateLabel(e){const t=this._labelInfos.length>this._nextLabelIndex,{textColor:n,backgroundColor:i}=this._colors;if(t){const e=this._labelInfos[this._nextLabelIndex++],{label:t}=e;return t.textColor=n,t.backgroundColor=i,e}const r=new L({anchor:"center",fontSize:8,textColor:n,backgroundColor:i});e.view.overlay?.items.add(r);const o={label:r};return this._labelInfos.push(o),this._nextLabelIndex=this._labelInfos.length,o}_destroyUnusedLabels(){for(;this._labelInfos.length>this._nextLabelIndex;)this._destroyLabel(this._labelInfos.pop())}_destroyLabel({label:e}){this.context?.view.overlay?.items.remove(e),e.destroy()}_refreshMessages(){this._messageUnitsTask?.abort(),this._messageUnitsTask=(0,y.UT)((()=>(0,M.ud)("esri/core/t9n/Units")))}};function V(e,t,n,i,r){const o=[];if(t.data.components[r].iterateVertices((e=>{o.push(i.toXYZ(e.pos,A.rq.get()))})),0===r&&null!=n&&o.push(i.toXYZ(n,A.rq.get())),o.length<2)return o;const s=o[0],a=o[o.length-1];return"polygon"===e.type&&o.length>2&&!(0,h.H)(s,a)&&o.push(s),o}function U(e,t,n,i){if("2d"===t.type)return!0;const r=(0,x.Ao)(i)??1,o=(0,x.G9)(i),s=e=>(0,p.xS)(t,e,i,n,p.qt)??0;for(let t=1;t<e.length;++t){const n=e[t-1],i=e[t],a=(i[0]-n[0])*r,l=(i[1]-n[1])*r,c=(s(i)-s(n))*o;if(Math.abs(c)/Math.sqrt(a*a+l*l)>k)return!1}return!0}(0,i._)([(0,l.MZ)()],H.prototype,"context",void 0),(0,i._)([(0,l.MZ)()],H.prototype,"stagedVertex",void 0),(0,i._)([(0,l.MZ)()],H.prototype,"visible",void 0),(0,i._)([(0,l.MZ)()],H.prototype,"edgeDistance",void 0),(0,i._)([(0,l.MZ)()],H.prototype,"updating",null),(0,i._)([(0,l.MZ)()],H.prototype,"_messageUnitsTask",void 0),(0,i._)([(0,l.MZ)()],H.prototype,"_messagesUnits",null),(0,i._)([(0,l.MZ)()],H.prototype,"_edgeDistancePixels",null),(0,i._)([(0,l.MZ)()],H.prototype,"_colors",null),H=(0,i._)([(0,u.$)("esri.views.interactive.SegmentLabels")],H);const k=(0,b.kU)(5),B=(0,S.vt)(),G=(0,S.vt)(),$=(0,g.gs)(),j=(0,g.gs)();let Z=class extends H{getCameraOrExtent({view:e}){return e.state.camera}toScreenPointArray({view:e,elevationInfo:t,editGeometryOperations:n},i,r=(0,g.gs)()){const{spatialReference:o}=n.data.coordinateHelper;return(0,m.X)(i,o,t,e,W),e.state.camera.projectToScreen(W,r),r}};Z=(0,i._)([(0,u.$)("esri.views.3d.interactive.SegmentLabels3D")],Z);const W=(0,d.vt)();var q=n(68734),Y=n(33400),X=n(41546),Q=n(91912),K=n(69508),J=n(73313),ee=n(79578),te=n(88781),ne=n(46949),ie=n(96253),re=n(91998);class oe{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1,this._renderGroup=ne.O7.Outline}destroy(){this._destroyResources()}get resources(){return null!=this._resources?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncGeometriesToRenderer())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}get renderGroup(){return this._renderGroup}set renderGroup(e){this._renderGroup=e;const t=this._resources?.layerView;t&&(t.renderGroup=e)}recreate(){this.attached&&this._createResources()}recreateGeometry(){this._resourceFactory.recreateGeometry?null!=this._resources&&(this._ensureRenderGeometriesRemoved(),this._resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}_createOrDestroyResources(){this._attached?null==this._resources&&this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this._resourceFactory.createResources(),t=new se({view:this._resourceFactory.view,renderGroup:this._renderGroup}),n=this._resourceFactory.view.basemapTerrain?.overlayManager;this._resources={layerView:new se({view:this._resourceFactory.view,renderGroup:this._renderGroup}),external:e,geometriesAdded:!1},n&&(this._resources.drapeSourceRenderer=n.registerGeometryDrapeSource(t)),this._syncGeometriesToRenderer()}_destroyResources(){if(null==this._resources)return;this._ensureRenderGeometriesRemoved();const e=this._resourceFactory.view.basemapTerrain?.overlayManager;e&&e.unregisterDrapeSource(this._resources.layerView),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncGeometriesToRenderer(){this._visible?this._ensureRenderGeometriesAdded():this._ensureRenderGeometriesRemoved()}_ensureRenderGeometriesRemoved(){null!=this._resources?.drapeSourceRenderer&&this._resources.geometriesAdded&&(this._resources.drapeSourceRenderer.removeGeometries(this._resources.external.geometries,ie.q.UPDATE),this._resources.geometriesAdded=!1)}_ensureRenderGeometriesAdded(){null!=this._resources?.drapeSourceRenderer&&(this._resources.geometriesAdded||(this._resources.drapeSourceRenderer.addGeometries(this._resources.external.geometries,ie.q.UPDATE),this._resources.geometriesAdded=!0))}}let se=class extends((0,te.sA)(v.A)){constructor(e){super(e),this.drapeSourceType=ne.Om.Features,this.updatePolicy=re.q.SYNC,this.renderGroup=ne.O7.Outline}};(0,i._)([(0,l.MZ)({constructOnly:!0})],se.prototype,"view",void 0),(0,i._)([(0,l.MZ)({readOnly:!0})],se.prototype,"drapeSourceType",void 0),(0,i._)([(0,l.MZ)()],se.prototype,"renderGroup",void 0),se=(0,i._)([(0,u.$)("esri.views.3d.interactive.visualElements.DrapedVisualElementResources")],se);class ae{get isDecoration(){return this._isDecoration}set isDecoration(e){this._isDecoration=e}constructor(e){this._isDecoration=!1,this._attached=!1,this._resourcesCreated=!1,this._visible=!0,this.view=e.view,this._handle=(0,a.watch)((()=>e.view.ready),(e=>{this._resourcesCreated&&(e?this._createResources():this._destroyResources())}))}applyProperties(e){let t=!1;for(const n in e)n in this&&("attached"===n?t=!!e[n]:this[n]=e[n]);this.attached=t}destroy(){this.attached=!1,this._handle.remove()}get attached(){return this._attached}set attached(e){e!==this._attached&&this.view._stage&&(this._attached=e,this._attached&&!this._resourcesCreated?this._createResources():!this._attached&&this._resourcesCreated&&this._destroyResources(),this.onAttachedChange(e))}onAttachedChange(e){}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.attached&&this.updateVisibility(e))}_createResources(){this.createResources(),this._resourcesCreated=!0,this.updateVisibility(this.visible)}_destroyResources(){this.destroyResources(),this._resourcesCreated=!1}}var le=n(40359),ce=n(10713),ue=n(1296);class he{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get object(){return null!=this._resources?this._resources.object:null}get resources(){return null!=this._resources?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncVisible())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){if(!this._resourceFactory.recreateGeometry)return void this.recreate();const e=this._resourceFactory.view._stage;if(null==this._resources||!e)return;const t=this._resources.object;this._resources.external.forEach((t=>{t.type!==le.X.Mesh&&t.type!==le.X.Line&&t.type!==le.X.Point||e.remove(t)})),t.removeAllGeometries(),this._resourceFactory.recreateGeometry(this._resources.external,t,this._resources.layer),this._resources.external.forEach((t=>{t.type!==le.X.Mesh&&t.type!==le.X.Line&&t.type!==le.X.Point||e.add(t)}))}_createOrDestroyResources(){this._attached?this._resources||this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this._resourceFactory,t=e.view,n=t._stage;if(!n)return;const i=new ue.x(n,{pickable:!1,updatePolicy:re.q.SYNC}),r=new ce.B({castShadow:!1}),o=e.createResources(r,i);o.forEach((e=>{n.add(e),e.type===le.X.Texture&&e.load(n.renderView.renderingContext)})),n.add(r),i.add(r);const s=e.cameraChanged,l=s?(0,a.watch)((()=>t.state.camera),(e=>s(e)),a.Vh):null;this._resources={layer:i,object:r,external:o,cameraHandle:l},this._syncVisible()}_destroyResources(){if(null==this._resources)return;const e=this._resourceFactory.view._stage;e&&(e.remove(this._resources.object),this._resources.layer.destroy(),this._resources.external.forEach((t=>{e.remove(t),t.type===le.X.Texture&&t.unload()}))),this._resources.object.dispose(),this._resources.cameraHandle?.remove(),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncVisible(){null!=this._resources&&(this._resources.object.visible=this._visible)}}class de extends ae{constructor(e){super(e),this._isDraped=!1,this.object3dResources=new he(this.createObject3DResourceFactory(e.view)),this.drapedResources=new oe(this.createDrapedResourceFactory(e.view)),this.isDraped=e.isDraped??!1}get isDraped(){return this._isDraped}set isDraped(e){e!==this._isDraped&&(this._isDraped=e,this.object3dResources.attached=this.attached&&!e,this.drapedResources.attached=this.attached&&e)}get renderGroup(){return this.drapedResources.renderGroup}set renderGroup(e){this.drapedResources.renderGroup=e}createResources(){this.object3dResources.attached=!this._isDraped,this.drapedResources.attached=this._isDraped}destroyResources(){this.object3dResources.attached=!1,this.drapedResources.attached=!1}recreate(){this.object3dResources.recreate(),this.drapedResources.recreate()}recreateGeometry(){this.object3dResources.recreateGeometry(),this.drapedResources.recreateGeometry()}destroy(){this.object3dResources.destroy(),this.drapedResources.destroy(),super.destroy()}updateVisibility(e){this.object3dResources.visible=e,this.drapedResources.visible=e}}var pe=n(65420),fe=n(46671),ge=n(74174),me=n(1092),_e=n(82547),ve=n(34615),ye=n(82273),be=n(54204),Te=n(57087);class xe extends ye.w{constructor(e,t,i){super(e,t,new ve.$(me.a,(()=>n.e(3557).then(n.bind(n,42132)))),i)}initializePipeline(e){switch(e.blitMode){case be.d.None:case be.d.Depth:return(0,Te.Ey)({colorWrite:Te.kn});case be.d.Alpha:return(0,Te.Ey)({blending:Te.Ky,colorWrite:Te.kn});default:(0,_e.Xb)(e.blitMode);case be.d.PremultipliedAlpha:case be.d.COUNT:return(0,Te.Ey)({blending:Te.Os,colorWrite:Te.kn})}}}var we=n(85456);class Se{constructor(e,t=be.d.None){this._techniques=e,this._parameters=new me.C,this._configuration=new be.N,this._configuration.blitMode=t,e.precompile(xe,this._configuration)}blit(e,t,n,i){e.bindFramebuffer(n.fbo),e.setClearColor(0,0,0,1),e.clear(we.NV.COLOR),this._parameters.texture=t.getTexture();const r=this._techniques.acquire(xe,this._configuration);e.bindTechnique(r,i,this._parameters),e.screen.draw(),r.release()}blend(e,t,n,i,r=1){this._configuration.hasOpacityFactor=r<1;const o=this._techniques.acquire(xe,this._configuration);return o.compiled?(e.bindFramebuffer(n.fbo),this._parameters.texture=t.getTexture(),this._parameters.opacity=r,e.bindTechnique(o,i,this._parameters),e.screen.draw(),o.release(),!0):(o.release(),!1)}}var Ee=n(50240),Ae=n(69550),Me=n(65856),Oe=n(39506),Re=n(96500);class Ce extends Oe.Y{constructor(){super(...arguments),this.innerColor=(0,d.fA)(1,1,1),this.innerWidth=1,this.glowColor=(0,d.fA)(1,.5,0),this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=.75,this.globalAlphaContrastBoost=2,this.angleCutoff=(0,b.kU)(6),this.pointDistanceOrigin=(0,d.vt)(),this.pointDistanceTarget=(0,d.vt)(),this.lineVerticalPlaneSegment=(0,J.vt)(),this.intersectsLineSegment=(0,J.vt)(),this.intersectsLineRadius=3,this.heightManifoldTarget=(0,d.vt)(),this.lineStartWorld=(0,d.vt)(),this.lineEndWorld=(0,d.vt)()}}class Ie extends ye.w{constructor(e,t,i){super(e,t,new ve.$(Re.L,(()=>n.e(3824).then(n.bind(n,62372)))),i)}}var Pe=n(65839),De=n(58054);class Le extends Ce{constructor(){super(...arguments),this.origin=(0,d.vt)()}}class Ne extends ye.w{constructor(e,t,i){super(e,t,new ve.$(De.L,(()=>n.e(2436).then(n.bind(n,28374)))),i,Fe)}}const Fe=new Map([[Pe.r.START,0],[Pe.r.END,1],[Pe.r.EXTRUDE,2],[Pe.r.START_UP,3],[Pe.r.END_UP,4]]);var ze=n(69445),He=n(86305);class Ve{constructor(e){this._renderCoordsHelper=e,this._buffers=null,this._origin=(0,d.vt)(),this._dirty=!1,this._count=0,this._vao=null}set vertices(e){const t=(0,Ee.jh)(3*e.length);let n=0;for(const i of e)t[n++]=i[0],t[n++]=i[1],t[n++]=i[2];this.buffers=[t]}set buffers(e){if(this._buffers=e,this._buffers.length>0){const e=this._buffers[0],t=3*Math.floor(e.length/3/2);(0,h.i)(this._origin,e[t],e[t+1],e[t+2])}else(0,h.i)(this._origin,0,0,0);this._dirty=!0}get origin(){return this._origin}draw(e){const t=this._ensureVAO(e);null!=t&&(e.bindVAO(t),e.drawArrays(we.WR.TRIANGLES,0,this._count))}dispose(){null!=this._vao&&this._vao.dispose()}get _layout(){return this._renderCoordsHelper.viewingMode===pe.RT.Global?Ge:$e}_ensureVAO(e){return null==this._buffers?null:(this._vao??=this._createVAO(e,this._buffers),this._ensureVertexData(this._vao,this._buffers),this._vao)}_createVAO(e,t){const n=this._createDataBuffer(t);return this._dirty=!1,new ze.Z(e,Fe,new Map([["data",(0,Ae.U)(this._layout)]]),new Map([["data",He.g.createVertex(e,we._U.STATIC_DRAW,n)]]))}_ensureVertexData(e,t){if(!this._dirty)return;const n=this._createDataBuffer(t);e.vertexBuffers.get("data")?.setData(n),this._dirty=!1}_createDataBuffer(e){const t=e.reduce(((e,t)=>e+Ue(t)),0);this._count=t;const n=this._layout.createBuffer(t),i=this._origin;let r=0,o=0;const s="startUp"in n?this._setUpVectors.bind(this,n):void 0;for(const t of e){for(let e=0;e<t.length;e+=3){const a=(0,h.i)(Be,t[e],t[e+1],t[e+2]);0===e?o=this._renderCoordsHelper.getAltitude(a):this._renderCoordsHelper.setAltitude(a,o);const l=r+2*e;s?.(e,l,t,a);const c=(0,h.d)(Be,a,i);if(e<t.length-3){for(let e=0;e<6;e++)n.start.setVec(l+e,c);n.extrude.setValues(l,0,-1),n.extrude.setValues(l+1,1,-1),n.extrude.setValues(l+2,1,1),n.extrude.setValues(l+3,0,-1),n.extrude.setValues(l+4,1,1),n.extrude.setValues(l+5,0,1)}if(e>0)for(let e=-6;e<0;e++)n.end.setVec(l+e,c)}r+=Ue(t)}return n.buffer}_setUpVectors(e,t,n,i,r){const o=this._renderCoordsHelper.worldUpAtPosition(r,ke);if(t<i.length-3)for(let t=0;t<6;t++)e.startUp.setVec(n+t,o);if(t>0)for(let t=-6;t<0;t++)e.endUp.setVec(n+t,o)}}function Ue(e){return 2*(e.length/3-1)*3}const ke=(0,d.vt)(),Be=(0,d.vt)(),Ge=(0,Me.BP)().vec3f(Pe.r.START).vec3f(Pe.r.END).vec2f(Pe.r.EXTRUDE).vec3f(Pe.r.START_UP).vec3f(Pe.r.END_UP),$e=(0,Me.BP)().vec3f(Pe.r.START).vec3f(Pe.r.END).vec2f(Pe.r.EXTRUDE);var je=n(65875);class Ze extends je.K{constructor(){super(...arguments),this.contrastControlEnabled=!1,this.spherical=!1}}(0,i._)([(0,je.W)()],Ze.prototype,"contrastControlEnabled",void 0),(0,i._)([(0,je.W)()],Ze.prototype,"spherical",void 0);class We extends Ze{constructor(){super(...arguments),this.heightManifoldEnabled=!1,this.pointDistanceEnabled=!1,this.lineVerticalPlaneEnabled=!1,this.intersectsLineEnabled=!1}}(0,i._)([(0,je.W)()],We.prototype,"heightManifoldEnabled",void 0),(0,i._)([(0,je.W)()],We.prototype,"pointDistanceEnabled",void 0),(0,i._)([(0,je.W)()],We.prototype,"lineVerticalPlaneEnabled",void 0),(0,i._)([(0,je.W)()],We.prototype,"intersectsLineEnabled",void 0);var qe=n(54407),Ye=n(84887);let Xe=class extends ge.A{constructor(e){super(e),this.produces=fe.OG.LASERLINES,this.consumes={required:[fe.OG.LASERLINES,"normals"]},this.requireGeometryDepth=!0,this._configuration=new We,this._pathTechniqueConfiguration=new Ze,this._heightManifoldEnabled=!1,this._pointDistanceEnabled=!1,this._lineVerticalPlaneEnabled=!1,this._intersectsLineEnabled=!1,this._intersectsLineInfinite=!1,this._pathVerticalPlaneEnabled=!1,this._passParameters=new Le;const t=e.view._stage.renderView.techniques,n=new Ze;n.contrastControlEnabled=e.contrastControlEnabled,t.precompile(Ne,n)}initialize(){this._passParameters.renderCoordsHelper=this.view.renderCoordsHelper,this._pathTechniqueConfiguration.spherical=this.view.state.viewingMode===pe.RT.Global,this._pathTechniqueConfiguration.contrastControlEnabled=this.contrastControlEnabled,this._techniques.precompile(Ne,this._pathTechniqueConfiguration),this._blit=new Se(this._techniques,be.d.PremultipliedAlpha)}destroy(){this._pathVerticalPlaneData=(0,s.WD)(this._pathVerticalPlaneData),this._blit=null}get _techniques(){return this.view._stage.renderView.techniques}get heightManifoldEnabled(){return this._heightManifoldEnabled}set heightManifoldEnabled(e){this._heightManifoldEnabled!==e&&(this._heightManifoldEnabled=e,this.requestRender(qe.C7.UPDATE))}get heightManifoldTarget(){return this._passParameters.heightManifoldTarget}set heightManifoldTarget(e){(0,h.c)(this._passParameters.heightManifoldTarget,e),this.requestRender(qe.C7.UPDATE)}get pointDistanceEnabled(){return this._pointDistanceEnabled}set pointDistanceEnabled(e){e!==this._pointDistanceEnabled&&(this._pointDistanceEnabled=e,this.requestRender(qe.C7.UPDATE))}get pointDistanceTarget(){return this._passParameters.pointDistanceTarget}set pointDistanceTarget(e){(0,h.c)(this._passParameters.pointDistanceTarget,e),this.requestRender(qe.C7.UPDATE)}get pointDistanceOrigin(){return this._passParameters.pointDistanceOrigin}set pointDistanceOrigin(e){(0,h.c)(this._passParameters.pointDistanceOrigin,e),this.requestRender(qe.C7.UPDATE)}get lineVerticalPlaneEnabled(){return this._lineVerticalPlaneEnabled}set lineVerticalPlaneEnabled(e){e!==this._lineVerticalPlaneEnabled&&(this._lineVerticalPlaneEnabled=e,this.requestRender(qe.C7.UPDATE))}get lineVerticalPlaneSegment(){return this._passParameters.lineVerticalPlaneSegment}set lineVerticalPlaneSegment(e){(0,J.C)(e,this._passParameters.lineVerticalPlaneSegment),this.requestRender(qe.C7.UPDATE)}get intersectsLineEnabled(){return this._intersectsLineEnabled}set intersectsLineEnabled(e){e!==this._intersectsLineEnabled&&(this._intersectsLineEnabled=e,this.requestRender(qe.C7.UPDATE))}get intersectsLineSegment(){return this._passParameters.intersectsLineSegment}set intersectsLineSegment(e){(0,J.C)(e,this._passParameters.intersectsLineSegment),this.requestRender(qe.C7.UPDATE)}get intersectsLineRadius(){return this._passParameters.intersectsLineRadius}set intersectsLineRadius(e){e!==this._passParameters.intersectsLineRadius&&(this._passParameters.intersectsLineRadius=e,this.requestRender(qe.C7.UPDATE))}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(e){e!==this._intersectsLineInfinite&&(this._intersectsLineInfinite=e,this.requestRender(qe.C7.UPDATE))}get pathVerticalPlaneEnabled(){return this._pathVerticalPlaneEnabled}set pathVerticalPlaneEnabled(e){e!==this._pathVerticalPlaneEnabled&&(this._pathVerticalPlaneEnabled=e,null!=this._pathVerticalPlaneData&&this.requestRender(qe.C7.UPDATE))}set pathVerticalPlaneVertices(e){null==this._pathVerticalPlaneData&&(this._pathVerticalPlaneData=new Ve(this._passParameters.renderCoordsHelper)),this._pathVerticalPlaneData.vertices=e,this.pathVerticalPlaneEnabled&&this.requestRender(qe.C7.UPDATE)}set pathVerticalPlaneBuffers(e){null==this._pathVerticalPlaneData&&(this._pathVerticalPlaneData=new Ve(this._passParameters.renderCoordsHelper)),this._pathVerticalPlaneData.buffers=e,this.pathVerticalPlaneEnabled&&this.requestRender(qe.C7.UPDATE)}setParameters(e){(0,Ye.MB)(this._passParameters,e)&&this.requestRender(qe.C7.UPDATE)}precompile(){this._acquireTechnique().release()}render(e){const t=e.find((({name:e})=>e===fe.OG.LASERLINES));if(!this.bindParameters.decorations||null==this._blit)return t;const n=this.renderingContext,i=e.find((({name:e})=>"normals"===e));this._passParameters.normals=i?.getTexture();const r=()=>{(this.heightManifoldEnabled||this.pointDistanceEnabled||this.lineVerticalPlaneSegment||this.intersectsLineEnabled)&&this._renderUnified(),this.pathVerticalPlaneEnabled&&this._renderPath()};if(!this.contrastControlEnabled)return n.bindFramebuffer(t.fbo),r(),t;this._passParameters.colors=t.getTexture();const o=this.fboCache.acquire(t.fbo.width,t.fbo.height,"laser lines");return n.bindFramebuffer(o.fbo),n.setClearColor(0,0,0,0),n.clear(we.NV.COLOR|we.NV.DEPTH),r(),n.unbindTexture(t.getTexture()),this._blit.blend(n,o,t,this.bindParameters)||this.requestRender(qe.C7.UPDATE),o.release(),t}_acquireTechnique(){return this._configuration.heightManifoldEnabled=this.heightManifoldEnabled,this._configuration.lineVerticalPlaneEnabled=this.lineVerticalPlaneEnabled,this._configuration.pointDistanceEnabled=this.pointDistanceEnabled,this._configuration.intersectsLineEnabled=this.intersectsLineEnabled,this._configuration.contrastControlEnabled=this.contrastControlEnabled,this._configuration.spherical=this.view.state.viewingMode===pe.RT.Global,this._techniques.acquire(Ie,this._configuration)}_renderUnified(){if(!this._updatePassParameters())return;const e=this._acquireTechnique();if(e.compiled){const t=this.renderingContext;t.bindTechnique(e,this.bindParameters,this._passParameters),t.screen.draw()}else this.requestRender(qe.C7.UPDATE);e.release()}_renderPath(){if(null==this._pathVerticalPlaneData)return;const e=this._techniques.acquire(Ne,this._pathTechniqueConfiguration);if(e.compiled){const t=this.renderingContext;this._passParameters.origin=this._pathVerticalPlaneData.origin,t.bindTechnique(e,this.bindParameters,this._passParameters),this._pathVerticalPlaneData.draw(t)}else this.requestRender(qe.C7.UPDATE);e.release()}_updatePassParameters(){if(!this._intersectsLineEnabled)return!0;const e=this.bindParameters.camera,t=this._passParameters;if(this._intersectsLineInfinite){if((0,Q.$e)((0,ee.LV)(t.intersectsLineSegment.origin,t.intersectsLineSegment.vector),Qe),Qe.c0=-Number.MAX_VALUE,!(0,K.ig)(e.frustum,Qe))return!1;(0,Q.j1)(Qe,t.lineStartWorld),(0,Q.mO)(Qe,t.lineEndWorld)}else(0,h.c)(t.lineStartWorld,t.intersectsLineSegment.origin),(0,h.g)(t.lineEndWorld,t.intersectsLineSegment.origin,t.intersectsLineSegment.vector);return!0}get test(){}};(0,i._)([(0,l.MZ)({constructOnly:!0})],Xe.prototype,"contrastControlEnabled",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0})],Xe.prototype,"isDecoration",void 0),(0,i._)([(0,l.MZ)()],Xe.prototype,"produces",void 0),(0,i._)([(0,l.MZ)()],Xe.prototype,"consumes",void 0),Xe=(0,i._)([(0,u.$)("esri.views.3d.webgl-engine.effects.laserlines.LaserLineRenderer")],Xe);const Qe=(0,Q.vt)();class Ke extends ae{constructor(e){super(e),this._angleCutoff=Re.d,this._style={},this._heightManifoldTarget=(0,d.vt)(),this._heightManifoldEnabled=!1,this._intersectsLine=(0,J.vt)(),this._intersectsLineEnabled=!1,this._intersectsLineInfinite=!1,this._lineVerticalPlaneSegment=null,this._pathVerticalPlaneBuffers=null,this._pointDistanceLine=null,this.applyProperties(e)}get testData(){}createResources(){this._ensureRenderer()}destroyResources(){this._disposeRenderer()}updateVisibility(){this._syncRenderer(),this._syncHeightManifold(),this._syncIntersectsLine(),this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance()}get angleCutoff(){return this._angleCutoff}set angleCutoff(e){this._angleCutoff!==e&&(this._angleCutoff=e,this._syncAngleCutoff())}get style(){return this._style}set style(e){this._style=e,this._syncStyle()}get heightManifoldTarget(){return this._heightManifoldEnabled?this._heightManifoldTarget:null}set heightManifoldTarget(e){null!=e?((0,h.c)(this._heightManifoldTarget,e),this._heightManifoldEnabled=!0):this._heightManifoldEnabled=!1,this._syncRenderer(),this._syncHeightManifold()}set intersectsWorldUpAtLocation(e){if(null==e)return void(this.intersectsLine=null);const t=this.view.renderCoordsHelper.worldUpAtPosition(e,Je);this.intersectsLine=(0,J.fA)(e,t),this.intersectsLineInfinite=!0}get intersectsLine(){return this._intersectsLineEnabled?this._intersectsLine:null}set intersectsLine(e){null!=e?((0,J.C)(e,this._intersectsLine),this._intersectsLineEnabled=!0):this._intersectsLineEnabled=!1,this._syncIntersectsLine(),this._syncRenderer()}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(e){this._intersectsLineInfinite=e,this._syncIntersectsLineInfinite()}get lineVerticalPlaneSegment(){return this._lineVerticalPlaneSegment}set lineVerticalPlaneSegment(e){this._lineVerticalPlaneSegment=null!=e?(0,J.C)(e):null,this._syncLineVerticalPlane(),this._syncRenderer()}get pathVerticalPlane(){return this._pathVerticalPlaneBuffers}set pathVerticalPlane(e){this._pathVerticalPlaneBuffers=e,this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance(),this._syncRenderer()}get pointDistanceLine(){return this._pointDistanceLine}set pointDistanceLine(e){this._pointDistanceLine=null!=e?{origin:(0,d.o8)(e.origin),target:e.target?(0,d.o8)(e.target):null}:null,this._syncPointDistance(),this._syncRenderer()}_syncRenderer(){this.attached&&this.visible&&(this._intersectsLineEnabled||this._heightManifoldEnabled||null!=this._pointDistanceLine||null!=this._pathVerticalPlaneBuffers)?this._ensureRenderer():this._disposeRenderer()}_ensureRenderer(){null==this._renderer&&(this._renderer=new Xe({view:this.view,contrastControlEnabled:!0,isDecoration:this.isDecoration}),this._syncStyle(),this._syncHeightManifold(),this._syncIntersectsLine(),this._syncIntersectsLineInfinite(),this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance(),this._syncAngleCutoff())}_syncStyle(){null!=this._renderer&&(this._renderer.setParameters(this._style),null!=this._style.intersectsLineRadius&&(this._renderer.intersectsLineRadius=this._style.intersectsLineRadius))}_syncAngleCutoff(){null!=this._renderer&&this._renderer.setParameters({angleCutoff:this._angleCutoff})}_syncHeightManifold(){null!=this._renderer&&(this._renderer.heightManifoldEnabled=this._heightManifoldEnabled&&this.visible,this._heightManifoldEnabled&&(this._renderer.heightManifoldTarget=this._heightManifoldTarget))}_syncIntersectsLine(){null!=this._renderer&&(this._renderer.intersectsLineEnabled=this._intersectsLineEnabled&&this.visible,this._intersectsLineEnabled&&(this._renderer.intersectsLineSegment=this._intersectsLine))}_syncIntersectsLineInfinite(){null!=this._renderer&&(this._renderer.intersectsLineInfinite=this._intersectsLineInfinite)}_syncPathVerticalPlane(){null!=this._renderer&&(this._renderer.pathVerticalPlaneEnabled=null!=this._pathVerticalPlaneBuffers&&this.visible,null!=this._pathVerticalPlaneBuffers&&(this._renderer.pathVerticalPlaneBuffers=this._pathVerticalPlaneBuffers))}_syncLineVerticalPlane(){null!=this._renderer&&(this._renderer.lineVerticalPlaneEnabled=null!=this._lineVerticalPlaneSegment&&this.visible,null!=this._lineVerticalPlaneSegment&&(this._renderer.lineVerticalPlaneSegment=this._lineVerticalPlaneSegment))}_syncPointDistance(){if(null==this._renderer)return;const e=this._pointDistanceLine,t=null!=e;this._renderer.pointDistanceEnabled=t&&null!=e.target&&this.visible,t&&(this._renderer.pointDistanceOrigin=e.origin,null!=e.target&&(this._renderer.pointDistanceTarget=e.target))}_disposeRenderer(){null!=this._renderer&&this.view._stage&&(this._renderer.destroy(),this._renderer=null)}}const Je=(0,d.vt)();var et=n(58704),tt=n(8470),nt=n(24100),it=n(15389),rt=n(65352);class ot extends de{constructor(e){super(e),this._ray=(0,ee.vt)(),this._isWorldDown=!1,this._start=(0,d.vt)(),this._end=(0,d.fA)(1,0,0),this._width=1,this._color=(0,X.fA)(1,0,1,1),this._polygonOffset=!1,this._writeDepthEnabled=!0,this._innerWidth=0,this._innerColor=(0,X.fA)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._stipplePreferContinuous=!0,this._falloff=0,this._extensionType=ht.LINE,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=nt.m$.OccludeAndTransparent,this._fadedExtensions=ft,this._laserline=new Ke({view:this.view,isDecoration:e.isDecoration}),this.applyProperties(e)}destroy(){this._laserline.destroy(),super.destroy()}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:st,recreateGeometry:(e,t)=>this._recreateObject3DGeometry(e,t),cameraChanged:()=>this._updateGeometry()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:st,recreateGeometry:e=>this._recreateDrapedGeometry(e)}}updateVisibility(e){super.updateVisibility(e),this._laserline.visible=e}onAttachedChange(){this._laserline.attached=this._laserlineAttached}setStartEndFromWorldDownAtLocation(e){this._isWorldDown=!0,(0,h.c)(this._start,e),this.view.renderCoordsHelper.worldUpAtPosition(e,this._end),(0,h.d)(this._end,e,this._end),(0,ee.Cr)(this._start,this._end,this._ray),this._updateGeometry()}get start(){return this._start}set start(e){this._isWorldDown=!1,(0,h.p)(this._start,e)||((0,h.c)(this._start,e),(0,ee.Cr)(this._start,this._end,this._ray),this._updateGeometry())}get end(){return this._end}set end(e){this._isWorldDown=!1,(0,h.p)(this._end,e)||((0,h.c)(this._end,e),(0,ee.Cr)(this._start,this._end,this._ray),this._updateGeometry())}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){(0,Y.a)(e,this._color)||((0,Y.c)(this._color,e),this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){e!==this._polygonOffset&&(this._polygonOffset=e,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){(0,Y.a)(e,this._innerColor)||((0,Y.c)(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=null!=e!=(null!=this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){null!=e&&null!=this._stippleOffColor&&(0,Y.a)(e,this._stippleOffColor)||(this._stippleOffColor=null!=e?(0,X.o8)(e):null,this._updateMaterial())}get stipplePreferContinuous(){return this._stipplePreferContinuous}set stipplePreferContinuous(e){e!==this._stipplePreferContinuous&&(this._stipplePreferContinuous=e,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get extensionType(){return this._extensionType}set extensionType(e){e!==this._extensionType&&(this._extensionType=e,this.recreateGeometry())}get _laserlineAttached(){return this._laserlineEnabled&&null!=this._laserlineStyle&&this.attached&&!this.isDraped}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this._laserlineAttached,null!=e&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===nt.m$.OccludeAndTransparentStencil?nt.m$.OccludeAndTransparent:this._renderOccluded}get fadedExtensions(){return this._fadedExtensions}set fadedExtensions(e){this._fadedExtensions=e??ft,this.recreateGeometry()}_updateMaterial(){const{materialParameters:e}=this;this.object3dResources.resources?.material.setParameters(e),this.drapedResources.resources?.material.setParameters(e)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,hasPolygonOffset:this._polygonOffset,renderOccluded:this._normalizedRenderOccluded,isDecoration:this.isDecoration,writeDepth:this._writeDepthEnabled}}_createObject3DResources(e){const t=new rt.W(this.materialParameters),n=new Array;return this._createObject3DGeometry(t,e,n),{material:t,geometries:n,forEach:e=>{e(t),n.forEach(e)}}}_recreateObject3DGeometry(e,t){e.geometries.length=0,this._createObject3DGeometry(e.material,t,e.geometries)}_createObject3DGeometry(e,t,n){const i=this._createGeometry(e);n.push(i),t.addGeometry(i),this._updateVerticesObject3D(t)}_createDrapedResources(){const e=new rt.W(this.materialParameters);return{material:e,geometries:[this._createDrapedGeometry(e)]}}_recreateDrapedGeometry(e){e.geometries=[this._createDrapedGeometry(e.material)]}_createDrapedGeometry(e){const t=this._createGeometry(e);return this._updateVerticesDraped(t),new it.$(t)}_createGeometry(e){const t=this.extensionType===ht.FADED,n=t?[(0,d.vt)(),(0,d.vt)(),(0,d.vt)(),(0,d.vt)()]:[(0,d.vt)(),(0,d.vt)()];return(0,tt.Z8)(e,n,null,t?[1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]:null)}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{const e=this.object3dResources.object;e&&this._updateVerticesObject3D(e)}}_updateVerticesObject3D(e){const t=this._lineSegment;this._updateVertexAttributesObject3D(e,t),this._laserline.intersectsLine=t}_updateVerticesDraped(e){this._updateVertexAttributesDraped(e,this._lineSegment)}get _lineSegment(){return this._extensionType===ht.FADED?this._updateLineSegmentFinite(ut):this._updateLineSegmentInfinite(this._extensionType,ut)}_updateLineSegmentFinite(e){return(0,J.Cr)(this._start,this._end,e)}_updateLineSegmentInfinite(e,t){const n=this.view.state.camera;switch((0,Q.$e)(this._ray,at),e){case ht.LINE:at.c0=-Number.MAX_VALUE;break;case ht.RAY:case ht.GROUND_RAY:{const e=this._ray.origin,t=this.view.elevationProvider.getElevation(e[0],e[1],e[2],this.view.renderCoordsHelper.spatialReference,"ground")??0,n=this.view.renderCoordsHelper.getAltitude(e);this._isWorldDown&&n<t&&(0,h.v)(at.ray.direction,at.ray.direction),this._extensionType===ht.GROUND_RAY&&null!=t&&(at.c1=Math.abs(n-t));break}}if(!(0,K.ig)(n.frustum,at))return this._updateLineSegmentFinite(t);const i=(0,Q.j1)(at,lt),r=(0,Q.mO)(at,ct);return(0,J.Cr)(i,r,t)}_updateVertexAttributesObject3D(e,t){const n=e.geometries[0].getMutableAttribute(Pe.r.POSITION)?.data;if(!n)return;let i=0;for(const e of this._lineVertices(t))n[i++]=e[0],n[i++]=e[1],n[i++]=e[2];e.geometryVertexAttributeUpdated(e.geometries[0],Pe.r.POSITION)}_updateVertexAttributesDraped(e,t){const n=e.getMutableAttribute(Pe.r.POSITION)?.data;if(!n)return;let i=0;for(const e of this._lineVertices(t))n[i++]=e[0],n[i++]=e[1],n[i++]=et.bi;e.invalidateBoundingInfo()}*_lineVertices(e){this.extensionType===ht.FADED?(yield(0,J.sd)(e,-this.fadedExtensions.start,lt),yield(0,J.sd)(e,0,lt),yield(0,J.sd)(e,1,lt),yield(0,J.sd)(e,1+this.fadedExtensions.end,lt)):(yield(0,J.sd)(e,0,lt),yield(0,J.sd)(e,1,lt))}}function st(e){e.geometries=[]}const at=(0,Q.vt)(),lt=(0,d.vt)(),ct=(0,d.vt)(),ut=(0,J.vt)();var ht,dt;(dt=ht||(ht={}))[dt.LINE=0]="LINE",dt[dt.RAY=1]="RAY",dt[dt.GROUND_RAY=2]="GROUND_RAY",dt[dt.FADED=3]="FADED";const pt=1/3,ft={start:pt,end:pt};var gt=n(46460);class mt extends de{constructor(e){super(e),this._location=(0,d.vt)(),this._direction=(0,d.fA)(1,0,0),this._width=1,this._offset=1,this._length=18,this._color=(0,X.fA)(1,0,1,1),this._renderOccluded=nt.m$.OccludeAndTransparent,this.applyProperties(e)}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:yt,recreateGeometry:(e,t)=>this._recreateObject3DGeometry(e,t),cameraChanged:()=>this._updateGeometry()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:bt,recreateGeometry:e=>this._recreateDrapedGeometry(e)}}get location(){return this._location}set location(e){(0,h.p)(this._location,e)||((0,h.c)(this._location,e),this._updateGeometry())}get direction(){return this._direction}set direction(e){(0,h.p)(this._direction,e)||((0,h.c)(this._direction,e),this._updateGeometry())}setDirectionFromPoints(e,t){(0,h.n)(this._direction,(0,h.d)(this._direction,t,e)),this._updateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get offset(){return this._offset}set offset(e){e!==this._offset&&(this._offset=e,this._updateGeometry())}get length(){return this._length}set length(e){e!==this._length&&(this._length=e,this._updateGeometry())}get color(){return this._color}set color(e){(0,Y.a)(e,this._color)||((0,Y.c)(this._color,e),this._updateMaterial())}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}_createObject3DResources(e){const t=new rt.W(this.materialParameters),n=new Array;return this._createObject3DGeometry(t,e,n),{material:t,geometries:n,forEach:e=>{e(t),n.forEach(e)}}}_recreateObject3DGeometry(e,t){e.geometries.length=0,this._createObject3DGeometry(e.material,t,e.geometries)}_createObject3DGeometry(e,t,n){const[i,r]=_t(e);t.addGeometry(i),t.addGeometry(r),n.push(i),n.push(r),this._updateVerticesObject3D(t)}_createDrapedResources(){const e=new rt.W(this.materialParameters),t=(0,a.watch)((()=>this.view.state.contentPixelRatio),(()=>{this.drapedResources.recreateGeometry()}));return{material:e,geometries:this._createDrapedGeometry(e),pixelRatioHandle:t}}_recreateDrapedGeometry(e){e.geometries=this._createDrapedGeometry(e.material)}_createDrapedGeometry(e){const t=_t(e);return this._updateVerticesDraped(t),t.map((e=>new it.$(e)))}_updateMaterial(){const{materialParameters:e}=this;this.object3dResources.resources?.material.setParameters(e),this.drapedResources.resources?.material.setParameters(e)}get materialParameters(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{const e=this.object3dResources.object;e&&this._updateVerticesObject3D(e)}}_updateVerticesObject3D(e){const t=this.view.state.camera;t.projectToScreen(this.location,Et),(0,h.g)(Tt,this.location,this.direction),t.projectToScreen(Tt,At),(0,w.S8)(At,(0,w.Re)(At,At,Et)),this._updateVertexAttributesObject3D(t,e,0,Et,At,1),this._updateVertexAttributesObject3D(t,e,1,Et,At,-1)}_updateVertexAttributesObject3D(e,t,n,i,r,o){const s=t.geometries[n],a=s.getMutableAttribute(Pe.r.POSITION)?.data;if(!a)return;const{start:l,end:c}=vt(r,i,o,this.offset,this.width,this.length);e.unprojectFromScreen((0,g.PR)(l),Tt),a[0]=Tt[0],a[1]=Tt[1],a[2]=Tt[2],e.unprojectFromScreen((0,g.PR)(c),Tt),a[3]=Tt[0],a[4]=Tt[1],a[5]=Tt[2],t.geometryVertexAttributeUpdated(s,Pe.r.POSITION)}_updateVerticesDraped(e){const{view:{basemapTerrain:{overlayManager:t},state:{contentPixelRatio:n}}}=this,{location:i,width:r,length:o,offset:s}=this,a=Mt;a.spatialReference=t.renderer.spatialReference,a.x=i[0],a.y=i[1];const l=this.view.overlayPixelSizeInMapUnits(a)*n,c=r*l,u=o*l,h=s*l;this._updateVertexAttributesDraped(e[0],c,u,h,-1),this._updateVertexAttributesDraped(e[1],c,u,h,1)}_updateVertexAttributesDraped(e,t,n,i,r){const o=e.getMutableAttribute(Pe.r.POSITION)?.data;if(!o)return;const{location:s,direction:a}=this,{start:l,end:c}=vt(a,s,r,i,t,n);o[0]=l[0],o[1]=l[1],o[2]=et.bi,o[3]=c[0],o[4]=c[1],o[5]=et.bi,e.invalidateBoundingInfo()}}function _t(e){return[(0,tt.Z8)(e,[(0,d.vt)(),(0,d.vt)()]),(0,tt.Z8)(e,[(0,d.vt)(),(0,d.vt)()])]}function vt(e,t,n,i,r,o){const s=(0,w.hs)(xt,(0,w.hZ)(xt,e[1]*n,e[0]*-n),i+r/2),a=(0,w.WQ)(wt,(0,w.WQ)(wt,(0,w.WQ)(wt,t,(0,w.hs)(wt,e,o/2)),s),s);return{start:a,end:(0,w.WQ)(St,a,(0,w.hs)(St,e,-o))}}function yt(e){e.geometries.length=0}function bt(e){e.pixelRatioHandle.remove(),e.geometries=[]}const Tt=(0,d.vt)(),xt=(0,S.vt)(),wt=(0,S.vt)(),St=(0,S.vt)(),Et=(0,g.gs)(),At=(0,g.gs)(),Mt=(0,gt.T)(0,0,void 0,null);var Ot=n(24761),Rt=n(73364),Ct=n(39714);class It extends ae{constructor(e){super(e),this._resources=null,this._transform=(0,Ct.vt)()}get object(){return null!=this._resources?this._resources.object:null}get transform(){return this._transform}set transform(e){(0,Rt.C)(this._transform,e),null!=this._resources&&(this._resources.object.transformation=this._transform)}recreate(){this.attached&&this.createResources()}recreateGeometry(){if(null==this._resources)return;const e=this._resources.object,t=this.view._stage;t.removeMany(e.geometries),e.removeAllGeometries(),this.createGeometries(e),e.visible=this.visible,t.addMany(e.geometries)}createResources(){this.destroyResources();const e=this.view._stage;if(!e)return;const t=new ue.x(e,{pickable:!1,updatePolicy:re.q.SYNC}),n=new ce.B({castShadow:!1});n.transformation=this._transform,this.createExternalResources(),this.createGeometries(n),e.addMany(n.geometries),this.forEachExternalMaterial((t=>e.add(t))),e.add(n),t.add(n),n.visible=this.visible,this._resources={layer:t,object:n}}destroyResources(){const e=this.view._stage;null!=this._resources&&e&&(e.remove(this._resources.object),this._resources.layer.destroy(),this.forEachExternalMaterial((t=>{e.remove(t)})),e.removeMany(this._resources.object.geometries),this._resources.object.dispose(),this.destroyExternalResources(),this._resources=null)}updateVisibility(e){null!=this._resources&&(this._resources.object.visible=e)}}var Pt=n(49618),Dt=n(76589),Lt=n(98323),Nt=n(6955);class Ft extends It{constructor(e){super(e),this._material=null,this._texture=null,this._geometry=null,this._size=3,this._color=(0,X.fA)(1,0,1,1),this._pixelSnappingEnabled=!0,this._primitive="square",this._outlineSize=1,this._outlineColor=(0,X.fA)(1,1,1,1),this._elevationInfo=null,this.applyProperties(e)}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get size(){return this._size}set size(e){if(e!==this._size){const t=this._preferredTextureSize;this._size=e,t<this._preferredTextureSize?this.recreate():this._updateSizeAttribute()}}get color(){return this._color}set color(e){(0,Y.a)(e,this._color)||((0,Y.c)(this._color,e),this._updateMaterial())}get pixelSnappingEnabled(){return this._pixelSnappingEnabled}set pixelSnappingEnabled(e){this._pixelSnappingEnabled!==e&&(this._pixelSnappingEnabled=e,this._updateMaterial())}get primitive(){return this._primitive}set primitive(e){this._primitive!==e&&(this._primitive=e,this.recreate())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,Y.a)(e,this._outlineColor)||((0,Y.c)(this._outlineColor,e),this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}_updateMaterial(){this._material?.setParameters(this._materialParameters)}_updateSizeAttribute(){const e=this.object;if(null==e)return;const t=e.geometries[0];if(null==t)return;const n=t.getMutableAttribute(Pe.r.SIZE).data,i=this._geometrySize;n[0]=i,n[1]=i,e.geometryVertexAttributeUpdated(e.geometries[0],Pe.r.SIZE)}get _materialParameters(){return{color:this._color,textureIsSignedDistanceField:!0,sampleSignedDistanceFieldTexelCenter:(0,Lt.ny)(this._primitive),distanceFieldBoundingBox:Ht,occlusionTest:!1,outlineColor:this._outlineColor,outlineSize:this._outlineSize,textureId:this._texture?.id,polygonOffset:!1,shaderPolygonOffset:0,drawInSecondSlot:!0,depthEnabled:!1,pixelSnappingEnabled:this.pixelSnappingEnabled,isDecoration:this.isDecoration}}get _geometrySize(){return this._size/zt}createExternalResources(){this._texture=(0,Lt.sZ)(this._primitive,this._preferredTextureSize),this._material=new Nt.R(this._materialParameters,this.view.state.viewingMode===pe.RT.Global);const e=this.view._stage;this._texture.load(e.renderView.renderingContext),e.add(this._texture)}destroyExternalResources(){this._texture&&(this.view._stage.remove(this._texture),this._texture.dispose(),this._texture=null),this._material=null}createGeometries(e){const t=this._createRenderGeometry();null!=t&&e.addGeometry(t)}forEachExternalMaterial(e){this._material&&e(this._material)}get _preferredTextureSize(){return(0,b.qE)(2*this._geometrySize,16,128)}calculateMapBounds(e){const t=this.object?.geometries[0];if(!t)return!1;const n=t.attributes.get(Pe.r.POSITION).data;return(0,q.F)(n,this.view.renderCoordsHelper.spatialReference,Vt,this.view.spatialReference),(0,Ot.Hq)(e,Vt),!0}_createRenderGeometry(){const{geometry:e,_material:t}=this;if(null==e||null==t)return null;const{renderCoordsHelper:n,elevationProvider:i}=this.view,r=(0,Pt.nG)(e,i,Dt.F.fromElevationInfo(this.elevationInfo),n),o=(0,h.i)(A.rq.get(),e.x,e.y,r),s=A.rq.get();(0,q.F)(o,e.spatialReference,s,n.spatialReference);const a=this._geometrySize;return(0,tt.DJ)(t,null,s,null,null,[a,a],[0,0,0,1])}}const zt=Lt.CN,Ht=[zt/2,zt/2,1-zt/2,1-zt/2],Vt=(0,d.vt)();var Ut=n(14905),kt=n(89769),Bt=n(48042);class Gt extends de{constructor(e){super(e),this._maxSize=0,this._position=(0,d.vt)(),this._up=(0,d.vt)(),this._right=(0,d.vt)(),this._renderOccluded=nt.m$.OccludeAndTransparent,this._color=(0,X.fA)(1,0,0,1),this._outlineColor=(0,X.fA)(0,0,0,1),this._outlineSize=0,this._size=32,this._outlineRenderOccluded=nt.m$.Opaque,this.applyProperties(e)}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:()=>{},cameraChanged:()=>this._updateTransformObject3D()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:$t}}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}get color(){return this._color}set color(e){(0,Y.c)(this._color,e),this._updateQuadMaterial()}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,Y.c)(this._outlineColor,e),this._updateOutlineMaterial()}get outlineSize(){return this._outlineSize}set outlineSize(e){const t=0===this._outlineSize!=(0===e);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateTransform())}get outlineRenderOccluded(){return this._outlineRenderOccluded}set outlineRenderOccluded(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}set geometry({previous:e,center:t,next:n}){this._maxSize=Math.min((0,h.j)(t,e),(0,h.j)(t,n))/3,(0,h.n)(this._up,(0,h.d)(this._up,e,t)),(0,h.n)(this._right,(0,h.d)(this._right,n,t)),(0,h.c)(this._position,t),this.recreateGeometry()}_createObject3DResources(e){const t=new Bt.v(this._quadMaterialParameters),n=0===this._outlineSize?void 0:new rt.W(this._outlineMaterialParameters);return this._createObject3DGeometries(e,t,n),{quadMaterial:t,outlineMaterial:n,forEach:e=>{e(t),n&&e(n)}}}_createObject3DGeometries(e,t,n){if((0,h.p)(this._up,d.uY)&&(0,h.p)(this._right,d.uY))return;const i=this._createGeometries(t,n);for(const t of i)e.addGeometry(t);this._updateTransformObject3D(e)}_createDrapedResources(){const e=new Bt.v(this._quadMaterialParameters),t=0===this._outlineSize?void 0:new rt.W(this._outlineMaterialParameters),n=this._createGeometries(e,t).map((e=>new it.$(e)));return this._setTransformDraped(n),{quadMaterial:e,outlineMaterial:t,geometries:n,pixelRatioHandle:(0,a.watch)((()=>this.view.state.contentPixelRatio),(()=>{this.drapedResources.recreateGeometry()}))}}_createGeometries(e,t){const{up:n,right:i,corner:r}=this._getVertices(),o=function(e,t,n,i){return new kt.V(i,[[Pe.r.POSITION,new Ut.n([0,0,0,...t,...e,...n],[0,1,2,1,2,3],3,!0)]])}(n,i,r,e);return t?[o,(0,tt.Z8)(t,[n,r,i])]:[o]}_getVertices(){let e=this._up,t=this._right;const n=(0,h.g)(A.rq.get(),e,t);return this.isDraped&&(e=(0,h.c)(A.rq.get(),e),t=(0,h.c)(A.rq.get(),t),e[2]=0,t[2]=0,n[2]=0),{up:e,right:t,corner:n}}_updateTransform(){this.isDraped?this.drapedResources.recreateGeometry():this._updateTransformObject3D()}_updateTransformObject3D(e=this.object3dResources.object){if(!e)return;const t=this.view.state.camera,n=this._size*t.computeScreenPixelSizeAt(this._position),i=Math.min(this._maxSize,n);(0,Rt.kN)(jt,this._position),(0,Rt.hs)(jt,jt,[i,i,i]),e.transformation=jt}_setTransformDraped(e){if(0===e.length)return;const{view:{basemapTerrain:{overlayManager:t},state:{contentPixelRatio:n}}}=this,{_position:i,_size:r}=this,o=(0,h.c)(A.rq.get(),i);o[2]=et.bi;const s=Zt;s.spatialReference=t.renderer.spatialReference,s.x=o[0],s.y=o[1];const a=r*(this.view.overlayPixelSizeInMapUnits(s)*n),l=Math.min(this._maxSize,a);(0,Rt.kN)(jt,o),(0,Rt.hs)(jt,jt,[l,l,1]);for(const t of e)t.transformation=jt}get _quadMaterialParameters(){return{color:this._color,forceTransparentMode:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateQuadMaterial(){this.object3dResources.resources?.quadMaterial.setParameters(this._quadMaterialParameters),this.drapedResources.resources?.quadMaterial.setParameters(this._quadMaterialParameters)}get _outlineMaterialParameters(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded,isDecoration:this.isDecoration}}_updateOutlineMaterial(){this.object3dResources.resources?.outlineMaterial?.setParameters(this._outlineMaterialParameters),this.drapedResources.resources?.outlineMaterial?.setParameters(this._outlineMaterialParameters)}}function $t(e){e.pixelRatioHandle.remove(),e.geometries=[]}const jt=(0,Ct.vt)(),Zt=(0,gt.T)(0,0,void 0,null);var Wt=n(28397),qt=n(21267),Yt=n(34618),Xt=n(44425),Qt=n(21858),Kt=n(64330);class Jt extends Qt.b{sortUniqueHints(e){return e.sort(((e,t)=>(t instanceof Kt.c?t.length:0)-(e instanceof Kt.c?e.length:0)))}visualizeIntersectionPoint(e,t){const{spatialReference:n,view:i}=t,r=en(t);return(0,o.DQ)(new Ft({view:i,primitive:"circle",geometry:(0,Wt.io)(e.intersectionPoint,n),elevationInfo:e.isDraped?p.Tq:p.qt,size:20,outlineSize:2,color:r.intersectionPointColor,outlineColor:r.intersectionPointOutlineColor,pixelSnappingEnabled:!1,isDecoration:!0,attached:!0}))}visualizePoint(e,t){const{view:n,spatialReference:i}=t,r=en(t),s=tn(e.point,e.domain,t);return(0,o.DQ)(new Ft({view:n,primitive:"circle",geometry:(0,Wt.io)(s,i),elevationInfo:nn(e),size:20,outlineSize:2,color:r.pointColor,outlineColor:r.pointOutlineColor,pixelSnappingEnabled:!1,isDecoration:!0,attached:!0}))}visualizeLine(e,t){const{view:n,spatialReference:i}=t,r=en(t),s=tn(e.lineStart,e.domain,t),a=tn(e.lineEnd,e.domain,t);return(0,o.DQ)(function(e,t,n,i,r,o,s,a=!1,l=!0,c=!0){const u=rn(t,i,r,o,a),h=rn(n,i,r,o,a),d=new ot({view:o,extensionType:ht.FADED,start:u,end:h,isDraped:a,color:s.lineColor,renderOccluded:a?nt.m$.OccludeAndTransparent:nt.m$.Opaque,renderGroup:ne.O7.SnappingHint,isDecoration:!0});switch(e){case Xt.H3.TARGET:d.width=qt.N.lineHintWidthTarget,d.fadedExtensions={start:0,end:qt.N.lineHintFadedExtensions};break;case Xt.H3.REFERENCE_EXTENSION:d.width=qt.N.lineHintWidthReference,d.fadedExtensions={start:0,end:0};break;case Xt.H3.REFERENCE:d.width=qt.N.lineHintWidthReference,d.fadedExtensions={start:l?qt.N.lineHintFadedExtensions:0,end:c?qt.N.lineHintFadedExtensions:0}}return d.attached=!0,d}(e.type,s,a,i,nn(e),n,r,e.isDraped,e.fadeLeft,e.fadeRight))}visualizeParallelSign(e,t){const{view:n,spatialReference:i}=t,r=en(t),{isDraped:s}=e,a=nn(e),l=tn(e.lineStart,e.domain,t),c=tn(e.lineEnd,e.domain,t),u=rn(l,i,a,n,s),d=rn(c,i,a,n,s),p=(0,h.m)(d,u,d,.5),f=new mt({view:n,attached:!1,offset:qt.N.parallelLineHintOffset,length:qt.N.parallelLineHintLength,width:qt.N.parallelLineHintWidth,color:r.parallelSignColor,location:p,renderOccluded:s?nt.m$.OccludeAndTransparent:nt.m$.Opaque,isDraped:s,renderGroup:ne.O7.SnappingHint,isDecoration:!0});return f.setDirectionFromPoints(u,p),f.attached=!0,(0,o.DQ)(f)}visualizeRightAngleQuad(e,t){const{view:n,spatialReference:i}=t,r=en(t),s=nn(e),{isDraped:a}=e,l=tn(e.previousVertex,e.domain,t),c=tn(e.centerVertex,e.domain,t),u=tn(e.nextVertex,e.domain,t),h=rn(l,i,s,n,a),d=rn(c,i,s,n,a),p=rn(u,i,s,n,a);return(0,o.DQ)(new Gt({view:n,attached:!0,color:a?r.rightAngleColorDraped:r.rightAngleColor,renderOccluded:a?nt.m$.OccludeAndTransparent:nt.m$.Transparent,outlineRenderOccluded:a?nt.m$.OccludeAndTransparent:nt.m$.Opaque,outlineColor:r.rightAngleOutlineColor,outlineSize:qt.N.rightAngleHintOutlineSize,size:qt.N.rightAngleHintSize,isDraped:a,geometry:{previous:h,center:d,next:p},renderGroup:ne.O7.SnappingHint,isDecoration:!0}))}}function en(e){const{effectiveTheme:t}=e.view,n=_.A.toUnitRGBA(t.accentColor),i=[0,0,0,0];return{intersectionPointColor:i,intersectionPointOutlineColor:n,pointColor:i,pointOutlineColor:n,lineColor:n,lineOutlineColor:void 0,parallelSignColor:n,rightAngleColor:n,rightAngleColorDraped:_.A.toUnitRGBA((0,r._L)(t.accentColor,.5)),rightAngleOutlineColor:n}}function tn(e,t,{selfSnappingZ:n,view:i,spatialReference:r}){return t&Yt.n.SELF&&(0,Wt.Ex)(e)&&null!=n?(0,Wt.FH)(e,n,i,r):e}function nn(e){return e.isDraped?p.Tq:p.qt}function rn(e,t,n,i,r){const o=(0,d.vt)();if(r){const n=i.basemapTerrain.overlayManager.renderer.spatialReference;(0,q.F)(e,t,o,n)}else(0,m.X)(e,t,n,i,o);return o}var on=n(14921);function sn(e){const t=e.graphic;return t?[(0,a.watch)((()=>"visible"in e?e.visible:e.displaying),(e=>{e&&t.notifyMeshTransformChanged({action:on.$.EnableFastUpdates})}),{...a.pc}),(0,o.hA)((()=>t.notifyMeshTransformChanged({action:on.$.DisableFastUpdates})))]:[]}var an=n(20794);const ln=.3;function cn(e,t){t&&Object.assign(e,t)}class un{constructor(e){this.height=90,this.coneHeight=40,this.coneWidth=23,this.width=3,this.renderOccluded=nt.m$.Opaque,this.color=e.accent}}class hn{constructor({colors:e,...t}){this.size=11,this.outlineSize=1,this.collisionPadding=9,this.color=e.accent,this.outlineColor=e.outline,this.renderOccluded=nt.m$.Opaque,this.hoverOutlineColor=e.selectedOutline,cn(this,t)}applyColor(e){this._apply(this.color,e)}applyOutline(e){this._apply(this.outlineColor,e)}applyHoverOutline(e){this._apply(this.hoverOutlineColor,e)}_apply(e,t){t.setParameters({color:(0,r.QP)(e),renderOccluded:this.renderOccluded})}}class dn{constructor({colors:e,...t}){this.size=40,this.height=.2,this.offset=.25,this.collisionPadding=2,this.renderOccluded=nt.m$.Transparent,this.minSquaredEdgeLength=900,this.color=(0,r._L)(e.accent,.5),this.hoverColor=e.accent,cn(this,t)}applyColor(e){this._apply(this.color,e)}applyHover(e){this._apply(this.hoverColor,e)}_apply(e,t){t.setParameters({color:(0,r.QP)(e),renderOccluded:this.renderOccluded})}}class pn{constructor(e){this.vertex=new hn({colors:e,color:e.accent,outlineColor:e.outline}),this.edge=new hn({colors:e,color:(0,r.Vl)((0,r._L)(e.accent,2/3),.5),outlineColor:(0,r._L)(e.outline,.5),size:8,collisionPadding:8}),this.selected=new hn({colors:e,color:e.selected,outlineColor:e.outline}),this.edgeOffset=new dn({colors:e})}}class fn{constructor({colors:e,...t}){this.width=1.5,this.stipplePattern=(0,an.wk)(3.3),this.falloff=0,this.innerWidth=1.5,this.renderOccluded=nt.m$.OccludeAndTransparent,this.color=e.selected,this.stippleOffColor=e.outline,this.innerColor=e.selected,cn(this,t)}apply(e){e.color=(0,r.QP)(this.color),e.width=this.width,e.stipplePattern=this.stipplePattern,e.stippleOffColor=(0,r.QP)(this.stippleOffColor),e.falloff=this.falloff,e.innerWidth=this.innerWidth,e.innerColor=(0,r.QP)(this.innerColor),e.renderOccluded=this.renderOccluded}}class gn{constructor({colors:e,...t}){this.size=4,this.outlineSize=1,this.shape="square",this.color=e.selected,this.outlineColor=e.outline,cn(this,t)}apply(e){e.color=(0,r.QP)(this.color),e.size=this.size,e.outlineSize=this.outlineSize,e.outlineColor=(0,r.QP)(this.outlineColor),e.primitive=this.shape}}class mn{constructor({colors:e,...t}){this.innerWidth=1,this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=ln,this.globalAlphaContrastBoost=1.5,this.radius=3,this.innerColor=e.selected,this.glowColor=e.accent,this.heightFillColor=e.accent,cn(this,t)}apply(e,t=1){const n={glowColor:_.A.toUnitRGB(this.glowColor),glowFalloff:this.glowFalloff,glowWidth:this.glowWidth,innerColor:_.A.toUnitRGB(this.innerColor),innerWidth:this.innerWidth,globalAlpha:this.globalAlpha*t*this.glowColor.a,globalAlphaContrastBoost:this.globalAlphaContrastBoost,intersectsLineRadius:this.radius};"style"in e?e.style=n:e.laserlineStyle=n}}class _n{constructor(e){this.outline=new fn({colors:e,color:e.stippleOff,renderOccluded:nt.m$.OccludeAndTransparentStencil,stippleOffColor:e.stippleOn,innerWidth:0}),this.staged=new fn({colors:e,color:e.stippleOn,renderOccluded:nt.m$.OccludeAndTransparentStencil,innerColor:e.stagedSolid,stippleOffColor:e.stippleOff}),this.shadowStyle=new mn({colors:e,globalAlpha:ln,glowColor:e.accent,glowFalloff:8,glowWidth:8,innerColor:e.selected,innerWidth:1})}}class vn{constructor(e){this.outline=new gn({colors:e,color:e.selected,outlineColor:e.outline,outlineSize:1,shape:"circle",size:4}),this.shadowStyle=new mn({colors:e,globalAlpha:ln,glowColor:e.accent,glowFalloff:1.5,glowWidth:6,innerColor:e.selected,innerWidth:1,radius:2})}}class yn extends fn{constructor({colors:e,...t}){super({colors:e}),this.extensionType=ht.GROUND_RAY,cn(this,t)}}class bn{constructor(e){this.laserlineAlphaMultiplier=1.5,this.heightPlaneAngleCutoff=20,this.lineObjects=new _n(e),this.pointObjects=new vn(e),this.heightPlane=new mn({colors:e,globalAlpha:ln,glowColor:e.accent,glowFalloff:8,glowWidth:8,innerColor:e.selected,innerWidth:1}),this.heightBox=new mn({colors:e,globalAlpha:ln,glowColor:e.accent,glowFalloff:8,glowWidth:8,innerColor:e.selected,innerWidth:0,heightFillColor:e.accent}),this.zVerticalLine=new yn({colors:e,color:(0,r._L)(e.accent,.5),falloff:2,innerColor:(0,r._L)(e.selected,0),renderOccluded:nt.m$.OccludeAndTransparent,stipplePattern:null,width:5,extensionType:ht.GROUND_RAY})}}let Tn=class extends v.A{constructor(e){super(e)}get colors(){const e=this.getTheme().accentColor,t=e.a;return{accent:e,contrast:(0,r.bJ)(e),selected:_.A.fromArray([255,255,255,t]),selectedOutline:_.A.fromArray([255,255,255,t]),staged:_.A.fromArray([12,207,255,t]),stagedSolid:_.A.fromArray([12,207,255,1]),outline:_.A.fromArray([0,0,0,.5*t]),stippleOn:_.A.fromArray([255,255,255,1]),stippleOff:_.A.fromArray([0,0,0,.5])}}get visualElements(){return new bn(this.colors)}get manipulators(){return new pn(this.colors)}get zManipulator(){return new un(this.colors)}};(0,i._)([(0,l.MZ)()],Tn.prototype,"colors",null),(0,i._)([(0,l.MZ)()],Tn.prototype,"visualElements",null),(0,i._)([(0,l.MZ)()],Tn.prototype,"manipulators",null),(0,i._)([(0,l.MZ)()],Tn.prototype,"zManipulator",null),(0,i._)([(0,l.MZ)()],Tn.prototype,"getTheme",void 0),Tn=(0,i._)([(0,u.$)("esri.views.3d.interactive.editingTools.settings")],Tn);var xn=n(48996),wn=n(57617),Sn=n(79366),En=n(29800);class An extends de{constructor(e){super(e),this._attachmentOrigin=(0,gt.T)(0,0,0,null),this._attachmentOriginDirty=!0,this.events=new xn.A,this._geometry=null,this._width=1,this._color=(0,X.fA)(1,0,1,1),this._innerWidth=0,this._innerColor=(0,X.fA)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._elevationInfo=null,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=nt.m$.OccludeAndTransparentStencil,this._attachmentOrigin.spatialReference=e.view.spatialReference,this._laserline=new Ke({view:e.view,isDecoration:e.isDecoration}),this.applyProperties(e),this.attached=e.attached??!0}destroy(){this._laserline.destroy(),super.destroy()}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:Mn,recreateGeometry:(e,t)=>{e.geometries.length=0,this._recreateGeometry(t,e.material,e.geometries)}}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:Mn,recreateGeometry:e=>{e.geometries=this._createRenderGeometriesDraped(e.material),this._attachmentOriginChanged()}}}get _laserlineAttached(){return this.attached&&this.visible&&null!=this._laserlineStyle&&!this.isDraped&&this.laserlineEnabled}onAttachedChange(e){this._laserline.attached=this._laserlineAttached,e&&this._attachmentOriginChanged()}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){(0,Y.a)(e,this._color)||((0,Y.c)(this._color,e),this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){(0,Y.a)(e,this._innerColor)||((0,Y.c)(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=null!=e!=(null!=this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){e&&this._stippleOffColor&&(0,Y.a)(e,this._stippleOffColor)||(this._stippleOffColor=e?(0,X.o8)(e):null,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this._laserlineAttached,null!=e&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get attachmentOrigin(){if(!this._attachmentOriginDirty)return this._attachmentOrigin;const e=this.object3dResources.resources?.geometries;if(!e||0===e.length)return null;(0,h.i)(Rn,0,0,0);let t=0;for(const n of e)n.computeAttachmentOrigin(On)&&((0,h.g)(Rn,Rn,On),t++);return 0===t?null:((0,h.h)(Rn,Rn,1/t),this.view.renderCoordsHelper.fromRenderCoords(Rn,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)}_updateMaterial(){this.object3dResources.resources?.material.setParameters(this._materialParameters),this.drapedResources.resources?.material.setParameters(this._materialParameters)}get _isClosed(){return null!=this.geometry&&"polygon"===this.geometry.type}get _materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:!1,isClosed:this._isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",hasPolygonOffset:!0,renderOccluded:this._normalizedRenderOccluded,isDecoration:this.isDecoration}}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===nt.m$.OccludeAndTransparentStencil?nt.m$.OccludeAndTransparent:this._renderOccluded}_recreateGeometry(e,t,n){this._createRenderGeometries(t,n);for(const t of n)e.addGeometry(t);this._attachmentOriginChanged()}_attachmentOriginChanged(){this._attachmentOriginDirty=!0,this.events.emit("attachment-origin-changed")}_createObject3DResources(e){const t=new rt.W(this._materialParameters),n=new Array;return this._recreateGeometry(e,t,n),{material:t,geometries:n,forEach:e=>{e(t),n.forEach(e)}}}_createDrapedResources(){const e=new rt.W(this._materialParameters);return{material:e,geometries:this._createRenderGeometriesDraped(e)}}_createRenderGeometriesDraped(e){const{geometry:t,view:n}=this,i=n.basemapTerrain.spatialReference;return null==t||null==i?[]:(0,En.A)(t,i).lines.map((({position:t})=>{const r={overlayInfo:{spatialReference:i,renderCoordsHelper:n.renderCoordsHelper},attributeData:{position:t},removeDuplicateStartEnd:this._isClosed};return new it.$((0,Sn.t)(e,r))}))}calculateMapBounds(e){if(null==this.object3dResources.resources)return!1;const t=this.view.renderCoordsHelper;for(const n of this.object3dResources.resources.geometries){const i=n.attributes.get(Pe.r.POSITION),r=(0,Ee.jh)(i.data.length);(0,wn.projectBuffer)(i.data,t.spatialReference,0,r,this.view.spatialReference,0),(0,Ot.Hq)(e,r)}return!0}_createRenderGeometries(e,t){const n=this.geometry;if(null==n)return;const i=(0,En.C)(n,this.view.elevationProvider,this.view.renderCoordsHelper,Dt.F.fromElevationInfo(this.elevationInfo??new f.A({mode:(0,p.w7)(n,null)}))),r=new Array;for(const{position:n,mapPositions:o}of i.lines){const i={mapPositions:o,attributeData:{position:n},removeDuplicateStartEnd:this._isClosed};t.push((0,Sn.t)(e,i)),r.push(n)}this._laserline.pathVerticalPlane=r}}function Mn(e){e.geometries=[]}const On=(0,d.vt)(),Rn=(0,d.vt)();var Cn=n(92754),In=n(27264),Pn=n(28686),Dn=n(4875),Ln=n(45079),Nn=n(29165),Fn=n(90553),zn=n(93678),Hn=n(54840),Vn=n(46921),Un=n(60593);class kn extends ye.w{constructor(e,t,i){super(e,t,new ve.$(Un.S,(()=>n.e(9586).then(n.bind(n,52609)))),i,Bn)}initializePipeline(e){const{oitPass:t,output:n,transparent:i,cullFace:r,shadingEnabled:o}=e,s=t===Hn.Y.NONE,a=t===Hn.Y.FrontFace;return(0,Te.Ey)({blending:n===In.V.Color&&i?(0,Vn.Yf)(t):null,culling:(0,Te.Xt)(r),depthTest:{func:a?we.MT.LESS:o?we.MT.LEQUAL:we.MT.LESS},depthWrite:(0,Vn.z5)(e),drawBuffers:(0,Vn.m6)(t,n),colorWrite:Te.kn,polygonOffset:s||a?null:Vn.SE})}}const Bn=new Map([[Pe.r.POSITION,0],[Pe.r.NORMAL,1],[Pe.r.OFFSET,2]]);var Gn=n(2457),$n=n(38130),jn=n(22095);class Zn extends jn.E{constructor(){super(...arguments),this.cullFace=qe.s2.None,this.hasSlicePlane=!1,this.transparent=!1,this.writeDepth=!0,this.screenSizeEnabled=!0,this.shadingEnabled=!0,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.textureCoordinateType=Gn.I.None,this.emissionSource=$n.ZX.None,this.occlusionPass=!1,this.objectAndLayerIdColorInstanced=!1}get discardInvisibleFragments(){return this.transparent}}(0,i._)([(0,je.W)({count:qe.s2.COUNT})],Zn.prototype,"cullFace",void 0),(0,i._)([(0,je.W)()],Zn.prototype,"hasSlicePlane",void 0),(0,i._)([(0,je.W)()],Zn.prototype,"transparent",void 0),(0,i._)([(0,je.W)()],Zn.prototype,"writeDepth",void 0),(0,i._)([(0,je.W)()],Zn.prototype,"screenSizeEnabled",void 0),(0,i._)([(0,je.W)()],Zn.prototype,"shadingEnabled",void 0),(0,i._)([(0,je.W)()],Zn.prototype,"terrainDepthTest",void 0),(0,i._)([(0,je.W)()],Zn.prototype,"cullAboveTerrain",void 0);class Wn extends nt.im{constructor(e){super(e,Yn),this._configuration=new Zn,this.vertexAttributeLocations=Bn,this.supportsEdges=!0,this.produces=new Map([[Nn.N.OPAQUE_MATERIAL,e=>e===In.V.Highlight||(0,In.zW)(e)&&!this.parameters.transparent],[Nn.N.TRANSPARENT_MATERIAL,e=>(0,In.zW)(e)&&this.parameters.transparent&&this.parameters.writeDepth],[Nn.N.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,e=>(0,In.zW)(e)&&this.parameters.transparent&&!this.parameters.writeDepth]])}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.screenSizeEnabled=this.parameters.screenSizeEnabled,this._configuration.shadingEnabled=this.parameters.shadingEnabled,this._configuration.oitPass=t.oitPass,this._configuration.terrainDepthTest=t.terrainDepthTest,this._configuration.cullAboveTerrain=t.cullAboveTerrain,this._configuration}get visible(){return this.parameters.color[3]>=Pn.Q}intersect(e,t,n,i,r,o){if(this.parameters.screenSizeEnabled){const t=e.attributes.get(Pe.r.OFFSET),s={applyToVertex:(e,i,r,o)=>{const s=(0,h.i)(Qn,t.data[3*o],t.data[3*o+1],t.data[3*o+2]),a=(0,h.i)(Kn,e,i,r);return(0,h.h)(s,s,this.parameters.screenSizeScale*n.camera.computeScreenPixelSizeAt(s)),(0,h.g)(a,a,s),[a[0],a[1],a[2]]},applyToAabb:e=>{const t=(0,Ot.gX)(e,Qn);return(0,Ot.hs)(e,this.parameters.screenSizeScale*n.camera.computeScreenPixelSizeAt(t))}};(0,Ln.Uy)(e,n,i,r,s,o)}else(0,Ln.Uy)(e,n,i,r,void 0,o)}createGLMaterial(e){return new qn(e)}createBufferWriter(){return new Xn(this.parameters.screenSizeEnabled)}}class qn extends Dn.A{beginSlot(e){return this.acquireTechnique(kn,e)}}class Yn extends nt.qA{constructor(){super(...arguments),this.color=(0,X.fA)(1,1,1,1),this.shadingTint=(0,X.fA)(0,0,0,.25),this.shadingDirection=(0,h.n)((0,d.vt)(),[.5,-.5,-.5]),this.screenSizeScale=14,this.forceTransparentMode=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=qe.s2.None,this.screenSizeEnabled=!1,this.shadingEnabled=!0}get transparent(){return this.color[3]<1||this.forceTransparentMode}}class Xn{constructor(e){this.screenSizeEnabled=e;const t=(0,Me.BP)().vec3f(Pe.r.POSITION).vec3f(Pe.r.NORMAL);this.screenSizeEnabled&&t.vec3f(Pe.r.OFFSET),this.vertexBufferLayout=t}elementCount(e){return e.get(Pe.r.POSITION).indices.length}write(e,t,n,i,r,o){if((0,zn.SA)(n,i,this.vertexBufferLayout,e,t,r,o),this.screenSizeEnabled){if(!n.has(Pe.r.OFFSET))throw new Error(`${Pe.r.OFFSET} vertex attribute required for screenSizeEnabled ShadedColorMaterial`);{const e=n.get(Pe.r.OFFSET);(0,Fn.vA)(3===e.size);const i=r.getField(Pe.r.OFFSET,Cn.xs);if(!i)throw new Error("unable to acquire view for "+Pe.r.OFFSET);(0,zn.Hk)(e,t,i,o)}}}}const Qn=(0,d.vt)(),Kn=(0,d.vt)();class Jn extends It{constructor(e){super(e),this.view=null,this._renderOccluded=nt.m$.OccludeAndTransparent,this._vertices=null,this._spatialReference=null,this._color=(0,X.ci)([1,127/255,0,1]),this._size=11,this._outlineColor=(0,X.ci)([0,0,0,.5]),this._outlineSize=1,this._elevationInfo=null,this.applyProperties(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial(),this._updateOutlineMaterial())}get vertices(){return this._vertices}set vertices(e){this._vertices=e,this.recreateGeometry()}get spatialReference(){return this._spatialReference}set spatialReference(e){this._spatialReference=e,this.recreateGeometry()}get color(){return this._color}set color(e){(0,Y.a)(e,this._color)||((0,Y.c)(this._color,e),this._updateMaterial())}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,Y.a)(e,this._outlineColor)||((0,Y.c)(this._outlineColor,e),this._updateOutlineMaterial())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateOutlineMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get _vertexMaterialParameters(){return{color:this._color,screenSizeScale:this.size,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}get _vertexOutlineMaterialParameters(){return{color:this._outlineColor,screenSizeScale:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateMaterial(){this.attached&&this._vertexMaterial.setParameters(this._vertexMaterialParameters)}_updateOutlineMaterial(){this.attached&&this._vertexOutlineMaterial.setParameters(this._vertexOutlineMaterialParameters)}_createRenderGeometries(){const e=this.vertices;if(null==e||0===e.length)return[];const t=function(e,t,n,i,r){const o=(0,Ee.jh)(3*e.length),s=(0,Ee.jh)(o.length);e.forEach(((e,t)=>{o[3*t]=e[0],o[3*t+1]=e[1],o[3*t+2]=e.length>2?e[2]:0}));const a=(0,Pt.au)(o,t,0,s,0,o,0,o.length/3,n,i,r),l=null!=a;return{numVertices:e.length,position:o,mapPositions:s,projectionSuccess:l,sampledElevation:a}}(e,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,Dt.F.fromElevationInfo(this.elevationInfo)),n=[],i=t.numVertices,r=t.position;for(let e=0;e<i;++e){const t=(0,h.i)(ei,r[3*e],r[3*e+1],r[3*e+2]),i=ti(this._vertexMaterial,.5,t),o=ti(this._vertexOutlineMaterial,.5,t);n.push({vertexGeometry:i,vertexOutlineGeometry:o})}return n}createGeometries(e){const t=this._createRenderGeometries();for(const{vertexGeometry:n,vertexOutlineGeometry:i}of t)e.addGeometry(n),e.addGeometry(i)}createExternalResources(){this._vertexMaterial=new Wn({...this._vertexMaterialParameters,writeDepth:!0,cullFace:qe.s2.Back,screenSizeEnabled:!0}),this._vertexOutlineMaterial=new Wn({...this._vertexOutlineMaterialParameters,forceTransparentMode:!0,writeDepth:!0,cullFace:qe.s2.Front,screenSizeEnabled:!0,shadingEnabled:!1})}destroyExternalResources(){this._vertexMaterial=null,this._vertexOutlineMaterial=null}forEachExternalMaterial(e){e(this._vertexMaterial),e(this._vertexOutlineMaterial)}}const ei=(0,d.vt)();function ti(e,t,n){return(0,tt.CM)(e,t,16,16,{offset:n})}let ni=class extends xn.A.EventedAccessor{constructor(e){super(e),this.tracking=!1,this.displaying=!1,this.error=null,this.isDraped=!1}};(0,i._)([(0,l.MZ)({constructOnly:!0})],ni.prototype,"graphic",void 0),(0,i._)([(0,l.MZ)()],ni.prototype,"tracking",void 0),(0,i._)([(0,l.MZ)()],ni.prototype,"displaying",void 0),(0,i._)([(0,l.MZ)()],ni.prototype,"error",void 0),(0,i._)([(0,l.MZ)()],ni.prototype,"isDraped",void 0),ni=(0,i._)([(0,u.$)("esri.views.3d.layers.graphics.GraphicState")],ni);var ii=n(93336),ri=n(85499),oi=n(99113),si=n(24148),ai=n(25638);let li=class extends ii.N{constructor(e){super(e),this._activeVertexVisualElement=null,this._createGraphicState=null,this._outlineVisualElement=null,this._verticesVisualElement=null,this._verticalLineVisualElement=null,this._settings=new Tn({getTheme:()=>this.view.effectiveTheme}),this.geometryType=null,this.type="draw-3d"}initialize(){const{mode:e,offset:t,unit:n}=this.elevationInfo;this.internalGraphicsLayer.elevationInfo=new f.A({mode:e,offset:t,unit:n})}normalizeCtorArgs(e){if(!e.elevationInfo){const t=e.hasZ??!0;return{...e,elevationInfo:(0,p.bK)(t)}}return e}initializeGraphic(e){const{view:t}=this,n=this._createGraphicState=new ni({graphic:e});return(0,o.vE)([t.maskOccludee(e),t.trackGraphicState(n),(0,a.watch)((()=>({element:this._outlineVisualElement,isDraped:n.isDraped})),(({element:e,isDraped:t})=>{e&&(e.isDraped=t)}),a.pc),(0,ai.fm)((()=>{(0,si.IA)(this.tooltipInfos.mesh,this.geometryToPlace)})),this._setupLoadingIndicator(n),...sn(n)])}makeDrawOperation(){const{geometryType:e}=this,t="circle"!==e&&"rectangle"!==e;return new ri.O0({view:this.view,manipulators:this.manipulators,geometryType:(0,ii.l)(e),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,drawSurface:new oi.IX(this.view,this.elevationInfo,[this.internalGraphicsLayer]),elevationDrawSurface:new oi.rT(this.elevationInfo,this.defaultZ,this.view,this.internalGraphicsLayer),hasM:!1,elevationInfo:this.elevationInfo,snappingManager:this.snappingManager,snappingVisualizer:new Jt,segmentLabels:t?new Z:null,labelOptions:this.sketchOptions.labels,isDraped:this._createGraphicState?this._createGraphicState.isDraped:"on-the-ground"===(0,p.wF)(this.hasZ,this.elevationInfo),cursor:this.cursor,constraintsEnabled:!0})}onActiveVertexChanged(e){const{view:t}=this;if(this._activeVertexVisualElement)return this._activeVertexVisualElement.vertices=[e],this._activeVertexVisualElement.recreate(),this._updateVerticalLineVisualElement(e),(0,o.hA)();const n=this._settings,i=n.manipulators.vertex,l=new Jn({view:t,spatialReference:t.spatialReference,vertices:[e],elevationInfo:this.internalGraphicsLayer.elevationInfo,size:i.size,outlineSize:i.outlineSize,renderOccluded:i.renderOccluded,attached:!1,isDecoration:!0});this._activeVertexVisualElement=l;const c=n.visualElements.zVerticalLine,u=new ot({view:t,extensionType:c.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:nt.m$.OccludeAndTransparent,isDecoration:!0});this._verticalLineVisualElement=u;const h=(0,o.vE)([(0,a.watch)((()=>n.visualElements.zVerticalLine),(e=>e.apply(u)),a.Vh),(0,a.watch)((()=>({selectedColor:(0,r.QP)(n.colors.selected),outlineColor:(0,r.QP)(n.manipulators.vertex.outlineColor)})),(({selectedColor:e,outlineColor:t})=>{l.color=e,l.outlineColor=t}),a.Vh),(0,o.hA)((()=>{this._activeVertexVisualElement=(0,s.pR)(this._activeVertexVisualElement),this._verticalLineVisualElement=(0,s.pR)(this._verticalLineVisualElement)}))]);return l.attached=!0,this._updateVerticalLineVisualElement(e),h}_updateVerticalLineVisualElement(e){const t=this._verticalLineVisualElement;if(!t)return;const{renderCoordsHelper:n,elevationProvider:i}=this.view;(0,h.i)(ui,e[0],e[1],e[2]),ci.setFromElevationInfo(this.elevationInfo),ui[2]=(0,Pt.nG)(ui,i,ci,n),n.toRenderCoords(ui,this.view.spatialReference,ui)?(t.setStartEndFromWorldDownAtLocation(ui),t.attached=!0):t.attached=!1}onOutlineChanged(e){if(this._outlineVisualElement)return this._outlineVisualElement.geometry=e,(0,o.hA)();const t=this.internalGraphicsLayer.elevationInfo,{view:n}=this,i=this._settings,r=new An({view:n,geometry:e,elevationInfo:t,isDraped:this._createGraphicState?this._createGraphicState.isDraped:"on-the-ground"===(0,p.wF)(this.hasZ,t),attached:!1,isDecoration:!0});this._outlineVisualElement=r;const l=(0,o.vE)([(0,a.watch)((()=>i.visualElements.lineObjects.outline),(e=>e.apply(r)),a.Vh),(0,a.watch)((()=>i.visualElements.lineObjects.shadowStyle),(e=>e.apply(r)),a.Vh),(0,o.hA)((()=>{this._outlineVisualElement=(0,s.pR)(this._outlineVisualElement)}))]);return r.attached=!0,r.laserlineEnabled=!0,l}onRegularVerticesChanged(e){if(this._verticesVisualElement)return this._verticesVisualElement.vertices=e,(0,o.hA)();const{view:t}=this,n=this._settings,i=n.manipulators.vertex,l=new Jn({view:t,spatialReference:t.spatialReference,vertices:e,elevationInfo:this.internalGraphicsLayer.elevationInfo,size:i.size,outlineSize:i.outlineSize,renderOccluded:i.renderOccluded,attached:!1,isDecoration:!0}),c=(0,o.vE)([(0,a.watch)((()=>({color:(0,r.QP)(n.manipulators.vertex.color),outlineColor:(0,r.QP)(n.manipulators.vertex.outlineColor)})),(({color:e,outlineColor:t})=>{l.color=e,l.outlineColor=t}),a.Vh),(0,o.hA)((()=>{this._verticesVisualElement=(0,s.pR)(this._verticesVisualElement)}))]);return l.attached=!0,this._verticesVisualElement=l,c}updateGraphicGeometry(e){if("mesh"!==this.geometryType||"point"!==e?.type)super.updateGraphicGeometry(e);else{const t=this.geometryToPlace;t?.centerAt(e),(0,si.IA)(this.tooltipInfos.mesh,t);const n=this._graphic;t&&n.geometry===t||(n.geometry=t)}}_setupLoadingIndicator(e){const{drawOperation:t}=this;if(!this.geometryToPlace)return t.loading=!1,null;t.loading=!0;const n=(0,o.hA)((()=>{t.loading=!1}));let i;const r=()=>i&&cancelAnimationFrame(i);return(0,o.vE)([(0,a.when)((()=>e.displaying),(()=>{r(),i=requestAnimationFrame((()=>n.remove()))}),{...a.pc,once:!0}),(0,o.hA)(r),n])}};(0,i._)([(0,l.MZ)({constructOnly:!0})],li.prototype,"elevationInfo",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0})],li.prototype,"geometryType",void 0),(0,i._)([(0,l.MZ)()],li.prototype,"type",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0})],li.prototype,"view",void 0),li=(0,i._)([(0,u.$)("esri.views.3d.interactive.editingTools.draw.DrawGraphicTool3D")],li);const ci=new Dt.F,ui=(0,d.vt)();var hi=n(50659),di=n(78879),pi=n(56275),fi=n(20248),gi=n(8527);function mi(e){if(null==e||"polyline"!==e.type&&"polygon"!==e.type)return 0;const t="polyline"===e.type?e.paths:e.rings,n=(0,gi.FD)();for(const e of t)for(let t=0;t<e.length-1;t++){const i=e[t],r=e[t+1],o=i[0]-r[0],s=i[1]-r[1];if(o*o+s*s>n)return Math.atan2(r[1]-i[1],r[0]-i[0])}return 0}var _i=n(71851);function vi(e){return e?.operations?.data.geometry}function yi(e,t){return function(e,t){return!!e&&"on-the-ground"!==t.mode&&!(0,p.v9)(t)}(e?.data.coordinateHelper.hasZ(),t)}var bi=n(34358),Ti=n(46517);function xi(e,t,n){function i(){const e=n(),t=e.sketchOptions.tooltips.effectiveEnabled?e.activeTooltipInfo:null;return{...e,activeTooltipInfo:t}}let r=!1;function s(e){r||(r=!0,e(),r=!1)}function l({activeTooltipInfo:n,sketchOptions:i,scaleRotateTransform:r}){s((()=>{n&&(n.sketchOptions=i,Ei(n,t),function(e,t){if("transform-point"!==e?.type)return;if(!t)return e.orientation.actual=void 0,e.size.actual=void 0,e.orientation.visible=!1,void(e.size.visible=!1);const n=t.mode,{size:i,orientationClockwise:r}=t.adapter,{visualVariables:o}=e.sketchOptions.tooltips,s=o?.rotation,a=null!=r&&(null==n||"rotate"===n),l=s?.rotationType??"geographic";e.orientation.actual=a?(0,pi.Wq)(r,"radians",l):void 0,e.orientation.precision=Mi(s?.valueType),e.orientation.visible=a;const c=o?.size,u=null!=i&&(null==n||"scale"===n);e.size.actual=u?(0,pi.d_)(i,c?.unit??"meters"):void 0,e.size.precision=Mi(c?.valueType),e.size.visible=u}(n,r)),e.info=n}))}return(0,o.vE)([(0,a.watch)(i,l,a.pc),(0,a.watch)((()=>{const e=i(),{activeTooltipInfo:n}=e;if(n)return{context:e,activeTooltipInfo:n,key:n.key,geometry:vi(t)}}),((e,n)=>{e&&n&&n.key!==e.key&&s((()=>wi(t,e.context)))}),a.OH),t.on("committed",(()=>{queueMicrotask((()=>l(i())))})),(0,si.sZ)(e,{onBeforePaste:()=>{r=!0},onAfterPaste:()=>{wi(t,i()),r=!1}})])}function wi(e,{activeTooltipInfo:t,callbacks:n}){if(!t)return;n.onBeforeUpdate();const i=vi(e);switch(i?.type){case"mesh":Si(t,i.origin,e,n),"orientation"in t&&"scale"in t&&(0,si.IA)(t,i,n);break;case"point":Si(t,i,e,n)}}function Si(e,t,n,i){const{dx:r,dy:o,dz:s}=(0,si.mu)(e,t);0===r&&0===o&&0===s||(i.onMoveStart(),n.operations?.move(r,o,s,bi.Y.NEW_STEP),i.onMove(r,o,s),i.onMoveStop())}function Ei(e,t){const n=vi(t),i=n?.type;if(!e||!n||"mesh"!==i&&"point"!==i)return;const r="mesh"===i,o=r?n.origin:n;e.setLocationFromPoint(o),Ai(e,o,t),"transform-mesh"===e.type&&r&&(0,si.Ue)(e,n),e.clearInputValues()}function Ai(e,t,n){e.elevation.actual=(0,Ti.Of)(t),e.elevation.visible=!!n.operations?.data.coordinateHelper.hasZ(),e.elevation.readOnly=!1,e.elevation.showAsZ=!0}function Mi(e){switch(e){case"integer":case"long":return 0;default:return null}}var Oi=n(85445),Ri=(n(50917),n(44705)),Ci=n(87725),Ii=n(61714),Pi=n(46157),Di=n(46098),Li=n(61441),Ni=n(87416),Fi=n(5596),zi=n(45328),Hi=n(60516);function Vi(e,t,n=(0,ee.vt)()){return Ui(e,(0,g.WA)(t),n),(0,h.n)(n.direction,n.direction),n}function Ui(e,t,n){return function(e,t,n){const i=(0,g.sc)((0,w.C)(A.rq.get(),t));if(i[2]=0,!e.unprojectFromRenderScreen(i,n.origin))return null;const r=(0,g.sc)((0,w.C)(A.rq.get(),t));r[2]=1;const o=e.unprojectFromRenderScreen(r,A.rq.get());return null==o?null:((0,h.d)(n.direction,o,n.origin),n)}(e,e.screenToRender(t,(0,g.sc)(A.rq.get())),n)}var ki=n(65631),Bi=n(53551),Gi=n(45532);class $i{constructor(e){this.metadata=void 0,this._camera=new ki.A,this._elevation={offset:0,override:null},this.collisionType={type:"point"},this.collisionPriority=0,this._renderObjects=new Array,this.autoScaleRenderObjects=!0,this._available=!0,this._noDisplayCount=0,this._radius=10,this._worldSized=!1,this.focusMultiplier=2,this.touchMultiplier=2.5,this.worldOriented=!1,this._modelTransform=(0,Ct.vt)(),this._worldFrame=null,this._renderLocation=(0,d.vt)(),this._renderLocationDirty=!0,this._location=new Gi.default({x:0,y:0,z:0}),this._elevationAlignedLocation=new Gi.default,this._elevationAlignedLocationDirty=!0,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.consumesClicks=!0,this.cursor=null,this.grabCursor=null,this._grabbing=!1,this.dragging=!1,this._hovering=!1,this._selected=!1,this._state=Bi.SJ.None,this._focused=!1,this.events=new xn.A.EventEmitter,this._screenLocation={screenPointArray:(0,g.gs)(),renderScreenPointArray:(0,g.r_)(),pixelSize:0},this._screenLocationDirty=!0,this._engineResourcesAddedToStage=!1,this._attached=!1,this._location.spatialReference=e.view.spatialReference,Object.assign(this,e);const t=this.view.state?.camera;t&&this._camera.copyFrom(t)}destroy(){this._applyObjectTransform=sr,this._removeResourcesFromStage(),this._engineResources=null,this.view=null,this._camera=null}get _stage(){return this.view?._stage}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this._elevationAlignedLocationDirty=!0,this._renderLocationDirty=!0,this._updateEngineObject()}get renderObjects(){return this._renderObjects}set renderObjects(e){this._removeResourcesFromStage(),this._engineResources=null,this._renderObjects=e.slice(),this._updateEngineObject()}set available(e){e!==this._available&&(this._available=e,this._updateEngineObject())}get available(){return this._available}disableDisplay(){return this._noDisplayCount++,1===this._noDisplayCount&&this._updateEngineObject(),(0,o.hA)((()=>{this._noDisplayCount--,0===this._noDisplayCount&&this._updateEngineObject()}))}set radius(e){e!==this._radius&&(this._radius=e,this._updateEngineObject())}get radius(){return this._radius}set worldSized(e){e!==this._worldSized&&(this._worldSized=e,this._updateEngineObject())}get worldSized(){return this._worldSized}get modelTransform(){return this._modelTransform}set modelTransform(e){ji(e)&&(this._screenLocationDirty=!0),(0,Rt.C)(this._modelTransform,e),this._updateEngineObject()}get renderLocation(){return this._renderLocationDirty&&(this._renderLocationDirty=!1,this.view.renderCoordsHelper.toRenderCoords(this.elevationAlignedLocation,this._renderLocation),this.worldOriented?(this._worldFrame||(this._worldFrame=(0,Ct.vt)()),function(e,t,n){switch(e.viewingMode){case"local":return(0,Rt.D_)(n),!0;case"global":{const i=(0,Ii.tO)(e.renderCoordsHelper.spatialReference);(0,Li.n4)(t,0,Ji,0,i.radius),(0,Di.z)((0,b.kU)(Ji[0]),(0,b.kU)(Ji[1]),n)}}}(this.view,this._renderLocation,this._worldFrame)):this._worldFrame&&(this._worldFrame=null)),this._renderLocation}set renderLocation(e){this.view.renderCoordsHelper.fromRenderCoords(e,this._location),this.elevationAlignedLocation=this._location}get location(){return this._location}set location(e){(0,zi.EL)(e,this._location),this._notifyLocationChanged()}_notifyLocationChanged(){this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!0,this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}get elevationAlignedLocation(){return this._elevationAlignedLocationDirty?(this._evaluateElevationAlignment(),this._updateElevationAlignedLocation(),this._elevationAlignedLocation):this._elevationAlignedLocation}set elevationAlignedLocation(e){(0,zi.EL)(e,this._location),this._evaluateElevationAlignment(),this._location.z-=this._elevation.offset,this._updateElevationAlignedLocation(),this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}_updateElevationAlignedLocation(){const e=null!=this._elevation.override?this._elevation.override:this.location.z||0;this._elevationAlignedLocation.x=this.location.x,this._elevationAlignedLocation.y=this.location.y,this._elevationAlignedLocation.z=e+this._elevation.offset,this._elevationAlignedLocation.spatialReference=(0,zi.RS)(this.location.spatialReference),this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!1}grabbableForEvent(){return!0}get grabbing(){return this._grabbing}set grabbing(e){e!==this._grabbing&&(this._grabbing=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get hovering(){return this._hovering}set hovering(e){e!==this._hovering&&(this._hovering=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get selected(){return this._selected}set selected(e){e!==this._selected&&(this._selected=e,this._updateEngineObject(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._updateEngineObject())}updateStateEnabled(e,t){t?this.state|=e:this.state&=~e}_setFocused(e){e!==this._focused&&(this._focused=e,this.events.emit("focus-changed",{action:!0===e?"focus":"unfocus"}))}get focused(){return this._focused}get screenLocation(){return this._ensureScreenLocation(),this._screenLocation}_ensureScreenLocation(){if(!this._screenLocationDirty)return;let e;if(this._screenLocation.pixelSize=this._camera.computeScreenPixelSizeAt(this.renderLocation),this._screenLocationDirty=!1,ji(this._modelTransform)){const t=this._calculateModelTransformOffset(rr);e=(0,h.g)(t,t,this.renderLocation)}else e=this.renderLocation;this._camera.projectToRenderScreen(e,this._screenLocation.renderScreenPointArray),this._camera.renderToScreen(this._screenLocation.renderScreenPointArray,this._screenLocation.screenPointArray)}get applyObjectTransform(){return this._applyObjectTransform}set applyObjectTransform(e){this._applyObjectTransform=e,this._screenLocationDirty=!0,this._updateEngineObject()}get attached(){return this._attached}intersectionDistance(e,t){if(!this.available)return null;const n=(0,g.WA)(e,Zi),i=this._getCollisionRadius(t),r=-1*this.collisionPriority;switch(this.collisionType.type){case"point":if((0,w.hG)(this.screenLocation.screenPointArray,n)<i*i)return this.screenLocation.renderScreenPointArray[2]+r;break;case"line":{const e=this.collisionType.paths,t=this._getWorldToScreenObjectScale(),o=this._calculateObjectTransform(t,Qi),s=i*this.screenLocation.pixelSize,a=Ui(this._camera,n,qi);if(null==a)return null;for(const t of e){if(0===t.length)continue;const e=(0,h.t)(Ji,t[0],o);for(let n=1;n<t.length;n++){const i=(0,h.t)(er,t[n],o),l=(0,J.dz)((0,J.Cr)(e,i,Wi),a);if(null!=l&&l<s*s){const t=(0,h.g)(A.rq.get(),e,i);(0,h.h)(t,t,.5);const n=(0,g.rX)(A.rq.get());return this._camera.projectToRenderScreen(t,n),n[2]+r}(0,h.c)(e,i)}}break}case"disc":{const e=this.collisionType.direction,t=this.collisionType.offset??d.uY,o=this._getWorldToScreenObjectScale(),s=this._calculateObjectTransform(o,Qi),a=i*this.screenLocation.pixelSize,l=Ui(this._camera,n,qi);if(null==l)return null;const c=(0,Ri.z0)(Yi,s),u=(0,h.q)(nr,e,c),p=(0,h.t)(ir,t,s);(0,Fi.O_)(p,u,Ki);const f=tr;if((0,Fi.Ui)(Ki,l,f)&&(0,h.s)(f,p)<a*a)return this.screenLocation.renderScreenPointArray[2]+r;break}case"ribbon":{const{paths:e,direction:t}=this.collisionType,o=this._getWorldToScreenObjectScale(),s=this._calculateObjectTransform(o,Qi),a=i*this._camera.computeScreenPixelSizeAt(this.renderLocation),l=Ui(this._camera,n,qi);if(null==l)return null;const c=(0,Ri.z0)(Yi,s),u=(0,h.q)(nr,t,c),d=this._calculateModelTransformPosition(ir);(0,Fi.O_)(d,u,Ki);const p=tr;if(!(0,Fi.Ui)(Ki,l,p))break;for(const t of e){if(0===t.length)continue;const e=(0,h.t)(Ji,t[0],s);for(let n=1;n<t.length;n++){const i=(0,h.t)(er,t[n],s),o=(0,J.kb)((0,J.Cr)(e,i,Wi),p);if(null!=o&&o<a*a){const t=(0,h.g)(A.rq.get(),e,i);(0,h.h)(t,t,.5);const n=(0,g.rX)(A.rq.get());return this._camera.projectToRenderScreen(t,n),n[2]+r}(0,h.c)(e,i)}}break}default:(0,_e.Xb)(this.collisionType)}return null}attach(e={manipulator3D:{}}){const t=this._stage;if(!t)return;const n=e.manipulator3D;null==n.engineLayerId?(this._engineLayer=new ue.x(t,{pickable:!1,updatePolicy:re.q.SYNC}),n.engineLayerId=this._engineLayer.id):t?.getObject&&(this._engineLayer=t.getObject(n.engineLayerId)),n.engineLayerReferences=(n.engineLayerReferences||0)+1,this._materialIdReferences=n.materialIdReferences,null==this._materialIdReferences&&(this._materialIdReferences=new Map,n.materialIdReferences=this._materialIdReferences),this._camera.copyFrom(this.view.state.camera),this._attached=!0,this._updateEngineObject(),(0,Pi.canProjectWithoutEngine)(this._location.spatialReference,this.view.spatialReference)||(this.location=new Gi.default({x:0,y:0,z:0,spatialReference:this.view.spatialReference}))}detach(e={manipulator3D:{}}){const t=e.manipulator3D;t.engineLayerReferences--;const n=0===t.engineLayerReferences;this._removeResourcesFromStage(),n&&(t.engineLayerId=null,(0,s.pR)(this._engineLayer)),this._engineResources=null,this._engineLayer=null,this._materialIdReferences=null,this._attached=!1}onViewChange(){this._camera.copyFrom(this.view.state.camera),this._screenLocationDirty=!0,this._updateEngineObject()}onElevationChange(e){(0,Pi.projectPoint)(this.location,or,e.spatialReference)&&(0,Ni.vR)(e.extent,or)&&this._notifyLocationChanged()}_evaluateElevationAlignment(){if(null==this.elevationInfo)return;let e=null,t=0;const n=(0,p.Ze)(this.elevationInfo,this.location.spatialReference??this.view.elevationProvider.spatialReference);switch(this.elevationInfo.mode){case"on-the-ground":e=(0,Hi.R1)(this.view.elevationProvider,this.location,"ground")??0;break;case"relative-to-ground":t=((0,Hi.R1)(this.view.elevationProvider,this.location,"ground")??0)+n;break;case"relative-to-scene":t=((0,Hi.R1)(this.view.elevationProvider,this.location,"scene")??0)+n;break;case"absolute-height":t=n}return t!==this._elevation.offset||e!==this._elevation.override?(this._elevation.offset=t,void(this._elevation.override=e)):void 0}_updateEngineObject(){if(!this._attached)return;if(!this.available)return void this._removeResourcesFromStage();const e=this._getWorldToScreenObjectScale(),t=Qi;if(!0===this.autoScaleRenderObjects){const n=this._getFocusedSize(this._radius,this.focused)*e;this._calculateObjectTransform(n,t)}else this._calculateObjectTransform(e,t);const{objectsByState:n}=this._ensureEngineResources(),i=(this.focused?Bi.p7.Focused:Bi.p7.Unfocused)|(this.selected?Bi.p7.Selected:Bi.p7.Unselected),r=this._noDisplayCount>0;for(const{stateMask:e,objects:o}of n){if(r){for(const e of o)e.visible=!1;continue}const n=(e&Bi.p7.All)!==Bi.p7.None,s=(e&Bi.SJ.All)!==Bi.SJ.None,a=!n||(i&e)==(e&Bi.p7.All),l=!s||(this.state&e)==(e&Bi.SJ.All);if(a&&l)for(const e of o)e.visible=!0,e.transformation=t;else for(const e of o)e.visible=!1}}_ensureEngineResources(){if(null==this._engineResources){const e=this._engineLayer,t=[],n=new Set;this.renderObjects.forEach((({geometry:{material:e}})=>{n.has(e)||(t.push(e),n.add(e))}));const i=new Map;this._renderObjects.forEach((e=>{const t=new ce.B({castShadow:!1,geometries:[e.geometry]}),n=i.get(e.stateMask)||[];n.push(t),i.set(e.stateMask,n)}));const r=[];i.forEach(((e,t)=>r.push({stateMask:t,objects:e}))),this._engineResources={objectsByState:r,layer:e,materials:t}}return this._addResourcesToStage(),this._engineResources}_addResourcesToStage(){const e=this._stage;if(this._engineResourcesAddedToStage||null==this._engineResources||!e)return;const{objectsByState:t,layer:n,materials:i}=this._engineResources;i.forEach((t=>{const n=this._materialIdReferences,i=n.get(t.id)||0;0===i&&e.add(t),n.set(t.id,i+1)})),t.forEach((({objects:t})=>{n.addMany(t),e.addMany(t)})),this._engineResourcesAddedToStage=!0}_removeResourcesFromStage(){const e=this._stage;if(!this._engineResourcesAddedToStage||null==this._engineResources||!e)return;const{objectsByState:t,layer:n,materials:i}=this._engineResources;t.forEach((({objects:t})=>{n.removeMany(t),e.removeMany(t)})),i.forEach((t=>{const n=this._materialIdReferences,i=n.get(t.id);1===i?(e.remove(t),n.delete(t.id)):n.set(t.id,i-1)})),this._engineResourcesAddedToStage=!1}_getCollisionRadius(e){return this._getFocusedSize(this.radius,!0)*("touch"===e?this.touchMultiplier:1)}_getFocusedSize(e,t){return e*(t?this.focusMultiplier:1)}_getWorldToScreenObjectScale(){return this._worldSized?1:this.screenLocation.pixelSize}_calculateModelTransformPosition(e){const t=this._getWorldToScreenObjectScale(),n=this._calculateObjectTransform(t,Xi);return(0,h.i)(e,n[12],n[13],n[14])}_calculateModelTransformOffset(e){const t=this._calculateModelTransformPosition(e);return(0,h.d)(e,t,this.renderLocation)}_calculateObjectTransform(e,t){return(0,Rt.hZ)(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1),this._worldFrame&&(0,Rt.lw)(t,t,this._worldFrame),(0,Rt.lw)(t,t,this._modelTransform),t[12]+=this.renderLocation[0],t[13]+=this.renderLocation[1],t[14]+=this.renderLocation[2],t[15]=1,null!=this._applyObjectTransform&&this._applyObjectTransform(t),t}get test(){}}function ji(e){return 0!==e[12]||0!==e[13]||0!==e[14]}const Zi=(0,g.gs)(),Wi=(0,J.vt)(),qi=(0,ee.vt)(),Yi=(0,Ci.vt)(),Xi=(0,Ct.vt)(),Qi=(0,Ct.vt)(),Ki=(0,Fi.vt)(),Ji=(0,d.vt)(),er=(0,d.vt)(),tr=(0,d.vt)(),nr=(0,d.vt)(),ir=(0,d.vt)(),rr=(0,d.vt)(),or=new Gi.default({x:0,y:0,z:0,spatialReference:null}),sr=()=>{};var ar,lr,cr,ur;(ur=ar||(ar={}))[ur.NONE=0]="NONE",ur[ur.ANY=1]="ANY",ur[ur.Z=2]="Z",ur[ur.XY=4]="XY",(cr=lr||(lr={}))[cr.TRANSLATE_Z=0]="TRANSLATE_Z",cr[cr.TRANSLATE_XY=1]="TRANSLATE_XY",cr[cr.SCALE=2]="SCALE",cr[cr.ROTATE=3]="ROTATE",cr[cr.SCALE_ROTATE=4]="SCALE_ROTATE";class hr{constructor(){this.grabbingState=ar.NONE,this.zManipulator=null,this.firstSelected=null,this.numSelected=0,this.firstGrabbedXY=null}update(e){this.grabbingState=ar.NONE,this.zManipulator=null,this.numSelected=0,this.firstSelected=null,this.firstGrabbedXY=null,e.forEachManipulator(((e,t)=>{if(t===lr.TRANSLATE_Z&&(this.zManipulator=e),e instanceof $i&&(e.selected&&(0===this.numSelected&&(this.firstSelected=e),this.numSelected++),null==this.firstGrabbedXY&&e.grabbing&&t===lr.TRANSLATE_XY&&(this.firstGrabbedXY=e)),e.grabbing)switch(this.grabbingState|=ar.ANY,t){case lr.TRANSLATE_Z:this.grabbingState|=ar.Z;break;case lr.TRANSLATE_XY:this.grabbingState|=ar.XY}}))}}function dr(e,t){const{object:n,view:i}=e,r=[],s=n.elevationInfo,l="on-the-ground"===s.mode||!s.offset&&"absolute-height"!==s.mode,c=new hr,u=new Tn({getTheme:()=>i.effectiveTheme}),d=u.visualElements,p=new ot({view:i,extensionType:d.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:nt.m$.OccludeAndTransparent,isDecoration:!0}),f=(0,b.kU)(d.heightPlaneAngleCutoff),g=new Ke({view:i,attached:!1,angleCutoff:f,isDecoration:!0}),m=(0,Oi.v)(1);r.push((0,a.watch)((()=>({lineShadowStyle:u.visualElements.lineObjects.shadowStyle,pointShadowStyle:u.visualElements.pointObjects.shadowStyle,alpha:m.value})),(({lineShadowStyle:e,pointShadowStyle:n,alpha:i})=>{e.apply(t,i),n.apply(p,i)}),a.Vh));const _=(0,Oi.v)(1);r.push((0,a.watch)((()=>({heightPlane:u.visualElements.heightPlane,alpha:_.value})),(({heightPlane:e,alpha:t})=>e.apply(g,t)),a.Vh));const v=()=>{c.update(e);const i=vi(n);if(!n.visible||l&&(n.isDraped||!pr(i)||!i.hasZ))return t.laserlineEnabled=!1,p.attached=!1,void(g.attached=!1);t.laserlineEnabled=!0;const r=c.grabbingState&ar.XY?d.laserlineAlphaMultiplier:1;m.value=r;const o=c.grabbingState&ar.Z?d.laserlineAlphaMultiplier:1;_.value=o,function(e,t){const n=1===t.numSelected?t.firstSelected:t.numSelected>1&&null!=t.firstGrabbedXY?t.firstGrabbedXY:null;null!=n?(e.setStartEndFromWorldDownAtLocation(n.renderLocation),e.attached=!0):e.attached=!1}(p,c),function(e,t,n,i){if(i.numSelected>0){(0,h.i)(fr,0,0,0);let t=0;e.forEachManipulator(((e,n)=>{n===lr.TRANSLATE_XY&&e.selected&&e instanceof $i&&((0,h.g)(fr,fr,e.renderLocation),t++)})),t>0?(n.heightManifoldTarget=(0,h.h)(fr,fr,1/t),n.attached=!0):n.attached=!1}else{const i=t.attachmentOrigin;null!=i&&e.view.renderCoordsHelper.toRenderCoords(i,fr)?(n.heightManifoldTarget=fr,n.attached=!0):n.attached=!1}}(e,t,g,c)};r.push((0,a.watch)((()=>u.visualElements.zVerticalLine),(e=>e.apply(p)),a.Vh)),r.push(n.on("committed",v),(0,a.watch)((()=>n.visible),v),t.events.on("attachment-origin-changed",v),(0,o.DQ)(p),(0,o.DQ)(g));const y=[],T=()=>{(0,o.a0)(y),y.length=0,e.forEachManipulator((e=>y.push(e.events.on("grab-changed",v)))),e.forEachManipulator((e=>y.push(e.events.on("select-changed",v)))),v()};return T(),r.push(e.onManipulatorsChanged(T),(0,o.a2)((()=>(0,o.vE)(y)))),(0,o.vE)(r)}function pr(e){return null!=e&&("polygon"===e.type||"polyline"===e.type)}const fr=(0,d.vt)();var gr=n(56763);function mr(e){const t=[],n=function(e,t){const{view:n,object:i}=e,r=new Ft({view:n,geometry:_r(vi(i)),elevationInfo:i.elevationInfo,isDecoration:!0});return function(e,t,n){const{view:i,object:r}=e,s=new Tn({getTheme:()=>i.effectiveTheme});(function(e,t,n){const{view:i,object:r}=e;let s=null;const a=()=>{const e=_r(vi(r));null!=e&&(0,p.x)(r.elevationInfo)&&(e.z=0),(e=>{null!=s&&(s.remove(),s=null),r.isDraped&&null!=e&&(s=function(e,t,n){const i=e.elevationProvider.spatialReference;(0,gr.g)(t,vr,i);const r=vr[0],o=vr[1];return e.elevationProvider.on("elevation-change",(e=>{(0,Ni.Rj)(e.extent,r,o)&&n()}))}(i,e,(()=>{t.geometry=e})))})(e),t.geometry=e};n.push(r.on("committed",a),(0,o.a2)((()=>s))),a()})(e,t,n),s.visualElements.pointObjects.outline.apply(t),n.push((0,a.watch)((()=>r.visible),(()=>{t.attached=r.visible}),a.Vh))}(e,r,t),t.push((0,o.DQ)(r)),r}(e,t);return function(e,t,n){const{view:i,object:r}=e,s=new Tn({getTheme:()=>i.effectiveTheme}),l=new ot({view:i,extensionType:s.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:nt.m$.OccludeAndTransparent,isDecoration:!0});t.push((0,a.watch)((()=>s.visualElements.zVerticalLine),(e=>e.apply(l)),a.Vh));const c=new Ke({view:i,intersectsLineInfinite:!0,attached:!1,isDecoration:!0}),u=(0,b.kU)(s.visualElements.heightPlaneAngleCutoff),d=new Ke({view:i,attached:!1,angleCutoff:u,isDecoration:!0}),f=r.elevationInfo,g=Dt.F.fromElevationInfo(f),m="on-the-ground"===f.mode||!f.offset&&"absolute-height"!==f.mode,_=new hr,v=(0,Oi.v)(1);t.push((0,a.watch)((()=>({heightPlane:s.visualElements.heightPlane,alpha:v.value})),(({heightPlane:e,alpha:t})=>e.apply(d,t)),a.Vh));const y=(0,Oi.v)(1);t.push((0,a.watch)((()=>({shadowStyle:s.visualElements.pointObjects.shadowStyle,alpha:y.value})),(({shadowStyle:e,alpha:t})=>e.apply(c,t)),a.Vh));const T=()=>{_.update(e);let t=_r(vi(r));const o=m&&(r.isDraped||null==t||!t.hasZ);let a=!0;if(o||null==t)a=!1;else{(0,p.x)(r.elevationInfo)&&(t=t.clone(),t.z=0);const e=(0,Pt.nG)(t,i.elevationProvider,g,i.renderCoordsHelper);(0,h.i)(vr,t.x,t.y,e),(0,q.F)(vr,t.spatialReference,vr,i.renderCoordsHelper.spatialReference),l.setStartEndFromWorldDownAtLocation(vr),c.intersectsWorldUpAtLocation=vr}const u=_.grabbingState&ar.Z?s.visualElements.laserlineAlphaMultiplier:1;v.value=u;const f=(0,Ot.Ie)(yr);!o&&r.visible&&n.calculateMapBounds(f)&&(0,q.F)((0,Ot.pg)(f,vr),i.spatialReference,vr,i.renderCoordsHelper.spatialReference)?(d.heightManifoldTarget=vr,d.attached=!0):d.attached=!1;const b=_.grabbingState&ar.XY?s.visualElements.laserlineAlphaMultiplier:1;y.value=b;const T=a&&r.visible&&!o;c.attached=T,l.attached=T};t.push((0,a.watch)((()=>[r.visible,r.isDraped]),T),r.on("committed",T)),e.forEachManipulator((e=>{t.push(e.events.on("grab-changed",T))})),t.push((0,o.DQ)(c)),t.push((0,o.DQ)(l)),t.push((0,o.DQ)(d)),T()}(e,t,n),{visualElement:n,remove:()=>(0,o.a0)(t)}}function _r(e){return null==e?null:"point"===e.type?e:"mesh"===e.type?e.origin.clone():null}const vr=(0,d.vt)(),yr=(0,Ot.vt)();function br(e){switch(vi(e.object)?.type){case"point":case"mesh":return mr(e);case"polygon":case"polyline":return function(e){const{object:t}=e,n=function(e){const{view:t,object:n}=e,i=vi(n),r=new An({view:t,geometry:pr(i)?i:null,elevationInfo:n.elevationInfo,attached:!1,isDecoration:!0}),s=new Tn({getTheme:()=>t.effectiveTheme}),l=()=>{r.attached=n.visible},c=(0,o.vE)([(0,a.watch)((()=>s.visualElements.lineObjects.outline),(e=>e.apply(r)),a.Vh),(0,a.watch)((()=>s.visualElements.lineObjects.shadowStyle),(e=>e.apply(r)),a.Vh),(0,a.watch)((()=>n.visible),l),(0,a.watch)((()=>n.isDraped),(e=>{r.isDraped=e}),a.Vh),n.on("committed",(()=>{const e=vi(n);r.geometry=pr(e)?e:null})),(0,o.DQ)(r)]);return l(),{visualElement:r,remove:()=>c.remove()}}(e),i=[n,dr(e,n.visualElement)];return t.maskOccludee&&i.push(t.maskOccludee()),{visualElement:n.visualElement,remove:()=>(0,o.a0)(i)}}(e);default:return null}}const Tr=70,xr=Math.ceil(Tr/3*2),wr=5*Math.PI/12,Sr=1*Math.PI/3;var Er=n(14606);class Ar{constructor(){this._available=!0}set location(e){this._forEachManipulator3D((t=>t.location=e))}set elevationAlignedLocation(e){this._forEachManipulator3D((t=>t.elevationAlignedLocation=e))}set elevationInfo(e){this._forEachManipulator3D((t=>t.elevationInfo=e))}get renderLocation(){let e;return this._forEachManipulator3D((t=>{e||(e=t.renderLocation)})),e}set renderLocation(e){this._forEachManipulator3D((t=>t.renderLocation=e))}get available(){return this._available}set available(e){this._available=e,this._forEachManipulator3D((t=>t.available=e))}get hovering(){return this.someManipulator((e=>e.hovering))}get grabbing(){return this.someManipulator((e=>e.grabbing))}get dragging(){return this.someManipulator((e=>e.dragging))}get selected(){return this.someManipulator((e=>e.selected))}hasManipulator(e){return this.someManipulator((t=>t===e))}someManipulator(e){let t=!1;return this.forEachManipulator((n=>{!t&&e(n)&&(t=!0)})),t}_forEachManipulator3D(e){this.forEachManipulator(((t,n)=>{t instanceof $i&&e(t,n)}))}}class Mr extends Ar{constructor(){super(...arguments),this._interactive=!0}get interactive(){return this._interactive}set interactive(e){this._interactive!==e&&(this._interactive=e),this._updateManipulatorInteractivity()}_updateManipulatorInteractivity(){const e=!this.grabbing&&this._interactive;this.forEachManipulator((t=>{t.interactive=e||t.grabbing}))}}class Or{constructor(e,t=Bi.p7.None){this.geometry=e,this.stateMask=t}}var Rr,Cr=n(29531),Ir=(n(49845),n(38177),n(22323),n(2831));function Pr(e,t){return Dr(e,(()=>t))}function Dr(e,t){const n=(0,d.vt)(),i=(0,d.vt)();let r=!1;return o=>{const s=t(o);if("start"===o.action){const t=(0,g.WA)(o.screenStart,(0,g.PR)(A.oG.get())),i=Ui(e.state.camera,t,Vr);null!=i&&(r=(0,Fi.Ui)(s,i,n))}if(!r)return null;const a=(0,g.WA)(o.screenEnd,(0,g.PR)(A.oG.get())),l=Ui(e.state.camera,a,Vr);return null==l?null:(0,Fi.Ui)(s,l,i)?{...o,renderStart:n,renderEnd:i,plane:s,ray:l}:null}}function Lr(e,t,n,i=null,r=null){return function(e,t,n=0,i=null,r=null){let o=null;return s=>{if("start"===s.action&&(o=e.sceneIntersectionHelper.intersectElevationFromScreen((0,g.gs)(s.screenStart.x,s.screenStart.y),t,n,r),null!=o&&null!=i&&!(0,Pi.projectPoint)(o,o,i)))return null;if(null==o)return null;const a=e.sceneIntersectionHelper.intersectElevationFromScreen((0,g.gs)(s.screenEnd.x,s.screenEnd.y),t,n,r);return null==a||null!=i&&!(0,Pi.projectPoint)(a,a,i)?null:{...s,mapStart:o,mapEnd:a}}}(e,n,(0,p.id)(t,e,n),i,r)}function Nr(e,t,n){let i=null;const r=new Ir.rh;return r.next(Pr(e,function(e,t){const n=zr,i=Hr,r=(0,Fi.vt)();e.renderCoordsHelper.worldUpAtPosition(t,n);const o=(0,h.e)((0,Fi.Qj)(r),n,(0,h.d)(i,t,e.state.camera.eye));return(0,h.e)(o,o,n),(0,Fi.O_)(t,o,r)}(e,t))).next(function(e,t){const n=(0,d.vt)(),i=(0,h.l)(t);e.renderCoordsHelper.worldUpAtPosition(t,n);const r=(0,d.vt)(),o=(0,d.vt)(),s=r=>((0,h.d)(r,r,t),(0,Cr._I)(n,r,r),"global"===e.viewingMode&&(0,h.l)(r)*Math.sign((0,h.f)(n,r))<.001-i&&(0,h.d)(r,(0,h.h)(r,n,.001),t),(0,h.g)(r,r,t),r);return e=>(e.renderStart=s((0,h.c)(r,e.renderStart)),e.renderEnd=s((0,h.c)(o,e.renderEnd)),e)}(e,t)).next(Fr(e,n)).next((e=>{e.mapEnd.x=e.mapStart.x,e.mapEnd.y=e.mapStart.y,i=e})),e=>(i=null,r.execute(e),i)}function Fr(e,t){const n=e.renderCoordsHelper;return e=>{const i=n.fromRenderCoords(e.renderStart,new Gi.default({spatialReference:t})),r=n.fromRenderCoords(e.renderEnd,new Gi.default({spatialReference:t}));return null!=i&&null!=r?{...e,mapStart:i,mapEnd:r}:null}}!function(e){e[e.GROUND=0]="GROUND",e[e.OTHER=1]="OTHER"}(Rr||(Rr={})),(0,S.vt)();const zr=(0,d.vt)(),Hr=(0,d.vt)(),Vr=(0,ee.vt)();function Ur(e,t,n){const i=(n,i)=>{t({action:n,object:e,dxScreen:i.screenDeltaX,dyScreen:i.screenDeltaY})};return n(((t,n,r)=>(n.next((e=>("start"===e.action&&i("start",e),e))).next((0,Ir.Wp)(e)).next((e=>{switch(e.action){case"start":case"update":(e.translationX||e.translationY||e.translationZ)&&i("update",e);break;case"end":i("end",e)}return e})),{steps:n,cancel:r=r.next((0,Ir.dp)(e)).next((e=>(i("end",{screenDeltaX:0,screenDeltaY:0}),e)))})))}function kr(e){if(null==e?.axis)return 1;const{mapStart:t,mapEnd:n,axis:i}=e,r=[n.x-t.x,n.y-t.y];return r[0]*i[0]+r[1]*i[1]>0?1:-1}class Br extends Ar{constructor(e){super(),this._handles=new Er.A,this._arrowManipulatorInfos=new Array,this._angle=0,this._scale=1,this._radius=Tr,this._updateAfterDrag=!1,this.events=new xn.A,this._tool=e.tool,this._view=e.view,this._opaqueMaterial=this._createMaterial(),this._transparentMaterial=this._createMaterial(.5),null!=e.radius&&(this._radius=e.radius),this._createManipulators(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}set orthogonalAvailable(e){this._arrowManipulatorInfos.length>=3&&(this._arrowManipulatorInfos[1].manipulator.available=e,this._arrowManipulatorInfos[3].manipulator.available=e)}destroy(){this._handles=(0,s.pR)(this._handles),this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()})),this._tool=null,this._view=null,this._arrowManipulatorInfos.length=0}forEachManipulator(e){for(const{manipulator:t}of this._arrowManipulatorInfos)e(t,lr.TRANSLATE_XY)}createManipulatedObjectDragPipeline(e,t,n){if(!t.operations)return(0,o.hA)();const i=t.operations.data.spatialReference,r=t.graphic;return Ur(t,n,(n=>this.createDragPipeline(((t,i,r,o,s)=>(({steps:i,cancel:r}=e(t,i,r,o,s)),n(t,i,r))),t.elevationInfo,i,r)))}createDragPipeline(e,t,n,i){return(0,o.vE)(this._arrowManipulatorInfos.map((({manipulator:r},o)=>(0,Ir.Xt)(r,((r,s,a,l,c)=>{const u=s.next((e=>({...e,manipulatorType:lr.TRANSLATE_XY}))).next((0,Ir.Tp)(this._view,r.elevationAlignedLocation)).next(Lr(this._view,r.elevationAlignedLocation,t,n,i)).next((0,Ir.an)(r.location,this.angle+(o+1)*Math.PI*.5)).next((0,Ir.sO)());e(r,u,a,l,c)})))))}get angle(){return this._angle}set angle(e){this._angle=e,this.dragging?this._updateAfterDrag=!0:this._updateManipulatorTransform()}get displayScale(){return this._scale}set displayScale(e){this._scale=e,this._updateManipulatorTransform()}get radius(){return this._radius}set radius(e){this._radius!==e&&(this._radius=e,this._updateManipulators())}_updateManipulators(){for(let e=0;e<this._arrowManipulatorInfos.length;e++)this._updateArrowManipulator(this._arrowManipulatorInfos[e],e);this._updateManipulatorTransform()}_updateArrowManipulator({manipulator:e,transform:t},n){const i=this._radius/Tr,r=54*i,o=r*Math.sqrt(3)/2,s=(0,tt._B)(this._opaqueMaterial,o,r/2,r/2,.02);(0,tt.xh)(s,(0,Rt.kN)(A.Rc.get(),(0,h.i)(A.rq.get(),0,-o/3,0))),e.renderObjects=[new Or(s,Bi.p7.Focused),new Or(s.instantiate({material:this._transparentMaterial}),Bi.p7.Unfocused)],e.radius=o/3*2*1.2;const a=(0,Rt.N9)(A.Rc.get(),n*Math.PI/2),l=(0,Rt.kN)(A.Rc.get(),(0,h.i)(A.rq.get(),0,100*i,0));(0,Rt.lw)(t,a,l)}_createManipulators(){for(let e=0;e<4;e++){const t=this._createArrowManipulator(e);this._arrowManipulatorInfos.push(t)}this._updateManipulatorTransform()}_updateManipulatorTransform(){const e=this.angle,t=(0,Rt.$0)(A.Rc.get(),e,(0,d.fA)(0,0,1));if(null==t)return;const n=(0,Rt.CV)(A.Rc.get(),(0,h.i)(A.rq.get(),this.displayScale,this.displayScale,this.displayScale)),i=(0,Rt.lw)(A.Rc.get(),n,t);for(const e of this._arrowManipulatorInfos){const t=(0,Rt.lw)(A.Rc.get(),i,e.transform);e.manipulator.modelTransform=t}}_createArrowManipulator(e){const t=new $i({view:this._view,autoScaleRenderObjects:!1,worldOriented:!0,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:(0,d.fA)(0,0,1)}}),n={manipulator:t,transform:(0,Ct.vt)()};return this._updateArrowManipulator(n,e),this._handles.add(t.events.on("drag",(e=>{this._updateAfterDrag&&"end"===e.action&&!this.dragging&&(this._updateManipulatorTransform(),this._updateAfterDrag=!1)}))),n}_createMaterial(e=1){const t=new Bt.v({cullFace:qe.s2.Back,renderOccluded:nt.m$.Transparent,isDecoration:!0});return this._handles.add((0,a.watch)((()=>_.A.toUnitRGBA(this._view.effectiveTheme.accentColor)),(n=>{n[3]*=e,t.setParameters({color:n})}),a.Vh)),t}get test(){}}class Gr{constructor(){this._view=null,this._elevationInfo=null,this._lastDragEvent=null,this._next=null,this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&null!=this._lastDragEvent&&null!=this._next){const t=this._lastDragEvent.mapEnd,n=this._snap(this._lastDragEvent.screenEnd);if(null!=n){const i={action:"update",mapStart:this._lastDragEvent.mapStart,mapEnd:!0===e?n:t,screenStart:this._lastDragEvent.screenEnd,screenEnd:this._lastDragEvent.screenEnd};this._next.execute(i)}}this._enabled=e}_snap(e){const t=null!=this._view?this._view.toMap(e,{exclude:[]}):null;return null!=t&&null!=this._view&&(t.z=(0,p.id)(t,this._view,this._elevationInfo)),t}createDragEventPipelineStep(e,t){this._view=e,this._elevationInfo=t,this._lastDragEvent=null;const n=new Ir.rh;return this._next=n,[e=>{if(this._lastDragEvent="end"!==e.action?{...e}:null,this._enabled){const t=this._snap(e.screenEnd);return null!=t?{action:e.action,mapStart:e.mapStart,mapEnd:t,screenStart:e.screenStart,screenEnd:e.screenEnd}:null}return{action:e.action,mapStart:e.mapStart,mapEnd:e.mapEnd,screenStart:e.screenStart,screenEnd:e.screenEnd}},n]}}class $r extends Ar{constructor(e){super(),this._handles=new Er.A,this._snapToScene=new Gr,this._scale=1,this._radius=Tr,this._view=e.view,this._tool=e.tool,this._discMaterial=this._createMaterial(),this._discMaterialTransparent=this._createMaterial(.5),null!=e.snapToScene&&(this.snapToScene=e.snapToScene),null!=e.radius&&(this._radius=e.radius),this._createManipulator(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}destroy(){this._handles=(0,s.pR)(this._handles),this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()})),this._tool=null,this._view=null,this._manipulator=null}forEachManipulator(e){e(this._manipulator,lr.TRANSLATE_XY)}get displayScale(){return this._scale}set displayScale(e){this._scale=e,this._updateManipulatorTransform()}get snapToScene(){return this._snapToScene.enabled}set snapToScene(e){this._snapToScene.enabled=e}get radius(){return this._radius}set radius(e){e!==this._radius&&(this._radius=e,this._updateManipulator())}get discManipulator(){return this._manipulator}createManipulatedObjectDragPipeline(e,t,n){if(!t.operations)return(0,o.hA)();const i=t.graphic,r=t.elevationInfo,s=t.operations.data.spatialReference;return Ur(t,n,(t=>this.createDragPipeline(((n,i,r,o,s)=>(({steps:i,cancel:r}=e(n,i,r,o,s)),t(n,i,r))),r,s,i)))}createDragPipeline(e,t,n,i){const r=this._view;return(0,Ir.Xt)(this._manipulator,((o,s,a,l,c)=>{const u=s.next((0,Ir.Tp)(r,o.elevationAlignedLocation)).next(Lr(r,o.elevationAlignedLocation,t,n,i)).next(...this._snapToScene.createDragEventPipelineStep(r,t)).next((e=>({...e,manipulatorType:lr.TRANSLATE_XY}))).next((0,Ir.sO)());e(o,u,a,l,c)}))}_updateManipulatorTransform(){const e=(0,Rt.CV)(A.Rc.get(),(0,h.i)(A.rq.get(),this.displayScale,this.displayScale,this.displayScale));this._manipulator.modelTransform=e}_createManipulator(){const e=this._view;this._manipulator=new $i({view:e,worldSized:!1,autoScaleRenderObjects:!1,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:(0,d.fA)(0,0,1)},worldOriented:!0}),this._updateManipulator()}_updateManipulator(){const e=(0,tt.nW)(this._discMaterial,.02,1,128,(0,d.fA)(0,0,1),(0,d.fA)(0,0,0));e.transformation=(0,Rt.CV)((0,Ct.vt)(),(0,d.fA)(this._radius,this._radius,this._radius)),this._manipulator.renderObjects=[new Or(e,Bi.p7.Focused),new Or(e.instantiate({material:this._discMaterialTransparent}),Bi.p7.Unfocused)],this._manipulator.radius=this._radius/Tr*80}_createMaterial(e=1){const t=new Bt.v({cullFace:qe.s2.Back,renderOccluded:nt.m$.Transparent,isDecoration:!0});return this._handles.add((0,a.watch)((()=>_.A.toUnitRGBA(this._view.effectiveTheme.accentColor)),(n=>{n[3]*=e,t.setParameters({color:n})}),a.Vh)),t}get test(){}}var jr=n(75302);function Zr(e,t=nt.m$.OccludeAndTransparent,n=!0){const i=(0,r.pf)(e),o=!(e[3]<1);return n?new Wn({color:i,writeDepth:o,cullFace:qe.s2.Back,renderOccluded:t,isDecoration:!0}):new Bt.v({color:i,writeDepth:o,cullFace:qe.s2.Back,renderOccluded:t,isDecoration:!0})}function Wr(e,t=nt.m$.OccludeAndTransparent){const n=(0,r.pf)(e);return new Bt.v({color:n,writeDepth:!0,cullFace:qe.s2.Front,renderOccluded:t,isDecoration:!0})}const qr=Object.freeze({calloutLength:40,calloutWidth:1,discRadius:27,focusMultiplier:1.1}),Yr=Object.freeze({autoScaleRenderObjects:!1,worldSized:!0});function Xr(e,t,n,i){const r=(0,h.d)(A.rq.get(),e,n),o=Qr(r,(0,h.e)(A.rq.get(),i,r),n,A.Rc.get());(0,Rt.B8)(o,o);const s=(0,h.t)(A.rq.get(),t,o);return Math.atan2(s[1],s[0])}function Qr(e,t,n,i){const r=(0,h.n)(A.rq.get(),e),o=(0,h.n)(A.rq.get(),t),s=(0,h.e)(A.rq.get(),r,o);return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=0,i[4]=o[0],i[5]=o[1],i[6]=o[2],i[7]=0,i[8]=s[0],i[9]=s[1],i[10]=s[2],i[11]=0,i[12]=n[0],i[13]=n[1],i[14]=n[2],i[15]=1,i}function Kr(e,t){const n=t.origin;null==n?function(e,t){if(null==t)return;const n="mesh"===t.type?t.origin:(0,jr.W$)(t);null!=n&&(e.location=(0,zi.wZ)(n))}(e,vi(t)):e.elevationAlignedLocation=n}class Jr extends Ar{constructor(e){super(),this._radius=Tr,this.events=new xn.A,this._tool=e.tool,this._view=e.view;const t=new Tn({getTheme:()=>this._view.effectiveTheme});this._settings=t,null!=e.radius&&(this._radius=e.radius);const n=this._view.effectiveTheme.accentColor;this._materials={materialUnfocused:Zr(eo(n,1,.25),nt.m$.Occlude),materialFocused:Zr(eo(n,1,0),nt.m$.Occlude),materialOccludedUnfocused:Zr(eo(n,.7,0),t.zManipulator.renderOccluded),materialOccludedFocused:Zr(eo(n,.85,0),t.zManipulator.renderOccluded)},this._themeHandle=(0,a.watch)((()=>this._view.effectiveTheme.accentColor),(e=>{const t=eo(e,1,.25),n=eo(e,1,0),i=eo(e,.7,0),r=eo(e,.85,0),{materialUnfocused:o,materialFocused:s,materialOccludedUnfocused:a,materialOccludedFocused:l}=this._materials;o.setParameters({color:t}),s.setParameters({color:n}),a.setParameters({color:i}),l.setParameters({color:r})})),this._createManipulator(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}destroy(){this._themeHandle=(0,s.xt)(this._themeHandle),this._manipulator.applyObjectTransform=ro,this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()}))}forEachManipulator(e){e(this._manipulator,lr.TRANSLATE_Z)}createManipulatedObjectDragPipeline(e,t,n){if(!t.operations)return(0,o.hA)();const i=t.operations.data.spatialReference;return Ur(t,n,(t=>this.createDragPipeline(((n,i,r,o,s)=>(({steps:i,cancel:r}=e(n,i,r,o,s)),t(n,i,r))),i)))}createDragPipeline(e,t){const n=this._view;return(0,Ir.Xt)(this._manipulator,((i,r,o,s,a)=>{const l=r.next((e=>({...e,manipulatorType:lr.TRANSLATE_Z}))).next(Nr(n,i.renderLocation,t)).next((0,Ir.sO)());e(i,l,o,s,a)}))}get radius(){return this._radius}set radius(e){e!==this._radius&&(this._radius=e,this._updateManipulator())}_updateManipulator(){const e=this._settings,t=this._radius/Tr,n=e.zManipulator.height*t,i=e.zManipulator.coneHeight*t,r=e.zManipulator.coneWidth*t,o=e.zManipulator.width*t,s=[(0,d.fA)(0,0,0),(0,d.fA)(0,0,n)],a=[(0,d.fA)(0,0,0),(0,d.fA)(0,0,n+i)],l=(()=>{const e=(0,Ct.vt)();return(0,Rt.Tl)(e,e,[0,0,n]),(0,Rt.eL)(e,e,Math.PI/2),e})(),{materialUnfocused:c,materialFocused:u,materialOccludedUnfocused:h,materialOccludedFocused:p}=this._materials,f=(0,tt.Nb)(c,s,o/2,16,!1),g=(0,tt.EE)(c,i,r/2,16,!1);g.transformation=l,this._manipulator.renderObjects=[new Or(g,Bi.p7.Unfocused),new Or(f,Bi.p7.Unfocused),new Or(g.instantiate({material:u}),Bi.p7.Focused),new Or(f.instantiate({material:u}),Bi.p7.Focused),new Or(g.instantiate({material:h}),Bi.p7.Unfocused),new Or(f.instantiate({material:h}),Bi.p7.Unfocused),new Or(g.instantiate({material:p}),Bi.p7.Focused),new Or(f.instantiate({material:p}),Bi.p7.Focused)],this._manipulator.radius=o/2+2,this._manipulator.collisionType={type:"line",paths:[a]}}_createManipulator(){const e=this._view,t=new $i({view:e,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});t.applyObjectTransform=t=>{const n=e.state.camera,i=to;e.renderCoordsHelper.toRenderCoords(this._manipulator.elevationAlignedLocation,i);const r=(0,h.F)(n.eye,i),o=n.computeRenderPixelSizeAtDist(r),s=(0,h.d)(no,i,n.eye);(0,h.n)(s,s);const a=io;e.renderCoordsHelper.worldUpAtPosition(to,a);const l=Math.abs((0,h.f)(s,a)),c=(0,h.e)(no,s,a),u=(0,h.e)(no,c,a),d=(0,b.qE)(l,.01,1),p=1-Math.sqrt(1-d*d)/d/n.fullWidth,f=this._settings,g=this._radius/Tr,m=f.zManipulator.width*g;(0,h.h)(u,(0,h.n)(u,u),(1/p-1)*r+o*m),t[12]-=no[0],t[13]-=no[1],t[14]-=no[2]},this._manipulator=t,this._updateManipulator()}get test(){}}function eo(e,t,n){const i=(0,r.e$)(e,n);return i.a*=t,_.A.toUnitRGBA(i)}const to=(0,d.vt)(),no=(0,d.vt)(),io=(0,d.vt)(),ro=()=>{};class oo extends Mr{constructor(e){super(),this._handles=new Er.A;const{tool:t,view:n,snapToScene:i,radius:r}=e;this._view=n,this.xyManipulation=new $r({tool:t,view:n,snapToScene:i,radius:r}),this.xyAxisManipulation=new Br({tool:t,view:n,radius:r}),this.zManipulation=new Jr({tool:t,view:n,radius:r}),this.xyManipulation.available=e.xyAvailable,this.xyAxisManipulation.available=e.xyAxisAvailable,this.zManipulation.available=e.zAvailable,this._autoHideXYAxis(),this.forEachManipulator((e=>this._handles.add(e.events.on("grab-changed",(()=>this._updateManipulatorInteractivity())))))}destroy(){this._handles.destroy(),this.xyManipulation.destroy(),this.xyAxisManipulation.destroy(),this.zManipulation.destroy()}createManipulatedObjectDragPipeline(e,t,n){return(0,o.vE)([this.xyManipulation.createManipulatedObjectDragPipeline(((t,n,i,r,o)=>e(ao.XY,t,n,i,r,o)),t,n),this.xyAxisManipulation.createManipulatedObjectDragPipeline(((t,n,i,r,o)=>e(ao.XY_AXIS,t,n,i,r,o)),t,n),this.zManipulation.createManipulatedObjectDragPipeline(((t,n,i,r,o)=>e(ao.Z,t,n,i,r,o)),t,n)])}createDragPipeline(e,t,n,i){return(0,o.vE)([this.xyManipulation.createDragPipeline(((t,n,i,r,o)=>e(ao.XY,t,n,i,r,o)),t,n,i),this.xyAxisManipulation.createDragPipeline(((t,n,i,r,o)=>e(ao.XY_AXIS,t,n,i,r,o)),t,n,i),this.zManipulation.createDragPipeline(((t,n,i,r,o)=>e(ao.Z,t,n,i,r,o)),n)])}set snapToScene(e){this.xyManipulation.snapToScene=e}set angle(e){this.xyAxisManipulation.angle=e}set radius(e){this.xyAxisManipulation.radius=e,this.xyManipulation.radius=e,this.zManipulation.radius=e}set displayScale(e){this.xyManipulation.displayScale=e,this.xyAxisManipulation.displayScale=e}forEachManipulator(e){this.xyManipulation.forEachManipulator((t=>e(t,lr.TRANSLATE_XY))),this.xyAxisManipulation.forEachManipulator((t=>e(t,lr.TRANSLATE_XY))),this.zManipulation.forEachManipulator((t=>e(t,lr.TRANSLATE_Z)))}get _xyAxisVisible(){const e=this.xyManipulation.someManipulator((e=>e.focused))||this.xyAxisManipulation.someManipulator((e=>e.focused));return this._view.inputManager&&"touch"===this._view.inputManager.latestPointerType||e}_autoHideXYAxis(){const e=this.xyAxisManipulation,t=this.xyManipulation;if((0,c.A)("esri-mobile"))return;const n=[];t.forEachManipulator((e=>n.push(e))),e.forEachManipulator((e=>n.push(e)));const i=()=>{const t=[];this._xyAxisVisible||e.forEachManipulator((e=>t.push(e.disableDisplay()))),this._handles.remove(so),this._handles.add(t,so)};for(const e of n)this._handles.add(e.events.on("focus-changed",i));this._view.inputManager&&this._handles.add((0,a.when)((()=>this._view.inputManager?.latestPointerType),i)),i()}static radiusForSymbol(e){const t=null!=e&&"point-3d"===e.type&&e.symbolLayers;return t&&t.some((e=>"icon"===e.type))?xr:Tr}}const so="disable-xy-axis-display";var ao,lo;(lo=ao||(ao={}))[lo.XY=0]="XY",lo[lo.XY_AXIS=1]="XY_AXIS",lo[lo.Z=2]="Z";class co extends Ar{constructor(e){super(),this._view=e.view,this._tool=e.tool,this._object=e.object,this._manipulator=this._object.createManipulator?.({selectable:!0,cursor:"move"}),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}destroy(){this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()})),this._tool=null,this._view=null,this._manipulator=null}forEachManipulator(e){this._manipulator&&e(this._manipulator,lr.TRANSLATE_XY)}createManipulatedObjectDragPipeline(e){return Ur(this._object,e,(e=>this.createDragPipeline(e)))}createDragPipeline(e){if(!this._manipulator)return(0,o.hA)();const t=this._view;return(0,Ir.Xt)(this._manipulator,((n,i,r,o,s)=>{const a=this._object.operations?.data.spatialReference,l=i.next((e=>a?e:null)).next(function(e,t,n,i){const r=n.toMap(e.screenStart);return null!=r?Lr(t,r,n.elevationInfo,i):null}(s,t,this._object,a)).next((0,Ir.EX)()).next((0,Ir.sO)());e(n,l,r,o,s)}))}}var uo=n(87982),ho=n(83202),po=n(7819),fo=n(37102),go=n(58144),mo=n(45908),_o=n(18945),vo=n(94492),yo=n(90858);let bo=class extends yo.w{constructor(e){super(e),this.type="translate-xy",this.distance=pi.r7}};(0,i._)([(0,l.MZ)()],bo.prototype,"type",void 0),(0,i._)([(0,l.MZ)()],bo.prototype,"distance",void 0),bo=(0,i._)([(0,u.$)("esri.views.interactive.tooltip.infos.TranslateXYTooltipInfo")],bo);let To=class extends yo.w{constructor(e){super(e),this.type="translate-z",this.distance=pi.r7}clear(){this.distance=pi.r7}};(0,i._)([(0,l.MZ)()],To.prototype,"type",void 0),(0,i._)([(0,l.MZ)()],To.prototype,"distance",void 0),To=(0,i._)([(0,u.$)("esri.views.interactive.tooltip.infos.TranslateZTooltipInfo")],To);class xo{constructor(e){this.objects=e,this.type="move-start"}}class wo{constructor(e,t,n){this.dx=e,this.dy=t,this.objects=n,this.type="move"}}class So{constructor(e){this.objects=e,this.type="move-stop"}}const Eo=Symbol("manipulators"),Ao=Symbol("tooltips");let Mo=class extends ho.g{constructor(e){super(e),this._infos=new Map,this.events=new xn.A,this.objects=new di.A,this.enableZ=!0,this.sketchOptions=new fo.A,this.type="move-3d",this._latestTooltipInfo=null,this._translateTooltipInfo=null,this._translateXYTooltipInfo=null,this._translateZTooltipInfo=null,this._updatingHandles=new fi.U,this._moveManipulation=null}initialize(){const{view:e}=this;this.tooltip=(0,si.A)((()=>({view:e,options:this.sketchOptions.tooltips}))),this.addHandles([this.objects.on("change",(e=>{e.removed.forEach((e=>this.removeHandles(e))),this._updateObjectInfos(e),this._setupFastTransformUpdates(e.added),this._refreshManipulators()})),this.objects.on("change",(()=>this._connectTooltips()))]);const t=this.objects.toArray();this._updateObjectInfos({added:t,removed:[]}),this._setupFastTransformUpdates(t),this._refreshManipulators(),this._connectTooltips(),this.finishToolCreation()}destroy(){this.tooltip=(0,s.pR)(this.tooltip),this._moveManipulation=(0,s.pR)(this._moveManipulation),this._set("view",null),this._updatingHandles.destroy()}onInputEvent(e){if(!this.destroyed&&!(0,si.wG)(e,this.tooltip))return super.onInputEvent(e)}get updating(){return this._updatingHandles.updating}get _shouldShowMovePointTooltip(){const{objects:e}=this;if(1!==e.length)return!1;const t=vi(e.at(0))?.type;return"point"===t||"mesh"===t}get activeTooltipInfo(){return this._shouldShowMovePointTooltip?this._movePointTooltipInfo:this._latestTooltipInfo}reset(){}_updateObjectInfos({added:e,removed:t}){for(const t of e){if((0,uo.Y)(t)!==_i.d.SUPPORTED)continue;const e=new Oo(t);this._infos.set(t,e)}for(const e of t)this._infos.delete(e)}_setupFastTransformUpdates(e){for(const t of e){const e=this._infos.get(t);this.addHandles(sn(e.object),t)}}_refreshManipulators(){if(this.removeHandles(Eo),this._moveManipulation=(0,s.pR)(this._moveManipulation),this.manipulators.removeAll(),0===this._infos.size)return;const e=Array.from(this._infos.values());this._createManipulators(e),this._createVisualElements(e),this._updateMoveManipulation(e)}_createManipulators(e){for(const t of e){const n=t.object;t.manipulationXY=new co({tool:this,view:this.view,object:n}),t.manipulationXY.forEachManipulator((e=>{this.addHandles([e.events.on("immediate-click",(e=>{this.events.emit("immediate-click",{...e,object:n}),e.stopPropagation()})),e.events.on("grab-changed",(({action:e})=>{"start"===e?this._showTooltip(ao.XY):this._hideTooltip()}))],Eo)})),this.addHandles(t.manipulationXY.createDragPipeline(((t,n,i,r)=>this._buildDragEventPipeline(e,ao.XY,t,n,i,r))),Eo)}this._createMoveManipulation(e)}_createMoveManipulation(e){const t=new oo({tool:this,view:this.view,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:1===e.length?oo.radiusForSymbol(e[0].object.graphic?.symbol):Tr});this._moveManipulation=t,t.elevationInfo={mode:"absolute-height",offset:0},t.forEachManipulator((e=>{this.addHandles(e.events.on("immediate-click",(n=>{const i=this.objects.at(0);!t.zManipulation.hasManipulator(e)&&1===this.objects.length&&i&&this.events.emit("immediate-click",{...n,object:i}),n.stopPropagation()})),Eo)}));const n=e=>t=>{this.addHandles([t.events.on("focus-changed",(({action:t})=>{"focus"===t?this._showTooltip(e):this._hideTooltip()})),t.events.on("grab-changed",(()=>{this._latestTooltipInfo&&(this._latestTooltipInfo.distance=pi.r7)}))],Eo)};this._moveManipulation.xyManipulation.forEachManipulator(n(ao.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(n(ao.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(n(ao.Z));const i=()=>this._updateMoveManipulation(e);for(const t of e)this.addHandles([t.object.on("committed",i),(0,a.watch)((()=>t.object.visible),i)],Eo);const r=e[e.length-1];this.addHandles(r.object.on("committed",(()=>this._updateMoveManipulationAngle(r))),Eo);const{object:o}=r,{operations:s}=o;if(s){const n=o.graphic;this.addHandles(t.createDragPipeline(((t,n,i,r,o)=>this._buildDragEventPipeline(e,t,n,i,r,o)),o.elevationInfo,s.data.spatialReference,n),Eo)}this._updateMoveManipulationAngle(r)}_createVisualElements(e){for(const t of e){const n=t.object,i=br({view:this.view,object:n,forEachManipulator:e=>{t.manipulationXY?.forEachManipulator(e),this._moveManipulation?.forEachManipulator(e)},onManipulatorsChanged:()=>(0,o.hA)()});null!=i&&(t.geometryRepresentation=i.visualElement,t.geometryRepresentation instanceof An&&this.addHandles([t.geometryRepresentation.events.on("attachment-origin-changed",(()=>{t.object.isDraped||this._updateMoveManipulation(e)})),(0,a.watch)((()=>t.object.isDraped),(()=>this._updateMoveManipulation(e)))],Eo),this.addHandles(i,Eo))}}_updateMoveManipulationAngle(e){this._moveManipulation&&(this._moveManipulation.angle=mi(vi(e.object)))}_updateMoveManipulation(e){const t=(0,gt.T)(0,0,0,this.view.spatialReference);let n=0,i=!1;const r=this._moveManipulation;if(r){for(const r of e){if(!r.object.visible)continue;this.enableZ&&yi(r.object.operations,r.object.elevationInfo)&&(i=!0);const e=r.geometryRepresentation instanceof An&&!r.object.isDraped?r.geometryRepresentation.attachmentOrigin:r.object.origin;if(null!=e){const{x:i,y:r,z:o}=e;t.x+=i,t.y+=r,o&&(t.z??=0,t.z+=o),n++}}n>0?(t.x/=n,t.y/=n,t.z??=0,t.z/=n,r.location=t,r.xyManipulation.available=!0,r.xyAxisManipulation.available=!0,r.zManipulation.available=i):r.available=!1}}_buildDragEventPipeline(e,t,n,i,r,o){const s=[],a=[];let l=null,c=null;const u=()=>{for(const e of s)e.dragging=!1;s.length=0,a.length=0,l=null,c=null,this._moveManipulation&&(this._moveManipulation.interactive=!0)};if(1===e.length&&t===ao.XY){const t=e[0].object;({steps:i,cancel:r}=this._buildSnappingPipelineSteps(t,t.elevationInfo,i,r,o))}return r=r.next((e=>c?.(e))).next((()=>(a.length&&this.events.emit("move-stop",new So(a)),this.destroyed||u(),null))),{steps:i=i.next((t=>{if("start"===t.action){s.length=0,a.length=0;for(const t of e)t.dragging||!t.manipulationXY?.hasManipulator(n)&&t.manipulationXY?.grabbing||(s.push(t),a.push(t.object),t.dragging=!0);if(0!==a.length&&(this._moveManipulation&&(this._moveManipulation.interactive=!1),l=(0,Ir.bl)(a),c=(0,Ir.mc)(a),this._emitRecordUndo(),this.events.emit("move-start",new xo(a)),this.destroyed))return null}return 0!==a.length?t:null})).next((e=>l?.(e))).next((e=>(this._updateMoveTooltip(t,e),e))).next((e=>{switch(e.action){case"start":case"update":if(e.translationX||e.translationY||e.translationZ){const t=this.view.toScreen(e.mapStart),n=this.view.toScreen(e.mapEnd),i=n.x-t.x,r=n.y-t.y;if(this.events.emit("move",new wo(i,r,a)),this.destroyed)return null}break;case"end":if(this.events.emit("move-stop",new So(a)),this.destroyed)return null;u()}return null})),cancel:r}}_connectTooltips(){let e;if(this.removeHandles(Ao),this._shouldShowMovePointTooltip){const t=this.objects.at(0),{events:n}=this;this._movePointTooltipInfo??=new _o.F({viewType:this.view.type,sketchOptions:this.sketchOptions});const i={onBeforeUpdate:()=>this.endDrag(),onMoveStart:()=>{this._emitRecordUndo(),n.emit("move-start",new xo([t]))},onMove:()=>n.emit("move",new wo(0,0,[t])),onMoveStop:()=>n.emit("move-stop",new So([t])),onRotateStart:()=>{},onRotate:()=>{},onRotateStop:()=>{},onScaleStart:()=>{},onScale:()=>{},onScaleStop:()=>{}};e=xi(this.tooltip,t,(()=>({sketchOptions:this.sketchOptions,activeTooltipInfo:this._movePointTooltipInfo,callbacks:i})))}else e=(0,a.watch)((()=>this.sketchOptions.tooltips.effectiveEnabled?this._latestTooltipInfo:null),(e=>{this.tooltip.info=e}),a.pc);this.addHandles(e,Ao)}_showTooltip(e){this._shouldShowMovePointTooltip||this._updateMoveTooltip(e)}_hideTooltip(){this._shouldShowMovePointTooltip||(this.tooltip?.clear(),this._latestTooltipInfo=null)}_updateMoveTooltip(e,t){if(this._shouldShowMovePointTooltip)return;const{sketchOptions:n}=this;switch(e){case ao.XY:this._latestTooltipInfo=this._translateTooltipInfo??=new vo.M({sketchOptions:n}),Ro(this._latestTooltipInfo,t,((e,t)=>(0,N.Kt)(e,t)));break;case ao.XY_AXIS:this._latestTooltipInfo=this._translateXYTooltipInfo??=new bo({sketchOptions:n}),Ro(this._latestTooltipInfo,t,((e,n)=>(0,pi.hs)((0,N.Kt)(e,n),kr(t))));break;case ao.Z:this._latestTooltipInfo=this._translateZTooltipInfo??=new To({sketchOptions:n}),Ro(this._latestTooltipInfo,t,Ti.e5)}this._latestTooltipInfo.sketchOptions=n}_emitRecordUndo(){const e=this.objects.toArray().map((e=>e.createUndoRecord?.())).filter(hi.Ru);e.length>0&&this.events.emit("record-undo",{updates:e})}_buildSnappingPipelineSteps(e,t,n,i,r){const o=vi(e);if(null==o||"point"!==o.type&&"mesh"!==o.type)return{steps:n,cancel:i};const s=("point"===o.type?o:o.origin).clone(),a=new go.e({elevationInfo:t,pointer:r,editGeometryOperations:po.p.fromGeometry(s,this.view.state.viewingMode),visualizer:new Jt,excludeFeature:e.graphic}),l=this.snappingManager,{snappingStep:c,cancelSnapping:u}=(0,mo.L)({snappingContext:a,snappingManager:l,updatingHandles:this._updatingHandles});return i=i.next(u),{steps:n=n.next((t=>(s.z=(0,p.wS)(this.view,s,e.elevationInfo,{mode:"absolute-height",offset:0}),{...t,snapOrigin:a.coordinateHelper.pointToVector(s)}))).next(...c),cancel:i}}};(0,i._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],Mo.prototype,"view",void 0),(0,i._)([(0,l.MZ)()],Mo.prototype,"objects",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],Mo.prototype,"enableZ",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0,type:fo.A})],Mo.prototype,"sketchOptions",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0})],Mo.prototype,"snappingManager",void 0),(0,i._)([(0,l.MZ)()],Mo.prototype,"type",void 0),(0,i._)([(0,l.MZ)()],Mo.prototype,"updating",null),(0,i._)([(0,l.MZ)()],Mo.prototype,"_latestTooltipInfo",void 0),(0,i._)([(0,l.MZ)()],Mo.prototype,"_shouldShowMovePointTooltip",null),(0,i._)([(0,l.MZ)()],Mo.prototype,"activeTooltipInfo",null),Mo=(0,i._)([(0,u.$)("esri.views.3d.interactive.editingTools.move.MoveTool3D")],Mo);class Oo{constructor(e){this.object=e,this.geometryRepresentation=null,this.manipulationXY=null,this.dragging=!1}}function Ro(e,t,n){if(null==t||"end"===t.action)return void(e.distance=pi.r7);const{mapStart:i,mapEnd:r}=t,o=n(i,r);e.distance=null!=o?o:pi.r7}var Co=n(91508),Io=n(57165),Po=n(89814),Do=n(57862),Lo=n(63447);function No(e,t,n){const i="on-the-ground"===n.mode?Lo.B.XY:Lo.B.XYZ;return new Lo.L(e,i,t,0)}function Fo(e,t,n){const i=(0,d.vt)();if(!e.renderCoordsHelper.toRenderCoords(t,i))return null;const r=zo(e,t,(0,Fi.Qj)(n.plane)),o=zo(e,t,n.edgeDirection);if(null==r||null==o)return null;const s=(0,h.e)((0,d.vt)(),r,o);return(0,Fi.O_)(i,s,(0,Fi.vt)())}function zo(e,t,n){const i=(0,gt.T)(t.x+n[0],t.y+n[1],t.z+n[2],t.spatialReference),r=(0,d.vt)(),o=(0,d.vt)();return e.renderCoordsHelper.toRenderCoords(t,r)&&e.renderCoordsHelper.toRenderCoords(i,o)?(0,h.o)(o,r,o):null}function Ho(e,t,n,i){const{elevationInfo:r,operations:o}=n;if(!o||!e)return null;const s=i.manipulator.elevationAlignedLocation,a=(0,p.id)(s,t,r),l=t.sceneIntersectionHelper.intersectElevationFromScreen((0,g.gs)(e.x,e.y),r,a);return l&&(0,Pi.projectPoint)(l,l,o.data.spatialReference)?l:null}var Vo=n(87265);let Uo=class extends yo.w{constructor(e){super(e),this.type="reshape-edge-offset",this.distance=(0,Vo.Y3)({lockable:!1}),this.area=(0,Vo.Am)({visible:!1}),this.totalLength=(0,Vo.fr)({visible:!1})}get allFields(){return[this.distance,this.area,this.totalLength]}};(0,i._)([(0,l.MZ)()],Uo.prototype,"type",void 0),(0,i._)([(0,l.MZ)()],Uo.prototype,"distance",void 0),(0,i._)([(0,l.MZ)()],Uo.prototype,"area",void 0),(0,i._)([(0,l.MZ)()],Uo.prototype,"totalLength",void 0),(0,i._)([(0,l.MZ)()],Uo.prototype,"allFields",null),Uo=(0,i._)([(0,u.$)("esri.views.interactive.tooltip.infos.ReshapeEdgeOffsetTooltipInfo")],Uo);var ko=n(83931),Bo=n(70474);function Go(e,t,n){function i(){const e=n(),t=e.sketchOptions.tooltips.effectiveEnabled?e.activeTooltipInfo:null;return{...e,activeTooltipInfo:t}}let r=!1;function s(e){r||(r=!0,e(),r=!1)}function l(n){s((()=>{(function(e,{activeTooltipInfo:t,selectedVertexManipulatorInfo:n,sketchOptions:i}){if(t)switch(t.sketchOptions=i,t?.type){case"move-point":Ei(t,e);break;case"selected-vertex":!function(e,t,n){if(!e||"selected-vertex"!==e.type)return;const i=t?.manipulator.location;e.setLocationFromPoint(i),Ai(e,i,n);const r=n.operations?.data.geometry;switch(r?.type){case"polygon":e.geometryType="polygon",e.totalLength.visible=!1,e.area.actual=(0,Bo.n)(r);break;case"polyline":e.geometryType="polyline",e.totalLength.actual=(0,N.ob)(r),e.area.visible=!1}}(t,n,e)}})(t,n),e.info=n.activeTooltipInfo}))}return(0,o.vE)([(0,a.watch)(i,l,a.pc),(0,a.watch)((()=>{const e=i(),{activeTooltipInfo:n}=e;if(n&&"key"in n)return{context:e,activeTooltipInfo:n,key:n.key,geometry:vi(t)}}),((e,n)=>{e&&n&&n.key!==e.key&&s((()=>$o(t,e.context)))}),a.OH),t.on("committed",(()=>l(i()))),(0,si.sZ)(e,{onBeforePaste:()=>{r=!0},onAfterPaste:()=>{$o(t,i()),r=!1}})])}function $o(e,{activeTooltipInfo:t,selectedVertexManipulatorInfo:n,callbacks:i}){if(!t)return;i.onBeforeReshape();const r=vi(e);switch(r?.type){case"mesh":"move-point"===t.type&&Si(t,r.origin,e,i);break;case"point":"move-point"===t.type&&Si(t,r,e,i);break;case"polyline":case"polygon":"selected-vertex"===t.type&&function(e,t,n,i){if(!t)return;const{dx:r,dy:o,dz:s}=(0,si.mu)(e,t.manipulator.location);0===r&&0===o&&0===s||(i.onReshapeStart(),n.operations?.moveVertices([t.handle],r,o,s,bi.Y.NEW_STEP),i.onReshape(),i.onReshapeStop())}(t,n,e,i)}}function jo(e,t,n){if(null!=t&&"end"!==t.action){const{mapStart:i,mapEnd:r}=t,o=n(i,r);e.distance=null!=o?o:pi.r7}else e.distance=pi.r7}function Zo({operations:e},t,{sketchOptions:n,tooltipInfos:i}){const r=i.edgeOffset;if(r.distance.committed=null,null!=t&&null!=t.signedDistance&&"end"!==t.action&&null!=e){const n=e.data.coordinateHelper,{start:i,end:o}=t.operation.clampedStartAndEnd(t.mapEnd),s=(0,N.Do)(i,o,n.spatialReference),a=Math.sign(t.signedDistance*t.operation.selectedArrow);r.distance.actual=null!=s?(0,pi.hs)(s,a):null}else r.distance.actual=pi.r7;const o=e?.data.geometry;switch(r.area.actual=null,r.area.visible=!1,r.totalLength.actual=null,r.totalLength.visible=!1,o?.type){case"polygon":r.area.actual=(0,Bo.n)(o),r.area.visible=!0;break;case"polyline":r.totalLength.actual=(0,N.ob)(o),r.totalLength.visible=!0}return r.sketchOptions=n,r}var Wo=n(71168),qo=n(37578);const Yo=Symbol();let Xo=class extends v.A{get _operations(){return this.object.operations}constructor(e){super(e),this._selectedIndex=0,this._manipulatorHandles=new Er.A,this._manipulatorInfos=[],this._numGrabbing=0,this._numDragging=0,this._reshapeEventState=os.NONE,this._pendingEdgeOffsetInfo=null,this._updatingHandles=new fi.U,this._recreatingManipulators=!1,this._settings=new Tn({getTheme:()=>this.view.effectiveTheme}),this.events=new xn.A,this.activeTooltipInfo=null,this._vertexLaserLineVisualElement=null,this._tooltipCallbacks={onBeforeReshape:()=>this.tool.endDrag(),onReshapeStart:()=>this._updateEventState(os.RESHAPING),onReshape:()=>this.events.emit("reshape",{type:"reshape",object:this.object}),onReshapeStop:()=>this._updateEventState(os.NONE,{forceEnd:!0}),onMoveStart:()=>this._updateEventState(os.MOVING),onMove:()=>this.events.emit("move",{type:"move",object:this.object,dx:0,dy:0}),onMoveStop:()=>this._updateEventState(os.NONE,{forceEnd:!0})}}initialize(){const{view:e}=this,t=this._settings.manipulators,n=t.vertex;this.tooltipInfos=function(e,t){const n=t?.type;return{edgeOffset:new Uo({sketchOptions:e,viewType:n}),movePoint:new _o.F({sketchOptions:e,viewType:n}),selectedVertex:new ko.d({sketchOptions:e,viewType:n}),translate:new vo.M({sketchOptions:e,viewType:n}),translateXY:new bo({sketchOptions:e,viewType:n}),translateZ:new To({sketchOptions:e,viewType:n})}}(this._sketchOptions,e),this._vertexManipulatorMaterial=Zr((0,r.QP)(n.color),n.renderOccluded),this._vertexManipulatorOutlineMaterial=Wr((0,r.QP)(n.outlineColor),n.renderOccluded),this._vertexManipulatorHoverOutlineMaterial=Wr((0,r.QP)(n.hoverOutlineColor),n.renderOccluded);const i=t.edge;this._edgeManipulatorMaterial=Zr((0,r.QP)(i.color),i.renderOccluded),this._edgeManipulatorOutlineMaterial=Wr((0,r.QP)(i.outlineColor),i.renderOccluded);const o=t.edgeOffset;this._edgeOffsetManipulatorMaterial=Zr((0,r.QP)(o.color),o.renderOccluded,!1),this._edgeOffsetManipulatorHoverMaterial=Zr((0,r.QP)(o.hoverColor),o.renderOccluded,!1);const s=t.selected;this._selectedManipulatorMaterial=Zr((0,r.QP)(s.color),s.renderOccluded),this._selectedManipulatorOutlineMaterial=Wr((0,r.QP)(s.outlineColor),s.renderOccluded),this._selectedManipulatorHoverOutlineMaterial=Wr((0,r.QP)(s.hoverOutlineColor),s.renderOccluded),this.tooltip=(0,si.A)((()=>({view:e,options:this._sketchOptions.tooltips}))),this.addHandles([(0,a.watch)((()=>{const e=this._settings.manipulators;return{vertexSettings:e.vertex,edgeSettings:e.edge,edgeOffsetSettings:e.edgeOffset,selectedSettings:e.selected}}),(({vertexSettings:e,edgeSettings:t,edgeOffsetSettings:n,selectedSettings:i})=>{e.applyColor(this._vertexManipulatorMaterial),e.applyOutline(this._vertexManipulatorOutlineMaterial),e.applyHoverOutline(this._vertexManipulatorHoverOutlineMaterial),t.applyColor(this._edgeManipulatorMaterial),t.applyOutline(this._edgeManipulatorOutlineMaterial),n.applyColor(this._edgeOffsetManipulatorMaterial),n.applyHover(this._edgeOffsetManipulatorHoverMaterial),i.applyColor(this._selectedManipulatorMaterial),i.applyOutline(this._selectedManipulatorOutlineMaterial),i.applyHoverOutline(this._selectedManipulatorHoverOutlineMaterial)})),(0,a.watch)((()=>this.object.visible),(e=>{for(const t of this._manipulatorInfos)t.manipulator.available=e,es(t)&&(t.edgeManipulator.available=e)})),(0,a.watch)((()=>this._numGrabbing+this._numDragging===0),(e=>this._toggleAutoHideManipulators(e))),(0,a.watch)((()=>({labels:this._segmentLabels,enabled:this._sketchOptions.labels.enabled,edgeOffsetEnabled:this.enableEdgeOffset})),(({labels:e,enabled:t,edgeOffsetEnabled:n})=>{null!=e&&(e.visible=t,e.edgeDistance=n?"far":"default")}),a.Vh),Go(this.tooltip,this.object,(()=>this._tooltipsContext)),(0,a.watch)((()=>this.tooltip.mode),((e,t)=>{"input"===t&&"input"!==e&&this._resetTooltip()})),(0,a.on)((()=>this._operations),"vertex-update",(e=>this._updateManipulatorPositions(e.vertices)),{onListenerAdd:()=>this._recreateManipulators()}),(0,a.on)((()=>this._operations?.data),"change",(e=>{"undo"!==e.operation&&"redo"!==e.operation||this._recreateManipulators()}))])}destroy(){this._removeManipulators(),this._updatingHandles.destroy(),this._segmentLabels=(0,s.pR)(this._segmentLabels),this.tooltip=(0,s.pR)(this.tooltip)}get updating(){return this._updatingHandles.updating}get manipulators(){return this.tool.manipulators}get view(){return this.tool.view}get object(){return this.tool.object}get enableZShape(){return this.tool.enableZShape}get enableDeleteVertices(){return this.tool.enableDeleteVertices}get enableZVertex(){return this.tool.enableZVertex}get autoHideManipulators(){return this.tool.autoHideManipulators}get enableMoveObject(){return this.tool.enableMoveObject}get enableMidpoints(){return this.tool.enableMidpoints}get enableEdgeOffset(){return this.tool.enableEdgeOffset}get _sketchOptions(){return this.tool.sketchOptions}get _accentColor(){return this.view.effectiveTheme.accentColor}enterInputModeIfAvailable(e){return"key-down"===e.type&&e.key===qo.ac.enterInputMode&&("reshape-edge-offset"===this.activeTooltipInfo?.type?this._enterInputModeDuringEdgeOffset(e):!!(0,si.wG)(e,this.tooltip)&&(this.tool.endDrag(),!0))}removeSelectedVertices(){const e=this._manipulatorInfos.filter((e=>e.manipulator.selected&&"vertex"===e.type));return this._removeVertices(e),e.length}onManipulatorSelectionChanged(){this.events.emit("manipulators-changed")}_removeManipulators(){this._manipulatorHandles.removeAll(),this._moveManipulation=(0,s.pR)(this._moveManipulation),this._objectMoveManipulation=(0,s.pR)(this._objectMoveManipulation),this.manipulators.removeAll(),this._manipulatorInfos=[],this._numGrabbing=0,this._numDragging=0}_createManipulators(e){if(null==this._operations)return;const t=this.object.elevationInfo;for(const n of this._operations.data.components){const i=e?.byComponentIndex.get(n.index);for(const e of n.vertices){const n=i?.has(e.index);this._createVertexOrEdgeManipulator(e,t,n)}for(const e of n.edges)this._createVertexOrEdgeManipulator(e,t)}this._createObjectMoveManipulation(),this._createMoveManipulation(t),this._createVisualElements()}get canRedo(){return null!=this._operations&&this._operations.canRedo}get canUndo(){return null!=this._operations&&this._operations.canUndo}redo(){return this._operations?.redo()}undo(){return this.events.emit("undo"),this._operations?.undo()}_recreateManipulators(){if(!this._recreatingManipulators){if(this._recreatingManipulators=!0,this._removeManipulators(),this._resetTooltip(),this._operations&&this._segmentLabels?.context?.editGeometryOperations===this._operations||(this._segmentLabels=(0,s.pR)(this._segmentLabels)),this._createManipulators(),!this._segmentLabels&&this._operations){const e=this._sketchOptions.labels;this._segmentLabels=new Z({context:{view:this.view,editGeometryOperations:this._operations,elevationInfo:this.object.elevationInfo,labelOptions:e},visible:e.enabled})}this._recreatingManipulators=!1}}_perObjectManipulatorDragAction(e,t){if("end"===t.action)return t;let n=0;const i=[],r=this._manipulatorInfos.some((e=>"vertex"===e.type&&e.manipulator.selected)),o=e===ss.SELECTED_OR_ALL&&r;for(const e of this._manipulatorInfos)"vertex"===e.type&&(e.manipulator.grabbing||o&&!e.manipulator.selected||i.push(e),n++);if(this._moveVertices(i,t),i.length===n){if(this._updateEventState(os.MOVING),this.destroyed)return t;this.events.emit("move",{type:"move",dx:t.screenDeltaX,dy:t.screenDeltaY,object:this.object})}else{if(this._updateEventState(os.RESHAPING),this.destroyed)return t;this.events.emit("reshape",{type:"reshape",object:this.object})}return t}_toggleAutoHideManipulators(e){this.autoHideManipulators&&(e?this.removeHandles(Yo):this.tool.manipulators.forEach((({manipulator:e})=>{const t=e.disableDisplay?.();t&&this.addHandles(t,Yo)})))}_isMultiVertexSelection(){return this._manipulatorInfos.reduce(((e,t)=>"vertex"===t.type&&t.manipulator.selected?e+1:e),0)>1}_perVertexManipulatorDragAction(e){if(this._updateEventState(os.RESHAPING),this.destroyed)return;const{mapDeltaX:t,mapDeltaY:n,mapDeltaZ:i}=e;if(!t&&!n&&!i)return;const r=[];for(const t of this._manipulatorInfos)"vertex"===t.type&&(t.manipulator.selected&&!t.manipulator.grabbing||t===e.info)&&r.push(t);this._moveVertices(r,e,bi.Y.ACCUMULATE_STEPS),this.events.emit("reshape",{type:"reshape",object:this.object})}_updateEventState(e,t={}){if(e===this._reshapeEventState)return!1;switch(e){case os.NONE:if(!t.forceEnd&&(0!==this._numGrabbing||0!==this._numDragging))return!1;switch(this._reshapeEventState){case os.MOVING:this.events.emit("move",{type:"move-stop",dx:0,dy:0,object:this.object});break;case os.RESHAPING:this.events.emit("reshape",{type:"reshape-stop",object:this.object})}break;case os.MOVING:switch(this._reshapeEventState){case os.NONE:this.events.emit("move",{type:"move-start",dx:0,dy:0,object:this.object});break;case os.RESHAPING:this.events.emit("reshape",{type:"reshape-stop",object:this.object}),this.destroyed||this.events.emit("move",{type:"move-start",dx:0,dy:0,object:this.object})}break;case os.RESHAPING:switch(this._reshapeEventState){case os.NONE:this.events.emit("reshape",{type:"reshape-start",object:this.object});break;case os.MOVING:this.events.emit("move",{type:"move-stop",dx:0,dy:0,object:this.object}),this.destroyed||this.events.emit("reshape",{type:"reshape-start",object:this.object})}}if(this.destroyed)return!1;const n=this._reshapeEventState!==e;return this._reshapeEventState=e,n}_createObjectMoveManipulation(){const{tool:e,view:t,object:n,_operations:i}=this;if(i){if(this._objectMoveManipulation=new co({tool:e,view:t,object:n}),this.enableMoveObject){let e=null;this._manipulatorHandles.add(this._objectMoveManipulation.createDragPipeline(((t,n,r)=>{n.next((e=>this._trackNumDragging(e))).next((t=>("start"===t.action&&(e=i.createUndoGroup()),t))).next((e=>this._perObjectManipulatorDragAction(ss.ALL,e))).next((e=>(this._updateTranslateObjectTooltip(ao.XY,e),e))).next((t=>{"end"===t.action&&(this._resetTooltip(),e=(0,s.xt)(e))})),r.next((()=>this._onDragCancel(!0,(()=>e=(0,s.xt)(e)))))}))),this._objectMoveManipulation.forEachManipulator((e=>this._manipulatorHandles.add(this._watchAndUpdateGrabState(e,!1))))}else this._objectMoveManipulation.forEachManipulator((e=>{e.grabbable=!1,e.cursor=null}));this._objectMoveManipulation.forEachManipulator((e=>this._manipulatorHandles.add(e.events.on("immediate-click",(e=>{this._manipulatorInfos.some((e=>e.manipulator.selected))?this._clearSelection():this.events.emit("immediate-click",{...e,object:this.object}),e.stopPropagation()})))))}}_createMoveManipulation(e){const{object:t,tool:n,view:i,_operations:r}=this;if(!r)return;this._moveManipulation=new oo({tool:n,view:i,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZShape&&yi(t.operations,t.elevationInfo),snapToScene:!1,radius:oo.radiusForSymbol(t.graphic?.symbol)}),this._moveManipulation.forEachManipulator((e=>this.addHandles([e.events.on("immediate-click",(t=>{this._moveManipulation.zManipulation.hasManipulator(e)||this._manipulatorInfos.some((e=>e.manipulator.selected))||this.events.emit("immediate-click",{...t,object:this.object}),t.stopPropagation()})),this._watchAndUpdateGrabState(e,!1)])));const o=e=>t=>{this.addHandles([t.events.on("focus-changed",(({action:t})=>{"focus"===t?this._updateTranslateTooltip(e):this._resetTooltip()}))])};this._moveManipulation.xyManipulation.forEachManipulator(o(ao.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(o(ao.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(o(ao.Z)),this._moveManipulation.elevationInfo={mode:"absolute-height",offset:0};const s=r.data.spatialReference;this.addHandles([this._moveManipulation.createDragPipeline(((i,o,s,a,l)=>{const{snappingStep:c,cancelSnapping:u}=(0,mo.L)({predicate:e=>!!e.info,snappingManager:n.snappingManager,snappingContext:new go.e({editGeometryOperations:r,elevationInfo:e,pointer:l,excludeFeature:t.graphic,visualizer:new Jt}),updatingHandles:this._updatingHandles,useZ:!1});return a=a.next((e=>(this._onDragCancel(),e))).next(u),{steps:s=s.next((e=>this._trackNumDragging(e))).next((e=>{const t=this._manipulatorInfos.filter((e=>"vertex"===e.type&&e.manipulator.selected));return e.manipulatorType===lr.TRANSLATE_XY&&1===t.length?{...e,info:t[0],snapOrigin:t[0].handle.pos}:e})).next((0,Ir.pg)(this.view,e,t.graphic??void 0)).next(...c).next((0,Ir.EX)()).next((e=>this._perObjectManipulatorDragAction(ss.SELECTED_OR_ALL,e))).next((e=>(this._updateTranslateTooltip(i,e),e))),cancel:a}}),e,s,t.graphic),(0,a.watch)((()=>t.visible),(()=>this._updateMoveManipulationPosition()),a.Vh),t.on("committed",(()=>{this._recreatingManipulators||this._updateMoveManipulationPosition()})),(0,a.watch)((()=>t.isDraped),(e=>{this._updateMoveManipulationPosition();const t="align-move-manipulation";e?this.addHandles(this.view.elevationProvider.on("elevation-change",(()=>this._updateMoveManipulationPosition())),t):this.removeHandles(t)}),a.Vh)])}_createVisualElements(){const{object:e,view:t}=this,n=br({view:t,object:e,forEachManipulator:e=>{if(!this.destroyed&&!this._recreatingManipulators){this._objectMoveManipulation.forEachManipulator(e),this._moveManipulation.forEachManipulator(e);for(const t of this._manipulatorInfos)e(t.manipulator,lr.TRANSLATE_XY)}},onManipulatorsChanged:e=>this.events.on("manipulators-changed",e)});null!=n&&(this._outlineVisualElement=n.visualElement instanceof An?n.visualElement:null);const i=this._outlineVisualElement;if(null!=i){const t=()=>{e.isDraped||this._updateMoveManipulationPosition()};this._manipulatorHandles.add((0,a.on)((()=>i.events),"attachment-origin-changed",t,{onListenerAdd:t}))}this._manipulatorHandles.add(n)}_createEdgeOffsetManipulator(e,t=this.object.elevationInfo){const n=this.view,i=this._operations;if(e.component.vertices.length<=2||!i)return null;const r=i.data.spatialReference,s=this._settings.manipulators.edgeOffset,a=s.size/2,l=a+s.collisionPadding,c=a/l,u=c/2,h=c*Math.sqrt(3)/2,{height:p,offset:f}=s,g=this._edgeOffsetManipulatorMaterial;if(!this._edgeOffsetManipulatorGeometryInside){const e=(0,tt._B)(g,h,u,u,p,f);this._edgeOffsetManipulatorGeometryInside=e}if(!this._edgeOffsetManipulatorGeometryOutside){const e=(0,tt._B)(g,-h,u,u,p,-f);this._edgeOffsetManipulatorGeometryOutside=e}const m=[new Or(this._edgeOffsetManipulatorGeometryInside.instantiate(),Bi.p7.Unfocused),new Or(this._edgeOffsetManipulatorGeometryInside.instantiate({material:this._edgeOffsetManipulatorHoverMaterial}),Bi.p7.Focused),new Or(this._edgeOffsetManipulatorGeometryOutside.instantiate(),Bi.p7.Unfocused),new Or(this._edgeOffsetManipulatorGeometryOutside.instantiate({material:this._edgeOffsetManipulatorHoverMaterial}),Bi.p7.Focused)],_=new $i({view:n,renderObjects:m,elevationInfo:"on-the-ground"!==t.mode||(0,Po.$d)(this.object.graphic?.symbol)?{mode:"absolute-height",offset:0}:t,worldOriented:!1,focusMultiplier:1,radius:l,available:this.object.visible,collisionType:{type:"disc",direction:(0,d.fA)(0,0,1)},collisionPriority:1,metadata:{deleting:!1},location:Jo(r)}),v=new $i({view:n,worldSized:!0,worldOriented:!1,available:this.object.visible,collisionPriority:-10,cursor:this.enableMoveObject?"move":"default",metadata:{deleting:!1},location:Jo(r)}),y={manipulator:_,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0,edgeManipulator:v,visibilityHandle:null};this._autoHideEdgeOffsetManipulator(y,s.minSquaredEdgeLength);const b=()=>this._updateEdgeOffsetManipulator(y);b(),y.locationUpdateHandle=(0,o.vE)([e.leftVertex,e.rightVertex].map((e=>{const t=this._getManipulatorInfoFromHandle(e);return t?.manipulator.events.on("location-update",b)})));const T=e=>{this._manipulatorInfos.some((e=>e.manipulator.selected))?this._clearSelection():this.events.emit("immediate-click",{...e,object:this.object}),e.stopPropagation()};return this._manipulatorHandles.add([y.locationUpdateHandle,this._watchAndUpdateGrabState(_,!0),this._watchAndUpdateGrabState(v,!0),(0,Ir.Xt)(_,this._createEdgeOffsetPipeline(y,t,i)),(0,Ir.Xt)(v,this._createEdgePipeline(y,t,i)),v.events.on("immediate-click",T),_.events.on("immediate-click",T),_.events.on("focus-changed",(()=>this._resetTooltip())),_.events.on("grab-changed",(({screenPoint:e,action:t})=>{y.grabMapPoint="start"===t?Ho(e,this.view,this.object,y):null}))],_),this._manipulatorInfos.push(y),this.manipulators.addMany([_,v]),this.events.emit("manipulators-changed"),y}_autoHideEdgeOffsetManipulator(e,t){const n=e.manipulator,i=e.edgeManipulator,r=()=>{e.visibilityHandle=(0,s.xt)(e.visibilityHandle);const r=this._getManipulatorInfoFromHandle(e.handle.leftVertex),a=this._getManipulatorInfoFromHandle(e.handle.rightVertex),l=null!=r&&null!=a&&function(e,t,n){const i=n.projectToRenderScreen(e,(0,g.r_)()),r=n.projectToRenderScreen(t,(0,g.r_)());return null!=i&&null!=r?(0,h.k)((0,h.d)(i,i,r)):0}(r.manipulator.renderLocation,a.manipulator.renderLocation,this.view.state.camera)<t;(!n.focused&&!i.focused||l)&&(n.grabbable=!l,i.grabbable=!l,e.visibilityHandle=(0,o.vE)([n.disableDisplay(),(0,o.hA)((()=>{n.grabbable=!0,i.grabbable=this.enableMoveObject}))]))};this._manipulatorHandles.add([n.events.on("focus-changed",r),i.events.on("focus-changed",r),(0,o.hA)((()=>{(0,s.xt)(e.visibilityHandle),i.metadata.deleting=!0,this.manipulators.remove(i)}))],n),r()}_updateEdgeOffsetManipulator(e){if(!this._operations)return;this._updateManipulatorPosition(e);const{coordinateHelper:t}=this._operations.data,n=Fo(this.view,e.manipulator.elevationAlignedLocation,No(t,e.handle,e.manipulator.elevationInfo)),i=this._getManipulatorInfoFromHandle(e.handle.leftVertex),r=this._getManipulatorInfoFromHandle(e.handle.rightVertex);if(null==i||null==r)return;const o=i.manipulator.renderLocation,s=r.manipulator.renderLocation,a=null!=n?function(e,t,n){const i=(0,Fi.Qj)(e),r=(0,h.o)((0,d.vt)(),t,n),o=(0,h.e)((0,d.vt)(),r,i),s=(0,h.e)((0,d.vt)(),r,o);return(0,Ct.fA)(r[0],r[1],r[2],0,o[0],o[1],o[2],0,s[0],s[1],s[2],0,0,0,0,1)}(n,o,s):Ct.zK;e.manipulator.modelTransform=a,e.edgeManipulator.elevationAlignedLocation=e.manipulator.elevationAlignedLocation,e.edgeManipulator.modelTransform=a;const l=(0,h.l)((0,h.d)(ns,o,s))/2;e.edgeManipulator.collisionType={type:"line",paths:[[[-l,0,0],[l,0,0]]]}}_createEdgePipeline(e,t,n){return(i,r,o,s)=>{if("touch"===s)this._createEdgeOffsetPipeline(e,t,n)(i,r,o);else if(this.enableMoveObject){const e=this.object.graphic,s=n.data.spatialReference,{elevationAlignedLocation:a}=i;r.next((e=>this._trackNumDragging(e))).next((0,Ir.Tp)(this.view,a)).next(Lr(this.view,a,t,s,e)).next((0,Ir.sO)()).next((0,Ir.EX)()).next((e=>this._perObjectManipulatorDragAction(ss.ALL,e))).next((e=>(this._updateTranslateObjectTooltip(ao.XY,e),e))).next((e=>{"end"===e.action&&this._resetTooltip()})),o.next((()=>this._onDragCancel(!i.metadata.deleting)))}}}_createEdgeOffsetPipeline(e,t,n){return(i,r,o)=>{const s=this._pendingEdgeOffsetInfo;if(s?.manipulatorInfo===e&&"drag"!==s.mode)return void o.execute({action:"cancel"});this._clearSelection();const{initializeStep:a,cleanup:l}=this._initializeEdgeOffset(e,t,n,o),c=this._applyEdgeOffsetStep(e);r.next((e=>this._trackNumDragging(e))).next((0,Ir.Tp)(this.view,i.elevationAlignedLocation)).next(a).next(function(e){return Dr(e,(e=>e.plane))}(this.view)).next(Fr(this.view,n.data.spatialReference)).next((0,Ir.EX)()).next((e=>{const{operation:t,mapEnd:n}=e;return null==t||null==n?e:{...e,signedDistance:t.signedDistanceToPoint(n)}})).next((e=>this._pendingEdgeOffsetInfo?e:c(e))).next((e=>{"end"!==e.action||this._pendingEdgeOffsetInfo||l()})),o.next((()=>{this._exitEdgeOffsetInputMode(),i.metadata.deleting||(l(),this._onDragCancel())}))}}_initializeEdgeOffset(e,t,n,i){const{view:r,object:a}=this,l=No(n.data.coordinateHelper,e.handle,t),c=n.createUndoGroup(),u=Fo(r,e.manipulator.elevationAlignedLocation,l);let h;this._splitEdgesBeforeEdgeOffset(e,l),this._selectEdgeOffsetArrow(e,l);const d=()=>{this._cleanEdgeOffsetCollapsedEdges(e,n),h=(0,s.xt)(h)},p=this.events.on("undo",d);return h=(0,o.vE)([this._initializeEdgeOffsetVisualElement(e,a,t,n),c,p,this._connectEdgeOffsetTooltip(e,l,n,(()=>{i.execute({action:"cancel"})}))]),{initializeStep:e=>null==l||null==u?(d(),null):{...e,operation:l,plane:u},cleanup:d}}_initializeEdgeOffsetVisualElement(e,t,n,i){const s=()=>new Co.A({paths:[[e.handle.leftVertex.pos,e.handle.rightVertex.pos]],spatialReference:i.data.spatialReference}),l=new An({view:this.view,isDraped:t.isDraped,geometry:s(),elevationInfo:n,width:this._settings.visualElements.lineObjects.outline.width,attached:!1,isDecoration:!0}),c=(0,o.vE)([(0,a.watch)((()=>({color:this._accentColor,draped:t.isDraped})),(({color:e,draped:t})=>{l.color=(0,r.QP)(e),l.isDraped=t}),a.pc),t.on("committed",(()=>{l.geometry=s()})),(0,o.DQ)(l)]);return l.attached=!0,c}_applyEdgeOffsetStep(e){return t=>(this.destroyed||null==t.operation||!this._operations||(this._updateEventState(os.RESHAPING),null==t.signedDistance?this._resetTooltip():((t.mapDeltaX||t.mapDeltaY||t.mapDeltaZ)&&(this._offsetEdge(e,t.operation,t.signedDistance),this.events.emit("reshape",{type:"reshape",object:this.object})),this._updateEdgeOffsetTooltip(t))),t)}_cleanEdgeOffsetCollapsedEdges(e,t){const n=e.handle.leftVertex.leftEdge?.leftVertex,i=e.handle.leftVertex,r=e.handle.rightVertex.rightEdge?.rightVertex,o=e.handle.rightVertex,s=t.data.coordinateHelper,a=this.view.pixelSizeAt(s.vectorToDehydratedPoint(i.pos),s.spatialReference),l=[];if(n&&s.distance(n.pos,i.pos)<is){const e=this._getManipulatorInfoFromHandle(i);null!=e&&l.push(e)}if(s.distance(i.pos,o.pos)<a||r&&s.distance(r.pos,o.pos)<is){const e=this._getManipulatorInfoFromHandle(o);null!=e&&l.push(e)}l.length&&this._removeVertices(l)}_enterInputModeDuringEdgeOffset(e){const t=this._findActiveEdgeOffsetManipulatorInfo();return!(!t||!(0,si.wG)(e,this.tooltip)||(t.manipulator.dragging?(this._pendingEdgeOffsetInfo={manipulatorInfo:t,mode:"drag"},0):(this._clearSelection(),this._pendingEdgeOffsetInfo={manipulatorInfo:t,mode:"hover"},this._connectEdgeOffsetTooltipOnHover(t),0)))}_exitEdgeOffsetInputMode(){this.tooltip&&(this._pendingEdgeOffsetInfo=null,this._resetTooltip(),this.tooltip.exitInputMode())}_findActiveEdgeOffsetManipulatorInfo(){return this._manipulatorInfos.filter(es).find((({manipulator:e})=>e.hovering||e.grabbing||e.dragging))}_connectEdgeOffsetTooltipOnHover(e){const{_operations:t,object:n}=this;if(!t)return;const{elevationInfo:i}=n,r=No(t.data.coordinateHelper,e.handle,i);this._selectEdgeOffsetArrow(e,r),this.addHandles([this._initializeEdgeOffsetVisualElement(e,n,i,t),this._connectEdgeOffsetTooltip(e,r,t,(()=>{this.removeHandles(r),this._exitEdgeOffsetInputMode()}))],r)}_splitEdgesBeforeEdgeOffset(e,t){if(t.requiresSplitEdgeLeft){const t=this._getManipulatorInfoFromHandle(e.handle.leftVertex.leftEdge);null!=t&&this._splitEdgeManipulator(t,1)}if(t.requiresSplitEdgeRight){const t=this._getManipulatorInfoFromHandle(e.handle.rightVertex.rightEdge);null!=t&&this._splitEdgeManipulator(t,0)}}_selectEdgeOffsetArrow(e,t){const n=e.grabMapPoint??Ho(this.view.inputManager?.latestPointerLocation,this.view,this.object,e);n&&t.selectArrowFromStartPoint(n)}_connectEdgeOffsetTooltip(e,t,n,i){const r=()=>this.tooltipInfos.edgeOffset.distance.actual,s=r=>{i(),queueMicrotask((()=>{this.view.focus();const i=n.createUndoGroup();this._tooltipCallbacks.onReshapeStart?.(),this._splitEdgesBeforeEdgeOffset(e,t),this._offsetEdge(e,t,function(e,t,n,{data:{coordinateHelper:i,spatialReference:r}}){const o=(0,pi.l3)(e,"meters"),s=(0,x.GA)(r),a=Math.sign(o*n.selectedArrow),l=(0,Do.Xn)(r),c=(0,Fi.Qj)(n.plane),u=i.pointToXYZ(t),p=(0,d.vt)();(0,h.b)(p,u,c,a*(10/s));const f=o*n.selectedArrow/s;if(!l||!(0,q.F)(u,r,u,l)||!(0,q.F)(p,r,p,l))return f;const g=new Do.Zj;if((0,Do._3)(g,u,p,l),(0,Do.vN)(p,u,g.azimuth,o,l),!(0,q.F)(p,l,p,r))return f;const m=p[0]-t.x,_=p[1]-t.y,v=Math.sqrt(m*m+_*_)*a,[y,b]=c,T=Math.sqrt(y*y+b*b);return 0===T?0:v/T}(r,e.manipulator.location,t,n)),this._tooltipCallbacks.onReshape?.(),this._tooltipCallbacks.onReshapeStop?.(),this._cleanEdgeOffsetCollapsedEdges(e,n),i.remove()}))},l=()=>{const e=r();null!=e?s(e):i()};return(0,o.vE)([(0,a.when)((()=>this.tooltip&&!this.tooltip.focused),(()=>l()),a.OH),this.tooltip.on("discard",i),this.tooltip.on("commit",(e=>{"commit-and-exit"===e.type&&l()}))])}_createVertexOrEdgeManipulator(e,t=this.object.elevationInfo,n=!1){const i=this.view,r=this._operations,a=this._settings;if(!r)return null;const l=r.data.type,c=r.data.spatialReference;if("edge"===e.type){if(this.enableEdgeOffset)return this._createEdgeOffsetManipulator(e,t);if(!this.enableMidpoints)return null}if(null==this._vertexManipulatorGeometry||null==this._vertexManipulatorOutlineGeometry){const{size:e,outlineSize:t}=Qo(a.manipulators.vertex);this._vertexManipulatorGeometry=(0,tt.CM)(this._vertexManipulatorMaterial,e,16,16),this._vertexManipulatorOutlineGeometry=(0,tt.CM)(this._vertexManipulatorOutlineMaterial,t,16,16)}if(null==this._edgeManipulatorGeometry||null==this._edgeManipulatorOutlineGeometry){const{size:e,outlineSize:t}=Qo(a.manipulators.edge);this._edgeManipulatorGeometry=(0,tt.CM)(this._edgeManipulatorMaterial,e,16,16),this._edgeManipulatorOutlineGeometry=(0,tt.CM)(this._edgeManipulatorOutlineMaterial,t,16,16)}const u="point"===l||"mesh"===l?[]:[new Or(this._vertexManipulatorGeometry.instantiate(),rs.Vertex|Bi.p7.Unselected),new Or(this._vertexManipulatorOutlineGeometry.instantiate(),rs.Vertex|Bi.p7.Unfocused|Bi.p7.Unselected),new Or(this._vertexManipulatorOutlineGeometry.instantiate({material:this._vertexManipulatorHoverOutlineMaterial}),rs.Vertex|Bi.p7.Focused|Bi.p7.Unselected),new Or(this._vertexManipulatorGeometry.instantiate({material:this._selectedManipulatorMaterial}),Bi.p7.Selected),new Or(this._vertexManipulatorOutlineGeometry.instantiate({material:this._selectedManipulatorOutlineMaterial}),Bi.p7.Selected|Bi.p7.Unfocused),new Or(this._vertexManipulatorOutlineGeometry.instantiate({material:this._selectedManipulatorHoverOutlineMaterial}),Bi.p7.Selected|Bi.p7.Focused)];this.enableMidpoints&&u.push(new Or(this._edgeManipulatorGeometry.instantiate({material:this._vertexManipulatorMaterial}),rs.Edge|Bi.p7.Focused|Bi.p7.Unselected),new Or(this._edgeManipulatorOutlineGeometry.instantiate({material:this._vertexManipulatorHoverOutlineMaterial}),rs.Edge|Bi.p7.Focused|Bi.p7.Unselected),new Or(this._edgeManipulatorGeometry.instantiate(),rs.Edge|Bi.p7.Unfocused|Bi.p7.Unselected),new Or(this._edgeManipulatorOutlineGeometry.instantiate(),rs.Edge|Bi.p7.Unfocused|Bi.p7.Unselected));const h=new $i({view:i,renderObjects:u,elevationInfo:t,focusMultiplier:1,touchMultiplier:1,available:this.object.visible,metadata:{deleting:!1},location:Jo(c)});h.selected=n,this._setTypeSpecificManipulatorSettings(h,e,t);const d="edge"===e.type?{manipulator:h,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:h,handle:e,type:"vertex",selectedIndex:0};if(this._manipulatorInfos.push(d),this.manipulators.add(h),this._updateManipulatorPosition(d),"edge"===d.type){const e=[];for(const t of[d.handle.leftVertex,d.handle.rightVertex]){const n=this._getManipulatorInfoFromHandle(t);null!=n&&e.push(n.manipulator.events.on("location-update",(()=>this._updateManipulatorPosition(d))))}d.locationUpdateHandle=(0,o.vE)(e),this._manipulatorHandles.add(d.locationUpdateHandle,h)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(h,!0),h);const p=(0,Ir.Xt)(h,((e,n,o,a)=>{let l=null;const{snappingStep:u,cancelSnapping:h}=(0,mo.L)({predicate:()=>!this._isMultiVertexSelection(),snappingManager:this.tool.snappingManager,snappingContext:new go.e({editGeometryOperations:r,elevationInfo:t,pointer:a,excludeFeature:this.object.graphic,visualizer:new Jt}),updatingHandles:this._updatingHandles,useZ:!1});o=o.next((t=>(this._onDragCancel(!e.metadata.deleting,(()=>l=(0,s.xt)(l))),t))).next(h);const{elevationAlignedLocation:p}=e,f=this.object.graphic??void 0;n.next((e=>this._trackNumDragging(e))).next((e=>{if("start"===e.action&&r&&(l=r.createUndoGroup()),"edge"===d.type){const t=this._splitEdgeManipulator(d);return{...e,info:t,snapOrigin:t.handle.pos}}return{...e,info:d,snapOrigin:d.handle.pos}})).next((0,Ir.Tp)(i,p)).next(Lr(i,p,t,c,f)).next((0,Ir.pg)(i,t,f)).next(...u).next((0,Ir.EX)()).next((e=>{this._perVertexManipulatorDragAction(e),"end"===e.action&&(l=(0,s.xt)(l)),this._resetTooltip()}))}));return this._manipulatorHandles.add([p,h.events.on("immediate-click",(e=>this._manipulatorClickCallback(e,d))),h.events.on("select-changed",(()=>{d.selectedIndex=++this._selectedIndex,this._updateMoveManipulationPosition(),this._resetTooltip()})),h.events.on("focus-changed",(()=>{this._resetTooltip()}))],h),this.events.emit("manipulators-changed"),d}_trackNumDragging(e){switch(e.action){case"start":this._numDragging++;break;case"end":this._numDragging--}return e}_onDragCancel(e=!0,t){switch(this._numDragging--,e&&this.undo(),this.tool.snappingManager?.doneSnapping(),this._resetTooltip(),this._reshapeEventState){case os.NONE:break;case os.MOVING:this.events.emit("move",{type:"move",dx:0,dy:0,object:this.object});break;case os.RESHAPING:this.events.emit("reshape",{type:"reshape",object:this.object})}t?.(),this.destroyed||this._updateEventState(os.NONE)}_setTypeSpecificManipulatorSettings(e,t,n){const i=this._settings;switch(t.type){case"vertex":{e.state=rs.Vertex,e.selectable=!0,e.cursor="move",e.collisionPriority=2;const{size:t,collisionPadding:r}=i.manipulators.vertex;e.radius=t/2+r,e.elevationInfo=n;const o=this._operations?.data.type;e.interactive=null!=o&&"point"!==o&&"mesh"!==o;break}case"edge":{e.state=rs.Edge,e.selectable=!1,e.cursor="copy",e.collisionPriority=-1;const{size:t,collisionPadding:r}=i.manipulators.edge;e.radius=t/2+r,e.elevationInfo="on-the-ground"!==n.mode||(0,Po.$d)(this.object.graphic?.symbol)?{mode:"absolute-height",offset:0}:n;break}}}_watchAndUpdateGrabState(e,t){return e.events.on("grab-changed",(n=>{this._onGrabStateChanged(e,t,n.action,n.pointerType)}))}_onGrabStateChanged(e,t,n,i="mouse"){if(!this._recreatingManipulators){if("start"===n)t&&this._updateSelection(e),this._numGrabbing++;else if(this._numGrabbing--,this._updateEventState(os.NONE),this.destroyed)return;this._moveManipulation.interactive=!this._numGrabbing,("touch"!==i||this.enableEdgeOffset)&&(this._manipulatorInfos.forEach((e=>{const{manipulator:t}=e,n=this._operations?.data.type;t.interactive=t.grabbing||!this._numGrabbing&&null!=n&&"point"!==n&&"mesh"!==n,es(e)&&(e.edgeManipulator.interactive=e.edgeManipulator.grabbing||!this._numGrabbing)})),this._objectMoveManipulation.forEachManipulator((e=>{e.interactive=e.grabbing||!this._numGrabbing})))}}_clearSelection(){for(const e of this._manipulatorInfos)e.manipulator.grabbing||(e.manipulator.selected=!1);this._pendingEdgeOffsetInfo=null}_updateSelection(e){e.grabbing&&!e.selected&&e.selectable&&(this._clearSelection(),e.selected=!0,this.events.emit("manipulators-changed"))}_removeManipulator(e){null!=e&&(e.manipulator.metadata.deleting=!0,this.manipulators.remove(e.manipulator),this._manipulatorHandles.remove(e.manipulator),(0,hi.Xy)(this._manipulatorInfos,e),this.events.emit("manipulators-changed"),this._resetTooltip())}_getManipulatorInfoFromHandle(e){if(e)for(const t of this._manipulatorInfos)if(e===t.handle)return t;return null}_updateManipulatorPositions(e){for(const t of e)this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(t))}_updateManipulatorPosition(e){const t=this._operations;if(null!=e&&t)if("vertex"===e.type)e.manipulator.location=t.data.coordinateHelper.vectorToDehydratedPoint(e.handle.pos,ts),e.manipulator.grabbing&&null!=this._vertexLaserLineVisualElement&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=e.manipulator.renderLocation);else if("edge"===e.type){const n=this._getManipulatorInfoFromHandle(e.handle.leftVertex),i=this._getManipulatorInfoFromHandle(e.handle.rightVertex);if(null==n||null==i)return;const r=n.manipulator,o=i.manipulator;if("on-the-ground"===e.manipulator.elevationInfo?.mode){const n=r.location,i=o.location,s=.5,a=n.x+s*(i.x-n.x),l=n.y+s*(i.y-n.y),c=n.hasZ&&i.hasZ?0:void 0;e.manipulator.location=(0,gt.T)(a,l,c,t.data.spatialReference)}else(0,h.m)(ns,r.renderLocation,o.renderLocation,.5),e.manipulator.renderLocation=ns}}_splitEdgeManipulator(e,t=.5){const n=this._operations,i=n.splitEdge(e.handle,t).createdVertex;e.locationUpdateHandle=(0,s.xt)(e.locationUpdateHandle);const r=this.object.elevationInfo;let o;this.enableEdgeOffset?(this._removeManipulator(e),o=this._createVertexOrEdgeManipulator(i)):(o=e,o.handle=i,o.type="vertex",this._setTypeSpecificManipulatorSettings(e.manipulator,e.handle,r)),i.leftEdge&&this._createVertexOrEdgeManipulator(i.leftEdge),i.rightEdge&&this._createVertexOrEdgeManipulator(i.rightEdge),this._updateManipulatorPosition(o),this.enableEdgeOffset||this._resetTooltip(),this._updateSelection(e.manipulator);const a=this._updateEventState(os.RESHAPING),l=n.data.coordinateHelper.vectorToArray(o.handle.pos),c=n.data.components.indexOf(i.component);return this.events.emit("vertex-add",{type:"vertex-add",object:this.object,vertices:[{coordinates:l,componentIndex:c,vertexIndex:i.index}],added:l}),a&&this._updateEventState(os.NONE),o}_updateMoveManipulationPosition(){const e=(0,h.i)(ns,0,0,0);let t=0,n=!1,i=null,r=null;for(const o of this._manipulatorInfos)"vertex"===o.type&&(o.manipulator.selected?(t++,(0,h.g)(e,e,o.manipulator.renderLocation),null==i||o.selectedIndex>i.selectedIndex?(r=i,i=o):(null==r||o.selectedIndex>r.selectedIndex)&&(r=o)):n=!0);const o=this.object,s=this._operations?.data.geometry;if(0===t){const e=o.visible&&this.enableMoveObject;this._moveManipulation.xyManipulation.available=e,this._moveManipulation.xyAxisManipulation.available=e,this._moveManipulation.xyAxisManipulation.orthogonalAvailable=e,this._moveManipulation.zManipulation.available=e&&this.enableZShape&&yi(this._operations,o.elevationInfo),this._moveManipulation.angle=mi(s),this._moveManipulation.radius=oo.radiusForSymbol(o.graphic?.symbol)}else{const e=o.visible;this._moveManipulation.xyManipulation.available=e,this._moveManipulation.xyAxisManipulation.available=e,this._moveManipulation.zManipulation.available=e&&this.enableZVertex&&yi(this._operations,this.object.elevationInfo),this._moveManipulation.xyAxisManipulation.orthogonalAvailable=e&&1!==t;let n=0;if(null!=i){const e=i.handle.pos,t=null!=r?r.handle.pos:i.handle.leftEdge?.leftVertex?i.handle.leftEdge.leftVertex.pos:null,o=null==r&&i.handle.rightEdge?.rightVertex?i.handle.rightEdge.rightVertex.pos:null;t&&o?this._moveManipulation.xyAxisManipulation.available=!1:t?n=Ko(t,e):o&&(n=Ko(e,o))}this._moveManipulation.angle=n,this._moveManipulation.radius=xr}0!==t&&n?((0,h.h)(e,e,1/t),ts.spatialReference=this._operations.data.spatialReference,ts.hasZ=!0,this.view.renderCoordsHelper.fromRenderCoords(e,ts),this._moveManipulation.elevationAlignedLocation=ts):null==this._outlineVisualElement||this.object.isDraped||null==this._outlineVisualElement.attachmentOrigin?Kr(this._moveManipulation,this.object):this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin}_removeVertices(e){const t=new Array,n=this._operations;if(n){for(const i of e){const e=i.handle.component;if("vertex"===i.type&&n.canRemoveVertex(e)){t.push(i.handle),this._removeManipulator(i),this._removeManipulator(this._getManipulatorInfoFromHandle(i.handle.leftEdge)),this._removeManipulator(this._getManipulatorInfoFromHandle(i.handle.rightEdge));const r=n.removeVertices([i.handle]),o=r.removedVertices?.[0].createdEdge;o?this._createVertexOrEdgeManipulator(o):this.enableEdgeOffset&&e.vertices.length<=2&&this._removeManipulator(this._getManipulatorInfoFromHandle(e.edges[0]))}}if(t.length>0){const e=t.map((e=>{const t=n.data.components.indexOf(e.component);return{coordinates:n.data.coordinateHelper.vectorToArray(e.pos),componentIndex:t,vertexIndex:e.index}})),i=this._updateEventState(os.RESHAPING);if(this.destroyed)return;if(this.events.emit("vertex-remove",{type:"vertex-remove",object:this.object,removed:e.map((e=>e.coordinates)),vertices:e}),this.destroyed)return;if(i&&(this._updateEventState(os.NONE),this.destroyed))return;this._updateMoveManipulationPosition()}}}_moveVertices(e,t,n=("start"===t.action?bi.Y.NEW_STEP:bi.Y.ACCUMULATE_STEPS)){const i=this._operations;if(i){e.length>0&&i.moveVertices(e.map((e=>e.handle)),t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ,n);for(const t of e)this._updateManipulatorPosition(t)}}_offsetEdge(e,t,n){if(!this._operations)return;const i=t.clone();i.distance=n,this._operations.updateVertices([e.handle.leftVertex,e.handle.rightVertex],i),this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.leftVertex)),this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.rightVertex))}_manipulatorClickCallback(e,t){e.shiftKey||this._clearSelection(),"vertex"===t.type&&(t.manipulator.selected=!t.manipulator.selected,this.enableDeleteVertices&&e.button===Wo.w.Right&&this._removeVertices([t])),"edge"===t.type&&e.button===Wo.w.Left&&this._splitEdgeManipulator(t),e.stopPropagation()}_updateTranslateTooltip(e,t){null!=this._defaultTooltipInfo?this._resetTooltip():this._updateTranslateObjectTooltip(e,t)}_updateTranslateObjectTooltip(e,t){this._pendingEdgeOffsetInfo||(this.activeTooltipInfo=function(e,t,{sketchOptions:n,tooltipInfos:i}){let r=null;switch(e){case ao.XY:r=i.translate,jo(r,t,((e,t)=>(0,N.Kt)(e,t)));break;case ao.XY_AXIS:r=i.translateXY,jo(r,t,((e,n)=>(0,pi.hs)((0,N.Kt)(e,n),kr(t))));break;case ao.Z:r=i.translateZ,jo(r,t,Ti.e5)}return r.sketchOptions=n,r}(e,t,this._tooltipsContext))}_updateEdgeOffsetTooltip(e){this._pendingEdgeOffsetInfo||(this.activeTooltipInfo=Zo(this.object,e,this._tooltipsContext))}_resetTooltip(){const e=this.activeTooltipInfo;if(this._pendingEdgeOffsetInfo&&"reshape-edge-offset"===e?.type)return;let t=null;t=this._pendingEdgeOffsetInfo||null!=this._findActiveEdgeOffsetManipulatorInfo()?Zo(this.object,null,this._tooltipsContext):this._defaultTooltipInfo,t!==e&&(null!=e&&null!=t&&"input"===this.tooltip.mode||(this.activeTooltipInfo=t))}get _defaultTooltipInfo(){const e=this._operations?.data.type;switch(e){case"polyline":case"polygon":return this._selectedVertexManipulatorInfo?this.tooltipInfos.selectedVertex:null;case"point":case"mesh":return this.tooltipInfos.movePoint;default:return null}}get _selectedVertexManipulatorInfo(){const e=this._manipulatorInfos.filter((e=>"vertex"===e.type&&e.manipulator.selected));return 1===e.length?e[0]:null}get _tooltipsContext(){return{sketchOptions:this._sketchOptions,tooltipInfos:this.tooltipInfos,activeTooltipInfo:this.activeTooltipInfo,selectedVertexManipulatorInfo:this._selectedVertexManipulatorInfo,callbacks:this._tooltipCallbacks}}get test(){}};function Qo(e){const t=e.size/2,n=t+e.collisionPadding;return{size:t/n,outlineSize:(t+e.outlineSize)/n}}function Ko(e,t){return Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI/2}function Jo(e){return new Gi.default({x:0,y:0,z:0,spatialReference:e})}function es(e){return"edge"===e.type&&"edgeManipulator"in e}(0,i._)([(0,l.MZ)()],Xo.prototype,"_numGrabbing",void 0),(0,i._)([(0,l.MZ)()],Xo.prototype,"_numDragging",void 0),(0,i._)([(0,l.MZ)()],Xo.prototype,"_pendingEdgeOffsetInfo",void 0),(0,i._)([(0,l.MZ)()],Xo.prototype,"_operations",null),(0,i._)([(0,l.MZ)()],Xo.prototype,"_segmentLabels",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0})],Xo.prototype,"tool",void 0),(0,i._)([(0,l.MZ)()],Xo.prototype,"tooltip",void 0),(0,i._)([(0,l.MZ)()],Xo.prototype,"activeTooltipInfo",void 0),(0,i._)([(0,l.MZ)({readOnly:!0})],Xo.prototype,"updating",null),(0,i._)([(0,l.MZ)()],Xo.prototype,"manipulators",null),(0,i._)([(0,l.MZ)()],Xo.prototype,"view",null),(0,i._)([(0,l.MZ)()],Xo.prototype,"object",null),(0,i._)([(0,l.MZ)()],Xo.prototype,"enableZShape",null),(0,i._)([(0,l.MZ)()],Xo.prototype,"enableDeleteVertices",null),(0,i._)([(0,l.MZ)()],Xo.prototype,"enableZVertex",null),(0,i._)([(0,l.MZ)()],Xo.prototype,"autoHideManipulators",null),(0,i._)([(0,l.MZ)()],Xo.prototype,"enableMoveObject",null),(0,i._)([(0,l.MZ)()],Xo.prototype,"enableMidpoints",null),(0,i._)([(0,l.MZ)()],Xo.prototype,"enableEdgeOffset",null),(0,i._)([(0,l.MZ)()],Xo.prototype,"_sketchOptions",null),(0,i._)([(0,l.MZ)()],Xo.prototype,"_accentColor",null),(0,i._)([(0,l.MZ)()],Xo.prototype,"_tooltipsContext",null),Xo=(0,i._)([(0,u.$)("esri.views.3d.interactive.editingTools.reshape.ReshapeOperation")],Xo);const ts=(0,gt.T)(0,0,void 0,Io.A.WGS84),ns=(0,d.vt)(),is=1e-6;var rs,os,ss;!function(e){e.Vertex=Bi.SJ.Custom1,e.Edge=Bi.SJ.Custom2}(rs||(rs={})),function(e){e[e.NONE=0]="NONE",e[e.MOVING=1]="MOVING",e[e.RESHAPING=2]="RESHAPING"}(os||(os={})),function(e){e[e.ALL=0]="ALL",e[e.SELECTED_OR_ALL=1]="SELECTED_OR_ALL"}(ss||(ss={}));let as=class extends ho.g{constructor(e){super(e),this._reshapeOperation=null,this.events=new xn.A,this.enableZShape=!0,this.enableZVertex=!0,this.enableMoveObject=!0,this.enableDeleteVertices=!0,this.autoHideManipulators=!1,this.enableMidpoints=!0,this.enableEdgeOffset=!1,this.type="reshape-3d",this.sketchOptions=new fo.A,this.snappingManager=null,this.automaticManipulatorSelection=!1}initialize(){const e=this._reshapeOperation=new Xo({tool:this});this.addHandles([e.events.on("reshape",(e=>this.events.emit("reshape",e))),e.events.on("move",(e=>this.events.emit("move",e))),e.events.on("vertex-add",(e=>this.events.emit("vertex-add",e))),e.events.on("vertex-remove",(e=>this.events.emit("vertex-remove",e))),e.events.on("immediate-click",(e=>this.events.emit("immediate-click",{...e,object:this.object}))),this.view.on("pointer-down",["Shift"],(e=>e.stopPropagation()))]),this.finishToolCreation()}destroy(){this._reshapeOperation=(0,s.pR)(this._reshapeOperation)}get updating(){return((this.object.updating??!1)||this._reshapeOperation?.updating)??!1}get activeTooltipInfo(){return this._reshapeOperation?.activeTooltipInfo??null}get tooltip(){return this._reshapeOperation?.tooltip??null}onManipulatorSelectionChanged(){this._reshapeOperation?.onManipulatorSelectionChanged()}get canUndo(){return this._reshapeOperation?.canUndo??!1}undo(){this.snappingManager?.doneSnapping(),this._reshapeOperation?.undo()}get canRedo(){return this._reshapeOperation?.canRedo??!1}redo(){this.snappingManager?.doneSnapping(),this._reshapeOperation?.redo()}onInputEvent(e){const t=this._reshapeOperation;t&&!t.enterInputModeIfAvailable(e)&&this.enableDeleteVertices&&"key-down"===e.type&&qo.NE.delete.includes(e.key)&&t.removeSelectedVertices()>0&&e.stopPropagation()}reset(){}};(0,i._)([(0,l.MZ)()],as.prototype,"_reshapeOperation",void 0),(0,i._)([(0,l.MZ)()],as.prototype,"view",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0})],as.prototype,"object",void 0),(0,i._)([(0,l.MZ)()],as.prototype,"enableZShape",void 0),(0,i._)([(0,l.MZ)()],as.prototype,"enableZVertex",void 0),(0,i._)([(0,l.MZ)()],as.prototype,"enableMoveObject",void 0),(0,i._)([(0,l.MZ)()],as.prototype,"enableDeleteVertices",void 0),(0,i._)([(0,l.MZ)()],as.prototype,"autoHideManipulators",void 0),(0,i._)([(0,l.MZ)()],as.prototype,"enableMidpoints",void 0),(0,i._)([(0,l.MZ)()],as.prototype,"enableEdgeOffset",void 0),(0,i._)([(0,l.MZ)()],as.prototype,"type",void 0),(0,i._)([(0,l.MZ)({type:fo.A})],as.prototype,"sketchOptions",void 0),(0,i._)([(0,l.MZ)()],as.prototype,"snappingManager",void 0),(0,i._)([(0,l.MZ)()],as.prototype,"updating",null),(0,i._)([(0,l.MZ)()],as.prototype,"activeTooltipInfo",null),(0,i._)([(0,l.MZ)()],as.prototype,"tooltip",null),(0,i._)([(0,l.MZ)()],as.prototype,"automaticManipulatorSelection",void 0),as=(0,i._)([(0,u.$)("esri.views.3d.interactive.editingTools.reshape.ReshapeTool3D")],as);var ls=n(26133);let cs=class extends v.A{constructor(e){super(e),this._interactionState=null}initialize(){this.addHandles([(0,a.when)((()=>{const e=this._interactionState;return e&&e.angle!==e.previousAngle?{interactionState:e,angle:e.state.angle}:null}),(({interactionState:e})=>{this._updateMeshRotation(e)}),a.OH),(0,a.when)((()=>{const e=this._interactionState;return e&&e.scale!==e.previousScale?{interactionState:e,scale:e.state.scale}:null}),(({interactionState:e})=>{this._updateMeshSize(e)}),a.OH)])}get initialAngle(){return this._interactionState?.initialAngle??0}get angle(){const e=this.geometry.transform;if(null==e)return this._interactionState?.angle??0;const t=(0,ls.yo)(e.rotation)[2];return Math.abs(t)>.999999?(0,b.kU)((0,ls.g7)(e.rotation))*Math.sign(t):0}get angleClockwise(){return-this.angle}get relativeAngle(){return this.angle-this.initialAngle}get relativeAngleClockwise(){return-this.relativeAngle}get scale(){return this._interactionState?.scale??1}startInteraction(){const e=new us({angle:this.angle});this._interactionState=e;const t=()=>{this._interactionState=null};return{state:e,done:t,cancel:()=>{e.cancel(),t()}}}createUndoRecord(){return this.object.createUndoRecord()}_updateMeshRotation(e){const{angle:t,previousAngle:n}=e;e.previousAngle=t;const i=(0,b.KJ)(t-n);this.geometry.rotate(0,0,i)}_updateMeshSize(e){const{scale:t,previousScale:n}=e;e.previousScale=t;const i=t/n;this.geometry.scale(i)}};(0,i._)([(0,l.MZ)({constructOnly:!0})],cs.prototype,"object",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0})],cs.prototype,"geometry",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0})],cs.prototype,"viewingMode",void 0),(0,i._)([(0,l.MZ)()],cs.prototype,"initialAngle",null),(0,i._)([(0,l.MZ)()],cs.prototype,"angle",null),(0,i._)([(0,l.MZ)()],cs.prototype,"angleClockwise",null),(0,i._)([(0,l.MZ)()],cs.prototype,"relativeAngle",null),(0,i._)([(0,l.MZ)()],cs.prototype,"relativeAngleClockwise",null),(0,i._)([(0,l.MZ)()],cs.prototype,"scale",null),(0,i._)([(0,l.MZ)()],cs.prototype,"_interactionState",void 0),cs=(0,i._)([(0,u.$)("esri.views.3d.interactive.editingTools.transform.ScaleRotateMeshAdapter")],cs);let us=class extends v.A{get state(){const{angle:e,scale:t}=this;return{angle:e,scale:t}}constructor(e){super(e),this.angle=0,this.initialAngle=0,this.previousAngle=0,this.previousScale=1,this.scale=1,this.initialAngle=e.angle,this.previousAngle=e.angle}cancel(){this.angle=this.initialAngle,this.scale=1}};(0,i._)([(0,l.MZ)()],us.prototype,"angle",void 0),(0,i._)([(0,l.MZ)()],us.prototype,"initialAngle",void 0),(0,i._)([(0,l.MZ)()],us.prototype,"previousAngle",void 0),(0,i._)([(0,l.MZ)()],us.prototype,"previousScale",void 0),(0,i._)([(0,l.MZ)()],us.prototype,"scale",void 0),(0,i._)([(0,l.MZ)()],us.prototype,"state",null),us=(0,i._)([(0,u.$)("esri.views.3d.interactive.editingTools.transform.ScaleRotateMeshAdapter.InteractionState")],us);let hs=class extends v.A{constructor(e){super(e),this.sizeAxis=null,this._interactionState=null}initialize(){this.addHandles((0,a.when)((()=>null!=this._interactionState?this._interactionState.state:null),(e=>{this._updateSymbol(e)}),a.OH))}get initialAngle(){return this._interactionState?.initialAngle??0}get angle(){return null!=this._interactionState?this._interactionState.angle:null!=this._orientationReferenceSymbolLayer?(e=this._orientationReferenceSymbolLayer.heading??0,-(0,b.kU)(e)):0;var e}get angleClockwise(){return-this.angle}get orientation(){return this.angle}get orientationClockwise(){return this.angleClockwise}get relativeAngle(){return this.angle-this.initialAngle}get relativeAngleClockwise(){return-this.relativeAngle}get scale(){return this._interactionState?.scale??1}get size(){const e=this._sizeReferenceSymbolLayer;if(null==e)return null;const t=this.findLayerView(),n=this._graphicSymbol;if(null==t||null==n||"point-3d"!==n.type)return null;const i=t.getSymbolLayerSize(n,e);if("size"in i&&null!=i.size)return i.size;const r=this.sizeAxis;return!("width"in i)||null==i.width||null!=r&&"width"!==r&&"all"!==r&&"width-and-depth"!==r?!("depth"in i)||null==e.depth||null!=r&&"depth"!==r&&"all"!==r&&"width-and-depth"!==r?!("height"in i)||null==e.height||null!=r&&"height"!==r&&"all"!==r?null:i.height:i.depth:i.width}get _sizeReferenceSymbolLayer(){const e=this._graphicSymbol;return null==e||0===e.symbolLayers.length?null:e.symbolLayers.find((e=>"object"===e.type))}get _orientationReferenceSymbolLayer(){const e=this._graphicSymbol;return null==e||0===e.symbolLayers.length?null:e.symbolLayers.find((e=>"object"===e.type&&null!=e.heading))}get _graphicSymbol(){return null!=this.graphic?.symbol&&"point-3d"===this.graphic.symbol.type?this.graphic.symbol:null}set _graphicSymbol(e){this.graphic.symbol=e}startInteraction(){const e=this._graphicSymbol,t=this.findLayerView();if(null!=this._interactionState||null==e||null==t)return ds;const n=e.symbolLayers.map((n=>"object"===n.type?t.getSymbolLayerSize(e,n):null)).toArray(),i=e.clone(),r=this.angle,o=new ps({originalSymbol:i,angle:r,initialSizes:n});this._interactionState=o;const s=()=>{this._interactionState=null};return{state:o,done:s,cancel:()=>{this._graphicSymbol=i,s()}}}createUndoRecord(){let e=this.graphic.symbol,t=null;return{undo:n=>{t=n.symbol,n.symbol=e},redo:n=>{e=n.symbol,n.symbol=t}}}_updateSymbol({scale:e,angle:t,originalSymbol:n,initialSizes:i}){const r=this._graphicSymbol;if(null==r||"point-3d"!==r.type)return;const o=r.clone(),s=-(0,b.KJ)(t-this.initialAngle);let a=!1;this._forEachObjectSymbolLayerPair(n,o,((t,n,r)=>{const o=(t.heading??0)+s;n.heading!==o&&(n.heading=o,a=!0);const l=i[r];if(null!=l&&"width"in l){l.width=this.sizeFilter(l.width),l.height=this.sizeFilter(l.height),l.depth=this.sizeFilter(l.depth);const t=l.width*e;n.width!==t&&(n.width=t,a=!0);const i=l.depth*e;n.depth!==i&&(n.depth=i,a=!0);const r=l.height*e;n.height!==r&&(n.height=r,a=!0)}})),a&&(this._graphicSymbol=o)}_forEachObjectSymbolLayerPair(e,t,n){e.symbolLayers.forEach(((e,i)=>{const r=t.symbolLayers.at(i);"object"===e.type&&"object"===r.type&&n(e,r,i)}))}};(0,i._)([(0,l.MZ)()],hs.prototype,"initialAngle",null),(0,i._)([(0,l.MZ)()],hs.prototype,"angle",null),(0,i._)([(0,l.MZ)()],hs.prototype,"angleClockwise",null),(0,i._)([(0,l.MZ)()],hs.prototype,"orientation",null),(0,i._)([(0,l.MZ)()],hs.prototype,"orientationClockwise",null),(0,i._)([(0,l.MZ)()],hs.prototype,"relativeAngle",null),(0,i._)([(0,l.MZ)()],hs.prototype,"relativeAngleClockwise",null),(0,i._)([(0,l.MZ)()],hs.prototype,"scale",null),(0,i._)([(0,l.MZ)()],hs.prototype,"size",null),(0,i._)([(0,l.MZ)()],hs.prototype,"sizeAxis",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0})],hs.prototype,"graphic",void 0),(0,i._)([(0,l.MZ)()],hs.prototype,"_interactionState",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0})],hs.prototype,"findLayerView",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0})],hs.prototype,"sizeFilter",void 0),(0,i._)([(0,l.MZ)()],hs.prototype,"_sizeReferenceSymbolLayer",null),(0,i._)([(0,l.MZ)()],hs.prototype,"_orientationReferenceSymbolLayer",null),(0,i._)([(0,l.MZ)()],hs.prototype,"_graphicSymbol",null),hs=(0,i._)([(0,u.$)("esri.views.3d.interactive.editingTools.transform.ScaleRotateObjectSymbol3DAdapter")],hs);const ds={state:{angle:0,scale:0},done:()=>{},cancel:()=>{}};let ps=class extends v.A{get state(){const{originalSymbol:e,angle:t,initialAngle:n,scale:i,initialSizes:r}=this;return{originalSymbol:e,angle:t,initialAngle:n,scale:i,initialSizes:r}}constructor(e){super(e),this.angle=0,this.initialAngle=0,this.scale=1,this.initialAngle=e.angle}};(0,i._)([(0,l.MZ)()],ps.prototype,"originalSymbol",void 0),(0,i._)([(0,l.MZ)()],ps.prototype,"angle",void 0),(0,i._)([(0,l.MZ)()],ps.prototype,"initialAngle",void 0),(0,i._)([(0,l.MZ)()],ps.prototype,"initialSizes",void 0),(0,i._)([(0,l.MZ)()],ps.prototype,"scale",void 0),(0,i._)([(0,l.MZ)()],ps.prototype,"state",null),ps=(0,i._)([(0,u.$)("esri.views.3d.interactive.editingTools.transform.ScaleRotateObjectSymbol3DAdapter.InteractionState")],ps);var fs,gs,ms=n(16691),_s=n(74087);(gs=fs||(fs={})).ScaleIn=Bi.SJ.Custom2,gs.ScaleOut=Bi.SJ.Custom3,gs.RotateLeft=Bi.SJ.Custom4,gs.RotateRight=Bi.SJ.Custom5,gs.Unlocked=Bi.SJ.Custom7,gs.DelayedFocused=Bi.SJ.Custom8,gs.TouchInput=Bi.SJ.Custom12;let vs=class extends v.A{get angle(){return this.adapter.angle}get scale(){return this.adapter.scale}set location(e){this._ringManipulator.location=e}set elevationAlignedLocation(e){this._ringManipulator.elevationAlignedLocation=e}get grabbing(){return this._ringManipulator.grabbing}set interactive(e){this._ringManipulator.interactive=e}get updating(){return!!this._activeAnimation}constructor(e){super(e),this.mode=null,this._scaleRotateDragData=null,this._activeAnimation=null,this._ringIndicatorDelayMs=200,this.events=new xn.A,this.getFocused=()=>this._ringManipulator.focused,this.getScale=()=>"scale"===this._scaleRotateDragData?.mode?this.adapter.scale:1}initialize(){this._createManipulator(),this._updateDragState(),this._updateManipulatorTransform(),this.addHandles([(0,a.watch)((()=>{const{adapter:e}=this;return[e.angle,e.scale]}),(()=>this._updateManipulatorTransform()))])}destroy(){this._activeAnimation?.frameTask.remove(),this._activeAnimation=null,this.tool.manipulators.remove(this._ringManipulator),this._ringManipulator=null}startAnimation(e){this.cancelActiveAnimation(),e.start();const t=(0,_s.mg)({update:({deltaTime:t})=>{e.update(t)&&this.cancelActiveAnimation()}});this._activeAnimation={...e,frameTask:t}}cancelActiveAnimation(){this._activeAnimation?.frameTask.remove(),this._activeAnimation=(0,s.pR)(this._activeAnimation)}forEachManipulator(e){e(this._ringManipulator,lr.SCALE_ROTATE)}_createManipulator(){const e=this._createRingManipulator();this._ringManipulator=e,this.tool.manipulators.add(e);const t=this.tool.object,n=(0,Ir.Xt)(e,((e,n,i)=>{this._scaleRotateDragData=null;const r=this.adapter.startInteraction(),o={mode:"none",origin:(0,d.o8)(e.renderLocation),initialAngle:this.adapter.angle,angle:0,angleDir:0,scaleDir:0};this._scaleRotateDragData=o,this._updateDragState();const s=A.rq.get();this.tool.view.renderCoordsHelper.worldUpAtPosition(e.renderLocation,s),n.next(Pr(this.tool.view,(0,Fi.O_)(e.renderLocation,s,(0,Fi.vt)()))).next((e=>{const n=(0,Fi.Qj)(e.plane),i=Xr(e.renderStart,e.renderEnd,o.origin,n),s=ms.wf.shortestSignedDiff(o.angle,i);o.angleDir=(0,b.qE)(o.angleDir+s,-.3,.3),o.angle=i;const a=function(e,t){const n=(0,h.d)(A.rq.get(),t.renderStart,e.origin),i=(0,h.d)(A.rq.get(),t.renderEnd,e.origin),r=(0,h.l)(n),o=(0,h.l)(i);return 0===r?0:o/r}(o,e),l=a-this.adapter.scale;if(o.scaleDir=(0,b.qE)(o.scaleDir+l,-.2,.2),this._onScaleChanged(),"none"===o.mode){const n=this.mode||function(e,t,n,i){const{renderStart:r,renderEnd:o}=e,s=ys(r,i,A.rq.get()),a=ys(o,i,A.rq.get());if((0,h.s)(s,a)<100)return null;const l=(0,h.d)(A.rq.get(),r,n),c=(0,h.e)(A.rq.get(),l,(0,Fi.Qj)(t)),u=r,d=(0,h.g)(A.rq.get(),u,c),p=ys(n,i,A.rq.get()),f=s,g=ys(d,i,A.rq.get()),m=(0,h.d)(A.rq.get(),g,f),_=(0,h.d)(A.rq.get(),s,p),v=(0,ee.LV)(f,m),y=(0,ee.LV)(p,_);return(0,ee.kb)(v,a)<(0,ee.kb)(y,a)?"rotate":"scale"}(e,e.plane,o.origin,this.tool.view.state.camera);if(null!=n){switch(n){case"rotate":this.tool.events.emit("rotate-start",{object:t,angle:0}),this.tool.events.emit("record-undo",{updates:[this.adapter.createUndoRecord()]});break;case"scale":this.tool.events.emit("scale-start",{object:t,xScale:1,yScale:1}),this.tool.events.emit("record-undo",{updates:[this.adapter.createUndoRecord()]})}o.mode=n}}switch(o.mode){case"rotate":r.state.angle=o.initialAngle+i;break;case"scale":r.state.scale=a,this._onScaleChanged()}switch(this._updateDragState(),this._updateManipulatorTransform(),e.action){case"start":case"update":switch(o.mode){case"rotate":this.tool.events.emit("rotate",{object:t,angle:(0,b.KJ)(o.angle)});break;case"scale":this.tool.events.emit("scale",{object:t,xScale:a,yScale:a})}break;case"end":switch(o.mode){case"rotate":this.tool.events.emit("rotate-stop",{object:t,angle:(0,b.KJ)(o.angle)});break;case"scale":this.tool.events.emit("scale-stop",{object:t,xScale:a,yScale:a})}}return"end"===e.action&&(this.startAnimation(Ts(this,(()=>this._onScaleChanged()))),this._scaleRotateDragData=null,this._updateDragState(),r.done()),e})),i.next((()=>{if(r.cancel(),null!=this._scaleRotateDragData){switch(this._scaleRotateDragData.mode){case"none":break;case"rotate":this.tool.events.emit("rotate-stop",{object:t,angle:0});break;case"scale":this.tool.events.emit("scale-stop",{object:t,xScale:1,yScale:1})}this.startAnimation(Ts(this,(()=>this._onScaleChanged()))),this._scaleRotateDragData=null,this._updateDragState()}}))}));this.addHandles([n,e.events.on("focus-changed",(e=>{"focus"===e.action?this.startAnimation(function(e,t,n){let i=0,r=null;const o=()=>!1;return{start:()=>{r=e.getFocused,e.getFocused=o,i=0,t()},update:e=>(i+=e,!r?.()||i>=n.delayMs?bs.STOP:bs.CONTINUE),destroy:()=>{r&&(e.getFocused=r),t()}}}(this,(()=>this._updateDelayedFocusedState()),{delayMs:this._ringIndicatorDelayMs})):this._updateDelayedFocusedState()})),e.events.on("immediate-click",(e=>{e.stopPropagation()})),(0,a.watch)((()=>this.tool.object.visible),(e=>this._ringManipulator.available=e),a.Vh)])}_onScaleChanged(){this.events.emit("scale-changed"),this._updateManipulatorTransform()}_updateDelayedFocusedState(){this._ringManipulator.updateStateEnabled(fs.DelayedFocused,this.getFocused())}_updateDragState(){if(this._ringManipulator.updateStateEnabled(fs.Unlocked,!(null!=this._scaleRotateDragData&&"none"!==this._scaleRotateDragData?.mode)),null!=this._scaleRotateDragData)switch(this._scaleRotateDragData.mode){case"rotate":this._ringManipulator.updateStateEnabled(fs.ScaleIn|fs.ScaleOut,!1),this._ringManipulator.updateStateEnabled(fs.RotateLeft,this._scaleRotateDragData.angleDir<0),this._ringManipulator.updateStateEnabled(fs.RotateRight,this._scaleRotateDragData.angleDir>=0);break;case"scale":this._ringManipulator.updateStateEnabled(fs.RotateLeft|fs.RotateRight,!1),this._ringManipulator.updateStateEnabled(fs.ScaleIn,this._scaleRotateDragData.scaleDir<0),this._ringManipulator.updateStateEnabled(fs.ScaleOut,this._scaleRotateDragData.scaleDir>=0)}else this._ringManipulator.updateStateEnabled(fs.ScaleIn|fs.ScaleOut|fs.RotateLeft|fs.RotateRight,!1)}_updateManipulatorTransform(){const e=(0,Rt.$0)(A.Rc.get(),this.adapter.angle,(0,d.fA)(0,0,1));if(null==e)return;const t=this.getScale(),n=(0,Rt.CV)(A.Rc.get(),(0,h.i)(A.rq.get(),t,t,t));this._ringManipulator.modelTransform=(0,Rt.lw)(A.Rc.get(),n,e)}_createRingManipulator(){const e=(e,t,n)=>{const i=[],r=Math.ceil(128*(t-e)/(2*Math.PI));for(let o=0;o<r+1;o++){const s=e+o*(t-e)/r;i.push((0,d.fA)(n*Math.cos(s),n*Math.sin(s),0))}return i},t=t=>e(0,2*Math.PI,t),n=this._createMaterial(1),i=(e,t,i=n)=>(0,tt.Nq)(i,(e=>[[-e/2,0],[e/2,0],[e/2,.25],[-e/2,.25]])(t),e,[],[],!1),r=t(160),o=i(r,24),s={left:new Array,right:new Array},a=[];for(let t=0;t<2;t++){const r=t*Math.PI-Math.PI/4,o=Math.PI/2-wr,l=r+o,c=r+Math.PI/2-o,u=e(l,c,190),h=i(u,9);a.push(u),a.push(e(l,c,201)),s.left.push(h),s.right.push(h.instantiate());for(let e=0;e<2;e++){const t=0===e,i=(0,Ct.vt)();if(t){(0,Rt.hs)(i,i,[1,-1,1]),(0,Rt.e$)(i,i,-l,[0,0,1]);const e=Math.round(.2*(u.length-1));i[12]=u[e][0],i[13]=u[e][1],i[14]=u[e][2]}else{(0,Rt.e$)(i,i,c,[0,0,1]);const e=Math.round(.8*(u.length-1));i[12]=u[e][0],i[13]=u[e][1],i[14]=u[e][2]}const r=(0,tt._B)(n,60,0,23,.5);(0,tt.xh)(r,i),(t?s.left:s.right).push(r)}}const l=[];for(let t=0;t<2;t++){const n=t*Math.PI-Math.PI/4,r=Math.PI/2-Sr,o=n+r,s=n+Math.PI/2-r,a=e(o,s,213);l.push(i(a,9))}const c=this._createMaterial(.66),u=this._createMaterial(.5),h=this._createMaterial(.33),p=t(190),f=t(213),g=i(p,9,c),m=i(f,9,h),_=t(130),v=t(107),y=i(_,9,c),b=i(v,9,h);let T=[new Or(o,fs.DelayedFocused),new Or(o.instantiate({material:u}),Bi.p7.None)];this.mode&&"scale"!==this.mode||(T=T.concat([...l.map((e=>new Or(e,fs.DelayedFocused|fs.Unlocked))),new Or(g,fs.DelayedFocused|fs.ScaleIn),new Or(m,fs.DelayedFocused|fs.ScaleIn),new Or(y,fs.DelayedFocused|fs.ScaleOut),new Or(b,fs.DelayedFocused|fs.ScaleOut)])),this.mode&&"rotate"!==this.mode||(T=T.concat([...s.right.map((e=>new Or(e.instantiate(),fs.DelayedFocused|fs.Unlocked))),...s.left.map((e=>new Or(e,fs.DelayedFocused|fs.RotateLeft))),...s.right.map((e=>new Or(e,fs.DelayedFocused|fs.RotateRight)))]));const x=[r,...a];return new $i({view:this.tool.view,renderObjects:T,autoScaleRenderObjects:!1,worldOriented:!0,radius:24,focusMultiplier:1,touchMultiplier:1.5,elevationInfo:this.tool.object.elevationInfo,collisionType:{type:"ribbon",paths:x,direction:(0,d.fA)(0,0,1)}})}_createMaterial(e){const t=new Bt.v({cullFace:qe.s2.Back,renderOccluded:nt.m$.Transparent,isDecoration:!0});return this.addHandles((0,a.watch)((()=>(0,r.f6)(this.tool.view.effectiveTheme.accentColor,e)),(e=>t.setParameters({color:e})),a.Vh)),t}get test(){}};function ys(e,t,n){return t.projectToScreen(e,xs),(0,h.i)(n,xs[0],xs[1],0)}var bs;function Ts(e,t){let n=null,i=1;const r=()=>i;return{start:()=>{i=e.getScale(),n=e.getScale,e.getScale=r,t()},update:e=>(i+=((i+1)/2-i)*Math.min(3*e,1),t(),Math.abs(i-1)<.01?bs.STOP:bs.CONTINUE),destroy:()=>{n&&(e.getScale=n),t()}}}(0,i._)([(0,l.MZ)({constructOnly:!0})],vs.prototype,"tool",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0})],vs.prototype,"adapter",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0})],vs.prototype,"sketchOptions",void 0),(0,i._)([(0,l.MZ)()],vs.prototype,"mode",void 0),(0,i._)([(0,l.MZ)()],vs.prototype,"_activeAnimation",void 0),(0,i._)([(0,l.MZ)()],vs.prototype,"updating",null),vs=(0,i._)([(0,u.$)("esri.views.3d.interactive.editingTools.transform.ScaleRotateTransform")],vs),function(e){e[e.CONTINUE=0]="CONTINUE",e[e.STOP=1]="STOP"}(bs||(bs={}));const xs=(0,g.gs)();var ws=n(73919);let Ss=class extends((0,ws.B)(yo.w)){constructor(e){super(e),this.type="transform-mesh",this.orientation=(0,Vo.LJ)(),this.scale=(0,Vo.dy)(),this.allFields.forEach((e=>{e.lockable=!1,e.setActual(null)}))}get key(){return{longitude:this.longitude.actual,latitude:this.latitude.actual,x:this.x.actual,y:this.y.actual,elevation:this.elevation.actual,geographic:this.geographic,orientation:this.orientation.actual,scale:this.scale.actual}}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,this.orientation,this.scale]}};(0,i._)([(0,l.MZ)()],Ss.prototype,"key",null),(0,i._)([(0,l.MZ)()],Ss.prototype,"allFields",null),Ss=(0,i._)([(0,u.$)("esri.views.interactive.tooltip.infos.TransformMeshTooltipInfo")],Ss);let Es=class extends((0,ws.B)(yo.w)){constructor(e){super(e),this.type="transform-point",this.orientation=(0,Vo.LJ)({readOnly:!0}),this.size=(0,Vo.qP)({readOnly:!0}),this.allFields.forEach((e=>{e.lockable=!1,e.setActual(null)}))}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,this.orientation,this.size]}};(0,i._)([(0,l.MZ)()],Es.prototype,"allFields",null),Es=(0,i._)([(0,u.$)("esri.views.interactive.tooltip.infos.TransformPointTooltipInfo")],Es);let As=class extends ho.g{constructor(e){super(e),this.events=new xn.A,this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.sketchOptions=new fo.A,this.type="transform-3d",this._updatingHandles=new fi.U,this._scaleRotate=null}initialize(){const{events:e,object:t,view:n}=this;this.tooltip=(0,si.A)((()=>({view:n,options:this.sketchOptions.tooltips}))),this._moveManipulation=new oo({tool:this,view:n,snapToScene:this.snapToScene,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&yi(t.operations,t.elevationInfo),radius:oo.radiusForSymbol(t.graphic?.symbol)}),this._moveManipulation.forEachManipulator((t=>this.addHandles(t.events.on("immediate-click",(t=>{e.emit("immediate-click",{...t,object:this.object}),t.stopPropagation()})))));const i=t.elevationInfo;if(this._moveManipulation.elevationInfo=i,this.addHandles(sn(t)),this._moveManipulation.createManipulatedObjectDragPipeline(((e,r,o,s,a)=>{if(e===ao.XY){const{snappingStep:e,cancelSnapping:r}=(0,mo.L)({snappingContext:new go.e({elevationInfo:i,pointer:a,editGeometryOperations:po.p.fromGeometry(new Gi.default({spatialReference:t.operations?.data.spatialReference}),n.state.viewingMode),visualizer:new Jt,excludeFeature:t.graphic}),snappingManager:this.snappingManager,updatingHandles:this._updatingHandles,useZ:!1});s=s.next(r),o=o.next((0,Ir.RS)(this.view,i)).next(...e)}return{steps:o,cancel:s}}),t,(t=>{const{action:n,object:i,dxScreen:r,dyScreen:o}=t,s={object:i,dxScreen:r,dyScreen:o};switch(n){case"start":this._emitRecordUndo(),e.emit("translate-start",s);break;case"update":e.emit("translate",s);break;case"end":e.emit("translate-stop",s)}})),this._moveManipulation.angle=null!=this._scaleRotate?this._scaleRotate.angle:0,this._scaleRotateAdapter=this._createScaleRotateAdapter(),this.addHandles((0,a.watch)((()=>this._scaleRotateAdapter.angle),(()=>this._updateMoveAngle()))),this.enableScaling||this.enableRotation){const e=this.enableScaling&&this.enableRotation?null:this.enableScaling?"scale":"rotate";this._scaleRotate=new vs({tool:this,mode:e,adapter:this._scaleRotateAdapter,sketchOptions:this.sketchOptions}),this.addHandles(this._scaleRotate.events.on("scale-changed",(()=>this._onScaleChanged())))}this.addHandles([br({view:this.view,object:t,forEachManipulator:e=>this._forEachManipulator(e),onManipulatorsChanged:()=>(0,o.hA)()}),t.on("committed",(()=>this._onGeometryChanged())),this._hideManipulatorsForObjectState(),(0,a.watch)((()=>n.scale),(()=>this._updateMoveAngle()))].filter(hi.Ru)),this._onGeometryChanged(),this._updateMoveAngle(),this._forEachManipulator((e=>{e instanceof $i&&this.addHandles(e.events.on("grab-changed",(()=>this._updateManipulatorsInteractive())))}));const r=n?.type,{sketchOptions:s}=this;this._meshTooltipInfo=new Ss({viewType:r,sketchOptions:s}),this._pointTooltipInfo=new Es({viewType:r,sketchOptions:s});const l={object:t,dxScreen:0,dyScreen:0},c={onBeforeUpdate:()=>this.endDrag(),onMoveStart:()=>{this._emitRecordUndo(),e.emit("translate-start",{...l})},onMove:()=>e.emit("translate",{...l}),onMoveStop:()=>e.emit("translate-stop",{...l}),onRotateStart:n=>{this._emitRecordUndo(),e.emit("rotate-start",{object:t,angle:n})},onRotate:n=>e.emit("rotate",{object:t,angle:n}),onRotateStop:n=>e.emit("rotate-stop",{object:t,angle:n}),onScaleStart:(n,i)=>{this._emitRecordUndo(),e.emit("scale-start",{object:t,xScale:n,yScale:i})},onScale:(n,i)=>e.emit("scale",{object:t,xScale:n,yScale:i}),onScaleStop:(n,i)=>e.emit("scale-stop",{object:t,xScale:n,yScale:i})};this.addHandles(xi(this.tooltip,this.object,(()=>({sketchOptions:this.sketchOptions,activeTooltipInfo:this.activeTooltipInfo,callbacks:c,scaleRotateTransform:this._scaleRotate})))),this.finishToolCreation()}destroy(){this.tooltip.destroy(),this._moveManipulation.destroy(),this._scaleRotate=(0,s.pR)(this._scaleRotate),this._scaleRotateAdapter=(0,s.pR)(this._scaleRotateAdapter),this._updatingHandles.destroy(),this._set("view",null),this._set("object",null)}onInputEvent(e){if(!this.destroyed&&!(0,si.wG)(e,this.tooltip))return super.onInputEvent(e)}_updateManipulatorsInteractive(){null!=this._scaleRotate&&(this._scaleRotate.interactive=!this._moveManipulation.grabbing,this._moveManipulation.interactive=!this._scaleRotate.grabbing)}_createScaleRotateAdapter(){const e=vi(this.object);return"mesh"===e?.type?new cs({object:this.object,geometry:e,viewingMode:this.view.state.viewingMode}):new hs({graphic:this.object.graphic,sizeFilter:e=>this._enforceNonZeroSize(e),findLayerView:()=>this.view.allLayerViews.find((e=>e.layer===this.object.graphic?.layer)),sizeAxis:this.sketchOptions?.tooltips?.visualVariables?.size?.axis??null})}_forEachManipulator(e){this._moveManipulation?.forEachManipulator(e),this._scaleRotate?.forEachManipulator(e)}_hideManipulatorsForObjectState(){return(0,a.watch)((()=>this.object.visible),(e=>{this._forEachManipulator((t=>t.available=e)),this._moveManipulation.zManipulation.available=e&&this.enableZ&&yi(this.object.operations,this.object.elevationInfo)}))}_emitRecordUndo(){this.events.emit("record-undo",{updates:[this.object.createUndoRecord()]})}set snapToScene(e){this._moveManipulation&&(this._moveManipulation.snapToScene=e),this._set("snapToScene",e)}get updating(){return this._updatingHandles.updating||!!this._scaleRotate?.updating}get activeTooltipInfo(){return"mesh"===vi(this.object)?.type?this._meshTooltipInfo:this._pointTooltipInfo}set location(e){this._moveManipulation.location=e,this._scaleRotate&&(this._scaleRotate.location=e)}set elevationAlignedLocation(e){this._moveManipulation.elevationAlignedLocation=e,this._scaleRotate&&(this._scaleRotate.elevationAlignedLocation=e)}reset(){}onHide(){this._scaleRotate?.cancelActiveAnimation()}_onScaleChanged(){null!=this._scaleRotate&&(this._moveManipulation.displayScale=this._scaleRotate.getScale())}_updateMoveAngle(){const{view:e}=this,t=e.state.viewingMode===pe.RT.Local||e.scale<1e6;this._moveManipulation.angle=t?this._scaleRotateAdapter.angle:0}_onGeometryChanged(){Kr(this,this.object)}_enforceNonZeroSize(e){return e||this.view.state.camera.computeRenderPixelSizeAt(this._moveManipulation.renderLocation)}get test(){}};(0,i._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],As.prototype,"view",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],As.prototype,"object",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],As.prototype,"enableZ",void 0),(0,i._)([(0,l.MZ)()],As.prototype,"enableRotation",void 0),(0,i._)([(0,l.MZ)()],As.prototype,"enableScaling",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0,type:fo.A})],As.prototype,"sketchOptions",void 0),(0,i._)([(0,l.MZ)({value:!1})],As.prototype,"snapToScene",null),(0,i._)([(0,l.MZ)({constructOnly:!0})],As.prototype,"snappingManager",void 0),(0,i._)([(0,l.MZ)({readOnly:!0})],As.prototype,"type",void 0),(0,i._)([(0,l.MZ)({readOnly:!0})],As.prototype,"updating",null),(0,i._)([(0,l.MZ)()],As.prototype,"activeTooltipInfo",null),As=(0,i._)([(0,u.$)("esri.views.3d.interactive.editingTools.transform.TransformTool3D")],As);var Ms=n(75743),Os=n(30905),Rs=n(77560),Cs=n(67888),Is=n(18627);let Ps=class extends((0,Ms.O)(Os.oY)){constructor(e){super(e),this.type="plane",this.position=null,this.heading=0,this.tilt=0,this.width=10,this.height=10}equals(e){return this.heading===e.heading&&this.tilt===e.tilt&&(0,s.CM)(this.position,e.position)&&this.width===e.width&&this.height===e.height}};(0,i._)([(0,l.MZ)({readOnly:!0,json:{read:!1,write:!0}})],Ps.prototype,"type",void 0),(0,i._)([(0,l.MZ)({type:Gi.default}),(0,Is.P)()],Ps.prototype,"position",void 0),(0,i._)([(0,l.MZ)({type:Number,nonNullable:!0,range:{min:0,max:360}}),(0,Is.P)(),(0,Rs.w)((e=>ms.ie.normalize((0,Cs.GB)(e),0,!0)))],Ps.prototype,"heading",void 0),(0,i._)([(0,l.MZ)({type:Number,nonNullable:!0,range:{min:0,max:360}}),(0,Is.P)(),(0,Rs.w)((e=>ms.ie.normalize((0,Cs.GB)(e),0,!0)))],Ps.prototype,"tilt",void 0),(0,i._)([(0,l.MZ)({type:Number,nonNullable:!0}),(0,Is.P)()],Ps.prototype,"width",void 0),(0,i._)([(0,l.MZ)({type:Number,nonNullable:!0}),(0,Is.P)()],Ps.prototype,"height",void 0),Ps=(0,i._)([(0,u.$)("esri.analysis.SlicePlane")],Ps),n(72485);var Ds=n(2075);(0,X.fA)(0,0,0,.04),(0,c.A)("mac"),Math.cos((0,b.kU)(45)),Math.cos((0,b.kU)(5));const Ls=22.5;(0,Ct.vt)(),new je.K;var Ns,Fs=n(84264),zs=n(73318),Hs=n(27291);function Vs(e){const t=(0,h.l)(e.basis1),n=(0,h.l)(e.basis2);return.3*Math.min(t,n)}function Us(e){return Vs(e)}function ks(e){return 0!==e.direction[0]&&0!==e.direction[1]}n(29829),Oe.Y,ye.w,Hs.W,Dn.A,n(12378),n(91484),function(e){e[e.POSITIVE_X=0]="POSITIVE_X",e[e.POSITIVE_Y=1]="POSITIVE_Y",e[e.NEGATIVE_X=2]="NEGATIVE_X",e[e.NEGATIVE_Y=3]="NEGATIVE_Y"}(Ns||(Ns={}));const Bs=Bi.SJ.Custom1;var Gs,$s;!function(e){e[e.HEADING=1]="HEADING",e[e.TILT=2]="TILT"}(Gs||(Gs={})),function(e){e[e.HORIZONTAL_OR_VERTICAL=0]="HORIZONTAL_OR_VERTICAL",e[e.HORIZONTAL=1]="HORIZONTAL",e[e.VERTICAL=2]="VERTICAL",e[e.TILTED=3]="TILTED"}($s||($s={}));const js=Bi.SJ.Custom2,Zs=((0,ee.vt)(),Math.PI/2),Ws=Bi.SJ.Custom1,qs=Bi.SJ.Custom2;var Ys,Xs=n(32237);!function(e){e[e.CENTER_ON_CALLOUT=0]="CENTER_ON_CALLOUT",e[e.CENTER_ON_ARROW=1]="CENTER_ON_ARROW"}(Ys||(Ys={}));class Qs extends $i{constructor(e,t){const n=new rt.W({width:1,renderOccluded:nt.m$.OccludeAndTransparent,isDecoration:!0}),i=new Bt.v({cullFace:qe.s2.Back,renderOccluded:nt.m$.Opaque,isDecoration:!0}),o=new Bt.v({cullFace:qe.s2.Back,renderOccluded:nt.m$.Opaque,isDecoration:!0}),s=new Bt.v({cullFace:qe.s2.Back,renderOccluded:nt.m$.Opaque,isDecoration:!0}),l=new Bt.v({writeDepth:!1,cullFace:qe.s2.Front,renderOccluded:nt.m$.Transparent,isDecoration:!0});super({view:e,...Ks({offsetMode:t,tubeMaterial:i,tipMaterial:o,capMaterial:s,outlineMaterial:l,calloutMaterial:n})}),this._themeHandle=(0,a.watch)((()=>e.effectiveTheme.accentColor),(e=>{const t=(0,r.bJ)(e),a=_.A.toUnitRGBA(e),c=_.A.toUnitRGBA(t),u=_.A.toUnitRGBA(_.A.blendColors(t,e,.4)),h=_.A.toUnitRGBA(_.A.blendColors(t,e,.14));n.setParameters({color:a}),i.setParameters({color:h}),o.setParameters({color:c}),s.setParameters({color:u}),l.setParameters({color:a})}),a.Vh)}destroy(){this._themeHandle.remove(),super.destroy()}}function Ks({offsetMode:e,tubeMaterial:t,tipMaterial:n,capMaterial:i,outlineMaterial:r,calloutMaterial:o}){const s=e===Ys.CENTER_ON_CALLOUT?40:0,a=[(0,d.fA)(s,0,-24),(0,d.fA)(s,0,24)],l=function(e){const t=(0,h.d)((0,d.vt)(),e[e.length-1],e[e.length-2]);(0,h.n)(t,t),(0,h.h)(t,t,Ls),(0,h.g)(t,t,e[e.length-1]);{const n=(0,h.d)((0,d.vt)(),e[0],e[1]);return(0,h.n)(n,n),(0,h.h)(n,n,Ls),(0,h.g)(n,n,e[0]),[n,...e,t]}}(a),c=Js({vertices:a,padding:0,materials:{tube:t,tip:n,cap:i}}),u=Js({vertices:a,padding:2.25,materials:{tube:r,tip:r,cap:r}}),p=(0,tt.Z8)(o,[[s,0,0],[s-40,0,0]]),f=(0,tt.Z8)(o,[[s,0,0],[s-40,0,0]]);return{renderObjects:[...c.normal.map((e=>new Or(e,Bi.p7.Unfocused|Bs))),...u.normal.map((e=>new Or(e,Bi.p7.Unfocused|Bs))),new Or(p,Bi.p7.Unfocused|Bs|js),...c.focused.map((e=>new Or(e,Bi.p7.Focused|Bs))),...u.focused.map((e=>new Or(e,Bi.p7.Focused|Bs))),new Or(f,Bi.p7.Focused|Bs|js)],autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[l]},collisionPriority:1,radius:11,state:Bs}}function Js({vertices:e,padding:t,materials:n}){const i=i=>{const r=e.slice(),o=(0,h.d)(A.rq.get(),r[0],r[1]);(0,h.n)(o,o);const s=(0,h.d)(A.rq.get(),r[r.length-1],r[r.length-2]);if((0,h.n)(s,s),t>0){const e=(0,h.h)((0,d.vt)(),s,-t);r[r.length-1]=(0,h.g)(e,e,r[r.length-1]);const n=(0,h.h)((0,d.vt)(),o,-t);r[0]=(0,h.g)(n,n,r[0])}const a=i?1.15:1,l=Ls*a,c=11*a,u=(0,Rt.D_)(A.Rc.get());if(t>0){const e=l/4,n=(0,h.i)(A.rq.get(),0,e,0),i=1+t/e;(0,Rt.Tl)(u,u,n),(0,Rt.hs)(u,u,(0,h.i)(A.rq.get(),i,i,i)),(0,Rt.Tl)(u,u,(0,h.h)(n,n,-1/i))}const p=(0,Rt.D_)((0,Ct.vt)()),f=(0,d.fA)(0,1,0),g=(0,Rt.I0)((0,Ct.vt)(),(0,Xs.Yc)(A.J8.get(),f,s));g[12]=r[r.length-1][0],g[13]=r[r.length-1][1],g[14]=r[r.length-1][2],(0,Rt.lw)(g,g,u);const m=n.tube,_=function(e,t,n){const i=[];for(let t=0;t<12;t++){const n=t/12*2*Math.PI;i.push([Math.cos(n)*e,Math.sin(n)*e])}return(0,tt.Nq)(n,i,t,[],[],!1)}(3*(i?1.15:1)+t,r,m);_.transformation=p;const v=[_],y=n.tip,b=(0,tt.EE)(y,l,c,24,!1,!1,!0);b.transformation=g,v.push(b);const T=n.cap,x=(0,tt.EE)(T,l,c,24,!1,!0,!1);x.transformation=g,v.push(x);const w=(0,Rt.I0)((0,Ct.vt)(),(0,Xs.Yc)(A.J8.get(),f,o));return w[12]=r[0][0],w[13]=r[0][1],w[14]=r[0][2],(0,Rt.lw)(w,w,u),v.push(b.instantiate({transformation:w})),v.push(x.instantiate({transformation:w})),v};return{normal:i(!1),focused:i(!0)}}class ea{get _object(){return this._tool.object}get _operations(){return this._object.operations}constructor(e,t){this._tool=e,this._bounds=t,this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null;const n=this._tool,i=n.view;this.moveXYObjectManipulation=new co({view:i,tool:n,object:this._object}),n.addHandles(this._createMoveXYObjectDragPipeline()),this.moveZManipulator=new Qs(i,Ys.CENTER_ON_CALLOUT),this.moveZManipulator.state|=js,n.manipulators.add(this.moveZManipulator),n.addHandles([this._createMoveZDragPipeline()]),n.addHandles([n.events.on("translate-stop",(()=>{this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null}))])}destroy(){this.moveXYObjectManipulation.destroy(),this._tool.manipulators.remove(this.moveZManipulator),this.moveZManipulator.destroy()}forEachManipulator(e){this.moveXYObjectManipulation.forEachManipulator(e),e(this.moveZManipulator,lr.TRANSLATE_Z)}updateManipulators(e,t){const n=this.moveZManipulator,i=(0,Rt.Qr)(A.Rc.get(),e,Math.PI);i[12]=0,i[13]=0,i[14]=0,n.modelTransform=i,n.renderLocation=(0,h.d)(A.rq.get(),t.origin,t.basis1)}getUpdatedTooltipInfo(){return this.moveXYObjectManipulation.grabbing||this.moveXYObjectManipulation.dragging?this._computeMoveXYTooltipInfo():this.moveZManipulator.focused?this._computeMoveZTooltipInfo():null}_computeMoveXYTooltipInfo(){const e=this._tool,t=this._moveXYTooltipInfo??=new vo.M({sketchOptions:e.sketchOptions});if(this.moveXYObjectManipulation.dragging){const n=this._bounds,i=n.mapBoundsStart.origin,r=n.mapBounds.origin,{renderSpatialReference:o}=e.view;if(!o)return null;const s=(0,N.Do)(i,r,o);if(null==s)return null;t.distance=s}else t.distance=pi.r7;return t}_computeMoveZTooltipInfo(){const e=this._tool,t=this._moveZTooltipInfo??=new To({sketchOptions:e.sketchOptions});if(this.moveZManipulator.dragging){const n=this._bounds,i=n.mapBoundsStart.origin,r=n.mapBounds.origin,{renderSpatialReference:o}=e.view;if(!o)return null;const s=(0,Ti.cL)(i,r,o);if(null==s)return null;t.distance=s}else t.distance=pi.r7;return t}_createMoveXYObjectDragPipeline(){return this.moveXYObjectManipulation.createDragPipeline(((e,t,n)=>this._applyObjectMoveSteps(t,n)))}_createMoveZDragPipeline(){if(!this._operations)return(0,o.hA)();const e=this._operations.data.spatialReference;return(0,Ir.Xt)(this.moveZManipulator,((t,n,i)=>{const r=(0,d.o8)(t.renderLocation),o=n.next(Nr(this._tool.view,r,e)).next((0,Ir.sO)());this._applyObjectMoveSteps(o,i)}))}_applyObjectMoveSteps(e,t){const{_tool:n,_object:i}=this,r=e.next((e=>("start"===e.action&&(n.inputState={type:"move"},this._bounds.backupMapBounds(),n.events.emit("translate-start",{object:i,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY})),e))).next((0,Ir.EX)()).next(this._moveDragUpdateGeometry()).next((e=>{const t={object:i,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY};switch(e.action){case"start":case"update":(e.mapEnd.x-e.mapStart.x||e.mapEnd.y-e.mapStart.y||(e.mapEnd.z??0)-(e.mapStart.z??0))&&n.events.emit("translate",t);break;case"end":n.inputState=null,n.events.emit("translate-stop",t)}return e}));return t.next((()=>{null!=n.inputState&&n.events.emit("translate-stop",{object:i,dxScreen:0,dyScreen:0}),n.cancel()})),r}_moveDragUpdateGeometry(){const e=this._tool;return t=>{if(null==e.inputState||"move"!==e.inputState.type)return t;const n="start"===t.action?bi.Y.NEW_STEP:bi.Y.ACCUMULATE_STEPS;if(this._operations){const e=this._operations.move(t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ,n);this._bounds.updateMapBoundsFromOperation(e)}return t}}}var ta=n(59552),na=n(36634),ia=n(6200),ra=n(72468);class oa extends ye.w{constructor(e,t,i){super(e,t,new ve.$(ra.I,(()=>n.e(2205).then(n.bind(n,35108)))),i,sa)}_getPipelineState(e,t){const{oitPass:n,output:i,hasOccludees:r,enableOffset:o,cullFace:s}=e,a=n===Hn.Y.NONE,l=n===Hn.Y.FrontFace;return(0,Te.Ey)({blending:i===In.V.Color?a?Te.Os:(0,Vn.ez)(n):null,culling:(0,Te.Xt)(s),depthTest:{func:(0,Vn.K_)(n)},depthWrite:(0,Vn.z5)(e),drawBuffers:(0,Vn.m6)(n,i),colorWrite:Te.kn,stencilWrite:r?ia.v0:null,stencilTest:r?t?ia.a9:ia.qh:null,polygonOffset:a||l?null:(0,Vn.aB)(o)})}initializePipeline(e){return this._occludeePipeline=this._getPipelineState(e,!0),this._getPipelineState(e,!1)}getPipeline(e){return e?this._occludeePipeline:super.getPipeline()}}const sa=new Map([[Pe.r.POSITION,0],[Pe.r.UV0,2],[Pe.r.PERSPECTIVEDIVIDE,3]]);class aa extends jn.E{constructor(){super(...arguments),this.cullFace=qe.s2.None,this.hasSlicePlane=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.perspectiveInterpolation=!0,this.textureCoordinateType=Gn.I.None,this.emissionSource=$n.ZX.None,this.discardInvisibleFragments=!0,this.occlusionPass=!1,this.objectAndLayerIdColorInstanced=!1}}(0,i._)([(0,je.W)({count:qe.s2.COUNT})],aa.prototype,"cullFace",void 0),(0,i._)([(0,je.W)()],aa.prototype,"hasSlicePlane",void 0),(0,i._)([(0,je.W)()],aa.prototype,"enableOffset",void 0),(0,i._)([(0,je.W)()],aa.prototype,"writeDepth",void 0),(0,i._)([(0,je.W)()],aa.prototype,"hasOccludees",void 0),(0,i._)([(0,je.W)()],aa.prototype,"terrainDepthTest",void 0),(0,i._)([(0,je.W)()],aa.prototype,"cullAboveTerrain",void 0),(0,i._)([(0,je.W)()],aa.prototype,"perspectiveInterpolation",void 0);class la extends Hs.W{constructor(e){super(e,ha),this._configuration=new aa,this.vertexAttributeLocations=sa,this.supportsEdges=!0,this.produces=new Map([[Nn.N.OPAQUE_MATERIAL,e=>(0,In.CL)(e)],[Nn.N.TRANSPARENT_MATERIAL,e=>(0,In._o)(e)&&this.parameters.writeDepth],[Nn.N.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,e=>(0,In._o)(e)&&!this.parameters.writeDepth],[Nn.N.DRAPED_MATERIAL,e=>(0,In._o)(e)||(0,In.CL)(e)]])}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=t.hasOccludees,this._configuration.oitPass=t.oitPass,this._configuration.enableOffset=t.camera.relativeElevation<Vn.xt,this._configuration.terrainDepthTest=t.terrainDepthTest,this._configuration.cullAboveTerrain=t.cullAboveTerrain,this._configuration.perspectiveInterpolation=this.parameters.perspectiveInterpolation,this._configuration}get visible(){return!0}createGLMaterial(e){return new ca(e)}createBufferWriter(){const e=zs.zK.clone();return this.parameters.perspectiveInterpolation&&e.f32(Pe.r.PERSPECTIVEDIVIDE),new ua(e)}}class ca extends na.m8{constructor(e){super({...e,...e.material.parameters})}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.acquireTechnique(oa,e)}}class ua extends Fs.Z{write(e,t,n,i,r,o){for(const i of this.vertexBufferLayout.fields.keys()){const s=n.get(i);if(s)if(i===Pe.r.PERSPECTIVEDIVIDE){(0,Fn.vA)(1===s.size);const e=r.getField(i,Cn.Y$);e&&(0,zn.uO)(s,e,o)}else(0,zn.zC)(i,s,e,t,r,o)}}}class ha extends nt.qA{constructor(){super(...arguments),this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=qe.s2.None,this.opacity=1,this.textureId=null,this.initTextureTransparent=!0,this.perspectiveInterpolation=!1}}class da extends $i{constructor(e,t){const n=new la({writeDepth:!1,renderOccluded:nt.m$.Opaque,isDecoration:!0}),i=qr.calloutWidth,o=new rt.W({width:i,renderOccluded:nt.m$.OccludeAndTransparent,isDecoration:!0});super({view:e,...pa({imageMaterial:n,calloutMaterial:o})}),this._currentTexture=null,this._themeHandle=(0,a.watch)((()=>e.effectiveTheme.accentColor),(e=>{const i=(0,r._L)(e,.5),s=(0,r.bJ)(e),a=this._currentTexture,l=t(i,s);n.setParameters({textureId:l.texture.id}),o.setParameters({color:_.A.toUnitRGBA(e)}),this._currentTexture=l,a?.release()}),a.Vh)}destroy(){this._themeHandle.remove(),this._currentTexture?.release(),super.destroy()}}function pa({imageMaterial:e,calloutMaterial:t}){const{focusMultiplier:n,calloutLength:i,discRadius:r}=qr,o=r*n,s=(e,t)=>{const n=[0,1,2,2,3,0];return new kt.V(t,[[Pe.r.POSITION,new Ut.n([i-e,-e,0,i+e,-e,0,i+e,e,0,i-e,e,0],n,3,!0)],[Pe.r.UV0,new Ut.n([0,0,1,0,1,1,0,1],n,2,!0)]])},a=(0,tt.Z8)(t,[[0,0,0],[i-r,0,0]]),l=(0,tt.Z8)(t,[[0,0,0],[i-o,0,0]]),c=Bs;return{autoScaleRenderObjects:!1,collisionPriority:1,collisionType:{type:"disc",direction:[0,0,1],offset:[i,0,0]},focusMultiplier:n,radius:r,renderObjects:[new Or(s(r,e),Bi.p7.Unfocused|c),new Or(a,Bi.p7.Unfocused|c),new Or(s(o,e),Bi.p7.Focused|c),new Or(l,Bi.p7.Focused|c)],state:c}}var fa=n(57665),ga=n(60403);class ma{get _object(){return this._tool.object}get _operations(){return this._object.operations}constructor(e,t,n){this._tool=e,this._bounds=t,this._snapRotation=n,this._rotateTooltipInfo=null,this._startAngle=0,this._endAngle=0;const i=this._tool,r=i.view,o=!r._stage?.renderView.renderingContext.driverTest.svgPremultipliesAlpha.result;this.rotateManipulator=new da(r,((e,t)=>function(e,t){const{accentColor:n,contrastColor:i,preMultiplyAlpha:r}=t;return e.fromData(`heading-rotate:[accent:${n},contrast:${i},size:64]`,(()=>new ta.g(function(e,t){return function(e,t){const n=new Image(t,t);return n.src=e,n}(function(e){const t=(new XMLSerializer).serializeToString(e);return`data:image/svg+xml;base64,${btoa(t)}`}(function(e,{accentColor:t,contrastColor:n}){const i=t.toHex(),r=t.a,o=n.toHex(),s=n.a,a=e.getElementsByTagNameNS("http://www.w3.org/2000/svg","style").namedItem("theme-style");return a&&(a.innerHTML=`\n      .contrast-fill { fill: ${o}; fill-opacity: ${s}; }\n      .contrast-stroke { stroke: ${o}; stroke-opacity: ${s};  }\n      .accent-fill { fill: ${i}; fill-opacity: ${r}; }\n      .accent-stroke { stroke: ${i}; stroke-opacity:  ${r}; }`),e}(function(e){const t=e.split(",")[1],n=atob(t);return(new DOMParser).parseFromString(n,"image/svg+xml")}(e),t)),t.size)}("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NiIgaGVpZ2h0PSI1NiIgZmlsbD0ibm9uZSIgdmVyc2lvbj0iMi4wIj48c3R5bGUgaWQ9InRoZW1lLXN0eWxlIj4uY29udHJhc3QtZmlsbHtmaWxsOiNmZmZ9LmNvbnRyYXN0LXN0cm9rZXtzdHJva2U6I2ZmZn0uYWNjZW50LWZpbGx7ZmlsbDojZmY3ZjAwO2ZpbGwtb3BhY2l0eTouNX08L3N0eWxlPjxwYXRoIGQ9Ik0yOCAwYTI4IDI4IDAgMSAxIDAgNTYgMjggMjggMCAwIDEgMC01NiIgY2xhc3M9ImFjY2VudC1maWxsIi8+PHBhdGggc3Ryb2tlLXdpZHRoPSI0Ljk5IiBkPSJNMjAuMDUgNDAuODZhMTUuMDUgMTUuMDUgMCAwIDAgMTcuMTQtMS41IDE1LjA1IDE1LjA1IDAgMCAwIDQuNDctMTYuNjUgMTUuMDUgMTUuMDUgMCAwIDAtMjIuNzItNy4xNSAxNS4wNSAxNS4wNSAwIDAgMC01LjUgNy4xNSIgY2xhc3M9ImNvbnRyYXN0LXN0cm9rZSIvPjxwYXRoIGQ9Im0xMC45NyAzNS41NyA1LjM4IDEyLjA3IDcuNzktMTMuNDd6IiBjbGFzcz0iY29udHJhc3QtZmlsbCIvPjwvc3ZnPg==",{accentColor:n,contrastColor:i,size:64}),{mipmap:!0,reloadable:!0,preMultiplyAlpha:r})))}(r.textures,{accentColor:e,contrastColor:t,preMultiplyAlpha:o}))),i.addHandles([this.rotateManipulator.events.on("grab-changed",(e=>this._onRotateGrab(e))),this._createRotateDragPipeline(this.rotateManipulator)]),i.manipulators.add(this.rotateManipulator),i.addHandles([i.events.on("rotate-start",(e=>this._startAngle=e.angle)),i.events.on("rotate",(e=>this._endAngle=e.angle)),i.events.on("rotate-stop",(()=>{this._startAngle=0,this._endAngle=0}))])}destroy(){this._tool.manipulators.remove(this.rotateManipulator),this.rotateManipulator.destroy()}forEachManipulator(e){e(this.rotateManipulator,lr.ROTATE)}updateManipulators(e,t){const n=this._bounds.mapBounds.plane[2]<0?Math.PI:0,i=(0,Rt.eL)(A.Rc.get(),e,n);i[12]=0,i[13]=0,i[14]=0,this.rotateManipulator.modelTransform=i,this.rotateManipulator.renderLocation=(0,h.g)(A.rq.get(),t.origin,t.basis1)}getUpdatedTooltipInfo(){return this.rotateManipulator.focused?this._computeRotateTooltipInfo():null}_computeRotateTooltipInfo(){const e=this._rotateTooltipInfo??=new ga.d({sketchOptions:this._tool.sketchOptions});return e.angle=this._startAngle-this._endAngle,e}_onRotateGrab({action:e,screenPoint:t}){const n=this._tool,i=this._bounds;if("start"!==e||!t)return;const r=function(e,t,n,i){const r=t.worldUpAtPosition(e.origin,A.rq.get()),o=A.rq.get();switch(n){case Gs.HEADING:(0,h.c)(o,r);break;case Gs.TILT:(0,h.c)(o,e.basis1)}return(0,Fi.O_)(e.origin,o,i)}(i.displayBounds,n.view.renderCoordsHelper,Gs.HEADING,(0,Fi.vt)()),o=Vi(n.view.state.camera,t);(0,Fi.Ui)(r,o,A.rq.get())&&(i.backupMapBounds(),n.inputState={type:"rotate",rotatePlane:r})}_createRotateDragPipeline(e){const{_tool:t,_object:n}=this;return(0,Ir.Xt)(e,((e,i,r)=>{const o=t.inputState;null!=o&&(i.next((e=>("start"===e.action&&t.events.emit("rotate-start",{object:n,angle:0}),e))).next(Pr(t.view,o.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(o)).next(...this._snapRotation()).next(this._rotateDragUpdateGeometry()).next((e=>{const i={object:n,angle:(0,b.KJ)(e.rotateAngle)};switch(e.action){case"start":case"update":t.events.emit("rotate",i);break;case"end":t.inputState=null,t.events.emit("rotate-stop",i)}return e})),r.next((()=>{null!=t.inputState&&t.events.emit("rotate-stop",{object:n,angle:0}),t.cancel()})))}))}_rotateDragRenderPlaneToRotate(e){return t=>{const n=(0,Fi.Qj)(e.rotatePlane),i=Xr(t.renderStart,t.renderEnd,this._bounds.displayBounds.origin,n);return{...t,rotateAxis:n,rotateAngle:i}}}_rotateDragUpdateGeometry(){const e=this._bounds;return t=>{const n=(0,h.c)((0,d.vt)(),e.mapBoundsStart.origin),i="start"===t.action?bi.Y.NEW_STEP:bi.Y.ACCUMULATE_STEPS;if(this._operations){const r=this._operations.rotate(n,t.rotateAngle,i,fa.K.REPLACE);(0,Ds.c)(e.mapBoundsStart,e.mapBounds),e.updateMapBoundsFromOperation(r)}return t}}}class _a extends $i{constructor(e,t){const n=ks(t),i=n?4:1,r=2*i,o={renderOccluded:nt.m$.OccludeAndTransparent,isDecoration:!0},s=new rt.W({...o,width:i}),l=new rt.W({...o,width:r}),c=new rt.W({...o,width:1});super({view:e,...Yr,...va({isCorner:n,unfocusedMaterial:s,focusedMaterial:l,outlineMaterial:c})}),this._themeHandle=(0,a.watch)((()=>e.effectiveTheme.accentColor),(e=>{const t=_.A.toUnitRGBA(e);s.setParameters({color:t}),l.setParameters({color:t}),c.setParameters({color:t})}),a.Vh)}destroy(){this._themeHandle.remove(),super.destroy()}}function va({isCorner:e,unfocusedMaterial:t,focusedMaterial:n,outlineMaterial:i}){const r=e?[(0,d.fA)(1,0,0),(0,d.fA)(0,0,0),(0,d.fA)(0,1,0)]:[(0,d.fA)(1,0,0),(0,d.fA)(-1,0,0)];return{renderObjects:[new Or((0,tt.Z8)(t,r),Bi.p7.Unfocused|Ws),new Or((0,tt.Z8)(n,r),Bi.p7.Focused|Ws),new Or((0,tt.Z8)(i,r),qs)],collisionType:{type:"line",paths:[r]},radius:e?6:4,state:Ws}}var ya=n(41857),ba=n(16633);class Ta{constructor(e,t){this._tool=e,this.mapBounds=(0,Ds.a)(),this.mapBoundsStart=(0,Ds.a)(),this.displayBounds=(0,Ds.a)(),e.addHandles((0,a.on)((()=>e.object),"modified-externally",(()=>this._resetMapBounds()),{onListenerAdd:()=>this._resetMapBounds()})),this._onDisplayBoundsChanged=t}get displayBoundsMargin(){const{view:e,object:t}=this._tool,n=vi(t),i=e.pointsOfInterest?.centerOnSurfaceFrequent.location??n?.extent?.center;return i?xa*e.pixelSizeAt(i):0}backupMapBounds(){(0,Ds.c)(this.mapBounds,this.mapBoundsStart)}updateDisplayBounds(){this._calculateDisplayBounds(),this._onDisplayBoundsChanged?.()}updateMapBoundsFromOperation(e){(0,ya.Bb)(e,this.mapBounds),this.updateDisplayBounds()}updateMapBoundsFromOperationInverse(e){(0,ya.fJ)(e,this.mapBounds),this.updateDisplayBounds()}_resetMapBounds(){this._calculateMapBounds(),this.updateDisplayBounds()}_calculateMapBounds(){const{view:e,attachmentOrigin:t,object:n}=this._tool,i=n.operations?.data;if(!i)return;const r=i.geometry;this.spatialReference=r.spatialReference;const o=function(e){const t=mi(e);return(0,S.fA)(Math.cos(t),Math.sin(t))}(r);(0,w.hs)(o,o,-1);const s=t?e.pixelSizeAt(t,r.spatialReference):0;(0,ya.G3)(o,i,wa*s,this.mapBounds)}_calculateDisplayBounds(){const{view:e,attachmentOrigin:t}=this._tool,n=t?.z??(0,Pt.nG)(this.mapBounds.origin,e.elevationProvider,Dt.F.fromElevationInfo(this._tool.object.elevationInfo),e.renderCoordsHelper),i=(0,Ds.c)(this.mapBounds);i.origin[2]=n??0,function(e,t,n,i=0,r){r||(r=(0,Ds.a)()),t.toRenderCoords(e.origin,n,r.origin);const o=A.rq.get();(0,h.g)(o,e.origin,e.basis1),(0,h.g)(o,o,e.basis2),t.toRenderCoords(o,n,o);const s=A.rq.get();(0,h.g)(s,e.origin,e.basis1),(0,h.d)(s,s,e.basis2),t.toRenderCoords(s,n,s);const a=A.rq.get();(0,h.d)(a,e.origin,e.basis1),(0,h.d)(a,a,e.basis2),t.toRenderCoords(a,n,a);const l=A.rq.get();(0,h.d)(l,e.origin,e.basis1),(0,h.g)(l,l,e.basis2),t.toRenderCoords(l,n,l);const c=(0,h.m)(A.rq.get(),o,s,.5);(0,h.d)(c,c,r.origin);const u=(0,h.m)(A.rq.get(),a,l,.5);(0,h.d)(u,r.origin,u),(0,h.m)(r.basis1,c,u,.5);const d=(0,h.m)(A.rq.get(),l,o,.5);(0,h.d)(d,d,r.origin);const p=(0,h.m)(A.rq.get(),s,a,.5);(0,h.d)(p,r.origin,p),(0,h.m)(r.basis2,d,p,.5);const f=(0,h.e)(A.rq.get(),r.basis1,r.basis2),g=(0,h.e)(f,f,r.basis1);(0,h.n)(g,g),(0,h.h)(r.basis2,g,(0,h.f)(r.basis2,g)),(0,h.h)(r.basis1,r.basis1,1+i/(0,h.l)(r.basis1)),(0,h.h)(r.basis2,r.basis2,1+i/(0,h.l)(r.basis2)),(0,Ds.u)(r)}(i,e.renderCoordsHelper,this.spatialReference,this.displayBoundsMargin,this.displayBounds)}}const xa=10,wa=80,Sa=(0,d.vt)(),Ea=(0,d.vt)(),Aa=(0,d.vt)(),Ma=(0,d.vt)();var Oa=n(96632);class Ra{get _object(){return this._tool.object}get _operations(){return this._object.operations}get zMax(){if(!this._zMaxDirty||!this._operations)return this._zMax;const e=this._operations.data;if(e.geometry.hasZ){const t=e.coordinateHelper;this._zMax=Number.NEGATIVE_INFINITY;for(const n of e.components)for(const e of n.vertices){const n=t.getZ(e.pos)??0;this._zMax=Math.max(n,this._zMax)}}else this._zMax=0;return this._zMaxDirty=!1,this._zMax}constructor(e,t,n){this._tool=e,this._bounds=t,this._preserveAspectRatioStep=n,this._resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}],this._displayBoundsStart=(0,Ds.a)(),this._displayBoundsMarginStart=0,this._zMax=0,this._zMaxDirty=!0;const i=this._tool,r=i.view;this.resizeManipulators=this._resizeHandles.map((e=>{const t=new _a(r,e);return i.addHandles([t.events.on("grab-changed",(e=>this._onResizeGrab(e))),this._createResizeDragPipeline(t,e)]),t})),i.manipulators.addMany(this.resizeManipulators),this._operations&&i.addHandles(this._operations.data.on("change",(()=>{"resize"!==i.inputState?.type&&(this._zMaxDirty=!0)})))}destroy(){this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()}))}forEachManipulator(e){this.resizeManipulators.forEach((t=>e(t,lr.SCALE)))}updateManipulators(e,t){this.resizeManipulators.forEach(((n,i)=>{!function(e,t,n,i){const r=(0,h.l)(i.basis1),o=(0,h.l)(i.basis2),s=Vs(i),a=Us(i),l=(0,h.i)(A.rq.get(),0,0,0);(0,h.g)(l,(0,h.h)(A.rq.get(),i.basis1,t.direction[0]),(0,h.h)(A.rq.get(),i.basis2,t.direction[1])),(0,h.g)(l,i.origin,l);let c=0,u=1;if(ks(t))1===t.direction[0]&&-1===t.direction[1]?c=Zs:1===t.direction[0]&&1===t.direction[1]?c=Math.PI:-1===t.direction[0]&&1===t.direction[1]&&(c=3*Math.PI/2),u=a;else{const e=0!==t.direction[0]?1:2;c=1===e?Zs:0,u=(1===e?o:r)-s}const d=(0,Rt.N9)(A.Rc.get(),c);(0,Rt.hs)(d,d,(0,h.i)(A.rq.get(),u,u,u)),(0,Rt.lw)(d,n,d),d[12]=0,d[13]=0,d[14]=0,e.modelTransform=d,e.renderLocation=l}(n,this._resizeHandles[i],e,t)}))}getUpdatedTooltipInfo(){if(!this.resizeManipulators.some((e=>e.focused)))return null;const e=this._tooltipInfo??=new Oa.c({sketchOptions:this._tool.sketchOptions}),t=function(e,t,n){return(0,h.d)(Ma,(0,h.d)(Ma,e.origin,e.basis1),e.basis2),(0,h.b)(Aa,Ma,e.basis1,2),(0,h.b)(Ea,Aa,e.basis2,2),(0,h.b)(Sa,Ma,e.basis2,2),Ma[2]=Aa[2]=Ea[2]=Sa[2]=t,(0,ba.b)({topLeft:Sa,topRight:Ea,bottomRight:Aa,bottomLeft:Ma,spatialReference:n})}(this._bounds.mapBounds,this.zMax,this._bounds.spatialReference);return t&&(e.xSize=t.xSize,e.ySize=t.ySize),this.resizeManipulators.some((e=>e.dragging))||(e.xScale=1,e.yScale=1),e}_onResizeGrab({action:e,screenPoint:t}){const n=this._tool,i=this._bounds;if("start"!==e||!t)return;const r=Vi(n.view.state.camera,t);(0,Fi.Ui)(i.displayBounds.plane,r,A.rq.get())&&(i.backupMapBounds(),(0,Ds.c)(i.displayBounds,this._displayBoundsStart),this._displayBoundsMarginStart=i.displayBoundsMargin,n.inputState={type:"resize"})}_createResizeDragPipeline(e,t){const{_tool:n,_object:i}=this;return(0,Ir.Xt)(e,((e,r,o)=>{null!=n.inputState&&(r.next((e=>("start"===e.action&&n.events.emit("scale-start",{object:i,xScale:1,yScale:1}),e))).next(Pr(n.view,this._displayBoundsStart.plane)).next((e=>({...e,handle:t}))).next(this._resizeDragRenderPlaneToFactors()).next(...this._preserveAspectRatioStep()).next(this._resizeDragUpdateGeometry()).next((e=>{const t=this._tooltipInfo;t&&(t.xScale=e.factor1,t.yScale=e.factor2);const r={object:i,xScale:e.factor1,yScale:e.factor2};switch(e.action){case"start":case"update":n.events.emit("scale",r);break;case"end":n.inputState=null,n.events.emit("scale-stop",r)}return e})),o.next((()=>{null!=n.inputState&&n.events.emit("scale-stop",{object:i,xScale:1,yScale:1}),n.cancel()})))}))}_resizeDragRenderPlaneToFactors(){const e=this._bounds;return t=>{const n=this._displayBoundsStart,i=t.handle.direction,r=e.displayBoundsMargin,o=this._displayBoundsMarginStart,s=(0,h.c)(A.rq.get(),n.origin);(0,h.b)(s,s,n.basis1,-i[0]),(0,h.b)(s,s,n.basis2,-i[1]);const a=(0,h.d)(A.rq.get(),t.renderEnd,s),l=(0,h.d)(A.rq.get(),t.renderStart,s),c=ks(t.handle),u=Us(n),d=Us(e.displayBounds)/u,p=(e,t)=>{if(0===e)return 1;let n=(0,h.l)(t),i=.5*e*(0,h.f)(t,a)/n;const s=i<0?-1:1;c&&(i+=(n-.5*e*(0,h.f)(t,l)/n)*s*d);const u=n<1.5*o?1:Ca;return n=Math.max(n-o,Ca),s>0&&(i-=r),s*Math.max(s*(i/n),u)};return{...t,factor1:p(i[0],n.basis1),factor2:p(i[1],n.basis2)}}}_resizeDragUpdateGeometry(){const e=this._bounds;return t=>{const n=(0,h.c)((0,d.vt)(),e.mapBoundsStart.origin);(0,h.b)(n,n,e.mapBoundsStart.basis1,-t.handle.direction[0]),(0,h.b)(n,n,e.mapBoundsStart.basis2,-t.handle.direction[1]);const i=(0,w.hZ)((0,S.vt)(),e.mapBoundsStart.basis1[0],e.mapBoundsStart.basis1[1]);(0,w.S8)(i,i);const r="start"===t.action?bi.Y.NEW_STEP:bi.Y.ACCUMULATE_STEPS;if(this._operations){const o=this._operations.scale(n,i,t.factor1,t.factor2,r,fa.K.REPLACE);(0,Ds.c)(e.mapBoundsStart,e.mapBounds),e.updateMapBoundsFromOperation(o)}return t}}}const Ca=1e-6;class Ia{constructor(){this._lastDragEvent=null,this._next=null,this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&null!=this._lastDragEvent&&null!=this._next){const t={...this._lastDragEvent,action:"update"};e&&Pa(t),this._next.execute(t)}this._enabled=e}createDragEventPipelineStep(){this._lastDragEvent=null;const e=new Ir.rh;return this._next=e,[e=>(this._lastDragEvent="end"!==e.action?{...e}:null,this._enabled&&Pa(e),e),e]}get test(){}}function Pa(e){const t=ks(e.handle)?Math.max(Math.abs(e.factor1),Math.abs(e.factor2)):0===e.handle.direction[0]?Math.abs(e.factor2):Math.abs(e.factor1);e.factor1=e.factor1<0?-t:t,e.factor2=e.factor2<0?-t:t}class Da{constructor(){this._lastDragEvent=null,this._next=null,this.incrementRadians=(0,b.kU)(5),this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&null!=this._lastDragEvent&&null!=this._next){const t={...this._lastDragEvent,action:"update"};e&&this._adjustRotation(t),this._next.execute(t)}this._enabled=e}createDragEventPipelineStep(){this._lastDragEvent=null;const e=new Ir.rh;return this._next=e,[e=>(this._lastDragEvent="end"!==e.action?{...e}:null,this._enabled&&this._adjustRotation(e),e),e]}_adjustRotation(e){e.rotateAngle=Math.round(e.rotateAngle/this.incrementRadians)*this.incrementRadians}}let La=class extends ho.g{get updating(){return!!this.object.updating}constructor(e){super(e),this.events=new xn.A,this.enableZ=!0,this.enableScaling=!0,this.enableRotation=!0,this.sketchOptions=new fo.A,this._preserveAspectRatio=new Ia,this._snapRotation=new Da,this.grabbing=!1,this.inputState=null,this._attachmentOrigin=null,this.type="transform-3d",this._outlineVisualElement=null}initialize(){const{view:e,object:t}=this,n=this._bounds=new Ta(this,(()=>this._updateManipulators()));this._extentMove=new ea(this,n),this._extentScale=new Ra(this,n,(()=>this._preserveAspectRatio.createDragEventPipelineStep())),this._extentRotate=new ma(this,n,(()=>this._snapRotation.createDragEventPipelineStep())),this.addHandles([(0,a.watch)((()=>this.enableZ),(()=>this._updateManipulatorAvailability(this._extentMove.moveZManipulator,lr.TRANSLATE_Z))),(0,a.watch)((()=>this.enableScaling),(()=>this._extentScale.forEachManipulator((e=>this._updateManipulatorAvailability(e,lr.SCALE))))),(0,a.watch)((()=>this.enableRotation),(()=>this._updateManipulatorAvailability(this._extentRotate.rotateManipulator,lr.ROTATE)))]),this._updateManipulators(),this._updateAllManipulatorAvailability();const i=br({view:e,object:t,forEachManipulator:e=>this._forEachManipulator(e),onManipulatorsChanged:()=>(0,o.hA)()});if(null!=i){const{visualElement:e}=i;e instanceof An&&(this._outlineVisualElement=e,this.addHandles(e.events.on("attachment-origin-changed",(()=>this._bounds.updateDisplayBounds())))),this.addHandles(i)}this.addHandles([t.on("committed",(()=>this._onGeometryChanged())),(0,a.watch)((()=>this.object.visible),(()=>this._updateAllManipulatorAvailability())),(0,a.watch)((()=>this.object.isDraped),(()=>this._graphicDrapedChanged()),a.Vh),(0,a.watch)((()=>e.pointsOfInterest?.centerOnSurfaceFrequent.location),(()=>n.updateDisplayBounds()))]),this._forEachManipulator((e=>{this.addHandles(e.events.on("grab-changed",(()=>{this.grabbing=e.grabbing,this._updateAllManipulatorAvailability()})))})),this._forEachManipulator(((e,n)=>{this.addHandles(e.events.on("immediate-click",(e=>{n===lr.TRANSLATE_XY&&this.events.emit("immediate-click",{...e,object:t}),e.stopPropagation()})))})),this._initializeTooltip(),this.finishToolCreation()}destroy(){this._extentMove.destroy(),this._extentScale.destroy(),this._extentRotate.destroy(),this.tooltip.destroy(),this._set("view",null),this._set("object",null)}_initializeTooltip(){const{view:e}=this;this.tooltip=(0,si.A)((()=>({view:e,options:this.sketchOptions.tooltips})));const t=()=>{this.tooltip.info=this._getUpdatedTooltipInfo()};this.addHandles([(0,a.watch)((()=>this.sketchOptions.tooltips.effectiveEnabled),t),(0,a.watch)((()=>this.preserveAspectRatio),t)]),this._forEachManipulator((e=>{this.addHandles([e.events.on(["focus-changed","grab-changed"],t),e.events.on("drag",(e=>{"cancel"===e.action?this.tooltip.clear():t()}))])}))}_getUpdatedTooltipInfo(){return this.sketchOptions.tooltips.effectiveEnabled?this._extentMove.getUpdatedTooltipInfo()??this._extentScale.getUpdatedTooltipInfo()??this._extentRotate.getUpdatedTooltipInfo():null}_onGeometryChanged(){this._bounds.updateDisplayBounds()}_graphicDrapedChanged(){this.removeHandles(Na),this._bounds.updateDisplayBounds(),this.object.isDraped&&this.addHandles(this.view.elevationProvider.on("elevation-change",(e=>{null!=this._attachmentOrigin&&(0,Ni.Rj)(e.extent,this._attachmentOrigin.x,this._attachmentOrigin.y)&&this._bounds.updateDisplayBounds()})),Na)}_updateManipulators(){if(!this.visible)return;const e=this._bounds.displayBounds,t=function(e,t){return Qr(e.basis1,e.basis2,e.origin,t)}(e,A.Rc.get());this._extentMove.updateManipulators(t,e),this._extentScale.updateManipulators(t,e),this._extentRotate.updateManipulators(t,e)}_updateAllManipulatorAvailability(){this._forEachManipulator(((e,t)=>this._updateManipulatorAvailability(e,t)))}_updateManipulatorAvailability(e,t){const n=this.grabbing&&!e.grabbing;if(e.interactive=!n,e instanceof $i){const i=this.object.visible,r=this.enableZ&&yi(this.object.operations,this.object.elevationInfo);switch(t){case lr.ROTATE:e.available=i&&this.enableRotation;break;case lr.SCALE:e.available=i&&(this.enableScaling||this.enableRotation||r),e.interactive=!n&&this.enableScaling,e.state=this.enableScaling?Ws:qs;break;case lr.TRANSLATE_Z:e.available=i&&r;break;default:e.available=i}}}_forEachManipulator(e){this._extentMove.forEachManipulator(e),this._extentScale.forEachManipulator(e),this._extentRotate.forEachManipulator(e)}get preserveAspectRatio(){return this._preserveAspectRatio.enabled}set preserveAspectRatio(e){this._preserveAspectRatio.enabled=e,this._set("preserveAspectRatio",e)}get snapRotation(){return this._snapRotation.enabled}set snapRotation(e){this._snapRotation.enabled=e,this._set("snapRotation",e)}get attachmentOrigin(){const e=this.object.isDraped?null:this._outlineVisualElement?.attachmentOrigin;return this._attachmentOrigin=e??this.object.origin??vi(this.object)?.extent?.center,this._attachmentOrigin}reset(){}cancel(){if(this.canUndo){const e=this.object.operations?.undo();e&&this._bounds.updateMapBoundsFromOperationInverse(e)}this.inputState=null}get canUndo(){return!!this.object.operations?.canUndo}undo(){if(null!=this.inputState)this.view.activeTool=null;else if(this.canUndo){const e=this.object.operations?.undo();e&&this._bounds.updateMapBoundsFromOperationInverse(e)}}get canRedo(){return!!this.object.operations?.canRedo}redo(){if(this.canRedo){const e=this.object.operations?.redo();e&&this._bounds.updateMapBoundsFromOperation(e)}}get test(){}};(0,i._)([(0,l.MZ)()],La.prototype,"updating",null),(0,i._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],La.prototype,"view",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],La.prototype,"object",void 0),(0,i._)([(0,l.MZ)()],La.prototype,"enableZ",void 0),(0,i._)([(0,l.MZ)()],La.prototype,"enableScaling",void 0),(0,i._)([(0,l.MZ)()],La.prototype,"enableRotation",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0,type:fo.A})],La.prototype,"sketchOptions",void 0),(0,i._)([(0,l.MZ)()],La.prototype,"preserveAspectRatio",null),(0,i._)([(0,l.MZ)()],La.prototype,"snapRotation",null),(0,i._)([(0,l.MZ)()],La.prototype,"grabbing",void 0),(0,i._)([(0,l.MZ)()],La.prototype,"inputState",void 0),(0,i._)([(0,l.MZ)({readOnly:!0})],La.prototype,"type",void 0),(0,i._)([(0,l.MZ)()],La.prototype,"tooltip",void 0),La=(0,i._)([(0,u.$)("esri.views.3d.interactive.editingTools.transform.ExtentTransformTool")],La);const Na="draped-elevation-changes";var Fa=n(67376);var za=n(82067);const Ha=Symbol();let Va=class extends xn.A.EventedAccessor{get operations(){return this._operations}get updating(){return this._updatingHandles.updating}get elevationInfo(){return(0,p.bh)(this.graphic)}get visible(){return this._graphicState.displaying}get isDraped(){return this._graphicState.isDraped}get origin(){return function(e,t){const n=e.getViewForGraphic(t);return null!=n&&"computeAttachmentOrigin"in n?n.computeAttachmentOrigin(t,e.spatialReference):null}(this.view,this.graphic)}constructor(e){super(e),this._updatingHandles=new fi.U}destroy(){this._operations=(0,s.pR)(this._operations),this._updatingHandles.destroy()}initialize(){this._graphicState=new ni({graphic:this.graphic}),this._graphicState.on("changed",(()=>this.emit("committed"))),this.addHandles(this.view.trackGraphicState(this._graphicState)),this.addHandles(this._updatingHandles.add((()=>this.graphic.geometry),(e=>{const t=this._operations?.data.geometry;if(e!==t){if(!e||"multipoint"===e?.type||"extent"===e?.type)return(0,s.pR)(this._operations),this.removeHandles(Ha),void(this._operations=null);if(this._operations?.trySetGeometry(e))this.emit("modified-externally");else{(0,s.pR)(this._operations),this.removeHandles(Ha);const t=po.p.fromGeometry(e,this.view.state.viewingMode);this._operations=t,this.addHandles(t.data.on("change",(()=>this.graphic.geometry=t.data.geometry)),Ha)}}}),a.pc))}createManipulator(e){return new za.l({view:this.view,graphic:this.graphic,...e})}maskOccludee(){return this.view.maskOccludee(this.graphic)}endInteraction(){const e=this.graphic.geometry;"mesh"===e?.type&&this.graphic.notifyMeshTransformChanged({action:on.$.UpdateFastLocalOrigin})}toMap(e){return this.view.toMap(e,{include:[this.graphic]})}createUndoRecord(){const{graphic:{geometry:e}}=this;return function(e){return null!=e&&"mesh"===e.type?function(e){return(0,Fa.Hq)(e.vertexSpace)?function(e,t,n){let i=t?.clone(),r=(0,d.o8)(n.origin),o=null,s=null;return{undo:()=>{o=e.transform?.clone(),s=(0,d.o8)(n.origin),e.transform=i,e.vertexSpace.origin=r},redo:()=>{i=e.transform?.clone(),r=(0,d.o8)(n.origin),e.transform=o,e.vertexSpace.origin=s}}}(e,e.transform,e.vertexSpace):function(e){let t,n=e.vertexAttributes.clonePositional();return{undo:()=>{t=e.vertexAttributes.clonePositional(),e.vertexAttributes=n},redo:()=>{n=e.vertexAttributes.clonePositional(),e.vertexAttributes=t}}}(e)}(e):function(e){let t=e,n=null;return{undo(e){n=e.geometry,e.geometry=t},redo(e){t=e.geometry,e.geometry=n}}}(e)}(e)}};(0,i._)([(0,l.MZ)({constructOnly:!0})],Va.prototype,"view",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0})],Va.prototype,"graphic",void 0),(0,i._)([(0,l.MZ)()],Va.prototype,"_operations",void 0),(0,i._)([(0,l.MZ)()],Va.prototype,"operations",null),(0,i._)([(0,l.MZ)()],Va.prototype,"updating",null),Va=(0,i._)([(0,u.$)("esri.views.3d.interactive.editingTools.ManipulatedObject3DGraphic")],Va)},76589:function(e,t,n){"use strict";n.d(t,{F:function(){return o}});var i=n(32e3),r=n(68546);class o{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=(0,i.Ao)(e)}get requiresSampledElevationInfo(){return"absolute-height"!==this.mode}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,t){const n=this.calculateOffsetRenderUnits(t);return null!=this.featureExpressionInfoContext?n:e+n}calculateOffsetRenderUnits(e){let t=this._meterUnitOffset;const n=this.featureExpressionInfoContext;return null!=n&&(t+=(0,r.g7)(n)*this._metersPerElevationInfoUnit),t/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=(0,i.Tg)(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=e.offset??0}updateFeatureExpressionInfoContext(e,t,n){if(null==e)return void(this._featureExpressionInfoContext=null);const i=e?.arcade;i&&null!=t&&null!=n?(this._featureExpressionInfoContext=(0,r.o8)(e),(0,r.gf)(this._featureExpressionInfoContext,(0,r.VG)(i.modules,t,n))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const t=new o;return null!=e&&t.setFromElevationInfo(e),t}}},49618:function(e,t,n){"use strict";n.d(t,{I2:function(){return m},Kf:function(){return v},Uk:function(){return T},ai:function(){return b},au:function(){return p},fe:function(){return y},nG:function(){return g},nu:function(){return _},sE:function(){return f},uw:function(){return i}});var i,r,o=n(73364),s=n(39714),a=n(32501),l=n(7456),c=n(57617),u=n(5915),h=n(60516),d=n(65839);function p(e,t,n,i,r,o,s,a,l,u,h){const d=x[h.mode];let p,f,g=0;if((0,c.projectBuffer)(e,t,n,i,l.spatialReference,r,a))return d?.requiresAlignment(h)?(g=d.applyElevationAlignmentBuffer(i,r,o,s,a,l,u,h),p=o,f=s):(p=i,f=r),(0,c.projectBuffer)(p,l.spatialReference,f,o,u.spatialReference,s,a)?g:void 0}function f(e,t,n,i,r){const o=((0,u.v)(e)?e.z:(0,h.cN)(e)?e.array[e.offset+2]:e[2])||0;switch(n.mode){case"on-the-ground":{const n=(0,h.R1)(t,e,"ground")??0;return r.verticalDistanceToGround=0,r.sampledElevation=n,void(r.z=n)}case"relative-to-ground":{const s=(0,h.R1)(t,e,"ground")??0,a=n.geometryZWithOffset(o,i);return r.verticalDistanceToGround=a,r.sampledElevation=s,void(r.z=a+s)}case"relative-to-scene":{const s=(0,h.R1)(t,e,"scene")??0,a=n.geometryZWithOffset(o,i);return r.verticalDistanceToGround=a,r.sampledElevation=s,void(r.z=a+s)}case"absolute-height":{const s=n.geometryZWithOffset(o,i),a=(0,h.R1)(t,e,"ground")??0;return r.verticalDistanceToGround=s-a,r.sampledElevation=a,void(r.z=s)}default:return void(r.z=0)}}function g(e,t,n,i){return f(e,t,n,i,S),S.z}function m(e,t,n){return"on-the-ground"===t&&"on-the-ground"===n?e.staysOnTheGround:t===n||"on-the-ground"!==t&&"on-the-ground"!==n?null==t||null==n?e.definedChanged:i.UPDATE:e.onTheGroundChanged}function _(e){return"relative-to-ground"===e||"relative-to-scene"===e}function v(e){return"absolute-height"!==e}function y(e,t,n,i,r){f(t,n,r,i,S),b(e,S.verticalDistanceToGround);const s=S.sampledElevation,a=(0,o.C)(w,e.transformation);return E[0]=t.x,E[1]=t.y,E[2]=S.z,(0,l.l)(t.spatialReference,E,a,i.spatialReference)?e.transformation=a:console.warn("Could not locate symbol object properly, it might be misplaced"),s}function b(e,t){for(let n=0;n<e.geometries.length;++n){const i=e.geometries[n].getMutableAttribute(d.r.CENTEROFFSETANDDISTANCE);i&&i.data[3]!==t&&(i.data[3]=t,e.geometryVertexAttributeUpdated(e.geometries[n],d.r.CENTEROFFSETANDDISTANCE))}}class T{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}}(r=i||(i={}))[r.NONE=0]="NONE",r[r.UPDATE=1]="UPDATE",r[r.RECREATE=2]="RECREATE";const x={"absolute-height":{applyElevationAlignmentBuffer:function(e,t,n,i,r,o,s,a){const l=a.calculateOffsetRenderUnits(s),c=a.featureExpressionInfoContext;t*=3,i*=3;for(let o=0;o<r;++o){const r=e[t],o=e[t+1],s=e[t+2];n[i]=r,n[i+1]=o,n[i+2]=null==c?s+l:l,t+=3,i+=3}return 0},requiresAlignment:function(e){const t=e.meterUnitOffset,n=e.featureExpressionInfoContext;return 0!==t||null!=n}},"on-the-ground":{applyElevationAlignmentBuffer:function(e,t,n,i,r,o){let s=0;const a=o.spatialReference;t*=3,i*=3;for(let l=0;l<r;++l){const r=e[t],l=e[t+1],c=e[t+2],u=o.getElevation(r,l,c,a,"ground")??0;s+=u,n[i]=r,n[i+1]=l,n[i+2]=u,t+=3,i+=3}return s/r},requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:function(e,t,n,i,r,o,s,a){let l=0;const c=a.calculateOffsetRenderUnits(s),u=a.featureExpressionInfoContext,h=o.spatialReference;t*=3,i*=3;for(let s=0;s<r;++s){const r=e[t],s=e[t+1],a=e[t+2],d=o.getElevation(r,s,a,h,"ground")??0;l+=d,n[i]=r,n[i+1]=s,n[i+2]=null==u?a+d+c:d+c,t+=3,i+=3}return l/r},requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:function(e,t,n,i,r,o,s,a){let l=0;const c=a.calculateOffsetRenderUnits(s),u=a.featureExpressionInfoContext,h=o.spatialReference;t*=3,i*=3;for(let s=0;s<r;++s){const r=e[t],s=e[t+1],a=e[t+2],d=o.getElevation(r,s,a,h,"scene")??0;l+=d,n[i]=r,n[i+1]=s,n[i+2]=null==u?a+d+c:d+c,t+=3,i+=3}return l/r},requiresAlignment:()=>!0}},w=(0,s.vt)(),S=new T,E=(0,a.vt)()},68546:function(e,t,n){"use strict";n.d(t,{KF:function(){return f},MF:function(){return p},VG:function(){return u},g7:function(){return d},gf:function(){return h},o8:function(){return l},q6:function(){return c}});var i=n(40633),r=n(60539),o=n(45328),s=n(54547);const a=()=>i.A.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function l(e){return{cachedResult:e.cachedResult,arcade:e.arcade?{func:e.arcade.func,context:e.arcade.modules.arcadeUtils.createExecContext(null,{sr:e.arcade.context.spatialReference}),modules:e.arcade.modules}:null}}async function c(e,t,n,i){const o=e?.expression;if("string"!=typeof o)return null;const a=function(e){return"0"===e?0:null}(o);if(null!=a)return{cachedResult:a};const l=await(0,s.lw)();(0,r.Te)(n);const c=l.arcadeUtils,u=c.createSyntaxTree(o);return c.dependsOnView(u)?(null!=i&&i.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:c.createFunction(u),context:c.createExecContext(null,{sr:t}),modules:l}}}function u(e,t,n){return e.arcadeUtils.createFeature(t.attributes,t.geometry,n)}function h(e,t){if(null!=e&&!g(e)){if(!t||!e.arcade)return void a().errorOncePerTick("Arcade support required but not provided");const n=t;n._geometry&&(n._geometry=(0,o.wZ)(n._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,t)}}function d(e){if(null!=e){if(g(e))return e.cachedResult;const t=e.arcade;let n=t?.modules.arcadeUtils.executeFunction(t.func,t.context);return"number"!=typeof n&&(e.cachedResult=0,n=0),n}return 0}function p(e,t=!1){let n=e?.featureExpressionInfo;const i=n?.expression;return t||"0"===i||(n=null),n??null}const f={cachedResult:0};function g(e){return null!=e.cachedResult}},75302:function(e,t,n){"use strict";n.d(t,{$2:function(){return E},$C:function(){return T},Hj:function(){return w},Mh:function(){return S},W$:function(){return _},pW:function(){return x},t8:function(){return b},vY:function(){return A}});var i=n(62938),r=n(73364),o=n(39714),s=n(32501),a=n(33400),l=n(41546),c=n(46157),u=n(24761),h=n(87416),d=n(72228),p=n(38441),f=n(67376),g=n(46460),m=n(45328);function _(e,t){if("point"===e.type)return y(e,t,!1);if((0,m.gr)(e))switch(e.type){case"extent":return y(e.center,t,!1);case"polygon":return y(e.centroid,t,!1);case"polyline":return y(v(e),t,!0);case"mesh":return y((0,f.MW)(e.vertexSpace,e.spatialReference)??e.extent.center,t,!1);case"multipoint":return}else switch(e.type){case"extent":return y(function(e){return(0,g.T)(.5*(e.xmax+e.xmin),.5*(e.ymax+e.ymin),null!=e.zmin&&null!=e.zmax&&isFinite(e.zmin)&&isFinite(e.zmax)?.5*(e.zmax+e.zmin):void 0,e.spatialReference)}(e),t,!0);case"polygon":return y(function(e){const t=e.rings[0];if(!t||0===t.length)return null;const n=(0,d.S8)(e.rings,!!e.hasZ);return(0,g.T)(n[0],n[1],n[2],e.spatialReference)}(e),t,!0);case"polyline":return y(v(e),t,!0);case"multipoint":return}}function v(e){const t=e.paths[0];if(!t||0===t.length)return null;const n=(0,p.$H)(t,(0,p.Yl)(t)/2);return(0,g.T)(n[0],n[1],n[2],e.spatialReference)}function y(e,t,n){const i=n?e:(0,m.EL)(e);return t&&e?(0,c.projectPoint)(e,i,t)?i:null:i}function b(e,t,n,i=0){if(e){t||(t=(0,h.vt)());const r=e;let o=.5*r.width*(n-1),s=.5*r.height*(n-1);return r.width<1e-7*r.height?o+=s/20:r.height<1e-7*r.width&&(s+=o/20),(0,a.s)(t,r.xmin-o-i,r.ymin-s-i,r.xmax+o+i,r.ymax+s+i),t}return null}function T(e,t,n=null){const i=(0,l.o8)(l.Un);return null!=e&&(i[0]=e[0],i[1]=e[1],i[2]=e[2]),null!=t?i[3]=t:null!=e&&e.length>3&&(i[3]=e[3]),n&&(i[0]*=n,i[1]*=n,i[2]*=n,i[3]*=n),i}function x(e=s.Un,t,n,i=1){const r=new Array(3);if(null==t||null==n)r[0]=1,r[1]=1,r[2]=1;else{let i,o=0;for(let s=2;s>=0;s--){const a=e[s];let l;const c=null!=a,u=0===s&&!i&&!c,h=n[s];"symbol-value"===a||u?l=0!==h?t[s]/h:1:c&&"proportional"!==a&&isFinite(a)&&(l=0!==h?a/h:1),null!=l&&(r[s]=l,i=l,o=Math.max(o,Math.abs(l)))}for(let e=2;e>=0;e--)null==r[e]?r[e]=i:0===r[e]&&(r[e]=.001*o)}for(let e=2;e>=0;e--)r[e]/=i;return(0,s.ci)(r)}function w(e){return S(function(e){return null!=e.isPrimitive}(e)?[e.width,e.depth,e.height]:e)?null:"Symbol sizes may not be negative values"}function S(e){const t=e=>null==e||e>=0;return Array.isArray(e)?e.every(t):t(e)}function E(e,t,n,i=(0,o.vt)()){return e&&(0,r.Qr)(i,i,-e/180*Math.PI),t&&(0,r.eL)(i,i,t/180*Math.PI),n&&(0,r.Z8)(i,i,n/180*Math.PI),i}function A(e,t,n){if(null!=n.minDemResolution)return n.minDemResolution;const r=(0,i.GA)(t),o=(0,u.VL)(e)*r,s=(0,u.yr)(e)*r,a=(0,u.uJ)(e)*(t.isGeographic?1:r);return 0===o&&0===s&&0===a?n.minDemResolutionForPoints:.01*Math.max(o,s,a)}},46949:function(e,t,n){"use strict";var i,r,o;n.d(t,{O7:function(){return r},Om:function(){return i},sv:function(){return o}}),function(e){e[e.RasterImage=0]="RasterImage",e[e.Features=1]="Features"}(i||(i={})),function(e){e[e.MapLayer=0]="MapLayer",e[e.ViewLayer=1]="ViewLayer",e[e.Outline=2]="Outline",e[e.SnappingHint=3]="SnappingHint"}(r||(r={})),function(e){e[e.WithRasterImage=0]="WithRasterImage",e[e.WithoutRasterImage=1]="WithoutRasterImage"}(o||(o={}))},24129:function(e,t,n){"use strict";n.d(t,{Gd:function(){return N},J_:function(){return D},VC:function(){return H},b3:function(){return z},s_:function(){return P},ul:function(){return V},wI:function(){return R}}),n(58941);var i,r,o,s=n(15774),a=n(44705),l=n(87725),c=n(73364),u=n(39714),h=n(20551),d=n(32501),p=n(85031),f=n(70974),g=n(39506);(o=i||(i={}))[o.Undefined=0]="Undefined",o[o.DefinedSize=1]="DefinedSize",o[o.DefinedScale=2]="DefinedScale",function(e){e[e.Undefined=0]="Undefined",e[e.DefinedAngle=1]="DefinedAngle"}(r||(r={}));class m{constructor(e){this.field=e}}class _ extends m{constructor(e){super(e),this.minSize=[0,0,0],this.maxSize=[0,0,0],this.offset=[0,0,0],this.factor=[0,0,0],this.type=[i.Undefined,i.Undefined,i.Undefined]}}class v extends m{constructor(e){super(e),this.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.values=[0,0,0,0,0,0,0,0]}}class y extends m{constructor(e){super(e),this.values=[0,0,0,0,0,0,0,0],this.opacityValues=[0,0,0,0,0,0,0,0]}}class b{}function T(e){return null!=e}function x(e){return"number"==typeof e}function w(e){return"string"==typeof e}function S(e,t){e&&e.push(t)}function E(e,t,n,r,o){const s=e.minSize,a=e.maxSize;if(e.useSymbolValue){const e=r.symbolSize[n];return t.minSize[n]=e,t.maxSize[n]=e,t.offset[n]=t.minSize[n],t.factor[n]=0,t.type[n]=i.DefinedSize,!0}if(T(e.field))return T(e.stops)?2===e.stops.length&&x(e.stops[0].size)&&x(e.stops[1].size)?(A(e.stops[0].size,e.stops[1].size,e.stops[0].value,e.stops[1].value,t,n),t.type[n]=i.DefinedSize,!0):(S(o,"Could not convert size info: stops only supported with 2 elements"),!1):x(s)&&x(a)&&T(e.minDataValue)&&T(e.maxDataValue)?(A(s,a,e.minDataValue,e.maxDataValue,t,n),t.type[n]=i.DefinedSize,!0):"unknown"===e.valueUnit?(S(o,"Could not convert size info: proportional size not supported"),!1):null!=p.j[e.valueUnit]?(t.minSize[n]=-1/0,t.maxSize[n]=1/0,t.offset[n]=0,t.factor[n]=1/p.j[e.valueUnit],t.type[n]=i.DefinedSize,!0):(S(o,"Could not convert size info: scale-dependent size not supported"),!1);if(!T(e.field)){if(e.stops?.[0]&&x(e.stops[0].size))return t.minSize[n]=e.stops[0].size,t.maxSize[n]=e.stops[0].size,t.offset[n]=t.minSize[n],t.factor[n]=0,t.type[n]=i.DefinedSize,!0;if(x(s))return t.minSize[n]=s,t.maxSize[n]=s,t.offset[n]=s,t.factor[n]=0,t.type[n]=i.DefinedSize,!0}return S(o,"Could not convert size info: unsupported variant of sizeInfo"),!1}function A(e,t,n,i,r,o){const s=Math.abs(i-n)>0?(t-e)/(i-n):0;r.minSize[o]=s>0?e:t,r.maxSize[o]=s>0?t:e,r.offset[o]=e-n*s,r.factor[o]=s}function M(e,t,n){e[4*t]=n.r/255,e[4*t+1]=n.g/255,e[4*t+2]=n.b/255,e[4*t+3]=n.a}function O(e,t,n){const i=2===n&&"arithmetic"===e.rotationType;t.offset[n]=i?90:0,t.factor[n]=i?-1:1,t.type[n]=1}class R{constructor(e,t=[1,1,1],n=[1,1,1],i=1,r=[0,0,0],o=[1,1,1],s=[0,0,0]){this.supports=e,this.modelSize=t,this.symbolSize=n,this.unitInMeters=i,this.anchor=r,this.scale=o,this.rotation=s}}function C(e,t,n){if(!e)return null;const r=e.reduce(((e,i)=>{if(!e)return e;if(i.valueExpression)return S(n,"Could not convert visual variables: arcade expressions not supported"),null;switch(i.type){case"size":return t.supports.size?function(e,t,n,i){if(e.normalizationField||e.valueRepresentation)return S(i,"Could not convert size info: unsupported property"),null;if(!function(e){return null==e||w(e)}(e.field))return S(i,"Could not convert size info: field is not a string"),null;if(t.size){if(e.field)if(t.size.field){if(e.field!==t.size.field)return S(i,"Could not convert size info: multiple fields in use"),null}else t.size.field=e.field}else t.size=new _(e.field);let r;switch(e.axis){case"width":return r=E(e,t.size,0,n,i),r?t:null;case"height":return r=E(e,t.size,2,n,i),r?t:null;case"depth":return r=E(e,t.size,1,n,i),r?t:null;case"width-and-depth":return r=E(e,t.size,0,n,i),r&&E(e,t.size,1,n,i),r?t:null;case null:case void 0:case"all":return r=E(e,t.size,0,n,i),r=r&&E(e,t.size,1,n,i),r=r&&E(e,t.size,2,n,i),r?t:null;default:return S(i,`Could not convert size info: unknown axis "${e.axis}""`),null}}(i,e,t,n):e;case"color":return t.supports.color?function(e,t,n){if(e.normalizationField)return S(n,"Could not convert color info: unsupported property"),null;if(w(e.field)){if(!e.stops)return S(n,"Could not convert color info: missing stops or colors"),null;{if(e.stops.length>8)return S(n,"Could not convert color info: too many color stops"),null;t.color=new v(e.field);const i=e.stops;for(let e=0;e<8;++e){const n=i[Math.min(e,i.length-1)];t.color.values[e]=n.value,M(t.color.colors,e,n.color)}}}else{if(!(e.stops&&e.stops.length>=0))return S(n,"Could not convert color info: no field and no colors/stops"),null;{const n=e.stops&&e.stops.length>=0&&e.stops[0].color;t.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let e=0;e<8;e++)t.color.values[e]=1/0,M(t.color.colors,e,n)}}return t}(i,e,n):e;case"opacity":return t.supports.opacity?function(e,t,n){if(e.normalizationField)return S(n,"Could not convert opacity info: unsupported property"),null;if(w(e.field)){if(!e.stops)return S(n,"Could not convert opacity info: missing stops or opacities"),null;{if(e.stops.length>8)return S(n,"Could not convert opacity info: too many opacity stops"),null;t.opacity=new y(e.field);const i=e.stops;for(let e=0;e<8;++e){const n=i[Math.min(e,i.length-1)];t.opacity.values[e]=n.value,t.opacity.opacityValues[e]=n.opacity}}}else{if(!(e.stops&&e.stops.length>=0))return S(n,"Could not convert opacity info: no field and no opacities/stops"),null;{const n=e.stops&&e.stops.length>=0?e.stops[0].opacity:0;t.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let e=0;e<8;e++)t.opacity.values[e]=1/0,t.opacity.opacityValues[e]=n}}return t}(i,e,n):null;case"rotation":return t.supports.rotation?function(e,t,n){if(!w(e.field))return S(n,"Could not convert rotation info: field is not a string"),null;if(t.rotation){if(e.field)if(t.rotation.field){if(e.field!==t.rotation.field)return S(n,"Could not convert rotation info: multiple fields in use"),null}else t.rotation.field=e.field}else t.rotation={field:e.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(e.axis){case"tilt":return O(e,t.rotation,0),t;case"roll":return O(e,t.rotation,1),t;case null:case void 0:case"heading":return O(e,t.rotation,2),t;default:return S(n,`Could not convert rotation info: unknown axis "${e.axis}""`),null}}(i,e,n):e;default:return null}}),new b);return!(e.length>0&&r)||r.size||r.color||r.opacity||r.rotation?r?.size&&!function(e,t,n){for(let n=0;n<3;++n){let r=t.unitInMeters;e.type[n]===i.DefinedSize&&(r*=t.modelSize[n],e.type[n]=i.DefinedScale),e.minSize[n]=e.minSize[n]/r,e.maxSize[n]=e.maxSize[n]/r,e.offset[n]=e.offset[n]/r,e.factor[n]=e.factor[n]/r}let r;if(e.type[0]!==i.Undefined)r=0;else if(e.type[1]!==i.Undefined)r=1;else{if(e.type[2]===i.Undefined)return S(n,"No size axis contains a valid size or scale"),!1;r=2}for(let t=0;t<3;++t)e.type[t]===i.Undefined&&(e.minSize[t]=e.minSize[r],e.maxSize[t]=e.maxSize[r],e.offset[t]=e.offset[r],e.factor[t]=e.factor[r],e.type[t]=e.type[r]);return!0}(r.size,t,n)?null:r:null}class I{constructor(e,t,n){this.visualVariables=e,this.materialParameters=t,this.requiresShaderTransformation=n}}function P(e,t){if(!e)return null;if(f.b.TESTS_DISABLE_FAST_UPDATES)return null;const n=C(e.visualVariables,t);return n?new I(n,F(n,t),!!n.size):null}function D(e,t,n){if(!t||!e)return!1;const i=e.visualVariables,r=C(t.visualVariables,n);return!!r&&!!(L(i.size,r.size,"size")&&L(i.color,r.color,"color")&&L(i.rotation,r.rotation,"rotation")&&L(i.opacity,r.opacity,"opacity"))&&(e.visualVariables=r,e.materialParameters=F(r,n),e.requiresShaderTransformation=!!r.size,!0)}function L(e,t,n){if(!!e!=!!t)return!1;if(e&&e.field!==t?.field)return!1;if(e&&"rotation"===n){const n=e,i=t;for(let e=0;e<3;e++)if(n.type[e]!==i.type[e]||n.offset[e]!==i.offset[e]||n.factor[e]!==i.factor[e])return!1}return!0}class N extends g.Y{constructor(e){super(),this.vvSize=e?.size??null,this.vvColor=e?.color??null,this.vvOpacity=e?.opacity??null}}function F(e,t){const n=new N(e);return n.vvSize&&(n.vvSymbolAnchor=t.anchor,(0,c.D_)(B),function(e,t,n,i=(0,u.vt)()){const r=e||0,o=t||0,s=n||0;0!==r&&(0,c.Qr)(i,i,-r/180*Math.PI),0!==o&&(0,c.eL)(i,i,o/180*Math.PI),0!==s&&(0,c.Z8)(i,i,s/180*Math.PI)}(t.rotation[2],t.rotation[0],t.rotation[1],B),n.vvSymbolRotationMatrix=n.vvSymbolRotationMatrix||(0,l.vt)(),(0,a.z0)(n.vvSymbolRotationMatrix,B)),n}function z(e,t,n){if(!e.vvSize)return n;(0,c.C)(U,n);const i=e.vvSymbolRotationMatrix;(0,c.hZ)(B,i[0],i[1],i[2],0,i[3],i[4],i[5],0,i[6],i[7],i[8],0,0,0,0,1),(0,c.lw)(U,U,B);for(let n=0;n<3;++n){const i=e.vvSize.offset[n]+t[0]*e.vvSize.factor[n];k[n]=(0,s.qE)(i,e.vvSize.minSize[n],e.vvSize.maxSize[n])}return(0,c.hs)(U,U,k),(0,c.Tl)(U,U,e.vvSymbolAnchor),U}function H(e,t,n){if(!t.vvSize)return(0,h.i)(e,1,1,1),e;for(let i=0;i<3;++i){const r=t.vvSize.offset[i]+n[0]*t.vvSize.factor[i];e[i]=(0,s.qE)(r,t.vvSize.minSize[i],t.vvSize.maxSize[i])}return e}function V(e,t){const n=null==e?0:t.attributes[e];return"number"==typeof n&&isFinite(n)?n:0}const U=(0,u.vt)(),k=(0,d.vt)(),B=(0,u.vt)()},60516:function(e,t,n){"use strict";n.d(t,{R1:function(){return s},aY:function(){return r},cN:function(){return o}});var i=n(5915);class r{constructor(e,t=null,n=0){this.array=e,this.spatialReference=t,this.offset=n}}function o(e){return"array"in e}function s(e,t,n="ground"){if((0,i.v)(t))return e.getElevation(t.x,t.y,t.z||0,t.spatialReference,n);if(o(t)){let i=t.offset;return e.getElevation(t.array[i++],t.array[i++],t.array[i]||0,t.spatialReference??e.spatialReference,n)}return e.getElevation(t[0],t[1],t[2]||0,e.spatialReference,n)}},12378:function(e,t,n){"use strict";n.d(t,{d:function(){return M}});var i=n(15774),r=n(62938),o=n(73364),s=n(20551),a=n(61714),l=n(96611),c=n(56763),u=n(56919),h=n(68734),d=n(87416),p=n(72485),f=n(32501),g=(n(57165),n(2075)),m=n(13794);function _(e,t,n=function(e){return{operations:e,value:e.create()}}(e)){return n.operations=e,e.copy(t,n.value),n}const v=2**50;function y(e,t,n,i){return e.operations.setAltitudeAt(e.value,t,n,i)}function b(e,t,n){return e.operations.elevate(e.value,t,n.value)}const T=(0,f.vt)();(0,f.vt)();var x=n(5596),w=n(29531),S=n(50973),E=n(5915),A=n(65420);class M{constructor(e,t,n,i){this.viewingMode=e,this.spatialReference=t,this.unitInMeters=n,this._coordinateSystem=i,this._tmpCoordinateSystem=function(e){const{value:t,operations:n}=e;return{operations:n,value:n.create(t)}}(i),this.referenceEllipsoid=(0,a.tO)(t),this.sphericalPCPF=(0,l.lO)(t)}set extent(e){e&&function(e,t,n){e.operations.setExtent(e.value,t,n.value)}(this._coordinateSystem,e,this._coordinateSystem)}get extent(){return e=this._coordinateSystem,t=(0,d.vt)(),e.operations.getExtent(e.value,t),t;var e,t}getAltitude(e){return function(e,t){return e.operations.altitudeAt(e.value,t)}(this._coordinateSystem,e)}setAltitude(e,t,n=e){return y(this._coordinateSystem,n,t,e)}setAltitudeOfTransformation(e,t){var n,i,r,a;n=this._coordinateSystem,r=e,(i=t)!==(a=t)&&(0,o.C)(a,i),(0,s.i)(T,a[12],a[13],a[14]),y(n,T,r,T),a[12]=T[0],a[13]=T[1],a[14]=T[2]}worldUpAtPosition(e,t){return function(e,t,n){return e.operations.axisAt(e.value,t,p._.Z,n)}(this._coordinateSystem,e,t)}worldBasisAtPosition(e,t,n){return function(e,t,n,i){return e.operations.axisAt(e.value,t,n,i)}(this._coordinateSystem,e,t,n)}basisMatrixAtPosition(e,t){const n=this.worldBasisAtPosition(e,p._.X,S.rq.get()),i=this.worldBasisAtPosition(e,p._.Y,S.rq.get()),r=this.worldBasisAtPosition(e,p._.Z,S.rq.get());return(0,o.hZ)(t,n[0],n[1],n[2],0,i[0],i[1],i[2],0,r[0],r[1],r[2],0,0,0,0,1),t}headingAtPosition(e,t){const n=this.worldUpAtPosition(e,S.rq.get()),r=this.worldBasisAtPosition(e,p._.Y,S.rq.get()),o=(0,w.EJ)(t,r,n);return(0,i.KJ)(o)}intersectManifoldClosestSilhouette(e,t,n){return b(this._coordinateSystem,t,this._tmpCoordinateSystem),function(e,t,n){e.operations.intersectRayClosestSilhouette(e.value,t,n)}(this._tmpCoordinateSystem,e,n),n}intersectManifold(e,t,n){b(this._coordinateSystem,t,this._tmpCoordinateSystem);const i=S.rq.get();return function(e,t,n){return e.operations.intersectRay(e.value,t,n)}(this._tmpCoordinateSystem,e,i)?(0,s.c)(n,i):null}intersectInfiniteManifold(e,t,n){if(this.viewingMode===A.RT.Global)return this.intersectManifold(e,t,n);b(this._coordinateSystem,t,this._tmpCoordinateSystem);const i=this._tmpCoordinateSystem.value,r=S.rq.get();return(0,x.Ui)(i.plane,e,r)?(0,s.c)(n,r):null}toRenderCoords(e,t,n){return(0,E.v)(e)?(0,c.g)(e,t,this.spatialReference):(0,h.F)(e,t,n,this.spatialReference)}fromRenderCoords(e,t,n=null){return(0,E.v)(t)?(null!=n&&(t.spatialReference=n),(0,u.E)(e,this.spatialReference,t)?t:null):(0,h.F)(e,this.spatialReference,t,n)?t:null}static create(e,t){switch(e){case A.RT.Local:return new M(A.RT.Local,t,(0,r.GA)(t),_(g.b,(0,g.f)([0,0,0],[v,0,0],[0,v,0])));case A.RT.Global:return new M(A.RT.Global,t,1,function(e){return _(m.s,(0,m.f)(0,0,0,(0,a.tO)(e).radius))}(t))}}static renderUnitScaleFactor(e,t){return(0,r.KX)(e)/(0,r.KX)(t)}}},65856:function(e,t,n){"use strict";n.d(t,{BP:function(){return l},l5:function(){return c},q3:function(){return a}});var i=n(92754),r=n(28404),o=n(90553);class s{constructor(e,t){this.layout=e,this.buffer="number"==typeof t?new ArrayBuffer(t*e.stride):t;for(const t of e.fields.keys()){const n=e.fields.get(t);this[t]=new n.constructor(this.buffer,n.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(e,t){const n=this[e];return n&&n.elementCount===t.ElementCount&&n.elementType===t.ElementType?n:null}slice(e,t){return new s(this.layout,this.buffer.slice(e*this.stride,t*this.stride))}copyFrom(e,t=0,n=0,i=e.count){const r=this.stride;if(r%4==0){const o=new Uint32Array(e.buffer,t*r,i*r/4);new Uint32Array(this.buffer,n*r,i*r/4).set(o)}else{const o=new Uint8Array(e.buffer,t*r,i*r);new Uint8Array(this.buffer,n*r,i*r).set(o)}return this}get usedMemory(){return this.byteLength}dispose(){}}class a{constructor(e){this._stride=0,this._lastAligned=0,this._fields=new Map,e&&(this._stride=e.stride,e.fields.forEach((e=>this._fields.set(e[0],{...e[1],constructor:d(e[1].constructor)}))))}freeze(){return this}vec2f(e,t){return this._appendField(e,i.gH,t),this}vec2f64(e,t){return this._appendField(e,i.si,t),this}vec3f(e,t){return this._appendField(e,i.xs,t),this}vec3f64(e,t){return this._appendField(e,i.Xm,t),this}vec4f(e,t){return this._appendField(e,i.Eq,t),this}vec4f64(e,t){return this._appendField(e,i.Aj,t),this}mat3f(e,t){return this._appendField(e,i.jZ,t),this}mat3f64(e,t){return this._appendField(e,i.j0,t),this}mat4f(e,t){return this._appendField(e,i.Sx,t),this}mat4f64(e,t){return this._appendField(e,i.E$,t),this}vec4u8(e,t){return this._appendField(e,i.XP,t),this}f32(e,t){return this._appendField(e,i.Y$,t),this}f64(e,t){return this._appendField(e,i.qB,t),this}u8(e,t){return this._appendField(e,i.SL,t),this}u16(e,t){return this._appendField(e,i.h,t),this}i8(e,t){return this._appendField(e,i.bf,t),this}vec2i8(e,t){return this._appendField(e,i.D6,t),this}vec2i16(e,t){return this._appendField(e,i.mJ,t),this}vec2u8(e,t){return this._appendField(e,i.LC,t),this}vec4u16(e,t){return this._appendField(e,i.Uz,t),this}u32(e,t){return this._appendField(e,i.P,t),this}_appendField(e,t,n){if(this._fields.has(e))return void(0,o.vA)(!1,`${e} already added to vertex buffer layout`);const i=t.ElementCount*(0,r.GJ)(t.ElementType),s=this._stride;this._stride+=i,this._fields.set(e,{size:i,constructor:t,offset:s,optional:n})}createBuffer(e){return new s(this,e)}createView(e){return new s(this,e)}clone(){const e=new a;return e._stride=this._stride,e._fields=new Map,this._fields.forEach(((t,n)=>e._fields.set(n,t))),e.BufferType=this.BufferType,e}get stride(){if(this._lastAligned!==this._fields.size){let e=1;this._fields.forEach((t=>e=Math.max(e,(0,r.GJ)(t.constructor.ElementType)))),this._stride=Math.floor((this._stride+e-1)/e)*e,this._lastAligned=this._fields.size}return this._stride}get fields(){return this._fields}}function l(){return new a}class c{constructor(e){this.fields=new Array,e.fields.forEach(((e,t)=>{const n={...e,constructor:h(e.constructor)};this.fields.push([t,n])})),this.stride=e.stride}}const u=[i.Y$,i.gH,i.xs,i.Eq,i.jZ,i.Sx,i.qB,i.si,i.Xm,i.Aj,i.j0,i.E$,i.SL,i.LC,i.eI,i.XP,i.h,i.Yi,i.nS,i.Uz,i.P,i.An,i.H$,i.ml,i.bf,i.D6,i.m8,i.TX,i.Qt,i.mJ,i.Vp,i.E7,i.My,i.UL,i.zD,i.Y4];function h(e){return`${e.ElementType}_${e.ElementCount}`}function d(e){return p.get(e)}const p=new Map;u.forEach((e=>p.set(h(e),e)))},69550:function(e,t,n){"use strict";n.d(t,{U:function(){return o}});var i=n(85456),r=n(3817);function o(e,t=0){const n=e.stride;return Array.from(e.fields.keys()).map((i=>{const o=e.fields.get(i),a=o.constructor.ElementCount,l=s(o.constructor.ElementType),c=o.offset,u=o.optional?.glNormalized??!1;return new r._(i,a,l,c,n,u,t)}))}function s(e){const t=a[e];if(t)return t;throw new Error("BufferType not supported in WebGL")}const a={u8:i.pe.UNSIGNED_BYTE,u16:i.pe.UNSIGNED_SHORT,u32:i.pe.UNSIGNED_INT,i8:i.pe.BYTE,i16:i.pe.SHORT,i32:i.pe.INT,f32:i.pe.FLOAT}},70974:function(e,t,n){"use strict";n.d(t,{b:function(){return l}});var i=n(53804),r=n(83525),o=n(23502),s=(n(58941),n(40633),n(13798),n(65953));let a=class extends r.A{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};(0,i._)([(0,o.MZ)()],a.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),(0,i._)([(0,o.MZ)()],a.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),(0,i._)([(0,o.MZ)()],a.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),(0,i._)([(0,o.MZ)()],a.prototype,"DECONFLICTOR_SHOW_GRID",void 0),(0,i._)([(0,o.MZ)()],a.prototype,"LABELS_SHOW_BORDER",void 0),(0,i._)([(0,o.MZ)()],a.prototype,"TEXT_SHOW_BASELINE",void 0),(0,i._)([(0,o.MZ)()],a.prototype,"TEXT_SHOW_BORDER",void 0),(0,i._)([(0,o.MZ)()],a.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),(0,i._)([(0,o.MZ)()],a.prototype,"OVERLAY_SHOW_CENTER",void 0),(0,i._)([(0,o.MZ)()],a.prototype,"SHOW_POI",void 0),(0,i._)([(0,o.MZ)()],a.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),(0,i._)([(0,o.MZ)()],a.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),(0,i._)([(0,o.MZ)()],a.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),(0,i._)([(0,o.MZ)()],a.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),(0,i._)([(0,o.MZ)()],a.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),(0,i._)([(0,o.MZ)()],a.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),(0,i._)([(0,o.MZ)()],a.prototype,"I3S_TREE_SHOW_TILES",void 0),(0,i._)([(0,o.MZ)()],a.prototype,"I3S_SHOW_MODIFICATIONS",void 0),(0,i._)([(0,o.MZ)()],a.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),(0,i._)([(0,o.MZ)()],a.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),(0,i._)([(0,o.MZ)()],a.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),(0,i._)([(0,o.MZ)()],a.prototype,"LINE_WIREFRAMES",void 0),a=(0,i._)([(0,s.$)("esri.views.3d.support.debugFlags")],a);const l=new a},79366:function(e,t,n){"use strict";n.d(t,{t:function(){return m},z:function(){return y}});var i=n(13786),r=n(1932),o=n(41546),s=n(61714),a=n(61441),l=n(50240),c=n(5047),u=n(37819),h=n(65420),d=n(14905),p=n(40359),f=n(89769),g=n(65839);function m(e,t,n=null){const r=[],m=t.mapPositions;!function(e,t){const{attributeData:{position:n},removeDuplicateStartEnd:i}=e,r=function(e){const t=e.length;return e[0]===e[t-3]&&e[1]===e[t-2]&&e[2]===e[t-1]}(n)&&i,o=n.length/3-(r?1:0),s=new Array(2*(o-1)),a=r?n.slice(0,-3):n;let l=0;for(let e=0;e<o-1;e++)s[l++]=e,s[l++]=e+1;t.push([g.r.POSITION,new d.n(a,s,3,r)])}(t,r);const y=r[0][1].data,b=r[0][1].indices.length,T=(0,u.EH)(b);return function(e,t,n){if(null!=e.attributeData.colorFeature)return;const i=e.attributeData.color;t.push([g.r.COLOR,new d.n(i??o.Un,n,4)])}(t,r,T),function(e,t,n){null==e.attributeData.sizeFeature&&t.push([g.r.SIZE,new d.n([e.attributeData.size??1],n,1,!0)])}(t,r,T),function(e,t,n){e.attributeData.normal&&t.push([g.r.NORMAL,new d.n(e.attributeData.normal,n,3)])}(t,r,T),function(e,t,n){null!=e.attributeData.colorFeature&&t.push([g.r.COLORFEATUREATTRIBUTE,new d.n([e.attributeData.colorFeature],n,1,!0)])}(t,r,T),function(e,t,n){null!=e.attributeData.sizeFeature&&t.push([g.r.SIZEFEATUREATTRIBUTE,new d.n([e.attributeData.sizeFeature],n,1,!0)])}(t,r,T),function(e,t,n){null!=e.attributeData.opacityFeature&&t.push([g.r.OPACITYFEATUREATTRIBUTE,new d.n([e.attributeData.opacityFeature],n,1,!0)])}(t,r,T),function(e,t,n){if(null==e.overlayInfo||e.overlayInfo.renderCoordsHelper.viewingMode!==h.RT.Global||!e.overlayInfo.spatialReference.isGeographic)return;const r=(0,l.jh)(n.length),o=(0,s.tO)(e.overlayInfo.spatialReference);for(let e=0;e<r.length;e+=3)(0,a.RC)(n,e,r,e,o);const u=n.length/3,p=(0,c.oe)(u+1);let f=_,m=v,y=0,b=0;(0,i.hZ)(f,r[b++],r[b++]),b++,p[0]=0;for(let e=1;e<u+1;++e)e===u&&(b=0),(0,i.hZ)(m,r[b++],r[b++]),b++,y+=(0,i.xg)(f,m),p[e]=y,[f,m]=[m,f];t.push([g.r.DISTANCETOSTART,new d.n(p,t[0][1].indices,1,!0)])}(t,r,y),new f.V(e,r,m,p.X.Line,n)}const _=(0,r.vt)(),v=(0,r.vt)();function y(e,t){if(null==e||0===e.length)return[];const n=[];return e.forEach((e=>{const i=e.length,r=(0,l.jh)(3*i);e.forEach(((e,t)=>{r[3*t]=e[0],r[3*t+1]=e[1],r[3*t+2]=e[2]}));const o={attributeData:{position:r,normal:t},removeDuplicateStartEnd:!1};n.push(o)})),n}},33710:function(e,t,n){"use strict";n.d(t,{Cz:function(){return r},DZ:function(){return s},PV:function(){return o},vO:function(){return i}}),n(98323),n(85456),n(12285),n(10956);const i=64,r=i/2,o=i/(r/5),s=.25},98323:function(e,t,n){"use strict";n.d(t,{CN:function(){return a},Q_:function(){return s},ny:function(){return l},sZ:function(){return c}}),n(58941);var i=n(5161),r=n(59552),o=n(85456);const s=128,a=.5;function l(e){return"cross"===e||"x"===e}function c(e,t=s,n=t*a,i=0){const l=function(e,t=s,n=t*a,i=0){switch(e){case"circle":default:return function(e,t){const n=e/2-.5;return f(e,d(n,n,t/2))}(t,n);case"square":return function(e,t){return u(e,t,!1)}(t,n);case"cross":return function(e,t,n=0){return h(e,t,!1,n)}(t,n,i);case"x":return function(e,t,n=0){return h(e,t,!0,n)}(t,n,i);case"kite":return function(e,t){return u(e,t,!0)}(t,n);case"triangle":return function(e,t){return f(e,p(e/2,t,t/2))}(t,n);case"arrow":return function(e,t){const n=t,i=t/2,r=e/2,o=.8*n,s=d(r,(e-t)/2-o,Math.sqrt(o*o+i*i)),a=p(r,n,i);return f(e,((e,t)=>Math.max(a(e,t),-s(e,t))))}(t,n)}}(e,t,n,i);return new r.g(l,{mipmap:!1,wrap:{s:o.pF.CLAMP_TO_EDGE,t:o.pF.CLAMP_TO_EDGE},width:t,height:t,components:4,noUnpackFlip:!0,reloadable:!0})}function u(e,t,n){return n&&(t/=Math.SQRT2),f(e,((i,r)=>{let o=i-.5*e+.25,s=.5*e-r-.75;if(n){const e=(o+s)/Math.SQRT2;s=(s-o)/Math.SQRT2,o=e}return Math.max(Math.abs(o),Math.abs(s))-.5*t}))}function h(e,t,n,i=0){t-=i,n&&(t*=Math.SQRT2);const r=.5*t;return f(e,((t,o)=>{let s,a=t-.5*e,l=.5*e-o-1;if(n){const e=(a+l)/Math.SQRT2;l=(l-a)/Math.SQRT2,a=e}return a=Math.abs(a),l=Math.abs(l),s=a>l?a>r?Math.sqrt((a-r)*(a-r)+l*l):l:l>r?Math.sqrt(a*a+(l-r)*(l-r)):a,s-=i/2,s}))}function d(e,t,n){return(i,r)=>{const o=i-e,s=r-t;return Math.sqrt(o*o+s*s)-n}}function p(e,t,n){const i=Math.sqrt(t*t+n*n);return(r,o)=>{const s=Math.abs(r-e)-n,a=o-e+t/2+.75,l=(t*s+n*a)/i,c=-a;return Math.max(l,c)}}function f(e,t){const n=new Uint8Array(4*e*e);for(let r=0;r<e;r++)for(let o=0;o<e;o++){const s=o+e*r;let a=t(o,r);a=a/e+.5,(0,i.U)(a,n,4*s)}return n}},89765:function(e,t,n){"use strict";n.d(t,{ab:function(){return be},gm:function(){return Ce}});var i=n(44705),r=n(87725),o=n(39714),s=n(32237),a=n(61769),l=n(20551),c=n(32501),u=n(33400),h=n(41546),d=n(61714),p=n(96611),f=n(7456),g=n(57617),m=n(61441),_=n(5596),v=n(57652),y=n(50973),b=n(65420),T=n(1932),x=n(14905);const w=1e-6,S=(0,c.vt)(),E=(0,c.vt)();function A(e,t,n,i,r,o,s,a,l,c){return function(e,t,n){let i=ve(e.maxVert[0],e.minVert[0]),r=0;for(let t=1;t<7;++t){const n=ve(e.maxVert[t],e.minVert[t]);n>i&&(i=n,r=t)}fe(t,e.minVert[r]),fe(n,e.maxVert[r])}(e,i,r),ve(i,r)<w?1:(de(s,i,r),me(s,s),function(e,t,n,i){const{data:r,size:o}=e;let s=Number.NEGATIVE_INFINITY,a=0;for(let e=0;e<r.length;e+=o){F[0]=r[e]-t[0],F[1]=r[e+1]-t[1],F[2]=r[e+2]-t[2];const i=n[0]*F[0]+n[1]*F[1]+n[2]*F[2],o=n[0]*n[0]+n[1]*n[1]+n[2]*n[2],l=F[0]*F[0]+F[1]*F[1]+F[2]*F[2]-i*i/o;l>s&&(s=l,a=e)}return fe(i,r,a),s}(t,i,s,o)<w?2:(de(a,r,o),me(a,a),de(l,o,i),me(l,l),ge(n,a,s),me(n,n),$(t,n,s,a,l,c),0))}const M=(0,c.vt)(),O=(0,c.vt)(),R=(0,c.vt)(),C=(0,c.vt)(),I=(0,c.vt)(),P=(0,c.vt)(),D=(0,c.vt)(),L=(0,c.vt)();function N(e,t,n,i,r,o,s,a,l){(function(e,t,n,i,r){!function(e,t,n,i,r){const{data:o,size:s}=e;fe(i,o),fe(r,i),n[0]=ye(j,t),n[1]=n[0];for(let e=s;e<o.length;e+=s){const s=o[e]*t[0]+o[e+1]*t[1]+o[e+2]*t[2];s<n[0]&&(n[0]=s,fe(i,o,e)),s>n[1]&&(n[1]=s,fe(r,o,e))}}(e,t,z,r,i);const o=ye(n,t);z[1]-w<=o&&(i[0]=void 0),z[0]+w>=o&&(r[0]=void 0)})(e,t,n,M,O),void 0!==M[0]&&(de(R,M,n),me(R,R),de(C,M,i),me(C,C),de(I,M,r),me(I,I),ge(P,C,o),me(P,P),ge(D,I,s),me(D,D),ge(L,R,a),me(L,L),$(e,P,o,C,R,l),$(e,D,s,I,C,l),$(e,L,a,R,I,l)),void 0!==O[0]&&(de(R,O,n),me(R,R),de(C,O,i),me(C,C),de(I,O,r),me(I,I),ge(P,C,o),me(P,P),ge(D,I,s),me(D,D),ge(L,R,a),me(L,L),$(e,P,o,C,R,l),$(e,D,s,I,C,l),$(e,L,a,R,I,l))}const F=[0,0,0],z=(0,T.vt)(),H=(0,c.vt)(),V=(0,c.vt)(),U=(0,c.vt)(),k=(0,c.vt)(),B=(0,c.vt)(),G=(0,c.vt)();function $(e,t,n,i,r,o){if(_e(t)<w)return;ge(H,n,t),ge(V,i,t),ge(U,r,t),Z(e,t,z),B[1]=z[0],k[1]=z[1],G[1]=k[1]-B[1];const s=[n,i,r],a=[H,V,U];for(let n=0;n<3;++n){Z(e,s[n],z),B[0]=z[0],k[0]=z[1],Z(e,a[n],z),B[2]=z[0],k[2]=z[1],G[0]=k[0]-B[0],G[2]=k[2]-B[2];const i=ue(G);i<o.quality&&(fe(o.b0,s[n]),fe(o.b1,t),fe(o.b2,a[n]),o.quality=i)}}const j=(0,c.vt)();function Z(e,t,n){const{data:i,size:r}=e;n[0]=Number.POSITIVE_INFINITY,n[1]=Number.NEGATIVE_INFINITY;for(let e=0;e<i.length;e+=r){const r=i[e]*t[0]+i[e+1]*t[1]+i[e+2]*t[2];n[0]=Math.min(n[0],r),n[1]=Math.max(n[1],r)}}function W(e,t,n){n.center=e,n.halfSize=(0,l.h)(t,t,.5),n.quaternion=a.zK}const q=(0,c.vt)(),Y=(0,c.vt)(),X=(0,c.vt)(),Q=(0,c.vt)(),K=(0,c.vt)(),J=(0,c.vt)();function ee(e,t,n){fe(q,t),Math.abs(t[0])>Math.abs(t[1])&&Math.abs(t[0])>Math.abs(t[2])?q[0]=0:Math.abs(t[1])>Math.abs(t[2])?q[1]=0:q[2]=0,_e(q)<w&&(q[0]=q[1]=q[2]=1),ge(Y,t,q),me(Y,Y),ge(X,t,Y),me(X,X),te(e,t,Y,X,Q,K),de(J,K,Q),ae(t,Y,X,Q,K,J,n)}function te(e,t,n,i,r,o){Z(e,t,z),r[0]=z[0],o[0]=z[1],Z(e,n,z),r[1]=z[0],o[1]=z[1],Z(e,i,z),r[2]=z[0],o[2]=z[1]}const ne=(0,c.vt)(),ie=(0,c.vt)(),re=(0,c.vt)(),oe=(0,r.fA)(1,0,0,0,1,0,0,0,1),se=(0,a.vt)();function ae(e,t,n,i,r,o,s){oe[0]=e[0],oe[1]=e[1],oe[2]=e[2],oe[3]=t[0],oe[4]=t[1],oe[5]=t[2],oe[6]=n[0],oe[7]=n[1],oe[8]=n[2],s.quaternion=function(e,t){const n=t[0]+t[4]+t[8];if(n>0){let i=Math.sqrt(n+1);e[3]=.5*i,i=.5/i,e[0]=(t[5]-t[7])*i,e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i}else{let n=0;t[4]>t[0]&&(n=1),t[8]>t[3*n+n]&&(n=2);const i=(n+1)%3,r=(n+2)%3;let o=Math.sqrt(t[3*n+n]-t[3*i+i]-t[3*r+r]+1);e[n]=.5*o,o=.5/o,e[3]=(t[3*i+r]-t[3*r+i])*o,e[i]=(t[3*i+n]+t[3*n+i])*o,e[r]=(t[3*r+n]+t[3*n+r])*o}return e}(se,oe),he(ne,i,r),pe(ne,ne,.5),pe(ie,e,ne[0]),pe(re,t,ne[1]),he(ie,ie,re),pe(re,n,ne[2]),s.center=(0,l.g)(ie,ie,re),s.halfSize=(0,l.h)(ne,o,.5)}class le{constructor(e){this.minVert=new Array(7),this.maxVert=new Array(7),this.buffer=new ArrayBuffer(448);let t=0;this.minProj=new Float64Array(this.buffer,t,7),t+=56,this.maxProj=new Float64Array(this.buffer,t,7),t+=56;for(let e=0;e<7;++e)this.minVert[e]=new Float64Array(this.buffer,t,3),t+=24;for(let e=0;e<7;++e)this.maxVert[e]=new Float64Array(this.buffer,t,3),t+=24;for(let e=0;e<7;++e)this.minProj[e]=Number.POSITIVE_INFINITY,this.maxProj[e]=Number.NEGATIVE_INFINITY;const n=new Array(7),i=new Array(7),{data:r,size:o}=e;for(let e=0;e<r.length;e+=o){let t=r[e];t<this.minProj[0]&&(this.minProj[0]=t,n[0]=e),t>this.maxProj[0]&&(this.maxProj[0]=t,i[0]=e),t=r[e+1],t<this.minProj[1]&&(this.minProj[1]=t,n[1]=e),t>this.maxProj[1]&&(this.maxProj[1]=t,i[1]=e),t=r[e+2],t<this.minProj[2]&&(this.minProj[2]=t,n[2]=e),t>this.maxProj[2]&&(this.maxProj[2]=t,i[2]=e),t=r[e]+r[e+1]+r[e+2],t<this.minProj[3]&&(this.minProj[3]=t,n[3]=e),t>this.maxProj[3]&&(this.maxProj[3]=t,i[3]=e),t=r[e]+r[e+1]-r[e+2],t<this.minProj[4]&&(this.minProj[4]=t,n[4]=e),t>this.maxProj[4]&&(this.maxProj[4]=t,i[4]=e),t=r[e]-r[e+1]+r[e+2],t<this.minProj[5]&&(this.minProj[5]=t,n[5]=e),t>this.maxProj[5]&&(this.maxProj[5]=t,i[5]=e),t=r[e]-r[e+1]-r[e+2],t<this.minProj[6]&&(this.minProj[6]=t,n[6]=e),t>this.maxProj[6]&&(this.maxProj[6]=t,i[6]=e)}for(let e=0;e<7;++e){let t=n[e];fe(this.minVert[e],r,t),t=i[e],fe(this.maxVert[e],r,t)}}}class ce{constructor(){this.b0=(0,c.fA)(1,0,0),this.b1=(0,c.fA)(0,1,0),this.b2=(0,c.fA)(0,0,1),this.quality=0}}function ue(e){return e[0]*e[1]+e[0]*e[2]+e[1]*e[2]}function he(e,t,n){e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2]}function de(e,t,n){e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2]}function pe(e,t,n){e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n}function fe(e,t,n=0){e[0]=t[n],e[1]=t[n+1],e[2]=t[n+2]}function ge(e,t,n){const i=t[0],r=t[1],o=t[2],s=n[0],a=n[1],l=n[2];e[0]=r*l-o*a,e[1]=o*s-i*l,e[2]=i*a-r*s}function me(e,t){const n=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(n>0){const i=1/Math.sqrt(n);e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i}}function _e(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]}function ve(e,t){const n=t[0]-e[0],i=t[1]-e[1],r=t[2]-e[2];return n*n+i*i+r*r}function ye(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}class be{constructor(e=c.uY,t=$e,n=a.zK){this._data=[e[0],e[1],e[2],t[0],t[1],t[2],n[0],n[1],n[2],n[3]]}clone(){const e=new be;return e._data=this._data.slice(),e}invalidate(){this._data[3]=-1}get isValid(){return this._data[3]>=0}static fromData(e){const t=new be;return t._data=e.slice(),t}static fromJSON(e){return new be(e.center,e.halfSize,e.quaternion)}copy(e){this._data=e.data.slice()}get center(){return(0,l.i)(y.rq.get(),this._data[0],this._data[1],this._data[2])}get centerX(){return this._data[0]}get centerY(){return this._data[1]}get centerZ(){return this._data[2]}getCenter(e){return e[0]=this._data[0],e[1]=this._data[1],e[2]=this._data[2],e}set center(e){this._data[0]=e[0],this._data[1]=e[1],this._data[2]=e[2]}setCenter(e,t,n){this._data[0]=e,this._data[1]=t,this._data[2]=n}get halfSize(){return(0,l.i)(y.rq.get(),this._data[3],this._data[4],this._data[5])}get halfSizeX(){return this._data[3]}get halfSizeY(){return this._data[4]}get halfSizeZ(){return this._data[5]}getHalfSize(e){return e[0]=this._data[3],e[1]=this._data[4],e[2]=this._data[5],e}set halfSize(e){this._data[3]=e[0],this._data[4]=e[1],this._data[5]=e[2]}get quaternion(){return(0,s.hZ)(y.J8.get(),this._data[6],this._data[7],this._data[8],this._data[9])}getQuaternion(e){return e[0]=this._data[6],e[1]=this._data[7],e[2]=this._data[8],e[3]=this._data[9],e}set quaternion(e){this._data[6]=e[0],this._data[7]=e[1],this._data[8]=e[2],this._data[9]=e[3]}get data(){return this._data}getCorners(e){const t=Te,n=this._data;t[0]=n[6],t[1]=n[7],t[2]=n[8],t[3]=n[9];for(let i=0;i<8;++i){const r=e[i];r[0]=(1&i?-1:1)*n[3],r[1]=(2&i?-1:1)*n[4],r[2]=(4&i?-1:1)*n[5],(0,l.w)(r,r,t),r[0]+=n[0],r[1]+=n[1],r[2]+=n[2]}}doesIntersectFrustumConservativeApproximation(e){return this.intersectPlane(e[0])<=0&&this.intersectPlane(e[1])<=0&&this.intersectPlane(e[2])<=0&&this.intersectPlane(e[3])<=0&&this.intersectPlane(e[4])<=0&&this.intersectPlane(e[5])<=0}get radius(){const e=this._data[3],t=this._data[4],n=this._data[5];return Math.sqrt(e*e+t*t+n*n)}intersectSphere(e){Se[0]=this._data[0]-e[0],Se[1]=this._data[1]-e[1],Se[2]=this._data[2]-e[2];const t=this.getQuaternion(xe);return(0,s.Xr)(Te,t),(0,l.w)(Se,Se,Te),(0,l.x)(Se,Se),Ee[0]=Math.min(Se[0],this._data[3]),Ee[1]=Math.min(Se[1],this._data[4]),Ee[2]=Math.min(Se[2],this._data[5]),(0,l.y)(Ee,Se)<e[3]*e[3]}intersectSphereWithMBS(e,t=this.radius){const n=this._data;Se[0]=n[0]-e[0],Se[1]=n[1]-e[1],Se[2]=n[2]-e[2];const i=e[3],r=i+t;return!((0,l.z)(Se)>r*r)&&(Te[0]=-n[6],Te[1]=-n[7],Te[2]=-n[8],Te[3]=n[9],(0,l.w)(Se,Se,Te),(0,l.x)(Se,Se),Ee[0]=Math.min(Se[0],n[3]),Ee[1]=Math.min(Se[1],n[4]),Ee[2]=Math.min(Se[2],n[5]),(0,l.y)(Ee,Se)<i*i)}intersectPlane(e){const t=e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3],n=this.projectedRadius((0,_.Qj)(e));return t>n?1:t<-n?-1:0}intersectRay(e,t,n=0){const i=this._data,r=Te;r[0]=-i[6],r[1]=-i[7],r[2]=-i[8],r[3]=i[9],Se[0]=e[0]-i[0],Se[1]=e[1]-i[1],Se[2]=e[2]-i[2];const o=(0,l.w)(Se,Se,Te),s=(0,l.w)(Ee,t,Te);let a=-1/0,c=1/0;const u=this.getHalfSize(ze);for(let e=0;e<3;e++){const t=o[e],i=s[e],r=u[e]+n;if(Math.abs(i)>1e-6){const e=(r-t)/i,n=(-r-t)/i;a=Math.max(a,Math.min(e,n)),c=Math.min(c,Math.max(e,n))}else if(t>r||t<-r)return!1}return a<=c}projectedArea(e,t,n,r){const o=this.getQuaternion(xe);(0,s.Xr)(Te,o),Se[0]=e[0]-this._data[0],Se[1]=e[1]-this._data[1],Se[2]=e[2]-this._data[2],(0,l.w)(Se,Se,Te);const a=this.getHalfSize(ze),c=Se[0]<-a[0]?-1:Se[0]>a[0]?1:0,h=Se[1]<-a[1]?-1:Se[1]>a[1]?1:0,d=Se[2]<-a[2]?-1:Se[2]>a[2]?1:0,p=Math.abs(c)+Math.abs(h)+Math.abs(d);if(0===p)return 1/0;const f=1===p?4:6,g=6*(c+3*h+9*d+13);(0,i.I0)(He,o),(0,i.hs)(He,He,a);const m=this.getCenter(Ne);for(let e=0;e<f;e++){const n=Re[g+e];(0,l.i)(Se,((1&n)<<1)-1,(2&n)-1,((4&n)>>1)-1),(0,l.q)(Se,Se,He),(0,l.g)(Ae,m,Se),Ae[3]=1,(0,u.t)(Ae,Ae,t);const i=1/Math.max(1e-6,Ae[3]);Oe[2*e]=Ae[0]*i,Oe[2*e+1]=Ae[1]*i}const _=2*f-2;let v=Oe[0]*(Oe[3]-Oe[_+1])+Oe[_]*(Oe[1]-Oe[_-1]);for(let e=2;e<_;e+=2)v+=Oe[e]*(Oe[e+3]-Oe[e-1]);return Math.abs(v)*n*r*.125}projectedRadius(e){const t=this.getQuaternion(xe);return(0,s.Xr)(Te,t),(0,l.w)(Se,e,Te),Math.abs(Se[0]*this._data[3])+Math.abs(Se[1]*this._data[4])+Math.abs(Se[2]*this._data[5])}minimumDistancePlane(e){return e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3]-this.projectedRadius((0,_.Qj)(e))}maximumDistancePlane(e){return e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3]+this.projectedRadius((0,_.Qj)(e))}toAaBoundingBox(e){const t=this.getQuaternion(xe),n=(0,i.I0)(He,t),r=this._data[3]*Math.abs(n[0])+this._data[4]*Math.abs(n[3])+this._data[5]*Math.abs(n[6]),o=this._data[3]*Math.abs(n[1])+this._data[4]*Math.abs(n[4])+this._data[5]*Math.abs(n[7]),s=this._data[3]*Math.abs(n[2])+this._data[4]*Math.abs(n[5])+this._data[5]*Math.abs(n[8]);e[0]=this._data[0]-r,e[1]=this._data[1]-o,e[2]=this._data[2]-s,e[3]=this._data[0]+r,e[4]=this._data[1]+o,e[5]=this._data[2]+s}transform(e,t,n,i=0,r=(0,p.lO)(n),o=(0,p.lO)(t),a=(0,m.jd)(t,o)){if(n===r)t.isGeographic?function(e,t,n,i,r=(0,p.lO)(n)){const o=(0,d.tO)(n),a=1+Math.max(0,i)/(o.radius+e.centerZ);e.getCenter(Le),Le[2]+=i,(0,g.projectBuffer)(Le,n,0,Le,r,0),t.center=Le;const c=e.getQuaternion(xe);t.quaternion=c,(0,s.Xr)(Te,c),(0,l.i)(ke,0,0,1),(0,l.w)(ke,ke,Te);const u=e.getHalfSize(ze);(0,l.i)(ke,u[0]*Math.abs(ke[0]),u[1]*Math.abs(ke[1]),u[2]*Math.abs(ke[2])),(0,l.h)(ke,ke,o.inverseFlattening),(0,l.g)(ke,u,ke),t.halfSize=(0,l.h)(ke,ke,a)}(this,e,t,i,o):function(e,t,n,i,r=(0,p.lO)(n),o=(0,m.jd)(n,r)){e.getCorners(Ue),e.getCenter(Le),Le[2]+=i,(0,f.l)(n,Le,Ve,r),t.setCenter(Ve[12],Ve[13],Ve[14]);const a=2*Math.sqrt(1+Ve[0]+Ve[5]+Ve[10]);Te[0]=(Ve[6]-Ve[9])/a,Te[1]=(Ve[8]-Ve[2])/a,Te[2]=(Ve[1]-Ve[4])/a,Te[3]=.25*a;const c=e.getQuaternion(xe);t.quaternion=(0,s.lw)(Te,Te,c),(0,s.Xr)(Te,Te),(0,l.i)(Be,0,0,0);const u=t.getCenter(Fe);for(const e of Ue)e[2]+=i,o(e,0,e,0),(0,l.a)(ke,e,u),(0,l.w)(ke,ke,Te),(0,l.x)(ke,ke),(0,l.D)(Be,Be,ke);t.halfSize=Be}(this,e,t,i,o,a);else if(t.isWGS84&&(n.isWebMercator||(0,v.r1)(n)))!function(e,t,n,i,r){t.getCenter(Ne),Ne[2]+=r;const o=(0,p.lO)(n);(0,g.projectBuffer)(Ne,e,0,Ne,o,0),Ie(o,t,Ne,n,i)}(t,this,n,e,i);else if(t.isWebMercator&&(0,v.r1)(n))!function(e,t,n,i,r){t.getCenter(Ne),Ne[2]+=r,Ie(e,t,Ne,n,i)}(t,this,n,e,i);else{const r=this.getCenter(Ne);r[2]+=i,(0,g.projectBuffer)(r,t,0,r,n,0),e.center=r,this!==e&&(e.quaternion=this.getQuaternion(xe),e.halfSize=this.getHalfSize(ze))}}}const Te=(0,a.vt)(),xe=(0,a.vt)(),we=(0,a.vt)(),Se=(0,c.vt)(),Ee=(0,c.vt)(),Ae=(0,h.vt)();function Me(e,t=new be){return function(e,t){const{data:n,size:i}=e,r=n.length/i;if(r<=0)return;const o=new le(e);he(S,o.minProj,o.maxProj),pe(S,S,.5),de(E,o.maxProj,o.minProj);const s=ue(E),a=new ce;a.quality=s,r<14&&(e=new x.K(new Float64Array(o.buffer,112,42),3));const l=(0,c.vt)(),u=(0,c.vt)(),h=(0,c.vt)(),d=(0,c.vt)(),p=(0,c.vt)(),f=(0,c.vt)(),g=(0,c.vt)();switch(A(o,e,g,l,u,h,d,p,f,a)){case 1:return void W(S,E,t);case 2:return void ee(e,d,t)}N(e,g,l,u,h,d,p,f,a),te(e,a.b0,a.b1,a.b2,Q,K);const m=(0,c.vt)();de(m,K,Q),a.quality=ue(m),a.quality<s?ae(a.b0,a.b1,a.b2,Q,K,m,t):W(S,E,t)}(e,t),t}const Oe=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2],Re=(()=>{const e=new Int8Array(162);let t=0;const n=n=>{for(let i=0;i<n.length;i++)e[t+i]=n[i];t+=6};return n([6,2,3,1,5,4]),n([0,2,3,1,5,4]),n([0,2,3,7,5,4]),n([0,1,3,2,6,4]),n([0,1,3,2,0,0]),n([0,1,5,7,3,2]),n([0,1,3,7,6,4]),n([0,1,3,7,6,2]),n([0,1,5,7,6,2]),n([0,1,5,4,6,2]),n([0,1,5,4,0,0]),n([0,1,3,7,5,4]),n([0,2,6,4,0,0]),n([0,0,0,0,0,0]),n([1,3,7,5,0,0]),n([2,3,7,6,4,0]),n([2,3,7,6,0,0]),n([2,3,1,5,7,6]),n([0,1,5,7,6,2]),n([0,1,5,7,6,4]),n([0,1,3,7,6,4]),n([4,5,7,6,2,0]),n([4,5,7,6,0,0]),n([4,5,1,3,7,6]),n([0,2,3,7,5,4]),n([6,2,3,7,5,4]),n([6,2,3,1,5,4]),e})();function Ce(e,t,n,i,r){const o=e.getQuaternion(xe);r.quaternion=o,(0,s.Xr)(Te,o);const a=e.getCenter(Ne),u=e.getHalfSize(ze);if(i===b.RT.Global){(0,l.w)(ke,a,Te),(0,l.x)(Be,ke),(0,l.A)(Ge,Be,u),(0,l.a)(Ge,Be,Ge);const i=(0,l.l)(Ge);(0,l.g)(Ge,Be,u);const o=(0,l.l)(Ge);if(i<n)r.center=a,(0,l.i)(ke,n,n,n),r.halfSize=(0,l.g)(ke,u,ke);else{const s=o>0?1+t/o:1,a=i>0?1+n/i:1,c=(a+s)/2,h=(a-s)/2;(0,l.h)(Ge,Be,h),r.halfSize=(0,l.b)(Ge,Ge,u,c),(0,l.h)(Ge,Be,c),(0,l.b)(Ge,Ge,u,h),(0,l.B)(ke,ke),(0,l.C)(ke,Ge,ke);const d=e.getQuaternion(we);r.center=(0,l.w)(ke,ke,d)}}else{r.center=(0,l.b)(ke,a,c.Cb,(n+t)/2);const e=(0,l.w)(ke,c.Cb,Te);(0,l.x)(e,e),r.halfSize=(0,l.b)(Be,u,e,(n-t)/2)}return r}function Ie(e,t,n,r,o){const s=t.getQuaternion(xe),a=(0,i.I0)(He,s),l=t.getHalfSize(ze);for(let e=0;e<8;++e){for(let t=0;t<3;++t)Le[t]=l[t]*(e&1<<t?-1:1);for(let t=0;t<3;++t){let i=n[t];for(let e=0;e<3;++e)i+=Le[e]*a[3*e+t];Pe[3*e+t]=i}}(0,g.projectBuffer)(Pe,e,0,Pe,r,0,8),Me(De,o)}const Pe=new Array(24),De=new x.K(Pe,3),Le=(0,c.vt)(),Ne=(0,c.vt)(),Fe=(0,c.vt)(),ze=(0,c.vt)(),He=(0,r.vt)(),Ve=(0,o.vt)(),Ue=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],ke=(0,c.vt)(),Be=(0,c.vt)(),Ge=(0,c.vt)(),$e=(0,c.CN)(-1,-1,-1)},29800:function(e,t,n){"use strict";n.d(t,{A:function(){return c},C:function(){return l}});var i=n(57617),r=n(50240),o=n(82588),s=n(49618),a=n(58704);function l(e,t,n,i){const a="polygon"===e.type?o.Wq.CCW_IS_HOLE:o.Wq.NONE,l="polygon"===e.type?e.rings:e.paths,{position:c,outlines:h}=(0,o.oR)(l,!!e.hasZ,a,e.spatialReference),d=(0,r.jh)(c.length),p=(0,s.au)(c,e.spatialReference,0,d,0,c,0,c.length/3,t,n,i),f=null!=p;return{lines:f?u(h,c,d):[],projectionSuccess:f,sampledElevation:p}}function c(e,t){const n="polygon"===e.type?o.Wq.CCW_IS_HOLE:o.Wq.NONE,r="polygon"===e.type?e.rings:e.paths,{position:s,outlines:l}=(0,o.oR)(r,!1,n),c=(0,i.projectBuffer)(s,e.spatialReference,0,s,t,0);for(let e=2;e<s.length;e+=3)s[e]=a.bi;return{lines:c?u(l,s):[],projectionSuccess:c}}function u(e,t,n=null){const i=new Array;for(const{index:o,count:s}of e){if(s<=1)continue;const e=3*o,a=3*s;i.push({position:(0,r.l5)(t,3*o,3*s),mapPositions:null!=n?(0,r.l5)(n,e,a):void 0})}return i}},89756:function(e,t,n){"use strict";n.d(t,{MQ:function(){return r}}),n(38177);var i=n(50456);n(59356);class r extends i.R6{constructor(e,t,n){super(e,t),this.triangleNr=n}}},58704:function(e,t,n){"use strict";n.d(t,{bi:function(){return Xt}});var i,r,o=n(53804),s=n(48996),a=n(58941),l=n(25738),c=n(95929),u=n(7187),h=n(28181),d=n(17660),p=n(23502),f=n(40633),g=(n(13798),n(65953)),m=n(73364),_=n(20551),v=n(32501),y=n(46949),b=n(70974),T=n(86398),x=n(87416),w=n(79068);class S{constructor(){this._extent=(0,x.vt)(),this.resolution=0,this.renderLocalOrigin=(0,w.f)(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new E}get extent(){return this._extent}setupGeometryViewsCyclical(e){this.setupGeometryView();const t=.001*e.range;if(this._extent[0]-t<=e.min){const t=this.canvasGeometries.extents[this.canvasGeometries.numViews++];(0,x.cY)(this._extent,e.range,0,t)}if(this._extent[2]+t>=e.max){const t=this.canvasGeometries.extents[this.canvasGeometries.numViews++];(0,x.cY)(this._extent,-e.range,0,t)}}setupGeometryView(){this.canvasGeometries.numViews=1,(0,x.C)(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const t=this.canvasGeometries.extents[e];if(t[0]!==t[2]&&t[1]!==t[3])return!0}return!1}}class E{constructor(){this.extents=[(0,x.vt)(),(0,x.vt)(),(0,x.vt)()],this.numViews=0}}(r=i||(i={}))[r.Color=0]="Color",r[r.ColorNoRasterImage=1]="ColorNoRasterImage",r[r.Highlight=2]="Highlight",r[r.WaterNormal=3]="WaterNormal",r[r.Occluded=4]="Occluded",r[r.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor";class A{constructor(e,t,n){this._fbos=e,this._format=t,this._name=n}get valid(){return null!=this._handle?.getTexture()}dispose(){this._handle=(0,c.Gz)(this._handle)}get texture(){return this._handle?.getTexture()}bind(e,t,n){this._handle&&this._handle.fbo?.width===t&&this._handle.fbo?.height===n||(this._handle?.release(),this._handle=this._fbos.acquire(t,n,this._name,this._format)),e.bindFramebuffer(this._handle?.fbo)}generateMipMap(){this._handle?.getTexture()?.descriptor?.hasMipmap&&this._handle?.getTexture()?.generateMipmap()}}var M=n(98680),O=n(27264),R=n(39534);class C{constructor(e,t,n,i,r=M.N.RGBA_MIPMAP){this.output=n,this.content=i,this.fbo=new A(e,r,t)}get valid(){return this.fbo.valid}}class I{constructor(e){this.targets=[new C(e,"overlay color",O.V.Color,i.Color),new C(e,"overlay IM color",O.V.Color,i.ColorNoRasterImage),new C(e,"overlay highlight",O.V.Highlight,i.Highlight,M.N.RG),new C(e,"overlay water",O.V.Normal,i.WaterNormal),new C(e,"overlay occluded",O.V.Color,i.Occluded)],(0,R.E)()&&this.targets.push(new C(e,"overlay olid",O.V.ObjectAndLayerIdColor,i.ObjectAndLayerIdColor,M.N.RGBA))}getTexture(e){return this.targets[e]?.fbo.texture}dispose(){for(const e of this.targets)e.fbo.dispose()}computeValidity(){return this.targets.reduce(((e,t,n)=>t.valid?e|=1<<n:e),0)}}var P,D,L=n(65631),N=n(41546);n(94211).Zo,(D=P||(P={}))[D.Material=0]="Material",D[D.ShadowMap=1]="ShadowMap",D[D.Highlight=2]="Highlight",D[D.ViewshedShadowMap=3]="ViewshedShadowMap",n(42426),n(11520),n(5830),n(41356),n(14543);var F,z,H=n(39506),V=(n(39838),n(65312));(z=F||(F={}))[z.Disabled=0]="Disabled",z[z.Enabled=1]="Enabled",z[z.EnabledWithWater=2]="EnabledWithWater",z[z.COUNT=3]="COUNT",(0,N.vt)(),V.n;var U=n(55747),k=n(67521),B=n(13786),G=n(46671),$=n(74174),j=n(34615),Z=n(82273),W=n(82186),q=n(57087);class Y extends Z.w{constructor(e,t,i){super(e,t,new j.$(W.H,(()=>n.e(4746).then(n.bind(n,50906)))),i)}initializePipeline(){return(0,q.Ey)({blending:q.Ky,colorWrite:q.kn})}}var X=n(40434);class Q extends Z.w{constructor(e,t,i){super(e,t,new j.$(X.a,(()=>n.e(5536).then(n.bind(n,5858)))),i)}initializePipeline(){return(0,q.Ey)({colorWrite:q.kn})}}var K=n(82854);class J extends H.Y{constructor(){super(...arguments),this.occludedFactor=K.cD,this.maxHighlightLevel=1,this.verticalCellCount=0,this.horizontalCellCount=0,this.highlightLevel=0,this.pixelRatio=1}}var ee=n(46655);class te extends Z.w{constructor(e,t,i){super(e,t,new j.$(ee.H,(()=>n.e(2803).then(n.bind(n,7471)))),i)}initializePipeline(){return(0,q.Ey)({colorWrite:q.kn})}}var ne=n(966);class ie extends Z.w{constructor(e,t,i){super(e,t,new j.$(ne.S,(()=>n.e(9086).then(n.bind(n,69718)))),i)}initializePipeline(){return(0,q.Ey)({blending:q.Ky,colorWrite:q.kn})}}var re=n(2963);class oe extends Z.w{constructor(e,t,i){super(e,t,new j.$(re.a,(()=>n.e(8643).then(n.bind(n,92227)))),i)}initializePipeline(){return(0,q.Ey)({colorWrite:q.kn})}}var se=n(54407),ae=n(40502),le=n(65839),ce=n(85456),ue=n(3817);const he=[];new ue._(le.r.POSITION,3,ce.pe.FLOAT,0,12),new ue._(le.r.POSITION,2,ce.pe.FLOAT,0,8),new ue._(le.r.POSITION,2,ce.pe.FLOAT,0,16),new ue._(le.r.UV0,2,ce.pe.FLOAT,8,16);var de=n(69445),pe=n(86305),fe=n(12285),ge=n(10956);let me=class extends $.A{constructor(e){super(e),this.produces=G.OG.HIGHLIGHTS,this.consumes={required:[G.OG.HIGHLIGHTS,"highlights"]},this.useMultipleHighlights=!!(0,a.A)("enable-feature:multiple-highlights"),this._optionsTexture=null,this._downsampleDrawParameters=new X.H,this._passParameters=new J,this._singleHighlightBlurDrawParameters=new re.S,this._grid=new _e,e.techniques.precompile(Q),this.useMultipleHighlights?e.techniques.precompile(Y):(e.techniques.precompile(te),e.techniques.precompile(oe),e.techniques.precompile(ie))}initialize(){this.addHandles([(0,h.watch)((()=>xe(this.view.highlights)),(()=>{this._optionsTexture=(0,c.WD)(this._optionsTexture),this.requestRender(se.C7.UPDATE)}),h.Vh)])}destroy(){this._passParameters&&(this._passParameters.highlightOptionsTexture=null),this._grid.coverage=(0,c.Gz)(this._grid.coverage),this._grid.vao=(0,c.WD)(this._grid.vao),this._optionsTexture=(0,c.Gz)(this._optionsTexture)}_updateOptionsTexture(e){const t=this.renderingContext;let n=this._optionsTexture;if(null==n){const e=new ge.R(16,2);e.internalFormat=ce.Ab.RGBA,e.samplingMode=ce.Cj.NEAREST,n=new fe.g(t,e,null),this._optionsTexture=n}n.setData(e),this._passParameters.highlightOptionsTexture=n}render(e){const t=e.find((({name:e})=>e===G.OG.HIGHLIGHTS)),{techniques:n,bindParameters:i,_passParameters:r,renderingContext:o}=this;if(!i.decorations)return t;const s=n.acquire(Q);if(!s.compiled)return s.release(),this.requestRender(se.C7.UPDATE),t;const a=e.find((({name:e})=>"highlights"===e)).getTexture(),l=()=>{const{highlights:e}=this.view;this._optionsTexture||this._updateOptionsTexture(function(e){const t=new Uint8Array(128),n=(e,n)=>{t[e]=n};return be(e,((e,t)=>{((e,t)=>{const i=4*e,r=4*e+64,{color:o}=t,s=t.haloColor??o;n(i+0,o.r),n(i+1,o.g),n(i+2,o.b),n(i+3,t.fillOpacity*o.a*255),n(r+0,s.r),n(r+1,s.g),n(r+2,s.b),n(r+3,t.haloOpacity*s.a*255)})(t,e.options)})),t}(e)),r.highlightOptionsTexture=this._optionsTexture,this._gridUpdateResources(a);const t=this._gridComputeCoverage(s,a,i);s.release();const{horizontalCellCount:n,verticalCellCount:o}=t;return r.horizontalCellCount=n,r.verticalCellCount=o,r.coverageTexture=t.coverage?.getTexture(),t},c=e=>{const t=e.verticalCellCount*e.horizontalCellCount;o.bindVAO(e.vao),o.drawElementsInstanced(ce.WR.TRIANGLES,6,ce.pe.UNSIGNED_BYTE,0,t)},{camera:u}=i,h=()=>{o.bindFramebuffer(t.fbo),o.setViewport4fv(u.fullViewport)};return this.useMultipleHighlights?this._renderMultiple(a,l,c,h):this._renderSingle(a,l,c,h),r.highlightTexture=null,r.coverageTexture=null,t}_renderMultiple(e,t,n,i){const{techniques:r,bindParameters:o,_passParameters:s,renderingContext:a}=this,l=r.acquire(Y);if(!l.compiled)return l.release(),void this.requestRender(se.C7.UPDATE);const c=t();s.highlightTexture=e,s.pixelRatio=o.camera.pixelRatio,s.maxHighlightLevel=Se(this.view.highlights)-1,a.bindTechnique(l,o,s),i(),n(c),l.release()}_renderSingle(e,t,n,i){const{fboCache:r,techniques:o,bindParameters:s,_passParameters:a,renderingContext:l}=this,c=o.acquire(te),u=o.acquire(oe),h=o.acquire(ie);if(!h.compiled||!u.compiled||!c.compiled)return h.release(),u.release(),c.release(),void this.requestRender(se.C7.UPDATE);const d=t(),{width:p,height:f}=e.descriptor;a.maxHighlightLevel=Se(this.view.highlights)-1,a.highlightTexture=e;const{camera:g}=s,{fullWidth:m,fullHeight:_,pixelRatio:v}=g,y=Math.ceil(m/v),b=Math.ceil(_/v),{_singleHighlightBlurDrawParameters:T}=this;for(let e=0;e<=a.maxHighlightLevel;++e){a.highlightLevel=e,l.setClearColor(0,0,0,0);const t=r.acquire(p,f,"single highlight",M.N.RG);l.bindFramebuffer(t.fbo),l.setViewport(0,0,p,f),l.clear(ce.NV.COLOR),l.bindTechnique(c,s,a),n(d),T.blurInput=t.getTexture(),(0,B.hZ)(T.blurSize,1/y,0);const o=r.acquire(y,b,"single highlight blur h",M.N.RG);l.unbindTexture(o.fbo?.colorTexture),l.bindFramebuffer(o.fbo),l.setViewport(0,0,y,b),l.clear(ce.NV.COLOR),T.blurInput=t.getTexture(),(0,B.hZ)(T.blurSize,1/y,0),l.bindTechnique(u,s,a,T),n(d),t.release(),(0,B.hZ)(T.blurSize,0,1/b),a.singleHighlightBlurTexture=o.getTexture(),i(),l.bindTechnique(h,s,a,T),n(d),o.release()}c.release(),u.release(),h.release()}_gridUpdateResources(e){const t=this.renderingContext,n=this._grid,{width:i,height:r}=e.descriptor;if(n.horizontalCellCount=Math.ceil(i/X.g),n.verticalCellCount=Math.ceil(r/X.g),n.vao)return;const o=pe.g.createIndex(t,ce._U.STATIC_DRAW,we);n.vao=new de.Z(t,ae.D,new Map([["geometry",he]]),new Map([["geometry",pe.g.createVertex(t,ce._U.STATIC_DRAW)]]),o)}_gridComputeCoverage(e,t,n){const i=this.renderingContext,r=this._grid,o=t.descriptor,s=Math.ceil(o.width/X.g),a=Math.ceil(o.height/X.g);this._downsampleDrawParameters.input=t,r.coverage?.release();const l=this.fboCache.acquire(s,a,"highlight coverage",M.N.RG);return r.coverage=l,i.bindFramebuffer(l.fbo),i.bindTechnique(e,n,this._passParameters,this._downsampleDrawParameters),i.setViewport(0,0,s,a),i.screen.draw(),r}get test(){}};(0,o._)([(0,p.MZ)()],me.prototype,"produces",void 0),(0,o._)([(0,p.MZ)()],me.prototype,"consumes",void 0),(0,o._)([(0,p.MZ)({constructOnly:!0})],me.prototype,"techniques",void 0),me=(0,o._)([(0,g.$)("esri.views.3d.webgl-engine.effects.highlight.Highlight")],me);class _e{constructor(){this.coverage=null,this.vao=null,this.verticalCellCount=0,this.horizontalCellCount=0,this.viewportWidth=0,this.viewportHeight=0}}const ve=new Array(K.cz),ye=new Array(K.cz);function be(e,t){const n=Math.min(e.length,K.cz);let i=K.cz;for(let t=n-1;t>=0;--t){const n=e.at(t);if(n){const e=n.name;ve.includes(e,i)||(--i,ve[i]=e,ye[i]=t)}}const r=K.cz-i;for(let n=0;n<r;++n){const i=ye[K.cz-r+n];t(e.at(i),n)}}let Te=0;function xe(e){let t=0;const n=Math.min(K.cz,e.length);for(let i=0;i<n;++i){const n=e.at(i);if(n){const{name:e,options:i}=n;t+=e.length;const{color:r,fillOpacity:o,haloColor:s,haloOpacity:a}=i;t+=r.r+(s?.r??1)+o+a}}{const n=e.at(0);if(n){const{shadowOpacity:e,shadowDifference:i,shadowColor:r}=n.options;t+=e+i+r.r}}return Te+++(t>=0?0:1)}const we=new Uint8Array([0,1,2,2,1,3]);function Se(e){const t=new Set;for(let n=0;n<K.cz;++n){const i=e.at(n)?.name;i&&t.add(i)}return t.size}var Ee=n(7970),Ae=n(90553);class Me{constructor(e,t,n,i){this._textures=e,this._techniques=t,this.materialChanged=n,this.requestRender=i,this._id2glMaterialRef=new Ee.O}dispose(){this._textures.destroy()}acquire(e,t,n){this._ownMaterial(e);const i=e.produces.get(t);if(!i?.(n))return null;let r=this._id2glMaterialRef.get(n,e.id);if(null==r){const t=e.createGLMaterial({material:e,techniques:this._techniques,textures:this._textures,output:n});r=new Oe(t),this._id2glMaterialRef.set(n,e.id,r)}return r.ref(),r.glMaterial}release(e,t){const n=this._id2glMaterialRef.get(t,e.id);null!=n&&(n.unref(),n.referenced||((0,c.WD)(n.glMaterial),this._id2glMaterialRef.delete(t,e.id)))}_ownMaterial(e){e.repository&&e.repository!==this&&f.A.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),e.repository=this}}class Oe{constructor(e){this.glMaterial=e,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,(0,Ae.vA)(this._refCnt>=0)}get referenced(){return this._refCnt>0}}var Re,Ce=n(19860),Ie=n(24100),Pe=n(54840),De=(n(38504),n(39714)),Le=n(1932),Ne=n(75256),Fe=n(60808),ze=n(29165);!function(e){e[e.Immediate=0]="Immediate",e[e.FadeWithWeather=1]="FadeWithWeather"}(Re||(Re={}));var He=n(95629);class Ve{constructor(e){this.shadowMap=e,this.slot=ze.N.OPAQUE_MATERIAL,this.slicePlane=null,this.hasOccludees=!1,this.enableFillLights=!0,this.oitPass=Pe.Y.NONE,this.alignPixelEnabled=!1,this.decorations=!0,this.overlayStretch=1,this.viewshedEnabled=!1,this._camera=new L.A,this._inverseViewport=(0,Le.vt)(),this._oldLighting=new He.TA,this._newLighting=new He.TA,this._fadedLighting=new He.TA,this._lighting=this._newLighting,this.ssr=new Ue,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.highlightMixTexture=null,this.highlightGroupName=null,this.highlightGroupIndices=new Map,this.highlightLevel=0,this.highlightMixOrigin=(0,Le.vt)(),this.hudRenderStyle=Fe.D.Occluded,this.clouds=new Ne.n,this.shadowHighlightsVisible=!1}get camera(){return this._camera}set camera(e){this._camera=e,this._inverseViewport[0]=1/e.fullViewport[2],this._inverseViewport[1]=1/e.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}fadeLighting(){switch(this.clouds.fadeFactor){case 0:this._lighting=this._oldLighting;break;default:this._fadedLighting.lerpLighting(this._oldLighting,this._newLighting,this.clouds.fadeFactor),this._lighting=this._fadedLighting;break;case 1:this._lighting=this._newLighting,this._oldLighting.copyFrom(this._newLighting)}}updateLighting(e,t,n,i){this._oldLighting.copyFrom(this.lighting),this._newLighting.noonFactor=t,this._newLighting.globalFactor=n,this._newLighting.set(e),i===Re.FadeWithWeather&&this.clouds.requestFade(),this.fadeLighting()}}class Ue{constructor(){this.fadeFactor=1,this.reprojectionMatrix=(0,De.vt)()}}class ke{constructor(e,t){this.rctx=e,this.lastFrameCamera=new L.A,this.output=O.V.Color,this.renderOccludedMask=Be,this.bind=new Ve(t),this.bind.alignPixelEnabled=!0}}const Be=Ie.m$.Occlude|Ie.m$.OccludeAndTransparent|Ie.m$.OccludeAndTransparentStencil;var Ge=n(15774),$e=n(87725),je=n(33400),Ze=n(65420);let We=class extends L.A{constructor(){super(...arguments),this._projectionMatrix=(0,De.vt)()}get projectionMatrix(){return this._projectionMatrix}};(0,o._)([(0,p.MZ)()],We.prototype,"_projectionMatrix",void 0),(0,o._)([(0,p.MZ)({readOnly:!0})],We.prototype,"projectionMatrix",null),We=(0,o._)([(0,g.$)("esri.views.3d.webgl-engine.lib.CascadeCamera")],We);var qe,Ye,Xe=n(12569);(Ye=qe||(qe={}))[Ye.Highlight=0]="Highlight",Ye[Ye.ExcludeHighlight=1]="ExcludeHighlight";class Qe{constructor(){this.camera=new We,this.lightMat=(0,De.vt)()}}class Ke{constructor(){this.maxNumCascadesHighQuality=4,this.maxNumCascadesLowQuality=4,this.textureSizeModHighQuality=1.3,this.textureSizeModLowQuality=.9,this.splitSchemeLambda=0}}class Je{constructor(e,t){this._fbos=e,this._viewingMode=t,this._enabled=!1,this._snapshots=new Array,this._textureHeight=0,this._numCascades=1,this.settings=new Ke,this._projectionView=(0,De.vt)(),this._projectionViewInverse=(0,De.vt)(),this._modelViewLight=(0,De.vt)(),this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=(0,N.vt)(),this._cascades=[new Qe,new Qe,new Qe,new Qe],this._lastOrigin=null,this._maxTextureWidth=Math.min((0,a.A)("esri-mobile")?4096:16384,e.rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}get depthTexture(){return this._handle?.getTexture()}get _textureWidth(){return this._textureHeight*this._numCascades}get numCascades(){return this._numCascades}get cascadeDistances(){return(0,je.s)(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}disposeOffscreenBuffers(){this._handle=(0,c.Gz)(this._handle),this._discardSnapshots()}set maxCascades(e){this.settings.maxNumCascadesHighQuality=(0,Ge.qE)(Math.floor(e),1,4)}get maxCascades(){return this.settings.maxNumCascadesHighQuality}set enabled(e){this._enabled=e,e||this.disposeOffscreenBuffers()}get enabled(){return this._enabled}get ready(){return this._enabled&&null!=this.depthTexture}get cascades(){for(let e=0;e<this._numCascades;++e)ct[e]=this._cascades[e];return ct.length=this._numCascades,ct}start(e,t,n,i,r){(0,Ae.vA)(this.enabled);const{near:o,far:s}=function(e){let{near:t,far:n}=e;return t<2&&(t=2),n<2&&(n=2),t>=n&&(t=2,n=4),{near:t,far:n}}(n);this._computeCascadeDistances(o,s,i),this._textureHeight=this._computeTextureHeight(e,r,i),this._setupMatrices(e,t);const{viewMatrix:a,projectionMatrix:l}=e;for(let e=0;e<this._numCascades;++e)this._constructCascade(e,l,a,t);this._lastOrigin=null,this.clear()}finish(){(0,Ae.vA)(this.enabled),this._handle?.detachDepth()}getShadowMapMatrices(e){if(!this._lastOrigin||!(0,_.p)(e,this._lastOrigin)){this._lastOrigin=this._lastOrigin||(0,v.vt)(),(0,_.c)(this._lastOrigin,e);for(let t=0;t<this._numCascades;++t){(0,m.Tl)(ut,this._cascades[t].lightMat,e);for(let e=0;e<16;++e)ht[16*t+e]=ut[e]}}return ht}moveSnapshot(e){(0,Ae.vA)(this.enabled),this._handle?.detachDepth(),this._snapshots[e]?.release(),this._snapshots[e]=this._handle,this._handle=null,this.clear()}copySnapshot(e){const t=this._handle?.getTexture()?.descriptor;if(!this.enabled||!t)return;this._snapshots[e]?.release();const{width:n,height:i}=t,r=e===qe.Highlight?"shadow highlight snapshot":"shadow no highlight snapshot";this._snapshots[e]=this._fbos.acquire(n,i,r,M.N.RGBA4);const o=this._fbos.rctx;this._bindFbo();const s=o.bindTexture(this._snapshots[e]?.getTexture(),fe.g.TEXTURE_UNIT_FOR_UPDATES);o.gl.copyTexSubImage2D(ce.Ap.TEXTURE_2D,0,0,0,0,0,n,i),o.bindTexture(s,fe.g.TEXTURE_UNIT_FOR_UPDATES)}getSnapshot(e){return this.enabled?this._snapshots[e]?.getTexture():null}clear(){const e=this._fbos.rctx;this._ensureFbo(),this._bindFbo(),e.setClearColor(1,1,1,1),e.clear(ce.NV.COLOR|ce.NV.DEPTH)}_computeTextureHeight(e,t,n){const i=Math.min(window.devicePixelRatio,t)/e.pixelRatio,r=n?this.settings.textureSizeModHighQuality:this.settings.textureSizeModLowQuality,o=(0,Xe.Mv)(Math.floor(Math.max(e.fullWidth,e.fullHeight)*i*r)),s=Math.min(this._maxTextureWidth,this._numCascades*o);return(0,Xe.uT)(s/this._numCascades)}_ensureFbo(){this._handle?.fbo?.width===this._textureWidth&&this._handle?.fbo.height===this._textureHeight||(this._handle?.release(),this._handle=this._fbos.acquire(this._textureWidth,this._textureHeight,"shadow map",M.N.RGBA4)),this._handle?.acquireDepth(M.z.DEPTH16_BUFFER)}_discardSnapshot(e){this._snapshots[e]=(0,c.Gz)(this._snapshots[e])}_discardSnapshots(){for(let e=0;e<this._snapshots.length;++e)this._discardSnapshot(e);this._snapshots.length=0}_bindFbo(){this._fbos.rctx.bindFramebuffer(this._handle?.fbo)}_constructCascade(e,t,n,i){const r=this._cascades[e],o=-this._cascadeDistances[e],s=-this._cascadeDistances[e+1],a=(t[10]*o+t[14])/Math.abs(t[11]*o+t[15]),l=(t[10]*s+t[14])/Math.abs(t[11]*s+t[15]);(0,Ae.vA)(a<l);for(let e=0;e<8;++e){(0,je.s)(tt,e%4==0||e%4==3?-1:1,e%4==0||e%4==1?-1:1,e<4?a:l,1);const t=nt[e];(0,je.t)(t,tt,this._projectionViewInverse),t[0]/=t[3],t[1]/=t[3],t[2]/=t[3]}(0,_.v)(lt,nt[0]),r.camera.viewMatrix=(0,m.Tl)(et,this._modelViewLight,lt);for(let e=0;e<8;++e)(0,_.t)(nt[e],nt[e],r.camera.viewMatrix);let c=nt[0][2],u=nt[0][2];for(let e=1;e<8;++e)c=Math.min(c,nt[e][2]),u=Math.max(u,nt[e][2]);c-=200,u+=200,r.camera.near=-u,r.camera.far=-c,function(e,t,n,i,r){const o=1/nt[0][3],s=1/nt[4][3];(0,Ae.vA)(o<s);let a=o+Math.sqrt(o*s);const l=Math.sin((0,Ge.XM)(e[2]*t[0]+e[6]*t[1]+e[10]*t[2]));a/=l,function(e,t,n,i,r,o,s,a){(0,B.hZ)(dt,0,0);for(let t=0;t<4;++t)(0,B.WQ)(dt,dt,e[t]);(0,B.hs)(dt,dt,.25),(0,B.hZ)(pt,0,0);for(let t=4;t<8;++t)(0,B.WQ)(pt,pt,e[t]);(0,B.hs)(pt,pt,.25),(0,B.Cc)(ft[0],e[4],e[5],.5),(0,B.Cc)(ft[1],e[5],e[6],.5),(0,B.Cc)(ft[2],e[6],e[7],.5),(0,B.Cc)(ft[3],e[7],e[4],.5);let l=0,c=(0,B.hG)(ft[0],dt);for(let e=1;e<4;++e){const t=(0,B.hG)(ft[e],dt);t<c&&(c=t,l=e)}(0,B.Re)(gt,ft[l],e[l+4]);const u=gt[0];let h,d;gt[0]=-gt[1],gt[1]=u,(0,B.Re)(mt,pt,dt),(0,B.Om)(mt,gt)<0&&(0,B.ze)(gt,gt),(0,B.Cc)(gt,gt,mt,n),(0,B.S8)(gt,gt),h=d=(0,B.Om)((0,B.Re)(_t,e[0],dt),gt);for(let t=1;t<8;++t){const n=(0,B.Om)((0,B.Re)(_t,e[t],dt),gt);n<h?h=n:n>d&&(d=n)}(0,B.C)(i,dt),(0,B.hs)(_t,gt,h-t),(0,B.WQ)(i,i,_t);let p=-1,f=1,g=0,m=0;for(let t=0;t<8;++t){(0,B.Re)(vt,e[t],i),(0,B.S8)(vt,vt);const n=gt[0]*vt[1]-gt[1]*vt[0];n>0?n>p&&(p=n,g=t):n<f&&(f=n,m=t)}(0,Ae.MX)(p>0,"leftArea"),(0,Ae.MX)(f<0,"rightArea"),(0,B.hs)(yt,gt,h),(0,B.WQ)(yt,yt,dt),(0,B.hs)(bt,gt,d),(0,B.WQ)(bt,bt,dt),Tt[0]=-gt[1],Tt[1]=gt[0];const _=(0,Ae.L)(i,e[m],bt,(0,B.WQ)(_t,bt,Tt),1,r),v=(0,Ae.L)(i,e[g],bt,_t,1,o),y=(0,Ae.L)(i,e[g],yt,(0,B.WQ)(_t,yt,Tt),1,s),b=(0,Ae.L)(i,e[m],yt,_t,1,a);(0,Ae.MX)(_,"rayRay"),(0,Ae.MX)(v,"rayRay"),(0,Ae.MX)(y,"rayRay"),(0,Ae.MX)(b,"rayRay")}(nt,a,l,it,rt,ot,st,at),function(e,t,n,i,r){(0,B.Re)(Et,n,i),(0,B.hs)(Et,Et,.5),At[0]=Et[0],At[1]=Et[1],At[2]=0,At[3]=Et[1],At[4]=-Et[0],At[5]=0,At[6]=Et[0]*Et[0]+Et[1]*Et[1],At[7]=Et[0]*Et[1]-Et[1]*Et[0],At[8]=1,At[xt(0,2)]=-(0,B.Om)(St(At,0),e),At[xt(1,2)]=-(0,B.Om)(St(At,1),e);let o=(0,B.Om)(St(At,0),n)+At[xt(0,2)],s=(0,B.Om)(St(At,1),n)+At[xt(1,2)],a=(0,B.Om)(St(At,0),i)+At[xt(0,2)],l=(0,B.Om)(St(At,1),i)+At[xt(1,2)];o=-(o+a)/(s+l),At[xt(0,0)]+=At[xt(1,0)]*o,At[xt(0,1)]+=At[xt(1,1)]*o,At[xt(0,2)]+=At[xt(1,2)]*o,o=1/((0,B.Om)(St(At,0),n)+At[xt(0,2)]),s=1/((0,B.Om)(St(At,1),n)+At[xt(1,2)]),At[xt(0,0)]*=o,At[xt(0,1)]*=o,At[xt(0,2)]*=o,At[xt(1,0)]*=s,At[xt(1,1)]*=s,At[xt(1,2)]*=s,At[xt(2,0)]=At[xt(1,0)],At[xt(2,1)]=At[xt(1,1)],At[xt(2,2)]=At[xt(1,2)],At[xt(1,2)]+=1,o=(0,B.Om)(St(At,1),t)+At[xt(1,2)],s=(0,B.Om)(St(At,2),t)+At[xt(2,2)],a=(0,B.Om)(St(At,1),n)+At[xt(1,2)],l=(0,B.Om)(St(At,2),n)+At[xt(2,2)],o=-.5*(o/s+a/l),At[xt(1,0)]+=At[xt(2,0)]*o,At[xt(1,1)]+=At[xt(2,1)]*o,At[xt(1,2)]+=At[xt(2,2)]*o,o=(0,B.Om)(St(At,1),t)+At[xt(1,2)],s=(0,B.Om)(St(At,2),t)+At[xt(2,2)],a=-s/o,At[xt(1,0)]*=a,At[xt(1,1)]*=a,At[xt(1,2)]*=a,r[0]=At[0],r[1]=At[1],r[2]=0,r[3]=At[2],r[4]=At[3],r[5]=At[4],r[6]=0,r[7]=At[5],r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=At[6],r[13]=At[7],r[14]=0,r[15]=At[8]}(it,rt,st,at,r.projectionMatrix),r.projectionMatrix[10]=2/(n-i),r.projectionMatrix[14]=-(n+i)/(n-i)}(n,i,c,u,r.camera),(0,m.lw)(r.lightMat,r.camera.projectionMatrix,r.camera.viewMatrix);const h=this._textureHeight;r.camera.viewport=[e*h,0,h,h]}_setupMatrices(e,t){(0,m.lw)(this._projectionView,e.projectionMatrix,e.viewMatrix),(0,m.B8)(this._projectionViewInverse,this._projectionView);const n=this._viewingMode===Ze.RT.Global?e.eye:(0,_.i)(lt,0,0,1);(0,m.t5)(this._modelViewLight,[0,0,0],[-t[0],-t[1],-t[2]],n)}_computeCascadeDistances(e,t,n){const i=n?this.settings.maxNumCascadesHighQuality:this.settings.maxNumCascadesLowQuality;this._numCascades=Math.min(1+Math.floor((0,Ae.kL)(t/e,4)),i);const r=(t-e)/this._numCascades,o=(t/e)**(1/this._numCascades);let s=e,a=e;for(let e=0;e<this._numCascades+1;++e)this._cascadeDistances[e]=(0,Ge.Cc)(s,a,this.settings.splitSchemeLambda),s*=o,a+=r}get test(){}}const et=(0,De.vt)(),tt=(0,N.vt)(),nt=[];for(let e=0;e<8;++e)nt.push((0,N.vt)());const it=(0,Le.vt)(),rt=(0,Le.vt)(),ot=(0,Le.vt)(),st=(0,Le.vt)(),at=(0,Le.vt)(),lt=(0,v.vt)(),ct=[],ut=(0,De.vt)(),ht=De.zK.concat(De.zK,De.zK,De.zK,De.zK),dt=(0,Le.vt)(),pt=(0,Le.vt)(),ft=[(0,Le.vt)(),(0,Le.vt)(),(0,Le.vt)(),(0,Le.vt)()],gt=(0,Le.vt)(),mt=(0,Le.vt)(),_t=(0,Le.vt)(),vt=(0,Le.vt)(),yt=(0,Le.vt)(),bt=(0,Le.vt)(),Tt=(0,Le.vt)();function xt(e,t){return 3*t+e}const wt=(0,Le.vt)();function St(e,t){return(0,B.hZ)(wt,e[t],e[t+3]),wt}const Et=(0,Le.vt)(),At=(0,$e.vt)();var Mt=n(83525),Ot=n(13794),Rt=n(89756),Ct=n(23545),It=n(49845),Pt=n(38177),Dt=n(96253),Lt=n(57701),Nt=n(26347);let Ft=class extends Mt.A{constructor(e){super(e),this._pending=new zt,this._changes=new Ct.VR,this._renderers=new Map,this._sortedRenderers=new u.A,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._renderers.forEach((e=>e.destroy())),this._renderers.clear(),this._sortedRenderers.clear(),this._geometries.clear(),this._pending.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materials(){return this.rendererContext.materials}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccludedDraped(){for(const e of this._renderers.values())if(0!==e.numGeometries&&!e.queryRenderOccludedState(Ie.m$.Occlude))return!0;return!1}get isEmpty(){return!this.updating&&0===this._renderers.size&&0===this._geometries.size}getMaterialRenderer(e){return this._renderers.get(e)}get sortedRenderers(){return this._sortedRenderers}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=(0,Lt.$T)(this._changes);let t=!1;return e.forEach(((e,n)=>{let i=this._renderers.get(n);!i&&e.adds.length>0&&(i=new Nt.y({material:n}),i.initializeRenderContext(this.rendererContext.pluginContext,this._materials),this._renderers.set(n,i),t=!0),i&&(i.modify(e),0===i.numGeometries&&(this._renderers.delete(n),i.destroy(),t=!0))})),this._changes.clear(),t&&this._updateSortedMaterialRenderers(),this._hasHighlights=(0,l.Bs)(this._renderers,(e=>{const t=e.produces.get(ze.N.DRAPED_MATERIAL);return!!t&&t(O.V.Highlight)})),this._hasWater=(0,l.Bs)(this._renderers,(e=>{const t=e.produces.get(ze.N.DRAPED_WATER);return!!t&&t(O.V.Normal)})),this.notifyChange("updating"),!0}addGeometries(e,t){if(0===e.length)return;const n=this._validateRenderGeometries(e);for(const e of n)this._geometries.set(e.id,e);const i=this._pending.empty;for(const e of n)this._pending.adds.add(e);i&&this.notifyChange("updating"),t===Dt.q.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,t){const n=this._pending.empty,i=this._pending.adds;for(const t of e)i.has(t)?(this._pending.removed.add(t),i.delete(t)):this._pending.removed.has(t)||this._pending.removes.add(t),this._geometries.delete(t.id);n&&!this._pending.empty&&this.notifyChange("updating"),t===Dt.q.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,t){const n=0===this._changes.updates.length;for(const n of e){const e=this._changes.updates.pushNew();e.renderGeometry=this._validateRenderGeometry(n),e.updateType=t}switch(n&&this._changes.updates.length>0&&this.notifyChange("updating"),t){case Dt.k.TRANSFORMATION:case Dt.k.GEOMETRY:return this._notifyGraphicGeometryChanged(e);case Dt.k.VISIBILITY:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let t=!1;return this._sortedRenderers.forAll((n=>t=!!n.updateAnimation&&n.updateAnimation(e)||t)),t}precompile(e){return this._sortedRenderers.reduce(((t,n)=>n.precompile(e)||t),!1)}render(e){this._sortedRenderers.forAll((t=>{const n=t.acquireTechniques(e);n&&(t.render(e,n),(0,k.VM)(n))}))}intersect(e,t,n,i,r){for(const o of this._geometries.values()){if(!i(o))continue;this._intersectRenderGeometry(o,n,t,0,e,r);const s=this.rendererContext.longitudeCyclical;s&&(o.boundingSphere[0]-o.boundingSphere[3]<s.min&&this._intersectRenderGeometry(o,n,t,s.range,e,r),o.boundingSphere[0]+o.boundingSphere[3]>s.max&&this._intersectRenderGeometry(o,n,t,-s.range,e,r)),r++}return r}_updateSortedMaterialRenderers(){this._sortedRenderers.clear();let e=0;for(const t of this._renderers.values())t.drapedPriority=e++,this._sortedRenderers.push(t);this._sortedRenderers.sort(((e,t)=>t.material?.renderPriority===e.material?.renderPriority?e.drapedPriority-t.drapedPriority:(t.material?.renderPriority||0)-(e.material?.renderPriority||0)))}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes)),this._changes.updates.filterInPlace((({renderGeometry:e})=>!this._pending.has(e))),this._pending.clear()}_intersectRenderGeometry(e,t,n,i,r,o){if(!e.visible||!e.material.visible)return;let s=0;i+=e.transformation[12],s=e.transformation[13],Ht[0]=n[0]-i,Ht[1]=n[1]-s,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersectDraped(e,null,r,Ht,((n,i,s)=>{!function(e,t,n,i,r,o,s){const a=new Rt.MQ(o,s,t),l=t=>{t.set(Pt.dz.OVERLAY,a,e.dist,e.normal,e.transformation,n,i)};if((null==r.results.min.drapedLayerOrder||n>=r.results.min.drapedLayerOrder)&&(null==r.results.min.dist||r.results.ground.dist<=r.results.min.dist)&&l(r.results.min),r.options.store!==Pt.oH.MIN&&(null==r.results.max.drapedLayerOrder||n<r.results.max.drapedLayerOrder)&&(null==r.results.max.dist||r.results.ground.dist>r.results.max.dist)&&l(r.results.max),r.options.store===Pt.oH.ALL){const e=(0,It.G7)(r.ray);l(e),r.results.all.push(e)}}(t,s,o,e.material.renderPriority,r,e.layerUid,e.graphicUid)}),t)}_notifyGraphicGeometryChanged(e){if(null==this.drapeSource.notifyGraphicGeometryChanged)return;let t;for(const{graphicUid:n}of e)null!=n&&n!==t&&(this.drapeSource.notifyGraphicGeometryChanged(n),t=n)}_notifyGraphicVisibilityChanged(e){if(null==this.drapeSource.notifyGraphicVisibilityChanged)return;let t;for(const{graphicUid:n}of e)null!=n&&n!==t&&(this.drapeSource.notifyGraphicVisibilityChanged(n),t=n)}_validateRenderGeometries(e){for(const t of e)this._validateRenderGeometry(t);return e}_validateRenderGeometry(e){return null==e.localOrigin&&(e.localOrigin=this._localOriginFactory.getOrigin((0,Ot.a)(e.boundingSphere))),e}get test(){}};(0,o._)([(0,p.MZ)()],Ft.prototype,"drapeSource",void 0),(0,o._)([(0,p.MZ)()],Ft.prototype,"updating",null),(0,o._)([(0,p.MZ)()],Ft.prototype,"rctx",null),(0,o._)([(0,p.MZ)({constructOnly:!0})],Ft.prototype,"rendererContext",void 0),(0,o._)([(0,p.MZ)()],Ft.prototype,"_materials",null),(0,o._)([(0,p.MZ)()],Ft.prototype,"_localOriginFactory",null),(0,o._)([(0,p.MZ)({readOnly:!0})],Ft.prototype,"isEmpty",null),(0,o._)([(0,p.MZ)()],Ft.prototype,"_renderers",void 0),(0,o._)([(0,p.MZ)()],Ft.prototype,"_geometries",void 0),Ft=(0,o._)([(0,g.$)("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],Ft);class zt{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return 0===this.adds.size&&0===this.removes.size&&0===this.removed.size}has(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}}const Ht=(0,Le.vt)();class Vt extends Z.w{constructor(e,t,i){super(e,t,new j.$(U.a,(()=>n.e(6404).then(n.bind(n,41722)))),i)}initializePipeline(e){return e.hasAlpha?(0,q.Ey)({blending:q.Ky,colorWrite:q.kn}):(0,q.Ey)({colorWrite:q.kn})}}var Ut=n(65875);class kt extends Ut.K{constructor(){super(...arguments),this.hasAlpha=!1}}(0,o._)([(0,Ut.W)()],kt.prototype,"hasAlpha",void 0);var Bt=n(91998),Gt=n(35910),$t=n(94010);class jt extends Z.w{constructor(e,t,i){super(e,t,new j.$($t.a,(()=>n.e(5835).then(n.bind(n,49706)))),i)}}var Zt=n(48961);let Wt=class extends k.RW{constructor(e){super(e),this._overlays=null,this._renderTargets=null,this._overlayParameters=new $t.O,this.hasHighlights=!1,this._hasWater=!1,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new u.A,this._passParameters=new U.T,this._materials=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._camera=new L.A,this.worldToPCSRatio=1,this.events=new s.A,this.longitudeCyclical=null,this.produces=new Map([[ze.N.DRAPED_MATERIAL,e=>e!==O.V.Highlight||this.hasHighlights],[ze.N.DRAPED_WATER,()=>this._hasWater]]),this._hasTargetWithoutRasterImage=!1,this._hasDrapedFeatureSource=!1,this._hasDrapedRasterSource=!1}initialize(){const{view:e}=this,{_stage:t}=e,n=t.renderer.fboCache,i=t.renderView,{waterTextures:r,textures:o}=i;this._renderContext=new ke(this._rctx,new Je(n,e.state.viewingMode)),this.addHandles([(0,h.watch)((()=>r.updating),(()=>this.events.emit("content-changed")),h.pc),(0,h.watch)((()=>this.spatialReference),(e=>this._localOriginFactory=new Ce.g(e)),h.pc),(0,h.on)((()=>this.view.allLayerViews),"after-changes",(()=>this._sortedDrapeSourceRenderersDirty=!0)),(0,h.watch)((()=>xe(this.view.highlights)),(()=>this._sortedDrapeSourceRenderersDirty=!0),h.pc)]),this._materials=new Me(o,this._techniques,(()=>{this.notifyChange("rendersOccludedDraped"),this.events.emit("content-changed"),this.notifyChange("updating"),this.notifyChange("isEmpty")}),(()=>this.events.emit("content-changed")));const{_bindParameters:s,_camera:a}=this;s.slot=ze.N.DRAPED_MATERIAL,s.mainDepth=null,a.near=1,a.far=1e4,a.relativeElevation=null,s.camera=this._camera,s.oitPass=Pe.Y.NONE,s.updateLighting([new Gt.$p((0,v.S)())],0,0,Re.Immediate),this.addHandles(this.view.resourceController.scheduler.registerTask(Zt.W6.STAGE,this))}destroy(){this._renderers.forEach((e=>e.destroy())),this._renderers.clear(),this._passParameters.texture=(0,c.WD)(this._passParameters.texture),this.disposeOverlays()}get _bindParameters(){return this._renderContext.bind}get _rctx(){return this.view._stage.renderView.renderingContext}get _techniques(){return this.view._stage.renderView.techniques}get rctx(){return this._rctx}get materials(){return this._materials}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}get pluginContext(){return this._pluginContext}initializeRenderContext(e){this._pluginContext=e,this._techniques.precompile(jt)}uninitializeRenderContext(){}acquireTechniques(){return[]}render(){}get updating(){return this._sortedDrapeSourceRenderersDirty||(0,l.Bs)(this._renderers,(e=>e.updating))}get hasOverlays(){return null!=this._overlays&&null!=this._renderTargets}getMaterialRenderer(e){for(const t of this._renderers.values()){const n=t.getMaterialRenderer(e);if(n)return n}return null}get layers(){return this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers(),this._sortedRenderers.map((e=>e.drapeSource.layer)).filter((e=>!!e))}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,Ft)}createDrapeSourceRenderer(e,t,n){const i=this._renderers.get(e);null!=i&&i.destroy();const r=new t({...n,rendererContext:this,drapeSource:e});return this._renderers.set(e,r),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this.addHandles((0,h.watch)((()=>e.fullOpacity),(()=>this.events.emit("content-changed"))),e),r}removeDrapeSourceRenderer(e){if(null==e)return;const t=this._renderers.get(e);null!=t&&(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this.removeHandles(e),t.destroy())}computeValidity(){return this._renderTargets?.computeValidity()??0}releaseRenderTargets(){this._renderTargets?.dispose()}get overlays(){return this._overlays??[]}ensureDrapeTargets(e){this._hasTargetWithoutRasterImage=!!this._overlays&&(0,d.bw)(e,(e=>e.drapeTargetType===y.sv.WithoutRasterImage))}ensureDrapeSources(e){this._overlays?(this._hasDrapedFeatureSource=(0,d.bw)(e,(e=>e.drapeSourceType===y.Om.Features)),this._hasDrapedRasterSource=(0,d.bw)(e,(e=>e.drapeSourceType===y.Om.RasterImage))):this._hasDrapedFeatureSource=this._hasDrapedRasterSource=!1}get _needsColorWithoutRasterImage(){return this._hasDrapedRasterSource&&this._hasDrapedFeatureSource&&this._hasTargetWithoutRasterImage}ensureOverlays(e,t,n=this._bindParameters.overlayStretch){null==this._overlays&&(this._renderTargets=new I(this.view._stage.renderer.fboCache),this._overlays=[new S,new S]),this.ensureDrapeTargets(e),this.ensureDrapeSources(t),this._bindParameters.overlayStretch=n}disposeOverlays(){this._overlays=null,this._renderTargets=(0,c.WD)(this._renderTargets),this.events.emit("textures-disposed")}getTexture(e){if(null!=e)return e===i.ColorNoRasterImage&&!this._needsColorWithoutRasterImage&&this._hasDrapedFeatureSource?this._renderTargets?.getTexture(i.Color):this._renderTargets?.getTexture(e)}get running(){return this.updating}runTask(e){this._processDrapeSources(e,(()=>!0))}_processDrapeSources(e,t){let n=!1;for(const[i,r]of this._renderers){if(e.done)break;(i.destroyed||t(i))&&r.commitChanges()&&(n=!0,e.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,n=!0,this._updateSortedDrapeSourceRenderers()),n&&(null!=this._overlays&&0===this._renderers.size&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this.hasHighlights=(0,l.Bs)(this._renderers,(e=>e.hasHighlights)),this.notifyChange("rendersOccludedDraped"),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(Zt.Bb,(e=>e.updatePolicy===Bt.q.SYNC))}get isEmpty(){return!b.b.OVERLAY_DRAW_DEBUG_TEXTURE&&!(0,l.Bs)(this._renderers,(e=>!e.isEmpty))}get hasWater(){return this._hasWater}get rendersOccludedDraped(){const e=this._renderContext.renderOccludedMask;this._renderContext.renderOccludedMask=Qt,++this._techniques.precompiling;const t=this._sortedRenderers.some((({renderer:e})=>e.precompile(this._renderContext)));return--this._techniques.precompiling,this._renderContext.renderOccludedMask=e,t}renders(e){if(b.b.OVERLAY_DRAW_DEBUG_TEXTURE&&e!==i.Occluded&&e!==i.Highlight)return!0;++this._techniques.precompiling;const t=this._sortedRenderers.some((({renderer:e})=>e.precompile(this._renderContext)));return--this._techniques.precompiling,t}get mode(){return this.isEmpty?F.Disabled:this._renderTargets?.getTexture(i.WaterNormal)?F.EnabledWithWater:this._renderTargets?.getTexture(i.Color)?F.Enabled:F.Disabled}updateAnimation(e){let t=!1;return this._renderers.forEach((n=>t=n.updateAnimation(e)||t)),t}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}precompileShaders(e){if(this._renderTargets){this._bindParameters.alignPixelEnabled=e.alignPixelEnabled,this._bindParameters.highlightGroupName=null,++this._techniques.precompiling;for(const e of this._renderTargets.targets){if(e.content===i.ColorNoRasterImage&&!this._needsColorWithoutRasterImage)continue;const t=e.output;this._renderContext.output=t,this._bindParameters.slot=t===O.V.Normal?ze.N.DRAPED_WATER:ze.N.DRAPED_MATERIAL,e.content===i.Occluded&&(this._renderContext.renderOccludedMask=Qt),this._sortedRenderers.forAll((({drapeSource:t,renderer:n})=>{e.content===i.ColorNoRasterImage&&t.drapeSourceType===y.Om.RasterImage||n.precompile(this._renderContext)})),this._renderContext.renderOccludedMask=Be}--this._techniques.precompiling}}drawOverlays(e){if(this._overlays&&this._renderTargets){for(const e of this._overlays)this.longitudeCyclical?e.setupGeometryViewsCyclical(this.longitudeCyclical):e.setupGeometryView();this._bindParameters.alignPixelEnabled=e.alignPixelEnabled;for(const t of this._renderTargets.targets){if(t.content===i.ColorNoRasterImage&&!this._needsColorWithoutRasterImage)continue;const n=this._drawTarget(T.vr.INNER,t,e),r=this._drawTarget(T.vr.OUTER,t,e);(n||r)&&t.fbo.generateMipMap()}}}_drawTarget(e,t,n){const r=this._overlays[e],o=r.canvasGeometries;if(0===o.numViews)return!1;const{contentPixelRatio:s}=n;this._screenToWorldRatio=s*r.mapUnitsPerPixel/this._bindParameters.overlayStretch;const a=t.output;if(this.isEmpty||a===O.V.Normal&&!this.hasWater||!r.hasSomeSizedView())return!1;const{_rctx:l,_bindParameters:c}=this;if(this._camera.pixelRatio=r.pixelRatio*s,this._renderContext.output=a,c.screenToWorldRatio=this._screenToWorldRatio,c.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,c.slot=a===O.V.Normal?ze.N.DRAPED_WATER:ze.N.DRAPED_MATERIAL,t.content===i.Occluded&&(this._renderContext.renderOccludedMask=Qt),c.highlightGroupName=null,!this.renders(t.content))return this._renderContext.renderOccludedMask=Be,!1;const{resolution:u}=r,h=e===T.vr.INNER?0:u;if(l.setViewport(h,0,u,u),this._bindTargetFBO(t),e===T.vr.INNER&&(l.setClearColor(0,0,0,0),l.clear(ce.NV.COLOR)),b.b.OVERLAY_DRAW_DEBUG_TEXTURE&&t.content!==i.Occluded&&t.content!==i.Highlight){this._techniques.precompile(Vt,Kt);const t=this._techniques.acquire(Vt,Kt);for(let n=0;n<o.numViews;n++)this._setViewParameters(o.extents[n],r),this._ensureDebugPatternResources(r.resolution,Yt[e]),l.bindTechnique(t,c,this._passParameters),l.screen.draw();t.release()}if(t.output===O.V.Highlight){const{fboCache:n}=this.view._stage.renderer,i=this._resolution;!function(e,t,n,i,r,o,s=0,a){const{highlightGroupIndices:l}=r;l.clear();const c=[];be(i,(e=>{const{name:t}=e;l.set(t,c.length),c.push(t)}));const u=l.size,{gl:h}=e;(0,B.hZ)(r.highlightMixOrigin,s,0);let d=null;u>1&&(d=t.acquire(n.width,n.height,"highlight mix",M.N.RG),e.bindFramebuffer(d.fbo),e.clearFramebuffer(N.uY));const p=d?.getTexture()??null;r.highlightMixTexture=p,a();for(let t=0;t<u;++t)t>0&&(e.bindTexture(p,0),h.copyTexSubImage2D(ce.Ap.TEXTURE_2D,0,0,0,s,0,n.width,n.height),e.bindTexture(null,0)),e.clear(ce.NV.DEPTH),r.highlightLevel=t,r.highlightGroupName=c[t],o();d?.release()}(l,n,{width:i,height:i},this.view.highlights,c,(()=>this._renderAllGeometry(e,t)),h,(()=>this._bindTargetFBO(t)))}else this._renderAllGeometry(e,t);return l.bindFramebuffer(null),this._renderContext.renderOccludedMask=Be,!0}_renderAllGeometry(e,t){const n=this._overlays[e],r=n.canvasGeometries;this._sortedRenderers.forAll((({drapeSource:o,renderer:s})=>{if(t.content===i.ColorNoRasterImage&&o.drapeSourceType===y.Om.RasterImage)return;const{fullOpacity:a}=o,l=null!=a&&a<1&&t.output===O.V.Color&&this._bindTemporaryFBO();for(let e=0;e<r.numViews;e++)this._setViewParameters(r.extents[e],n),s.render(this._renderContext);if(l){this._bindTargetFBO(t),this._overlayParameters.texture=l.getTexture(),this._overlayParameters.opacity=a,this._overlayParameters.overlayIndex=e;const n=this._techniques.acquire(jt);this._rctx.bindTechnique(n,this._bindParameters,this._overlayParameters),this._rctx.screen.draw(),n.release(),l.release()}}))}_bindTargetFBO(e){const t=this._resolution,n=2*t;e.fbo.bind(this._rctx,n,t)}_bindTemporaryFBO(){const e=this._resolution,t=2*e,n=this.view._stage.renderer.fboCache,i=n.acquire(t,e,"overlay tmp");return n.rctx.bindFramebuffer(i.fbo),n.rctx.clear(ce.NV.COLOR),i}get _resolution(){return this._overlays?.[T.vr.INNER].resolution??0}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,t,n,i){this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers();let r=0;for(const{renderer:o}of this._sortedRenderers)r=o.intersect?.(e,t,n,i,r)??r}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),0===this._renderers.size)return;const e=this.view.map.allLayers,t=e.length;this._renderers.forEach(((n,i)=>{const r=e.indexOf(i.layer),o=r>=0,s=i.renderGroup??(o?y.O7.MapLayer:y.O7.ViewLayer),a=t*s+(o?r:0);this._sortedRenderers.push(new qt(i,n,a))})),this._sortedRenderers.sort(((e,t)=>e.index-t.index))}_setViewParameters(e,t){const n=this._camera;n.viewport=[0,0,t.resolution,t.resolution],(0,m.v3)(n.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],n.near,n.far),(0,m.kN)(n.viewMatrix,[-e[0],-e[1],0])}_updateHasWater(){const e=(0,l.Bs)(this._renderers,(e=>e.hasWater));e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water"))}_ensureDebugPatternResources(e,t){if((0,_.i)(this._passParameters.color,t[0],t[1],t[2]),this._passParameters.texture)return;const n=new Uint8Array(e*e*4);let i=0;for(let t=0;t<e;t++)for(let r=0;r<e;r++){const o=Math.floor(r/10),s=Math.floor(t/10);o<2||s<2||10*o>e-20||10*s>e-20?(n[i++]=255,n[i++]=255,n[i++]=255,n[i++]=255):(n[i++]=255,n[i++]=255,n[i++]=255,n[i++]=1&o&&1&s?1&r^1&t?0:255:1&o^1&s?0:128)}const r=new ge.R(e);r.samplingMode=ce.Cj.NEAREST,this._passParameters.texture=new fe.g(this._rctx,r,n)}get test(){}};(0,o._)([(0,p.MZ)()],Wt.prototype,"hasHighlights",void 0),(0,o._)([(0,p.MZ)()],Wt.prototype,"_sortedDrapeSourceRenderersDirty",void 0),(0,o._)([(0,p.MZ)({constructOnly:!0})],Wt.prototype,"view",void 0),(0,o._)([(0,p.MZ)({readOnly:!0})],Wt.prototype,"_techniques",null),(0,o._)([(0,p.MZ)()],Wt.prototype,"worldToPCSRatio",void 0),(0,o._)([(0,p.MZ)()],Wt.prototype,"spatialReference",void 0),(0,o._)([(0,p.MZ)({type:Boolean,readOnly:!0})],Wt.prototype,"updating",null),(0,o._)([(0,p.MZ)()],Wt.prototype,"isEmpty",null),(0,o._)([(0,p.MZ)({readOnly:!0})],Wt.prototype,"rendersOccludedDraped",null),Wt=(0,o._)([(0,g.$)("esri.views.3d.terrain.OverlayRenderer")],Wt);class qt{constructor(e,t,n){this.drapeSource=e,this.renderer=t,this.index=n}}const Yt=[[1,.5,.5],[.5,.5,1]],Xt=-2,Qt=Ie.m$.OccludeAndTransparent,Kt=new kt;Kt.hasAlpha=!0},86398:function(e,t,n){"use strict";var i,r,o;n.d(t,{vr:function(){return i}}),function(e){e[e.INNER=0]="INNER",e[e.OUTER=1]="OUTER"}(i||(i={})),function(e){e[e.REGULAR=0]="REGULAR",e[e.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",e[e.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",e[e.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(r||(r={})),function(e){e[e.FADING=0]="FADING",e[e.IMMEDIATE=1]="IMMEDIATE",e[e.UNFADED=2]="UNFADED"}(o||(o={}))},30087:function(e,t,n){"use strict";n.d(t,{i$:function(){return c},oD:function(){return u},xJ:function(){return l}});var i=n(27264),r=n(66299),o=n(11687),s=n(39506);function a(e){e.varyings.add("linearDepth","float")}function l(e){e.vertex.uniforms.add(new o.G("nearFar",((e,t)=>t.camera.nearFar)))}function c(e){e.vertex.code.add(s.H`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}function u(e,t){const{vertex:n}=e;switch(t.output){case i.V.Color:case i.V.ColorEmission:if(t.receiveShadows)return a(e),void n.code.add(s.H`void forwardLinearDepth() { linearDepth = gl_Position.w; }`);break;case i.V.Shadow:case i.V.ShadowHighlight:case i.V.ShadowExcludeHighlight:case i.V.ViewshedShadow:return e.include(r.em,t),a(e),l(e),c(e),void n.code.add(s.H`void forwardLinearDepth() {
linearDepth = calculateLinearDepth(nearFar, vPosition_view.z);
}`)}n.code.add(s.H`void forwardLinearDepth() {}`)}},28721:function(e,t,n){"use strict";n.d(t,{Q:function(){return a}});var i=n(12511),r=n(39506),o=n(39838),s=n(40434);function a(e){const{vertex:t}=e;t.uniforms.add(new o.N("coverageTexture",(e=>e.coverageTexture)),new i.g("highlightRenderCellCount",(e=>[e.horizontalCellCount,e.verticalCellCount])),new i.g("highlightTextureResolution",(e=>[e.highlightTexture.descriptor.width,e.highlightTexture.descriptor.height]))),t.constants.add("cellSize","int",s.g),e.varyings.add("sUV","vec2"),e.varyings.add("vOutlinePossible","float"),t.code.add(r.H`const ivec2 cellVertices[4] = ivec2[4](ivec2(0,0), ivec2(1,0), ivec2(0,1), ivec2(1,1));`),t.main.add(r.H`int cellIndex = gl_InstanceID;
int cellX = cellIndex % highlightRenderCellCount[0];
int cellY = (cellIndex - cellX) / highlightRenderCellCount[0];
ivec2 cellPos = ivec2(cellX, cellY);
vec4 cov = texelFetch(coverageTexture, cellPos, 0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
vOutlinePossible = cov.g;
ivec2 iPosInCell = cellVertices[gl_VertexID];
vec2 sPos = vec2(cellPos * cellSize + iPosInCell * (cellSize));
vec2 vPos = sPos / vec2(highlightTextureResolution);
sUV = vPos;
gl_Position = vec4(2.0 * vPos - vec2(1.0), 0.0, 1.0);`)}},74571:function(e,t,n){"use strict";n.d(t,{y:function(){return r}});var i=n(39506);function r(e){const{fragment:t}=e;t.code.add(i.H`uint readChannelBits(uint channel, int highlightLevel) {
int llc = (highlightLevel & 3) << 1;
return (channel >> llc) & 3u;
}
uint readChannel(vec2 texel, int highlightLevel) {
int lic = (highlightLevel >> 2) & 1;
return uint(texel[lic] * 255.0);
}
uint readLevelBits(vec2 texel, int highlightLevel) {
return readChannelBits(readChannel(texel, highlightLevel), highlightLevel);
}`)}},68561:function(e,t,n){"use strict";n.d(t,{K:function(){return c}});var i=n(23397),r=n(82316),o=n(82598),s=n(14543),a=n(39506),l=n(39838);function c(e,t){const n=e.fragment;n.include(i.E),e.include(r.Ir),n.uniforms.add(new s.m("globalAlpha",(e=>e.globalAlpha)),new o.t("glowColor",(e=>e.glowColor)),new s.m("glowWidth",((e,t)=>e.glowWidth*t.camera.pixelRatio)),new s.m("glowFalloff",(e=>e.glowFalloff)),new o.t("innerColor",(e=>e.innerColor)),new s.m("innerWidth",((e,t)=>e.innerWidth*t.camera.pixelRatio)),new l.N("depthMap",((e,t)=>t.depth?.attachment)),new l.N("normalMap",(e=>e.normals))),n.code.add(a.H`vec4 blendPremultiplied(vec4 source, vec4 dest) {
float oneMinusSourceAlpha = 1.0 - source.a;
return vec4(
source.rgb + dest.rgb * oneMinusSourceAlpha,
source.a + dest.a * oneMinusSourceAlpha
);
}`),n.code.add(a.H`vec4 premultipliedColor(vec3 rgb, float alpha) {
return vec4(rgb * alpha, alpha);
}`),n.code.add(a.H`vec4 laserlineProfile(float dist) {
if (dist > glowWidth) {
return vec4(0.0);
}
float innerAlpha = (1.0 - smoothstep(0.0, innerWidth, dist));
float glowAlpha = pow(max(0.0, 1.0 - dist / glowWidth), glowFalloff);
return blendPremultiplied(
premultipliedColor(innerColor, innerAlpha),
premultipliedColor(glowColor, glowAlpha)
);
}`),n.code.add(a.H`bool laserlineReconstructFromDepth(out vec3 pos, out vec3 normal, out float angleCutoffAdjust, out float depthDiscontinuityAlpha) {
float depth = depthFromTexture(depthMap, uv);
if (depth == 1.0) {
return false;
}
float linearDepth = linearizeDepth(depth);
pos = reconstructPosition(gl_FragCoord.xy, linearDepth);
float minStep = 6e-8;
float depthStep = clamp(depth + minStep, 0.0, 1.0);
float linearDepthStep = linearizeDepth(depthStep);
float depthError = abs(linearDepthStep - linearDepth);
if (depthError > 0.2) {
normal = texture(normalMap, uv).xyz * 2.0 - 1.0;
angleCutoffAdjust = 0.004;
} else {
normal = normalize(cross(dFdx(pos), dFdy(pos)));
angleCutoffAdjust = 0.0;
}
float ddepth = fwidth(linearDepth);
depthDiscontinuityAlpha = 1.0 - smoothstep(0.0, 0.01, -ddepth / linearDepth);
return true;
}`),t.contrastControlEnabled?(n.uniforms.add(new l.N("frameColor",((e,t)=>e.colors)),new s.m("globalAlphaContrastBoost",(e=>null!=e.globalAlphaContrastBoost?e.globalAlphaContrastBoost:1))),n.code.add(a.H`float rgbToLuminance(vec3 color) {
return dot(vec3(0.2126, 0.7152, 0.0722), color);
}
vec4 laserlineOutput(vec4 color) {
float backgroundLuminance = rgbToLuminance(texture(frameColor, uv).rgb);
float alpha = clamp(globalAlpha * max(backgroundLuminance * globalAlphaContrastBoost, 1.0), 0.0, 1.0);
return color * alpha;
}`)):n.code.add(a.H`vec4 laserlineOutput(vec4 color) {
return color * globalAlpha;
}`)}},88416:function(e,t,n){"use strict";n.d(t,{L:function(){return s}});var i=n(20830),r=n(14543),o=n(39506);function s(e,t){if(!t.screenSizeEnabled)return;const n=e.vertex;(0,i.yu)(n,t),n.uniforms.add(new r.m("perScreenPixelRatio",((e,t)=>t.camera.perScreenPixelRatio)),new r.m("screenSizeScale",(e=>e.screenSizeScale))).code.add(o.H`float computeRenderPixelSizeAt( vec3 pWorld ){
vec3 viewForward = - vec3(view[0][2], view[1][2], view[2][2]);
float viewDirectionDistance = abs(dot(viewForward, pWorld - cameraPosition));
return viewDirectionDistance * perScreenPixelRatio;
}
vec3 screenSizeScaling(vec3 position, vec3 anchor){
return position * screenSizeScale * computeRenderPixelSizeAt(anchor) + anchor;
}`)}},77423:function(e,t,n){"use strict";n.d(t,{c:function(){return o}});var i=n(39506),r=n(65839);function o(e,t=!0){e.attributes.add(r.r.POSITION,"vec2"),t&&e.varyings.add("uv","vec2"),e.vertex.main.add(i.H`
      gl_Position = vec4(position, 0.0, 1.0);
      ${t?i.H`uv = position * 0.5 + vec2(0.5);`:""}
  `)}},27264:function(e,t,n){"use strict";var i;function r(e){return e===i.Shadow||e===i.ShadowHighlight||e===i.ShadowExcludeHighlight||e===i.ViewshedShadow}function o(e){return g(e)||e===i.Normal}function s(e){return function(e){return function(e){return u(e)||a(e)}(e)||m(e)}(e)||e===i.Normal}function a(e){return e===i.Highlight||e===i.ObjectAndLayerIdColor}function l(e){return c(e)||a(e)}function c(e){return e===i.Color}function u(e){return c(e)||_(e)}function h(e){return c(e)||e===i.ObjectAndLayerIdColor}function d(e){return c(e)||e===i.Highlight}function p(e){return d(e)||m(e)}function f(e){return c(e)||a(e)}function g(e){return f(e)||m(e)}function m(e){return e===i.Depth}function _(e){return e===i.ColorEmission}n.d(t,{CL:function(){return a},LG:function(){return _},MO:function(){return g},PJ:function(){return r},RN:function(){return u},V:function(){return i},XY:function(){return o},_o:function(){return c},aD:function(){return p},dX:function(){return f},eh:function(){return m},i3:function(){return l},iq:function(){return s},zW:function(){return h}}),function(e){e[e.Color=0]="Color",e[e.ColorEmission=1]="ColorEmission",e[e.Depth=2]="Depth",e[e.Normal=3]="Normal",e[e.Shadow=4]="Shadow",e[e.ShadowHighlight=5]="ShadowHighlight",e[e.ShadowExcludeHighlight=6]="ShadowExcludeHighlight",e[e.ViewshedShadow=7]="ViewshedShadow",e[e.Highlight=8]="Highlight",e[e.ObjectAndLayerIdColor=9]="ObjectAndLayerIdColor",e[e.COUNT=10]="COUNT"}(i||(i={}))},13668:function(e,t,n){"use strict";n.d(t,{HQ:function(){return c}});var i=n(73364),r=n(39714),o=n(20551),s=n(32501),a=n(4435),l=(n(82598),n(39506));function c(e,t){!function(e,t,...n){if(!t.hasSlicePlane){const n=l.H`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;return t.hasSliceInVertexProgram&&e.vertex.code.add(n),void e.fragment.code.add(n)}const i=l.H`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,r=l.H`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,o=t.hasSliceHighlight?l.H`
        ${r}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:l.H`#define highlightSlice(_color_, _pos_) (_color_)`;t.hasSliceInVertexProgram&&e.vertex.uniforms.add(...n).code.add(i),e.fragment.uniforms.add(...n).code.add(i),e.fragment.code.add(o)}(e,t,new a.W("slicePlaneOrigin",((e,n)=>function(e,t,n){if(null==n.slicePlane)return s.uY;const i=u(e,t,n),r=h(i,n.slicePlane),a=d(e,i,n);return null!=a?(0,o.t)(g,r,a):r}(t,e,n))),new a.W("slicePlaneBasis1",((e,n)=>p(t,e,n,n.slicePlane?.basis1))),new a.W("slicePlaneBasis2",((e,n)=>p(t,e,n,n.slicePlane?.basis2))))}function u(e,t,n){return e.instancedDoublePrecision?(0,o.i)(f,n.camera.viewInverseTransposeMatrix[3],n.camera.viewInverseTransposeMatrix[7],n.camera.viewInverseTransposeMatrix[11]):t.slicePlaneLocalOrigin}function h(e,t){return null!=e?(0,o.d)(g,t.origin,e):t.origin}function d(e,t,n){return e.hasSliceTranslatedView?null!=t?(0,i.Tl)(_,n.camera.viewMatrix,t):n.camera.viewMatrix:null}function p(e,t,n,i){if(null==i||null==n.slicePlane)return s.uY;const r=u(e,t,n),a=h(r,n.slicePlane),l=d(e,r,n);return null!=l?((0,o.g)(m,i,a),(0,o.t)(g,a,l),(0,o.t)(m,m,l),(0,o.d)(m,m,g)):i}l.Y;const f=(0,s.vt)(),g=(0,s.vt)(),m=(0,s.vt)(),_=(0,r.vt)()},34178:function(e,t,n){"use strict";n.d(t,{d:function(){return o}});var i=n(30087),r=n(39506);function o(e){(0,i.i$)(e),e.vertex.code.add(r.H`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`),e.vertex.code.add(r.H`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}},11377:function(e,t,n){"use strict";n.d(t,{W:function(){return i},Y:function(){return l}});var i,r,o=n(82547),s=n(39506),a=n(65839);function l(e,t){switch(t.normalType){case i.Compressed:e.attributes.add(a.r.NORMALCOMPRESSED,"vec2"),e.vertex.code.add(s.H`vec3 decompressNormal(vec2 normal) {
float z = 1.0 - abs(normal.x) - abs(normal.y);
return vec3(normal + sign(normal) * min(z, 0.0), z);
}
vec3 normalModel() {
return decompressNormal(normalCompressed);
}`);break;case i.Attribute:e.attributes.add(a.r.NORMAL,"vec3"),e.vertex.code.add(s.H`vec3 normalModel() {
return normal;
}`);break;case i.ScreenDerivative:e.fragment.code.add(s.H`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`);break;default:(0,o.Xb)(t.normalType);case i.COUNT:}}(r=i||(i={}))[r.Attribute=0]="Attribute",r[r.Compressed=1]="Compressed",r[r.ScreenDerivative=2]="ScreenDerivative",r[r.COUNT=3]="COUNT"},27271:function(e,t,n){"use strict";n.d(t,{g:function(){return s}});var i=n(27264),r=n(39506),o=n(65839);function s(e,t){if(t.output!==i.V.ObjectAndLayerIdColor)return e.vertex.code.add(r.H`void forwardObjectAndLayerIdColor() {}`),void e.fragment.code.add(r.H`void outputObjectAndLayerIdColor() {}`);const n=t.objectAndLayerIdColorInstanced;e.varyings.add("objectAndLayerIdColorVarying","vec4"),e.attributes.add(n?o.r.INSTANCEOBJECTANDLAYERIDCOLOR:o.r.OBJECTANDLAYERIDCOLOR,"vec4"),e.vertex.code.add(r.H`
    void forwardObjectAndLayerIdColor() {
      objectAndLayerIdColorVarying = ${n?"instanceObjectAndLayerIdColor":"objectAndLayerIdColor"} * 0.003921568627451;
    }`),e.fragment.code.add(r.H`void outputObjectAndLayerIdColor() {
fragColor = objectAndLayerIdColorVarying;
}`)}},91765:function(e,t,n){"use strict";n.d(t,{I:function(){return o}});var i=n(39506),r=n(65839);function o(e){e.attributes.add(r.r.POSITION,"vec3"),e.vertex.code.add(i.H`vec3 positionModel() { return position; }`)}},55123:function(e,t,n){"use strict";n.d(t,{s:function(){return u}});var i=n(58766),r=n(82598),o=n(14543),s=n(454),a=n(39506),l=n(65839);const c=8;function u(e,t){const n=e.vertex;n.uniforms.add(new o.m("intrinsicWidth",(e=>e.width))),t.vvSize?(e.attributes.add(l.r.SIZEFEATUREATTRIBUTE,"float"),n.uniforms.add(new r.t("vvSizeMinSize",(e=>e.vvSize.minSize)),new r.t("vvSizeMaxSize",(e=>e.vvSize.maxSize)),new r.t("vvSizeOffset",(e=>e.vvSize.offset)),new r.t("vvSizeFactor",(e=>e.vvSize.factor))),n.code.add(a.H`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(e.attributes.add(l.r.SIZE,"float"),n.code.add(a.H`float getSize(){
return intrinsicWidth * size;
}`)),t.vvOpacity?(e.attributes.add(l.r.OPACITYFEATUREATTRIBUTE,"float"),n.constants.add("vvOpacityNumber","int",8),n.uniforms.add(new s.x("vvOpacityValues",(e=>e.vvOpacity.values),c),new s.x("vvOpacityOpacities",(e=>e.vvOpacity.opacityValues),c)),n.code.add(a.H`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):n.code.add(a.H`vec4 applyOpacity( vec4 color ){
return color;
}`),t.vvColor?(e.include(i.A,t),e.attributes.add(l.r.COLORFEATUREATTRIBUTE,"float"),n.code.add(a.H`vec4 getColor(){
return applyOpacity(interpolateVVColor(colorFeatureAttribute));
}`)):(e.attributes.add(l.r.COLOR,"vec4"),n.code.add(a.H`vec4 getColor(){
return applyOpacity(color);
}`))}},2457:function(e,t,n){"use strict";n.d(t,{I:function(){return i},U:function(){return l}});var i,r,o=n(82547),s=n(39506),a=n(65839);function l(e,t){switch(t.textureCoordinateType){case i.Default:return e.attributes.add(a.r.UV0,"vec2"),e.varyings.add("vuv0","vec2"),void e.vertex.code.add(s.H`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case i.Compressed:return e.attributes.add(a.r.UV0,"vec2"),e.varyings.add("vuv0","vec2"),void e.vertex.code.add(s.H`vec2 getUV0() {
return uv0 / 16384.0;
}
void forwardTextureCoordinates() {
vuv0 = getUV0();
}`);case i.Atlas:return e.attributes.add(a.r.UV0,"vec2"),e.varyings.add("vuv0","vec2"),e.attributes.add(a.r.UVREGION,"vec4"),e.varyings.add("vuvRegion","vec4"),void e.vertex.code.add(s.H`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);default:(0,o.Xb)(t.textureCoordinateType);case i.None:return void e.vertex.code.add(s.H`void forwardTextureCoordinates() {}`);case i.COUNT:return}}(r=i||(i={}))[r.None=0]="None",r[r.Default=1]="Default",r[r.Atlas=2]="Atlas",r[r.Compressed=3]="Compressed",r[r.COUNT=4]="COUNT"},85709:function(e,t,n){"use strict";n.d(t,{c:function(){return o}});var i=n(39506),r=n(65839);function o(e,t){t.hasVertexColors?(e.attributes.add(r.r.COLOR,"vec4"),e.varyings.add("vColor","vec4"),e.vertex.code.add(i.H`void forwardVertexColor() { vColor = color; }`),e.vertex.code.add(i.H`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):e.vertex.code.add(i.H`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}},94211:function(e,t,n){"use strict";n.d(t,{Mh:function(){return h},Zo:function(){return d},gy:function(){return p}});var i=n(82547),r=n(87725),o=n(41546),s=n(11377),a=n(66299),l=n(39506),c=n(31190),u=n(78567);function h(e,t){switch(t.normalType){case s.W.Attribute:case s.W.Compressed:e.include(s.Y,t),e.varyings.add("vNormalWorld","vec3"),e.varyings.add("vNormalView","vec3"),e.vertex.uniforms.add(new c.h("transformNormalGlobalFromModel",(e=>e.transformNormalGlobalFromModel)),new u.k("transformNormalViewFromGlobal",(e=>e.transformNormalViewFromGlobal))),e.vertex.code.add(l.H`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`);break;case s.W.ScreenDerivative:e.vertex.code.add(l.H`void forwardNormal() {}`);break;default:(0,i.Xb)(t.normalType);case s.W.COUNT:}}class d extends a.dO{constructor(){super(...arguments),this.transformNormalViewFromGlobal=(0,r.vt)()}}class p extends a.EM{constructor(){super(...arguments),this.transformNormalGlobalFromModel=(0,r.vt)(),this.toMapSpace=(0,o.vt)()}}},66299:function(e,t,n){"use strict";n.d(t,{EM:function(){return m},dO:function(){return g},em:function(){return f}});var i=n(87725),r=n(39714),o=n(32501),s=n(91765),a=n(90576),l=n(4435),c=n(82598),u=n(39506),h=n(31190),d=n(78567),p=n(70340);function f(e,t){e.include(s.I);const n=e.vertex;n.include(a.u,t),e.varyings.add("vPositionWorldCameraRelative","vec3"),e.varyings.add("vPosition_view","vec3"),n.uniforms.add(new c.t("transformWorldFromViewTH",(e=>e.transformWorldFromViewTH)),new c.t("transformWorldFromViewTL",(e=>e.transformWorldFromViewTL)),new d.k("transformViewFromCameraRelativeRS",(e=>e.transformViewFromCameraRelativeRS)),new p.X("transformProjFromView",(e=>e.transformProjFromView)),new h.h("transformWorldFromModelRS",(e=>e.transformWorldFromModelRS)),new l.W("transformWorldFromModelTH",(e=>e.transformWorldFromModelTH)),new l.W("transformWorldFromModelTL",(e=>e.transformWorldFromModelTL))),n.code.add(u.H`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),n.code.add(u.H`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${t.spherical?u.H`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:u.H`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),e.fragment.uniforms.add(new c.t("transformWorldFromViewTL",(e=>e.transformWorldFromViewTL))),n.code.add(u.H`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),e.fragment.code.add(u.H`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}class g extends u.Y{constructor(){super(...arguments),this.transformWorldFromViewTH=(0,o.vt)(),this.transformWorldFromViewTL=(0,o.vt)(),this.transformViewFromCameraRelativeRS=(0,i.vt)(),this.transformProjFromView=(0,r.vt)()}}class m extends u.Y{constructor(){super(...arguments),this.transformWorldFromModelRS=(0,i.vt)(),this.transformWorldFromModelTH=(0,o.vt)(),this.transformWorldFromModelTL=(0,o.vt)()}}},28499:function(e,t,n){"use strict";n.d(t,{r:function(){return s}});var i=n(2457),r=n(39506);function o(e){e.fragment.code.add(r.H`vec4 textureAtlasLookup(sampler2D tex, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
return textureGrad(tex, uvAtlas, dUVdx, dUVdy);
}`)}function s(e,t){const{textureCoordinateType:n}=t;if(n===i.I.None||n===i.I.COUNT)return;e.include(i.U,t);const s=n===i.I.Atlas;s&&e.include(o),e.fragment.code.add(r.H`
    vec4 textureLookup(sampler2D tex, vec2 uv) {
      return ${s?"textureAtlasLookup(tex, uv, vuvRegion)":"texture(tex, uv)"};
    }
  `)}},74603:function(e,t,n){"use strict";n.d(t,{G:function(){return c},V:function(){return h}});var i=n(33400),r=n(41546),o=n(19202),s=n(20830),a=n(38917),l=n(39506);function c(e,t){const n=e.vertex;t.hasVerticalOffset?(h(n),t.hasScreenSizePerspective&&(e.include(o.Y6),(0,o.OH)(n),(0,s.yu)(e.vertex,t)),n.code.add(l.H`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${t.spherical?l.H`vec3 worldNormal = normalize(worldPos + localOrigin);`:l.H`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${t.hasScreenSizePerspective?l.H`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:l.H`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):n.code.add(l.H`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const u=(0,r.vt)();function h(e){e.uniforms.add(new a.E("verticalOffset",((e,t)=>{const{minWorldLength:n,maxWorldLength:r,screenLength:o}=e.verticalOffset,s=Math.tan(.5*t.camera.fovY)/(.5*t.camera.fullViewport[3]),a=t.camera.pixelRatio||1;return(0,i.s)(u,o*a,s,n,r)})))}},10155:function(e,t,n){"use strict";n.d(t,{K:function(){return o}});var i=n(45937),r=n(39506);function o(e){e.uniforms.add(new i.e("alignPixelEnabled",((e,t)=>t.alignPixelEnabled))),e.code.add(r.H`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`),e.code.add(r.H`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`)}},1143:function(e,t,n){"use strict";n.d(t,{Q:function(){return h},R:function(){return u}});var i=n(74603),r=n(19202),o=n(20830),s=n(38917),a=n(14543),l=n(39506),c=n(65839);const u=.5;function h(e,t){e.include(r.Y6),e.attributes.add(c.r.POSITION,"vec3"),e.attributes.add(c.r.NORMAL,"vec3"),e.attributes.add(c.r.CENTEROFFSETANDDISTANCE,"vec4");const n=e.vertex;(0,o.NB)(n,t),(0,o.yu)(n,t),n.uniforms.add(new s.E("viewport",((e,t)=>t.camera.fullViewport)),new a.m("polygonOffset",(e=>e.shaderPolygonOffset)),new a.m("cameraGroundRelative",((e,t)=>t.camera.aboveGround?1:-1))),t.hasVerticalOffset&&(0,i.V)(n),n.constants.add("smallOffsetAngle","float",.984807753012208),n.code.add(l.H`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),n.code.add(l.H`
    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
      float pointGroundSign = ${t.terrainDepthTest?l.H.float(0):l.H`sign(pointGroundDistance)`};
      if (pointGroundSign == 0.0) {
        pointGroundSign = cameraGroundRelative;
      }

      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground
      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise
      float groundRelative = cameraGroundRelative * pointGroundSign;

      // view angle dependent part of polygon offset emulation: we take the absolute value because the sign that is
      // dropped is instead introduced using the ground-relative position of the symbol and the camera
      if (polygonOffset > .0) {
        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
        float factor = (1.0 - tanAlpha / viewport[2]);

        // same side of the terrain
        if (groundRelative > 0.0) {
          posView *= factor;
        }
        // opposite sides of the terrain
        else {
          posView /= factor;
        }
      }

      return groundRelative;
    }
  `),t.draped&&!t.hasVerticalOffset||(0,o.S7)(n),t.draped||(n.uniforms.add(new a.m("perDistancePixelRatio",((e,t)=>Math.tan(t.camera.fovY/2)/(t.camera.fullViewport[2]/2)))),n.code.add(l.H`
    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
      float distanceToCamera = length(posView);

      // Compute offset in world units for a half pixel shift
      float pixelOffset = distanceToCamera * perDistancePixelRatio * ${l.H.float(u)};

      // Apply offset along normal in the direction away from the ground surface
      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;

      // Apply the same offset also on the view space position
      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;

      posModel += modelOffset;
      posView += viewOffset;
    }
  `)),t.screenCenterOffsetUnitsEnabled&&(0,o.Nz)(n),t.hasScreenSizePerspective&&(0,r.OH)(n),n.code.add(l.H`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      vec3 centerOffset = centerOffsetAndDistance.xyz;
      float pointGroundDistance = centerOffsetAndDistance.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${t.draped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${t.hasScreenSizePerspective&&(t.hasVerticalOffset||t.screenCenterOffsetUnitsEnabled)?"vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${t.hasVerticalOffset?t.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${t.hasVerticalOffset?l.H`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${t.screenCenterOffsetUnitsEnabled?"":l.H`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${t.screenCenterOffsetUnitsEnabled?t.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${t.screenCenterOffsetUnitsEnabled?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `)}},50399:function(e,t,n){"use strict";n.d(t,{I:function(){return s}});var i=n(10155),r=n(77771),o=n(39506);function s(e,t){const{vertex:n,fragment:s}=e;e.include(r.Z,t),n.include(i.K),t.terrainDepthTest&&e.varyings.add("depth","float"),n.main.add(o.H`
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${t.terrainDepthTest?o.H`depth = projectAux.posView.z;`:""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  `),s.main.add(o.H`fragColor = vec4(1);
if(terrainDepthTest(depth)) {
fragColor.g = 0.5;
}`)}},60808:function(e,t,n){"use strict";var i;n.d(t,{D:function(){return i}}),function(e){e[e.Occluded=0]="Occluded",e[e.NotOccluded=1]="NotOccluded",e[e.Both=2]="Both",e[e.COUNT=3]="COUNT"}(i||(i={}))},80231:function(e,t,n){"use strict";n.d(t,{y:function(){return c}});var i=n(10155),r=n(60808),o=n(38917),s=n(14543),a=n(39506),l=n(39838);function c(e){e.vertex.uniforms.add(new s.m("renderTransparentlyOccludedHUD",((e,t)=>t.hudRenderStyle===r.D.Occluded?1:t.hudRenderStyle===r.D.NotOccluded?0:.75)),new o.E("viewport",((e,t)=>t.camera.fullViewport)),new l.N("hudVisibilityTexture",((e,t)=>t.hudVisibility?.getTexture()))),e.vertex.include(i.K),e.vertex.code.add(a.H`bool testHUDVisibility(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}},38130:function(e,t,n){"use strict";n.d(t,{NL:function(){return p},ZX:function(){return i}});var i,r,o=n(27264),s=n(28499),a=n(4435),l=n(82598),c=n(39506),u=n(40075),h=n(39838),d=n(54516);function p(e,t){if(!(0,o.RN)(t.output))return;const{emissionSource:n,hasEmissiveTextureTransform:r,bindType:p}=t,f=n===i.Texture;f&&(e.include(s.r,t),e.fragment.uniforms.add(p===d.c.Pass?new h.N("texEmission",(e=>e.textureEmissive)):new u.o("texEmission",(e=>e.textureEmissive))));const g=n===i.Value||f;g&&e.fragment.uniforms.add(p===d.c.Pass?new l.t("emissionFactor",(e=>e.emissiveFactor)):new a.W("emissionFactor",(e=>e.emissiveFactor))),e.fragment.code.add(c.H`
    vec4 getEmissions() {
      vec4 emissions = ${g?"vec4(emissionFactor, 1.0)":"vec4(0.0)"};
      ${(0,c.If)(f,`emissions *= textureLookup(texEmission, ${r?"emissiveUV":"vuv0"});\n         emissions.w = emissions.rgb == vec3(0.0) ? 0.0: emissions.w;`)};
      return emissions;
    }
  `)}n(36634),(r=i||(i={}))[r.None=0]="None",r[r.Value=1]="Value",r[r.Texture=2]="Texture",r[r.COUNT=3]="COUNT"},84435:function(e,t,n){"use strict";n.d(t,{Q:function(){return l}});var i=n(27264),r=n(12511),o=n(50295),s=n(39506),a=n(39838);function l(e,t){const{fragment:n}=e;t.output===i.V.Highlight?(n.uniforms.add(new a.N("depthTexture",((e,t)=>t.mainDepth)),new a.N("highlightTexture",((e,t)=>t.highlightMixTexture)),new o.c("highlightLevel",((e,t)=>t.highlightLevel)),new r.g("highlightMixOrigin",((e,t)=>t.highlightMixOrigin))),e.outputs.add("fragHighlight","vec2",0),n.code.add(s.H`vec2 getAccumulatedHighlight() {
return texelFetch(highlightTexture, ivec2(gl_FragCoord.xy) - highlightMixOrigin, 0).rg;
}
void outputHighlight(bool occluded) {
if (highlightLevel == 0) {
uint bits = occluded ? 3u : 1u;
fragHighlight = vec2(float(bits) / 255.0, 0.0);
} else {
int ll = (highlightLevel & 3) << 1;
int li = (highlightLevel >> 2) & 3;
uint bits;
if (occluded) {
bits = 3u << ll;
} else {
bits = 1u << ll;
}
vec2 combinedHighlight = getAccumulatedHighlight();
uint accumulatedI = uint(combinedHighlight[li] * 255.0);
combinedHighlight[li] = float(bits | accumulatedI) / 255.0;
fragHighlight = combinedHighlight;
}
}
bool isHighlightOccluded() {
float sceneDepth = texelFetch(depthTexture, ivec2(gl_FragCoord.xy), 0).x;
return gl_FragCoord.z > sceneDepth + 5e-7;
}
void calculateOcclusionAndOutputHighlight() {
outputHighlight(isHighlightOccluded());
}`),t.canHaveOverlay&&(n.constants.add("occlusionAndMask","int",85),n.code.add(s.H`void outputAllHighlights(vec2 highlightToAdd) {
if (highlightToAdd == vec2(0.0)) { discard; }
int occludedOrMask = isHighlightOccluded() ? 0xaa : 0;
ivec2 added = ivec2(highlightToAdd * 255.0);
ivec2 masked = (added & ivec2(occlusionAndMask)) | (ivec2(occludedOrMask) & (added<<1));
fragHighlight = vec2(masked) / 255.0;
}`))):n.code.add(s.H`void calculateOcclusionAndOutputHighlight() {}`)}},23397:function(e,t,n){"use strict";n.d(t,{E:function(){return a}});var i=n(13786),r=n(1932),o=n(11687),s=n(39506);function a(e){e.uniforms.add(new o.G("zProjectionMap",((e,t)=>function(e){const t=e.projectionMatrix;return(0,i.hZ)(l,t[14],t[10])}(t.camera)))),e.code.add(s.H`float linearizeDepth(float depth) {
float depthNdc = depth * 2.0 - 1.0;
float c1 = zProjectionMap[0];
float c2 = zProjectionMap[1];
return -(c1 / (depthNdc + c2 + 1e-7));
}`),e.code.add(s.H`float depthFromTexture(sampler2D depthTexture, vec2 uv) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthTexture, 0)));
float depth = texelFetch(depthTexture, iuv, 0).r;
return depth;
}`),e.code.add(s.H`float linearDepthFromTexture(sampler2D depthTexture, vec2 uv) {
return linearizeDepth(depthFromTexture(depthTexture, uv));
}`)}const l=(0,r.vt)()},2120:function(e,t,n){"use strict";n.d(t,{v:function(){return o},z:function(){return r}});var i=n(39506);function r(e){e.fragment.code.add(i.H`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function o(e){e.fragment.code.add(i.H`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}},31166:function(e,t,n){"use strict";n.d(t,{q:function(){return f},h:function(){return g}});var i=n(52766),r=n(20830),o=n(38917),s=n(14543),a=n(39506),l=n(39838);function c(e){return e.pattern.map((t=>Math.round(t*e.pixelRatio)))}function u(e){return c(e).reduce(((e,t)=>Math.max(e,t)))}n(5161),n(85456),n(12285),n(10956);var h=n(33400),d=n(41546);const p=(0,d.vt)();function f(e,t){t.stippleEnabled?function(e,t){const n=!(t.draped&&t.stipplePreferContinuous),{vertex:c,fragment:f}=e;f.include(i.W),t.draped||((0,r.yu)(c,t),c.uniforms.add(new s.m("worldToScreenPerDistanceRatio",((e,t)=>1/t.camera.perScreenPixelRatio))),c.code.add(a.H`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),e.varyings.add("vStippleDistance","float"),e.varyings.add("vStippleDistanceLimits","vec2"),e.varyings.add("vStipplePatternStretch","float"),c.code.add(a.H`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${m};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),c.code.add(a.H`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),c.code.add(a.H`
    if (segmentLengthPseudoScreen >= ${n?"patternLength":"1e4"}) {
  `),(0,r.Nz)(c),c.code.add(a.H`float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
float segmentLengthScreenRounded = flooredRepetitions * patternLength;
float stretch = repetitions / flooredRepetitions;
vStipplePatternStretch = max(0.75, stretch);
return vec2(0.0, segmentLengthScreenRounded);
}
return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
}`),f.uniforms.add(new l.N("stipplePatternTexture",(e=>e.stippleTexture)),new s.m("stipplePatternSDFNormalizer",(e=>function(e){return e?(Math.floor(.5*(u(e)-1))+.5)/e.pixelRatio:1}(e.stipplePattern))),new s.m("stipplePatternPixelSizeInv",(e=>1/g(e)))),f.code.add(a.H`float getStippleSDF(out bool isClamped) {
float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;
float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv * vLineSizeInv;
u = fract(u);
float encodedSDF = rgba2float(texture(stipplePatternTexture, vec2(u, 0.5)));
float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;
return (sdf - 0.5) * vStipplePatternStretch + 0.5;
}
float getStippleSDF() {
bool ignored;
return getStippleSDF(ignored);
}
float getStippleAlpha() {
bool isClamped;
float stippleSDF = getStippleSDF(isClamped);
float antiAliasedResult = clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);
return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
}`),t.stippleOffColorEnabled?(f.uniforms.add(new o.E("stippleOffColor",(e=>function(e){return null==e?d.uY:4===e.length?e:(0,h.s)(p,e[0],e[1],e[2],1)}(e.stippleOffColor)))),f.code.add(a.H`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):f.code.add(a.H`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}(e,t):function(e){e.fragment.code.add(a.H`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}(e)}function g(e){const t=e.stipplePattern;return t?function(e){if(null==e)return 1;const t=c(e);return Math.floor(t.reduce(((e,t)=>e+t)))}(e.stipplePattern)/t.pixelRatio:1}const m=a.H.float(.4)},42426:function(e,t,n){"use strict";n.d(t,{Gc:function(){return o},O4:function(){return s},Vt:function(){return a}});var i=n(82598),r=n(39506);function o(e){e.uniforms.add(new i.t("mainLightDirection",((e,t)=>t.lighting.mainLight.direction)))}function s(e){e.uniforms.add(new i.t("mainLightIntensity",((e,t)=>t.lighting.mainLight.intensity)))}function a(e){o(e.fragment),s(e.fragment),e.fragment.code.add(r.H`vec3 applyShading(vec3 shadingNormalWorld, float shadow) {
float dotVal = clamp(dot(shadingNormalWorld, mainLightDirection), 0.0, 1.0);
return mainLightIntensity * ((1.0 - shadow) * dotVal);
}`)}},91981:function(e,t,n){"use strict";n.d(t,{r:function(){return l}});var i=n(33710),r=n(20830),o=n(14543),s=n(39506),a=n(50678);function l(e,t){const n=e.vertex;(0,r.Nz)(n),null==n.uniforms.get("markerScale")&&n.constants.add("markerScale","float",1),n.constants.add("markerSizePerLineWidth","float",i.PV).code.add(s.H`float getLineWidth() {
return max(getSize(), 1.0) * pixelRatio;
}
float getScreenMarkerSize() {
return markerSizePerLineWidth * markerScale * getLineWidth();
}`),t.space===a.lM.World&&(n.constants.add("maxSegmentLengthFraction","float",.45),n.uniforms.add(new o.m("perRenderPixelRatio",((e,t)=>t.camera.perRenderPixelRatio))),n.code.add(s.H`bool areWorldMarkersHidden(vec4 pos, vec4 other) {
vec3 midPoint = mix(pos.xyz, other.xyz, 0.5);
float distanceToCamera = length(midPoint);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
float worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;
float segmentLen = length(pos.xyz - other.xyz);
return worldMarkerSize > maxSegmentLengthFraction * segmentLen;
}
float getWorldMarkerSize(vec4 pos) {
float distanceToCamera = length(pos.xyz);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
return getScreenMarkerSize() * screenToWorldRatio;
}`))}},51942:function(e,t,n){"use strict";n.d(t,{c:function(){return a},f:function(){return l}});var i=n(39506);function r(e){const t=e.fragment.code;t.add(i.H`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),t.add(i.H`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),t.add(i.H`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}var o=n(11520),s=n(61629);function a(e,t){const n=e.fragment.code;e.include(s.p),t.pbrMode!==o.A9.Normal&&t.pbrMode!==o.A9.Schematic&&t.pbrMode!==o.A9.Simplified&&t.pbrMode!==o.A9.TerrainWithWater||(n.add(i.H`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),n.add(i.H`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`)),t.pbrMode!==o.A9.Normal&&t.pbrMode!==o.A9.Schematic||(e.include(r),n.add(i.H`struct PBRShadingInfo
{
float NdotV;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),n.add(i.H`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),n.add(i.H`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),n.add(i.H`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}function l(e,t){const n=e.fragment.code;e.include(s.p),n.add(i.H`
  struct PBRShadingWater
  {
      float NdotL;   // cos angle between normal and light direction
      float NdotV;   // cos angle between normal and view direction
      float NdotH;   // cos angle between normal and half vector
      float VdotH;   // cos angle between view direction and half vector
      float LdotH;   // cos angle between light direction and half vector
      float VdotN;   // cos angle between view direction and normal vector
  };

  float dtrExponent = ${t.useCustomDTRExponentForWater?"2.2":"2.0"};
  `),n.add(i.H`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),n.add(i.H`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),n.add(i.H`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),n.add(i.H`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze) * strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}`)}},11520:function(e,t,n){"use strict";n.d(t,{A9:function(){return i},_Z:function(){return p}});var i,r,o=n(28499),s=n(4435),a=n(82598),l=n(39506),c=n(40075),u=n(39838),h=n(54516),d=n(36634);function p(e,t){const n=t.pbrMode,r=e.fragment;if(n!==i.Schematic&&n!==i.Disabled&&n!==i.Normal)return void r.code.add(l.H`void applyPBRFactors() {}`);if(n===i.Disabled)return void r.code.add(l.H`void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`);if(n===i.Schematic)return void r.code.add(l.H`vec3 mrr = vec3(0.0, 0.6, 0.2);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`);const{hasMetallicRoughnessTexture:d,hasMetallicRoughnessTextureTransform:p,hasOcclusionTexture:f,hasOcclusionTextureTransform:g,bindType:m}=t;(d||f)&&e.include(o.r,t),r.code.add(l.H`vec3 mrr;
float occlusion;`),d&&r.uniforms.add(m===h.c.Pass?new u.N("texMetallicRoughness",(e=>e.textureMetallicRoughness)):new c.o("texMetallicRoughness",(e=>e.textureMetallicRoughness))),f&&r.uniforms.add(m===h.c.Pass?new u.N("texOcclusion",(e=>e.textureOcclusion)):new c.o("texOcclusion",(e=>e.textureOcclusion))),r.uniforms.add(m===h.c.Pass?new a.t("mrrFactors",(e=>e.mrrFactors)):new s.W("mrrFactors",(e=>e.mrrFactors))),r.code.add(l.H`
    ${(0,l.If)(d,l.H`void applyMetallicRoughness(vec2 uv) {
            vec3 metallicRoughness = textureLookup(texMetallicRoughness, uv).rgb;
            mrr[0] *= metallicRoughness.b;
            mrr[1] *= metallicRoughness.g;
          }`)}

    ${(0,l.If)(f,"void applyOcclusion(vec2 uv) { occlusion *= textureLookup(texOcclusion, uv).r; }")}

    float getBakedOcclusion() {
      return ${f?"occlusion":"1.0"};
    }

    void applyPBRFactors() {
      mrr = mrrFactors;
      occlusion = 1.0;

      ${(0,l.If)(d,`applyMetallicRoughness(${p?"metallicRoughnessUV":"vuv0"});`)}
      ${(0,l.If)(f,`applyOcclusion(${g?"occlusionUV":"vuv0"});`)}
    }
  `)}n(27539),(r=i||(i={}))[r.Disabled=0]="Disabled",r[r.Normal=1]="Normal",r[r.Schematic=2]="Schematic",r[r.Water=3]="Water",r[r.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",r[r.Simplified=5]="Simplified",r[r.TerrainWithWater=6]="TerrainWithWater",r[r.COUNT=7]="COUNT",d.NV},61629:function(e,t,n){"use strict";function i(e){const t=3.141592653589793,n=.3183098861837907;e.vertex.constants.add("PI","float",t),e.fragment.constants.add("PI","float",t),e.fragment.constants.add("LIGHT_NORMALIZATION","float",n),e.fragment.constants.add("INV_PI","float",n),e.fragment.constants.add("HALF_PI","float",1.570796326794897),e.fragment.constants.add("TWO_PI","float",6.28318530717958)}n.d(t,{p:function(){return i}})},3088:function(e,t,n){"use strict";n.d(t,{O:function(){return i},b:function(){return r}});const i=3e5,r=5e5},77771:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var i=n(23397),r=n(39506),o=n(39838);function s(e,{occlusionPass:t,terrainDepthTest:n,cullAboveTerrain:s}){n?(e.fragment.include(i.E),e.fragment.uniforms.add(new o.N("terrainDepthTexture",((e,t)=>t.terrainDepth?.attachment))).code.add(r.H`
   ${t?"bool":"void"} terrainDepthTest(float fragmentDepth) {
      float depth = texelFetch(terrainDepthTexture, ivec2(gl_FragCoord.xy), 0).r;
      float linearDepth = linearizeDepth(depth);
      ${t?r.H`return fragmentDepth < linearDepth && depth < 1.0;`:r.H`if(fragmentDepth ${s?">":"<="} linearDepth) discard;`}
    }`)):t?e.fragment.code.add(r.H`#define terrainDepthTest(fragmentDepth) false`):e.fragment.code.add(r.H`#define terrainDepthTest(fragmentDepth) {}`)}},58766:function(e,t,n){"use strict";n.d(t,{A:function(){return u}});var i=n(82598),r=n(30636),o=n(454),s=n(39506),a=n(78567),l=n(65839),c=n(77971);function u(e,t){const{vertex:n,attributes:u}=e;t.hasVvInstancing&&(t.vvSize||t.vvColor)&&u.add(l.r.INSTANCEFEATUREATTRIBUTE,"vec4"),t.vvSize?(n.uniforms.add(new i.t("vvSizeMinSize",(e=>e.vvSize.minSize))),n.uniforms.add(new i.t("vvSizeMaxSize",(e=>e.vvSize.maxSize))),n.uniforms.add(new i.t("vvSizeOffset",(e=>e.vvSize.offset))),n.uniforms.add(new i.t("vvSizeFactor",(e=>e.vvSize.factor))),n.uniforms.add(new a.k("vvSymbolRotationMatrix",(e=>e.vvSymbolRotationMatrix))),n.uniforms.add(new i.t("vvSymbolAnchor",(e=>e.vvSymbolAnchor))),n.code.add(s.H`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),n.code.add(s.H`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${t.hasVvInstancing?s.H`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):n.code.add(s.H`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),t.vvColor?(n.constants.add("vvColorNumber","int",c.p),n.uniforms.add(new o.x("vvColorValues",(e=>e.vvColor.values),c.p),new r.F("vvColorColors",(e=>e.vvColor.colors),c.p)),n.code.add(s.H`
      vec4 interpolateVVColor(float value) {
        if (value <= vvColorValues[0]) {
          return vvColorColors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (vvColorValues[i] >= value) {
            float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
            return mix(vvColorColors[i-1], vvColorColors[i], f);
          }
        }
        return vvColorColors[vvColorNumber - 1];
      }

      vec4 vvGetColor(vec4 featureAttribute) {
        return interpolateVVColor(featureAttribute.y);
      }

      ${t.hasVvInstancing?s.H`
            vec4 vvColor() {
              return vvGetColor(instanceFeatureAttribute);
            }`:"vec4 vvColor() { return vec4(1.0); }"}
    `)):n.code.add(s.H`vec4 vvColor() { return vec4(1.0); }`)}},5830:function(e,t,n){"use strict";n.d(t,{E:function(){return O}});var i=n(2120),r=n(39506);function o(e){e.fragment.code.add(r.H`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}var s=n(51942),a=n(3088),l=n(23397),c=n(11687),u=n(14543),h=n(70340),d=n(39838);function p(e,t){if(!t.screenSpaceReflections)return;const n=e.fragment;n.include(l.E),n.uniforms.add(new c.G("nearFar",((e,t)=>t.camera.nearFar)),new d.N("depthMap",((e,t)=>t.depth?.attachment)),new h.X("proj",((e,t)=>t.camera.projectionMatrix)),new u.m("invResolutionHeight",((e,t)=>1/t.camera.height)),new h.X("reprojectionMatrix",((e,t)=>t.ssr.reprojectionMatrix))).code.add(r.H`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${t.highStepCount?"150":"75"};

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P = clamp(P + dP, vec2(0.0), vec2(0.999));
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}var f=n(32501),g=n(43587),m=n(1616),_=n(75256),v=n(58192),y=n(42426),b=n(45937),T=n(82598),x=n(65312),w=n(54516);class S extends x.n{constructor(e,t){super(e,"samplerCube",w.c.Pass,((n,i,r)=>n.bindTexture(e,t(i,r))))}}function E(e){const t=e.fragment;t.constants.add("radiusCloudsSquared","float",A).code.add(r.H`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos) {
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusCloudsSquared;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
return (cameraPosition + dir * pointIntDist) - spherePos;
}`),t.uniforms.add(new u.m("radiusCurvatureCorrection",((e,t)=>t.clouds.parallax.radiusCurvatureCorrection))).code.add(r.H`vec3 correctForPlanetCurvature(vec3 dir) {
dir.z = dir.z * (1.0 - radiusCurvatureCorrection) + radiusCurvatureCorrection;
return dir;
}`),t.code.add(r.H`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec) {
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),(0,y.Gc)(t),(0,y.O4)(t);const n=(0,f.fA)(.28,.175,.035);t.constants.add("RIM_COLOR","vec3",n),t.code.add(r.H`
    vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds) {
      float upDotLight = dot(cameraPosition, mainLightDirection);
      float dirDotLight = max(dot(worldSpaceRay, mainLightDirection), 0.0);
      float sunsetTransition = clamp(pow(max(upDotLight, 0.0), ${r.H.float(.3)}), 0.0, 1.0);

      // Base color of the clouds that depends on lighting of the sun and sky
      vec3 ambientLight = calculateAmbientIrradiance(cameraPosition,  0.0);
      vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
      vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));

      // Rim light around the edge of the clouds simulating scattering of the direct lun light
      float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
      float rimLightIntensity = 0.5 + 0.5 * pow(max(upDotLight, 0.0), 0.35);
      vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, ${r.H.float(140)})) * scatteringMod;

      // Brighten the clouds around the sun at the sunsets
      float additionalLight = ${r.H.float(.2)} * pow(dirDotLight, ${r.H.float(10)}) * (1. - pow(sunsetTransition, ${r.H.float(.3)})) ;

      return vec3(baseCloudColor * (1.0 + additionalLight) + directSunScattering);
    }
  `),t.uniforms.add(new b.e("readChannelsRG",((e,t)=>t.clouds.readChannels===m.c.RG)),new S("cubeMap",((e,t)=>t.clouds.data?.cubeMap?.colorTexture??null))).code.add(r.H`vec4 sampleCloud(vec3 rayDir, bool readOtherChannel) {
vec4 s = texture(cubeMap, rayDir);
bool readRG = readChannelsRG ^^ readOtherChannel;
s = readRG ? vec4(vec3(s.r), s.g) : vec4(vec3(s.b), s.a);
return length(s) == 0.0 ? vec4(s.rgb, 1.0) : s;
}`),t.uniforms.add(new T.t("anchorPoint",((e,t)=>t.clouds.parallax.anchorPoint)),new T.t("anchorPointNew",((e,t)=>t.clouds.parallaxNew.anchorPoint)),new h.X("rotationClouds",((e,t)=>t.clouds.parallax.transform)),new h.X("rotationCloudsNew",((e,t)=>t.clouds.parallaxNew.transform)),new u.m("cloudsOpacity",((e,t)=>t.clouds.opacity)),new u.m("fadeFactor",((e,t)=>t.clouds.fadeFactor)),new b.e("crossFade",((e,t)=>t.clouds.fadeState===_.c.CROSS_FADE))).code.add(r.H`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition) {
vec3 intersectionPoint = intersectWithCloudLayer(worldRay, cameraPosition, anchorPoint);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = sampleCloud(worldRayRotatedCorrected, crossFade);
vec3 cameraPositionN = normalize(cameraPosition);
vec4 cloudColor = vec4(calculateCloudColor(cameraPositionN, worldRay, cloudData), cloudData.a);
if(crossFade) {
intersectionPoint = intersectWithCloudLayer(worldRay, cameraPosition, anchorPointNew);
worldRayRotated = rotateDirectionToAnchorPoint(rotationCloudsNew, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = sampleCloud(worldRayRotatedCorrected, false);
vec4 cloudColorNew = vec4(calculateCloudColor(cameraPositionN, worldRay, cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorNew, fadeFactor);
}
float totalTransmittance = length(cloudColor.rgb) == 0.0 ?
1.0 :
clamp(cloudColor.a * cloudsOpacity + (1.0 - cloudsOpacity), 0.0 , 1.0);
return vec4(cloudColor.rgb, totalTransmittance);
}`)}const A=(g.$O.radius+v.k9)**2;function M(e){e.code.add(r.H`vec3 tonemapACES(vec3 x) {
return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
}`)}function O(e,t){e.include(s.f,t),e.include(o),e.include(i.v),t.cloudReflections&&e.include(E),e.include(p,t);const n=e.fragment;n.include(M),n.constants.add("fresnelSky","vec3",[.02,1,15]),n.constants.add("fresnelMaterial","vec2",[.02,.1]),n.constants.add("roughness","float",.015),n.constants.add("foamIntensityExternal","float",1.7),n.constants.add("ssrIntensity","float",.65),n.constants.add("ssrHeightFadeStart","float",a.O),n.constants.add("ssrHeightFadeEnd","float",a.b),n.constants.add("waterDiffusion","float",.92),n.constants.add("waterSeaColorMod","float",.8),n.constants.add("correctionViewingPowerFactor","float",.4),n.constants.add("skyZenitColor","vec3",[.52,.68,.9]),n.constants.add("skyColor","vec3",[.67,.79,.9]),n.constants.add("cloudFresnelModifier","vec2",[1.2,.01]),n.code.add(r.H`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),n.uniforms.add(new u.m("lightingSpecularStrength",((e,t)=>t.lighting.mainLight.specularStrength)),new u.m("lightingEnvironmentStrength",((e,t)=>t.lighting.mainLight.environmentStrength))),n.code.add(r.H`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
float NdotL = clamp(dot(n, l), 0.0, 1.0);
specular = lightingSpecularStrength * NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),t.cloudReflections&&n.uniforms.add(new u.m("cloudsOpacity",((e,t)=>t.clouds.opacity))).code.add(r.H`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y * cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * cloudsOpacity;`),t.screenSpaceReflections?n.uniforms.add(new h.X("view",((e,t)=>t.camera.viewMatrix)),new d.N("lastFrameColorTexture",((e,t)=>t.ssr.lastFrameColor?.getTexture())),new u.m("fadeFactorSSR",((e,t)=>t.ssr.fadeFactor))).code.add(r.H`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view * vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view * vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactorSSR;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture(lastFrameColorTexture, reprojectedCoordinate).xyz) *
reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +
reflSea * seaColorMod + specular + foam);`):n.code.add(r.H`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),t.cloudReflections?t.screenSpaceReflections?n.code.add(r.H`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):n.code.add(r.H`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):n.code.add(r.H`return waterRenderedColor;
}`)}},28686:function(e,t,n){"use strict";n.d(t,{Q:function(){return i}});const i=1/255.5},82316:function(e,t,n){"use strict";n.d(t,{Ir:function(){return u}});var i=n(13786),r=n(1932),o=n(33400),s=n(41546),a=n(11687),l=n(38917),c=n(39506);function u(e){e.fragment.uniforms.add(new l.E("projInfo",((e,t)=>function(e){const t=e.projectionMatrix;return 0===t[11]?(0,o.s)(h,2/(e.fullWidth*t[0]),2/(e.fullHeight*t[5]),(1+t[12])/t[0],(1+t[13])/t[5]):(0,o.s)(h,-2/(e.fullWidth*t[0]),-2/(e.fullHeight*t[5]),(1-t[8])/t[0],(1-t[9])/t[5])}(t.camera)))),e.fragment.uniforms.add(new a.G("zScale",((e,t)=>function(e){return 0===e.projectionMatrix[11]?(0,i.hZ)(d,0,1):(0,i.hZ)(d,1,0)}(t.camera)))),e.fragment.code.add(c.H`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}const h=(0,s.vt)(),d=(0,r.vt)()},23864:function(e,t,n){"use strict";n.d(t,{a:function(){return r}});var i=n(39506);function r(e){e.code.add(i.H`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}},90576:function(e,t,n){"use strict";n.d(t,{u:function(){return r}});var i=n(39506);function r({code:e},t){t.doublePrecisionRequiresObfuscation?e.add(i.H`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):e.add(i.H`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}},52766:function(e,t,n){"use strict";n.d(t,{W:function(){return r}});var i=n(39506);function r(e){e.code.add(i.H`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}`),e.code.add(i.H`const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`),e.code.add(i.H`const vec4 uninterpolatedRGBAToFloatFactors = vec4(
1.0 / 256.0,
1.0 / 256.0 / 256.0,
1.0 / 256.0 / 256.0 / 256.0,
1.0 / 256.0 / 256.0 / 256.0 / 256.0
);
float uninterpolatedRGBAToFloat(vec4 rgba) {
return (dot(round(rgba * 255.0), uninterpolatedRGBAToFloatFactors) - 0.5) * 2.0;
}`)}},19202:function(e,t,n){"use strict";n.d(t,{OH:function(){return c},Y6:function(){return a},pM:function(){return l}});var i=n(20551),r=n(32501),o=n(82598),s=n(39506);function a(e){e.vertex.code.add(s.H`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),e.vertex.code.add(s.H`vec3 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec3 params) {
return vec3(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z
);
}`),e.vertex.code.add(s.H`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),e.vertex.code.add(s.H`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),e.vertex.code.add(s.H`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),e.vertex.code.add(s.H`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function l(e){e.uniforms.add(new o.t("screenSizePerspective",(e=>u(e.screenSizePerspective))))}function c(e){e.uniforms.add(new o.t("screenSizePerspectiveAlignment",(e=>u(e.screenSizePerspectiveAlignment||e.screenSizePerspective))))}function u(e){return(0,i.i)(h,e.parameters.divisor,e.parameters.offset,e.minScaleFactor)}const h=(0,r.vt)()},20830:function(e,t,n){"use strict";n.d(t,{yu:function(){return f},Nz:function(){return y},NB:function(){return g},S7:function(){return v}});var i=n(73364),r=n(39714),o=n(20551),s=n(32501),a=n(4435),l=n(82598),c=n(14543),u=n(65312),h=n(54516);class d extends u.n{constructor(e,t){super(e,"mat4",h.c.Draw,((n,i,r)=>n.setUniformMatrix4fv(e,t(i,r))))}}var p=n(70340);function f(e,t){t.instancedDoublePrecision?e.constants.add("cameraPosition","vec3",s.uY):e.uniforms.add(new a.W("cameraPosition",((e,t)=>(0,o.i)(_,t.camera.viewInverseTransposeMatrix[3]-e.origin[0],t.camera.viewInverseTransposeMatrix[7]-e.origin[1],t.camera.viewInverseTransposeMatrix[11]-e.origin[2]))))}function g(e,t){if(!t.instancedDoublePrecision)return void e.uniforms.add(new p.X("proj",((e,t)=>t.camera.projectionMatrix)),new d("view",((e,t)=>(0,i.Tl)(m,t.camera.viewMatrix,e.origin))),new a.W("localOrigin",(e=>e.origin)));const n=e=>(0,o.i)(_,e.camera.viewInverseTransposeMatrix[3],e.camera.viewInverseTransposeMatrix[7],e.camera.viewInverseTransposeMatrix[11]);e.uniforms.add(new p.X("proj",((e,t)=>t.camera.projectionMatrix)),new p.X("view",((e,t)=>(0,i.Tl)(m,t.camera.viewMatrix,n(t)))),new l.t("localOrigin",((e,t)=>n(t))))}const m=(0,r.vt)(),_=(0,s.vt)();function v(e){e.uniforms.add(new p.X("viewNormal",((e,t)=>t.camera.viewInverseTransposeMatrix)))}function y(e){e.uniforms.add(new c.m("pixelRatio",((e,t)=>t.camera.pixelRatio/t.overlayStretch)))}},45937:function(e,t,n){"use strict";n.d(t,{e:function(){return o}});var i=n(65312),r=n(54516);class o extends i.n{constructor(e,t){super(e,"bool",r.c.Pass,((n,i,r)=>n.setUniform1b(e,t(i,r))))}}},30262:function(e,t,n){"use strict";n.d(t,{t:function(){return o}});var i=n(65312),r=n(54516);class o extends i.n{constructor(e,t){super(e,"vec2",r.c.Draw,((n,i,r,o)=>n.setUniform2fv(e,t(i,r,o))))}}},11687:function(e,t,n){"use strict";n.d(t,{G:function(){return o}});var i=n(65312),r=n(54516);class o extends i.n{constructor(e,t){super(e,"vec2",r.c.Pass,((n,i,r)=>n.setUniform2fv(e,t(i,r))))}}},4435:function(e,t,n){"use strict";n.d(t,{W:function(){return o}});var i=n(65312),r=n(54516);class o extends i.n{constructor(e,t){super(e,"vec3",r.c.Draw,((n,i,r,o)=>n.setUniform3fv(e,t(i,r,o))))}}},82598:function(e,t,n){"use strict";n.d(t,{t:function(){return o}});var i=n(65312),r=n(54516);class o extends i.n{constructor(e,t){super(e,"vec3",r.c.Pass,((n,i,r)=>n.setUniform3fv(e,t(i,r))))}}},41356:function(e,t,n){"use strict";n.d(t,{V:function(){return o}});var i=n(65312),r=n(54516);class o extends i.n{constructor(e,t){super(e,"vec4",r.c.Draw,((n,i,r)=>n.setUniform4fv(e,t(i,r))))}}},38917:function(e,t,n){"use strict";n.d(t,{E:function(){return o}});var i=n(65312),r=n(54516);class o extends i.n{constructor(e,t){super(e,"vec4",r.c.Pass,((n,i,r)=>n.setUniform4fv(e,t(i,r))))}}},30636:function(e,t,n){"use strict";n.d(t,{F:function(){return o}});var i=n(65312),r=n(54516);class o extends i.n{constructor(e,t,n){super(e,"vec4",r.c.Pass,((n,i,r)=>n.setUniform4fv(e,t(i,r))),n)}}},14543:function(e,t,n){"use strict";n.d(t,{m:function(){return o}});var i=n(65312),r=n(54516);class o extends i.n{constructor(e,t){super(e,"float",r.c.Pass,((n,i,r)=>n.setUniform1f(e,t(i,r))))}}},454:function(e,t,n){"use strict";n.d(t,{x:function(){return o}});var i=n(65312),r=n(54516);class o extends i.n{constructor(e,t,n){super(e,"float",r.c.Pass,((n,i,r)=>n.setUniform1fv(e,t(i,r))),n)}}},12511:function(e,t,n){"use strict";n.d(t,{g:function(){return o}});var i=n(65312),r=n(54516);class o extends i.n{constructor(e,t){super(e,"ivec2",r.c.Pass,((n,i,r)=>n.setUniform2iv(e,t(i,r))))}}},50295:function(e,t,n){"use strict";n.d(t,{c:function(){return o}});var i=n(65312),r=n(54516);class o extends i.n{constructor(e,t){super(e,"int",r.c.Pass,((n,i,r)=>n.setUniform1i(e,t(i,r))))}}},31190:function(e,t,n){"use strict";n.d(t,{h:function(){return o}});var i=n(65312),r=n(54516);class o extends i.n{constructor(e,t){super(e,"mat3",r.c.Draw,((n,i,r)=>n.setUniformMatrix3fv(e,t(i,r))))}}},78567:function(e,t,n){"use strict";n.d(t,{k:function(){return o}});var i=n(65312),r=n(54516);class o extends i.n{constructor(e,t){super(e,"mat3",r.c.Pass,((n,i,r)=>n.setUniformMatrix3fv(e,t(i,r))))}}},70340:function(e,t,n){"use strict";n.d(t,{X:function(){return o}});var i=n(65312),r=n(54516);class o extends i.n{constructor(e,t){super(e,"mat4",r.c.Pass,((n,i,r)=>n.setUniformMatrix4fv(e,t(i,r))))}}},62988:function(e,t,n){"use strict";n.d(t,{N5:function(){return l}});var i=n(39819),r=(n(58941),n(40633)),o=n(54516),s=n(90553);class a{constructor(){this._includedModules=new Map}include(e,t){this._includedModules.has(e)?this._includedModules.get(e):(this._includedModules.set(e,t),e(this.builder,t))}}class l extends a{constructor(){super(...arguments),this.vertex=new d,this.fragment=new d,this.attributes=new p,this.varyings=new f,this.extensions=new g,this.outputs=new m}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(e){const t=this.extensions.generateSource(e),n=this.attributes.generateSource(e),i=this.varyings.generateSource(e),r="vertex"===e?this.vertex:this.fragment,o=r.uniforms.generateSource(),s=r.code.generateSource(),a=r.main.generateSource(),l="vertex"===e?y:v,c=r.constants.generateSource(),u=this.outputs.generateSource(e);return`#version 300 es\n${t.join("\n")}\n\n${l}\n\n${c.join("\n")}\n\n${o.join("\n")}\n\n${n.join("\n")}\n\n${i.join("\n")}\n\n${u.join("\n")}\n\n${s.join("\n")}\n\n${a.join("\n")}`}generateBindPass(e){const t=new Map;this.vertex.uniforms.entries.forEach((e=>{const n=e.bind[o.c.Pass];n&&t.set(e.name,n)})),this.fragment.uniforms.entries.forEach((e=>{const n=e.bind[o.c.Pass];n&&t.set(e.name,n)}));const n=Array.from(t.values()),i=n.length;return(t,r)=>{for(let o=0;o<i;++o)n[o](e,t,r)}}generateBindDraw(e){const t=new Map;this.vertex.uniforms.entries.forEach((e=>{const n=e.bind[o.c.Draw];n&&t.set(e.name,n)})),this.fragment.uniforms.entries.forEach((e=>{const n=e.bind[o.c.Draw];n&&t.set(e.name,n)}));const n=Array.from(t.values()),i=n.length;return(t,r,o)=>{for(let s=0;s<i;++s)n[s](e,o,t,r)}}}class c{constructor(e){this._stage=e,this._entries=new Map}add(...e){for(const t of e)this._add(t);return this._stage}get(e){return this._entries.get(e)}_add(e){if(null!=e){if(this._entries.has(e.name)&&!this._entries.get(e.name).equals(e))throw new i.A(`Duplicate uniform name ${e.name} for different uniform type`);this._entries.set(e.name,e)}else r.A.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder").error(`Trying to add null Uniform from ${(new Error).stack}.`)}generateSource(){return Array.from(this._entries.values()).map((e=>null!=e.arraySize?`uniform ${e.type} ${e.name}[${e.arraySize}];`:`uniform ${e.type} ${e.name};`))}get entries(){return Array.from(this._entries.values())}}class u{constructor(e){this._stage=e,this._bodies=new Array}add(e){return this._bodies.push(e),this._stage}generateSource(){if(this._bodies.length>0)return[`void main() {\n ${this._bodies.join("\n")||""} \n}`];throw new i.A("Shader does not contain main function body.")}}class h{constructor(e){this._stage=e,this._entries=new Array}add(e){return this._entries.push(e),this._stage}generateSource(){return this._entries}}class d extends a{constructor(){super(...arguments),this.uniforms=new c(this),this.main=new u(this),this.code=new h(this),this.constants=new _(this)}get builder(){return this}}class p{constructor(){this._entries=new Array}add(e,t){this._entries.push([e,t])}generateSource(e){return"fragment"===e?[]:this._entries.map((e=>`in ${e[1]} ${e[0]};`))}}class f{constructor(){this._entries=new Map}add(e,t){this._entries.has(e)&&(0,s.vA)(this._entries.get(e)===t),this._entries.set(e,t)}generateSource(e){const t=new Array;return this._entries.forEach(((n,i)=>t.push("vertex"===e?`out ${n} ${i};`:`in ${n} ${i};`))),t}}class g{constructor(){this._entries=new Set}add(e){this._entries.add(e)}generateSource(e){const t="vertex"===e?g.ALLOWLIST_VERTEX:g.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter((e=>t.includes(e))).map((e=>`#extension ${e} : enable`))}}g.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],g.ALLOWLIST_VERTEX=[];class m{constructor(){this._entries=new Map}add(e,t,n=0){const i=this._entries.get(n);i?(0,s.vA)(i.name===e&&i.type===t,`Fragment shader output location ${n} occupied`):this._entries.set(n,{name:e,type:t})}generateSource(e){if("vertex"===e)return[];0===this._entries.size&&this._entries.set(0,{name:m.DEFAULT_NAME,type:m.DEFAULT_TYPE});const t=new Array;return this._entries.forEach(((e,n)=>t.push(`layout(location = ${n}) out ${e.type} ${e.name};`))),t}}m.DEFAULT_TYPE="vec4",m.DEFAULT_NAME="fragColor";class _{constructor(e){this._stage=e,this._entries=new Set}add(e,t,n){let i="ERROR_CONSTRUCTOR_STRING";switch(t){case"float":i=_._numberToFloatStr(n);break;case"int":i=_._numberToIntStr(n);break;case"bool":i=n.toString();break;case"vec2":i=`vec2(${_._numberToFloatStr(n[0])},                            ${_._numberToFloatStr(n[1])})`;break;case"vec3":i=`vec3(${_._numberToFloatStr(n[0])},                            ${_._numberToFloatStr(n[1])},                            ${_._numberToFloatStr(n[2])})`;break;case"vec4":i=`vec4(${_._numberToFloatStr(n[0])},                            ${_._numberToFloatStr(n[1])},                            ${_._numberToFloatStr(n[2])},                            ${_._numberToFloatStr(n[3])})`;break;case"ivec2":i=`ivec2(${_._numberToIntStr(n[0])},                             ${_._numberToIntStr(n[1])})`;break;case"ivec3":i=`ivec3(${_._numberToIntStr(n[0])},                             ${_._numberToIntStr(n[1])},                             ${_._numberToIntStr(n[2])})`;break;case"ivec4":i=`ivec4(${_._numberToIntStr(n[0])},                             ${_._numberToIntStr(n[1])},                             ${_._numberToIntStr(n[2])},                             ${_._numberToIntStr(n[3])})`;break;case"mat2":case"mat3":case"mat4":i=`${t}(${Array.prototype.map.call(n,(e=>_._numberToFloatStr(e))).join(", ")})`}return this._entries.add(`const ${t} ${e} = ${i};`),this._stage}static _numberToIntStr(e){return e.toFixed(0)}static _numberToFloatStr(e){return Number.isInteger(e)?e.toFixed(1):e.toString()}generateSource(){return Array.from(this._entries)}}const v="#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif",y="precision highp float;\nprecision highp sampler2D;"},40075:function(e,t,n){"use strict";n.d(t,{o:function(){return o}});var i=n(65312),r=n(54516);class o extends i.n{constructor(e,t){super(e,"sampler2D",r.c.Draw,((n,i,r)=>n.bindTexture(e,t(i,r))))}}},39838:function(e,t,n){"use strict";n.d(t,{N:function(){return o}});var i=n(65312),r=n(54516);class o extends i.n{constructor(e,t){super(e,"sampler2D",r.c.Pass,((n,i,r)=>n.bindTexture(e,t(i,r))))}}},65312:function(e,t,n){"use strict";n.d(t,{n:function(){return r}});var i=n(54516);class r{constructor(e,t,n,r,o=null){if(this.name=e,this.type=t,this.arraySize=o,this.bind={[i.c.Pass]:null,[i.c.Draw]:null},r)switch(n){case i.c.Pass:this.bind[i.c.Pass]=r;break;case i.c.Draw:this.bind[i.c.Draw]=r}}equals(e){return this.type===e.type&&this.name===e.name&&this.arraySize===e.arraySize}}},39506:function(e,t,n){"use strict";n.d(t,{H:function(){return r},If:function(){return o},Y:function(){return i}});const i=class{};function r(e,...t){let n="";for(let i=0;i<t.length;i++)n+=e[i]+t[i];return n+=e[e.length-1],n}function o(e,t,n=""){return e?t:n}var s;(s=r||(r={})).int=function(e){return Math.round(e).toString()},s.float=function(e){return e.toPrecision(8)}},54516:function(e,t,n){"use strict";var i;n.d(t,{c:function(){return i}}),function(e){e[e.Pass=0]="Pass",e[e.Draw=1]="Draw"}(i||(i={}))},34615:function(e,t,n){"use strict";n.d(t,{$:function(){return i}});class i{constructor(e,t){this._module=e,this._load=t}get(){return this._module}async reload(){return this._module=await this._load(),this._module}}},82273:function(e,t,n){"use strict";n.d(t,{w:function(){return u}});var i=n(95929),r=n(40502),o=n(7187),s=n(41835);class a{constructor(e,t,n){this._context=e,this._locations=n,this._textures=new Map,this._freeTextureUnits=new o.A({deallocator:null}),this._glProgram=e.programCache.acquire(t.generate("vertex"),t.generate("fragment"),n),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bindPass=t.generateBindPass(this),this.bindDraw=t.generateBindDraw(this),this._fragmentUniforms=(0,s.en)()?t.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get hasTransformFeedbackVaryings(){return this._glProgram.hasTransformFeedbackVaryings}get compiled(){return this._glProgram.compiled}setUniform1b(e,t){this._glProgram.setUniform1i(e,t?1:0)}setUniform1i(e,t){this._glProgram.setUniform1i(e,t)}setUniform1f(e,t){this._glProgram.setUniform1f(e,t)}setUniform2fv(e,t){this._glProgram.setUniform2fv(e,t)}setUniform3fv(e,t){this._glProgram.setUniform3fv(e,t)}setUniform4fv(e,t){this._glProgram.setUniform4fv(e,t)}setUniformMatrix3fv(e,t){this._glProgram.setUniformMatrix3fv(e,t)}setUniformMatrix4fv(e,t){this._glProgram.setUniformMatrix4fv(e,t)}setUniform1fv(e,t){this._glProgram.setUniform1fv(e,t)}setUniform1iv(e,t){this._glProgram.setUniform1iv(e,t)}setUniform2iv(e,t){this._glProgram.setUniform2iv(e,t)}setUniform3iv(e,t){this._glProgram.setUniform3iv(e,t)}setUniform4iv(e,t){this._glProgram.setUniform4iv(e,t)}assertCompatibleVertexAttributeLocations(e){e.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(e,t){if(null==t?.glName){const t=this._textures.get(e);return t&&(this._context.bindTexture(null,t.unit),this._freeTextureUnit(t),this._textures.delete(e)),null}let n=this._textures.get(e);return null==n?(n=this._allocTextureUnit(t),this._textures.set(e,n)):n.texture=t,this._context.useProgram(this),this.setUniform1i(e,n.unit),this._context.bindTexture(t,n.unit),n.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach(((e,t)=>{this._context.bindTexture(e.texture,e.unit),this.setUniform1i(t,e.unit)})),this._fragmentUniforms?.forEach((e=>{"sampler2D"!==e.type&&"samplerCube"!==e.type||this._textures.has(e.name)||console.error(`Texture sampler ${e.name} has no bound texture`)}))}_allocTextureUnit(e){return{texture:e,unit:0===this._freeTextureUnits.length?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(e){this._freeTextureUnits.push(e.unit)}}var l=n(85456),c=n(57087);class u{constructor(e,t,n,o,s=r.D){this.release=o,this.locations=s,this.primitiveType=l.WR.TRIANGLES,this.key=t.key,this._program=new a(e.rctx,n.get().build(t),s),this._pipeline=this.initializePipeline(t),this.reload=async r=>{if(r&&await n.reload(),!this.key.equals(t.key))throw new Error("Configuration was changed after construction, cannot reload shader");(0,i.WD)(this._program),this._program=new a(e.rctx,n.get().build(t),s),this._pipeline=this.initializePipeline(t)}}destroy(){this._program=(0,i.WD)(this._program),this._pipeline=null}get program(){return this._program}get compiled(){return this.program.compiled}ensureAttributeLocations(e){this.program.assertCompatibleVertexAttributeLocations(e)}getPipeline(e,t){return this._pipeline}initializePipeline(e){return(0,c.Ey)({blending:c.Os,colorWrite:c.kn})}}},65875:function(e,t,n){"use strict";n.d(t,{K:function(){return a},W:function(){return l}});var i=n(39819),r=n(39506),o=n(50659);class s{constructor(e){this._bits=[...e]}equals(e){return(0,o.aI)(this._bits,e.bits)}get code(){return this._code??=String.fromCharCode(...this._bits),this._code}get bits(){return this._bits}}class a extends r.Y{constructor(){super(),this._parameterBits=this._parameterBits?.map((()=>0))??[],this._parameterNames??=[]}get key(){return this._key??=new s(this._parameterBits),this._key}decode(e=this.key){const t=this._parameterBits;this._parameterBits=[...e.bits];const n=this._parameterNames.map((e=>`    ${e}: ${this[e]}`)).join("\n");return this._parameterBits=t,n}}function l(e={}){return(t,n)=>{t.hasOwnProperty("_parameterNames")||Object.defineProperty(t,"_parameterNames",{value:t._parameterNames?.slice()??[],configurable:!0,writable:!0}),t.hasOwnProperty("_parameterBits")||Object.defineProperty(t,"_parameterBits",{value:t._parameterBits?.slice()??[0],configurable:!0,writable:!0}),t._parameterNames.push(n);const r=e.count||2,o=Math.ceil(Math.log2(r)),s=t._parameterBits;let a=0;for(;s[a]+o>16;)a++,a>=s.length&&s.push(0);const l=s[a],c=(1<<o)-1<<l;s[a]+=o,e.count?Object.defineProperty(t,n,{get(){return(this._parameterBits[a]&c)>>l},set(t){if(this[n]!==t){if(this._key=null,this._parameterBits[a]=this._parameterBits[a]&~c|+t<<l&c,"number"!=typeof t)throw new i.A(`Configuration value for ${n} must be a number, got ${typeof t}`);if(null==e.count)throw new i.A(`Configuration value for ${n} must provide a count option`)}}}):Object.defineProperty(t,n,{get(){return!!((this._parameterBits[a]&c)>>l)},set(e){if(this[n]!==e&&(this._key=null,this._parameterBits[a]=this._parameterBits[a]&~c|+e<<l&c,"boolean"!=typeof e))throw new i.A(`Configuration value for ${n} must be boolean, got ${typeof e}`)}})}}},67521:function(e,t,n){"use strict";n.d(t,{Cc:function(){return l},RW:function(){return a},VM:function(){return c}});var i=n(83525),r=n(27264);const o={required:[]};r.V.Depth;class s extends i.A{precompile(e){const t=this.acquireTechniques(e);return c(t),null!=t}consumes(){return o}get usedMemory(){return 0}get isDecoration(){return!1}get running(){return!1}modify(e){}get numGeometries(){return 0}get hasOccludees(){return!1}get hasEmissions(){return!1}forEachGeometry(e){}queryRenderOccludedState(e){return!1}}class a extends s{}class l extends s{}function c(e){Array.isArray(e)?e.forEach((e=>e?.release())):e?.release()}},39534:function(e,t,n){"use strict";n.d(t,{E:function(){return r}});var i=n(58941);function r(){return!!(0,i.A)("enable-feature:objectAndLayerId-rendering")}},14905:function(e,t,n){"use strict";n.d(t,{K:function(){return i},n:function(){return r}});class i{constructor(e,t,n=t){this.data=e,this.size=t,this.stride=n}}class r extends i{constructor(e,t,n,i=!1,r=n){super(e,n,r),this.indices=t,this.exclusive=i}}},89932:function(e,t,n){"use strict";n.d(t,{S:function(){return r}});var i=n(24540);function r(e){if(e.length<i.y9)return Array.from(e);if((0,i.cy)(e))return Float64Array.from(e);if(!("BYTES_PER_ELEMENT"in e))return Array.from(e);switch(e.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(e);case 2:return(0,i.jq)(e)?Uint16Array.from(e):Int16Array.from(e);case 4:return Float32Array.from(e);default:return Float64Array.from(e)}}},53905:function(e,t,n){"use strict";n.d(t,{j:function(){return a}});var i=n(7187),r=n(20551),o=n(32501),s=n(90553);class a{constructor(e,t,n){this.primitiveIndices=e,this._numIndexPerPrimitive=t,this.position=n,this._children=void 0,(0,s.vA)(e.length>=1),(0,s.vA)(3===n.size||4===n.size);const{data:i,size:a,indices:c}=n;(0,s.vA)(c.length%this._numIndexPerPrimitive==0),(0,s.vA)(c.length>=e.length*this._numIndexPerPrimitive);const u=e.length;let h=a*c[this._numIndexPerPrimitive*e[0]];l.clear(),l.push(h);const d=(0,o.fA)(i[h],i[h+1],i[h+2]),p=(0,o.o8)(d);for(let t=0;t<u;++t){const n=this._numIndexPerPrimitive*e[t];for(let e=0;e<this._numIndexPerPrimitive;++e){h=a*c[n+e],l.push(h);let t=i[h];d[0]=Math.min(t,d[0]),p[0]=Math.max(t,p[0]),t=i[h+1],d[1]=Math.min(t,d[1]),p[1]=Math.max(t,p[1]),t=i[h+2],d[2]=Math.min(t,d[2]),p[2]=Math.max(t,p[2])}}this.bbMin=d,this.bbMax=p;const f=(0,r.m)((0,o.vt)(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(p[0]-d[0],p[1]-d[1]),p[2]-d[2]);let g=this.radius*this.radius;for(let e=0;e<l.length;++e){h=l.at(e);const t=i[h]-f[0],n=i[h+1]-f[1],r=i[h+2]-f[2],o=t*t+n*n+r*r;if(o<=g)continue;const s=Math.sqrt(o),a=.5*(s-this.radius);this.radius=this.radius+a,g=this.radius*this.radius;const c=a/s;f[0]+=t*c,f[1]+=n*c,f[2]+=r*c}this.center=f,l.clear()}getChildren(){if(this._children||(0,r.s)(this.bbMin,this.bbMax)<=1)return this._children;const e=(0,r.m)((0,o.vt)(),this.bbMin,this.bbMax,.5),t=this.primitiveIndices.length,n=new Uint8Array(t),i=new Array(8);for(let e=0;e<8;++e)i[e]=0;const{data:s,size:l,indices:c}=this.position;for(let r=0;r<t;++r){let t=0;const o=this._numIndexPerPrimitive*this.primitiveIndices[r];let a=l*c[o],u=s[a],h=s[a+1],d=s[a+2];for(let e=1;e<this._numIndexPerPrimitive;++e){a=l*c[o+e];const t=s[a],n=s[a+1],i=s[a+2];t<u&&(u=t),n<h&&(h=n),i<d&&(d=i)}u<e[0]&&(t|=1),h<e[1]&&(t|=2),d<e[2]&&(t|=4),n[r]=t,++i[t]}let u=0;for(let e=0;e<8;++e)i[e]>0&&++u;if(u<2)return;const h=new Array(8);for(let e=0;e<8;++e)h[e]=i[e]>0?new Uint32Array(i[e]):void 0;for(let e=0;e<8;++e)i[e]=0;for(let e=0;e<t;++e){const t=n[e];h[t][i[t]++]=this.primitiveIndices[e]}this._children=new Array;for(let e=0;e<8;++e)void 0!==h[e]&&this._children.push(new a(h[e],this._numIndexPerPrimitive,this.position));return this._children}static prune(){l.prune()}}const l=new i.A({deallocator:null})},23545:function(e,t,n){"use strict";n.d(t,{VR:function(){return r},a0:function(){return s}});var i=n(7187);class r{constructor(){this.adds=new i.A,this.removes=new i.A,this.updates=new i.A({allocator:e=>e||new o,deallocator:e=>(e.renderGeometry=null,e)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}get empty(){return 0===this.adds.length&&0===this.removes.length&&0===this.updates.length}}class o{}class s{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}}},48015:function(e,t,n){"use strict";n.d(t,{J:function(){return r}});var i=n(11231);class r{constructor(){this.id=(0,i.c)()}}},40359:function(e,t,n){"use strict";var i;n.d(t,{X:function(){return i}}),function(e){e[e.Layer=0]="Layer",e[e.Object=1]="Object",e[e.Mesh=2]="Mesh",e[e.Line=3]="Line",e[e.Point=4]="Point",e[e.Material=5]="Material",e[e.Texture=6]="Texture",e[e.COUNT=7]="COUNT"}(i||(i={}))},40502:function(e,t,n){"use strict";n.d(t,{D:function(){return r}});var i=n(65839);const r=new Map([[i.r.POSITION,0],[i.r.NORMAL,1],[i.r.NORMALCOMPRESSED,1],[i.r.UV0,2],[i.r.COLOR,3],[i.r.COLORFEATUREATTRIBUTE,3],[i.r.SIZE,4],[i.r.TANGENT,4],[i.r.CENTEROFFSETANDDISTANCE,5],[i.r.SYMBOLCOLOR,5],[i.r.FEATUREATTRIBUTE,6],[i.r.INSTANCEFEATUREATTRIBUTE,6],[i.r.INSTANCECOLOR,7],[i.r.OBJECTANDLAYERIDCOLOR,7],[i.r.INSTANCEOBJECTANDLAYERIDCOLOR,7],[i.r.ROTATION,8],[i.r.INSTANCEMODEL,8],[i.r.INSTANCEMODELNORMAL,12],[i.r.INSTANCEMODELORIGINHI,11],[i.r.INSTANCEMODELORIGINLO,15]])},4875:function(e,t,n){"use strict";n.d(t,{A:function(){return r}});var i=n(54407);class r{constructor(e){this._material=e.material,this._techniques=e.techniques,this._output=e.output}dispose(){}get _stippleTextures(){return this._techniques.context.stippleTextures}get _markerTextures(){return this._techniques.context.markerTextures}acquireTechnique(e,t){return this._techniques.acquire(e,this._material.getConfiguration(this._output,t))}ensureResources(e){return i.Am.LOADED}}},52798:function(e,t,n){"use strict";n.d(t,{c:function(){return r}});var i=n(54407);class r{constructor(e,t){this._material=e,this._repository=t,this._map=new Map}dispose(){this._map.forEach(((e,t)=>{null!=e&&this._repository.release(this._material,t)}))}load(e,t,n){const r=this._material.produces.get(t);if(!r?.(n))return null;this._map.has(n)||this._map.set(n,this._repository.acquire(this._material,t,n));const o=this._map.get(n);if(null!=o){if(o.ensureResources(e)===i.Am.LOADED)return o;this._repository.requestRender()}return null}}},36634:function(e,t,n){"use strict";n.d(t,{NV:function(){return u},m8:function(){return l}});var i=n(95929),r=n(60539),o=n(39506),s=n(54407),a=n(4875);class l extends a.A{constructor(e){super(e),this._numLoading=0,this._disposed=!1,this._textures=e.textures,this._textureId=e.textureId,this._acquire(e.textureId,(e=>this._texture=e)),this._acquire(e.normalTextureId,(e=>this._textureNormal=e)),this._acquire(e.emissiveTextureId,(e=>this._textureEmissive=e)),this._acquire(e.occlusionTextureId,(e=>this._textureOcclusion=e)),this._acquire(e.metallicRoughnessTextureId,(e=>this._textureMetallicRoughness=e))}dispose(){super.dispose(),this._texture=(0,i.Gz)(this._texture),this._textureNormal=(0,i.Gz)(this._textureNormal),this._textureEmissive=(0,i.Gz)(this._textureEmissive),this._textureOcclusion=(0,i.Gz)(this._textureOcclusion),this._textureMetallicRoughness=(0,i.Gz)(this._textureMetallicRoughness),this._disposed=!0}ensureResources(e){return 0===this._numLoading?s.Am.LOADED:s.Am.LOADING}get textureBindParameters(){return new u(null!=this._texture?this._texture.glTexture:null,null!=this._textureNormal?this._textureNormal.glTexture:null,null!=this._textureEmissive?this._textureEmissive.glTexture:null,null!=this._textureOcclusion?this._textureOcclusion.glTexture:null,null!=this._textureMetallicRoughness?this._textureMetallicRoughness.glTexture:null)}updateTexture(e){null!=this._texture&&e===this._texture.id||(this._texture=(0,i.Gz)(this._texture),this._textureId=e,this._acquire(this._textureId,(e=>this._texture=e)))}_acquire(e,t){if(null==e)return void t(null);const n=this._textures.acquire(e);if((0,r.$X)(n))return++this._numLoading,void n.then((e=>{if(this._disposed)return(0,i.Gz)(e),void t(null);t(e)})).finally((()=>--this._numLoading));t(n)}}class c extends o.Y{constructor(e=null){super(),this.textureEmissive=e}}class u extends c{constructor(e=null,t=null,n=null,i=null,r=null,o,s){super(n),this.texture=e,this.textureNormal=t,this.textureOcclusion=i,this.textureMetallicRoughness=r,this.scale=o,this.normalTextureTransformMatrix=s}}},89769:function(e,t,n){"use strict";n.d(t,{V:function(){return y}});var i=n(39714),r=n(20551),o=n(37819),s=n(89932),a=n(53905),l=n(48015),c=n(40359),u=n(32501),h=n(67496);const d=(0,u.vt)(),p=(0,u.vt)(),f=(0,u.vt)(),g=(0,u.vt)();var m=n(84321),_=n(90553),v=n(65839);class y extends l.J{constructor(e,t,n=null,i=c.X.Mesh,r=null,s=-1){super(),this.material=e,this.mapPositions=n,this.type=i,this.objectAndLayerIdColor=r,this.edgeIndicesLength=s,this.highlights=new Set,this._highlightGroupCounts=new Map,this.visible=!0,this._attributes=new Map,this._boundingInfo=null;for(const[e,n]of t)this._attributes.set(e,{...n,indices:(0,o.Dg)(n.indices)}),e===v.r.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._attributes.get(e).indices.length:this.edgeIndicesLength)}instantiate(e={}){const t=new y(e.material||this.material,[],this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);return this._attributes.forEach(((e,n)=>{e.exclusive=!1,t._attributes.set(n,e)})),t._boundingInfo=this._boundingInfo,t.transformation=e.transformation||this.transformation,t}get attributes(){return this._attributes}getMutableAttribute(e){let t=this._attributes.get(e);return t&&!t.exclusive&&(t={...t,exclusive:!0,data:(0,s.S)(t.data)},this._attributes.set(e,t)),t}setAttributeData(e,t){const n=this._attributes.get(e);n&&this._attributes.set(e,{...n,exclusive:!0,data:t})}get indexCount(){const e=this._attributes.values().next().value.indices;return e?.length??0}get faceCount(){return this.indexCount/3}get boundingInfo(){return null==this._boundingInfo&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(e){return!!(this.type===c.X.Mesh?this._computeAttachmentOriginTriangles(e):this.type===c.X.Line?this._computeAttachmentOriginLines(e):this._computeAttachmentOriginPoints(e))&&(null!=this._transformation&&(0,r.t)(e,e,this._transformation),!0)}_computeAttachmentOriginTriangles(e){return function(e,t){if(!e)return!1;const{size:n,data:i,indices:o}=e;(0,r.i)(t,0,0,0),(0,r.i)(g,0,0,0);let s=0,a=0;for(let e=0;e<o.length-2;e+=3){const l=o[e]*n,c=o[e+1]*n,u=o[e+2]*n;(0,r.i)(d,i[l],i[l+1],i[l+2]),(0,r.i)(p,i[c],i[c+1],i[c+2]),(0,r.i)(f,i[u],i[u+1],i[u+2]);const m=(0,h.Q7)(d,p,f);m?((0,r.g)(d,d,p),(0,r.g)(d,d,f),(0,r.h)(d,d,1/3*m),(0,r.g)(t,t,d),s+=m):((0,r.g)(g,g,d),(0,r.g)(g,g,p),(0,r.g)(g,g,f),a+=3)}return!(0===a&&0===s||(0!==s?((0,r.h)(t,t,1/s),0):0===a||((0,r.h)(t,g,1/a),0)))}(this.attributes.get(v.r.POSITION),e)}_computeAttachmentOriginLines(e){const t=this.attributes.get(v.r.POSITION);return function(e,t,n){if(!e)return!1;(0,r.i)(n,0,0,0),(0,r.i)(g,0,0,0);let i=0,o=0;const{size:s,data:a,indices:l}=e,c=l.length-1,u=c+(t?2:0);for(let e=0;e<u;e+=2){const t=e<c?e+1:0,u=l[e<c?e:c]*s,h=l[t]*s;d[0]=a[u],d[1]=a[u+1],d[2]=a[u+2],p[0]=a[h],p[1]=a[h+1],p[2]=a[h+2],(0,r.h)(d,(0,r.g)(d,d,p),.5);const f=(0,r.F)(d,p);f>0?((0,r.g)(n,n,(0,r.h)(d,d,f)),i+=f):0===i&&((0,r.g)(g,g,d),o++)}return 0!==i?((0,r.h)(n,n,1/i),!0):0!==o&&((0,r.h)(n,g,1/o),!0)}(t,function(e,t){return!(!("isClosed"in e)||!e.isClosed)&&t.indices.length>2}(this.material.parameters,t),e)}_computeAttachmentOriginPoints(e){return function(e,t){if(!e)return!1;const{size:n,data:i,indices:o}=e;(0,r.i)(t,0,0,0);let s=-1,a=0;for(let e=0;e<o.length;e++){const r=o[e]*n;s!==r&&(t[0]+=i[r],t[1]+=i[r+1],t[2]+=i[r+2],a++),s=r}return a>1&&(0,r.h)(t,t,1/a),a>0}(this.attributes.get(v.r.POSITION),e)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const e=this.attributes.get(v.r.POSITION);if(!e||0===e.indices.length)return null;const t=this.type===c.X.Mesh?3:1;(0,_.vA)(e.indices.length%t==0,"Indexing error: "+e.indices.length+" not divisible by "+t);const n=(0,o.tM)(e.indices.length/t);return new a.j(n,t,e)}get transformation(){return this._transformation??i.zK}set transformation(e){this._transformation=e&&e!==i.zK?(0,i.o8)(e):null}get highlightGroups(){return this._highlightGroupCounts}get hasHighlights(){return this._highlightGroupCounts.size>0}foreachHighlightGroup(e){this._highlightGroupCounts.forEach(((t,n)=>e(n)))}allocateIdAndHighlight(e){const t=new m.h(e);return this.addHighlight(t)}addHighlight(e){this.highlights.add(e);const{highlightGroupName:t}=e,n=(this._highlightGroupCounts.get(t)??0)+1;return this._highlightGroupCounts.set(t,n),e}removeHighlight(e){if(this.highlights.delete(e)){const{highlightGroupName:t}=e,n=this._highlightGroupCounts.get(t)??0;n<=1?this._highlightGroupCounts.delete(t):this._highlightGroupCounts.set(t,n-1)}}}},8470:function(e,t,n){"use strict";n.d(t,{zC:function(){return ie},C1:function(){return S},EE:function(){return X},YG:function(){return Y},nW:function(){return Q},td:function(){return R},_B:function(){return te},Nq:function(){return J},DJ:function(){return Z},uX:function(){return j},Z8:function(){return ee},CM:function(){return $},Gj:function(){return q},Ho:function(){return G},Nb:function(){return K},Xl:function(){return oe},xh:function(){return ne}});var i,r=n(20551),o=n(43274),s=n(32501),a=n(50240),l=n(5047),c=n(37819),u=n(5596),h=n(79578),d=n(14905);!function(e){e.length=function(e,t){const n=e[t],i=e[t+1],r=e[t+2];return Math.sqrt(n*n+i*i+r*r)},e.normalize=function(e,t){const n=e[t],i=e[t+1],r=e[t+2],o=1/Math.sqrt(n*n+i*i+r*r);e[t]*=o,e[t+1]*=o,e[t+2]*=o},e.scale=function(e,t,n){e[t]*=n,e[t+1]*=n,e[t+2]*=n},e.add=function(e,t,n,i,r,o=t){(r=r||e)[o]=e[t]+n[i],r[o+1]=e[t+1]+n[i+1],r[o+2]=e[t+2]+n[i+2]},e.subtract=function(e,t,n,i,r,o=t){(r=r||e)[o]=e[t]-n[i],r[o+1]=e[t+1]-n[i+1],r[o+2]=e[t+2]-n[i+2]}}(i||(i={}));var p=n(40359),f=n(89769),g=n(90553),m=n(65839);const _=i,v=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],y=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],b=[0,0,1,0,1,1,0,1],T=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],x=new Array(36);for(let e=0;e<6;e++)for(let t=0;t<6;t++)x[6*e+t]=e;const w=new Array(36);for(let e=0;e<6;e++)w[6*e]=0,w[6*e+1]=1,w[6*e+2]=2,w[6*e+3]=2,w[6*e+4]=3,w[6*e+5]=0;function S(e,t){Array.isArray(t)||(t=[t,t,t]);const n=new Array(24);for(let e=0;e<8;e++)n[3*e]=v[e][0]*t[0],n[3*e+1]=v[e][1]*t[1],n[3*e+2]=v[e][2]*t[2];return new f.V(e,[[m.r.POSITION,new d.n(n,T,3,!0)],[m.r.NORMAL,new d.n(y,x,3)],[m.r.UV0,new d.n(b,w,2)]])}const E=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],A=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],M=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],O=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];function R(e,t){Array.isArray(t)||(t=[t,t,t]);const n=new Array(18);for(let e=0;e<6;e++)n[3*e]=E[e][0]*t[0],n[3*e+1]=E[e][1]*t[1],n[3*e+2]=E[e][2]*t[2];return new f.V(e,[[m.r.POSITION,new d.n(n,M,3,!0)],[m.r.NORMAL,new d.n(A,O,3)]])}const C=(0,o.fA)(-.5,0,-.5),I=(0,o.fA)(.5,0,-.5),P=(0,o.fA)(0,0,.5),D=(0,o.fA)(0,.5,0),L=(0,o.vt)(),N=(0,o.vt)(),F=(0,o.vt)(),z=(0,o.vt)(),H=(0,o.vt)();(0,r.d)(L,C,D),(0,r.d)(N,C,I),(0,r.e)(F,L,N),(0,r.n)(F,F),(0,r.d)(L,I,D),(0,r.d)(N,I,P),(0,r.e)(z,L,N),(0,r.n)(z,z),(0,r.d)(L,P,D),(0,r.d)(N,P,C),(0,r.e)(H,L,N),(0,r.n)(H,H);const V=[C,I,P,D],U=[0,-1,0,F[0],F[1],F[2],z[0],z[1],z[2],H[0],H[1],H[2]],k=[0,1,2,3,1,0,3,2,1,3,0,2],B=[0,0,0,1,1,1,2,2,2,3,3,3];function G(e,t){Array.isArray(t)||(t=[t,t,t]);const n=new Array(12);for(let e=0;e<4;e++)n[3*e]=V[e][0]*t[0],n[3*e+1]=V[e][1]*t[1],n[3*e+2]=V[e][2]*t[2];return new f.V(e,[[m.r.POSITION,new d.n(n,k,3,!0)],[m.r.NORMAL,new d.n(U,B,3)]])}function $(e,t,n,i,r={uv:!0}){const o=-Math.PI,s=2*Math.PI,a=-Math.PI/2,u=Math.PI,h=Math.max(3,Math.floor(n)),p=Math.max(2,Math.floor(i)),g=(h+1)*(p+1),_=(0,l.oe)(3*g),v=(0,l.oe)(3*g),y=(0,l.oe)(2*g),b=[];let T=0;for(let e=0;e<=p;e++){const n=[],i=e/p,r=a+i*u,l=Math.cos(r);for(let e=0;e<=h;e++){const a=e/h,c=o+a*s,u=Math.cos(c)*l,d=Math.sin(r),p=-Math.sin(c)*l;_[3*T]=u*t,_[3*T+1]=d*t,_[3*T+2]=p*t,v[3*T]=u,v[3*T+1]=d,v[3*T+2]=p,y[2*T]=a,y[2*T+1]=i,n.push(T),++T}b.push(n)}const x=new Array;for(let e=0;e<p;e++)for(let t=0;t<h;t++){const n=b[e][t],i=b[e][t+1],r=b[e+1][t+1],o=b[e+1][t];0===e?(x.push(n),x.push(r),x.push(o)):e===p-1?(x.push(n),x.push(i),x.push(r)):(x.push(n),x.push(i),x.push(r),x.push(r),x.push(o),x.push(n))}const w=[[m.r.POSITION,new d.n(_,x,3,!0)],[m.r.NORMAL,new d.n(v,x,3,!0)]];return r.uv&&w.push([m.r.UV0,new d.n(y,x,2,!0)]),r.offset&&(w[0][0]=m.r.OFFSET,w.push([m.r.POSITION,new d.n(Float64Array.from(r.offset),(0,c.EH)(x.length),3,!0)])),new f.V(e,w)}function j(e,t,n,i){const r=function(e,t,n){const i=e;let r,o;if(n)r=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],o=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const e=i*(1+Math.sqrt(5))/2;r=[-i,e,0,i,e,0,-i,-e,0,i,-e,0,0,-i,e,0,i,e,0,-i,-e,0,i,-e,e,0,-i,e,0,i,-e,0,-i,-e,0,i],o=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let t=0;t<r.length;t+=3)_.scale(r,t,e/_.length(r,t));let s={};function a(t,n){t>n&&([t,n]=[n,t]);const i=t.toString()+"."+n.toString();if(s[i])return s[i];let o=r.length;return r.length+=3,_.add(r,3*t,r,3*n,r,o),_.scale(r,o,e/_.length(r,o)),o/=3,s[i]=o,o}for(let e=0;e<t;e++){const e=o.length,t=new Array(4*e);for(let n=0;n<e;n+=3){const e=o[n],i=o[n+1],r=o[n+2],s=a(e,i),l=a(i,r),c=a(r,e),u=4*n;t[u]=e,t[u+1]=s,t[u+2]=c,t[u+3]=i,t[u+4]=l,t[u+5]=s,t[u+6]=r,t[u+7]=c,t[u+8]=l,t[u+9]=s,t[u+10]=l,t[u+11]=c}o=t,s={}}const c=(0,l.Wz)(r);for(let e=0;e<c.length;e+=3)_.normalize(c,e);return[[m.r.POSITION,new d.n((0,l.Wz)(r),o,3,!0)],[m.r.NORMAL,new d.n(c,o,3,!0)]]}(t,n,i);return new f.V(e,r)}function Z(e,t,n,i,r,o,a,l,u,h=null){const g=n?(0,s.o8)(n):(0,s.vt)(),_=t?(0,s.o8)(t):(0,s.fA)(0,0,1),v=i?[255*i[0],255*i[1],255*i[2],i.length>3?255*i[3]:255]:[255,255,255,255],y=null!=o&&2===o.length?o:[1,1],b=null!=r?[r]:[0],T=(0,c.EH)(1),x=[[m.r.POSITION,new d.n(g,T,3,!0)],[m.r.NORMAL,new d.n(_,T,3,!0)],[m.r.COLOR,new d.n(v,T,4,!0)],[m.r.SIZE,new d.n(y,T,2)],[m.r.ROTATION,new d.n(b,T,1,!0)]];if(l&&x.push([m.r.UV0,new d.n(l,T,l.length)]),null!=a&&(a=[a[0],a[1],a[2],a[3]],x.push([m.r.CENTEROFFSETANDDISTANCE,new d.n(a,T,4)])),u){const e=[u[0],u[1],u[2],u[3]];x.push([m.r.FEATUREATTRIBUTE,new d.n(e,T,4)])}return new f.V(e,x,null,p.X.Point,h)}const W=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function q(e,t=W){const n=new Array(12);for(let e=0;e<4;e++)for(let i=0;i<3;i++)n[3*e+i]=t[e][i];const i=[0,1,2,2,3,0],r=[0,0,0,0,0,0],o=[[m.r.POSITION,new d.n(n,i,3,!0)],[m.r.NORMAL,new d.n([0,0,1],r,3,!0)],[m.r.UV0,new d.n([0,0,1,0,1,1,0,1],i,2,!0)],[m.r.COLOR,new d.n([255,255,255,255],r,4,!0)]];return new f.V(e,o)}function Y(e,t,n,i,r=!0,s=!0){let a=0;const c=t,u=e;let h=(0,o.fA)(0,a,0),p=(0,o.fA)(0,a+u,0),f=(0,o.fA)(0,-1,0),g=(0,o.fA)(0,1,0);i&&(a=u,p=(0,o.fA)(0,0,0),h=(0,o.fA)(0,a,0),f=(0,o.fA)(0,1,0),g=(0,o.fA)(0,-1,0));const _=[p,h],v=[f,g],y=n+2,b=Math.sqrt(u*u+c*c);if(i)for(let e=n-1;e>=0;e--){const t=e*(2*Math.PI/n),i=(0,o.fA)(Math.cos(t)*c,a,Math.sin(t)*c);_.push(i);const r=(0,o.fA)(u*Math.cos(t)/b,-c/b,u*Math.sin(t)/b);v.push(r)}else for(let e=0;e<n;e++){const t=e*(2*Math.PI/n),i=(0,o.fA)(Math.cos(t)*c,a,Math.sin(t)*c);_.push(i);const r=(0,o.fA)(u*Math.cos(t)/b,c/b,u*Math.sin(t)/b);v.push(r)}const T=new Array,x=new Array;if(r){for(let e=3;e<_.length;e++)T.push(1),T.push(e-1),T.push(e),x.push(0),x.push(0),x.push(0);T.push(_.length-1),T.push(2),T.push(1),x.push(0),x.push(0),x.push(0)}if(s){for(let e=3;e<_.length;e++)T.push(e),T.push(e-1),T.push(0),x.push(e),x.push(e-1),x.push(1);T.push(0),T.push(2),T.push(_.length-1),x.push(1),x.push(2),x.push(v.length-1)}const w=(0,l.oe)(3*y);for(let e=0;e<y;e++)w[3*e]=_[e][0],w[3*e+1]=_[e][1],w[3*e+2]=_[e][2];const S=(0,l.oe)(3*y);for(let e=0;e<y;e++)S[3*e]=v[e][0],S[3*e+1]=v[e][1],S[3*e+2]=v[e][2];return[[m.r.POSITION,new d.n(w,T,3,!0)],[m.r.NORMAL,new d.n(S,x,3,!0)]]}function X(e,t,n,i,r,o=!0,s=!0){return new f.V(e,Y(t,n,i,r,o,s))}function Q(e,t,n,i,s,a,c){const u=s?(0,o.o8)(s):(0,o.fA)(1,0,0),h=a?(0,o.o8)(a):(0,o.fA)(0,0,0);c??=!0;const p=(0,o.vt)();(0,r.n)(p,u);const g=(0,o.vt)();(0,r.h)(g,p,Math.abs(t));const _=(0,o.vt)();(0,r.h)(_,g,-.5),(0,r.g)(_,_,h);const v=(0,o.fA)(0,1,0);Math.abs(1-(0,r.f)(p,v))<.2&&(0,r.i)(v,0,0,1);const y=(0,o.vt)();(0,r.e)(y,p,v),(0,r.n)(y,y),(0,r.e)(v,y,p);const b=2*i+(c?2:0),T=i+(c?2:0),x=(0,l.oe)(3*b),w=(0,l.oe)(3*T),S=(0,l.oe)(2*b),E=new Array(3*i*(c?4:2)),A=new Array(3*i*(c?4:2));c&&(x[3*(b-2)]=_[0],x[3*(b-2)+1]=_[1],x[3*(b-2)+2]=_[2],S[2*(b-2)]=0,S[2*(b-2)+1]=0,x[3*(b-1)]=x[3*(b-2)]+g[0],x[3*(b-1)+1]=x[3*(b-2)+1]+g[1],x[3*(b-1)+2]=x[3*(b-2)+2]+g[2],S[2*(b-1)]=1,S[2*(b-1)+1]=1,w[3*(T-2)]=-p[0],w[3*(T-2)+1]=-p[1],w[3*(T-2)+2]=-p[2],w[3*(T-1)]=p[0],w[3*(T-1)+1]=p[1],w[3*(T-1)+2]=p[2]);const M=(e,t,n)=>{E[e]=t,A[e]=n};let O=0;const R=(0,o.vt)(),C=(0,o.vt)();for(let e=0;e<i;e++){const t=e*(2*Math.PI/i);(0,r.h)(R,v,Math.sin(t)),(0,r.h)(C,y,Math.cos(t)),(0,r.g)(R,R,C),w[3*e]=R[0],w[3*e+1]=R[1],w[3*e+2]=R[2],(0,r.h)(R,R,n),(0,r.g)(R,R,_),x[3*e]=R[0],x[3*e+1]=R[1],x[3*e+2]=R[2],S[2*e]=e/i,S[2*e+1]=0,x[3*(e+i)]=x[3*e]+g[0],x[3*(e+i)+1]=x[3*e+1]+g[1],x[3*(e+i)+2]=x[3*e+2]+g[2],S[2*(e+i)]=e/i,S[2*e+1]=1;const o=(e+1)%i;M(O++,e,e),M(O++,e+i,e),M(O++,o,o),M(O++,o,o),M(O++,e+i,e),M(O++,o+i,o)}if(c){for(let e=0;e<i;e++){const t=(e+1)%i;M(O++,b-2,T-2),M(O++,e,T-2),M(O++,t,T-2)}for(let e=0;e<i;e++){const t=(e+1)%i;M(O++,e+i,T-1),M(O++,b-1,T-1),M(O++,t+i,T-1)}}const I=[[m.r.POSITION,new d.n(x,E,3,!0)],[m.r.NORMAL,new d.n(w,A,3,!0)],[m.r.UV0,new d.n(S,E,2,!0)]];return new f.V(e,I)}function K(e,t,n,i,r,o){i=i||10,r=null==r||r,(0,g.vA)(t.length>1);const s=[],a=[];for(let e=0;e<i;e++){s.push([0,-e-1,-(e+1)%i-1]);const t=e/i*2*Math.PI;a.push([Math.cos(t)*n,Math.sin(t)*n])}return J(e,a,t,[[0,0,0]],s,r,o)}function J(e,t,n,i,a,c,p=(0,o.fA)(0,0,0)){const g=t.length,_=(0,l.oe)(n.length*g*3+(6*i.length||0)),v=(0,l.oe)(n.length*g*3+(i?6:0)),y=new Array,b=new Array;let T=0,x=0;const w=(0,s.vt)(),S=(0,s.vt)(),E=(0,s.vt)(),A=(0,s.vt)(),M=(0,s.vt)(),O=(0,s.vt)(),R=(0,s.vt)(),C=(0,s.vt)(),I=(0,s.vt)(),P=(0,s.vt)(),D=(0,s.vt)(),L=(0,s.vt)(),N=(0,s.vt)(),F=(0,u.vt)();(0,r.i)(I,0,1,0),(0,r.d)(S,n[1],n[0]),(0,r.n)(S,S),c?((0,r.g)(C,n[0],p),(0,r.n)(E,C)):(0,r.i)(E,0,0,1),oe(S,E,I,I,M,E,se),(0,r.c)(A,E),(0,r.c)(L,M);for(let e=0;e<i.length;e++)(0,r.h)(O,M,i[e][0]),(0,r.h)(C,E,i[e][2]),(0,r.g)(O,O,C),(0,r.g)(O,O,n[0]),_[T++]=O[0],_[T++]=O[1],_[T++]=O[2];v[x++]=-S[0],v[x++]=-S[1],v[x++]=-S[2];for(let e=0;e<a.length;e++)y.push(a[e][0]>0?a[e][0]:-a[e][0]-1+i.length),y.push(a[e][1]>0?a[e][1]:-a[e][1]-1+i.length),y.push(a[e][2]>0?a[e][2]:-a[e][2]-1+i.length),b.push(0),b.push(0),b.push(0);let z=i.length;const H=i.length-1;for(let e=0;e<n.length;e++){let i=!1;e>0&&((0,r.c)(w,S),e<n.length-1?((0,r.d)(S,n[e+1],n[e]),(0,r.n)(S,S)):i=!0,(0,r.g)(P,w,S),(0,r.n)(P,P),(0,r.g)(D,n[e-1],A),(0,u.O_)(n[e],P,F),(0,u.Ui)(F,(0,h.LV)(D,w),C)?((0,r.d)(C,C,n[e]),(0,r.n)(E,C),(0,r.e)(M,P,E),(0,r.n)(M,M)):oe(P,A,L,I,M,E,se),(0,r.c)(A,E),(0,r.c)(L,M)),c&&((0,r.g)(C,n[e],p),(0,r.n)(N,C));for(let o=0;o<g;o++)if((0,r.h)(O,M,t[o][0]),(0,r.h)(C,E,t[o][1]),(0,r.g)(O,O,C),(0,r.n)(R,O),v[x++]=R[0],v[x++]=R[1],v[x++]=R[2],(0,r.g)(O,O,n[e]),_[T++]=O[0],_[T++]=O[1],_[T++]=O[2],!i){const e=(o+1)%g;y.push(z+o),y.push(z+g+o),y.push(z+e),y.push(z+e),y.push(z+g+o),y.push(z+g+e);for(let e=0;e<6;e++){const t=y.length-6;b.push(y[t+e]-H)}}z+=g}const V=n[n.length-1];for(let e=0;e<i.length;e++)(0,r.h)(O,M,i[e][0]),(0,r.h)(C,E,i[e][1]),(0,r.g)(O,O,C),(0,r.g)(O,O,V),_[T++]=O[0],_[T++]=O[1],_[T++]=O[2];const U=x/3;v[x++]=S[0],v[x++]=S[1],v[x++]=S[2];const k=z-g;for(let e=0;e<a.length;e++)y.push(a[e][0]>=0?z+a[e][0]:-a[e][0]-1+k),y.push(a[e][2]>=0?z+a[e][2]:-a[e][2]-1+k),y.push(a[e][1]>=0?z+a[e][1]:-a[e][1]-1+k),b.push(U),b.push(U),b.push(U);const B=[[m.r.POSITION,new d.n(_,y,3,!0)],[m.r.NORMAL,new d.n(v,b,3,!0)]];return new f.V(e,B)}function ee(e,t,n,i){(0,g.vA)(t.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),(0,g.vA)(3===t[0].length,"createPolylineGeometry(): malformed vertex"),(0,g.vA)(null==n||n.length===t.length,"createPolylineGeometry: need same number of points and normals"),(0,g.vA)(null==n||3===n[0].length,"createPolylineGeometry(): malformed normal");const r=(0,a.jh)(3*t.length),o=new Array(2*(t.length-1));let s=0,u=0;for(let e=0;e<t.length;e++){for(let n=0;n<3;n++)r[s++]=t[e][n];e>0&&(o[u++]=e-1,o[u++]=e)}const h=[[m.r.POSITION,new d.n(r,o,3,!0)]];if(n){const e=(0,l.oe)(3*n.length);let i=0;for(let r=0;r<t.length;r++)for(let t=0;t<3;t++)e[i++]=n[r][t];h.push([m.r.NORMAL,new d.n(e,o,3,!0)])}return i&&h.push([m.r.COLOR,new d.n(i,(0,c.tM)(i.length/4),4)]),new f.V(e,h,null,p.X.Line)}function te(e,t,n,i,r,o=0){const s=new Array(18),a=[[-n,o,r/2],[i,o,r/2],[0,t+o,r/2],[-n,o,-r/2],[i,o,-r/2],[0,t+o,-r/2]];for(let e=0;e<6;e++)s[3*e]=a[e][0],s[3*e+1]=a[e][1],s[3*e+2]=a[e][2];return new f.V(e,[[m.r.POSITION,new d.n(s,[0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5],3,!0)]])}function ne(e,t){const n=e.getMutableAttribute(m.r.POSITION).data;for(let e=0;e<n.length;e+=3){const i=n[e],o=n[e+1],s=n[e+2];(0,r.i)(ae,i,o,s),(0,r.t)(ae,ae,t),n[e]=ae[0],n[e+1]=ae[1],n[e+2]=ae[2]}}function ie(e,t=e){const n=e.attributes,i=n.get(m.r.POSITION).data,r=n.get(m.r.NORMAL).data;if(r){const e=t.getMutableAttribute(m.r.NORMAL).data;for(let t=0;t<r.length;t+=3){const n=r[t+1];e[t+1]=-r[t+2],e[t+2]=n}}if(i){const e=t.getMutableAttribute(m.r.POSITION).data;for(let t=0;t<i.length;t+=3){const n=i[t+1];e[t+1]=-i[t+2],e[t+2]=n}}}function re(e,t,n,i,o){return!(Math.abs((0,r.f)(t,e))>o||((0,r.e)(n,e,t),(0,r.n)(n,n),(0,r.e)(i,n,e),(0,r.n)(i,i),0))}function oe(e,t,n,i,r,o,s){return re(e,t,r,o,s)||re(e,n,r,o,s)||re(e,i,r,o,s)}const se=.99619469809,ae=(0,s.vt)()},19860:function(e,t,n){"use strict";n.d(t,{g:function(){return _}}),n(58941);var i=n(11231),r=n(20551),o=n(32501),s=n(41546),a=n(57617),l=n(14905),c=n(40359),u=n(89769),h=n(79068),d=n(10713),p=n(10228),f=n(65839),g=n(1296),m=n(65352);class _{constructor(e){this._originSR=e,this._rootOriginId="root/"+(0,i.c)(),this._origins=new Map,this._objects=new Map,this._gridSize=5e5}getOrigin(e){const t=this._origins.get(this._rootOriginId);if(null==t){const t=p.Q.rootOrigin;if(null!=t)return this._origins.set(this._rootOriginId,(0,h.f)(t[0],t[1],t[2],this._rootOriginId)),this.getOrigin(e);const n=(0,h.f)(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,n),n}const n=this._gridSize,i=Math.round(e[0]/n),o=Math.round(e[1]/n),s=Math.round(e[2]/n),a=`${i}/${o}/${s}`;let l=this._origins.get(a);const c=.5*n;if((0,r.d)(v,e,t.vec3),v[0]=Math.abs(v[0]),v[1]=Math.abs(v[1]),v[2]=Math.abs(v[2]),v[0]<c&&v[1]<c&&v[2]<c){if(l){const t=Math.max(...v);if((0,r.d)(v,e,l.vec3),v[0]=Math.abs(v[0]),v[1]=Math.abs(v[1]),v[2]=Math.abs(v[2]),Math.max(...v)<t)return l}return t}return l||(l=(0,h.f)(i*n,o*n,s*n,a),this._origins.set(a,l)),l}_drawOriginBox(e,t=(0,s.fA)(1,1,0,1)){const n=window.view,i=n._stage,r=t.toString();if(!this._objects.has(r)){this._material=new m.W({width:2,color:t}),i.add(this._material);const e=new g.x(i,{pickable:!1}),n=new d.B({castShadow:!1});i.add(n),e.add(n),this._objects.set(r,n)}const o=this._objects.get(r),h=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],p=h.length,_=new Array(3*p),v=new Array,y=.5*this._gridSize;for(let t=0;t<p;t++)_[3*t]=e[0]+(1&h[t]?y:-y),_[3*t+1]=e[1]+(2&h[t]?y:-y),_[3*t+2]=e[2]+(4&h[t]?y:-y),t>0&&v.push(t-1,t);(0,a.projectBuffer)(_,this._originSR,0,_,n.renderSpatialReference,0,p);const b=new u.V(this._material,[[f.r.POSITION,new l.n(_,v,3,!0)]],null,c.X.Line);i.add(b),o.addGeometry(b)}get test(){}}const v=(0,o.vt)()},49845:function(e,t,n){"use strict";n.d(t,{G7:function(){return x},hz:function(){return v}});var i=n(73364),r=n(39714),o=n(20551),s=n(32501),a=n(33400),l=n(41546),c=n(79578),u=n(65420),h=n(38177),d=n(50456),p=n(59356),f=n(22323);const g=1e-5;class m{constructor(e){this.options=new h.H6,this._results=new y,this.transform=new f.dg,this.tolerance=g,this.verticalOffset=null,this._ray=(0,c.vt)(),this._rayEnd=(0,s.vt)(),this._rayBeginTransformed=(0,s.vt)(),this._rayEndTransformed=(0,s.vt)(),this.viewingMode=e??u.RT.Global}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(e,t,n){this.resetWithRay((0,c.Cr)(e,t,this._ray),n)}resetWithRay(e,t){this.camera=t,e!==this._ray&&(0,c.C)(e,this._ray),0!==this.options.verticalOffset?this.viewingMode===u.RT.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,(0,o.g)(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(e=null,t,n,i,r){this.point=t,this.filterPredicate=i,this.tolerance=n??g;const o=(0,f.ou)(this.verticalOffset);if(e&&e.length>0){const t=r?e=>{r(e)&&this.intersectObject(e)}:e=>{this.intersectObject(e)};for(const n of e){const e=n.getSpatialQueryAccelerator?.();null!=e?(null!=o?e.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,t,o):e.forEachAlongRay(this._ray.origin,this._ray.direction,t),this.options.selectionMode&&this.options.hud&&e.forEachDegenerateObject(t)):n.objects.forAll((e=>t(e)))}}this.sortResults()}intersectObject(e){const t=e.geometries;if(!t)return;const n=e.effectiveTransformation,i=(0,f.ou)(this.verticalOffset);for(const s of t){if(!s.visible)continue;const{material:t,id:a}=s;if(!t.visible)continue;this.transform.setAndInvalidateLazyTransforms(n,s.transformation),(0,o.t)(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),(0,o.t)(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const l=this.transform.transform;null!=i&&(i.objectTransform=this.transform),t.intersect(s,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,((t,n,i,o,s,c)=>{if(t>=0){if(null!=this.filterPredicate&&!this.filterPredicate(this._ray.origin,this._rayEnd,t))return;const u=o?this._results.hud:this._results,p=o?o=>{const l=new d.B$(e,a,i,c);o.set(h.dz.HUD,l,t,n,r.zK,s)}:r=>r.set(h.dz.OBJECT,{object:e,geometryId:a,triangleNr:i},t,n,l,s);if((null==u.min.drapedLayerOrder||s>=u.min.drapedLayerOrder)&&(null==u.min.dist||t<u.min.dist)&&p(u.min),this.options.store!==h.oH.MIN&&(null==u.max.drapedLayerOrder||s<u.max.drapedLayerOrder)&&(null==u.max.dist||t>u.max.dist)&&p(u.max),this.options.store===h.oH.ALL)if(o){const e=new T(this._ray);p(e),this._results.hud.all.push(e)}else{const e=new b(this._ray);p(e),this._results.all.push(e)}}}))}}sortResults(e=this._results.all){e.sort(((e,t)=>e.dist!==t.dist?(e.dist??0)-(t.dist??0):e.drapedLayerOrder!==t.drapedLayerOrder?_(e.drapedLayerOrder,t.drapedLayerOrder):_(e.drapedLayerGraphicOrder,t.drapedLayerGraphicOrder)))}}function _(e,t){return(t??-Number.MAX_VALUE)-(e??-Number.MAX_VALUE)}function v(e){return new m(e)}class y{constructor(){this.min=new b((0,c.vt)()),this.max=new b((0,c.vt)()),this.hud={min:new T((0,c.vt)()),max:new T((0,c.vt)()),all:new Array},this.ground=new b((0,c.vt)()),this.all=[]}init(e){this.min.init(e),this.max.init(e),this.ground.init(e),this.all.length=0,this.hud.min.init(e),this.hud.max.init(e),this.hud.all.length=0}}class b{get ray(){return this._ray}get distanceInRenderSpace(){return null!=this.dist?((0,o.h)(w,this.ray.direction,this.dist),(0,o.l)(w)):null}getIntersectionPoint(e){return!!(0,p.i3)(this)&&((0,o.h)(w,this.ray.direction,this.dist),(0,o.g)(e,this.ray.origin,w),!0)}getTransformedNormal(e){return(0,o.c)(S,this.normal),S[3]=0,(0,a.t)(S,S,this.transformation),(0,o.c)(e,S),(0,o.n)(e,e)}constructor(e){this.intersector=h.dz.OBJECT,this.normal=(0,s.vt)(),this.transformation=(0,r.vt)(),this._ray=(0,c.vt)(),this.init(e)}init(e){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=h.dz.OBJECT,(0,c.C)(e,this._ray)}set(e,t,n,a,l,c,u){this.intersector=e,this.dist=n,(0,o.c)(this.normal,a??s.Cb),(0,i.C)(this.transformation,l??r.zK),this.target=t,this.drapedLayerOrder=c,this.drapedLayerGraphicOrder=u}copy(e){(0,c.C)(e.ray,this._ray),this.intersector=e.intersector,this.dist=e.dist,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,(0,o.c)(this.normal,e.normal),(0,i.C)(this.transformation,e.transformation)}}class T extends b{constructor(){super(...arguments),this.intersector=h.dz.HUD}}function x(e){return new b(e)}const w=(0,s.vt)(),S=(0,l.vt)()},38177:function(e,t,n){"use strict";var i,r;n.d(t,{H6:function(){return o},dz:function(){return i},oH:function(){return r}}),function(e){e[e.OBJECT=0]="OBJECT",e[e.HUD=1]="HUD",e[e.TERRAIN=2]="TERRAIN",e[e.OVERLAY=3]="OVERLAY",e[e.I3S=4]="I3S",e[e.PCL=5]="PCL",e[e.LOD=6]="LOD",e[e.VOXEL=7]="VOXEL",e[e.TILES3D=8]="TILES3D"}(i||(i={}));class o{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.filteredLayerUids=[],this.store=r.ALL,this.normalRequired=!0,this.excludeLabels=!1}}!function(e){e[e.MIN=0]="MIN",e[e.MINMAX=1]="MINMAX",e[e.ALL=2]="ALL"}(r||(r={}))},50456:function(e,t,n){"use strict";n.d(t,{B$:function(){return o},HE:function(){return s},R6:function(){return a}});var i=n(32501);class r{constructor(e,t,n){this.object=e,this.geometryId=t,this.triangleNr=n}}class o extends r{constructor(e,t,n,r){super(e,t,n),this.center=null!=r?(0,i.o8)(r):null}}class s{constructor(e){this.layerUid=e}}class a extends s{constructor(e,t){super(e),this.graphicUid=t}}},79068:function(e,t,n){"use strict";n.d(t,{f:function(){return o}});var i=n(32501);class r{constructor(e,t){this.vec3=e,this.id=t}}function o(e,t,n,o){return new r((0,i.fA)(e,t,n),o)}},24100:function(e,t,n){"use strict";n.d(t,{im:function(){return h},m$:function(){return i},qA:function(){return d}});var i,r,o=n(32501),s=n(39506),a=n(48015),l=n(40359),c=n(40502),u=n(84887);class h extends a.J{constructor(e,t){super(),this.type=l.X.Material,this.supportsEdges=!1,this._renderPriority=0,this.vertexAttributeLocations=c.D,this._pp0=(0,o.fA)(0,0,1),this._pp1=(0,o.fA)(0,0,0),this._parameters=new t,(0,u.MB)(this._parameters,e),this.validateParameters(this._parameters)}get parameters(){return this._parameters}update(e){return!1}setParameters(e,t=!0){(0,u.MB)(this._parameters,e)&&(this.validateParameters(this._parameters),t&&this._parametersChanged())}validateParameters(e){}shouldRender(e){return this.visible&&this.isVisibleForOutput(e.output)&&(!this.parameters.isDecoration||e.bind.decorations)&&!!(this.parameters.renderOccluded&e.renderOccludedMask)}isVisibleForOutput(e){return!0}get renderPriority(){return this._renderPriority}set renderPriority(e){e!==this._renderPriority&&(this._renderPriority=e,this._parametersChanged())}_parametersChanged(){this.repository?.materialChanged(this)}queryRenderOccludedState(e){return this.visible&&this.parameters.renderOccluded===e}get hasEmissions(){return!1}intersectDraped(e,t,n,i,r,o){return this._pp0[0]=this._pp1[0]=i[0],this._pp0[1]=this._pp1[1]=i[1],this.intersect(e,t,n,this._pp0,this._pp1,r)}}(r=i||(i={}))[r.None=0]="None",r[r.Occlude=1]="Occlude",r[r.Transparent=2]="Transparent",r[r.OccludeAndTransparent=4]="OccludeAndTransparent",r[r.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",r[r.Opaque=16]="Opaque";class d extends s.Y{constructor(){super(...arguments),this.renderOccluded=i.Occlude,this.isDecoration=!1}}},96253:function(e,t,n){"use strict";var i,r;n.d(t,{k:function(){return r},q:function(){return i}}),function(e){e[e.ADD=0]="ADD",e[e.UPDATE=1]="UPDATE",e[e.REMOVE=2]="REMOVE"}(i||(i={})),function(e){e[e.NONE=0]="NONE",e[e.VISIBILITY=1]="VISIBILITY",e[e.GEOMETRY=2]="GEOMETRY",e[e.TRANSFORMATION=4]="TRANSFORMATION",e[e.HIGHLIGHT=8]="HIGHLIGHT",e[e.OCCLUDEE=16]="OCCLUDEE"}(r||(r={}))},54840:function(e,t,n){"use strict";var i;n.d(t,{Y:function(){return i}}),function(e){e[e.NONE=0]="NONE",e[e.ColorAlpha=1]="ColorAlpha",e[e.FrontFace=2]="FrontFace",e[e.COUNT=3]="COUNT"}(i||(i={}))},10713:function(e,t,n){"use strict";n.d(t,{B:function(){return m}}),n(58941);var i=n(73364),r=n(39714),o=n(20551),s=n(32501),a=n(13794),l=n(76185),c=n(54407),u=n(48015),h=n(40359),d=n(84321),p=n(90553),f=n(65839),g=n(84738);class m extends u.J{get geometries(){return this._geometries}get transformation(){return this._transformation??r.zK}set transformation(e){this._transformation=(0,i.C)(this._transformation??(0,r.vt)(),e),this._invalidateBoundingVolume(),this._emit("transformationChanged",this)}get shaderTransformation(){return this._shaderTransformation}set shaderTransformation(e){this._shaderTransformation=e?(0,i.C)(this._shaderTransformation??(0,r.vt)(),e):null,this._invalidateBoundingVolume(),this._emit("shaderTransformationChanged",this)}get effectiveTransformation(){return this.shaderTransformation??this.transformation}constructor(e={}){super(),this.type=h.X.Object,this._shaderTransformation=null,this._parentLayer=null,this._visible=!0,this.castShadow=e.castShadow??!0,this.usesVerticalDistanceToGround=e.usesVerticalDistanceToGround??!1,this.graphicUid=e.graphicUid,this.layerUid=e.layerUid,e.isElevationSource&&(this.lastValidElevationBB=new _),this._geometries=e.geometries?Array.from(e.geometries):new Array}dispose(){this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(e){(0,p.vA)(null==this._parentLayer||null==e,"Object3D can only be added to a single Layer"),this._parentLayer=e}addGeometry(e){e.visible=this._visible,this._geometries.push(e),this._emit("geometryAdded",{object:this,geometry:e}),this._invalidateBoundingVolume()}removeGeometry(e){const t=this._geometries.splice(e,1)[0];t&&(this._emit("geometryRemoved",{object:this,geometry:t}),this._invalidateBoundingVolume())}removeAllGeometries(){for(;this._geometries.length>0;)this.removeGeometry(0)}geometryVertexAttributeUpdated(e,t,n=!1){this._emit("attributesChanged",{object:this,geometry:e,attribute:t,sync:n}),(0,f.b)(t)&&this._invalidateBoundingVolume()}get visible(){return this._visible}set visible(e){if(this._visible!==e){this._visible=e;for(const e of this._geometries)e.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const e=new d.p;for(const t of this._geometries)t.occludees=(0,g.Ci)(t.occludees,e);return this._emit("occlusionChanged",this),e}removeOcclude(e){for(const t of this._geometries)t.occludees=(0,g.PC)(t.occludees,e);this._emit("occlusionChanged",this)}highlight(e){const t=new d.h(e);for(const e of this._geometries)e.addHighlight(t);return this._emit("highlightChanged",this),t}removeHighlight(e){for(const t of this._geometries)t.removeHighlight(e);this._emit("highlightChanged",this)}removeStateID(e){e.channel===c.Mg.Highlight?this.removeHighlight(e):this.removeOcclude(e)}getCombinedStaticTransformation(e,t){return(0,i.lw)(t,this.transformation,e.transformation)}getCombinedShaderTransformation(e,t=(0,r.vt)()){return(0,i.lw)(t,this.effectiveTransformation,e.transformation)}get boundingVolumeWorldSpace(){return this._bvWorldSpace||(this._bvWorldSpace=this._bvWorldSpace||new v,this._validateBoundingVolume(this._bvWorldSpace,S.WorldSpace)),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._bvObjectSpace||(this._bvObjectSpace=this._bvObjectSpace||new v,this._validateBoundingVolume(this._bvObjectSpace,S.ObjectSpace)),this._bvObjectSpace}_validateBoundingVolume(e,t){const n=t===S.ObjectSpace;for(const t of this._geometries){const i=t.boundingInfo;i&&y(i,e,n?t.transformation:this.getCombinedShaderTransformation(t))}(0,o.m)((0,a.a)(e.bounds),e.min,e.max,.5);for(const t of this._geometries){const i=t.boundingInfo;if(null==i)continue;const r=n?t.transformation:this.getCombinedShaderTransformation(t),s=(0,l.hG)(r);(0,o.t)(w,i.center,r);const c=(0,o.j)(w,(0,a.a)(e.bounds)),u=i.radius*s;e.bounds[3]=Math.max(e.bounds[3],c+u)}}_invalidateBoundingVolume(){const e=this._bvWorldSpace?.bounds;this._bvObjectSpace=this._bvWorldSpace=void 0,this._parentLayer&&e&&this._parentLayer.notifyObjectBBChanged(this,e)}_emit(e,t){this._parentLayer&&this._parentLayer.events.emit(e,t)}get test(){}}class _{constructor(){this.min=(0,s.fA)(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=(0,s.fA)(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}}class v extends _{constructor(){super(...arguments),this.bounds=(0,a.c)()}}function y(e,t,n){const r=e.bbMin,s=e.bbMax;if((0,i.tZ)(n)){const e=(0,o.i)(b,n[12],n[13],n[14]);(0,o.g)(T,r,e),(0,o.g)(x,s,e);for(let e=0;e<3;++e)t.min[e]=Math.min(t.min[e],T[e]),t.max[e]=Math.max(t.max[e],x[e])}else if((0,o.t)(T,r,n),(0,o.p)(r,s))for(let e=0;e<3;++e)t.min[e]=Math.min(t.min[e],T[e]),t.max[e]=Math.max(t.max[e],T[e]);else{(0,o.t)(x,s,n);for(let e=0;e<3;++e)t.min[e]=Math.min(t.min[e],T[e],x[e]),t.max[e]=Math.max(t.max[e],T[e],x[e]);for(let e=0;e<3;++e){(0,o.c)(T,r),(0,o.c)(x,s),T[e]=s[e],x[e]=r[e],(0,o.t)(T,T,n),(0,o.t)(x,x,n);for(let e=0;e<3;++e)t.min[e]=Math.min(t.min[e],T[e],x[e]),t.max[e]=Math.max(t.max[e],T[e],x[e])}}}const b=(0,s.vt)(),T=(0,s.vt)(),x=(0,s.vt)(),w=(0,s.vt)();var S,E;(E=S||(S={}))[E.WorldSpace=0]="WorldSpace",E[E.ObjectSpace=1]="ObjectSpace"},84321:function(e,t,n){"use strict";n.d(t,{h:function(){return s},p:function(){return a}});var i=n(11231),r=n(54407);class o{constructor(){this.uid=(0,i.c)()}}class s extends o{constructor(e){super(),this.highlightGroupName=e,this.channel=r.Mg.Highlight}}class a extends o{constructor(){super(...arguments),this.channel=r.Mg.MaskOccludee}}},35363:function(e,t,n){"use strict";n.d(t,{A:function(){return G}});var i,r,o=n(56996),s=n(7187),a=n(20551),l=n(32501),c=n(69508),u=n(79578),h=n(13794),d=n(90553);class p{get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}constructor(e,t){this.objectToBoundingSphere=e,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new f,this._objectCount=0,t&&(void 0!==t.maximumObjectsPerNode&&(this._maximumObjectsPerNode=t.maximumObjectsPerNode),void 0!==t.maximumDepth&&(this._maximumDepth=t.maximumDepth))}destroy(){this._degenerateObjects.clear(),f.clearPool(),C[0]=null,N.prune(),k.prune()}add(e,t=e.length){this._objectCount+=t,this._grow(e,t);const n=f.acquire();for(let i=0;i<t;i++){const t=e[i];this._isDegenerate(t)?this._degenerateObjects.add(t):(n.init(this._root),this._add(t,n))}f.release(n)}remove(e,t=null){this._objectCount-=e.length;const n=f.acquire();for(const i of e){const e=t??(0,h.e)(this.objectToBoundingSphere(i),F);A(e[3])?(n.init(this._root),_(i,e,n)):this._degenerateObjects.delete(i)}f.release(n),this._shrink()}update(e,t){if(!A(t[3])&&this._isDegenerate(e))return;const n=function(e){return C[0]=e,C}(e);this.remove(n,t),this.add(n)}forEachAlongRay(e,t,n){const i=(0,u.LV)(e,t);g(this._root,(e=>{if(!function(e,t){return x((0,h.a)(t.bounds),2*-t.halfSize,D),x((0,h.a)(t.bounds),2*t.halfSize,L),(0,d.O_)(e.origin,e.direction,D,L)}(i,e))return!1;const t=e.node;return t.terminals.forAll((e=>{this._intersectsObject(i,e)&&n(e)})),null!==t.residents&&t.residents.forAll((e=>{this._intersectsObject(i,e)&&n(e)})),!0}))}forEachAlongRayWithVerticalOffset(e,t,n,i){const r=(0,u.LV)(e,t);g(this._root,(e=>{if(!function(e,t,n){return x((0,h.a)(t.bounds),2*-t.halfSize,D),x((0,h.a)(t.bounds),2*t.halfSize,L),n.applyToMinMax(D,L),(0,d.O_)(e.origin,e.direction,D,L)}(r,e,i))return!1;const t=e.node;return t.terminals.forAll((e=>{this._intersectsObjectWithOffset(r,e,i)&&n(e)})),null!==t.residents&&t.residents.forAll((e=>{this._intersectsObjectWithOffset(r,e,i)&&n(e)})),!0}))}forEach(e){g(this._root,(t=>{const n=t.node;return n.terminals.forAll(e),null!==n.residents&&n.residents.forAll(e),!0})),this._degenerateObjects.forEach(e)}forEachDegenerateObject(e){this._degenerateObjects.forEach(e)}findClosest(e,t,n,i=()=>!0,r=1/0){let o=1/0,s=1/0,l=null;const u=S(e,t),d=a=>{if(--r,!i(a))return;const u=this.objectToBoundingSphere(a);if(!(0,c.m7)(n,u))return;const d=E(e,t,(0,h.a)(u)),p=d-u[3],f=d+u[3];p<o&&(o=p,s=f,l=a)};return m(this._root,(i=>{if(r<=0||!(0,c.m7)(n,i.bounds))return!1;if((0,a.h)(P,u,i.halfSize),(0,a.g)(P,P,(0,h.a)(i.bounds)),E(e,t,P)>s)return!1;const o=i.node;return o.terminals.forAll((e=>d(e))),null!==o.residents&&o.residents.forAll((e=>d(e))),!0}),e,t),l}forEachInDepthRange(e,t,n,i,r,o,s){let l=-1/0,u=1/0;const d={setRange:e=>{n===p.DepthOrder.FRONT_TO_BACK?(l=Math.max(l,e.near),u=Math.min(u,e.far)):(l=Math.max(l,-e.far),u=Math.min(u,-e.near))}};d.setRange(i);const f=E(t,n,e),g=S(t,n),_=S(t,-n),v=e=>{if(!s(e))return;const i=this.objectToBoundingSphere(e),a=(0,h.a)(i),p=E(t,n,a)-f,g=p-i[3],m=p+i[3];g>u||m<l||!(0,c.m7)(o,i)||r(e,d)};m(this._root,(e=>{if(!(0,c.m7)(o,e.bounds))return!1;if((0,a.h)(P,g,e.halfSize),(0,a.g)(P,P,(0,h.a)(e.bounds)),E(t,n,P)-f>u)return!1;if((0,a.h)(P,_,e.halfSize),(0,a.g)(P,P,(0,h.a)(e.bounds)),E(t,n,P)-f<l)return!1;const i=e.node;return i.terminals.forAll((e=>v(e))),null!==i.residents&&i.residents.forAll((e=>v(e))),!0}),t,n)}forEachNode(e){g(this._root,(t=>e(t.node,t.bounds,t.halfSize,t.depth)))}forEachNeighbor(e,t){const n=(0,h.g)(t),i=(0,h.a)(t),r=t=>{const r=this.objectToBoundingSphere(t),o=(0,h.g)(r),s=n+o;return!((0,a.s)((0,h.a)(r),i)-s*s<=0)||e(t)};let o=!0;const s=e=>{o&&(o=r(e))};g(this._root,(e=>{const t=(0,h.g)(e.bounds),r=n+t;if((0,a.s)((0,h.a)(e.bounds),i)-r*r>0)return!1;const l=e.node;return l.terminals.forAll(s),o&&null!==l.residents&&l.residents.forAll(s),o})),o&&this.forEachDegenerateObject(s)}_intersectsObject(e,t){const n=this.objectToBoundingSphere(t);return!(n[3]>0)||(0,h.k)(n,e)}_intersectsObjectWithOffset(e,t,n){const i=this.objectToBoundingSphere(t);return!(i[3]>0)||(0,h.k)(n.applyToBoundingSphere(i),e)}_add(e,t){t.advanceTo(this.objectToBoundingSphere(e))?t.node.terminals.push(e):(t.node.residents.push(e),t.node.residents.length>this._maximumObjectsPerNode&&t.depth<this._maximumDepth&&this._split(t))}_split(e){const t=e.node.residents;e.node.residents=null;for(let n=0;n<t.length;n++){const i=f.acquire().init(e);this._add(t.at(n),i),f.release(i)}}_grow(e,t){if(0!==t&&(w(e,t,(e=>this.objectToBoundingSphere(e)),z),A(z[3])&&!this._fitsInsideTree(z)))if(y(this._root.node))(0,h.e)(z,this._root.bounds),this._root.halfSize=1.25*this._root.bounds[3],this._root.updateBoundsRadiusFromHalfSize();else{const e=this._rootBoundsForRootAsSubNode(z);this._placingRootViolatesMaxDepth(e)?this._rebuildTree(z,e):this._growRootAsSubNode(e),f.release(e)}}_rebuildTree(e,t){(0,a.c)((0,h.a)(H),(0,h.a)(t.bounds)),H[3]=t.halfSize,w([e,H],2,(e=>e),V);const n=f.acquire().init(this._root);this._root.initFrom(null,V,V[3]),this._root.increaseHalfSize(1.25),g(n,(e=>(this.add(e.node.terminals.data,e.node.terminals.length),null!==e.node.residents&&this.add(e.node.residents.data,e.node.residents.length),!0))),f.release(n)}_placingRootViolatesMaxDepth(e){const t=Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E;let n=0;return g(this._root,(e=>(n=Math.max(n,e.depth),n+t<=this._maximumDepth))),n+t>this._maximumDepth}_rootBoundsForRootAsSubNode(e){const t=e[3],n=e;let i=-1/0;const r=this._root.bounds,o=this._root.halfSize;for(let e=0;e<3;e++){const s=r[e]-o-(n[e]-t),a=n[e]+t-(r[e]+o),l=Math.max(0,Math.ceil(s/(2*o))),c=Math.max(0,Math.ceil(a/(2*o)))+1,u=2**Math.ceil(Math.log(l+c)*Math.LOG2E);i=Math.max(i,u),U[e].min=l,U[e].max=c}for(let e=0;e<3;e++){let t=U[e].min,n=U[e].max;const s=(i-(t+n))/2;t+=Math.ceil(s),n+=Math.floor(s);const a=r[e]-o-t*o*2;I[e]=a+(n+t)*o}const s=i*o;return I[3]=s*R,f.acquire().initFrom(null,I,s,0)}_growRootAsSubNode(e){const t=this._root.node;(0,a.c)((0,h.a)(z),(0,h.a)(this._root.bounds)),z[3]=this._root.halfSize,this._root.init(e),e.advanceTo(z,null,!0),e.node.children=t.children,e.node.residents=t.residents,e.node.terminals=t.terminals}_shrink(){for(;;){const e=this._findShrinkIndex();if(-1===e)break;this._root.advance(e),this._root.depth=0}}_findShrinkIndex(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;let e=null;const t=this._root.node.children;let n=0,i=0;for(;i<t.length&&null==e;)n=i++,e=t[n];for(;i<t.length;)if(t[i++])return-1;return n}_isDegenerate(e){return!A(this.objectToBoundingSphere(e)[3])}_fitsInsideTree(e){const t=this._root.bounds,n=this._root.halfSize;return e[3]<=n&&e[0]>=t[0]-n&&e[0]<=t[0]+n&&e[1]>=t[1]-n&&e[1]<=t[1]+n&&e[2]>=t[2]-n&&e[2]<=t[2]+n}toJSON(){const{maximumDepth:e,maximumObjectsPerNode:t,_objectCount:n}=this,i=this._nodeToJSON(this._root.node);return{maximumDepth:e,maximumObjectsPerNode:t,objectCount:n,root:{bounds:this._root.bounds,halfSize:this._root.halfSize,depth:this._root.depth,node:i}}}_nodeToJSON(e){const t=e.children.map((e=>e?this._nodeToJSON(e):null)),n=e.residents?.map((e=>this.objectToBoundingSphere(e))),i=e.terminals?.map((e=>this.objectToBoundingSphere(e)));return{children:t,residents:n,terminals:i}}static fromJSON(e){const t=new p((e=>e),{maximumDepth:e.maximumDepth,maximumObjectsPerNode:e.maximumObjectsPerNode});return t._objectCount=e.objectCount,t._root.initFrom(e.root.node,e.root.bounds,e.root.halfSize,e.root.depth),t}}class f{constructor(){this.bounds=(0,h.c)(),this.halfSize=0,this.initFrom(null,null,0,0)}init(e){return this.initFrom(e.node,e.bounds,e.halfSize,e.depth)}initFrom(e,t,n,i=this.depth){return this.node=null!=e?e:f.createEmptyNode(),t&&(0,h.e)(t,this.bounds),this.halfSize=n,this.depth=i,this}increaseHalfSize(e){this.halfSize*=e,this.updateBoundsRadiusFromHalfSize()}updateBoundsRadiusFromHalfSize(){this.bounds[3]=this.halfSize*R}advance(e){let t=this.node.children[e];t||(t=f.createEmptyNode(),this.node.children[e]=t),this.node=t,this.halfSize/=2,this.depth++;const n=M[e];return this.bounds[0]+=n[0]*this.halfSize,this.bounds[1]+=n[1]*this.halfSize,this.bounds[2]+=n[2]*this.halfSize,this.updateBoundsRadiusFromHalfSize(),this}advanceTo(e,t,n=!1){for(;;){if(this.isTerminalFor(e))return t&&t(this,-1),!0;if(this.isLeaf()){if(!n)return t&&t(this,-1),!1;this.node.residents=null}const i=this._childIndex(e);t&&t(this,i),this.advance(i)}}isLeaf(){return null!=this.node.residents}isTerminalFor(e){return e[3]>this.halfSize/2}_childIndex(e){const t=this.bounds;return(t[0]<e[0]?1:0)+(t[1]<e[1]?2:0)+(t[2]<e[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new s.A({shrink:!0}),residents:new s.A({shrink:!0})}}static acquire(){return f._pool.acquire()}static release(e){f._pool.release(e)}static clearPool(){f._pool.prune()}}function g(e,t){let n=f.acquire().init(e);const i=[n];for(;0!==i.length;){if(n=i.pop(),t(n)&&!n.isLeaf())for(let e=0;e<n.node.children.length;e++)n.node.children[e]&&i.push(f.acquire().init(n).advance(e));f.release(n)}}function m(e,t,n,i=p.DepthOrder.FRONT_TO_BACK){let r=f.acquire().init(e);const o=[r];for(function(e,t,n){if(!k.length)for(let e=0;e<8;++e)k.push({index:0,distance:0});for(let n=0;n<8;++n){const i=M[n];k.data[n].index=n,k.data[n].distance=E(e,t,i)}k.sort(((e,t)=>e.distance-t.distance));for(let e=0;e<8;++e)n[e]=k.data[e].index}(n,i,B);0!==o.length;){if(r=o.pop(),t(r)&&!r.isLeaf())for(let e=7;e>=0;--e){const t=B[e];r.node.children[t]&&o.push(f.acquire().init(r).advance(t))}f.release(r)}}function _(e,t,n){N.clear();const i=n.advanceTo(t,((e,t)=>{N.push(e.node),N.push(t)}))?n.node.terminals:n.node.residents;if(i.removeUnordered(e),0===i.length)for(let e=N.length-2;e>=0&&v(N.data[e],N.data[e+1]);e-=2);}function v(e,t){return t>=0&&(e.children[t]=null),!!y(e)&&(null===e.residents&&(e.residents=new s.A({shrink:!0})),!0)}function y(e){if(0!==e.terminals.length)return!1;if(null!==e.residents)return 0===e.residents.length;for(let t=0;t<e.children.length;t++)if(e.children[t])return!1;return!0}function b(e,t){e[0]=Math.min(e[0],t[0]-t[3]),e[1]=Math.min(e[1],t[1]-t[3]),e[2]=Math.min(e[2],t[2]-t[3])}function T(e,t){e[0]=Math.max(e[0],t[0]+t[3]),e[1]=Math.max(e[1],t[1]+t[3]),e[2]=Math.max(e[2],t[2]+t[3])}function x(e,t,n){n[0]=e[0]+t,n[1]=e[1]+t,n[2]=e[2]+t}function w(e,t,n,i){if(1===t){const t=n(e[0]);(0,h.e)(t,i)}else{D[0]=1/0,D[1]=1/0,D[2]=1/0,L[0]=-1/0,L[1]=-1/0,L[2]=-1/0;for(let i=0;i<t;i++){const t=n(e[i]);A(t[3])&&(b(D,t),T(L,t))}(0,a.m)((0,h.a)(i),D,L,.5),i[3]=Math.max(L[0]-D[0],L[1]-D[1],L[2]-D[2])/2}}function S(e,t){let n,i=1/0;for(let r=0;r<8;++r){const o=E(e,t,O[r]);o<i&&(i=o,n=O[r])}return n}function E(e,t,n){return t*(e[0]*n[0]+e[1]*n[1]+e[2]*n[2])}function A(e){return!isNaN(e)&&e!==-1/0&&e!==1/0&&e>0}f._pool=new o.A(f),i=p||(p={}),(r=i.DepthOrder||(i.DepthOrder={}))[r.FRONT_TO_BACK=1]="FRONT_TO_BACK",r[r.BACK_TO_FRONT=-1]="BACK_TO_FRONT";const M=[(0,l.fA)(-1,-1,-1),(0,l.fA)(1,-1,-1),(0,l.fA)(-1,1,-1),(0,l.fA)(1,1,-1),(0,l.fA)(-1,-1,1),(0,l.fA)(1,-1,1),(0,l.fA)(-1,1,1),(0,l.fA)(1,1,1)],O=[(0,l.fA)(-1,-1,-1),(0,l.fA)(-1,-1,1),(0,l.fA)(-1,1,-1),(0,l.fA)(-1,1,1),(0,l.fA)(1,-1,-1),(0,l.fA)(1,-1,1),(0,l.fA)(1,1,-1),(0,l.fA)(1,1,1)],R=Math.sqrt(3),C=[null],I=(0,h.c)(),P=(0,l.vt)(),D=(0,l.vt)(),L=(0,l.vt)(),N=new s.A,F=(0,h.c)(),z=(0,h.c)(),H=(0,h.c)(),V=(0,h.c)(),U=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],k=new s.A,B=[0,0,0,0,0,0,0,0],G=p},46921:function(e,t,n){"use strict";n.d(t,{K_:function(){return f},SE:function(){return d},Yf:function(){return c},aB:function(){return p},ez:function(){return l},m6:function(){return g},xt:function(){return h},z5:function(){return u}});var i=n(27264),r=n(54840),o=n(85456),s=n(57087);const a=(0,s.p3)(o.dn.ONE,o.dn.ZERO,o.dn.ONE,o.dn.ONE_MINUS_SRC_ALPHA);function l(e){return e===r.Y.FrontFace?null:a}function c(e){switch(e){case r.Y.NONE:return s.Ky;case r.Y.ColorAlpha:return a;case r.Y.FrontFace:case r.Y.COUNT:return null}}function u(e){if(e.draped)return null;switch(e.oitPass){case r.Y.NONE:case r.Y.FrontFace:return e.writeDepth?s.Uy:null;case r.Y.ColorAlpha:case r.Y.COUNT:return null}}const h=5e5,d={factor:-1,units:-2};function p(e){return e?d:null}function f(e,t=o.MT.LESS){return e===r.Y.NONE||e===r.Y.FrontFace?t:o.MT.LEQUAL}function g(e,t){const n=(0,i.LG)(t);return e===r.Y.ColorAlpha?n?{buffers:[o.Nm.COLOR_ATTACHMENT0,o.Nm.COLOR_ATTACHMENT1,o.Nm.COLOR_ATTACHMENT2]}:{buffers:[o.Nm.COLOR_ATTACHMENT0,o.Nm.COLOR_ATTACHMENT1]}:n?{buffers:[o.Nm.COLOR_ATTACHMENT0,o.Nm.COLOR_ATTACHMENT1]}:null}},45079:function(e,t,n){"use strict";n.d(t,{JG:function(){return c},Uy:function(){return h},Wb:function(){return S},Z$:function(){return g}});var i=n(20551),r=n(32501),o=n(24761),s=n(40359),a=n(90553),l=n(65839);class c{constructor(e=!1,t=!0){this.isVerticalRay=e,this.normalRequired=t}}const u=(0,o.vt)();function h(e,t,n,r,o,u){if(!e.visible)return;const h=(0,i.a)(M,r,n),d=(e,t,n)=>{u(e,n,t,!1)},f=new c(!1,t.options.normalRequired);if(e.boundingInfo){(0,a.vA)(e.type===s.X.Mesh);const i=t.tolerance;p(e.boundingInfo,n,h,i,o,f,d)}else{const t=e.attributes.get(l.r.POSITION),i=t.indices;m(n,h,0,i.length/3,i,t.data,t.stride,o,f,d)}}const d=(0,r.vt)();function p(e,t,n,r,s,a,l){if(null==e)return;const c=function(e,t){return(0,i.i)(t,1/e[0],1/e[1],1/e[2])}(n,d);if((0,o.Ne)(u,e.bbMin),(0,o.vI)(u,e.bbMax),null!=s&&s.applyToAabb(u),S(u,t,c,r)){const{primitiveIndices:i,position:o}=e,c=i?i.length:o.indices.length/3;if(c>E){const i=e.getChildren();if(void 0!==i){for(const e of i)p(e,t,n,r,s,a,l);return}}!function(e,t,n,i,r,o,s,a,l,c,u){const h=e[0],d=e[1],p=e[2],g=t[0],m=t[1],_=t[2],{normalRequired:v}=c;for(let e=0;e<i;++e){const t=a[e],n=3*t,i=s*r[n];let c=o[i],y=o[i+1],T=o[i+2];const x=s*r[n+1];let w=o[x],S=o[x+1],E=o[x+2];const M=s*r[n+2];let O=o[M],R=o[M+1],C=o[M+2];null!=l&&([c,y,T]=l.applyToVertex(c,y,T,e),[w,S,E]=l.applyToVertex(w,S,E,e),[O,R,C]=l.applyToVertex(O,R,C,e));const I=w-c,P=S-y,D=E-T,L=O-c,N=R-y,F=C-T,z=m*F-N*_,H=_*L-F*g,V=g*N-L*m,U=I*z+P*H+D*V;if(Math.abs(U)<=A)continue;const k=h-c,B=d-y,G=p-T,$=k*z+B*H+G*V;if(U>0){if($<0||$>U)continue}else if($>0||$<U)continue;const j=B*D-P*G,Z=G*I-D*k,W=k*P-I*B,q=g*j+m*Z+_*W;if(U>0){if(q<0||$+q>U)continue}else if(q>0||$+q<U)continue;const Y=(L*j+N*Z+F*W)/U;Y>=0&&u(Y,t,v?b(I,P,D,L,N,F,f):null)}}(t,n,0,c,o.indices,o.data,o.stride,i,s,a,l)}}const f=(0,r.vt)();function g(e,t,n,r,o,s,a,l,c){const{data:u,stride:h}=s;m(e,(0,i.a)(M,t,e),n,r,o,u,h,a,l,c)}function m(e,t,n,r,o,s,a,l,c,u){const h=t,d=O,p=Math.abs(h[0]),f=Math.abs(h[1]),g=Math.abs(h[2]),m=p>=f?p>=g?0:2:f>=g?1:2,b=m,x=h[b]<0?2:1,w=(m+x)%3,S=(m+(3-x))%3,E=h[w]/h[b],A=h[S]/h[b],M=1/h[b],R=_,C=v,I=y,{normalRequired:P}=c;for(let t=n;t<r;++t){const n=3*t,r=a*o[n];(0,i.i)(d[0],s[r+0],s[r+1],s[r+2]);const c=a*o[n+1];(0,i.i)(d[1],s[c+0],s[c+1],s[c+2]);const h=a*o[n+2];(0,i.i)(d[2],s[h+0],s[h+1],s[h+2]),l&&((0,i.c)(d[0],l.applyToVertex(d[0][0],d[0][1],d[0][2],t)),(0,i.c)(d[1],l.applyToVertex(d[1][0],d[1][1],d[1][2],t)),(0,i.c)(d[2],l.applyToVertex(d[2][0],d[2][1],d[2][2],t))),(0,i.a)(R,d[0],e),(0,i.a)(C,d[1],e),(0,i.a)(I,d[2],e);const p=R[w]-E*R[b],f=R[S]-A*R[b],g=C[w]-E*C[b],m=C[S]-A*C[b],_=I[w]-E*I[b],v=I[S]-A*I[b],y=_*m-v*g,x=p*v-f*_,O=g*f-m*p;if((y<0||x<0||O<0)&&(y>0||x>0||O>0))continue;const D=y+x+O;if(0===D)continue;const L=y*(M*R[b])+x*(M*C[b])+O*(M*I[b]);if(L*Math.sign(D)<0)continue;const N=L/D;N>=0&&u(N,t,P?T(d):null)}}const _=(0,r.vt)(),v=(0,r.vt)(),y=(0,r.vt)();function b(e,t,n,r,o,s,a){return(0,i.i)(x,e,t,n),(0,i.i)(w,r,o,s),(0,i.e)(a,x,w),(0,i.n)(a,a),a}function T(e){return(0,i.a)(x,e[1],e[0]),(0,i.a)(w,e[2],e[0]),(0,i.e)(f,x,w),(0,i.n)(f,f),f}const x=(0,r.vt)(),w=(0,r.vt)();function S(e,t,n,i){return function(e,t,n,i){const r=(e[0]-i-t[0])*n[0],o=(e[3]+i-t[0])*n[0];let s=Math.min(r,o),a=Math.max(r,o);const l=(e[1]-i-t[1])*n[1],c=(e[4]+i-t[1])*n[1];if(a=Math.min(a,Math.max(l,c)),a<0)return!1;if(s=Math.max(s,Math.min(l,c)),s>a)return!1;const u=(e[2]-i-t[2])*n[2],h=(e[5]+i-t[2])*n[2];return a=Math.min(a,Math.max(u,h)),!(a<0)&&(s=Math.max(s,Math.min(u,h)),!(s>a)&&s<1/0)}(e,t,n,i)}const E=1e3,A=1e-7,M=(0,r.vt)(),O=[(0,r.vt)(),(0,r.vt)(),(0,r.vt)()]},15389:function(e,t,n){"use strict";n.d(t,{$:function(){return c}});var i=n(11231),r=n(73364),o=n(39714),s=n(20551),a=n(13794),l=n(76185);class c{constructor(e,t={}){this.geometry=e,this.screenToWorldRatio=1,this._transformation=(0,o.vt)(),this._shaderTransformation=null,this._boundingSphere=null,this.id=(0,i.c)(),this.layerUid=t.layerUid,this.graphicUid=t.graphicUid,this.castShadow=t.castShadow??!1,t.objectShaderTransformation&&this.objectShaderTransformationChanged(t.objectShaderTransformation)}get transformation(){return this._transformation}set transformation(e){(0,r.C)(this._transformation,e),this._boundingSphere=null}get boundingInfo(){return this.geometry.boundingInfo}objectShaderTransformationChanged(e){null==e?this._shaderTransformation=null:(this._shaderTransformation??=(0,o.vt)(),(0,r.lw)(this._shaderTransformation,e,this.geometry.transformation)),this._boundingSphere=null}get boundingSphere(){return this.boundingInfo?(null==this._boundingSphere&&(this._boundingSphere??=(0,a.c)(),(0,s.t)((0,a.a)(this._boundingSphere),this.boundingInfo.center,this.shaderTransformation),this._boundingSphere[3]=this.boundingInfo.radius*(0,l.hG)(this.shaderTransformation)),this._boundingSphere):a.N}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return this._shaderTransformation??this.transformation}get attributes(){return this.geometry.attributes}get highlight(){return this.geometry.highlights}foreachHighlightGroup(e){this.geometry.foreachHighlightGroup(e)}get hasHighlights(){return this.geometry.hasHighlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(e){this.geometry.visible=e}}},29165:function(e,t,n){"use strict";var i;n.d(t,{N:function(){return i}}),function(e){e[e.INTEGRATED_MESH=0]="INTEGRATED_MESH",e[e.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",e[e.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",e[e.OPAQUE_MATERIAL_WITHOUT_NORMALS=3]="OPAQUE_MATERIAL_WITHOUT_NORMALS",e[e.TRANSPARENT_MATERIAL=4]="TRANSPARENT_MATERIAL",e[e.TRANSPARENT_MATERIAL_WITHOUT_NORMALS=5]="TRANSPARENT_MATERIAL_WITHOUT_NORMALS",e[e.TRANSPARENT_TERRAIN=6]="TRANSPARENT_TERRAIN",e[e.TRANSPARENT_MATERIAL_WITHOUT_DEPTH=7]="TRANSPARENT_MATERIAL_WITHOUT_DEPTH",e[e.OCCLUDED_TERRAIN=8]="OCCLUDED_TERRAIN",e[e.OCCLUDER_MATERIAL=9]="OCCLUDER_MATERIAL",e[e.TRANSPARENT_OCCLUDER_MATERIAL=10]="TRANSPARENT_OCCLUDER_MATERIAL",e[e.OCCLUSION_PIXELS=11]="OCCLUSION_PIXELS",e[e.HUD_MATERIAL=12]="HUD_MATERIAL",e[e.LABEL_MATERIAL=13]="LABEL_MATERIAL",e[e.LINE_CALLOUTS=14]="LINE_CALLOUTS",e[e.LINE_CALLOUTS_HUD_DEPTH=15]="LINE_CALLOUTS_HUD_DEPTH",e[e.DRAPED_MATERIAL=16]="DRAPED_MATERIAL",e[e.DRAPED_WATER=17]="DRAPED_WATER",e[e.VOXEL=18]="VOXEL",e[e.MAX_SLOTS=19]="MAX_SLOTS"}(i||(i={}))},6200:function(e,t,n){"use strict";n.d(t,{I$:function(){return h},a9:function(){return u},m:function(){return o},mK:function(){return d},qh:function(){return c},r8:function(){return l},sf:function(){return s},v0:function(){return a}});var i=n(54407),r=n(85456);const o={func:r.MT.LESS},s={func:r.MT.ALWAYS},a={mask:255},l={mask:0},c={function:{func:r.MT.ALWAYS,ref:i.dd.OutlineVisualElementMask,mask:i.dd.OutlineVisualElementMask},operation:{fail:r.eA.KEEP,zFail:r.eA.KEEP,zPass:r.eA.ZERO}},u={function:{func:r.MT.ALWAYS,ref:i.dd.OutlineVisualElementMask,mask:i.dd.OutlineVisualElementMask},operation:{fail:r.eA.KEEP,zFail:r.eA.KEEP,zPass:r.eA.REPLACE}},h={function:{func:r.MT.EQUAL,ref:i.dd.OutlineVisualElementMask,mask:i.dd.OutlineVisualElementMask},operation:{fail:r.eA.KEEP,zFail:r.eA.KEEP,zPass:r.eA.KEEP}},d={function:{func:r.MT.NOTEQUAL,ref:i.dd.OutlineVisualElementMask,mask:i.dd.OutlineVisualElementMask},operation:{fail:r.eA.KEEP,zFail:r.eA.KEEP,zPass:r.eA.KEEP}}},59552:function(e,t,n){"use strict";n.d(t,{g:function(){return V}}),n(58941);var i=n(39819),r=n(48996),o=n(95929),s=n(60539),a=n(24540),l=n(90683),c=n(9030),u=n(86419),h=n(54407),d=n(53216);let p;var f,g;(g=f||(f={}))[g.ETC1_RGB=0]="ETC1_RGB",g[g.ETC2_RGBA=1]="ETC2_RGBA",g[g.BC1_RGB=2]="BC1_RGB",g[g.BC3_RGBA=3]="BC3_RGBA",g[g.BC4_R=4]="BC4_R",g[g.BC5_RG=5]="BC5_RG",g[g.BC7_M6_RGB=6]="BC7_M6_RGB",g[g.BC7_M5_RGBA=7]="BC7_M5_RGBA",g[g.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",g[g.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",g[g.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",g[g.ATC_RGB=11]="ATC_RGB",g[g.ATC_RGBA=12]="ATC_RGBA",g[g.FXT1_RGB=17]="FXT1_RGB",g[g.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",g[g.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",g[g.ETC2_EAC_R11=20]="ETC2_EAC_R11",g[g.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",g[g.RGBA32=13]="RGBA32",g[g.RGB565=14]="RGB565",g[g.BGR565=15]="BGR565",g[g.RGBA4444=16]="RGBA4444";var m=n(85456),_=n(12285),v=n(93380);let y=null,b=null;async function T(){return null==b&&(p??=(async()=>{const e=await n.e(5090).then(n.bind(n,90830)),t=await e.default({locateFile:e=>(0,d.s)(`esri/libs/basisu/${e}`)});return t.initializeBasis(),t})(),b=p,y=await b),b}function x(e,t,n,i,r){const o=(0,v.IB)(t?m.CQ.COMPRESSED_RGBA8_ETC2_EAC:m.CQ.COMPRESSED_RGB8_ETC2),s=r&&e>1?(4**e-1)/(3*4**(e-1)):1;return Math.ceil(n*i*o*s)}function w(e){return e.getNumImages()>=1&&!e.isUASTC()}function S(e){return e.getFaces()>=1&&e.isETC1S()}function E(e,t,n,i,r,o,s,a){const{compressedTextureETC:l,compressedTextureS3TC:c}=e.capabilities,[u,h]=l?i?[f.ETC2_RGBA,m.CQ.COMPRESSED_RGBA8_ETC2_EAC]:[f.ETC1_RGB,m.CQ.COMPRESSED_RGB8_ETC2]:c?i?[f.BC3_RGBA,m.CQ.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[f.BC1_RGB,m.CQ.COMPRESSED_RGB_S3TC_DXT1_EXT]:[f.RGBA32,m.Ab.RGBA],d=t.hasMipmap?n:Math.min(1,n),p=[];for(let e=0;e<d;e++)p.push(new Uint8Array(s(e,u))),a(e,u,p[e]);return t.internalFormat=h,t.hasMipmap=p.length>1,t.samplingMode=t.hasMipmap?m.Cj.LINEAR_MIPMAP_LINEAR:m.Cj.LINEAR,t.width=r,t.height=o,new _.g(e,t,{type:"compressed",levels:p})}var A=n(48015),M=n(40359),O=n(40633);const R=()=>O.A.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil");function C(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}const I=C("DXT1"),P=C("DXT3"),D=C("DXT5");var L,N,F=n(12569),z=n(90553),H=n(10956);class V extends A.J{get parameters(){return this._parameters}constructor(e,t){super(),this._data=e,this.type=M.X.Texture,this._glTexture=null,this._loadingPromise=null,this._loadingController=null,this.events=new r.A,this._parameters={...k,...t},this._startPreload(e)}dispose(){this.unload(),this._data=this.frameUpdate=void 0}_startPreload(e){null!=e&&(e instanceof HTMLVideoElement?(this.frameUpdate=t=>this._frameUpdate(e,t),this._startPreloadVideoElement(e)):e instanceof HTMLImageElement&&this._startPreloadImageElement(e))}_startPreloadVideoElement(e){if(!((0,l.w8)(e.src)||"auto"===e.preload&&e.crossOrigin)){e.preload="auto",e.crossOrigin="anonymous";const t=!e.paused;if(e.src=e.src,t&&e.autoplay){const t=()=>{e.removeEventListener("canplay",t),e.play()};e.addEventListener("canplay",t)}}}_startPreloadImageElement(e){(0,l.DB)(e.src)||(0,l.w8)(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)}_createDescriptor(e){const t=new H.R;return t.wrapMode=this._parameters.wrap??m.pF.REPEAT,t.flipped=!this._parameters.noUnpackFlip,t.samplingMode=this._parameters.mipmap?m.Cj.LINEAR_MIPMAP_LINEAR:m.Cj.LINEAR,t.hasMipmap=!!this._parameters.mipmap,t.preMultiplyAlpha=!!this._parameters.preMultiplyAlpha,t.maxAnisotropy=this._parameters.maxAnisotropy??(this._parameters.mipmap?e.parameters.maxMaxAnisotropy:1),t}get glTexture(){return this._glTexture}get memoryEstimate(){return this._glTexture?.usedMemory||function(e,t){if(null==e)return 0;if((0,a.mw)(e)||(0,a.mg)(e))return t.encoding===h.JS.KTX2_ENCODING?function(e,t){if(null==y)return e.byteLength;const n=new y.KTX2File(new Uint8Array(e)),i=S(n)?x(n.getLevels(),n.getHasAlpha(),n.getWidth(),n.getHeight(),t):0;return n.close(),n.delete(),i}(e,!!t.mipmap):t.encoding===h.JS.BASIS_ENCODING?function(e,t){if(null==y)return e.byteLength;const n=new y.BasisFile(new Uint8Array(e)),i=w(n)?x(n.getNumLevels(0),n.getHasAlpha(),n.getImageWidth(0,0),n.getImageHeight(0,0),t):0;return n.close(),n.delete(),i}(e,!!t.mipmap):e.byteLength;const{width:n,height:i}=e instanceof Image||e instanceof ImageData||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement?U(e):t;return(t.mipmap?4/3:1)*n*i*(t.components||4)||0}(this._data,this._parameters)}load(e){if(this._glTexture)return this._glTexture;if(this._loadingPromise)return this._loadingPromise;const t=this._data;return null==t?(this._glTexture=new _.g(e,this._createDescriptor(e),null),this._glTexture):(this._parameters.reloadable||(this._data=void 0),"string"==typeof t?this._loadFromURL(e,t):t instanceof Image?this._loadFromImageElement(e,t):t instanceof HTMLVideoElement?this._loadFromVideoElement(e,t):t instanceof ImageData||t instanceof HTMLCanvasElement?this._loadFromImage(e,t):(0,a.mg)(t)&&this._parameters.encoding===h.JS.DDS_ENCODING?this._loadFromDDSData(e,t):(0,a.mw)(t)&&this._parameters.encoding===h.JS.DDS_ENCODING?this._loadFromDDSData(e,new Uint8Array(t)):((0,a.mw)(t)||(0,a.mg)(t))&&this._parameters.encoding===h.JS.KTX2_ENCODING?this._loadFromKTX2(e,t):((0,a.mw)(t)||(0,a.mg)(t))&&this._parameters.encoding===h.JS.BASIS_ENCODING?this._loadFromBasis(e,t):(0,a.mg)(t)?this._loadFromPixelData(e,t):(0,a.mw)(t)?this._loadFromPixelData(e,new Uint8Array(t)):null)}_frameUpdate(e,t){return null==this._glTexture||e.readyState<L.HAVE_CURRENT_DATA||t===e.currentTime?t:(this._glTexture.setData(e),this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this._parameters.updateCallback&&this._parameters.updateCallback(),e.currentTime)}_loadFromDDSData(e,t){return this._glTexture=function(e,t,n){const i=function(e,t){const n=new Int32Array(e.buffer,e.byteOffset,31);if(542327876!==n[0])return R().error("Invalid magic number in DDS header"),null;if(!(4&n[20]))return R().error("Unsupported format, must contain a FourCC code"),null;const i=n[21];let r,o;switch(i){case I:r=8,o=m.CQ.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case P:r=16,o=m.CQ.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case D:r=16,o=m.CQ.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return R().error("Unsupported FourCC code:",function(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}(i)),null}let s=1,a=n[4],l=n[3];(3&a||3&l)&&(R().warn("Rounding up compressed texture size to nearest multiple of 4."),a=a+3&-4,l=l+3&-4);const c=a,u=l;let h,d;131072&n[2]&&!1!==t&&(s=Math.max(1,n[7]));let p=e.byteOffset+n[1]+4;const f=[];for(let t=0;t<s;++t)d=(a+3>>2)*(l+3>>2)*r,h=new Uint8Array(e.buffer,p,d),f.push(h),p+=d,a=Math.max(1,a>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:f},internalFormat:o,width:c,height:u}}(n,t.hasMipmap??!1);if(null==i)throw new Error("DDS texture data is null");const{textureData:r,internalFormat:o,width:s,height:a}=i;return t.samplingMode=r.levels.length>1?m.Cj.LINEAR_MIPMAP_LINEAR:m.Cj.LINEAR,t.hasMipmap=r.levels.length>1,t.internalFormat=o,t.width=s,t.height=a,new _.g(e,t,r)}(e,this._createDescriptor(e),t),this._glTexture}_loadFromKTX2(e,t){return this._loadAsync((()=>async function(e,t,n){null==y&&(y=await T());const i=new y.KTX2File(new Uint8Array(n));if(!S(i))return null;i.startTranscoding();const r=E(e,t,i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),((e,t)=>i.getImageTranscodedSizeInBytes(e,0,0,t)),((e,t,n)=>i.transcodeImage(n,e,0,0,t,0,-1,-1)));return i.close(),i.delete(),r}(e,this._createDescriptor(e),t).then((e=>(this._glTexture=e,e)))))}_loadFromBasis(e,t){return this._loadAsync((()=>async function(e,t,n){null==y&&(y=await T());const i=new y.BasisFile(new Uint8Array(n));if(!w(i))return null;i.startTranscoding();const r=E(e,t,i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),((e,t)=>i.getImageTranscodedSizeInBytes(0,e,t)),((e,t,n)=>i.transcodeImage(n,0,e,t,0,0)));return i.close(),i.delete(),r}(e,this._createDescriptor(e),t).then((e=>(this._glTexture=e,e)))))}_loadFromPixelData(e,t){(0,z.vA)(this._parameters.width>0&&this._parameters.height>0);const n=this._createDescriptor(e);return n.pixelFormat=1===this._parameters.components?m.Ab.LUMINANCE:3===this._parameters.components?m.Ab.RGB:m.Ab.RGBA,n.width=this._parameters.width??0,n.height=this._parameters.height??0,this._glTexture=new _.g(e,n,t),this._glTexture}_loadFromURL(e,t){return this._loadAsync((async n=>{const i=await(0,c.D)(t,{signal:n});return(0,s.Te)(n),this._loadFromImage(e,i)}))}_loadFromImageElement(e,t){return t.complete?this._loadFromImage(e,t):this._loadAsync((async n=>{const i=await(0,u.Sx)(t,t.src,!1,n);return(0,s.Te)(n),this._loadFromImage(e,i)}))}_loadFromVideoElement(e,t){return t.readyState>=L.HAVE_CURRENT_DATA?this._loadFromImage(e,t):this._loadFromVideoElementAsync(e,t)}_loadFromVideoElementAsync(e,t){return this._loadAsync((n=>new Promise(((r,a)=>{const l=()=>{t.removeEventListener("loadeddata",c),t.removeEventListener("error",u),(0,o.xt)(h)},c=()=>{t.readyState>=L.HAVE_CURRENT_DATA&&(l(),r(this._loadFromImage(e,t)))},u=e=>{l(),a(e||new i.A("Failed to load video"))};t.addEventListener("loadeddata",c),t.addEventListener("error",u);const h=(0,s.u7)(n,(()=>u((0,s.NK)())))}))))}_loadFromImage(e,t){let n=t;if(!(n instanceof HTMLVideoElement)){const{maxTextureSize:t}=e.parameters;n=this._parameters.downsampleUncompressed?(0,F.IR)(n,t):(0,F.vM)(n,t)}const i=U(n);this._parameters.width=i.width,this._parameters.height=i.height;const r=this._createDescriptor(e);return r.pixelFormat=3===this._parameters.components?m.Ab.RGB:m.Ab.RGBA,r.width=i.width,r.height=i.height,this._glTexture=new _.g(e,r,n),this._glTexture}_loadAsync(e){const t=new AbortController;this._loadingController=t;const n=e(t.signal);this._loadingPromise=n;const i=()=>{this._loadingController===t&&(this._loadingController=null),this._loadingPromise===n&&(this._loadingPromise=null)};return n.then(i,i),n}unload(){if(this._glTexture=(0,o.WD)(this._glTexture),null!=this._loadingController){const e=this._loadingController;this._loadingController=null,this._loadingPromise=null,e.abort()}this.events.emit("unloaded")}}function U(e){return e instanceof HTMLVideoElement?{width:e.videoWidth,height:e.videoHeight}:e}(N=L||(L={}))[N.HAVE_NOTHING=0]="HAVE_NOTHING",N[N.HAVE_METADATA=1]="HAVE_METADATA",N[N.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",N[N.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",N[N.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA";const k={wrap:{s:m.pF.REPEAT,t:m.pF.REPEAT},mipmap:!0,noUnpackFlip:!1,preMultiplyAlpha:!1,downsampleUncompressed:!1}},91998:function(e,t,n){"use strict";var i;n.d(t,{q:function(){return i}}),function(e){e[e.ASYNC=0]="ASYNC",e[e.SYNC=1]="SYNC"}(i||(i={}))},90553:function(e,t,n){"use strict";n.d(t,{L:function(){return l},MX:function(){return s},O_:function(){return a},kL:function(){return c},vA:function(){return o},zH:function(){return u}});var i=n(1932);n(33400),(0,n(41546).vt)();class r{constructor(e){this.message=e}toString(){return`AssertException: ${this.message}`}}function o(e,t="Assertion"){if(!e){const e=new Error(t).stack;throw new r(`${t} at ${e}`)}}function s(e,t){e||(t=t||"",console.warn("Verify failed: "+t+"\n"+new Error("verify").stack))}function a(e,t,n,i){let r,o=(n[0]-e[0])/t[0],s=(i[0]-e[0])/t[0];o>s&&(r=o,o=s,s=r);let a=(n[1]-e[1])/t[1],l=(i[1]-e[1])/t[1];if(a>l&&(r=a,a=l,l=r),o>l||a>s)return!1;a>o&&(o=a),l<s&&(s=l);let c=(n[2]-e[2])/t[2],u=(i[2]-e[2])/t[2];return c>u&&(r=c,c=u,u=r),!(o>u||c>s||(u<s&&(s=u),s<0))}function l(e,t,n,r,o,s=(0,i.vt)()){const a=(r[o]-n[o])*(t[0]-e[0])-(r[0]-n[0])*(t[o]-e[o]),l=(r[0]-n[0])*(e[o]-n[o])-(r[o]-n[o])*(e[0]-n[0]);if(0===a)return!1;const c=l/a;return s[0]=e[0]+c*(t[0]-e[0]),s[1]=e[o]+c*(t[o]-e[o]),!0}function c(e,t){return Math.log(e)/Math.log(t)}function u(e){return 1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&1===e[15]}},69445:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});var i=n(81438);class r extends i.Z{}},65839:function(e,t,n){"use strict";var i;function r(e){return e===i.POSITION}n.d(t,{b:function(){return r},r:function(){return i}}),function(e){e.POSITION="position",e.NORMAL="normal",e.NORMALCOMPRESSED="normalCompressed",e.UV0="uv0",e.COLOR="color",e.SYMBOLCOLOR="symbolColor",e.SIZE="size",e.ROTATION="rotation",e.TANGENT="tangent",e.OFFSET="offset",e.PERSPECTIVEDIVIDE="perspectiveDivide",e.CENTEROFFSETANDDISTANCE="centerOffsetAndDistance",e.LENGTH="length",e.PREVPOSITION="prevPosition",e.NEXTPOSITION="nextPosition",e.SUBDIVISIONFACTOR="subdivisionFactor",e.COLORFEATUREATTRIBUTE="colorFeatureAttribute",e.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",e.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",e.DISTANCETOSTART="distanceToStart",e.UVMAPSPACE="uvMapSpace",e.BOUNDINGRECT="boundingRect",e.UVREGION="uvRegion",e.PROFILERIGHT="profileRight",e.PROFILEUP="profileUp",e.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",e.FEATUREVALUE="featureValue",e.INSTANCEMODELORIGINHI="instanceModelOriginHi",e.INSTANCEMODELORIGINLO="instanceModelOriginLo",e.INSTANCEMODEL="instanceModel",e.INSTANCEMODELNORMAL="instanceModelNormal",e.INSTANCECOLOR="instanceColor",e.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",e.LOCALTRANSFORM="localTransform",e.GLOBALTRANSFORM="globalTransform",e.BOUNDINGSPHERE="boundingSphere",e.MODELORIGIN="modelOrigin",e.MODELSCALEFACTORS="modelScaleFactors",e.FEATUREATTRIBUTE="featureAttribute",e.STATE="state",e.LODLEVEL="lodLevel",e.POSITION0="position0",e.POSITION1="position1",e.NORMAL2COMPRESSED="normal2Compressed",e.COMPONENTINDEX="componentIndex",e.VARIANTOFFSET="variantOffset",e.VARIANTSTROKE="variantStroke",e.VARIANTEXTENSION="variantExtension",e.SIDENESS="sideness",e.START="start",e.END="end",e.UP="up",e.START_UP="startUp",e.END_UP="endUp",e.EXTRUDE="extrude",e.OBJECTANDLAYERIDCOLOR="objectAndLayerIdColor",e.INSTANCEOBJECTANDLAYERIDCOLOR="instanceObjectAndLayerIdColor"}(i||(i={}))},1296:function(e,t,n){"use strict";n.d(t,{x:function(){return d}});var i=n(48996),r=n(14606),o=n(95929),s=n(7187),a=n(48015),l=n(40359);const c=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","transformationChanged","shaderTransformationChanged","visibilityChanged","occlusionChanged","highlightChanged","geometryAdded","geometryRemoved","attributesChanged"];var u=n(35363),h=n(91998);class d extends a.J{constructor(e,t,n=""){super(),this.stage=e,this.apiLayerUid=n,this.type=l.X.Layer,this.events=new i.A,this.visible=!0,this.sliceable=!1,this._objectsAdded=new s.A,this._handles=new r.A,this._objects=new s.A,this._pickable=!0,this.visible=t?.visible??!0,this._pickable=t?.pickable??!0,this.updatePolicy=t?.updatePolicy??h.q.ASYNC,this._disableOctree=t?.disableOctree??!1,e.add(this);for(const t of c)this._handles.add(this.events.on(t,(n=>e.handleEvent(t,n))))}destroy(){this._handles.size&&(this._handles.destroy(),this.stage.remove(this),this.invalidateSpatialQueryAccelerator())}get objects(){return this._objects}set pickable(e){this._pickable=e}get pickable(){return this._pickable&&this.visible}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),null!=this._octree&&this._objectsAdded.push(e)}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),null!=this._octree&&(this._objectsAdded.removeUnordered(e)||this._octree.remove([e])))}addMany(e){this._objects.pushArray(e);for(const t of e)t.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),null!=this._octree&&this._objectsAdded.pushArray(e)}removeMany(e){const t=new Array;if(this._objects.removeUnorderedMany(e,e.length,t),0!==t.length){for(const e of t)e.parentLayer=null;if(this.events.emit("layerObjectsRemoved",{layer:this,objects:t}),null!=this._octree){for(let e=0;e<t.length;)this._objectsAdded.removeUnordered(t[e])?(t[e]=t[t.length-1],t.length-=1):++e;this._octree.remove(t)}}}sync(){this.updatePolicy!==h.q.SYNC&&this.stage.syncLayer(this.id)}notifyObjectBBChanged(e,t){null==this._octree||this._objectsAdded.includes(e)||this._octree.update(e,t)}getSpatialQueryAccelerator(){return null==this._octree&&this._objects.length>50&&!this._disableOctree?(this._octree=new u.A((e=>e.boundingVolumeWorldSpace.bounds)),this._octree.add(this._objects.data,this._objects.length)):null!=this._octree&&this._objectsAdded.length>0&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear()),this._octree}invalidateSpatialQueryAccelerator(){this._octree=(0,o.pR)(this._octree),this._objectsAdded.clear()}}},54407:function(e,t,n){"use strict";var i,r,o,s,a,l,c,u;n.d(t,{Am:function(){return s},C7:function(){return o},JS:function(){return u},Mg:function(){return l},dd:function(){return a},it:function(){return r},s2:function(){return i},sf:function(){return c}}),function(e){e[e.None=0]="None",e[e.Front=1]="Front",e[e.Back=2]="Back",e[e.COUNT=3]="COUNT"}(i||(i={})),function(e){e[e.Less=0]="Less",e[e.Lequal=1]="Lequal",e[e.COUNT=2]="COUNT"}(r||(r={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.UPDATE=1]="UPDATE"}(o||(o={})),function(e){e[e.NOT_LOADED=0]="NOT_LOADED",e[e.LOADING=1]="LOADING",e[e.LOADED=2]="LOADED"}(s||(s={})),function(e){e[e.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",e[e.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(a||(a={})),function(e){e[e.Highlight=0]="Highlight",e[e.MaskOccludee=1]="MaskOccludee"}(l||(l={})),function(e){e[e.Blend=0]="Blend",e[e.Opaque=1]="Opaque",e[e.Mask=2]="Mask",e[e.MaskBlend=3]="MaskBlend",e[e.COUNT=4]="COUNT"}(c||(c={})),function(e){e.DDS_ENCODING="image/vnd-ms.dds",e.KTX2_ENCODING="image/ktx2",e.BASIS_ENCODING="image/x.basis"}(u||(u={}))},59356:function(e,t,n){"use strict";n.d(t,{i3:function(){return r}}),n(20551);var i=n(32501);function r(e){return null!=e?.dist}n(2075),n(38177),(0,i.vt)()},57701:function(e,t,n){"use strict";n.d(t,{$T:function(){return a},zj:function(){return r}});var i,r,o,s=n(23545);function a(e){const t=new Map,n=e=>{let n=t.get(e);return n||(n=new s.a0,t.set(e,n)),n};return e.removes.forAll((e=>{l(e)&&n(e.material).removes.push(e)})),e.adds.forAll((e=>{l(e)&&n(e.material).adds.push(e)})),e.updates.forAll((e=>{l(e.renderGeometry)&&n(e.renderGeometry.material).updates.push(e)})),t}function l(e){return e.geometry.indexCount>=1}(o=i||(i={}))[o.Default=0]="Default",o[o.Screenshot=1]="Screenshot",o[o.ObjectAndLayerID=2]="ObjectAndLayerID",function(e){e[e.TOP=0]="TOP",e[e.RIGHT=1]="RIGHT",e[e.BOTTOM=2]="BOTTOM",e[e.LEFT=3]="LEFT"}(r||(r={}))},54035:function(e,t,n){"use strict";n.d(t,{MD:function(){return l},cJ:function(){return a},hs:function(){return c},m0:function(){return s}});var i=n(15774),r=(n(2075),n(13794));function o(e,t,n){const i=n.parameters;return u.scale=Math.min(i.divisor/(t-i.offset),1),u.factor=function(e){return Math.abs(e*e*e)}(e),u}function s(e,t){return(0,i.Cc)(e*Math.max(t.scale,t.minScaleFactor),e,t.factor)}function a(e,t,n,i){i.scale=function(e,t,n){const i=o(e,t,n);return i.minScaleFactor=0,s(1,i)}(e,t,n),i.factor=0,i.minScaleFactor=n.minScaleFactor}function l(e,t,n=[0,0]){const i=Math.min(Math.max(t.scale,t.minScaleFactor),1);return n[0]=e[0]*i,n[1]=e[1]*i,n}function c(e,t,n,i){return s(e,o(t,n,i))}n(65420),(0,i.kU)(10),(0,i.kU)(12),(0,i.kU)(70),(0,i.kU)(40);const u={scale:0,factor:0,minScaleFactor:0};(0,r.c)()},10228:function(e,t,n){"use strict";n.d(t,{G:function(){return i},Q:function(){return r}});const i={stableRendering:!1},r={rootOrigin:null}},12569:function(e,t,n){"use strict";n.d(t,{IR:function(){return a},Mv:function(){return o},uT:function(){return s},vM:function(){return l}});var i=n(39819);const r=16;function o(e){return Math.ceil(e/r)*r}function s(e){return Math.floor(e/r)*r}function a(e,t){let n=e.width*e.height;if(n<4096)return e instanceof ImageData?u(e):e;let i=e.width,r=e.height;do{i=Math.ceil(i/2),r=Math.ceil(r/2),n=i*r}while(n>1048576||null!=t&&(i>t||r>t));return c(e,i,r)}function l(e,t){const n=Math.max(e.width,e.height);if(n<=t)return e;const i=t/n;return c(e,Math.round(e.width*i),Math.round(e.height*i))}function c(e,t,n){if(e instanceof ImageData)return c(u(e),t,n);const i=document.createElement("canvas");return i.width=t,i.height=n,i.getContext("2d").drawImage(e,0,0,i.width,i.height),i}function u(e){const t=document.createElement("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");if(null==n)throw new i.A("Failed to create 2d context from HTMLCanvasElement");return n.putImageData(e,0,0),t}},22323:function(e,t,n){"use strict";n.d(t,{dg:function(){return d},ou:function(){return g}});var i=n(44705),r=n(87725),o=n(73364),s=n(39714),a=n(20551),l=n(32501),c=n(13794),u=n(65420),h=n(89765);class d{constructor(){this._transform=(0,s.vt)(),this._transformInverse=new p({value:this._transform},o.B8,s.vt),this._transformInverseTranspose=new p(this._transformInverse,o.mg,s.vt),this._transformTranspose=new p({value:this._transform},o.mg,s.vt),this._transformInverseRotation=new p({value:this._transform},i.dR,r.vt)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(e){(0,o.C)(this._transform,e)}multiplyTransform(e){(0,o.lw)(this._transform,this._transform,e)}set(e){(0,o.C)(this._transform,e),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(e,t){this.setTransformMatrix(e),this.multiplyTransform(t),this._invalidateLazyTransforms()}}class p{constructor(e,t,n){this._original=e,this._update=t,this._dirty=!0,this._transform=n()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}}const f=new class{constructor(e=0){this.offset=e,this.sphere=(0,c.c)(),this.tmpVertex=(0,l.vt)()}applyToVertex(e,t,n){const i=this.objectTransform.transform,r=(0,a.i)(m,e,t,n),o=(0,a.t)(r,r,i),s=this.offset/(0,a.l)(o);(0,a.b)(o,o,o,s);const l=this.objectTransform.inverse;return(0,a.t)(this.tmpVertex,o,l),this.tmpVertex}applyToMinMax(e,t){const n=this.offset/(0,a.l)(e);(0,a.b)(e,e,e,n);const i=this.offset/(0,a.l)(t);(0,a.b)(t,t,t,i)}applyToAabb(e){const t=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*t,e[1]+=e[1]*t,e[2]+=e[2]*t;const n=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*n,e[4]+=e[4]*n,e[5]+=e[5]*n,e}applyToBoundingSphere(e){const t=(0,a.l)((0,c.a)(e)),n=this.offset/t;return(0,a.b)((0,c.a)(this.sphere),(0,c.a)(e),(0,c.a)(e),n),this.sphere[3]=e[3]+e[3]*this.offset/t,this.sphere}};function g(e){return null!=e?(f.offset=e,f):null}new class{constructor(e=0){this.componentLocalOriginLength=0,this._totalOffset=0,this._offset=0,this._tmpVertex=(0,l.vt)(),this._tmpMbs=(0,c.c)(),this._tmpObb=new h.ab,this._resetOffset(e)}_resetOffset(e){this._offset=e,this._totalOffset=e}set offset(e){this._resetOffset(e)}get offset(){return this._offset}set componentOffset(e){this._totalOffset=this._offset+e}set localOrigin(e){this.componentLocalOriginLength=(0,a.l)(e)}applyToVertex(e,t,n){const i=(0,a.i)(m,e,t,n),r=(0,a.i)(_,e,t,n+this.componentLocalOriginLength),o=this._totalOffset/(0,a.l)(r);return(0,a.b)(this._tmpVertex,i,r,o),this._tmpVertex}applyToAabb(e){const t=this.componentLocalOriginLength,n=e[0],i=e[1],r=e[2]+t,o=e[3],s=e[4],a=e[5]+t,l=Math.abs(n),c=Math.abs(i),u=Math.abs(r),h=Math.abs(o),d=Math.abs(s),p=Math.abs(a),f=.5*(1+Math.sign(n*o))*Math.min(l,h),g=.5*(1+Math.sign(i*s))*Math.min(c,d),m=.5*(1+Math.sign(r*a))*Math.min(u,p),_=Math.max(l,h),v=Math.max(c,d),y=Math.max(u,p),b=Math.sqrt(f*f+g*g+m*m),T=Math.sign(l+n),x=Math.sign(c+i),w=Math.sign(u+r),S=Math.sign(h+o),E=Math.sign(d+s),A=Math.sign(p+a),M=this._totalOffset;if(b<M)return e[0]-=(1-T)*M,e[1]-=(1-x)*M,e[2]-=(1-w)*M,e[3]+=S*M,e[4]+=E*M,e[5]+=A*M,e;const O=M/Math.sqrt(_*_+v*v+y*y),R=M/b,C=R-O,I=-C;return e[0]+=n*(T*I+R),e[1]+=i*(x*I+R),e[2]+=r*(w*I+R),e[3]+=o*(S*C+O),e[4]+=s*(E*C+O),e[5]+=a*(A*C+O),e}applyToMbs(e){const t=(0,a.l)((0,c.a)(e)),n=this._totalOffset/t;return(0,a.b)((0,c.a)(this._tmpMbs),(0,c.a)(e),(0,c.a)(e),n),this._tmpMbs[3]=e[3]+e[3]*this._totalOffset/t,this._tmpMbs}applyToObb(e){return(0,h.gm)(e,this._totalOffset,this._totalOffset,u.RT.Global,this._tmpObb),this._tmpObb}},new class{constructor(e=0){this.offset=e,this.tmpVertex=(0,l.vt)()}applyToVertex(e,t,n){const i=(0,a.i)(m,e,t,n),r=(0,a.g)(_,i,this.localOrigin),o=this.offset/(0,a.l)(r);return(0,a.b)(this.tmpVertex,i,r,o),this.tmpVertex}applyToAabb(e){const t=v,n=y,i=b;for(let r=0;r<3;++r)t[r]=e[0+r]+this.localOrigin[r],n[r]=e[3+r]+this.localOrigin[r],i[r]=t[r];const r=this.applyToVertex(t[0],t[1],t[2]);for(let t=0;t<3;++t)e[t]=r[t],e[t+3]=r[t];const o=t=>{const n=this.applyToVertex(t[0],t[1],t[2]);for(let t=0;t<3;++t)e[t]=Math.min(e[t],n[t]),e[t+3]=Math.max(e[t+3],n[t])};for(let e=1;e<8;++e){for(let r=0;r<3;++r)i[r]=e&1<<r?n[r]:t[r];o(i)}let s=0;for(let e=0;e<3;++e)t[e]*n[e]<0&&(s|=1<<e);if(0!==s&&7!==s)for(let e=0;e<8;++e)if(!(s&e)){for(let r=0;r<3;++r)i[r]=s&1<<r?0:e&1<<r?t[r]:n[r];o(i)}for(let t=0;t<3;++t)e[t]-=this.localOrigin[t],e[t+3]-=this.localOrigin[t];return e}};const m=(0,l.vt)(),_=(0,l.vt)(),v=(0,l.vt)(),y=(0,l.vt)(),b=(0,l.vt)()},35910:function(e,t,n){"use strict";n.d(t,{$p:function(){return r},Qx:function(){return s},_y:function(){return o},e_:function(){return a}});var i=n(32501);class r{constructor(e=(0,i.Ul)()){this.intensity=e}}class o{constructor(e=(0,i.Ul)(),t=(0,i.fA)(.57735,.57735,.57735)){this.intensity=e,this.direction=t}}class s{constructor(e=(0,i.Ul)(),t=(0,i.fA)(.57735,.57735,.57735),n=!0,r=1,o=1){this.intensity=e,this.direction=t,this.castShadows=n,this.specularStrength=r,this.environmentStrength=o}}class a{constructor(){this.r=[0],this.g=[0],this.b=[0]}}},95629:function(e,t,n){"use strict";n.d(t,{TA:function(){return E},uH:function(){return S}});var i=n(15774),r=n(20551),o=n(32501),s=n(35910);function a(e,t,n){(n=n||e).length=e.length;for(let i=0;i<e.length;i++)n[i]=e[i]*t[i];return n}function l(e,t,n){(n=n||e).length=e.length;for(let i=0;i<e.length;i++)n[i]=e[i]*t;return n}function c(e,t,n){(n=n||e).length=e.length;for(let i=0;i<e.length;i++)n[i]=e[i]+t[i];return n}function u(e){return(e+1)*(e+1)}function h(e,t,n){const i=e[0],r=e[1],o=e[2],s=n||[];return s.length=u(t),t>=0&&(s[0]=.28209479177),t>=1&&(s[1]=.4886025119*i,s[2]=.4886025119*o,s[3]=.4886025119*r),t>=2&&(s[4]=1.09254843059*i*r,s[5]=1.09254843059*r*o,s[6]=.31539156525*(3*o*o-1),s[7]=1.09254843059*i*o,s[8]=.54627421529*(i*i-r*r)),s}function d(e,t){const n=u(e),i=t||{r:[],g:[],b:[]};i.r.length=i.g.length=i.b.length=n;for(let e=0;e<n;e++)i.r[e]=i.g[e]=i.b[e]=0;return i}function p(e,t){const n=function(e){return(0,i.qE)(Math.floor(Math.sqrt(e)-1),0,2)}(t.r.length);for(const i of e)(0,r.v)(b,i.direction),h(b,n,v),a(v,T),l(v,i.intensity[0],y),c(t.r,y),l(v,i.intensity[1],y),c(t.g,y),l(v,i.intensity[2],y),c(t.b,y);return t}function f(e,t){h(b,0,v);for(const n of e)t.r[0]+=v[0]*T[0]*n.intensity[0]*4*Math.PI,t.g[0]+=v[0]*T[0]*n.intensity[1]*4*Math.PI,t.b[0]+=v[0]*T[0]*n.intensity[2]*4*Math.PI;return t}const g=[],m=[],_=[],v=[0],y=[0],b=(0,o.vt)(),T=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];class x{constructor(){this.color=(0,o.vt)(),this.intensity=1}}class w{constructor(){this.direction=(0,o.vt)(),this.ambient=new x,this.diffuse=new x}}const S=.4;class E{constructor(){this._shOrder=2,this._legacy=new w,this.globalFactor=.5,this.noonFactor=.5,this._sphericalHarmonics=new s.e_,this._mainLight=new s.Qx((0,o.vt)(),(0,o.fA)(1,0,0),!1)}get legacy(){return this._legacy}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}set(e){(function(e,t,n,i){d(t,i),(0,r.i)(n.intensity,0,0,0);let o=!1;const a=g,l=m,u=_;a.length=0,l.length=0,u.length=0;for(const t of e)t instanceof s.Qx&&!o?((0,r.c)(n.direction,t.direction),(0,r.c)(n.intensity,t.intensity),n.specularStrength=t.specularStrength,n.environmentStrength=t.environmentStrength,n.castShadows=t.castShadows,o=!0):t instanceof s.Qx||t instanceof s._y?a.push(t):t instanceof s.$p?l.push(t):t instanceof s.e_&&u.push(t);p(a,i),f(l,i);for(const e of u)c(i.r,e.r),c(i.g,e.g),c(i.b,e.b)})(e,this._shOrder,this._mainLight,this._sphericalHarmonics),(0,r.c)(this._legacy.direction,this._mainLight.direction);const t=1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*t,this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*t,this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*t,(0,r.h)(this._legacy.diffuse.color,this._mainLight.intensity,t),(0,r.c)(A,this._legacy.diffuse.color),(0,r.h)(A,A,S*this.globalFactor),(0,r.g)(this._legacy.ambient.color,this._legacy.ambient.color,A)}copyFrom(e){this._sphericalHarmonics.r=Array.from(e.sh.r),this._sphericalHarmonics.g=Array.from(e.sh.g),this._sphericalHarmonics.b=Array.from(e.sh.b),(0,r.c)(this._mainLight.direction,e.mainLight.direction),(0,r.c)(this._mainLight.intensity,e.mainLight.intensity),this._mainLight.castShadows=e.mainLight.castShadows,this._mainLight.specularStrength=e.mainLight.specularStrength,this._mainLight.environmentStrength=e.mainLight.environmentStrength,this.globalFactor=e.globalFactor,this.noonFactor=e.noonFactor}lerpLighting(e,t,n){if((0,r.m)(this._mainLight.intensity,e.mainLight.intensity,t.mainLight.intensity,n),this._mainLight.environmentStrength=(0,i.Cc)(e.mainLight.environmentStrength,t.mainLight.environmentStrength,n),this._mainLight.specularStrength=(0,i.Cc)(e.mainLight.specularStrength,t.mainLight.specularStrength,n),(0,r.c)(this._mainLight.direction,t.mainLight.direction),this._mainLight.castShadows=t.mainLight.castShadows,this.globalFactor=(0,i.Cc)(e.globalFactor,t.globalFactor,n),this.noonFactor=(0,i.Cc)(e.noonFactor,t.noonFactor,n),e.sh.r.length===t.sh.r.length)for(let r=0;r<t.sh.r.length;r++)this._sphericalHarmonics.r[r]=(0,i.Cc)(e.sh.r[r],t.sh.r[r],n),this._sphericalHarmonics.g[r]=(0,i.Cc)(e.sh.g[r],t.sh.g[r],n),this._sphericalHarmonics.b[r]=(0,i.Cc)(e.sh.b[r],t.sh.b[r],n);else for(let e=0;e<t.sh.r.length;e++)this._sphericalHarmonics.r[e]=t.sh.r[e],this._sphericalHarmonics.g[e]=t.sh.g[e],this._sphericalHarmonics.b[e]=t.sh.b[e]}}const A=(0,o.vt)()},48042:function(e,t,n){"use strict";n.d(t,{v:function(){return I}});var i=n(41546),r=n(65856),o=n(27264),s=n(28686),a=n(39534),l=n(54407),c=n(4875),u=n(46921),h=n(29165),d=n(65839),p=n(84264),f=n(27291),g=n(77971),m=n(34615),_=n(82273),v=n(54840),y=n(6200),b=n(38474),T=n(85456),x=n(57087);g.S;class w extends _.w{constructor(e,t,i){super(e,t,new m.$(b.C,(()=>n.e(2523).then(n.bind(n,62970)))),i)}_createPipeline(e,t){const{oitPass:n,output:i,transparent:r,cullFace:s,draped:a,hasOccludees:l,polygonOffset:c,enableOffset:h}=e,d=n===v.Y.NONE,p=n===v.Y.FrontFace;return(0,x.Ey)({blending:i===o.V.Color&&r?(0,u.Yf)(n):null,culling:(0,x.Xt)(s),depthTest:a?null:{func:(0,u.K_)(n)},depthWrite:(0,u.z5)(e),drawBuffers:i===o.V.Depth?{buffers:[T.Hr.NONE]}:(0,u.m6)(n,i),colorWrite:x.kn,stencilWrite:l?y.v0:null,stencilTest:l?t?y.a9:y.qh:null,polygonOffset:d||p?c?S:null:(0,u.aB)(h)})}initializePipeline(e){return this._occludeePipelineState=this._createPipeline(e,!0),this._createPipeline(e,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}}const S={factor:1,units:1};var E=n(53804),A=n(2457),M=n(38130),O=n(65875),R=n(22095);class C extends R.E{constructor(){super(...arguments),this.cullFace=l.s2.None,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.discardInvisibleFragments=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.objectAndLayerIdColorInstanced=!1,this.vvColor=!1,this.draped=!1,this.textureCoordinateType=A.I.None,this.emissionSource=M.ZX.None,this.occlusionPass=!1,this.hasVvInstancing=!0,this.vvSize=!1,this.vvOpacity=!1}}(0,E._)([(0,O.W)({count:l.s2.COUNT})],C.prototype,"cullFace",void 0),(0,E._)([(0,O.W)()],C.prototype,"hasSlicePlane",void 0),(0,E._)([(0,O.W)()],C.prototype,"hasVertexColors",void 0),(0,E._)([(0,O.W)()],C.prototype,"transparent",void 0),(0,E._)([(0,O.W)()],C.prototype,"discardInvisibleFragments",void 0),(0,E._)([(0,O.W)()],C.prototype,"polygonOffset",void 0),(0,E._)([(0,O.W)()],C.prototype,"enableOffset",void 0),(0,E._)([(0,O.W)()],C.prototype,"writeDepth",void 0),(0,E._)([(0,O.W)()],C.prototype,"hasOccludees",void 0),(0,E._)([(0,O.W)()],C.prototype,"terrainDepthTest",void 0),(0,E._)([(0,O.W)()],C.prototype,"cullAboveTerrain",void 0),(0,E._)([(0,O.W)()],C.prototype,"objectAndLayerIdColorInstanced",void 0),(0,E._)([(0,O.W)()],C.prototype,"vvColor",void 0),(0,E._)([(0,O.W)()],C.prototype,"draped",void 0);class I extends f.W{constructor(e){super(e,D),this._configuration=new C,this.supportsEdges=!0,this.produces=new Map([[h.N.OPAQUE_MATERIAL,e=>this._isOpaqueMaterialPass(e)],[h.N.OPAQUE_MATERIAL_WITHOUT_NORMALS,e=>this._isOpaqueNoSSAODepthPass(e)],[h.N.TRANSPARENT_MATERIAL,e=>(0,o.zW)(e)&&this._transparent&&this.parameters.writeDepth],[h.N.TRANSPARENT_MATERIAL_WITHOUT_NORMALS,e=>(0,o.eh)(e)&&this._transparent&&this.parameters.writeDepth],[h.N.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,e=>(0,o.zW)(e)&&this._transparent&&!this.parameters.writeDepth],[h.N.DRAPED_MATERIAL,e=>(0,o.i3)(e)]])}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this._transparent,this._configuration.discardInvisibleFragments=this._transparent&&!this._isOpaquePass(e)&&this.parameters.discardInvisibleFragments,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=t.hasOccludees,this._configuration.oitPass=t.oitPass,this._configuration.enableOffset=t.camera.relativeElevation<u.xt,this._configuration.terrainDepthTest=t.terrainDepthTest,this._configuration.cullAboveTerrain=t.cullAboveTerrain,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.draped=this.parameters.draped,this._configuration}get visible(){return this.parameters.color[3]>=s.Q}get _transparent(){return this.parameters.color[3]<1||this.parameters.forceTransparentMode}_isOpaquePass(e){return this._isOpaqueMaterialPass(e)||this._isOpaqueNoSSAODepthPass(e)}_isOpaqueMaterialPass(e){return e===o.V.Highlight||(0,o.zW)(e)&&!this._transparent}_isOpaqueNoSSAODepthPass(e){return(0,o.eh)(e)&&this.parameters.writeDepth&&!this._transparent}createGLMaterial(e){return new P(e)}createBufferWriter(){const e=(0,r.BP)().vec3f(d.r.POSITION);return(0,a.E)()&&e.vec4u8(d.r.OBJECTANDLAYERIDCOLOR),this.parameters.vvColor?e.f32(d.r.COLORFEATUREATTRIBUTE):e.vec4u8(d.r.COLOR),new p.Z(e)}}class P extends c.A{beginSlot(e){return this.acquireTechnique(w,e)}}class D extends g.S{constructor(){super(...arguments),this.color=i.uY,this.forceTransparentMode=!1,this.writeDepth=!0,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=l.s2.None,this.draped=!1,this.discardInvisibleFragments=!1}}},84264:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var i=n(65839),r=n(93678);class o{constructor(e){this.vertexBufferLayout=e}elementCount(e){return e.get(i.r.POSITION).indices.length}write(e,t,n,i,o,s){(0,r.SA)(n,i,this.vertexBufferLayout,e,t,o,s)}}},73318:function(e,t,n){"use strict";n.d(t,{Ci:function(){return o},Dq:function(){return l},dB:function(){return a},zK:function(){return s}});var i=n(65856),r=n(65839);const o=(0,i.BP)().vec3f(r.r.POSITION),s=(0,i.BP)().vec3f(r.r.POSITION).vec2f(r.r.UV0),a=(0,i.BP)().vec3f(r.r.POSITION).vec4u8(r.r.COLOR),l=(0,i.BP)().vec3f(r.r.POSITION).vec2f(r.r.UV0).vec4u8(r.r.OBJECTANDLAYERIDCOLOR)},22095:function(e,t,n){"use strict";n.d(t,{E:function(){return c}});var i=n(53804),r=n(27264),o=n(65875);class s extends o.K{constructor(){super(...arguments),this.instancedDoublePrecision=!1,this.hasModelTransformation=!1}}(0,i._)([(0,o.W)()],s.prototype,"instancedDoublePrecision",void 0),(0,i._)([(0,o.W)()],s.prototype,"hasModelTransformation",void 0);var a=n(54516),l=n(54840);class c extends s{constructor(){super(...arguments),this.output=r.V.Color,this.oitPass=l.Y.NONE,this.hasSliceHighlight=!0,this.hasSliceInVertexProgram=!1,this.bindType=a.c.Pass,this.writeDepth=!0}}(0,i._)([(0,o.W)({count:r.V.COUNT})],c.prototype,"output",void 0),(0,i._)([(0,o.W)({count:l.Y.COUNT})],c.prototype,"oitPass",void 0)},51564:function(e,t,n){"use strict";n.d(t,{P:function(){return o}});var i=n(32501),r=n(94211);class o extends r.gy{constructor(e=(0,i.vt)()){super(),this.origin=e}get slicePlaneLocalOrigin(){return this.origin}}},6955:function(e,t,n){"use strict";n.d(t,{R:function(){return Z}});var i=n(15774),r=n(44705),o=n(87725),s=n(73364),a=n(39714),l=n(13786),c=n(1932),u=n(20551),h=n(32501),d=n(41546);var p=n(87416),f=n(92754),g=n(24129),m=n(70974),_=n(65856),v=n(27264),y=n(1143),b=n(28686),T=n(39534),x=n(36634),w=n(24100),S=n(29165),E=n(54035),A=n(90553),M=n(65839);class O{constructor(){this.scale=0,this.factor=0,this.minScaleFactor=0}}var R=n(93678),C=n(84887),I=n(88008),P=n(34615),D=n(82273),L=n(54840),N=n(46921),F=n(85456),z=n(57087);class H extends D.w{constructor(e,t,i){super(e,t,new P.$(I.H,(()=>n.e(8121).then(n.bind(n,47416)))),i),this.primitiveType=t.occlusionPass?F.WR.POINTS:F.WR.TRIANGLES}initializePipeline(e){const{oitPass:t,hasPolygonOffset:n,draped:i,output:r,depthTestEnabled:o}=e,s=t===L.Y.NONE,a=n?V:null,l=t===L.Y.ColorAlpha,c=i||!o||l||r===v.V.Highlight?null:z.Uy;return(0,z.Ey)({blending:r===v.V.Color?s?z.Os:(0,N.ez)(t):null,depthTest:o&&!i?{func:F.MT.LEQUAL}:null,depthWrite:c,drawBuffers:(0,N.m6)(t,r),colorWrite:z.kn,polygonOffset:a})}}const V={factor:0,units:-4};var U=n(53804),k=n(2457),B=n(38130),G=n(65875),$=n(22095);class j extends $.E{constructor(e){super(),this.spherical=e,this.screenCenterOffsetUnitsEnabled=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.hasRotation=!1,this.debugDrawLabelBorder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthTestEnabled=!0,this.pixelSnappingEnabled=!0,this.draped=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.occlusionPass=!1,this.occludedFragmentFade=!1,this.objectAndLayerIdColorInstanced=!1,this.horizonCullingEnabled=!0,this.textureCoordinateType=k.I.None,this.emissionSource=B.ZX.None,this.discardInvisibleFragments=!0,this.hasSliceInVertexProgram=!0,this.hasVvInstancing=!1}}(0,U._)([(0,G.W)()],j.prototype,"screenCenterOffsetUnitsEnabled",void 0),(0,U._)([(0,G.W)()],j.prototype,"occlusionTestEnabled",void 0),(0,U._)([(0,G.W)()],j.prototype,"signedDistanceFieldEnabled",void 0),(0,U._)([(0,G.W)()],j.prototype,"sampleSignedDistanceFieldTexelCenter",void 0),(0,U._)([(0,G.W)()],j.prototype,"vvSize",void 0),(0,U._)([(0,G.W)()],j.prototype,"vvColor",void 0),(0,U._)([(0,G.W)()],j.prototype,"hasVerticalOffset",void 0),(0,U._)([(0,G.W)()],j.prototype,"hasScreenSizePerspective",void 0),(0,U._)([(0,G.W)()],j.prototype,"hasRotation",void 0),(0,U._)([(0,G.W)()],j.prototype,"debugDrawLabelBorder",void 0),(0,U._)([(0,G.W)()],j.prototype,"hasSlicePlane",void 0),(0,U._)([(0,G.W)()],j.prototype,"hasPolygonOffset",void 0),(0,U._)([(0,G.W)()],j.prototype,"depthTestEnabled",void 0),(0,U._)([(0,G.W)()],j.prototype,"pixelSnappingEnabled",void 0),(0,U._)([(0,G.W)()],j.prototype,"draped",void 0),(0,U._)([(0,G.W)()],j.prototype,"terrainDepthTest",void 0),(0,U._)([(0,G.W)()],j.prototype,"cullAboveTerrain",void 0),(0,U._)([(0,G.W)()],j.prototype,"occlusionPass",void 0),(0,U._)([(0,G.W)()],j.prototype,"occludedFragmentFade",void 0),(0,U._)([(0,G.W)()],j.prototype,"objectAndLayerIdColorInstanced",void 0),(0,U._)([(0,G.W)()],j.prototype,"horizonCullingEnabled",void 0);class Z extends w.im{constructor(e,t){super(e,ge),this.produces=new Map([[S.N.HUD_MATERIAL,e=>(0,v.dX)(e)&&!this.parameters.drawInSecondSlot],[S.N.LABEL_MATERIAL,e=>(0,v.dX)(e)&&this.parameters.drawInSecondSlot],[S.N.OCCLUSION_PIXELS,()=>this.parameters.occlusionTest],[S.N.DRAPED_MATERIAL,e=>this.parameters.draped&&(0,v.dX)(e)]]),this._visible=!0,this._configuration=new j(t)}getConfiguration(e,t){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits,this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.draped=this.parameters.draped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.sampleSignedDistanceFieldTexelCenter=this.parameters.sampleSignedDistanceFieldTexelCenter,this._configuration.hasRotation=this.parameters.hasRotation,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.occlusionPass=t.slot===S.N.OCCLUSION_PIXELS,this._configuration.occludedFragmentFade=this.parameters.occludedFragmentFade,this._configuration.horizonCullingEnabled=this.parameters.horizonCullingEnabled,this._configuration.depthTestEnabled=this.parameters.depthEnabled||t.slot===S.N.OCCLUSION_PIXELS,e===v.V.Color&&(this._configuration.debugDrawLabelBorder=!!m.b.LABELS_SHOW_BORDER),this._configuration.oitPass=t.oitPass,this._configuration.terrainDepthTest=t.terrainDepthTest,this._configuration.cullAboveTerrain=t.cullAboveTerrain,this._configuration}intersect(e,t,n,i,o,a){const{options:{selectionMode:l,hud:c,excludeLabels:d},point:p,camera:f}=n,{parameters:g}=this;if(!l||!c||d&&g.isLabel||!e.visible||!p)return;const{scaleX:m,scaleY:_}=this._getScreenScale(e,f.pixelRatio);(0,r.z0)(re,t),e.attributes.has(M.r.FEATUREATTRIBUTE)&&function(e){const t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],s=e[5],a=e[6],l=e[7],c=e[8],u=1/Math.sqrt(t*t+n*n+i*i),h=1/Math.sqrt(r*r+o*o+s*s),d=1/Math.sqrt(a*a+l*l+c*c);e[0]=t*u,e[1]=n*u,e[2]=i*u,e[3]=r*h,e[4]=o*h,e[5]=s*h,e[6]=a*d,e[7]=l*d,e[8]=c*d}(re);const v=e.attributes.get(M.r.POSITION),y=e.attributes.get(M.r.SIZE),b=e.attributes.get(M.r.NORMAL),T=e.attributes.get(M.r.ROTATION),x=e.attributes.get(M.r.CENTEROFFSETANDDISTANCE);(0,A.vA)(v.size>=3);const w=(0,I.c)(g),S="screen"===this.parameters.centerOffsetUnits;for(let e=0;e<v.data.length/v.size;e++){const i=e*v.size;(0,u.i)(Q,v.data[i],v.data[i+1],v.data[i+2]),(0,u.t)(Q,Q,t),(0,u.t)(Q,Q,f.viewMatrix);const r=e*x.size;if((0,u.i)(ae,x.data[r],x.data[r+1],x.data[r+2]),!S&&(Q[0]+=ae[0],Q[1]+=ae[1],0!==ae[2])){const e=ae[2];(0,u.n)(ae,Q),(0,u.d)(Q,Q,(0,u.h)(ae,ae,e))}const o=e*b.size;if((0,u.i)(K,b.data[o],b.data[o+1],b.data[o+2]),q(K,re,f,ue),this._applyVerticalOffsetTransformationView(Q,ue,f,X),f.applyProjection(Q,J),J[0]>-1){S&&(ae[0]||ae[1])&&(J[0]+=ae[0]*f.pixelRatio,0!==ae[1]&&(J[1]+=(0,E.m0)(ae[1],X.factorAlignment)*f.pixelRatio),f.unapplyProjection(J,Q)),J[0]+=this.parameters.screenOffset[0]*f.pixelRatio,J[1]+=this.parameters.screenOffset[1]*f.pixelRatio,J[0]=Math.floor(J[0]),J[1]=Math.floor(J[1]);const t=e*y.size;pe[0]=y.data[t],pe[1]=y.data[t+1],(0,E.MD)(pe,X.factor,pe);const i=he*f.pixelRatio;let r=0;g.textureIsSignedDistanceField&&(r=Math.min(g.outlineSize,.5*pe[0])*f.pixelRatio/2),pe[0]*=m,pe[1]*=_;const o=e*T.size,l=g.rotation+T.data[o];if(Y(p,J[0],J[1],pe,i,r,l,g,w)){const e=n.ray;if((0,u.t)(te,Q,(0,s.B8)(se,f.viewMatrix)),J[0]=p[0],J[1]=p[1],f.unprojectFromRenderScreen(J,Q)){const t=(0,h.vt)();(0,u.c)(t,e.direction);const n=1/(0,u.l)(t);(0,u.h)(t,t,n),a((0,u.j)(e.origin,Q)*n,t,-1,!0,1,te)}}}}}intersectDraped(e,t,n,i,r,o){const s=e.attributes.get(M.r.POSITION),a=e.attributes.get(M.r.SIZE),l=e.attributes.get(M.r.ROTATION),c=this.parameters,u=(0,I.c)(c),{scaleX:h,scaleY:d}=this._getScreenScale(e,e.screenToWorldRatio),p=de*e.screenToWorldRatio;for(let t=0;t<s.data.length/s.size;t++){const n=t*s.size,f=s.data[n],g=s.data[n+1],m=t*a.size;pe[0]=a.data[m],pe[1]=a.data[m+1];let _=0;c.textureIsSignedDistanceField&&(_=Math.min(c.outlineSize,.5*pe[0])*e.screenToWorldRatio/2),pe[0]*=h,pe[1]*=d;const v=t*l.size,y=c.rotation+l.data[v];Y(i,f,g,pe,p,_,y,c,u)&&r(o.dist,o.normal,-1,!1)}}createBufferWriter(){return new ve}_updateScaleInfo(e,t,n){const i=this.parameters;null!=i.screenSizePerspective?(0,E.cJ)(n,t,i.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minScaleFactor=0),null!=i.screenSizePerspectiveAlignment?(0,E.cJ)(n,t,i.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minScaleFactor=e.factor.minScaleFactor)}applyShaderOffsetsView(e,t,n,i,r,o,s){const a=q(t,n,r,ue);return this._applyVerticalGroundOffsetView(e,a,r,s),this._applyVerticalOffsetTransformationView(s,a,r,o),this._applyPolygonOffsetView(s,a,i[3],r,s),this._applyCenterOffsetView(s,i,s),s}applyShaderOffsetsNDC(e,t,n,i,r){return this._applyCenterOffsetNDC(e,t,n,i),null!=r&&(0,u.c)(r,i),this._applyPolygonOffsetNDC(i,t,n,i),i}_applyPolygonOffsetView(e,t,n,r,o){const s=r.aboveGround?1:-1;let a=Math.sign(n);0===a&&(a=s);const l=s*a;if(this.parameters.shaderPolygonOffset<=0)return(0,u.c)(o,e);const c=(0,i.qE)(Math.abs(t.cosAngle),.01,1),h=1-Math.sqrt(1-c*c)/c/r.viewport[2];return(0,u.h)(o,e,l>0?h:1/h),o}_applyVerticalGroundOffsetView(e,t,n,i){const r=(0,u.l)(e),o=n.aboveGround?1:-1,s=n.computeRenderPixelSizeAtDist(r)*y.R,a=(0,u.h)(Q,t.normal,o*s);return(0,u.g)(i,e,a),i}_applyVerticalOffsetTransformationView(e,t,n,i){const r=this.parameters;if(!r.verticalOffset?.screenLength){if(r.screenSizePerspective||r.screenSizePerspectiveAlignment){const n=(0,u.l)(e);this._updateScaleInfo(i,n,t.cosAngle)}else i.factor.scale=1,i.factorAlignment.scale=1;return e}const o=(0,u.l)(e),s=r.screenSizePerspectiveAlignment??r.screenSizePerspective,a=(0,C.kE)(n,o,r.verticalOffset,t.cosAngle,s);return this._updateScaleInfo(i,o,t.cosAngle),(0,u.h)(t.normal,t.normal,a),(0,u.g)(e,e,t.normal)}_applyCenterOffsetView(e,t,n){const i="screen"!==this.parameters.centerOffsetUnits;return n!==e&&(0,u.c)(n,e),i&&(n[0]+=t[0],n[1]+=t[1],t[2]&&((0,u.n)(K,n),(0,u.g)(n,n,(0,u.h)(K,K,t[2])))),n}_applyCenterOffsetNDC(e,t,n,i){const r="screen"!==this.parameters.centerOffsetUnits;return i!==e&&(0,u.c)(i,e),r||(i[0]+=t[0]/n.fullWidth*2,i[1]+=t[1]/n.fullHeight*2),i}_applyPolygonOffsetNDC(e,t,n,i){const r=this.parameters.shaderPolygonOffset;if(e!==i&&(0,u.c)(i,e),r){const e=n.aboveGround?1:-1,o=e*Math.sign(t[3]);i[2]-=(o||e)*r}return i}set visible(e){this._visible=e}get visible(){const{color:e,outlineSize:t,outlineColor:n}=this.parameters,i=e[3]>=b.Q||t>=b.Q&&n[3]>=b.Q;return this._visible&&i}createGLMaterial(e){return new W(e)}calculateRelativeScreenBounds(e,t,n=(0,p.vt)()){return function(e,t,n,i){i[0]=e.anchorPosition[0]*-t[0]+e.screenOffset[0]*n,i[1]=e.anchorPosition[1]*-t[1]+e.screenOffset[1]*n}(this.parameters,e,t,n),n[2]=n[0]+e[0],n[3]=n[1]+e[1],n}_getScreenScale(e,t){const n=e.attributes.get(M.r.FEATUREATTRIBUTE);if(null==n)return{scaleX:t,scaleY:t};const i=(0,d.ci)(n.data,ce);return(0,g.VC)(le,this.parameters,i),{scaleX:le[0]*t,scaleY:le[1]*t}}}class W extends x.m8{constructor(e){super({...e,...e.material.parameters})}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.acquireTechnique(H,e)}}function q(e,t,n,i){return function(e){return(t=e)instanceof Float32Array&&t.length>=16||function(e){return Array.isArray(e)&&e.length>=16}(e);var t}(t)&&(t=(0,r.z0)(oe,t)),(0,u.q)(i.normal,e,t),(0,u.t)(i.normal,i.normal,n.viewInverseTransposeMatrix),i.cosAngle=(0,u.f)(ee,fe),i}function Y(e,t,n,r,o,s,a,c,u){let h=t-o-r[0]*u[0],d=h+r[0]+2*o,p=n-o-r[1]*u[1],f=p+r[1]+2*o;const g=c.distanceFieldBoundingBox;return c.textureIsSignedDistanceField&&null!=g&&(h+=r[0]*g[0],p+=r[1]*g[1],d-=r[0]*(1-g[2]),f-=r[1]*(1-g[3]),h-=s,d+=s,p-=s,f+=s),(0,l.hZ)(ie,t,n),(0,l.e$)(ne,e,ie,(0,i.kU)(a)),ne[0]>h&&ne[0]<d&&ne[1]>p&&ne[1]<f}const X=new class{constructor(){this.factor=new O,this.factorAlignment=new O}},Q=(0,h.vt)(),K=(0,h.vt)(),J=(0,d.vt)(),ee=(0,h.vt)(),te=(0,h.vt)(),ne=(0,c.vt)(),ie=(0,c.vt)(),re=(0,o.vt)(),oe=(0,o.vt)(),se=(0,a.vt)(),ae=(0,h.vt)(),le=(0,h.vt)(),ce=(0,d.vt)(),ue={normal:ee,cosAngle:0},he=1,de=2,pe=[0,0],fe=(0,h.fA)(0,0,1);class ge extends x.NV{constructor(){super(...arguments),this.renderOccluded=w.m$.Occlude,this.isDecoration=!1,this.color=(0,d.CN)(1,1,1,1),this.polygonOffset=!1,this.anchorPosition=(0,c.fA)(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.outlineColor=(0,d.CN)(1,1,1,1),this.outlineSize=0,this.rotation=0,this.hasRotation=!1,this.vvSizeEnabled=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.occludedFragmentFade=!1,this.horizonCullingEnabled=!1,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.draped=!1,this.isLabel=!1}}const me=(0,_.BP)().vec3f(M.r.POSITION).vec3f(M.r.NORMAL).vec2f(M.r.UV0).vec4u8(M.r.COLOR).vec2f(M.r.SIZE).f32(M.r.ROTATION).vec4f(M.r.CENTEROFFSETANDDISTANCE).vec4f(M.r.FEATUREATTRIBUTE),_e=me.clone().vec4u8(M.r.OBJECTANDLAYERIDCOLOR);class ve{constructor(){this.vertexBufferLayout=(0,T.E)()?_e:me}elementCount(e){return 6*e.get(M.r.POSITION).indices.length}write(e,t,n,i,r,o){(0,R.Hk)(n.get(M.r.POSITION),e,r.position,o,6),(0,R.p1)(n.get(M.r.NORMAL),t,r.normal,o,6);const s=n.get(M.r.UV0)?.data;let a=0,l=0,c=1,u=1;s&&s.length>=4&&(a=s[0],l=s[1],c=s[2],u=s[3]),c=Math.min(1.99999,c+1),u=Math.min(1.99999,u+1);let h=n.get(M.r.POSITION).indices.length,d=o;const p=r.uv0;for(let e=0;e<h;++e)p.set(d,0,a),p.set(d,1,l),d++,p.set(d,0,c),p.set(d,1,l),d++,p.set(d,0,c),p.set(d,1,u),d++,p.set(d,0,c),p.set(d,1,u),d++,p.set(d,0,a),p.set(d,1,u),d++,p.set(d,0,a),p.set(d,1,l),d++;(0,R.tb)(n.get(M.r.COLOR),4,r.color,o,6);const{data:g,indices:m}=n.get(M.r.SIZE);h=m.length;const _=r.size;d=o;for(let e=0;e<h;++e){const t=g[2*m[e]],n=g[2*m[e]+1];for(let e=0;e<6;++e)_.set(d,0,t),_.set(d,1,n),d++}if((0,R.uO)(n.get(M.r.ROTATION),r.rotation,o,6),n.get(M.r.CENTEROFFSETANDDISTANCE)?(0,R.Ut)(n.get(M.r.CENTEROFFSETANDDISTANCE),r.centerOffsetAndDistance,o,6):(0,R.Pq)(r.centerOffsetAndDistance,o,6*h),n.get(M.r.FEATUREATTRIBUTE)?(0,R.Ut)(n.get(M.r.FEATUREATTRIBUTE),r.featureAttribute,o,6):(0,R.Pq)(r.featureAttribute,o,6*h),null!=i){const e=n.get(M.r.POSITION)?.indices;if(e){const t=e.length,n=r.getField(M.r.OBJECTANDLAYERIDCOLOR,f.XP);(0,R.tH)(i,n,t,o,6)}}}}},65352:function(e,t,n){"use strict";n.d(t,{W:function(){return H}});var i=n(40633),r=n(15774),o=n(13520),s=n(13786),a=n(20551),l=n(32501),c=n(41546),u=n(69508),h=n(73313),d=n(5596),p=n(65856),f=n(27264),g=n(28686),m=n(39534),_=n(4875),v=n(24100),y=n(29165),b=n(90553),T=n(65839),x=n(77971),w=n(50678),S=n(35904),E=(n(58941),n(34615)),A=n(82273),M=n(54840),O=n(46921),R=n(6200),C=n(85456),I=n(57087);class P extends A.w{constructor(e,t,i){super(e,t,new E.$(S.R,(()=>n.e(3569).then(n.bind(n,75312)))),i,L),this.primitiveType=t.wireframe?C.WR.LINES:C.WR.TRIANGLE_STRIP}_makePipelineState(e,t){const{oitPass:n,output:i,hasOccludees:r,hasPolygonOffset:o}=e,s=n===M.Y.NONE,a=n===M.Y.FrontFace;return(0,I.Ey)({blending:e.output===f.V.Color?(0,O.Yf)(n):null,depthTest:{func:(0,O.K_)(n)},depthWrite:(0,O.z5)(e),drawBuffers:i===f.V.Depth?{buffers:[C.Hr.NONE]}:(0,O.m6)(n,i),colorWrite:I.kn,stencilWrite:r?R.v0:null,stencilTest:r?t?R.a9:R.qh:null,polygonOffset:s||a?o?D:null:O.SE})}initializePipeline(e){if(e.occluder){const t=e.hasPolygonOffset?D:null;this._occluderPipelineTransparent=(0,I.Ey)({blending:I.Ky,polygonOffset:t,depthTest:R.sf,depthWrite:null,colorWrite:I.kn,stencilWrite:null,stencilTest:R.mK,drawBuffers:e.output===f.V.Depth?{buffers:[C.Hr.NONE]}:null}),this._occluderPipelineOpaque=(0,I.Ey)({blending:I.Ky,polygonOffset:t,depthTest:R.sf,depthWrite:null,colorWrite:I.kn,stencilWrite:R.r8,stencilTest:R.I$,drawBuffers:e.output===f.V.Depth?{buffers:[C.Hr.NONE]}:null}),this._occluderPipelineMaskWrite=(0,I.Ey)({blending:null,polygonOffset:t,depthTest:R.m,depthWrite:null,colorWrite:null,stencilWrite:R.v0,stencilTest:R.a9,drawBuffers:e.output===f.V.Depth?{buffers:[C.Hr.NONE]}:null})}return this._occludeePipeline=this._makePipelineState(e,!0),this._makePipelineState(e,!1)}getPipeline(e,t){if(e)return this._occludeePipeline;switch(t){case y.N.TRANSPARENT_OCCLUDER_MATERIAL:return this._occluderPipelineTransparent??super.getPipeline();case y.N.OCCLUDER_MATERIAL:return this._occluderPipelineOpaque??super.getPipeline();default:return this._occluderPipelineMaskWrite??super.getPipeline()}}}const D={factor:0,units:-4},L=new Map([[T.r.POSITION,0],[T.r.PREVPOSITION,1],[T.r.NEXTPOSITION,2],[T.r.SUBDIVISIONFACTOR,3],[T.r.UV0,4],[T.r.COLOR,5],[T.r.COLORFEATUREATTRIBUTE,5],[T.r.SIZE,6],[T.r.SIZEFEATUREATTRIBUTE,6],[T.r.OPACITYFEATUREATTRIBUTE,7],[T.r.OBJECTANDLAYERIDCOLOR,8]]);var N,F,z=n(95736);(F=N||(N={}))[F.LEFT_JOIN_START=-2]="LEFT_JOIN_START",F[F.LEFT_JOIN_END=-1]="LEFT_JOIN_END",F[F.LEFT_CAP_START=-4]="LEFT_CAP_START",F[F.LEFT_CAP_END=-5]="LEFT_CAP_END",F[F.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",F[F.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",F[F.RIGHT_CAP_START=4]="RIGHT_CAP_START",F[F.RIGHT_CAP_END=5]="RIGHT_CAP_END";class H extends v.im{constructor(e){super(e,U),this._configuration=new z.Q,this.vertexAttributeLocations=L,this.produces=new Map([[y.N.OPAQUE_MATERIAL,e=>(0,f.CL)(e)||(0,f._o)(e)&&this.parameters.renderOccluded===v.m$.OccludeAndTransparentStencil],[y.N.OPAQUE_MATERIAL_WITHOUT_NORMALS,e=>(0,f.eh)(e)],[y.N.OCCLUDER_MATERIAL,e=>(0,f.MO)(e)&&this.parameters.renderOccluded===v.m$.OccludeAndTransparentStencil],[y.N.TRANSPARENT_OCCLUDER_MATERIAL,e=>(0,f.MO)(e)&&this.parameters.renderOccluded===v.m$.OccludeAndTransparentStencil],[y.N.TRANSPARENT_MATERIAL,e=>e===f.V.Color&&this.parameters.writeDepth&&this.parameters.renderOccluded!==v.m$.OccludeAndTransparentStencil],[y.N.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,e=>e===f.V.Color&&!this.parameters.writeDepth&&this.parameters.renderOccluded!==v.m$.OccludeAndTransparentStencil],[y.N.DRAPED_MATERIAL,e=>(0,f.i3)(e)]])}getConfiguration(e,t){this._configuration.output=e,this._configuration.oitPass=t.oitPass,this._configuration.draped=t.slot===y.N.DRAPED_MATERIAL;const n=null!=this.parameters.stipplePattern&&e!==f.V.Highlight;return this._configuration.stippleEnabled=n,this._configuration.stippleOffColorEnabled=n&&null!=this.parameters.stippleOffColor,this._configuration.stipplePreferContinuous=n&&this.parameters.stipplePreferContinuous,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.roundJoins="round"===this.parameters.join,this._configuration.capType=this.parameters.cap,this._configuration.applyMarkerOffset=null!=this.parameters.markerParameters&&function(e){return e.anchor===w.kJ.Tip&&e.hideOnShortSegments&&"begin-end"===e.placement&&e.worldSpace}(this.parameters.markerParameters),this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.innerColorEnabled=this.parameters.innerWidth>0&&null!=this.parameters.innerColor,this._configuration.falloffEnabled=this.parameters.falloff>0,this._configuration.hasOccludees=t.hasOccludees,this._configuration.occluder=this.parameters.renderOccluded===v.m$.OccludeAndTransparentStencil,this._configuration.terrainDepthTest=t.terrainDepthTest,this._configuration.cullAboveTerrain=t.cullAboveTerrain,this._configuration.wireframe=this.parameters.wireframe,this._configuration}get visible(){return this.parameters.color[3]>=g.Q||null!=this.parameters.stipplePattern&&(this.parameters.stippleOffColor?.[3]??0)>g.Q}intersectDraped({attributes:e,screenToWorldRatio:t},n,i,o,s,a){if(!i.options.selectionMode)return;const l=e.get(T.r.SIZE);let c=this.parameters.width;if(this.parameters.vvSize){const t=e.get(T.r.SIZEFEATUREATTRIBUTE).data[0];c*=(0,r.qE)(this.parameters.vvSize.offset[0]+t*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else l&&(c*=l.data[0]);const u=o[0],h=o[1],d=(c/2+4)*t;let p=Number.MAX_VALUE,f=0;const g=e.get(T.r.POSITION).data,m=G(this.parameters,e)?g.length-2:g.length-5;for(let e=0;e<m;e+=3){const t=g[e],n=g[e+1],i=(e+3)%g.length,o=u-t,s=h-n,a=g[i]-t,l=g[i+1]-n,c=(0,r.qE)((a*o+l*s)/(a*a+l*l),0,1),d=a*c-o,m=l*c-s,_=d*d+m*m;_<p&&(p=_,f=e/3)}p<d*d&&s(a.dist,a.normal,f,!1)}intersect(e,t,n,o,l,c){if(!n.options.selectionMode||!e.visible)return;if(!(0,b.zH)(t))return void i.A.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix");const p=e.attributes,f=p.get(T.r.POSITION).data;let g=this.parameters.width;if(this.parameters.vvSize){const e=p.get(T.r.SIZEFEATUREATTRIBUTE).data[0];g*=(0,r.qE)(this.parameters.vvSize.offset[0]+e*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else p.has(T.r.SIZE)&&(g*=p.get(T.r.SIZE).data[0]);const m=n.camera,_=q;(0,s.C)(_,n.point);const v=g*m.pixelRatio/2+4*m.pixelRatio;(0,a.i)(re[0],_[0]-v,_[1]+v,0),(0,a.i)(re[1],_[0]+v,_[1]+v,0),(0,a.i)(re[2],_[0]+v,_[1]-v,0),(0,a.i)(re[3],_[0]-v,_[1]-v,0);for(let e=0;e<4;e++)if(!m.unprojectFromRenderScreen(re[e],oe[e]))return;(0,d.Cr)(m.eye,oe[0],oe[1],se),(0,d.Cr)(m.eye,oe[1],oe[2],ae),(0,d.Cr)(m.eye,oe[2],oe[3],le),(0,d.Cr)(m.eye,oe[3],oe[0],ce);let y=Number.MAX_VALUE,x=0;const w=G(this.parameters,p)?f.length-2:f.length-5;for(let e=0;e<w;e+=3){$[0]=f[e]+t[12],$[1]=f[e+1]+t[13],$[2]=f[e+2]+t[14];const n=(e+3)%f.length;if(j[0]=f[n]+t[12],j[1]=f[n+1]+t[13],j[2]=f[n+2]+t[14],(0,d.mN)(se,$)<0&&(0,d.mN)(se,j)<0||(0,d.mN)(ae,$)<0&&(0,d.mN)(ae,j)<0||(0,d.mN)(le,$)<0&&(0,d.mN)(le,j)<0||(0,d.mN)(ce,$)<0&&(0,d.mN)(ce,j)<0)continue;if(m.projectToRenderScreen($,Y),m.projectToRenderScreen(j,X),Y[2]<0&&X[2]>0){(0,a.d)(Z,$,j);const e=m.frustum,t=-(0,d.mN)(e[u.FB.NEAR],$)/(0,a.f)(Z,(0,d.Qj)(e[u.FB.NEAR]));(0,a.h)(Z,Z,t),(0,a.g)($,$,Z),m.projectToRenderScreen($,Y)}else if(Y[2]>0&&X[2]<0){(0,a.d)(Z,j,$);const e=m.frustum,t=-(0,d.mN)(e[u.FB.NEAR],j)/(0,a.f)(Z,(0,d.Qj)(e[u.FB.NEAR]));(0,a.h)(Z,Z,t),(0,a.g)(j,j,Z),m.projectToRenderScreen(j,X)}else if(Y[2]<0&&X[2]<0)continue;Y[2]=0,X[2]=0;const i=(0,h.kb)((0,h.Cr)(Y,X,J),_);i<y&&(y=i,(0,a.c)(Q,$),(0,a.c)(K,j),x=e/3)}const S=n.rayBegin,E=n.rayEnd;if(y<v*v){let e=Number.MAX_VALUE;if((0,h.ld)((0,h.Cr)(Q,K,J),(0,h.Cr)(S,E,ee),W)){(0,a.d)(W,W,S);const t=(0,a.l)(W);(0,a.h)(W,W,1/t),e=t/(0,a.j)(S,E)}c(e,W,x,!1)}}get _layout(){const e=(0,p.BP)().vec3f(T.r.POSITION).vec3f(T.r.PREVPOSITION).vec3f(T.r.NEXTPOSITION).f32(T.r.SUBDIVISIONFACTOR).vec2f(T.r.UV0);return this.parameters.vvSize?e.f32(T.r.SIZEFEATUREATTRIBUTE):e.f32(T.r.SIZE),this.parameters.vvColor?e.f32(T.r.COLORFEATUREATTRIBUTE):e.vec4f(T.r.COLOR),this.parameters.vvOpacity&&e.f32(T.r.OPACITYFEATUREATTRIBUTE),(0,m.E)()&&e.vec4u8(T.r.OBJECTANDLAYERIDCOLOR),e}createBufferWriter(){return new k(this._layout,this.parameters)}createGLMaterial(e){return new V(e)}validateParameters(e){"miter"!==e.join&&(e.miterLimit=0),null!=e.markerParameters&&(e.markerScale=e.markerParameters.width/e.width)}}class V extends _.A{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextures.release(this._stipplePattern),this._stipplePattern=null}beginSlot(e){const t=this._material.parameters.stipplePattern;return this._stipplePattern!==t&&(this._material.setParameters({stippleTexture:this._stippleTextures.swap(t,this._stipplePattern)}),this._stipplePattern=t),this.acquireTechnique(P,e)}}class U extends x.S{constructor(){super(...arguments),this.width=0,this.color=c.Un,this.join="miter",this.cap=z.x.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleTexture=null,this.stipplePreferContinuous=!0,this.markerParameters=null,this.markerScale=1,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.wireframe=!1}get transparent(){return this.color[3]<1||null!=this.stipplePattern&&(this.stippleOffColor?.[3]??0)<1}}class k{constructor(e,t){this.vertexBufferLayout=e,this._parameters=t,this.numJoinSubdivisions=0;const n=t.stipplePattern?1:0;switch(this._parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=n;break;case"round":this.numJoinSubdivisions=S.r+n}}_isClosed(e){return G(this._parameters,e)}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){const t=e.get(T.r.POSITION).indices.length/2+1,n=this._isClosed(e);let i=n?2:4;return i+=((n?t:t-1)-(n?0:1))*(2*this.numJoinSubdivisions+4),i+=2,this._parameters.wireframe&&(i=2+4*(i-2)),i}write(e,t,n,i,r,o){const s=te,l=ne,c=ie,u=n.get(T.r.POSITION),h=u.indices,d=u.data.length/3,p=n.get(T.r.DISTANCETOSTART)?.data;h&&h.length!==2*(d-1)&&console.warn("RibbonLineMaterial does not support indices");const f=n.get(T.r.SIZEFEATUREATTRIBUTE)?.data[0]??n.get(T.r.SIZE)?.data[0]??1;let g=[1,1,1,1],_=0;const v=this.vertexBufferLayout.fields.has(T.r.COLORFEATUREATTRIBUTE);v?_=n.get(T.r.COLORFEATUREATTRIBUTE).data[0]:n.has(T.r.COLOR)&&(g=n.get(T.r.COLOR).data);const y=this.vertexBufferLayout.fields.has(T.r.OPACITYFEATUREATTRIBUTE),b=y?n.get(T.r.OPACITYFEATUREATTRIBUTE).data[0]:0,x=new Float32Array(r.buffer),w=(0,m.E)()?new Uint8Array(r.buffer):null,S=this.vertexBufferLayout.stride/4;let E=o*S;const A=E;let M=0;const O=p?(e,t,n)=>M=p[n]:(e,t,n)=>M+=(0,a.j)(e,t),R=(e,t,n,r,o,s,a)=>{if(x[E++]=t[0],x[E++]=t[1],x[E++]=t[2],x[E++]=e[0],x[E++]=e[1],x[E++]=e[2],x[E++]=n[0],x[E++]=n[1],x[E++]=n[2],x[E++]=r,x[E++]=a,x[E++]=o,x[E++]=f,v)x[E++]=_;else{const e=Math.min(4*s,g.length-4);x[E++]=g[e],x[E++]=g[e+1],x[E++]=g[e+2],x[E++]=g[e+3]}y&&(x[E++]=b),(0,m.E)()&&(i&&(w[4*E]=i[0],w[4*E+1]=i[1],w[4*E+2]=i[2],w[4*E+3]=i[3]),E++)};E+=S,(0,a.i)(l,u.data[0],u.data[1],u.data[2]),e&&(0,a.t)(l,l,e);const C=this._isClosed(n);if(C){const t=u.data.length-3;(0,a.i)(s,u.data[t],u.data[t+1],u.data[t+2]),e&&(0,a.t)(s,s,e)}else(0,a.i)(c,u.data[3],u.data[4],u.data[5]),e&&(0,a.t)(c,c,e),R(l,l,c,1,N.LEFT_CAP_START,0,0),R(l,l,c,1,N.RIGHT_CAP_START,0,0),(0,a.c)(s,l),(0,a.c)(l,c);const I=C?0:1,P=C?d:d-1;for(let t=I;t<P;t++){const n=(t+1)%d*3;(0,a.i)(c,u.data[n],u.data[n+1],u.data[n+2]),e&&(0,a.t)(c,c,e),O(s,l,t),R(s,l,c,0,N.LEFT_JOIN_END,t,M),R(s,l,c,0,N.RIGHT_JOIN_END,t,M);const i=this.numJoinSubdivisions;for(let e=0;e<i;++e){const n=(e+1)/(i+1);R(s,l,c,n,N.LEFT_JOIN_END,t,M),R(s,l,c,n,N.RIGHT_JOIN_END,t,M)}R(s,l,c,1,N.LEFT_JOIN_START,t,M),R(s,l,c,1,N.RIGHT_JOIN_START,t,M),(0,a.c)(s,l),(0,a.c)(l,c)}C?((0,a.i)(c,u.data[3],u.data[4],u.data[5]),e&&(0,a.t)(c,c,e),M=O(s,l,P),R(s,l,c,0,N.LEFT_JOIN_END,I,M),R(s,l,c,0,N.RIGHT_JOIN_END,I,M)):(M=O(s,l,P),R(s,l,l,0,N.LEFT_CAP_END,P,M),R(s,l,l,0,N.RIGHT_CAP_END,P,M)),B(x,A+S,x,A,S),E=B(x,E-S,x,E,S),this._parameters.wireframe&&this._addWireframeVertices(r,A,E,S)}_addWireframeVertices(e,t,n,i){const r=new Float32Array(e.buffer,n*Float32Array.BYTES_PER_ELEMENT),o=new Float32Array(e.buffer,t*Float32Array.BYTES_PER_ELEMENT,n-t);let s=0;const a=e=>s=B(o,e,r,s,i);for(let e=0;e<o.length-1;e+=2*i)a(e),a(e+2*i),a(e+1*i),a(e+2*i),a(e+1*i),a(e+3*i)}}function B(e,t,n,i,r){for(let o=0;o<r;o++)n[i++]=e[t++];return i}function G(e,t){return!!e.isClosed&&t.get(T.r.POSITION).indices.length>2}const $=(0,l.vt)(),j=(0,l.vt)(),Z=(0,l.vt)(),W=(0,l.vt)(),q=(0,l.vt)(),Y=(0,o.r_)(),X=(0,o.r_)(),Q=(0,l.vt)(),K=(0,l.vt)(),J=(0,h.vt)(),ee=(0,h.vt)(),te=(0,l.vt)(),ne=(0,l.vt)(),ie=(0,l.vt)(),re=[(0,o.r_)(),(0,o.r_)(),(0,o.r_)(),(0,o.r_)()],oe=[(0,l.vt)(),(0,l.vt)(),(0,l.vt)(),(0,l.vt)()],se=(0,d.vt)(),ae=(0,d.vt)(),le=(0,d.vt)(),ce=(0,d.vt)()},27291:function(e,t,n){"use strict";n.d(t,{W:function(){return o}});var i=n(24100),r=n(45079);class o extends i.im{intersect(e,t,n,i,o,s){return(0,r.Uy)(e,n,i,o,void 0,s)}}},77971:function(e,t,n){"use strict";n.d(t,{S:function(){return o},p:function(){return s}});var i=n(24129),r=n(24100);class o extends i.Gd{constructor(){super(...arguments),this.renderOccluded=r.m$.Occlude,this.isDecoration=!1}}const s=8},84887:function(e,t,n){"use strict";n.d(t,{MB:function(){return a},Um:function(){return l},kE:function(){return s}});var i=n(50659),r=n(15774),o=n(54035);function s(e,t,n,i,s){let a=(n.screenLength||0)*e.pixelRatio;null!=s&&(a=(0,o.hs)(a,i,t,s));const l=a*Math.tan(.5*e.fovY)/(.5*e.fullHeight);return(0,r.qE)(l*t,n.minWorldLength||0,null!=n.maxWorldLength?n.maxWorldLength:1/0)}function a(e,t){let n=!1;for(const r in t){const o=t[r];void 0!==o&&(Array.isArray(o)?Array.isArray(e[r])&&(0,i.aI)(o,e[r])||(e[r]=o.slice(),n=!0):e[r]!==o&&(n=!0,e[r]=o))}return n}const l={multiply:1,ignore:2,replace:3,tint:4}},93678:function(e,t,n){"use strict";n.d(t,{Hk:function(){return d},Pq:function(){return h},SA:function(){return m},Ut:function(){return u},p1:function(){return p},tH:function(){return g},tb:function(){return f},uO:function(){return a},zC:function(){return _}});var i=n(73364),r=n(92754),o=n(90553),s=n(65839);function a(e,t,n,i=1){const{data:r,indices:o}=e,s=t.typedBuffer,a=t.typedBufferStride,l=o.length;if(n*=a,1===i)for(let e=0;e<l;++e)s[n]=r[o[e]],n+=a;else for(let e=0;e<l;++e){const t=r[o[e]];for(let e=0;e<i;e++)s[n]=t,n+=a}}function l(e,t,n){const{data:i,indices:r}=e,o=t.typedBuffer,s=t.typedBufferStride,a=r.length;n*=s;for(let e=0;e<a;++e){const t=2*r[e];o[n]=i[t],o[n+1]=i[t+1],n+=s}}function c(e,t,n,i){const{data:r,indices:o}=e,s=t.typedBuffer,a=t.typedBufferStride,l=o.length;if(n*=a,null==i||1===i)for(let e=0;e<l;++e){const t=3*o[e];s[n]=r[t],s[n+1]=r[t+1],s[n+2]=r[t+2],n+=a}else for(let e=0;e<l;++e){const t=3*o[e];for(let e=0;e<i;++e)s[n]=r[t],s[n+1]=r[t+1],s[n+2]=r[t+2],n+=a}}function u(e,t,n,i=1){const{data:r,indices:o}=e,s=t.typedBuffer,a=t.typedBufferStride,l=o.length;if(n*=a,1===i)for(let e=0;e<l;++e){const t=4*o[e];s[n]=r[t],s[n+1]=r[t+1],s[n+2]=r[t+2],s[n+3]=r[t+3],n+=a}else for(let e=0;e<l;++e){const t=4*o[e];for(let e=0;e<i;++e)s[n]=r[t],s[n+1]=r[t+1],s[n+2]=r[t+2],s[n+3]=r[t+3],n+=a}}function h(e,t,n){const i=e.typedBuffer,r=e.typedBufferStride;t*=r;for(let e=0;e<n;++e)i[t]=0,i[t+1]=0,i[t+2]=0,i[t+3]=0,t+=r}function d(e,t,n,r,o=1){if(!t)return void c(e,n,r,o);const{data:s,indices:a}=e,l=n.typedBuffer,u=n.typedBufferStride,h=a.length,d=t[0],p=t[1],f=t[2],g=t[4],m=t[5],_=t[6],v=t[8],y=t[9],b=t[10],T=t[12],x=t[13],w=t[14];r*=u;let S=0,E=0,A=0;const M=(0,i.tZ)(t)?e=>{S=s[e]+T,E=s[e+1]+x,A=s[e+2]+w}:e=>{const t=s[e],n=s[e+1],i=s[e+2];S=d*t+g*n+v*i+T,E=p*t+m*n+y*i+x,A=f*t+_*n+b*i+w};if(1===o)for(let e=0;e<h;++e)M(3*a[e]),l[r]=S,l[r+1]=E,l[r+2]=A,r+=u;else for(let e=0;e<h;++e){M(3*a[e]);for(let e=0;e<o;++e)l[r]=S,l[r+1]=E,l[r+2]=A,r+=u}}function p(e,t,n,r,o=1){if(!t)return void c(e,n,r,o);const{data:s,indices:a}=e,l=t,u=n.typedBuffer,h=n.typedBufferStride,d=a.length,p=l[0],f=l[1],g=l[2],m=l[4],_=l[5],v=l[6],y=l[8],b=l[9],T=l[10],x=!(0,i.ut)(l),w=1e-6,S=1-w;r*=h;let E=0,A=0,M=0;const O=(0,i.tZ)(l)?e=>{E=s[e],A=s[e+1],M=s[e+2]}:e=>{const t=s[e],n=s[e+1],i=s[e+2];E=p*t+m*n+y*i,A=f*t+_*n+b*i,M=g*t+v*n+T*i};if(1===o)if(x)for(let e=0;e<d;++e){O(3*a[e]);const t=E*E+A*A+M*M;if(t<S&&t>w){const e=1/Math.sqrt(t);u[r]=E*e,u[r+1]=A*e,u[r+2]=M*e}else u[r]=E,u[r+1]=A,u[r+2]=M;r+=h}else for(let e=0;e<d;++e)O(3*a[e]),u[r]=E,u[r+1]=A,u[r+2]=M,r+=h;else for(let e=0;e<d;++e){if(O(3*a[e]),x){const e=E*E+A*A+M*M;if(e<S&&e>w){const t=1/Math.sqrt(e);E*=t,A*=t,M*=t}}for(let e=0;e<o;++e)u[r]=E,u[r+1]=A,u[r+2]=M,r+=h}}function f(e,t,n,i,r=1){const{data:o,indices:s}=e,a=n.typedBuffer,l=n.typedBufferStride,c=s.length;if(i*=l,t!==o.length||4!==t)if(1!==r)if(4!==t)for(let e=0;e<c;++e){const t=3*s[e];for(let e=0;e<r;++e)a[i]=o[t],a[i+1]=o[t+1],a[i+2]=o[t+2],a[i+3]=255,i+=l}else for(let e=0;e<c;++e){const t=4*s[e];for(let e=0;e<r;++e)a[i]=o[t],a[i+1]=o[t+1],a[i+2]=o[t+2],a[i+3]=o[t+3],i+=l}else{if(4===t){for(let e=0;e<c;++e){const t=4*s[e];a[i]=o[t],a[i+1]=o[t+1],a[i+2]=o[t+2],a[i+3]=o[t+3],i+=l}return}for(let e=0;e<c;++e){const t=3*s[e];a[i]=o[t],a[i+1]=o[t+1],a[i+2]=o[t+2],a[i+3]=255,i+=l}}else{a[i]=o[0],a[i+1]=o[1],a[i+2]=o[2],a[i+3]=o[3];const e=new Uint32Array(n.typedBuffer.buffer,n.start),t=l/4,s=e[i/=4];i+=t;const u=c*r;for(let n=1;n<u;++n)e[i]=s,i+=t}}function g(e,t,n,i,r=1){const o=t.typedBuffer,s=t.typedBufferStride;if(i*=s,1===r)for(let t=0;t<n;++t)o[i]=e[0],o[i+1]=e[1],o[i+2]=e[2],o[i+3]=e[3],i+=s;else for(let t=0;t<n;++t)for(let t=0;t<r;++t)o[i]=e[0],o[i+1]=e[1],o[i+2]=e[2],o[i+3]=e[3],i+=s}function m(e,t,n,i,o,a,l){for(const c of n.fields.keys()){const n=e.get(c),u=n?.indices;if(n&&u)_(c,n,i,o,a,l);else if(c===s.r.OBJECTANDLAYERIDCOLOR&&null!=t){const n=e.get(s.r.POSITION)?.indices;if(n){const e=n.length;g(t,a.getField(c,r.XP),e,l)}}}}function _(e,t,n,a,c,h){switch(e){case s.r.POSITION:{(0,o.vA)(3===t.size);const i=c.getField(e,r.xs);(0,o.vA)(!!i,`No buffer view for ${e}`),i&&d(t,n,i,h);break}case s.r.NORMAL:{(0,o.vA)(3===t.size);const n=c.getField(e,r.xs);(0,o.vA)(!!n,`No buffer view for ${e}`),n&&p(t,a,n,h);break}case s.r.NORMALCOMPRESSED:{(0,o.vA)(2===t.size);const n=c.getField(e,r.mJ);(0,o.vA)(!!n,`No buffer view for ${e}`),n&&l(t,n,h);break}case s.r.UV0:{(0,o.vA)(2===t.size);const n=c.getField(e,r.gH);(0,o.vA)(!!n,`No buffer view for ${e}`),n&&l(t,n,h);break}case s.r.COLOR:case s.r.SYMBOLCOLOR:{const n=c.getField(e,r.XP);(0,o.vA)(!!n,`No buffer view for ${e}`),(0,o.vA)(3===t.size||4===t.size),!n||3!==t.size&&4!==t.size||f(t,t.size,n,h);break}case s.r.COLORFEATUREATTRIBUTE:{const n=c.getField(e,r.Y$);(0,o.vA)(!!n,`No buffer view for ${e}`),(0,o.vA)(1===t.size),n&&1===t.size&&function(e,t,n){const{data:i,indices:r}=e,o=t.typedBuffer,s=t.typedBufferStride,a=r.length,l=i[0];n*=s;for(let e=0;e<a;++e)o[n]=l,n+=s}(t,n,h);break}case s.r.TANGENT:{(0,o.vA)(4===t.size);const s=c.getField(e,r.Eq);(0,o.vA)(!!s,`No buffer view for ${e}`),s&&function(e,t,n,r,o=1){if(!t)return void u(e,n,r,o);const{data:s,indices:a}=e,l=t,c=n.typedBuffer,h=n.typedBufferStride,d=a.length,p=l[0],f=l[1],g=l[2],m=l[4],_=l[5],v=l[6],y=l[8],b=l[9],T=l[10],x=!(0,i.ut)(l),w=1e-6,S=1-w;if(r*=h,1===o)for(let e=0;e<d;++e){const t=4*a[e],n=s[t],i=s[t+1],o=s[t+2],l=s[t+3];let u=p*n+m*i+y*o,d=f*n+_*i+b*o,E=g*n+v*i+T*o;if(x){const e=u*u+d*d+E*E;if(e<S&&e>w){const t=1/Math.sqrt(e);u*=t,d*=t,E*=t}}c[r]=u,c[r+1]=d,c[r+2]=E,c[r+3]=l,r+=h}else for(let e=0;e<d;++e){const t=4*a[e],n=s[t],i=s[t+1],l=s[t+2],u=s[t+3];let d=p*n+m*i+y*l,E=f*n+_*i+b*l,A=g*n+v*i+T*l;if(x){const e=d*d+E*E+A*A;if(e<S&&e>w){const t=1/Math.sqrt(e);d*=t,E*=t,A*=t}}for(let e=0;e<o;++e)c[r]=d,c[r+1]=E,c[r+2]=A,c[r+3]=u,r+=h}}(t,n,s,h);break}case s.r.PROFILERIGHT:case s.r.PROFILEUP:case s.r.PROFILEVERTEXANDNORMAL:case s.r.FEATUREVALUE:{(0,o.vA)(4===t.size);const n=c.getField(e,r.Eq);(0,o.vA)(!!n,`No buffer view for ${e}`),n&&u(t,n,h)}}}},20794:function(e,t,n){"use strict";n.d(t,{Xq:function(){return a},wk:function(){return s}});const i={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},r={dash:i.dash,"dash-dot":[...i.dash,...i.dot],dot:i.dot,"long-dash":i["long-dash"],"long-dash-dot":[...i["long-dash"],...i.dot],"long-dash-dot-dot":[...i["long-dash"],...i.dot,...i.dot],none:null,"short-dash":i["short-dash"],"short-dash-dot":[...i["short-dash"],...i["short-dot"]],"short-dash-dot-dot":[...i["short-dash"],...i["short-dot"],...i["short-dot"]],"short-dot":i["short-dot"],solid:null},o=8;function s(e){return{pattern:[e,e],pixelRatio:2}}function a(e){return"style"===e?.type?function(e){return null!=e?function(e,t){return null==e?e:{pattern:e.slice(),pixelRatio:t}}(r[e],o):null}(e.style):null}},27539:function(e,t,n){"use strict";n.d(t,{Bt:function(){return a},Jr:function(){return o},SY:function(){return l},mb:function(){return s}});var i=n(20551),r=n(32501);function o({normalTexture:e,metallicRoughnessTexture:t,metallicFactor:n,roughnessFactor:o,emissiveTexture:s,emissiveFactor:a,occlusionTexture:l}){return null==e&&null==t&&null==s&&(null==a||(0,i.p)(a,r.uY))&&null==l&&(null==o||1===o)&&(null==n||1===n)}const s=(0,r.CN)(1,1,.5),a=(0,r.CN)(0,.6,.2),l=(0,r.CN)(0,1,.2)},26347:function(e,t,n){"use strict";n.d(t,{y:function(){return C},N:function(){return G}});var i=n(53804),r=n(50659),o=(n(58941),n(15774)),s=n(95929),a=n(7970),l=n(7187),c=n(17660),u=n(23502),h=(n(40633),n(65953)),d=n(73364),p=n(39714),f=n(69550),g=n(27264),m=n(67521),_=n(52798),v=n(96253),y=n(29165),b=n(90553),T=n(51564);class x{constructor(e=0,t=0){this.from=e,this.to=t}get numElements(){return this.to-this.from}}function w(e){const t=new Map;e.forAll((e=>t.set(e.from,e)));let n=!0;for(;n;){n=!1;for(let i=0;i<e.length;++i){const r=e.data[i],o=t.get(r.to);if(!o)return;r.to=o.to,t.delete(o.from),e.removeUnordered(o),n=!0}}}class S extends x{constructor(e,t,n){super(t,n),this.geometry=e}get isVisible(){return this.geometry.visible}get hasHighlights(){return this.isVisible&&this.geometry.hasHighlights}foreachHighlightGroup(e){this.isVisible&&this.geometry.foreachHighlightGroup(e)}get hasOccludees(){return null!=this.geometry.occludees}}class E{constructor(){this.first=0,this.count=0}}class A{constructor(){this._numElements=0,this._instances=new Map,this.holes=new l.A({allocator:e=>e||new x,deallocator:null}),this.hasHiddenInstances=!1,this.hasOccludees=!1,this.drawCommandsDirty=!0,this.highlightGroups=new Set,this.drawCommandsDefault=M(),this.drawCommandsHighlights=new Map,this.drawCommandsOccludees=M(),this.drawCommandsShadowHighlightRest=M()}get numElements(){return this._numElements}get instances(){return this._instances}get hasHighlights(){return this.highlightGroups.size>0}resetInstanceSummary(){this.hasHiddenInstances=!1,this.hasOccludees=!1,this.highlightGroups.clear()}updateIfDrawCommandsDirty(e){if(this.drawCommandsDirty){this.resetInstanceSummary();for(const e of this.instances.values())this.updateDrawState(e);this.updateDrawCommands(e)}}addInstance(e,t){this.deleteInstance(e),this._instances.set(e,t),this._numElements+=t.numElements}deleteInstance(e){const t=this._instances.get(e);t&&(this._numElements-=t.numElements,this._instances.delete(e))}updateInstance(e,t,n){const i=this._instances.get(e);i&&(this._numElements-=i.numElements,i.from=t,i.to=n,this._numElements+=i.numElements)}updateDrawState(e){e.isVisible?(e.foreachHighlightGroup((e=>this.highlightGroups.add(e))),e.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0}updateDrawCommands(e){if(this.drawCommandsDefault.clear(),this.drawCommandsHighlights.clear(),this.drawCommandsOccludees.clear(),this.drawCommandsShadowHighlightRest.clear(),this.drawCommandsDirty=!1,0===this._instances.size)return;if(!this.needsMultipleCommands()){const t=this.drawCommandsDefault.pushNew(),n=this.holes.front();return null!=this.vao&&1===this.holes.length&&n.to===Math.floor(this.vao.byteSize/e)?(t.first=0,void(t.count=n.from)):(t.first=1/0,t.count=0,this._instances.forEach((e=>{t.first=Math.min(t.first,e.from),t.count=Math.max(t.count,e.to)})),void(t.count-=t.first))}const t=Array.from(this._instances.values()).sort(((e,t)=>e.from===t.from?e.to-t.to:e.from-t.from)),{drawCommandsHighlights:n}=this;for(const e of t)e.isVisible&&(O(e.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,e),e.hasHighlights?e.foreachHighlightGroup((t=>{let i=n.get(t);i||(i=M(),n.set(t,i)),O(i,e)})):O(this.drawCommandsShadowHighlightRest,e))}needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}}function M(){return new l.A({allocator:e=>e||new E,deallocator:e=>e})}function O(e,t){const n=e.back();if(null==n){const n=e.pushNew();return n.first=t.from,void(n.count=t.numElements)}if(function(e,t){return e.first+e.count>=t.from}(n,t)){const e=t.from-n.first+t.numElements;n.count=e}else{const n=e.pushNew();n.first=t.from,n.count=t.numElements}}class R{constructor(e){this.origin=e,this.buffers=new Array}dispose(){this.buffers.forEach((e=>e.vao.dispose())),this.buffers.length=0}findBuffer(e){return this.buffers.find((t=>t.instances.has(e)))}}let C=class extends m.RW{get _hasAnyHighlight(){return this._highlightGroups.size>0}constructor(e){super(e),this._dataByOrigin=new Map,this._drawParameters=new T.P,this._highlightGroups=new Set,this.drapedPriority=0,this._produces=new Map,this._hasOccludees=!1}destroy(){this._glMaterials=(0,s.WD)(this._glMaterials),this._dataByOrigin.forEach((e=>e.dispose())),this._dataByOrigin.clear(),this._vaoCache=null}initialize(){this.material.produces.forEach(((e,t)=>{this._produces.set(t,(t=>!(0===this._dataByOrigin.size||!(t!==g.V.Highlight&&t!==g.V.ShadowHighlight||this._hasAnyHighlight))&&e(t)))}))}initializeRenderContext(e,t){this._glMaterials=new _.c(this.material,t??e.materials),this._bufferWriter=this.material.createBufferWriter(),this._vaoCache=e.renderContext.rctx.getVaoCache(this.material.vertexAttributeLocations,(0,f.U)(this._bufferWriter.vertexBufferLayout))}uninitializeRenderContext(){}get produces(){return this._produces}get hasOccludees(){return this._hasOccludees}get hasEmissions(){return this.material.hasEmissions}get isDecoration(){return this.material.parameters.isDecoration}queryRenderOccludedState(e){return this.material.queryRenderOccludedState(e)}get numGeometries(){let e=0;return this._dataByOrigin.forEach((t=>e+=t.buffers.reduce(((e,t)=>e+t.instances.size),0))),e}get usedMemory(){let e=0;return this._dataByOrigin.forEach((t=>e+=t.buffers.reduce(((e,t)=>e+t.vao.usedMemory),0))),e}forEachGeometry(e){this._dataByOrigin.forEach((t=>t.buffers.forEach((t=>t.instances.forEach((({geometry:t})=>e(t)))))))}modify(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateDrawCommands()}_updateGeometries(e){const t=this._bufferWriter;if(null==t)return;const n=t.vertexBufferLayout.stride/4;for(const i of e){const e=i.renderGeometry,r=this._dataByOrigin.get(e.localOrigin.id),o=r?.findBuffer(e.id);if(null==o)return;const s=o.instances.get(e.id);if(i.updateType&(v.k.GEOMETRY|v.k.TRANSFORMATION)){const i=B(t.elementCount(s.geometry.geometry.attributes)*n),r=t.vertexBufferLayout.createView(i.buffer);this._writeGeometry(e,r,0),o.vao.vertexBuffers.get("geometry").setSubData(i,s.from*n,0,s.numElements*n)}i.updateType&(v.k.HIGHLIGHT|v.k.OCCLUDEE|v.k.VISIBILITY)&&(o.drawCommandsDirty=!0)}}_computeDeltas(e,t){const n=new a.O;for(const t of e){const e=t.localOrigin;if(null==e)continue;let i=n.get(e.id,null);null==i&&(i=new I(e.vec3),n.set(e.id,null,i)),i.changes.push(t)}for(const e of t){const t=e.localOrigin;if(null==t)continue;const i=this._dataByOrigin.get(t.id),r=i?.findBuffer(e.id);if(null==r)continue;let o=n.get(t.id,r);null==o&&(o=new I(t.vec3),n.set(t.id,r,o)),o.changes.push(e)}return n}_addAndRemoveGeometries(e,t){if(null==this._bufferWriter||null==this._vaoCache)return;const{_bufferWriter:n,_dataByOrigin:i}=this,o=n.vertexBufferLayout.stride/4,s=this._computeDeltas(e,t);s.forEach(((e,t)=>{const a=e.get(null),l=a?.changes??[];s.delete(t,null);let c=i.get(t);if(e.forEach(((e,a)=>{if(s.delete(t,a),null==a)return void(0,b.vA)(!1,"No VAO for removed geometries");if(a.instances.size===e.changes.length)return this._vaoCache.deleteVao(a.vao),(0,r.Xy)(c.buffers,a),void(0===c.buffers.length&&0===l.length&&i.delete(t));const u=a.numElements,h=a.vao.byteSize/4,d=l.reduce(((e,t)=>e+n.elementCount(t.geometry.attributes)),0),p=e.changes.reduce(((e,t)=>e+n.elementCount(t.geometry.attributes)),0),f=Math.min((u+d-p)*o,U),g=f>h;f>F&&f<h/2?(e.changes.forEach((({id:e})=>a.deleteInstance(e))),a.instances.forEach((({geometry:e})=>l.push(e))),this._vaoCache.deleteVao(a.vao),(0,r.Xy)(c.buffers,a)):g?this._applyAndRebuild(a,l,e):this._applyRemoves(a,e)})),l.length>0)for(null==c&&(c=new R(a.origin),i.set(t,c)),c.buffers.forEach((e=>this._applyAdds(e,l)));l.length>0;)c.buffers.push(this._applyAndRebuild(new A,l,null))}))}_updateDrawCommands(){this._highlightGroups.clear(),this._hasOccludees=!1,this._dataByOrigin.forEach((e=>{e.buffers.forEach((e=>{e.updateIfDrawCommandsDirty(this._bufferWriter.vertexBufferLayout.stride),e.hasHighlights&&(0,c.FB)(this._highlightGroups,e.highlightGroups),this._hasOccludees=this._hasOccludees||e.hasOccludees}))}))}_applyAndRebuild(e,t,n){if(n)for(const t of n.changes)e.deleteInstance(t.id);const i=this._bufferWriter,r=i.vertexBufferLayout.stride,o=r/4,s=Math.floor(U/o);let a=e.numElements;for(;t.length>0;){const n=t.pop(),r=i.elementCount(n.geometry.attributes);if(a+r>s&&a>0){t.push(n);break}a+=r;const o=new S(n,0,0);(0,b.vA)(null==e.instances.get(n.id)),e.addInstance(n.id,o)}const l=a*o,c=B(l),u=i.vertexBufferLayout.createView(c.buffer);let h=0;e.resetInstanceSummary(),e.instances.forEach(((t,n)=>{this._writeGeometry(t.geometry,u,h);const r=h;h+=i.elementCount(t.geometry.geometry.attributes),e.updateInstance(n,r,h),e.updateDrawState(t)})),this._vaoCache.deleteVao(e.vao),e.vao=this._vaoCache.newVao(G(l)),e.vao.vertexBuffers.get("geometry").setSubData(c,0,0,h*o),e.holes.clear();const d=e.holes.pushNew();return d.from=h,d.to=Math.floor(e.vao.byteSize/r),e.updateDrawCommands(r),e}_applyRemoves(e,t){if(0===t.changes.length||null==this._bufferWriter)return;for(const n of t.changes){const t=n.id,i=e.instances.get(t);if(!i)continue;e.deleteInstance(t);const r=N.back();if(r){if(r.to===i.from){r.to=i.to;continue}if(r.from===i.to){r.from=i.from;continue}}const o=N.pushNew();o.from=i.from,o.to=i.to}w(N);const n=this._bufferWriter.vertexBufferLayout.stride/4,i=N.reduce(((e,t)=>Math.max(e,t.numElements)),0)*n,r=B(i);r.fill(0,0,i);const o=e.vao.vertexBuffers.get("geometry");N.forAll((e=>o.setSubData(r,e.from*n,0,e.numElements*n))),e.holes.pushArray(N.data,N.length),N.forAll(((e,t)=>N.data[t]=null)),N.clear(),e.drawCommandsDirty=!0}_applyAdds(e,t){if(0===t.length||null==this._bufferWriter)return;if(!function(e){return null!=e.vao}(e))return void this._applyAndRebuild(e,t,null);const n=this._bufferWriter,i=n.vertexBufferLayout.stride/4,o=e.numElements,s=t.reduce(((e,t)=>e+n.elementCount(t.geometry.attributes)),0),a=Math.min((o+s)*i,U),l=4*a;if(e.vao.byteSize<G(U-F)&&l>e.vao.byteSize)return void this._applyAndRebuild(e,t,null);w(e.holes);const c=new Array;for(const i of t){const t=n.elementCount(i.geometry.attributes),r=P(e.holes,t);c.push(r)}const u=e.vao.vertexBuffers.get("geometry");let h=0,d=0,p=0;const f=B(a),g=n.vertexBufferLayout.createView(f.buffer);t.forEach(((t,r)=>{const o=c[r];if(null==o)return;if(p!==o){const e=p-d;e>0&&u.setSubData(f,d*i,0,e*i),d=o,h=0}const s=n.elementCount(t.geometry.attributes);this._writeGeometry(t,g,h),h+=s,p=o+s;const a=new S(t,o,o+s);(0,b.vA)(null==e.instances.get(t.id)),e.addInstance(t.id,a),e.drawCommandsDirty=!0}));const m=p-d;m>0&&u.setSubData(f,d*i,0,m*i),(0,r.$i)(t,((e,t)=>null==c[t]))}_writeGeometry(e,t,n){null!=this._bufferWriter&&((0,d.C)(D,e.transformation),D[12]-=e.localOrigin.vec3[0],D[13]-=e.localOrigin.vec3[1],D[14]-=e.localOrigin.vec3[2],(0,d.B8)(L,D),(0,d.mg)(L,L),this._bufferWriter.write(D,L,e.geometry.attributes,e.geometry.objectAndLayerIdColor,t,n))}updateAnimation(e){return this.material.update(e)}acquireTechniques(e){if(!this.material.shouldRender(e))return null;const{output:t,bind:n}=e,i=this.material.produces.get(n.slot);if(!i?.(t))return null;const{highlightGroupName:r,slot:o}=n,s=t===g.V.ShadowHighlight,a=t===g.V.Highlight,l=a||s,c=e=>l&&(0===this._highlightGroups.size||a&&!!r&&!e.has(r));if(c(this._highlightGroups))return null;const u=t===g.V.ShadowExcludeHighlight,h=!(l||u);for(const{buffers:i}of this._dataByOrigin.values())for(const a of i){if(c(a.highlightGroups))continue;const i=s?a.drawCommandsHighlights.size>0:l?r?a.drawCommandsHighlights.get(r):a.drawCommandsHighlights.size>0:((u&&a.needsMultipleCommands()?a.drawCommandsShadowHighlightRest:a.drawCommandsDefault)||null)?.length??!1,d=h&&a.drawCommandsOccludees||null;if(i||d?.length){const i=this._glMaterials.load(e.rctx,o,t),r=i?.beginSlot(n);if(r)return r}}return null}render(e,t){const{output:n,bind:i}=e,{slot:r,highlightGroupName:o}=i,s=n===g.V.Highlight;if(s&&!o)return;const a=n===g.V.ShadowHighlight,l=s||a,c=n===g.V.ShadowExcludeHighlight,u=!(l||c),h=r===y.N.OCCLUDER_MATERIAL||r===y.N.TRANSPARENT_OCCLUDER_MATERIAL?r:null,{rctx:d}=e;d.runAppleAmdDriverHelper();const p=d.bindTechnique(t,i,this.material.parameters);for(const e of this._dataByOrigin.values())for(const n of e.buffers){if(s&&(!n.hasHighlights||!n.drawCommandsHighlights.has(o)))continue;if(a&&!n.hasHighlights)continue;const r=()=>{const e=[];for(const t of n.drawCommandsHighlights.values())e.push(t);return e},f=l&&!a?n.drawCommandsHighlights.get(o)??null:null,g=a?r():l?f?[f]:$:(c&&n.needsMultipleCommands()?[n.drawCommandsShadowHighlightRest]:[n.drawCommandsDefault])||$,m=g.some((e=>e.length>0)),_=u&&n.drawCommandsOccludees||null;if(m||_?.length){if(this._drawParameters.origin=e.origin,p.bindDraw(i,this.material.parameters,this._drawParameters),t.ensureAttributeLocations(n.vao),d.bindVAO(n.vao),m)for(const e of g)d.setPipelineState(t.getPipeline(!1,h)),e.forAll((e=>d.drawArrays(t.primitiveType,e.first,e.count)));_?.length&&(d.setPipelineState(t.getPipeline(!0,h)),_.forAll((e=>d.drawArrays(t.primitiveType,e.first,e.count))))}}}get test(){}};(0,i._)([(0,u.MZ)({constructOnly:!0})],C.prototype,"material",void 0),C=(0,i._)([(0,h.$)("esri.views.3d.webgl-engine.materials.renderers.MergedRenderer")],C);class I{constructor(e){this.origin=e,this.changes=new Array}}function P(e,t){const n=e.find((e=>e.numElements>=t));if(null==n)return null;const i=n.from;return n.from+=t,n.from>=n.to&&e.removeUnordered(n),i}const D=(0,p.vt)(),L=(0,p.vt)(),N=new l.A({allocator:e=>e||new x,deallocator:null}),F=65536,z=4*F,H=1024,V=16777216,U=V/4;let k=new Float32Array(F);function B(e){return k.length<e&&(k=new Float32Array(e)),k}function G(e){const t=4*e;return t<=H?H:t<z?(0,o.cU)(t):Math.max(Math.min(Math.ceil(1.5*t/z)*z,V),t)}const $=[]},84738:function(e,t,n){"use strict";n.d(t,{Ci:function(){return o},PC:function(){return s},Vk:function(){return a}});var i=n(32501),r=n(44476);function o(e,t){return null==e&&(e=[]),e.push(t),e}function s(e,t){if(null==e)return null;const n=e.filter((e=>e!==t));return 0===n.length?null:n}function a(e,t,n,i,o){l[0]=e.get(t,0),l[1]=e.get(t,1),l[2]=e.get(t,2),(0,r.jS)(l,c,3),n.set(o,0,c[0]),i.set(o,0,c[1]),n.set(o,1,c[2]),i.set(o,1,c[3]),n.set(o,2,c[4]),i.set(o,2,c[5])}const l=(0,i.vt)(),c=new Float32Array(6)},54204:function(e,t,n){"use strict";n.d(t,{N:function(){return a},d:function(){return i}});var i,r,o=n(53804),s=n(65875);(r=i||(i={}))[r.None=0]="None",r[r.Alpha=1]="Alpha",r[r.PremultipliedAlpha=2]="PremultipliedAlpha",r[r.Depth=3]="Depth",r[r.COUNT=4]="COUNT";class a extends s.K{constructor(){super(...arguments),this.blitMode=i.None,this.hasOpacityFactor=!1}}(0,o._)([(0,s.W)({count:i.COUNT})],a.prototype,"blitMode",void 0),(0,o._)([(0,s.W)()],a.prototype,"hasOpacityFactor",void 0)},50678:function(e,t,n){"use strict";n.d(t,{Dt:function(){return h},kJ:function(){return r},lM:function(){return i}});var i,r,o,s=n(53804),a=n(2457),l=n(38130),c=n(65875),u=n(22095);(o=i||(i={}))[o.Draped=0]="Draped",o[o.Screen=1]="Screen",o[o.World=2]="World",o[o.COUNT=3]="COUNT",function(e){e[e.Center=0]="Center",e[e.Tip=1]="Tip",e[e.COUNT=2]="COUNT"}(r||(r={}));class h extends u.E{constructor(){super(...arguments),this.space=i.Screen,this.anchor=r.Center,this.occluder=!1,this.hasSlicePlane=!1,this.writeDepth=!1,this.hideOnShortSegments=!1,this.hasCap=!1,this.hasTip=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.textureCoordinateType=a.I.None,this.emissionSource=l.ZX.None,this.discardInvisibleFragments=!0,this.occlusionPass=!1,this.hasVvInstancing=!0,this.hasSliceTranslatedView=!0,this.objectAndLayerIdColorInstanced=!1}get draped(){return this.space===i.Draped}}(0,s._)([(0,c.W)({count:i.COUNT})],h.prototype,"space",void 0),(0,s._)([(0,c.W)({count:r.COUNT})],h.prototype,"anchor",void 0),(0,s._)([(0,c.W)()],h.prototype,"occluder",void 0),(0,s._)([(0,c.W)()],h.prototype,"hasSlicePlane",void 0),(0,s._)([(0,c.W)()],h.prototype,"writeDepth",void 0),(0,s._)([(0,c.W)()],h.prototype,"hideOnShortSegments",void 0),(0,s._)([(0,c.W)()],h.prototype,"hasCap",void 0),(0,s._)([(0,c.W)()],h.prototype,"hasTip",void 0),(0,s._)([(0,c.W)()],h.prototype,"vvSize",void 0),(0,s._)([(0,c.W)()],h.prototype,"vvColor",void 0),(0,s._)([(0,c.W)()],h.prototype,"vvOpacity",void 0),(0,s._)([(0,c.W)()],h.prototype,"hasOccludees",void 0),(0,s._)([(0,c.W)()],h.prototype,"terrainDepthTest",void 0),(0,s._)([(0,c.W)()],h.prototype,"cullAboveTerrain",void 0)},25124:function(e,t,n){"use strict";n.d(t,{z:function(){return u}});var i=n(27264),r=n(38130),o=n(84435),s=n(28686),a=n(23864),l=n(39506),c=n(54840);function u(e,t){e.include(o.Q,t),e.include(r.NL,t),e.fragment.include(a.a);const n=t.output===i.V.ObjectAndLayerIdColor,u=(0,i.LG)(t.output),h=(0,i.RN)(t.output)&&t.oitPass===c.Y.ColorAlpha,d=(0,i.RN)(t.output)&&t.oitPass!==c.Y.ColorAlpha,p=t.discardInvisibleFragments;let f=0;(d||u||h)&&e.outputs.add("fragColor","vec4",f++),u&&e.outputs.add("fragEmission","vec4",f++),h&&e.outputs.add("fragAlpha","float",f++),e.fragment.code.add(l.H`
    void outputColorHighlightOID(vec4 finalColor, const in vec3 vWorldPosition) {
      ${(0,l.If)(n,l.H`finalColor.a = 1.0;`)}

      ${(0,l.If)(p,l.H`if (finalColor.a < ${l.H.float(s.Q)}){
              discard;
              return;
            }`)}

      finalColor = highlightSlice(finalColor, vWorldPosition);
      ${(0,l.If)(h,l.H`fragColor = premultiplyAlpha(finalColor);
             fragAlpha = finalColor.a;`)}
      ${(0,l.If)(d,"fragColor = finalColor;")}
      ${(0,l.If)(u,"fragEmission = getEmissions();")}
      calculateOcclusionAndOutputHighlight();
      ${(0,l.If)(n,"outputObjectAndLayerIdColor();")}
    }
  `)}},95736:function(e,t,n){"use strict";n.d(t,{Q:function(){return u},x:function(){return i}});var i,r,o=n(53804),s=n(2457),a=n(38130),l=n(65875),c=n(22095);(r=i||(i={}))[r.BUTT=0]="BUTT",r[r.SQUARE=1]="SQUARE",r[r.ROUND=2]="ROUND",r[r.COUNT=3]="COUNT";class u extends c.E{constructor(){super(...arguments),this.capType=i.BUTT,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.applyMarkerOffset=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.occluder=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.wireframe=!1,this.discardInvisibleFragments=!1,this.objectAndLayerIdColorInstanced=!1,this.textureCoordinateType=s.I.None,this.emissionSource=a.ZX.None,this.occlusionPass=!1,this.hasVvInstancing=!0,this.hasSliceTranslatedView=!0}}(0,o._)([(0,l.W)({count:i.COUNT})],u.prototype,"capType",void 0),(0,o._)([(0,l.W)()],u.prototype,"hasSlicePlane",void 0),(0,o._)([(0,l.W)()],u.prototype,"hasPolygonOffset",void 0),(0,o._)([(0,l.W)()],u.prototype,"writeDepth",void 0),(0,o._)([(0,l.W)()],u.prototype,"draped",void 0),(0,o._)([(0,l.W)()],u.prototype,"stippleEnabled",void 0),(0,o._)([(0,l.W)()],u.prototype,"stippleOffColorEnabled",void 0),(0,o._)([(0,l.W)()],u.prototype,"stipplePreferContinuous",void 0),(0,o._)([(0,l.W)()],u.prototype,"roundJoins",void 0),(0,o._)([(0,l.W)()],u.prototype,"applyMarkerOffset",void 0),(0,o._)([(0,l.W)()],u.prototype,"vvSize",void 0),(0,o._)([(0,l.W)()],u.prototype,"vvColor",void 0),(0,o._)([(0,l.W)()],u.prototype,"vvOpacity",void 0),(0,o._)([(0,l.W)()],u.prototype,"falloffEnabled",void 0),(0,o._)([(0,l.W)()],u.prototype,"innerColorEnabled",void 0),(0,o._)([(0,l.W)()],u.prototype,"hasOccludees",void 0),(0,o._)([(0,l.W)()],u.prototype,"occluder",void 0),(0,o._)([(0,l.W)()],u.prototype,"terrainDepthTest",void 0),(0,o._)([(0,l.W)()],u.prototype,"cullAboveTerrain",void 0),(0,o._)([(0,l.W)()],u.prototype,"wireframe",void 0),(0,o._)([(0,l.W)()],u.prototype,"discardInvisibleFragments",void 0),(0,o._)([(0,l.W)()],u.prototype,"objectAndLayerIdColorInstanced",void 0)},46671:function(e,t,n){"use strict";var i,r,o;n.d(t,{OG:function(){return r},hM:function(){return i}}),n(39714),n(7456),n(57617),(o=i||(i={})).OPAQUE="opaque-color",o.TRANSPARENT="transparent-color",o.COMPOSITE="composite-color",o.FINAL="final-color",function(e){e.SSAO="ssao",e.LASERLINES="laserline-color",e.ANTIALIASING="aa-color",e.HIGHLIGHTS="highlight-color",e.MAGNIFIER="magnifier-color",e.OCCLUDED="occluded-color",e.VIEWSHED="viewshed-color",e.OPAQUE_ENVIRONMENT="opaque-environment-color",e.TRANSPARENT_ENVIRONMENT="transparent-environment-color"}(r||(r={}))},65631:function(e,t,n){"use strict";n.d(t,{A:function(){return E}});var i,r=n(53804),o=n(83525),s=n(40633),a=n(15774),l=n(13520),c=n(23502),u=(n(58941),n(13798),n(65953)),h=n(73364),d=n(39714),p=n(13786),f=n(1932),g=n(20551),m=n(32501),_=n(33400),v=n(41546),y=n(69508),b=n(79578),T=n(29531),x=n(65420),w=n(57701);let S=i=class extends o.A{constructor(e){super(e),this._ray=(0,b.vt)(),this._viewport=(0,v.fA)(0,0,1,1),this._padding=(0,v.fA)(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=(0,f.fA)(1,1e3),this._viewDirty=!0,this._viewMatrix=(0,d.vt)(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=(0,d.vt)(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=(0,d.vt)(),this._frustumDirty=!0,this._frustum=(0,y.vt)(),this._fullViewport=(0,v.vt)(),this._pixelRatio=1,this.row=0,this.column=0,this._rows=1,this._columns=1,this._center=(0,m.vt)(),this._up=(0,m.vt)(),this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(e){this._pixelRatio=e>0?e:1}get rows(){return this._rows}set rows(e){this._rows=Math.max(1,e)}get columns(){return this._columns}set columns(e){this._columns=Math.max(1,e)}get eye(){return this._ray.origin}set eye(e){this._compareAndSetView(e,this._ray.origin)}get center(){return this._center}set center(e){this._compareAndSetView(e,this._center,"_center")}get ray(){return(0,g.d)(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(e){this._compareAndSetView(e,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(e){(0,h.C)(this._viewMatrix,e),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),(0,g.i)((0,m.vt)(),-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10])}get viewUp(){return this._ensureViewClean(),(0,g.i)((0,m.vt)(),this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9])}get viewRight(){return this._ensureViewClean(),(0,g.i)((0,m.vt)(),this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8])}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(e){this._nearFar[0]!==e&&(this._nearFar[0]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(e){this._nearFar[1]!==e&&(this._nearFar[1]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(e){this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]}get screenViewport(){if(1===this.pixelRatio)return this._viewport;const e=(0,_.d)((0,v.vt)(),this._viewport,1/this.pixelRatio),t=this._get("screenViewport");return t&&(0,_.e)(e,t)?t:e}get screenPadding(){if(1===this.pixelRatio)return this._padding;const e=(0,_.d)((0,v.vt)(),this._padding,1/this.pixelRatio),t=this._get("screenPadding");return t&&(0,_.e)(e,t)?t:e}get x(){return this._viewport[0]}set x(e){e+=this._padding[w.zj.LEFT],this._viewport[0]!==e&&(this._viewport[0]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(e){e+=this._padding[w.zj.BOTTOM],this._viewport[1]!==e&&(this._viewport[1]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(e){this._viewport[2]!==e&&(this._viewport[2]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(e){this._viewport[3]!==e&&(this._viewport[3]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[w.zj.RIGHT]+this._padding[w.zj.LEFT]}set fullWidth(e){this.width=e-(this._padding[w.zj.RIGHT]+this._padding[w.zj.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[w.zj.TOP]+this._padding[w.zj.BOTTOM]}set fullHeight(e){this.height=e-(this._padding[w.zj.TOP]+this._padding[w.zj.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[w.zj.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[w.zj.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(e){(0,_.a)(this._padding,e)||(this._viewport[0]+=e[w.zj.LEFT]-this._padding[w.zj.LEFT],this._viewport[1]+=e[w.zj.BOTTOM]-this._padding[w.zj.BOTTOM],this._viewport[2]-=e[w.zj.RIGHT]+e[w.zj.LEFT]-(this._padding[w.zj.RIGHT]+this._padding[w.zj.LEFT]),this._viewport[3]-=e[w.zj.TOP]+e[w.zj.BOTTOM]-(this._padding[w.zj.TOP]+this._padding[w.zj.BOTTOM]),(0,_.c)(this._padding,e),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&((0,h.lw)(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){return this._projectionMatrixInternal}get inverseProjectionMatrix(){return(0,h.B8)((0,d.vt)(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||(0,d.vt)()}get fov(){return this._fov}set fov(e){this._fov=e,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return e=this._fov,t=this.width,n=this.height,2*Math.atan(t*Math.tan(.5*e)/Math.sqrt(t*t+n*n));var e,t,n}set fovX(e){this._fov=function(e,t,n){return 2*Math.atan(Math.sqrt(t*t+n*n)*Math.tan(.5*e)/t)}(e,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return e=this._fov,t=this.width,n=this.height,2*Math.atan(n*Math.tan(.5*e)/Math.sqrt(t*t+n*n));var e,t,n}set fovY(e){this._fov=function(e,t,n){return 2*Math.atan(Math.sqrt(t*t+n*n)*Math.tan(.5*e)/n)}(e,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return(0,g.j)(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&((0,h.B8)(this._viewInverseTransposeMatrix,this.viewMatrix),(0,h.mg)(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(e){const t=2*e-1;return 2*this.near*this.far/(this.far+this.near-t*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return null!=this.relativeElevation&&this.relativeElevation>=0}get _projectionMatrixInternal(){const e=this.width,t=this.height,n=this.near*Math.tan(this.fovY/2)*2,i=n*this._aspect,r=n/this.rows,o=i/this.columns,s=-i/2+this.column*o,a=s+o,l=-n/2+this.row*r,c=l+r,u=(0,h.$h)((0,d.vt)(),s*(1+2*this._padding[w.zj.LEFT]/e),a*(1+2*this._padding[w.zj.RIGHT]/e),l*(1+2*this._padding[w.zj.BOTTOM]/t),c*(1+2*this._padding[w.zj.TOP]/t),this.near,this.far),p=this._get("projectionMatrix");return p&&(0,h.aI)(p,u)?p:u}copyFrom(e){(0,g.c)(this._ray.origin,e.eye),this.center=e.center,this.up=e.up,(0,_.c)(this._viewport,e.viewport),this.notifyChange("_viewport"),(0,_.c)(this._padding,e.padding),this.notifyChange("_padding"),(0,p.C)(this._nearFar,e.nearFar),this.notifyChange("_nearFar"),this._fov=e.fov,this.row=e.row,this.column=e.column,this.rows=e.rows,this.columns=e.columns,this.relativeElevation=e.relativeElevation;const t=e;return this._viewDirty=t._viewDirty,this._viewDirty||((0,h.C)(this._viewMatrix,e.viewMatrix),this.notifyChange("_viewMatrix")),this._viewProjectionDirty=!0,this._frustumDirty=t._frustumDirty,this._frustumDirty||((0,y.C)(this._frustum,e.frustum),this._frustumDirty=!1),t._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:((0,h.C)(this._viewInverseTransposeMatrix,e.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),(0,_.c)(this._fullViewport,e.fullViewport),this.pixelRatio=e.pixelRatio,this}copyViewFrom(e){this.eye=e.eye,this.center=e.center,this.up=e.up,this.fov=e.fov}clone(){return(new i).copyFrom(this)}equals(e){return(0,g.p)(this.eye,e.eye)&&(0,g.p)(this.center,e.center)&&(0,g.p)(this.up,e.up)&&(0,_.a)(this._viewport,e.viewport)&&(0,_.a)(this._padding,e.padding)&&(0,p.t2)(this.nearFar,e.nearFar)&&this._fov===e.fov&&this.pixelRatio===e.pixelRatio&&this.relativeElevation===e.relativeElevation&&this.row===e.row&&this.column===e.column&&this.rows===e.rows&&this.columns===e.columns}almostEquals(e){const t=Math.max(1,1/this.pixelRatio,1/e.pixelRatio);if(Math.abs(e.fov-this._fov)>=.001||(0,_.f)(e.screenPadding,this.screenPadding)>=t||(0,_.f)(this.screenViewport,e.screenViewport)>=t||this.row!==e.row||this.column!==e.column||this.rows!==e.rows||this.columns!==e.columns)return!1;(0,g.a)(O,e.eye,e.center),(0,g.a)(R,this.eye,this.center);const n=(0,g.f)(O,R),i=(0,g.z)(O),r=(0,g.z)(R),o=5e-4;return n*n>=(1-1e-10)*i*r&&(0,g.y)(e.eye,this.eye)<Math.max(i,r)*o*o}computeRenderPixelSizeAt(e){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(e))}computeRenderPixelSizeAtDist(e){return e*this.perRenderPixelRatio}computeScreenPixelSizeAt(e){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(e))}_viewDirectionDistance(e){return Math.abs((0,T.gr)(this.viewForward,(0,g.d)(O,e,this.eye)))}computeScreenPixelSizeAtDist(e){return e*this.perScreenPixelRatio}computeDistanceFromRadius(e,t){return e/Math.tan(Math.min(this.fovX,this.fovY)/(2*(t||1)))}getScreenCenter(e=(0,l.gs)()){return e[0]=(this.padding[w.zj.LEFT]+this.width/2)/this.pixelRatio,e[1]=(this.padding[w.zj.TOP]+this.height/2)/this.pixelRatio,e}getRenderCenter(e,t=.5,n=.5){return e[0]=this.padding[w.zj.LEFT]+this.width*t,e[1]=this.padding[w.zj.BOTTOM]+this.height*n,e[2]=.5,e}setGLViewport(e){const t=this.viewport,n=this.padding;e.setViewport(t[0]-n[3],t[1]-n[2],t[2]+n[1]+n[3],t[3]+n[0]+n[2])}applyProjection(e,t){e!==A&&(0,g.c)(A,e),A[3]=1,(0,_.t)(A,A,this.projectionMatrix);const n=Math.abs(A[3]);(0,g.h)(A,A,1/n);const i=this.fullViewport;t[0]=(0,a.Cc)(0,i[0]+i[2],.5+.5*A[0]),t[1]=(0,a.Cc)(0,i[1]+i[3],.5+.5*A[1]),t[2]=.5*(A[2]+1),t[3]=n}unapplyProjection(e,t){const n=this.fullViewport;A[0]=(e[0]/(n[0]+n[2])*2-1)*e[3],A[1]=(e[1]/(n[1]+n[3])*2-1)*e[3],A[2]=(2*e[2]-1)*e[3],A[3]=e[3],null!=this.inverseProjectionMatrix&&((0,_.t)(A,A,this.inverseProjectionMatrix),t[0]=A[0],t[1]=A[1],t[2]=A[2])}projectToScreen(e,t){return this.projectToRenderScreen(e,C),this.renderToScreen(C,t),t}projectToRenderScreen(e,t){if(A[0]=e[0],A[1]=e[1],A[2]=e[2],A[3]=1,(0,_.t)(A,A,this.viewProjectionMatrix),0===A[3])return null;const n=A;(0,g.h)(n,n,1/Math.abs(A[3]));const i=this.fullViewport,r=(0,a.Cc)(0,i[0]+i[2],.5+.5*n[0]),o=(0,a.Cc)(0,i[1]+i[3],.5+.5*n[1]);return"x"in t?(t.x=r,t.y=o):(t[0]=r,t[1]=o,t.length>2&&(t[2]=.5*(n[2]+1))),t}unprojectFromScreen(e,t){return this.unprojectFromRenderScreen(this.screenToRender(e,C),t)}unprojectFromRenderScreen(e,t){if((0,h.lw)(M,this.projectionMatrix,this.viewMatrix),!(0,h.B8)(M,M))return null;const n=this.fullViewport;return A[0]=2*(e[0]-n[0])/n[2]-1,A[1]=2*(e[1]-n[1])/n[3]-1,A[2]=2*e[2]-1,A[3]=1,(0,_.t)(A,A,M),0===A[3]?null:(t[0]=A[0]/A[3],t[1]=A[1]/A[3],t[2]=A[2]/A[3],t)}constrainWindowSize(e,t,n,i){const r=e*this.pixelRatio,o=t*this.pixelRatio,s=Math.max(r-n/2,0),a=Math.max(this.fullHeight-o-i/2,0),l=-Math.min(r-n/2,0),c=-Math.min(this.fullHeight-o-i/2,0),u=n-l- -Math.min(this.fullWidth-r-n/2,0),h=i-c- -Math.min(o-i/2,0);return[Math.round(s),Math.round(a),Math.round(u),Math.round(h)]}computeUp(e){e===x.RT.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(e,t){const n=e[0]*this.pixelRatio,i=this.fullHeight-e[1]*this.pixelRatio;return t[0]=n,t[1]=i,t}renderToScreen(e,t){const n=e[0]/this.pixelRatio,i=(this.fullHeight-e[1])/this.pixelRatio;t[0]=n,t[1]=i}_computeUpGlobal(){(0,g.d)(O,this.center,this.eye);const e=(0,g.l)(this.center);e<1?((0,g.i)(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs((0,g.f)(O,this.center))>.9999*(0,g.l)(O)*e||((0,g.e)(this._up,O,this.center),(0,g.e)(this._up,this._up,O),(0,g.n)(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){(0,g.o)(O,this.eye,this.center),Math.abs(O[2])<=.9999&&((0,g.h)(O,O,O[2]),(0,g.i)(this._up,-O[0],-O[1],1-O[2]),(0,g.n)(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(e,t,n=""){"number"==typeof e[0]&&isFinite(e[0])&&"number"==typeof e[1]&&isFinite(e[1])&&"number"==typeof e[2]&&isFinite(e[2])?(0,g.p)(e,t)||((0,g.c)(t,e),this._markViewDirty(),n.length&&this.notifyChange(n)):s.A.getLogger("esri.views.3d.webgl-engine.lib.RenderCamera").warn("RenderCamera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&((0,y.ui)(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&((0,h.t5)(this._viewMatrix,this.eye,this.center,this.up),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};(0,r._)([(0,c.MZ)()],S.prototype,"_viewport",void 0),(0,r._)([(0,c.MZ)()],S.prototype,"_padding",void 0),(0,r._)([(0,c.MZ)()],S.prototype,"_fov",void 0),(0,r._)([(0,c.MZ)()],S.prototype,"_nearFar",void 0),(0,r._)([(0,c.MZ)()],S.prototype,"_viewDirty",void 0),(0,r._)([(0,c.MZ)()],S.prototype,"_viewMatrix",void 0),(0,r._)([(0,c.MZ)()],S.prototype,"_pixelRatio",void 0),(0,r._)([(0,c.MZ)()],S.prototype,"pixelRatio",null),(0,r._)([(0,c.MZ)()],S.prototype,"row",void 0),(0,r._)([(0,c.MZ)()],S.prototype,"column",void 0),(0,r._)([(0,c.MZ)()],S.prototype,"_rows",void 0),(0,r._)([(0,c.MZ)()],S.prototype,"rows",null),(0,r._)([(0,c.MZ)()],S.prototype,"_columns",void 0),(0,r._)([(0,c.MZ)()],S.prototype,"columns",null),(0,r._)([(0,c.MZ)()],S.prototype,"eye",null),(0,r._)([(0,c.MZ)()],S.prototype,"center",null),(0,r._)([(0,c.MZ)()],S.prototype,"_center",void 0),(0,r._)([(0,c.MZ)()],S.prototype,"up",null),(0,r._)([(0,c.MZ)()],S.prototype,"_up",void 0),(0,r._)([(0,c.MZ)()],S.prototype,"viewMatrix",null),(0,r._)([(0,c.MZ)({readOnly:!0})],S.prototype,"viewForward",null),(0,r._)([(0,c.MZ)({readOnly:!0})],S.prototype,"viewUp",null),(0,r._)([(0,c.MZ)({readOnly:!0})],S.prototype,"viewRight",null),(0,r._)([(0,c.MZ)({readOnly:!0})],S.prototype,"nearFar",null),(0,r._)([(0,c.MZ)()],S.prototype,"near",null),(0,r._)([(0,c.MZ)()],S.prototype,"far",null),(0,r._)([(0,c.MZ)()],S.prototype,"viewport",null),(0,r._)([(0,c.MZ)({readOnly:!0})],S.prototype,"screenViewport",null),(0,r._)([(0,c.MZ)({readOnly:!0})],S.prototype,"screenPadding",null),(0,r._)([(0,c.MZ)()],S.prototype,"x",null),(0,r._)([(0,c.MZ)()],S.prototype,"y",null),(0,r._)([(0,c.MZ)()],S.prototype,"width",null),(0,r._)([(0,c.MZ)()],S.prototype,"height",null),(0,r._)([(0,c.MZ)()],S.prototype,"fullWidth",null),(0,r._)([(0,c.MZ)()],S.prototype,"fullHeight",null),(0,r._)([(0,c.MZ)({readOnly:!0})],S.prototype,"_aspect",null),(0,r._)([(0,c.MZ)()],S.prototype,"padding",null),(0,r._)([(0,c.MZ)({readOnly:!0})],S.prototype,"projectionMatrix",null),(0,r._)([(0,c.MZ)({readOnly:!0})],S.prototype,"inverseProjectionMatrix",null),(0,r._)([(0,c.MZ)()],S.prototype,"fov",null),(0,r._)([(0,c.MZ)()],S.prototype,"fovX",null),(0,r._)([(0,c.MZ)()],S.prototype,"fovY",null),(0,r._)([(0,c.MZ)()],S.prototype,"viewInverseTransposeMatrix",null),(0,r._)([(0,c.MZ)({readOnly:!0})],S.prototype,"_projectionMatrixInternal",null),(0,r._)([(0,c.MZ)()],S.prototype,"relativeElevation",void 0),S=i=(0,r._)([(0,u.$)("esri.views.3d.webgl.RenderCamera")],S);const E=S,A=(0,v.vt)(),M=(0,d.vt)(),O=(0,m.vt)(),R=(0,m.vt)(),C=(0,l.r_)()},74174:function(e,t,n){"use strict";n.d(t,{A:function(){return d}});var i=n(53804),r=n(83525),o=n(39819),s=n(28181),a=n(23502),l=n(65953),c=n(46671),u=n(54407);let h=class extends r.A{constructor(e){super(e),this.view=null,this.consumes={required:[]},this.produces=c.hM.COMPOSITE,this.requireGeometryDepth=!1,this._dirty=!0}initialize(){this.addHandles([(0,s.watch)((()=>this.view.ready),(e=>{e&&this.view._stage?.renderer.addRenderNode(this)}),s.Vh)])}destroy(){this.view._stage?.renderer?.removeRenderNode(this)}precompile(){}render(){throw new o.A("RenderNode:render-function-not-implemented","render() is not implemented.")}get camera(){return this.view.state.camera.clone()}get sunLight(){return this.bindParameters.lighting.legacy}get gl(){return this.view._stage.renderView.renderingContext.gl}acquireOutputFramebuffer(){const e=this._frameBuffer?.getTexture()?.descriptor,t=this.view._stage.renderer.fboCache.acquire(e?.width??640,e?.height??480,this.produces);return t.fbo?.initializeAndBind(),t}bindRenderTarget(){return this._frameBuffer?.fbo?.initializeAndBind(),this._frameBuffer}requestRender(e){e===u.C7.UPDATE&&this.view._stage?.renderView.requestRender(e),this._dirty=!0}resetWebGLState(){this.renderingContext.resetState(),this.renderingContext.bindFramebuffer(this._frameBuffer?.fbo)}get fboCache(){return this.view._stage.renderer.fboCache}get bindParameters(){return this.renderContext.bind}get renderingContext(){return this.view._stage.renderView.renderingContext}get renderContext(){return this.view._stage?.renderer.renderContext}updateAnimation(e){return!!this._dirty&&(this._dirty=!1,!0)}doRender(e){this._frameBuffer=e.find((({name:e})=>e===this.produces));try{return this.render(e)}finally{this._frameBuffer=null}}};(0,i._)([(0,a.MZ)({constructOnly:!0})],h.prototype,"view",void 0),(0,i._)([(0,a.MZ)({constructOnly:!0})],h.prototype,"consumes",void 0),(0,i._)([(0,a.MZ)()],h.prototype,"produces",void 0),h=(0,i._)([(0,l.$)("esri.views.3d.webgl.RenderNode")],h);const d=h},98680:function(e,t,n){"use strict";var i,r;n.d(t,{N:function(){return i},z:function(){return r}}),function(e){e[e.RED=0]="RED",e[e.RG=1]="RG",e[e.RGBA4=2]="RGBA4",e[e.RGBA=3]="RGBA",e[e.RGBA_MIPMAP=4]="RGBA_MIPMAP",e[e.R16F=5]="R16F",e[e.RGBA16F=6]="RGBA16F"}(i||(i={})),function(e){e[e.DEPTH_STENCIL_TEXTURE=0]="DEPTH_STENCIL_TEXTURE",e[e.DEPTH16_BUFFER=1]="DEPTH16_BUFFER"}(r||(r={}))},65420:function(e,t,n){"use strict";var i;n.d(t,{RT:function(){return i}}),function(e){e[e.Global=1]="Global",e[e.Local=2]="Local"}(i||(i={}))},93336:function(e,t,n){"use strict";n.d(t,{N:function(){return Ke},l:function(){return tt}});var i,r,o=n(53804),s=n(59469),a=n(83525),l=n(78879),c=n(28181),u=n(23502),h=(n(58941),n(40633),n(13798),n(65953)),d=n(20248);!function(e){e[e.NeverApplied=0]="NeverApplied",e[e.Applied=1]="Applied",e[e.Undone=2]="Undone"}(i||(i={})),function(e){e.UndoRedoUpdating="UndoRedoUpdating",e.UndoInvalidError="UndoInvalidError",e.RedoInvalidError="RedoInvalidError",e.ApplyInvalidError="ApplyInvalidError"}(r||(r={}));const p={[r.UndoRedoUpdating]:"Cannot perform operation whilst undo redo is updating",[r.UndoInvalidError]:"There are no items to Undo",[r.RedoInvalidError]:"There are no items to Redo",[r.ApplyInvalidError]:"Cannot apply an item that is already applied"};class f extends Error{constructor(){super(p[r.UndoRedoUpdating]),this.type="undo-redo-updating-error"}}class g extends Error{constructor(){super(p[r.UndoInvalidError]),this.type="undo-redo-undo-error"}}class m extends Error{constructor(){super(p[r.RedoInvalidError]),this.type="undo-redo-redo-error"}}class _ extends Error{constructor(){super(p[r.ApplyInvalidError]),this.type="undo-redo-apply-error"}}var v,y;(y=v||(v={}))[y.Apply=0]="Apply",y[y.Undo=1]="Undo",y[y.Redo=2]="Redo";let b=class extends a.A{constructor(){super(...arguments),this.name="",this.tag=Symbol(),this.status=i.NeverApplied}get canUndo(){return this.status===i.Applied}get canRedo(){return this.status===i.Undone}async executeUndoRedoOperation(e){switch(e){case v.Apply:if(this.status!==i.NeverApplied)throw new _;return await this.apply(),void(this.status=i.Applied);case v.Undo:if(this.status!==i.Applied)throw new g;return await this.undo(),void(this.status=i.Undone);case v.Redo:if(this.status!==i.Undone)throw new g;return await this.redo(),void(this.status=i.Applied)}}};(0,o._)([(0,u.MZ)()],b.prototype,"name",void 0),(0,o._)([(0,u.MZ)()],b.prototype,"tag",void 0),b=(0,o._)([(0,h.$)("esri.undoredo.UndoableOperation")],b);let T=class extends a.A{constructor(){super(...arguments),this._stack=new l.A,this._stackPosition=-1,this._updatingHandles=new d.U}get updating(){return this._updatingHandles.updating}get canUndo(){return this.hasUndo&&!this.updating}get hasUndo(){return this._stackPosition>=0}get canRedo(){return this.hasRedo&&!this.updating}get hasRedo(){return this._stackPosition<this._stack.length-1}_truncateForwardStack(){this._stack.splice(this._stackPosition+1,this._stack.length-this._stackPosition).forEach((e=>e.destroy()))}_drainStack(){this._stack.drain((e=>e.destroy())),this._stackPosition=-1}async undo(){if(!this.hasUndo)throw new g;if(this.updating)throw new f;const e=this._stack.getItemAt(this._stackPosition);e&&await this._updatingHandles.addPromise((async()=>{await e.executeUndoRedoOperation(v.Undo),--this._stackPosition,e.canRedo||this._truncateForwardStack()})())}async redo(){if(!this.hasRedo)throw new m;if(this.updating)throw new f;const e=this._stack.getItemAt(this._stackPosition+1);if(!e)throw new m;await this._updatingHandles.addPromise((async()=>{await e.executeUndoRedoOperation(v.Redo),++this._stackPosition})())}peekUndo(){if(this.canUndo)return this._stack.getItemAt(this._stackPosition)}peekRedo(){if(this.canRedo)return this._stack.getItemAt(this._stackPosition+1)}async inject(e){if(this.updating)throw new f;await this._updatingHandles.addPromise((async()=>{e.status===i.NeverApplied&&await e.executeUndoRedoOperation(v.Apply),e.canUndo?(this._stack.splice(this._stackPosition+1,0,e),this._stackPosition++):this._stackPosition>-1&&(this._stack.splice(0,this._stackPosition+1).forEach((e=>e.destroy())),this._stackPosition=-1)})())}async add(e){if(this.updating)throw new f;await this._updatingHandles.addPromise((async()=>{e.status===i.NeverApplied&&await e.executeUndoRedoOperation(v.Apply),this._stackPosition>=-1&&this._truncateForwardStack(),e.canUndo?(this._stack.push(e),this._stackPosition=this._stack.length-1):this._drainStack()})())}async removeTagged(e,t=!1){if(this.updating&&!t)return;await(0,c.C_)((()=>!this.updating));const n=new l.A;for(let t=0;t<this._stack.length;t++){const i=this._stack.getItemAt(t);i&&(i.tag===e?(i.destroy(),t===this._stackPosition&&(this._stackPosition=n.length-1)):n.push(i))}this._stack=n,this._stackPosition>n.length-1&&(this._stackPosition=n.length-1)}async clear(e=!1){if(this.updating&&!e)throw new f;await(0,c.C_)((()=>!this.updating)),this._drainStack()}};(0,o._)([(0,u.MZ)()],T.prototype,"_stack",void 0),(0,o._)([(0,u.MZ)()],T.prototype,"_stackPosition",void 0),(0,o._)([(0,u.MZ)()],T.prototype,"updating",null),(0,o._)([(0,u.MZ)({readOnly:!0})],T.prototype,"canUndo",null),(0,o._)([(0,u.MZ)({readOnly:!0})],T.prototype,"hasUndo",null),(0,o._)([(0,u.MZ)({readOnly:!0})],T.prototype,"canRedo",null),(0,o._)([(0,u.MZ)({readOnly:!0})],T.prototype,"hasRedo",null),T=(0,o._)([(0,h.$)("esri.UndoRedo")],T);var x=n(77472),w=n(48996),S=n(61226),E=n(95929),A=n(6338),M=n(19702),O=n(42413);class R{constructor(){this.committedVertices=null,this.cursorVertex=null,this.full=null,this.outline=null,this.cursorEdge=null,this.circle=null,this.rectangle=null}}n(50917);var C,I=n(50659),P=n(21609),D=n(62938),L=n(20551),N=n(32501),F=n(61714),z=n(45532),H=n(44740),V=n(57165),U=n(57862),k=n(1644),B=n(94757);let G=C=class extends H.A{constructor(e){super(e),this.center=null,this.geodesic=!1,this.numberOfPoints=60,this.radius=1e3,this.radiusUnit="meters"}initialize(){const e=this.center,t=this.numberOfPoints;if(this.hasZ=e?.hasZ??!1,0!==this.rings.length||!e)return;const n=(0,D.oU)(this.radius,this.radiusUnit,"meters"),i=e.spatialReference;let r,o="geographic";if(i.isWebMercator?o="webMercator":(null!=(i.wkid&&B.A[i.wkid])||(i.wkt2||i.wkt)&&(0,D.x1)(i.wkt2||i.wkt))&&(o="projected"),this.geodesic){let i;switch(o){case"webMercator":i=(0,k.ci)(e);break;case"projected":console.error("Creating a geodesic circle requires the center to be specified in web mercator or geographic coordinate system");break;case"geographic":i=e}r=this._createGeodesicCircle(i,n,t),"webMercator"===o&&(r=(0,k.Gh)(r))}else{let i;"webMercator"===o||"projected"===o?i=n/(0,D.Ao)(e.spatialReference):"geographic"===o&&(i=(0,D.vl)(n,"meters",(0,F.tO)(e.spatialReference).radius)),r=this._createPlanarCircle(e,i,t)}this.spatialReference=r.spatialReference,this.addRing(r.rings[0])}clone(){const{center:e,numberOfPoints:t,radius:n,radiusUnit:i,geodesic:r}=this;return new C({center:e?.clone(),numberOfPoints:t,radius:n,radiusUnit:i,geodesic:r})}_createGeodesicCircle(e,t,n){let i=0;const r=[];for(;i<360;){const o=[0,0],s=[e.x,e.y];(0,U.vN)(o,s,i,t,V.A.WGS84),this.hasZ&&o.push(e.z),r.push(o),i+=360/n}return r.push(r[0]),new H.A({rings:[r]})}_createPlanarCircle(e,t,n){const i=[],r=2*Math.PI/n;for(let o=0;o<n;++o){const n=r*o,s=[e.x+Math.cos(-n)*t,e.y+Math.sin(-n)*t];this.hasZ&&s.push(e.z),i.push(s)}return i.push(i[0]),new H.A({spatialReference:e.spatialReference,rings:[i]})}};(0,o._)([(0,u.MZ)({type:z.default})],G.prototype,"center",void 0),(0,o._)([(0,u.MZ)()],G.prototype,"geodesic",void 0),(0,o._)([(0,u.MZ)()],G.prototype,"numberOfPoints",void 0),(0,o._)([(0,u.MZ)()],G.prototype,"radius",void 0),(0,o._)([(0,u.MZ)()],G.prototype,"radiusUnit",void 0),G=C=(0,o._)([(0,h.$)("esri.geometry.Circle")],G);const $=G;var j=n(22162),Z=n(38441),W=n(57652),q=n(67348),Y=n(12978),X=n(32237),Q=n(61769),K=n(72485);function J(e,t,n=null){return null!=n?[e,t,n]:[e,t]}function ee(e,t,n=null){return null!=n?{x:e,y:t,z:n}:{x:e,y:t}}class te{constructor(e){this.spatialReference=e}mapToLocalMultiple(e){return e.map((e=>this.mapToLocal(e))).filter(I.Ru)}get doUnnormalization(){return!1}}class ne extends te{constructor(e,t,n=null){super(t),this._defaultZ=n,this.transform=(0,Y.vt)(),this.transformInv=(0,Y.vt)(),this.transform=(0,Y.o8)(e),(0,q.B8)(this.transformInv,this.transform)}makeMapPoint(e,t){return J(e,t,this._defaultZ)}mapToLocal(e){return ee(this.transform[0]*e[0]+this.transform[2]*e[1]+this.transform[4],this.transform[1]*e[0]+this.transform[3]*e[1]+this.transform[5])}localToMap(e){return J(this.transformInv[0]*e.x+this.transformInv[2]*e.y+this.transformInv[4],this.transformInv[1]*e.x+this.transformInv[3]*e.y+this.transformInv[5],this._defaultZ)}}class ie extends te{constructor(e,t){super(e.spatialReference),this.view=e,this.defaultZ=null,this.pWS=(0,N.vt)(),this.tangentFrameUpWS=(0,N.vt)(),this.tangentFrameRightWS=(0,N.vt)(),this.tangentFrameForwardWS=(0,N.vt)(),this.localFrameRightWS=(0,N.vt)(),this.localFrameUpWS=(0,N.vt)(),this.worldToLocalTransform=(0,Q.vt)(),this.localToWorldTransform=(0,Q.vt)(),this.scale=1,this.scale=e.resolution,this.referenceMapPoint=t,this.defaultZ=t.hasZ?t.z:null;const n=e.state.camera.viewRight;this.view.renderCoordsHelper.toRenderCoords(this.referenceMapPoint,this.pWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,K._.X,this.tangentFrameRightWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,K._.Y,this.tangentFrameUpWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,K._.Z,this.tangentFrameForwardWS);const i=(0,N.vt)();(0,L.h)(i,this.tangentFrameForwardWS,(0,L.f)(n,this.tangentFrameForwardWS)),(0,L.d)(this.localFrameRightWS,n,i),(0,L.n)(this.localFrameRightWS,this.localFrameRightWS),(0,L.e)(this.localFrameUpWS,this.tangentFrameForwardWS,this.localFrameRightWS),(0,X.Yc)(this.worldToLocalTransform,this.localFrameRightWS,this.tangentFrameRightWS),(0,X.B8)(this.localToWorldTransform,this.worldToLocalTransform)}get doUnnormalization(){return"global"===this.view.viewingMode}makeMapPoint(e,t){return J(e,t,this.defaultZ)}mapToLocal(e){const t=(0,N.vt)();this.view.renderCoordsHelper.toRenderCoords(new z.default({x:e[0],y:e[1],spatialReference:this.spatialReference}),t),(0,L.w)(t,t,this.worldToLocalTransform);const n=this.view.renderCoordsHelper.fromRenderCoords(t,new z.default({spatialReference:this.view.spatialReference}));return null!=n?ee(n.x/this.scale,n.y/this.scale):null}localToMap(e){const t=(0,N.vt)();this.view.renderCoordsHelper.toRenderCoords(new z.default({x:e.x*this.scale,y:e.y*this.scale,spatialReference:this.spatialReference}),t),(0,L.w)(t,t,this.localToWorldTransform);const n=this.view.renderCoordsHelper.fromRenderCoords(t,new z.default({spatialReference:this.view.spatialReference}));return null!=n?J(n.x,n.y,this.defaultZ):null}}var re=n(71673),oe=n(91508);function se(e,t){const n=new z.default({x:e[0],y:e[1],spatialReference:t});return e.length>2&&(n.z=e[2]),n}function ae(e,t,n){const i=new oe.A({paths:e,spatialReference:t});return n&&(0,Z._7)(i),i}function le(e,t,n,i=!0){const r=(0,P.o8)(e);r.forEach((e=>{const t=e[0],n=e[e.length-1];(0,I.aI)(t,n)&&1!==e.length||e.push(e[0])}));let o=new H.A({rings:r,spatialReference:t});return o.rings.forEach((e=>{(0,Z.$3)(e)||e.reverse()})),n&&(0,Z._7)(o),i&&o.isSelfIntersecting&&(0,W.fn)(t)&&(o=(0,j.simplify)(o)),o}function ce(e,t,n){const i=t.mapToLocalMultiple(e),r=[],o={x:i[0].x,y:i[0].y},s=i[1].x,a=i[1].y,l=Math.round(s-o.x),c=Math.round(a-o.y),u=Math.max(Math.abs(l),Math.abs(c));if(n){const e={x:o.x+u,y:o.y+u},t={x:o.x-u,y:o.y-u};r.push(ee(e.x,t.y),ee(t.x,t.y),ee(t.x,e.y),ee(e.x,e.y))}else{const e={x:l>0?o.x+u:o.x-u,y:c>0?o.y+u:o.y-u};r.push(ee(o.x,o.y),ee(e.x,o.y),ee(e.x,e.y),ee(o.x,e.y))}return ue(le([r.map((e=>t.localToMap(e))).filter(I.Ru)],t.spatialReference,t.doUnnormalization,!0),r,t)}function ue(e,t,n){const i=he(t[3],t[2],n),r=he(t[1],t[2],n),o=he(t[0],t[1],n),s=he(t[0],t[3],n);return{geometry:e,midpoints:null!=i&&null!=r&&null!=o&&null!=s?{top:i,right:r,bottom:o,left:s}:null}}function he(e,t,n){pe[0]=e.x,pe[1]=e.y,pe[2]=0,fe[0]=t.x,fe[1]=t.y,fe[2]=0,(0,L.m)(pe,pe,fe,.5),de.x=pe[0],de.y=fe[1],de.z=fe[2];const i=n.localToMap(de);return null!=i?se(i,n.spatialReference):null}const de=ee(0,0,0),pe=(0,N.vt)(),fe=(0,N.vt)();function ge(e,t,n,i){const r=t.mapToLocalMultiple(e);let o=null,s=null;if(n)o=r[0],s=r[1];else{const e=r[0],t=r[1],n=Math.round(t.x-e.x),i=Math.round(t.y-e.y),a=Math.max(Math.abs(n),Math.abs(i));o=ee(n>0?e.x+a/2:e.x-a/2,i>0?e.y+a/2:e.y-a/2),s=ee(Math.abs(n)>Math.abs(i)?o.x-a/2:o.x,Math.abs(n)>Math.abs(i)?o.y:o.y-a/2)}const a=t.localToMap(o),l=t.localToMap(s);if(null==a||null==l)return null;t.doUnnormalization&&(0,Z.JM)([[a,l]],t.spatialReference);const c=se(a,t.spatialReference),u=se(l,t.spatialReference),h=(0,D.GA)(t.spatialReference);let d=0;if((0,W.fn)(t.spatialReference))d=h*(0,j.distance)(c,u,null);else{const e=o.x-s.x,t=o.y-s.y;d=h*Math.sqrt(e*e+t*t)*(i||1)}const p=new $({center:c,radius:d,radiusUnit:"meters",spatialReference:t.spatialReference});return{geometry:le(p.rings,p.spatialReference,!1),center:c,edge:u}}var me=n(56275),_e=n(68945);function ve(e,t){switch(e){case"point":case"multipoint":return"point";case"polyline":return function(e){return(null!=e&&"polyline"===e.type&&e.paths.length?e.paths[0].length:0)<2?"polylineZeroVertices":"polylineOneVertex"}(t);case"polygon":return function(e){const t=null!=e&&"polygon"===e.type&&e.rings.length?e.rings[0].length:0;return t<3?"polylineZeroVertices":t<4?"polygonOneVertex":"polygonTwoVertices"}(t);default:return}}const ye=(0,N.vt)();var be=n(7768),Te=n(24148),xe=n(90858);let we=class extends xe.w{constructor(e){super(e),this.type="draw-circle",this.radius=null,this.xSize=null,this.ySize=null,this.area=me.iT}get allFields(){return[]}};(0,o._)([(0,u.MZ)()],we.prototype,"type",void 0),(0,o._)([(0,u.MZ)()],we.prototype,"radius",void 0),(0,o._)([(0,u.MZ)()],we.prototype,"xSize",void 0),(0,o._)([(0,u.MZ)()],we.prototype,"ySize",void 0),(0,o._)([(0,u.MZ)()],we.prototype,"area",void 0),(0,o._)([(0,u.MZ)()],we.prototype,"allFields",null),we=(0,o._)([(0,h.$)("esri.views.interactive.tooltip.infos.DrawCircleTooltipInfo")],we);var Se=n(87265),Ee=n(73919);let Ae=class extends((0,Ee.B)(xe.w)){constructor(e){super(e),this.type="draw-mesh",this.orientation=(0,Se.LJ)({lockable:!1}),this.scale=(0,Se.dy)({lockable:!1})}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,this.orientation,this.scale]}};(0,o._)([(0,u.MZ)()],Ae.prototype,"helpMessage",void 0),(0,o._)([(0,u.MZ)()],Ae.prototype,"allFields",null),Ae=(0,o._)([(0,h.$)("esri.views.interactive.tooltip.infos.DrawMeshTooltipInfo")],Ae);let Me=class extends((0,Ee.B)(xe.w)){constructor(e){super(e),this.type="draw-point"}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};(0,o._)([(0,u.MZ)()],Me.prototype,"helpMessage",void 0),(0,o._)([(0,u.MZ)()],Me.prototype,"allFields",null),Me=(0,o._)([(0,h.$)("esri.views.interactive.tooltip.infos.DrawPointTooltipInfo")],Me);let Oe=class extends((0,Ee.B)(xe.w)){constructor(e){super(e),this.type="draw-polygon",this.direction=(0,Se.Gk)(),this.distance=(0,Se.Ku)(),this.area=(0,Se.Am)(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.area]}};(0,o._)([(0,u.MZ)()],Oe.prototype,"xyMode",void 0),(0,o._)([(0,u.MZ)()],Oe.prototype,"helpMessage",void 0),(0,o._)([(0,u.MZ)()],Oe.prototype,"allFields",null),Oe=(0,o._)([(0,h.$)("esri.views.interactive.tooltip.infos.DrawPolygonTooltipInfo")],Oe);let Re=class extends((0,Ee.B)(xe.w)){constructor(e){super(e),this.type="draw-polyline",this.direction=(0,Se.Gk)(),this.distance=(0,Se.Ku)(),this.totalLength=(0,Se.fr)(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.totalLength]}};(0,o._)([(0,u.MZ)()],Re.prototype,"helpMessage",void 0),(0,o._)([(0,u.MZ)()],Re.prototype,"xyMode",void 0),(0,o._)([(0,u.MZ)()],Re.prototype,"allFields",null),Re=(0,o._)([(0,h.$)("esri.views.interactive.tooltip.infos.DrawPolylineTooltipInfo")],Re);let Ce=class extends xe.w{constructor(e){super(e),this.type="draw-rectangle",this.xSize=me.r7,this.ySize=me.r7,this.area=me.iT}get allFields(){return[]}};(0,o._)([(0,u.MZ)()],Ce.prototype,"type",void 0),(0,o._)([(0,u.MZ)()],Ce.prototype,"xSize",void 0),(0,o._)([(0,u.MZ)()],Ce.prototype,"ySize",void 0),(0,o._)([(0,u.MZ)()],Ce.prototype,"area",void 0),(0,o._)([(0,u.MZ)()],Ce.prototype,"allFields",null),Ce=(0,o._)([(0,h.$)("esri.views.interactive.tooltip.infos.DrawRectangleTooltipInfo")],Ce);var Ie=n(99675),Pe=n(70474),De=n(9862),Le=n(46517);function Ne(e){const{directionOptions:t,geometryType:n,sketchOptions:i,tooltipInfos:r}=e,o=t=>{const n=je(e).mode,i=r[t].elevation;"relative-to-ground"===n||"relative-to-scene"===n||"on-the-ground"===n?i.lock(We(e)):i.unlock()};switch(n){case"polygon":case"polyline":o(n),(e=>{if(t){const n=r[e].direction;n.committed=t.angle,n.unlockOnVertexPlacement=!1,i.values.directionMode=t.mode}})(n);break;case"point":case"mesh":o(n)}}function Fe(e){ze(e)?.allFields.forEach((e=>{e.unlockOnVertexPlacement&&e.unlock()}))}function ze({geometryType:e,graphic:t,tooltipInfos:n}){return"multipoint"===e||t?.geometry?.type!==He[e]?null:n[e]}const He={point:"point",mesh:"mesh",polyline:"polyline",polygon:"polygon",circle:"polygon",rectangle:"polygon"};function Ve(e,t,n){const{drawOperation:i,view:r,sketchOptions:o}=n,{cursorVertex:s}=i;if(e.sketchOptions=o,e.viewType=r.type,e.setLocationFromPoint(t,Ze(n)),ke(e.elevation,n),!s)return void(i.constraints=void 0);const a=s;i.constraints={context:qe(a,n),x:e.x.committed,y:e.y.committed,longitude:e.longitude.committed,latitude:e.latitude.committed,elevation:e.elevation.committed,distance:null,direction:null}}function Ue(e,t){const{drawOperation:n,sketchOptions:i,view:r}=t,{cursorVertex:o,lastVertex:s,secondToLastVertex:a}=n,l=i.values.effectiveDirectionMode;e.sketchOptions=i,e.viewType=r.type;const c=s&&o?(0,De.Kt)(s,o)??me.r7:null;if(e.distance.actual=c,e.distance.readOnly=null==s,e.direction.actual=null,e.direction.readOnly=!0,s&&o&&("absolute"===l||a)){const t=(0,Ie.uR)(a,s,o,l);e.direction.actual=t??me.n0,e.direction.readOnly=!1}e.setLocationFromPoint(o,Ze(t)),ke(e.elevation,t);const u=function(e,{sketchOptions:t}){const n=t.tooltips.xyMode;return"auto"===n?e?"direction-distance":"coordinates":n}(s,t);e.xyMode=u,e.direction.visible="direction-distance"===u,e.distance.visible="direction-distance"===u,e.effectiveX.visible="coordinates"===u,e.effectiveY.visible="coordinates"===u;const h=o??s;n.constraints=h?{context:qe(h,t),x:e.x.committed,y:e.y.committed,longitude:e.longitude.committed,latitude:e.latitude.committed,elevation:e.elevation.committed,distance:e.distance.committed,direction:e.direction.committed}:void 0}function ke(e,t){const{drawOperation:n}=t,i=n?.cursorVertex??n?.lastVertex;e.actual=(0,Le.Of)(i)??We(t),e.visible=n.hasZ,e.readOnly=!1,e.showAsZ=!0}function Be(e){const t=e.createOperationGeometry?.full;return"polygon"!==t?.type?me.iT:(0,Pe.n)(t)??me.iT}function Ge(e){const t=e.createOperationGeometry?.rectangle?.midpoints;return(null!=t?(0,De.Kt)(t.left,t.right):null)??me.r7}function $e(e){const t=e.createOperationGeometry?.rectangle?.midpoints;return(null!=t?(0,De.Kt)(t.top,t.bottom):null)??me.r7}function je(e){return e.drawOperation.elevationInfo??_e.qt}function Ze(e){return e.drawOperation.coordinateHelper.spatialReference}function We(e){const t=(0,D.G9)(Ze(e));return(0,me.d_)(e.defaultZ*t,"meters")}function qe(e,t){return(0,be.hj)(e,t.view,Ze(t),je(t),t.drawOperation.coordinateHelper.hasZ(),t.sketchOptions.values.effectiveDirectionMode)}var Ye=n(83202),Xe=n(37102),Qe=n(25638);let Ke=class extends(w.A.EventedMixin(Ye.g)){constructor(e){super(e),this._graphic=null,this._coordinateFormatterLoadTask=null,this._createOperationGeometry=null,this.defaultZ=0,this.directionOptions=null,this.geometryType=null,this.hasZ=!0,this.geometryToPlace=null,this.snappingManager=null,this.snapToScene=!1,this.sketchOptions=new Xe.A}initialize(){const{view:e}=this;this.internalGraphicsLayer=new M.default({listMode:"hide",internal:!0}),this.view.map.layers.add(this.internalGraphicsLayer);const t=this.drawOperation=this.makeDrawOperation();this.tooltipInfos=function(e,t){return{point:new Me({sketchOptions:t,viewType:e}),polyline:new Re({sketchOptions:t,viewType:e}),polygon:new Oe({sketchOptions:t,viewType:e}),mesh:new Ae({sketchOptions:t,viewType:e}),rectangle:new Ce({sketchOptions:t}),circle:new we({sketchOptions:t})}}(e.type,this.sketchOptions);const n=(0,Te.A)((()=>({view:e,options:this.sketchOptions.tooltips})));this.tooltip=n,Ne(this._tooltipsContext),this._coordinateFormatterLoadTask=(0,x.UT)((()=>(0,A.Hh)())),this.addHandles([t.on("vertex-add",(e=>this.onVertexAdd(e))),t.on("vertex-remove",(e=>this.onVertexRemove(e))),t.on("vertex-update",(e=>this.onVertexUpdate(e))),t.on("cursor-update",(e=>this.onCursorUpdate(e))),t.on("cursor-remove",(()=>this._updateGraphic())),t.on("complete",(e=>this.onComplete(e))),this._coordinateFormatterLoadTask,n.on("paste",(e=>(0,Te.HA)(e,this.activeTooltipInfo))),(0,c.watch)((()=>this.cursor),(e=>{t.cursor=e}),c.pc),(0,Qe.fm)((()=>{const{activeTooltipInfo:e,sketchOptions:t}=this;(function(e,t){switch(e?.type){case"draw-point":!function(e,t){const n=t.graphic?.geometry;"point"===n?.type&&(Ve(e,n,t),e.helpMessage=ve("point",n))}(e,t);break;case"draw-polyline":!function(e,t){const{createOperationGeometry:n,drawOperation:i}=t,r=null!=n?n.full:null;r&&"polyline"!==r.type||(Ue(e,t),e.totalLength.actual=i.lastVertex?(r?(0,De.ob)(r):null)??me.r7:null,e.helpMessage=ve("polyline",r))}(e,t);break;case"draw-polygon":!function(e,t){const{createOperationGeometry:n,drawOperation:i}=t,r=null!=n?n.full:null;r&&"polygon"!==r.type||(Ue(e,t),e.area.actual=i.lastVertex?(r?(0,Pe.n)(r):null)??me.iT:null,e.helpMessage=ve("polygon",r))}(e,t);break;case"draw-rectangle":!function(e,t){e.sketchOptions=t.sketchOptions,e.xSize=Ge(t),e.ySize=$e(t),e.area=Be(t)}(e,t);break;case"draw-circle":!function(e,t){const{forceUniformSize:n,sketchOptions:i}=t;e.sketchOptions=i,e.radius=n?function({createOperationGeometry:e}){return(null!=e?.circle?.center&&null!=e.circle.edge?(0,De.Kt)(e.circle.center,e.circle.edge):null)??me.r7}(t):null,e.xSize=n?null:Ge(t),e.ySize=n?null:$e(t),e.area=Be(t)}(e,t);break;case"draw-mesh":!function(e,t){const{graphic:n,view:i}=t,r=n?.geometry;"3d"!==i.type||r&&"mesh"!==r.type||(Ve(e,r?.origin,t),r&&(0,Te.Ue)(e,r),e.helpMessage=function(e,t){const n=e?.geometry;if(!e||"mesh"!==n?.type||!t)return;const{renderCoordsHelper:i,elevationProvider:r}=t,{camera:o}=t.state,{extent:s}=n,{center:a,spatialReference:l}=s,c=(0,D.GA)(l),u=(0,D.G9)(l),h=(0,D.GA)(i.spatialReference),d=s.width*c,p=s.height*u,f=(s.zmax??0)*u,g=f-(s.zmin??0)*u,m=Math.max(d,p,g)/h,{x:_,y:v}=a,y=a.z??0;(0,L.i)(ye,_,v,y),i.toRenderCoords(ye,l,ye);const b=m/o.computeScreenPixelSizeAt(ye);if(b>1*o.width)return"meshTooClose";if(b<20)return"meshTooFar";const T=(0,_e.bh)(e),{absoluteZ:x}=(0,_e.Q5)(_,v,f,l,t,T);return x<(r.getElevation(_,v,y,l,"ground")??0)*u+.1*g?"meshUnderground":"mesh"}(n,i))}(e,t)}})(e,this._tooltipsContext),n.info=t.tooltips.effectiveEnabled?e:null})),(0,Qe.fm)((()=>{t.constraintZ=function(e){const{geometryType:t,tooltipInfos:n}=e;switch(t){case"point":case"mesh":case"polyline":case"polygon":{const i=n[t].elevation.committed;if(!i)return;return(0,me.l3)(i,"meters")/(0,D.G9)(Ze(e))}default:return}}(this._tooltipsContext)}),c.OH)]),this.finishToolCreation()}destroy(){this.drawOperation=(0,E.pR)(this.drawOperation),this.tooltip=(0,E.pR)(this.tooltip),this._destroyAllVisualizations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=(0,E.pR)(this.internalGraphicsLayer),this._set("view",null)}get _drawSpatialReference(){return this.drawOperation.coordinateHelper.spatialReference}get _tooltipsContext(){return{createOperationGeometry:this._createOperationGeometry,defaultZ:this.defaultZ,directionOptions:this.directionOptions,drawOperation:this.drawOperation,forceUniformSize:this.forceUniformSize,geometryType:this.geometryType,graphic:this.graphic,sketchOptions:this.sketchOptions,tooltipInfos:this.tooltipInfos,view:this.view}}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centered(e){this._set("centered",e),this._updateGraphic()}get cursor(){return this._get("cursor")}set cursor(e){this._set("cursor",e)}set enabled(e){this.drawOperation.interactive=e,this._set("enabled",e)}set forceUniformSize(e){this._set("forceUniformSize",e),this._updateGraphic()}get graphic(){return this._graphic}set graphicSymbol(e){this._set("graphicSymbol",e),null!=this._graphic&&(this._graphic.symbol=e)}set mode(e){const t=this.drawOperation;t&&(t.drawingMode=e),this._set("mode",e)}get updating(){return this.drawOperation?.updating??!1}get undoRedo(){const{view:{type:e,map:t}}=this;return"2d"===e&&t&&"undoRedo"in t&&t.undoRedo instanceof T?t.undoRedo:null}set undoRedo(e){this._override("undoRedo",e)}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(e){this.destroyed||(0,Te.wG)(e,this.tooltip)||this.drawOperation.onInputEvent(e)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo(),0===this.drawOperation.numCommittedVertices&&Ne(this._tooltipsContext)}_destroyAllVisualizations(){this.removeHandles(et.outline),this.removeHandles(et.regularVertices),this.removeHandles(et.activeVertex),this.removeHandles(et.activeEdge),this.removeHandles(Je)}_createOrUpdateGraphic(e){if(null!=this._graphic)return this.updateGraphicGeometry(e),this._graphic;const t=new s.default({...this.graphicProperties,symbol:this.graphicSymbol});return this._graphic=t,this.updateGraphicGeometry(e),this.internalGraphicsLayer.add(t),this.addHandles(this.initializeGraphic(t)),this.notifyChange("graphic"),this.addHandles((0,S.hA)((()=>{this.internalGraphicsLayer.remove(t),this._graphic===t&&(this._graphic=null)})),Je),t}updateGraphicGeometry(e){this._graphic.geometry=e}_getCreateOperationGeometry(e={operationComplete:!1}){if(null==this.drawOperation)return;const{coordinateHelper:t,view:n,visualizationCursorVertex:i,lastVertex:r,committedVertices:o,geometryIncludingUncommittedVertices:s,numCommittedVertices:a}=this.drawOperation;if(!(a>0||null!=i))return;const l=e.operationComplete?o:s,c=l.length,u=null!=i?t.pointToArray(i):null,h=this._drawSpatialReference,d="3d"===n.type&&"global"===n.viewingMode,p=new R;p.committedVertices=o,p.cursorVertex=u;const{geometryType:f}=this;switch(f){case"point":case"mesh":p.full=t.arrayToPoint(l[0]);break;case"multipoint":p.full=c>0?function(e,t){return new re.A({points:e,spatialReference:t})}(l,h):null;break;case"polyline":case"polygon":c>0&&(p.full="polygon"===f?le([l],h,d,!0):ae([l],h,d),p.cursorEdge=null!=u&&r&&!(0,O.CI)(i,r)?ae([[u,t.pointToArray(r)]],h,d):null,p.outline=c>1?p.full:null);break;case"circle":case"rectangle":{if(p.committedVertices=p.cursorVertex=null,!c)break;const t=function(e,t){if("2d"===e.type)return new ne(e.state.transform,e.spatialReference,t.length>2?t[2]:null);if("3d"===e.type){const n=t.length>2?new z.default({x:t[0],y:t[1],z:t[2],spatialReference:e.spatialReference}):new z.default({x:t[0],y:t[1],spatialReference:e.spatialReference});return new ie(e,n)}return null}(n,l[0]),i=l[0],r=t.makeMapPoint(i[0]+nt*n.resolution,i[1]);"circle"===f?1===c&&e.operationComplete?p.circle=ge([i,r],t,!0):2===c&&(this.forceUniformSize?p.circle=ge(l,t,this.centered):p.rectangle=function(e,t,n){const i=t.mapToLocalMultiple(e),r=i[0],o=i[1],s=Math.round(o.x-r.x),a=Math.round(o.y-r.y),l=ee(n?r.x:r.x+s/2,n?r.y:r.y+a/2),c=n?s:s/2,u=n?a:a/2,h=[],d=2*Math.PI/60;function p(e){const t=Math.cos(e),n=Math.sin(e);return ee(c*t+l.x,u*n+l.y)}for(let e=0;e<60;e++)h.push(p(e*d));h.push(h[0]);const{spatialReference:f,doUnnormalization:g}=t,m=le([h.map((e=>t.localToMap(e))).filter(I.Ru)],f,g,!1),_=t.localToMap(p(Math.PI/2)),v=t.localToMap(p(0)),y=t.localToMap(p(-Math.PI/2)),b=t.localToMap(p(Math.PI));return{geometry:m,midpoints:null!=_&&null!=v&&null!=y&&null!=b?{top:se(_,f),right:se(v,f),bottom:se(y,f),left:se(b,f)}:null}}(l,t,this.centered)):1===c&&e.operationComplete?p.rectangle=ce([i,r],t,!0):2===c&&(p.rectangle=this.forceUniformSize?ce(l,t,this.centered):function(e,t,n){let i=t.mapToLocalMultiple(e);if(1===i.length){const e=48,t=i[0];i=[ee(t.x-e,t.y+e),ee(t.x+e,t.y-e),ee(t.x+e,t.y-e),ee(t.x-e,t.y+e)]}const r=[],o={x:i[0].x,y:i[0].y},s={x:i[1].x,y:i[1].y};if(n){const e=Math.round(s.x-o.x),t=Math.round(s.y-o.y);r.push(ee(o.x-e,o.y-t),ee(s.x,o.y-t),ee(s.x,s.y),ee(o.x-e,s.y))}else r.push(ee(o.x,o.y),ee(s.x,o.y),ee(s.x,s.y),ee(o.x,s.y));return ue(le([r.map((e=>t.localToMap(e))).filter(I.Ru)],t.spatialReference,t.doUnnormalization,!0),r,t)}(l,t,this.centered)),p.full=null!=p.circle?p.circle.geometry:p.rectangle?.geometry,p.outline="polygon"===p.full?.type?p.full:null;break}default:return null}return p}initializeGraphic(e){return(0,S.hA)()}onComplete(e){if(!this.drawOperation)return;this._updateGraphic();let t=null;if(this.drawOperation.isCompleted){const e=this._getCreateOperationGeometry({operationComplete:!0});null!=e&&(t=this._createOrUpdateGraphic(e.full))}this._createOperationGeometry=null,this.emit("complete",{graphic:t,...e})}onCursorUpdate(e){this._updateGraphic(),this.emit("cursor-update",e)}onDeactivate(){const{drawOperation:e}=this;e&&(e.isCompleted||e.cancel())}onOutlineChanged(e){return(0,S.hA)()}onCursorEdgeChanged(e){return(0,S.hA)()}onVertexAdd(e){Fe(this._tooltipsContext),this._updateGraphic(),function(e,t){const{drawOperation:n,view:i}=t,r=ze(t),o=je(t);if("2d"===i.type||!e||"absolute-height"!==o.mode||1!==n?.numCommittedVertices||!r||"draw-polyline"!==r.type&&"draw-polygon"!==r.type||r.elevation.locked)return;const[s,a,l]=e,c=function(e,t,n,i,r){const{view:o,drawOperation:s}=r;if("3d"!==o.type||!s)return;n??=0;const a=Ze(r),l=je(r),c=(0,_e.Fo)(o,e,t,n,a,l,i);return(0,Le.Qc)(c,a)??We(r)}(s,a,l,o,t);null!=c&&r.elevation.lock(c)}(e.vertices.at(0)?.coordinates,this._tooltipsContext),this.emit("vertex-add",e)}onVertexRemove(e){Fe(this._tooltipsContext),this._updateGraphic(),this.emit("vertex-remove",e)}onVertexUpdate(e){this._updateGraphic(),this.emit("vertex-update",e)}_updateGraphic(){const e=this._getCreateOperationGeometry();this._createOperationGeometry=e,null!=e?(null!=e.cursorEdge?this.addHandles(this.onCursorEdgeChanged(e.cursorEdge),et.activeEdge):this.removeHandles(et.activeEdge),null!=e.outline?this.addHandles(this.onOutlineChanged(e.outline),et.outline):this.removeHandles(et.outline),null!=e.committedVertices?this.addHandles(this.onRegularVerticesChanged(e.committedVertices),et.regularVertices):this.removeHandles(et.regularVertices),null!=e.cursorVertex?this.addHandles(this.onActiveVertexChanged(e.cursorVertex),et.activeVertex):this.removeHandles(et.activeVertex),null!=e.full?this._createOrUpdateGraphic(e.full):this.removeHandles(Je)):this._destroyAllVisualizations()}get activeTooltipInfo(){return this._coordinateFormatterLoadTask?.finished?ze(this._tooltipsContext):null}};(0,o._)([(0,u.MZ)()],Ke.prototype,"_coordinateFormatterLoadTask",void 0),(0,o._)([(0,u.MZ)()],Ke.prototype,"_createOperationGeometry",void 0),(0,o._)([(0,u.MZ)()],Ke.prototype,"_tooltipsContext",null),(0,o._)([(0,u.MZ)({value:!0})],Ke.prototype,"centered",null),(0,o._)([(0,u.MZ)()],Ke.prototype,"cursor",null),(0,o._)([(0,u.MZ)({nonNullable:!0})],Ke.prototype,"defaultZ",void 0),(0,o._)([(0,u.MZ)({constructOnly:!0})],Ke.prototype,"directionOptions",void 0),(0,o._)([(0,u.MZ)()],Ke.prototype,"drawOperation",void 0),(0,o._)([(0,u.MZ)({value:!0})],Ke.prototype,"enabled",null),(0,o._)([(0,u.MZ)({value:!0})],Ke.prototype,"forceUniformSize",null),(0,o._)([(0,u.MZ)({constructOnly:!0})],Ke.prototype,"geometryType",void 0),(0,o._)([(0,u.MZ)()],Ke.prototype,"graphic",null),(0,o._)([(0,u.MZ)({constructOnly:!0})],Ke.prototype,"graphicProperties",void 0),(0,o._)([(0,u.MZ)()],Ke.prototype,"graphicSymbol",null),(0,o._)([(0,u.MZ)({constructOnly:!0})],Ke.prototype,"hasZ",void 0),(0,o._)([(0,u.MZ)({constructOnly:!0})],Ke.prototype,"geometryToPlace",void 0),(0,o._)([(0,u.MZ)()],Ke.prototype,"mode",null),(0,o._)([(0,u.MZ)()],Ke.prototype,"snappingManager",void 0),(0,o._)([(0,u.MZ)()],Ke.prototype,"snapToScene",void 0),(0,o._)([(0,u.MZ)()],Ke.prototype,"tooltip",void 0),(0,o._)([(0,u.MZ)()],Ke.prototype,"tooltipInfos",void 0),(0,o._)([(0,u.MZ)({constructOnly:!0,type:Xe.A})],Ke.prototype,"sketchOptions",void 0),(0,o._)([(0,u.MZ)()],Ke.prototype,"updating",null),(0,o._)([(0,u.MZ)({constructOnly:!0,nonNullable:!0})],Ke.prototype,"view",void 0),(0,o._)([(0,u.MZ)({constructOnly:!0})],Ke.prototype,"undoRedo",null),(0,o._)([(0,u.MZ)()],Ke.prototype,"activeTooltipInfo",null),Ke=(0,o._)([(0,h.$)("esri.views.draw.DrawGraphicTool")],Ke);const Je=Symbol("create-operation-graphic"),et={outline:Symbol("outline-visual"),regularVertices:Symbol("regular-vertices-visual"),activeVertex:Symbol("active-vertex-visual"),activeEdge:Symbol("active-edge-visual")};function tt(e){switch(e){case"point":case"polyline":case"polygon":case"multipoint":return e;case"circle":case"rectangle":return"segment";case"mesh":return"point"}}const nt=48},85499:function(e,t,n){"use strict";n.d(t,{O0:function(){return F}});var i=n(53804),r=n(83525),o=n(48996),s=n(21609),a=n(95929),l=n(7213),c=n(60539),u=n(85876),h=n(28181),d=n(13520),p=n(23502),f=(n(58941),n(40633),n(65953)),g=n(72952),m=n(20248),_=n(42413),v=n(68945),y=n(65420);const b="click";class T{constructor({consumesClicks:e,grabbableForEvent:t}){this.events=new o.A,this.interactive=!0,this.selectable=!1,this.cursor=null,this.grabbable=!0,this.consumesClicks=e,this.grabbableForEvent=t}destroy(){}intersectionDistance(e,t){return 0}attach(){}detach(){}onElevationChange(){}onViewChange(){}}var x=n(50517),w=n(2831),S=n(2623),E=n(7819),A=n(92100),M=n(7768),O=n(50822),R=n(58144),C=n(45908),I=(n(13798),n(48961));let P=class extends r.A{constructor(e){super(e),this.constrainResult=e=>e,this._snapPoints=null,this._frameTask=null,this._abortController=null,this._stagedPoint=null,this._snap=(0,c.sg)((async(e,t,n,i)=>{const r=this._frameTask;if(null==r)return;const o=await r.schedule((()=>t.snap({...e,context:n,signal:i})),i);o.valid&&await r.schedule((()=>{this.stagedPoint=o.apply(),e!==this._snapPoints&&null!=this._snapPoints&&(this.stagedPoint=t.update({...this._snapPoints,context:n}))}),i)}))}get stagedPoint(){return this._stagedPoint}set stagedPoint(e){this._stagedPoint=this.constrainResult(e)}initialize(){const e="3d"===this.view.type?this.view?.resourceController?.scheduler:null;this._frameTask=null!=e?e.registerTask(I.W6.SNAPPING):I.nu}destroy(){this._abortController=(0,a.DC)(this._abortController),this._frameTask=(0,a.xt)(this._frameTask)}update(e,t,n){this._snapPoints=e;const{point:i,scenePoint:r}=e,o=t.update({point:i,scenePoint:r,context:n});return this.stagedPoint=o,o}async snap(e,t,n){const{point:i,scenePoint:r}=e;return this.stagedPoint=t.update({point:i,scenePoint:r,context:n}),this._snapPoints=e,null==this._abortController&&(this._abortController=new AbortController),this._snap(e,t,n,this._abortController.signal)}async snapAgainNearPreviousMapPoint(e,t){null!=this._snapPoints&&await this.snap(this._snapPoints,e,t)}abort(){this._abortController=(0,a.DC)(this._abortController),this._snapPoints=null}};(0,i._)([(0,p.MZ)({constructOnly:!0})],P.prototype,"view",void 0),(0,i._)([(0,p.MZ)()],P.prototype,"stagedPoint",null),(0,i._)([(0,p.MZ)()],P.prototype,"constrainResult",void 0),(0,i._)([(0,p.MZ)()],P.prototype,"_stagedPoint",void 0),P=(0,i._)([(0,f.$)("esri.views.interactive.snapping.SnappingOperation")],P);var D=n(44425);const L=Symbol(),N=Symbol();let F=class extends(o.A.EventedMixin(r.A)){constructor(e){super(e),this._createOperationCompleted=!1,this._hideDefaultCursor=!1,this._pointerDownStates=new u.A,this._stagedScreenPoint=null,this._stagedPointerType=null,this._updatingHandles=new m.U,this._stagedPointerId=null,this.constraintsEnabled=!1,this.constraints=void 0,this._getPointConstraint=(0,l.B)(M.cx),this._getPolylineOrPolygonConstraint=(0,l.B)(M.lJ),this.constraintZ=null,this.defaultZ=null,this.isDraped=!0,this.labelOptions=new O.A,this.cursor=null,this.loading=!1,this.snapToSceneEnabled=null,this.firstVertex=null,this.lastVertex=null,this.secondToLastVertex=null,null==e.elevationInfo&&(this.elevationInfo=(0,v.bK)(!!e.hasZ))}initialize(){const{geometryType:e,view:t}=this,n=t.spatialReference,i="viewingMode"in t.state?t.state.viewingMode:y.RT.Local,r="segment"===e||"multipoint"===e?"polyline":e;this.coordinateHelper=(0,x.BV)(this.hasZ,this.hasM,n),this._editGeometryOperations=new E.p(new S.ZE(r,this.coordinateHelper),i),this._snappingOperation=new P({view:t}),this.addHandles([(0,h.watch)((()=>({stagedPoint:this._snappingOperation.stagedPoint,constraint:this._constraint})),(({stagedPoint:e,constraint:t},n)=>{const{snappingOptions:i}=this;if(i&&(i.forceDisabled=null!=t&&(0,A.fT)(t)),null!=n&&e===n.stagedPoint&&t!==n.constraint)return this._onKeyboardBasedChange();this._processCursor(e??this._screenToMap(this._stagedScreenPoint))}),{equals:(e,t)=>e.stagedPoint===t.stagedPoint&&(0,a.CM)(e.constraint,t.constraint)}),(0,h.watch)((()=>this.view.viewpoint),((e,t)=>{e&&t&&(0,g.Ui)(e,t)&&this._onKeyboardBasedChange()}))]),this._activeComponent=new S.uA(n,i),this._editGeometryOperations.data.components.push(this._activeComponent);const o=this.segmentLabels;null!=o&&(o.context={view:t,editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,labelOptions:this.labelOptions},this.addHandles((0,h.watch)((()=>this.labelOptions.enabled),(e=>{o.visible=e}),h.pc))),this.addHandles(this._editGeometryOperations.on(["vertex-add","vertex-update","vertex-remove"],(e=>{const t=e.vertices.map((e=>({componentIndex:0,vertexIndex:e.index,coordinates:this.coordinateHelper.vectorToArray(e.pos)}))),n=t.map((e=>e.coordinates)),i=this.coordinateHelper.vectorToDehydratedPoint(this._activeComponent.getFirstVertex()?.pos)??null;(0,_.CI)(i,this.firstVertex)||(this.firstVertex=i);const r=this.coordinateHelper.vectorToDehydratedPoint(this._activeComponent.getLastVertex()?.pos)??null;(0,_.CI)(r,this.lastVertex)||(this.lastVertex=r);const o=this.coordinateHelper.vectorToDehydratedPoint(this._activeComponent.edges.at(-1)?.leftVertex?.pos)??null;switch((0,_.CI)(o,this.secondToLastVertex)||(this.secondToLastVertex=o),this._processCursor(this.cursorVertex),e.type){case"vertex-add":this.emit(e.type,{...e,added:n,vertices:t});break;case"vertex-update":this.emit(e.type,{...e,updated:n,vertices:t});break;case"vertex-remove":this.emit(e.type,{...e,removed:n,vertices:t})}})));const s=this._manipulator=new T({consumesClicks:!1,grabbableForEvent:e=>"click"!==this.drawingMode||"touch"===e.pointerType&&this._snappingEnabled&&1===this._pointerDownStates.size});this.manipulators.add(s),s.grabbable="point"!==e,this.addHandles([s.events.on("immediate-click",(e=>this._onImmediateClick(e))),s.events.on("immediate-double-click",(e=>this._onImmediateDoubleClick(e))),(0,h.watch)((()=>this.drawingMode),(()=>{this.removeHandles(L),this.addHandles(this._createManipulatorDragPipeline(s),L)}),h.pc),(0,h.watch)((()=>({effectiveCursor:this.effectiveCursor})),(({effectiveCursor:e})=>{s.cursor=e}),h.pc)]),(0,D.BY)(this,(()=>{const e=this.view.inputManager.latestPointerType??"mouse",t=this._getSnappingContext(e);if(null!=this.snappingManager){const e=this._snappingOperation.snapAgainNearPreviousMapPoint(this.snappingManager,t);this._updatingHandles.addPromise((0,c.QZ)(e))}}))}destroy(){(0,a.pR)(this.segmentLabels),(0,a.pR)(this._snappingOperation),this._editGeometryOperations=(0,a.pR)(this._editGeometryOperations),this._updatingHandles.destroy()}get _isDragging(){const{_stagedPointerId:e,_manipulator:t}=this;return null!=e&&this._pointerDownStates.has(e)||t.grabbing||!t.interactive}get _snappingEnabled(){return null!=this.snappingManager&&this.snappingManager.options.effectiveEnabled}get _requiresScenePoint(){const e=this._updateAndGetEffectiveDrawSurface();return"3d"===this.view.type&&this.drawSurface!==e}get canRedo(){return this._editGeometryOperations.canRedo}get canUndo(){return this._editGeometryOperations.canUndo}get committedVertices(){return this._activeComponent.vertices.map((e=>this.coordinateHelper.vectorToArray(e.pos)))}get _constraint(){const{constraints:e,constraintsEnabled:t}=this;if(e&&t)switch(this.geometryType){case"point":return this._getPointConstraint(e);case"polygon":case"polyline":return this._getPolylineOrPolygonConstraint(this.lastVertex,this.secondToLastVertex,e)}}set drawingMode(e){this._set("drawingMode",e??b)}get effectiveCursor(){return this.loading?"progress":this._hideDefaultCursor?null:this.cursor||"crosshair"}get interactive(){return this._manipulator.interactive}set interactive(e){this._manipulator.interactive=e}get isCompleted(){return this._createOperationCompleted}get numCommittedVertices(){return this._activeComponent.vertices.length}get snappingOptions(){return null!=this.snappingManager?this.snappingManager.options:null}get cursorVertex(){return this._get("cursorVertex")}get visualizationCursorVertex(){return"mouse"===this._stagedPointerType?this.cursorVertex:null}get committableVertex(){const{cursorVertex:e,lastVertex:t,firstVertex:n,geometryType:i}=this;return"polygon"===i&&(0,_.fk)(e,n)||(0,_.fk)(e,t)?null:e}get updating(){return this._updatingHandles.updating}get geometryIncludingUncommittedVertices(){const{committedVertices:e,committableVertex:t,coordinateHelper:n}=this,i=e.slice();return null!=t&&i.push(n.pointToArray(t)),i}cancel(){this.complete({aborted:!0})}commitStagedVertex(){this._snappingOperation.abort();const{committableVertex:e}=this;null!=e&&this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(e))}complete(e){const t=e?.aborted||!1;this._snappingOperation.abort(),this.snappingManager?.doneSnapping();const{geometryType:n,numCommittedVertices:i}=this,r="multipoint"===n&&0===i||"polyline"===n&&i<2||"polygon"===n&&i<3;"segment"!==n&&"point"!==n||this.commitStagedVertex(),this._createOperationCompleted=!r,(this.isCompleted||t)&&(this._stagedScreenPoint=null,this._stagedPointerId=null,this._stagedPointerType=null,this._processCursor(null),this.emit("complete",{vertices:this.committedVertices.map(((e,t)=>({componentIndex:0,vertexIndex:t,coordinates:e}))),aborted:t,type:"complete"}))}onInputEvent(e){switch(e.type){case"pointer-down":this._pointerDownStates.add(e.pointerId);break;case"pointer-up":this._pointerDownStates.delete(e.pointerId)}switch(e.type){case"pointer-move":return this._onPointerMove(e);case"hold":return this._onHold(e)}}redo(){this._editGeometryOperations.redo()}undo(){null!=this.snappingManager&&this.snappingManager.doneSnapping(),this._editGeometryOperations.undo()}_processCursor(e){const t=(0,s.o8)(this.cursorVertex),n=(0,s.o8)(e),i=n&&(this._updateAndGetEffectiveDrawSurface()?.constrainZ(n)??n),r=this._snapToClosingVertex(i),o=this._applyConstraints(r);(0,_.fk)(t,o)||(this._set("cursorVertex",o),this.segmentLabels?.set("stagedVertex",null!=o?this.coordinateHelper.pointToVector(o):null),null==o||"mouse"!==this._stagedPointerType?this.emit("cursor-remove"):this.emit("cursor-update",{updated:null,vertices:[{componentIndex:0,vertexIndex:this._activeComponent.vertices.length,coordinates:this.coordinateHelper.pointToArray(o)}],operation:"apply",type:"vertex-update"}))}_snapToClosingVertex(e){if(null==e||this._isDragging||"polygon"!==this.geometryType||this.numCommittedVertices<=2)return e;const t=this._mapToScreen(e);if(!t)return e;const n=this._activeComponent;return this._vertexWithinPointerDistance(n.vertices[0].pos,t)?this.firstVertex:this._vertexWithinPointerDistance(n.vertices.at(-1).pos,t)?this.lastVertex:e}_createManipulatorDragPipeline(e){switch(this.drawingMode){case"click":return this._createManipulatorDragPipelineClick(e);case"freehand":return this._createManipulatorDragPipelineFreehand(e);case"hybrid":return this._createManipulatorDragPipelineHybrid(e)}}_createManipulatorDragPipelineClick(e){return(0,w.Xt)(e,((e,t,n,i)=>{const r="touch"===i&&this._snappingEnabled;if(this.isCompleted||!r)return;const{snappingStep:o,cancelSnapping:s}=(0,C.L)({predicate:()=>r,snappingManager:this.snappingManager,snappingContext:new R.e({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,feature:this.graphic,pointer:i,visualizer:this.snappingVisualizer,drawConstraints:this.constraints}),updatingHandles:this._updatingHandles,useZ:!this._requiresScenePoint});n=n.next((e=>(r&&null!=this.snappingManager&&this.snappingManager.doneSnapping(),e))).next(s),t.next(this._screenToMapDragEventStep()).next((e=>("start"===e.action&&(this._processCursor(e.mapStart),("segment"===this.geometryType||r&&!this.numCommittedVertices)&&this.commitStagedVertex()),e))).next((0,w.pg)(this.view,this.elevationInfo)).next(...o).next((e=>(r&&(this._processCursor(e.mapEnd),"end"===e.action&&this.commitStagedVertex()),e))).next((e=>("end"===e.action&&("mouse"!==this._stagedPointerType&&this._snappingOperation.abort(),"segment"!==this.geometryType&&"point"!==this.geometryType||this.complete()),e)))}))}_createManipulatorDragPipelineFreehand(e){return(0,w.Xt)(e,((e,t)=>{this.isCompleted||t.next(this._screenToMapDragEventStep()).next((e=>("start"===e.action&&(this._snappingOperation.abort(),null==this.committableVertex&&this._processCursor(e.mapStart),"segment"===this.geometryType&&this.commitStagedVertex()),e))).next((e=>{switch(e.action){case"start":case"update":this._processCursor(e.mapEnd),"polygon"!==this.geometryType&&"polyline"!==this.geometryType||this.commitStagedVertex();break;case"end":this.complete()}return e}))}))}_createManipulatorDragPipelineHybrid(e){return(0,w.Xt)(e,((e,t)=>{this.isCompleted||t.next(this._screenToMapDragEventStep()).next((e=>("start"===e.action&&(this._snappingOperation.abort(),this.addHandles(this._editGeometryOperations.createUndoGroup(),N),this._processCursor(e.mapStart),this.commitStagedVertex()),e))).next((e=>{switch(e.action){case"start":case"update":this._processCursor(e.mapEnd),"polygon"!==this.geometryType&&"polyline"!==this.geometryType||this.commitStagedVertex();break;case"end":"mouse"!==this._stagedPointerType&&this._snappingOperation.abort(),this.removeHandles(N),"segment"!==this.geometryType&&"point"!==this.geometryType||this.complete()}return e}))}))}get _drawAtFixedElevation(){const{constraintsEnabled:e,constraintZ:t,geometryType:n,numCommittedVertices:i}=this;return e?null!=t||"segment"===n&&i>0:("segment"===n||"polygon"===n)&&i>0}_updateAndGetEffectiveDrawSurface(){const{constraintsEnabled:e,coordinateHelper:t,drawSurface:n,elevationDrawSurface:i,snapToSceneEnabled:r}=this;if(null==i)return n;if(!this.hasZ)return i.defaultZ=null,i;const o=this.elevationInfo?.mode;let s=this.defaultZ,a=e||"absolute-height"===o;return null!=r&&(a=r),"on-the-ground"===o&&(a=!1),this._drawAtFixedElevation&&(s=(e?this.constraintZ:null)??t.getZ(this._activeComponent.vertices[0].pos),a=!1),a?n:(i.defaultZ=s,i)}_mapToScreen(e){return this._updateAndGetEffectiveDrawSurface()?.mapToScreen(e)}_onHold(e){this._snappingOperation.abort(),"click"===this.drawingMode&&"touch"===e.pointerType&&this._snappingEnabled&&this._processCursor(e.mapPoint),e.stopPropagation()}_onImmediateClick(e){if(!("mouse"===e.pointerType&&2===e.button||this._manipulator.dragging))try{const{drawingMode:t,geometryType:n}=this;this._stagedPointerType=e.pointerType,this._stagedScreenPoint=e.screenPoint;const i=this._screenToMap(e.screenPoint);if(null==i)return;if(null==i||"freehand"===t&&"point"!==n)return;if(this._snappingEnabled&&null!=this.cursorVertex||this._processCursor(i),null==this.committableVertex)return void this.complete();this.commitStagedVertex(),"mouse"!==e.pointerType&&this._processCursor(null),("freehand"===t||"point"===n||"segment"===n&&2===this.numCommittedVertices||"segment"===n&&"hybrid"===t&&1===this.numCommittedVertices)&&this.complete()}finally{e.stopPropagation()}}_onImmediateDoubleClick(e){this._manipulator.dragging||"point"===this.geometryType||(this.complete(),e.stopPropagation())}_onPointerMove(e){const t=(0,d.tc)(e.x,e.y);this._stagedScreenPoint=t,this._stagedPointerType=e.pointerType,this._stagedPointerId=e.pointerId,this._isDragging?this._snappingOperation.abort():(e.stopPropagation(),this._processCursorMovementRelativeToSurface(t,e.pointerType))}_onKeyboardBasedChange(){"mouse"===this._stagedPointerType&&this._stagedScreenPoint&&null!=this._stagedPointerId&&!this._isDragging?this._processCursorMovementRelativeToSurface(this._stagedScreenPoint,this._stagedPointerType):this._snappingOperation.abort()}_processCursorMovementRelativeToSurface(e,t){const n=this._snappingOperation,i=this._screenToMap(e),r=this._requiresScenePoint?this.drawSurface?.screenToMap(e):null;if(null==i)return this._hideDefaultCursor=!0,this._processCursor(null),void n.abort();this._hideDefaultCursor=!1;const o=this.snappingManager;if(null==o)return this._processCursor(i),void n.abort();const s=this._getSnappingContext(t);this._updatingHandles.addPromise((0,c.QZ)(n.snap({point:i,scenePoint:r},o,s)))}_applyConstraints(e){const{_constraint:t,constraints:n}=this;if(!e||!n||!t)return e;const{context:i}=n,r=(0,M.dz)(e,i),o=r?t.closestTo(r):void 0;if(!o)return e;const s=(0,M.tC)(o,e,i),a="2d"===this.view.type||"absolute-height"!==i.elevationInfo.mode;return null!=s&&a&&null!=this.constraintZ&&this.hasZ&&(s.z=this.constraintZ),s}_screenToMap(e){return e?this._updateAndGetEffectiveDrawSurface()?.screenToMap(e):null}_screenToMapDragEventStep(){let e=null;return t=>{if("start"===t.action&&(e=this._screenToMap(t.screenStart)),null==e)return null;const n=this._screenToMap(t.screenEnd);return null!=n?{...t,mapStart:e,mapEnd:n}:null}}_vertexWithinPointerDistance(e,t){const n=this._mapToScreen(this.coordinateHelper.vectorToDehydratedPoint(e));return null!=n&&function(e,t){const n=e.x-t.x,i=e.y-t.y;return n*n+i*i<=25}(n,t)}_getSnappingContext(e){const t=this._drawAtFixedElevation?this.elevationDrawSurface?.defaultZ:null;return new R.e({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:e,feature:this.graphic,visualizer:this.snappingVisualizer,selfSnappingZ:null!=t?{value:t,elevationInfo:this.elevationInfo}:null,drawConstraints:this.constraints})}};(0,i._)([(0,p.MZ)()],F.prototype,"_hideDefaultCursor",void 0),(0,i._)([(0,p.MZ)()],F.prototype,"_stagedPointerId",void 0),(0,i._)([(0,p.MZ)()],F.prototype,"_isDragging",null),(0,i._)([(0,p.MZ)()],F.prototype,"_snappingOperation",void 0),(0,i._)([(0,p.MZ)()],F.prototype,"_snappingEnabled",null),(0,i._)([(0,p.MZ)({constructOnly:!0})],F.prototype,"graphic",void 0),(0,i._)([(0,p.MZ)()],F.prototype,"constraintsEnabled",void 0),(0,i._)([(0,p.MZ)()],F.prototype,"constraints",void 0),(0,i._)([(0,p.MZ)()],F.prototype,"_constraint",null),(0,i._)([(0,p.MZ)()],F.prototype,"constraintZ",void 0),(0,i._)([(0,p.MZ)()],F.prototype,"defaultZ",void 0),(0,i._)([(0,p.MZ)()],F.prototype,"isDraped",void 0),(0,i._)([(0,p.MZ)({value:b})],F.prototype,"drawingMode",null),(0,i._)([(0,p.MZ)({constructOnly:!0})],F.prototype,"elevationDrawSurface",void 0),(0,i._)([(0,p.MZ)({constructOnly:!0})],F.prototype,"elevationInfo",void 0),(0,i._)([(0,p.MZ)({constructOnly:!0,type:O.A})],F.prototype,"labelOptions",void 0),(0,i._)([(0,p.MZ)({constructOnly:!0})],F.prototype,"geometryType",void 0),(0,i._)([(0,p.MZ)({constructOnly:!0})],F.prototype,"hasM",void 0),(0,i._)([(0,p.MZ)({constructOnly:!0})],F.prototype,"hasZ",void 0),(0,i._)([(0,p.MZ)()],F.prototype,"cursor",void 0),(0,i._)([(0,p.MZ)()],F.prototype,"effectiveCursor",null),(0,i._)([(0,p.MZ)()],F.prototype,"loading",void 0),(0,i._)([(0,p.MZ)({constructOnly:!0})],F.prototype,"manipulators",void 0),(0,i._)([(0,p.MZ)({constructOnly:!0})],F.prototype,"drawSurface",void 0),(0,i._)([(0,p.MZ)({constructOnly:!0})],F.prototype,"segmentLabels",void 0),(0,i._)([(0,p.MZ)({constructOnly:!0})],F.prototype,"snappingManager",void 0),(0,i._)([(0,p.MZ)({constructOnly:!0})],F.prototype,"snappingVisualizer",void 0),(0,i._)([(0,p.MZ)()],F.prototype,"snapToSceneEnabled",void 0),(0,i._)([(0,p.MZ)({readOnly:!0})],F.prototype,"cursorVertex",null),(0,i._)([(0,p.MZ)({readOnly:!0})],F.prototype,"visualizationCursorVertex",null),(0,i._)([(0,p.MZ)()],F.prototype,"committableVertex",null),(0,i._)([(0,p.MZ)()],F.prototype,"firstVertex",void 0),(0,i._)([(0,p.MZ)()],F.prototype,"lastVertex",void 0),(0,i._)([(0,p.MZ)()],F.prototype,"secondToLastVertex",void 0),(0,i._)([(0,p.MZ)()],F.prototype,"updating",null),(0,i._)([(0,p.MZ)({constructOnly:!0})],F.prototype,"view",void 0),F=(0,i._)([(0,f.$)("esri.views.draw.DrawOperation")],F)},99113:function(e,t,n){"use strict";n.d(t,{IX:function(){return u},rT:function(){return c},uF:function(){return h}}),n(50917);var i=n(13520),r=n(46460),o=n(45328),s=n(68945),a=n(57165),l=n(45532);class c{constructor(e,t,n,i=null){this._elevationInfo=e,this.defaultZ=t,this._view=n,this._excludeGraphics=i}screenToMap(e){const{defaultZ:t,_view:n}=this,r=n.sceneIntersectionHelper.intersectElevationFromScreen((0,i.gs)(e.x,e.y),this._elevationInfo,t??0,this._excludeGraphics);return null==t&&null!=r&&(r.z=void 0),r}mapToScreen(e){const t=(0,r.T)(e.x,e.y,(0,s.wS)(this._view,e,this._elevationInfo),e.spatialReference);return this._view.toScreen(t)}constrainZ(e){const{defaultZ:t}=this;return null!=t&&e.z!==t&&((e=(0,o.EL)(e)).z=t),e}}class u{constructor(e,t,n=[]){this.view=e,this.elevationInfo=t,this.exclude=n}screenToMap(e){const t=this.view.toMap(e,{exclude:this.exclude,excludeLabels:!0});return null!=t&&(t.z=(0,s.id)(t,this.view,this.elevationInfo)),t}mapToScreen(e){let t=e;return null!=this.elevationInfo&&(t=(0,r.T)(e.x,e.y,(0,s.wS)(this.view,e,this.elevationInfo),e.spatialReference)),this.view.toScreen(t)}constrainZ(e){return e}}class h{constructor(e,t=!1,n=0){this.view=e,this.hasZ=t,this.defaultZ=n,this.mapToScreen=t=>e.toScreen(t),this.screenToMap=t?t=>{const i=e.toMap(t);return i.z=n,i}:t=>e.toMap(t)}constrainZ(e){const{defaultZ:t}=this;return this.hasZ&&e.z!==t&&((e=(0,o.EL)(e)).z=t),e}}class d{screenToMap(e){const{x:t,y:n}=e;return new l.default({x:t,y:n,spatialReference:d.spatialReference})}mapToScreen(e){return(0,i.tc)(e.x,e.y)}constrainZ(e){return e}}d.spatialReference=new a.A},71168:function(e,t,n){"use strict";var i;n.d(t,{w:function(){return i}}),function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right"}(i||(i={}))},82067:function(e,t,n){"use strict";n.d(t,{l:function(){return b}});var i=n(53804),r=n(83525),o=n(48996),s=n(28181),a=n(13520),l=n(23502),c=(n(58941),n(40633),n(13798),n(65953)),u=n(13786),h=n(20551),d=n(32501),p=n(46157),f=n(56763),g=n(68945),m=n(74661),_=n(6422),v=n(17921),y=n(33383);let b=class extends r.A{set graphic(e){this._circleCollisionCache=null,this._originalSymbol=e.symbol,this._set("graphic",e),this.attachSymbolChanged()}get elevationInfo(){const{layer:e}=this.graphic,t=e&&"elevationInfo"in e?e.elevationInfo:null,n=(0,g.ky)(this.graphic),i=t?t.offset:0;return new _.A({mode:n,offset:i})}set focusedSymbol(e){e!==this._get("focusedSymbol")&&(this._set("focusedSymbol",e),this._updateGraphicSymbol(),this._circleCollisionCache=null)}grabbableForEvent(){return!0}set grabbing(e){e!==this._get("grabbing")&&(this._set("grabbing",e),this._updateGraphicSymbol())}set hovering(e){e!==this._get("hovering")&&(this._set("hovering",e),this._updateGraphicSymbol())}set selected(e){e!==this._get("selected")&&(this._set("selected",e),this._updateGraphicSymbol(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}get _focused(){return this._get("hovering")||this._get("grabbing")}constructor(e){super(e),this.layer=null,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.dragging=!1,this.cursor=null,this.consumesClicks=!0,this.events=new o.A.EventEmitter,this._circleCollisionCache=null,this._graphicSymbolChangedHandle=null,this._originalSymbol=null}destroy(){this.detachSymbolChanged(),this._resetGraphicSymbol(),this._set("view",null)}intersectionDistance(e){const t=this.graphic;if(!1===t.visible)return null;const n=t.geometry;if(null==n)return null;const i=this._get("focusedSymbol"),r=null!=i?i:t.symbol;return"2d"===this.view.type?this._intersectDistance2D(this.view,e,n,r):this._intersectDistance3D(this.view,e,t)}attach(){this.attachSymbolChanged(),null!=this.layer&&this.layer.add(this.graphic)}detach(){this.detachSymbolChanged(),this._resetGraphicSymbol(),null!=this.layer&&this.layer.remove(this.graphic)}attachSymbolChanged(){this.detachSymbolChanged(),this._graphicSymbolChangedHandle=(0,s.watch)((()=>this.graphic?.symbol),(e=>{null!=e&&e!==this.focusedSymbol&&e!==this._originalSymbol&&(this._originalSymbol=e,this._focused&&null!=this.focusedSymbol&&(this.graphic.symbol=this.focusedSymbol))}),s.OH)}detachSymbolChanged(){null!=this._graphicSymbolChangedHandle&&(this._graphicSymbolChangedHandle.remove(),this._graphicSymbolChangedHandle=null)}onElevationChange(){}onViewChange(){}_updateGraphicSymbol(){this.graphic.symbol=this._focused&&null!=this.focusedSymbol?this.focusedSymbol:this._originalSymbol}_resetGraphicSymbol(){this.graphic.symbol=this._originalSymbol}_intersectDistance2D(e,t,n,i){if(null==(i=i||(0,m.SF)(n)))return null;let r=this._circleCollisionCache;if("point"===n.type&&"cim"===i.type&&"CIMPointSymbol"===i.data.symbol?.type&&i.data.symbol.symbolLayers){const{offsetX:r,offsetY:o,size:s}=(0,v.T)(i),l=(0,a.WA)(t,x),c=s/2,h=e.toScreen(n),d=h.x+r,p=h.y+o;return(0,u.hG)(l,[d,p])<c*c?1:null}if("point"!==n.type||"simple-marker"!==i.type)return(0,y.t)(t,n,e)?1:null;if(null==r||!r.originalPoint.equals(n)){const t=n,o=e.spatialReference;if((0,p.canProjectWithoutEngine)(t.spatialReference,o)){const e=(0,p.project)(t,o);r={originalPoint:t.clone(),mapPoint:e,radiusPx:(0,a.Lz)(i.size)},this._circleCollisionCache=r}}if(null!=r){const n=(0,a.WA)(t,x),o=e.toScreen?.(r.mapPoint);if(!o)return null;const s=r.radiusPx,l=o.x+(0,a.Lz)(i.xoffset),c=o.y-(0,a.Lz)(i.yoffset);return(0,u.hG)(n,[l,c])<s*s?1:null}return null}_intersectDistance3D(e,t,n){const i=e.toMap(t,{include:[n]});return i&&(0,f.g)(i,T,e.renderSpatialReference)?(0,h.j)(T,e.state.camera.eye):null}};(0,i._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],b.prototype,"graphic",null),(0,i._)([(0,l.MZ)()],b.prototype,"elevationInfo",null),(0,i._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],b.prototype,"view",void 0),(0,i._)([(0,l.MZ)({value:null})],b.prototype,"focusedSymbol",null),(0,i._)([(0,l.MZ)({constructOnly:!0})],b.prototype,"layer",void 0),(0,i._)([(0,l.MZ)()],b.prototype,"interactive",void 0),(0,i._)([(0,l.MZ)()],b.prototype,"selectable",void 0),(0,i._)([(0,l.MZ)()],b.prototype,"grabbable",void 0),(0,i._)([(0,l.MZ)({value:!1})],b.prototype,"grabbing",null),(0,i._)([(0,l.MZ)()],b.prototype,"dragging",void 0),(0,i._)([(0,l.MZ)()],b.prototype,"hovering",null),(0,i._)([(0,l.MZ)({value:!1})],b.prototype,"selected",null),(0,i._)([(0,l.MZ)()],b.prototype,"cursor",void 0),b=(0,i._)([(0,c.$)("esri.views.interactive.GraphicManipulator")],b);const T=(0,d.vt)(),x=(0,a.gs)()},83202:function(e,t,n){"use strict";n.d(t,{g:function(){return p}});var i,r,o=n(53804),s=n(83525),a=(n(58941),n(40633),n(60539)),l=n(23502),c=(n(13798),n(65953)),u=n(53551),h=n(78879);(r=i||(i={}))[r.WhenToolEditable=0]="WhenToolEditable",r[r.WhenToolNotEditable=1]="WhenToolNotEditable",r[r.Always=2]="Always";class d{constructor(){this._isToolEditable=!0,this._manipulators=new h.A,this._resourceContexts={manipulator3D:{}},this._attached=!1}set isToolEditable(e){this._isToolEditable=e}get length(){return this._manipulators.length}add(e,t=i.WhenToolEditable){this.addMany([e],t)}addMany(e,t=i.WhenToolEditable){for(const n of e){const e={manipulator:n,visibilityPredicate:t,attached:!1};this._manipulators.add(e),this._attached&&this._updateManipulatorAttachment(e)}}remove(e){for(let t=0;t<this._manipulators.length;t++)if(this._manipulators.at(t).manipulator===e){const e=this._manipulators.splice(t,1)[0];this._detachManipulator(e);break}}removeAll(){this._manipulators.forEach((e=>{this._detachManipulator(e)})),this._manipulators.removeAll()}attach(){this._manipulators.forEach((e=>{this._updateManipulatorAttachment(e)})),this._attached=!0}detach(){this._manipulators.forEach((e=>{this._detachManipulator(e)})),this._attached=!1}destroy(){this.detach(),this._manipulators.forEach((({manipulator:e})=>e.destroy())),this._manipulators.destroy(),this._resourceContexts=null}on(e,t){return this._manipulators.on(e,(e=>{t(e)}))}forEach(e){for(const t of this._manipulators.items)e(t)}some(e){return this._manipulators.items.some(e)}toArray(){const e=[];return this.forEach((t=>e.push(t.manipulator))),e}intersect(e,t){let n=null,i=Number.MAX_VALUE;return this._manipulators.forEach((({manipulator:r,attached:o})=>{if(!o||!r.interactive)return;const s=r.intersectionDistance(e,t);null!=s&&s<i&&(i=s,n=r)})),n}_updateManipulatorAttachment(e){this._isManipulatorItemVisible(e)?this._attachManipulator(e):this._detachManipulator(e)}_attachManipulator(e){e.attached||(e.manipulator.attach&&e.manipulator.attach(this._resourceContexts),e.attached=!0)}_detachManipulator(e){if(!e.attached)return;const t=e.manipulator;t.grabbing=!1,t.dragging=!1,t.hovering=!1,t.selected=!1,t.detach&&t.detach(this._resourceContexts),e.attached=!1}_isManipulatorItemVisible(e){return e.visibilityPredicate===i.Always||(this._isToolEditable?e.visibilityPredicate===i.WhenToolEditable:e.visibilityPredicate===i.WhenToolNotEditable)}}let p=class extends s.A{constructor(e){super(e),this.manipulators=new d,this.automaticManipulatorSelection=!0,this.hasGrabbedManipulators=!1,this.hasHoveredManipulators=!1,this.firstGrabbedManipulator=null,this.created=!1,this.removeIncompleteOnCancel=!0,this._editableFlags=new Map([[u.PK.MANAGER,!0],[u.PK.USER,!0]]),this._creationFinishedResolver=(0,a.Tw)()}get active(){return null!=this.view&&this.view.activeTool===this}set visible(e){this._get("visible")!==e&&(this._set("visible",e),this._syncVisible())}get editable(){return this.getEditableFlag(u.PK.USER)}set editable(e){this.setEditableFlag(u.PK.USER,e)}get updating(){return!1}get cursor(){return null}get hasFocusedManipulators(){return this.hasGrabbedManipulators||this.hasHoveredManipulators}destroy(){this.manipulators.destroy(),this._set("view",null)}onAdd(){this._syncVisible()}activate(){null!=this.view&&(this.view.focus(),this.onActivate())}deactivate(){this.onDeactivate()}handleInputEvent(e){this.onInputEvent(e)}handleInputEventAfter(e){this.onInputEventAfter(e)}setEditableFlag(e,t){this._editableFlags.set(e,t),this.manipulators.isToolEditable=this.internallyEditable,this._updateManipulatorAttachment(),e===u.PK.USER&&this.notifyChange("editable"),this.onEditableChange(),this.onManipulatorSelectionChanged()}getEditableFlag(e){return this._editableFlags.get(e)??!1}endDrag(){const e=this.view.inputManager.latestPointerLocation;if(!e)return;let t=!1;this.manipulators.forEach((({manipulator:n})=>{n.dragging&&(t=!0,n.events.emit("drag",{action:"end",start:e,screenPoint:e}))})),t&&(this.view.toolViewManager.activeTool=null)}whenCreated(){return this._creationFinishedResolver.promise}onManipulatorSelectionChanged(){}onActivate(){}onDeactivate(){}onShow(){}onHide(){}onEditableChange(){}onInputEvent(e){}onInputEventAfter(e){}get internallyEditable(){return this.getEditableFlag(u.PK.USER)&&this.getEditableFlag(u.PK.MANAGER)}finishToolCreation(){this.created||this._creationFinishedResolver.resolve(this),this._set("created",!0)}_syncVisible(){if(this.initialized)if(this.visible)this._show();else if(this._hide(),this.active)return void(this.view.activeTool=null)}_show(){this._updateManipulatorAttachment(),this.onShow()}_hide(){this._updateManipulatorAttachment(),this.onHide()}_updateManipulatorAttachment(){this.visible?this.manipulators.attach():this.manipulators.detach()}};(0,o._)([(0,l.MZ)({constructOnly:!0})],p.prototype,"view",void 0),(0,o._)([(0,l.MZ)({readOnly:!0})],p.prototype,"active",null),(0,o._)([(0,l.MZ)({value:!0})],p.prototype,"visible",null),(0,o._)([(0,l.MZ)({value:!0})],p.prototype,"editable",null),(0,o._)([(0,l.MZ)({readOnly:!0})],p.prototype,"manipulators",void 0),(0,o._)([(0,l.MZ)({readOnly:!0})],p.prototype,"updating",null),(0,o._)([(0,l.MZ)()],p.prototype,"cursor",null),(0,o._)([(0,l.MZ)({readOnly:!0})],p.prototype,"automaticManipulatorSelection",void 0),(0,o._)([(0,l.MZ)()],p.prototype,"hasFocusedManipulators",null),(0,o._)([(0,l.MZ)()],p.prototype,"hasGrabbedManipulators",void 0),(0,o._)([(0,l.MZ)()],p.prototype,"hasHoveredManipulators",void 0),(0,o._)([(0,l.MZ)()],p.prototype,"firstGrabbedManipulator",void 0),(0,o._)([(0,l.MZ)({readOnly:!0})],p.prototype,"created",void 0),(0,o._)([(0,l.MZ)({readOnly:!0})],p.prototype,"removeIncompleteOnCancel",void 0),p=(0,o._)([(0,c.$)("esri.views.interactive.InteractiveToolBase")],p)},50517:function(e,t,n){"use strict";n.d(t,{BV:function(){return g}});var i,r,o=n(13786),s=n(1932),a=n(20551),l=n(32501),c=n(33400),u=n(41546),h=n(45532);(r=i||(i={}))[r.Z=0]="Z",r[r.M=1]="M";class d{constructor(e){this.spatialReference=e}createVector(){return this._tag((0,s.vt)())}pointToVector(e){return this._tag((0,s.fA)(e.x,e.y))}arrayToVector(e){return this._tag((0,s.fA)(e[0],e[1]))}vectorToArray(e){return[e[0],e[1]]}pointToArray(e){return[e.x,e.y]}vectorToPoint(e,t=new h.default){return t.x=e[0],t.y=e[1],t.z=void 0,t.m=void 0,t.spatialReference=this.spatialReference,t}arrayToPoint(e,t=new h.default){return t.x=e[0],t.y=e[1],t.z=void 0,t.m=void 0,t.spatialReference=this.spatialReference,t}vectorToDehydratedPoint(e,t){if(e)return t??={x:void 0,y:void 0,z:void 0,m:void 0,hasZ:void 0,hasM:void 0,spatialReference:void 0,type:"point"},t.x=e[0],t.y=e[1],t.z=void 0,t.m=void 0,t.hasZ=!1,t.hasM=!1,t.spatialReference=this.spatialReference,t}lerp(e,t,n,i){return(0,o.Cc)(i,e,t,n)}addDelta(e,t,n){e[0]+=t,e[1]+=n}distance(e,t){return(0,o.Io)(e,t)}getZ(e,t=void 0){return t}hasZ(){return!1}getM(e,t=void 0){return t}hasM(){return!1}clone(e){return this._tag((0,s.ci)(e))}copy(e,t){return(0,o.C)(t,e)}fromXYZ(e){return this._tag((0,s.fA)(e[0],e[1]))}toXYZ(e,t=(0,l.vt)()){return(0,a.i)(t,e[0],e[1],0)}pointToXYZ(e,t=(0,l.vt)()){return(0,a.i)(t,e.x,e.y,0)}equals(e,t){return(0,o.aI)(e,t)}_tag(e){return e}}class p{constructor(e,t){this._valueType=e,this.spatialReference=t}createVector(){return this._tag((0,l.vt)())}pointToVector(e){return this._tag((0,l.fA)(e.x,e.y,this._valueType===i.Z?e.z:e.m))}arrayToVector(e){return this._tag((0,l.fA)(e[0],e[1],e[2]||0))}vectorToArray(e){return[e[0],e[1],e[2]]}pointToArray(e){return this._valueType===i.Z?[e.x,e.y,e.z]:[e.x,e.y,e.m]}vectorToPoint(e,t=new h.default){return t.x=e[0],t.y=e[1],t.z=this._valueType===i.Z?e[2]:void 0,t.m=this._valueType===i.M?e[2]:void 0,t.spatialReference=this.spatialReference,t}arrayToPoint(e,t=new h.default){return t.x=e[0],t.y=e[1],t.z=this._valueType===i.Z?e[2]:void 0,t.m=this._valueType===i.M?e[2]:void 0,t.spatialReference=this.spatialReference,t}vectorToDehydratedPoint(e,t){if(!e)return;t??={x:void 0,y:void 0,z:void 0,m:void 0,hasZ:void 0,hasM:void 0,spatialReference:void 0,type:"point"};const n=this._valueType===i.Z,r=this._valueType===i.M;return t.x=e[0],t.y=e[1],t.z=n?e[2]:void 0,t.m=r?e[2]:void 0,t.hasZ=n,t.hasM=r,t.spatialReference=this.spatialReference,t}lerp(e,t,n,i){return(0,a.m)(i,e,t,n)}addDelta(e,t,n,r){e[0]+=t,e[1]+=n,this._valueType===i.Z&&(e[2]+=r)}distance(e,t){return this._valueType===i.Z?(0,a.j)(e,t):(0,o.Io)(e,t)}getZ(e,t=void 0){return this._valueType===i.Z?e[2]:t}hasZ(){return this._valueType===i.Z}getM(e,t=void 0){return this._valueType===i.M?e[2]:t}hasM(){return this._valueType===i.M}clone(e){return this._tag((0,l.ci)(e))}copy(e,t){return(0,a.c)(t,e)}fromXYZ(e,t=0,n=0){return this._tag((0,l.fA)(e[0],e[1],this._valueType===i.Z?e.length>2?e[2]:t:n))}toXYZ(e,t=(0,l.vt)()){return(0,a.i)(t,e[0],e[1],this._valueType===i.Z?e[2]:0)}pointToXYZ(e,t=(0,l.vt)()){return(0,a.i)(t,e.x,e.y,this._valueType===i.Z?e.z??0:0)}equals(e,t){return(0,a.H)(e,t)}_tag(e){return e}}class f{constructor(e){this.spatialReference=e}createVector(){return this._tag((0,u.vt)())}pointToVector(e){return this._tag((0,u.fA)(e.x,e.y,e.z,e.m))}arrayToVector(e){return this._tag((0,u.fA)(e[0],e[1],e[2]||0,e[3]||0))}vectorToArray(e){return[e[0],e[1],e[2],e[3]]}pointToArray(e){return[e.x,e.y,e.z,e.m]}vectorToPoint(e,t=new h.default){return t.x=e[0],t.y=e[1],t.z=e[2],t.m=e[3],t.spatialReference=this.spatialReference,t}arrayToPoint(e,t=new h.default){return t.x=e[0],t.y=e[1],t.z=e[2],t.m=e[3],t.spatialReference=this.spatialReference,t}vectorToDehydratedPoint(e,t){if(e)return t??={x:void 0,y:void 0,z:void 0,m:void 0,hasZ:void 0,hasM:void 0,spatialReference:void 0,type:"point"},t.x=e[0],t.y=e[1],t.z=e[2],t.m=e[3],t.hasZ=!0,t.hasM=!0,t.spatialReference=this.spatialReference,t}lerp(e,t,n,i){return(0,c.l)(i,e,t,n)}addDelta(e,t,n,i){e[0]+=t,e[1]+=n,e[2]+=i}distance(e,t){return(0,a.j)(e,t)}getZ(e){return e[2]}hasZ(){return!0}getM(e){return e[3]}hasM(){return!0}clone(e){return this._tag((0,u.ci)(e))}copy(e,t){return(0,c.c)(t,e)}fromXYZ(e,t=0,n=0){return this._tag((0,u.fA)(e[0],e[1],e.length>2?e[2]:t,n))}toXYZ(e,t=(0,l.vt)()){return(0,a.i)(t,e[0],e[1],e[2])}pointToXYZ(e,t=(0,l.vt)()){return(0,a.i)(t,e.x,e.y,e.z??0)}equals(e,t){return(0,c.e)(e,t)}_tag(e){return e}}function g(e,t,n){return e&&t?new f(n):t?new p(i.M,n):e?new p(i.Z,n):new d(n)}},2831:function(e,t,n){"use strict";n.d(t,{EX:function(){return b},RS:function(){return M},Tp:function(){return x},Wp:function(){return p},Xt:function(){return h},an:function(){return d},bl:function(){return _},dp:function(){return v},mc:function(){return y},pg:function(){return E},rh:function(){return S},sO:function(){return T},y$:function(){return m}});var i=n(50659),r=(n(58941),n(21609),n(15774)),o=n(13520),s=n(46157),a=n(67376),l=n(45328),c=n(68945),u=n(7819);function h(e,t){return e.events.on("drag",function(e,t){let n=null,i=null;return r=>{if("cancel"===r.action)return void(null!=i&&(i.execute({action:"cancel"}),n=null,i=null));const o={action:r.action,screenStart:r.start,screenEnd:r.screenPoint};"start"===r.action&&null==n&&(n=new S,i=new S,t(e,n,i,r.pointerType,o)),null!=n&&n.execute(o),"end"===r.action&&null!=n&&(n=null,i=null)}}(e,t))}function d(e,t){const n=[e.x,e.y,e.z??0],i=t,r=[Math.cos(i),Math.sin(i)],o=Math.sqrt(r[0]*r[0]+r[1]*r[1]);if(0===o)return null;r[0]/=o,r[1]/=o;const s=e=>{const t=(e.x-n[0])*r[0]+(e.y-n[1])*r[1];e.x=n[0]+t*r[0],e.y=n[1]+t*r[1]};return e=>(s(e.mapStart),s(e.mapEnd),{...e,axis:r})}function p(e){let t=null;return n=>{if("start"===n.action&&(t=function(e,t){const n=e.operations;if(!n)return null;const i=n.data.geometry,r=(0,l.RS)(t);if(i.spatialReference.equals(r))return g(e,n,(()=>{}));if("mesh"!==i.type){const t=f(i,r);if(null==t)return null;const o=i.spatialReference;return g(e,u.p.fromGeometry(t,n.viewingMode),(()=>{const e=(0,s.project)(i,o);n.trySetGeometry(e)}))}if((0,a.CK)(i)){const t=f(i.origin,r);if(!t)return null;const o=i.spatialReference,a=u.p.fromGeometry(t,n.viewingMode);return g(e,n,(()=>{const e=(0,s.project)(a.data.geometry,o),t=e.x-i.origin.x,r=e.y-i.origin.y,l=(e.z??0)-(i.origin.z??0);n.move(t,r,l)}))}return null}(e,n.mapStart.spatialReference)),null==t)return null;const i=n.mapEnd.x-n.mapStart.x,r=n.mapEnd.y-n.mapStart.y,o=(n.mapEnd.z??0)-(n.mapStart.z??0);return t.move(i,r,o,n.action),{...n,translationX:i,translationY:r,translationZ:o}}}function f(e,t){return null==e?null:e.spatialReference.equals(t)?e.clone():(0,s.project)(e,t)}function g(e,t,n){let i=0,r=0,o=0;return{move:(s,a,l,c)=>{"start"===c&&(i=0,r=0,o=0);const u=s-i,h=a-r,d=l-o;t.move(u,h,d),i+=u,r+=h,o+=d,n(),"end"===c&&e.endInteraction?.()}}}function m(e,t=null,n){let i=null;const r=null==t||e.spatialReference?.equals(t)?e=>e:e=>null!=e?(0,s.project)(e,t):e,o={exclude:[],...n};return t=>{if("start"===t.action&&(i=r(e.toMap(t.screenStart,o))),null==i)return null;const n=r(e.toMap(t.screenEnd,o));return null!=n?{...t,mapStart:i,mapEnd:n}:null}}function _(e){const t=e.map((e=>p(e))).filter(i.Ru);return e=>{const n=e.mapEnd.x-e.mapStart.x,i=e.mapEnd.y-e.mapStart.y,r=e.mapEnd.z-e.mapStart.z;return t.forEach((t=>t(e))),{...e,translationX:n,translationY:i,translationZ:r}}}function v(e){const t=e.operations?.createResetState();return e=>(t?.remove(),e)}function y(e){const t=e.map((e=>v(e))).filter((e=>null!=e));return e=>(t.forEach((t=>t(e))),e)}function b(){let e=0,t=0,n=0;return i=>{"start"===i.action&&(e=i.mapStart.x,t=i.mapStart.y,n=i.mapStart.z);const r=i.mapEnd.x-e,o=i.mapEnd.y-t,s=i.mapEnd.z-n;return e=i.mapEnd.x,t=i.mapEnd.y,n=i.mapEnd.z,{...i,mapDeltaX:r,mapDeltaY:o,mapDeltaZ:s,mapDeltaSpatialReference:i.mapStart.spatialReference}}}function T(){let e=0,t=0;return n=>{"start"===n.action&&(e=n.screenStart.x,t=n.screenStart.y);const i=n.screenEnd.x-e,r=n.screenEnd.y-t;return e=n.screenEnd.x,t=n.screenEnd.y,{...n,screenDeltaX:i,screenDeltaY:r}}}function x(e,t){let n=null,i=0,s=0;return a=>{if("start"===a.action&&(n=e.toScreen?.(t),null!=n&&(n.x<0||n.x>e.width||n.y<0||n.y>e.height?n=null:(i=a.screenStart.x-n.x,s=a.screenStart.y-n.y))),null==n)return null;const l=(0,r.qE)(a.screenEnd.x-i,0,e.width),c=(0,r.qE)(a.screenEnd.y-s,0,e.height),u=(0,o.tc)(l,c);return a.screenStart=n,a.screenEnd=u,a}}const w=()=>{};class S{constructor(){this.execute=w}next(e,t=new S){return null!=e&&(this.execute=n=>{const i=e(n);null!=i&&t.execute(i)}),t}}function E(e,t,n=[]){if("2d"===e.type)return e=>e;let i=null;return r=>{"start"===r.action&&(i=e.toMap(r.screenStart,{exclude:n}),null!=i&&(i.z=(0,c.id)(i,e,t)));const o=e.toMap(r.screenEnd,{exclude:n});null!=o&&(o.z=(0,c.id)(o,e,t));const s=null!=i&&null!=o?{sceneStart:i,sceneEnd:o}:null;return{...r,scenePoints:s}}}function A(e,t,n){const i=t.elevationProvider.getElevation(e.x,e.y,e.z??0,e.spatialReference,"scene")??0,r=(0,l.EL)(e);return r.z=i,r.hasZ=!0,r.z=(0,c.id)(r,t,n),r}function M(e,t){if("2d"===e.type)return e=>e;let n=null;return i=>{"start"===i.action&&(n=A(i.mapStart,e,t));const r=A(i.mapEnd,e,t),o=null!=n&&null!=r?{sceneStart:n,sceneEnd:r}:null;return{...i,scenePoints:o}}}},2623:function(e,t,n){"use strict";n.d(t,{uA:function(){return p},oH:function(){return d},ZE:function(){return f},Li:function(){return h},oF:function(){return m}});var i=n(50659),r=n(82547),o=n(48996),s=n(44740),a=n(91508),l=n(50517),c=n(57652),u=n(65420);class h{constructor(e){this.component=e,this.leftEdge=null,this.rightEdge=null,this.type="vertex",this.index=null}get pos(){return this._pos}set pos(e){this._pos=e,this.component.unnormalizeVertexPositions()}}class d{constructor(e,t,n){this.component=e,this.leftVertex=t,this.rightVertex=n,this.type="edge",t.rightEdge=this,n.leftEdge=this}}class p{constructor(e,t){this._spatialReference=e,this._viewingMode=t,this.vertices=[],this.edges=[],this.index=null}unnormalizeVertexPositions(){this.vertices.length<=1||function(e,t){if(!t.supported)return;let n=1/0,i=-1/0;const r=t.upperBoundX-t.lowerBoundX;e.forEach((e=>{let o=e.pos[0];for(;o<t.lowerBoundX;)o+=r;for(;o>t.upperBoundX;)o-=r;n=Math.min(n,o),i=Math.max(i,o),e.pos[0]=o}));const o=i-n;r-o<o&&e.forEach((e=>{e.pos[0]<0&&(e.pos[0]+=r)}))}(this.vertices,function(e,t){const n=(0,c.Vp)(e);return t===u.RT.Global&&n?{supported:!0,lowerBoundX:n.valid[0],upperBoundX:n.valid[1]}:{supported:!1,lowerBoundX:null,upperBoundX:null}}(this._spatialReference,this._viewingMode))}updateVertexIndex(e,t){if(0===this.vertices.length)return;const n=this.vertices[0];let i=null,r=e,o=t;do{i=r,i.index=o++,r=i.rightEdge?i.rightEdge.rightVertex:null}while(null!=r&&r!==n);i.leftEdge&&i!==this.vertices[this.vertices.length-1]&&this.swapVertices(this.vertices.indexOf(i),this.vertices.length-1)}getFirstVertex(){return this.vertices.at(0)}getLastVertex(){return this.vertices.at(-1)}isClosed(){return this.vertices.length>2&&null!==this.vertices[0].leftEdge}swapVertices(e,t){const n=this.vertices[e];this.vertices[e]=this.vertices[t],this.vertices[t]=n}iterateVertices(e){if(0===this.vertices.length)return;const t=this.vertices[0];let n=t;do{e(n,n.index),n=null!=n.rightEdge?n.rightEdge.rightVertex:null}while(n!==t&&null!=n)}}class f extends o.A{constructor(e,t){super(),this.type=e,this.coordinateHelper=t,this._geometry=null,this._dirty=!0,this.components=[]}get geometry(){if(this._dirty){switch(this.type){case"point":this._geometry=this._toPoint();break;case"polyline":this._geometry=this._toPolyline();break;case"polygon":this._geometry=this._toPolygon();break;case"mesh":break;default:(0,r.Xb)(this.type)}this._dirty=!1}return this._geometry}get spatialReference(){return this.coordinateHelper.spatialReference}get allVertices(){return Array.from(this.iterateVertices())}*iterateVertices(){for(const e of this.components)for(const t of e.vertices)yield t}notifyChanges(e){this._dirty=!0,this.emit("change",e)}_toPoint(){return 0===this.components.length||0===this.components[0].vertices.length?null:this.coordinateHelper.vectorToPoint(this.components[0].vertices[0].pos)}_toPolyline(){const e=[],t=this.coordinateHelper.vectorToArray;for(const n of this.components){if(n.vertices.length<1)continue;const i=[];let r=n.vertices.find((e=>null==e.leftEdge));const o=r;do{i.push(t(r.pos)),r=r.rightEdge?r.rightEdge.rightVertex:null}while(r&&r!==o);e.push(i)}return new a.A({paths:e,spatialReference:this.spatialReference,hasZ:this.coordinateHelper.hasZ(),hasM:this.coordinateHelper.hasM()})}_toPolygon(){const e=[],t=this.coordinateHelper.vectorToArray;for(const n of this.components){if(n.vertices.length<1)continue;const i=[],r=n.vertices[0];let o=r;const s=o;do{i.push(t(o.pos)),o=null!=o.rightEdge?o.rightEdge.rightVertex:null}while(o&&o!==s);n.isClosed()&&i.push(t(r.pos)),e.push(i)}return new s.A({rings:e,spatialReference:this.spatialReference,hasZ:this.coordinateHelper.hasZ(),hasM:this.coordinateHelper.hasM()})}static fromGeometry(e,t){const n=e.spatialReference,r=(0,l.BV)(e.hasZ,e.hasM,n),o=new f(e.type,r);switch(e.type){case"polygon":!function(e,t,n){const r=t.spatialReference,o=e.coordinateHelper,s=t.rings;for(let t=0;t<s.length;++t){const a=s[t],l=new p(r,n);l.index=t;const c=a.length>2&&(0,i.aI)(a[0],a[a.length-1]),u=c?a.length-1:a.length;for(let e=0;e<u;++e){const t=o.arrayToVector(a[e]),n=new h(l);l.vertices.push(n),n.pos=t,n.index=e}const f=l.vertices.length-1;for(let e=0;e<f;++e){const t=l.vertices[e],n=l.vertices[e+1],i=new d(l,t,n);l.edges.push(i)}if(c){const e=new d(l,l.vertices[l.vertices.length-1],l.vertices[0]);l.edges.push(e)}e.components.push(l)}}(o,e,t);break;case"polyline":!function(e,t,n){const i=t.spatialReference,r=e.coordinateHelper,o=t.paths;for(let t=0;t<o.length;++t){const s=o[t],a=new p(i,n);a.index=t;const l=s.length;for(let e=0;e<l;++e){const t=r.arrayToVector(s[e]),n=new h(a);a.vertices.push(n),n.pos=t,n.index=e}const c=a.vertices.length-1;for(let e=0;e<c;++e){const t=a.vertices[e],n=a.vertices[e+1],i=new d(a,t,n);a.edges.push(i)}e.components.push(a)}}(o,e,t);break;case"point":g(o,e,t);break;case"mesh":g(o,e.origin,t),o._geometry=e,o._dirty=!1}return o}}function g(e,t,n){const i=t.spatialReference,r=e.coordinateHelper,o=new p(i,n);o.index=0;const s=new h(o);s.index=0,s.pos=r.pointToVector(t),o.vertices.push(s),e.components.push(o)}function m(e){return"mesh"===e.type}},7819:function(e,t,n){"use strict";n.d(t,{p:function(){return E}});var i=n(48996),r=n(61226),o=n(32501),s=n(38441),a=n(2623),l=n(34358);class c{constructor(e,t,n){this._editGeometry=e,this._component=t,this._pos=n,this._addedVertex=null,this._originalEdge=null,this._left=null,this._right=null}apply(){let e="redo";null==this._addedVertex&&(e="apply",this._addedVertex=new a.Li(this._component));const t=this._component.getLastVertex();if(null==t)this._component.vertices.push(this._addedVertex),this._addedVertex.pos=this._pos,this._addedVertex.index=0;else{let e=null;t.rightEdge&&(this._originalEdge=t.rightEdge,e=this._originalEdge.rightVertex,this._component.edges.splice(this._component.edges.indexOf(this._originalEdge),1)),this._component.vertices.push(this._addedVertex),this._addedVertex.pos=this._pos,null==this._left&&(this._left=new a.oH(this._component,t,this._addedVertex)),this._component.edges.push(this._left),t.rightEdge=this._left,null!=this._originalEdge&&null!=e&&(null==this._right&&(this._right=new a.oH(this._component,this._addedVertex,e)),this._component.edges.push(this._right),e.leftEdge=this._right),this._component.updateVertexIndex(this._addedVertex,t.index+1)}this._editGeometry.notifyChanges({operation:e,addedVertices:[this._addedVertex]})}undo(){null!=this._addedVertex&&(this._component.vertices.splice(this._component.vertices.indexOf(this._addedVertex),1),null!=this._left&&(this._component.edges.splice(this._component.edges.indexOf(this._left),1),this._left.leftVertex.rightEdge=null),null!=this._right&&(this._component.edges.splice(this._component.edges.indexOf(this._right),1),this._right.rightVertex.leftEdge=null),null!=this._originalEdge&&(this._component.edges.push(this._originalEdge),this._originalEdge.leftVertex.rightEdge=this._originalEdge,this._originalEdge.rightVertex.leftEdge=this._originalEdge),null!=this._left?this._component.updateVertexIndex(this._left.leftVertex,this._left.leftVertex.index):this._component.updateVertexIndex(this._addedVertex,0),this._editGeometry.notifyChanges({operation:"undo",removedVertices:[this._addedVertex]}))}accumulate(){return!1}}var u=n(57665);class h{constructor(e,t,n=0){this._editGeometry=e,this._vertices=t,this._minNumberOfVertices=n,this.removedVertices=null}apply(){let e="redo";if(null==this.removedVertices){const t=this.removedVertices=[];this._vertices.forEach((e=>{const n=this._removeVertex(e);null!=n&&t.push(n)})),e="apply"}else this.removedVertices.forEach((e=>{this._removeVertex(e.removedVertex)}));this._editGeometry.notifyChanges({operation:e,removedVertices:this._vertices})}undo(){this.removedVertices?.forEach((e=>{this._undoRemoveVertex(e)})),this._editGeometry.notifyChanges({operation:"undo",addedVertices:this._vertices})}accumulate(){return!1}_removeVertex(e){const t=e.component;if(t.vertices.length<=this._minNumberOfVertices)return null;const n={removedVertex:e,createdEdge:null},i=e.leftEdge,r=e.rightEdge;return t.vertices.splice(t.vertices.indexOf(e),1),i&&(t.edges.splice(t.edges.indexOf(i),1),i.leftVertex.rightEdge=null),r&&(t.edges.splice(t.edges.indexOf(r),1),r.rightVertex.leftEdge=null),0===e.index&&r&&this._vertices.length>0&&t.swapVertices(t.vertices.indexOf(r.rightVertex),0),i&&r&&(n.createdEdge=new a.oH(t,i.leftVertex,r.rightVertex),t.edges.push(n.createdEdge)),r&&t.updateVertexIndex(r.rightVertex,r.rightVertex.index-1),n}_undoRemoveVertex(e){const t=e.removedVertex,n=e.removedVertex.component,i=t.leftEdge,r=t.rightEdge;e.createdEdge&&n.edges.splice(n.edges.indexOf(e.createdEdge),1),n.vertices.push(t),i&&(n.edges.push(i),i.leftVertex.rightEdge=i),r&&(n.edges.push(r),r.rightVertex.leftEdge=r),n.updateVertexIndex(t,t.index)}}class d{constructor(e,t,n){this._editGeometry=e,this._edge=t,this._t=n,this.createdVertex=null,this._left=null,this._right=null}apply(){let e="redo";const t=this._edge,n=t.component,i=t.leftVertex,r=t.rightVertex;n.edges.splice(n.edges.indexOf(t),1),null==this.createdVertex&&(e="apply",this.createdVertex=new a.Li(t.component)),n.vertices.push(this.createdVertex),this.createdVertex.pos=this._editGeometry.coordinateHelper.lerp(t.leftVertex.pos,t.rightVertex.pos,this._t,this._editGeometry.coordinateHelper.createVector()),null==this._left&&(this._left=new a.oH(n,i,this.createdVertex)),this._left.leftVertex.leftEdge?n.edges.push(this._left):n.edges.unshift(this._left),i.rightEdge=this._left,null==this._right&&(this._right=new a.oH(n,this.createdVertex,r)),n.edges.push(this._right),r.leftEdge=this._right,n.updateVertexIndex(this.createdVertex,i.index+1),this._editGeometry.notifyChanges({operation:e,addedVertices:[this.createdVertex]})}undo(){if(null==this.createdVertex||null==this._left||null==this._right)return null;const e=this._edge,t=e.component,n=this.createdVertex.leftEdge,i=this.createdVertex.rightEdge,r=n?.leftVertex,o=i?.rightVertex;t.vertices.splice(t.vertices.indexOf(this.createdVertex),1),t.edges.splice(t.edges.indexOf(this._left),1),t.edges.splice(t.edges.indexOf(this._right),1),this._edge.leftVertex.leftEdge?t.edges.push(this._edge):t.edges.unshift(this._edge),r&&(r.rightEdge=e),o&&(o.leftEdge=e),r&&t.updateVertexIndex(r,r.index),this._editGeometry.notifyChanges({operation:"undo",removedVertices:[this.createdVertex]})}accumulate(){return!1}}class p{constructor(e,t,n){this._editGeometry=e,this._vertex=t,this._pos=n}apply(){const e=null==this._originalPosition;e&&(this._originalPosition=this._vertex.pos),this._apply(e?"apply":"redo")}undo(){this._vertex.pos=this._originalPosition,this._editGeometry.notifyChanges({operation:"undo",updatedVertices:[this._vertex]})}accumulate(e){return e instanceof p&&e._vertex===this._vertex&&(this._pos=e._pos,this._apply("apply"),!0)}_apply(e){this._vertex.pos=this._pos,this._editGeometry.components.forEach((e=>e.unnormalizeVertexPositions())),this._editGeometry.notifyChanges({operation:e,updatedVertices:[this._vertex]})}}var f=n(50659);class g{constructor(e,t){this._editGeometry=e,this._component=t,this._createdEdge=null}apply(){let e="redo";if(null==this._createdEdge){e="apply";const t=this._component.getFirstVertex(),n=this._component.getLastVertex();if(this._component.isClosed()||this._component.vertices.length<3||null==t||null==n)return;this._createdEdge=new a.oH(this._component,n,t)}this._createdEdge.leftVertex.rightEdge=this._createdEdge,this._createdEdge.rightVertex.leftEdge=this._createdEdge,this._component.edges.push(this._createdEdge),this._editGeometry.notifyChanges({operation:e})}undo(){null!=this._createdEdge&&((0,f.TF)(this._component.edges,this._createdEdge),this._createdEdge.leftVertex.rightEdge=null,this._createdEdge.rightVertex.leftEdge=null,this._editGeometry.notifyChanges({operation:"undo"}))}accumulate(){return!1}}class m{constructor(e,t,n,i){this._editGeometry=e,this.dx=t,this.dy=n,this.dz=i,this._firstTime=!0}apply(){const e=this._firstTime?"apply":"redo";this._firstTime=!1,this._apply(e,this.dx,this.dy,this.dz)}undo(){this._apply("undo",-this.dx,-this.dy,-this.dz)}accumulate(e){const t=this._editGeometry.geometry;return e instanceof m&&e._editGeometry.geometry===t&&(this._apply("apply",e.dx,e.dy,e.dz),this.dx+=e.dx,this.dy+=e.dy,this.dz+=e.dz,!0)}_apply(e,t,n,i){const r=this._editGeometry.geometry;r.offset(t,n,i);const o=this._editGeometry.components[0].getFirstVertex();if(!o)return;const s=this._editGeometry.coordinateHelper;o.pos=s.pointToVector(r.origin),this._editGeometry.notifyChanges({operation:e,updatedVertices:[o]})}}var _,v=n(28080),y=n(63447),b=n(31966),T=n(76835);class x{constructor(e,t){this._editGeometry=e,this._newPositions=t}apply(){const e=null==this._originalPositions?"apply":"redo";if(!this._originalPositions){const e=this._editGeometry.coordinateHelper;this._originalPositions=this._editGeometry.allVertices.map((t=>e.clone(t.pos)))}this._apply(e,this._newPositions)}undo(){this._originalPositions&&this._apply("undo",this._originalPositions)}accumulate(e){return e instanceof x&&(this._newPositions=e._newPositions,this._apply("apply",this._newPositions),!0)}_apply(e,t){const n=this._editGeometry.coordinateHelper,i=this._editGeometry.allVertices;for(let e=0;e<i.length;e++)n.copy(t[e],i[e].pos);this._editGeometry.components.forEach((e=>e.unnormalizeVertexPositions())),this._editGeometry.notifyChanges({operation:e,updatedVertices:i})}}const w=Symbol();class S{constructor(e){this._operations=[],this._closed=!1,this[_]=!0,e&&(this._operations=e,this._closed=!0)}close(){this._closed=!0}apply(){for(const e of this._operations)e.apply()}undo(){for(let e=this._operations.length-1;e>=0;e--)this._operations[e].undo()}accumulate(e){if(this._closed)return!1;const t=this._operations.length?this._operations[this._operations.length-1]:null;return t&&t.accumulate(e)||(this._operations.push(e),e.apply()),!0}}_=w;class E extends i.A{constructor(e,t){super(),this.data=e,this.viewingMode=t,this._undoStack=[],this._redoStack=[],this._listener=this.data.on("change",(e=>{e.addedVertices&&this.emit("vertex-add",{type:"vertex-add",vertices:e.addedVertices,operation:e.operation}),e.removedVertices&&this.emit("vertex-remove",{type:"vertex-remove",vertices:e.removedVertices,operation:e.operation}),e.updatedVertices&&this.emit("vertex-update",{type:"vertex-update",vertices:e.updatedVertices,operation:e.operation})}))}destroy(){this._listener.remove()}splitEdge(e,t){return this._apply(new d(this.data,e,t))}updateVertices(e,t,n=l.Y.ACCUMULATE_STEPS){return this._apply(new u.D(this.data,e,t),n)}move(e,t,n,i=l.Y.ACCUMULATE_STEPS){return(0,a.oF)(this.data)?this._apply(new m(this.data,e,t,n),i):this.moveVertices(this.data.allVertices,e,t,n,i)}moveVertices(e,t,n,i,r=l.Y.ACCUMULATE_STEPS){return(0,a.oF)(this.data)?this._apply(new m(this.data,t,n,i),r):this.updateVertices(e,new v.a(this.data.coordinateHelper,t,n,i),r)}scale(e,t,n,i,r=l.Y.ACCUMULATE_STEPS,o=u.K.CUMULATIVE){return this.scaleVertices(this.data.allVertices,e,t,n,i,r,o)}scaleVertices(e,t,n,i,r,o=l.Y.ACCUMULATE_STEPS,s=u.K.CUMULATIVE){return this.updateVertices(e,new T.j(t,n,i,r,s),o)}rotate(e,t,n=l.Y.ACCUMULATE_STEPS,i=u.K.CUMULATIVE){return this.rotateVertices(this.data.allVertices,e,t,n,i)}rotateVertices(e,t,n,i=l.Y.ACCUMULATE_STEPS,r=u.K.CUMULATIVE){return this.updateVertices(e,new b.m(t,n,r),i)}removeVertices(e){return this._apply(new h(this.data,e,this._minNumVerticesPerType))}appendVertex(e){return 0===this.data.components.length?null:this._apply(new c(this.data,this.data.components[0],e))}setVertexPosition(e,t){return this._apply(new p(this.data,e,t))}offsetEdge(e,t,n,i=l.Y.ACCUMULATE_STEPS){return this.updateVertices([t.leftVertex,t.rightVertex],new y.L(this.data.coordinateHelper,e,t,n),i)}trySetGeometry(e,t=l.Y.ACCUMULATE_STEPS){const{data:n}=this,{coordinateHelper:i}=n;if(n.type!==e.type||!n.spatialReference.equals(e.spatialReference)||i.hasZ()!==e.hasZ||i.hasM()!==e.hasM||!(0,s.It)(n.geometry,e)||(0,a.oF)(n))return;const r=Array.from(a.ZE.fromGeometry(e,this.viewingMode).iterateVertices(),(e=>e.pos));return this.setVertexPositions(r,t)}setVertexPositions(e,t=l.Y.ACCUMULATE_STEPS){return this._apply(new x(this.data,e),t)}createResetState(){if((0,a.oF)(this.data))return this._createResetStateMesh();const e=this.data.geometry.clone();return(0,r.hA)((()=>this.trySetGeometry(e)))}closeComponent(e){return this.data.components.includes(e)?this._apply(new g(this.data,e)):null}canRemoveVertex(e){return e.vertices.length>this._minNumVerticesPerType}createUndoGroup(){const e=new S;return this._apply(e),(0,r.hA)((()=>e.close()))}undo(){if(this._undoStack.length>0){const e=this._undoStack.pop();return e.undo(),this._redoStack.push(e),e}return null}redo(){if(this._redoStack.length>0){const e=this._redoStack.pop();return e.apply(),this._undoStack.push(e),e}return null}get canUndo(){return this._undoStack.length>0}get canRedo(){return this._redoStack.length>0}get lastOperation(){return this._undoStack.length>0?this._undoStack[this._undoStack.length-1]:null}get _minNumVerticesPerType(){switch(this.data.type){case"point":return 1;case"polyline":return 2;case"polygon":return 3;default:return 0}}_apply(e,t=l.Y.ACCUMULATE_STEPS){return t!==l.Y.NEW_STEP&&null!=this.lastOperation&&this.lastOperation.accumulate(e)||(e.apply(),this._undoStack.push(e),this._redoStack=[]),e}_createResetStateMesh(){if(!(0,a.oF)(this.data))return(0,r.hA)();const e=this.data.geometry,{vertexSpace:t}=e;if(t.origin){const n=(0,o.o8)(t.origin);return(0,r.hA)((()=>{e.vertexSpace.origin=n}))}const n=e.vertexAttributes.clonePositional();return(0,r.hA)((()=>{e.vertexAttributes=n,e.vertexAttributesChanged()}))}static fromGeometry(e,t){return new E(a.ZE.fromGeometry(e,t),t)}}},34358:function(e,t,n){"use strict";var i;n.d(t,{Y:function(){return i}}),function(e){e[e.NEW_STEP=0]="NEW_STEP",e[e.ACCUMULATE_STEPS=1]="ACCUMULATE_STEPS"}(i||(i={}))},28080:function(e,t,n){"use strict";n.d(t,{a:function(){return i}});class i{constructor(e,t,n,i){this._helper=e,this.dx=t,this.dy=n,this.dz=i}_move(e,t,n,i){this._helper.addDelta(e.pos,t,n,i)}apply(e){this._move(e,this.dx,this.dy,this.dz)}undo(e){this._move(e,-this.dx,-this.dy,-this.dz)}canAccumulate(e){return e instanceof i}accumulate(e,t){this._move(e,t.dx,t.dy,t.dz)}accumulateParams(e){this.dx+=e.dx,this.dy+=e.dy,this.dz+=e.dz}}},63447:function(e,t,n){"use strict";n.d(t,{B:function(){return f},L:function(){return h}});var i=n(15774),r=n(13786),o=n(1932),s=n(20551),a=n(32501),l=n(5596),c=n(29531),u=n(77363);class h{get plane(){return this._plane}get requiresSplitEdgeLeft(){return!this._left.isOriginalDirection}get requiresSplitEdgeRight(){return!this._right.isOriginalDirection}get edgeDirection(){return this._edgeDirection}constructor(e,t,n,i=0,r=g.IMMEDIATE){this._helper=e,this._planeType=t,this._edge=n,this.distance=i,this._plane=(0,l.vt)(),this._offsetPlane=(0,l.vt)(),this._minDistance=-1/0,this._maxDistance=1/0,this._selectedArrow=1,r===g.IMMEDIATE&&this._initialize()}_initialize(){this._initializeNeighbors(),this._initializePlane(),this._initializeDistanceConstraints()}_initializeNeighbors(){const e=this._toXYZ(this._edge.leftVertex.pos),t=this._toXYZ(this._edge.leftVertex.leftEdge?.leftVertex?.pos),n=this._toXYZ(this._edge.rightVertex.pos),i=this._toXYZ(this._edge.rightVertex.rightEdge?.rightVertex?.pos);this._edgeDirection=(0,s.o)((0,a.vt)(),e,n),t?(this._left=this._computeNeighbor(e,t,this._edgeDirection),this._right=this._computeNeighbor(n,i,this._edgeDirection,this._left)):(this._right=this._computeNeighbor(n,i,this._edgeDirection),this._left=this._computeNeighbor(e,t,this._edgeDirection,this._right))}_toXYZ(e){return null!=e?this._helper.toXYZ(e):null}_pointToXYZ(e){return this._toXYZ(this._helper.pointToVector(e))}_computeNeighbor(e,t,n,i){const r=(0,a.vt)();if(t){(0,s.o)(r,e,t);const i=!this._passesBisectingAngleThreshold(r,n);return{start:e,end:t,direction:i?this._bisectVectorsPerpendicular(n,r):r,isOriginalDirection:!i}}return this._helper.hasZ()?i&&((0,s.e)(r,n,i.direction),(0,s.e)(r,r,n),(0,s.n)(r,r),Math.sign(r[1])!==Math.sign(n[0])&&(0,s.h)(r,r,-1)):(0,s.i)(r,-n[1],n[0],0),{start:e,end:t,direction:r,isOriginalDirection:!0}}_passesBisectingAngleThreshold(e,t){const n=Math.abs((0,c.g7)(t,e));return n>=d&&n<=Math.PI-d}_bisectVectorsPerpendicular(e,t){const n=(0,s.f)(e,t)<0?e:(0,s.v)((0,a.vt)(),e),i=Math.abs((0,s.f)(n,t));if(!(i<p||i>1-p))return this._bisectDirection(n,t);const r=(0,s.e)((0,a.vt)(),n,[0,0,1]);return(0,s.n)(r,r)}_bisectDirection(e,t){const n=(0,s.g)((0,a.vt)(),e,t);return(0,s.n)(n,n)}_initializePlane(){const e=this._computeNormalDirection(this._left),t=this._computeNormalDirection(this._right);(0,s.f)(e,t)<0&&(0,s.v)(t,t),(0,l.O_)(this._left.start,this._bisectDirection(e,t),this._plane)}_computeNormalDirection(e){const t=(0,s.e)((0,a.vt)(),e.direction,this._edgeDirection);(0,s.n)(t,t);const n=(0,s.e)((0,a.vt)(),this._edgeDirection,t);return this._planeType===f.XY&&(n[2]=0),(0,s.n)(n,n)}_initializeDistanceConstraints(){null==this._left.end||this.requiresSplitEdgeLeft||this._updateDistanceConstraint((0,l.mN)(this._plane,this._left.end)),null==this._right.end||this.requiresSplitEdgeRight||this._updateDistanceConstraint((0,l.mN)(this._plane,this._right.end)),this._updateIntersectDistanceConstraint(this._plane)}_updateDistanceConstraint(e){e<=0&&(this._minDistance=Math.max(this._minDistance,e)),e>=0&&(this._maxDistance=Math.min(this._maxDistance,e))}_updateIntersectDistanceConstraint(e){const t=(0,l.Qj)(e),n=this._edgeDirection,i=(0,s.g)((0,a.vt)(),this._left.start,this._left.direction),c=(0,s.g)((0,a.vt)(),this._right.start,this._right.direction),h=this._pointInBasis2D((0,o.vt)(),t,n,this._left.start),d=this._pointInBasis2D((0,o.vt)(),t,n,i),p=this._pointInBasis2D((0,o.vt)(),t,n,this._right.start),f=this._pointInBasis2D((0,o.vt)(),t,n,c),[g]=(0,u.jI)({start:d,end:h,type:u.Vv.LINE},{start:f,end:p,type:u.Vv.LINE});if(!g)return;const m=(0,r.Re)((0,o.vt)(),h,d);(0,r.S8)(m,m);const _=(0,r.Re)((0,o.vt)(),g,d),v=(0,r.Om)(m,_),y=(0,s.g)((0,a.vt)(),i,(0,s.h)((0,a.vt)(),this._left.direction,-v)),b=(0,l.mN)(e,y);this._updateDistanceConstraint(b)}_pointInBasis2D(e,t,n,i){return e[0]=(0,c.gr)(t,i),e[1]=(0,c.gr)(n,i),e}_offset(e,t){Number.isFinite(this._minDistance)&&(t=Math.max(this._minDistance,t)),Number.isFinite(this._maxDistance)&&(t=Math.min(this._maxDistance,t)),(0,l.C)(this._offsetPlane,this._plane),this._offsetPlane[3]-=t;const n=(e,t,n)=>null!=t&&(0,l.U5)(this._offsetPlane,e,(0,s.g)((0,a.vt)(),e,t),n),i=(0,a.vt)();(e===this._edge.leftVertex?n(this._left.start,this._left.direction,i):n(this._right.start,this._right.direction,i))&&this._helper.copy(this._helper.fromXYZ(i,void 0,this._helper.getM(e.pos)),e.pos)}selectArrowFromStartPoint(e){this._selectedArrow=(0,l.Tj)(this.plane,this._pointToXYZ(e))?1:-1}get selectedArrow(){return this._selectedArrow}signedDistanceToPoint(e){return(0,l.mN)(this.plane,this._pointToXYZ(e))}clampedStartAndEnd(e){const t=this._helper.toXYZ(this._helper.pointToVector(e)),n=(0,l._I)(this._plane,t,(0,a.vt)()),r=(0,l.mN)(this._plane,t),o=(0,i.qE)(r,this._minDistance,this._maxDistance);return(0,s.m)(t,n,t,o/r),{start:n,end:t}}apply(e){this._offset(e,this.distance)}undo(e){this._offset(e,0)}canAccumulate(e){return e instanceof h&&this._edge.leftVertex.index===e._edge.leftVertex.index&&this._edge.rightVertex.index===e._edge.rightVertex.index&&this._edge.component===e._edge.component&&this._maybeEqualsVec3(this._left.direction,e._left.direction)&&this._maybeEqualsVec3(this._right.direction,e._right.direction)&&(0,s.H)((0,l.Qj)(this._plane),(0,l.Qj)(e._plane))}accumulate(e,t){const n=this._plane[3]-t._plane[3]+t.distance;this._offset(e,n)}accumulateParams(e){const t=e.distance-e._plane[3];this.distance=t+this._plane[3]}clone(){const e=new h(this._helper,this._planeType,this._edge,this.distance,g.DEFERRED);return(0,l.C)(e._plane,this._plane),(0,l.C)(e._offsetPlane,this._offsetPlane),e._maxDistance=this._maxDistance,e._minDistance=this._minDistance,e._left=this._cloneNeighbor(this._left),e._right=this._cloneNeighbor(this._right),e._edgeDirection=(0,s.c)((0,a.vt)(),this._edgeDirection),e}_maybeEqualsVec3(e,t){return null==e&&null==t||null!=e&&null!=t&&(0,s.H)(e,t)}_cloneNeighbor({start:e,end:t,direction:n,isOriginalDirection:i}){return{start:(0,s.c)((0,a.vt)(),e),end:null!=t?(0,s.c)((0,a.vt)(),t):null,direction:(0,s.c)((0,a.vt)(),n),isOriginalDirection:i}}}const d=(0,i.kU)(15),p=.001;var f,g,m;(m=f||(f={}))[m.XYZ=0]="XYZ",m[m.XY=1]="XY",function(e){e[e.IMMEDIATE=0]="IMMEDIATE",e[e.DEFERRED=1]="DEFERRED"}(g||(g={}))},31966:function(e,t,n){"use strict";n.d(t,{m:function(){return s}});var i=n(50659),r=n(13786),o=n(57665);class s{constructor(e,t,n=o.K.CUMULATIVE){this.origin=e,this.angle=t,this._accumulationType=n}_rotate(e,t){(0,r.e$)(e.pos,e.pos,this.origin,t)}apply(e){this._rotate(e,this.angle)}undo(e){this._rotate(e,-this.angle)}canAccumulate(e){return e instanceof s&&(0,i.aI)(this.origin,e.origin)}accumulate(e,t){const n=t._accumulationType===o.K.REPLACE;this._rotate(e,n?t.angle-this.angle:t.angle)}accumulateParams(e){const t=e._accumulationType===o.K.REPLACE;this.angle=t?e.angle:this.angle+e.angle}}},76835:function(e,t,n){"use strict";n.d(t,{j:function(){return a}});var i=n(50659),r=n(1932),o=n(13786),s=n(57665);class a{constructor(e,t,n,i,o=s.K.CUMULATIVE){this.origin=e,this.axis1=t,this.factor1=n,this.factor2=i,this._accumulationType=o,this.axis2=(0,r.fA)(t[1],-t[0])}_scale(e,t,n){(0,o.Vj)(e.pos,e.pos,this.origin,this.axis1,t),(0,o.Vj)(e.pos,e.pos,this.origin,this.axis2,n)}apply(e){this._scale(e,this.factor1,this.factor2)}undo(e){this._scale(e,1/this.factor1,1/this.factor2)}canAccumulate(e){return e instanceof a&&(0,i.aI)(this.origin,e.origin)&&(0,i.aI)(this.axis1,e.axis1)}accumulate(e,t){t._accumulationType===s.K.REPLACE?this._scale(e,t.factor1/this.factor1,t.factor2/this.factor2):this._scale(e,t.factor1,t.factor2)}accumulateParams(e){const t=e._accumulationType===s.K.REPLACE;this.factor1=t?e.factor1:this.factor1*e.factor1,this.factor2=t?e.factor2:this.factor2*e.factor2}}},57665:function(e,t,n){"use strict";n.d(t,{D:function(){return i},K:function(){return r}});class i{constructor(e,t,n){this._editGeometry=e,this._vertices=t,this.operation=n,this._undone=!1}apply(){this._vertices.forEach((e=>this.operation.apply(e))),this._editGeometry.components.forEach((e=>e.unnormalizeVertexPositions())),this._editGeometry.notifyChanges({operation:this._undone?"redo":"apply",updatedVertices:this._vertices})}undo(){this._vertices.forEach((e=>this.operation.undo(e))),this._editGeometry.notifyChanges({operation:"undo",updatedVertices:this._vertices}),this._undone=!0}canAccumulate(e){if(this._undone||e._vertices.length!==this._vertices.length)return!1;for(let t=0;t<e._vertices.length;++t)if(e._vertices[t]!==this._vertices[t])return!1;return this.operation.canAccumulate(e.operation)}accumulate(e){return!!(e instanceof i&&this.canAccumulate(e))&&(this._vertices.forEach((t=>this.operation.accumulate(t,e.operation))),this.operation.accumulateParams(e.operation),this._editGeometry.components.forEach((e=>e.unnormalizeVertexPositions())),this._editGeometry.notifyChanges({operation:"apply",updatedVertices:this._vertices}),!0)}}var r;!function(e){e[e.CUMULATIVE=0]="CUMULATIVE",e[e.REPLACE=1]="REPLACE"}(r||(r={}))},41857:function(e,t,n){"use strict";n.d(t,{Bb:function(){return d},G3:function(){return g},fJ:function(){return p}});var i=n(13786),r=n(20551),o=n(32501),s=n(2075),a=n(50973),l=n(28080),c=n(31966),u=n(76835),h=n(57665);function d(e,t){return f(e,t,!1)}function p(e,t){return f(e,t,!0)}function f(e,t,n){if(e instanceof h.D){if(e.operation instanceof l.a)return function(e,t,n=!1){const i=n?-1:1,a=(0,o.fA)(i*e.dx,i*e.dy,i*e.dz);(0,r.g)(t.origin,t.origin,a),(0,s.u)(t)}(e.operation,t,n),!0;if(e.operation instanceof c.m)return function(e,t,n=!1){const i=n?-e.angle:e.angle;(0,r.K)(t.basis1,t.basis1,o.uY,i),(0,r.K)(t.basis2,t.basis2,o.uY,i),(0,s.u)(t)}(e.operation,t,n),!0;if(e.operation instanceof u.j)return function(e,t,n=!1){const o=n?1/e.factor1:e.factor1,a=n?1/e.factor2:e.factor2;(0,r.h)(t.basis1,t.basis1,o),(0,r.h)(t.basis2,t.basis2,a),(0,i.Vj)(t.origin,t.origin,e.origin,e.axis1,o),(0,i.Vj)(t.origin,t.origin,e.origin,e.axis2,a),(0,s.u)(t)}(e.operation,t,n),!0}return!1}function g(e,t,n,r){r||(r=(0,s.a)());const o=(0,i.hZ)(a.oG.get(),e[1],-e[0]),l=(0,i.hZ)(a.oG.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),c=(0,i.hZ)(a.oG.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),u=a.oG.get();t.components.forEach((t=>t.vertices.forEach((({pos:t})=>{(0,i.hZ)(u,(0,i.Om)(e,t),(0,i.Om)(o,t)),(0,i.jk)(l,l,u),(0,i.T9)(c,c,u)}))));const h=1e-6,d=(0,i.hZ)(a.oG.get(),c[0]-l[0]<h?n/2:0,c[1]-l[1]<h?n/2:0);return(0,i.Re)(l,l,d),(0,i.WQ)(c,c,d),(0,i.hs)(r.basis1,e,(c[0]-l[0])/2),(0,i.hs)(r.basis2,o,(c[1]-l[1])/2),(0,i.hZ)(r.origin,l[0]*e[0]+l[1]*o[0],l[0]*e[1]+l[1]*o[1]),(0,i.WQ)(r.origin,r.origin,r.basis1),(0,i.WQ)(r.origin,r.origin,r.basis2),(0,s.u)(r),r}},53551:function(e,t,n){"use strict";var i,r,o;n.d(t,{PK:function(){return i},SJ:function(){return o},p7:function(){return r}}),function(e){e[e.USER=0]="USER",e[e.MANAGER=1]="MANAGER"}(i||(i={})),function(e){e[e.None=0]="None",e[e.Unfocused=1]="Unfocused",e[e.Focused=2]="Focused",e[e.Unselected=4]="Unselected",e[e.Selected=8]="Selected",e[e.All=15]="All"}(r||(r={})),function(e){e[e.None=0]="None",e[e.Custom1=16]="Custom1",e[e.Custom2=32]="Custom2",e[e.Custom3=64]="Custom3",e[e.Custom4=128]="Custom4",e[e.Custom5=256]="Custom5",e[e.Custom6=512]="Custom6",e[e.Custom7=1024]="Custom7",e[e.Custom8=2048]="Custom8",e[e.Custom9=4096]="Custom9",e[e.Custom10=8192]="Custom10",e[e.Custom11=16384]="Custom11",e[e.Custom12=32768]="Custom12",e[e.All=65520]="All"}(o||(o={}))},7768:function(e,t,n){"use strict";n.d(t,{cx:function(){return y},dz:function(){return x},hj:function(){return f},lJ:function(){return b},tC:function(){return w}}),n(50917);var i=n(56275),r=n(62938),o=n(20551),s=n(68734),a=n(57862),l=n(46460),c=n(68945),u=n(92100),h=n(28397),d=n(99675),p=n(57165);function f(e,t,n,i,r,o){let l="geodesic",c=(0,a.Xn)(n);const u=(0,h.Hh)();return(0,h.vf)(e,t,i,u),u[2]=0,c&&(0,s.F)(u,n,u,c)||(l="euclidean",c=n),{mode:l,view:t,elevationInfo:i,hasZ:r,directionMode:o,spatialReference:e.spatialReference,measurementSR:c,origin:u}}function g(e,t,n){if(null==t||null==e)return;const o=(0,r._H)(n.measurementSR);if(null==o)return;const s=x(e,n);if(null==s)return;const a=(0,i.l3)(t,o);return new u.ej(s,a)}function m(e,t,n,r){if(null==n||null==e)return;const o=x(e,r);if(null==o)return;const s=(0,d.hF)(n),a=e=>{if(null==e)return;const t=(0,h.Hh)(),n=(0,i.Wq)(e,"degrees","geographic");return(0,d.rT)(t,o,r.measurementSR,10,n,r.mode)?new u.FX(o,t):void 0},l=()=>{if(null!=t&&null!=e)return(0,d.hF)((0,d.$h)(t,e))};switch(r.directionMode){case d.rZ.Absolute:return a(s);case d.rZ.Relative:{const e=l();if(null==e)return;return a(e+s)}case d.rZ.RelativeBilateral:{const e=l();if(null==e)return;return(0,u.xW)([a(e+s),a(e-s)])}}}function _(e,t){const n=S(e,t);return null!=n?new u.qR(n):void 0}function v(e,t,n){const{context:r,longitude:o,latitude:a,direction:l,distance:c,elevation:p}=n;if(null!=o||null!=a||null!=c||null!=p||null!=l){if(null!=o||null!=a){const e=(0,d.hF)(o),t=(0,d.hF)(a),n=S(p,r);return new u.QT(e,t,n)}return function(e,t,{context:n,direction:r,distance:o,elevation:a}){if(null==t)return _(a,n);const{view:l,elevationInfo:c,measurementSR:p}=n,f=(0,h.vf)(t,l,c);if(!p||!(0,s.F)(f,t.spatialReference,E,p))return;const[g,m]=E,v=null!=o?(0,i.l3)(o,"meters"):void 0,y=(0,d.hF)(r),b=S(a,n),T=e=>{const t=new u.jf([g,m],p,v,b,e);return null==v||null==e||null==b&&n.hasZ?t:new u.i7(t.closestTo(f))};if(null==y)return T(void 0);const x=()=>{if(null!=e&&null!=t)return(0,d.hF)((0,d.$h)(e,t))};switch(n.directionMode){case d.rZ.Absolute:return T(y);case d.rZ.Relative:{const e=x();if(null==e)return;return T(e+y)}case d.rZ.RelativeBilateral:{const e=x();if(null==e)return;return(0,u.xW)([T(e+y),T(e-y)])}}}(e,t,n)}}function y(e){return"geodesic"===e.context.mode?v(null,null,e):T(e)}function b(e,t,n){const{context:i,x:r,y:o,distance:s,direction:a,elevation:l}=n;return"geodesic"===i.mode?v(t,e,n):null!=r||null!=o?T(n):function(e){let t;for(const n of e)n&&(t=t?.intersect(n)??n);return t}([g(e,s,i),m(e,t,a,i),_(l,i)])}function T({x:e,y:t,elevation:n,context:i}){O.x=e?.value??0,O.y=t?.value??0,O.spatialReference=i.spatialReference;const r=x(O,i,A);return new u.QT(null!=e&&null!=r?r[0]:void 0,null!=t&&null!=r?r[1]:void 0,S(n,i))}function x(e,t,n=(0,h.Hh)()){const{view:i,elevationInfo:r,measurementSR:a,origin:l,mode:c}=t;if((0,h.vf)(e,i,r,n),(0,s.F)(n,e.spatialReference,n,a))return"geodesic"!==c&&(0,o.d)(n,n,l),n}function w(e,t,n,i){const{view:r,measurementSR:a,spatialReference:l,origin:c,mode:u}=n;if("geodesic"===u?(0,o.c)(M,e):(0,o.g)(M,e,c),(0,s.F)(M,a,M,l))return(0,h.xF)(M,r,t,n,i)}function S(e,t){return function(e,{view:t,origin:n,elevationInfo:o,hasZ:s,measurementSR:a}){if(null==e||!s)return;const l=(0,r.mq)(a);if(null==l)return;const[u,h]=n,d=(0,i.l3)(e,l),p="3d"===t?.type?(0,c.Fo)(t,u,h,d,a,o):d;return null!=p?(0,i.d_)(p,l):void 0}(e,t)?.value??void 0}const E=(0,h.Hh)(),A=(0,h.Hh)(),M=(0,h.Hh)(),O=(0,l.T)(0,0,0,p.A.WGS84)},58144:function(e,t,n){"use strict";n.d(t,{e:function(){return i}});class i{constructor(e){this.vertexHandle=null,this.excludeFeature=null,this.visualizer=null,this.selfSnappingZ=null,this.drawConstraints=null,this.editGeometryOperations=e.editGeometryOperations,this.elevationInfo=e.elevationInfo,this.pointer=e.pointer,this.vertexHandle=e.vertexHandle,this.excludeFeature=e.excludeFeature,this.feature=e.feature,this.visualizer=e.visualizer,this.selfSnappingZ=e.selfSnappingZ,this.drawConstraints=e.drawConstraints}get coordinateHelper(){return this.editGeometryOperations.data.coordinateHelper}get spatialReference(){return this.coordinateHelper.spatialReference}}},45908:function(e,t,n){"use strict";n.d(t,{L:function(){return d}});var i=n(95929),r=n(60539),o=n(28181),s=n(42413),a=n(45328),l=n(68945),c=n(2831),u=n(58144),h=n(48961);function d({predicate:e=()=>!0,snappingManager:t,snappingContext:n,updatingHandles:a,useZ:d=!0}){const _=new c.rh;if(null==t)return{snappingStep:[m,_],cancelSnapping:m};let v,y=null,b=null,T=null;const x=()=>{y=(0,i.DC)(y),t.doneSnapping(),b?.frameTask.remove(),b=null,v=(0,i.xt)(v),T=null},w=(S=t,E=d,A=_,(0,r.sg)((async({frameTask:e,point:t,scenePoint:n,context:i,event:r,delta:o,getLastState:a},l)=>{const c=await e.schedule((()=>S.snap({point:t,scenePoint:n,context:i,signal:l})),l);if(c.valid){let n=await e.schedule((()=>c.apply()),l);const u=a();null!=u.point&&t!==u.point&&(n=S.update({point:u.point,scenePoint:u.scenePoint,context:i})),null!=u.updatePoint&&(0,s.CI)(n,u.updatePoint)||(g(r.mapEnd,n,o,E),A.execute(r))}})));var S,E,A;let M=null,O=null,R=null;return{snappingStep:[i=>{if(!e(i))return i;const{action:s}=i;if("start"===s){const{info:e}=i,r=function(e){return"3d"===e.type?e.resourceController.scheduler.registerTask(h.W6.SNAPPING):h.nu}(t.view);if(b=function(e,t,n){return{context:new u.e({editGeometryOperations:e.editGeometryOperations,elevationInfo:e.elevationInfo,pointer:e.pointer,vertexHandle:null!=t.info?t.info.handle:null,excludeFeature:e.excludeFeature,feature:e.feature,visualizer:e.visualizer}),originalPos:null!=t.snapOrigin?e.coordinateHelper.vectorToDehydratedPoint(t.snapOrigin):t.mapStart,originalScenePos:null!=t.scenePoints?t.scenePoints.sceneStart:null,frameTask:n}}(n,i,r),b.context.selfSnappingZ=null,!d&&null!=e){const t=function(e,t){if(!e.hasZ())return null;const n=t.vertices;let i=null;for(const t of n){const n=e.getZ(t.pos);if(null!=i&&null!=n&&Math.abs(n-i)>1e-6)return null;null==i&&(i=n)}return i}(n.coordinateHelper,e.handle.component);null!=t&&(b.context.selfSnappingZ={value:t,elevationInfo:n.elevationInfo??l.qt})}}if(null!=b){const{context:e,originalScenePos:n,originalPos:l}=b,{mapEnd:c,mapStart:u,scenePoints:h}=i,m=p(l,f(c,u)),_=f(u,l),x={...i,action:"update"},S=b.context,E=function(e,t){return null==e||null==t?null:p(e,f(t.sceneEnd,t.sceneStart))}(n,h),A=t.update({point:m,scenePoint:E,context:e});if(R=A,g(c,A,_,d),M=m,O=E,"end"!==s){const{frameTask:e}=b;null==y&&(y=new AbortController),T=t=>{a.addPromise((0,r.QZ)(w({frameTask:e,event:x,context:S,point:m,scenePoint:E,delta:_,getLastState:()=>({point:M,scenePoint:O,updatePoint:t.forceUpdate?null:R})},y.signal)))},T({forceUpdate:!1}),null==v&&(v=(0,o.watch)((()=>t.options.effectiveEnabled),(()=>T?.({forceUpdate:!0}))))}}return"end"===s&&x(),i},_],cancelSnapping:e=>(x(),e)}}function p(e,[t,n,i]){const r=(0,a.EL)(e);return r.x+=t,r.y+=n,r.hasZ&&(r.z+=i),r}function f(e,t){const n=e.hasZ&&t.hasZ?e.z-t.z:0;return[e.x-t.x,e.y-t.y,n]}function g(e,t,[n,i,r],o){e.x=t.x+n,e.y=t.y+i,o&&e.hasZ&&t.hasZ&&(e.z=t.z+r)}function m(e){return e}},21858:function(e,t,n){"use strict";n.d(t,{b:function(){return c}});var i=n(61226),r=n(97441),o=n(64330),s=n(92535),a=n(96942),l=n(98245);class c{draw(e,t){const n=function(e){const t=[];for(const n of e){let e=!0;for(const i of t)if(n.equals(i)){e=!1;break}e&&t.push(n)}return t}(e),c=this.sortUniqueHints(n),u=[];for(const e of c)e instanceof r.v&&u.push(this.visualizeIntersectionPoint(e,t)),e instanceof o.c&&u.push(this.visualizeLine(e,t)),e instanceof s.r&&u.push(this.visualizeParallelSign(e,t)),e instanceof l.l&&u.push(this.visualizeRightAngleQuad(e,t)),e instanceof a._&&u.push(this.visualizePoint(e,t));return(0,i.vE)(u)}sortUniqueHints(e){return e}}},96942:function(e,t,n){"use strict";n.d(t,{_:function(){return o}});var i=n(20551),r=n(94612);class o extends r.m{constructor(e,t,n){super(t,n),this.point=e}equals(e){return e instanceof o&&(0,i.p)(this.point,e.point)}}},17921:function(e,t,n){"use strict";n.d(t,{T:function(){return r}});var i=n(13520);function r(e){let t=0,n=0,r=0;return e?("cim"===e.type&&e.data.symbol&&"symbolLayers"in e.data.symbol&&e.data.symbol.symbolLayers&&e.data.symbol.symbolLayers.map((e=>{"CIMVectorMarker"===e.type&&e.anchorPoint&&(Math.abs(e.anchorPoint.x)>t&&(t=e.anchorPoint.x),Math.abs(e.anchorPoint.y)>n&&(n=e.anchorPoint.y),null!=e.size&&e.size>r&&(r=e.size))})),t=(0,i.Lz)(t),n=(0,i.Lz)(n),r=(0,i.Lz)(r),{offsetX:t,offsetY:n,size:r}):{offsetX:t,offsetY:n,size:r}}},87265:function(e,t,n){"use strict";n.d(t,{Am:function(){return A},Gk:function(){return _},Ku:function(){return b},S3:function(){return x},fL:function(){return O},em:function(){return M},LJ:function(){return w},Y3:function(){return T},dy:function(){return E},qP:function(){return S},fr:function(){return y},Hw:function(){return R},uf:function(){return C}});var i=n(56275),r=n(49634),o=n(53804),s=n(83525),a=n(66110),l=n(23502),c=(n(58941),n(40633),n(13798),n(65953));let u=class extends s.A{constructor(e){super(e),this.actual=null,this.lockable=!0,this.id=(0,a.lk)(),this.inputValue=null,this.readOnly=!1,this.suffix=null,this.visible=!0,this.invalid=!1,this.unlockOnVertexPlacement=!0}get committed(){return this.lockable?this._get("committed"):null}set committed(e){this.lockable&&this._set("committed",e)}get dirty(){return null!=this.inputValue}get locked(){return this.lockable&&null!=this.committed}onInput(e){this.inputValue=e}onCommit(e,t,n){this.lockable?this._onCommitLockable(e,n):this._onCommitNonLockable(n),this.invalid&&"commit-and-exit"===e||n.onCommit(t,e)}_onCommitLockable(e,t){const{inputValue:n,locked:i}=this;i&&h(n)?this.unlock():("commit-and-exit"===e&&!i||null!=n)&&this._parseInputAndLock(t)}_onCommitNonLockable(e){const{inputValue:t}=this;h(t)?this.setActual(null):null!=t&&this._parseInputAndSetActual(e)}applyValue(e){this.lockable?this.lock(e):this.setActual(e)}clearInputValue(){this.inputValue=null,this.invalid=!1}setActual(e){this.actual=e,this.clearInputValue()}lock(e){this.lockable&&(this.committed=e??this.actual,this.clearInputValue())}unlock(){this.lockable&&(this.committed=null,this.clearInputValue())}toggleLock(e){this.lockable&&(this.locked?this.unlock():this._parseInputAndLock(e))}getSuffix(e){const{suffix:t}=this;return"function"==typeof t?t(e):t}getFormattedValue(e){const{actual:t,committed:n,format:i}=this;return null!=n?i(n,e):null!=t?i(t,e):null}getRawDisplayValue(e){const{actual:t,committed:n,inputValue:i}=this;return null!=i?i:this.lockable&&null!=n?this.formatForInputMode(n,e):null!=t?this.formatForInputMode(t,e):null}_parseInputAndSetActual(e){const{inputValue:t}=this;if(null==t||h(t))return this.setActual(null);const n=this.parse(t,e);null!=n?this.setActual(n):this.invalid=!0}_parseInputAndLock(e){const{inputValue:t,actual:n}=this;if(h(t))return this.unlock();if(null==t)return this.lock(n);const i=this.parse(t,e);null!=i?this.lock(i):this.invalid=!0}};function h(e){return null!=e&&""===e.trim()}(0,o._)([(0,l.MZ)()],u.prototype,"actual",void 0),(0,o._)([(0,l.MZ)()],u.prototype,"committed",null),(0,o._)([(0,l.MZ)()],u.prototype,"dirty",null),(0,o._)([(0,l.MZ)()],u.prototype,"format",void 0),(0,o._)([(0,l.MZ)()],u.prototype,"formatForInputMode",void 0),(0,o._)([(0,l.MZ)()],u.prototype,"lockable",void 0),(0,o._)([(0,l.MZ)()],u.prototype,"locked",null),(0,o._)([(0,l.MZ)()],u.prototype,"id",void 0),(0,o._)([(0,l.MZ)()],u.prototype,"inputValue",void 0),(0,o._)([(0,l.MZ)()],u.prototype,"name",void 0),(0,o._)([(0,l.MZ)()],u.prototype,"parse",void 0),(0,o._)([(0,l.MZ)()],u.prototype,"readOnly",void 0),(0,o._)([(0,l.MZ)()],u.prototype,"suffix",void 0),(0,o._)([(0,l.MZ)()],u.prototype,"title",void 0),(0,o._)([(0,l.MZ)()],u.prototype,"visible",void 0),(0,o._)([(0,l.MZ)()],u.prototype,"invalid",void 0),(0,o._)([(0,l.MZ)()],u.prototype,"unlockOnVertexPlacement",void 0),u=(0,o._)([(0,c.$)("esri.views.interactive.tooltip.fields.TooltipField")],u);let d=class extends u{constructor(e){super(e),this.showAsZ=!1}normalizeCtorArgs(e){const t=e=>e.inputUnitInfos.verticalLength.unit;return{name:"elevation",actual:i.r7,parse:(0,r.hw)({createQuantity:(e,n)=>(0,i.d_)(e,t(n))}),format:(e,t)=>t.formatters.verticalLength(e),formatForInputMode:(e,n)=>n.formatters.scalar((0,i.kM)(e,t(n))),suffix:e=>e.inputUnitInfos.verticalLength.abbreviation,title:e=>e.messages.sketch[this.showAsZ?"z":"elevation"],unlockOnVertexPlacement:!1,...e}}};(0,o._)([(0,l.MZ)()],d.prototype,"showAsZ",void 0),d=(0,o._)([(0,c.$)("esri.views.interactive.tooltip.fields.TooltipFieldElevation")],d);var p=n(88226),f=n(99675);let g=class extends u{constructor(e){super(e),this.precision=1}normalizeCtorArgs(e){return{name:"orientation",actual:null,parse:(0,r.hw)({createQuantity:(e,t)=>(0,i.Wq)(e,(e=>e.inputUnitInfos.angle.unit)(t),"geographic"),sanitize:r.D5}),format:e=>{const t=(0,f.P1)(e);return(0,p.Nk)(t,"geographic",this.precision)},formatForInputMode:(e,t)=>{const n=(0,f.P1)(e);return t.formatters.scalar(n)},suffix:e=>e.inputUnitInfos.angle.abbreviation,title:e=>e.messages.sketch.orientation,...e}}};(0,o._)([(0,l.MZ)()],g.prototype,"precision",void 0),g=(0,o._)([(0,c.$)("esri.views.interactive.tooltip.fields.TooltipFieldOrientation")],g);let m=class extends u{constructor(e){super(e),this.precision=null}normalizeCtorArgs(e){const t=e=>e.inputUnitInfos.length.unit;return{name:"size",actual:null,parse:(0,r.hw)({createQuantity:(e,n)=>(0,i.d_)(e,t(n))}),format:(e,t)=>t.formatters.length(e),formatForInputMode:(e,n)=>n.formatters.scalar((0,i.kM)(e,t(n))),suffix:e=>e.inputUnitInfos.length.abbreviation,title:e=>e.messages.sketch.size,...e}}};function _(e){const t=e=>e.inputUnitInfos.angle.unit,n=e=>e.sketchOptions.values.effectiveDirectionMode;return new u({name:"direction",actual:i.IV,parse:(0,r.hw)({createQuantity:(e,n)=>(0,i.Wq)(e,t(n),"geographic"),sanitize:r.D5}),format:(e,t)=>{const i=n(t),r=(0,f.jQ)(e,i);switch(i){case f.rZ.Absolute:return t.formatters.direction(r);case f.rZ.Relative:return t.formatters.directionRelative(r);case f.rZ.RelativeBilateral:return t.formatters.directionRelativeBilateral(r)}},formatForInputMode:(e,r)=>{const o=(0,f.jQ)(e,n(r));return r.formatters.scalar((0,i.kM)(o,t(r)))},suffix:e=>e.inputUnitInfos.angle.abbreviation,title:e=>{const t=n(e),{absolute:i,relative:r}=e.messages.sketch.direction;switch(t){case f.rZ.Absolute:return i;case f.rZ.Relative:case f.rZ.RelativeBilateral:return r}},...e})}function v(e){const t=e=>e.inputUnitInfos.length.unit;return new u({name:"distance",actual:i.r7,parse:(0,r.hw)({createQuantity:(e,n)=>(0,i.d_)(Math.max(e,0),t(n))}),format:(e,t)=>t.formatters.length(e),formatForInputMode:(e,n)=>n.formatters.scalar((0,i.kM)(e,t(n))),suffix:e=>e.inputUnitInfos.length.abbreviation,title:e=>e.messages.sketch.distance,...e})}function y(e){return v({format:(e,t)=>t.formatters.totalLength(e),title:e=>e.messages.sketch.totalLength,readOnly:!0,...e})}function b(e){return v({...e})}function T(e){return v({...e,parse:(0,r.hw)({createQuantity:(e,t)=>(0,i.d_)(e,(e=>e.inputUnitInfos.length.unit)(t))}),format:(e,t)=>t.formatters.lengthRelative(e)})}function x(e){return new d(e)}function w(e){return new g(e)}function S(e){return new m(e)}function E(e){return I("scale",{name:"scale",actual:null,parse:(0,r.hw)({createQuantity:e=>(0,i.LF)(Math.abs(e))}),...e})}function A(e){const t=e=>e.inputUnitInfos.area.unit;return new u({name:"area",actual:i.iT,parse:(0,r.hw)({createQuantity:(e,n)=>(0,i.gT)(e,t(n))}),format:(e,t)=>t.formatters.area(e),formatForInputMode:(e,n)=>n.formatters.scalar((0,i.kM)(e,t(n))),suffix:e=>e.inputUnitInfos.area.abbreviation,title:e=>e.messages.sketch.area,readOnly:!0,...e})}function M(e){return new u({name:"x",actual:i.IV,parse:r.L5,format:(e,t)=>t.formatters.longitudeDecimalDegrees(e),formatForInputMode:e=>(0,r.zX)(e),suffix:e=>e.inputUnitInfos.angle.abbreviation,title:e=>e.messages.sketch.longitude,...e})}function O(e){return new u({name:"y",actual:i.IV,parse:r.A3,format:(e,t)=>t.formatters.latitudeDecimalDegrees(e),formatForInputMode:e=>(0,r.oZ)(e),suffix:e=>e.inputUnitInfos.angle.abbreviation,title:e=>e.messages.sketch.latitude,...e})}function R(e){return I("x",{name:"x",...e})}function C(e){return I("y",{name:"y",...e})}function I(e,t){return new u({actual:(0,i.LF)(0),parse:(0,r.hw)({createQuantity:e=>(0,i.LF)(e)}),format:(e,t)=>t.formatters.scalar(e),formatForInputMode:(e,t)=>t.formatters.scalar(e),title:t=>t.messages.sketch[e],...t})}(0,o._)([(0,l.MZ)()],m.prototype,"precision",void 0),m=(0,o._)([(0,c.$)("esri.views.interactive.tooltip.fields.TooltipFieldSize")],m)},49634:function(e,t,n){"use strict";n.d(t,{A3:function(){return L},D5:function(){return M},GC:function(){return h},L5:function(){return D},Nr:function(){return C},X3:function(){return P},hw:function(){return A},m6:function(){return N},oZ:function(){return y},zX:function(){return v}});var i=n(16691),r=n(88226),o=n(56275),s=n(6338),a=n(2900),l=n(99675);const c=1,u=6;function h(e,t){return{angleRelative:d,direction:p,directionRelative:f,directionRelativeBilateral:g,latitudeDecimalDegrees:_,longitudeDecimalDegrees:m,area:(n,i)=>(0,r.Jd)(e,n,i??t.area),length:(n,i,o)=>(0,r.ix)(e,n,i??t.length,o),lengthRelative:(n,i)=>(0,r.yh)(e,n,i??t.length),totalLength:(n,i)=>(0,r.ix)(e,n,i??t.length),verticalLength:(n,i)=>(0,r.Oo)(e,n,i??t.verticalLength),verticalLengthRelative:(n,i)=>(0,r.OM)(e,n,i??t.verticalLength),percentage:x,scalar:S,scale:w}}function d(e){return(0,a.ZV)(e,{signDisplay:"exceptZero",...E(c)})}function p(e){return(0,r.Nk)(e,e.rotationType,c)}function f(e){const t=(0,l.hF)(e);return(0,a.ZV)(t,{style:"unit",unitDisplay:"narrow",unit:"degree",signDisplay:t>0?"never":"exceptZero",...E(c)})}function g(e){return(0,r.Nk)(e,e.rotationType,c)}function m(e){return b(e,F)}function _(e){return b(e,z)}function v(e){return T(e,F)}function y(e){return T(e,z)}function b(e,t){return(0,r.Nk)((0,o.kM)(e,"degrees"),"geographic",u,t,!1)}function T(e,t){const n=t.normalize((0,o.kM)(e,"degrees").value,void 0,!1);return S((0,o.LF)(n),u)}function x(e){return(0,a.ZV)(e.value,{style:"percent"})}function w(e){return(0,a.ZV)(e,{style:"percent",maximumFractionDigits:0})}function S(e,t){return(0,a.ZV)(e.value,E(t))}function E(e){return{minimumFractionDigits:e,maximumFractionDigits:e}}function A({createQuantity:e,sanitize:t}){return(n,i)=>{if(null==n)return null;t&&(n=t(n));const r=(0,a.$J)(n);return null==r?null:e(r,i)}}function M(e){return e.replaceAll(/[*^~°º]/g,"")}const O=e=>{let t=`[-+]?[0-9${e.thousands}]+`;return""!==e.decimal&&(t+=`${e.decimal}[0-9]+`),new RegExp(`^(${t}\\s*)${e.separator}(\\s*${t})$`,"i")},R=[];for(const e of[",","\\|","\\s+"])for(const t of["\\.",",",""])for(const n of["",",","\\."," ","\\s+"])e!==t&&e!==n&&t!==n&&R.push({separator:e,decimal:t,thousands:n,pattern:O({decimal:t,thousands:n,separator:e})});function C(e){for(const{decimal:t,thousands:n,pattern:i}of R){i.lastIndex=0;const r=e.match(i);if(!r)continue;const s=(0,a.$J)(I(r[1],t,n)),l=(0,a.$J)(I(r[2],t,n));if(null!=s&&null!=l)return{x:(0,o.LF)(s),y:(0,o.LF)(l)}}return null}function I(e,t,n){let i=e.replaceAll(/[\s+]/g,"");return""!==n&&(i=i.replaceAll(n,"")),""!==t&&(i=i.replaceAll(t,".")),i}function P(e){if(!e||null!=(0,a.$J)(e)||!(0,s.s1)())return null;const t=(0,s.o6)(e),n=N(t?.latitude),i=N(t?.longitude);return null!=i&&null!=n?{latitude:n,longitude:i}:null}function D(e){return N((0,s.mT)(e))}function L(e){return N((0,s.ts)(e))}function N(e){return null!=e?(0,o.Wq)(e,"degrees","geographic"):null}const F=new i.hr(-180,180),z=new i.hr(-90,90)},60403:function(e,t,n){"use strict";n.d(t,{d:function(){return a}});var i=n(53804),r=n(23502),o=(n(58941),n(40633),n(13798),n(65953)),s=n(90858);let a=class extends s.w{constructor(e){super(e),this.type="extent-rotate",this.angle=0}};(0,i._)([(0,r.MZ)()],a.prototype,"type",void 0),(0,i._)([(0,r.MZ)()],a.prototype,"angle",void 0),a=(0,i._)([(0,o.$)("esri.views.interactive.tooltip.infos.ExtentRotateTooltipInfo")],a)},96632:function(e,t,n){"use strict";n.d(t,{c:function(){return l}});var i=n(53804),r=n(56275),o=n(23502),s=(n(58941),n(40633),n(13798),n(65953)),a=n(90858);let l=class extends a.w{constructor(e){super(e),this.type="extent-scale",this.xScale=0,this.yScale=0,this.xSize=r.r7,this.ySize=r.r7}};(0,i._)([(0,o.MZ)()],l.prototype,"type",void 0),(0,i._)([(0,o.MZ)()],l.prototype,"xScale",void 0),(0,i._)([(0,o.MZ)()],l.prototype,"yScale",void 0),(0,i._)([(0,o.MZ)()],l.prototype,"xSize",void 0),(0,i._)([(0,o.MZ)()],l.prototype,"ySize",void 0),l=(0,i._)([(0,s.$)("esri.views.interactive.tooltip.infos.ExtentScaleTooltipInfo")],l)},18945:function(e,t,n){"use strict";n.d(t,{F:function(){return l}});var i=n(53804),r=n(23502),o=(n(58941),n(40633),n(13798),n(65953)),s=n(90858),a=n(73919);let l=class extends((0,a.B)(s.w)){constructor(e){super(e),this.type="move-point",this.allFields.forEach((e=>{e.lockable=!1,e.setActual(null)}))}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};(0,i._)([(0,r.MZ)()],l.prototype,"allFields",null),l=(0,i._)([(0,o.$)("esri.views.interactive.tooltip.infos.MovePointTooltipInfo")],l)},83931:function(e,t,n){"use strict";n.d(t,{d:function(){return c}});var i=n(53804),r=n(23502),o=(n(58941),n(40633),n(13798),n(65953)),s=n(87265),a=n(90858),l=n(73919);let c=class extends((0,l.B)(a.w)){constructor(e){super(e),this.type="selected-vertex",this.area=(0,s.Am)(),this.totalLength=(0,s.fr)(),this.geometryType="polyline",this.allFields.forEach((e=>{e.lockable=!1,e.setActual(null)}))}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,"polygon"===this.geometryType?this.area:this.totalLength]}};(0,i._)([(0,r.MZ)()],c.prototype,"geometryType",void 0),(0,i._)([(0,r.MZ)()],c.prototype,"allFields",null),c=(0,i._)([(0,o.$)("esri.views.interactive.tooltip.infos.SelectedVertexTooltipInfo")],c)},90858:function(e,t,n){"use strict";n.d(t,{w:function(){return a}});var i=n(53804),r=n(83525),o=n(23502),s=(n(58941),n(40633),n(13798),n(65953));let a=class extends r.A{constructor(e){super(e),this.helpMessage=void 0,this.viewType=void 0}get visibleElements(){return this.sketchOptions.tooltips.visibleElements}get allFields(){return[]}get editableFields(){return this.allFields.filter((e=>e.visible&&!e.readOnly))}clearInputValues(){this.allFields.forEach((e=>e.clearInputValue()))}};(0,i._)([(0,o.MZ)()],a.prototype,"sketchOptions",void 0),(0,i._)([(0,o.MZ)()],a.prototype,"visibleElements",null),(0,i._)([(0,o.MZ)()],a.prototype,"helpMessage",void 0),(0,i._)([(0,o.MZ)()],a.prototype,"viewType",void 0),(0,i._)([(0,o.MZ)()],a.prototype,"allFields",null),(0,i._)([(0,o.MZ)()],a.prototype,"editableFields",null),a=(0,i._)([(0,s.$)("esri.views.interactive.tooltip.infos.SketchTooltipInfo")],a)},73919:function(e,t,n){"use strict";n.d(t,{B:function(){return h}});var i=n(53804),r=n(56275),o=n(23502),s=(n(58941),n(40633),n(13798),n(65953)),a=n(74471),l=n(87265),c=n(49634),u=n(99368);const h=e=>{let t=class extends e{constructor(){super(...arguments),this.longitude=(0,l.em)(),this.latitude=(0,l.fL)(),this.x=(0,l.Hw)(),this.y=(0,l.uf)(),this.elevation=(0,l.S3)(),this.geographic=!1}get effectiveX(){return this.geographic?this.longitude:this.x}get effectiveY(){return this.geographic?this.latitude:this.y}get key(){return{longitude:this.longitude.actual,latitude:this.latitude.actual,x:this.x.actual,y:this.y.actual,elevation:this.elevation.actual,geographic:this.geographic}}setLocationFromPoint(e,t=e?.spatialReference){if(this.geographic=!!t&&(0,u.yF)(t),null==e)return this._setActualLonLat(null,null),void this._setActualXY(null,null);if(this.geographic){const t=(0,a.QP)(e,d);this._setActualLonLat((0,c.m6)(t?.[0]),(0,c.m6)(t?.[1]))}else this._setActualXY((0,r.LF)(e.x),(0,r.LF)(e.y))}_setActualLonLat(e,t){this.longitude.actual=e,this.latitude.actual=t}_setActualXY(e,t){this.x.actual=e,this.y.actual=t}};return(0,i._)([(0,o.MZ)()],t.prototype,"geographic",void 0),(0,i._)([(0,o.MZ)()],t.prototype,"effectiveX",null),(0,i._)([(0,o.MZ)()],t.prototype,"effectiveY",null),(0,i._)([(0,o.MZ)()],t.prototype,"key",null),t=(0,i._)([(0,s.$)("esri.views.interactive.tooltip.infos.TooltipInfoWithCoordinates")],t),t},d=[0,0]},94492:function(e,t,n){"use strict";n.d(t,{M:function(){return l}});var i=n(53804),r=n(56275),o=n(23502),s=(n(58941),n(40633),n(13798),n(65953)),a=n(90858);let l=class extends a.w{constructor(e){super(e),this.type="translate",this.distance=r.r7}clear(){this.distance=r.r7}};(0,i._)([(0,o.MZ)()],l.prototype,"type",void 0),(0,i._)([(0,o.MZ)()],l.prototype,"distance",void 0),l=(0,i._)([(0,s.$)("esri.views.interactive.tooltip.infos.TranslateTooltipInfo")],l)},24148:function(e,t,n){"use strict";n.d(t,{sZ:function(){return je},wG:function(){return $e},mu:function(){return Ve},A:function(){return Fe},HA:function(){return Ze},IA:function(){return He},Ue:function(){return ze}});var i=n(77472),r=n(61226),o=n(15774),s=n(56275),a=n(28181),l=n(62938),c=n(20551),u=n(32501),h=n(6338),d=(n(45532),n(36405)),p=n(67376),f=n(57652),g=n(1644),m=n(37578),_=n(53804),v=n(48996),y=n(40212),b=n(95929),T=n(13520),x=n(23502),w=(n(58941),n(40633),n(13798),n(65953)),S=n(93839);const E="esri-tooltip",A=`${E}-content`,M=`${E}-content--input`,O=`${E}-content__header`,R=`${E}-content__header__spacer`,C=`${E}-content__header__actions`,I=`${E}-draw-header-actions`,P=`${E}-table`,D=`${E}-help-message`,L=`${E}-help-message__text`,N=`${E}-help-message__icon`;n(39819);var F=n(31267),z=n(10362),H=n(49146);const V=`${E}-field`,U={base:V,inputMode:`${V}--input`,title:`${V}__title`,value:`${V}__value`};let k=class extends F.A{constructor(){super(...arguments),this.hidden=!1,this.mode="feedback"}render(){return(0,H.K)("div",{class:this.classes({[U.base]:!0,[U.inputMode]:"input"===this.mode})},(0,H.K)("div",{class:U.title,key:"title"},this.title),(0,H.K)("div",{class:U.value,key:"value"},this.value))}};(0,_._)([(0,x.MZ)()],k.prototype,"hidden",void 0),(0,_._)([(0,x.MZ)()],k.prototype,"mode",void 0),(0,_._)([(0,x.MZ)()],k.prototype,"title",void 0),(0,_._)([(0,x.MZ)()],k.prototype,"value",void 0),k=(0,_._)([(0,w.$)("esri.views.interactive.tooltip.components.TooltipField")],k);const B={base:`${E}-value-by-value`};let G=class extends F.A{constructor(){super(...arguments),this.divider="×"}render(){return(0,H.K)("div",{class:B.base},(0,H.K)("span",null,this.left),(0,H.K)("span",null,this.divider),(0,H.K)("span",null,this.right))}};(0,_._)([(0,x.MZ)()],G.prototype,"left",void 0),(0,_._)([(0,x.MZ)()],G.prototype,"divider",void 0),(0,_._)([(0,x.MZ)()],G.prototype,"right",void 0),G=(0,_._)([(0,w.$)("esri.views.interactive.tooltip.components.ValueByValue")],G);var $=n(84016),j=n(7213),Z=n(60539),W=n(74087),q=n(15999),Y=n(76722),X=n(49634),Q=n(28754),K=n(90357);const J=Symbol("dragHandles");let ee=class extends F.A{constructor(){super(...arguments),this._focusAbortController=new AbortController,this._transitionInfo=null,this._mode="feedback",this._getFormatters=(0,j.B)(X.GC),this._onHeaderPointerDown=e=>{const t=e.target;t instanceof HTMLElement&&"calcite-button"!==t?.tagName?.toLowerCase()&&(this.removeHandles(J),t.setPointerCapture(e.pointerId),this.tooltip.onDragStart(e.clientX,e.clientY),this.addHandles([(0,y.on)(t,"pointermove",(({clientX:e,clientY:t})=>{this.tooltip.onDrag(e,t)})),(0,y.on)(t,["pointerup","pointercancel"],(n=>{this.removeHandles(J),t.releasePointerCapture(e.pointerId),this.tooltip.onDragEnd()})),(0,y.on)(t,"touchstart",(e=>e.preventDefault()))],J))},this._onDiscard=()=>{this.destroyed||(this.tooltip.emit("discard"),this.info.clearInputValues(),this.exitInputMode())},this._onCommit=(e,t)=>{if(this.destroyed)return;if(this.tooltip.emit("commit",{type:t}),"commit-and-exit"===t)return void this.exitInputMode();if("commit-on-blur"===t)return;const n=this._getFocusableElements(),i=n.length,r=n.indexOf(e);if(-1===r)return void this.exitInputMode();const o=((r+("commit-and-next"===t?1:-1))%i+i)%i;te(n.at(o))},this._onKeyDown=e=>{switch(e.code){case m.ac.next:return this._onNextKey(e);case m.ac.discard:return e.stopPropagation(),this._onDiscard()}}}get mode(){return this._mode}get _displayUnits(){const{displayUnits:e}=this.info.sketchOptions.values,t=(0,Y.c)(this.tooltip.view);return{length:e.length??t,verticalLength:e.verticalLength??t,area:e.area??t}}get _inputUnitInfos(){const e=this._messagesUnits,t=t=>({unit:t,abbreviation:(0,q.Cq)(e,t,"abbr")}),{inputUnits:n}=this.info.sketchOptions.values,i=(0,Y.c)(this.tooltip.view),r=n.length??i,o=n.verticalLength??i,s=n.area??i;return{length:t((0,l.wL)(r)),verticalLength:t((0,l.m5)(o)),area:t((0,l.tW)(s)),angle:t("degrees")}}get _formatters(){return this._getFormatters(this._messagesUnits,this._displayUnits)}get fieldContext(){return{formatters:this._formatters,inputUnitInfos:this._inputUnitInfos,messages:this._messagesTooltip,sketchOptions:this.info.sketchOptions,onCommit:this._onCommit,onDiscard:this._onDiscard}}render(){const{visibleElements:e}=this.info.sketchOptions.tooltips,t=this._renderedContent,n=this._renderedActions,i=this._renderedHelpMessage,r=t.length>0,o=r||!!i,s="input"===this.mode;return(0,H.K)("div",{class:(0,z.Ly)(A,s&&M),onkeydown:this._onKeyDown,tabIndex:-1},s&&o&&e.header?(0,H.K)("div",{class:O,"data-testid":"tooltip-header",key:"header",onpointerdown:this._onHeaderPointerDown},(0,H.K)("calcite-button",{appearance:"transparent","data-testid":"tooltip-back-button",iconFlipRtl:"both",iconStart:"chevron-left",key:"discard-button",kind:"neutral",onclick:this._onDiscard,scale:"s",tabIndex:-1}),n.length>0?(0,H.K)(H.w,null,(0,H.K)("div",{class:R,key:"spacer"}),(0,H.K)("div",{class:C,key:"actions"},n)):null):null,r?(0,H.K)("div",{class:P,key:"content"},...t):null,i)}destroy(){this._focusAbortController.abort(),this._transitionInfo?.transition.skipTransition()}_renderActions(){return null}loadDependencies(){return(0,Q.W)({button:()=>n.e(2974).then(n.bind(n,45399)),icon:()=>n.e(2525).then(n.bind(n,50855)),input:()=>n.e(2498).then(n.bind(n,21512))})}async enterInputMode(e,t){try{await this._transitionTo("input",t),await this._focusField(e)}catch(e){(0,Z.jH)(e)}}async exitInputMode({focusOnView:e=!0}={}){try{const{container:t,info:n}=this;n.clearInputValues();const i=e?t?.closest(".esri-view")?.querySelector(".esri-view-surface"):null;await this._transitionTo("feedback"),i instanceof HTMLElement&&i.focus()}catch(e){(0,Z.jH)(e)}}_onNextKey(e){const t=this._getFocusableElements(),n=t.at(0),i=t.at(-1);n&&i&&(e.shiftKey?document.activeElement===n&&(e.preventDefault(),e.stopPropagation(),te(i)):document.activeElement===i&&(e.preventDefault(),e.stopPropagation(),te(n)))}get _renderedContent(){return ne(this._renderContent())}get _renderedActions(){return ne(this._renderActions())}get _renderedHelpMessage(){const{sketchOptions:e,visibleElements:t}=this.info;if(!t.helpMessage)return null;const n=e.tooltips.helpMessage??this._defaultHelpMessage;if(!n)return null;const i=e.tooltips.helpMessageIcon??"information";return(0,H.K)("div",{class:D,key:"help-message"},i?(0,H.K)("calcite-icon",{class:N,icon:i,scale:"s"}):null,(0,H.K)("div",{class:L},n))}get _defaultHelpMessage(){const{helpMessage:e,viewType:t}=this.info;if(null==e)return null;const n="3d"===t?"helpMessages3d":"helpMessages2d";return this._messagesTooltip?.sketch?.[n]?.[e]}async _focusField(e){this._focusAbortController?.abort(),this._focusAbortController=new AbortController;const{signal:t}=this._focusAbortController;await this._waitForInputs(),(0,Z.Te)(t);const n=this._getFocusableInputs(),i=e?n.find((t=>t.getAttribute("data-field-name")===e)):n.at(0);await te(i)}async _transitionTo(e,t){if(this._mode===e&&!this._transitionInfo)return;if(this._transitionInfo?.mode===e)return this._transitionInfo.transition.finished;this._transitionInfo?.transition.skipTransition();const n=async()=>{this.destroyed||(this._mode=e,await(0,W.NO)(),this.destroyed||(this.renderNow(),await(0,W.NO)(),this.destroyed||t?.()))};if(!this.domNode?.firstChild||!document.startViewTransition||(0,$.O)())return void await n();this.autoRenderingEnabled=!1;const i=this._transitionInfo={transition:document.startViewTransition((async()=>{this.destroyed||i!==this._transitionInfo||(this.autoRenderingEnabled=!0,await n())})),mode:e};try{await i.transition.finished}finally{i===this._transitionInfo&&(this._transitionInfo=null)}}async _waitForInputs(){const e=()=>Array.from(this.domNode?.querySelectorAll("calcite-input")??[]);for(;0===e().length;)await(0,Z.Pl)(ie);await(0,W.$m)()}_getFocusableInputs(){return Array.from(this.domNode?.querySelectorAll("calcite-input:not([read-only]):not([disabled])")??[])}_getFocusableElements(){const e=this.domNode?.querySelector(`.${I}`);return[...Array.from(e?.querySelectorAll(`.${C} calcite-button:not([disabled])`)??[]),...this._getFocusableInputs()]}};async function te(e){await(e?.setFocus())}function ne(e){return(Array.isArray(e)?e:[e]).flat(10).filter((e=>!!e))}(0,_._)([(0,K.G)("esri/core/t9n/Units"),(0,x.MZ)()],ee.prototype,"_messagesUnits",void 0),(0,_._)([(0,K.G)("esri/views/interactive/tooltip/t9n/Tooltip"),(0,x.MZ)()],ee.prototype,"_messagesTooltip",void 0),(0,_._)([(0,x.MZ)()],ee.prototype,"info",void 0),(0,_._)([(0,x.MZ)()],ee.prototype,"tooltip",void 0),(0,_._)([(0,x.MZ)()],ee.prototype,"_mode",void 0),(0,_._)([(0,x.MZ)()],ee.prototype,"mode",null),(0,_._)([(0,x.MZ)()],ee.prototype,"_displayUnits",null),(0,_._)([(0,x.MZ)()],ee.prototype,"_inputUnitInfos",null),(0,_._)([(0,x.MZ)()],ee.prototype,"_formatters",null),(0,_._)([(0,x.MZ)()],ee.prototype,"fieldContext",null),(0,_._)([(0,x.MZ)()],ee.prototype,"_renderedContent",null),(0,_._)([(0,x.MZ)()],ee.prototype,"_renderedActions",null),(0,_._)([(0,x.MZ)()],ee.prototype,"_renderedHelpMessage",null),(0,_._)([(0,x.MZ)()],ee.prototype,"_defaultHelpMessage",null),ee=(0,_._)([(0,w.$)("esri.views.interactive.tooltip.content.TooltipContent")],ee);const ie=20;let re=class extends ee{_renderContent(){const{area:e,radius:t,xSize:n,ySize:i,visibleElements:r}=this.info,o=this._messagesTooltip.sketch,s=this._formatters;return(0,H.K)(H.w,null,r.radius&&null!=t?(0,H.K)(k,{title:o.radius,value:s.length(t)}):null,r.size&&null!=n&&null!=i?(0,H.K)(k,{title:o.size,value:(0,H.K)(G,{left:s.length(n),right:s.length(i)})}):null,r.area?(0,H.K)(k,{title:o.area,value:s.area(e)}):null)}};re=(0,_._)([(0,w.$)("esri.views.interactive.tooltip.content.TooltipContentDrawCircle")],re);const oe=`${E}-editable-field`,se={base:oe,inputMode:`${oe}--input`,feedbackMode:`${oe}--feedback`,readOnly:`${oe}--read-only`,locked:`${oe}--locked`,title:`${oe}__title`,value:`${oe}__value`,valueContent:`${oe}__value__content`,valueContentReadOnly:`${oe}__value__content--read-only`,lockIcon:`${oe}__lock-icon`,input:`${oe}__input`,inputSuffix:`${oe}__input-suffix`,button:`${oe}__button`},ae="lock";let le=class extends F.A{constructor(){super(...arguments),this._input=null,this._lock=null,this._onLockClick=()=>{this.field.toggleLock(this.context)},this._onLockAfterCreate=e=>{this._lock=e},this._onLockAfterRemoved=()=>{this._lock=null},this._onKeyDown=e=>{e.key===m.ac.discard&&"input"===this.mode&&this._input&&this.context.onDiscard(this._input)},this._onInputKeyDown=e=>{const t=this._input;if(t)switch(e.key){case m.ac.commit:return this.field.onCommit("commit-and-exit",t,this.context);case m.ac.next:{e.preventDefault(),e.stopPropagation();const n=e.shiftKey?"commit-and-previous":"commit-and-next";return this.field.onCommit(n,t,this.context)}}},this._onInput=e=>{this.field.onInput(e.target.value)},this._onInputBlur=e=>{const t=this._input;t&&e.relatedTarget!==this._lock&&this.field.onCommit("commit-on-blur",t,this.context)},this._selectText=()=>{const e=()=>{this._input===document.activeElement&&this._input?.selectText()};e(),(0,W.$m)().then(e)},this._onAfterCreate=e=>{this._input=e,e.addEventListener("paste",this._onPaste),e.addEventListener("beforeinput",this._onBeforeInput)},this._onAfterRemoved=e=>{e.removeEventListener("paste",this._onPaste),e.removeEventListener("beforeinput",this._onBeforeInput)},this._onPaste=e=>{const t=e.clipboardData?.getData("text");t&&null!=this.field.parse(t,this.context)&&(e.stopPropagation(),this.field.onInput(t))},this._onBeforeInput=e=>{("historyUndo"===e.inputType||"historyRedo"===e.inputType)&&!this.field.dirty&&e.preventDefault()}}initialize(){this.addHandles((0,a.watch)((()=>this._rawDisplayValue),(()=>{const{committed:e,inputValue:t}=this.field;e||t||this._input!==document.activeElement||this._selectText()})))}loadDependencies(){return(0,Q.W)({button:()=>n.e(2974).then(n.bind(n,45399)),icon:()=>n.e(2525).then(n.bind(n,50855)),input:()=>n.e(2498).then(n.bind(n,21512))})}render(){const{field:e,mode:t}=this,n="input"===t,{locked:i,readOnly:r}=e;return(0,H.K)("div",{class:this.classes({[se.base]:!0,[se.feedbackMode]:"feedback"===t,[se.inputMode]:"input"===t,[se.locked]:i,[se.readOnly]:r})},(0,H.K)("div",{class:se.title,key:"title"},this._title),(0,H.K)("div",{class:se.value,key:"value",onkeydown:this._onKeyDown},n?this._renderValueInputMode():this._renderValueFeedbackMode()))}get _formattedValue(){return this.field.getFormattedValue(this.context)||ce}get _rawDisplayValue(){return this.field.getRawDisplayValue(this.context)}get _suffix(){return this.field.getSuffix(this.context)}get _title(){const{title:e}=this.field;return"string"==typeof e?e:e(this.context)}_renderValueFeedbackMode(){return(0,H.K)(H.w,null,(0,H.K)("div",{class:se.valueContent,key:"value-feedback"},this._formattedValue),this.field.locked&&"input"!==this.mode?(0,H.K)("calcite-icon",{class:se.lockIcon,icon:ae,key:"icon",scale:"s"}):null)}_renderValueInputMode(){return this.field.readOnly?this._renderValueReadOnly():this._renderValueWritable()}_renderValueReadOnly(){return(0,H.K)("div",{class:this.classes(se.valueContent,se.valueContentReadOnly),key:"value-read-only"},this._formattedValue)}_renderValueWritable(){const{field:e}=this,{name:t,invalid:n,locked:i}=e,r=this.context?.messages.sketch??{},o=i?r.unlockConstraint:r.lockConstraint;return(0,H.K)(H.w,null,(0,H.K)("calcite-input",{afterCreate:this._onAfterCreate,afterRemoved:this._onAfterRemoved,class:se.input,"data-field-name":t,"data-testid":`tooltip-field-${t}`,key:"input",onblur:this._onInputBlur,onfocus:this._selectText,onkeydown:this._onInputKeyDown,scale:"s",status:n?"invalid":"idle",type:"text",value:this._rawDisplayValue??ce,onCalciteInputInput:this._onInput}),(0,H.K)("div",{class:se.inputSuffix,key:"suffix"},this._suffix),e.lockable?(0,H.K)("calcite-button",{afterCreate:this._onLockAfterCreate,afterRemoved:this._onLockAfterRemoved,alignment:"center",appearance:"transparent",class:se.button,"data-testid":`tooltip-field-${t}-lock`,iconStart:i?ae:"unlock",key:"lock",kind:"neutral",label:o,onclick:this._onLockClick,scale:"s",tabIndex:-1,title:o}):(0,H.K)("div",{key:"lock-empty"}))}};(0,_._)([(0,x.MZ)()],le.prototype,"field",void 0),(0,_._)([(0,x.MZ)()],le.prototype,"context",void 0),(0,_._)([(0,x.MZ)()],le.prototype,"mode",void 0),(0,_._)([(0,x.MZ)()],le.prototype,"_input",void 0),(0,_._)([(0,x.MZ)()],le.prototype,"_lock",void 0),(0,_._)([(0,x.MZ)()],le.prototype,"_formattedValue",null),(0,_._)([(0,x.MZ)()],le.prototype,"_rawDisplayValue",null),(0,_._)([(0,x.MZ)()],le.prototype,"_suffix",null),(0,_._)([(0,x.MZ)()],le.prototype,"_title",null),le=(0,_._)([(0,w.$)("esri.views.interactive.tooltip.components.TooltipEditableField")],le);const ce="—";function ue(e){const t=e.fields.filter((e=>!0===e?.visible));return 0===t.length?null:(0,H.K)(H.w,null,t.map((t=>(0,H.K)(le,{context:e.context,field:t,key:t.id,mode:e.mode}))))}let he=class extends ee{_renderContent(){const{fieldContext:e,info:t,mode:n}=this,{visibleElements:i}=t;return(0,H.K)(ue,{context:e,fields:[i.coordinates?t.effectiveX:void 0,i.coordinates?t.effectiveY:void 0,i.elevation?t.elevation:void 0,i.orientation?t.orientation:void 0,i.scale?t.scale:void 0],mode:n})}};he=(0,_._)([(0,w.$)("esri.views.interactive.tooltip.content.TooltipContentDrawMesh")],he);let de=class extends ee{_renderContent(){const{fieldContext:e,info:t,mode:n}=this,{elevation:i,visibleElements:r}=t;return(0,H.K)(ue,{context:e,fields:[r.coordinates?t.effectiveX:void 0,r.coordinates?t.effectiveY:void 0,r.elevation?i:void 0],mode:n})}};de=(0,_._)([(0,w.$)("esri.views.interactive.tooltip.content.TooltipContentDrawPoint")],de);const pe={absolute:"absolute-direction",relative:"relative-direction"};let fe=class extends F.A{constructor(e){super(e),this.visibleElements={}}render(){return(0,H.K)("div",{class:I},this._isElementVisible("direction")?(0,H.K)(ge,{messages:this.messages,sketchOptions:this.sketchOptions}):null)}loadDependencies(){return(0,Q.W)({button:()=>n.e(2974).then(n.bind(n,45399)),dropdown:()=>n.e(7209).then(n.bind(n,94794)),"dropdown-item":()=>n.e(2547).then(n.bind(n,79383)),"dropdown-group":()=>n.e(951).then(n.bind(n,96361))})}_isElementVisible(e){return this.visibleElements?.[e]??this.sketchOptions.tooltips.visibleElements[e]}};function ge(e){const{directionMode:t}=e.sketchOptions.values,n=e.messages?.sketch,i=n?.directionModeSelect?.title,r="absolute",o="relative";return(0,H.K)("calcite-dropdown",{key:"direction-mode",placement:"bottom-end",scale:"s",widthScale:"s",onCalciteDropdownSelect:t=>{const n=t.target.selectedItems?.[0]?.getAttribute("data-mode");e.sketchOptions.values.directionMode=n??"absolute"}},(0,H.K)("calcite-button",{alignment:"end",appearance:"transparent",iconStart:pe[t],kind:"neutral",label:i,scale:"s",slot:"trigger",title:i}),(0,H.K)("calcite-dropdown-group",{selectionMode:"single"},(0,H.K)("calcite-dropdown-item",{"data-mode":o,"data-testid":"tooltip-direction-mode-relative",iconStart:pe.relative,key:"relative",selected:t===o},n?.directionModeSelect?.relative),(0,H.K)("calcite-dropdown-item",{"data-mode":r,"data-testid":"tooltip-direction-mode-absolute",iconStart:pe.absolute,key:"absolute",selected:t===r},n?.directionModeSelect?.absolute)))}(0,_._)([(0,K.G)("esri/views/interactive/tooltip/t9n/Tooltip"),(0,x.MZ)()],fe.prototype,"messages",void 0),(0,_._)([(0,x.MZ)()],fe.prototype,"sketchOptions",void 0),(0,_._)([(0,x.MZ)()],fe.prototype,"visibleElements",void 0),fe=(0,_._)([(0,w.$)("esri.views.interactive.tooltip.components.DrawHeaderActions")],fe);let me=class extends ee{_renderContent(){const{fieldContext:e,info:t,mode:n}=this,{xyMode:i,visibleElements:r}=t;return(0,H.K)(ue,{context:e,fields:[..."direction-distance"===i?[r.direction?t.direction:void 0,r.distance?t.distance:void 0]:[r.coordinates?t.effectiveX:void 0,r.coordinates?t.effectiveY:void 0],r.elevation?t.elevation:void 0,r.area?t.area:void 0],mode:n})}_renderActions(){const{xyMode:e,sketchOptions:t}=this.info;return(0,H.K)(fe,{sketchOptions:t,visibleElements:{direction:"direction-distance"===e}})}};me=(0,_._)([(0,w.$)("esri.views.interactive.tooltip.content.TooltipContentDrawPolygon")],me);let _e=class extends ee{_renderContent(){const{fieldContext:e,info:t,mode:n}=this,{xyMode:i,visibleElements:r}=t;return(0,H.K)(ue,{context:e,fields:[..."direction-distance"===i?[r.direction?t.direction:void 0,r.distance?t.distance:void 0]:[r.coordinates?t.effectiveX:void 0,r.coordinates?t.effectiveY:void 0],r.elevation?t.elevation:void 0,r.totalLength?t.totalLength:void 0],mode:n})}_renderActions(){const{xyMode:e,sketchOptions:t}=this.info;return(0,H.K)(fe,{sketchOptions:t,visibleElements:{direction:"direction-distance"===e}})}};_e=(0,_._)([(0,w.$)("esri.views.interactive.tooltip.content.TooltipContentDrawPolyline")],_e);let ve=class extends ee{_renderContent(){const{area:e,xSize:t,ySize:n,visibleElements:i}=this.info,r=this._messagesTooltip.sketch,o=this._formatters;return(0,H.K)(H.w,null,i.size&&null!=t&&null!=n?(0,H.K)(k,{title:r.size,value:(0,H.K)(G,{left:o.length(t),right:o.length(n)})}):null,i.area?(0,H.K)(k,{title:r.area,value:o.area(e)}):null)}};ve=(0,_._)([(0,w.$)("esri.views.interactive.tooltip.content.TooltipContentDrawRectangle")],ve);let ye=class extends ee{_renderContent(){const{angle:e,visibleElements:t}=this.info,n=this._messagesTooltip.sketch;return(0,H.K)(H.w,null,t.rotation?(0,H.K)(k,{title:n.rotation,value:this._formatters.angleRelative(e)}):null)}};ye=(0,_._)([(0,w.$)("esri.views.interactive.tooltip.content.TooltipContentExtentRotate")],ye);let be=class extends ee{_renderContent(){const e=this.info,{visibleElements:t}=e,n=this._messagesTooltip.sketch,i=this._formatters;return(0,H.K)(H.w,null,t.size?(0,H.K)(k,{title:n.size,value:(0,H.K)(G,{left:i.length(e.xSize),right:i.length(e.ySize)})}):null,t.scale?(0,H.K)(k,{title:n.scale,value:(0,H.K)(G,{left:i.scale(e.xScale),right:i.scale(e.yScale)})}):null)}};be=(0,_._)([(0,w.$)("esri.views.interactive.tooltip.content.TooltipContentExtentScale")],be);let Te=class extends ee{_renderContent(){const{fieldContext:e,info:t,mode:n}=this,{visibleElements:i}=t;return(0,H.K)(ue,{context:e,fields:[i.coordinates?t.effectiveX:void 0,i.coordinates?t.effectiveY:void 0,i.elevation?t.elevation:void 0],mode:n})}};Te=(0,_._)([(0,w.$)("esri.views.interactive.tooltip.content.TooltipContentMovePoint")],Te);let xe=class extends ee{_renderContent(){const{fieldContext:e,info:t,mode:n}=this,{visibleElements:i}=t;return(0,H.K)(ue,{context:e,fields:[i.distance?t.distance:void 0,i.area?t.area:void 0,i.totalLength?t.totalLength:void 0],mode:n})}};xe=(0,_._)([(0,w.$)("esri.views.interactive.tooltip.content.TooltipContentReshapeEdgeOffset")],xe);let we=class extends ee{_renderContent(){const{fieldContext:e,info:t,mode:n}=this,{visibleElements:i}=t;return(0,H.K)(ue,{context:e,fields:[i.coordinates?t.effectiveX:void 0,i.coordinates?t.effectiveY:void 0,i.elevation?t.elevation:void 0,i.area&&"polygon"===t.geometryType?t.area:null,i.totalLength&&"polyline"===t.geometryType?t.totalLength:null],mode:n})}};we=(0,_._)([(0,w.$)("esri.views.interactive.tooltip.content.TooltipContentSelectedVertex")],we);let Se=class extends ee{_renderContent(){const{fieldContext:e,info:t,mode:n}=this,{visibleElements:i}=t;return(0,H.K)(ue,{context:e,fields:[i.coordinates?t.effectiveX:void 0,i.coordinates?t.effectiveY:void 0,i.elevation?t.elevation:void 0,i.orientation?t.orientation:void 0,i.scale?t.scale:void 0],mode:n})}};Se=(0,_._)([(0,w.$)("esri.views.interactive.tooltip.content.TooltipContentTransformMesh")],Se);let Ee=class extends ee{_renderContent(){const{fieldContext:e,info:t,mode:n}=this,{visibleElements:i}=t;return(0,H.K)(ue,{context:e,fields:[i.coordinates?t.effectiveX:void 0,i.coordinates?t.effectiveY:void 0,i.elevation?t.elevation:void 0,i.orientation?t.orientation:void 0,i.size?t.size:void 0],mode:n})}};Ee=(0,_._)([(0,w.$)("esri.views.interactive.tooltip.content.TooltipContentTransformPoint")],Ee);let Ae=class extends ee{_renderContent(){const{info:e}=this,{visibleElements:t}=e,n=this._messagesTooltip.sketch,i=this._formatters;return(0,H.K)(H.w,null,t.distance?(0,H.K)(k,{title:n.distance,value:i.length(e.distance)}):null)}};Ae=(0,_._)([(0,w.$)("esri.views.interactive.tooltip.content.TooltipContentTranslate")],Ae);let Me=class extends ee{_renderContent(){const{distance:e,elevation:t,area:n,totalLength:i,visibleElements:r}=this.info,o=this._messagesTooltip.sketch,s=this._formatters;return(0,H.K)(H.w,null,r.distance?(0,H.K)(k,{title:o.distance,value:s.length(e)}):null,r.elevation&&null!=t?.actual?(0,H.K)(k,{title:o.elevation,value:s.verticalLength(t.actual)}):null,r.area&&null!=n?(0,H.K)(k,{title:o.area,value:s.area(n)}):null,r.totalLength&&null!=i?(0,H.K)(k,{title:o.totalLength,value:s.length(i)}):null)}};Me=(0,_._)([(0,w.$)("esri.views.interactive.tooltip.content.TooltipContentTranslateVertex")],Me);let Oe=class extends ee{_renderContent(){const{info:e}=this,{visibleElements:t}=e,n=this._messagesTooltip.sketch,i=this._formatters;return(0,H.K)(H.w,null,t.distance?(0,H.K)(k,{title:n.distance,value:i.length(e.distance)}):null)}};Oe=(0,_._)([(0,w.$)("esri.views.interactive.tooltip.content.TooltipContentTranslateXY")],Oe);let Re=class extends ee{_renderContent(){const{info:e}=this,{visibleElements:t}=e,n=this._messagesTooltip.sketch;return(0,H.K)(H.w,null,t.distance?(0,H.K)(k,{title:n.distance,value:this._formatters.verticalLengthRelative(e.distance)}):null)}};Re=(0,_._)([(0,w.$)("esri.views.interactive.tooltip.content.TooltipContentTranslateZ")],Re);const Ce={base:`${E}`,ltr:`${E}--ltr`,rtl:`${E}--rtl`,debug:`${E}--debug`};let Ie=class extends v.A.EventedAccessor{constructor(e){super(e),this.info=null,this.options=null,this.position=null,this.content=null,this._focused=!1,this.outerContainer=document.createElement("div"),this.debug=!1,this._lastPosition=null,this._rtl=!1,this._prevXY=[0,0]}initialize(){const{outerContainer:e}=this;this.addHandles([(0,a.watch)((()=>this.view.overlay?.surface),(t=>{e.remove(),t?.appendChild(e),this._rtl=(0,z.V8)(t)}),a.pc),(0,a.watch)((()=>this.info),((t,n)=>{if(null!=this.content&&null!=t&&null!=n&&t.type===n.type)this.content.info=t;else{(0,b.pR)(this.content);const n=function(e,t){if(null==t)return null;const n=document.createElement("div");switch(t.type){case"draw-point":return new de({tooltip:e,info:t,container:n});case"draw-polygon":return new me({tooltip:e,info:t,container:n});case"draw-polyline":return new _e({tooltip:e,info:t,container:n});case"draw-mesh":return new he({tooltip:e,info:t,container:n});case"draw-rectangle":return new ve({tooltip:e,info:t,container:n});case"draw-circle":return new re({tooltip:e,info:t,container:n});case"extent-rotate":return new ye({tooltip:e,info:t,container:n});case"extent-scale":return new be({tooltip:e,info:t,container:n});case"move-point":return new Te({tooltip:e,info:t,container:n});case"selected-vertex":return new we({tooltip:e,info:t,container:n});case"transform-point":return new Ee({tooltip:e,info:t,container:n});case"transform-mesh":return new Se({tooltip:e,info:t,container:n});case"translate":return new Ae({tooltip:e,info:t,container:n});case"translate-vertex":return new Me({tooltip:e,info:t,container:n});case"translate-z":return new Re({tooltip:e,info:t,container:n});case"translate-xy":return new Oe({tooltip:e,info:t,container:n});case"reshape-edge-offset":return new xe({tooltip:e,info:t,container:n})}}(this,t);n?(this.content=n,n.container&&e.appendChild(n.container),this.exitInputMode()):this.content=null}}),a.pc),(0,a.watch)((()=>({container:this.outerContainer,style:this._outerContainerStyle})),(({container:e,style:t})=>{Object.assign(e.style,t)}),a.Vh),(0,a.watch)((()=>({outerContainer:this.outerContainer,placement:this.effectivePlacement,effectiveOffset:this._effectiveOffset,rtl:this._rtl,debug:this.debug})),(({outerContainer:e,placement:t,effectiveOffset:n,rtl:i,debug:r})=>{const{classList:o}=e;o.add(Ce.base),o.toggle(Ce.rtl,i),o.toggle(Ce.ltr,!i),o.toggle(Ce.debug,r),this.outerContainer.style.setProperty("--offset",`${n}px`),(0,S.hY)(e),function({classList:e},t){Pe.forEach((t=>e.remove(t))),e.add(De(t))}(e,t)}),a.Vh),(0,a.when)((()=>"feedback"===this.mode),(()=>{this.position=null,this._clearOverride("effectivePlacement")}),a.OH),(0,y.on)(this.outerContainer,"paste",(e=>{this.emit("paste",e)})),(0,y.on)(this.outerContainer,["focusin","focusout"],(()=>{setTimeout((()=>{this._focused=this.content?.container?.contains(document.activeElement)??!1}))}))])}destroy(){this.info=null,this.content=(0,b.pR)(this.content),this.outerContainer.remove()}get mode(){return this.content?.mode??"feedback"}get focused(){return this._focused}get visible(){return"none"!==this._outerContainerStyle.display}get contentContainer(){return this.content?.container}get effectivePlacement(){const e=this.options?.placement;return"auto"===e?"bottom-end":e??"bottom-end"}get _screenPoint(){const{inputManager:e}=this.view;return e?.multiTouchActive?null:e?.latestPointerLocation}get _effectiveOffset(){return this.options?.offset??20}get _outerContainerStyle(){const e=this.position??this._screenPoint;return this._lastPosition=(0,T.y8)(e),null!=e&&null!=this.content?{display:"block",transform:`translate(${Math.round(e.x)}px, ${Math.round(e.y)}px)`}:{display:"none",transform:"none"}}clear(){this.info=null}async enterInputMode(e){const t=this.position??this._lastPosition??this._screenPoint,n=this.position=(0,T.y8)(t),{effectivePlacement:i}=this;this._override("effectivePlacement",i),await(this.content?.enterInputMode(e,(()=>{n&&(this.position=function(e,t,n,i){if(!e||!i.container)return t;const r=e.getBoundingClientRect(),{left:o,top:s}=i.container.getBoundingClientRect();let{x:a,y:l}=t;const c=r.left-o-n;c<0&&(a-=c);const u=r.right-o+n-i.width;u>0&&(a-=u);const h=r.top-s-n;h<0&&(l-=h);const d=r.bottom-s+n-i.height;return d>0&&(l-=d),(0,T.tc)(a,l)}(this.contentContainer,n,this._effectiveOffset,this.view),Object.assign(this.outerContainer.style,this._outerContainerStyle))})))}async exitInputMode(e){await(this.content?.exitInputMode(e))}onDragStart(e,t){this._prevXY=[e,t]}onDrag(e,t){const n=e-this._prevXY[0],i=t-this._prevXY[1];this._prevXY=[e,t];const{position:r}=this;if(r){const{view:o}=this,s=e-o.position[0],a=t-o.position[1];if(s<0||s>o.width||a<0||a>o.height-16)return;this.position=(0,T.tc)(r.x+n,r.y+i)}}onDragEnd(){this._prevXY=[0,0]}};(0,_._)([(0,x.MZ)({nonNullable:!0})],Ie.prototype,"view",void 0),(0,_._)([(0,x.MZ)()],Ie.prototype,"info",void 0),(0,_._)([(0,x.MZ)()],Ie.prototype,"options",void 0),(0,_._)([(0,x.MZ)()],Ie.prototype,"position",void 0),(0,_._)([(0,x.MZ)()],Ie.prototype,"content",void 0),(0,_._)([(0,x.MZ)({readOnly:!0})],Ie.prototype,"mode",null),(0,_._)([(0,x.MZ)()],Ie.prototype,"_focused",void 0),(0,_._)([(0,x.MZ)({readOnly:!0})],Ie.prototype,"focused",null),(0,_._)([(0,x.MZ)({readOnly:!0})],Ie.prototype,"outerContainer",void 0),(0,_._)([(0,x.MZ)({readOnly:!0})],Ie.prototype,"contentContainer",null),(0,_._)([(0,x.MZ)({readOnly:!0})],Ie.prototype,"effectivePlacement",null),(0,_._)([(0,x.MZ)()],Ie.prototype,"debug",void 0),(0,_._)([(0,x.MZ)()],Ie.prototype,"_lastPosition",void 0),(0,_._)([(0,x.MZ)()],Ie.prototype,"_screenPoint",null),(0,_._)([(0,x.MZ)()],Ie.prototype,"_rtl",void 0),(0,_._)([(0,x.MZ)()],Ie.prototype,"_effectiveOffset",null),(0,_._)([(0,x.MZ)()],Ie.prototype,"_outerContainerStyle",null),Ie=(0,_._)([(0,w.$)("esri.views.interactive.Tooltip")],Ie);const Pe=["top","bottom","leading","trailing"].flatMap((e=>[De(`${e}-start`),De(e),De(`${e}-end`)]));function De(e){return`${Ce.base}--${e}`}const Le=Ie;var Ne=n(99675);function Fe(e){const t=new Le(e());return t.addHandles((0,a.watch)((()=>e()),(({view:e,options:n,info:i})=>{t.view=e,void 0!==n&&(t.options=n),void 0!==i&&(t.info=i)}))),t}function ze(e,t){const n=(0,p.Hq)(t.vertexSpace),{scale:i,orientation:r}=e,{transform:o}=t,a=function(e){if(!e)return 0;const t=ke(e.rotationAxis);return null!=t?t*e.rotationAngle:null}(o);n&&null!=a?(r.actual=(0,s.Wq)(a,"degrees","arithmetic"),r.visible=!0):(r.actual=null,r.visible=!1),n?(i.actual=(0,s.LF)(Ge(o)),i.visible=!0):(i.actual=null,i.visible=!1)}function He(e,t,n){if(!t||!(0,p.Hq)(t.vertexSpace))return;const i=t.transform??=new d.A;(function(e,t,n){const i=(0,Ne.Ef)(e.orientation.actual),r=ke(t.rotationAxis);if(null==i||null==r)return;const o=t.rotationAngle,s=i*r,a=(i-o)*r;o!==s&&(n?.onRotateStart(0),t.rotationAngle=s,n?.onRotate(a),n?.onRotateStop(a))})(e,i,n),function(e,t,n){const i=e.scale.actual?.value,r=Ge(t);if(null==i||i===r)return;const{scale:o}=t;let s;if(0===r)s=(0,u.o8)(u.Un);else{const e=i/r;s=(0,c.h)((0,u.vt)(),o,e)}n?.onScaleStart(o[0],o[1],o[2]),t.scale=s,n?.onScale(s[0],s[1],s[2]),n?.onScaleStop(s[0],s[1],s[2])}(e,i,n)}function Ve(e,t){const{x:n,y:i,z:r}=t,{x:a,y:c,z:u}=function(e,t){let n,i;e.geographic?(n=(0,Ne.hF)(e.longitude.actual),i=(0,Ne.hF)(e.latitude.actual),(0,f.K8)(t)&&(null!=n&&null!=i?[n,i]=(0,g.je)(n,i,Ue):null!=n?n=(0,g.je)(n,0,Ue)[0]:null!=i&&(i=(0,g.je)(0,i,Ue)[1]))):(n=e.x.actual?.value,i=e.y.actual?.value);const r=e.elevation.actual,o=(0,l.mq)(t);return{x:n,y:i,z:null!=o&&null!=r?(0,s.l3)(r,o):void 0}}(e,t.spatialReference);return{dx:null==a||(0,o.Io)(a,n)?0:a-n,dy:null==c||(0,o.Io)(c,i)?0:c-i,dz:null==u||null==r||(0,o.Io)(u,r)?0:u-r}}const Ue=[0,0];function ke(e){return(0,c.H)(e,u.Cb)?1:(0,c.H)(e,Be)?-1:null}const Be=(0,c.v)((0,u.vt)(),u.Cb);function Ge(e){return e?Math.max(...e.scale):1}function $e(e,t){return!("key-down"!==e.type||e.key!==m.ac.enterInputMode||!t||!function(e){const t=e?.sketchOptions;if(!t)return!1;const{inputEnabled:n,visibleElements:i}=t.tooltips;return n&&!0===e.editableFields.some((({name:e})=>"x"===e||"y"===e?i.coordinates:i[e]))}(t.info)||(t.enterInputMode(),e.preventDefault(),e.stopPropagation(),0))}function je(e,t){let n=null;return(0,r.vE)([e.on("paste",(async r=>{n?.abort(),n=(0,i.UT)((async()=>{(0,h.s1)()||await(0,h.Hh)(),Ze(r,e.info,t)}))})),(0,i.UT)((()=>(0,h.Hh)())),(0,r.hA)((()=>n?.abort()))])}function Ze(e,t,n){if(!t||!("geographic"in t))return;const i=e.clipboardData?.getData("text");if(!i)return;const r=t=>{e.stopPropagation(),e.preventDefault(),n?.onBeforePaste(),t(),n?.onAfterPaste()};if(t.geographic){const e=(0,X.X3)(i);e&&r((()=>{t.longitude.applyValue(e.longitude),t.latitude.applyValue(e.latitude)}))}else{const e=(0,X.Nr)(i);e&&r((()=>{t.x.applyValue(e.x),t.y.applyValue(e.y)}))}}},82854:function(e,t,n){"use strict";n.d(t,{Tv:function(){return l},Zs:function(){return o},cD:function(){return a},cz:function(){return h},fT:function(){return r},lH:function(){return u},mA:function(){return s},n4:function(){return c}});var i=n(52874);const r=new i.A("cyan"),o=1,s=.25,a=(new i.A("black"),.25),l="default",c="temporary",u=new i.A("yellow"),h=8},81197:function(e,t,n){"use strict";var i;n.d(t,{M:function(){return i}}),function(e){e[e.ANIMATING=0]="ANIMATING",e[e.INTERACTING=1]="INTERACTING",e[e.IDLE=2]="IDLE"}(i||(i={}))},48961:function(e,t,n){"use strict";n.d(t,{Bb:function(){return O},W6:function(){return i},mj:function(){return v},nu:function(){return R}});var i,r,o=n(14606),s=(n(58941),n(40633)),a=n(95929),l=n(69739),c=n(7187),u=n(60539),h=n(28181),d=n(85445),p=n(38504),f=n(47558),g=n(16164),m=n(81197),_=n(55213);function v(){return new A.Scheduler}(r=i||(i={})).RESOURCE_CONTROLLER_IMMEDIATE="immediate",r.RESOURCE_CONTROLLER="schedule",r.SLIDE="slide",r.STREAM_DATA_LOADER="stream loader",r.ELEVATION_QUERY="elevation query",r.TERRAIN_SURFACE="terrain",r.SURFACE_GEOMETRY_UPDATES="surface geometry updates",r.LOD_RENDERER="LoD renderer",r.GRAPHICS_CORE="Graphics3D",r.I3S_CONTROLLER="I3S",r.POINT_CLOUD_LAYER="point cloud",r.FEATURE_TILE_FETCHER="feature fetcher",r.OVERLAY="overlay",r.STAGE="stage",r.GRAPHICS_DECONFLICTOR="graphics deconflictor",r.FILTER_VISIBILITY="Graphics3D filter visibility",r.SCALE_VISIBILITY="Graphics3D scale visibility",r.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",r.POINT_OF_INTEREST_FREQUENT="POI frequent",r.POINT_OF_INTEREST_INFREQUENT="POI infrequent",r.LABELER="labeler",r.FEATURE_QUERY_ENGINE="feature query",r.FEATURE_TILE_TREE="feature tile tree",r.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",r.ELEVATION_ALIGNMENT="elevation alignment",r.ELEVATION_ALIGNMENT_SCENE="elevation alignment scene",r.TEXT_TEXTURE_ATLAS="text texture atlas",r.TEXTURE_UNLOAD="texture unload",r.LINE_OF_SIGHT_TOOL="line of sight tool",r.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",r.ELEVATION_PROFILE="elevation profile",r.SNAPPING="snapping",r.SHADOW_ACCUMULATOR="shadow accumulator",r.CLOUDS_GENERATOR="clouds generator",r.MAPVIEW_FETCH_QUEUE="mapview fetch queue",r.MAPVIEW_LAYERVIEW_UPDATE="mapview layerview update",r.MAPVIEW_VECTOR_TILE_PARSING_QUEUE="mapview vector tile parsing queue",r[r.NONE=0]="NONE",r[r.TEST_PRIO=1]="TEST_PRIO";const y=new Map([[i.RESOURCE_CONTROLLER_IMMEDIATE,0],[i.RESOURCE_CONTROLLER,4],[i.SLIDE,0],[i.STREAM_DATA_LOADER,0],[i.ELEVATION_QUERY,0],[i.TERRAIN_SURFACE,1],[i.SURFACE_GEOMETRY_UPDATES,1],[i.LOD_RENDERER,2],[i.GRAPHICS_CORE,2],[i.I3S_CONTROLLER,2],[i.POINT_CLOUD_LAYER,2],[i.FEATURE_TILE_FETCHER,2],[i.CLOUDS_GENERATOR,2],[i.OVERLAY,4],[i.STAGE,4],[i.GRAPHICS_DECONFLICTOR,4],[i.FILTER_VISIBILITY,4],[i.SCALE_VISIBILITY,4],[i.FRUSTUM_VISIBILITY,4],[i.POINT_OF_INTEREST_FREQUENT,6],[i.POINT_OF_INTEREST_INFREQUENT,30],[i.LABELER,8],[i.FEATURE_QUERY_ENGINE,8],[i.FEATURE_TILE_TREE,16],[i.FEATURE_TILE_TREE_ACTIVE,0],[i.ELEVATION_ALIGNMENT,12],[i.ELEVATION_ALIGNMENT_SCENE,14],[i.TEXT_TEXTURE_ATLAS,12],[i.TEXTURE_UNLOAD,12],[i.LINE_OF_SIGHT_TOOL,16],[i.LINE_OF_SIGHT_TOOL_INTERACTIVE,0],[i.SNAPPING,0],[i.SHADOW_ACCUMULATOR,30],[i.MAPVIEW_FETCH_QUEUE,0],[i.MAPVIEW_LAYERVIEW_UPDATE,2],[i.MAPVIEW_VECTOR_TILE_PARSING_QUEUE,0]]);function b(e){return y.has(e)?y.get(e):"number"==typeof e?e:1}const T=(0,p.l5)(6.5),x=(0,p.l5)(1),w=(0,p.l5)(30),S=(0,p.l5)(1e3/30),E=(0,p.l5)(100);var A,M;!function(e){e.Scheduler=class{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some((e=>e.needsUpdate))}constructor(){this._updating=(0,d.v)(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new l.A("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new n,this._state=m.M.INTERACTING,this._tasks=new c.A,this._runQueue=new c.A,this._load=0,this._idleStateCallbacks=new c.A,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=(0,h.watch)((()=>g.A.SCHEDULER_LOG_SLOW_TASKS),(e=>this._debug=e),h.Vh);for(const e of Object.keys(i))this.performanceInfo.tasks.set(i[e],new l.A(i[e]))}destroy(){this._tasks.toArray().forEach((e=>e.remove())),this._tasks.clear(),(0,a.xt)(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(e){this._updatingChanged(),e&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask((()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this.frame())})))}registerTask(e,n){const i=new t(this,e,n);return this._tasks.push(i),this._updatingChanged(),this.performanceInfo.tasks.has(e)||this.performanceInfo.tasks.set(e,new l.A(e)),i}registerIdleStateCallbacks(e,t){const n={idleBegin:e,idleEnd:t};this._idleStateCallbacks.push(n),this.state===m.M.IDLE&&this._idleUpdatesStartFired&&n.idleBegin();const i=this;return{remove:()=>this._removeIdleStateCallbacks(n),set idleBegin(e){i._idleUpdatesStartFired&&(n.idleEnd(),i._state===m.M.IDLE&&e()),n.idleBegin=e},set idleEnd(e){n.idleEnd=e}}}get load(){return this._load}set state(e){this._state!==e&&(this._state=e,this.state!==m.M.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll((e=>e.idleEnd()))))}get state(){return this._state}updateBudget(e){this._test&&(this._test.usedBudget=0),++this._frameNumber;let t=T,n=e.frameDuration,i=x;switch(this.state){case m.M.IDLE:t=(0,p.l5)(0),n=(0,p.l5)(Math.max(E,e.frameDuration)),i=w;break;case m.M.INTERACTING:n=(0,p.l5)(Math.max(S,e.frameDuration));case m.M.ANIMATING:}return n=(0,p.l5)(n-e.elapsedFrameTime-t),this.state!==m.M.IDLE&&n<x&&!this._forceTask?(this._forceTask=!0,!1):(n=(0,p.l5)(Math.max(n,i)),this._budget.reset(n,this.state),this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case m.M.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll((e=>e.idleBegin()))),this._runIdle();break;case m.M.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test&&(this._test.usedBudget=this._budget.elapsed)}stopFrame(){this._budget.reset((0,p.l5)(0),this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(e){this._idleUpdatesStartFired&&e.idleEnd(),this._idleStateCallbacks.removeUnordered(e)}removeTask(e){this._tasks.removeUnordered(e),this._runQueue.removeUnordered(e),this._updatingChanged()}_updateTask(e){this._tasks.forAll((t=>{t.name===e&&t.setPriority(e)}))}_getState(e){if(this._runQueue.some((t=>t.name===e)))return M.SCHEDULED;let t=M.IDLE;return this._tasks.forAll((n=>{n.name===e&&n.needsUpdate&&(n.schedulePriority<=1?t=M.READY:t!==M.READY&&(t=M.WAITING))})),t}_getRuntime(e){let t=0;return this._tasks.forAll((n=>{n.name===e&&(t+=n.runtime)})),t}_resetRuntimes(){this._tasks.forAll((e=>e.runtime=0))}_getRunning(){const e=new Map;if(this._tasks.forAll((t=>{t.needsUpdate&&e.set(t.name,(e.get(t.name)||0)+1)})),0===e.size)return null;let t="";return e.forEach(((e,n)=>{t+=e>1?` ${e}x ${n}`:` ${n}`})),t}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const e=this._tasks.reduce(((e,t)=>t.needsUpdate?++e:e),0);this._load=.9*this._load+e*(1-.9)}_schedule(){for(this._runQueue.filterInPlace((e=>!!e.needsUpdate||(e.schedulePriority=e.basePriority,!1))),this._tasks.forAll((e=>{0===e.basePriority&&e.needsUpdate&&!this._runQueue.includes(e)&&e.blockFrame!==this._frameNumber&&this._runQueue.unshift(e)}));0===this._runQueue.length;){let e=!1,t=0;if(this._tasks.forAll((n=>{n.needsUpdate&&0!==n.schedulePriority&&0!==n.basePriority&&n.blockFrame!==this._frameNumber&&(e=!0,t=Math.max(t,n.basePriority),1===n.schedulePriority?(n.schedulePriority=0,this._runQueue.push(n)):--n.schedulePriority)})),!e)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){const e=this._budget.now();this._startFrameTaskTimes();do{for(;this._runQueue.length>0;){const t=this._budget.now(),n=this._runQueue.pop();this._budget.resetProgress();try{n.task.runTask(this._budget)===_.G&&(n.blockFrame=this._frameNumber)}catch(e){s.A.getLogger("esri.views.support.Scheduler").error(`Exception in task "${n.name}"`,e),n.blockFrame=this._frameNumber}!this._budget.hasProgressed&&n.blockFrame!==this._frameNumber&&n.needsUpdate&&(n.name,i.I3S_CONTROLLER,n.blockFrame=this._frameNumber),n.schedulePriority=n.basePriority;const r=this._budget.now()-t;if(n.runtime+=r,this._frameTaskTimes.set(n.priority,this._frameTaskTimes.get(n.priority)+r),this._budget.remaining<=0)return this._updatingChanged(),void this._recordFrameTaskTimes(this._budget.now()-e)}}while(this._schedule());this._updatingChanged(),this._recordFrameTaskTimes(this._budget.now()-e)}_startFrameTaskTimes(){for(const e of Object.keys(i))this._frameTaskTimes.set(i[e],0)}_recordFrameTaskTimes(e){this._frameTaskTimes.forEach(((e,t)=>this.performanceInfo.tasks.get(t).push(e))),this.performanceInfo.total.push(e)}get test(){return this._test}};class t{get task(){return this._task.value}get updating(){return this._queue.running}constructor(e,t,n){this._scheduler=e,this.name=t,this.blockFrame=0,this.runtime=0,this._queue=new f.T,this._handles=new o.A,this._basePriority=b(t),this.schedulePriority=this._basePriority,this._task=(0,d.v)(null!=n?n:this._queue),this._handles.add((0,h.when)((()=>this.task.running),(t=>e.taskRunningChanged(t))))}remove(){this.processQueue(O),this._scheduler.removeTask(this),this.schedule=R.schedule,this.reschedule=R.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(e){if(this.name===e)return;this.name=e;const t=b(e);0!==this._basePriority&&0===this.schedulePriority||(this.schedulePriority=t),this._basePriority=t}get priority(){return this.name}set priority(e){this.setPriority(e)}get needsUpdate(){return this.updating||this.task.running}schedule(e,t,n){return this._queue.push(e,t,n)}reschedule(e,t,n){return this._queue.unshift(e,t,n)}processQueue(e){return this._queue.runTask(e)}}class n{constructor(){this._begin="undefined"!=typeof performance?performance.now():0,this._budget=0,this._state=m.M.IDLE,this._done=!1,this._progressed=!1,this._enabled=!0}run(e){return!this.done&&(!0===e()&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get state(){return this._state}get enabled(){return this._enabled}set enabled(e){this._enabled=e}reset(e,t){this._begin=this.now(),this._budget=e,this._state=t,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return this.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}e.Budget=n}(A||(A={})),function(e){e.SCHEDULED="s",e.READY="r",e.WAITING="w",e.IDLE="i"}(M||(M={}));const O=(()=>{const e=new A.Budget;return e.enabled=!1,e})(),R=new class{remove(){}processQueue(){}schedule(e,t,n){try{if((0,u.G4)(t)){const e=(0,u.NK)();return n?Promise.resolve(n(e)):Promise.reject(e)}return(0,u.z7)(e(O))}catch(e){return Promise.reject(e)}}reschedule(e,t,n){return this.schedule(e,t,n)}}},55213:function(e,t,n){"use strict";n.d(t,{G:function(){return i}});const i=Symbol("Yield")},70474:function(e,t,n){"use strict";n.d(t,{n:function(){return x}});var i=n(56275),r=n(62938),o=n(59122),s=n(20551),a=n(32501),l=n(68734),c=n(5596),u=n(67496),h=n(19271);function d(e,t,n=e.hasZ){const o=(0,h.l)(e.spatialReference),d=(0,r.B5)(o);if(null==d)return null;const m=(e,t)=>!(t.length<2||((0,s.i)(e,t[0],t[1],n&&t[2]||0),0));let _=0;for(const n of e.rings){const i=n.length;if(i<3)continue;const{positionsWorldCoords:r}=t;for(;r.length<i;)r.push((0,a.vt)());const h=p,d=(0,s.i)(f,0,0,0),v=1/i;for(let t=0;t<i;t++){if(!m(h,n[t]))return null;if(!(0,l.F)(h,e.spatialReference,r[t],o))return null;(0,s.b)(d,d,r[t],v)}const y=(0,c.Cr)(r[0],r[1],d,(0,c.LV)());if(0===(0,s.k)((0,c.Qj)(y)))continue;for(let e=0;e<i;e++)(0,c.Z1)(y,d,r[e],r[e]);const b=g(r);for(let e=0;e<b.length;e+=3)_+=(0,u.Fm)(r[b[e]],r[b[e+1]],r[b[e+2]])}return(0,i.gT)(_,d)}const p=(0,a.vt)(),f=(0,a.vt)();function g(e){return(0,o.e)(function(e){const t=new Float64Array(2*e.length);for(let n=0;n<e.length;++n){const i=e[n],r=2*n;t[r]=i[0],t[r+1]=i[1]}return t}(e),[],2)}var m=n(22162),_=n(57862),v=n(99368);function y(e){const{spatialReference:t}=e;return(0,v.M0)(t,b,T,e)}function b(e){return(0,i.gT)(Math.abs((0,_.qy)([e],"square-meters")[0]),"square-meters")}function T(e){try{return(0,i.gT)(Math.abs((0,m.geodesicArea)(e,"square-meters")),"square-meters")}catch(e){return null}}function x(e,t={positionsWorldCoords:[]}){return function(e,t,n={positionsWorldCoords:[]}){if("on-the-ground"===t){const t=y(e);return null!=t?t:function(e,t={positionsWorldCoords:[]}){return d(e,t,!1)}(e,n)}return function(e,t={positionsWorldCoords:[]}){return d(e,t)}(e,n)}(e,"on-the-ground",t)}},9862:function(e,t,n){"use strict";n.d(t,{Do:function(){return l},Kt:function(){return a},ob:function(){return s}});var i=n(32501),r=n(46517),o=n(1428);function s(e){return(0,o.mh)(e)??(0,r.Xg)(e)}function a(e,t){return(0,o.Og)(e,t)??(0,r.ll)(e,t)}function l(e,t,n){return c[0]=e[0],c[1]=e[1],c[2]=3===e.length?e[2]:0,u[0]=t[0],u[1]=t[1],u[2]=3===t.length?t[2]:0,(0,o.n3)(c,u,n)??(0,r.sT)(c,u,n)}const c=(0,i.vt)(),u=(0,i.vt)()},16164:function(e,t,n){"use strict";n.d(t,{A:function(){return l}});var i=n(53804),r=n(83525),o=n(23502),s=(n(58941),n(40633),n(13798),n(65953));let a=class extends r.A{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};(0,i._)([(0,o.MZ)()],a.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),(0,i._)([(0,o.MZ)()],a.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),a=(0,i._)([(0,s.$)("esri.views.support.debugFlags")],a);const l=new a},33383:function(e,t,n){"use strict";n.d(t,{V:function(){return s},t:function(){return a}}),n(50917);var i=n(62938),r=n(82418),o=n(91484);function s(e,t,n,r=new o.default){let s=0;if("2d"===n.type)s=t*(n.resolution??0);else if("3d"===n.type){const r=n.overlayPixelSizeInMapUnits(e),o=n.basemapSpatialReference;s=null==o||o.equals(n.spatialReference)?t*r:(0,i.GA)(o)/(0,i.GA)(n.spatialReference)}const a=e.x-s,l=e.y-s,c=e.x+s,u=e.y+s,{spatialReference:h}=n;return r.xmin=Math.min(a,c),r.ymin=Math.min(l,u),r.xmax=Math.max(a,c),r.ymax=Math.max(l,u),r.spatialReference=h,r}function a(e,t,n){const i=n.toMap(e);return null!=i&&s(i,(0,r.o)(),n,l).intersects(t)}const l=new o.default},46517:function(e,t,n){"use strict";n.d(t,{Of:function(){return g},Qc:function(){return m},Xg:function(){return d},cL:function(){return y},e5:function(){return f},ll:function(){return p},sT:function(){return v}});var i,r,o=n(56275),s=n(62938),a=n(20551),l=n(32501),c=n(68734),u=n(57652),h=n(19271);function d(e){return function(e,t){const{hasZ:n,spatialReference:r}=e,a=(0,h.l)(r);let l=0;const c=(0,s._H)(a);if(null==c)return null;const u=t===i.Direct?_:v;for(const t of e.paths){if(t.length<2)continue;const e=t.length-1;for(let i=0;i<e;++i){const e=t[i];T[0]=e[0],T[1]=e[1],T[2]=n?e[2]:0;const o=t[i+1];x[0]=o[0],x[1]=o[1],x[2]=n?o[2]:0;const s=u(T,x,r);if(null==s)return null;l+=s.value}}return(0,o.d_)(l,c)}(e,i.Horizontal)}function p(e,t){const{spatialReference:n}=e;return(0,u.aI)(n,t.spatialReference)?(T[0]=e.x,T[1]=e.y,T[2]=e.hasZ?e.z:0,x[0]=t.x,x[1]=t.y,x[2]=t.hasZ?t.z:0,v(T,x,n)):null}function f(e,t){const{spatialReference:n}=e;return(0,u.aI)(n,t.spatialReference)?(T[0]=e.x,T[1]=e.y,T[2]=e.hasZ?e.z:0,x[0]=t.x,x[1]=t.y,x[2]=t.hasZ?t.z:0,y(T,x,n)):null}function g(e){return null!=e?m(e.hasZ?e.z:0,e.spatialReference):null}function m(e,t){const n=(0,s.mq)(t);return null!=n?(0,o.d_)(e??0,n):null}function _(e,t,n){const r=b(e,t,n,i.Direct);return null!=r?(0,o.d_)(r.direct,r.unit):null}function v(e,t,n){const r=b(e,t,n,i.Horizontal);return null!=r?(0,o.d_)(r.horizontal,r.unit):null}function y(e,t,n){const r=b(e,t,n,i.Vertical);return null!=r?(0,o.d_)(r.verticalSigned,r.unit):null}function b(e,t,n,r){const o=(0,h.l)(n),l=(0,s._H)(o);if(null==l)return null;const u=t[2]-e[2];if(r===i.Vertical)return{verticalSigned:u,unit:l};if(!(0,c.F)(e,n,w,o)||!(0,c.F)(t,n,S,o))return null;if(r===i.Direct)return{direct:(0,a.j)(S,w),unit:l};if((0,a.i)(E,e[0],e[1],t[2]),!(0,c.F)(E,n,E,o))return null;const d=(0,a.j)(E,S);return r===i.Horizontal?{horizontal:d,unit:l}:{direct:(0,a.j)(S,w),horizontal:d,vertical:Math.abs(u),unit:l}}(r=i||(i={}))[r.Direct=0]="Direct",r[r.Horizontal=1]="Horizontal",r[r.Vertical=2]="Vertical";const T=(0,l.vt)(),x=(0,l.vt)(),w=(0,l.vt)(),S=(0,l.vt)(),E=(0,l.vt)()},16633:function(e,t,n){"use strict";n.d(t,{b:function(){return o}});var i=n(56275),r=n(9862);function o({topLeft:e,topRight:t,bottomRight:n,bottomLeft:o,spatialReference:s}){const a=(0,i.T9)((0,r.Do)(o,n,s),(0,r.Do)(e,t,s));if(null==a)return null;const l=(0,i.T9)((0,r.Do)(n,t,s),(0,r.Do)(o,e,s));return null==l?null:{xSize:a,ySize:l}}},1428:function(e,t,n){"use strict";n.d(t,{Og:function(){return u},mh:function(){return c},n3:function(){return h}});var i=n(56275),r=n(32501),o=n(22162),s=n(57862),a=n(57652),l=n(99368);function c(e){const{spatialReference:t}=e;return(0,l.M0)(t,f,g,e)}function u(e,t){if(!(0,a.aI)(e.spatialReference,t.spatialReference))return null;const{spatialReference:n}=e;return _[0]=e.x,_[1]=e.y,_[2]=e.hasZ?e.z:0,v[0]=t.x,v[1]=t.y,v[2]=t.hasZ?t.z:0,h(_,v,n)}function h(e,t,n){return(0,l.M0)(n,d,p,e,t,n)}function d(e,t,n){return(0,i.d_)((0,s._3)(m,e,t,n).distance,"meters")}function p(e,t,n){return(0,i.d_)((0,o.geodesicLength)(function(e,t,n){return{type:"polyline",spatialReference:n,paths:[[[...e],[...t]]]}}(e,t,n),"meters"),"meters")}function f(e){return(0,i.d_)((0,s.l1)([e],"meters")[0],"meters")}function g(e){return(0,i.d_)((0,o.geodesicLength)(e,"meters"),"meters")}const m=new s.Zj,_=(0,r.vt)(),v=(0,r.vt)()},99368:function(e,t,n){"use strict";n.d(t,{M0:function(){return s},yF:function(){return o}});var i=n(57862),r=n(57652);function o(e){return(0,i.TT)(e)||(0,r.K8)(e)}function s(e,t,n,...o){return(0,i.TT)(e)?t.apply(void 0,o):(0,r.K8)(e)?n.apply(void 0,o):null}},19271:function(e,t,n){"use strict";n.d(t,{l:function(){return s}});var i=n(61714),r=n(96611),o=n(57652);function s(e){return(0,o.B3)(e)?(0,o.oT)(e)||(0,o.K8)(e)||(0,o.x1)(e)||(0,i.jA)(e)?r.Y0:e:(0,r.lO)(e)}},86305:function(e,t,n){"use strict";n.d(t,{g:function(){return c}});var i=n(50659),r=(n(58941),n(40633)),o=n(24540),s=n(41835),a=n(85456);const l=()=>r.A.getLogger("esri.views.webgl.BufferObject");class c{static createIndex(e,t,n){return new c(e,a.NZ.ELEMENT_ARRAY_BUFFER,t,n)}static createVertex(e,t,n){return new c(e,a.NZ.ARRAY_BUFFER,t,n)}static createUniform(e,t,n){return new c(e,a.NZ.UNIFORM_BUFFER,t,n)}static createPixelPack(e,t=a._U.STREAM_READ,n){const i=new c(e,a.NZ.PIXEL_PACK_BUFFER,t);return n&&i.setSize(n),i}static createPixelUnpack(e,t=a._U.STREAM_DRAW,n){return new c(e,a.NZ.PIXEL_UNPACK_BUFFER,t,n)}static createTransformFeedback(e,t=a._U.STATIC_DRAW,n){const i=new c(e,a.NZ.TRANSFORM_FEEDBACK_BUFFER,t);return i.setSize(n),i}constructor(e,t,n,i){this._context=e,this.bufferType=t,this.usage=n,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(a.vt.BufferObject,this),this._glName=this._context.gl.createBuffer(),(0,s.Y2)(this._context.gl),i&&this.setData(i)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get usedMemory(){if(this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER){if(this._indexType===a.pe.UNSIGNED_INT)return 4*this._size;if(this._indexType===a.pe.UNSIGNED_SHORT)return 2*this._size}return this._size}get _isVAOAware(){return this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER||this.bufferType===a.NZ.ARRAY_BUFFER}dispose(){this._context?.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(a.vt.BufferObject,this),this._context=null):this._glName&&l().warn("Leaked WebGL buffer object")}setSize(e,t=null){if(this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER&&null!=t)switch(this._indexType=t,t){case a.pe.UNSIGNED_SHORT:e*=2;break;case a.pe.UNSIGNED_INT:e*=4}this._setBufferData(e)}setData(e){if(!e)return;let t=e.byteLength;this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER&&((0,o.mg)(e)?this._indexType=a.pe.UNSIGNED_BYTE:(0,o.jq)(e)?(t/=2,this._indexType=a.pe.UNSIGNED_SHORT):(0,o.XJ)(e)&&(t/=4,this._indexType=a.pe.UNSIGNED_INT)),this._setBufferData(t,e)}_setBufferData(e,t=null){this._size=e;const n=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const i=this._context.gl;null!=t?i.bufferData(this.bufferType,t,this.usage):i.bufferData(this.bufferType,e,this.usage),(0,s.Y2)(i),this._isVAOAware&&this._context.bindVAO(n)}setSubData(e,t,n,i){if(!e)return;const r=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const{gl:o}=this._context;o.bufferSubData(this.bufferType,t*e.BYTES_PER_ELEMENT,e,n,i-n),(0,s.Y2)(o),this._isVAOAware&&this._context.bindVAO(r)}getSubData(e,t=0,n,r){if(n<0||r<0)return;const o=function(e){return(0,i.Xj)(e)}(e)?e.BYTES_PER_ELEMENT:1;if(o*((n??0)+(r??0))>e.byteLength)return;t+o*(r??0)>this.usedMemory&&l().warn("Potential problem getting subdata: requested data exceeds buffer size!");const s=this._context.gl;this.bufferType===a.NZ.TRANSFORM_FEEDBACK_BUFFER?(this._context.bindBuffer(this,a.NZ.TRANSFORM_FEEDBACK_BUFFER),s.getBufferSubData(a.NZ.TRANSFORM_FEEDBACK_BUFFER,t,e,n,r),this._context.unbindBuffer(a.NZ.TRANSFORM_FEEDBACK_BUFFER)):(this._context.bindBuffer(this,a.NZ.COPY_READ_BUFFER),s.getBufferSubData(a.NZ.COPY_READ_BUFFER,t,e,n,r),this._context.unbindBuffer(a.NZ.COPY_READ_BUFFER))}async getSubDataAsync(e,t=0,n,i){await this._context.clientWaitAsync(),this.getSubData(e,t,n,i)}}},69452:function(e,t,n){"use strict";var i;n.d(t,{p:function(){return i}}),function(e){e[e.Texture=0]="Texture",e[e.RenderBuffer=1]="RenderBuffer"}(i||(i={}))},12285:function(e,t,n){"use strict";n.d(t,{g:function(){return c}});var i=n(39819),r=(n(58941),n(41835)),o=n(85456),s=n(69452),a=n(10956),l=n(31516);let c=class e{constructor(e,t=null,n=null){if(this.type=s.p.Texture,this._glName=null,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._wasImmutablyAllocated=!1,"context"in e)this._descriptor=e,n=t;else{const n=l.z.validate(e,t);if(!n)throw new i.A("Texture descriptor invalid");this._descriptor=n}this._descriptor.target===o.Ap.TEXTURE_CUBE_MAP?this._setDataCubeMap(n):this.setData(n)}get glName(){return this._glName}get descriptor(){return this._descriptor}get usedMemory(){return(0,a.e)(this._descriptor)}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._glName&&this._descriptor.context.instanceCounter.decrement(o.vt.Texture,this),this._descriptor.context.gl&&this._glName&&(this._descriptor.context.unbindTexture(this),this._descriptor.context.gl.deleteTexture(this._glName),this._glName=null)}release(){this.dispose()}resize(e,t){const n=this._descriptor;if(n.width!==e||n.height!==t){if(this._wasImmutablyAllocated)throw new i.A("Immutable textures can't be resized!");n.width=e,n.height=t,this._descriptor.target===o.Ap.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(e=null){for(let t=o.Ap.TEXTURE_CUBE_MAP_POSITIVE_X;t<=o.Ap.TEXTURE_CUBE_MAP_NEGATIVE_Z;t++)this._setData(e,t)}setData(e){this._setData(e)}_setData(t,n){const s=this._descriptor.context?.gl;if(!s)return;(0,r.Y2)(s),this._glName||(this._glName=s.createTexture(),this._glName&&this._descriptor.context.instanceCounter.increment(o.vt.Texture,this));const a=this._descriptor,l=n??a.target,c=g(l),_=this._descriptor.context.bindTexture(this,e.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(e.TEXTURE_UNIT_FOR_UPDATES),u(a),this._configurePixelStorage(),(0,r.Y2)(s);const v=this._deriveInternalFormat();if(f(t)){let e="width"in t?t.width:t.codedWidth,n="height"in t?t.height:t.codedHeight;const i=1;t instanceof HTMLVideoElement&&(e=t.videoWidth,n=t.videoHeight),a.width&&a.height,c&&a.depth,a.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(l,v,a.hasMipmap,e,n,i),this._texImage(l,0,v,e,n,i,t),(0,r.Y2)(s),a.hasMipmap&&(this.generateMipmap(),(0,r.Y2)(s)),a.width||(a.width=e),a.height||(a.height=n),c&&!a.depth&&(a.depth=i)}else{const{width:e,height:n,depth:u}=a;if(null==e||null==n)throw new i.A("Width and height must be specified!");if(c&&null==u)throw new i.A("Depth must be specified!");if(a.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(l,v,a.hasMipmap,e,n,u),p(t)){const r=t.levels,c=m(l,e,n,u),h=Math.min(c-1,r.length-1);s.texParameteri(a.target,this._descriptor.context.gl.TEXTURE_MAX_LEVEL,h);const d=v;if(!(d in o.CQ))throw new i.A("Attempting to use compressed data with an uncompressed format!");this._forEachMipmapLevel(((e,t,n,i)=>{const o=r[Math.min(e,r.length-1)];this._compressedTexImage(l,e,d,t,n,i,o)}),h)}else this._texImage(l,0,v,e,n,u,t),(0,r.Y2)(s),a.hasMipmap&&this.generateMipmap()}h(s,this._descriptor),d(s,this._descriptor),function(e,t){const n=e.capabilities.textureFilterAnisotropic;n&&e.gl.texParameterf(t.target,n.TEXTURE_MAX_ANISOTROPY,t.maxAnisotropy??1)}(this._descriptor.context,this._descriptor),(0,r.Y2)(s),this._descriptor.context.bindTexture(_,e.TEXTURE_UNIT_FOR_UPDATES)}updateData(t,n,r,o,s,a,l=0){a||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const c=this._descriptor,u=this._deriveInternalFormat(),{context:h,pixelFormat:d,dataType:g,target:m,isImmutable:_}=c;if(_&&!this._wasImmutablyAllocated)throw new i.A("Cannot update immutable texture before allocation!");const v=h.bindTexture(this,e.TEXTURE_UNIT_FOR_UPDATES,!0);(n<0||r<0||n+o>c.width||r+s>c.height)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage();const{gl:y}=h;l&&y.pixelStorei(y.UNPACK_SKIP_ROWS,l),f(a)?y.texSubImage2D(m,t,n,r,o,s,d,g,a):p(a)?y.compressedTexSubImage2D(m,t,n,r,o,s,u,a.levels[t]):y.texSubImage2D(m,t,n,r,o,s,d,g,a),l&&y.pixelStorei(y.UNPACK_SKIP_ROWS,0),h.bindTexture(v,e.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(t,n,r,o,s,a,l,c){c||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const u=this._descriptor,h=this._deriveInternalFormat(),{context:d,pixelFormat:f,dataType:m,isImmutable:_,target:v}=u;if(_&&!this._wasImmutablyAllocated)throw new i.A("Cannot update immutable texture before allocation!");g(v)||console.warn("Attempting to set 3D texture data on a non-3D texture");const y=d.bindTexture(this,e.TEXTURE_UNIT_FOR_UPDATES);d.setActiveTexture(e.TEXTURE_UNIT_FOR_UPDATES),(n<0||r<0||o<0||n+s>u.width||r+a>u.height||o+l>u.depth)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage();const{gl:b}=d;if(p(c))c=c.levels[t],b.compressedTexSubImage3D(v,t,n,r,o,s,a,l,h,c);else{const e=c;b.texSubImage3D(v,t,n,r,o,s,a,l,f,m,e)}d.bindTexture(y,e.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const t=this._descriptor;if(!t.hasMipmap){if(this._wasImmutablyAllocated)throw new i.A("Cannot add mipmaps to immutable texture after allocation");t.hasMipmap=!0,this._samplingModeDirty=!0,u(t)}t.samplingMode===o.Cj.LINEAR?(this._samplingModeDirty=!0,t.samplingMode=o.Cj.LINEAR_MIPMAP_NEAREST):t.samplingMode===o.Cj.NEAREST&&(this._samplingModeDirty=!0,t.samplingMode=o.Cj.NEAREST_MIPMAP_NEAREST);const n=this._descriptor.context.bindTexture(this,e.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(e.TEXTURE_UNIT_FOR_UPDATES),this._descriptor.context.gl.generateMipmap(t.target),this._descriptor.context.bindTexture(n,e.TEXTURE_UNIT_FOR_UPDATES)}clearMipmap(){const e=this._descriptor;if(e.hasMipmap){if(this._wasImmutablyAllocated)throw new i.A("Cannot delete mipmaps to immutable texture after allocation");e.hasMipmap=!1,this._samplingModeDirty=!0,u(e)}e.samplingMode===o.Cj.LINEAR_MIPMAP_NEAREST?(this._samplingModeDirty=!0,e.samplingMode=o.Cj.LINEAR):e.samplingMode===o.Cj.NEAREST_MIPMAP_NEAREST&&(this._samplingModeDirty=!0,e.samplingMode=o.Cj.NEAREST)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,u(this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const e=this._descriptor,t=e.context.gl;this._samplingModeDirty&&(h(t,e),this._samplingModeDirty=!1),this._wrapModeDirty&&(d(t,e),this._wrapModeDirty=!1)}_deriveInternalFormat(){if(null!=this._descriptor.internalFormat)return this._descriptor.internalFormat===o.Ab.DEPTH_STENCIL&&(this._descriptor.internalFormat=o.Ab.DEPTH24_STENCIL8),this._descriptor.internalFormat;switch(this._descriptor.dataType){case o.ld.FLOAT:switch(this._descriptor.pixelFormat){case o.Ab.RGBA:return this._descriptor.internalFormat=o.H0.RGBA32F;case o.Ab.RGB:return this._descriptor.internalFormat=o.H0.RGB32F;default:throw new i.A("Unable to derive format")}case o.ld.UNSIGNED_BYTE:switch(this._descriptor.pixelFormat){case o.Ab.RGBA:return this._descriptor.internalFormat=o.H0.RGBA8;case o.Ab.RGB:return this._descriptor.internalFormat=o.H0.RGB8}}return this._descriptor.internalFormat=this._descriptor.pixelFormat===o.Ab.DEPTH_STENCIL?o.Ab.DEPTH24_STENCIL8:this._descriptor.pixelFormat}_configurePixelStorage(){const e=this._descriptor.context.gl,{unpackAlignment:t,flipped:n,preMultiplyAlpha:i}=this._descriptor;e.pixelStorei(e.UNPACK_ALIGNMENT,t),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,n?1:0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i?1:0)}_texStorage(e,t,n,r,s,a){const{gl:l}=this._descriptor.context;if(!(t in o.H0))throw new i.A("Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const c=n?m(e,r,s,a):1;if(g(e)){if(null==a)throw new i.A("Missing depth dimension for 3D texture upload");l.texStorage3D(e,c,t,r,s,a)}else l.texStorage2D(e,c,t,r,s);this._wasImmutablyAllocated=!0}_texImage(e,t,n,r,o,s,a){const l=this._descriptor.context.gl,c=g(e),{isImmutable:u,pixelFormat:h,dataType:d}=this._descriptor;if(u){if(null!=a){const n=a;if(c){if(null==s)throw new i.A("Missing depth dimension for 3D texture upload");l.texSubImage3D(e,t,0,0,0,r,o,s,h,d,n)}else l.texSubImage2D(e,t,0,0,r,o,h,d,n)}}else{const u=a;if(c){if(null==s)throw new i.A("Missing depth dimension for 3D texture upload");l.texImage3D(e,t,n,r,o,s,0,h,d,u)}else l.texImage2D(e,t,n,r,o,0,h,d,u)}}_compressedTexImage(e,t,n,r,o,s,a){const l=this._descriptor.context.gl,c=g(e);if(this._descriptor.isImmutable){if(null!=a)if(c){if(null==s)throw new i.A("Missing depth dimension for 3D texture upload");l.compressedTexSubImage3D(e,t,0,0,0,r,o,s,n,a)}else l.compressedTexSubImage2D(e,t,0,0,r,o,n,a)}else if(c){if(null==s)throw new i.A("Missing depth dimension for 3D texture upload");l.compressedTexImage3D(e,t,n,r,o,s,0,a)}else l.compressedTexImage2D(e,t,n,r,o,0,a)}_forEachMipmapLevel(e,t=1/0){let{width:n,height:r,depth:s,hasMipmap:a,target:l}=this._descriptor;const c=l===o.Ap.TEXTURE_3D;if(null==n||null==r||c&&null==s)throw new i.A("Missing texture dimensions for mipmap calculation");for(let i=0;e(i,n,r,s),a&&(1!==n||1!==r||c&&1!==s)&&!(i>=t);++i)n=Math.max(1,n>>1),r=Math.max(1,r>>1),c&&(s=Math.max(1,s>>1))}};function u(e){(null!=e.width&&e.width<0||null!=e.height&&e.height<0||null!=e.depth&&e.depth<0)&&console.error("Negative dimension parameters are not allowed!")}function h(e,t){let n=t.samplingMode,i=t.samplingMode;n===o.Cj.LINEAR_MIPMAP_NEAREST||n===o.Cj.LINEAR_MIPMAP_LINEAR?(n=o.Cj.LINEAR,t.hasMipmap||(i=o.Cj.LINEAR)):n!==o.Cj.NEAREST_MIPMAP_NEAREST&&n!==o.Cj.NEAREST_MIPMAP_LINEAR||(n=o.Cj.NEAREST,t.hasMipmap||(i=o.Cj.NEAREST)),e.texParameteri(t.target,e.TEXTURE_MAG_FILTER,n),e.texParameteri(t.target,e.TEXTURE_MIN_FILTER,i)}function d(e,t){"number"==typeof t.wrapMode?(e.texParameteri(t.target,e.TEXTURE_WRAP_S,t.wrapMode),e.texParameteri(t.target,e.TEXTURE_WRAP_T,t.wrapMode)):(e.texParameteri(t.target,e.TEXTURE_WRAP_S,t.wrapMode.s),e.texParameteri(t.target,e.TEXTURE_WRAP_T,t.wrapMode.t))}function p(e){return null!=e&&"type"in e&&"compressed"===e.type}function f(e){return null!=e&&!p(e)&&!function(e){return null!=e&&"byteLength"in e}(e)}function g(e){return e===o.Ap.TEXTURE_3D||e===o.Ap.TEXTURE_2D_ARRAY}function m(e,t,n,i=1){let r=Math.max(t,n);return e===o.Ap.TEXTURE_3D&&(r=Math.max(r,i)),Math.round(Math.log(r)/Math.LN2)+1}c.TEXTURE_UNIT_FOR_UPDATES=0},10956:function(e,t,n){"use strict";n.d(t,{R:function(){return o},e:function(){return s}});var i=n(85456),r=n(93380);class o{constructor(e=0,t=e){this.width=e,this.height=t,this.target=i.Ap.TEXTURE_2D,this.pixelFormat=i.Ab.RGBA,this.dataType=i.ld.UNSIGNED_BYTE,this.samplingMode=i.Cj.LINEAR,this.wrapMode=i.pF.REPEAT,this.maxAnisotropy=1,this.flipped=!1,this.hasMipmap=!1,this.isOpaque=!1,this.unpackAlignment=4,this.preMultiplyAlpha=!1,this.depth=1,this.isImmutable=!1}}function s(e){return e.width<=0||e.height<=0?0:Math.round(e.width*e.height*(e.hasMipmap?4/3:1)*(null==e.internalFormat?4:(0,r.IB)(e.internalFormat))*(e.target===i.Ap.TEXTURE_CUBE_MAP?6:1))}},93380:function(e,t,n){"use strict";n.d(t,{Hi:function(){return l},IB:function(){return c},WH:function(){return s},yu:function(){return a}}),n(58941);var i=n(41835),r=n(85456),o=n(48347);function s(e){const t=e.gl;switch(t.getError()){case t.NO_ERROR:return null;case t.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case t.INVALID_VALUE:return"An unacceptable value has been specified for an argument";case t.INVALID_OPERATION:return"The specified command is not allowed for the current state";case t.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case t.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case t.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function a(e,t,n,r,a=0){const l=e.gl;e.bindBuffer(n);for(const n of r){const r=t.get(n.name);if(null==r){console.warn(`There is no location for vertex attribute '${n.name}' defined.`);continue}const c=a*n.stride;if(n.count<=4)l.vertexAttribPointer(r,n.count,n.type,n.normalized,n.stride,n.offset+c),l.enableVertexAttribArray(r),n.divisor>0&&e.gl.vertexAttribDivisor(r,n.divisor);else if(9===n.count)for(let t=0;t<3;t++)l.vertexAttribPointer(r+t,3,n.type,n.normalized,n.stride,n.offset+12*t+c),l.enableVertexAttribArray(r+t),n.divisor>0&&e.gl.vertexAttribDivisor(r+t,n.divisor);else if(16===n.count)for(let t=0;t<4;t++)l.vertexAttribPointer(r+t,4,n.type,n.normalized,n.stride,n.offset+16*t+c),l.enableVertexAttribArray(r+t),n.divisor>0&&e.gl?.vertexAttribDivisor(r+t,n.divisor);else console.error("Unsupported vertex attribute element count: "+n.count);if((0,i.en)()){const t=s(e),i=(0,o._)(n.type),r=n.offset,a=Math.round(i/r)!==i/r?`. Offset not a multiple of stride. DataType requires ${i} bytes, but descriptor has an offset of ${r}`:"";t&&console.error(`Unable to bind vertex attribute "${n.name}" with baseInstanceOffset ${c}${a}:`,t,n)}}}function l(e,t,n,i){const o=e.gl;e.bindBuffer(n);for(const n of i){const i=t.get(n.name);if(n.count<=4)o.disableVertexAttribArray(i),n.divisor&&n.divisor>0&&e.gl?.vertexAttribDivisor(i,0);else if(9===n.count)for(let t=0;t<3;t++)o.disableVertexAttribArray(i+t),n.divisor&&n.divisor>0&&e.gl?.vertexAttribDivisor(i+t,0);else if(16===n.count)for(let t=0;t<4;t++)o.disableVertexAttribArray(i+t),n.divisor&&n.divisor>0&&e.gl?.vertexAttribDivisor(i+t,0);else console.error("Unsupported vertex attribute element count: "+n.count)}e.unbindBuffer(r.NZ.ARRAY_BUFFER)}function c(e){switch(e){case r.Ab.ALPHA:case r.Ab.LUMINANCE:case r.Ab.RED:case r.Ab.RED_INTEGER:case r.H0.R8:case r.H0.R8I:case r.H0.R8UI:case r.H0.R8_SNORM:case r.yQ.STENCIL_INDEX8:return 1;case r.Ab.LUMINANCE_ALPHA:case r.Ab.RG:case r.Ab.RG_INTEGER:case r.H0.RGBA4:case r.H0.R16F:case r.H0.R16I:case r.H0.R16UI:case r.H0.RG8:case r.H0.RG8I:case r.H0.RG8UI:case r.H0.RG8_SNORM:case r.H0.RGB565:case r.H0.RGB5_A1:case r.yQ.DEPTH_COMPONENT16:return 2;case r.Ab.DEPTH_COMPONENT:case r.Ab.RGB:case r.Ab.RGB_INTEGER:case r.H0.RGB8:case r.H0.RGB8I:case r.H0.RGB8UI:case r.H0.RGB8_SNORM:case r.H0.SRGB8:case r.yQ.DEPTH_COMPONENT24:return 3;case r.Ab.DEPTH_STENCIL:case r.Ab.DEPTH24_STENCIL8:case r.Ab.RGBA:case r.Ab.RGBA_INTEGER:case r.H0.RGBA8:case r.H0.R32F:case r.H0.R11F_G11F_B10F:case r.H0.RG16F:case r.H0.R32I:case r.H0.R32UI:case r.H0.RG16I:case r.H0.RG16UI:case r.H0.RGBA8I:case r.H0.RGBA8UI:case r.H0.RGBA8_SNORM:case r.H0.SRGB8_ALPHA8:case r.H0.RGB9_E5:case r.H0.RGB10_A2UI:case r.H0.RGB10_A2:case r.yQ.DEPTH_STENCIL:case r.yQ.DEPTH_COMPONENT32F:case r.yQ.DEPTH24_STENCIL8:return 4;case r.yQ.DEPTH32F_STENCIL8:return 5;case r.H0.RGB16F:case r.H0.RGB16I:case r.H0.RGB16UI:return 6;case r.H0.RG32F:case r.H0.RG32I:case r.H0.RG32UI:case r.H0.RGBA16F:case r.H0.RGBA16I:case r.H0.RGBA16UI:return 8;case r.H0.RGB32F:case r.H0.RGB32I:case r.H0.RGB32UI:return 12;case r.H0.RGBA32F:case r.H0.RGBA32I:case r.H0.RGBA32UI:return 16;case r.CQ.COMPRESSED_RGB_S3TC_DXT1_EXT:case r.CQ.COMPRESSED_RGBA_S3TC_DXT1_EXT:return.5;case r.CQ.COMPRESSED_RGBA_S3TC_DXT3_EXT:case r.CQ.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case r.CQ.COMPRESSED_R11_EAC:case r.CQ.COMPRESSED_SIGNED_R11_EAC:case r.CQ.COMPRESSED_RGB8_ETC2:case r.CQ.COMPRESSED_SRGB8_ETC2:case r.CQ.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case r.CQ.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return.5;case r.CQ.COMPRESSED_RG11_EAC:case r.CQ.COMPRESSED_SIGNED_RG11_EAC:case r.CQ.COMPRESSED_RGBA8_ETC2_EAC:case r.CQ.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}},31516:function(e,t,n){"use strict";n.d(t,{z:function(){return o}});var i=n(85456),r=n(10956);class o extends r.R{constructor(e,t){switch(super(),this.context=e,Object.assign(this,t),this.internalFormat){case i.H0.R16F:case i.H0.R16I:case i.H0.R16UI:case i.H0.R32F:case i.H0.R32I:case i.H0.R32UI:case i.H0.R8_SNORM:case i.H0.R8:case i.H0.R8I:case i.H0.R8UI:this.pixelFormat=i.Ab.RED}}static validate(e,t){return new o(e,t)}}},81438:function(e,t,n){"use strict";n.d(t,{Z:function(){return c}});var i=n(40633),r=n(95929),o=n(24540),s=n(85456),a=n(93380);const l=()=>i.A.getLogger("esri.views.webgl.VertexArrayObject");let c=class{constructor(e,t,n,i,r=null){this._context=e,this._locations=t,this._layout=n,this._buffers=i,this._indexBuffer=r,this._glName=null,this._initialized=!1}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get byteSize(){return Array.from(this._buffers.values()).reduce(((e,t)=>e+t.usedMemory),null!=this._indexBuffer?this._indexBuffer.usedMemory:0)}get layout(){return this._layout}get locations(){return this._locations}get usedMemory(){return this.byteSize+(Object.keys(this._buffers).length+(this._indexBuffer?1:0))*o.zQ}dispose(){this._context?(this._context.getBoundVAO()===this&&this._context.bindVAO(null),this._buffers.forEach((e=>e.dispose())),this._buffers.clear(),this._indexBuffer=(0,r.WD)(this._indexBuffer),this.disposeVAOOnly()):(this._glName||Object.getOwnPropertyNames(this._buffers).length>0)&&l().warn("Leaked WebGL VAO")}disposeVAOOnly(){this._glName&&(this._context.gl.deleteVertexArray(this._glName),this._glName=null,this._context.instanceCounter.decrement(s.vt.VertexArrayObject,this)),this._context=null}initialize(){if(this._initialized)return;const{gl:e}=this._context,t=e.createVertexArray();e.bindVertexArray(t),this._bindLayout(),e.bindVertexArray(null),this._glName=t,this._context.instanceCounter.increment(s.vt.VertexArrayObject,this),this._initialized=!0}bind(){this.initialize(),this._context.gl.bindVertexArray(this.glName)}_bindLayout(){const{_buffers:e,_layout:t,_indexBuffer:n}=this;e||l().error("Vertex buffer dictionary is empty!");const i=this._context.gl;this._buffers.forEach(((e,n)=>{const i=t.get(n);i?(0,a.yu)(this._context,this._locations,e,i):l().error("Vertex element descriptor is empty!")})),null!=n&&i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,n.glName)}unbind(){this.initialize(),this._context.gl.bindVertexArray(null)}}},3817:function(e,t,n){"use strict";n.d(t,{_:function(){return i}});class i{constructor(e,t,n,i,r,o=!1,s=0){this.name=e,this.count=t,this.type=n,this.offset=i,this.stride=r,this.normalized=o,this.divisor=s}}},41835:function(e,t,n){"use strict";n.d(t,{Xc:function(){return c},Y2:function(){return u},en:function(){return l}});var i=n(39819),r=n(58941),o=n(40633);const s=()=>o.A.getLogger("esri.views.webgl.checkWebGLError"),a=!!(0,r.A)("enable-feature:webgl-debug");function l(){return a}function c(){return a}function u(e){if(l()){const t=e.getError();if(t){const n=function(e,t){switch(t){case e.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case e.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case e.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case e.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case e.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case e.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}(e,t),r=(new Error).stack;s().error(new i.A("webgl-error","WebGL error occurred",{message:n,stack:r}))}}}},44476:function(e,t,n){"use strict";function i(e,t,n){for(let i=0;i<n;++i)t[2*i]=e[i],t[2*i+1]=e[i]-t[2*i]}function r(e,t){const n=e.length;for(let i=0;i<n;++i)s[0]=e[i],t[i]=s[0];return t}function o(e,t){const n=e.length;for(let i=0;i<n;++i)s[0]=e[i],s[1]=e[i]-s[0],t[i]=s[1];return t}n.d(t,{Zo:function(){return r},jA:function(){return o},jS:function(){return i}});const s=new Float32Array(2)},85456:function(e,t,n){"use strict";var i,r,o,s,a,l,c,u,h,d,p,f,g,m,_,v,y,b,T,x;n.d(t,{Ab:function(){return m},Ac:function(){return c},Ap:function(){return g},CQ:function(){return O},Cj:function(){return p},Co:function(){return T},H0:function(){return _},Hr:function(){return A},MT:function(){return h},NV:function(){return i},NZ:function(){return a},Nm:function(){return E},R:function(){return x},Tb:function(){return s},WR:function(){return r},Y7:function(){return l},_U:function(){return b},dn:function(){return o},eA:function(){return d},ld:function(){return v},nI:function(){return M},pF:function(){return f},pe:function(){return u},sS:function(){return P},tx:function(){return D},vt:function(){return S},xM:function(){return w},xV:function(){return R},yQ:function(){return y}}),function(e){e[e.DEPTH=256]="DEPTH",e[e.STENCIL=1024]="STENCIL",e[e.COLOR=16384]="COLOR"}(i||(i={})),function(e){e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(r||(r={})),function(e){e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(o||(o={})),function(e){e[e.ADD=32774]="ADD",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX",e[e.SUBTRACT=32778]="SUBTRACT",e[e.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"}(s||(s={})),function(e){e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",e[e.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER"}(a||(a={})),function(e){e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(l||(l={})),function(e){e[e.CW=2304]="CW",e[e.CCW=2305]="CCW"}(c||(c={})),function(e){e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.HALF_FLOAT=5131]="HALF_FLOAT"}(u||(u={})),function(e){e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS"}(h||(h={})),function(e){e[e.ZERO=0]="ZERO",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP"}(d||(d={})),function(e){e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(p||(p={})),function(e){e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.REPEAT=10497]="REPEAT",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(f||(f={})),function(e){e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"}(g||(g={})),function(e){e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.RED=6403]="RED",e[e.RG=33319]="RG",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER"}(m||(m={})),function(e){e[e.RGBA4=32854]="RGBA4",e[e.R16F=33325]="R16F",e[e.RG16F=33327]="RG16F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.R32F=33326]="R32F",e[e.RG32F=33328]="RG32F",e[e.RGBA32F=34836]="RGBA32F",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB5_A1=32855]="RGB5_A1",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.RGB16F=34843]="RGB16F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.RGB565=36194]="RGB565",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2=32857]="RGB10_A2",e[e.RGB10_A2UI=36975]="RGB10_A2UI"}(_||(_={})),function(e){e[e.FLOAT=5126]="FLOAT",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.INT=5124]="INT",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"}(v||(v={})),function(e){e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"}(y||(y={})),function(e){e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_READ=35045]="STATIC_READ",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.STREAM_COPY=35042]="STREAM_COPY"}(b||(b={})),function(e){e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER"}(T||(T={})),function(e){e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"}(x||(x={}));const w=33984;var S,E,A;!function(e){e[e.Texture=0]="Texture",e[e.BufferObject=1]="BufferObject",e[e.VertexArrayObject=2]="VertexArrayObject",e[e.Shader=3]="Shader",e[e.Program=4]="Program",e[e.FramebufferObject=5]="FramebufferObject",e[e.Renderbuffer=6]="Renderbuffer",e[e.TransformFeedback=7]="TransformFeedback",e[e.Sync=8]="Sync",e[e.UNCOUNTED=9]="UNCOUNTED",e[e.LinesOfCode=9]="LinesOfCode",e[e.Uniform=10]="Uniform",e[e.COUNT=11]="COUNT"}(S||(S={})),function(e){e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"}(E||(E={})),function(e){e[e.NONE=0]="NONE",e[e.BACK=1029]="BACK"}(A||(A={}));const M=33306;var O,R,C,I,P,D,L;!function(e){e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"}(O||(O={})),function(e){e[e.FLOAT=5126]="FLOAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT=5124]="INT",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"}(R||(R={})),function(e){e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS"}(C||(C={})),function(e){e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED"}(I||(I={})),function(e){e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED"}(P||(P={})),function(e){e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"}(D||(D={})),function(e){e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"}(L||(L={}))},48347:function(e,t,n){"use strict";n.d(t,{_:function(){return r}});var i=n(85456);function r(e){switch(e){case i.pe.BYTE:case i.pe.UNSIGNED_BYTE:return 1;case i.pe.SHORT:case i.pe.UNSIGNED_SHORT:case i.pe.HALF_FLOAT:return 2;case i.pe.FLOAT:case i.pe.INT:case i.pe.UNSIGNED_INT:return 4}}},57087:function(e,t,n){"use strict";n.d(t,{Ey:function(){return S},Ky:function(){return c},Ms:function(){return Z},Os:function(){return l},Uy:function(){return p},Xt:function(){return d},gh:function(){return a},hG:function(){return h},kn:function(){return f},p3:function(){return s}});var i=n(54407),r=n(85456);function o(e,t,n=r.Tb.ADD,i=[0,0,0,0]){return{srcRgb:e,srcAlpha:e,dstRgb:t,dstAlpha:t,opRgb:n,opAlpha:n,color:{r:i[0],g:i[1],b:i[2],a:i[3]}}}function s(e,t,n,i,o=r.Tb.ADD,s=r.Tb.ADD,a=[0,0,0,0]){return{srcRgb:e,srcAlpha:t,dstRgb:n,dstAlpha:i,opRgb:o,opAlpha:s,color:{r:a[0],g:a[1],b:a[2],a:a[3]}}}const a=o(r.dn.ZERO,r.dn.ONE_MINUS_SRC_ALPHA),l=(o(r.dn.ONE,r.dn.ZERO),o(r.dn.ONE,r.dn.ONE),o(r.dn.ONE,r.dn.ONE_MINUS_SRC_ALPHA)),c=s(r.dn.SRC_ALPHA,r.dn.ONE,r.dn.ONE_MINUS_SRC_ALPHA,r.dn.ONE_MINUS_SRC_ALPHA),u={face:r.Y7.BACK,mode:r.Ac.CCW},h={face:r.Y7.FRONT,mode:r.Ac.CCW},d=e=>e===i.s2.Back?u:e===i.s2.Front?h:null,p={zNear:0,zFar:1},f={r:!0,g:!0,b:!0,a:!0};function g(e){return M.intern(e)}function m(e){return R.intern(e)}function _(e){return I.intern(e)}function v(e){return D.intern(e)}function y(e){return N.intern(e)}function b(e){return z.intern(e)}function T(e){return V.intern(e)}function x(e){return k.intern(e)}function w(e){return G.intern(e)}function S(e){return j.intern(e)}class E{constructor(e,t){this._makeKey=e,this._makeRef=t,this._interns=new Map}intern(e){if(!e)return null;const t=this._makeKey(e),n=this._interns;return n.has(t)||n.set(t,this._makeRef(e)),n.get(t)??null}}function A(e){return"["+e.join(",")+"]"}const M=new E(O,(e=>({__tag:"Blending",...e})));function O(e){return e?A([e.srcRgb,e.srcAlpha,e.dstRgb,e.dstAlpha,e.opRgb,e.opAlpha,e.color.r,e.color.g,e.color.b,e.color.a]):null}const R=new E(C,(e=>({__tag:"Culling",...e})));function C(e){return e?A([e.face,e.mode]):null}const I=new E(P,(e=>({__tag:"PolygonOffset",...e})));function P(e){return e?A([e.factor,e.units]):null}const D=new E(L,(e=>({__tag:"DepthTest",...e})));function L(e){return e?A([e.func]):null}const N=new E(F,(e=>({__tag:"StencilTest",...e})));function F(e){return e?A([e.function.func,e.function.ref,e.function.mask,e.operation.fail,e.operation.zFail,e.operation.zPass]):null}const z=new E(H,(e=>({__tag:"DepthWrite",...e})));function H(e){return e?A([e.zNear,e.zFar]):null}const V=new E(U,(e=>({__tag:"ColorWrite",...e})));function U(e){return e?A([e.r,e.g,e.b,e.a]):null}const k=new E(B,(e=>({__tag:"StencilWrite",...e})));function B(e){return e?A([e.mask]):null}const G=new E($,(e=>({__tag:"DrawBuffers",...e})));function $(e){return e?A(e.buffers):null}const j=new E((function(e){return e?A([O(e.blending),C(e.culling),P(e.polygonOffset),L(e.depthTest),F(e.stencilTest),H(e.depthWrite),U(e.colorWrite),B(e.stencilWrite),$(e.drawBuffers)]):null}),(e=>({blending:g(e.blending),culling:m(e.culling),polygonOffset:_(e.polygonOffset),depthTest:v(e.depthTest),stencilTest:y(e.stencilTest),depthWrite:b(e.depthWrite),colorWrite:T(e.colorWrite),stencilWrite:x(e.stencilWrite),drawBuffers:w(e.drawBuffers)})));class Z{constructor(e){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._drawBuffersInvalid=!0,this._stateSetters=e}setPipeline(e){(this._pipelineInvalid||e!==this._pipeline)&&(this._setBlending(e.blending),this._setCulling(e.culling),this._setPolygonOffset(e.polygonOffset),this._setDepthTest(e.depthTest),this._setStencilTest(e.stencilTest),this._setDepthWrite(e.depthWrite),this._setColorWrite(e.colorWrite),this._setStencilWrite(e.stencilWrite),this._setDrawBuffers(e.drawBuffers),this._pipeline=e),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDrawBuffers(){this._drawBuffersInvalid=!0,this._pipelineInvalid=!0}_setBlending(e){this._blending=this._setSubState(e,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(e){this._culling=this._setSubState(e,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(e){this._polygonOffset=this._setSubState(e,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(e){this._depthTest=this._setSubState(e,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(e){this._stencilTest=this._setSubState(e,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(e){this._depthWrite=this._setSubState(e,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(e){this._colorWrite=this._setSubState(e,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(e){this._stencilWrite=this._setSubState(e,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setDrawBuffers(e){this._drawBuffers=this._setSubState(e,this._drawBuffers,this._drawBuffersInvalid,this._stateSetters.setDrawBuffers),this._drawBuffersInvalid=!1}_setSubState(e,t,n,i){return(n||e!==t)&&(i(e),this._pipelineInvalid=!0),e}}},31267:function(e,t,n){"use strict";n.d(t,{A:function(){return H}});var i=n(53804),r=(n(64122),n(88022)),o=n(88264),s=n(48996),a=n(40212),l=(n(58941),n(21609)),c=n(40633),u=n(95929),h=n(62560),d=n(60539),p=n(28181),f=n(66110),g=n(23502),m=n(77560),_=n(65953),v=n(44567),y=n(6792),b=n(92781);n(81401);const T={handleInterceptedEvent:(e,t,n,i)=>(e.scheduleRender(),t.properties[`on${i.type}`].apply(t.properties.bind||n,[i]))},x={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(e,t,n)=>{"-"===t.charAt(0)?e.style.setProperty(t,n):e.style[t]=n}},w=(e,t,n=!1)=>{let i=e;return t.forEach(((e,r)=>{const o=i?.children?((e,t)=>e.find(t))(i.children,(t=>t.domNode===e)):void 0;n&&!o&&r!==t.length-1||(i=o)})),i};var S=n(28754),E=n(69987),A=n(50074);const M=new Set;var O,R=n(15351),C=n(10362),I=n(22739),P=n(38225);let D=0;function L(e,t){const n=Object.prototype.hasOwnProperty;for(const i in t)n.call(t,i)&&n.call(e,i)&&(null!=e[i]&&null!=t[i]&&"object"==typeof e[i]&&"object"==typeof t[i]?L(e[i],t[i]):e[i]=t[i]);return e}const N=(e=>{let t;const n={...T,...e},i=(o=n,{...x,...o}),r=i.performanceLogger;var o;let s,a=!0,l=!1;const c=[],u=[],h=(e,o,s)=>{let a;i.eventHandlerInterceptor=(e,i,o,s)=>function(e){let i;r("domEvent",e);const o=((e,t)=>{const n=[];for(;e&&e!==t;)n.push(e),e=e.parentNode;return n})(e.currentTarget,a.domNode),s=o.some((e=>customElements.get(e?.tagName?.toLowerCase())));if(e.eventPhase!==Event.CAPTURING_PHASE&&s){const t=e.composedPath(),n=t.slice(t.indexOf(e.currentTarget),t.indexOf(a.domNode)).reverse();i=w(a.getLastRender(),n,!0)}else o.reverse(),i=w(a.getLastRender(),o);let l;return i&&(l=n.handleInterceptedEvent(t,i,this,e)),r("domEventProcessed",e),l},n.postProcessProjectionOptions?.(i);const l=s();a=e(o,l,i),i.eventHandlerInterceptor=void 0,c.push(a),u.push(s),n.afterFirstVNodeRendered&&n.afterFirstVNodeRendered(a,l)};let d=()=>{if(s=void 0,a){a=!1,r("renderStart",void 0);for(let e=0;e<c.length;e++){const t=u[e]();r("rendered",void 0);try{c[e].update(t)}catch(e){console.error(e)}r("patched",void 0)}r("renderDone",void 0),a=!0}};return n.modifyDoRenderImplementation&&(d=n.modifyDoRenderImplementation(d,c,u)),t={renderNow:d,scheduleRender:()=>{s||l||(s=requestAnimationFrame(d))},stop:()=>{s&&(cancelAnimationFrame(s),s=void 0),l=!0},resume:()=>{l=!1,a=!0,t.scheduleRender()},append:(e,t)=>{h(b.t.append,e,t)},insertBefore:(e,t)=>{h(b.t.insertBefore,e,t)},merge:(e,t)=>{h(b.t.merge,e,t)},replace:(e,t)=>{h(b.t.replace,e,t)},detach:e=>{for(let t=0;t<u.length;t++)if(u[t]===e)return u.splice(t,1),c.splice(t,1)[0];throw new Error("renderFunction was not found")}},t})({postProcessProjectionOptions(e){const t=e.eventHandlerInterceptor,n=/capture$/i;e.eventHandlerInterceptor=(e,i,r,o)=>{const s=t?.(e,i,r,o),a=n.test(e);if(!((e=e.replace(n,"")).toLowerCase()in r)||a){const t=e[2].toLowerCase()+e.slice(3),n=e=>s?.call(r,e);r.addEventListener(t,n,a);const i=()=>r.removeEventListener(t,n,a),l=o.afterRemoved;o.afterRemoved=e=>{l?.(e),i()}}return s}},handleInterceptedEvent(e,t,n,i){const{eventPhase:r,type:o}=i,s=r===Event.CAPTURING_PHASE;let a=`on${o}${s?"capture":""}`;const l=t.properties;(l&&a in l||(a=`on${o[0].toUpperCase()}${o.slice(1)}${s?"Capture":""}`,l&&a in l))&&((0,R.Sh)(),e.scheduleRender(),l[a].call(l.bind||n,i))}});let F=!1,z=class extends((0,h.g)(s.A.EventedAccessor)){constructor(e,t){super(e,t),this._attached=!1,this._projector=N,this._readyForTrueRender=!1,this.key=this,this.autoRenderingEnabled=!0,this._loadLocale=(0,d.sg)((async()=>{if(this._messageBundleProps?.length){const e=await Promise.allSettled(this._messageBundleProps.map((async({bundlePath:e,propertyName:t})=>{if(this.destroyed)return;let n=await(0,P.ud)(e);this.uiStrings&&Object.keys(this.uiStrings)&&(n=L((0,l.o8)(n),this.uiStrings)),this[t]=n})));if(this.destroyed)return;for(const t of e)"rejected"===t.status&&c.A.getLogger(this).error("widget-intl:locale-error",this.declaredClass,t.reason)}await this.loadLocale()})),(0,S.V)();const n="esri-widget-uid-"+(0,f.lk)(),i=this.render.bind(this);this._trackingTarget=new y.r((()=>{this.autoRenderingEnabled&&this.scheduleRender()}));const r=()=>({vnodeSelector:"div",properties:{key:`${n}-hidden`,class:"",styles:{display:"none"}},domNode:null,children:void 0,text:void 0}),o=()=>{if(!this._readyForTrueRender||this.destroyed)return null;const e=i()??r(),t=e.properties??={};if(t.key??=n,(0,E.b)(e.vnodeSelector)){if(!this.visible)return r()}else this.visible?t.styles||(t.styles={}):(t.class="",t.styles={display:"none"}),t.styles.display??="";let o=0;return e.children?.forEach((e=>{(0,E.b)(e.vnodeSelector)||(e.properties??={},e.properties.key??=`${this.id}--${o++}`)})),(0,E.d)(this,e)};this.render=()=>{if(F)return o();let e=(0,R.rE)(this)??null;if(e)return e;this._trackingTarget.clear(),F=!0;try{e=(0,v.a)(this._trackingTarget,o)}catch(e){throw c.A.getLogger(this).error(e),e}finally{F=!1}return e&&(0,R.$U)(this,e),e};const s=this.beforeFirstRender();var a;s?this._resourcesFetch=s.then((()=>{this._readyForTrueRender=!0,this._postInitialize()})):(this._resourcesFetch=Promise.resolve().then((()=>{this._postInitialize()})),this._readyForTrueRender=!0),this.addResolvingPromise(this._resourcesFetch),a=this._resourcesFetch,M.add(a),a.finally((()=>M.delete(a)))}normalizeCtorArgs(e,t){const n={...e};return t&&(n.container=t),n}postInitialize(){}beforeFirstRender(){const e=this.loadDependencies();return this._messageBundleProps?.length||e?Promise.all([e,this._loadLocale()]).then((()=>{})).catch(d.jH):null}loadDependencies(){return null}loadLocale(){return null}destroy(){this.destroyed||((0,u.pR)(this._trackingTarget),(0,u.pR)(this.viewModel),this._detach(this.container),this._set("container",null),this._emitter.clear(),this.render=()=>null,this._projector=null,(0,R.Qw)(this))}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return(0,o.$)(e)}get domNode(){return this.container}set domNode(e){this.container=e}get icon(){return null}set icon(e){this._overrideIfSome("icon",e)}get id(){return this._get("id")||this.container?.id||Date.now().toString(16)+"-widget-"+D++}set id(e){e&&this._set("id",e)}get label(){return this.declaredClass.split(".").pop()}set label(e){this._overrideIfSome("label",e)}get renderable(){return this._resourcesFetch}get visible(){return this._get("visible")}set visible(e){this._set("visible",e)}get[(O=A.x,A.D)](){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||((0,R.Qw)(this),this._projector.scheduleRender())}own(e){(0,r.eO)(c.A.getLogger(this),"`Widget.own()` is deprecated in favor of 'Widget.addHandles()'",{replacement:"Widget.addHandles()",version:"4.28"}),this.addHandles(e)}classes(...e){return C.Ly.apply(this,e)}renderNow(){(0,R.Qw)(this),this._projector.renderNow()}_postInitialize(){if(this.destroyed)return;this.scheduleRender(),this._delegatedEventNames?.length&&this.addHandles((0,p.watch)((()=>this.viewModel),((e,t)=>{t&&this.removeHandles("delegated-events"),e&&(0,a.wb)(e)&&this.addHandles(this._delegatedEventNames.map((t=>(0,a.on)(e,t,(e=>{this.emit(t,e)})))),"delegated-events")}),p.pc)),this.postInitialize();const e=async()=>{await this._loadLocale().catch(d.jH),this.scheduleRender()};this.addHandles([(0,I.oQ)(e),(0,p.watch)((()=>this.uiStrings),e),(0,p.when)((()=>this.container),(e=>{this.destroyed||this._attach(e)}),{initial:!0,once:!0})])}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){this._attached&&(this._projector.detach(this.render),this._attached=!1),e?.parentNode?.removeChild(e)}};z[O]=!0,z.vnodeSelector="div",(0,i._)([(0,g.MZ)()],z.prototype,"_readyForTrueRender",void 0),(0,i._)([(0,g.MZ)({value:null})],z.prototype,"container",null),(0,i._)([(0,m.w)("container")],z.prototype,"castContainer",null),(0,i._)([(0,g.MZ)()],z.prototype,"icon",null),(0,i._)([(0,g.MZ)()],z.prototype,"id",null),(0,i._)([(0,g.MZ)()],z.prototype,"label",null),(0,i._)([(0,g.MZ)()],z.prototype,"renderable",null),(0,i._)([(0,g.MZ)()],z.prototype,"uiStrings",void 0),(0,i._)([(0,g.MZ)()],z.prototype,"viewModel",void 0),(0,i._)([(0,g.MZ)({value:!0})],z.prototype,"visible",null),(0,i._)([(0,g.MZ)()],z.prototype,"key",void 0),(0,i._)([(0,g.MZ)()],z.prototype,"children",void 0),(0,i._)([(0,g.MZ)()],z.prototype,"afterCreate",void 0),(0,i._)([(0,g.MZ)()],z.prototype,"afterUpdate",void 0),(0,i._)([(0,g.MZ)()],z.prototype,"afterRemoved",void 0),z=(0,i._)([(0,_.$)("esri.widgets.Widget")],z);const H=z},28754:function(e,t,n){"use strict";n.d(t,{V:function(){return h},W:function(){return d}});var i=n(96367),r=n(67646),o=n(54038),s=n(3102);function a(){const{classList:e}=document.body,t=window.matchMedia("(prefers-color-scheme: dark)").matches,n=()=>e.contains(i.d)||e.contains(i.a)&&t?"dark":"light",r=e=>document.body.dispatchEvent(new CustomEvent("calciteModeChange",{bubbles:!0,detail:{mode:e}})),o=e=>{s!==e&&r(e),s=e};let s=n();r(s),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",(e=>o(e.matches?"dark":"light"))),new MutationObserver((()=>o(n()))).observe(document.body,{attributes:!0,attributeFilter:["class"]})}(0,o.i)()&&("interactive"===document.readyState?a():document.addEventListener("DOMContentLoaded",(()=>a()),{once:!0})),(0,r.s)();var l=n(53216),c=(n(58941),n(90683));let u;function h(){try{(0,s.OX)(".")}catch{(0,s.Qu)((0,c.s2)((0,l.s)(u)))}}function d(e){const t=[];for(const n of Object.keys(e))customElements.get(`calcite-${n}`)||t.push(e[n]?.());return t.length>0?Promise.all(t):null}u="components/assets"},90357:function(e,t,n){"use strict";function i(e){return(t,n)=>{t.hasOwnProperty("_messageBundleProps")||(t._messageBundleProps=t._messageBundleProps?t._messageBundleProps.slice():[]),t._messageBundleProps.push({bundlePath:e,propertyName:n})}}n.d(t,{G:function(){return i}})},49146:function(e,t,n){"use strict";n.d(t,{K:function(){return a},w:function(){return l}});var i=n(69987),r=function(e){return{vnodeSelector:"",properties:void 0,children:void 0,text:e.toString(),domNode:null}},o=function(e,t){for(var n=0,i=e.length;n<i;n++){var s=e[n];Array.isArray(s)?o(s,t):null!=s&&!1!==s&&(s.hasOwnProperty("vnodeSelector")||(s=r(s)),t.push(s))}},s=function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];if(1===n.length&&"string"==typeof n[0])return{vnodeSelector:e,properties:t||void 0,children:void 0,text:n[0],domNode:null};var r=[];return o(n,r),{vnodeSelector:e,properties:t||void 0,children:r,text:void 0,domNode:null}};function a(e,t,...n){return"function"!=typeof e||(0,i.b)(e)?s(e,t,...n):e(t,...n)}function l(...e){return e}},69987:function(e,t,n){"use strict";n.d(t,{b:function(){return d},d:function(){return l}});var i=n(61226),r=n(50074);const o=[],s={},a=new WeakMap;function l(e,t){let n=t.children;if(n?.length)for(let t=0;t<n.length;++t)n[t]=l(e,n[t]);else n=o;const i=t.vnodeSelector;if(d(i)){const r=t.properties||s,o=r.key||i,a={key:o,afterCreate:c,afterUpdate:u,afterRemoved:h,parentWidget:e,widgetConstructor:i,widgetProperties:{...r,key:o,children:n}};return{vnodeSelector:i.vnodeSelector,properties:a,children:void 0,text:void 0,domNode:null}}return t}function c(e,t,n,{parentWidget:o,widgetConstructor:s,widgetProperties:l}){const c=new s(l);c.container=e,a.set(e,c),c.afterCreate?.(c,e),o.addHandles((0,i.hA)((()=>h(e)))),queueMicrotask((()=>{c[r.D].projector.renderNow()}))}function u(e,t,n,{widgetProperties:i}){const r=a.get(e);r&&(r.set(i),r.afterUpdate?.(r,e))}function h(e){const t=a.get(e);t&&(t.afterRemoved?.(t,e),t.destroy(),a.delete(e))}function d(e){return"function"==typeof e&&e[r.x]}},50074:function(e,t,n){"use strict";n.d(t,{D:function(){return r},x:function(){return i}});const i=Symbol("widget"),r=Symbol("widget-test-data")},15351:function(e,t,n){"use strict";n.d(t,{$U:function(){return s},Qw:function(){return a},Sh:function(){return r},rE:function(){return o}});const i=new Map;function r(){i.clear()}function o(e){return i.get(e)}function s(e,t){i.set(e,t)}function a(e){i.delete(e)}},10362:function(e,t,n){"use strict";n.d(t,{Ly:function(){return he},N_:function(){return pe},OU:function(){return ve},V8:function(){return de},W5:function(){return _e},Z6:function(){return ye},cA:function(){return fe}});var i=function(){return i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},i.apply(this,arguments)},r={exports:{}},o={},s={exports:{}},a={};function l(){return{"align-content":!1,"align-items":!1,"align-self":!1,"alignment-adjust":!1,"alignment-baseline":!1,all:!1,"anchor-point":!1,animation:!1,"animation-delay":!1,"animation-direction":!1,"animation-duration":!1,"animation-fill-mode":!1,"animation-iteration-count":!1,"animation-name":!1,"animation-play-state":!1,"animation-timing-function":!1,azimuth:!1,"backface-visibility":!1,background:!0,"background-attachment":!0,"background-clip":!0,"background-color":!0,"background-image":!0,"background-origin":!0,"background-position":!0,"background-repeat":!0,"background-size":!0,"baseline-shift":!1,binding:!1,bleed:!1,"bookmark-label":!1,"bookmark-level":!1,"bookmark-state":!1,border:!0,"border-bottom":!0,"border-bottom-color":!0,"border-bottom-left-radius":!0,"border-bottom-right-radius":!0,"border-bottom-style":!0,"border-bottom-width":!0,"border-collapse":!0,"border-color":!0,"border-image":!0,"border-image-outset":!0,"border-image-repeat":!0,"border-image-slice":!0,"border-image-source":!0,"border-image-width":!0,"border-left":!0,"border-left-color":!0,"border-left-style":!0,"border-left-width":!0,"border-radius":!0,"border-right":!0,"border-right-color":!0,"border-right-style":!0,"border-right-width":!0,"border-spacing":!0,"border-style":!0,"border-top":!0,"border-top-color":!0,"border-top-left-radius":!0,"border-top-right-radius":!0,"border-top-style":!0,"border-top-width":!0,"border-width":!0,bottom:!1,"box-decoration-break":!0,"box-shadow":!0,"box-sizing":!0,"box-snap":!0,"box-suppress":!0,"break-after":!0,"break-before":!0,"break-inside":!0,"caption-side":!1,chains:!1,clear:!0,clip:!1,"clip-path":!1,"clip-rule":!1,color:!0,"color-interpolation-filters":!0,"column-count":!1,"column-fill":!1,"column-gap":!1,"column-rule":!1,"column-rule-color":!1,"column-rule-style":!1,"column-rule-width":!1,"column-span":!1,"column-width":!1,columns:!1,contain:!1,content:!1,"counter-increment":!1,"counter-reset":!1,"counter-set":!1,crop:!1,cue:!1,"cue-after":!1,"cue-before":!1,cursor:!1,direction:!1,display:!0,"display-inside":!0,"display-list":!0,"display-outside":!0,"dominant-baseline":!1,elevation:!1,"empty-cells":!1,filter:!1,flex:!1,"flex-basis":!1,"flex-direction":!1,"flex-flow":!1,"flex-grow":!1,"flex-shrink":!1,"flex-wrap":!1,float:!1,"float-offset":!1,"flood-color":!1,"flood-opacity":!1,"flow-from":!1,"flow-into":!1,font:!0,"font-family":!0,"font-feature-settings":!0,"font-kerning":!0,"font-language-override":!0,"font-size":!0,"font-size-adjust":!0,"font-stretch":!0,"font-style":!0,"font-synthesis":!0,"font-variant":!0,"font-variant-alternates":!0,"font-variant-caps":!0,"font-variant-east-asian":!0,"font-variant-ligatures":!0,"font-variant-numeric":!0,"font-variant-position":!0,"font-weight":!0,grid:!1,"grid-area":!1,"grid-auto-columns":!1,"grid-auto-flow":!1,"grid-auto-rows":!1,"grid-column":!1,"grid-column-end":!1,"grid-column-start":!1,"grid-row":!1,"grid-row-end":!1,"grid-row-start":!1,"grid-template":!1,"grid-template-areas":!1,"grid-template-columns":!1,"grid-template-rows":!1,"hanging-punctuation":!1,height:!0,hyphens:!1,icon:!1,"image-orientation":!1,"image-resolution":!1,"ime-mode":!1,"initial-letters":!1,"inline-box-align":!1,"justify-content":!1,"justify-items":!1,"justify-self":!1,left:!1,"letter-spacing":!0,"lighting-color":!0,"line-box-contain":!1,"line-break":!1,"line-grid":!1,"line-height":!1,"line-snap":!1,"line-stacking":!1,"line-stacking-ruby":!1,"line-stacking-shift":!1,"line-stacking-strategy":!1,"list-style":!0,"list-style-image":!0,"list-style-position":!0,"list-style-type":!0,margin:!0,"margin-bottom":!0,"margin-left":!0,"margin-right":!0,"margin-top":!0,"marker-offset":!1,"marker-side":!1,marks:!1,mask:!1,"mask-box":!1,"mask-box-outset":!1,"mask-box-repeat":!1,"mask-box-slice":!1,"mask-box-source":!1,"mask-box-width":!1,"mask-clip":!1,"mask-image":!1,"mask-origin":!1,"mask-position":!1,"mask-repeat":!1,"mask-size":!1,"mask-source-type":!1,"mask-type":!1,"max-height":!0,"max-lines":!1,"max-width":!0,"min-height":!0,"min-width":!0,"move-to":!1,"nav-down":!1,"nav-index":!1,"nav-left":!1,"nav-right":!1,"nav-up":!1,"object-fit":!1,"object-position":!1,opacity:!1,order:!1,orphans:!1,outline:!1,"outline-color":!1,"outline-offset":!1,"outline-style":!1,"outline-width":!1,overflow:!1,"overflow-wrap":!1,"overflow-x":!1,"overflow-y":!1,padding:!0,"padding-bottom":!0,"padding-left":!0,"padding-right":!0,"padding-top":!0,page:!1,"page-break-after":!1,"page-break-before":!1,"page-break-inside":!1,"page-policy":!1,pause:!1,"pause-after":!1,"pause-before":!1,perspective:!1,"perspective-origin":!1,pitch:!1,"pitch-range":!1,"play-during":!1,position:!1,"presentation-level":!1,quotes:!1,"region-fragment":!1,resize:!1,rest:!1,"rest-after":!1,"rest-before":!1,richness:!1,right:!1,rotation:!1,"rotation-point":!1,"ruby-align":!1,"ruby-merge":!1,"ruby-position":!1,"shape-image-threshold":!1,"shape-outside":!1,"shape-margin":!1,size:!1,speak:!1,"speak-as":!1,"speak-header":!1,"speak-numeral":!1,"speak-punctuation":!1,"speech-rate":!1,stress:!1,"string-set":!1,"tab-size":!1,"table-layout":!1,"text-align":!0,"text-align-last":!0,"text-combine-upright":!0,"text-decoration":!0,"text-decoration-color":!0,"text-decoration-line":!0,"text-decoration-skip":!0,"text-decoration-style":!0,"text-emphasis":!0,"text-emphasis-color":!0,"text-emphasis-position":!0,"text-emphasis-style":!0,"text-height":!0,"text-indent":!0,"text-justify":!0,"text-orientation":!0,"text-overflow":!0,"text-shadow":!0,"text-space-collapse":!0,"text-transform":!0,"text-underline-position":!0,"text-wrap":!0,top:!1,transform:!1,"transform-origin":!1,"transform-style":!1,transition:!1,"transition-delay":!1,"transition-duration":!1,"transition-property":!1,"transition-timing-function":!1,"unicode-bidi":!1,"vertical-align":!1,visibility:!1,"voice-balance":!1,"voice-duration":!1,"voice-family":!1,"voice-pitch":!1,"voice-range":!1,"voice-rate":!1,"voice-stress":!1,"voice-volume":!1,volume:!1,"white-space":!1,widows:!1,width:!0,"will-change":!1,"word-break":!0,"word-spacing":!0,"word-wrap":!0,"wrap-flow":!1,"wrap-through":!1,"writing-mode":!1,"z-index":!1}}var c=/javascript\s*\:/gim;a.whiteList={"align-content":!1,"align-items":!1,"align-self":!1,"alignment-adjust":!1,"alignment-baseline":!1,all:!1,"anchor-point":!1,animation:!1,"animation-delay":!1,"animation-direction":!1,"animation-duration":!1,"animation-fill-mode":!1,"animation-iteration-count":!1,"animation-name":!1,"animation-play-state":!1,"animation-timing-function":!1,azimuth:!1,"backface-visibility":!1,background:!0,"background-attachment":!0,"background-clip":!0,"background-color":!0,"background-image":!0,"background-origin":!0,"background-position":!0,"background-repeat":!0,"background-size":!0,"baseline-shift":!1,binding:!1,bleed:!1,"bookmark-label":!1,"bookmark-level":!1,"bookmark-state":!1,border:!0,"border-bottom":!0,"border-bottom-color":!0,"border-bottom-left-radius":!0,"border-bottom-right-radius":!0,"border-bottom-style":!0,"border-bottom-width":!0,"border-collapse":!0,"border-color":!0,"border-image":!0,"border-image-outset":!0,"border-image-repeat":!0,"border-image-slice":!0,"border-image-source":!0,"border-image-width":!0,"border-left":!0,"border-left-color":!0,"border-left-style":!0,"border-left-width":!0,"border-radius":!0,"border-right":!0,"border-right-color":!0,"border-right-style":!0,"border-right-width":!0,"border-spacing":!0,"border-style":!0,"border-top":!0,"border-top-color":!0,"border-top-left-radius":!0,"border-top-right-radius":!0,"border-top-style":!0,"border-top-width":!0,"border-width":!0,bottom:!1,"box-decoration-break":!0,"box-shadow":!0,"box-sizing":!0,"box-snap":!0,"box-suppress":!0,"break-after":!0,"break-before":!0,"break-inside":!0,"caption-side":!1,chains:!1,clear:!0,clip:!1,"clip-path":!1,"clip-rule":!1,color:!0,"color-interpolation-filters":!0,"column-count":!1,"column-fill":!1,"column-gap":!1,"column-rule":!1,"column-rule-color":!1,"column-rule-style":!1,"column-rule-width":!1,"column-span":!1,"column-width":!1,columns:!1,contain:!1,content:!1,"counter-increment":!1,"counter-reset":!1,"counter-set":!1,crop:!1,cue:!1,"cue-after":!1,"cue-before":!1,cursor:!1,direction:!1,display:!0,"display-inside":!0,"display-list":!0,"display-outside":!0,"dominant-baseline":!1,elevation:!1,"empty-cells":!1,filter:!1,flex:!1,"flex-basis":!1,"flex-direction":!1,"flex-flow":!1,"flex-grow":!1,"flex-shrink":!1,"flex-wrap":!1,float:!1,"float-offset":!1,"flood-color":!1,"flood-opacity":!1,"flow-from":!1,"flow-into":!1,font:!0,"font-family":!0,"font-feature-settings":!0,"font-kerning":!0,"font-language-override":!0,"font-size":!0,"font-size-adjust":!0,"font-stretch":!0,"font-style":!0,"font-synthesis":!0,"font-variant":!0,"font-variant-alternates":!0,"font-variant-caps":!0,"font-variant-east-asian":!0,"font-variant-ligatures":!0,"font-variant-numeric":!0,"font-variant-position":!0,"font-weight":!0,grid:!1,"grid-area":!1,"grid-auto-columns":!1,"grid-auto-flow":!1,"grid-auto-rows":!1,"grid-column":!1,"grid-column-end":!1,"grid-column-start":!1,"grid-row":!1,"grid-row-end":!1,"grid-row-start":!1,"grid-template":!1,"grid-template-areas":!1,"grid-template-columns":!1,"grid-template-rows":!1,"hanging-punctuation":!1,height:!0,hyphens:!1,icon:!1,"image-orientation":!1,"image-resolution":!1,"ime-mode":!1,"initial-letters":!1,"inline-box-align":!1,"justify-content":!1,"justify-items":!1,"justify-self":!1,left:!1,"letter-spacing":!0,"lighting-color":!0,"line-box-contain":!1,"line-break":!1,"line-grid":!1,"line-height":!1,"line-snap":!1,"line-stacking":!1,"line-stacking-ruby":!1,"line-stacking-shift":!1,"line-stacking-strategy":!1,"list-style":!0,"list-style-image":!0,"list-style-position":!0,"list-style-type":!0,margin:!0,"margin-bottom":!0,"margin-left":!0,"margin-right":!0,"margin-top":!0,"marker-offset":!1,"marker-side":!1,marks:!1,mask:!1,"mask-box":!1,"mask-box-outset":!1,"mask-box-repeat":!1,"mask-box-slice":!1,"mask-box-source":!1,"mask-box-width":!1,"mask-clip":!1,"mask-image":!1,"mask-origin":!1,"mask-position":!1,"mask-repeat":!1,"mask-size":!1,"mask-source-type":!1,"mask-type":!1,"max-height":!0,"max-lines":!1,"max-width":!0,"min-height":!0,"min-width":!0,"move-to":!1,"nav-down":!1,"nav-index":!1,"nav-left":!1,"nav-right":!1,"nav-up":!1,"object-fit":!1,"object-position":!1,opacity:!1,order:!1,orphans:!1,outline:!1,"outline-color":!1,"outline-offset":!1,"outline-style":!1,"outline-width":!1,overflow:!1,"overflow-wrap":!1,"overflow-x":!1,"overflow-y":!1,padding:!0,"padding-bottom":!0,"padding-left":!0,"padding-right":!0,"padding-top":!0,page:!1,"page-break-after":!1,"page-break-before":!1,"page-break-inside":!1,"page-policy":!1,pause:!1,"pause-after":!1,"pause-before":!1,perspective:!1,"perspective-origin":!1,pitch:!1,"pitch-range":!1,"play-during":!1,position:!1,"presentation-level":!1,quotes:!1,"region-fragment":!1,resize:!1,rest:!1,"rest-after":!1,"rest-before":!1,richness:!1,right:!1,rotation:!1,"rotation-point":!1,"ruby-align":!1,"ruby-merge":!1,"ruby-position":!1,"shape-image-threshold":!1,"shape-outside":!1,"shape-margin":!1,size:!1,speak:!1,"speak-as":!1,"speak-header":!1,"speak-numeral":!1,"speak-punctuation":!1,"speech-rate":!1,stress:!1,"string-set":!1,"tab-size":!1,"table-layout":!1,"text-align":!0,"text-align-last":!0,"text-combine-upright":!0,"text-decoration":!0,"text-decoration-color":!0,"text-decoration-line":!0,"text-decoration-skip":!0,"text-decoration-style":!0,"text-emphasis":!0,"text-emphasis-color":!0,"text-emphasis-position":!0,"text-emphasis-style":!0,"text-height":!0,"text-indent":!0,"text-justify":!0,"text-orientation":!0,"text-overflow":!0,"text-shadow":!0,"text-space-collapse":!0,"text-transform":!0,"text-underline-position":!0,"text-wrap":!0,top:!1,transform:!1,"transform-origin":!1,"transform-style":!1,transition:!1,"transition-delay":!1,"transition-duration":!1,"transition-property":!1,"transition-timing-function":!1,"unicode-bidi":!1,"vertical-align":!1,visibility:!1,"voice-balance":!1,"voice-duration":!1,"voice-family":!1,"voice-pitch":!1,"voice-range":!1,"voice-rate":!1,"voice-stress":!1,"voice-volume":!1,volume:!1,"white-space":!1,widows:!1,width:!0,"will-change":!1,"word-break":!0,"word-spacing":!0,"word-wrap":!0,"wrap-flow":!1,"wrap-through":!1,"writing-mode":!1,"z-index":!1},a.getDefaultWhiteList=l,a.onAttr=function(e,t,n){},a.onIgnoreAttr=function(e,t,n){},a.safeAttrValue=function(e,t){return c.test(t)?"":t};var u=function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},h=function(e){return String.prototype.trimRight?e.trimRight():e.replace(/(\s*$)/g,"")},d=a,p=function(e,t){";"!==(e=h(e))[e.length-1]&&(e+=";");var n=e.length,i=!1,r=0,o=0,s="";function a(){if(!i){var n=u(e.slice(r,o)),a=n.indexOf(":");if(-1!==a){var l=u(n.slice(0,a)),c=u(n.slice(a+1));if(l){var h=t(r,s.length,l,c,n);h&&(s+=h+"; ")}}}r=o+1}for(;o<n;o++){var l=e[o];if("/"===l&&"*"===e[o+1]){var c=e.indexOf("*/",o+2);if(-1===c)break;r=(o=c+1)+1,i=!1}else"("===l?i=!0:")"===l?i=!1:";"===l?i||a():"\n"===l&&a()}return u(s)};function f(e){return null==e}function g(e){(e=function(e){var t={};for(var n in e)t[n]=e[n];return t}(e||{})).whiteList=e.whiteList||d.whiteList,e.onAttr=e.onAttr||d.onAttr,e.onIgnoreAttr=e.onIgnoreAttr||d.onIgnoreAttr,e.safeAttrValue=e.safeAttrValue||d.safeAttrValue,this.options=e}g.prototype.process=function(e){if(!(e=(e=e||"").toString()))return"";var t=this.options,n=t.whiteList,i=t.onAttr,r=t.onIgnoreAttr,o=t.safeAttrValue;return p(e,(function(e,t,s,a,l){var c=n[s],u=!1;if(!0===c?u=c:"function"==typeof c?u=c(a):c instanceof RegExp&&(u=c.test(a)),!0!==u&&(u=!1),a=o(s,a)){var h,d={position:t,sourcePosition:e,source:l,isWhite:u};return u?f(h=i(s,a,d))?s+":"+a:h:f(h=r(s,a,d))?void 0:h}}))};var m=g;!function(e,t){var n=a,i=m;for(var r in(t=e.exports=function(e,t){return new i(t).process(e)}).FilterCSS=i,n)t[r]=n[r]}(s,s.exports);var _=s.exports,v={indexOf:function(e,t){var n,i;if(Array.prototype.indexOf)return e.indexOf(t);for(n=0,i=e.length;n<i;n++)if(e[n]===t)return n;return-1},forEach:function(e,t,n){var i,r;if(Array.prototype.forEach)return e.forEach(t,n);for(i=0,r=e.length;i<r;i++)t.call(n,e[i],i,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(e){var t=/\s|\n|\t/.exec(e);return t?t.index:-1}},y=_.FilterCSS,b=_.getDefaultWhiteList,T=v;var x=new y;function w(e){return e.replace(S,"&lt;").replace(E,"&gt;")}var S=/</g,E=/>/g,A=/"/g,M=/&quot;/g,O=/&#([a-zA-Z0-9]*);?/gim,R=/&colon;?/gim,C=/&newline;?/gim,I=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,P=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,D=/u\s*r\s*l\s*\(.*/gi;function L(e){return e.replace(A,"&quot;")}function N(e){return e.replace(M,'"')}function F(e){return e.replace(O,(function(e,t){return"x"===t[0]||"X"===t[0]?String.fromCharCode(parseInt(t.substr(1),16)):String.fromCharCode(parseInt(t,10))}))}function z(e){return e.replace(R,":").replace(C," ")}function H(e){for(var t="",n=0,i=e.length;n<i;n++)t+=e.charCodeAt(n)<32?" ":e.charAt(n);return T.trim(t)}function V(e){return H(e=z(e=F(e=N(e))))}function U(e){return w(e=L(e))}o.whiteList={a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]},o.getDefaultWhiteList=function(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}},o.onTag=function(e,t,n){},o.onIgnoreTag=function(e,t,n){},o.onTagAttr=function(e,t,n){},o.onIgnoreTagAttr=function(e,t,n){},o.safeAttrValue=function(e,t,n,i){if(n=V(n),"href"===t||"src"===t){if("#"===(n=T.trim(n)))return"#";if("http://"!==n.substr(0,7)&&"https://"!==n.substr(0,8)&&"mailto:"!==n.substr(0,7)&&"tel:"!==n.substr(0,4)&&"data:image/"!==n.substr(0,11)&&"ftp://"!==n.substr(0,6)&&"./"!==n.substr(0,2)&&"../"!==n.substr(0,3)&&"#"!==n[0]&&"/"!==n[0])return""}else if("background"===t){if(I.lastIndex=0,I.test(n))return""}else if("style"===t){if(P.lastIndex=0,P.test(n))return"";if(D.lastIndex=0,D.test(n)&&(I.lastIndex=0,I.test(n)))return"";!1!==i&&(n=(i=i||x).process(n))}return U(n)},o.escapeHtml=w,o.escapeQuote=L,o.unescapeQuote=N,o.escapeHtmlEntities=F,o.escapeDangerHtml5Entities=z,o.clearNonPrintableCharacter=H,o.friendlyAttrValue=V,o.escapeAttrValue=U,o.onIgnoreTagStripAll=function(){return""},o.StripTagBody=function(e,t){"function"!=typeof t&&(t=function(){});var n=!Array.isArray(e),i=[],r=!1;return{onIgnoreTag:function(o,s,a){if(function(t){return!!n||-1!==T.indexOf(e,t)}(o)){if(a.isClosing){var l=a.position+10;return i.push([!1!==r?r:a.position,l]),r=!1,"[/removed]"}return r||(r=a.position),"[removed]"}return t(o,s,a)},remove:function(e){var t="",n=0;return T.forEach(i,(function(i){t+=e.slice(n,i[0]),n=i[1]})),t+=e.slice(n)}}},o.stripCommentTag=function(e){for(var t="",n=0;n<e.length;){var i=e.indexOf("\x3c!--",n);if(-1===i){t+=e.slice(n);break}t+=e.slice(n,i);var r=e.indexOf("--\x3e",i);if(-1===r)break;n=r+3}return t},o.stripBlankChar=function(e){var t=e.split("");return(t=t.filter((function(e){var t=e.charCodeAt(0);return!(127===t||t<=31&&10!==t&&13!==t)}))).join("")},o.cssFilter=x,o.getDefaultCSSWhiteList=b;var k={},B=v;function G(e){var t,n=B.spaceIndex(e);return t=-1===n?e.slice(1,-1):e.slice(1,n+1),"/"===(t=B.trim(t).toLowerCase()).slice(0,1)&&(t=t.slice(1)),"/"===t.slice(-1)&&(t=t.slice(0,-1)),t}function $(e){return"</"===e.slice(0,2)}var j=/[^a-zA-Z0-9\\_:.-]/gim;function Z(e,t){for(;t<e.length;t++){var n=e[t];if(" "!==n)return"="===n?t:-1}}function W(e,t){for(;t<e.length;t++){var n=e[t];if(" "!==n)return"'"===n||'"'===n?t:-1}}function q(e,t){for(;t>0;t--){var n=e[t];if(" "!==n)return"="===n?t:-1}}function Y(e){return function(e){return'"'===e[0]&&'"'===e[e.length-1]||"'"===e[0]&&"'"===e[e.length-1]}(e)?e.substr(1,e.length-2):e}k.parseTag=function(e,t,n){var i="",r=0,o=!1,s=!1,a=0,l=e.length,c="",u="";e:for(a=0;a<l;a++){var h=e.charAt(a);if(!1===o){if("<"===h){o=a;continue}}else if(!1===s){if("<"===h){i+=n(e.slice(r,a)),o=a,r=a;continue}if(">"===h){i+=n(e.slice(r,o)),c=G(u=e.slice(o,a+1)),i+=t(o,i.length,c,u,$(u)),r=a+1,o=!1;continue}if('"'===h||"'"===h)for(var d=1,p=e.charAt(a-d);""===p.trim()||"="===p;){if("="===p){s=h;continue e}p=e.charAt(a-++d)}}else if(h===s){s=!1;continue}}return r<e.length&&(i+=n(e.substr(r))),i},k.parseAttr=function(e,t){var n=0,i=0,r=[],o=!1,s=e.length;function a(e,n){if(!((e=(e=B.trim(e)).replace(j,"").toLowerCase()).length<1)){var i=t(e,n||"");i&&r.push(i)}}for(var l=0;l<s;l++){var c,u=e.charAt(l);if(!1!==o||"="!==u)if(!1===o||l!==i){if(/\s|\n|\t/.test(u)){if(e=e.replace(/\s|\n|\t/g," "),!1===o){if(-1===(c=Z(e,l))){a(B.trim(e.slice(n,l))),o=!1,n=l+1;continue}l=c-1;continue}if(-1===(c=q(e,l-1))){a(o,Y(B.trim(e.slice(n,l)))),o=!1,n=l+1;continue}}}else{if(-1===(c=e.indexOf(u,l+1)))break;a(o,B.trim(e.slice(i+1,c))),o=!1,n=(l=c)+1}else o=e.slice(n,l),n=l+1,i='"'===e.charAt(n)||"'"===e.charAt(n)?n:W(e,l+1)}return n<e.length&&(!1===o?a(e.slice(n)):a(o,Y(B.trim(e.slice(n))))),B.trim(r.join(" "))};var X=_.FilterCSS,Q=o,K=k,J=K.parseTag,ee=K.parseAttr,te=v;function ne(e){return null==e}function ie(e){(e=function(e){var t={};for(var n in e)t[n]=e[n];return t}(e||{})).stripIgnoreTag&&(e.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),e.onIgnoreTag=Q.onIgnoreTagStripAll),e.whiteList||e.allowList?e.whiteList=function(e){var t={};for(var n in e)Array.isArray(e[n])?t[n.toLowerCase()]=e[n].map((function(e){return e.toLowerCase()})):t[n.toLowerCase()]=e[n];return t}(e.whiteList||e.allowList):e.whiteList=Q.whiteList,e.onTag=e.onTag||Q.onTag,e.onTagAttr=e.onTagAttr||Q.onTagAttr,e.onIgnoreTag=e.onIgnoreTag||Q.onIgnoreTag,e.onIgnoreTagAttr=e.onIgnoreTagAttr||Q.onIgnoreTagAttr,e.safeAttrValue=e.safeAttrValue||Q.safeAttrValue,e.escapeHtml=e.escapeHtml||Q.escapeHtml,this.options=e,!1===e.css?this.cssFilter=!1:(e.css=e.css||{},this.cssFilter=new X(e.css))}ie.prototype.process=function(e){if(!(e=(e=e||"").toString()))return"";var t=this.options,n=t.whiteList,i=t.onTag,r=t.onIgnoreTag,o=t.onTagAttr,s=t.onIgnoreTagAttr,a=t.safeAttrValue,l=t.escapeHtml,c=this.cssFilter;t.stripBlankChar&&(e=Q.stripBlankChar(e)),t.allowCommentTag||(e=Q.stripCommentTag(e));var u=!1;t.stripIgnoreTagBody&&(u=Q.StripTagBody(t.stripIgnoreTagBody,r),r=u.onIgnoreTag);var h=J(e,(function(e,t,u,h,d){var p={sourcePosition:e,position:t,isClosing:d,isWhite:Object.prototype.hasOwnProperty.call(n,u)},f=i(u,h,p);if(!ne(f))return f;if(p.isWhite){if(p.isClosing)return"</"+u+">";var g=function(e){var t=te.spaceIndex(e);if(-1===t)return{html:"",closing:"/"===e[e.length-2]};var n="/"===(e=te.trim(e.slice(t+1,-1)))[e.length-1];return n&&(e=te.trim(e.slice(0,-1))),{html:e,closing:n}}(h),m=n[u],_=ee(g.html,(function(e,t){var n=-1!==te.indexOf(m,e),i=o(u,e,t,n);return ne(i)?n?(t=a(u,e,t,c))?e+'="'+t+'"':e:ne(i=s(u,e,t,n))?void 0:i:i}));return h="<"+u,_&&(h+=" "+_),g.closing&&(h+=" /"),h+">"}return ne(f=r(u,h,p))?l(h):f}),l);return u&&(h=u.remove(h)),h};var re=ie;!function(e,t){var n=o,i=k,r=re;function s(e,t){return new r(t).process(e)}(t=e.exports=s).filterXSS=s,t.FilterXSS=r,function(){for(var e in n)t[e]=n[e];for(var r in i)t[r]=i[r]}(),"undefined"!=typeof self&&"undefined"!=typeof DedicatedWorkerGlobalScope&&self instanceof DedicatedWorkerGlobalScope&&(self.filterXSS=e.exports)}(r,r.exports);var oe=r.exports,se=function(){function e(e,t){var n,r=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],article:["style"],aside:["style"],audio:["autoplay","controls","loop","muted","preload"],b:[],blockquote:["style"],br:[],code:["style"],dd:["style"],del:["style"],details:["open","style"],div:["align","aria-hidden","aria-label","style"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],footer:["style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],header:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],main:["style"],mark:["style"],nav:["style"],ol:[],p:["style"],pre:["style"],section:["style"],source:["media","src","type"],span:["aria-hidden","aria-label","style"],strong:[],sub:["style"],summary:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],time:["style"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.arcgisCSSWhiteList=i(i({},oe.getDefaultCSSWhiteList()),{"align-items":!0,"align-self":!0,flex:!0,"flex-basis":!0,"flex-direction":!0,"flex-flow":!0,"flex-grow":!0,"flex-shrink":!0,"flex-wrap":!0,float:!0,gap:!0,grid:!0,"grid-area":!0,"grid-auto-columns":!0,"grid-auto-flow":!0,"grid-auto-rows":!0,"grid-column":!0,"grid-column-end":!0,"grid-column-start":!0,"grid-row":!0,"grid-row-end":!0,"grid-row-start":!0,"grid-template":!0,"grid-template-areas":!0,"grid-template-columns":!0,"grid-template-rows":!0,"justify-content":!0,"justify-items":!0,"justify-self":!0,"line-height":!0,overflow:!0}),this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(e,t,n,i){return"a"===e&&"href"===t||("img"===e||"source"===e)&&"src"===t?r.sanitizeUrl(n):oe.safeAttrValue(e,t,n,i)}},this._entityMap={"&":"&#x38;","<":"&#x3C;",">":"&#x3E;",'"':"&#x22;","'":"&#x27;","/":"&#x2F;"},e&&!t?n=e:e&&t?((n=Object.create(this.arcgisFilterOptions)).css={whiteList:this.arcgisCSSWhiteList},Object.keys(e).forEach((function(t){if("whiteList"===t)n.whiteList=r._extendObjectOfArrays([r.arcgisWhiteList,e.whiteList||{}]);else if("css"===t){var i=e.css.whiteList;null!=i&&e.css instanceof Object&&Object.keys(i).forEach((function(e){return n.css.whiteList[e]=i[e]}))}else n[t]=e[t]}))):((n=Object.create(this.arcgisFilterOptions)).whiteList=this.arcgisWhiteList,n.css={whiteList:this.arcgisCSSWhiteList}),this.xssFilterOptions=n,this._xssFilter=new oe.FilterXSS(n)}return e.prototype.sanitize=function(e,t){switch(void 0===t&&(t={}),typeof e){case"number":return isNaN(e)||!isFinite(e)?null:e;case"boolean":return e;case"string":return this._xssFilter.process(e);case"object":return this._iterateOverObject(e,t);default:if(t.allowUndefined&&void 0===e)return;return null}},e.prototype.sanitizeUrl=function(e,t){var n=(null!=t?t:{}).isProtocolRequired,i=void 0===n||n,r=this._trim(e.substring(0,e.indexOf(":"))),o="/"===e,s=/^#/.test(e),a=r&&this.allowedProtocols.indexOf(r.toLowerCase())>-1;return o||s||a?oe.escapeAttrValue(e):r||i?"":oe.escapeAttrValue("https://".concat(e))},e.prototype.sanitizeHTMLAttribute=function(e,t,n,i){return"function"==typeof this.xssFilterOptions.safeAttrValue?this.xssFilterOptions.safeAttrValue(e,t,n,i):oe.safeAttrValue(e,t,n,i)},e.prototype.validate=function(e,t){void 0===t&&(t={});var n=this.sanitize(e,t);return{isValid:e===n,sanitized:n}},e.prototype.encodeHTML=function(e){var t=this;return String(e).replace(/[&<>"'\/]/g,(function(e){return t._entityMap[e]}))},e.prototype.encodeAttrValue=function(e){var t=/^[a-zA-Z0-9]$/;return String(e).replace(/[\x00-\xFF]/g,(function(n,i){return t.test(n)?n:"&#x".concat(Number(e.charCodeAt(i)).toString(16),";")}))},e.prototype._extendObjectOfArrays=function(e){var t={};return e.forEach((function(e){Object.keys(e).forEach((function(n){Array.isArray(e[n])&&Array.isArray(t[n])?t[n]=t[n].concat(e[n]):t[n]=e[n]}))})),t},e.prototype._iterateOverObject=function(e,t){var n=this;void 0===t&&(t={});try{var i=!1,r=void 0;if(Array.isArray(e))r=e.reduce((function(e,r){var o=n.validate(r,t);return o.isValid?e.concat([r]):(i=!0,e.concat([o.sanitized]))}),[]);else{if(!function(e){if("object"!=typeof e||null===e)return!1;if("[object Object]"!==Object.prototype.toString.call(e))return!1;var t=Object.getPrototypeOf(e);if(null===t)return!0;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}(e)){if(t.allowUndefined&&void 0===e)return;return null}r=Object.keys(e).reduce((function(r,o){var s=e[o],a=n.validate(s,t);return a.isValid?r[o]=s:(i=!0,r[o]=a.sanitized),r}),{})}return i?r:e}catch(e){return null}},e.prototype._trim=function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},e}(),ae=n(14130),le=(n(61226),n(58941),n(40633),n(60539)),ce=(n(28181),n(74087)),ue=n(15351);function he(...e){const t=ae.A.acquire();for(let n=0;n<e.length;n++){const i=e[n],r=typeof i;if("string"===r)t.push(i);else if(Array.isArray(i))t.push.apply(t,i);else if("object"===r)for(const e in i)i[e]&&t.push(e)}const n=t.join(" ");return ae.A.release(t),n}function de(e){const t=e?.closest("[dir]");return null!==t&&t instanceof HTMLElement&&"rtl"===t.dir||"rtl"===document.dir}function pe(e){this[e.getAttribute("data-node-ref")]=null}function fe(e){this[e.getAttribute("data-node-ref")]=e}(()=>{const e=new Map;new ResizeObserver((t=>{(0,ue.Sh)();for(const n of t)e.get(n.target)?.(n)}))})();const ge=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"].reduce(((e,t)=>(e[t]=[],e)),{}),me=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],_e=new se({whiteList:ge,onTagAttr:(e,t,n)=>{const i=`${t}="${n}"`;if(me.includes(t))return i},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);function ve(e){return"Enter"===e||" "===e}async function ye(e,t){await(0,ce.$m)((0,le.Mq)(t));const n="function"==typeof e?e():e;n&&("setFocus"in n&&"function"==typeof n.setFocus?await n.setFocus():n instanceof HTMLElement&&n.focus())}}}]);
//# sourceMappingURL=views-3d-interactive-editingTools.js.map