{"version":3,"file":"symbols-cim-CIMSymbolRasterizer.js","mappings":"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","sources":["webpack://defra/./node_modules/@arcgis/core/symbols/cim/CIMResourceManager.js","webpack://defra/./node_modules/@arcgis/core/symbols/cim/CIMSymbolRasterizer.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport{loadFont as e}from\"../../core/fontUtils.js\";import{getImageData as t}from\"../../core/imageUtils.js\";class i{constructor(){this._resourceMap=new Map,this._inFlightResourceMap=new Map,this.geometryEngine=null,this.geometryEnginePromise=null}destroy(){this._inFlightResourceMap.clear(),this._resourceMap.clear()}getResource(e){return this._resourceMap.get(e)??null}async fetchResource(e,i){const h=this._resourceMap.get(e);if(h)return{width:h.width,height:h.height};let r=this._inFlightResourceMap.get(e);return r?r.then((e=>({width:e.width,height:e.height}))):(r=t(e,i),this._inFlightResourceMap.set(e,r),r.then((t=>(this._inFlightResourceMap.delete(e),this._resourceMap.set(e,t),{width:t.width,height:t.height})),(()=>({width:0,height:0}))))}deleteResource(e){this._inFlightResourceMap.delete(e),this._resourceMap.delete(e)}loadFont(t){return e(t)}}export{i as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport e from\"./CIMResourceManager.js\";import{Transformation as t,CanvasDrawHelper as i}from\"./CIMSymbolDrawHelper.js\";import{CIMSymbolHelper as r}from\"./CIMSymbolHelper.js\";import{OverrideHelper as a}from\"./OverrideHelper.js\";import{mapCIMSymbolToGeometryType as s}from\"./utils.js\";const n=96/72;class h{constructor(t){this._spatialReference=t,this._imageDataCanvas=null,this._cimResourceManager=new e}get _canvas(){return this._imageDataCanvas||(this._imageDataCanvas=document.createElement(\"canvas\")),this._imageDataCanvas}get resourceManager(){return this._cimResourceManager}async rasterizeCIMSymbolAsync(e,t,i,n,h,l,c,m,g){if(!e)return null;const{data:y}=e;if(!y||\"CIMSymbolReference\"!==y.type||!y.symbol)return null;const{symbol:d}=y;l||(l=s(d));const u=await a.resolveSymbolOverrides(y,t,this._spatialReference,h,l,c,m),w=this._cimResourceManager,p=[];r.fetchResources(u,w,p),r.fetchFonts(u,w,p),p.length>0&&await Promise.all(p);const{width:b,height:f}=i,M=o(l,b,f,n),C=r.getEnvelope(u,M,w);if(!C)return null;C.x===1/0&&(C.x=b+2),C.y===1/0&&(C.y=-f/2),C.width===-1/0&&(C.width=b),C.height===-1/0&&(C.height=f);let R=1,v=0,x=0;switch(d.type){case\"CIMPointSymbol\":case\"CIMTextSymbol\":{let e=1;C.width>b&&(e=b/C.width);let t=1;C.height>f&&(t=f/C.height),\"preview\"===n&&(C.width<b&&(e=b/C.width),C.height<f&&(t=f/C.height)),R=Math.min(e,t),v=C.x+C.width/2,x=C.y+C.height/2}break;case\"CIMLineSymbol\":{(g||C.height>f)&&(R=f/C.height),x=C.y+C.height/2;const e=C.x*R+b/2,t=(C.x+C.width)*R+b/2,{paths:i}=M;i[0][0][0]-=e/R,i[0][2][0]-=(t-b)/R}break;case\"CIMPolygonSymbol\":{v=C.x+C.width/2,x=C.y+C.height/2;const e=C.x*R+b/2,t=(C.x+C.width)*R+b/2,i=C.y*R+f/2,r=(C.y+C.height)*R+f/2,{rings:a}=M;e<0&&(a[0][0][0]-=e,a[0][3][0]-=e,a[0][4][0]-=e),i<0&&(a[0][0][1]+=i,a[0][1][1]+=i,a[0][4][1]+=i),t>b&&(a[0][1][0]-=t-b,a[0][2][0]-=t-b),r>f&&(a[0][2][1]+=r-f,a[0][3][1]+=r-f)}}const I={type:\"cim\",data:{type:\"CIMSymbolReference\",symbol:u}};return this.rasterize(I,b,f,v,x,R,l,1,M)}rasterize(e,r,a,h,l,c,m,g=0,y=null){const{data:d}=e;if(!d||\"CIMSymbolReference\"!==d.type||!d.symbol)return null;const{symbol:u}=d,w=this._canvas,p=(window.devicePixelRatio||1)*n;w.width=r*p,w.height=a*p,m||(m=s(u)),y||(y=o(m,r,a,\"legend\")),w.width+=2*g,w.height+=2*g;const b=w.getContext(\"2d\",{willReadFrequently:!0}),f=t.createIdentity();f.translate(-h,-l),f.scale(c*p,-c*p),f.translate(r*p/2+g,a*p/2+g),b.clearRect(0,0,w.width,w.height);return new i(b,this._cimResourceManager,f,!0).drawSymbol(u,y),b.getImageData(0,0,w.width,w.height)}}function o(e,t,i,r){const a=1,s=-t/2+a,n=t/2-a,h=i/2-a,o=-i/2+a;switch(e){case\"esriGeometryPoint\":return{x:0,y:0};case\"esriGeometryPolyline\":return{paths:[[[s,0],[0,0],[n,0]]]};default:return\"legend\"===r?{rings:[[[s,h],[n,0],[n,o],[s,o],[s,h]]]}:{rings:[[[s,h],[n,h],[n,o],[s,o],[s,h]]]}}}export{h as CIMSymbolRasterizer};\n"],"names":["i","constructor","this","_resourceMap","Map","_inFlightResourceMap","geometryEngine","geometryEnginePromise","destroy","clear","getResource","e","get","fetchResource","h","width","height","r","then","set","t","delete","deleteResource","loadFont","n","_spatialReference","_imageDataCanvas","_cimResourceManager","_canvas","document","createElement","resourceManager","rasterizeCIMSymbolAsync","l","c","m","g","data","y","type","symbol","d","u","resolveSymbolOverrides","w","p","fetchResources","fetchFonts","length","Promise","all","b","f","M","o","C","getEnvelope","x","R","v","Math","min","paths","rings","a","I","rasterize","window","devicePixelRatio","getContext","willReadFrequently","createIdentity","translate","scale","clearRect","drawSymbol","getImageData","s"],"sourceRoot":""}