"use strict";(self.webpackChunkdefra=self.webpackChunkdefra||[]).push([[2072],{90735:function(e,t,n){n.d(t,{J:function(){return o}});var r,i=n(32150),s={exports:{}};const o=(0,i.g)(function(){return r||(r=1,e=s,t=function(){var e=function(){function e(e){this.message="JPEG error: "+e}return e.prototype=new Error,e.prototype.name="JpegError",e.constructor=e,e}();return function(){if(!self||!self.Uint8ClampedArray)return null;var t=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),n=4017,r=799,i=3406,s=2276,o=1567,a=3784,l=5793,u=2896;function c(){this.decodeTransform=null,this.colorTransform=-1}function p(e,t){for(var n,r,i=0,s=[],o=16;o>0&&!e[o-1];)o--;s.push({children:[],index:0});var a,l=s[0];for(n=0;n<o;n++){for(r=0;r<e[n];r++){for((l=s.pop()).children[l.index]=t[i];l.index>0;)l=s.pop();for(l.index++,s.push(l);s.length<=n;)s.push(a={children:[],index:0}),l.children[l.index]=a.children,l=a;i++}n+1<o&&(s.push(a={children:[],index:0}),l.children[l.index]=a.children,l=a)}return s[0].children}function h(e,t,n){return 64*((e.blocksPerLine+1)*t+n)}function f(n,r,i,s,o,a,l,u,c){var p=i.mcusPerLine,f=i.progressive,d=r,m=0,g=0;function w(){if(g>0)return g--,m>>g&1;if(255===(m=n[r++])){var t=n[r++];if(t)throw new e("unexpected marker "+(m<<8|t).toString(16))}return g=7,m>>>7}function b(t){for(var n=t;;){if("number"==typeof(n=n[w()]))return n;if("object"!=typeof n)throw new e("invalid huffman sequence")}}function v(e){for(var t=0;e>0;)t=t<<1|w(),e--;return t}function x(e){if(1===e)return 1===w()?1:-1;var t=v(e);return t>=1<<e-1?t:t+(-1<<e)+1}var M,A=0,I=0;function S(e,t,n,r,i){var s=n%p;t(e,h(e,(n/p|0)*e.v+r,s*e.h+i))}function _(e,t,n){t(e,h(e,n/e.blocksPerLine|0,n%e.blocksPerLine))}var C,T,k,R,P,N,D=s.length;N=f?0===a?0===u?function(e,t){var n=b(e.huffmanTableDC),r=0===n?0:x(n)<<c;e.blockData[t]=e.pred+=r}:function(e,t){e.blockData[t]|=w()<<c}:0===u?function(e,n){if(A>0)A--;else for(var r=a,i=l;r<=i;){var s=b(e.huffmanTableAC),o=15&s,u=s>>4;if(0!==o){var p=t[r+=u];e.blockData[n+p]=x(o)*(1<<c),r++}else{if(u<15){A=v(u)+(1<<u)-1;break}r+=16}}}:function(n,r){for(var i,s,o=a,u=l,p=0;o<=u;){var h=t[o];switch(I){case 0:if(p=(s=b(n.huffmanTableAC))>>4,0==(i=15&s))p<15?(A=v(p)+(1<<p),I=4):(p=16,I=1);else{if(1!==i)throw new e("invalid ACn encoding");M=x(i),I=p?2:3}continue;case 1:case 2:n.blockData[r+h]?n.blockData[r+h]+=w()<<c:0==--p&&(I=2===I?3:0);break;case 3:n.blockData[r+h]?n.blockData[r+h]+=w()<<c:(n.blockData[r+h]=M<<c,I=0);break;case 4:n.blockData[r+h]&&(n.blockData[r+h]+=w()<<c)}o++}4===I&&0==--A&&(I=0)}:function(e,n){var r=b(e.huffmanTableDC),i=0===r?0:x(r);e.blockData[n]=e.pred+=i;for(var s=1;s<64;){var o=b(e.huffmanTableAC),a=15&o,l=o>>4;if(0!==a){var u=t[s+=l];e.blockData[n+u]=x(a),s++}else{if(l<15)break;s+=16}}};var E,L,F,O,z=0;for(L=1===D?s[0].blocksPerLine*s[0].blocksPerColumn:p*i.mcusPerColumn;z<L;){var j=o?Math.min(L-z,o):L;for(T=0;T<D;T++)s[T].pred=0;if(A=0,1===D)for(C=s[0],P=0;P<j;P++)_(C,N,z),z++;else for(P=0;P<j;P++){for(T=0;T<D;T++)for(F=(C=s[T]).h,O=C.v,k=0;k<O;k++)for(R=0;R<F;R++)S(C,N,z,k,R);z++}g=0,(E=y(n,r))&&E.invalid&&(console.log("decodeScan - unexpected MCU data, next marker is: "+E.invalid),r=E.offset);var B=E&&E.marker;if(!B||B<=65280)throw new e("marker was not found");if(!(B>=65488&&B<=65495))break;r+=2}return(E=y(n,r))&&E.invalid&&(console.log("decodeScan - unexpected Scan data, next marker is: "+E.invalid),r=E.offset),r-d}function d(t,c,p){var h,f,d,m,y,g,w,b,v,x,M,A,I,S,_,C,T,k=t.quantizationTable,R=t.blockData;if(!k)throw new e("missing required Quantization Table.");for(var P=0;P<64;P+=8)v=R[c+P],x=R[c+P+1],M=R[c+P+2],A=R[c+P+3],I=R[c+P+4],S=R[c+P+5],_=R[c+P+6],C=R[c+P+7],v*=k[P],x|M|A|I|S|_|C?(x*=k[P+1],M*=k[P+2],A*=k[P+3],I*=k[P+4],S*=k[P+5],_*=k[P+6],C*=k[P+7],f=(h=(h=l*v+128>>8)+(f=l*I+128>>8)+1>>1)-f,T=(d=M)*a+(m=_)*o+128>>8,d=d*o-m*a+128>>8,w=(y=(y=u*(x-C)+128>>8)+(w=S<<4)+1>>1)-w,g=(b=(b=u*(x+C)+128>>8)+(g=A<<4)+1>>1)-g,m=(h=h+(m=T)+1>>1)-m,d=(f=f+d+1>>1)-d,T=y*s+b*i+2048>>12,y=y*i-b*s+2048>>12,b=T,T=g*r+w*n+2048>>12,g=g*n-w*r+2048>>12,w=T,p[P]=h+b,p[P+7]=h-b,p[P+1]=f+w,p[P+6]=f-w,p[P+2]=d+g,p[P+5]=d-g,p[P+3]=m+y,p[P+4]=m-y):(T=l*v+512>>10,p[P]=T,p[P+1]=T,p[P+2]=T,p[P+3]=T,p[P+4]=T,p[P+5]=T,p[P+6]=T,p[P+7]=T);for(var N=0;N<8;++N)v=p[N],(x=p[N+8])|(M=p[N+16])|(A=p[N+24])|(I=p[N+32])|(S=p[N+40])|(_=p[N+48])|(C=p[N+56])?(f=(h=4112+((h=l*v+2048>>12)+(f=l*I+2048>>12)+1>>1))-f,T=(d=M)*a+(m=_)*o+2048>>12,d=d*o-m*a+2048>>12,m=T,w=(y=(y=u*(x-C)+2048>>12)+(w=S)+1>>1)-w,g=(b=(b=u*(x+C)+2048>>12)+(g=A)+1>>1)-g,T=y*s+b*i+2048>>12,y=y*i-b*s+2048>>12,b=T,T=g*r+w*n+2048>>12,g=g*n-w*r+2048>>12,v=(v=(h=h+m+1>>1)+b)<16?0:v>=4080?255:v>>4,x=(x=(f=f+d+1>>1)+(w=T))<16?0:x>=4080?255:x>>4,M=(M=(d=f-d)+g)<16?0:M>=4080?255:M>>4,A=(A=(m=h-m)+y)<16?0:A>=4080?255:A>>4,I=(I=m-y)<16?0:I>=4080?255:I>>4,S=(S=d-g)<16?0:S>=4080?255:S>>4,_=(_=f-w)<16?0:_>=4080?255:_>>4,C=(C=h-b)<16?0:C>=4080?255:C>>4,R[c+N]=v,R[c+N+8]=x,R[c+N+16]=M,R[c+N+24]=A,R[c+N+32]=I,R[c+N+40]=S,R[c+N+48]=_,R[c+N+56]=C):(T=(T=l*v+8192>>14)<-2040?0:T>=2024?255:T+2056>>4,R[c+N]=T,R[c+N+8]=T,R[c+N+16]=T,R[c+N+24]=T,R[c+N+32]=T,R[c+N+40]=T,R[c+N+48]=T,R[c+N+56]=T)}function m(e,t){for(var n=t.blocksPerLine,r=t.blocksPerColumn,i=new Int16Array(64),s=0;s<r;s++)for(var o=0;o<n;o++)d(t,h(t,s,o),i);return t.blockData}function y(e,t,n){function r(t){return e[t]<<8|e[t+1]}var i=e.length-1,s=n<t?n:t;if(t>=i)return null;var o=r(t);if(o>=65472&&o<=65534)return{invalid:null,marker:o,offset:t};for(var a=r(s);!(a>=65472&&a<=65534);){if(++s>=i)return null;a=r(s)}return{invalid:o.toString(16),marker:a,offset:s}}return c.prototype={parse:function(n){function r(){var e=n[l]<<8|n[l+1];return l+=2,e}function i(){var e=r(),t=l+e-2,i=y(n,t,l);i&&i.invalid&&(console.log("readDataBlock - incorrect length, next marker is: "+i.invalid),t=i.offset);var s=n.subarray(l,t);return l+=s.length,s}function s(e){for(var t=Math.ceil(e.samplesPerLine/8/e.maxH),n=Math.ceil(e.scanLines/8/e.maxV),r=0;r<e.components.length;r++){z=e.components[r];var i=Math.ceil(Math.ceil(e.samplesPerLine/8)*z.h/e.maxH),s=Math.ceil(Math.ceil(e.scanLines/8)*z.v/e.maxV),o=t*z.h,a=n*z.v*64*(o+1);z.blockData=new Int16Array(a),z.blocksPerLine=i,z.blocksPerColumn=s}e.mcusPerLine=t,e.mcusPerColumn=n}var o,a,l=0,u=null,c=null,h=[],d=[],g=[],w=r();if(65496!==w)throw new e("SOI not found");for(w=r();65497!==w;){var b,v,x;switch(w){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var M=i();65504===w&&74===M[0]&&70===M[1]&&73===M[2]&&70===M[3]&&0===M[4]&&(u={version:{major:M[5],minor:M[6]},densityUnits:M[7],xDensity:M[8]<<8|M[9],yDensity:M[10]<<8|M[11],thumbWidth:M[12],thumbHeight:M[13],thumbData:M.subarray(14,14+3*M[12]*M[13])}),65518===w&&65===M[0]&&100===M[1]&&111===M[2]&&98===M[3]&&101===M[4]&&(c={version:M[5]<<8|M[6],flags0:M[7]<<8|M[8],flags1:M[9]<<8|M[10],transformCode:M[11]});break;case 65499:for(var A=r()+l-2;l<A;){var I=n[l++],S=new Uint16Array(64);if(I>>4){if(I>>4!=1)throw new e("DQT - invalid table spec");for(v=0;v<64;v++)S[t[v]]=r()}else for(v=0;v<64;v++)S[t[v]]=n[l++];h[15&I]=S}break;case 65472:case 65473:case 65474:if(o)throw new e("Only single frame JPEGs supported");r(),(o={}).extended=65473===w,o.progressive=65474===w,o.precision=n[l++],o.scanLines=r(),o.samplesPerLine=r(),o.components=[],o.componentIds={};var _,C=n[l++],T=0,k=0;for(b=0;b<C;b++){_=n[l];var R=n[l+1]>>4,P=15&n[l+1];T<R&&(T=R),k<P&&(k=P);var N=n[l+2];x=o.components.push({h:R,v:P,quantizationId:N,quantizationTable:null}),o.componentIds[_]=x-1,l+=3}o.maxH=T,o.maxV=k,s(o);break;case 65476:var D=r();for(b=2;b<D;){var E=n[l++],L=new Uint8Array(16),F=0;for(v=0;v<16;v++,l++)F+=L[v]=n[l];var O=new Uint8Array(F);for(v=0;v<F;v++,l++)O[v]=n[l];b+=17+F,(E>>4?d:g)[15&E]=p(L,O)}break;case 65501:r(),a=r();break;case 65498:r();var z,j=n[l++],B=[];for(b=0;b<j;b++){var Z=o.componentIds[n[l++]];z=o.components[Z];var U=n[l++];z.huffmanTableDC=g[U>>4],z.huffmanTableAC=d[15&U],B.push(z)}var V=n[l++],G=n[l++],H=n[l++],W=f(n,l,o,B,a,V,G,H>>4,15&H);l+=W;break;case 65535:255!==n[l]&&l--;break;default:if(255===n[l-3]&&n[l-2]>=192&&n[l-2]<=254){l-=3;break}throw new e("unknown marker "+w.toString(16))}w=r()}for(this.width=o.samplesPerLine,this.height=o.scanLines,this.jfif=u,this.eof=l,this.adobe=c,this.components=[],b=0;b<o.components.length;b++){var J=h[(z=o.components[b]).quantizationId];J&&(z.quantizationTable=J),this.components.push({output:m(0,z),scaleX:z.h/o.maxH,scaleY:z.v/o.maxV,blocksPerLine:z.blocksPerLine,blocksPerColumn:z.blocksPerColumn})}this.numComponents=this.components.length},_getLinearizedBlockData:function(e,t){var n,r,i,s,o,a,l,u,c,p,h,f=this.width/e,d=this.height/t,m=0,y=this.components.length,g=e*t*y,w=new Uint8ClampedArray(g),b=new Uint32Array(e),v=4294967288;for(l=0;l<y;l++){for(r=(n=this.components[l]).scaleX*f,i=n.scaleY*d,m=l,h=n.output,s=n.blocksPerLine+1<<3,o=0;o<e;o++)u=0|o*r,b[o]=(u&v)<<3|7&u;for(a=0;a<t;a++)for(p=s*((u=0|a*i)&v)|(7&u)<<3,o=0;o<e;o++)w[m]=h[p+b[o]],m+=y}var x=this.decodeTransform;if(x)for(l=0;l<g;)for(u=0,c=0;u<y;u++,l++,c+=2)w[l]=(w[l]*x[c]>>8)+x[c+1];return w},_isColorConversionNeeded:function(){return this.adobe?!!this.adobe.transformCode:3===this.numComponents?0!==this.colorTransform:1===this.colorTransform},_convertYccToRgb:function(e){for(var t,n,r,i=0,s=e.length;i<s;i+=3)t=e[i],n=e[i+1],r=e[i+2],e[i]=t-179.456+1.402*r,e[i+1]=t+135.459-.344*n-.714*r,e[i+2]=t-226.816+1.772*n;return e},_convertYcckToRgb:function(e){for(var t,n,r,i,s=0,o=0,a=e.length;o<a;o+=4)t=e[o],n=e[o+1],r=e[o+2],i=e[o+3],e[s++]=n*(-660635669420364e-19*n+.000437130475926232*r-54080610064599e-18*t+.00048449797120281*i-.154362151871126)-122.67195406894+r*(-.000957964378445773*r+.000817076911346625*t-.00477271405408747*i+1.53380253221734)+t*(.000961250184130688*t-.00266257332283933*i+.48357088451265)+i*(-.000336197177618394*i+.484791561490776),e[s++]=107.268039397724+n*(219927104525741e-19*n-.000640992018297945*r+.000659397001245577*t+.000426105652938837*i-.176491792462875)+r*(-.000778269941513683*r+.00130872261408275*t+.000770482631801132*i-.151051492775562)+t*(.00126935368114843*t-.00265090189010898*i+.25802910206845)+i*(-.000318913117588328*i-.213742400323665),e[s++]=n*(-.000570115196973677*n-263409051004589e-19*r+.0020741088115012*t-.00288260236853442*i+.814272968359295)-20.810012546947+r*(-153496057440975e-19*r-.000132689043961446*t+.000560833691242812*i-.195152027534049)+t*(.00174418132927582*t-.00255243321439347*i+.116935020465145)+i*(-.000343531996510555*i+.24165260232407);return e},_convertYcckToCmyk:function(e){for(var t,n,r,i=0,s=e.length;i<s;i+=4)t=e[i],n=e[i+1],r=e[i+2],e[i]=434.456-t-1.402*r,e[i+1]=119.541-t+.344*n+.714*r,e[i+2]=481.816-t-1.772*n;return e},_convertCmykToRgb:function(e){for(var t,n,r,i,s=0,o=1/255,a=0,l=e.length;a<l;a+=4)t=e[a]*o,n=e[a+1]*o,r=e[a+2]*o,i=e[a+3]*o,e[s++]=255+t*(-4.387332384609988*t+54.48615194189176*n+18.82290502165302*r+212.25662451639585*i-285.2331026137004)+n*(1.7149763477362134*n-5.6096736904047315*r-17.873870861415444*i-5.497006427196366)+r*(-2.5217340131683033*r-21.248923337353073*i+17.5119270841813)-i*(21.86122147463605*i+189.48180835922747),e[s++]=255+t*(8.841041422036149*t+60.118027045597366*n+6.871425592049007*r+31.159100130055922*i-79.2970844816548)+n*(-15.310361306967817*n+17.575251261109482*r+131.35250912493976*i-190.9453302588951)+r*(4.444339102852739*r+9.8632861493405*i-24.86741582555878)-i*(20.737325471181034*i+187.80453709719578),e[s++]=255+t*(.8842522430003296*t+8.078677503112928*n+30.89978309703729*r-.23883238689178934*i-14.183576799673286)+n*(10.49593273432072*n+63.02378494754052*r+50.606957656360734*i-112.23884253719248)+r*(.03296041114873217*r+115.60384449646641*i-193.58209356861505)-i*(22.33816807309886*i+180.12613974708367);return e},getData:function(t,n,r){if(this.numComponents>4)throw new e("Unsupported color mode");var i=this._getLinearizedBlockData(t,n);if(1===this.numComponents&&r){for(var s=i.length,o=new Uint8ClampedArray(3*s),a=0,l=0;l<s;l++){var u=i[l];o[a++]=u,o[a++]=u,o[a++]=u}return o}if(3===this.numComponents&&this._isColorConversionNeeded())return this._convertYccToRgb(i);if(4===this.numComponents){if(this._isColorConversionNeeded())return r?this._convertYcckToRgb(i):this._convertYcckToCmyk(i);if(r)return this._convertCmykToRgb(i)}return i}},c}()},void 0!==(n=t())&&(e.exports=n)),s.exports;var e,t,n}())},82499:function(e,t,n){n.d(t,{Z:function(){return o}});var r,i=n(32150),s={exports:{}};const o=(0,i.g)(function(){return r||(r=1,t=s,void 0!==(e=function(){function e(){this.pos=0,this.bufferLength=0,this.eof=!1,this.buffer=null}return e.prototype={ensureBuffer:function(e){var t=this.buffer,n=t?t.byteLength:0;if(e<n)return t;for(var r=512;r<e;)r<<=1;for(var i=new Uint8Array(r),s=0;s<n;++s)i[s]=t[s];return this.buffer=i},getByte:function(){for(var e=this.pos;this.bufferLength<=e;){if(this.eof)return null;this.readBlock()}return this.buffer[this.pos++]},getBytes:function(e){var t=this.pos;if(e){this.ensureBuffer(t+e);for(var n=t+e;!this.eof&&this.bufferLength<n;)this.readBlock();var r=this.bufferLength;n>r&&(n=r)}else{for(;!this.eof;)this.readBlock();n=this.bufferLength}return this.pos=n,this.buffer.subarray(t,n)},lookChar:function(){for(var e=this.pos;this.bufferLength<=e;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos])},getChar:function(){for(var e=this.pos;this.bufferLength<=e;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos++])},makeSubStream:function(e,t,n){for(var r=e+t;this.bufferLength<=r&&!this.eof;)this.readBlock();return new Stream(this.buffer,e,t,n)},skip:function(e){e||(e=1),this.pos+=e},reset:function(){this.pos=0}},e}(),n=function(){if(!self||!self.Uint32Array)return null;var t=new Uint32Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),n=new Uint32Array([3,4,5,6,7,8,9,10,65547,65549,65551,65553,131091,131095,131099,131103,196643,196651,196659,196667,262211,262227,262243,262259,327811,327843,327875,327907,258,258,258]),r=new Uint32Array([1,2,3,4,65541,65543,131081,131085,196625,196633,262177,262193,327745,327777,393345,393409,459009,459137,524801,525057,590849,591361,657409,658433,724993,727041,794625,798721,868353,876545]),i=[new Uint32Array([459008,524368,524304,524568,459024,524400,524336,590016,459016,524384,524320,589984,524288,524416,524352,590048,459012,524376,524312,589968,459028,524408,524344,590032,459020,524392,524328,59e4,524296,524424,524360,590064,459010,524372,524308,524572,459026,524404,524340,590024,459018,524388,524324,589992,524292,524420,524356,590056,459014,524380,524316,589976,459030,524412,524348,590040,459022,524396,524332,590008,524300,524428,524364,590072,459009,524370,524306,524570,459025,524402,524338,590020,459017,524386,524322,589988,524290,524418,524354,590052,459013,524378,524314,589972,459029,524410,524346,590036,459021,524394,524330,590004,524298,524426,524362,590068,459011,524374,524310,524574,459027,524406,524342,590028,459019,524390,524326,589996,524294,524422,524358,590060,459015,524382,524318,589980,459031,524414,524350,590044,459023,524398,524334,590012,524302,524430,524366,590076,459008,524369,524305,524569,459024,524401,524337,590018,459016,524385,524321,589986,524289,524417,524353,590050,459012,524377,524313,589970,459028,524409,524345,590034,459020,524393,524329,590002,524297,524425,524361,590066,459010,524373,524309,524573,459026,524405,524341,590026,459018,524389,524325,589994,524293,524421,524357,590058,459014,524381,524317,589978,459030,524413,524349,590042,459022,524397,524333,590010,524301,524429,524365,590074,459009,524371,524307,524571,459025,524403,524339,590022,459017,524387,524323,589990,524291,524419,524355,590054,459013,524379,524315,589974,459029,524411,524347,590038,459021,524395,524331,590006,524299,524427,524363,590070,459011,524375,524311,524575,459027,524407,524343,590030,459019,524391,524327,589998,524295,524423,524359,590062,459015,524383,524319,589982,459031,524415,524351,590046,459023,524399,524335,590014,524303,524431,524367,590078,459008,524368,524304,524568,459024,524400,524336,590017,459016,524384,524320,589985,524288,524416,524352,590049,459012,524376,524312,589969,459028,524408,524344,590033,459020,524392,524328,590001,524296,524424,524360,590065,459010,524372,524308,524572,459026,524404,524340,590025,459018,524388,524324,589993,524292,524420,524356,590057,459014,524380,524316,589977,459030,524412,524348,590041,459022,524396,524332,590009,524300,524428,524364,590073,459009,524370,524306,524570,459025,524402,524338,590021,459017,524386,524322,589989,524290,524418,524354,590053,459013,524378,524314,589973,459029,524410,524346,590037,459021,524394,524330,590005,524298,524426,524362,590069,459011,524374,524310,524574,459027,524406,524342,590029,459019,524390,524326,589997,524294,524422,524358,590061,459015,524382,524318,589981,459031,524414,524350,590045,459023,524398,524334,590013,524302,524430,524366,590077,459008,524369,524305,524569,459024,524401,524337,590019,459016,524385,524321,589987,524289,524417,524353,590051,459012,524377,524313,589971,459028,524409,524345,590035,459020,524393,524329,590003,524297,524425,524361,590067,459010,524373,524309,524573,459026,524405,524341,590027,459018,524389,524325,589995,524293,524421,524357,590059,459014,524381,524317,589979,459030,524413,524349,590043,459022,524397,524333,590011,524301,524429,524365,590075,459009,524371,524307,524571,459025,524403,524339,590023,459017,524387,524323,589991,524291,524419,524355,590055,459013,524379,524315,589975,459029,524411,524347,590039,459021,524395,524331,590007,524299,524427,524363,590071,459011,524375,524311,524575,459027,524407,524343,590031,459019,524391,524327,589999,524295,524423,524359,590063,459015,524383,524319,589983,459031,524415,524351,590047,459023,524399,524335,590015,524303,524431,524367,590079]),9],s=[new Uint32Array([327680,327696,327688,327704,327684,327700,327692,327708,327682,327698,327690,327706,327686,327702,327694,0,327681,327697,327689,327705,327685,327701,327693,327709,327683,327699,327691,327707,327687,327703,327695,0]),5];function o(e){throw new Error(e)}function a(t){var n=0,r=t[n++],i=t[n++];-1!=r&&-1!=i||o("Invalid header in flate stream"),8!=(15&r)&&o("Unknown compression method in flate stream"),((r<<8)+i)%31!=0&&o("Bad FCHECK in flate stream"),32&i&&o("FDICT bit set in flate stream"),this.bytes=t,this.bytesPos=2,this.codeSize=0,this.codeBuf=0,e.call(this)}return a.prototype=Object.create(e.prototype),a.prototype.getBits=function(e){for(var t,n=this.codeSize,r=this.codeBuf,i=this.bytes,s=this.bytesPos;n<e;)void 0===(t=i[s++])&&o("Bad encoding in flate stream"),r|=t<<n,n+=8;return t=r&(1<<e)-1,this.codeBuf=r>>e,this.codeSize=n-=e,this.bytesPos=s,t},a.prototype.getCode=function(e){for(var t=e[0],n=e[1],r=this.codeSize,i=this.codeBuf,s=this.bytes,a=this.bytesPos;r<n;){var l;void 0===(l=s[a++])&&o("Bad encoding in flate stream"),i|=l<<r,r+=8}var u=t[i&(1<<n)-1],c=u>>16,p=65535&u;return(0==r||r<c||0==c)&&o("Bad encoding in flate stream"),this.codeBuf=i>>c,this.codeSize=r-c,this.bytesPos=a,p},a.prototype.generateHuffmanTable=function(e){for(var t=e.length,n=0,r=0;r<t;++r)e[r]>n&&(n=e[r]);for(var i=1<<n,s=new Uint32Array(i),o=1,a=0,l=2;o<=n;++o,a<<=1,l<<=1)for(var u=0;u<t;++u)if(e[u]==o){var c=0,p=a;for(r=0;r<o;++r)c=c<<1|1&p,p>>=1;for(r=c;r<i;r+=l)s[r]=o<<16|u;++a}return[s,n]},a.prototype.readBlock=function(){function e(e,t,n,r,i){for(var s=e.getBits(n)+r;s-- >0;)t[d++]=i}var a=this.getBits(3);if(1&a&&(this.eof=!0),0!=(a>>=1)){var l,u;if(1==a)l=i,u=s;else if(2==a){for(var c=this.getBits(5)+257,p=this.getBits(5)+1,h=this.getBits(4)+4,f=Array(t.length),d=0;d<h;)f[t[d++]]=this.getBits(3);for(var m=this.generateHuffmanTable(f),y=0,g=(d=0,c+p),w=new Array(g);d<g;){var b=this.getCode(m);16==b?e(this,w,2,3,y):17==b?e(this,w,3,3,y=0):18==b?e(this,w,7,11,y=0):w[d++]=y=b}l=this.generateHuffmanTable(w.slice(0,c)),u=this.generateHuffmanTable(w.slice(c,g))}else o("Unknown block type in flate stream");for(var v=(N=this.buffer)?N.length:0,x=this.bufferLength;;){var M=this.getCode(l);if(M<256)x+1>=v&&(v=(N=this.ensureBuffer(x+1)).length),N[x++]=M;else{if(256==M)return void(this.bufferLength=x);var A=(M=n[M-=257])>>16;A>0&&(A=this.getBits(A)),y=(65535&M)+A,M=this.getCode(u),(A=(M=r[M])>>16)>0&&(A=this.getBits(A));var I=(65535&M)+A;x+y>=v&&(v=(N=this.ensureBuffer(x+y)).length);for(var S=0;S<y;++S,++x)N[x]=N[x-I]}}}else{var _,C=this.bytes,T=this.bytesPos;void 0===(_=C[T++])&&o("Bad block header in flate stream");var k=_;void 0===(_=C[T++])&&o("Bad block header in flate stream"),k|=_<<8,void 0===(_=C[T++])&&o("Bad block header in flate stream");var R=_;void 0===(_=C[T++])&&o("Bad block header in flate stream"),(R|=_<<8)!=(65535&~k)&&o("Bad uncompressed block length in flate stream"),this.codeBuf=0,this.codeSize=0;var P=this.bufferLength,N=this.ensureBuffer(P+k),D=P+k;this.bufferLength=D;for(var E=P;E<D;++E){if(void 0===(_=C[T++])){this.eof=!0;break}N[E]=_}this.bytesPos=T}},a}())&&(t.exports=n)),s.exports;var e,t,n}())},32150:function(e,t,n){n.d(t,{c:function(){return r},g:function(){return i}});var r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function i(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}},69296:function(e,t,n){var r;n.d(t,{u:function(){return r}}),function(e){e[e.KILOBYTES=1024]="KILOBYTES",e[e.MEGABYTES=1048576]="MEGABYTES",e[e.GIGABYTES=1073741824]="GIGABYTES"}(r||(r={}))},99680:function(e,t,n){n.d(t,{q:function(){return i}});var r=n(85408);class i{constructor(e,t){this._storage=new r.F,this.id="",this.name="",this.size=0,this._storage.maxSize=e,this._storage.register(this),t&&this._storage.registerRemoveFunc("",t)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(e,t,n=1){this._storage.put(this,e,t,n,1)}pop(e){return this._storage.pop(this,e)}get(e){return this._storage.get(this,e)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}resetHitRate(){}}},85408:function(e,t,n){n.d(t,{F:function(){return l},Ti:function(){return i}});var r=n(7187);const i=-3,s=i-1;var o,a;(a=o||(o={}))[a.ALL=0]="ALL",a[a.SOME=1]="SOME";class l{get size(){return this._size}constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new r.A,this._users=new r.A}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(e){this._users.push(e)}deregister(e){this._users.removeUnordered(e)}registerRemoveFunc(e,t){this._removeFuncs.push([e,t])}deregisterRemoveFunc(e){this._removeFuncs.filterInPlace((t=>t[0]!==e))}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,-1),this._checkSize()}getSize(e,t){const n=this._db.get(e.id+t);return n?.size??0}put(e,t,n,r,a){t=e.id+t;const l=this._db.get(t);if(l&&(this._size-=l.size,e.size-=l.size,this._db.delete(t),l.entry!==n&&this._notifyRemove(t,l.entry,l.size,o.ALL)),r>this._maxSize)return void this._notifyRemove(t,n,r,o.ALL);if(void 0===n)return void console.warn("Refusing to cache undefined entry ");if(!r||r<0)return console.warn(`Refusing to cache entry with size ${r} for key ${t}`),void this._notifyRemove(t,n,0,o.ALL);const c=1+Math.max(a,s)-i;this._db.set(t,new u(n,r,c)),this._size+=r,e.size+=r,this._checkSize()}updateSize(e,t,n,r){t=e.id+t;const i=this._db.get(t);if(i&&i.entry===n){for(this._size-=i.size,e.size-=i.size;r>this._maxSize;){const e=this._notifyRemove(t,n,r,o.SOME);if(!(null!=e&&e>0))return void this._db.delete(t);r=e}i.size=r,this._size+=r,e.size+=r,this._checkSize()}}pop(e,t){t=e.id+t;const n=this._db.get(t);if(n)return this._size-=n.size,e.size-=n.size,this._db.delete(t),++this._hit,n.entry;++this._miss}get(e,t){t=e.id+t;const n=this._db.get(t);if(void 0!==n)return this._db.delete(t),n.lives=n.lifetime,this._db.set(t,n),++this._hit,n.entry;++this._miss}peek(e,t){const n=this._db.get(e.id+t);return n?++this._hit:++this._miss,n?.entry}get performanceInfo(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},t={},n=new Array;this._db.forEach(((e,r)=>{const i=e.lifetime;n[i]=(n[i]||0)+e.size,this._users.forAll((n=>{const{id:i,name:s}=n;if(r.startsWith(i)){const n=t[s]||0;t[s]=n+e.size}}))}));const r={};this._users.forAll((e=>{const n=e.name;if("hitRate"in e&&"number"==typeof e.hitRate&&!isNaN(e.hitRate)&&e.hitRate>0){const i=t[n]||0;t[n]=i,r[n]=Math.round(100*e.hitRate)+"%"}else r[n]="0%"}));const s=Object.keys(t);s.sort(((e,n)=>t[n]-t[e])),s.forEach((n=>e[n]=Math.round(t[n]/2**20)+"MB / "+r[n]));for(let t=n.length-1;t>=0;--t){const r=n[t];r&&(e["Priority "+(t+i-1)]=Math.round(r/this._size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forAll((e=>e.resetHitRate()))}clear(e){const t=e.id;this._db.forEach(((e,n)=>{n.startsWith(t)&&(this._size-=e.size,this._db.delete(n),this._notifyRemove(n,e.entry,e.size,o.ALL))})),e.size=0}clearAll(){this._db.forEach(((e,t)=>this._notifyRemove(t,e.entry,e.size,o.ALL))),this._users.forAll((e=>e.size=0)),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,t,n,r){let i;return this._removeFuncs.some((s=>{if(e.startsWith(s[0])){const e=s[1](t,r,n);return"number"==typeof e&&(i=e),!0}return!1})),i}_checkSize(){this._users.forAll((e=>this._checkSizeLimits(e))),this._checkSizeLimits()}_checkSizeLimits(e){const t=e??this;if(t.maxSize<0||t.size<=t.maxSize)return;const n=e?.id;let r=!0;for(;r;){r=!1;for(const[i,s]of this._db)if(0===s.lifetime&&(!n||i.startsWith(n))){if(this._purgeItem(i,s,e),t.size<=.9*t.maxSize)return;r||=this._db.has(i)}}for(const[r,i]of this._db)if((!n||r.startsWith(n))&&(this._purgeItem(r,i,e),t.size<=.9*t.maxSize))return}_purgeItem(e,t,n=this._users.find((t=>e.startsWith(t.id)))){if(this._db.delete(e),t.lives<=1){this._size-=t.size,n&&(n.size-=t.size);const r=this._notifyRemove(e,t.entry,t.size,o.SOME);null!=r&&r>0&&(this._size+=r,n&&(n.size+=r),t.lives=t.lifetime,t.size=r,this._db.set(e,t))}else--t.lives,this._db.set(e,t)}}class u{constructor(e,t,n){this.entry=e,this.size=t,this.lifetime=n,this.lives=n}}},77793:function(e,t,n){n.d(t,{P:function(){return b},L:function(){return v}});var r=n(53804),i=n(83525),s=n(90194),o=n(21609),a=n(72977);class l{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(a.AU),this._values=new Map,this.multipleOriginsSupported=!0}clone(e){const t=new l,n=this._originStores[a.Gr.DEFAULTS];n&&n.forEach(((e,n)=>{t.set(n,(0,o.o8)(e),a.Gr.DEFAULTS)}));for(let n=a.Gr.SERVICE;n<a.AU;n++){const r=this._originStores[n];r&&r.forEach(((r,i)=>{e&&e.has(i)||t.set(i,(0,o.o8)(r),n)}))}return t}get(e,t){const n=void 0===t?this._values:this._originStores[t];return n?n.get(e):void 0}keys(e){const t=null==e?this._values:this._originStores[e];return t?[...t.keys()]:[]}set(e,t,n=a.Gr.USER){let r=this._originStores[n];if(r||(r=new Map,this._originStores[n]=r),r.set(e,t),!this._values.has(e)||this._propertyOriginMap.get(e)<=n){const r=this._values.get(e);return this._values.set(e,t),this._propertyOriginMap.set(e,n),r!==t}return!1}delete(e,t=a.Gr.USER){const n=this._originStores[t];if(!n)return;const r=n.get(e);if(n.delete(e),this._values.has(e)&&this._propertyOriginMap.get(e)===t){this._values.delete(e);for(let n=t-1;n>=0;n--){const t=this._originStores[n];if(t&&t.has(e)){this._values.set(e,t.get(e)),this._propertyOriginMap.set(e,n);break}}}return r}has(e,t){const n=void 0===t?this._values:this._originStores[t];return!!n&&n.has(e)}revert(e,t){for(;t>0&&!this.has(e,t);)--t;const n=this._originStores[t],r=n?.get(e),i=this._values.get(e);return this._values.set(e,r),this._propertyOriginMap.set(e,t),i!==r}originOf(e){return this._propertyOriginMap.get(e)||a.Gr.DEFAULTS}forEach(e){this._values.forEach(e)}}var u=n(97354),c=n(63693),p=n(65953);const h=e=>{let t=class extends e{constructor(...e){super(...e);const t=(0,c.oY)(this),n=t.store,r=new l;t.store=r,(0,s.k)(t,n,r)}read(e,t){(0,u.L)(this,e,t)}getAtOrigin(e,t){const n=f(this),r=(0,a.aB)(t);if("string"==typeof e)return n.get(e,r);const i={};return e.forEach((e=>{i[e]=n.get(e,r)})),i}originOf(e){return(0,a.OL)(this.originIdOf(e))}originIdOf(e){return f(this).originOf(e)}revert(e,t){const n=f(this),r=(0,a.aB)(t),i=(0,c.oY)(this);let s;s="string"==typeof e?"*"===e?n.keys(r):[e]:e,s.forEach((e=>{i.invalidate(e),n.revert(e,r),i.commit(e)}))}};return t=(0,r._)([(0,p.$)("esri.core.ReadOnlyMultiOriginJSONSupport")],t),t};function f(e){return(0,c.oY)(e).store}let d=class extends(h(i.A)){};d=(0,r._)([(0,p.$)("esri.core.ReadOnlyMultiOriginJSONSupport")],d);var m=n(62664),y=n(99495);const g=e=>{let t=class extends e{constructor(...e){super(...e)}clear(e,t="user"){return w(this).delete(e,(0,a.aB)(t))}write(e,t){return(0,y.M)(this,e=e||{},t),e}setAtOrigin(e,t,n){(0,c.oY)(this).setAtOrigin(e,t,(0,a.aB)(n))}removeOrigin(e){const t=w(this),n=(0,a.aB)(e),r=t.keys(n);for(const e of r)t.originOf(e)===n&&t.set(e,t.get(e,n),a.Gr.USER)}updateOrigin(e,t){const n=w(this),r=(0,a.aB)(t),i=(0,m.Jt)(this,e);for(let t=r+1;t<a.AU;++t)n.delete(e,t);n.set(e,i,r)}toJSON(e){return this.write({},e)}};return t=(0,r._)([(0,p.$)("esri.core.MultiOriginJSONSupport.WriteableMultiOriginJSONSupport")],t),t.prototype.toJSON.isDefaultToJSON=!0,t};function w(e){return(0,c.oY)(e).store}const b=e=>{let t=class extends(g(h(e))){constructor(...e){super(...e)}};return t=(0,r._)([(0,p.$)("esri.core.MultiOriginJSONSupport")],t),t};let v=class extends(b(i.A)){};v=(0,r._)([(0,p.$)("esri.core.MultiOriginJSONSupport")],v)},62790:function(e,t,n){n.d(t,{A:function(){return s}});var r=n(44567),i=n(87085);class s{constructor(e){this._observable=new i.I,this._map=new Map(e)}get size(){return(0,r.gc)(this._observable),this._map.size}clear(){this._map.size>0&&(this._map.clear(),this._observable.notify())}delete(e){const t=this._map.delete(e);return t&&this._observable.notify(),t}entries(){return(0,r.gc)(this._observable),this._map.entries()}forEach(e,t){(0,r.gc)(this._observable),this._map.forEach(((n,r)=>e.call(t,n,r,this)),t)}get(e){return(0,r.gc)(this._observable),this._map.get(e)}has(e){return(0,r.gc)(this._observable),this._map.has(e)}keys(){return(0,r.gc)(this._observable),this._map.keys()}set(e,t){return this._map.set(e,t),this._observable.notify(),this}values(){return(0,r.gc)(this._observable),this._map.values()}[Symbol.iterator](){return(0,r.gc)(this._observable),this._map[Symbol.iterator]()}get[Symbol.toStringTag](){return this._map[Symbol.toStringTag]}}},72952:function(e,t,n){n.d(t,{EB:function(){return f},Im:function(){return y},Mj:function(){return h},Ui:function(){return m},w2:function(){return d}});var r=n(83525),i=n(78879),s=n(63693);const o=new Set(["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"]);function a(e){return e instanceof r.A}function l(e){return e instanceof i.A?Object.keys(e.items):a(e)?(0,s.oY)(e).keys():e?Object.keys(e):[]}function u(e,t){return e instanceof i.A?e.items[t]:e[t]}function c(e){return e?e.declaredClass:null}function p(e,t){const n=e.diff;if(n&&"function"==typeof n)return n(e,t);const r=l(e),i=l(t);if(0===r.length&&0===i.length)return;if(!r.length||!i.length||function(e,t){return!(!Array.isArray(e)||!Array.isArray(t))&&e.length!==t.length}(e,t))return{type:"complete",oldValue:e,newValue:t};const s=i.filter((e=>!r.includes(e))),h=r.filter((e=>!i.includes(e))),f=r.filter((n=>i.includes(n)&&u(e,n)!==u(t,n))).concat(s,h).sort(),d=c(e);if(d&&o.has(d)&&f.length)return{type:"complete",oldValue:e,newValue:t};let m;const y=a(e)&&a(t);for(const r of f){const i=u(e,r),s=u(t,r);let o;if((y||"function"!=typeof i&&"function"!=typeof s)&&i!==s&&(null!=i||null!=s)){if(n&&n[r]&&"function"==typeof n[r])o=n[r]?.(i,s);else if(i instanceof Date&&s instanceof Date){if(i.getTime()===s.getTime())continue;o={type:"complete",oldValue:i,newValue:s}}else o="object"==typeof i&&"object"==typeof s&&c(i)===c(s)?p(i,s):{type:"complete",oldValue:i,newValue:s};null!=o&&(null!=m?m.diff[r]=o:m={type:"partial",diff:{[r]:o}})}}return m}function h(e,t){return f(e,t)}function f(e,t){if(null==e)return!1;const n=t.split(".");let r=e;for(const e of n){if("complete"===r.type)return!0;if("partial"!==r.type)return!1;{const t=r.diff[e];if(!t)return!1;r=t}}return!0}function d(e,t){if(!e)return!1;if("partial"===e.type){const n=Object.keys(e.diff);return 1===n.length&&n[0]===t}return!1}function m(e,t){if("function"!=typeof e&&"function"!=typeof t&&(null!=e||null!=t))return null==e||null==t||"object"==typeof e&&"object"==typeof t&&c(e)!==c(t)?{type:"complete",oldValue:e,newValue:t}:p(e,t)}function y(e){if(null==e)return!0;switch(e.type){case"complete":return!1;case"collection":{const t=e;for(const e of t.added)if(!y(e))return!1;for(const e of t.removed)if(!y(e))return!1;for(const e of t.changed)if(!y(e))return!1;return!0}case"partial":for(const t in e.diff)if(!y(e.diff[t]))return!1;return!0}}},64786:function(e,t,n){n.d(t,{K:function(){return r}});const r=["operational-layers","basemap","ground"]},75505:function(e,t,n){n.d(t,{$:function(){return w},IB:function(){return a},Iy:function(){return N},N2:function(){return b},QP:function(){return k},RH:function(){return x},Vl:function(){return T},Ws:function(){return M},ZD:function(){return v},_L:function(){return C},bJ:function(){return S},e$:function(){return _},f6:function(){return P},pW:function(){return A},pf:function(){return R}});var r=n(52874),i=n(50659),s=n(21609),o=(n(33400),n(41546));function a(e){return"r"in e&&"g"in e&&"b"in e}function l(e){return"h"in e&&"s"in e&&"v"in e}function u(e){return"l"in e&&"a"in e&&"b"in e}function c(e){return"l"in e&&"c"in e&&"h"in e}const p=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],h=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function f(e,t){const n=[];let r,i;if(e[0].length!==t.length)throw new Error("dimensions do not match");const s=e.length,o=e[0].length;let a=0;for(r=0;r<s;r++){for(a=0,i=0;i<o;i++)a+=e[r][i]*t[i];n.push(a)}return n}function d(e){const t=[e.r/255,e.g/255,e.b/255].map((e=>e<=.04045?e/12.92:((e+.055)/1.055)**2.4)),n=f(p,t);return{x:100*n[0],y:100*n[1],z:100*n[2]}}function m(e){const t=f(h,[e.x/100,e.y/100,e.z/100]).map((e=>{const t=e<=.0031308?12.92*e:1.055*e**(1/2.4)-.055;return Math.min(1,Math.max(t,0))}));return{r:Math.round(255*t[0]),g:Math.round(255*t[1]),b:Math.round(255*t[2])}}function y(e){const t=[e.x/95.047,e.y/100,e.z/108.883].map((e=>e>(6/29)**3?e**(1/3):1/3*(29/6)**2*e+4/29));return{l:116*t[1]-16,a:500*(t[0]-t[1]),b:200*(t[1]-t[2])}}function g(e){const t=e.l,n=[(t+16)/116+e.a/500,(t+16)/116,(t+16)/116-e.b/200].map((e=>e>6/29?e**3:3*(6/29)**2*(e-4/29)));return{x:95.047*n[0],y:100*n[1],z:108.883*n[2]}}function w(e){return a(e)?e:c(e)?function(e){return m(g(function(e){const t=e.l,n=e.c,r=e.h;return{l:t,a:n*Math.cos(r),b:n*Math.sin(r)}}(e)))}(e):u(e)?function(e){return m(g(e))}(e):function(e){return"x"in e&&"y"in e&&"z"in e}(e)?m(e):l(e)?function(e){const t=(e.h+360)%360/60,n=e.s/100,r=e.v/100*255,i=r*n,s=i*(1-Math.abs(t%2-1));let o;switch(Math.floor(t)){case 0:o={r:i,g:s,b:0};break;case 1:o={r:s,g:i,b:0};break;case 2:o={r:0,g:i,b:s};break;case 3:o={r:0,g:s,b:i};break;case 4:o={r:s,g:0,b:i};break;case 5:case 6:o={r:i,g:0,b:s};break;default:o={r:0,g:0,b:0}}return o.r=Math.round(o.r+r-i),o.g=Math.round(o.g+r-i),o.b=Math.round(o.b+r-i),o}(e):e}function b(e){return l(e)?e:function(e){const t=e.r,n=e.g,r=e.b,i=Math.max(t,n,r),s=i-Math.min(t,n,r);let o=i,a=0===s?0:i===t?(n-r)/s%6:i===n?(r-t)/s+2:(t-n)/s+4,l=0===s?0:s/o;return a<0&&(a+=6),a*=60,l*=100,o*=100/255,{h:a,s:l,v:o}}(w(e))}function v(e){return u(e)?e:function(e){return y(d(e))}(w(e))}function x(e){return c(e)?e:function(e){return function(e){const t=e.l,n=e.a,r=e.b,i=Math.sqrt(n*n+r*r);let s=Math.atan2(r,n);return s=s>0?s:s+2*Math.PI,{l:t,c:i,h:s}}(y(d(e)))}(w(e))}function M(e,t){const{r:n,g:i,b:s}=t?.ignoreAlpha?e:function(e){let{r:t,g:n,b:i,a:s}=e;return s<1&&(t=Math.round(s*t+255*(1-s)),n=Math.round(s*n+255*(1-s)),i=Math.round(s*i+255*(1-s))),new r.A({r:t,g:n,b:i})}(e);return.2126*n+.7152*i+.0722*s}var A,I;function S(e,t=A.High){return M(e,{ignoreAlpha:!0})>t?new r.A([0,0,0,e.a]):new r.A([255,255,255,e.a])}function _(e,t){const n=v(e);n.l*=1-t;const r=w(n),i=e.clone();return i.setColor(r),i.a=e.a,i}function C(e,t){const n=e.clone();return n.a*=t,n}function T(e,t){const n=b(e);n.s*=t;const r=w(n),i=e.clone();return i.setColor(r),i.a=e.a,i}function k(e){return r.A.toUnitRGBA(e)}function R(e){return(0,o.fA)(e[0],e[1],e[2],e.length>3?e[3]:1)}function P(e,t){const n=r.A.toUnitRGBA(e);return n[3]*=t,n}function N(e,t,n={}){if(0===e.length||t<=0)return[];if(1===(e=e.map((e=>"string"==typeof e?new r.A(e):e))).length||1===t){const n=[],r=e[0];for(let e=0;e<t;e++)n.push(r.clone());return n}if(n.shuffle&&(e=(0,i.k4)((0,s.o8)(e),n.seed)),e.length>=t){const n=[],r=(e.length-1)/(t-1);for(let i=0;i<t;i++){const t=Math.round(i*r);n.push(e[t].clone())}return n}return function(e,t,n={}){const r=[],s=e.length-1,o=Math.ceil((t-e.length)/s);e:for(let i=0;i<s;i++){const s=e[i],a=e[i+1];for(let i=1;i<=o;i++){const l=i/(o+1);if(r.push(E(s,a,l,n)),r.length+e.length===t)break e}}return[...e.map((e=>e.clone())),...(0,i.k4)(r,n.seed??1)]}(e,t,n)}(I=A||(A={}))[I.Low=160]="Low",I[I.High=225]="High";const D=(e,t)=>{const n=Math.floor(10*t())-5;return Math.min(255,Math.max(0,e+n))};function E(e,t,n,s={}){const o=e.r,a=e.g,l=e.b,u=t.r,c=t.g,p=t.b,h=Math.round(o+(u-o)*n),f=Math.round(a+(c-a)*n),d=Math.round(l+(p-l)*n);if(!s.offset)return new r.A([h,f,d]);const m=(0,i.Mo)(s.seed);return new r.A([D(h,m),D(f,m),D(d,m)])}},37797:function(e,t,n){n.d(t,{A:function(){return u}});var r=n(61226),i=(n(58941),n(60539)),s=n(51846),o=n(13370),a=n(90465),l=n(50193);class u{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new s.A}destroy(){this.close()}get closed(){return!this._clients?.length}open(e,t){return new Promise(((n,r)=>{let s=!0;const o=e=>{(0,i.Te)(t.signal),s&&(s=!1,e())};this._clients.length=e.length,this._clientPromises.length=e.length,this._inUseClients.length=e.length;for(let s=0;s<e.length;++s){const a=e[s];(0,i.$X)(a)?this._clientPromises[s]=a.then((e=>(this._clients[s]=new l.A(e,t,this._ongoingJobsQueue),o(n),this._clients[s])),(()=>(o(r),null))):(this._clients[s]=new l.A(a,t,this._ongoingJobsQueue),this._clientPromises[s]=Promise.resolve(this._clients[s]),o(n))}}))}broadcast(e,t,n){const r=new Array(this._clientPromises.length);for(let i=0;i<this._clientPromises.length;++i){const s=this._clientPromises[i];r[i]=s.then((r=>r?.invoke(e,t,n)))}return r}close(){let e;for(;e=this._ongoingJobsQueue.pop();)e.resolver.reject((0,i.NK)(`Worker closing, aborting job calling '${e.methodName}'`));for(const e of this._clientPromises)e.then((e=>e?.close()));this._clients.length=0,this._clientPromises.length=0,this._inUseClients.length=0,(0,o.h)(this)}invoke(e,t,n){return this.apply(e,[t],n)}apply(e,t,n){const r=(0,i.Tw)();this._ongoingJobsQueue.push({methodName:e,data:t,invokeOptions:n,resolver:r});for(let e=0;e<this._clientPromises.length;e++){const t=this._clients[e];t?t.jobAdded():this._clientPromises[e].then((e=>e?.jobAdded()))}return r.promise}createInvokeProxy(e){return(0,a.L)(this,e)}on(e,t){return Promise.all(this._clientPromises).then((()=>(0,r.vE)(this._clients.map((n=>n.on(e,t))))))}openPorts(){return new Promise((e=>{const t=new Array(this._clientPromises.length);let n=t.length;for(let r=0;r<this._clientPromises.length;++r)this._clientPromises[r].then((i=>{i&&(t[r]=i.openPort()),0==--n&&e(t)}))}))}get test(){}}},90465:function(e,t,n){function r(e,t){return new Proxy({},{get:(n,r,i)=>(...n)=>{let i,s;const o=n[n.length-1];return function(e){return"object"==typeof e&&!Array.isArray(e)&&null!=e&&("signal"in e||"transferList"in e||0===Object.keys(e).length)}(o)&&(i=o.signal,s=o.transferList,n.pop()),e.apply(t?`${t}.${r.toString()}`:r.toString(),n,{transferList:s,signal:i})}})}n.d(t,{L:function(){return r}})},50193:function(e,t,n){n.d(t,{A:function(){return v}});var r=n(7156),i=n(39819),s=n(40212),o=n(61226),a=n(95929),l=n(60539),u=n(90465);const c={statsWorker:()=>n.e(1838).then(n.bind(n,27966)),geometryEngineWorker:()=>n.e(2384).then(n.bind(n,9568)),CSVSourceWorker:()=>n.e(2600).then(n.bind(n,80172)),EdgeProcessingWorker:()=>n.e(2933).then(n.bind(n,92273)),ElevationSamplerWorker:()=>n.e(5120).then(n.bind(n,55412)),FeatureServiceSnappingSourceWorker:()=>n.e(8246).then(n.bind(n,66038)),GeoJSONSourceWorker:()=>n.e(7253).then(n.bind(n,4389)),LercWorker:()=>n.e(6594).then(n.bind(n,67024)),MemorySourceWorker:()=>n.e(807).then(n.bind(n,8489)),PBFDecoderWorker:()=>n.e(8950).then(n.bind(n,19939)),FeaturePipelineWorker:()=>n.e(3806).then(n.bind(n,25423)),PointCloudWorker:()=>n.e(9722).then(n.bind(n,33764)),RasterWorker:()=>n.e(6221).then(n.bind(n,85563)),SceneLayerSnappingSourceWorker:()=>n.e(5974).then(n.bind(n,28820)),SceneLayerWorker:()=>n.e(5404).then(n.bind(n,90525)),WFSSourceWorker:()=>n.e(4900).then(n.bind(n,6412)),WorkerTileHandler:()=>n.e(3295).then(n.bind(n,27787)),Lyr3DWorker:()=>n.e(3213).then(n.bind(n,6883)),Feature3DPipelineWorker:()=>n.e(3929).then(n.bind(n,38518))};var p=n(64272),h=n(23532);const{CLOSE:f,ABORT:d,INVOKE:m,RESPONSE:y,OPEN_PORT:g,ON:w}=p.Go;class b{constructor(e){this._invoke=e,this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._timer=null,this._process=this._process.bind(this)}push(e){e.type===p.Go.ABORT?this._cancelledJobIds.add(e.jobId):(this._invokeMessages.push(e),null===this._timer&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const e of this._invokeMessages)this._cancelledJobIds.has(e.jobId)||this._invoke(e);this._cancelledJobIds.clear(),this._invokeMessages.length=0}}class v{static connect(e,t){const n=new MessageChannel;let r;r="function"==typeof e?new e:"default"in e&&"function"==typeof e.default?new e.default:e;const i=new v(n.port1,{channel:n,client:r,schedule:t});return"object"==typeof r&&"remoteClient"in r&&(r.remoteClient=i),v.clients.set(i,r),n.port2}static loadWorker(e){const t=c[e];return t?t():Promise.resolve(null)}constructor(e,t,n){this._port=e,this._jobQueue=n,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new b((e=>this._onInvokeMessage(e))),this._client=t.client,this._onMessage=this._onMessage.bind(this),this._channel=t.channel,this._schedule=t.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}close(){this._post({type:f}),this._close()}isBusy(){return this._outJobs.size>0}invoke(e,t,n){return this.apply(e,[t],n)}apply(e,t,n){const r=n?.signal,s=n?.transferList;if(!this._port)return Promise.reject(new i.A(p.T,`Cannot call invoke('${e}'), port is closed`,{methodName:e,data:t}));const o=(0,p.Jc)();return new Promise(((n,i)=>{if((0,l.G4)(r))return this._processWork(),void i((0,l.NK)());const u=(0,l.u7)(r,(()=>{const e=this._outJobs.get(o);e&&(this._outJobs.delete(o),this._processWork(),(0,a.xt)(e.abortHandle),this._post({type:d,jobId:o}),i((0,l.NK)()))})),c={resolve:n,reject:i,abortHandle:u,debugInfo:e};this._outJobs.set(o,c),this._post({type:m,jobId:o,methodName:e,abortable:null!=r},t,s)}))}createInvokeProxy(e){return(0,u.L)(this,e)}on(e,t){const n=new MessageChannel;function r(e){t(e.data)}return this._port.postMessage({type:p.Go.ON,eventType:e,port:n.port2},[n.port2]),n.port1.addEventListener("message",r),n.port1.start(),(0,o.hA)((()=>{n.port1.postMessage({type:p.Go.CLOSE}),n.port1.close(),n.port1.removeEventListener("message",r)}))}jobAdded(){this._processWork()}openPort(){const e=new MessageChannel;return this._post({type:g,port:e.port2}),e.port1}_processWork(){if(this._outJobs.size>=2)return;const e=this._jobQueue?.pop();if(!e)return;const{methodName:t,data:n,invokeOptions:r,resolver:i}=e;this.apply(t,n,r).then((e=>i.resolve(e))).catch((e=>i.reject(e)))}_close(){this._channel&&(this._channel=void 0),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach((e=>{(0,a.xt)(e.abortHandle),e.reject((0,l.NK)(`Worker closing, aborting job calling '${e.debugInfo}'`))})),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=null,this._client=null,this._schedule=null}_onMessage(e){null!=this._schedule?this._schedule((()=>this._processMessage(e,!0))):this._processMessage(e,!1)}_processMessage(e,t){const n=(0,p.VI)(e);if(n)switch(n.type){case y:this._onResponseMessage(n);break;case m:t?this._onInvokeMessage(n):this._invokeQueue.push(n);break;case d:this._onAbortMessage(n);break;case f:this._onCloseMessage();break;case g:this._onOpenPortMessage(n);break;case w:this._onOnMessage(n)}}_onAbortMessage(e){const t=this._inJobs,n=e.jobId,r=t.get(n);this._invokeQueue.push(e),r&&(r.controller&&r.controller.abort(),t.delete(n))}_onCloseMessage(){const e=this._client;this._close(),e&&"destroy"in e&&v.clients.get(this)===e&&e.destroy(),v.clients.delete(this),e?.remoteClient&&(e.remoteClient=null)}_onInvokeMessage(e){const{methodName:t,jobId:n,data:r=[],abortable:i}=e,s=i?new AbortController:null,o=this._inJobs;let a,u=this._client,c=u[t];try{if(!c&&t&&t.includes(".")){const e=t.split(".");for(let t=0;t<e.length-1;t++)u=u[e[t]],c=u[e[t+1]]}if("function"!=typeof c)throw new TypeError(`${t} is not a function`);r.push({client:this,signal:s?s.signal:null}),a=c.apply(u,r)}catch(e){return void this._post({type:y,jobId:n,error:(0,p.mF)(e)})}(0,l.$X)(a)?(o.set(n,{controller:s,promise:a}),a.then((e=>{o.has(n)&&(o.delete(n),this._post({type:y,jobId:n},e))}),(e=>{o.has(n)&&(o.delete(n),(0,l.zf)(e)||this._post({type:y,jobId:n,error:(0,p.mF)(e||{message:`Error encountered at method ${t}`})}))}))):this._post({type:y,jobId:n},a)}_onOpenPortMessage(e){new v(e.port,{client:this._client})}_onOnMessage(e){const{port:t}=e,n=this._client.on(e.eventType,(e=>{t.postMessage(e)})),r=(0,s.on)(e.port,"message",(e=>{const i=(0,p.VI)(e);i?.type===p.Go.CLOSE&&(r.remove(),n.remove(),t.close())}))}_onResponseMessage(e){const{jobId:t,error:n,data:r}=e,s=this._outJobs;if(!s.has(t))return;const o=s.get(t);s.delete(t),this._processWork(),(0,a.xt)(o.abortHandle),n?o.reject(i.A.fromJSON(JSON.parse(n))):o.resolve(r)}_post(e,t,n){return(0,p.u1)(this._port,e,t,n)}}v.kernelInfo={buildDate:h.$,fullVersion:r.ol,revision:h.u},v.clients=new Map},13370:function(e,t,n){n.d(t,{h:function(){return s},k:function(){return i}});const r=new FinalizationRegistry((e=>{e.close()}));function i(e,t){r.register(e,t,t)}function s(e){r.unregister(e)}},64272:function(e,t,n){n.d(t,{Go:function(){return o},Jc:function(){return u},T:function(){return s},VI:function(){return h},mF:function(){return c},oV:function(){return d},u1:function(){return p}});var r=n(58941),i=n(60539);const s="worker:port-closed";var o,a;(a=o||(o={}))[a.HANDSHAKE=0]="HANDSHAKE",a[a.OPEN=1]="OPEN",a[a.OPENED=2]="OPENED",a[a.RESPONSE=3]="RESPONSE",a[a.INVOKE=4]="INVOKE",a[a.ABORT=5]="ABORT",a[a.CLOSE=6]="CLOSE",a[a.OPEN_PORT=7]="OPEN_PORT",a[a.ON=8]="ON";let l=0;function u(){return l++}function c(e){return e?"string"==typeof e?JSON.stringify({name:"message",message:e}):e.toJSON?JSON.stringify(e):JSON.stringify({name:e.name,message:e.message,details:e.details||{stack:e.stack}}):null}function p(e,t,n,i){if(t.type===o.OPEN_PORT)return void e.postMessage(t,[t.port]);if(t.type!==o.INVOKE&&t.type!==o.RESPONSE)return void e.postMessage(t);let s;if(function(e){return e&&"object"==typeof e&&("result"in e||"transferList"in e)}(n)?(s=f(n.transferList),t.data=n.result):(s=f(i),t.data=n),s){if((0,r.A)("ff"))for(const n of s)if("byteLength"in n&&n.byteLength>267386880){const n="Worker call with large ArrayBuffer would crash Firefox";switch(t.type){case o.INVOKE:throw n;case o.RESPONSE:return void p(e,{type:o.RESPONSE,jobId:t.jobId,error:c(n)})}}e.postMessage(t,s)}else e.postMessage(t)}function h(e){if(!e)return null;const t=e.data;return t?"string"==typeof t?JSON.parse(t):t:null}function f(e){if(!e?.length)return null;if((0,r.A)("esri-workers-arraybuffer-transfer"))return e;const t=e.filter((e=>!function(e){return e instanceof ArrayBuffer||"ArrayBuffer"===e?.constructor?.name}(e)));return t.length?t:null}async function d(e){try{return await e}catch(e){const t=e?.name===s;if(!(0,i.zf)(e)&&!t)throw e;return}}},86027:function(e,t,n){n.d(t,{n_:function(){return Z},ho:function(){return V}});var r=n(39819),i=n(58941),s=n(60539),o=n(37797),a=n(13370),l=n(50193),u=n(40633),c=n(95929),p=n(93040),h=n(90683);const f={async request(e,t){const n=e.options,r=n.responseType;n.signal=t?.signal,n.responseType="native"===r||"native-request-init"===r?"native-request-init":r&&["blob","json","text"].includes(r)&&(0,h.sC)(e.url)?.after?r:"array-buffer";const i=await(0,p.A)(e.url,n),s={data:i.data,httpStatus:i.httpStatus,ssl:i.ssl};switch(i.requestOptions?.responseType){case"native-request-init":return delete s.data.signal,s;case"blob":s.data=await s.data.arrayBuffer();break;case"json":s.data=(new TextEncoder).encode(JSON.stringify(s.data)).buffer;break;case"text":s.data=(new TextEncoder).encode(s.data).buffer}return{result:s,transferList:[s.data]}}};var d=n(64272),m=n(53216),y=n(25591),g=(n(64122),n(7156));const w={};var b=n(29601);class v{constructor(){const e=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach((t=>{this[t]=(...n)=>e[t](...n)}))}}class x{constructor(){this._dispatcher=new v,this._workerPostMessage({type:d.Go.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=e,e&&this.addEventListener("message",e)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(e){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=e,e&&this.addEventListener("messageerror",e)}get onerror(){return this._onerrorHandler}set onerror(e){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=e,e&&this.addEventListener("error",e)}postMessage(e){(0,b.d)((()=>{this._workerMessageHandler(new MessageEvent("message",{data:e}))}))}dispatchEvent(e){return this._dispatcher.dispatchEvent(e)}addEventListener(e,t,n){this._dispatcher.addEventListener(e,t,n)}removeEventListener(e,t,n){this._dispatcher.removeEventListener(e,t,n)}_workerPostMessage(e){(0,b.d)((()=>{this.dispatchEvent(new MessageEvent("message",{data:e}))}))}async _workerMessageHandler(e){const t=(0,d.VI)(e);if(t&&t.type===d.Go.OPEN){const{modulePath:e,jobId:n}=t;let r=await l.A.loadWorker(e);r||(r=await import(e));const i=l.A.connect(r);this._workerPostMessage({type:d.Go.OPENED,jobId:n,data:i})}}}var M=n(22739),A=n(23532);const I=()=>u.A.getLogger("esri.core.workers.workerFactory"),{HANDSHAKE:S}=d.Go;let _,C;const T="Failed to create Worker. Fallback to execute module in main thread";async function k(e){return new Promise((t=>{function n(i){const s=(0,d.VI)(i);s&&s.type===S&&(e.removeEventListener("message",n),e.removeEventListener("error",r),t(e))}function r(t){t.preventDefault(),e.removeEventListener("message",n),e.removeEventListener("error",r),I().warn("Failed to create Worker. Fallback to execute module in main thread",t),(e=new x).addEventListener("message",n),e.addEventListener("error",r)}e.addEventListener("message",n),e.addEventListener("error",r)}))}let R=0;const{ABORT:P,INVOKE:N,OPEN:D,OPENED:E,RESPONSE:L}=d.Go;class F{static async create(e){const t=await async function(){if(!(0,i.A)("esri-workers"))return k(new x);if(!_&&!C)try{const e='let globalId=0;const outgoing=new Map,configuration={CONFIGURATION};self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;let s=null;return new Promise(((r,i)=>{if(t){if(t.aborted)return i(createAbortError());s=()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:5,jobId:n}),i(createAbortError()))},t.addEventListener("abort",s)}outgoing.set(n,{resolve:r,reject:i}),self.postMessage({type:4,jobId:n,methodName:e,abortable:null!=t,data:o})})).finally((()=>{t&&t.removeEventListener("abort",s)}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,fullVersion:r}=configuration.kernelInfo,{revision:t,fullVersion:n,version:s}=e.kernelInfo;esriConfig.assetsPath!==esriConfig.defaultAssetsPath&&o!==t&&console.warn(`Version mismatch detected between ArcGIS Maps SDK for JavaScript modules and assets. For more information visit https://bit.ly/3QnsuSo.\nModules version: ${r}\nAssets version: ${n??s}\nAssets path: ${esriConfig.assetsPath}`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case 1:let n;function t(e){const o=n.connect(e);self.postMessage({type:2,jobId:r,data:o},[o])}"function"==typeof define&&define.amd?require([workerPath],(e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((e=>(n=e.default,checkWorkerRevision(n),n.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),n=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(n),n.loadWorker(o.modulePath).then(t));break;case 3:if(outgoing.has(r)){const s=outgoing.get(r);outgoing.delete(r),o.error?s.reject(JSON.parse(o.error)):s.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});'.split("{CONFIGURATION}").join(function(){let e;if(null!=y.default.default){const t={...y.default};delete t.default,e=JSON.parse(JSON.stringify(t))}else e=JSON.parse(JSON.stringify(y.default));e.assetsPath=(0,h.s2)(e.assetsPath),e.defaultAssetsPath=e.defaultAssetsPath?(0,h.s2)(e.defaultAssetsPath):void 0,e.request.interceptors=[],e.log.interceptors=[],e.locale=(0,M.JK)(),e.has={"esri-csp-restrictions":(0,i.A)("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":(0,i.A)("esri-2d-update-debug"),"esri-2d-log-updating":(0,i.A)("esri-2d-log-updating"),"featurelayer-pbf":(0,i.A)("featurelayer-pbf"),"featurelayer-fast-triangulation-enabled":(0,i.A)("featurelayer-fast-triangulation-enabled"),"featurelayer-simplify-thresholds":(0,i.A)("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":(0,i.A)("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":(0,i.A)("featurelayer-simplify-mobile-factor"),"featurelayer-query-max-depth":(0,i.A)("featurelayer-query-max-depth"),"featurelayer-query-pausing-enabled":(0,i.A)("featurelayer-query-pausing-enabled"),"featurelayer-snapshot-enabled":(0,i.A)("featurelayer-snapshot-enabled"),"esri-atomics":(0,i.A)("esri-atomics"),"esri-shared-array-buffer":(0,i.A)("esri-shared-array-buffer"),"esri-tiles-debug":(0,i.A)("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":(0,i.A)("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":(0,i.A)("feature-polyline-generalization-factor"),"host-webworker":1},e.workers.loaderUrl&&(e.workers.loaderUrl=(0,h.s2)(e.workers.loaderUrl)),e.workers.workerPath?e.workers.workerPath=(0,h.s2)(e.workers.workerPath):e.workers.workerPath=(0,h.s2)((0,m.s)("esri/core/workers/RemoteClient.js")),e.workers.useDynamicImport=!1;const t=y.default.workers.loaderConfig,n=function(e){const t={async:e.async,isDebug:e.isDebug,locale:e.locale,baseUrl:e.baseUrl,has:{...e.has},map:{...e.map},packages:e.packages?.slice()||[],paths:{...w.paths,...e.paths}};return e.hasOwnProperty("async")||(t.async=!0),e.hasOwnProperty("isDebug")||(t.isDebug=!1),e.baseUrl||(t.baseUrl=w.baseUrl),t}({baseUrl:t?.baseUrl,locale:(0,M.JK)(),has:{"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1,...t?.has},map:{...t?.map},paths:{...t?.paths},packages:t?.packages||[]}),r={buildDate:A.$,fullVersion:g.ol,revision:A.u};return JSON.stringify({esriConfig:e,loaderConfig:n,kernelInfo:r})}());_=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))}catch(e){C=e||{}}let e;if(_)try{e=new Worker(_,{name:"esri-worker-"+R++})}catch(t){I().warn(T,C),e=new x}else I().warn(T,C),e=new x;return k(e)}();return new F(t,e)}constructor(e,t){this._outJobs=new Map,this._inJobs=new Map,this.worker=e,this.id=t,e.addEventListener("message",this._onMessage.bind(this)),e.addEventListener("error",(e=>{e.preventDefault(),u.A.getLogger("esri.core.workers.WorkerOwner").error(e)}))}terminate(){this.worker.terminate()}async open(e,t={}){const{signal:n}=t,r=(0,d.Jc)();return new Promise(((t,i)=>{const o={resolve:t,reject:i,abortHandle:(0,s.NY)(n,(()=>{this._outJobs.delete(r),this._post({type:P,jobId:r})}))};this._outJobs.set(r,o),this._post({type:D,jobId:r,modulePath:e})}))}_onMessage(e){const t=(0,d.VI)(e);if(t)switch(t.type){case E:this._onOpenedMessage(t);break;case L:this._onResponseMessage(t);break;case P:this._onAbortMessage(t);break;case N:this._onInvokeMessage(t)}}_onAbortMessage(e){const t=this._inJobs,n=e.jobId,r=t.get(n);r&&(r.controller&&r.controller.abort(),t.delete(n))}_onInvokeMessage(e){const{methodName:t,jobId:n,data:r,abortable:i}=e,o=i?new AbortController:null,a=this._inJobs,l=f[t];let u;try{if("function"!=typeof l)throw new TypeError(`${t} is not a function`);u=l.call(null,r,{signal:o?o.signal:null})}catch(e){return void this._post({type:L,jobId:n,error:(0,d.mF)(e)})}(0,s.$X)(u)?(a.set(n,{controller:o,promise:u}),u.then((e=>{a.has(n)&&(a.delete(n),this._post({type:L,jobId:n},e))}),(e=>{a.has(n)&&(a.delete(n),e||(e={message:"Error encountered at method"+t}),(0,s.zf)(e)||this._post({type:L,jobId:n,error:(0,d.mF)(e||{message:`Error encountered at method ${t}`})}))}))):this._post({type:L,jobId:n},u)}_onOpenedMessage(e){const{jobId:t,data:n}=e,r=this._outJobs.get(t);r&&(this._outJobs.delete(t),(0,c.xt)(r.abortHandle),r.resolve(n))}_onResponseMessage(e){const{jobId:t,error:n,data:i}=e,s=this._outJobs.get(t);s&&(this._outJobs.delete(t),(0,c.xt)(s.abortHandle),n?s.reject(r.A.fromJSON(JSON.parse(n))):s.resolve(i))}_post(e,t,n){return(0,d.u1)(this.worker,e,t,n)}}const O=(0,i.A)("host-browser")?Math.min(navigator.hardwareConcurrency-1,(0,i.A)("workers-pool-size")??8):0;let z=(0,i.A)("esri-mobile")?Math.min(O,3):O;z||(z=(0,i.A)("safari")&&(0,i.A)("mac")?7:2);let j=0;const B=[];function Z(){W()}async function U(e,t){const n=new o.A,{registryTarget:r,...i}=t;return await n.open(e,i),r&&(0,a.k)(r,n),n}async function V(e,t={}){if("string"!=typeof e)throw new r.A("workers:undefined-module","modulePath is missing");let n=t.strategy||"distributed";if((0,i.A)("host-webworker")&&!(0,i.A)("esri-workers")&&(n="local"),"local"===n){let n=await l.A.loadWorker(e);n||(n=await import(e)),(0,s.Te)(t.signal);const r=t.client||n;return U([l.A.connect(n,t.schedule)],{...t,client:r})}if(await W(),(0,s.Te)(t.signal),"dedicated"===n){const n=j++%z;return U([await B[n].open(e,t)],t)}if(t.maxNumWorkers&&t.maxNumWorkers>0){const n=Math.min(t.maxNumWorkers,z);if(n<z){const r=new Array(n);for(let i=0;i<n;++i){const n=j++%z;r[i]=B[n].open(e,t)}return U(r,t)}}return U(B.map((n=>n.open(e,t))),t)}let G,H=null;async function W(){if(H)return H;G=new AbortController;const e=[];for(let t=0;t<z;t++){const n=F.create(t).then((e=>(B[t]=e,e)));e.push(n)}return H=Promise.all(e),H}},65298:function(e,t,n){n.d(t,{O7:function(){return _},Hr:function(){return S},el:function(){return I},mT:function(){return C},XX:function(){return v}});var r=n(25591),i=n(39819),s=n(40633),o=n(44740),a=n(91508),l=n(65417),u=n(57652),c=n(1644),p=(n(50917),n(93040)),h=n(74697),f=n(39397),d=n(90683),m=n(26765);const y=()=>s.A.getLogger("esri.geometry.support.normalizeUtils");function g(e){return"polygon"===e[0].type}function w(e){return"polyline"===e[0].type}function b(e){const t=[];let n=0,r=0;for(let i=0;i<e.length;i++){const s=e[i];let o=null;for(let e=0;e<s.length;e++)o=s[e],t.push(o),0===e?(n=o[0],r=n):(n=Math.min(n,o[0]),r=Math.max(r,o[0]));o&&t.push([(n+r)/2,0])}return t}function v(e,t){if(!(e instanceof a.A||e instanceof o.A)){const e="straightLineDensify: the input geometry is neither polyline nor polygon";throw y().error(e),new i.A(e)}const n=(0,l.r8)(e),r=[];for(const e of n){const n=[];r.push(n),n.push([e[0][0],e[0][1]]);for(let r=0;r<e.length-1;r++){const i=e[r][0],s=e[r][1],o=e[r+1][0],a=e[r+1][1],l=Math.sqrt((o-i)*(o-i)+(a-s)*(a-s)),u=(a-s)/l,c=(o-i)/l,p=l/t;if(p>1){for(let e=1;e<=p-1;e++){const r=e*t,o=c*r+i,a=u*r+s;n.push([o,a])}const e=(l+Math.floor(p-1)*t)/2,r=c*e+i,o=u*e+s;n.push([r,o])}n.push([o,a])}}return function(e){return"polygon"===e.type}(e)?new o.A({rings:r,spatialReference:e.spatialReference}):new a.A({paths:r,spatialReference:e.spatialReference})}function x(e,t,n){if(t){const t=v(e,1e6);e=(0,c.ci)(t,!0)}return n&&(e=(0,l.kS)(e,n)),e}function M(e,t,n){if(Array.isArray(e)){const r=e[0];if(r>t){const n=(0,l.kd)(r,t);e[0]=r+n*(-2*t)}else if(r<n){const t=(0,l.kd)(r,n);e[0]=r+t*(-2*n)}}else{const r=e.x;if(r>t){const n=(0,l.kd)(r,t);e=e.clone().offset(n*(-2*t),0)}else if(r<n){const t=(0,l.kd)(r,n);e=e.clone().offset(t*(-2*n),0)}}return e}function A(e,t){let n=-1;for(let r=0;r<t.cutIndexes.length;r++){const i=t.cutIndexes[r],s=t.geometries[r],o=(0,l.r8)(s);for(let e=0;e<o.length;e++){const t=o[e];t.some((n=>{if(n[0]<180)return!0;{let n=0;for(let e=0;e<t.length;e++){const r=t[e][0];n=r>n?r:n}n=Number(n.toFixed(9));const r=-360*(0,l.kd)(n,180);for(let n=0;n<t.length;n++){const t=s.getPoint(e,n);s.setPoint(e,n,t.clone().offset(r,0))}return!0}}))}if(i===n){if(g(e))for(const t of(0,l.r8)(s))e[i]=e[i].addRing(t);else if(w(e))for(const t of(0,l.r8)(s))e[i]=e[i].addPath(t)}else n=i,e[i]=s}return e}async function I(e,t,n){if(!Array.isArray(e))return I([e],t);t&&"string"!=typeof t&&y().warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");const i="string"==typeof t?t:t?.url??r.default.geometryServiceUrl;let s,g,w,b,v,S,_,C,T=0;const k=[],R=[];for(const t of e)if(null!=t)if(s||(s=t.spatialReference,g=(0,u.Vp)(s),w=s.isWebMercator,S=w?102100:4326,b=l.j7[S].maxX,v=l.j7[S].minX,_=l.j7[S].plus180Line,C=l.j7[S].minus180Line),g)if("mesh"===t.type)R.push(t);else if("point"===t.type)R.push(M(t.clone(),b,v));else if("multipoint"===t.type){const e=t.clone();e.points=e.points.map((e=>M(e,b,v))),R.push(e)}else if("extent"===t.type){const e=t.clone()._normalize(!1,!1,g);R.push(e.rings?new o.A(e):e)}else if(t.extent){const e=t.extent,n=(0,l.kd)(e.xmin,v)*(2*b);let r=0===n?t.clone():(0,l.kS)(t.clone(),n);e.offset(n,0);let{xmin:i,xmax:s}=e;i=Number(i.toFixed(9)),s=Number(s.toFixed(9)),e.intersects(_)&&s!==b?(T=s>T?s:T,r=x(r,w),k.push(r),R.push("cut")):e.intersects(C)&&i!==v?(T=s*(2*b)>T?s*(2*b):T,r=x(r,w,360),k.push(r),R.push("cut")):R.push(r)}else R.push(t.clone());else R.push(t);else R.push(t);let P=(0,l.kd)(T,b),N=-90;const D=P,E=new a.A;for(;P>0;){const e=360*P-180;E.addPath([[e,N],[e,-1*N]]),N*=-1,P--}if(k.length>0&&D>0){const t=A(k,await async function(e,t,n,r){const i=(0,f.Dl)(e),s=t[0].spatialReference,o={...r,responseType:"json",query:{...i.query,f:"json",sr:(0,u.YX)(s),target:JSON.stringify({geometryType:(0,h.$B)(t[0]),geometries:t}),cutter:JSON.stringify(n)}},a=await(0,p.A)(i.path+"/cut",o),{cutIndexes:l,geometries:c=[]}=a.data;return{cutIndexes:l,geometries:c.map((e=>{const t=(0,h.rS)(e);return t.spatialReference=s,t}))}}(i,k,E,n)),r=[],s=[];for(let n=0;n<R.length;n++){const i=R[n];if("cut"!==i)s.push(i);else{const i=t.shift(),o=e[n];null!=o&&"polygon"===o.type&&o.rings&&o.rings.length>1&&i.rings.length>=o.rings.length?(r.push(i),s.push("simplify")):s.push(w?(0,c.Gh)(i):i)}}if(!r.length)return s;const o=await async function(e,t,n){const r="string"==typeof e?(0,d.An)(e):e,i=t[0].spatialReference,s=(0,h.$B)(t[0]),o={...n,query:{...r.query,f:"json",sr:(0,u.YX)(i),geometries:JSON.stringify((0,m.X)(t))}},{data:a}=await(0,p.A)(r.path+"/simplify",o);return(0,m.V)(a.geometries,s,i)}(i,r,n),a=[];for(let e=0;e<s.length;e++){const t=s[e];"simplify"!==t?a.push(t):a.push(w?(0,c.Gh)(o.shift()):o.shift())}return a}const L=[];for(let e=0;e<R.length;e++){const t=R[e];if("cut"!==t)L.push(t);else{const e=k.shift();L.push(!0===w?(0,c.Gh)(e):e)}}return L}function S(e){if(!e)return null;const t=e.extent;if(!t)return null;const n=e.spatialReference&&(0,u.Vp)(e.spatialReference);if(!n)return t;const[r,i]=n.valid,s=2*i,{width:o}=t;let a,{xmin:l,xmax:c}=t;if([l,c]=[c,l],"extent"===e.type||0===o||o<=i||o>s||l<r||c>i)return t;switch(e.type){case"polygon":if(!(e.rings.length>1))return t;a=b(e.rings);break;case"polyline":if(!(e.paths.length>1))return t;a=b(e.paths);break;case"multipoint":a=e.points}const p=t.clone();for(let e=0;e<a.length;e++){let t=a[e][0];t<0?(t+=i,c=Math.max(t,c)):(t-=i,l=Math.min(t,l))}return p.xmin=l,p.xmax=c,p.width<o?(p.xmin-=i,p.xmax-=i,p):t}function _(e,t,n){const r=(0,u.Vp)(n);if(null==r)return e;const[i,s]=r.valid,o=2*s;let a=0,l=0;t>s?a=Math.ceil(Math.abs(t-s)/o):t<i&&(a=-Math.ceil(Math.abs(t-i)/o)),e>s?l=Math.ceil(Math.abs(e-s)/o):e<i&&(l=-Math.ceil(Math.abs(e-i)/o));let c=e+(a-l)*o;const p=c-t;return p>s?c-=o:p<i&&(c+=o),c}function C(e,t){const n=(0,u.Vp)(t);if(n){const[t,r]=n.valid,i=r-t;if(e<t)for(;e<t;)e+=i;if(e>r)for(;e>r;)e-=i}return e}},65417:function(e,t,n){n.d(t,{j7:function(){return o},kS:function(){return l},kd:function(){return a},r8:function(){return u}});var r=n(91508),i=n(57165),s=n(74697);const o={102100:{maxX:20037508.342788905,minX:-20037508.342788905,plus180Line:new r.A({paths:[[[20037508.342788905,-20037508.342788905],[20037508.342788905,20037508.342788905]]],spatialReference:i.A.WebMercator}),minus180Line:new r.A({paths:[[[-20037508.342788905,-20037508.342788905],[-20037508.342788905,20037508.342788905]]],spatialReference:i.A.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new r.A({paths:[[[180,-180],[180,180]]],spatialReference:i.A.WGS84}),minus180Line:new r.A({paths:[[[-180,-180],[-180,180]]],spatialReference:i.A.WGS84})}};function a(e,t){return Math.ceil((e-t)/(2*t))}function l(e,t){const n=u(e);for(const e of n)for(const n of e)n[0]+=t;return e}function u(e){return(0,s.Bi)(e)?e.rings:e.paths}},53286:function(e,t,n){n.r(t),n.d(t,{default:function(){return yt}});var r=n(53804),i=n(90473),s=n(75743),o=n(39819),a=n(40633),l=n(77793),u=n(60539),c=n(28181),p=n(23502),h=n(67888),f=(n(13798),n(58941)),d=n(65953),m=n(20833),y=n(74927),g=n(1615),w=n(88243),b=(n(50917),n(92778)),v=n(93040),x=n(88022),M=n(74376),A=n(47332),I=n(57652),S=n(93389),_=n(7010),C=n(7860),T=n(66362),k=n(32405),R=n(77345),P=n(46766),N=n(76226),D=n(44740),E=n(30905),L=n(44431),F=n(70850),O=n(30158),z=n(36529),j=n(95738),B=n(43008),Z=n(43264),U=n(80221),V=n(53611),G=n(46863),H=n(45532),W=n(91484),J=n(57165);let q=0,$=class extends E.oY{constructor(){super(...arguments),this._tileFetchQueue=new G.e({concurrency:32,process:(e,t)=>this._fetchRawTile(e.pyramidLevel,e.row,e.col,{...e.options,signal:t})}),this.datasetName=null,this.datasetFormat=null,this.hasUniqueSourceStorageInfo=!0,this.rasterInfo=null,this.ioConfig={sampling:"closest"}}normalizeCtorArgs(e){return e?.ioConfig&&(e={...e,ioConfig:{resolution:null,bandIds:null,sampling:"closest",tileInfo:N.default.create(),...e.ioConfig}}),e}get _isGlobalWrappableSource(){const{rasterInfo:e}=this,t=(0,U.FT)(e.spatialReference);return null!=t&&e.extent.width>=t/2}get _hasNoneOrGCSShiftTransform(){const{transform:e}=this.rasterInfo;return null==e||"gcs-shift"===e.type}set rasterJobHandler(e){this._set("rasterJobHandler",e),"Function"===this.datasetFormat&&this.primaryRasters?.rasters?.forEach((t=>t.rasterJobHandler=e))}get rasterId(){return this.url||"rasterId-"+q++}set url(e){this._set("url",(0,S.Jf)(e,a.A.getLogger(this)))}async open(e){return this._openPromise??=(0,U.Hh)().then((()=>this._open(e))),this._openPromise}async fetchTile(e,t,n,r={}){const i=r.tileInfo||this.rasterInfo.storageInfo.tileInfo,s=this.getTileExtentFromTileInfo(e,t,n,i);return r={noClip:!0,...r},this.fetchPixels(s,i.size[0],i.size[1],r)}async identify(e,t={}){e=(0,h.PZ)(H.default,e).clone().normalize();const{multidimensionalDefinition:n,timeExtent:r}=t,{rasterInfo:i}=this,{hasMultidimensionalTranspose:s,multidimensionalInfo:o}=i;let{transposedVariableName:a}=t;const l=null!=o&&s&&(null!=r||(0,O.DY)(n));l&&!a&&(a=null!=n&&n.length>0?n[0].variableName??void 0:o.variables[0].name,t={...t,transposedVariableName:a}),t=this._getRequestOptionsWithSliceId(t);const{spatialReference:u,extent:c}=i,{datumTransformation:p}=t;let f=(0,U._I)(e,u,p);if(!c.intersects(f))return{location:f,value:null};if(null!=i.transform){const e=i.transform.inverseTransform(f);if(!i.nativeExtent.intersects(e))return{location:e,value:null};f=e}let d=0;const m=null!=a&&null!=o&&i.hasMultidimensionalTranspose;if("Function"===this.datasetFormat){const e=this.primaryRasters.rasters[0];if(m)return e.identify(f,t);const{pixelSize:r}=i,s=3,o=r.x*s/2,a=r.y*s/2,l=new W.default({xmin:f.x-o,xmax:f.x+o,ymin:f.y-a,ymax:f.y+a,spatialReference:u}),c={interpolation:"nearest",multidimensionalDefinition:n,sliceId:t.sliceId},{pixelBlock:p}=await e.fetchPixels(l,s,s,c),{pixelBlock:h}=await this.fetchPixels(l,s,s,c);if(null==p)return{location:f,value:null};const d=Math.floor(s*s*.5),y=!p.mask||p.mask[d]?p.pixels.map((e=>e[d])):null;let g;return null!=h&&(g=!h.mask||h.mask[d]?h.pixels.map((e=>e[d])):void 0),{location:f,value:y,processedValue:g,pyramidLevel:0}}if(!m)if(t.srcResolution)d=(0,U.t$)(t.srcResolution,i,this.ioConfig.sampling).pyramidLevel;else if(d=await this.computeBestPyramidLevelForLocation(e,t),null==d)return{location:f,value:null};const y=this.identifyPixelLocation(f,d,null,m);if(null===y)return{location:f,value:null};const{row:g,col:w,rowOffset:b,colOffset:v,blockWidth:x}=y,M=a??t.sliceId,A=(0,z.ph)(this.rasterId,M),I=`${d}/${g}/${w}`;let S=(0,z.gd)(A,null,I);null==S&&(S=this.fetchRawTile(d,g,w,t),(0,z.no)(A,null,I,S));const _=await S;if(!_?.pixels?.length)return{location:f,value:null};const C=b*x+v;return this._processIdentifyResult(_,{srcLocation:f,position:C,pyramidLevel:d,useTransposedTile:!!m,requestSomeSlices:l,identifyOptions:t})}async fetchPixels(e,t,n,r={}){e=(0,U.Ps)(e),r=this._getRequestOptionsWithSliceId(r);const{_hasNoneOrGCSShiftTransform:i}=this;if(r.requestRawData&&i)return this._fetchPixels(e,t,n,r);const s=(0,U.FT)(e.spatialReference),o=(0,U.OM)(e);if(null==s||0===o||1===o&&this._isGlobalWrappableSource&&i)return this._fetchPixels(e,t,n,r);if(o>=3)return{extent:e,pixelBlock:null};const a=[],{xmin:l,xmax:u}=e,c=Math.round(s/(u-l)*t),p=c-Math.round((s/2-l)/(u-l)*t);let h=0;const f=[];for(let i=0;i<=o;i++){const d=new W.default({xmin:0===i?l:-s/2,xmax:i===o?u-s*i:s/2,ymin:e.ymin,ymax:e.ymax,spatialReference:e.spatialReference}),m=0===i?c-p:i===o?t-h:c;h+=m,f.push(m);const y=r.disableWrapAround&&i>0?null:this._fetchPixels(d,m,n,r);a.push(y)}const d=(await Promise.all(a)).map((e=>e?.pixelBlock));let m=null;const y={width:t,height:n};return m=this.rasterJobHandler?(await this.rasterJobHandler.mosaicAndTransform({srcPixelBlocks:d,srcMosaicSize:y,destDimension:null,coefs:null,sampleSpacing:null,interpolation:"nearest",alignmentInfo:null,blockWidths:f},r)).pixelBlock:(0,Z.z7)(d,y,{blockWidths:f}),{extent:e,srcExtent:(0,U._l)(e,this.rasterInfo.spatialReference,r.datumTransformation),pixelBlock:m}}async fetchRawPixels(e,t,n,r={}){t={x:Math.floor(t.x),y:Math.floor(t.y)};const i=await this._fetchRawTiles(e,t,n,r),{nativeExtent:s,nativePixelSize:o,storageInfo:a}=this.rasterInfo,l=2**e,u=o.x*l,c=o.y*l,p=new W.default({xmin:s.xmin+u*t.x,xmax:s.xmin+u*(t.x+n.width-1),ymin:s.ymax-c*(t.y+n.height-1),ymax:s.ymax-c*t.y,spatialReference:s.spatialReference});if(!i)return{extent:p,srcExtent:p,pixelBlock:null};const{pixelBlocks:h,mosaicSize:f}=i;if(1===h.length&&null!=h[0]&&h[0].width===n.width&&h[0].height===n.height)return{extent:p,srcExtent:p,pixelBlock:i.pixelBlocks[0]};const d=e>0?a.pyramidBlockWidth:a.blockWidth,m=e>0?a.pyramidBlockHeight:a.blockHeight,y={x:t.x%d,y:t.y%m};let g;return g=this.rasterJobHandler?(await this.rasterJobHandler.mosaicAndTransform({srcPixelBlocks:h,srcMosaicSize:f,destDimension:n,clipOffset:y,clipSize:n,coefs:null,sampleSpacing:null,interpolation:r.interpolation,alignmentInfo:null,blockWidths:null},r)).pixelBlock:(0,Z.z7)(h,f,{clipOffset:y,clipSize:n}),{extent:p,srcExtent:p,pixelBlock:g}}fetchRawTile(e,t,n,r){throw new o.A("BaseRaster:read-not-implemented","fetchRawTile() is not implemented")}computeExtent(e){return(0,U._l)(this.rasterInfo.extent,e)}decodePixelBlock(e,t){return!this.rasterJobHandler||t.useCanvas?(0,B.D)(e,t):this.rasterJobHandler.decode({data:e,options:t})}async request(e,t,n=0){const{customFetchParameters:r}=this.ioConfig,{range:i,query:s,headers:o}=t;n=n??t.retryCount??this.ioConfig.retryCount;const a=i?{Range:`bytes=${i.from}-${i.to}`}:null;try{return await(0,v.A)(e,{...t,query:{...s,...r},headers:{...o,...a}})}catch(r){if(n>0)return n--,this.request(e,t,n);throw r}}getSliceIndex(e){const{multidimensionalInfo:t}=this.rasterInfo;return null==t||null==e||0===e.length?null:(0,O.NG)(e,t)}getTileExtentFromTileInfo(e,t,n,r){const i=r.lodAt(e);return this.getTileExtent({x:i.resolution,y:i.resolution},t,n,r.origin,r.spatialReference,r.size)}updateTileInfo(){const{storageInfo:e,spatialReference:t,extent:n,pixelSize:r}=this.rasterInfo,{pyramidResolutions:i}=e;if(!e.tileInfo){const s=[],o=e.maximumPyramidLevel||0;let a=(r.x+r.y)/2,l=1/.0254*96*a;for(let e=0;e<=o&&(s.unshift(new L.A({level:o-e,resolution:a,scale:l})),e!==o);e++)if(i){const t=(i[e].x+i[e].y)/2;l*=t/a,a=t}else a*=2,l*=2;const u=new H.default({x:n.xmin,y:n.ymax,spatialReference:t});e.tileInfo=new N.default({origin:u,size:[e.blockWidth,e.blockHeight],spatialReference:t,lods:s}),e.isVirtualTileInfo=!0}}createRemoteDatasetStorageInfo(e,t=512,n=512,r){const{width:i,height:s,nativeExtent:o,pixelSize:a,spatialReference:l}=e,u=new H.default({x:o.xmin,y:o.ymax,spatialReference:l});null==r&&(r=Math.max(0,Math.round(Math.log(Math.max(i,s))/Math.LN2-8)));const c=this.computeBlockBoundary(o,512,512,{x:o.xmin,y:o.ymax},[a],r);e.storageInfo=new F.A({blockWidth:t,blockHeight:n,pyramidBlockWidth:t,pyramidBlockHeight:n,origin:u,firstPyramidLevel:1,maximumPyramidLevel:r,blockBoundary:c})}async computeBestPyramidLevelForLocation(e,t={}){return 0}computeBlockBoundary(e,t,n,r,i,s=0,o=2){if(1===i.length&&s>0){i=[...i];let{x:e,y:t}=i[0];for(let n=0;n<s;n++)e*=o,t*=o,i.push({x:e,y:t})}const a=[],{x:l,y:u}=r;for(let r=0;r<i.length;r++){const{x:s,y:o}=i[r];a.push({minCol:Math.floor((e.xmin-l+.1*s)/t/s),maxCol:Math.floor((e.xmax-l-.1*s)/t/s),minRow:Math.floor((u-e.ymax+.1*o)/n/o),maxRow:Math.floor((u-e.ymin-.1*o)/n/o)})}return a}getPyramidPixelSize(e){const{nativePixelSize:t}=this.rasterInfo,{pyramidResolutions:n,pyramidScalingFactor:r}=this.rasterInfo.storageInfo;if(0===e)return t;if(null!=n&&n.length)return n[e-1];const i=r**e;return{x:t.x*i,y:t.y*i}}identifyPixelLocation(e,t,n,r){const{spatialReference:i,nativeExtent:s,storageInfo:o}=this.rasterInfo,{maximumPyramidLevel:a,origin:l,transposeInfo:u}=o,c=r&&null!=u?u.tileSize[0]:o.blockWidth,p=r&&null!=u?u.tileSize[1]:o.blockHeight,h=(0,U._I)(e,i,n);if(!s.intersects(h))return null;if(t<0||t>a)return null;const f=this.getPyramidPixelSize(t),{x:d,y:m}=f,y=(l.y-h.y)/m/p,g=(h.x-l.x)/d/c,w=Math.min(p-1,Math.floor((y-Math.floor(y))*p)),b=Math.min(c-1,Math.floor((g-Math.floor(g))*c));return{pyramidLevel:t,row:Math.floor(y),col:Math.floor(g),rowOffset:w,colOffset:b,blockWidth:c,srcLocation:h}}getTileExtent(e,t,n,r,i,s){const[o,a]=s,l=r.x+n*o*e.x,u=l+o*e.x,c=r.y-t*a*e.y,p=c-a*e.y;return new W.default({xmin:l,xmax:u,ymin:p,ymax:c,spatialReference:i})}getBlockWidthHeight(e){return{blockWidth:e>0?this.rasterInfo.storageInfo.pyramidBlockWidth:this.rasterInfo.storageInfo.blockWidth,blockHeight:e>0?this.rasterInfo.storageInfo.pyramidBlockHeight:this.rasterInfo.storageInfo.blockHeight}}isBlockOutside(e,t,n){const r=this.rasterInfo.storageInfo.blockBoundary[e];return!r||r.maxRow<t||r.maxCol<n||r.minRow>t||r.minCol>n}updateImageSpaceRasterInfo(e){const{pixelSize:t}=e,{width:n,height:r}=e,i=J.A.WebMercator;e.spatialReference=i,e.extent=e.nativeExtent=new W.default({xmin:-.5,ymax:.5,xmax:n-.5,ymin:.5-r,spatialReference:i}),e.isPseudoSpatialReference=!0,e.transform=null,e.pixelSize=new H.default({x:1,y:1,spatialReference:i});const{extent:s,storageInfo:o}=e;if(o){o.origin=new H.default({x:s.xmin,y:s.ymax,spatialReference:i});const{pyramidResolutions:n,tileInfo:r}=o;if(n&&n.forEach((e=>{e.x/=t.x,e.y/=t.y})),r){r.origin=o.origin;const t=(e.nativePixelSize.x+e.nativePixelSize.y)/2;r.lods.forEach(((e,n)=>{e.resolution=t*2**n,e.scale=96*e.resolution/.0254}))}}}async _fetchPixels(e,t,n,r={}){let i=(0,U.OM)(e);if(i>=2)return{extent:e,pixelBlock:null};const s=this._getSourceDataInfo(e,t,n,r),{pyramidLevel:o,srcResolution:a,srcExtent:l,srcWidth:u,srcHeight:c,ul:p}=s;if(0===u||0===c)return{extent:e,srcExtent:l,pixelBlock:null};const{rasterInfo:h}=this,f=h.transform,d="gcs-shift"===f?.type,m=null!=(0,U.FT)(e.spatialReference);!d&&m||(i=(0,U.OM)(s.srcExtent,d));const y=await this._fetchRawTiles(o,p,{width:u,height:c,wrapCount:i},r);if(!y)return{extent:e,srcExtent:l,pixelBlock:null};const g=h.storageInfo,w=o>0?g.pyramidBlockWidth:g.blockWidth,b=o>0?g.pyramidBlockHeight:g.blockHeight;let{x:v,y:x}=h.pixelSize;if(o>0){const{pyramidResolutions:e,pyramidScalingFactor:t}=g;if(null!=e&&e[o-1])({x:v,y:x}=e[o-1]);else{const e=t**o;v*=e,x*=e}}const M=h.spatialReference,A=new H.default({x:v,y:x,spatialReference:M}),I=w===u&&b===c&&p.x%w==0&&p.y%b==0,S=new H.default({x:(e.xmax-e.xmin)/t,y:(e.ymax-e.ymin)/n,spatialReference:e.spatialReference}),_=!e.spatialReference.equals(M),C=M.isGeographic?1e-9:1e-4,{datumTransformation:T}=r;if(!_&&I&&1===y.pixelBlocks.length&&w===t&&b===n&&function(e,t,n){return Math.abs(e.x-t.x)<n&&Math.abs(e.y-t.y)<n}(a,S,C))return{extent:e,srcExtent:l,srcTilePixelSize:A,pixelBlock:y.pixelBlocks[0]};const k=m&&null!=(0,U.FT)(l.spatialReference)&&this._hasNoneOrGCSShiftTransform,R=r.requestProjectedLocalDirections&&this.rasterInfo.dataType.startsWith("vector");R&&!this.rasterJobHandler&&await(0,U.Hh)();const P=this.rasterJobHandler?await this.rasterJobHandler.getProjectionOffsetGrid({projectedExtent:e,srcBufferExtent:y.extent,pixelSize:S.toJSON(),datumTransformation:T,rasterTransform:f,hasWrapAround:i>0||k,isAdaptive:!1!==this.ioConfig.optimizeProjectionAccuracy,includeGCSGrid:R},r):(0,U.l0)({projectedExtent:e,srcBufferExtent:y.extent,pixelSize:S,datumTransformation:T,rasterTransform:f,hasWrapAround:i>0||k,isAdaptive:!1,includeGCSGrid:R});let N;const D=!r.requestRawData,E={rows:P.spacing[0],cols:P.spacing[1]},L=this._hasNoneOrGCSShiftTransform?this._getRasterTileAlignmentInfo(o,y.extent.xmin):void 0,{pixelBlocks:F,mosaicSize:O,isPartiallyFilled:z}=y;let j=null;if(this.rasterJobHandler){const e=await this.rasterJobHandler.mosaicAndTransform({srcPixelBlocks:F,srcMosaicSize:O,destDimension:D?{width:t,height:n}:null,coefs:D?P.coefficients:null,sampleSpacing:D?E:null,projectDirections:R,gcsGrid:R?P.gcsGrid:null,isUV:"vector-uv"===this.rasterInfo.dataType,interpolation:r.interpolation,alignmentInfo:L,blockWidths:null},r);({pixelBlock:N,localNorthDirections:j}=e)}else{const e=(0,Z.z7)(F,O,{alignmentInfo:L});N=D?(0,Z.$i)(e,{width:t,height:n},P.coefficients,E,r.interpolation):e,R&&P.gcsGrid&&(j=(0,Z.QF)({width:t,height:n},P.gcsGrid),N=(0,V.Y2)(N,this.rasterInfo.dataType,j))}return r.requestRawData||R?{extent:e,srcExtent:l,srcTilePixelSize:A,pixelBlock:N,transformGrid:P,localNorthDirections:j,isPartiallyFilled:z}:{extent:e,srcExtent:l,srcTilePixelSize:A,pixelBlock:N}}async _fetchRawTiles(e,t,n,r){const{origin:i,blockBoundary:s}=this.rasterInfo.storageInfo,{blockWidth:o,blockHeight:a}=this.getBlockWidthHeight(e);let{x:l,y:u}=t,{width:c,height:p,wrapCount:h}=n;const f=this._getRasterTileAlignmentInfo(e,0);r.buffer&&(l-=r.buffer.cols,u-=r.buffer.rows,c+=2*r.buffer.cols,p+=2*r.buffer.rows);let d=0,m=0,y=0;h&&null!=f&&(({worldColumnCountFromOrigin:m,originColumnOffset:y,rightPadding:d}=f),m*f.blockWidth-d>=l+c&&(d=0));const g=Math.floor(l/o),w=Math.floor(u/a),b=Math.floor((l+c+d-1)/o),v=Math.floor((u+p+d-1)/a),x=s[e];if(!x)return null;const{minRow:M,minCol:A,maxCol:I,maxRow:S}=x;if(0===h&&(v<M||b<A||w>S||g>I))return null;const _=new Array;let C=!1;const T=null==this.ioConfig.allowPartialFill?r.allowPartialFill:this.ioConfig.allowPartialFill;for(let t=w;t<=v;t++)for(let n=g;n<=b;n++){let i=n;if(!r.disableWrapAround&&h&&null!=f&&m<=n&&(i=n-m-y),t>=M&&i>=A&&S>=t&&I>=i){const n=this._tileFetchQueue.push({pyramidLevel:e,row:t,col:i,options:r},{signal:r.signal});T?_.push(new Promise((e=>{n.then((t=>e(t))).catch((()=>{C=!0,e(null)}))}))):_.push(n)}else _.push(Promise.resolve(null))}if(0===_.length)return null;const k=await Promise.all(_),R={height:(v-w+1)*a,width:(b-g+1)*o},{spatialReference:P}=this.rasterInfo,N=this.getPyramidPixelSize(e),{x:D,y:E}=N;return{extent:new W.default({xmin:i.x+g*o*D,xmax:i.x+(b+1)*o*D,ymin:i.y-(v+1)*a*E,ymax:i.y-w*a*E,spatialReference:P}),pixelBlocks:k,mosaicSize:R,isPartiallyFilled:C}}_fetchRawTile(e,t,n,r){const i=this.rasterInfo.storageInfo.blockBoundary[e];if(!i)return Promise.resolve(null);const{minRow:s,minCol:o,maxCol:a,maxRow:l}=i;if(t<s||n<o||t>l||n>a)return Promise.resolve(null);const c=(0,z.ph)(this.rasterId,r.sliceId),p=`${e}/${t}/${n}`;let h=(0,z.gd)(c,r.registryId,p);if(null==h){const i=new AbortController;h=this.fetchRawTile(e,t,n,{...r,signal:i.signal}),(0,z.no)(c,r.registryId,p,h,i),h.catch((()=>(0,z.zo)(c,r.registryId,p)))}return r.signal&&(0,u.u7)(r,(()=>{(0,z.jX)(c,r.registryId,p)})),h}_computeMagDirValues(e){const{bandCount:t,dataType:n}=this.rasterInfo;if((2!==t||"vector-magdir"!==n)&&"vector-uv"!==n||2!==e?.length||!e[0]?.length)return null;const r=e[0].length;if("vector-magdir"===n){const t=e[1].map((e=>(e+360)%360));return[e[0],t]}const[i,s]=e,o=[],a=[];for(let e=0;e<r;e++){const[t,n]=(0,V.Lu)([i[e],s[e]]);o.push(t),a.push(n)}return[o,a]}_getRasterTileAlignmentInfo(e,t){return null==this._rasterTileAlignmentInfo&&(this._rasterTileAlignmentInfo=(0,U.DO)(this.rasterInfo)),null==this._rasterTileAlignmentInfo.pyramidsInfo?null:{startX:t,halfWorldWidth:this._rasterTileAlignmentInfo.halfWorldWidth,hasGCSSShiftTransform:this._rasterTileAlignmentInfo.hasGCSSShiftTransform,...this._rasterTileAlignmentInfo.pyramidsInfo[e]}}_getSourceDataInfo(e,t,n,r={}){const i={datumTransformation:r.datumTransformation,pyramidLevel:0,pyramidResolution:null,srcExtent:null,srcHeight:0,srcResolution:null,srcWidth:0,ul:{x:0,y:0}};r.srcResolution&&(i.srcResolution=r.srcResolution,this._updateSourceDataInfo(e,i));const s=this.rasterInfo.storageInfo.maximumPyramidLevel||0,{srcWidth:o,srcHeight:a,pyramidLevel:l}=i,u=o/t,c=a/n,p=l<s&&u*c>=16,h=l===s&&this._requireTooManySrcTiles(o,a,t,n);if(p||h||0===o||0===a){const o=new H.default({x:(e.xmax-e.xmin)/t,y:(e.ymax-e.ymin)/n,spatialReference:e.spatialReference});let a=(0,U.Wo)(o,this.rasterInfo.spatialReference,e,i.datumTransformation);const h=!a||r.srcResolution&&a.x+a.y<r.srcResolution.x+r.srcResolution.y;if(p&&r.srcResolution&&h){const e=Math.round(Math.log(Math.max(u,c))/Math.LN2)-1;if(s-l+3>=e){const t=2**e;a={x:r.srcResolution.x*t,y:r.srcResolution.y*t}}}a&&(i.srcResolution=a,this._updateSourceDataInfo(e,i))}return this._requireTooManySrcTiles(i.srcWidth,i.srcHeight,t,n)&&(i.srcWidth=0,i.srcHeight=0),i}_requireTooManySrcTiles(e,t,n,r){const{tileInfo:i}=this.rasterInfo.storageInfo,s=e/n,o=t/r;return Math.ceil(e/i.size[0])*Math.ceil(t/i.size[1])>=256*Math.max(1,(n+r)/1024)||s>8||o>8}_updateSourceDataInfo(e,t){t.srcWidth=0,t.srcHeight=0;const{rasterInfo:n}=this,r=n.spatialReference,{srcResolution:i,datumTransformation:s}=t,{pyramidLevel:o,pyramidResolution:a,excessiveReading:l}=(0,U.t$)(i,n,this.ioConfig.sampling);if(l)return;let u=t.srcExtent||(0,U._l)(e,r,s);if(null==u)return;const c=n.transform;c&&(u=c.inverseTransform(u)),t.srcExtent=u;const{x:p,y:h}=n.storageInfo.origin,f=Math.floor((u.xmin-p)/a.x+.1),d=Math.floor((h-u.ymax)/a.y+.1),m=Math.floor((u.xmax-p)/a.x-.1),y=Math.floor((h-u.ymin)/a.y-.1),g=u.width<.1*a.x?0:m-f+1,w=u.height<.1*a.y?0:y-d+1;t.pyramidLevel=o,t.pyramidResolution=a,t.srcWidth=g,t.srcHeight=w,t.ul={x:f,y:d}}_getRequestOptionsWithSliceId(e){return null!=this.rasterInfo.multidimensionalInfo&&null==e.sliceId&&(e={...e,sliceId:this.getSliceIndex(e.multidimensionalDefinition)}),e}_processIdentifyResult(e,t){const{srcLocation:n,position:r,pyramidLevel:i,useTransposedTile:s}=t,o=e.pixels[0].length/e.width/e.height;if(e.mask&&!e.mask[r])return{location:n,value:null};const{multidimensionalInfo:a}=this.rasterInfo;if(null==a||!s){const t=e.pixels.map((e=>e[r])),s={location:n,value:t,pyramidLevel:i},o=this._computeMagDirValues(t.map((e=>[e])));return o?.length&&(s.magdirValue=o.map((e=>e[0]))),s}let l=e.pixels.map((e=>e.slice(r*o,r*o+o))),u=this._computeMagDirValues(l);const{requestSomeSlices:c,identifyOptions:p}=t;let h=(0,O.QW)(a,p.transposedVariableName);if(c){const e=(0,O.xx)(h,p.multidimensionalDefinition,p.timeExtent);l=l.map((t=>e.map((e=>t[e])))),u=u?.map((t=>e.map((e=>t[e])))),h=e.map((e=>h[e]))}const f=e.noDataValues||this.rasterInfo.noDataValue,d={pixels:l,pixelType:e.pixelType};let m;return null!=f&&((0,j.Sp)(d,f),m=d.mask),{location:n,value:null,dataSeries:h.map(((e,t)=>{const n={value:0===m?.[t]?null:l.map((e=>e[t])),multidimensionalDefinition:e.multidimensionalDefinition.map((e=>new C.A({...e,isSlice:!0})))};return u?.length&&(n.magdirValue=[u[0][t],u[1][t]]),n})),pyramidLevel:i}}};(0,r._)([(0,p.MZ)()],$.prototype,"_rasterTileAlignmentInfo",void 0),(0,r._)([(0,p.MZ)()],$.prototype,"_tileFetchQueue",void 0),(0,r._)([(0,p.MZ)({readOnly:!0})],$.prototype,"_isGlobalWrappableSource",null),(0,r._)([(0,p.MZ)({readOnly:!0})],$.prototype,"_hasNoneOrGCSShiftTransform",null),(0,r._)([(0,p.MZ)()],$.prototype,"_openPromise",void 0),(0,r._)([(0,p.MZ)()],$.prototype,"rasterJobHandler",null),(0,r._)([(0,p.MZ)({readOnly:!0})],$.prototype,"rasterId",null),(0,r._)([(0,p.MZ)(_.OZ)],$.prototype,"url",null),(0,r._)([(0,p.MZ)({type:String,json:{write:!0}})],$.prototype,"datasetName",void 0),(0,r._)([(0,p.MZ)({type:String,json:{write:!0}})],$.prototype,"datasetFormat",void 0),(0,r._)([(0,p.MZ)()],$.prototype,"hasUniqueSourceStorageInfo",void 0),(0,r._)([(0,p.MZ)()],$.prototype,"rasterInfo",void 0),(0,r._)([(0,p.MZ)()],$.prototype,"ioConfig",void 0),(0,r._)([(0,p.MZ)()],$.prototype,"sourceJSON",void 0),$=(0,r._)([(0,d.$)("esri.layers.support.rasterDatasets.BaseRaster")],$);const K=$;var Y=n(67090),X=n(51084);let Q=class extends K{constructor(){super(...arguments),this.datasetFormat="Function",this.tileType="Raster",this.rasterFunction=null,this._clippingGeometry=new Map}async fetchPixels(e,t,n,r={}){const{rasters:i,rasterIds:s}=this.primaryRasters;let o=!1;const{interpolation:a}=r,l=this.rasterFunction.flatWebGLFunctionChain?.hasFocalFunction;!r.requestRawData&&l&&(o=1===i.length&&!r.skipRasterFunction,r={...r,interpolation:"bilinear",requestRawData:o});const u=i.map((i=>i.fetchPixels(e,t,n,r))),c=await Promise.all(u),p=c.map((e=>e.pixelBlock)),h=o||r.requestRawData?c.map((e=>e.srcTilePixelSize)):null;if(r.skipRasterFunction||p.every((e=>null==e)))return c[0];const f=c.find((e=>null!=e.pixelBlock))?.extent??e;let d=this.rasterJobHandler?await this.rasterJobHandler.process({extent:f,primaryPixelBlocks:p,primaryPixelSizes:h,primaryRasterIds:s}):this.rasterFunction.process({extent:f,primaryPixelBlocks:p,primaryPixelSizes:h,primaryRasterIds:s});const{transformGrid:m}=c[0];if(!o||null==d||null==m){const e=r.noClip?null:this.getClippingGeometry(f.spatialReference);return r.noClip||r.requestRawData||null==d||!e||(d=await(0,Y.$Q)(d,f,e)),{...c[0],pixelBlock:d}}const y={rows:m.spacing[0],cols:m.spacing[1]};let g;g=this.rasterJobHandler?(await this.rasterJobHandler.mosaicAndTransform({srcPixelBlocks:[d],srcMosaicSize:{width:d.width,height:d.height},destDimension:{width:t,height:n},coefs:m.coefficients,sampleSpacing:y,projectDirections:!1,gcsGrid:null,isUV:!1,interpolation:a,alignmentInfo:void 0,blockWidths:null},r)).pixelBlock:(0,Z.$i)(d,{width:t,height:n},m.coefficients,y,a);const w=r.noClip?null:this.getClippingGeometry(e.spatialReference);return r.noClip||r.requestRawData||null==g||null==w||(g=await(0,Y.$Q)(g,e,w)),{extent:e,srcExtent:c[0].srcExtent,pixelBlock:g}}getClippingGeometry(e){const t=this._clippingGeometry.get("0");if(!e||!t)return t;const n=function(e){return String(e.wkid??e.wkt??e.wkt2)}(e);let r=this._clippingGeometry.get(n);return null!=r||(r=e.equals(t.spatialReference)?t:(0,U.uk)(t,e),this._clippingGeometry.set(n,r)),r}async _open(e){const{rasterFunction:t}=this;this.primaryRasters?.rasters?.length?t.sourceRasters=this.primaryRasters.rasters:(this.primaryRasters=t.getPrimaryRasters(),this.rasterJobHandler&&this.primaryRasters.rasters?.forEach((e=>e.rasterJobHandler=this.rasterJobHandler)));const{rasters:n,rasterIds:r}=this.primaryRasters,i=n.map((t=>t.rasterInfo?void 0:t.open(e)));await Promise.all(i);const s=n.map((({rasterInfo:e})=>e)),a=t.bind({rasterInfos:s,rasterIds:r});if(t.rawSourceRasterInfos=s,!a.success||0===s.length)throw new o.A("raster-function:open",`cannot bind the function: ${a.error??""}`);const l="Table"===t.functionName?t:t.functionArguments?.raster;"Table"===l?.functionName&&(t.rasterInfo.attributeTable=X.A.fromJSON(l.functionArguments.attributeTableAsRecordSet)),await this.syncJobHandler();const u=s[0];this.hasUniqueSourceStorageInfo=1===s.length||s.slice(1).every((e=>function(e,t){const{storageInfo:n,pixelSize:r,spatialReference:i,extent:s}=e,{storageInfo:o,pixelSize:a,spatialReference:l,extent:u}=t;return r.x===a.x&&r.y===a.y&&i.equals(l)&&s.equals(u)&&n.blockHeight===o.blockHeight&&n.blockWidth===o.blockWidth&&n.maximumPyramidLevel===o.maximumPyramidLevel}(e,u))),this.set("sourceJSON",n[0].sourceJSON),this.set("rasterInfo",t.rasterInfo),await this._updateClipGeometry()}async syncJobHandler(){return this.rasterJobHandler?.updateRasterFunction(this.rasterFunction)}async _updateClipGeometry(){const e=this.rasterFunction.getClippingGeometries()[0];let t=e?.clippingGeometry;if(t&&"inside"===e.clippingType){const{extent:e}=this.rasterInfo,{difference:r,densify:i}=await n.e(5418).then(n.bind(n,22162));let s=i(D.A.fromExtent(e),2*(e.width+e.height)/40);s=(0,U.uk)(s,t.spatialReference),t=r(s,t)}this._clippingGeometry.clear(),t&&this._clippingGeometry.set("0",t)}};(0,r._)([(0,p.MZ)({type:String,json:{write:!0}})],Q.prototype,"datasetFormat",void 0),(0,r._)([(0,p.MZ)()],Q.prototype,"tileType",void 0),(0,r._)([(0,p.MZ)()],Q.prototype,"rasterFunction",void 0),(0,r._)([(0,p.MZ)()],Q.prototype,"primaryRasters",void 0),Q=(0,r._)([(0,d.$)("esri.layers.support.rasterDatasets.FunctionRaster")],Q);const ee=Q;var te=n(56991),ne=n(72567),re=n(41262),ie=n(31233),se=n(78263),oe=n(20106);const ae=e=>{let t=class extends e{constructor(...e){super(...e),this._isConstructedFromFunctionRaster=!1,this._rasterJobHandler={instance:null,refCount:0,connectionPromise:null},this.bandIds=null,this.copyright=null,this.interpolation=null,this.multidimensionalSubset=null,this.raster=null,this.serviceRasterInfo=null,this.sourceJSON=null,this.spatialReference=null,this.symbolizer=null,this._isConstructedFromFunctionRaster="Function"===e[0]?.raster?.datasetFormat}get fullExtent(){return this.serviceRasterInfo?.extent}set multidimensionalDefinition(e){this._set("multidimensionalDefinition",e),this.updateRenderer()}set rasterFunction(e){"none"===e?.functionName?.toLowerCase()&&(e=void 0),this._set("rasterFunction",e),this.updateRasterFunction()}get rasterInfo(){return(0,x.Lx)(a.A.getLogger(this),"rasterInfo",{replacement:"serviceRasterInfo",version:"4.29",warnOnce:!0}),this._get("serviceRasterInfo")}set url(e){this._set("url",(0,S.Jf)(e,a.A.getLogger(this)))}get renderer(){if("imagery-tile"!==this.type)return this.internalRenderer;const{activePresetRendererName:e,presetRenderers:t}=this;if(e){const n=t?.find((({name:t})=>t===e));return n?.renderer.clone()}return this.internalRenderer}set renderer(e){"imagery-tile"===this.type&&(this.activePresetRendererName=null),this.internalRenderer=e}set internalRenderer(e){null==e&&null==this.rasterFunction?this._configDefaultRenderer("override"):(this._set("internalRenderer",e),this.updateRenderer())}readRenderer(e,t,n){const r=t?.layerDefinition?.drawingInfo?.renderer;return(0,b.LF)(r,n)||void 0}async convertVectorFieldData(e,t){const{serviceRasterInfo:n}=this;if(null==e||!n)return null;const r=this._rasterJobHandler.instance,i=n.dataType;return r?r.convertVectorFieldData({pixelBlock:e,dataType:i},t):(0,V.FI)(e,i)}async computeStatisticsHistograms(e,t){await this.load(t),e=(0,h.PZ)(se.A,e).clone();const{serviceRasterInfo:n}=this;if(null==n)throw new o.A("imagery-tile-mixin:compute-statistics-histograms","serviceRasterInfo must be specified");const{geometry:r}=e;if(null==r)throw new o.A("imagery-tile-mixin:compute-statistics-histograms","geometry must be specified");let i=r;const{spatialReference:s}=n;r.spatialReference.equals(s)||(await(0,U.Hh)(),i="extent"===r.type?(0,U._l)(r,s):(0,U.uk)(r,s));const a=e.pixelSize??new H.default({x:n.pixelSize.x,y:n.pixelSize.y,spatialReference:s}),{extent:l,width:u,height:c}=(0,Y.b7)(n,i,a),p=await this.fetchPixels(l,u,c,{...t,interpolation:"nearest"});if(null==p.pixelBlock)throw new o.A("imagery-tile-mixin:compute-statistics-histograms","failed to fetch pixels");const f=await(0,Y.$Q)(p.pixelBlock,l,i),d=this._rasterJobHandler.instance;return d?d.computeStatisticsHistograms({pixelBlock:f},t):(0,ne.eH)(f)}async createFlowMesh(e,t){const n=this._rasterJobHandler.instance;return n?n.createFlowMesh(e,t):(0,oe.CW)(e.meshType,e.simulationSettings,e.flowData,null!=t.signal?t.signal:(new AbortController).signal)}normalizeRasterFetchOptions(e){const{multidimensionalInfo:t}=this.serviceRasterInfo??{};if(null==t)return e;let n=e.multidimensionalDefinition||this.multidimensionalDefinition;n?.length||(n=(0,O.fy)(this.raster.rasterInfo,{multidimensionalSubset:this.multidimensionalSubset}));const r=e.timeExtent||this.timeExtent;if(null!=n&&null!=r&&(null!=r.start||null!=r.end)){n=n.map((e=>e.clone()));const i=t.variables.find((({name:e})=>e===n[0].variableName))?.dimensions?.find((({name:e})=>"StdTime"===e)),s=n.find((({dimensionName:e})=>"StdTime"===e));if(!i||!s)return{...e,multidimensionalDefinition:null};const{start:o,end:a}=r,l=null==o?null:o.getTime(),u=null==a?null:a.getTime(),c=l??u,p=u??l;if(null!=i.values){const e=i.values.filter((e=>{if(Array.isArray(e)){if(c===p)return e[0]<=c&&e[1]>=c;const t=e[0]<=c&&e[1]>c||e[0]<p&&e[1]>=p,n=e[0]>=c&&e[1]<=p||e[0]<c&&e[1]>p;return t||n}return c===p?e===c:e>=c&&e<=p}));if(e.length){const t=e.sort(((e,t)=>{const n=Array.isArray(e)?e[0]:e,r=Array.isArray(e)?e[1]:e,i=Array.isArray(t)?t[0]:t,s=Array.isArray(t)?t[1]:t;return c===p?n-i:Math.abs(r-p)-Math.abs(s-p)}))[0];s.values=[t]}else n=null}else if(i.hasRegularIntervals&&i.extent){const[e,t]=i.extent;c>t||p<e?n=null:s.values=c===p?[c]:[Math.max(e,c),Math.min(t,p)]}}return null!=n&&(0,O.sx)(n,this.multidimensionalSubset)?{...e,multidimensionalDefinition:null}:{...e,multidimensionalDefinition:n}}async updateRasterFunction(){if(!this.loaded||"imagery-tile"!==this.type||!this.rasterFunction&&!this._cachedRasterFunctionJson||JSON.stringify(this.rasterFunction)===JSON.stringify(this._cachedRasterFunctionJson))return;if(this._isConstructedFromFunctionRaster&&"Function"===this.raster.datasetFormat){const e=this.raster.rasterFunction.toJSON();return!this.rasterFunction&&e&&this._set("rasterFunction",R.A.fromJSON(e)),void(this._cachedRasterFunctionJson=this.rasterFunction?.toJSON())}let e,t=this.raster,n=!1;"Function"===t.datasetFormat?(e=t.primaryRasters.rasters,t=e[0],n=!0):e=[t];const{rasterFunction:r}=this;if(r){const n={raster:t};e.length>1&&e.forEach((e=>n[e.url]=e));const i=(0,te.vt)(r.functionDefinition?.toJSON()??r.toJSON(),n),s=new ee({rasterFunction:i});s.rasterJobHandler=this._rasterJobHandler.instance,await s.open(),this._cachedRasterFunctionJson=this.rasterFunction?.toJSON(),this.raster=s}else this.raster=t,this._cachedRasterFunctionJson=null,await t.open();if(this._cachedRendererJson=null,!n&&!r)return;const{bandIds:i}=this,{bandCount:s}=this.raster.rasterInfo,o=i?.length?i.some((e=>e>=s)):s>=3;i&&(o||this.renderer&&"raster-stretch"!==this.renderer.type)&&this._set("bandIds",null),this._configDefaultRenderer("auto")}async updateRenderer(){const{loaded:e,symbolizer:t}=this;if(!e||!t||!this.renderer)return;const{rasterInfo:n}=this.raster,r=(0,O.ct)(n,{multidimensionalDefinition:this.multidimensionalDefinition,multidimensionalSubset:this.multidimensionalSubset}),i=r?.name,s=(0,re.$P)({...this.renderer.toJSON(),variableName:i});if(JSON.stringify(this._cachedRendererJson)===JSON.stringify(s))return;const o=this._rasterJobHandler.instance;o&&(t.rasterInfo=(0,re.m7)(n,i),t.rendererJSON=s,t.bind(),await o.updateSymbolizer(t),this._cachedRendererJson=s)}async applyRenderer(e,t){const n=e?.pixelBlock;if(!(null!=n&&n.pixels&&n.pixels.length>0))return null;let r;await this.updateRenderer();const i=this._rasterJobHandler.instance,s=this.bandIds??[];return r=i?await i.symbolize({...e,simpleStretchParams:t,bandIds:s}):this.symbolizer.symbolize({...e,simpleStretchParams:t,bandIds:s}),r}getTileUrl(e,t,n){return"RasterTileServer"===this.raster.datasetFormat?`${this.url}/tile/${e}/${t}/${n}`:""}getCompatibleTileInfo(e,t,n=!1){if(!this.loaded||null==t)return null;if(n&&e.equals(this.spatialReference))return this.tileInfo;const r=(0,I.Vp)(e);return N.default.create({size:256,spatialReference:e,origin:r?{x:r.origin[0],y:r.origin[1]}:{x:t.xmin,y:t.ymax}})}getCompatibleFullExtent(e){return this.loaded?(this._compatibleFullExtent?.spatialReference.equals(e)||(this._compatibleFullExtent=this.raster.computeExtent(e)),this._compatibleFullExtent):null}async fetchTile(e,t,r,i={}){if(n(this),i.requestAsImageElement){const n=this.getTileUrl(e,t,r);return(0,v.A)(n,{responseType:"image",query:{...this.refreshParameters,...this.raster.ioConfig.customFetchParameters},signal:i.signal}).then((e=>e.data))}const{serviceRasterInfo:s}=this;if(null!=s.multidimensionalInfo&&null==(i=this.normalizeRasterFetchOptions(i)).multidimensionalDefinition){const n=i.tileInfo||s.storageInfo.tileInfo;return{extent:this.raster.getTileExtentFromTileInfo(e,t,r,n),pixelBlock:null}}return await this._initJobHandler(),await this.updateRasterFunction(),"raster-shaded-relief"===this.renderer?.type&&(i={...i,buffer:{cols:1,rows:1}}),this.raster.fetchTile(e,t,r,i)}async fetchPixels(e,t,n,r={}){return null!=this.serviceRasterInfo.multidimensionalInfo&&null==(r=this.normalizeRasterFetchOptions(r)).multidimensionalDefinition?{extent:e,pixelBlock:null}:(await this._initJobHandler(),await this.updateRasterFunction(),t=Math.round(t),n=Math.round(n),this.raster.fetchPixels(e,t,n,r))}async identify(e,t={}){await this.load();const{raster:n,serviceRasterInfo:r}=this;if(null!=r?.multidimensionalInfo&&!(r.hasMultidimensionalTranspose&&((0,O.DY)(t.multidimensionalDefinition)||t.transposedVariableName||t.timeExtent)||null!=(t=this.normalizeRasterFetchOptions(t)).multidimensionalDefinition))return{location:e,value:null};const i=this.multidimensionalSubset?.areaOfInterest;if(i&&!i.contains(e))throw new o.A("imagery-tile-mixin:identify","the request cannot be fulfilled when falling outside of the multidimensional subset");return n.identify(e,t)}increaseRasterJobHandlerUsage(){this._rasterJobHandler.refCount++}decreaseRasterJobHandlerUsage(){this._rasterJobHandler.refCount--,this._rasterJobHandler.refCount<=0&&this._shutdownJobHandler()}hasStandardTime(){const e=this.serviceRasterInfo?.multidimensionalInfo;if(null==e||"standard-time"!==this.serviceRasterInfo?.dataType)return!1;const t=this.multidimensionalDefinition,n=t?.[0]?.variableName;return e.variables.some((e=>e.name===n&&(!t?.[0].dimensionName||e.dimensions.some((e=>"StdTime"===e.name)))))}getStandardTimeValue(e){return new Date(24*(e-25569)*3600*1e3).toString()}getMultidimensionalSubsetVariables(e){const t=e??this.serviceRasterInfo?.multidimensionalInfo;return(0,O.z2)(this.multidimensionalSubset,t)}_configDefaultSettings(){this._configDefaultInterpolation(),this.multidimensionalDefinition||(this.multidimensionalDefinition=(0,O.fy)(this.raster.rasterInfo,{multidimensionalSubset:this.multidimensionalSubset})),this.rasterFunction&&"Function"===this.raster.datasetFormat&&(this._cachedRasterFunctionJson=this.rasterFunction.toJSON()),this._configDefaultRenderer()}_initJobHandler(){if(null!=this._rasterJobHandler.connectionPromise)return this._rasterJobHandler.connectionPromise;const e=new P.A;return this._rasterJobHandler.connectionPromise=e.initialize().then((async()=>{n(this),this._rasterJobHandler.instance=e,this.raster.rasterJobHandler=e,"Function"===this.raster.datasetFormat&&this.raster.syncJobHandler(),this.rasterFunction&&await this.updateRasterFunction().catch((()=>{})),this.renderer&&this.updateRenderer()})).catch((()=>{})),this._rasterJobHandler.connectionPromise}_shutdownJobHandler(){this._rasterJobHandler.instance&&this._rasterJobHandler.instance.destroy(),this._rasterJobHandler.instance=null,this._rasterJobHandler.connectionPromise=null,this._rasterJobHandler.refCount=0,this._cachedRendererJson=null,this.raster&&(this.raster.rasterJobHandler=null)}_configDefaultInterpolation(){if(null==this.interpolation){n(this);const{raster:e}=this,t=(0,re.w6)(e.rasterInfo,e.tileType,this.sourceJSON?.defaultResamplingMethod);this._set("interpolation",t)}}_configDefaultRenderer(e="no"){n(this);const{rasterInfo:t}=this.raster,r=(0,O.ct)(t,{multidimensionalDefinition:this.multidimensionalDefinition,multidimensionalSubset:this.multidimensionalSubset}),i=r?.name,s=(0,re.I8)({variableName:i,rasterFunctionName:this.rasterFunction?.functionName,presetRenderers:this.presetRenderers});if(!this.bandIds&&t.bandCount>1&&(this.bandIds=s?.bandIds??(0,re.ci)(t)),!this.renderer||"override"===e){const e=(0,re.Mm)(this.raster),n=s?.renderer??(0,re.PD)(t,{bandIds:this.bandIds,variableName:i,rasterFunctionColorRamp:e}),r=t.statistics,o=r&&r.length>0?r[0]:null,a=o?.max??0,l=o?.min??0;"WCSServer"===this.raster.datasetFormat&&"raster-stretch"===n.type&&(a>1e24||l<-1e24)&&(n.dynamicRangeAdjustment=!0,n.customStatistics=null,"none"===n.stretchType&&(n.stretchType="min-max")),this.renderer=n}const o=(0,re.$P)({...this.renderer.toJSON(),variableName:i}),l=(0,re.m7)(t,i);this.symbolizer?(this.symbolizer.rendererJSON=o,this.symbolizer.rasterInfo=l):this.symbolizer=new ie.A({rendererJSON:o,rasterInfo:l});const u=this.symbolizer.bind();if(u.success){if("auto"===e){const{colormap:e}=this.raster.rasterInfo,t=this.renderer;if(null!=e&&"raster-colormap"===t.type){const e=(0,re.PD)(this.raster.rasterInfo);JSON.stringify(e)!==JSON.stringify(t)&&this._configDefaultRenderer("override")}else if("raster-stretch"===t.type){const e=this.bandIds?.length,n=t.customStatistics?.length;!t.dynamicRangeAdjustment&&n&&e&&n!==e&&this._configDefaultRenderer("override")}}}else a.A.getLogger(this).warn("imagery-tile-mixin",u.error||"The given renderer is not supported by the layer."),"auto"===e&&this._configDefaultRenderer("override")}};function n(e){if(!e.raster||!e.serviceRasterInfo)throw new o.A("imagery-tile","no raster")}return(0,r._)([(0,p.MZ)({clonable:!1})],t.prototype,"_cachedRendererJson",void 0),(0,r._)([(0,p.MZ)({clonable:!1})],t.prototype,"_cachedRasterFunctionJson",void 0),(0,r._)([(0,p.MZ)({clonable:!1})],t.prototype,"_compatibleFullExtent",void 0),(0,r._)([(0,p.MZ)({clonable:!1})],t.prototype,"_isConstructedFromFunctionRaster",void 0),(0,r._)([(0,p.MZ)({clonable:!1})],t.prototype,"_rasterJobHandler",void 0),(0,r._)([(0,p.MZ)({type:[h.jz],json:{write:{overridePolicy(){return{enabled:!this.loaded||"Raster"===this.raster.tileType||"0,1,2"!==this.bandIds?.join(",")}}}}})],t.prototype,"bandIds",void 0),(0,r._)([(0,p.MZ)({json:{origins:{service:{read:{source:"copyrightText"}}}}})],t.prototype,"copyright",void 0),(0,r._)([(0,p.MZ)({json:{read:!1}})],t.prototype,"fullExtent",null),(0,r._)([(0,p.MZ)({json:{write:{overridePolicy(){return{enabled:!this.loaded||"Raster"===this.raster.tileType||"bilinear"!==this.interpolation}}}}}),(0,M.e)(k.SZ)],t.prototype,"interpolation",void 0),(0,r._)([(0,p.MZ)()],t.prototype,"ioConfig",void 0),(0,r._)([(0,p.MZ)({type:[C.A],json:{write:!0}})],t.prototype,"multidimensionalDefinition",null),(0,r._)([(0,p.MZ)({type:T.A,json:{write:!0}})],t.prototype,"multidimensionalSubset",void 0),(0,r._)([(0,p.MZ)()],t.prototype,"raster",void 0),(0,r._)([(0,p.MZ)({type:R.A,json:{name:"renderingRule",write:!0}})],t.prototype,"rasterFunction",null),(0,r._)([(0,p.MZ)({readOnly:!0})],t.prototype,"rasterInfo",null),(0,r._)([(0,p.MZ)()],t.prototype,"serviceRasterInfo",void 0),(0,r._)([(0,p.MZ)()],t.prototype,"sourceJSON",void 0),(0,r._)([(0,p.MZ)({readOnly:!0,type:J.A,json:{read:!1}})],t.prototype,"spatialReference",void 0),(0,r._)([(0,p.MZ)({type:N.default})],t.prototype,"tileInfo",void 0),(0,r._)([(0,p.MZ)(_.OZ)],t.prototype,"url",null),(0,r._)([(0,p.MZ)()],t.prototype,"renderer",null),(0,r._)([(0,p.MZ)({types:b.uy,json:{name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy(){const e="raster-stretch"===this.renderer?.type&&"none"===this.renderer.stretchType&&!this.renderer.useGamma;return{enabled:!this.loaded||"Raster"===this.raster.tileType||!e}}},origins:{"web-scene":{types:b.Gj,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:e=>({enabled:e&&"vector-field"!==e.type&&"flow"!==e.type})}}}}})],t.prototype,"internalRenderer",null),(0,r._)([(0,A.w)("internalRenderer")],t.prototype,"readRenderer",null),(0,r._)([(0,p.MZ)({clonable:!1})],t.prototype,"symbolizer",void 0),t=(0,r._)([(0,d.$)("esri.layers.mixins.ImageryTileMixin")],t),t};var le=n(92078),ue=n(61380),ce=n(28366),pe=n(70652),he=n(18195),fe=n(85924),de=n(56740),me=n(52874),ye=n(22739),ge=n(21327);function we(e){return["x","e","east","long","longitude"].includes(e.toLowerCase())}function be(e){return["y","n","west","lat","latitude"].includes(e.toLowerCase())}function ve(e){const{axes:t}=e.domain,n=Object.keys(t),r=[],i=[];let s=-1,o=-1,a=[];for(let e=0;e<n.length;e++){const l=n[e];we(l)?s=e:be(l)&&(o=e);const u=t[l],c=[];if("values"in u){u.values.forEach((e=>c.push("string"==typeof e?new Date(e).getTime():e)));const e=c[1]-c[0];r.push([c[0]-.5*e,c[c.length-1]+.5*e]),i.push(e)}else{const{start:e,stop:t,num:n}=u,s=(t-e)/(n-1);r.push([e-.5*s,t+.5*s]),i.push(s);for(let t=0;t<n;t++)c.push(e+s*t)}a.push({name:l,values:c,extent:[c[0],c[c.length-1]]})}s>-1&&-1===o?o=0===s?1:0:o>-1&&-1===s?s=0===o?1:0:-1===o&&-1===s&&(s=0,o=1),a=a.filter(((e,t)=>!(t===s||t===o)));const{referencing:l}=e.domain,u=l.find((e=>e.coordinates.includes(n[s]))).system.id,c=u?.slice(u.lastIndexOf("/")+1),p=null==c||"CRS84"===c?4326:Number(c),h=new J.A({wkid:p}),[f,d]=r[s],[m,y]=r[o],g=new W.default({xmin:f,xmax:d,ymin:m,ymax:y,spatialReference:h});return{width:Math.round(g.width/i[s]),height:Math.round(g.height/i[o]),extent:g,dimensions:a}}function xe(e){const t=(0,ye.Z0)();return t?e[t]??Object.values(e)[0]:Object.values(e)[0]}function Me(){return Math.round(255*Math.random())}function Ae(e){let t=Number.MAX_VALUE,n=-Number.MAX_VALUE;for(let r=0;r<e.length;r++){const i=e[r];null!=i&&(i<t&&(t=i),i>n&&(n=i))}return(0,j.X1)(t,n)}function Ie(e,t,n){const r=e.map(((e,n)=>({name:e,count:t[n]}))).sort(((e,t)=>e.name>t.name?-1:1)),i=(s=1,e=>s*=e.count);var s;const o=[...r.slice(1),{name:"",count:1}].reverse().map(i).reverse();let a=0;for(let i=e.length-1;i>=0;i--)a+=o[r.findIndex((({name:t})=>t===e[i]))]*(n%t[i]),n=Math.floor(n/t[i]);return a}var Se=n(98521);let _e=class extends K{constructor(){super(...arguments),this.datasetFormat="MEMORY",this.source=null}get url(){return""}fetchRawTile(e,t,n,r={}){if(!this._pixelBlockTiles){const{rasterInfo:i}=this,[s,o]=i.storageInfo.tileInfo.size,{sliceId:a}=r,{pixelBlocks:l}=this.source,u={pixelBlock:null==a?l[0]:l[a],useBilinear:"thematic"!==i.dataType,tileSize:{width:s,height:o},level:e,row:t,col:n},c=this.rasterJobHandler?this.rasterJobHandler.clipTile(u,r):(0,Z.J$)(u);return Promise.resolve(c)}const i=this._pixelBlockTiles.get(`${e}/${t}/${n}`);return Promise.resolve(i)}async _open(e){const t=this.source,{pixelBlocks:n,attributeTable:r,statistics:i,histograms:s,name:o,nativeExtent:a,transform:l}=t,u=n[0],{width:c,height:p,pixelType:h}=u,f=t.extent??new W.default({xmin:-.5,ymin:.5,xmax:c-.5,ymax:p-.5,spatialReference:new J.A({wkid:3857})}),d=t.isPseudoSpatialReference??!t.extent,m={x:f.width/c,y:f.height/p},y={...t.keyProperties};r&&(y.DataType="Thematic");const g=new Se.A({width:c,height:p,pixelType:h,extent:f,nativeExtent:a,attributeTable:r,transform:l,pixelSize:m,spatialReference:f.spatialReference,bandCount:u.pixels.length,keyProperties:y,multidimensionalInfo:t.multidimensionalInfo,statistics:i,isPseudoSpatialReference:d,histograms:s});this.ioConfig.skipMapInfo&&this.updateImageSpaceRasterInfo(g),this.createRemoteDatasetStorageInfo(g,512,512),this._set("rasterInfo",g),this.updateTileInfo(),g.multidimensionalInfo?await this._buildMDimStats(t.pixelBlocks,g.multidimensionalInfo):await this._buildInMemoryRaster(u,{width:512,height:512},e),g.multidimensionalInfo||(this.source=null),this.datasetName=o}async _buildInMemoryRaster(e,t,n){const{rasterInfo:r}=this,i=r.storageInfo.maximumPyramidLevel??0,s="thematic"!==r.dataType,a=this.rasterJobHandler?this.rasterJobHandler.split({pixelBlock:e,tileSize:t,maximumPyramidLevel:i,useBilinear:s},n):Promise.resolve((0,Z.lD)(e,t,i,s)),l=null!=r.statistics,c=null!=r.histograms,p=this.ioConfig.skipStatistics||l?Promise.resolve({statistics:null,histograms:null}):this.rasterJobHandler?this.rasterJobHandler.estimateStatisticsHistograms({pixelBlock:e},n):Promise.resolve((0,ne.f4)(e)),h=await(0,u.Lx)([a,p]);if(!h[0].value&&h[1].value)throw new o.A("inmemory-raster:open","failed to build in memory raster");this._pixelBlockTiles=h[0].value,l||(r.statistics=h[1].value?.statistics),c||(r.histograms=h[1].value?.histograms)}async _buildMDimStats(e,t,n){for(let r=0;r<t.variables.length;r++){const i=t.variables[r];if(i.statistics)continue;const s=i.dimensions.map((e=>new C.A({variableName:i.name,dimensionName:e.name,values:[e.values?.[0]??e.extent?.[0]],isSlice:!0}))),o=(0,O.NG)(s,t),a=null==o?null:e[o];if(null==a)continue;const l=this.rasterJobHandler?await this.rasterJobHandler.computeStatisticsHistograms({pixelBlock:a},n):(0,ne.eH)(a);i.statistics=l.statistics,i.histograms||(i.histograms=l.histograms)}}};(0,r._)([(0,p.MZ)({type:String,json:{write:!0}})],_e.prototype,"datasetFormat",void 0),(0,r._)([(0,p.MZ)()],_e.prototype,"source",void 0),(0,r._)([(0,p.MZ)()],_e.prototype,"url",null),_e=(0,r._)([(0,d.$)("esri.layers.support.rasterDatasets.InMemoryRaster")],_e);const Ce=_e;let Te=class extends K{constructor(){super(...arguments),this.datasetFormat="CovJSON"}fetchRawTile(e,t,n,r={}){return this._inMemoryRaster.fetchRawTile(e,t,n,r)}async _open(e){const{extent:t,pixelBlocks:n,multidimensionalInfo:r,attributeTable:i,bandNames:s}=await this._fetchData(e),{statistics:o,histograms:a}=(0,ne.eH)(n[0]),l=s?.map((e=>({BandName:e}))),u={DataType:i?"Thematic":r?"Scientific":"Generic",BandProperties:l},c=new Ce({source:{extent:t,pixelBlocks:n,attributeTable:i?X.A.fromJSON(i):null,multidimensionalInfo:r,statistics:o,histograms:a,keyProperties:u,isPseudoSpatialReference:!1}});await c.open(),this._inMemoryRaster=c;const p=this.source?"":this.url.slice(this.url.lastIndexOf("/")+1);this._set("datasetName",p.slice(0,p.indexOf("."))),this._set("rasterInfo",c.rasterInfo)}async _fetchData(e){const t=this.source??(await this.request(this.url,{signal:e?.signal})).data,n="imagery-tile-layer:open-coverage-json";if("coverage"!==t.type?.toLowerCase()||"grid"!==t.domain?.domainType?.toLowerCase())throw new o.A(n,"Only coverage with Grid domain type is supported");if(!t.ranges)throw new o.A(n,"Missing ranges in the grid coverage data");if(!t.domain.referencing?.length)throw new o.A(n,"Missing domain referencing in the grid coverage data");const r=Object.values(t.ranges);for(let e=0;e<r.length;e++){const{axisNames:t,shape:i,type:s,values:a}=r[e];if(!("ndarray"===s.toLowerCase()&&a?.length&&t?.length&&i?.length))throw new o.A(n,"Only ranges with valid NdArray, axisNames, shape, and inline values are supported");if(!we(t[t.length-1])||!be(t[t.length-2]))throw new o.A(n,"Only row-major ordered pixel values are supported. X axis must be the last axis.")}return function(e){const{width:t,height:n,extent:r,dimensions:i}=ve(e),{ranges:s}=e,o=Object.keys(s).sort(((e,t)=>e<t?-1:1)),a=[];for(let e=0;e<o.length;e++){const t=o[e];i?.length&&a.push({name:t,dimensions:i})}const l=function(e){const t={},{parameters:n}=e;if(!n)return t;for(const[e,r]of Object.entries(n)){const{type:n,description:i,unit:s,categoryEncoding:o,observedProperty:a}=r;if("Parameter"===n&&(t[e]={},i&&(t[e].description=xe(i)),s&&(t[e].unit=s.label?xe(s.label):null,t[e].symbol=s.symbol?.value),o)){const n=Object.entries(o).map(((e,t)=>({OID:t,Value:Number(e[1]),ClassName:e[0].slice(e[0].lastIndexOf("/")+1),Count:1})));let r=!1;a?.categories?.length&&(a.categories.forEach((e=>{if(!e.id)return;const t=e.id.slice(e.id.lastIndexOf("/")+1),i=n.find((e=>e.ClassName===t));if(!i)return;const s=e.label?xe(e.label):null;if(i.Label=s,e.preferredColor){const t=me.A.fromHex(e.preferredColor);t&&(r=!0,i.Red=t.r,i.Green=t.g,i.Blue=t.b)}})),r&&n.forEach((e=>{null==e.Red&&(e.Red=Me(),e.Green=Me(),e.Blue=Me())})));const i={objectIdFieldName:"",fields:[{name:"OID",type:"esriFieldTypeOID",alias:"OID",domain:null},{name:"Value",type:"esriFieldTypeInteger",alias:"Value",domain:null},{name:"Count",type:"esriFieldTypeDouble",alias:"Count",domain:null},{name:"ClassName",type:"esriFieldTypeString",alias:"ClassName",domain:null,length:50},{name:"Label",type:"esriFieldTypeString",alias:"Label",domain:null,length:50}],features:n.map((e=>({attributes:e})))};r&&i.fields.push({name:"Red",type:"esriFieldTypeInteger",alias:"Red",domain:null},{name:"Green",type:"esriFieldTypeInteger",alias:"Green",domain:null},{name:"Blue",type:"esriFieldTypeInteger",alias:"Blue",domain:null}),t[e].attributeTable=i}}return t}(e);a.forEach((e=>l[e.name]&&Object.assign(e,l[e.name])));const u=a.length?{variables:a}:void 0,c=[];for(let e=0;e<o.length;e++){const r=o[e],{values:a,dataType:l,axisNames:u,shape:p}=s[r],h=p.length>2?e*p.slice(0,-2).reduce(((e,t)=>e*t)):0,f=u.slice(0,-2),d=p.slice(0,-2),m="float"===l?"f32":Ae(a),y=t*n,g=a.length/y;for(let r=0;r<g;r++){const s=ge.A.createEmptyBand(m,y),o=new Uint8Array(y).fill(255);let l=!1;const u=r*y;for(let e=0;e<y;e++){const t=a[u+e];null==t?(o[e]=0,l=!0):s[e]=t}if(0===e||i?.length){const e=new ge.A({width:t,height:n,mask:l?o:null,pixels:[s],pixelType:m});e.updateStatistics(),i?.length?c[Ie(f,d,r)+h]=e:c.push(e)}else{const e=c[r];e.pixels.push(s),l?e.mask&&(e.mask=ge.A.combineBandMasks([e.mask,o])):e.mask=l?o:null}}}const p=Object.values(l).find((e=>e.attributeTable))?.attributeTable;return{extent:r,pixelBlocks:c,multidimensionalInfo:u,attributeTable:p,bandNames:u?void 0:o}}(t)}};(0,r._)([(0,p.MZ)({type:String,json:{write:!0}})],Te.prototype,"datasetFormat",void 0),(0,r._)([(0,p.MZ)({constructOnly:!0})],Te.prototype,"source",void 0),Te=(0,r._)([(0,d.$)("esri.layers.support.rasterDatasets.CovJSONRaster")],Te);const ke=Te;var Re=n(50659);function Pe(e,t){if(!e||!t)return[];let n=t;t.includes("/")?(n=t.slice(0,t.indexOf("/")),t=t.slice(t.indexOf("/")+1)):t="";const r=[];if(t){const i=Pe(e,n);for(let e=0;e<i.length;e++)Pe(i[e],t).forEach((e=>r.push(e)));return r}const i=e.getElementsByTagNameNS("*",n);if(!i||0===i.length)return[];for(let e=0;e<i.length;e++)r.push(i[e]||i.item(e));return r}function Ne(e,t){if(!e||!t)return null;let n=t;t.includes("/")?(n=t.slice(0,t.indexOf("/")),t=t.slice(t.indexOf("/")+1)):t="";const r=Pe(e,n);return r.length>0?t?Ne(r[0],t):r[0]:null}function De(e,t=null){const n=t?Ne(e,t):e;let r;return n?(r=n.textContent||n.nodeValue,r?r.trim():null):null}function Ee(e,t){return function(e,t){const n=Pe(e,t),r=[];let i;for(let e=0;e<n.length;e++)i=n[e].textContent||n[e].nodeValue,i&&(i=i.trim(),""!==i&&r.push(i));return r}(e,t).map((e=>Number(e)))}function Le(e,t){const n=De(e,t);return Number(n)}function Fe(e,t){const n=e?.nodeName?.toLowerCase(),r=t.toLowerCase();return n.slice(n.lastIndexOf(":")+1)===r}var Oe=n(85307);function ze(e,t){if(!e||!t)return null;const n=[];for(let r=0;r<e.length;r++)n.push(e[r]),n.push(t[r]);return n}function je(e){if(!e)return null;let t=Number(e);if(!isNaN(t)&&0!==t)return new J.A({wkid:t});if(e=String(e).trim(),(0,I.jp)(e))return new J.A({wkt2:e});const n=e.toUpperCase();if(n.startsWith("COMPD_CS")){if(!n.includes("VERTCS")||!n.includes("GEOGCS")&&!n.startsWith("PROJCS"))return null;const r=n.indexOf("VERTCS"),i=n.indexOf("PROJCS"),s=i>-1?i:n.indexOf("GEOGCS");if(-1===s)return null;const o=e.slice(s,e.lastIndexOf("]",r)+1).trim(),a=e.slice(r,e.lastIndexOf("]")).trim();t=Be(o);const l=new J.A(t?{wkid:t}:{wkt:o}),u=Be(a);return u&&(l.vcsWkid=u),l}return n.startsWith("GEOGCS")||n.startsWith("PROJCS")?(t=Be(e),new J.A(0!==t?{wkid:t}:{wkt:e})):null}function Be(e){const t=e.replaceAll("]","[").replaceAll('"',"").split("[").map((e=>e.trim())).filter((e=>""!==e)),n=t[t.length-1].split(","),r=n[0]?.toLowerCase();if(("epsg"===r||"esri"===r)&&e.endsWith('"]]')){const e=Number(n[1]);if(!isNaN(e)&&0!==e)return e}return 0}function Ze(e){if("pamdataset"!==e?.documentElement.tagName?.toLowerCase())return{};const t={spatialReference:null,transform:null,metadata:{},rasterBands:[],statistics:null,histograms:null};e.documentElement.childNodes.forEach((e=>{if(1===e.nodeType)if(Fe(e,"SRS")){if(!t.spatialReference){const n=De(e);t.spatialReference=je(n)}}else if(Fe(e,"Metadata"))if("xml:ESRI"===e.getAttribute("domain")){const{spatialReference:n,transform:r}=function(e){const t=Ne(e,"GeodataXform"),n=je(Le(t,"SpatialReference/WKID")||De(t,"SpatialReference/WKT"));if("typens:PolynomialXform"!==t.getAttribute("xsi:type"))return{spatialReference:n,transform:null};const r=Le(t,"PolynomialOrder")??1,i=Ee(t,"CoeffX/Double"),s=Ee(t,"CoeffY/Double"),o=Ee(t,"InverseCoeffX/Double"),a=Ee(t,"InverseCoeffY/Double"),l=ze(i,s),u=ze(o,a);return{spatialReference:n,transform:l&&u&&l.length&&u.length?new Oe.A({spatialReference:n,polynomialOrder:r,forwardCoefficients:l,inverseCoefficients:u}):null}}(e);t.transform=r,t.spatialReference||(t.spatialReference=n)}else Pe(e,"MDI").forEach((e=>t.metadata[e.getAttribute("key")]=De(e)));else if(Fe(e,"PAMRasterBand")){const n=function(e){const t=Le(e,"NoDataValue"),n=Ne(e,"Histograms/HistItem"),r=Le(n,"HistMin"),i=Le(n,"HistMax"),s=Le(n,"BucketCount"),o=De(n,"HistCounts")?.split("|").map((e=>Number(e)));let a,l,u,c;Pe(e,"Metadata/MDI").forEach((e=>{const t=Number(e.textContent??e.nodeValue);switch(e.getAttribute("key").toUpperCase()){case"STATISTICS_MINIMUM":a=t;break;case"STATISTICS_MAXIMUM":l=t;break;case"STATISTICS_MEAN":u=t;break;case"STATISTICS_STDDEV":c=t}}));const p=Le(e,"Metadata/SourceBandIndex");return{noDataValue:t,histogram:o?.length&&null!=r&&null!=i?{min:r,max:i,size:s||o.length,counts:o}:null,sourceBandIndex:p,statistics:null!=a&&null!=l?{min:a,max:l,avg:u,stddev:c}:null}}(e);null!=n.sourceBandIndex&&null==t.rasterBands[n.sourceBandIndex]?t.rasterBands[n.sourceBandIndex]=n:t.rasterBands.push(n)}}));const n=t.rasterBands;if(n.length){const e=!!n[0].statistics;t.statistics=e?n.map((e=>e.statistics)).filter(Re.Ru):null;const r=!!n[0].histogram;t.histograms=r?n.map((e=>e.histogram)).filter(Re.Ru):null}return t}let Ue=class extends K{fetchRawTile(e,t,n,r={}){return this._inMemoryRaster.fetchRawTile(e,t,n,r)}async _open(e){const t=await this._fetchData(e);let{spatialReference:n,statistics:r,histograms:i,transform:s}=await this._fetchAuxiliaryData(e);const o=!n;o&&(n=new J.A({wkid:3857})),i?.length&&null==r&&(r=(0,ne.Pg)(i));const{width:a,height:l}=t;let u=new W.default({xmin:-.5,ymin:.5-l,xmax:a-.5,ymax:.5,spatialReference:n});const c=s?s.forwardTransform(u):u;let p=!0;if(s){const e=s.forwardCoefficients;p=e&&0===e[1]&&0===e[2],p&&(s=null,u=c)}const h=new Ce({source:{extent:c,nativeExtent:u,transform:s,pixelBlocks:[t],statistics:r,histograms:i,keyProperties:{DateType:"Processed"},isPseudoSpatialReference:o},ioConfig:{sampling:"closest",skipStatistics:!0}});this.ioConfig.skipMapInfo&&(h.ioConfig.skipMapInfo=!0),await h.open(),h.source=null,this._set("rasterInfo",h.rasterInfo),this._inMemoryRaster=h}async _fetchData(e){const{data:t}=await this.request(this.url,{responseType:"array-buffer",signal:e?.signal}),n=(0,B.g)(t).toUpperCase();if("JPG"!==n&&"PNG"!==n&&"GIF"!==n&&"BMP"!==n)throw new o.A("image-aux-raster:open","the data is not a supported format");this._set("datasetFormat",n);const r=n.toLowerCase(),i="gif"===r||"bmp"===r||!(0,f.A)("ios"),s=await this.decodePixelBlock(t,{format:r,useCanvas:i,hasNoZlibMask:!0});if(null==s)throw new o.A("image-aux-raster:open","the data cannot be decoded");return s}async _fetchAuxiliaryData(e){const t=e?.signal,{skipExtensions:n=[],skipMapInfo:r}=this.ioConfig,i=r||n.includes("aux.xml")?null:this.request(this.url+".aux.xml",{responseType:"xml",signal:t}),s=this.datasetFormat,o="JPG"===s?"jgw":"PNG"===s?"pgw":"BMP"===s?"bpw":null,a=o&&n.includes(o)?null:this.request(this.url.slice(0,this.url.lastIndexOf("."))+"."+o,{responseType:"text",signal:t}),l=await(0,u.Lx)([i,a]);if(t?.aborted)throw(0,u.NK)();const c=Ze(l[0].value?.data);if(!c.transform){const e=l[1].value?l[1].value.data.split("\n").slice(0,6).map((e=>Number(e))):null;c.transform=6===e?.length?new Oe.A({forwardCoefficients:[e[4],e[5],e[0],-e[1],e[2],-e[3]]}):null}return c}};(0,r._)([(0,p.MZ)({type:String,json:{write:!0}})],Ue.prototype,"datasetFormat",void 0),Ue=(0,r._)([(0,d.$)("esri.layers.support.rasterDatasets.ImageAuxRaster")],Ue);const Ve=Ue;var Ge=n(95929),He=n(90683),We=n(6053),Je=n(62710),qe=n(30164);let $e=class extends K{constructor(){super(...arguments),this._levelOffset=0,this._tilemapCache=null,this._slices=null,this.datasetFormat="RasterTileServer",this.tileType=null}async fetchRawTile(e,t,n,r={}){const{storageInfo:i,extent:s}=this.rasterInfo,{transposeInfo:o}=i,a=null!=o&&!!r.transposedVariableName;if(this._slices&&!a&&null==r.sliceId)return null;const l=a?0:i.maximumPyramidLevel-e+this._levelOffset,u=`${this.url}/tile/${l}/${t}/${n}`,c=this._slices?a?{variable:r.transposedVariableName}:{sliceId:r.sliceId||0}:null,{data:p}=await this.request(u,{query:c,responseType:"array-buffer",signal:r.signal});if(!p)return null;const h=a?o.tileSize:i.tileInfo.size,f=await this.decodePixelBlock(p,{width:h[0],height:h[1],planes:null,pixelType:null,isPoint:"Elevation"===this.tileType,returnInterleaved:a,noDataValue:this.rasterInfo.noDataValue});if(null==f)return null;const d=i.blockBoundary[e];if("jpg"!==i.compression||n>d.minCol&&n<d.maxCol&&t>d.minRow&&t<d.maxRow)return f;const{origin:m,blockWidth:y,blockHeight:g}=i,{x:w,y:b}=this.getPyramidPixelSize(e),v=Math.round((s.xmin-m.x)/w)%y,x=Math.round((s.xmax-m.x)/w)%y||y,M=Math.round((m.y-s.ymax)/b)%g,A=Math.round((m.y-s.ymin)/b)%g||g,I=n===d.minCol?v:0,S=t===d.minRow?M:0,_=n===d.maxCol?x:y,C=t===d.maxRow?A:g;return(0,Z.z$)(f,{x:I,y:S},{width:_-I,height:C-S}),f}getSliceIndex(e){if(!this._slices||null==e||0===e.length)return null;const t=e;for(let e=0;e<this._slices.length;e++){const n=this._slices[e].multidimensionalDefinition;if(n.length===t.length&&!n.some((e=>{const n=t.find((t=>e.variableName===t.variableName&&t.dimensionName===e.dimensionName));return!n||(Array.isArray(e.values[0])?`${e.values[0][0]}-${e.values[0][1]}`:e.values[0])!==(Array.isArray(n.values[0])?`${n.values[0][0]}-${n.values[0][1]}`:n.values[0])})))return e}return null}async fetchVariableStatisticsHistograms(e,t){const n=this.request(this.url+"/statistics",{query:{variable:e,f:"json"},signal:t}).then((e=>e.data?.statistics)),r=this.request(this.url+"/histograms",{query:{variable:e,f:"json"},signal:t}).then((e=>e.data?.histograms)),i=await Promise.all([n,r]);return i[0]&&i[0].forEach((e=>{e.avg=e.mean,e.stddev=e.standardDeviation})),i[1]?.[0]?.counts?.length||(i[1]=null),{statistics:i[0]||null,histograms:i[1]||null}}async computeBestPyramidLevelForLocation(e,t={}){if(!this._tilemapCache)return 0;let n=this.identifyPixelLocation(e,0,t.datumTransformation);if(null===n)return null;let r=0;const{maximumPyramidLevel:i}=this.rasterInfo.storageInfo;let s=i-r+this._levelOffset;const o=n.srcLocation;for(;s>=0;){try{if("available"===await this._tilemapCache.fetchAvailability(s,n.row,n.col,t))break}catch{}if(s--,r++,n=this.identifyPixelLocation(o,r,t.datumTransformation),null===n)return null}return-1===s||null==n?null:r}async _open(e){const t=e?.signal,n=this.sourceJSON?{data:this.sourceJSON}:await this.request(this.url,{query:{f:"json"},signal:t});n.ssl&&(this.url=this.url.replace(/^http:/i,"https:"));const r=n.data;if(this.sourceJSON=r,!r)throw new o.A("imageserverraster:open","cannot initialize tiled image service, missing service info");if(!r.tileInfo)throw new o.A("imageserverraster:open","use ImageryLayer to open non-tiled image services");this._fixScaleInServiceInfo(),this.tileType=r.cacheType,null==this.tileType&&(["jpg","jpeg","png","png8","png24","png32","mixed"].includes(r.tileInfo.format.toLowerCase())?this.tileType="Map":"lerc"===r.tileInfo.format.toLowerCase()?this.tileType="Elevation":this.tileType="Raster"),this.datasetName=r.name?.slice(r.name.indexOf("/")+1)??"";const i=await this._fetchRasterInfo({signal:t});if(null==i)throw new o.A("image-server-raster:open","cannot initialize image service");(0,qe.E9)(i,r);const s="Map"===this.tileType?function(e,t){if(!e)return null;const{minScale:n,maxScale:r,minLOD:i,maxLOD:s}=t;if(null!=i&&null!=s)return N.default.fromJSON({...e,lods:e.lods.filter((({level:e})=>null!=e&&e>=i&&e<=s))});if(0!==n&&0!==r){const t=e=>Math.round(1e4*e)/1e4,i=n?t(n):1/0,s=r?t(r):-1/0;return N.default.fromJSON({...e,lods:e.lods.filter((e=>{const n=t(e.scale);return n<=i&&n>=s}))})}return N.default.fromJSON(e)}(r.tileInfo,r):N.default.fromJSON(r.tileInfo);(0,Ge.Lw)(s);const[a,l]=this._computeMinMaxLOD(i,s),{extent:u,pixelSize:c}=i,p=.5/i.width*c.x,h=Math.max(c.x,c.y),{lods:f}=s;("Map"!==this.tileType&&0!==r.maxScale||Math.abs(c.x-c.y)>p||!f.some((e=>Math.abs(e.resolution-h)<p)))&&(c.x=c.y=a.resolution,i.width=Math.ceil((u.xmax-u.xmin)/c.x-.1),i.height=Math.ceil((u.ymax-u.ymin)/c.y-.1));const d=a.level-l.level,[m,y]=s.size,g=[],w=[];f.forEach(((e,t)=>{e.level>=l.level&&e.level<=a.level&&g.push({x:e.resolution,y:e.resolution}),t<f.length-1&&w.push(Math.round(10*e.resolution/f[t+1].resolution)/10)})),g.sort(((e,t)=>e.x-t.x));const b=this.computeBlockBoundary(u,m,y,s.origin,g,d),v=g.length>1?g.slice(1):null;let x;r.transposeInfo&&(x={tileSize:[r.transposeInfo.rows,r.transposeInfo.cols],packetSize:i.keyProperties?._yxs.PacketSize??0});const M=w.length<=1||w.length>=3&&w.slice(0,-1).every((e=>e===w[0]))?w[0]??2:Math.round(10/(l.resolution/a.resolution)**(-1/d))/10;if(i.storageInfo=new F.A({blockWidth:s.size[0],blockHeight:s.size[1],pyramidBlockWidth:s.size[0],pyramidBlockHeight:s.size[1],pyramidResolutions:v,pyramidScalingFactor:M,compression:s.format,origin:s.origin,firstPyramidLevel:1,maximumPyramidLevel:d,tileInfo:s,transposeInfo:x,blockBoundary:b}),function(e){const{extent:t,spatialReference:n}=e;t.xmin>-1&&t.xmax>181&&n?.wkid&&n.isGeographic&&(e.nativeExtent=e.extent,e.transform=new Je.A,e.extent=e.transform.forwardTransform(t))}(i),this._set("rasterInfo",i),r.capabilities.toLowerCase().includes("tilemap")){const e={tileInfo:i.storageInfo.tileInfo,parsedUrl:(0,He.An)(this.url),url:this.url,tileServers:[]};this._tilemapCache=new We.d({layer:e})}}async _fetchRasterInfo(e){const t=this.sourceJSON;if("Map"===this.tileType){const e=t.fullExtent||t.extent,n=Math.ceil((e.xmax-e.xmin)/t.pixelSizeX-.1),r=Math.ceil((e.ymax-e.ymin)/t.pixelSizeY-.1),i=J.A.fromJSON(t.spatialReference||e.spatialReference),s=new H.default({x:t.pixelSizeX,y:t.pixelSizeY,spatialReference:i});return new Se.A({width:n,height:r,bandCount:3,extent:W.default.fromJSON(e),spatialReference:i,pixelSize:s,pixelType:"u8",statistics:null,keyProperties:{DataType:"processed"}})}const{signal:n}=e,r=(0,qe.Tw)(this.url,this.sourceJSON,{signal:n,query:this.ioConfig.customFetchParameters}),i=t.hasMultidimensions?this.request(`${this.url}/slices`,{query:{f:"json"},signal:n}).then((e=>e.data?.slices)).catch((()=>null)):null,s=await Promise.all([r,i]);return this._slices=s[1],s[0]}_fixScaleInServiceInfo(){const{sourceJSON:e}=this;e.minScale&&e.minScale<0&&(e.minScale=0),e.maxScale&&e.maxScale<0&&(e.maxScale=0)}_computeMinMaxLOD(e,t){const{pixelSize:n}=e,r=.5/e.width*n.x,{lods:i}=t,s=t.lodAt(Math.max.apply(null,i.map((e=>e.level)))),o=t.lodAt(Math.min.apply(null,i.map((e=>e.level)))),{tileType:a}=this;if("Map"===a)return this._levelOffset=i[0].level,[s,o];if("Raster"===a)return[i.find((e=>e.resolution===n.x))??s,o];const{minScale:l,maxScale:u}=this.sourceJSON;let c=s;u>0&&(c=i.find((e=>Math.abs(e.scale-u)<r)),c||(c=i.filter((e=>e.scale>u)).sort(((e,t)=>e.scale>t.scale?1:-1))[0]??s));let p=o;return l>0&&(p=i.find((e=>Math.abs(e.scale-l)<r))??o,this._levelOffset=p.level-o.level),[c,p]}};(0,r._)([(0,p.MZ)({type:String,json:{write:!0}})],$e.prototype,"datasetFormat",void 0),(0,r._)([(0,p.MZ)()],$e.prototype,"tileType",void 0),$e=(0,r._)([(0,d.$)("esri.layers.support.rasterDatasets.ImageServerRaster")],$e);const Ke=$e;var Ye=n(70041);const Xe=new Map;Xe.set("Int8","s8"),Xe.set("UInt8","u8"),Xe.set("Int16","s16"),Xe.set("UInt16","u16"),Xe.set("Int32","s32"),Xe.set("UInt32","u32"),Xe.set("Float32","f32"),Xe.set("Float64","f32"),Xe.set("Double64","f32");const Qe=new Map;Qe.set("none",{blobExtension:".til",isOneSegment:!0,decoderFormat:"bip"}),Qe.set("lerc",{blobExtension:".lrc",isOneSegment:!1,decoderFormat:"lerc"}),Qe.set("deflate",{blobExtension:".pzp",isOneSegment:!0,decoderFormat:"deflate"}),Qe.set("jpeg",{blobExtension:".pjg",isOneSegment:!0,decoderFormat:"jpg"});let et=class extends K{constructor(){super(...arguments),this._files=null,this._storageIndex=null,this.datasetFormat="MRF"}async fetchRawTile(e,t,n,r={}){const{blockWidth:i,blockHeight:s,blockBoundary:o}=this.rasterInfo.storageInfo,a=o[e];if(!a||a.maxRow<t||a.maxCol<n||a.minRow>t||a.minCol>n)return null;const{bandCount:l,pixelType:u}=this.rasterInfo,{ranges:c,actualTileWidth:p,actualTileHeight:h}=this._getTileLocation(e,t,n);if(!c||0===c.length)return null;if(0===c[0].from&&0===c[0].to){const e=new Uint8Array(i*s);return new ge.A({width:i,height:s,pixels:void 0,mask:e,validPixelCount:0})}const{bandIds:f}=this.ioConfig,d=this._getBandSegmentCount(),m=[];let y=0;for(y=0;y<d;y++)f&&!f.includes(y)||m.push(this.request(this._files.data,{range:{from:c[y].from,to:c[y].to},responseType:"array-buffer",signal:r.signal}));const g=await Promise.all(m),w=g.map((e=>e.data.byteLength)).reduce(((e,t)=>e+t)),b=new Uint8Array(w),v=[];let x=0;for(y=0;y<d;y++)v.push(x),b.set(new Uint8Array(g[y].data),x),x+=g[y].data.byteLength;const M=Qe.get(this.rasterInfo.storageInfo.compression).decoderFormat,A=await this.decodePixelBlock(b.buffer,{width:i,height:s,format:M,planes:f?.length||l,offsets:v,pixelType:u});if(null==A)return null;let{noDataValue:I}=this.rasterInfo;if(null!=I&&"lerc"!==M&&!A.mask&&(I=I[0],null!=I)){const e=A.width*A.height,t=new Uint8Array(e);if(Math.abs(I)>1e24)for(y=0;y<e;y++)Math.abs((A.pixels[0][y]-I)/I)>1e-6&&(t[y]=1);else for(y=0;y<e;y++)A.pixels[0][y]!==I&&(t[y]=1);A.mask=t}let S=0,_=0;if(p!==i||h!==s){let e=A.mask;if(e)for(y=0;y<s;y++)if(_=y*i,y<h)for(S=p;S<i;S++)e[_+S]=0;else for(S=0;S<i;S++)e[_+S]=0;else for(e=new Uint8Array(i*s),A.mask=e,y=0;y<h;y++)for(_=y*i,S=0;S<p;S++)e[_+S]=1}return A}async _open(e){this.datasetName=this.url.slice(this.url.lastIndexOf("/")+1);const t=e?e.signal:null,n=await this.request(this.url,{responseType:"xml",signal:t}),{rasterInfo:r,files:i}=this._parseHeader(n.data),{skipMapInfo:s,skipExtensions:o=[]}=this.ioConfig;if(!o.includes("aux.xml")&&!s){const t=await this._fetchAuxiliaryData(e);null!=t&&(r.statistics=t.statistics??r.statistics,r.histograms=t.histograms,t.histograms&&null==r.statistics&&(r.statistics=(0,ne.Pg)(t.histograms)))}s&&this.updateImageSpaceRasterInfo(r),this._set("rasterInfo",r),this._files=i;const a=await this.request(i.index,{responseType:"array-buffer",signal:t});this._storageIndex=function(e){if(e.byteLength%16>0)throw new Error("invalid array buffer must be multiples of 16");let t,n,r,i,s,o;if(Ye.Z){for(n=new Uint8Array(e),i=new ArrayBuffer(e.byteLength),r=new Uint8Array(i),s=0;s<e.byteLength/4;s++)for(o=0;o<4;o++)r[4*s+o]=n[4*s+3-o];t=new Uint32Array(i)}else t=new Uint32Array(e);return t}(a.data);const{blockWidth:l,blockHeight:u}=this.rasterInfo.storageInfo,c=this.rasterInfo.storageInfo.pyramidScalingFactor,{width:p,height:h}=this.rasterInfo,f=[],d=this._getBandSegmentCount();let m=0,y=-1;for(;m<this._storageIndex.length;){y++;const e=Math.ceil(p/l/c**y)-1,t=Math.ceil(h/u/c**y)-1;m+=(e+1)*(t+1)*d*4,f.push({maxRow:t,maxCol:e,minCol:0,minRow:0})}this.rasterInfo.storageInfo.blockBoundary=f,y>0&&(this.rasterInfo.storageInfo.firstPyramidLevel=1,this.rasterInfo.storageInfo.maximumPyramidLevel=y),this.updateTileInfo()}_getBandSegmentCount(){return Qe.get(this.rasterInfo.storageInfo.compression).isOneSegment?1:this.rasterInfo.bandCount}_getTileLocation(e,t,n){const{blockWidth:r,blockHeight:i,pyramidScalingFactor:s}=this.rasterInfo.storageInfo,{width:o,height:a}=this.rasterInfo,l=this._getBandSegmentCount();let u,c,p,h=0,f=0;for(p=0;p<e;p++)f=s**p,u=Math.ceil(o/r/f),c=Math.ceil(a/i/f),h+=u*c;f=s**e,u=Math.ceil(o/r/f),c=Math.ceil(a/i/f),h+=t*u+n,h*=4*l;const d=this._storageIndex.subarray(h,h+4*l);let m=0,y=0;const g=[];for(let e=0;e<l;e++)m=d[4*e]*2**32+d[4*e+1],y=m+d[4*e+2]*2**32+d[4*e+3],g.push({from:m,to:y});return{ranges:g,actualTileWidth:n<u-1?r:Math.ceil(o/f)-r*(u-1),actualTileHeight:t<c-1?i:Math.ceil(a/f)-i*(c-1)}}_parseHeader(e){const t=Ne(e,"MRF_META/Raster");if(!t)throw new o.A("mrf:open","not a valid MRF format");const n=Ne(t,"Size"),r=parseInt(n.getAttribute("x"),10),i=parseInt(n.getAttribute("y"),10),s=parseInt(n.getAttribute("c"),10),a=(De(t,"Compression")||"none").toLowerCase();if(!Qe.has(a))throw new o.A("mrf:open","currently does not support compression "+a);const l=De(t,"DataType")||"UInt8",u=Xe.get(l);if(null==u)throw new o.A("mrf:open","currently does not support pixel type "+l);const c=Ne(t,"PageSize"),p=parseInt(c.getAttribute("x"),10),h=parseInt(c.getAttribute("y"),10),f=Ne(t,"DataValues");let d,m;if(f&&(m=f.getAttribute("NoData"),null!=m&&(d=m.trim().split(" ").map((e=>parseFloat(e))))),Ne(e,"MRF_META/CachedSource"))throw new o.A("mrf:open","currently does not support MRF referencing other data files");const y=Ne(e,"MRF_META/GeoTags"),g=Ne(y,"BoundingBox");let w,b=!1;if(null!=g){const e=parseFloat(g.getAttribute("minx")),t=parseFloat(g.getAttribute("miny")),n=parseFloat(g.getAttribute("maxx")),r=parseFloat(g.getAttribute("maxy")),i=De(y,"Projection")||"";let s=J.A.WGS84;if("LOCAL_CS[]"!==i)if(i.toLowerCase().startsWith("epsg:")){const e=Number(i.slice(5));isNaN(e)||0===e||(s=new J.A({wkid:e}))}else s=je(i)??J.A.WGS84;else b=!0,s=new J.A({wkid:3857});w=new W.default(e,t,n,r),w.spatialReference=s}else b=!0,w=new W.default({xmin:-.5,ymin:.5-i,xmax:r-.5,ymax:.5,spatialReference:new J.A({wkid:3857})});const v=Ne(e,"MRF_META/Rsets"),x=parseInt(v?.getAttribute("scale")||"2",10),M=w.spatialReference,A=new F.A({origin:new H.default({x:w.xmin,y:w.ymax,spatialReference:M}),blockWidth:p,blockHeight:h,pyramidBlockWidth:p,pyramidBlockHeight:h,compression:a,pyramidScalingFactor:x}),I=new H.default({x:w.width/r,y:w.height/i,spatialReference:M}),S=new Se.A({width:r,height:i,extent:w,isPseudoSpatialReference:b,spatialReference:M,bandCount:s,pixelType:u,pixelSize:I,noDataValue:d,storageInfo:A}),_=De(e,"datafile"),C=De(e,"IndexFile");return{rasterInfo:S,files:{mrf:this.url,index:C||this.url.replace(".mrf",".idx"),data:_||this.url.replace(".mrf",Qe.get(a).blobExtension)}}}async _fetchAuxiliaryData(e){try{const{data:t}=await this.request(this.url+".aux.xml",{responseType:"xml",signal:e?.signal});return Ze(t)}catch{return null}}};(0,r._)([(0,p.MZ)()],et.prototype,"_files",void 0),(0,r._)([(0,p.MZ)()],et.prototype,"_storageIndex",void 0),(0,r._)([(0,p.MZ)({type:String,json:{write:!0}})],et.prototype,"datasetFormat",void 0),et=(0,r._)([(0,d.$)("esri.layers.support.rasterDatasets.MRFRaster")],et);const tt=et;var nt=n(11958);function rt(e){const t=e.fields,n=e.records,r=t.some((e=>"oid"===e.name.toLowerCase()))?"OBJECTID":"OID",i=[{name:r,type:"esriFieldTypeOID",alias:"OID"}].concat(t.map((e=>({name:e.name,type:"esriFieldType"+e.typeName,alias:e.name})))),s=i.map((e=>e.name)),o=[];let a=0,l=0;return n.forEach((e=>{const t={};for(t[r]=a++,l=1;l<s.length;l++)t[s[l]]=e[l-1];o.push({attributes:t})})),{displayFieldName:"",fields:i,features:o}}class it{static get supportedVersions(){return[5]}static parse(e){const t=new DataView(e),n=3&t.getUint8(0);if(3!==n)return{header:{version:n},recordSet:null};const r=t.getUint32(4,!0),i=t.getUint16(8,!0),s=t.getUint16(10,!0),o={version:n,recordCount:r,headerByteCount:i,recordByteCount:s};let a=32;const l=[],u=[];let c;if(3===n){for(;13!==t.getUint8(a);)c=String.fromCharCode(t.getUint8(a+11)).trim(),l.push({name:(0,nt.w)(new Uint8Array(e,a,11)),type:c,typeName:["String","Date","Double","Boolean","String","Integer"][["C","D","F","L","M","N"].indexOf(c)],length:t.getUint8(a+16)}),a+=32;if(a+=1,l.length>0)for(;u.length<r&&e.byteLength-a>s;){const n=[];32===t.getUint8(a)?(a+=1,l.forEach((t=>{if("C"===t.type)n.push((0,nt.w)(new Uint8Array(e,a,t.length)).trim());else if("N"===t.type)n.push(parseInt(String.fromCharCode.apply(null,new Uint8Array(e,a,t.length)).trim(),10));else if("F"===t.type)n.push(parseFloat(String.fromCharCode.apply(null,new Uint8Array(e,a,t.length)).trim()));else if("D"===t.type){const r=String.fromCharCode.apply(null,new Uint8Array(e,a,t.length)).trim();n.push(new Date(parseInt(r.slice(0,4),10),parseInt(r.slice(4,6),10)-1,parseInt(r.slice(6,8),10)))}a+=t.length})),u.push(n)):a+=s}}return{header:o,fields:l,records:u,recordSet:rt({fields:l,records:u})}}}var st=n(3685),ot=n(57328);const at=(e,t)=>e.get(t)?.values,lt=(e,t)=>e.get(t)?.values?.[0];let ut=class extends K{constructor(){super(...arguments),this._files=null,this._headerInfo=null,this._bufferSize=1048576,this.datasetFormat="TIFF"}async fetchRawTile(e,t,n,r={}){if(!this._headerInfo?.isSupported||this.isBlockOutside(e,t,n))return null;const i=await this._fetchRawTiffTile(e,t,n,!1,r);if(null!=i&&this._headerInfo.hasMaskBand){const s=await this._fetchRawTiffTile(e,t,n,!0,r);null!=s&&s.pixels[0]instanceof Uint8Array&&(i.mask=s.pixels[0])}return i}async _open(e){const t=e?e.signal:null,{data:n}=await this.request(this.url,{range:{from:0,to:this._bufferSize},responseType:"array-buffer",signal:t});if(!n)throw new o.A("tiffraster:open","failed to open url "+this.url);this.datasetName=this.url.slice(this.url.lastIndexOf("/")+1,this.url.lastIndexOf("."));const{littleEndian:r,firstIFDPos:i,isBigTiff:s}=(0,st.uT)(n),l=[];await this._readIFDs(l,n,r,i,0,s?8:4,t);const{imageInfo:u,rasterInfo:c}=function(e){const t=(0,st.uc)(e),{width:n,height:r,tileWidth:i,tileHeight:s,planes:o,pixelType:a,compression:l,firstPyramidLevel:u,maximumPyramidLevel:c,pyramidBlockWidth:p,pyramidBlockHeight:h,pyramidResolutions:f,tileBoundary:d,affine:m,metadata:y}=t;let g=je(t.extent.spatialReference?.wkt||t.extent.spatialReference?.wkid),w=!!t.isPseudoGeographic;null==g&&(w=!0,g=new J.A({wkid:3857}));const b=new W.default({...t.extent,spatialReference:g}),v=new H.default(b?{x:b.xmin,y:b.ymax,spatialReference:g}:{x:0,y:0}),x=new F.A({blockWidth:i,blockHeight:s,pyramidBlockWidth:p,pyramidBlockHeight:h,compression:l,origin:v,firstPyramidLevel:u,maximumPyramidLevel:c,pyramidResolutions:f,blockBoundary:d}),M=new H.default({x:(b.xmax-b.xmin)/n,y:(b.ymax-b.ymin)/r,spatialReference:g}),A=y?{BandProperties:y.bandProperties,DataType:y.dataType}:{};let I=null;const S=lt(e[0],"PHOTOMETRICINTERPRETATION"),_=at(e[0],"COLORMAP");if(S<=3&&_?.length>3&&_.length%3==0){I=[];const e=_.length/3;for(let t=0;t<e;t++)I.push([t,_[t]>>>8,_[t+e]>>>8,_[t+2*e]>>>8])}const C=new Se.A({width:n,height:r,bandCount:o,pixelType:a,pixelSize:M,storageInfo:x,spatialReference:g,isPseudoSpatialReference:w,keyProperties:A,extent:b,colormap:I,statistics:y?y.statistics:null});if(m?.length&&(C.nativeExtent=new W.default({xmin:-.5,ymin:.5-r,xmax:n-.5,ymax:.5,spatialReference:g}),C.transform=new Oe.A({polynomialOrder:1,forwardCoefficients:[m[2]+m[0]/2,m[5]-m[3]/2,m[0],m[3],-m[1],-m[4]]}),C.extent=C.transform.forwardTransform(C.nativeExtent),C.pixelSize=new H.default({x:(b.xmax-b.xmin)/n,y:(b.ymax-b.ymin)/r,spatialReference:g}),x.origin.x=-.5,x.origin.y=.5),f){const{x:e,y:t}=C.pixelSize;f.forEach((n=>{n.x*=e,n.y*=t}))}return{imageInfo:t,rasterInfo:C}}(l),p=(0,st.zS)(l),h=(0,st.r9)(l);if(this._headerInfo={littleEndian:r,isBigTiff:s,ifds:l,pyramidIFDs:p,maskIFDs:h,...u},this._set("rasterInfo",c),!u.isSupported)throw new o.A("tiffraster:open","this tiff is not supported: "+u.message);if(!u.tileWidth)throw new o.A("tiffraster:open","none-tiled tiff is not optimized for access, convert to COG and retry.");c.isPseudoSpatialReference&&a.A.getLogger(this).warn("The spatial reference for this tiff is unsupported. Only EPSG spatial reference codes and Esri WKTs are supported.");const f=l[0].get("PREDICTOR")?.values?.[0],d=l[0].get("SAMPLEFORMAT")?.values?.[0];if(3===d&&2===f)throw new o.A("tiffraster:open","unsupported horizontal difference encoding. Predictor=3 is supported for floating point data");const{skipMapInfo:m,skipExtensions:y=[]}=this.ioConfig;if(!y.includes("aux.xml")&&!m){const t=await this._fetchAuxiliaryMetaData(e);null!=t&&function(e,t){if(t.statistics=e.statistics??t.statistics,t.histograms=e.histograms,e.histograms&&null==t.statistics&&(t.statistics=(0,ne.Pg)(e.histograms)),e.transform&&null==t.transform){t.transform=e.transform,t.nativeExtent=t.extent;const n=t.transform.forwardTransform(t.nativeExtent);t.pixelSize=new H.default({x:(n.xmax-n.xmin)/t.width,y:(n.ymax-n.ymin)/t.height,spatialReference:t.spatialReference}),t.extent=n}t.isPseudoSpatialReference&&e.spatialReference&&(t.spatialReference=e.spatialReference,t.extent.spatialReference=t.nativeExtent.spatialReference=t.storageInfo.origin.spatialReference=t.spatialReference)}(t,c)}y.includes("vat.dbf")||1!==c.bandCount||"u8"!==c.pixelType||m||(c.attributeTable=await this._fetchAuxiliaryTable(e),null!=c.attributeTable&&(c.keyProperties.DataType="thematic")),m&&this.updateImageSpaceRasterInfo(c),this.updateTileInfo()}async _readIFDs(e,t,n,r,i,s=4,o){if(!r)return null;(r>=t.byteLength||r<0)&&(t=(await this.request(this.url,{range:{from:r+i,to:r+i+this._bufferSize},responseType:"array-buffer",signal:o})).data,i=r+i,r=0);const a=await this._readIFD(t,n,r,i,ot.A.tiffTags,s,o);if(e.push(a.ifd),!a.nextIFD)return null;await this._readIFDs(e,t,n,a.nextIFD-i,i,s,o)}async _readIFD(e,t,n,r,i=ot.A.tiffTags,s=4,o){if(!e)return null;const a=(0,st.JM)(e,t,n,r,i,s);if(a.success){const n=[];if(a.ifd?.forEach((e=>{e.values||n.push(e)})),n.length>0){const i=n.map((e=>e.offlineOffsetSize)).filter(Re.Ru),s=Math.min.apply(null,i.map((e=>e[0])));if(Math.min.apply(null,i.map((e=>e[0]+e[1])))-s<=this._bufferSize){const{data:i}=await this.request(this.url,{range:{from:s,to:s+this._bufferSize},responseType:"array-buffer",signal:o});e=i,r=s,n.forEach((n=>(0,st.Cr)(e,t,n,r)))}}if(a.ifd?.has("GEOKEYDIRECTORY")){const n=a.ifd.get("GEOKEYDIRECTORY"),i=n?.values;if(i&&i.length>4){const s=i[0]+"."+i[1]+"."+i[2],a=await this._readIFD(e,t,n.valueOffset+6-r,r,ot.A.geoKeys,2,o);n.data=a.ifd,n.data&&n.data.set("GEOTIFFVersion",{id:0,type:2,valueCount:1,valueOffset:null,values:[s]})}}return a}if(a.requiredBufferSize&&a.requiredBufferSize!==e.byteLength){const n=await this.request(this.url,{range:{from:r,to:r+a.requiredBufferSize+4},responseType:"array-buffer",signal:o});return(e=n.data).byteLength<a.requiredBufferSize?null:this._readIFD(e,t,0,r,ot.A.tiffTags,4,o)}}async _fetchRawTiffTile(e,t,n,r,i={}){const s=this._getTileLocation(e,t,n,r);if(!s)return null;const{ranges:o,actualTileWidth:a,actualTileHeight:l,ifd:u}=s,c=o.map((e=>this.request(this.url,{range:e,responseType:"array-buffer",signal:i.signal}))),p=await Promise.all(c),h=p.map((e=>e.data.byteLength)).reduce(((e,t)=>e+t)),f=1===p.length?p[0].data:new ArrayBuffer(h),d=[0],m=[0];if(p.length>1){const e=new Uint8Array(f);for(let t=0,n=0;t<p.length;t++){const r=p[t].data;e.set(new Uint8Array(r),n),d[t]=n,n+=r.byteLength,m[t]=r.byteLength}}const{blockWidth:y,blockHeight:g}=this.getBlockWidthHeight(e),w=await this.decodePixelBlock(f,{format:"tiff",customOptions:{headerInfo:this._headerInfo,ifd:u,offsets:d,sizes:m},width:y,height:g,planes:null,pixelType:null});if(null==w)return null;let b,v,x;if(a!==y||l!==g){let e=w.mask;if(e)for(b=0;b<g;b++)if(x=b*y,b<l)for(v=a;v<y;v++)e[x+v]=0;else for(v=0;v<y;v++)e[x+v]=0;else for(e=new Uint8Array(y*g),w.mask=e,b=0;b<l;b++)for(x=b*y,v=0;v<a;v++)e[x+v]=1}return w}_getTileLocation(e,t,n,r=!1){const{firstPyramidLevel:i,blockBoundary:s}=this.rasterInfo.storageInfo,o=0===e?0:e-(i-1),{_headerInfo:a}=this;if(!a)return null;const l=r?a.maskIFDs[o]:0===o?a?.ifds[0]:a?.pyramidIFDs[o-1];if(!l)return null;const u=(0,st.XO)(l,a),c=at(l,"TILEOFFSETS");if(void 0===c)return null;const p=at(l,"TILEBYTECOUNTS"),{minRow:h,minCol:f,maxRow:d,maxCol:m}=s[o];if(t>d||n>m||t<h||n<f)return null;const y=lt(l,"IMAGEWIDTH"),g=lt(l,"IMAGELENGTH"),w=lt(l,"TILEWIDTH"),b=lt(l,"TILELENGTH"),v=[];if(u){const{bandCount:e}=this.rasterInfo;for(let r=0;r<e;r++){const e=r*(d+1)*(m+1)+t*(m+1)+n;v[r]={from:c[e],to:c[e]+p[e]-1}}}else{const e=t*(m+1)+n;v.push({from:c[e],to:c[e]+p[e]-1})}for(let e=0;e<v.length;e++)if(null==v[e].from||!v[e].to||v[e].to<0)return null;return{ranges:v,ifd:l,actualTileWidth:n===m&&y%w||w,actualTileHeight:t===d&&g%b||b}}async _fetchAuxiliaryMetaData(e){try{const{data:t}=await this.request(this.url+".aux.xml",{responseType:"xml",signal:e?.signal});return Ze(t)}catch{return null}}async _fetchAuxiliaryTable(e){try{const{data:t}=await this.request(this.url+".vat.dbf",{responseType:"array-buffer",signal:e?.signal}),n=it.parse(t);return n?.recordSet?X.A.fromJSON(n.recordSet):null}catch{return null}}};(0,r._)([(0,p.MZ)()],ut.prototype,"_files",void 0),(0,r._)([(0,p.MZ)()],ut.prototype,"_headerInfo",void 0),(0,r._)([(0,p.MZ)()],ut.prototype,"_bufferSize",void 0),(0,r._)([(0,p.MZ)({type:String,json:{write:!0}})],ut.prototype,"datasetFormat",void 0),ut=(0,r._)([(0,d.$)("esri.layers.support.rasterDatasets.TIFFRaster")],ut);const ct=ut,pt=new Map;pt.set("MRF",{desc:"Meta Raster Format",constructor:tt}),pt.set("TIFF",{desc:"GeoTIFF",constructor:ct}),pt.set("RasterTileServer",{desc:"Raster Tile Server",constructor:Ke}),pt.set("JPG",{desc:"JPG Raster Format",constructor:Ve}),pt.set("PNG",{desc:"PNG Raster Format",constructor:Ve}),pt.set("GIF",{desc:"GIF Raster Format",constructor:Ve}),pt.set("BMP",{desc:"BMP Raster Format",constructor:Ve}),pt.set("CovJSON",{desc:"COVJSON Raster Format",constructor:ke}),pt.set("MEMORY",{desc:"In Memory Raster Format",constructor:Ce});class ht{static get supportedFormats(){const e=new Set;return pt.forEach(((t,n)=>e.add(n))),e}static async open(e){const{url:t,ioConfig:n,source:r,sourceJSON:i}=e;let s=e.datasetFormat??n?.datasetFormat;null==s&&(t.includes(".")?s=t.slice(t.lastIndexOf(".")+1).toUpperCase():"coverage"===r?.type?.toLowerCase()?s="CovJSON":r?.extent&&r.pixelblocks&&(s="MEMORY")),"OVR"===s||"TIF"===s?s="TIFF":"JPG"===s||"JPEG"===s||"JFIF"===s?s="JPG":"COVJSON"===s&&(s="CovJSON"),t.toLowerCase().includes("/imageserver")&&!t.toLowerCase().includes("/wcsserver")&&(s="RasterTileServer");const a={url:t,source:r,sourceJSON:i,datasetFormat:s,ioConfig:n??{bandIds:null,sampling:null}};if(Object.keys(a).forEach((e=>{null==a[e]&&delete a[e]})),s){if(!this.supportedFormats.has(s))throw new o.A("rasterfactory:open","not a supported format "+s);if("CRF"===s)throw new o.A("rasterfactory:open",`cannot open raster: ${t}`);const n=new(0,pt.get(s).constructor)(a);return await n.open({signal:e.signal}),n}const l=Array.from(pt.keys()).filter((e=>"CovJSON"!==e&&"Memory"!==e));let u=0;const c=()=>{if(s=l[u++],!s)return null;if("CRF"===s)return null;const t=new(0,pt.get(s).constructor)(a);return t.open({signal:e.signal}).then((()=>t)).catch((()=>c()))};return c()}static register(e,t,n){pt.has(e.toUpperCase())||pt.set(e.toUpperCase(),{desc:t,constructor:n})}}var ft=n(18950),dt=n(91448);let mt=class extends((0,g.dM)((0,he.j)((0,le.q)((0,ue.A)((0,ce.H)((0,w.d)(ae((0,fe.e)((0,y.b)((0,pe.J)((0,l.P)((0,s.O)(m.A))))))))))))){constructor(...e){super(...e),this._primaryRasters=[],this.legendEnabled=!0,this.isReference=null,this.listMode="show",this.sourceJSON=null,this.version=null,this.type="imagery-tile",this.operationalLayerType="ArcGISTiledImageServiceLayer",this.popupEnabled=!0,this.popupTemplate=null,this.fields=null,this.source=void 0,this._debouncedSaveOperations=(0,u.sg)((async(e,t,r)=>{const{save:i,saveAs:s}=await n.e(3662).then(n.bind(n,47259));switch(e){case dt.X.SAVE:return i(this,t);case dt.X.SAVE_AS:return s(this,r,t)}}))}normalizeCtorArgs(e,t){return"string"==typeof e?{url:e,...t}:e}load(e){const t=null!=e?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Image Service"]},e).catch(u.QP).then((()=>this._openRaster(t)))),Promise.resolve(this)}get defaultPopupTemplate(){return this.createPopupTemplate()}get rasterFields(){const e=[new de.A({name:"Raster.ServicePixelValue",alias:"Pixel Value",domain:null,editable:!1,length:50,type:"string"}),new de.A({name:"Raster.ServicePixelValue.Raw",alias:"Raw Pixel Value",domain:null,editable:!1,length:50,type:"string"})],t=this.raster?.rasterInfo??this.serviceRasterInfo,n=t?.attributeTable,r=null!=n?n.fields:null;if(r){const t=r.filter((e=>"oid"!==e.type&&"value"!==e.name.toLowerCase())).map((e=>{const t=e.clone();return t.name="Raster."+e.name,t}));e.push(...t)}const i=t?.dataType,s=t?.multidimensionalInfo;if(("vector-magdir"===i||"vector-uv"===i)&&null!=s){const t=s.variables[0].unit?.trim(),n="Magnitude"+(t?` (${t})`:"");e.push(new de.A({name:"Raster.Magnitude",alias:n,domain:null,editable:!1,type:"double"})),e.push(new de.A({name:"Raster.Direction",alias:"Direction (°)",domain:null,editable:!1,type:"double"}))}return e}createPopupTemplate(e){const{rasterFields:t}=this,n=e?.visibleFieldNames??new Set(t.map((({name:e})=>e)).filter((e=>"raster.servicepixelvalue.raw"!==e.toLowerCase()))),r=(0,ft.tn)({fields:t,title:this.title},{...e,visibleFieldNames:n}),{rasterInfo:i}=this.raster;return r?.fieldInfos&&i?.pixelType.startsWith("f")&&r.fieldInfos.forEach((({format:e,fieldName:t})=>{e&&t&&/^raster\.(item|service)pixelvalue/i.test(t)&&(e.places=2)})),r}async generateRasterInfo(e,t){if(e=(0,h.PZ)(R.A,e),await this.load(),!e||"none"===e.functionName?.toLowerCase())return this.serviceRasterInfo;try{const{rasterInfo:n}=await this._openFunctionRaster(e,t);return n}catch(e){if(e instanceof o.A)throw e;throw new o.A("imagery-tile-layer","the given raster function is not supported")}}async save(e){return this._debouncedSaveOperations(dt.X.SAVE,e)}async saveAs(e,t){return this._debouncedSaveOperations(dt.X.SAVE_AS,t,e)}write(e,t){const n=this._primaryRasters[0]??this.raster;if(this.loaded?"RasterTileServer"===n.datasetFormat&&("Raster"===n.tileType||"Map"===n.tileType):this.url&&/\/ImageServer(\/|\/?$)/i.test(this.url))return super.write(e,t);if(t?.messages){const e=`${t.origin}/${t.layerContainerType||"operational-layers"}`;t.messages.push(new o.A("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${e}'`,{layer:this}))}return null}async _openRaster(e){let t=!1;if(this.raster)await this._openFromRaster(this.raster,e),t="Function"===this.raster.datasetFormat,!t&&this.rasterFunction&&(this._primaryRasters=[this.raster],await this._initializeWithFunctionRaster(this.rasterFunction));else{const{url:t,rasterFunction:n,source:r}=this;if(!t&&!r)throw new o.A("imagery-tile-layer:open","missing url or source parameter");r?await this._openFromSource(r,e):n?await this._openFromUrlWithRasterFunction(t,n,e):await this._openFromUrl(t,e)}const n=this.raster.rasterInfo;if(!n)throw new o.A("imagery-tile-layer:load","cannot load resources on "+this.url);if(this._set("serviceRasterInfo",t?n:this._primaryRasters[0].rasterInfo),this._set("spatialReference",n.spatialReference),this.sourceJSON=this.sourceJSON||this.raster.sourceJSON,null!=this.sourceJSON){const e="Map"===this.raster.tileType&&null!=this.sourceJSON.minLOD&&null!=this.sourceJSON.maxLOD?this.sourceJSON:{...this.sourceJSON,minScale:0,maxScale:0};this.read(e,{origin:"service"})}else this.read({tileInfo:this.serviceRasterInfo?.storageInfo.tileInfo.toJSON()},{origin:"service"});this.title||(this.title=this.raster.datasetName),"Map"===this.raster.tileType&&(this.popupEnabled=!1),this._configDefaultSettings(),this.addHandles((0,c.watch)((()=>this.customParameters),(e=>{this.raster&&(this.raster.ioConfig.customFetchParameters=e)})))}async _openFromRaster(e,t){e.rasterInfo||await e.open({signal:t}),this._primaryRasters="Function"===e.datasetFormat?e.primaryRasters.rasters:[e],this.url||(this.url=this._primaryRasters[0].url)}async _openFromUrlWithRasterFunction(e,t,n){const r=[e];t&&(0,te.UD)(t.toJSON(),r);const i=await Promise.all(r.map((e=>ht.open({url:e,sourceJSON:this.sourceJSON,ioConfig:{sampling:"closest",...this.ioConfig,customFetchParameters:this.customParameters},signal:n})))),s=i.findIndex((e=>null==e));if(s>-1)throw new o.A("imagery-tile-layer:open",`cannot open raster: ${r[s]}`);return this._primaryRasters=i,this._initializeWithFunctionRaster(t)}async _openFromUrl(e,t){const n=await ht.open({url:e,sourceJSON:this.sourceJSON,ioConfig:{sampling:"closest",...this.ioConfig,customFetchParameters:this.customParameters},signal:t});if(null==n)throw new o.A("imagery-tile-layer:open",`cannot open raster: ${e}`);this._primaryRasters=[n],this.raster=n}async _openFromSource(e,t){const n="the tiled imagery data source is not supported",r="coverage"===e.type?.toLowerCase()?"CovJSON":e.extent&&e.pixelBlock?"MEMORY":null;if(!r)throw new o.A("imagery-tile-layer:open",n);"MEMORY"===r&&(e={...e,pixelBlock:void 0,pixelBlocks:[e.pixelBlock]});const i=await ht.open({url:"",source:e,datasetFormat:r,ioConfig:{sampling:"closest",...this.ioConfig,customFetchParameters:this.customParameters},signal:t});if(null==i)throw new o.A("imagery-tile-layer:open",n);this._primaryRasters=[i],this.rasterFunction?await this._initializeWithFunctionRaster(this.rasterFunction):this.raster=i}async _openFunctionRaster(e,t){const n={raster:this._primaryRasters[0]};this._primaryRasters.length>1&&this._primaryRasters.forEach((e=>n[e.url]=e));const r=(0,te.vt)(e.functionDefinition?.toJSON()??e.toJSON(),n),i=new ee({rasterFunction:r});return await i.open(t),i}async _initializeWithFunctionRaster(e,t){try{this.raster=await this._openFunctionRaster(e,t)}catch(e){e instanceof o.A&&a.A.getLogger(this).error("imagery-tile-layer:open",e.message),a.A.getLogger(this).warn("imagery-tile-layer:open","the raster function cannot be applied and is removed"),this._set("rasterFunction",null),this.raster=this._primaryRasters[0]}}};(0,r._)([(0,p.MZ)({clonable:!1})],mt.prototype,"_primaryRasters",void 0),(0,r._)([(0,p.MZ)(_.fV)],mt.prototype,"legendEnabled",void 0),(0,r._)([(0,p.MZ)({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],mt.prototype,"isReference",void 0),(0,r._)([(0,p.MZ)({type:["show","hide"]})],mt.prototype,"listMode",void 0),(0,r._)([(0,p.MZ)({json:{read:!0,write:!0}})],mt.prototype,"blendMode",void 0),(0,r._)([(0,p.MZ)()],mt.prototype,"sourceJSON",void 0),(0,r._)([(0,p.MZ)({readOnly:!0,json:{origins:{service:{read:{source:"currentVersion"}}}}})],mt.prototype,"version",void 0),(0,r._)([(0,p.MZ)({readOnly:!0,json:{read:!1}})],mt.prototype,"type",void 0),(0,r._)([(0,p.MZ)({type:["ArcGISTiledImageServiceLayer"]})],mt.prototype,"operationalLayerType",void 0),(0,r._)([(0,p.MZ)({type:Boolean,value:!0,json:{read:{source:"disablePopup",reader:(e,t)=>!t.disablePopup},write:{target:"disablePopup",overridePolicy(){return{enabled:!this.loaded||"Raster"===this.raster.tileType}},writer(e,t,n){t[n]=!e}}}})],mt.prototype,"popupEnabled",void 0),(0,r._)([(0,p.MZ)({type:i.A,json:{read:{source:"popupInfo"},write:{target:"popupInfo",overridePolicy(){return{enabled:!this.loaded||"Raster"===this.raster.tileType}}}}})],mt.prototype,"popupTemplate",void 0),(0,r._)([(0,p.MZ)({readOnly:!0})],mt.prototype,"defaultPopupTemplate",null),(0,r._)([(0,p.MZ)({readOnly:!0,type:[de.A]})],mt.prototype,"fields",void 0),(0,r._)([(0,p.MZ)({readOnly:!0,type:[de.A]})],mt.prototype,"rasterFields",null),(0,r._)([(0,p.MZ)({constructOnly:!0})],mt.prototype,"source",void 0),mt=(0,r._)([(0,d.$)("esri.layers.ImageryTileLayer")],mt);const yt=mt},74927:function(e,t,n){n.d(t,{b:function(){return l}});var r=n(53804),i=n(40633),s=n(23502),o=(n(58941),n(13798),n(65953)),a=n(93389);const l=e=>{let t=class extends e{get title(){if(this._get("title")&&"defaults"!==this.originOf("title"))return this._get("title");if(this.url){const e=(0,a.qg)(this.url);if(null!=e&&e.title)return e.title}return this._get("title")||""}set title(e){this._set("title",e)}set url(e){this._set("url",(0,a.Jf)(e,i.A.getLogger(this)))}};return(0,r._)([(0,s.MZ)()],t.prototype,"title",null),(0,r._)([(0,s.MZ)({type:String})],t.prototype,"url",null),t=(0,r._)([(0,o.$)("esri.layers.mixins.ArcGISService")],t),t}},88243:function(e,t,n){n.d(t,{d:function(){return o}});var r=n(53804),i=n(23502),s=(n(58941),n(40633),n(13798),n(65953));const o=e=>{let t=class extends e{constructor(){super(...arguments),this.customParameters=null}};return(0,r._)([(0,i.MZ)({type:Object,json:{write:{overridePolicy:e=>({enabled:!!(e&&Object.keys(e).length>0)})}}})],t.prototype,"customParameters",void 0),t=(0,r._)([(0,s.$)("esri.layers.mixins.CustomParametersMixin")],t),t}},92078:function(e,t,n){n.d(t,{q:function(){return v}});var r=n(53804),i=n(39819),s=n(90683),o=n(23502),a=n(67888),l=(n(13798),n(58941),n(47332)),u=n(65953),c=n(81392),p=n(64786),h=n(97354),f=n(99495);const d={ArcGISAnnotationLayer:!0,ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,CatalogLayer:!0,CSV:!0,GeoJSON:!0,GeoRSS:!0,GroupLayer:!0,KML:!0,KnowledgeGraphLayer:!0,MediaLayer:!0,OGCFeatureLayer:!0,OrientedImageryLayer:!0,SubtypeGroupLayer:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},m={ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,OpenStreetMap:!0,VectorTileLayer:!0,WMS:!0,WebTiledLayer:!0},y={ArcGISFeatureLayer:!0,SubtypeGroupTable:!0},g={"web-scene/operational-layers":{ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledElevationServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BuildingSceneLayer:!0,CatalogLayer:!0,CSV:!0,GeoJSON:!0,GroupLayer:!0,IntegratedMesh3DTilesLayer:!0,IntegratedMeshLayer:!0,KML:!0,LineOfSightLayer:!0,MediaLayer:!0,OGCFeatureLayer:!0,OrientedImageryLayer:!0,PointCloudLayer:!0,RasterDataLayer:!0,VectorTileLayer:!0,ViewshedLayer:!0,Voxel:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},"web-scene/basemap":{ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,WMS:!0,WebTiledLayer:!0},"web-scene/ground":{ArcGISTiledElevationServiceLayer:!0,RasterDataElevationLayer:!0},"web-scene/tables":{ArcGISFeatureLayer:!0},"web-map/operational-layers":d,"web-map/basemap":m,"web-map/tables":y,"link-chart/operational-layers":{...d,LinkChartLayer:!0},"link-chart/basemap":m,"link-chart/tables":y,"portal-item/operational-layers":{ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,BuildingSceneLayer:!0,IntegratedMesh3DTilesLayer:!0,IntegratedMeshLayer:!0,MediaLayer:!0,OrientedImageryLayer:!0,PointCloudLayer:!0,SubtypeGroupLayer:!0}};var w=n(7010),b=n(52038);const v=e=>{let t=class extends e{constructor(){super(...arguments),this.persistenceEnabled=!0,this.title=null}readId(e,t,n){return"Group Layer"===n?.portalItem?.type?void 0:e}writeListMode(e,t,n,r){(r&&"ground"===r.layerContainerType||e&&(0,f.R)(this,n,{},r))&&(t[n]=e)}writeOperationalLayerType(e,t,n,r){e&&"tables"!==r?.layerContainerType&&(t.layerType=e)}writeTitle(e,t){t.title=e??"Layer"}readTimeExtent(e){return e?b.A.fromArray(e):null}writeTimeExtent(e,t,n,r){e&&"tables"!==r.layerContainerType&&(e.isEmpty?r?.messages&&r.messages.push(new i.A("layer:invalid-visibilityTimeExtent","visibilityTimeExtent cannot be empty")):t[n]=e.toArray())}read(e,t){t&&(t.layer=this),(0,h.t)(this,e,(t=>super.read(e,t)),t)}write(e,t){if(!this.persistenceEnabled&&!t?.ignorePersistenceEnabled)return null;if(t?.origin){const e=`${t.origin}/${t.layerContainerType||"operational-layers"}`,n=g[e];let r=!!n?.[this.operationalLayerType];if("ArcGISTiledElevationServiceLayer"===this.operationalLayerType&&"web-scene/operational-layers"===e&&(r=!1),"ArcGISDimensionLayer"===this.operationalLayerType&&"web-map/operational-layers"===e&&(r=!1),!r)return t.messages?.push(new i.A("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${e}'`,{layer:this})),null}const n=super.write(e,{...t,layer:this}),r=!!t&&!!t.messages&&!!t.messages.filter((e=>e instanceof i.A&&"web-document-write:property-required"===e.name)).length;return(0,s.w8)(n?.url)?(t?.messages?.push(new i.A("layer:invalid-url",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Blob URL cannot be written to web scenes and web maps`,{layer:this})),null):!this.url&&r?null:n}beforeSave(){}};return(0,r._)([(0,o.MZ)({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],t.prototype,"id",void 0),(0,r._)([(0,l.w)("id",["id"])],t.prototype,"readId",null),(0,r._)([(0,o.MZ)(w.C1)],t.prototype,"listMode",void 0),(0,r._)([(0,c.K)("listMode")],t.prototype,"writeListMode",null),(0,r._)([(0,o.MZ)({type:String,readOnly:!0,json:{read:!1,write:{target:"layerType",ignoreOrigin:!0},origins:{"portal-item":{write:!1},"web-scene":{name:"layerType",read:!1,write:{enabled:!0,ignoreOrigin:!0,layerContainerTypes:p.K}}}}})],t.prototype,"operationalLayerType",void 0),(0,r._)([(0,c.K)("operationalLayerType")],t.prototype,"writeOperationalLayerType",null),(0,r._)([(0,o.MZ)(w.ke)],t.prototype,"opacity",void 0),(0,r._)([(0,o.MZ)({type:Boolean,readOnly:!1})],t.prototype,"persistenceEnabled",void 0),(0,r._)([(0,o.MZ)({type:String,json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}},"portal-item":{write:!1}}},value:"Layer"})],t.prototype,"title",void 0),(0,r._)([(0,c.K)("title"),(0,c.K)(["web-scene"],"title")],t.prototype,"writeTitle",null),(0,r._)([(0,o.MZ)({type:b.A,json:{origins:{"web-scene":{write:{layerContainerTypes:p.K}}}}})],t.prototype,"visibilityTimeExtent",void 0),(0,r._)([(0,l.w)("visibilityTimeExtent")],t.prototype,"readTimeExtent",null),(0,r._)([(0,c.K)(["portal-item","web-map","web-scene"],"visibilityTimeExtent",{visibilityTimeExtent:{type:[[a.jz,a.Uv]]}})],t.prototype,"writeTimeExtent",null),(0,r._)([(0,o.MZ)({type:Boolean,json:{origins:{"web-scene":{name:"visibility",write:{enabled:!0,layerContainerTypes:p.K}}},name:"visibility",write:!0}})],t.prototype,"visible",void 0),t=(0,r._)([(0,u.$)("esri.layers.mixins.OperationalLayer")],t),t}},61380:function(e,t,n){n.d(t,{A:function(){return M}});var r=n(53804),i=n(25591),s=n(7156),o=n(93040),a=n(77472),l=n(39819),u=n(40633),c=n(95929),p=n(60539),h=n(90683),f=n(23502),d=(n(58941),n(13798),n(47332)),m=n(65953),y=n(81392),g=n(11432),w=n(51432),b=n(43173),v=n(85956),x=n(29606);const M=e=>{let t=class extends e{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1}destroy(){this.portalItem=(0,c.pR)(this.portalItem),this.resourceReferences.portalItem=null,this.resourceReferences.paths.length=0}set portalItem(e){e!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",e))}readPortalItem(e,t,n){if(t.itemId)return new b.default({id:t.itemId,portal:n?.portal})}writePortalItem(e,t){e?.id&&(t.itemId=e.id)}async loadFromPortal(e,t){if(this.portalItem?.id)try{const{load:r}=await n.e(1536).then(n.bind(n,58615));return(0,p.Te)(t),await r({instance:this,supportedTypes:e.supportedTypes,validateItem:e.validateItem,supportsData:e.supportsData,layerModuleTypeMap:e.layerModuleTypeMap},t)}catch(e){throw(0,p.zf)(e)||u.A.getLogger(this).warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})\n  ${e}`),e}}async finishLoadEditablePortalLayer(e){this._set("userHasEditingPrivileges",await this._fetchUserHasEditingPrivileges(e).catch((e=>((0,p.QP)(e),!0))))}async setUserPrivileges(e,t){if(!i.default.userPrivilegesApplied)return this.finishLoadEditablePortalLayer(t);if(this.url)try{const{features:{edit:n,fullEdit:r},content:{updateItem:i}}=await this._fetchUserPrivileges(e,t);this._set("userHasEditingPrivileges",n),this._set("userHasFullEditingPrivileges",r),this._set("userHasUpdateItemPrivileges",i)}catch(e){(0,p.QP)(e)}}async _fetchUserPrivileges(e,t){let n=this.portalItem;if(!e||!n||!n.loaded||n.sourceUrl)return this._fetchFallbackUserPrivileges(t);const r=e===n.id;if(r&&n.portal.user)return(0,x.It)(n);let i,o;if(r)i=n.portal.url;else try{i=await(0,g.wI)(this.url,t)}catch(e){(0,p.QP)(e)}if(!i||!(0,h.b8)(i,n.portal.url))return this._fetchFallbackUserPrivileges(t);try{const e=null!=t?t.signal:null;o=await(s.id?.getCredential(`${i}/sharing`,{prompt:!1,signal:e}))}catch(e){(0,p.QP)(e)}const a=!0,l=!1,u=!1;if(!o)return{features:{edit:a,fullEdit:l},content:{updateItem:u}};try{if(r?await n.reload():(n=new b.default({id:e,portal:{url:i}}),await n.load(t)),n.portal.user)return(0,x.It)(n)}catch(e){(0,p.QP)(e)}return{features:{edit:a,fullEdit:l},content:{updateItem:u}}}async _fetchFallbackUserPrivileges(e){let t=!0;try{t=await this._fetchUserHasEditingPrivileges(e)}catch(e){(0,p.QP)(e)}return{features:{edit:t,fullEdit:!1},content:{updateItem:!1}}}async _fetchUserHasEditingPrivileges(e){const t=this.url?s.id?.findCredential(this.url):null;if(!t)return!0;const n=A.credential===t?A.user:await this._fetchEditingUser(e);return A.credential=t,A.user=n,null==n?.privileges||n.privileges.includes("features:user:edit")}async _fetchEditingUser(e){const t=this.portalItem?.portal?.user;if(t)return t;const n=s.id?.findServerInfo(this.url??"");if(!n?.owningSystemUrl)return null;const r=`${n.owningSystemUrl}/sharing/rest`,i=w.A.getDefault();if(i&&i.loaded&&(0,h.S8)(i.restUrl)===(0,h.S8)(r))return i.user;const l=`${r}/community/self`,u=null!=e?e.signal:null,c=await(0,a.Ke)((0,o.A)(l,{authMode:"no-prompt",query:{f:"json"},signal:u}));return c.ok?v.A.fromJSON(c.value.data):null}read(e,t){t&&(t.layer=this),super.read(e,t)}write(e,t){const n=t?.portal,r=this.portalItem?.id&&(this.portalItem.portal||w.A.getDefault());return n&&r&&!(0,h.ut)(r.restUrl,n.restUrl)?(t.messages&&t.messages.push(new l.A("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(e,{...t,layer:this})}};return(0,r._)([(0,f.MZ)({type:b.default})],t.prototype,"portalItem",null),(0,r._)([(0,d.w)("web-document","portalItem",["itemId"])],t.prototype,"readPortalItem",null),(0,r._)([(0,y.K)("web-document","portalItem",{itemId:{type:String}})],t.prototype,"writePortalItem",null),(0,r._)([(0,f.MZ)({clonable:!1})],t.prototype,"resourceReferences",void 0),(0,r._)([(0,f.MZ)({type:Boolean,readOnly:!0})],t.prototype,"userHasEditingPrivileges",void 0),(0,r._)([(0,f.MZ)({type:Boolean,readOnly:!0})],t.prototype,"userHasFullEditingPrivileges",void 0),(0,r._)([(0,f.MZ)({type:Boolean,readOnly:!0})],t.prototype,"userHasUpdateItemPrivileges",void 0),t=(0,r._)([(0,m.$)("esri.layers.mixins.PortalLayer")],t),t},A={credential:null,user:null}},28366:function(e,t,n){n.d(t,{H:function(){return f}});var r=n(53804),i=n(23502),s=(n(58941),n(40633),n(13798),n(65953)),o=n(92778),a=n(75743),l=n(30905),u=n(67888),c=n(74376);let p=class extends((0,a.O)(l.oY)){constructor(e){super(e),this.name=void 0,this.method="none",this.value=void 0,this.bandIds=void 0,this.renderer=void 0}};(0,r._)([(0,i.MZ)({type:String,json:{write:!0}})],p.prototype,"name",void 0),(0,r._)([(0,i.MZ)({type:["raster-function-template","variable","none"],json:{write:!0}}),(0,c.e)({rasterFunctionTemplate:"raster-function-template",variable:"variable",none:"none"})],p.prototype,"method",void 0),(0,r._)([(0,i.MZ)({type:String,json:{write:!0}})],p.prototype,"value",void 0),(0,r._)([(0,i.MZ)({type:[u.jz],json:{write:!0}})],p.prototype,"bandIds",void 0),(0,r._)([(0,i.MZ)({types:o.uy,json:{write:!0,origins:{"web-scene":{types:o.Gj,write:{overridePolicy:e=>({enabled:e&&"vector-field"!==e.type&&"flow"!==e.type})}}}}})],p.prototype,"renderer",void 0),p=(0,r._)([(0,s.$)("esri.renderers.support.RasterPresetRenderer")],p);const h=p,f=e=>{let t=class extends e{constructor(){super(...arguments),this.activePresetRendererName=null,this.presetRenderers=null}};return(0,r._)([(0,i.MZ)({type:String,json:{name:"layerDefinition.activePresetRendererName",write:{allowNull:!0}}})],t.prototype,"activePresetRendererName",void 0),(0,r._)([(0,i.MZ)({type:[h],json:{name:"layerDefinition.presetRenderers",write:!0}})],t.prototype,"presetRenderers",void 0),t=(0,r._)([(0,s.$)("esri.layers.mixins.RasterPresetRendererMixin")],t),t}},70652:function(e,t,n){n.d(t,{J:function(){return b}});var r=n(53804),i=(n(58941),n(40633)),s=n(60539),o=n(23502),a=n(77560),l=(n(13798),n(65953)),u=n(64786),c=n(78879),p=n(28181),h=n(25638);const f=new c.A,d=new WeakMap;function m(e,t){return Number.isFinite(e)&&Number.isFinite(t)?t<=0?e:m(t,e%t):0}let y=0,g=0;function w(){const e=Date.now();let t=!1;for(const n of f){const r=n.deref();r?r.refreshInterval&&e-(d.get(r)??0)+5>=6e4*r.refreshInterval&&(d.set(r,e),r.refresh(e)):t=!0}if(t)for(let e=f.length-1;e>=0;e--)f.at(e).deref()||f.removeAt(e)}(0,h.fm)((()=>{const e=Date.now();let t=0;for(const n of f){const r=n.deref();r&&(t=m(Math.round(6e4*r.refreshInterval),t),r.refreshInterval?d.get(r)||d.set(r,e):d.delete(r))}if(t!==g){if(g=t,clearInterval(y),0===g)return void(y=0);y=setInterval(w,g)}}),p.OH);const b=e=>{let t=class extends e{constructor(...e){super(...e),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=(0,s.sg)((()=>this.hasDataChanged())),this.when().then((()=>{this.destroyed||function(e){(function(e){return null!=e&&"object"==typeof e&&"refreshInterval"in e&&"refresh"in e})(e)&&f.push(new WeakRef(e))}(this)}),(()=>{}))}destroy(){!function(e){const t=f.find((t=>t.deref()===e));t&&f.remove(t)}(this)}castRefreshInterval(e){return e>=.1?e:e<=0?0:.1}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(e=Date.now()){(0,s.QZ)(this._debounceHasDataChanged()).then((t=>{t&&this._set("refreshTimestamp",e),this.emit("refresh",{dataChanged:t})}),(e=>{i.A.getLogger(this).error(e),this.emit("refresh",{dataChanged:!1,error:e})}))}async hasDataChanged(){return!0}get test(){}};return(0,r._)([(0,o.MZ)({type:Number,json:{write:!0,origins:{"web-scene":{write:{enabled:!0,layerContainerTypes:u.K}}}}})],t.prototype,"refreshInterval",void 0),(0,r._)([(0,a.w)("refreshInterval")],t.prototype,"castRefreshInterval",null),(0,r._)([(0,o.MZ)({readOnly:!0})],t.prototype,"refreshTimestamp",void 0),(0,r._)([(0,o.MZ)({readOnly:!0})],t.prototype,"refreshParameters",null),t=(0,r._)([(0,l.$)("esri.layers.mixins.RefreshableLayer")],t),t}},85924:function(e,t,n){n.d(t,{B:function(){return f},e:function(){return d}});var r=n(53804),i=n(23502),s=(n(58941),n(40633),n(13798),n(47332)),o=n(65953),a=n(64786),l=n(53743),u=n(36143),c=n(35060),p=n(52038),h=n(92427);const f={type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation",layerContainerTypes:a.K}}},d=e=>{let t=class extends e{constructor(){super(...arguments),this.timeExtent=null,this.timeOffset=null,this.useViewTime=!0}readOffset(e,t){const n=t.timeInfo.exportOptions;if(!n)return null;const r=n.timeOffset,i=c.j.fromJSON(n.timeOffsetUnits);return r&&i?new h.A({value:r,unit:i}):null}set timeInfo(e){(0,l.sv)(e,this.fieldsIndex),this._set("timeInfo",e)}};return(0,r._)([(0,i.MZ)({type:p.A,json:{write:!1}})],t.prototype,"timeExtent",void 0),(0,r._)([(0,i.MZ)({type:h.A})],t.prototype,"timeOffset",void 0),(0,r._)([(0,s.w)("service","timeOffset",["timeInfo.exportOptions"])],t.prototype,"readOffset",null),(0,r._)([(0,i.MZ)({value:null,type:u.A,json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],t.prototype,"timeInfo",null),(0,r._)([(0,i.MZ)(f)],t.prototype,"useViewTime",void 0),t=(0,r._)([(0,o.$)("esri.layers.mixins.TemporalLayer")],t),t}},7860:function(e,t,n){n.d(t,{A:function(){return p}});var r,i=n(53804),s=n(30905),o=n(21609),a=n(23502),l=n(67888),u=n(65953);let c=r=class extends s.oY{constructor(e){super(e),this.variableName=null,this.dimensionName=null,this.values=[],this.isSlice=!1}clone(){return new r({variableName:this.variableName,dimensionName:this.dimensionName,values:(0,o.o8)(this.values),isSlice:this.isSlice})}};(0,i._)([(0,a.MZ)({type:String,json:{write:!0}})],c.prototype,"variableName",void 0),(0,i._)([(0,a.MZ)({type:String,json:{write:!0}})],c.prototype,"dimensionName",void 0),(0,i._)([(0,a.MZ)({type:l.gK.array(l.gK.oneOf([l.gK.native(Number),l.gK.array(l.gK.native(Number))])),json:{write:!0}})],c.prototype,"values",void 0),(0,i._)([(0,a.MZ)({type:Boolean,json:{write:!0}})],c.prototype,"isSlice",void 0),c=r=(0,i._)([(0,u.$)("esri.layers.support.DimensionalDefinition")],c);const p=c},44431:function(e,t,n){n.d(t,{A:function(){return c}});var r,i=n(53804),s=n(30905),o=n(23502),a=n(67888),l=(n(13798),n(58941),n(65953));let u=r=class extends s.oY{constructor(e){super(e),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new r({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};(0,i._)([(0,o.MZ)({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],u.prototype,"cols",void 0),(0,i._)([(0,o.MZ)({type:a.jz,json:{write:!0}})],u.prototype,"level",void 0),(0,i._)([(0,o.MZ)({type:String,json:{write:!0}})],u.prototype,"levelValue",void 0),(0,i._)([(0,o.MZ)({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],u.prototype,"origin",void 0),(0,i._)([(0,o.MZ)({type:Number,json:{write:!0}})],u.prototype,"resolution",void 0),(0,i._)([(0,o.MZ)({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],u.prototype,"rows",void 0),(0,i._)([(0,o.MZ)({type:Number,json:{write:!0}})],u.prototype,"scale",void 0),u=r=(0,i._)([(0,l.$)("esri.layers.support.LOD")],u);const c=u},84284:function(e,t,n){n.d(t,{A:function(){return v}});var r,i=n(53804),s=n(73037),o=n(30905),a=n(21609),l=n(23502),u=n(77560),c=n(47332),p=n(65953),h=n(81392),f=n(67888),d=n(45532),m=n(7860),y=n(77345);const g=(0,s.O)()({MT_FIRST:"first",MT_LAST:"last",MT_MIN:"min",MT_MAX:"max",MT_MEAN:"mean",MT_BLEND:"blend",MT_SUM:"sum"}),w=(0,s.O)()({esriMosaicNone:"none",esriMosaicCenter:"center",esriMosaicNadir:"nadir",esriMosaicViewpoint:"viewpoint",esriMosaicAttribute:"attribute",esriMosaicLockRaster:"lock-raster",esriMosaicNorthwest:"northwest",esriMosaicSeamline:"seamline"});let b=r=class extends o.oY{constructor(e){super(e),this.ascending=!0,this.itemRasterFunction=null,this.lockRasterIds=null,this.method=null,this.multidimensionalDefinition=null,this.objectIds=null,this.operation=null,this.sortField=null,this.sortValue=null,this.viewpoint=null,this.where=null}readAscending(e,t){return null!=t.ascending?t.ascending:null==t.sortAscending||t.sortAscending}readMethod(e,t){return function(e){let t;switch(e?e.toLowerCase().replace("esrimosaic",""):""){case"byattribute":case"attribute":t="esriMosaicAttribute";break;case"lockraster":t="esriMosaicLockRaster";break;case"center":t="esriMosaicCenter";break;case"northwest":t="esriMosaicNorthwest";break;case"nadir":t="esriMosaicNadir";break;case"viewpoint":t="esriMosaicViewpoint";break;case"seamline":t="esriMosaicSeamline";break;default:t="esriMosaicNone"}return w.fromJSON(t)}(t.mosaicMethod||t.defaultMosaicMethod)}writeMultidimensionalDefinition(e,t,n){null!=e&&(e=e.filter((({variableName:e,dimensionName:t})=>e&&"*"!==e||t))).length&&(t[n]=e.map((e=>e.toJSON())))}readOperation(e,t){const n=t.mosaicOperation,r=t.mosaicOperator?.toLowerCase(),i=n||(r?g.toJSON(r):null);return g.fromJSON(i)||"first"}castSortValue(e){return null==e||"string"==typeof e||"number"==typeof e?e:`${e}`}clone(){return new r({ascending:this.ascending,itemRasterFunction:(0,a.o8)(this.itemRasterFunction),lockRasterIds:(0,a.o8)(this.lockRasterIds),method:this.method,multidimensionalDefinition:(0,a.o8)(this.multidimensionalDefinition),objectIds:(0,a.o8)(this.objectIds),operation:this.operation,sortField:this.sortField,sortValue:this.sortValue,viewpoint:(0,a.o8)(this.viewpoint),where:this.where})}};(0,i._)([(0,l.MZ)({type:Boolean,json:{write:!0}})],b.prototype,"ascending",void 0),(0,i._)([(0,c.w)("ascending",["ascending","sortAscending"])],b.prototype,"readAscending",null),(0,i._)([(0,l.MZ)({type:y.A,json:{name:"itemRenderingRule",write:!0}})],b.prototype,"itemRasterFunction",void 0),(0,i._)([(0,l.MZ)({type:[f.jz],json:{write:{overridePolicy(){return{enabled:"lock-raster"===this.method}}}}})],b.prototype,"lockRasterIds",void 0),(0,i._)([(0,l.MZ)({type:String,json:{type:w.jsonValues,write:{target:"mosaicMethod",writer:w.write}}})],b.prototype,"method",void 0),(0,i._)([(0,c.w)("method",["mosaicMethod","defaultMosaicMethod"])],b.prototype,"readMethod",null),(0,i._)([(0,l.MZ)({type:[m.A],json:{write:!0}})],b.prototype,"multidimensionalDefinition",void 0),(0,i._)([(0,h.K)("multidimensionalDefinition")],b.prototype,"writeMultidimensionalDefinition",null),(0,i._)([(0,l.MZ)({type:[f.jz],json:{name:"fids",write:!0}})],b.prototype,"objectIds",void 0),(0,i._)([(0,l.MZ)({json:{type:g.jsonValues,read:{reader:g.read},write:{target:"mosaicOperation",writer:g.write}}})],b.prototype,"operation",void 0),(0,i._)([(0,c.w)("operation",["mosaicOperation","mosaicOperator"])],b.prototype,"readOperation",null),(0,i._)([(0,l.MZ)({type:String,json:{write:{overridePolicy(){return{enabled:"attribute"===this.method}}}}})],b.prototype,"sortField",void 0),(0,i._)([(0,l.MZ)({type:[String,Number],json:{write:{allowNull:!0,overridePolicy(){return{enabled:"attribute"===this.method,allowNull:!0}}}}})],b.prototype,"sortValue",void 0),(0,i._)([(0,u.w)("sortValue")],b.prototype,"castSortValue",null),(0,i._)([(0,l.MZ)({type:d.default,json:{write:!0}})],b.prototype,"viewpoint",void 0),(0,i._)([(0,l.MZ)({type:String,json:{write:!0}})],b.prototype,"where",void 0),b=r=(0,i._)([(0,p.$)("esri.layers.support.MosaicRule")],b);const v=b},66362:function(e,t,n){n.d(t,{A:function(){return d}});var r,i=n(53804),s=(n(50917),n(30905)),o=n(23502),a=(n(58941),n(40633),n(13798),n(65953)),l=n(91484),u=n(44740),c=n(74697),p=n(7860);const h={base:n(46556).A,key:"type",typeMap:{extent:l.default,polygon:u.A}};let f=r=class extends s.oY{constructor(e){super(e),this.areaOfInterest=null,this.subsetDefinitions=null}get dimensions(){const{subsetDefinitions:e}=this;if(null==e||0===e.length)return[];const t=new Map;e.forEach((e=>{if(!e.dimensionName)return;let n,r;if(Array.isArray(e.values[0])){const t=e.values;n=t[0][0],r=t[e.values.length-1][1]}else{const t=e.values;n=t[0],r=t[e.values.length-1]}if(t.has(e.dimensionName)){const i=t.get(e.dimensionName);i[0]=Math.min(n,i[0]),i[1]=Math.max(r,i[1])}else t.set(e.dimensionName,[n,r])}));const n=[];for(const e of t)n.push({name:e[0],extent:e[1]});return n}get variables(){const{subsetDefinitions:e}=this;if(null==e||0===e.length)return[];const t=new Set;return e.forEach((e=>{e.variableName&&t.add(e.variableName)})),[...t]}clone(){const e=this.subsetDefinitions?.map((e=>e.clone())),t=this.areaOfInterest?this.areaOfInterest.clone():this.areaOfInterest;return new r({areaOfInterest:t,subsetDefinitions:e})}};(0,i._)([(0,o.MZ)({types:h,json:{read:c.rS,write:!0}})],f.prototype,"areaOfInterest",void 0),(0,i._)([(0,o.MZ)({readOnly:!0})],f.prototype,"dimensions",null),(0,i._)([(0,o.MZ)({readOnly:!0})],f.prototype,"variables",null),(0,i._)([(0,o.MZ)({type:[p.A],json:{write:!0}})],f.prototype,"subsetDefinitions",void 0),f=r=(0,i._)([(0,a.$)("esri.layers.support.MultidimensionalSubset")],f);const d=f},21327:function(e,t,n){n.d(t,{A:function(){return m}});var r,i=n(53804),s=n(39819),o=n(30905),a=n(21609),l=n(40633),u=n(23502),c=n(77560),p=n(65953),h=n(42568),f=n(95738);let d=r=class extends o.oY{static createEmptyBand(e,t){return new(r.getPixelArrayConstructor(e))(t)}static combineBandMasks(e){if(e.length<2)return e[0];const t=e[0].length,n=new Uint8Array(t).fill(255);for(let r=0;r<e.length;r++){const i=e[r];for(let e=0;e<t;e++)i[e]||(n[e]=0)}return n}static getPixelArrayConstructor(e){let t;switch(e){case"u1":case"u2":case"u4":case"u8":t=Uint8Array;break;case"u16":t=Uint16Array;break;case"u32":t=Uint32Array;break;case"s8":t=Int8Array;break;case"s16":t=Int16Array;break;case"s32":t=Int32Array;break;case"f32":case"c64":case"c128":case"unknown":t=Float32Array;break;case"f64":t=Float64Array}return t}constructor(e){super(e),this.width=null,this.height=null,this.pixelType="f32",this.validPixelCount=null,this.mask=null,this.maskIsAlpha=!1,this.premultiplyAlpha=!1,this.statistics=null,this.depthCount=1}castPixelType(e){if(!e)return"f32";let t=e.toLowerCase();return["u1","u2","u4"].includes(t)?t="u8":["unknown","u8","s8","u16","s16","u32","s32","f32","f64"].includes(t)||(t="f32"),t}getPlaneCount(){return this.pixels?.length}addData(e){if(!e.pixels||e.pixels.length!==this.width*this.height)throw new s.A("pixelblock:invalid-or-missing-pixels","add data requires valid pixels array that has same length defined by pixel block width * height");this.pixels||(this.pixels=[]),this.statistics||(this.statistics=[]),this.pixels.push(e.pixels),this.statistics.push(e.statistics??new h.z)}getAsRGBA(){const e=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case"s8":case"s16":case"u16":case"s32":case"u32":case"f32":case"f64":this._fillFromNon8Bit(e);break;default:this._fillFrom8Bit(e)}return new Uint8ClampedArray(e)}getAsRGBAFloat(){const e=new Float32Array(this.width*this.height*4);return this._fillFrom32Bit(e),e}updateStatistics(){if(!this.pixels)return;this.statistics=this.pixels.map((e=>function(e,t){let n=1/0,r=-1/0;const i=e.length;let s,o=0;if(null!=t)for(s=0;s<i;s++)t[s]&&(o=e[s],n=o<n?o:n,r=o>r?o:r);else for(s=0;s<i;s++)o=e[s],n=o<n?o:n,r=o>r?o:r;return new h.z(n,r)}(e,this.mask)));const e=this.mask;let t=0;if(null!=e)for(let n=0;n<e.length;n++)e[n]&&t++;else t=this.width*this.height;this.validPixelCount=t}clamp(e){if(!e||"f64"===e||"f32"===e||!this.pixels)return;const[t,n]=(0,f.hP)(e),i=this.pixels,s=this.width*this.height,o=i.length;let a,l,u;const c=[];for(let p=0;p<o;p++){u=r.createEmptyBand(e,s),a=i[p];for(let e=0;e<s;e++)l=a[e],u[e]=l>n?n:l<t?t:l;c.push(u)}this.pixels=c,this.pixelType=e}extractBands(e){const{pixels:t,statistics:n}=this;if(null==e||0===e.length||!t||0===t.length)return this;const i=t.length,s=e.some((e=>e>=t.length)),o=i===e.length&&!e.some(((e,t)=>e!==t));if(s||o)return this;const a=this.bandMasks?.length===i?e.map((e=>this.bandMasks[e])):void 0;let{mask:l,validPixelCount:u}=this;const{width:c,height:p}=this;return a?.length&&(l=r.combineBandMasks(a),u=l.filter((e=>!!e)).length),new r({pixelType:this.pixelType,width:c,height:p,mask:l,bandMasks:a,validPixelCount:u,maskIsAlpha:this.maskIsAlpha,pixels:e.map((e=>t[e])),statistics:n&&e.map((e=>n[e]))})}clone(){const e=new r({width:this.width,height:this.height,pixelType:this.pixelType,maskIsAlpha:this.maskIsAlpha,validPixelCount:this.validPixelCount});let t;null!=this.mask&&(e.mask=new Uint8Array(this.mask)),this.bandMasks&&(e.bandMasks=this.bandMasks.map((e=>new Uint8Array(e))));const n=r.getPixelArrayConstructor(this.pixelType);if(this.pixels&&this.pixels.length>0){e.pixels=[];const r=!!this.pixels[0].slice;for(t=0;t<this.pixels.length;t++)e.pixels[t]=r?this.pixels[t].slice():new n(this.pixels[t])}if(this.statistics)for(e.statistics=[],t=0;t<this.statistics.length;t++)e.statistics[t]=(0,a.o8)(this.statistics[t]);return e.premultiplyAlpha=this.premultiplyAlpha,e}_fillFrom8Bit(e){const{mask:t,maskIsAlpha:n,premultiplyAlpha:r,pixels:i}=this;if(!e||!i?.length)return void l.A.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.");let s,o,a,u;s=o=a=i[0],i.length>=3?(o=i[1],a=i[2]):2===i.length&&(o=i[1]);const c=new Uint32Array(e),p=this.width*this.height;if(s.length===p)if(null!=t&&t.length===p)if(n)for(u=0;u<p;u++){const e=t[u];if(e){const t=e/255;c[u]=r?e<<24|a[u]*t<<16|o[u]*t<<8|s[u]*t:e<<24|a[u]<<16|o[u]<<8|s[u]}}else for(u=0;u<p;u++)t[u]&&(c[u]=255<<24|a[u]<<16|o[u]<<8|s[u]);else for(u=0;u<p;u++)c[u]=255<<24|a[u]<<16|o[u]<<8|s[u];else l.A.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.")}_fillFromNon8Bit(e){const{pixels:t,mask:n,statistics:r}=this;if(!e||!t?.length)return void l.A.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.");const i=this.pixelType;let s=1,o=0,a=1;if(r&&r.length>0){for(const e of r)if(null!=e.minValue&&(o=Math.min(o,e.minValue)),null!=e.maxValue&&null!=e.minValue){const t=e.maxValue-e.minValue;a=Math.max(a,t)}s=255/a}else{let e=255;"s8"===i?(o=-128,e=127):"u16"===i?e=65535:"s16"===i?(o=-32768,e=32767):"u32"===i?e=4294967295:"s32"===i?(o=-2147483648,e=2147483647):"f32"===i?(o=-34e38,e=34e38):"f64"===i&&(o=-Number.MAX_VALUE,e=Number.MAX_VALUE),s=255/(e-o)}const u=new Uint32Array(e),c=this.width*this.height;let p,h,f,d,m;if(p=h=f=t[0],p.length!==c)return l.A.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");if(t.length>=2)if(h=t[1],t.length>=3&&(f=t[2]),null!=n&&n.length===c)for(d=0;d<c;d++)n[d]&&(u[d]=255<<24|(f[d]-o)*s<<16|(h[d]-o)*s<<8|(p[d]-o)*s);else for(d=0;d<c;d++)u[d]=255<<24|(f[d]-o)*s<<16|(h[d]-o)*s<<8|(p[d]-o)*s;else if(null!=n&&n.length===c)for(d=0;d<c;d++)m=(p[d]-o)*s,n[d]&&(u[d]=255<<24|m<<16|m<<8|m);else for(d=0;d<c;d++)m=(p[d]-o)*s,u[d]=255<<24|m<<16|m<<8|m}_fillFrom32Bit(e){const{pixels:t,mask:n}=this;if(!e||!t?.length)return l.A.getLogger(this).error("getAsRGBAFloat()","Unable to convert to RGBA. The input pixel block is empty.");let r,i,s,o;r=i=s=t[0],t.length>=3?(i=t[1],s=t[2]):2===t.length&&(i=t[1]);const a=this.width*this.height;if(r.length!==a)return l.A.getLogger(this).error("getAsRGBAFloat()","Unable to convert to RGBA. The pixelblock is invalid.");let u=0;if(null!=n&&n.length===a)for(o=0;o<a;o++)e[u++]=r[o],e[u++]=i[o],e[u++]=s[o],e[u++]=1&n[o];else for(o=0;o<a;o++)e[u++]=r[o],e[u++]=i[o],e[u++]=s[o],e[u++]=1}};(0,i._)([(0,u.MZ)({json:{write:!0}})],d.prototype,"width",void 0),(0,i._)([(0,u.MZ)({json:{write:!0}})],d.prototype,"height",void 0),(0,i._)([(0,u.MZ)({json:{write:!0}})],d.prototype,"pixelType",void 0),(0,i._)([(0,c.w)("pixelType")],d.prototype,"castPixelType",null),(0,i._)([(0,u.MZ)({json:{write:!0}})],d.prototype,"validPixelCount",void 0),(0,i._)([(0,u.MZ)({json:{write:!0}})],d.prototype,"mask",void 0),(0,i._)([(0,u.MZ)({json:{write:!0}})],d.prototype,"maskIsAlpha",void 0),(0,i._)([(0,u.MZ)({json:{write:!0}})],d.prototype,"pixels",void 0),(0,i._)([(0,u.MZ)()],d.prototype,"premultiplyAlpha",void 0),(0,i._)([(0,u.MZ)({json:{write:!0}})],d.prototype,"statistics",void 0),(0,i._)([(0,u.MZ)({json:{write:!0}})],d.prototype,"depthCount",void 0),(0,i._)([(0,u.MZ)({json:{write:!0}})],d.prototype,"noDataValues",void 0),(0,i._)([(0,u.MZ)({json:{write:!0}})],d.prototype,"bandMasks",void 0),d=r=(0,i._)([(0,p.$)("esri.layers.support.PixelBlock")],d);const m=d},77345:function(e,t,n){n.d(t,{A:function(){return N}});var r=n(53804),i=n(30905),s=n(21609),o=n(23502),a=(n(58941),n(40633),n(74376)),l=n(47332),u=n(65953),c=n(81392),p=n(73037),h=n(67888),f=(n(13798),n(32405));let d=class extends i.oY{constructor(){super(...arguments),this.pixelType="unknown"}};(0,r._)([(0,o.MZ)({type:String,json:{write:!0}})],d.prototype,"name",void 0),(0,r._)([(0,o.MZ)({type:String,json:{write:!0}})],d.prototype,"description",void 0),(0,r._)([(0,o.MZ)({type:h.jz,json:{type:h.jz,write:!0,name:"_object_id"}})],d.prototype,"id",void 0),(0,r._)([(0,o.MZ)({type:String,json:{type:f.e8.jsonValues,read:f.e8.read,write:f.e8.write}})],d.prototype,"pixelType",void 0),(0,r._)([(0,o.MZ)({type:String,json:{write:!0}})],d.prototype,"type",void 0),d=(0,r._)([(0,u.$)("esri.layers.support.RasterFunctionInfo")],d);const m=d;let y=class extends i.oY{constructor(){super(...arguments),this.isDataset=!1,this.isPublic=!1,this.type="RasterFunctionVariable"}};(0,r._)([(0,o.MZ)({type:String,json:{write:!0}})],y.prototype,"name",void 0),(0,r._)([(0,o.MZ)({type:Number,json:{type:h.jz,write:!0,name:"_object_id"}})],y.prototype,"id",void 0),(0,r._)([(0,o.MZ)({type:Boolean,json:{write:!0}})],y.prototype,"isDataset",void 0),(0,r._)([(0,o.MZ)({type:Boolean,json:{write:!0}})],y.prototype,"isPublic",void 0),(0,r._)([(0,o.MZ)({json:{write:!0}})],y.prototype,"value",void 0),(0,r._)([(0,o.MZ)({type:String,json:{write:!0}})],y.prototype,"type",void 0),y=(0,r._)([(0,u.$)("esri.layers.support.RasterFunctionVariable")],y);const g={key:"type",base:null,typeMap:{RasterFunctionVariable:y}};let w=class extends i.oY{};(0,r._)([(0,o.MZ)({types:g,json:{types:g,name:"MatchVariable"}})],w.prototype,"matchVariable",void 0),(0,r._)([(0,o.MZ)({types:g,json:{types:g,name:"UnionDimension"}})],w.prototype,"unionDimension",void 0),(0,r._)([(0,o.MZ)({type:Number,json:{type:h.jz,write:!0,name:"_object_id"}})],w.prototype,"id",void 0),(0,r._)([(0,o.MZ)({type:String,json:{write:!0}})],w.prototype,"type",void 0),w=(0,r._)([(0,u.$)("esri.layers.support.RasterFunctionProperties")],w);const b=w,v=new p.J({0:"mosaic",1:"item",2:"item-group"},{useNumericKeys:!0});let x=class extends i.oY{constructor(){super(...arguments),this.functionType="mosaic",this.type="RasterFunctionTemplate"}};(0,r._)([(0,o.MZ)({type:[String],json:{write:!0}})],x.prototype,"aliases",void 0),(0,r._)([(0,o.MZ)({type:Object,json:{write:!0}})],x.prototype,"arguments",void 0),(0,r._)([(0,o.MZ)({type:String,json:{write:!0}})],x.prototype,"description",void 0),(0,r._)([(0,o.MZ)({type:m,json:{write:!0,name:"function"}})],x.prototype,"functionInfo",void 0),(0,r._)([(0,o.MZ)({type:v.apiValues,json:{type:[0,1,2],read:v.read,write:v.write}})],x.prototype,"functionType",void 0),(0,r._)([(0,o.MZ)({type:String,json:{write:!0}})],x.prototype,"group",void 0),(0,r._)([(0,o.MZ)({type:String,json:{write:!0}})],x.prototype,"help",void 0),(0,r._)([(0,o.MZ)({type:Number,json:{type:h.jz,write:!0,name:"_object_id"}})],x.prototype,"id",void 0),(0,r._)([(0,o.MZ)({type:String,json:{write:!0}})],x.prototype,"name",void 0),(0,r._)([(0,o.MZ)({type:String,json:{write:!0,name:"definition"}})],x.prototype,"queryDefinition",void 0),(0,r._)([(0,o.MZ)({type:String,json:{write:!0}})],x.prototype,"tag",void 0),(0,r._)([(0,o.MZ)({type:b,json:{write:!0}})],x.prototype,"properties",void 0),(0,r._)([(0,o.MZ)({type:String,json:{write:!0}})],x.prototype,"thumbnail",void 0),(0,r._)([(0,o.MZ)({type:String,json:{write:!0}})],x.prototype,"thumbnailEx",void 0),(0,r._)([(0,o.MZ)({json:{type:["RasterFunctionTemplate"],write:!0}})],x.prototype,"type",void 0),x=(0,r._)([(0,u.$)("esri.layers.support.RasterFunctionTemplate")],x);const M=x;var A;const I=new Set(["raster","raster2","dem","fillraster"]),S=new Set(["rasters"]),_=e=>e?.rasterFunction?P.fromJSON(e):e,C=e=>e&&e instanceof P?e.toJSON():e,T=e=>e?.functionName&&!e.declaredClass,k=e=>T(e)?new P(e):e,R={types:{key:"type",base:null,typeMap:{RasterFunctionTemplate:M}},json:{write:!0,name:"rasterFunctionDefinition"}};let P=A=class extends i.oY{constructor(e){super(e),this.functionName=null,this.outputPixelType="unknown",this.variableName=null,this.functionDefinition=null}set functionArguments(e){if(e){const t=Object.keys(e);if(t.some((t=>I.has(t.toLowerCase())&&T(e[t])))||t.some((t=>S.has(t.toLowerCase())&&Array.isArray(e[t])&&e[t].some((e=>T(e)))))){e=(0,s.o8)(e);for(const n of t)I.has(n.toLowerCase())?e[n]=k(e[n]):S.has(n.toLowerCase())&&Array.isArray(e[n])&&(e[n]=e[n].map((e=>k(e))))}}this._set("functionArguments",e)}readFunctionArguments(e){return(e=>{if(null==e)return null;e=(0,s.o8)(e);const t={};for(const n of Object.keys(e))I.has(n.toLowerCase())?t[n]=_(e[n]):S.has(n.toLowerCase())&&Array.isArray(e[n])?t[n]=e[n].map(_):t[n]=e[n];return t})(e)}writeFunctionArguments(e,t,n){const r={};for(const t of Object.keys(e))I.has(t.toLowerCase())?r[t]=C(e[t]):S.has(t.toLowerCase())&&Array.isArray(e[t])?r[t]=e[t].map(C):r[t]=C(e[t]);t[n]=r}readFunctionName(e,t){const n=t.rasterFunctionInfos;return t.name||(n?.length&&"None"!==n[0].name?n[0].name:t.rasterFunction||t.rasterFunctionDefinition?.name)}get rasterFunctionDefinition(){return this.functionDefinition?.toJSON()}set rasterFunctionDefinition(e){this.functionDefinition=e?M.fromJSON(e):null}get hasClipFunction(){return this.rasterFunctionDefinition?JSON.stringify(this.rasterFunctionDefinition).includes('"type":"ClipFunction"'):JSON.stringify(this).includes('"rasterFunction":"Clip"')}clone(){return new A({functionName:this.functionName,functionArguments:(0,s.o8)(this.functionArguments),outputPixelType:this.outputPixelType,variableName:this.variableName,rasterFunctionDefinition:(0,s.o8)(this.rasterFunctionDefinition)})}};(0,r._)([(0,o.MZ)({json:{type:Object,name:"rasterFunctionArguments"}})],P.prototype,"functionArguments",null),(0,r._)([(0,l.w)("functionArguments")],P.prototype,"readFunctionArguments",null),(0,r._)([(0,c.K)("functionArguments")],P.prototype,"writeFunctionArguments",null),(0,r._)([(0,o.MZ)({json:{type:String,write:{target:"rasterFunction"}}})],P.prototype,"functionName",void 0),(0,r._)([(0,l.w)("functionName",["rasterFunction","rasterFunctionInfos","rasterFunctionDefinition"])],P.prototype,"readFunctionName",null),(0,r._)([(0,a.e)({C128:"c128",C64:"c64",F32:"f32",F64:"f64",S16:"s16",S32:"s32",S8:"s8",U1:"u1",U16:"u16",U2:"u2",U32:"u32",U4:"u4",U8:"u8",UNKNOWN:"unknown"},{ignoreUnknown:!1,default:"unknown"})],P.prototype,"outputPixelType",void 0),(0,r._)([(0,o.MZ)({type:String,json:{read:!0,write:!0}})],P.prototype,"variableName",void 0),(0,r._)([(0,o.MZ)()],P.prototype,"rasterFunctionDefinition",null),(0,r._)([(0,o.MZ)(R)],P.prototype,"functionDefinition",void 0),(0,r._)([(0,o.MZ)()],P.prototype,"hasClipFunction",null),P=A=(0,r._)([(0,u.$)("esri.layers.support.RasterFunction")],P);const N=P},98521:function(e,t,n){n.d(t,{A:function(){return A}});var r,i=n(53804),s=n(30905),o=n(21609),a=n(23502),l=(n(58941),n(40633),n(65953)),u=n(91484),c=n(57165);function p(e){return e=Number(e),isNaN(e)?void 0:e}n(13798);let h=r=class extends s.oY{constructor(){super(...arguments),this.name=null,this.minWavelength=void 0,this.maxWavelength=void 0,this.radianceBias=void 0,this.radianceGain=void 0,this.reflectanceBias=void 0,this.reflectanceGain=void 0,this.solarIrradiance=void 0}clone(){return new r({name:this.name,minWavelength:this.minWavelength,maxWavelength:this.maxWavelength,radianceBias:this.radianceBias,radianceGain:this.radianceGain,reflectanceBias:this.reflectanceBias,reflectanceGain:this.reflectanceGain,solarIrradiance:this.solarIrradiance})}};(0,i._)([(0,a.MZ)({json:{name:"BandName",write:!0}})],h.prototype,"name",void 0),(0,i._)([(0,a.MZ)({json:{name:"WavelengthMin",read:{reader:p},write:!0}})],h.prototype,"minWavelength",void 0),(0,i._)([(0,a.MZ)({json:{name:"WavelengthMax",read:{reader:p},write:!0}})],h.prototype,"maxWavelength",void 0),(0,i._)([(0,a.MZ)({json:{name:"RadianceBias",read:{reader:p},write:!0}})],h.prototype,"radianceBias",void 0),(0,i._)([(0,a.MZ)({json:{name:"RadianceGain",read:{reader:p},write:!0}})],h.prototype,"radianceGain",void 0),(0,i._)([(0,a.MZ)({json:{name:"ReflectanceBias",read:{reader:p},write:!0}})],h.prototype,"reflectanceBias",void 0),(0,i._)([(0,a.MZ)({json:{name:"ReflectanceGain",read:{reader:p},write:!0}})],h.prototype,"reflectanceGain",void 0),(0,i._)([(0,a.MZ)({json:{name:"SolarIrradiance",read:{reader:p},write:!0}})],h.prototype,"solarIrradiance",void 0),h=r=(0,i._)([(0,l.$)("esri.layers.support.RasterBandInfo")],h);const f=h;var d,m=n(47332),y=n(81392);function g(e){return e=Number(e),isNaN(e)?void 0:e}let w=d=class extends s.oY{constructor(){super(...arguments),this.acquisitionDate=void 0,this.cloudCover=void 0,this.productName=void 0,this.sensorName=null,this.sensorAzimuth=void 0,this.sensorElevation=void 0,this.sunAzimuth=void 0,this.sunElevation=void 0}readAcquisitionDate(e){return new Date(e)}writeAcquisitionDate(e,t){t.AcquisitionDate=e.getTime()}clone(){return new d({acquisitionDate:this.acquisitionDate,cloudCover:this.cloudCover,productName:this.productName,sensorName:this.sensorName,sensorAzimuth:this.sensorAzimuth,sensorElevation:this.sensorElevation,sunAzimuth:this.sunAzimuth,sunElevation:this.sunElevation})}};(0,i._)([(0,a.MZ)({json:{name:"AcquisitionDate",write:!0}})],w.prototype,"acquisitionDate",void 0),(0,i._)([(0,m.w)("acquisitionDate")],w.prototype,"readAcquisitionDate",null),(0,i._)([(0,y.K)("acquisitionDate")],w.prototype,"writeAcquisitionDate",null),(0,i._)([(0,a.MZ)({json:{name:"CloudCover",read:{reader:g},write:!0}})],w.prototype,"cloudCover",void 0),(0,i._)([(0,a.MZ)({json:{name:"ProductName",write:!0}})],w.prototype,"productName",void 0),(0,i._)([(0,a.MZ)({json:{name:"SensorName",write:!0}})],w.prototype,"sensorName",void 0),(0,i._)([(0,a.MZ)({json:{name:"SensorAzimuth",read:{reader:g},write:!0}})],w.prototype,"sensorAzimuth",void 0),(0,i._)([(0,a.MZ)({json:{name:"SensorElevation",read:{reader:g},write:!0}})],w.prototype,"sensorElevation",void 0),(0,i._)([(0,a.MZ)({json:{name:"SunAzimuth",read:{reader:g},write:!0}})],w.prototype,"sunAzimuth",void 0),(0,i._)([(0,a.MZ)({json:{name:"SunElevation",read:{reader:g},write:!0}})],w.prototype,"sunElevation",void 0),w=d=(0,i._)([(0,l.$)("esri.layers.support.RasterSensorInfo")],w);const b=w;var v,x=n(70850);let M=v=class extends s.oY{constructor(e){super(e),this.attributeTable=null,this.bandCount=null,this.colormap=null,this.extent=null,this.format=void 0,this.height=null,this.width=null,this.histograms=null,this.keyProperties={},this.multidimensionalInfo=null,this.noDataValue=null,this.pixelSize=null,this.pixelType=null,this.isPseudoSpatialReference=!1,this.spatialReference=null,this.statistics=null,this.storageInfo=null,this.transform=null}get bandInfos(){const e=this.keyProperties.BandProperties,{bandCount:t}=this;if(!e?.length||e.length<t){const e=[];for(let n=1;n<=t;n++)e.push(new f({name:"band_"+n}));return e}const n=e.map((e=>f.fromJSON(e)));for(let e=0;e<n.length;e++)n[e].name=n[e].name||"band_"+(e+1);return n}get dataType(){const e=this.keyProperties?.DataType?.toLowerCase()??"generic";return"stdtime"===e?"standard-time":e}get nativeExtent(){return this._get("nativeExtent")||this.extent}set nativeExtent(e){e&&this._set("nativeExtent",e)}get nativePixelSize(){if(null==this.transform||!this.transform.affectsPixelSize)return this.pixelSize;const e=this.nativeExtent;return{x:e.width/this.width,y:e.height/this.height}}get hasMultidimensionalTranspose(){return!!this.storageInfo?.transposeInfo}get sensorInfo(){if(this.keyProperties?.SensorName)return b.fromJSON(this.keyProperties)}clone(){return new v({attributeTable:(0,o.o8)(this.attributeTable),bandCount:this.bandCount,colormap:(0,o.o8)(this.colormap),extent:(0,o.o8)(this.extent),format:this.format,height:this.height,width:this.width,histograms:(0,o.o8)(this.histograms),keyProperties:(0,o.o8)(this.keyProperties),multidimensionalInfo:(0,o.o8)(this.multidimensionalInfo),noDataValue:this.noDataValue,pixelSize:(0,o.o8)(this.pixelSize),pixelType:this.pixelType,isPseudoSpatialReference:this.isPseudoSpatialReference,spatialReference:(0,o.o8)(this.spatialReference),statistics:(0,o.o8)(this.statistics),storageInfo:(0,o.o8)(this.storageInfo),transform:(0,o.o8)(this.transform)})}};(0,i._)([(0,a.MZ)({json:{write:!0}})],M.prototype,"attributeTable",void 0),(0,i._)([(0,a.MZ)({json:{write:!0}})],M.prototype,"bandCount",void 0),(0,i._)([(0,a.MZ)({readOnly:!0})],M.prototype,"bandInfos",null),(0,i._)([(0,a.MZ)({json:{write:!0}})],M.prototype,"colormap",void 0),(0,i._)([(0,a.MZ)({type:String,readOnly:!0})],M.prototype,"dataType",null),(0,i._)([(0,a.MZ)({type:u.default,json:{write:!0}})],M.prototype,"extent",void 0),(0,i._)([(0,a.MZ)({type:u.default,json:{write:!0}})],M.prototype,"nativeExtent",null),(0,i._)([(0,a.MZ)({json:{write:!0}})],M.prototype,"nativePixelSize",null),(0,i._)([(0,a.MZ)({json:{write:!0}})],M.prototype,"format",void 0),(0,i._)([(0,a.MZ)({json:{write:!0}})],M.prototype,"height",void 0),(0,i._)([(0,a.MZ)({json:{write:!0}})],M.prototype,"width",void 0),(0,i._)([(0,a.MZ)({json:{write:!0}})],M.prototype,"hasMultidimensionalTranspose",null),(0,i._)([(0,a.MZ)({json:{write:!0}})],M.prototype,"histograms",void 0),(0,i._)([(0,a.MZ)({json:{write:!0}})],M.prototype,"keyProperties",void 0),(0,i._)([(0,a.MZ)({json:{write:!0}})],M.prototype,"multidimensionalInfo",void 0),(0,i._)([(0,a.MZ)({json:{write:!0}})],M.prototype,"noDataValue",void 0),(0,i._)([(0,a.MZ)({json:{write:!0}})],M.prototype,"pixelSize",void 0),(0,i._)([(0,a.MZ)({json:{write:!0}})],M.prototype,"pixelType",void 0),(0,i._)([(0,a.MZ)()],M.prototype,"isPseudoSpatialReference",void 0),(0,i._)([(0,a.MZ)({readOnly:!0})],M.prototype,"sensorInfo",null),(0,i._)([(0,a.MZ)({type:c.A,json:{write:!0}})],M.prototype,"spatialReference",void 0),(0,i._)([(0,a.MZ)({json:{write:!0}})],M.prototype,"statistics",void 0),(0,i._)([(0,a.MZ)({type:x.A,json:{write:!0}})],M.prototype,"storageInfo",void 0),(0,i._)([(0,a.MZ)({json:{write:!0}})],M.prototype,"transform",void 0),M=v=(0,i._)([(0,l.$)("esri.layers.support.RasterInfo")],M);const A=M},46766:function(e,t,n){n.d(t,{A:function(){return o}});var r=n(39819),i=n(86027),s=n(21327);class o{constructor(){this._workerThread=null,this._destroyed=!1}async initialize(){const e=await(0,i.ho)("RasterWorker");this._destroyed?e.close():this._workerThread=e}destroy(){this._destroyed=!0,this._workerThread&&(this._workerThread.close(),this._workerThread=null)}async convertVectorFieldData(e,t){if(!this._workerThread)throw new r.A("raster-jobhandler:no-connection","no available worker connection");const n=await this._workerThread.invoke("convertVectorFieldData",{pixelBlock:e.pixelBlock.toJSON(),type:e.dataType},t);return n?new s.A(n):null}computeStatisticsHistograms(e,t){if(!this._workerThread)throw new r.A("raster-jobhandler:no-connection","no available worker connection");return this._workerThread.invoke("computeStatisticsHistograms",{pixelBlock:e.pixelBlock.toJSON()},t)}async decode(e,t){if(!this._workerThread)throw new r.A("raster-jobhandler:no-connection","no available worker connection");const n=await this._workerThread.invoke("decode",e,t);return n?new s.A(n):null}async symbolize(e,t){if(!this._workerThread)throw new r.A("raster-jobhandler:no-connection","no available worker connection");const n={extent:e.extent?.toJSON(),pixelBlock:e.pixelBlock?.toJSON(),simpleStretchParams:e.simpleStretchParams,bandIds:e.bandIds},i=await this._workerThread.invoke("symbolize",n,t);return i?new s.A(i):null}async updateSymbolizer(e,t){if(!this._workerThread)throw new r.A("raster-jobhandler:no-connection","no available worker connection");const n=e?.rendererJSON?.histograms;await Promise.all(this._workerThread.broadcast("updateSymbolizer",{symbolizerJSON:e.toJSON(),histograms:n},t))}async updateRasterFunction(e,t){if(!this._workerThread)throw new r.A("raster-jobhandler:no-connection","no available worker connection");await Promise.all(this._workerThread.broadcast("updateRasterFunction",{rasterFunctionJSON:e.toJSON()},t))}async process(e,t){if(!this._workerThread)throw new r.A("raster-jobhandler:no-connection","no available worker connection");const n=await this._workerThread.invoke("process",{extent:e.extent?.toJSON(),primaryPixelSizes:e.primaryPixelSizes?.map((e=>null!=e?e.toJSON():null)),primaryPixelBlocks:e.primaryPixelBlocks.map((e=>null!=e?e.toJSON():null)),primaryRasterIds:e.primaryRasterIds},t);return n?new s.A(n):null}async stretch(e,t){if(!this._workerThread)throw new r.A("raster-jobhandler:no-connection","no available worker connection");if(!e?.pixelBlock)return null;const n={srcPixelBlock:e.pixelBlock.toJSON(),stretchParams:e.stretchParams},i=await this._workerThread.invoke("stretch",n,t);return i?new s.A(i):null}async split(e,t){if(!this._workerThread)throw new r.A("raster-jobhandler:no-connection","no available worker connection");if(!e?.pixelBlock)return null;const n={srcPixelBlock:e.pixelBlock.toJSON(),tileSize:e.tileSize,maximumPyramidLevel:e.maximumPyramidLevel,useBilinear:e.useBilinear},i=await this._workerThread.invoke("split",n,t);return i&&i.forEach(((e,t)=>{i.set(t,e?s.A.fromJSON(e):null)})),i}async clipTile(e,t){if(!this._workerThread)throw new r.A("raster-jobhandler:no-connection","no available worker connection");if(!e?.pixelBlock)return null;const n={...e,pixelBlock:e.pixelBlock.toJSON()},i=await this._workerThread.invoke("clipTile",n,t);return i?s.A.fromJSON(i):null}async estimateStatisticsHistograms(e,t){if(!this._workerThread)throw new r.A("raster-jobhandler:no-connection","no available worker connection");if(!e?.pixelBlock)return null;const n={srcPixelBlock:e.pixelBlock.toJSON()};return await this._workerThread.invoke("estimateStatisticsHistograms",n,t)}async mosaicAndTransform(e,t){if(!this._workerThread)throw new r.A("raster-jobhandler:no-connection","no available worker connection");if(!e?.srcPixelBlocks?.length)return{pixelBlock:null};const n={...e,srcPixelBlocks:e.srcPixelBlocks.map((e=>null!=e?e.toJSON():null))},i=await this._workerThread.invoke("mosaicAndTransform",n,t);return{pixelBlock:i.pixelBlock?new s.A(i.pixelBlock):null,localNorthDirections:i.localNorthDirections}}async createFlowMesh(e,t){if(!this._workerThread)throw new r.A("raster-jobhandler:no-connection","no available worker connection");const n={buffer:e.flowData.data.buffer,maskBuffer:e.flowData.mask.buffer,width:e.flowData.width,height:e.flowData.height},{meshType:i,simulationSettings:s}=e,o=await this._workerThread.invoke("createFlowMesh",{meshType:i,flowData:n,simulationSettings:s},{...t,transferList:[n.buffer,n.maskBuffer]});return{vertexData:new Float32Array(o.vertexBuffer),indexData:new Uint32Array(o.indexBuffer)}}getProjectionOffsetGrid(e,t){if(!this._workerThread)throw new r.A("raster-jobhandler:no-connection","no available worker connection");const n=null!=e.datumTransformation?e.datumTransformation.steps.map((e=>({wkid:e.wkid,wkt:e.wkt,isInverse:e.isInverse}))):null,i=null!=e.rasterTransform?e.rasterTransform.toJSON():null,s={projectedExtent:e.projectedExtent.toJSON(),srcBufferExtent:e.srcBufferExtent.toJSON(),pixelSize:e.pixelSize,hasWrapAround:e.hasWrapAround,spacing:e.spacing,datumTransformationSteps:n,rasterTransform:i,isAdaptive:e.isAdaptive,includeGCSGrid:e.includeGCSGrid};return this._workerThread.invoke("getProjectionOffsetGrid",s,t)}}},70850:function(e,t,n){n.d(t,{A:function(){return p}});var r,i=n(53804),s=n(30905),o=n(21609),a=n(23502),l=(n(58941),n(40633),n(65953)),u=n(45532);let c=r=class extends s.oY{constructor(){super(...arguments),this.blockWidth=void 0,this.blockHeight=void 0,this.compression=null,this.origin=null,this.firstPyramidLevel=null,this.maximumPyramidLevel=null,this.pyramidScalingFactor=2,this.pyramidBlockWidth=null,this.pyramidBlockHeight=null,this.isVirtualTileInfo=!1,this.tileInfo=null,this.transposeInfo=null,this.blockBoundary=null}clone(){return new r({blockWidth:this.blockWidth,blockHeight:this.blockHeight,compression:this.compression,origin:(0,o.o8)(this.origin),firstPyramidLevel:this.firstPyramidLevel,maximumPyramidLevel:this.maximumPyramidLevel,pyramidResolutions:(0,o.o8)(this.pyramidResolutions),pyramidScalingFactor:this.pyramidScalingFactor,pyramidBlockWidth:this.pyramidBlockWidth,pyramidBlockHeight:this.pyramidBlockHeight,isVirtualTileInfo:this.isVirtualTileInfo,tileInfo:(0,o.o8)(this.tileInfo),transposeInfo:(0,o.o8)(this.transposeInfo),blockBoundary:(0,o.o8)(this.blockBoundary)})}};(0,i._)([(0,a.MZ)({type:Number,json:{write:!0}})],c.prototype,"blockWidth",void 0),(0,i._)([(0,a.MZ)({type:Number,json:{write:!0}})],c.prototype,"blockHeight",void 0),(0,i._)([(0,a.MZ)({type:String,json:{write:!0}})],c.prototype,"compression",void 0),(0,i._)([(0,a.MZ)({type:u.default,json:{write:!0}})],c.prototype,"origin",void 0),(0,i._)([(0,a.MZ)({type:Number,json:{write:!0}})],c.prototype,"firstPyramidLevel",void 0),(0,i._)([(0,a.MZ)({type:Number,json:{write:!0}})],c.prototype,"maximumPyramidLevel",void 0),(0,i._)([(0,a.MZ)({json:{write:!0}})],c.prototype,"pyramidResolutions",void 0),(0,i._)([(0,a.MZ)({type:Number,json:{write:!0}})],c.prototype,"pyramidScalingFactor",void 0),(0,i._)([(0,a.MZ)({type:Number,json:{write:!0}})],c.prototype,"pyramidBlockWidth",void 0),(0,i._)([(0,a.MZ)({type:Number,json:{write:!0}})],c.prototype,"pyramidBlockHeight",void 0),(0,i._)([(0,a.MZ)({type:Boolean,json:{write:!0}})],c.prototype,"isVirtualTileInfo",void 0),(0,i._)([(0,a.MZ)({json:{write:!0}})],c.prototype,"tileInfo",void 0),(0,i._)([(0,a.MZ)()],c.prototype,"transposeInfo",void 0),(0,i._)([(0,a.MZ)()],c.prototype,"blockBoundary",void 0),c=r=(0,i._)([(0,l.$)("esri.layers.support.RasterStorageInfo")],c);const p=c},42568:function(e,t,n){n.d(t,{z:function(){return r}});class r{constructor(e=null,t=null,n=null){this.minValue=e,this.maxValue=t,this.noDataValue=n}}},76226:function(e,t,n){n.r(t),n.d(t,{default:function(){return I}});var r,i=n(53804),s=n(73037),o=n(30905),a=n(62938),l=n(23502),u=n(67888),c=(n(13798),n(58941),n(47332)),p=n(65953),h=n(81392),f=n(45532),d=n(57165),m=n(87416),y=n(57652),g=n(1644),w=n(44431),b=n(29679);const v=new s.J({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let x=r=class extends o.oY{static create(e={}){const{resolutionFactor:t=1,scales:n,size:i=256,spatialReference:s=d.A.WebMercator,numLODs:o=24}=e;if(!(0,y.fn)(s)){const e=[];if(n)for(let t=0;t<n.length;t++){const r=n[t];e.push(new w.A({level:t,scale:r,resolution:r}))}else{let t=5e-4;for(let n=o-1;n>=0;n--)e.unshift(new w.A({level:n,scale:t,resolution:t})),t*=2}return new r({dpi:96,lods:e,origin:new f.default(0,0,s),size:[i,i],spatialReference:s})}const l=(0,y.Vp)(s),u=e.origin?new f.default({x:e.origin.x,y:e.origin.y,spatialReference:s}):new f.default(l?{x:l.origin[0],y:l.origin[1],spatialReference:s}:{x:0,y:0,spatialReference:s}),c=1/(39.37*(0,a.GA)(s)*96),p=[];if(n)for(let e=0;e<n.length;e++){const t=n[e],r=t*c;p.push(new w.A({level:e,scale:t,resolution:r}))}else{let e=(0,y.EA)(s)?512/i*591657527.5917094:256/i*591657527.591555;const n=Math.ceil(o/t);p.push(new w.A({level:0,scale:e,resolution:e*c}));for(let r=1;r<n;r++){const n=e/2**t,i=n*c;p.push(new w.A({level:r,scale:n,resolution:i})),e=n}}return new r({dpi:96,lods:p,origin:u,size:[i,i],spatialReference:s})}constructor(e){super(e),this.dpi=96,this.format=null,this.origin=null,this.size=null,this.spatialReference=null}get isWrappable(){const{spatialReference:e,origin:t}=this;if(e&&t){const n=(0,y.Vp)(e);return e.isWrappable&&!!n&&Math.abs(n.origin[0]-t.x)<=n.dx}return!1}readOrigin(e,t){return f.default.fromJSON({spatialReference:t.spatialReference,...e})}set lods(e){let t=0,n=0;const r=[],i=this._levelToLOD={};e&&(t=-1/0,n=1/0,e.forEach((e=>{r.push(e.scale),t=e.scale>t?e.scale:t,n=e.scale<n?e.scale:n,i[e.level]=e}))),this._set("scales",r),this._set("lods",e),this._initializeUpsampleLevels()}readSize(e,t){return[t.cols,t.rows]}writeSize(e,t){t.cols=e[0],t.rows=e[1]}zoomToScale(e){const t=this.scales;if(e<=0)return t[0];if(e>=t.length-1)return t[t.length-1];const n=Math.floor(e),r=n+1;return t[n]/(t[n]/t[r])**(e-n)}scaleToZoom(e){const t=this.scales,n=t.length-1;let r=0;for(;r<n;r++){const n=t[r],i=t[r+1];if(n<=e)return r;if(i===e)return r+1;if(n>e&&i<e)return r+Math.log(n/e)/Math.log(n/i)}return r}tileAt(e,t,n,r){const i=this.lodAt(e);if(!i)return null;let s,o;if("number"==typeof t)s=t,o=n;else if((0,y.aI)(t.spatialReference,this.spatialReference))s=t.x,o=t.y,r=n;else{const e=(0,g.Cv)(t,this.spatialReference);if(null==e)return null;s=e.x,o=e.y,r=n}const a=i.resolution*this.size[0],l=i.resolution*this.size[1];return r||(r=new b.U(null,0,0,0,(0,m.vt)())),r.level=e,r.row=Math.floor((this.origin.y-o)/l+.001),r.col=Math.floor((s-this.origin.x)/a+.001),this.updateTileInfo(r),r}updateTileInfo(e,t=r.ExtrapolateOptions.NONE){let n=this.lodAt(e.level);if(!n&&t===r.ExtrapolateOptions.POWER_OF_TWO){const t=this.lods[this.lods.length-1];t.level<e.level&&(n=t)}if(!n)return;const i=e.level-n.level,s=n.resolution*this.size[0]/2**i,o=n.resolution*this.size[1]/2**i;e.id=`${e.level}/${e.row}/${e.col}`,e.extent||(e.extent=(0,m.vt)()),e.extent[0]=this.origin.x+e.col*s,e.extent[1]=this.origin.y-(e.row+1)*o,e.extent[2]=e.extent[0]+s,e.extent[3]=e.extent[1]+o}upsampleTile(e){const t=this._upsampleLevels[e.level];return!(!t||-1===t.parentLevel||(e.level=t.parentLevel,e.row=Math.floor(e.row/t.factor+.001),e.col=Math.floor(e.col/t.factor+.001),this.updateTileInfo(e),0))}getTileBounds(e,t){const n=this.lodAt(t.level);if(null==n)return null;const{resolution:r}=n,i=r*this.size[0],s=r*this.size[1];return e[0]=this.origin.x+t.col*i,e[1]=this.origin.y-(t.row+1)*s,e[2]=e[0]+i,e[3]=e[1]+s,e}lodAt(e){return this._levelToLOD?.[e]??null}clone(){return r.fromJSON(this.write({}))}getCompatibleForVTL(e){if(this.size[0]!==this.size[1]||256===this.size[0]&&512===e)return null;const t=(512===this.size[0]&&256===e?-1:0)+(this.spatialReference.isGeographic?1:0);if(this.size[0]===e&&0===t)return this;const n=[],i=this.lods.length-t;for(let e=0;e<i;e++){const r=e+t,{scale:i,resolution:s}=r>=0?this.lods[r]:{scale:2*this.lods[0].scale,resolution:2*this.lods[0].resolution};n.push(new w.A({level:e,scale:i,resolution:s}))}return new r({size:[e,e],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:n})}_initializeUpsampleLevels(){const e=this.lods;this._upsampleLevels=[];let t=null;for(let n=0;n<e.length;n++){const r=e[n];this._upsampleLevels[r.level]={parentLevel:t?t.level:-1,factor:t?t.resolution/r.resolution:0},t=r}}};var M,A;(0,i._)([(0,l.MZ)({type:Number,json:{write:!0}})],x.prototype,"compressionQuality",void 0),(0,i._)([(0,l.MZ)({type:Number,json:{write:!0}})],x.prototype,"dpi",void 0),(0,i._)([(0,l.MZ)({type:String,json:{read:v.read,write:v.write,origins:{"web-scene":{read:!1,write:!1}}}})],x.prototype,"format",void 0),(0,i._)([(0,l.MZ)({readOnly:!0})],x.prototype,"isWrappable",null),(0,i._)([(0,l.MZ)({type:f.default,json:{write:!0}})],x.prototype,"origin",void 0),(0,i._)([(0,c.w)("origin")],x.prototype,"readOrigin",null),(0,i._)([(0,l.MZ)({type:[w.A],value:null,json:{write:!0}})],x.prototype,"lods",null),(0,i._)([(0,l.MZ)({readOnly:!0})],x.prototype,"scales",void 0),(0,i._)([(0,l.MZ)({cast:e=>Array.isArray(e)?e:"number"==typeof e?[e,e]:[256,256]})],x.prototype,"size",void 0),(0,i._)([(0,c.w)("size",["rows","cols"])],x.prototype,"readSize",null),(0,i._)([(0,h.K)("size",{cols:{type:u.jz},rows:{type:u.jz}})],x.prototype,"writeSize",null),(0,i._)([(0,l.MZ)({type:d.A,json:{write:!0}})],x.prototype,"spatialReference",void 0),x=r=(0,i._)([(0,p.$)("esri.layers.support.TileInfo")],x),M=x||(x={}),(A=M.ExtrapolateOptions||(M.ExtrapolateOptions={}))[A.NONE=0]="NONE",A[A.POWER_OF_TWO=1]="POWER_OF_TWO";const I=x},29679:function(e,t,n){n.d(t,{U:function(){return r}});class r{constructor(e,t,n,r,i=void 0){this.id=e,this.level=t,this.row=n,this.col=r,this.extent=i}}},6053:function(e,t,n){n.d(t,{d:function(){return I}});var r,i=n(53804),s=n(93040),o=n(83525),a=n(69296),l=n(39819),u=n(61226),c=(n(58941),n(99680)),p=n(7187),h=n(60539),f=n(28181),d=n(74087),m=n(90683),y=n(23502),g=(n(40633),n(13798),n(65953)),w=n(29679),b=n(21609),v=n(24540);class x{constructor(e){!function(e){if(!e?.location)throw new l.A("tilemap:missing-location","Location missing from tilemap response");if(!1===e.valid)throw new l.A("tilemap:invalid","Tilemap response was marked as invalid");if(!e.data)throw new l.A("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(e.data))throw new l.A("tilemap:data-mismatch","Data must be an array of numbers");if(e.data.length!==e.location.width*e.location.height)throw new l.A("tilemap:data-mismatch","Number of data items does not match width/height of tilemap")}(e);const{location:t,data:n}=e;this.location=Object.freeze((0,b.o8)(t));const r=this.location.width,i=this.location.height;let s=!0,o=!0;const a=function(e,t=!1){return e<=v.y9?t?new Array(e).fill(0):new Array(e):new Uint32Array(e)}(Math.ceil(r*i/32));let u=0;for(let e=0;e<n.length;e++){const t=e%32;n[e]?(o=!1,a[u]|=1<<t):s=!1,31===t&&++u}o?(this._availability="unavailable",this.byteSize=40):s?(this._availability="available",this.byteSize=40):(this._availability=a,this.byteSize=40+(0,v.Ek)(a))}getAvailability(e,t){if("unavailable"===this._availability||"available"===this._availability)return this._availability;const n=(e-this.location.top)*this.location.width+(t-this.location.left),r=n%32,i=n>>5,s=this._availability;return i<0||i>s.length?"unknown":s[i]&1<<r?"available":"unavailable"}static fromDefinition(e,t){const n=e.service.request||s.A,{row:r,col:i,width:o,height:a}=e,u={query:{f:"json"}};return t=t?{...u,...t}:u,n(function(e){let t;if(e.service.tileServers?.length){const n=e.service.tileServers;t=`${n&&n.length?n[e.row%n.length]:e.service.url}/tilemap/${e.level}/${e.row}/${e.col}/${e.width}/${e.height}`}else t=`${e.service.url}/tilemap/${e.level}/${e.row}/${e.col}/${e.width}/${e.height}`;const n=e.service.query;return n&&(t=`${t}?${n}`),t}(e),t).then((e=>e.data)).catch((e=>{if(422===e?.details?.httpStatus)return{location:{top:r,left:i,width:o,height:a},valid:!0,data:new Array(o*a).fill(0)};throw e})).then((e=>{if(e.location&&(e.location.top!==r||e.location.left!==i||e.location.width!==o||e.location.height!==a))throw new l.A("tilemap:location-mismatch","Tilemap response for different location than requested",{response:e,definition:{top:r,left:i,width:o,height:a}});return x.fromJSON(e)}))}static fromJSON(e){return Object.freeze(new x(e))}}function M(e){return`${e.level}/${e.row}/${e.col}/${e.width}/${e.height}`}function A(e,t,n){return new l.A("tile-map:tile-unavailable","Tile is not available",{level:e,row:t,col:n})}let I=r=class extends o.A{constructor(e){super(e),this._pendingTilemapRequests={},this.request=s.A,this.size=32,this._prefetchingEnabled=!0}initialize(){this._tilemapCache=new c.q(2*a.u.MEGABYTES),this.addHandles((0,f.watch)((()=>{const{layer:e}=this;return[e?.parsedUrl,e?.tileServers,e?.apiKey,e?.customParameters]}),(()=>this._initializeTilemapDefinition()),f.Vh))}get effectiveMinLOD(){return this.minLOD??this.layer.tileInfo.lods[0].level}get effectiveMaxLOD(){return this.maxLOD??this.layer.tileInfo.lods[this.layer.tileInfo.lods.length-1].level}getAvailability(e,t,n){if(!this.layer.tileInfo.lodAt(e)||e<this.effectiveMinLOD||e>this.effectiveMaxLOD)return"unavailable";const r=this._tilemapFromCache(e,t,n,this._tmpTilemapDefinition);return r?r.getAvailability(t,n):"unknown"}fetchAvailability(e,t,n,r){return!this.layer.tileInfo.lodAt(e)||e<this.effectiveMinLOD||e>this.effectiveMaxLOD?Promise.reject(A(e,t,n)):this._fetchTilemap(e,t,n,r).catch((e=>e)).then((r=>{if(r instanceof x){const i=r.getAvailability(t,n);if("unavailable"===i)throw A(e,t,n);return i}if((0,h.zf)(r))throw r;return"unknown"}))}fetchAvailabilityUpsample(e,t,n,r,i){r.level=e,r.row=t,r.col=n;const s=this.layer.tileInfo;s.updateTileInfo(r);const o=this.fetchAvailability(e,t,n,i).catch((e=>{if((0,h.zf)(e))throw e;if(s.upsampleTile(r))return this.fetchAvailabilityUpsample(r.level,r.row,r.col,r,i);throw e}));return this._fetchAvailabilityUpsamplePrefetch(r.id,e,t,n,i,o),o}async _fetchAvailabilityUpsamplePrefetch(e,t,n,i,s,o){if(!this._prefetchingEnabled||null==e)return;const a=`prefetch-${e}`;if(this.hasHandles(a))return;const l=new AbortController;o.then((()=>l.abort()),(()=>l.abort()));let c=!1;const p=(0,u.hA)((()=>{c||(c=!0,l.abort())}));if(this.addHandles(p,a),await(0,d.md)(10,l.signal).catch((()=>{})),c||(c=!0,this.removeHandles(a)),(0,h.G4)(l))return;const f=new w.U(e,t,n,i),m={...s,signal:l.signal},y=this.layer.tileInfo;for(let e=0;r._prefetches.length<r._maxPrefetch&&y.upsampleTile(f);++e){const e=this.fetchAvailability(f.level,f.row,f.col,m);r._prefetches.push(e);const t=()=>{r._prefetches.removeUnordered(e)};e.then(t,t)}}_fetchTilemap(e,t,n,r){if(!this.layer.tileInfo.lodAt(e)||e<this.effectiveMinLOD||e>this.effectiveMaxLOD)return Promise.reject(new l.A("tilemap-cache:level-unavailable",`Level ${e} is unavailable in the service`));const i=this._tmpTilemapDefinition,s=this._tilemapFromCache(e,t,n,i);if(s)return Promise.resolve(s);const o=r?.signal;return r={...r,signal:null},new Promise(((e,t)=>{(0,h.u7)(o,(()=>t((0,h.NK)())));const n=M(i);let s=this._pendingTilemapRequests[n];if(!s){s=x.fromDefinition(i,r).then((e=>(this._tilemapCache.put(n,e,e.byteSize),e)));const e=()=>{delete this._pendingTilemapRequests[n]};this._pendingTilemapRequests[n]=s,s.then(e,e)}s.then(e,t)}))}_initializeTilemapDefinition(){if(!this.layer.parsedUrl)return;const{parsedUrl:e,apiKey:t,customParameters:n}=this.layer;this._tilemapCache.clear(),this._tmpTilemapDefinition={service:{url:e.path,query:(0,m.x0)({...e.query,...n,token:t??e.query?.token}),tileServers:this.layer.tileServers,request:this.request},width:this.size,height:this.size,level:0,row:0,col:0}}_tilemapFromCache(e,t,n,r){r.level=e,r.row=t-t%this.size,r.col=n-n%this.size;const i=M(r);return this._tilemapCache.get(i)}get test(){}};I._maxPrefetch=4,I._prefetches=new p.A({initialSize:r._maxPrefetch}),(0,i._)([(0,y.MZ)({constructOnly:!0})],I.prototype,"layer",void 0),(0,i._)([(0,y.MZ)({constructOnly:!0})],I.prototype,"minLOD",void 0),(0,i._)([(0,y.MZ)({constructOnly:!0})],I.prototype,"maxLOD",void 0),(0,i._)([(0,y.MZ)({constructOnly:!0})],I.prototype,"request",void 0),(0,i._)([(0,y.MZ)({constructOnly:!0})],I.prototype,"size",void 0),I=r=(0,i._)([(0,g.$)("esri.layers.support.TilemapCache")],I)},36143:function(e,t,n){n.d(t,{A:function(){return m}});var r=n(53804),i=n(75743),s=n(30905),o=n(23502),a=(n(58941),n(40633),n(13798),n(47332)),l=n(65953),u=n(81392),c=n(52038),p=n(92427),h=n(21168);function f(e,t){return p.A.fromJSON({value:e,unit:t})}let d=class extends((0,i.O)(s.oY)){constructor(e){super(e),this.cumulative=!1,this.endField=null,this.fullTimeExtent=null,this.hasLiveData=!1,this.interval=null,this.startField=null,this.timeZone=null,this.trackIdField=null,this.useTime=!0,this.stops=null}readFullTimeExtent(e,t){return t.timeExtent&&Array.isArray(t.timeExtent)&&2===t.timeExtent.length?c.A.fromArray(t.timeExtent):null}writeFullTimeExtent(e,t){null!=e?.start&&null!=e.end?t.timeExtent=e.toArray():t.timeExtent=null}readInterval(e,t){return t.timeInterval&&t.timeIntervalUnits?f(t.timeInterval,t.timeIntervalUnits):t.defaultTimeInterval&&t.defaultTimeIntervalUnits?f(t.defaultTimeInterval,t.defaultTimeIntervalUnits):null}writeInterval(e,t){t.timeInterval=e?.toJSON().value??null,t.timeIntervalUnits=e?.toJSON().unit??null}};(0,r._)([(0,o.MZ)({type:Boolean,json:{name:"exportOptions.timeDataCumulative",write:!0}})],d.prototype,"cumulative",void 0),(0,r._)([(0,o.MZ)({type:String,json:{name:"endTimeField",write:{enabled:!0,allowNull:!0}}})],d.prototype,"endField",void 0),(0,r._)([(0,o.MZ)({type:c.A,json:{write:{enabled:!0,allowNull:!0}}})],d.prototype,"fullTimeExtent",void 0),(0,r._)([(0,a.w)("fullTimeExtent",["timeExtent"])],d.prototype,"readFullTimeExtent",null),(0,r._)([(0,u.K)("fullTimeExtent")],d.prototype,"writeFullTimeExtent",null),(0,r._)([(0,o.MZ)({type:Boolean,json:{write:!0}})],d.prototype,"hasLiveData",void 0),(0,r._)([(0,o.MZ)({type:p.A,json:{write:{enabled:!0,allowNull:!0}}})],d.prototype,"interval",void 0),(0,r._)([(0,a.w)("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],d.prototype,"readInterval",null),(0,r._)([(0,u.K)("interval")],d.prototype,"writeInterval",null),(0,r._)([(0,o.MZ)({type:String,json:{name:"startTimeField",write:{enabled:!0,allowNull:!0}}})],d.prototype,"startField",void 0),(0,r._)([(0,o.MZ)((0,h.P6)("timeReference",!0))],d.prototype,"timeZone",void 0),(0,r._)([(0,o.MZ)({type:String,json:{write:{enabled:!0,allowNull:!0}}})],d.prototype,"trackIdField",void 0),(0,r._)([(0,o.MZ)({type:Boolean,json:{name:"exportOptions.useTime",write:!0}})],d.prototype,"useTime",void 0),(0,r._)([(0,o.MZ)({type:[Date],json:{read:!1}})],d.prototype,"stops",void 0),d=(0,r._)([(0,l.$)("esri.layers.support.TimeInfo")],d);const m=d},7010:function(e,t,n){n.d(t,{C1:function(){return I},Fm:function(){return v},Ih:function(){return b},M6:function(){return p},OZ:function(){return f},PY:function(){return c},Qo:function(){return y},Yj:function(){return m},fV:function(){return d},hG:function(){return A},hn:function(){return M},id:function(){return x},kF:function(){return h},ke:function(){return w},zQ:function(){return S}});var r=n(64786),i=n(91484),s=n(57165),o=n(60534),a=n(6422),l=n(92777),u=n(59798);const c={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:{enabled:!0,layerContainerTypes:r.K}}},p={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(e,t)=>!t.disablePopup},write:{enabled:!0,writer(e,t,n){t[n]=!e}}}},h={type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",write:{enabled:!0,layerContainerTypes:r.K}}},f={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:o.w}}},d={type:Boolean,value:!0,nonNullable:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:{enabled:!0,layerContainerTypes:r.K}}},m={value:null,type:a.A,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:{enabled:!0,layerContainerTypes:r.K}}};function y(e){return{type:e,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const g={write:{enabled:!0,layerContainerTypes:r.K},read:!0},w={type:Number,json:{origins:{"web-document":g,"portal-item":{write:!0}}}},b={...w,json:{...w.json,origins:{"web-document":{...g,write:{enabled:!0,layerContainerTypes:r.K,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}}},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(e,t,n)=>n&&"service"!==n.origin||!t.drawingInfo||void 0===t.drawingInfo.transparency?t.layerDefinition?.drawingInfo&&void 0!==t.layerDefinition.drawingInfo.transparency?(0,u.D)(t.layerDefinition.drawingInfo.transparency):void 0:(0,u.D)(t.drawingInfo.transparency)}}},v={type:i.default,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(e,t)=>{const n=i.default.fromJSON(e);return null!=t.spatialReference&&"object"==typeof t.spatialReference&&(n.spatialReference=s.A.fromJSON(t.spatialReference)),n}}}},read:!1}},x={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},M={type:Number,json:{origins:{service:{write:{enabled:!1}},"web-scene":{name:"layerDefinition.minScale",write:{enabled:!0,layerContainerTypes:r.K}}},name:"layerDefinition.minScale",write:!0}},A={type:Number,json:{origins:{service:{write:{enabled:!1}},"web-scene":{name:"layerDefinition.maxScale",write:{enabled:!0,layerContainerTypes:r.K}}},name:"layerDefinition.maxScale",write:!0}},I={json:{write:{ignoreOrigin:!0,layerContainerTypes:r.K},origins:{"web-map":{read:!1,write:!1}}}},S={type:l.A,json:{name:"attributeTableInfo",write:!0,origins:{"web-scene":{read:!1,write:!1}}}}},36529:function(e,t,n){n.d(t,{jX:function(){return c},zo:function(){return f},gd:function(){return p},ph:function(){return a},no:function(){return h},kz:function(){return l},ht:function(){return u},yo:function(){return m}}),n(50917);var r=n(80221),i=n(45532);const s=new Map,o=new class{constructor(e=15e3,t=5e3){this._timer=null,this._cachedBlocks=new Map,this._size=-1,this._duration=e,this._interval=Math.min(e,t)}decreaseRefCount(e,t){const n=e+"/"+t,r=this._cachedBlocks;if(r.has(n)){const e=r.get(n);return e.refCount--,e.refCount<=0&&(r.delete(n),e.controller&&e.controller.abort()),e.refCount}return 0}getBlock(e,t){const n=e+"/"+t,r=this._cachedBlocks;if(r.has(n)){const e=r.get(n);return e.ts=Date.now(),e.refCount++,r.delete(n),r.set(n,e),e.block}return null}putBlock(e,t,n,r){const i=this._cachedBlocks,s=e+"/"+t;if(i.has(s)){const e=i.get(s);e.ts=Date.now(),e.refCount++}else i.set(s,{block:n,ts:Date.now(),refCount:1,controller:r});this._trim(),this._updateTimer()}deleteBlock(e,t){const n=this._cachedBlocks,r=e+"/"+t;n.has(r)&&n.delete(r)}updateMaxSize(e){this._size=e,this._trim()}empty(){this._cachedBlocks.clear(),this._clearTimer()}getCurrentSize(){return this._cachedBlocks.size}_updateTimer(){if(null!=this._timer)return;const e=this._cachedBlocks;this._timer=setInterval((()=>{const t=Array.from(e),n=Date.now();for(let r=0;r<t.length&&t[r][1].ts<=n-this._duration;r++)e.delete(t[r][0]);0===e.size&&this._clearTimer()}),this._interval)}_trim(){const e=this._cachedBlocks;if(-1===this._size||this._size>=e.size)return;const t=Array.from(e);for(let n=0;n<t.length-this._size;n++)e.delete(t[n][0])}_clearTimer(){null!=this._timer&&(clearInterval(this._timer),this._timer=null)}};function a(e,t){return null==t?e:`${e}?sliceId=${t}`}function l(e,t){const n={extent:null,rasterInfo:t,cache:new Map},r=s.get(e);return r?(r.push(n),r.length-1):(s.set(e,[n]),0)}function u(e,t){const n=s.get(e);n&&(n[t]=null,n.some((e=>null!=e))||s.delete(e))}function c(e,t,n){const r=s.get(e);if(!r)return null==t?o.decreaseRefCount(e,n):0;if(null==t||null==r[t])return o.decreaseRefCount(e,n);const i=r[t]?.cache,a=i?.get(n);if(i&&a){if(a.refCount--,0===a.refCount){i.delete(n);for(let e=0;e<r.length;e++)r[e]?.cache.delete(n);a.controller&&a.controller.abort()}return a.refCount}return 0}function p(e,t,n){const r=s.get(e);if(!r)return null==t?o.getBlock(e,n):null;if(null==t||null==r[t]){for(let e=0;e<r.length;e++){const t=r[e]?.cache.get(n);if(t)return t.refCount++,t.block}return o.getBlock(e,n)}const i=r[t]?.cache.get(n);if(i)return i.refCount++,i.block;for(let e=0;e<r.length;e++){if(e===t||!r[e])continue;const i=r[e]?.cache,s=i?.get(n);if(i&&s)return s.refCount++,i.set(n,s),s.block}return null}function h(e,t,n,r,i=null){const a=s.get(e);if(!a)return void(null==t&&o.putBlock(e,n,r,i));if(null==t||null==a[t])return void o.putBlock(e,n,r,i);const l={refCount:1,block:r,isResolved:!1,isRejected:!1,controller:i};r.then((()=>l.isResolved=!0)).catch((()=>l.isRejected=!0)),a[t]?.cache.set(n,l)}function f(e,t,n){const r=s.get(e);r?null!=t&&null!=r[t]?r[t]?.cache.delete(n):o.deleteBlock(e,n):null==t&&o.deleteBlock(e,n)}function d(e,t){const n=s.get(e);return n?n[t]??null:null}function m(e,t,n,s,o,a,l=null){const u=d(e,t);if(!u)return;const c=u.extent,{cache:p,rasterInfo:h}=u;if(c&&c.xmin===n.xmin&&c.xmax===n.xmax&&c.ymin===n.ymin&&c.ymax===n.ymax)return;s=s??0;const f=n.clone().normalize(),{spatialReference:m,transform:y}=h,g=new Set;for(let e=0;e<f.length;e++){const t=f[e];if(t.xmax-t.xmin<=s||t.ymax-t.ymin<=s)continue;let n=(0,r._l)(t,m,l);null!=y&&(n=y.inverseTransform(n));const u=new i.default({x:s,y:s,spatialReference:t.spatialReference});if(null==o&&!(o=(0,r.Wo)(u,m,t,l)))return;const{pyramidLevel:c,pyramidResolution:p,excessiveReading:d}=(0,r.t$)(o,h,a||"closest");if(d)return;const{storageInfo:w}=h,{origin:b}=w,v={x:Math.max(0,Math.floor((n.xmin-b.x)/p.x)),y:Math.max(0,Math.floor((b.y-n.ymax)/p.y))},x=Math.ceil((n.xmax-n.xmin)/p.x-.1),M=Math.ceil((n.ymax-n.ymin)/p.y-.1),A=c>0?w.pyramidBlockWidth:w.blockWidth,I=c>0?w.pyramidBlockHeight:w.blockHeight,S=1,_=Math.max(0,Math.floor(v.x/A)-S),C=Math.max(0,Math.floor(v.y/I)-S),T=Math.floor((v.x+x-1)/A)+S,k=Math.floor((v.y+M-1)/I)+S;for(let e=C;e<=k;e++)for(let t=_;t<=T;t++)g.add(`${c}/${e}/${t}`)}p.forEach(((e,t)=>{if(!g.has(t)){const e=p.get(t);(null==e||e.isResolved||e.isRejected)&&p.delete(t)}})),u.extent={xmin:n.xmin,ymin:n.ymin,xmax:n.xmax,ymax:n.ymax}}},11958:function(e,t,n){function r(e,t){let n=0,r="",i=0,s=0;const o=e.length;for(;n<o;)s=e[n++],i=s>>4,i<8?i=1:15===i?(i=4,s=(7&s)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++]):14===i?(i=3,s=(15&s)<<12|(63&e[n++])<<6|63&e[n++]):(i=2,s=(31&s)<<6|63&e[n++]),(0!==s||t)&&(r+=String.fromCharCode(s));return r}n.d(t,{w:function(){return r}})},30158:function(e,t,n){n.d(t,{DY:function(){return y},NG:function(){return v},QW:function(){return o},Rp:function(){return f},ct:function(){return d},fy:function(){return m},sx:function(){return h},xx:function(){return a},z2:function(){return g}});var r=n(50659),i=n(7860);function s(e,t,n){const r=t.shift();if(0===n.length){const e=[];n.push({sliceId:-1,multidimensionalDefinition:e})}const i=n.length;for(let t=0;t<i;t++){const t=n.shift().multidimensionalDefinition;r.values?.forEach((i=>{n.push({sliceId:-1,multidimensionalDefinition:[...t,{variableName:e,dimensionName:r.name,values:[i]}]})}))}t.length&&s(e,t,n)}function o(e,t){const n=[];let r=0;return(t?e.variables.filter((e=>e.name.toLowerCase()===t.toLowerCase())):[...e.variables].sort(((e,t)=>e.name>t.name?1:-1))).forEach((e=>{const t=[],i=[...e.dimensions].sort(((e,t)=>e.name>t.name?-1:1));s(e.name,i,t),t.forEach((e=>{n.push({...e,sliceId:r++})}))})),n}function a(e,t,n){let r=e;if(t&&(t=[...t].sort(((e,t)=>e.dimensionName<t.dimensionName?-1:1))).forEach((({dimensionName:e,values:t,isSlice:n})=>{t.length&&(r=r.filter((r=>{const i=r.multidimensionalDefinition.find((t=>t.dimensionName===e));if(null==i)return!1;const s=i.values[0];return"number"==typeof s?"number"==typeof t[0]?t.includes(s):t.some((e=>e[0]<=s&&e[1]>=s)):"number"==typeof t[0]?t.some((e=>s[0]<=e&&s[1]>=e)):n?t.some((e=>e[0]===s[0]&&e[0]===s[1])):t.some((e=>e[0]>=s[0]&&e[0]<=s[1]||e[1]>=s[0]&&e[1]<=s[1]||e[0]<s[0]&&e[1]>s[1]))})))})),r.length&&null!=n?.start&&null!=n.end){const e=n.start.getTime(),t=n.end.getTime(),i=r[0].multidimensionalDefinition.findIndex((e=>"StdTime"===e.dimensionName));i>-1&&(r=r.filter((n=>{const r=n.multidimensionalDefinition[i].values[0];return e<=r&&t>=r})))}return r.map((e=>e.sliceId))}function l(e,t){return Array.isArray(e)?t[0]===t[1]?e[0]===t[0]||e[1]===t[0]:e[0]>=t[0]&&e[0]<=t[1]&&e[1]>=t[0]&&e[1]<=t[1]:e>=t[0]&&e<=t[1]}function u(e,t){return e[0]<=t[0]&&e[1]>=t[0]||e[0]<=t[1]&&e[1]>=t[1]||e[0]>=t[0]&&e[1]<=t[1]}function c(e){return 1===e.length?[e[0],e[0]]:[e[0],e[e.length-1]]}function p(e,t,n){if(!t?.subsetDefinitions?.length)return e;let r;if(n){const{variables:i}=t;if(i.length&&!i.includes(n))return null;const s=t.subsetDefinitions.find((t=>t.dimensionName===e.name&&t.variableName===n));if(!s?.values?.length)return e;r=c(s.values)}else{const n=t.dimensions.find((({name:t})=>t===e.name));r=n?.extent}const i=r;if(!i?.length)return e;const s=e.values.filter((e=>l(e,i)));return{...e,extent:[...i],values:s}}function h(e,t,n){if(!t?.subsetDefinitions?.length)return!1;const{variables:r}=t;if(r.length&&e.some((({variableName:e})=>e&&!r.includes(e))))return!0;for(let r=0;r<e.length;r++){const i=e[r],s=t.subsetDefinitions.find((e=>(""===i.variableName||e.variableName===i.variableName)&&e.dimensionName===i.dimensionName));if(s?.values.length){const e=c(s.values);if(i.isSlice||2!==i.values.length||Array.isArray(i.values[0])||i.values[0]===i.values[1]||!n){if(i.values.some((t=>!l(t,e))))return!0}else if(!u(i.values,e))return!0}}return!1}function f(e,t){if(null==e)return{isOutside:!1};const{geometry:n,timeExtent:r,multidimensionalDefinition:s}=t;let o=null;if(null!=r&&(o=function(e,t){const n=e.dimensions.find((({name:e})=>"StdTime"===e));if(null==n||null==t.start&&null==t.end)return t;t=t.clone();const{start:r,end:s}=t.toJSON(),o=r===s?[r]:null!=r&&null!=s?[r,s]:[r??s];return 2===o.length&&n?.extent.length&&(o[0]=Math.max(o[0],n.extent[0]),o[1]=Math.min(o[1],n.extent[1]??n.extent[0]),o[1]<o[0])||h([new i.A({variableName:"",dimensionName:"StdTime",isSlice:1===o.length,values:o})],e,!0)?null:(t.start=new Date(o[0]),t.end=new Date(o[1]??o[0]),t)}(e,r),null==o))return{isOutside:!0};const{areaOfInterest:a}=e;if(a&&n){const e="point"===n.type?n:"extent"===n.type?n.center:"polygon"===n.type?n.centroid:null;if(e&&!a.contains(e))return{isOutside:!0}}return null!=s&&s.length&&h(s,e,!0)?{isOutside:!0}:{isOutside:!1,intersection:{geometry:n,timeExtent:o,multidimensionalDefinition:s}}}function d(e,t={}){const{multidimensionalInfo:n,keyProperties:r}=e;if(null==n)return null;const{variableName:i,multidimensionalSubset:s,multidimensionalDefinition:o}=t,a=null!=o?o[0]?.variableName:null,l=i||a||r?.DefaultVariable;let{variables:u}=n;return s?.variables?.length&&(u=u.filter((({name:e})=>s.variables.includes(e)))),l?u.find((({name:e})=>e===l))??u[0]:u[0]}function m(e,t={}){const n=d(e,t);if(!n)return null;const r=[],{dimensions:s,name:o}=n;if(0===s.length)return[new i.A({variableName:o,dimensionName:"",values:[],isSlice:!0})];for(let e=0;e<s.length;e++){const n=p(s[e],t.multidimensionalSubset,o);if(!n)return null;const{values:a,extent:l}=n;let u=a?.[0]??l?.[0];"stdz"===n.name.toLowerCase()&&!n.hasRanges&&l&&Math.abs(l[1])<=Math.abs(l[0])&&(u=a?.length?a[a.length-1]:l[1]),r.push(new i.A({variableName:o,dimensionName:n.name,values:[u],isSlice:!t.useRangeForRangedDimensionInfo||!!n.hasRanges}))}return r}function y(e){return!!e?.length&&e.some((e=>{if(null==e.values)return!0;const t=e.values.length;return 0===t||t>1||!e.isSlice&&Array.isArray(e.values[0])}))}function g(e,t){if(null==t||null==e)return null;let n=t.variables.map((e=>({...e})));return e?.variables?.length&&(n=n.filter((({name:t})=>e.variables.includes(t))),n.forEach((t=>{t.dimensions=t.dimensions.map((n=>p(n,e,t.name))).filter(r.Ru)}))),n}function w(e,t){const{values:n}=t;if(n?.length){const t=Array.isArray(n[0]),r=Array.isArray(e);return t!==r?-1:t&&r?n.findIndex((t=>t[0]===e[0]&&t[1]===e[1])):n.indexOf(e)}const{extent:r}=t;if(Array.isArray(e)||!r||e<r[0]||e>r[1])return-1;const i=t.interval||1;if("ISO8601"!==t.unit)return Math.round((e-r[0])/i);const s=r[0];let o=-1;switch(t.intervalUnit?.toLowerCase()||"days"){case"seconds":o=Math.round((e-s)/1e3/i);break;case"minutes":o=Math.round((e-s)/6e4/i);break;case"hours":o=Math.round((e-s)/36e5/i);break;case"days":o=Math.round((e-s)/864e5/i);break;case"months":{const t=new Date(e).getUTCFullYear()-new Date(s).getUTCFullYear(),n=new Date(s).getUTCMonth(),r=new Date(e).getUTCMonth();o=0===t?r-n:r+11-n+12*(t-1)}break;case"years":o=Math.round((new Date(e).getUTCFullYear()-new Date(s).getUTCFullYear())/i);break;case"decades":o=Math.round((new Date(e).getUTCFullYear()-new Date(s).getUTCFullYear())/10/i)}return o}function b(e){let t=e.values?.length;if(t)return t;const{extent:n,unit:r}=e,i=e.interval||1,s=n?n[1]-n[0]:0;if("ISO8601"!==r)return Math.round(s/i);switch(e.intervalUnit?.toLowerCase()??"seconds"){case"seconds":t=Math.round(s/1e3/i);break;case"minutes":t=Math.round(s/6e4/i);break;case"hours":t=Math.round(s/36e5/i);break;case"days":t=Math.round(s/864e5/i);break;case"months":if(n){const e=new Date(n[1]).getUTCFullYear()-new Date(n[0]).getUTCFullYear(),r=new Date(n[0]).getUTCMonth(),i=new Date(n[1]).getUTCMonth();t=0===e?i-r+1:i+11-r+12*(e-1)+1}else t=0;break;case"years":t=n?Math.round((new Date(n[1]).getUTCFullYear()-new Date(n[0]).getUTCFullYear())/i):0;break;case"decades":t=n?Math.round((new Date(n[1]).getUTCFullYear()-new Date(n[0]).getUTCFullYear())/10/i):0;break;default:t=0}return t}function v(e,t){let n=0;const r=e[0].variableName,i=[...t.variables].sort(((e,t)=>e.name>t.name?1:-1));for(let t=0;t<i.length;t++){const s=i[t],o=[...s.dimensions].sort(((e,t)=>e.name>t.name?-1:1));if(s.name!==r){n+=o.map((e=>b(e))).reduce(((e,t)=>e*t));continue}const a=o.map((e=>b(e))),l=o.length;for(let t=0;t<l;t++){const r=e.find((e=>e.dimensionName===o[t].name));if(null==r)return null;const i=w(r.values[0],o[t]);if(-1===i)return null;a.shift(),n+=t===l-1?i:i*a.reduce(((e,t)=>e*t))}break}return n}},32405:function(e,t,n){n.d(t,{SZ:function(){return i},e8:function(){return o},hm:function(){return s}});var r=n(73037);const i=(0,r.O)()({RSP_NearestNeighbor:"nearest",RSP_BilinearInterpolation:"bilinear",RSP_CubicConvolution:"cubic",RSP_Majority:"majority"}),s=(0,r.O)()({esriNoDataMatchAny:"any",esriNoDataMatchAll:"all"}),o=(0,r.O)()({U1:"u1",U2:"u2",U4:"u4",U8:"u8",S8:"s8",U16:"u16",S16:"s16",U32:"u32",S32:"s32",F32:"f32",F64:"f64",C64:"c64",C128:"c128",UNKNOWN:"unknown"})},80426:function(e,t,n){n.d(t,{D4:function(){return c},Hh:function(){return o}});var r=n(53216);const i=[{pixelType:"S8",size:1,ctor:Int8Array,range:[-128,127]},{pixelType:"U8",size:1,ctor:Uint8Array,range:[0,255]},{pixelType:"S16",size:2,ctor:Int16Array,range:[-32768,32767]},{pixelType:"U16",size:2,ctor:Uint16Array,range:[0,65536]},{pixelType:"S32",size:4,ctor:Int32Array,range:[-2147483648,2147483647]},{pixelType:"U32",size:4,ctor:Uint32Array,range:[0,4294967296]},{pixelType:"F32",size:4,ctor:Float32Array,range:[-34027999387901484e22,34027999387901484e22]},{pixelType:"F64",size:8,ctor:Float64Array,range:[-17976931348623157e292,17976931348623157e292]}];let s=null;function o(){return s||(s=n.e(7535).then(n.bind(n,65915)).then((e=>e.l)).then((({default:e})=>e({locateFile:e=>(0,r.s)(`esri/layers/support/rasterFormats/${e}`)}))).then((e=>{!function(e){const{_malloc:t,_free:n,_lerc_getBlobInfo:r,_lerc_getDataRanges:s,_lerc_decode_4D:o,asm:u}=e;let c;const p=Object.values(u).find((t=>t&&"buffer"in t&&t.buffer===e.HEAPU8.buffer)),h=e=>{const n=e.map((e=>function(e){return 16+(e>>3<<3)}(e))),r=n.reduce(((e,t)=>e+t)),i=t(r);c=new Uint8Array(p.buffer);let s=n[0];n[0]=i;for(let e=1;e<n.length;e++){const t=n[e];n[e]=n[e-1]+s,s=t}return n};a.getBlobInfo=e=>{const t=new Uint8Array(48),i=new Uint8Array(24),[o,a,u]=h([e.length,t.length,i.length]);c.set(e,o),c.set(t,a),c.set(i,u);let f=r(o,e.length,a,u,12,3);if(f)throw n(o),new Error(`lerc-getBlobInfo: error code is ${f}`);c=new Uint8Array(p.buffer),l(c,a,t),l(c,u,i);const d=new Uint32Array(t.buffer),m=new Float64Array(i.buffer),[y,g,,w,b,v,x,M,A,I,S]=d,_={version:y,depthCount:I,width:w,height:b,validPixelCount:x,bandCount:v,blobSize:M,maskCount:A,dataType:g,minValue:m[0],maxValue:m[1],maxZerror:m[2],statistics:[],bandCountWithNoData:S};if(S&&I>1)return n(o),_;if(1===I&&1===v)return n(o),_.statistics.push({minValue:m[0],maxValue:m[1]}),_;const C=I*v*8,T=new Uint8Array(C),k=new Uint8Array(C);let R=o,P=0,N=0,D=!1;if(c.byteLength<o+2*C?(n(o),D=!0,[R,P,N]=h([e.length,C,C]),c.set(e,R)):[P,N]=h([C,C]),c.set(T,P),c.set(k,N),f=s(R,e.length,I,v,P,N),f)throw n(R),D||n(P),new Error(`lerc-getDataRanges: error code is ${f}`);c=new Uint8Array(p.buffer),l(c,P,T),l(c,N,k);const E=new Float64Array(T.buffer),L=new Float64Array(k.buffer),F=_.statistics;for(let e=0;e<v;e++)if(I>1){const t=E.slice(e*I,(e+1)*I),n=L.slice(e*I,(e+1)*I),r=Math.min.apply(null,t),i=Math.max.apply(null,n);F.push({minValue:r,maxValue:i,depthStats:{minValues:t,maxValues:n}})}else F.push({minValue:E[e],maxValue:L[e]});return n(R),D||n(P),_},a.decode=(e,t)=>{const{maskCount:r,depthCount:s,bandCount:a,width:u,height:f,dataType:d,bandCountWithNoData:m}=t,y=i[d],g=u*f,w=new Uint8Array(g*a),b=g*s*a*y.size,v=new Uint8Array(b),x=new Uint8Array(a),M=new Uint8Array(8*a),[A,I,S,_,C]=h([e.length,w.length,v.length,x.length,M.length]);c.set(e,A),c.set(w,I),c.set(v,S),c.set(x,_),c.set(M,C);const T=o(A,e.length,r,I,s,u,f,a,d,S,_,C);if(T)throw n(A),new Error(`lerc-decode: error code is ${T}`);c=new Uint8Array(p.buffer),l(c,S,v),l(c,I,w);let k=null;if(m){l(c,_,x),l(c,C,M),k=[];const e=new Float64Array(M.buffer);for(let t=0;t<x.length;t++)k.push(x[t]?e[t]:null)}return n(A),{data:v,maskData:w,noDataValues:k}}}(e)})),s)}const a={getBlobInfo:null,decode:null};function l(e,t,n){n.set(e.slice(t,t+n.length))}function u(e,t,n,r,i){if(n<2)return e;const s=new r(t*n);for(let r=0,i=0;r<t;r++)for(let o=0,a=r;o<n;o++,a+=t)s[a]=e[i++];return s}function c(e,t={}){const n=t.inputOffset??0,r=e instanceof Uint8Array?e.subarray(n):new Uint8Array(e,n),s=a.getBlobInfo(r),{data:o,maskData:l,noDataValues:c}=a.decode(r,s),{width:p,height:h,bandCount:f,depthCount:d,dataType:m,maskCount:y,statistics:g}=s,w=i[m],b=new w.ctor(o.buffer),v=[],x=[],M=p*h,A=M*d;for(let e=0;e<f;e++){const n=b.subarray(e*A,(e+1)*A);if(t.returnInterleaved)v.push(n);else{const e=u(n,M,d,w.ctor);v.push(e)}x.push(l.subarray(e*A,(e+1)*A))}const I=0===y?null:1===y?x[0]:new Uint8Array(M);if(y>1){I.set(x[0]);for(let e=1;e<x.length;e++){const t=x[e];for(let e=0;e<M;e++)I[e]=I[e]&t[e]}}const{noDataValue:S}=t,_=null!=S&&w.range[0]<=S&&w.range[1]>=S;if(y>0&&_)for(let e=0;e<f;e++){const t=v[e],n=x[e]||I;for(let e=0;e<M;e++)0===n[e]&&(t[e]=S)}const C=y===f&&f>1?x:null,{pixelType:T}=w;return{width:p,height:h,bandCount:f,pixelType:T,depthCount:d,statistics:g,pixels:v,mask:I,bandMasks:C,noDataValues:c}}},94235:function(e,t,n){function r(){const e=[];for(let t=0;t<=257;t++)e[t]=[t];return e}function i(e,t){for(let n=0;n<t.length;n++)e.push(t[n])}n.d(t,{D:function(){return o}});const s=new Set;function o(e,t,n,o=!0){const a=function(e,t,n,r=!0){if(t%4!=0||n%4!=0){const i=new ArrayBuffer(4*Math.ceil(n/4)),s=new Uint8Array(i),o=new Uint8Array(e,t,n);if(r)for(let e=0;e<s.length;e+=4)s[e]=o[e+3],s[e+1]=o[e+2],s[e+2]=o[e+1],s[e+3]=o[e];else s.set(o);return new Uint32Array(s.buffer)}if(r){const r=new Uint8Array(e,t,n),i=new Uint8Array(r.length);for(let e=0;e<i.length;e+=4)i[e]=r[e+3],i[e+1]=r[e+2],i[e+2]=r[e+1],i[e+3]=r[e];return new Uint32Array(i.buffer)}return new Uint32Array(e,t,n/4)}(e,t,n,o);let l=9,u=r(),c=32,p=u.length,h=[],f=1,d=a[0],m=0;const y=a.length,g=8*(4*y-n),w=[];for(;null!=d;){if(c>=l)c-=l,m=d>>>32-l,d<<=l;else{m=d>>>32-c,d=a[f++];const e=l-c;c=32-e,m=(m<<e)+(d>>>c),d<<=e}if(257===m)break;if(256===m){l=9,u=r(),p=u.length,h=[];continue}const e=u[m];if(null==e){if(m>u.length)throw new Error("data integrity issue: code does not exist on code page");h.push(h[0]),u[p++]=h.slice(),i(w,h)}else i(w,e),h.push(e[0]),h.length>1&&(u[p++]=h.slice()),h=e.slice();if(s.has(p)&&l++,0===c&&(d=a[f++],c=32),f>y||f===y&&c<=g)break}return new Uint8Array(w)}s.add(511),s.add(1023),s.add(2047),s.add(4095),s.add(8191)},43008:function(e,t,n){n.d(t,{D:function(){return N},g:function(){return P}});var r=n(39819),i=n(95929),s=n(21327),o=n(42568),a=n(60539),l=n(82499);class u{constructor(e){this._canvas=null,this._ctx=null,e&&(this._canvas=e.canvas,this._ctx=e.ctx||e.canvas&&e.canvas.getContext("2d"))}decode(e,t,n){if(!e||e.byteLength<10)throw new r.A("imagecanvasdecoder: decode","required a valid encoded data as input.");let{width:i=0,height:s=0,format:o}=t;const{applyJpegMask:l}=t;if(l&&(!i||!s))throw new r.A("imagecanvasdecoder: decode","image width and height are needed to apply jpeg mask directly to canvas");return new Promise(((r,c)=>{let p=null;"jpg"===o&&l&&(p=u._getMask(e,{width:i,height:s}));const h=new Blob([new Uint8Array(e)],{type:"image/"+o=="jpg"?"jpeg":o}),f=URL.createObjectURL(h),d=new Image;let m;d.src=f,d.onload=()=>{if(URL.revokeObjectURL(f),(0,a.G4)(n))return void c((0,a.NK)());i=d.width,s=d.height,this._canvas&&this._ctx?(this._canvas.width===i&&this._canvas.height===s||(this._canvas.width=i,this._canvas.height=s),this._ctx.clearRect(0,0,i,s)):(this._canvas=document.createElement("canvas"),this._canvas.width=i,this._canvas.height=s,this._ctx=this._canvas.getContext("2d")),this._ctx.drawImage(d,0,0);const e=this._ctx.getImageData(0,0,i,s);let o;if(m=e.data,t.renderOnCanvas){if(p)for(o=0;o<p.length;o++)p[o]?m[4*o+3]=255:m[4*o+3]=0;return this._ctx.putImageData(e,0,0),void r(null)}const l=i*s,u=new Uint8Array(l),h=new Uint8Array(l),y=new Uint8Array(l);if(p)for(o=0;o<l;o++)u[o]=m[4*o],h[o]=m[4*o+1],y[o]=m[4*o+2];else for(p=new Uint8Array(l),o=0;o<l;o++)u[o]=m[4*o],h[o]=m[4*o+1],y[o]=m[4*o+2],p[o]=m[4*o+3];r({width:i,height:s,pixels:[u,h,y],mask:p,pixelType:"u8"})},d.onerror=()=>{URL.revokeObjectURL(f),c("cannot load image")}}))}static _getMask(e,t){let n=null;try{const r=new Uint8Array(e),i=Math.ceil(r.length/2);let s=0;const o=r.length-2;for(s=i;s<o&&(255!==r[s]||217!==r[s+1]);s++);if(s+=2,s<r.length-1){const e=new l.Z(r.subarray(s)).getBytes();n=new Uint8Array(t.width*t.height);let i=0;for(let t=0;t<e.length;t++)for(let r=7;r>=0;r--)n[i++]=e[t]>>r&1}}catch(e){}return n}}var c=n(90735);class p{static decode(e,t=!1){const n=new Uint8Array(e),r=new c.J;r.parse(n);const{width:i,height:s,numComponents:o,eof:a}=r,u=r.getData(i,s,!0),p=i*s;let h,f=null,d=0,m=0,y=0;if(!t&&a<n.length-1)try{const e=new l.Z(n.subarray(a)).getBytes();f=new Uint8Array(p);let t=0;for(d=0;d<e.length;d++)for(y=7;y>=0;y--)f[t++]=e[d]>>y&1}catch{}if(1===o&&u.length===i*s){const e=new Uint8Array(u.buffer);h=[e,e,e]}else{for(h=[],d=0;d<3;d++)h.push(new Uint8Array(p));for(y=0,m=0;m<p;m++)for(d=0;d<3;d++)h[d][m]=u[y++]}return{width:i,height:s,pixels:h,mask:f}}}var h=n(80426),f=n(94235),d=n(95738);const m=(e,t)=>{const n=t.width*t.height,r=t.pixelType;return Math.floor(e.byteLength/(n*y(r)))},y=e=>{let t=1;switch(e){case Uint8Array:case Int8Array:t=1;break;case Uint16Array:case Int16Array:t=2;break;case Uint32Array:case Int32Array:case Float32Array:t=4;break;case Float64Array:t=8}return t};class g{static decode(e,t){const n=t.pixelType,r=[],i=t.width*t.height,s=m(e,t),{bandIds:o,format:a}=t,l=o?.length||m(e,t),u=e.byteLength-e.byteLength%(i*y(n)),c=new n(e,0,i*s);let p,h,f,d,g=null;if("bip"===a)for(p=0;p<l;p++){for(f=new n(i),d=o?o[p]:p,h=0;h<i;h++)f[h]=c[h*s+d];r.push(f)}else if("bsq"===a)for(p=0;p<l;p++)d=o?o[p]:p,r.push(c.subarray(d*i,(d+1)*i));return u<e.byteLength-1&&(g=((e,t)=>{if(8*e.byteLength<t)return null;const n=new Uint8Array(e,0,Math.ceil(t/8)),r=new Uint8Array(t);let i=0,s=0,o=0,a=0;for(o=0;o<n.length-1;o++)for(s=n[o],a=7;a>=0;a--)r[i++]=s>>a&1;for(a=7;i<t-1;)s=n[n.length-1],r[i++]=s>>a&1,a--;return r})(e.slice(u),i)),{pixels:r,mask:g}}}var w=n(3685),b=n(70041),v=function(e){var t,n,r;function i(e){var t,n,r,i,s,o,a,l,u,c,p,h,f;for(this.data=e,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},s=null;;){switch(t=this.readUInt32(),l=function(){var e,t;for(t=[],e=0;e<4;++e)t.push(String.fromCharCode(this.data[this.pos++]));return t}.call(this).join(""),l){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(t);break;case"fcTL":s&&this.animation.frames.push(s),this.pos+=4,s={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},i=this.readUInt16(),r=this.readUInt16()||100,s.delay=1e3*i/r,s.disposeOp=this.data[this.pos++],s.blendOp=this.data[this.pos++],s.data=[];break;case"IDAT":case"fdAT":for("fdAT"===l&&(this.pos+=4,t-=4),e=(null!=s?s.data:void 0)||this.imgData,p=0;0<=t?p<t:p>t;0<=t?++p:--p)e.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(this.transparency.indexed=this.read(t),(u=255-this.transparency.indexed.length)>0)for(h=0;0<=u?h<u:h>u;0<=u?++h:--h)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(t)[0];break;case 2:this.transparency.rgb=this.read(t)}break;case"tEXt":o=(c=this.read(t)).indexOf(0),a=String.fromCharCode.apply(String,c.slice(0,o)),this.text[a]=String.fromCharCode.apply(String,c.slice(o+1));break;case"IEND":return s&&this.animation.frames.push(s),this.colors=function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}.call(this),this.hasAlphaChannel=4===(f=this.colorType)||6===f,n=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*n,this.colorSpace=function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}.call(this),void(this.imgData=new Uint8Array(this.imgData));default:this.pos+=t}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}}return i.load=function(e,t,n){var r;return"function"==typeof t&&(n=t),(r=new XMLHttpRequest).open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(){var e;return e=new i(new Uint8Array(r.response||r.mozResponseArrayBuffer)),"function"==typeof(null!=t?t.getContext:void 0)&&e.render(t),"function"==typeof n?n(e):void 0},r.send(null)},i.prototype.read=function(e){var t,n;for(n=[],t=0;0<=e?t<e:t>e;0<=e?++t:--t)n.push(this.data[this.pos++]);return n},i.prototype.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},i.prototype.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},i.prototype.decodePixels=function(e){var t,n,r,i,s,o,a,u,c,p,h,f,d,m,y,g,w,b,v,x,M,A,I;if(null==e&&(e=this.imgData),0===e.length)return new Uint8Array(0);for(e=(e=new l.Z(e)).getBytes(),g=(f=this.pixelBitlength/8)*this.width,d=new Uint8Array(g*this.height),o=e.length,y=0,m=0,n=0;m<o;){switch(e[m++]){case 0:for(i=v=0;v<g;i=v+=1)d[n++]=e[m++];break;case 1:for(i=x=0;x<g;i=x+=1)t=e[m++],s=i<f?0:d[n-f],d[n++]=(t+s)%256;break;case 2:for(i=M=0;M<g;i=M+=1)t=e[m++],r=(i-i%f)/f,w=y&&d[(y-1)*g+r*f+i%f],d[n++]=(w+t)%256;break;case 3:for(i=A=0;A<g;i=A+=1)t=e[m++],r=(i-i%f)/f,s=i<f?0:d[n-f],w=y&&d[(y-1)*g+r*f+i%f],d[n++]=(t+Math.floor((s+w)/2))%256;break;case 4:for(i=I=0;I<g;i=I+=1)t=e[m++],r=(i-i%f)/f,s=i<f?0:d[n-f],0===y?w=b=0:(w=d[(y-1)*g+r*f+i%f],b=r&&d[(y-1)*g+(r-1)*f+i%f]),a=s+w-b,u=Math.abs(a-s),p=Math.abs(a-w),h=Math.abs(a-b),c=u<=p&&u<=h?s:p<=h?w:b,d[n++]=(t+c)%256;break;default:throw new Error("Invalid filter algorithm: "+e[m-1])}y++}return d},i.prototype.decodePalette=function(){var e,t,n,r,i,s,o,a,l;for(n=this.palette,s=this.transparency.indexed||[],i=new Uint8Array((s.length||0)+n.length),r=0,n.length,e=0,t=o=0,a=n.length;o<a;t=o+=3)i[r++]=n[t],i[r++]=n[t+1],i[r++]=n[t+2],i[r++]=null!=(l=s[e++])?l:255;return i},i.prototype.copyToImageData=function(e,t){var n,r,i,s,o,a,l,u,c,p,h;if(r=this.colors,c=null,n=this.hasAlphaChannel,this.palette.length&&(c=null!=(h=this._decodedPalette)?h:this._decodedPalette=this.decodePalette(),r=4,n=!0),u=(i=e.data||e).length,o=c||t,s=a=0,1===r)for(;s<u;)l=c?4*t[s/4]:a,p=o[l++],i[s++]=p,i[s++]=p,i[s++]=p,i[s++]=n?o[l++]:this.transparency.grayscale&&this.transparency.grayscale===p?0:255,a=l;else for(;s<u;)l=c?4*t[s/4]:a,i[s++]=o[l++],i[s++]=o[l++],i[s++]=o[l++],i[s++]=n?o[l++]:this.transparency.rgb&&this.transparency.rgb[1]===o[l-3]&&this.transparency.rgb[3]===o[l-2]&&this.transparency.rgb[5]===o[l-1]?0:255,a=l},i.prototype.decode=function(){var e;return e=new Uint8Array(this.width*this.height*4),this.copyToImageData(e,this.decodePixels()),e},n=e.document&&e.document.createElement("canvas"),r=n&&n.getContext("2d"),t=function(e){var t;return r.width=e.width,r.height=e.height,r.clearRect(0,0,e.width,e.height),r.putImageData(e,0,0),(t=new Image).src=n.toDataURL(),t},i.prototype.decodeFrames=function(e){var n,r,i,s,o,a,l,u;if(this.animation){for(u=[],r=o=0,a=(l=this.animation.frames).length;o<a;r=++o)n=l[r],i=e.createImageData(n.width,n.height),s=this.decodePixels(new Uint8Array(n.data)),this.copyToImageData(i,s),n.imageData=i,u.push(n.image=t(i));return u}},i.prototype.renderFrame=function(e,t){var n,r,i;return n=(r=this.animation.frames)[t],i=r[t-1],0===t&&e.clearRect(0,0,this.width,this.height),1===(null!=i?i.disposeOp:void 0)?e.clearRect(i.xOffset,i.yOffset,i.width,i.height):2===(null!=i?i.disposeOp:void 0)&&e.putImageData(i.imageData,i.xOffset,i.yOffset),0===n.blendOp&&e.clearRect(n.xOffset,n.yOffset,n.width,n.height),e.drawImage(n.image,n.xOffset,n.yOffset)},i.prototype.animate=function(e){var t,n,r,i,s,o,a=this;return n=0,o=this.animation,i=o.numFrames,r=o.frames,s=o.numPlays,(t=function(){var o,l;if(o=n++%i,l=r[o],a.renderFrame(e,o),i>1&&n/i<s)return a.animation._timeout=setTimeout(t,l.delay)})()},i.prototype.stopAnimation=function(){var e;return clearTimeout(null!=(e=this.animation)?e._timeout:void 0)},i.prototype.render=function(e){var t,n;return e._png&&e._png.stopAnimation(),e._png=this,e.width=this.width,e.height=this.height,t=e.getContext("2d"),this.animation?(this.decodeFrames(t),this.animate(t)):(n=t.createImageData(this.width,this.height),this.copyToImageData(n,this.decodePixels()),t.putImageData(n,0,0))},i}(self);const x=new Set(["jpg","png","bmp","gif"]);async function M(e,t){if(!b.Z)throw new r.A("rasterCoded:decode","lerc decoder is not supported on big endian platform");await(0,h.Hh)();const{offset:n}=t,{width:i,height:a,pixelType:l,statistics:u,depthCount:c,noDataValues:p,bandMasks:f,pixels:d,mask:m}=(0,h.D4)(e,{inputOffset:n,returnInterleaved:t.returnInterleaved}),y=new s.A({width:i,height:a,pixelType:l.toLowerCase(),pixels:d,mask:m,statistics:u.map((({minValue:e,maxValue:t})=>new o.z(e,t))),bandMasks:f,depthCount:c,noDataValues:p});return u?.length||y.updateStatistics(),y}async function A(e,t){const n=await(0,w.D4)(e,{...t,noDataValue:null});(0,i.Lw)(n);const r=new s.A({width:n.width,height:n.height,pixels:n.pixels,pixelType:n.pixelType.toLowerCase(),mask:n.mask,bandMasks:n.bandMasks,statistics:null});return r.updateStatistics(),r}function I(e,t){const n=t.pixelType||"u8",r=s.A.getPixelArrayConstructor(n),i="u8"===n?e:new r(e.buffer),o=[],a=t.planes||1;if(1===a)o.push(i);else for(let n=0;n<a;n++){const s=(t.width||1)*(t.height||e.length),l=new r(s);for(let e=0;e<s;e++)l[e]=i[e*a+n];o.push(l)}const l=new s.A({width:t.width||1,height:t.height||e.length,pixels:o,pixelType:n,statistics:null});return l.updateStatistics(),l}function S(e,t){return I(new l.Z(new Uint8Array(e)).getBytes(),t)}function _(e,t){return I((0,f.D)(e,t.offset,t.eof,!t.isInputBigEndian),t)}function C(e,t,n){const{pixelTypeCtor:r}=function(e){let t=null,n=null;switch(e?e.toLowerCase():"f32"){case"u1":case"u2":case"u4":case"u8":n=255,t=Uint8Array;break;case"u16":n=n||65535,t=Uint16Array;break;case"u32":n=n||2**32-1,t=Uint32Array;break;case"s8":n=n||-128,t=Int8Array;break;case"s16":n=n||-32768,t=Int16Array;break;case"s32":n=n||0-2**31,t=Int32Array;break;default:t=Float32Array}return{pixelTypeCtor:t,noDataValue:n}}(t.pixelType),i=(0,g.decode)(e,{width:t.width,height:t.height,pixelType:r,format:n}),o=new s.A({width:t.width,height:t.height,pixels:i.pixels,pixelType:t.pixelType,mask:i.mask,statistics:null});return o.updateStatistics(),o}function T(e,t){const n=p.decode(e,t.hasNoZlibMask??void 0),r=new s.A({width:n.width,height:n.height,pixels:n.pixels,pixelType:"u8",mask:n.mask,statistics:null});return r.updateStatistics(),r}function k(e,t){const n=new Uint8Array(e),r=new v(n),{width:i,height:o}=t,a=i*o,l=r.decode();let u,c=0,p=0;const h=new Uint8Array(a);for(c=0;c<a;c++)h[c]=l[4*c+3];const f=new s.A({width:i,height:o,pixels:[],pixelType:"u8",mask:h,statistics:[]});for(c=0;c<3;c++){for(u=new Uint8Array(a),p=0;p<a;p++)u[p]=l[4*p+c];f.addData({pixels:u})}return f.updateStatistics(),f}function R(e){if(null==e)throw new r.A("rasterCodec:decode","parameter encodeddata is required.");const t=new Uint8Array(e,0,10);let n="";return 255===t[0]&&216===t[1]?n="jpg":137===t[0]&&80===t[1]&&78===t[2]&&71===t[3]?n="png":67===t[0]&&110===t[1]&&116===t[2]&&90===t[3]&&73===t[4]&&109===t[5]&&97===t[6]&&103===t[7]&&101===t[8]&&32===t[9]?n="lerc":76===t[0]&&101===t[1]&&114===t[2]&&99===t[3]&&50===t[4]&&32===t[5]?n="lerc2":73===t[0]&&73===t[1]&&42===t[2]&&0===t[3]||77===t[0]&&77===t[1]&&0===t[2]&&42===t[3]||73===t[0]&&73===t[1]&&43===t[2]&&0===t[3]||77===t[0]&&77===t[1]&&0===t[2]&&43===t[3]?n="tiff":71===t[0]&&73===t[1]&&70===t[2]?n="gif":66===t[0]&&77===t[1]?n="bmp":String.fromCharCode.apply(null,t).toLowerCase().includes("error")&&(n="error"),n}function P(e){let t=R(e);return"lerc2"===t?t="lerc":"error"===t&&(t=""),t}async function N(e,t={},n){if(null==e)throw new r.A("rasterCodec:decode","missing encodeddata parameter.");let i=t.format?.toLowerCase();if(!("bsq"!==i&&"bip"!==i||null!=t.width&&null!=t.height))throw new r.A("rasterCodec:decode","requires width and height in options parameter.");if("tiff"===i&&t.customOptions)return async function(e,t){const n=await(0,w.s$)(e,t.customOptions),r=new s.A({width:n.width,height:n.height,pixels:n.pixels,pixelType:n.pixelType.toLowerCase(),mask:n.mask,statistics:null});return r.updateStatistics(),r}(e,t);if((!i||"bsq"!==i&&"bip"!==i&&"deflate"!==i&&"lzw"!==i)&&(i=R(e)),t.useCanvas&&x.has(i))return async function(e,t,n,r){const i=new u,o={applyJpegMask:!1,format:t,...n},a=await i.decode(e,o,r),l=new s.A(a);return l.updateStatistics(),l}(e,i,t,n);const o=function(e){let t=null;switch(e){case"lerc":case"lerc2":t=M;break;case"jpg":t=T;break;case"png":t=k;break;case"bsq":case"bip":t=(t,n)=>C(t,n,e);break;case"tiff":t=A;break;case"deflate":t=S;break;case"lzw":t=_;break;case"error":t=()=>{throw new r.A("rasterCodec:decode","input data contains error")};break;default:t=()=>{throw new r.A("rasterCodec:decode","unsupported raster format")}}return t}(i);let a;t.isPoint&&(null!=(t={...t}).width&&t.width++,null!=t.height&&t.height++);const{offsets:l}=t;if(l&&l.length>1){const n=l.map(((n,r)=>o(e.slice(n,l[r+1]),t))),r=await Promise.all(n);a=r[0],a.pixels=r.map((e=>e.pixels[0]));const i=r.map((e=>e.mask));r.some((e=>null!=e))&&(i.forEach(((e,t)=>{null==e&&(i[t]=new Uint8Array(a.width*a.height).fill(255))})),a.bandMasks=i,a.mask=s.A.combineBandMasks(i)),a.updateStatistics()}else a=await o(e,{...t,offset:l?.[0]??t.offset});return"jpg"!==i&&null!=t.noDataValue&&1===a.depthCount&&(0,d.Sp)(a,t.noDataValue,{customFloatTolerance:t.tolerance}),t.isPoint&&function(e,t=1){if(!e)return;const{pixels:n,width:r,height:i,mask:o}=e;if(!n||0===n.length)return;const a=n.length,l=r-1,u=i-1,c=[];let p,h,f,d,m,y,g=null;const w=s.A.getPixelArrayConstructor(e.pixelType);if(0===t){for(p=0;p<a;p++){for(m=n[p],y=new w(l*u),h=0;h<u;h++)for(d=h*r,f=0;f<l;f++)y[h*l+f]=m[d+f];c.push(y)}if(null!=o)for(g=new Uint8Array(l*u),h=0;h<u;h++)for(d=h*r,f=0;f<l;f++)g[h*l+f]=o[d+f]}else{for(p=0;p<a;p++){for(m=n[p],y=new w(l*u),h=0;h<u;h++)for(d=h*r,f=0;f<l;f++)y[h*l+f]=(m[d+f]+m[d+f+1]+m[d+r+f]+m[d+r+f+1])/4;c.push(y)}if(o)for(g=new Uint8Array(l*u),h=0;h<u;h++)for(d=h*r,f=0;f<l;f++)g[h*l+f]=Math.min.apply(null,[o[d+f],o[d+f+1],o[d+r+f],o[d+r+f+1]])}e.width=l,e.height=u,e.mask=g,e.pixels=c}(a),a}},3685:function(e,t,n){n.d(t,{Cr:function(){return R},D4:function(){return U},JM:function(){return j},XO:function(){return N},r9:function(){return E},s$:function(){return Z},uT:function(){return z},uc:function(){return P},zS:function(){return D}}),n(58941);var r=n(11958),i=n(90735),s=n(80426),o=n(94235),a=n(95738),l=n(57328),u=n(70041),c=n(82499);const p=[0,1,1,2,4,8,1,1,2,4,8,4,8,-1,-1,-1,8,8,8],h=4294967296,f=new Set([1,5,6,7,8,34712,34887]);function d(e,t){let n="unknown";return 3===e?n=64===t?"f64":"f32":1===e?1===t?n="u1":2===t?n="u2":4===t?n="u4":t<=8?n="u8":t<=16?n="u16":t<=32&&(n="u32"):2===e&&(t<=8?n="s8":t<=16?n="s16":t<=32&&(n="s32")),n}function m(e){let t=null;switch(e?e.toLowerCase():"f32"){case"u1":case"u2":case"u4":case"u8":t=Uint8Array;break;case"u16":t=Uint16Array;break;case"u32":t=Uint32Array;break;case"s8":t=Int8Array;break;case"s16":t=Int16Array;break;case"s32":t=Int32Array;break;case"f64":t=Float64Array;break;default:t=Float32Array}return t}function y(e,t){return{x:t[0]*e.x+t[1]*e.y+t[2],y:t[3]*e.x+t[4]*e.y+t[5]}}function g(e,t){return e.get(t)?.values}function w(e,t){return e.get(t)?.values}function b(e,t){return e.get(t)?.values?.[0]}function v(e,t){return e.get(t)?.values?.[0]}function x(e,t,n,r=0,i=l.A.tiffTags,s=4){const o=8===s,a=o?L(new DataView(e,n,8),0,t):new DataView(e,n,2).getUint16(0,t),u=4+2*s,c=o?8:2,p=c+a*u;if(n+p>e.byteLength)return{success:!1,ifd:null,nextIFD:null,requiredBufferSize:p};const h=n+p+4<=e.byteLength?O(new DataView(e,n+p,8===s?8:4),0,t,8===s):null,f=n+c,d=new Map;let m,y,g,w,b,v=0,x=0;for(let n=0;n<a;n++){y=new DataView(e,f+u*n,u),g=y.getUint16(0,t),b=y.getUint16(2,t),w=l.A.getTagName(g,i);const o=[];2===s?(v=y.getUint16(4,t),x=y.getUint16(6,t)):4===s?(v=y.getUint32(4,t),x=y.getUint32(8,t)):8===s&&(v=O(y,4,t,!0),x=O(y,12,t,!0),o.push(y.getUint32(12,t)),o.push(y.getUint32(16,t))),m={id:g,type:b,valueCount:v,valueOffset:x,valueOffsets:o,values:null},R(e,t,m,r,!1,s),d.set(w,m)}return{success:!0,ifd:d,nextIFD:h,requiredBufferSize:p}}const M=(e,t)=>(0,s.D4)(e,{inputOffset:t}).pixels[0];function A(e,t){if(1!==t&&2!==t&&4!==t)return e;const n=new Uint8Array(e),r=8/t,i=new Uint8Array(e.byteLength*r);let s=0;const o=2**t-1;for(let e=0;e<n.length;e++){const a=n[e];for(let e=0;e<r;e++)i[s++]=a<<t*e>>>8-t&o}return i.buffer}function I(e,t,n){const r=new i.J;r.parse(e),r.colorTransform=6===n?-1:0;const s=r.getData(r.width,r.height,1!==t&&4!==t);return new Uint8Array(s.buffer)}function S(e){const t=new c.Z(e).getBytes(),n=new ArrayBuffer(t.length),r=new Uint8Array(n);return r.set(t),r}async function _(e,t,n,r,i){const a=u.Z===t,l=v(n,"BITSPERSAMPLE"),c=v(n,"SAMPLESPERPIXEL")??1,p=v(n,"PHOTOMETRICINTERPRETATION"),h=v(n,"SAMPLEFORMAT")??1,f=d(h,l),y=v(n,"COMPRESSION")??1,g=m(f);let w,b,x;if(34887===y)return await(0,s.Hh)(),M(e,r);if(1===y)w=e.slice(r,r+i),b=new Uint8Array(w);else if(8===y||32946===y)b=new Uint8Array(e,r,i),b=S(b),w=b.buffer;else if(6===y)b=new Uint8Array(e,r,i),b=I(b,c,p),w=b.buffer;else if(7===y){const t=n.get("JPEGTABLES").values,s=t.length-2;b=new Uint8Array(s+i-2);for(let e=0;e<s;e++)b[e]=t[e];const o=new Uint8Array(e,r+2,i-2);for(let e=0;e<o.length;e++)b[s+e]=o[e];b=I(b,c,p),w=b.buffer}else{if(5!==y)throw new Error("tiff-decode: unsupport compression "+y);b=(0,o.D)(e,r,i,t),w=b.buffer}if(w=A(w,l),"u8"===f||"s8"===f||a)x=new g(w);else{w=new ArrayBuffer(b.length);const e=new Uint8Array(w);switch(f){case"u16":case"s16":for(let t=0;t<b.length;t+=2)e[t]=b[t+1],e[t+1]=b[t];break;case"u32":case"s32":case"f32":for(let t=0;t<b.length;t+=4)e[t]=b[t+3],e[t+1]=b[t+2],e[t+2]=b[t+1],e[t+3]=b[t]}x=new g(w)}const _=v(n,"PREDICTOR")??1,C=v(n,"TILEWIDTH"),T=v(n,"TILELENGTH");if(_>1&&(5===y||8===y||32946===y)&&C&&T){const e=N(n),t=new g(x.length);t.set(x),x=function(e,t,n,r,i){const s=r?4:1,o=n*s*i;r&&(e=new Uint8Array(e.buffer));for(let n=0;n<t;n++){const t=n*o;for(let n=i;n<o;n++)e[t+n]+=e[t+n-i]}if(!r)return e;const a=new Uint8Array(e.length),l=n*i;for(let n=0;n<t;n++){const t=n*o;for(let n=0;n<l;n++)for(let r=0;r<s;r++)a[t+n*s+r]=e[t+n+(s-r-1)*l]}return new Float32Array(a.buffer)}(t,T,C,3===h&&3===_,e?1:c)}return x}const C=(e,t,n)=>{const r=u.Z===t.littleEndian,i=w(n,"STRIPOFFSETS");if(void 0===i)return null;const{width:s,height:a,pixelType:l}=P([n]),c=v(n,"SAMPLESPERPIXEL")||t.planes,p=v(n,"PHOTOMETRICINTERPRETATION"),h=s*a,f=v(n,"BITSPERSAMPLE"),d=m(l),y=new d(h*c),g=w(n,"STRIPBYTECOUNTS"),b=v(n,"ROWSPERSTRIP"),x=v(n,"COMPRESSION")??1;let M,_,C,T,k,R,N,D,E;if(f%8==0)for(M=0;M<i.length;M++){if(k=M*(b*s)*c,"u8"===l||"s8"===l||r)8===x||32946===x?(N=new Uint8Array(e,i[M],g[M]),N=S(N),R=N.buffer):6===x?(N=new Uint8Array(e,i[M],g[M]),N=I(N,c,p),R=N.buffer):5===x?(N=(0,o.D)(e,i[M],g[M],t.littleEndian),R=N.buffer):R=e.slice(i[M],i[M]+g[M]),R=A(R,f),T=new d(R);else{switch(6===x||8===x||32946===x?(N=new Uint8Array(e,i[M],g[M]),D=S(N),R=D.buffer):(R=new ArrayBuffer(g[M]),N=new Uint8Array(e,i[M],g[M]),D=new Uint8Array(R)),l){case"u16":case"s16":for(C=0;C<N.length;C+=2)D[C]=N[C+1],D[C+1]=N[C];break;case"u32":case"s32":case"f32":for(C=0;C<N.length;C+=4)D[C]=N[C+3],D[C+1]=N[C+2],D[C+2]=N[C+1],D[C+3]=N[C]}R=A(R,f),T=new d(R)}y.set(T,k)}const L=[];if(1===c)L.push(y);else for(M=0;M<c;M++){for(E=new d(h),_=0;_<h;_++)E[_]=y[_*c+M];L.push(E)}return{width:s,height:a,pixelType:l,pixels:L}},T=(e,t,n)=>{if(!(e&&e.length>0&&t&&n))return null;let r,i,s;const o=e[0].length,a=e.length,l=new Uint8Array(o);for(let u=0;u<a;u++)if(r=e[u],i=t[u],s=n[u],0===u)for(let e=0;e<o;e++)l[e]=r[e]<i||r[e]>s?0:1;else for(let e=0;e<o;e++)l[e]&&(l[e]=r[e]<i||r[e]>s?0:1);return l},k=e=>{if(!e)return null;const t=e.match(/<Item(.*?)Item>/gi);if(!t||0===t.length)return null;const n=new Map;let r,i,s,o,a;for(let e=0;e<t.length;e++)r=t[e],i=r.slice(6,r.indexOf(">")),o=r.indexOf("sample="),o>-1&&(a=r.slice(o+8,r.indexOf('"',o+8))),o=r.indexOf("name="),o>-1&&(i=r.slice(o+6,r.indexOf('"',o+6))),i&&(s=r.slice(r.indexOf(">")+1,r.indexOf("</Item>")).trim(),null!=a?n.has(i)?n.get(i)[a]=s:n.set(i,[s]):n.set(i,s)),a=null;const l=n.get("STATISTICS_MINIMUM"),u=n.get("STATISTICS_MAXIMUM"),c=n.get("STATISTICS_MEAN"),p=n.get("STATISTICS_STDDEV");let h=null;if(l&&u){h=[];for(let e=0;e<l.length;e++)h.push({min:parseFloat(l[e]),max:parseFloat(u[e]),avg:c&&parseFloat(c[e]),stddev:p&&parseFloat(p[e])})}const f=n.get("BandName"),d=n.get("WavelengthMin"),m=n.get("WavelengthMax");let y=null;if(f){y=[];for(let e=0;e<f.length;e++)y.push({BandName:f[e],WavelengthMin:d&&parseFloat(d[e]),WavelengthMax:m&&parseFloat(m[e])})}return{statistics:h,bandProperties:y,dataType:n.get("DataType"),rawMetadata:n}};function R(e,t,n,r=0,i=!1,s=4){if(n.values)return!0;const o=n.type,a=n.valueCount;let l=n.valueOffset,u=[];const c=p[o],f=8*c,d=a*c,m=a*p[o]*8;let y,g;const w=8===s?64:32,b=n.valueOffsets;if(m>w&&d>(i?e.byteLength:e?e.byteLength-l+r:0))return n.offlineOffsetSize=[l,d],n.values=null,!1;if(m<=w){if(!t)if(w<=32)l>>>=32-m;else{const e=b?.length?b[0]:l>>>0,t=b?.length?b[1]:Math.round((l-e)/h);m<=32?(l=e>>>32-m,b[0]=l):(l=e*2**(32-m)+(t>>>32-m),b[0]=e,b[1]=t>>>32-m)}if(1===a&&f===w)u=[l];else if(64===w){const e=b?.length?b[0]:l>>>0,t=b?.length?b[1]:Math.round((l-e)/h);let n=e,r=32;for(g=1;g<=a;g++){const e=32-f*g%32;if(r<f){const i=n<<e>>>32-r,s=t<<32-r>>>32-r;n=t,u.push(i+s*2**(f-r)),r-=32-(f-r)}else u.push(n<<e>>>32-f),r-=f;0===r&&(r=32,n=t)}}else for(g=1;g<=a;g++){const e=32-f*g;u.push(l<<e>>>32-f)}}else{l-=r,i&&(l=0);for(let n=l;n<l+d;n+=c){switch(o){case 1:case 2:case 7:y=new DataView(e,n,1).getUint8(0);break;case 3:y=new DataView(e,n,2).getUint16(0,t);break;case 4:case 13:y=new DataView(e,n,4).getUint32(0,t);break;case 5:y=new DataView(e,n,4).getUint32(0,t)/new DataView(e,n+4,4).getUint32(0,t);break;case 6:y=new DataView(e,n,1).getInt8(0);break;case 8:y=new DataView(e,n,2).getInt16(0,t);break;case 9:y=new DataView(e,n,4).getInt32(0,t);break;case 10:y=new DataView(e,n,4).getInt32(0,t)/new DataView(e,n+4,4).getInt32(0,t);break;case 11:y=new DataView(e,n,4).getFloat32(0,t);break;case 12:y=new DataView(e,n,8).getFloat64(0,t);break;case 16:case 18:y=L(new DataView(e,n,8),0,t);break;case 17:y=F(new DataView(e,n,8),0,t);break;default:y=null}u.push(y)}}if(2===o){let e="";const t=u;for(u=[],g=0;g<t.length;g++)0===t[g]&&""!==e?(u.push(e),e=""):e+=String.fromCharCode(t[g]);""===e&&0!==u.length||u.push(e)}return n.values=u,!0}function P(e){const t=e[0],n=v(t,"TILEWIDTH"),r=v(t,"TILELENGTH"),i=v(t,"IMAGEWIDTH"),s=v(t,"IMAGELENGTH"),o=v(t,"BITSPERSAMPLE"),a=v(t,"SAMPLESPERPIXEL"),l=v(t,"SAMPLEFORMAT")??1,u=d(l,o),c=N(t),p=g(t,"GDAL_NODATA");let h=null;p?.length&&(h=p.map((e=>parseFloat(e))),h.some((e=>isNaN(e)))&&(h=null));const m=v(t,"COMPRESSION")??1;let x;switch(m){case 1:x="NONE";break;case 2:case 3:case 4:case 32771:x="CCITT";break;case 5:x="LZW";break;case 6:case 7:x="JPEG";break;case 32773:x="PACKBITS";break;case 8:case 32946:x="DEFLATE";break;case 34712:x="JPEG2000";break;case 34887:x="LERC";break;default:x=String(m)}let M=!0,A="";f.has(m)||(M=!1,A+="unsupported tag compression "+m),l>3&&(M=!1,A+="unsupported tag sampleFormat "+l),1!==o&&2!==o&&4!==o&&o%8!=0&&(M=!1,A+="unsupported tag bitsPerSample "+o);const I=b(t,"GEOASCIIPARAMS");let S;if(I){const e=I.split("|").find((e=>e.includes("ESRI PE String = "))),t=e?e.replace("ESRI PE String = ",""):"";S=t.startsWith("COMPD_CS")||t.startsWith("PROJCS")||t.startsWith("GEOGCS")?{wkid:null,wkt:t}:null}const _=w(t,"GEOTIEPOINTS"),C=w(t,"GEOPIXELSCALE"),T=w(t,"GEOTRANSMATRIX"),R=t.has("GEOKEYDIRECTORY")?t.get("GEOKEYDIRECTORY").data:null;let P,L,F=!1,O=!1;if(R){F=2===v(R,"GTRasterTypeGeoKey");const e=v(R,"GTModelTypeGeoKey");if(2===e){const e=v(R,"GeographicTypeGeoKey");e>=1024&&e<=32766&&(S={wkid:e}),S||32767!==e||(O=!0,S={wkid:4326})}else if(1===e){const e=v(R,"ProjectedCSTypeGeoKey");e>=1024&&e<=32766&&(S={wkid:e})}}if(C&&_&&_.length>=6?(P=[C[0],0,_[3]-_[0]*C[0],0,-Math.abs(C[1]),_[4]-_[1]*C[1]],F&&(P[2]-=.5*P[0]+.5*P[1],P[5]-=.5*P[3]+.5*P[4])):T&&16===T.length&&(P=F?[T[0],T[1],T[3]-.5*T[0],T[4],T[5],T[7]-.5*T[5]]:[T[0],T[1],T[3],T[4],T[5],T[7]]),P){const e=[{x:0,y:s},{x:0,y:0},{x:i,y:s},{x:i,y:0}];let t,n=Number.POSITIVE_INFINITY,r=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,a=Number.NEGATIVE_INFINITY;for(let i=0;i<e.length;i++)t=y(e[i],P),n=t.x>n?n:t.x,o=t.x<o?o:t.x,r=t.y>r?r:t.y,a=t.y<a?a:t.y;L={xmin:n,xmax:o,ymin:r,ymax:a,spatialReference:S}}else L={xmin:-.5,ymin:.5-s,xmax:i-.5,ymax:.5,spatialReference:S};O&&(L.xmax-L.xmin>400||Math.max(Math.abs(L.xmin),Math.abs(L.xmax))>361)&&(S=null,L.spatialReference=null);const z=D(e);let j,Z,U,V,G;if(z.length>0){U=Math.round(Math.log(i/v(z[0],"IMAGEWIDTH"))/Math.LN2);const e=z[z.length-1];V=z.length,j=v(e,"TILEWIDTH"),Z=v(e,"TILELENGTH")}j=null!=V&&V>0?j||n:null,Z=null!=V&&V>0?Z||r:null,n&&(G=[{maxCol:Math.ceil(i/n)-1,maxRow:Math.ceil(s/r)-1,minRow:0,minCol:0}],z.forEach((e=>{G.push({maxCol:Math.ceil(v(e,"IMAGEWIDTH")/v(e,"TILEWIDTH"))-1,maxRow:Math.ceil(v(e,"IMAGELENGTH")/v(e,"TILELENGTH"))-1,minRow:0,minCol:0})})));const H=b(e[0],"GDAL_METADATA"),W=k(H);A+=" "+B({width:i,height:s,tileWidth:n,tileHeight:r,planes:a,ifds:e});const J=E(e).length===z.length+1,q=z?.length?z.map((e=>({x:i/v(e,"IMAGEWIDTH"),y:s/v(e,"IMAGELENGTH")}))):void 0;return{width:i,height:s,tileWidth:n,tileHeight:r,planes:a,isBSQ:c,pixelType:u,compression:x,noData:h,hasMaskBand:J,isSupported:M,pyramidResolutions:q,message:A,extent:L,isPseudoGeographic:O,affine:C?null:P,firstPyramidLevel:U,maximumPyramidLevel:V,pyramidBlockWidth:j,pyramidBlockHeight:Z,tileBoundary:G,metadata:W}}function N(e,t){const n=g(e,"PLANARCONFIGURATION");return n?2===n[0]:!!t&&t.isBSQ}function D(e){return e.filter((e=>1===v(e,"NEWSUBFILETYPE")))}function E(e){return e.filter((e=>{const t=!(4&~(v(e,"NEWSUBFILETYPE")??0)),n=4===v(e,"PHOTOMETRICINTERPRETATION");return t&&n}))}function L(e,t,n){const r=e.getUint32(t,n),i=e.getUint32(t+4,n);return n?i*h+r:r*h+i}function F(e,t,n){let r=n?e.getInt32(t,n):e.getUint32(t,n),i=n?e.getUint32(t+4,n):e.getInt32(t+4,n);const s=(n?r:i)>=0?1:-1;return n?r*=s:i*=s,s*(n?i*h+r:r*h+i)}function O(e,t,n,r){return r?L(e,t,n):e.getUint32(t,n)}function z(e){const t=new DataView(e,0,16),n=t.getUint16(0,!1);let r=null;if(18761===n)r=!0;else{if(19789!==n)throw new Error("unexpected endianess byte");r=!1}const i=t.getUint16(2,r);if(42!==i&&43!==i)throw new Error("unexpected tiff identifier");let s=4;const o=43===i;if(o){const e=t.getUint16(s,r);if(s+=2,8!==e)throw new Error("unsupported bigtiff version");if(0!==t.getUint16(s,r))throw new Error("unsupported bigtiff version");s+=2}return{littleEndian:r,isBigTiff:o,firstIFDPos:O(t,s,r,o)}}function j(e,t,n,i=0,s=l.A.tiffTags,o=4){const a=x(e,t,n,i,s,o);let u;const c=a.ifd;if(c){if(l.A.ifdTags.forEach(((n,r)=>{c.has(r)&&(u=c.get(r),u.data=x(e,t,u.valueOffset-i,i,n).ifd)})),c.has("GEOKEYDIRECTORY")){u=c.get("GEOKEYDIRECTORY");const n=u.values;if(n&&n.length>4){const r=n[0]+"."+n[1]+"."+n[2];u.data=x(e,t,u.valueOffset+6-i,i,l.A.geoKeys,2).ifd,u.data&&u.data.set("GEOTIFFVersion",{id:0,type:2,valueCount:1,valueOffset:null,values:[r]})}}if(c.has("XMP")){u=c.get("XMP");const e=u.values;"number"==typeof e[0]&&7===u.type&&(u.values=[(0,r.w)(new Uint8Array(e))])}}return a}function B(e){const{width:t,height:n,tileHeight:r,tileWidth:i}=e,s=e.planes,o=i?i*r:t*n,a=v(e.ifds[0],"BITSPERSAMPLE");let l="";return o*s>2**30/(a>8?a/8:1)&&(l=i?"tiled tiff exceeding 1 gigabits per tile is not supported":"scanline tiff exceeding 1 gigabits is not supported"),l}async function Z(e,t){const{headerInfo:n,ifd:r,offsets:i,sizes:s}=t,o=[];for(let t=0;t<i.length;t++){s[t];const a=await _(e,n.littleEndian,r,i[t],s[t]||e.byteLength);o.push(a)}const l=N(r,n),u=v(r,"BITSPERSAMPLE"),c=d(v(r,"SAMPLEFORMAT")??1,u),p=v(r,"SAMPLESPERPIXEL")||n.planes,h=m(c),f=v(r,"TILEWIDTH"),y=v(r,"TILELENGTH"),g=v(r,"COMPRESSION")??1,w=f*y;let b;const x=[];let M=o[0];const A=34887===g;for(let e=0;e<p;e++){if(b=new h(w),o.length===p)M=o[e],M.length===w&&(b=M);else if(M.length)if(l||A)b=M.length===w?M:M.slice(w*e,w*(e+1));else for(let t=0;t<w;t++)b[t]=M[t*p+e];x.push(b)}const I=n.noData?n.noData[0]:t.noDataValue,S=n.metadata?n.metadata.statistics:null,C=S?S.map((e=>e.min)):null,k=S?S.map((e=>e.max)):null,R={pixelType:c,width:f,height:y,pixels:x,noDataValue:I};return null!=I?(0,a.Sp)(R,I):C&&k&&t.applyMinMaxConstraint&&(R.mask=T(x,C,k)),R}async function U(e,t={}){const n=t.pyramidLevel||0,r=t.headerInfo||function(e){const{littleEndian:t,isBigTiff:n,firstIFDPos:r}=z(e);let i=r;const s=[];do{const r=j(e,t,i,0,l.A.tiffTags,n?8:4);if(!r.success)break;s.push(r.ifd),i=r.nextIFD}while(i>0);return{...P(s),littleEndian:t,isBigTiff:n,ifds:s,pyramidIFDs:D(s),maskIFDs:E(s)}}(e),{ifds:i,noData:s}=r;if(0===i.length)throw new Error("no valid image file directory");const o=B(r);if(o)throw o;let u=null;const c=-1===n?i[i.length-1]:i[n],p=s??t.noDataValue;return u=r.tileWidth?await async function(e,t,n){const r=w(n,"TILEOFFSETS");if(void 0===r)return null;const i=w(n,"TILEBYTECOUNTS"),{width:s,height:o,pixelType:a,tileWidth:l,tileHeight:u}=P([n]),c=N(n,t),p=v(n,"SAMPLESPERPIXEL")||t.planes,h=s*o,f=v(n,"BITSPERSAMPLE"),d=34887===(v(n,"COMPRESSION")??1),y=m(a),g=[];for(let e=0;e<p;e++)g.push(new y(h));let b,x,M,A,I,S,C,T,k,R,D,E,L;const F=Math.ceil(s/l),O=new Uint8Array(h).fill(255);let z=!1;if(f%8==0)if(d&&c&&p>1){const a=Math.round(r.length/p);for(b=0;b<a;b++){S=Math.floor(b/F)*u,C=b%F*l,T=S*s+C;for(let a=0;a<p;a++){const c=b*p+a;for(0===i[c]?(M=null,z=!0):M=await _(e,t.littleEndian,n,r[c],i[c]),R=0,k=T,E=Math.min(l,s-C),D=Math.min(u,o-S),L=g[a],A=0;A<D;A++)for(k=T+A*s,R=A*l,I=0;I<E;I++,k++,R++)M?L[k]=M[R]:O[k]=0}}}else for(b=0;b<r.length;b++)for(S=Math.floor(b/F)*u,C=b%F*l,T=S*s+C,0===i[b]?(M=null,z=!0):M=await _(e,t.littleEndian,n,r[b],i[b]),R=0,k=T,E=Math.min(l,s-C),D=Math.min(u,o-S),x=0;x<p;x++)if(L=g[x],c||d)for(A=0;A<D;A++)for(k=T+A*s,R=l*u*x+A*l,I=0;I<E;I++,k++,R++)M?L[k]=M[R]:O[k]=0;else for(A=0;A<D;A++)for(k=T+A*s,R=A*l*p+x,I=0;I<E;I++,k++,R+=p)M?L[k]=M[R]:O[k]=0;return{width:s,height:o,pixelType:a,pixels:g,mask:z?O:void 0}}(e,r,c):C(e,r,c),u?(null!=p&&(0,a.Sp)(u,p),u):u}},57328:function(e,t,n){n.d(t,{A:function(){return a}});const r=(()=>{const e=[];return e[254]="NEWSUBFILETYPE",e[255]="SUBFILETYPE",e[256]="IMAGEWIDTH",e[257]="IMAGELENGTH",e[258]="BITSPERSAMPLE",e[259]="COMPRESSION",e[262]="PHOTOMETRICINTERPRETATION",e[263]="THRESHHOLDING",e[264]="CELLWIDTH",e[265]="CELLLENGTH",e[266]="FILLORDER",e[269]="DOCUMENTNAME",e[270]="IMAGEDESCRIPTION",e[271]="MAKE",e[272]="MODEL",e[273]="STRIPOFFSETS",e[274]="ORIENTATION",e[277]="SAMPLESPERPIXEL",e[278]="ROWSPERSTRIP",e[279]="STRIPBYTECOUNTS",e[280]="MINSAMPLEVALUE",e[281]="MAXSAMPLEVALUE",e[282]="XRESOLUTION",e[283]="YRESOLUTION",e[284]="PLANARCONFIGURATION",e[285]="PAGENAME",e[286]="XPOSITION",e[287]="YPOSITION",e[288]="FREEOFFSETS",e[289]="FREEBYTECOUNTS",e[290]="GRAYRESPONSEUNIT",e[291]="GRAYRESPONSECURVE",e[292]="T4OPTIONS",e[293]="T6OPTIONS",e[296]="RESOLUTIONUNIT",e[297]="PAGENUMBER",e[300]="COLORRESPONSEUNIT",e[301]="TRANSFERFUNCTION",e[305]="SOFTWARE",e[306]="DATETIME",e[315]="ARTIST",e[316]="HOSTCOMPUTER",e[317]="PREDICTOR",e[318]="WHITEPOINT",e[319]="PRIMARYCHROMATICITIES",e[320]="COLORMAP",e[321]="HALFTONEHINTS",e[322]="TILEWIDTH",e[323]="TILELENGTH",e[324]="TILEOFFSETS",e[325]="TILEBYTECOUNTS",e[326]="BADFAXLINES",e[327]="CLEANFAXDATA",e[328]="CONSECUTIVEBADFAXLINES",e[330]="SUBIFD",e[332]="INKSET",e[333]="INKNAMES",e[334]="NUMBEROFINKS",e[336]="DOTRANGE",e[337]="TARGETPRINTER",e[338]="EXTRASAMPLES",e[339]="SAMPLEFORMAT",e[340]="SMINSAMPLEVALUE",e[341]="SMAXSAMPLEVALUE",e[342]="TRANSFERRANGE",e[347]="JPEGTABLES",e[512]="JPEGPROC",e[513]="JPEGIFOFFSET",e[514]="JPEGIFBYTECOUNT",e[515]="JPEGRESTARTINTERVAL",e[517]="JPEGLOSSLESSPREDICTORS",e[518]="JPEGPOINTTRANSFORM",e[519]="JPEGQTABLES",e[520]="JPEGDCTABLES",e[521]="JPEGACTABLES",e[529]="YCBCRCOEFFICIENTS",e[530]="YCBCRSUBSAMPLING",e[531]="YCBCRPOSITIONING",e[532]="REFERENCEBLACKWHITE",e[700]="XMP",e[33550]="GEOPIXELSCALE",e[33922]="GEOTIEPOINTS",e[33432]="COPYRIGHT",e[42112]="GDAL_METADATA",e[42113]="GDAL_NODATA",e[50844]="RPCCOEFFICIENT",e[34264]="GEOTRANSMATRIX",e[34735]="GEOKEYDIRECTORY",e[34736]="GEODOUBLEPARAMS",e[34737]="GEOASCIIPARAMS",e[34665]="EXIFIFD",e[34853]="GPSIFD",e[40965]="INTEROPERABILITYIFD",e})(),i=(()=>{const e=r.slice();return e[36864]="ExifVersion",e[40960]="FlashpixVersion",e[40961]="ColorSpace",e[42240]="Gamma",e[37121]="ComponentsConfiguration",e[37122]="CompressedBitsPerPixel",e[40962]="PixelXDimension",e[40963]="PixelYDimension",e[37500]="MakerNote",e[37510]="UserComment",e[40964]="RelatedSoundFile",e[36867]="DateTimeOriginal",e[36868]="DateTimeDigitized",e[36880]="OffsetTime",e[36881]="OffsetTimeOriginal",e[36882]="OffsetTimeDigitized",e[37520]="SubSecTime",e[37521]="SubSecTimeOriginal",e[37522]="SubSecTimeDigitized",e[37888]="Temperature",e[37889]="Humidity",e[37890]="Pressure",e[37891]="WaterDepth",e[37892]="Acceleration",e[37893]="CameraElevationAngle",e[42016]="ImageUniqueID",e[42032]="CameraOwnerName",e[42033]="BodySerialNumber",e[42034]="LensSpecification",e[42035]="LensMake",e[42036]="LensModel",e[42037]="LensSerialNumber",e[33434]="ExposureTime",e[33437]="FNumber",e[34850]="ExposureProgram",e[34852]="SpectralSensitivity",e[34855]="PhotographicSensitivity",e[34856]="OECF",e[34864]="SensitivityType",e[34865]="StandardOutputSensitivity",e[34866]="RecommendedExposureIndex",e[34867]="ISOSpeed",e[34868]="ISOSpeedLatitudeyyy",e[34869]="ISOSpeedLatitudezzz",e[37377]="ShutterSpeedValue",e[37378]="ApertureValue",e[37379]="BrightnessValue",e[37380]="ExposureBiasValue",e[37381]="MaxApertureValue",e[37382]="SubjectDistance",e[37383]="MeteringMode",e[37384]="LightSource",e[37385]="Flash",e[37386]="FocalLength",e[37396]="SubjectArea",e[41483]="FlashEnergy",e[41484]="SpatialFrequencyResponse",e[41486]="FocalPlaneXResolution",e[41487]="FocalPlaneYResolution",e[41488]="FocalPlaneResolutionUnit",e[41492]="SubjectLocation",e[41493]="ExposureIndex",e[41495]="SensingMethod",e[41728]="FileSource",e[41729]="SceneType",e[41730]="CFAPattern",e[41985]="CustomRendered",e[41986]="ExposureMode",e[41987]="WhiteBalance",e[41988]="DigitalZoomRatio",e[41989]="FocalLengthIn35mmFilm",e[41990]="SceneCaptureType",e[41991]="GainControl",e[41992]="Contrast",e[41993]="Saturation",e[41994]="Sharpness",e[41995]="DeviceSettingDescription",e[41996]="SubjectDistanceRange",e})(),s=(()=>{const e=[];return e[1024]="GTModelTypeGeoKey",e[1025]="GTRasterTypeGeoKey",e[1026]="GTCitationGeoKey",e[2048]="GeographicTypeGeoKey",e[2049]="GeogCitationGeoKey",e[2050]="GeogGeodeticDatumGeoKey",e[2051]="GeogPrimeMeridianGeoKey",e[2052]="GeogLinearUnitsGeoKey",e[2053]="GeogLinearUnitSizeGeoKey",e[2054]="GeogAngularUnitsGeoKey",e[2055]="GeogAngularUnitSizeGeoKey",e[2056]="GeogEllipsoidGeoKey",e[2057]="GeogSemiMajorAxisGeoKey",e[2058]="GeogSemiMinorAxisGeoKey",e[2059]="GeogInvFlatteningGeoKey",e[2061]="GeogPrimeMeridianLongGeoKey",e[2060]="GeogAzimuthUnitsGeoKey",e[3072]="ProjectedCSTypeGeoKey",e[3073]="PCSCitationGeoKey",e[3074]="ProjectionGeoKey",e[3075]="ProjCoordTransGeoKey",e[3076]="ProjLinearUnitsGeoKey",e[3077]="ProjLinearUnitSizeGeoKey",e[3078]="ProjStdParallel1GeoKey",e[3079]="ProjStdParallel2GeoKey",e[3080]="ProjNatOriginLongGeoKey",e[3081]="ProjNatOriginLatGeoKey",e[3082]="ProjFalseEastingGeoKey",e[3083]="ProjFalseNorthingGeoKey",e[3084]="ProjFalseOriginLongGeoKey",e[3085]="ProjFalseOriginLatGeoKey",e[3086]="ProjFalseOriginEastingGeoKey",e[3087]="ProjFalseOriginNorthingGeoKey",e[3088]="ProjCenterLongGeoKey",e[3090]="ProjCenterEastingGeoKey",e[3091]="ProjCenterNorthingGeoKey",e[3092]="ProjScaleAtNatOriginGeoKey",e[3093]="ProjScaleAtCenterGeoKey",e[3094]="ProjAzimuthAngleGeoKey",e[3095]="ProjStraightVertPoleLongGeoKey",e[4096]="VerticalCSTypeGeoKey",e[4097]="VerticalCitationGeoKey",e[4098]="VerticalDatumGeoKey",e[4099]="VerticalUnitsGeoKey",e})(),o=new Map;o.set("EXIFIFD",i),o.set("GPSIFD",["GPSVersionID","GPSLatitudeRef","GPSLatitude","GPSLongitudeRef","GPSLongitude","GPSAltitudeRef","GPSAltitude","GPSTimeStamp","GPSSatellites","GPSStatus","GPSMeasureMode","GPSDOP","GPSSpeedRef","GPSSpeed","GPSTrackRef","GPSTrack","GPSImgDirectionRef","GPSImgDirection","GPSMapDatum","GPSDestLatitudeRef","GPSDestLatitude","GPSDestLongitudeRef","GPSDestLongitude","GPSDestBearingRef","GPSDestBearing","GPSDestDistanceRef","GPSDestDistance","GPSProcessingMethod","GPSAreaInformation","GPSDateStamp","GPSDifferential","GPSHPositioningError"]);const a={tiffTags:r,ifdTags:o,geoKeys:s,getTagName:(e,t)=>{let n=(t||r)[e];return void 0===n&&(n="unknown"+String(e)),n}}},95738:function(e,t,n){n.d(t,{$p:function(){return c},Sp:function(){return p},X1:function(){return a},hP:function(){return o},yM:function(){return u},zw:function(){return l}});const r=9999999e31,i=2e-7,s={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-34028234663852886e22,34028234663852886e22],f64:[-Number.MAX_VALUE,Number.MAX_VALUE],unknown:void 0,c64:void 0,c128:void 0};function o(e){return s[e]??[-34028234663852886e22,34028234663852886e22]}function a(e,t){return null==e||null==t?"s32":e<0?e>=-128&&t<128?"s8":e>=-32768&&t<32768?"s16":"s32":t<256?"u8":t<65536?"u16":"u32"}function l(e){return(e?.startsWith("s")||e?.startsWith("u"))??!1}function u(e,t,n,r){let[i,s]=o(n);const a=l(n);return a&&(i-=1e-5,s+=1e-5),a?n.startsWith("u")?function(e,t,n,r){const[i,s]=r;for(let r=0;r<t.length;r++)if(t[r]){const o=e[r];o<i||o>s?t[r]=0:n[r]=o+.5|0}}(e,t,r,[i,s]):function(e,t,n,r){const[i,s]=r;for(let r=0;r<t.length;r++)if(t[r]){const o=e[r];o<i||o>s?t[r]=0:n[r]=o+(o>0?.5:-.5)|0}}(e,t,r,[i,s]):function(e,t,n,r){const[i,s]=r;for(let r=0;r<t.length;r++)if(t[r]){const o=e[r];o<i||o>s?t[r]=0:n[r]=o}}(e,t,r,[i,s])}function c(e,t){for(let n=0;n<t.length;n++)t[n]&&isNaN(e[n])&&(t[n]=0,e[n]=0)}function p(e,t,n){if(e.depthCount&&e.depthCount>1)return;const{pixels:s,statistics:a,pixelType:l}=e,u=s[0].length,c=e.bandMasks??[],p=e.mask??new Uint8Array(u).fill(255),h="f32"===l||"f64"===l,f=o(l);let d=!1;for(let e=0;e<s.length;e++){const o="number"==typeof t?t:t[e];if(null==o)continue;const u=a?.[e]?.minValue??f[0],m=a?.[e]?.maxValue??f[1];if(u>o+Number.EPSILON||m<o-Number.EPSILON)continue;const y=c[e]||p.slice(),g=s[e],w=n?.customFloatTolerance;if(h&&0!==w){let e=w;e||(e=Math.abs(o)>=r?i*Math.abs(o):"f32"===l?2**-23:Number.EPSILON);for(let t=0;t<g.length;t++)y[t]&&Math.abs(g[t]-o)<e&&(g[t]=0,y[t]=0,p[t]=0,d=!0)}else for(let e=0;e<g.length;e++)y[e]&&g[e]===o&&(g[e]=0,y[e]=0,p[e]=0,d=!0);c[e]=y}d&&(e.bandMasks=e.bandMasks||e.pixels.length>1?c:null,e.mask=p),d&&"updateStatistics"in e&&e.updateStatistics()}},70041:function(e,t,n){n.d(t,{Z:function(){return r}});const r=(()=>{const e=new ArrayBuffer(4),t=new Uint8Array(e);return new Uint32Array(e)[0]=1,1===t[0]})()},67090:function(e,t,n){n.d(t,{$Q:function(){return a},Sd:function(){return l},b7:function(){return u}});var r=n(62938),i=n(91484),s=n(45532),o=n(21327);async function a(e,t,r){if("extent"===r.type)return function(e,t,n){const{width:r,height:i}=e,s=new Uint8Array(r*i),a=t.width/r,l=t.height/i;if(n.width/a<.5||n.height/l<.5)return new o.A({pixelType:e.pixelType,width:r,height:i,mask:s,pixels:[...e.pixels]});const{xmin:u,xmax:c,ymin:p,ymax:h}=t,{xmin:f,xmax:d,ymin:m,ymax:y}=n,g=Math.max(u,f),w=Math.min(c,d),b=Math.max(p,m),v=Math.min(h,y),x=.5*a,M=.5*l;if(w-g<x||v-b<M||w<u+x||g>c-x||b>h-M||v<p+M)return new o.A({pixelType:e.pixelType,width:r,height:i,mask:s,pixels:[...e.pixels]});const A=Math.max(0,(g-u)/a),I=Math.min(r,Math.max(0,(w-u)/a)),S=Math.max(0,(h-v)/l),_=Math.min(i,Math.max(0,(h-b)/l)),C=Math.round(A),T=Math.round(I)-1,k=Math.round(S),R=Math.round(_)-1;if(C===T&&A%1>.5&&I%1<.5||k===R&&S%1>.5&&_%1<.5)return new o.A({pixelType:e.pixelType,width:r,height:i,mask:s,pixels:[...e.pixels]});if(0===C&&0===k&&T===r&&R===i)return e;const P=e.mask;for(let e=k;e<=R;e++)for(let t=C;t<=T;t++){const n=e*r+t;s[n]=P?P[n]:255}return new o.A({pixelType:e.pixelType,width:r,height:i,mask:s,pixels:[...e.pixels]})}(e,t,r);const{width:i,height:s}=e,a=new Uint8Array(i*s),{contains:l,intersects:u}=await n.e(5418).then(n.bind(n,22162));return u(t,r)?"polyline"===r.type?function(e,t,n){const{width:r,height:i}=e,s=new Uint8Array(r*i),a=t.width/r,l=t.height/i,{xmin:u,ymax:c}=t,{paths:p}=n,h=e.mask;for(let e=0;e<p.length;e++){const t=p[e];for(let e=0;e<t.length-1;e++){const[n,o]=t[e],[p,f]=t[e+1];let d=Math.floor((c-o)/l),m=Math.floor((c-f)/l);if(m<d){const e=d;d=m,m=e}d=Math.max(0,d),m=Math.min(i-1,m);const y=(p-n)/(f-o);for(let e=d;e<=m;e++){const t=e===d?Math.max(o,f):(i+1-e)*l,c=e===m?Math.min(o,f):t-l;let g=f===o?Math.floor((n-u)/a):Math.floor((y*(t-o)+n-u)/a),w=f===o?Math.floor((p-u)/a):Math.floor((y*(c-o)+n-u)/a);if(w<g){const e=g;g=w,w=e}const b=e*r;g=Math.max(0,g),w=Math.min(r-1,w);for(let e=b+g;e<=b+w;e++)s[e]=h?h[e]:255}}}return new o.A({pixelType:e.pixelType,width:r,height:i,mask:s,pixels:[...e.pixels]})}(e,t,r):l(r,t)?e:function(e,t,n){if(!e)return e;const{width:r,height:i}=e,s=t.width/r,a=t.height/i,{xmin:l,ymax:u}=t;let c;if("extent"===n.type){const e=(n.xmin-l)/s,t=(n.xmax-l)/s,r=(u-n.ymax)/a,i=(u-n.ymin)/a;c=[[[e,r],[e,i],[t,i],[t,r],[e,r]]]}else c=n.rings.map((e=>e.map((([e,t])=>[(e-l)/s,(u-t)/a]))));const p=document.createElement("canvas");p.width=r,p.height=i;const h=p.getContext("2d");h.fillStyle="#f00",h.beginPath(),c.forEach((e=>{h.moveTo(e[0][0],e[0][1]);for(let t=0;t<e.length;t++)h.lineTo(e[t][0],e[t][1]);h.closePath()})),h.fill();const f=h.getImageData(0,0,r,i).data,d=e.mask,m=r*i,y=new Uint8Array(m);for(let e=0;e<m;e++)d&&!d[e]||(y[e]=f[4*e+3]>127?255:0);return new o.A({pixelType:e.pixelType,width:r,height:i,mask:y,maskIsAlpha:!1,pixels:[...e.pixels]})}(e,t,r):new o.A({pixelType:e.pixelType,width:i,height:s,mask:a,maskIsAlpha:!1,pixels:[...e.pixels]})}function l(e,t){const{extent:n}=u(e,t,new s.default({x:e.pixelSize.x,y:e.pixelSize.y,spatialReference:e.spatialReference})),{extent:r}=e.extent;if(n.xmax=Math.min(n.xmax,r.xmax),n.ymax=Math.min(n.ymax,r.ymax),n.xmin<n.xmax&&n.ymin<n.ymax){const{x:t,y:r}=e.pixelSize,i=Math.round(n.width/t),s=Math.round(n.height/r);e.extent=n,e.width=i,e.height=s}}function u(e,t,n,s=!0){const{spatialReference:o}=e,{x:a,y:l}=function(e,t){if(e.spatialReference.equals(t))return e;const n=(0,r.GA)(e.spatialReference),i=(0,r.GA)(t);if(n===i)return e;const s=n/i;return{x:e.x*s,y:e.y*s}}(n,o);let u,c,p;const h="extent"===t.type?t:t.extent;let{xmin:f,xmax:d,ymax:m,ymin:y}=h;const{xmin:g,ymax:w}=e.extent;return s?(f=g+(f>g?a*Math.round((f-g)/a):0),m=w-(m<w?l*Math.round((w-m)/l):0),d=g+(d>g?a*Math.round((d-g)/a):0),y=w-(y<w?l*Math.round((w-y)/l):0),u=new i.default({xmin:f,ymax:m,xmax:d,ymin:y,spatialReference:o}),c=Math.round(u.width/a),p=Math.round(u.height/l)):(c=Math.floor((d-f)/a+.8),p=Math.floor((m-y)/l+.8),f=g+(f>g?a*Math.floor((f-g)/a+.1):0),m=w-(m<w?l*Math.floor((w-m)/l+.1):0),d=f+c*a,y=m-p*l,u=new i.default({xmin:f,ymax:m,xmax:d,ymin:y,spatialReference:o})),{extent:u,width:c,height:p}}},43264:function(e,t,n){n.d(t,{$i:function(){return O},AB:function(){return u},Ew:function(){return y},Hx:function(){return m},IB:function(){return r},J$:function(){return E},LY:function(){return A},QF:function(){return F},UK:function(){return d},Wb:function(){return i},Wt:function(){return M},Wy:function(){return c},XU:function(){return x},dK:function(){return v},eH:function(){return f},et:function(){return l},lD:function(){return D},qL:function(){return h},z$:function(){return _},z7:function(){return S},zg:function(){return p}});var r,i,s,o=n(21327),a=n(95738);(s=r||(r={}))[s.matchAny=0]="matchAny",s[s.matchAll=1]="matchAll",function(e){e[e.bestMatch=0]="bestMatch",e[e.fail=1]="fail"}(i||(i={}));const l=6;function u(e){return null!=e&&"esri.layers.support.PixelBlock"===e.declaredClass&&e.pixels&&e.pixels.length>0}function c(e){if(!e?.length||e.some((e=>!u(e))))return null;if(1===e.length)return e[0]?.clone()??null;const t=e,{width:n,height:r,pixelType:i}=t[0];if(t.some((e=>e.width!==n||e.height!==r)))return null;const s=t.map((({mask:e})=>e)).filter((e=>null!=e));let a=null;s.length&&(a=new Uint8Array(n*r),a.set(s[0]),s.length>1&&b(s.slice(1),a));const l=[];t.forEach((({pixels:e})=>l.push(...e)));const c=t.map((({statistics:e})=>e)).filter((e=>e?.length)),p=[];return c.forEach((e=>p.push(...e))),new o.A({pixelType:i,width:n,height:r,mask:a,pixels:l,statistics:p.length?p:null})}function p(e){if(!e)return;const t=e.colormap;if(!t||0===t.length)return;const n=t.sort(((e,t)=>e[0]-t[0]));let r=0;n[0][0]<0&&(r=n[0][0]);const i=Math.max(256,n[n.length-1][0]-r+1),s=new Uint8Array(4*i),o=[];let a,l=0,u=0;const c=5===n[0].length;if(i>65536)return n.forEach((e=>{o[e[0]-r]=c?e.slice(1):e.slice(1).concat([255])})),{indexed2DColormap:o,offset:r,alphaSpecified:c};if(e.fillUnspecified)for(a=n[u],l=a[0]-r;l<i;l++)s[4*l]=a[1],s[4*l+1]=a[2],s[4*l+2]=a[3],s[4*l+3]=c?a[4]:255,l===a[0]-r&&(a=u===n.length-1?a:n[++u]);else for(l=0;l<n.length;l++)a=n[l],u=4*(a[0]-r),s[u]=a[1],s[u+1]=a[2],s[u+2]=a[3],s[u+3]=c?a[4]:255;return{indexedColormap:s,offset:r,alphaSpecified:c}}function h(e,t){if(!u(e))return e;if(!t||!t.indexedColormap&&!t.indexed2DColormap)return e;const n=e.clone(),r=n.pixels;let i=n.mask;const s=n.width*n.height;if(1!==r.length)return e;const{indexedColormap:o,indexed2DColormap:a,offset:l,alphaSpecified:c}=t;let p=0;const h=r[0],f=new Uint8Array(h.length),d=new Uint8Array(h.length),m=new Uint8Array(h.length);let y,g=0;if(o){const e=o.length-1;if(null!=i)for(p=0;p<s;p++)i[p]&&(g=4*(h[p]-l),g<l||g>e?i[p]=0:(f[p]=o[g],d[p]=o[g+1],m[p]=o[g+2],i[p]=o[g+3]));else{for(i=new Uint8Array(s),p=0;p<s;p++)g=4*(h[p]-l),g<l||g>e?i[p]=0:(f[p]=o[g],d[p]=o[g+1],m[p]=o[g+2],i[p]=o[g+3]);n.mask=i}}else if(a)if(null!=i)for(p=0;p<s;p++)i[p]&&(y=a[h[p]],f[p]=y[0],d[p]=y[1],m[p]=y[2],i[p]=y[3]);else{for(i=new Uint8Array(s),p=0;p<s;p++)y=a[h[p]],f[p]=y[0],d[p]=y[1],m[p]=y[2],i[p]=y[3];n.mask=i}return n.pixels=[f,d,m],n.statistics=null,n.pixelType="u8",n.maskIsAlpha=c,n}function f(e,t){if(!u(e))return null;const{pixels:n,mask:r}=e,i=n.length;let s=t.lut;const{offset:a}=t;s&&1===s[0].length&&(s=n.map((()=>s)));const l=[],c=t.outputPixelType||"u8";for(let e=0;e<i;e++){const t=d(n[e],r,s[e],a||0,c);l.push(t)}const p=new o.A({width:e.width,height:e.height,pixels:l,mask:r,pixelType:c});return p.updateStatistics(),p}function d(e,t,n,r,i){const s=e.length,a=o.A.createEmptyBand(i,s);if(t)for(let i=0;i<s;i++)t[i]&&(a[i]=n[e[i]-r]);else for(let t=0;t<s;t++)a[t]=n[e[t]-r];return a}function m(e,t){if(!u(e))return null;const n=e.clone(),{pixels:r}=n,i=n.width*n.height,s=t.length,o=Math.floor(s/2),a=t[Math.floor(o)],l=r[0];let c,p,h,f,d,m,y=!1;const g=new Uint8Array(i),w=new Uint8Array(i),b=new Uint8Array(i);let v=n.mask;const x=4===t[0].mappedColor.length;for(v||(v=new Uint8Array(i),v.fill(x?255:1),n.mask=v),d=0;d<i;d++)if(v[d]){for(c=l[d],y=!1,m=o,p=a,h=0,f=s-1;f-h>1;){if(c===p.value){y=!0;break}c>p.value?h=m:f=m,m=Math.floor((h+f)/2),p=t[Math.floor(m)]}y||(c===t[h].value?(p=t[h],y=!0):c===t[f].value?(p=t[f],y=!0):c<t[h].value?(y=!1,p=null):c>t[h].value&&(c<t[f].value?(p=t[h],y=!0):f===s-1?(y=!1,p=null):(p=t[f],y=!0))),y?(g[d]=p.mappedColor[0],w[d]=p.mappedColor[1],b[d]=p.mappedColor[2],v[d]=p.mappedColor[3]):g[d]=w[d]=b[d]=v[d]=0}return n.pixels=[g,w,b],n.mask=v,n.pixelType="u8",n.maskIsAlpha=x,n}function y(e,t){if(!u(e))return null;const{width:n,height:r}=e,{inputRanges:i,outputValues:s,outputPixelType:l,noDataRanges:c,allowUnmatched:p,isLastInputRangeInclusive:h}=t,f=e.pixels[0],d=o.A.createEmptyBand(l,f.length),m=e.mask,y=new Uint8Array(n*r);m?y.set(m):y.fill(255);const g=e.pixelType.startsWith("f")?1e-6:0,w=i.map((e=>e-g));w[0]=i[0],w[w.length-1]=i[i.length-1]+(h?1e-6:0);const b=i.length/2,[v,x]=(0,a.hP)(l);for(let e=0;e<r;e++)for(let t=0;t<n;t++){const r=e*n+t;if(y[r]){const e=f[r];let t=!1;for(let n=b-1;n>=0;n--)if(e===w[2*n]||e>w[2*n]&&e<w[2*n+1]){d[r]=s[n],t=!0;break}t||(p?d[r]=e>x?x:e<v?v:e:y[r]=0)}}const M=c?.length;if(M)for(let e=0;e<r;e++)for(let t=0;t<n;t++){const r=e*n+t;if(!m||m[r]){const e=f[r];for(let t=0;t<M;t+=2)if(e>=c[t]&&e<=c[t+1]){d[r]=0,y[r]=0;break}}}return new o.A({width:n,height:r,pixelType:l,pixels:[d],mask:y})}function g(e,t,n,r){const i=null!=n&&n.length>=2?new Set(n):null,s=1===n?.length?n[0]:null,o=!!t?.length;for(let n=0;n<e.length;n++)if(r[n]){const a=e[n];if(o){let e=!1;for(let n=0;n<t.length;n+=2)if(a>=t[n]&&a<=t[n+1]){e=!0;break}e||(r[n]=0)}r[n]&&(a===s||i?.has(a))&&(r[n]=0)}}function w(e,t){const n=e[0].length;for(let r=0;r<n;r++)if(t[r]){let n=!1;for(let t=0;t<e.length;t++)if(e[t][r]){n=!0;break}n||(t[r]=0)}}function b(e,t){const n=e[0].length;for(let r=0;r<n;r++)if(t[r]){let n=!1;for(let t=0;t<e.length;t++)if(0===e[t][r]){n=!0;break}n&&(t[r]=0)}}function v(e,t){if(!u(e))return null;const{width:n,height:r,pixels:i}=e,s=n*r,a=new Uint8Array(s);e.mask?a.set(e.mask):a.fill(255);const l=i.length,{includedRanges:c,noDataValues:p,outputPixelType:h,matchAll:f,lookups:m}=t;if(m){const e=[];for(let t=0;t<l;t++){const n=m[t],r=d(i[t],a,n.lut,n.offset||0,"u8");e.push(r)}1===e.length?a.set(e[0]):f?w(e,a):b(e,a)}else if(f){const e=[];for(let t=0;t<l;t++){const n=new Uint8Array(s);n.set(a),g(i[t],c?.slice(2*t,2*t+2),p?.[t],n),e.push(n)}1===e.length?a.set(e[0]):w(e,a)}else for(let e=0;e<l;e++)g(i[e],c?.slice(2*e,2*e+2),p?.[e],a);return new o.A({width:n,height:r,pixelType:h,pixels:i,mask:a})}function x(e){const{srcPixelType:t,inputRanges:n,outputValues:r,allowUnmatched:i,noDataRanges:s,isLastInputRangeInclusive:l,outputPixelType:u}=e;if("u8"!==t&&"s8"!==t&&"u16"!==t&&"s16"!==t)return null;const c=t.includes("16")?65536:256,p=t.includes("s")?-c/2:0,h=o.A.createEmptyBand(u,c),f=new Uint8Array(c);i&&f.fill(255);const[d,m]=(0,a.hP)(u);if(n?.length&&r?.length){const e=1e-6,t=n.map((t=>t-e));t[0]=n[0],l&&(t[t.length-1]=n[n.length-1]);for(let e=0;e<t.length;e++){const n=r[e]>m?m:r[e]<d?d:r[e],i=Math.ceil(t[2*e]-p),s=Math.floor(t[2*e+1]-p);for(let e=i;e<=s;e++)h[e]=n,f[e]=255}}if(s?.length)for(let e=0;e<s.length;e++){const t=Math.ceil(s[2*e]-p),n=Math.floor(s[2*e+1]-p);for(let e=t;e<=n;e++)f[e]=0}return{lut:h,offset:p,mask:f}}function M(e,t,n){if("u8"!==e&&"s8"!==e&&"u16"!==e&&"s16"!==e)return null;const r=e.includes("16")?65536:256,i=e.includes("s")?-r/2:0,s=new Uint8Array(r);if(t)for(let e=0;e<t.length;e++){const n=Math.ceil(t[2*e]-i),r=Math.floor(t[2*e+1]-i);for(let e=n;e<=r;e++)s[e]=255}else s.fill(255);if(n)for(let e=0;e<n.length;e++)s[n[e]-i]=0;return{lut:s,offset:i}}function A(e,t){if(!e||0===e.length)return null;const n=e.find((e=>e.pixelBlock));if(null==n?.pixelBlock)return null;const r=(n.extent.xmax-n.extent.xmin)/n.pixelBlock.width,i=(n.extent.ymax-n.extent.ymin)/n.pixelBlock.height,s=.01*Math.min(r,i),o=e.sort(((e,t)=>Math.abs(e.extent.ymax-t.extent.ymax)>s?t.extent.ymax-e.extent.ymax:Math.abs(e.extent.xmin-t.extent.xmin)>s?e.extent.xmin-t.extent.xmin:0)),a=Math.min.apply(null,o.map((e=>e.extent.xmin))),l=Math.min.apply(null,o.map((e=>e.extent.ymin))),u=Math.max.apply(null,o.map((e=>e.extent.xmax))),c=Math.max.apply(null,o.map((e=>e.extent.ymax))),p={x:Math.round((t.xmin-a)/r),y:Math.round((c-t.ymax)/i)},h={width:Math.round((u-a)/r),height:Math.round((c-l)/i)},f={width:Math.round((t.xmax-t.xmin)/r),height:Math.round((t.ymax-t.ymin)/i)};return Math.round(h.width/n.pixelBlock.width)*Math.round(h.height/n.pixelBlock.height)!==o.length||p.x<0||p.y<0||h.width<f.width||h.height<f.height?null:{extent:t,pixelBlock:S(o.map((e=>e.pixelBlock)),h,{clipOffset:p,clipSize:f})}}function I(e,t,n,r,i,s){const{width:o,height:a}=n.block,{x:l,y:u}=n.offset,{width:c,height:p}=n.mosaic,h=function(e,t,n,r,i,s,o,a){return{xmin:i<=n*e?0:i<n*e+e?i-n*e:e,ymin:s<=r*t?0:s<r*t+t?s-r*t:t,xmax:i+o<=n*e?0:i+o<n*e+e?i+o-n*e:e,ymax:s+a<=r*t?0:s+a<r*t+t?s+a-r*t:t}}(o,a,r,i,l,u,c,p);let f=0,d=0;if(s){const e=s.hasGCSSShiftTransform?360:s.halfWorldWidth??0,t=o*s.resolutionX,n=s.startX+r*t;n<e&&n+t>e?d=s.rightPadding:n>=e&&(f=s.leftMargin-s.rightPadding,d=0)}if(h.xmax-=d,"number"!=typeof t)for(let n=h.ymin;n<h.ymax;n++){const s=(i*a+n-u)*c+(r*o-l)+f,p=n*o;for(let n=h.xmin;n<h.xmax;n++)e[s+n]=t[p+n]}else for(let n=h.ymin;n<h.ymax;n++){const s=(i*a+n-u)*c+(r*o-l)+f;for(let n=h.xmin;n<h.xmax;n++)e[s+n]=t}}function S(e,t,n={}){const{clipOffset:r,clipSize:i,alignmentInfo:s,blockWidths:a}=n;if(a)return function(e,t,n){const r=e.find((e=>null!=e));if(null==r)return null;const i=e.some((e=>null==e||!!e.mask)),{width:s,height:a}=t,l=i?new Uint8Array(s*a):null,{blockWidths:c}=n,p=[],h=r.getPlaneCount(),f=o.A.getPixelArrayConstructor(r.pixelType);if(i)for(let t=0,n=0;t<e.length;n+=c[t],t++){const r=e[t];if(!u(r))continue;const i=r.mask;for(let e=0;e<a;e++)for(let o=0;o<c[t];o++)l[e*s+o+n]=null==i?255:i[e*r.width+o]}const d=e.some((e=>e?.bandMasks&&e.bandMasks.length>1)),m=d?[]:void 0,y=s*a;for(let t=0;t<h;t++){const n=new f(y),r=d?new Uint8Array(y):void 0;for(let i=0,o=0;i<e.length;o+=c[i],i++){const l=e[i];if(!u(l))continue;const p=l.pixels[t];if(null!=p){for(let e=0;e<a;e++)for(let t=0;t<c[i];t++)n[e*s+t+o]=p[e*l.width+t];if(r){const e=l.bandMasks?.[t]??l.mask;for(let t=0;t<a;t++)for(let n=0;n<c[i];n++)r[t*s+n+o]=e?e[t*l.width+n]:255}}}p.push(n),m&&r&&m.push(r)}const g=new o.A({width:s,height:a,mask:l,bandMasks:m,pixels:p,pixelType:r.pixelType});return g.updateStatistics(),g}(e,t,{blockWidths:a});const l=e.find((e=>u(e)));if(null==l)return null;const c=i?i.width:t.width,p=i?i.height:t.height,h=l.width,f=l.height,d=t.width/h,m=t.height/f,y={offset:r||{x:0,y:0},mosaic:i||t,block:{width:h,height:f}},g=l.pixelType,w=o.A.getPixelArrayConstructor(g),b=l.pixels.length,v=[];let x,M;for(let t=0;t<b;t++){M=new w(c*p);for(let n=0;n<m;n++)for(let r=0;r<d;r++){const i=e[n*d+r];u(i)&&(x=i.pixels[t],I(M,x,y,r,n,s))}v.push(M)}const A=e.some((e=>null==e||null!=e.mask&&e.mask.length>0)),S=e.some((e=>e?.bandMasks&&e.bandMasks.length>1)),_=A?new Uint8Array(c*p):void 0,C=S?[]:void 0;if(_){for(let t=0;t<m;t++)for(let n=0;n<d;n++){const r=e[t*d+n],i=null!=r?r.mask:null;I(_,null!=i?i:r?255:0,y,n,t,s)}if(C)for(let t=0;t<b;t++){const n=new Uint8Array(c*p);for(let r=0;r<m;r++)for(let i=0;i<d;i++){const o=e[r*d+i],a=o?.bandMasks?.[t]??o?.mask;I(n,null!=a?a:o?255:0,y,i,r,s)}C.push(n)}}const T=new o.A({width:c,height:p,pixels:v,pixelType:g,bandMasks:C,mask:_});return T.updateStatistics(),T}function _(e,t,n){if(!u(e))return null;const{width:r,height:i}=e,s=t.x,o=t.y,a=n.width+s,l=n.height+o;if(s<0||o<0||a>r||l>i)return e;if(0===s&&0===o&&a===r&&l===i)return e;e.mask||(e.mask=new Uint8Array(r*i));const c=e.mask;for(let e=0;e<i;e++){const t=e*r;for(let n=0;n<r;n++)c[t+n]=e<o||e>=l||n<s||n>=a?0:1}return e.updateStatistics(),e}function C(e){if(!u(e))return null;const t=e.clone(),{width:n,height:r,pixels:i}=e,s=i[0],o=t.pixels[0],a=e.mask;for(let e=2;e<r-1;e++){const t=new Map;for(let r=e-2;r<e+2;r++)for(let e=0;e<4;e++){const i=r*n+e;R(t,s[i],a?a[i]:1)}o[e*n]=T(t),o[e*n+1]=o[e*n+2]=o[e*n];let r=3;for(;r<n-1;r++){let i=(e-2)*n+r+1;R(t,s[i],a?a[i]:1),i=(e-1)*n+r+1,R(t,s[i],a?a[i]:1),i=e*n+r+1,R(t,s[i],a?a[i]:1),i=(e+1)*n+r+1,R(t,s[i],a?a[i]:1),i=(e-2)*n+r-3,k(t,s[i],a?a[i]:1),i=(e-1)*n+r-3,k(t,s[i],a?a[i]:1),i=e*n+r-3,k(t,s[i],a?a[i]:1),i=(e+1)*n+r-3,k(t,s[i],a?a[i]:1),o[e*n+r]=T(t)}o[e*n+r+1]=o[e*n+r]}for(let e=0;e<n;e++)o[e]=o[n+e]=o[2*n+e],o[(r-1)*n+e]=o[(r-2)*n+e];return t.updateStatistics(),t}function T(e){if(0===e.size)return 0;let t=0,n=-1,r=0;const i=e.keys();let s=i.next();for(;!s.done;)r=e.get(s.value),r>t&&(n=s.value,t=r),s=i.next();return n}function k(e,t,n){if(0===n)return;const r=e.get(t);1===r?e.delete(t):e.set(t,r-1)}function R(e,t,n){0!==n&&e.set(t,e.has(t)?e.get(t)+1:1)}function P(e,t,n){let{x:r,y:i}=t;const{width:s,height:a}=n;if(0===r&&0===i&&a===e.height&&s===e.width)return e;const{width:l,height:c}=e,p=Math.max(0,i),h=Math.max(0,r),f=Math.min(r+s,l),d=Math.min(i+a,c);if(f<0||d<0||!u(e))return null;r=Math.max(0,-r),i=Math.max(0,-i);const{pixels:m}=e,y=s*a,g=m.length,w=[];for(let t=0;t<g;t++){const n=m[t],a=o.A.createEmptyBand(e.pixelType,y);for(let e=p;e<d;e++){const t=e*l;let o=(e+i-p)*s+r;for(let e=h;e<f;e++)a[o++]=n[t+e]}w.push(a)}const b=new Uint8Array(y),v=e.mask;for(let e=p;e<d;e++){const t=e*l;let n=(e+i-p)*s+r;for(let e=h;e<f;e++)b[n++]=v?v[t+e]:1}const x=new o.A({width:n.width,height:n.height,pixelType:e.pixelType,pixels:w,mask:b});return x.updateStatistics(),x}function N(e,t=!0){if(!u(e))return null;const{pixels:n,width:r,height:i,mask:s,pixelType:a}=e,l=[],c=Math.round(r/2),p=Math.round(i/2),h=i-1,f=r-1;for(let e=0;e<n.length;e++){const s=n[e],u=o.A.createEmptyBand(a,c*p);let d=0;for(let e=0;e<i;e+=2)for(let n=0;n<r;n+=2){const i=s[e*r+n];if(t){const t=n===f?i:s[e*r+n+1],o=e===h?i:s[e*r+n+r],a=n===f?o:e===h?t:s[e*r+n+r+1];u[d++]=(i+t+o+a)/4}else u[d++]=i}l.push(u)}let d=null;if(null!=s){d=new Uint8Array(c*p);let e=0;for(let n=0;n<i;n+=2)for(let i=0;i<r;i+=2){const o=s[n*r+i];if(t){const t=i===f?o:s[n*r+i+1],a=n===h?o:s[n*r+i+r],l=i===f?a:n===h?t:s[n*r+i+r+1];d[e++]=o*t*a*l?1:0}else d[e++]=o}}return new o.A({width:c,height:p,pixelType:a,pixels:l,mask:d})}function D(e,t,n=0,r=!0){if(!u(e))return null;const{width:i,height:s}=t;let{width:o,height:a}=e;const l=new Map,c={x:0,y:0},p=1+n;let h=e;for(let e=0;e<p;e++){const n=Math.ceil(o/i),u=Math.ceil(a/s);for(let r=0;r<u;r++){c.y=r*s;for(let s=0;s<n;s++){c.x=s*i;const n=P(h,c,t);l.set(`${e}/${r}/${s}`,n)}}e<p-1&&(h=N(h,r)),o=Math.round(o/2),a=Math.round(a/2)}return l}function E(e){const{pixelBlock:t,tileSize:n,level:r,row:i,col:s,useBilinear:o}=e;if(!u(t))return null;const{width:a,height:l}=n,c=2**r,p=c*a,h=c*l;let f=P(t,{y:i*h,x:s*p},{width:p,height:h});if(!f)return null;for(let e=r;e>0;e--)f=N(f,o);return f}function L(e,t,n,r,i=0){const{width:s,height:o}=e,{width:a,height:l}=t,u=r.cols,c=r.rows,p=Math.ceil(a/u-.1/u),h=Math.ceil(l/c-.1/c);let f,d,m,y,g,w,b;const v=p*u,x=v*h*c,M=new Float32Array(x),A=new Float32Array(x),I=new Uint32Array(x),S=new Uint32Array(x);let _,C,T=0;for(let e=0;e<h;e++)for(let t=0;t<p;t++){f=12*(e*p+t),d=n[f],m=n[f+1],y=n[f+2],g=n[f+3],w=n[f+4],b=n[f+5];for(let n=0;n<c;n++){T=(e*c+n)*v+t*u,C=(n+.5)/c;for(let e=0;e<n;e++)_=(e+.5)/u,M[T+e]=(d*_+m*C+y)*s+i,A[T+e]=(g*_+w*C+b)*o+i,I[T+e]=Math.floor(M[T+e]),S[T+e]=Math.floor(A[T+e])}f+=6,d=n[f],m=n[f+1],y=n[f+2],g=n[f+3],w=n[f+4],b=n[f+5];for(let n=0;n<c;n++){T=(e*c+n)*v+t*u,C=(n+.5)/c;for(let e=n;e<u;e++)_=(e+.5)/u,M[T+e]=(d*_+m*C+y)*s+i,A[T+e]=(g*_+w*C+b)*o+i,I[T+e]=Math.floor(M[T+e]),S[T+e]=Math.floor(A[T+e])}}return{offsets_x:M,offsets_y:A,offsets_xi:I,offsets_yi:S,gridWidth:v}}function F(e,t){const{coefficients:n,spacing:r}=t,{offsets_x:i,offsets_y:s,gridWidth:o}=L(e,e,n,{rows:r[0],cols:r[1]}),{width:a,height:l}=e,u=new Float32Array(a*l),c=180/Math.PI;for(let e=0;e<l;e++)for(let t=0;t<a;t++){const n=e*o+t,r=0===e?n:n-o,p=e===l-1?n:n+o,h=i[r]-i[p],f=s[p]-s[r];if(isNaN(h)||isNaN(f))u[e*a+t]=90;else{let n=Math.atan2(f,h)*c;n=(360+n)%360,u[e*a+t]=n}}return u}function O(e,t,n,r,i="nearest"){if(!u(e))return null;"majority"===i&&(e=C(e));const{pixels:s,mask:a,bandMasks:l,pixelType:c}=e,p=e.width,h=e.height,f=o.A.getPixelArrayConstructor(c),d=s.length,{width:m,height:y}=t;let g=!1;for(let e=0;e<n.length;e+=3)-1===n[e]&&-1===n[e+1]&&-1===n[e+2]&&(g=!0);const{offsets_x:w,offsets_y:b,offsets_xi:v,offsets_yi:x,gridWidth:M}=L({width:p,height:h},t,n,r,"majority"===i?.5:0);let A;const I=(e,t,n,r)=>{const i=e instanceof Float32Array||e instanceof Float64Array?0:.5;for(let s=0;s<y;s++){A=s*M;for(let o=0;o<m;o++){if(w[A]<0||b[A]<0)e[s*m+o]=0;else if(r)e[s*m+o]=t[v[A]+x[A]*p];else{const r=Math.floor(w[A]),a=Math.floor(b[A]),l=Math.ceil(w[A]),u=Math.ceil(b[A]),c=w[A]-r,h=b[A]-a;if(!n||n[r+a*p]&&n[l+a*p]&&n[r+u*p]&&n[l+u*p]){const n=(1-c)*t[r+a*p]+c*t[l+a*p],f=(1-c)*t[r+u*p]+c*t[l+u*p];e[s*m+o]=(1-h)*n+h*f+i}else e[s*m+o]=t[v[A]+x[A]*p]}A++}}},S=[];let _;const T=l?.length===d,k=[];for(let e=0;e<d;e++){if(T){const t=new Uint8Array(m*y);I(t,l[e],l[e],!0),k.push(t)}_=new f(m*y),I(_,s[e],T?l[e]:a,"nearest"===i||"majority"===i),S.push(_)}const R=new o.A({width:m,height:y,pixelType:c,pixels:S,bandMasks:T?k:void 0});if(null!=a)R.mask=new Uint8Array(m*y),I(R.mask,a,a,!0);else if(g){R.mask=new Uint8Array(m*y);for(let e=0;e<m*y;e++)R.mask[e]=w[e]<0||b[e]<0?0:1}return R.updateStatistics(),R}},56991:function(e,t,n){n.d(t,{vt:function(){return jr},UD:function(){return zr}});var r=n(75505),i=n(39819),s=n(21609),o=n(53804),a=n(23502),l=(n(58941),n(40633),n(13798),n(65953)),u=n(95738),c=n(30905);let p=class extends c.oY{constructor(){super(...arguments),this.raster=void 0}};(0,o._)([(0,a.MZ)({json:{write:!0}})],p.prototype,"raster",void 0),p=(0,o._)([(0,l.$)("esri.layers.support.rasterFunctions.BaseFunctionArguments")],p);const h=p;var f;let d=f=class extends h{constructor(){super(...arguments),this.raster2=void 0}get rasters(){return[this.raster,this.raster2]}clone(){return new f({raster:this.raster,raster2:this.raster2,operation:this.operation})}};(0,o._)([(0,a.MZ)({json:{write:!0}})],d.prototype,"operation",void 0),(0,o._)([(0,a.MZ)({json:{write:!0}})],d.prototype,"raster2",void 0),(0,o._)([(0,a.MZ)({readOnly:!0})],d.prototype,"rasters",null),d=f=(0,o._)([(0,l.$)("esri.layers.support.rasterFunctions.ArithmeticFunctionArguments")],d);const m=d;var y=n(77560),g=n(21327),w=n(98521);const b=new Set(["slope","aspect","curvature","hillshade","shadedrelief","statistics"]);let v=class extends c.oY{constructor(){super(...arguments),this.functionArguments=null,this.readingBufferSize=0,this.id=-1,this.isNoopProcess=!1,this.rawInputBandIds=[],this.rawSourceRasterInfos=null,this.isInputBandIdsSwizzled=!1,this.swizzledBandSelection=[],this.isBranch=!1,this._bindingResult=null}get supportsGPU(){return this._bindingResult.supportsGPU}get flatWebGLFunctionChain(){const e=this.getWebGLProcessorDefinition();if(!e)return null;const t=[e],{parameters:n}=e;let r=n.rasters||n.raster&&[n.raster];for(;r?.length;){t.unshift(...r);const e=[];for(let t=0;t<r.length;t++){const{parameters:n}=r[t],i=n.rasters||n.raster&&[n.raster];i?.length&&e.push(...i)}r=e}for(let e=t.length-1;e>=0;e--)t[e].isNoopProcess&&t.splice(e,1);let i=!1;for(let e=0;e<t.length;e++){const n=t[e];n.id=t.length-e-1;const{rasters:r}=n.parameters;i=i||null!=r&&r.length>1}const s=t.some((({name:e})=>b.has(e.toLowerCase()))),{rawSourceRasterInfos:o}=this;return{functions:t,hasBranches:i,hasFocalFunction:s,isSourceSingleBand:1===o?.[0]?.bandCount}}bind(e,t=!1,n=-1){this.id=n+1;const r=this._getRasterValues();let i=!0;for(let n=0;n<r.length;n++){const s=r[n];if(null!=s&&this._isRasterFunctionValue(s)){const r=s.bind(e,t,this.id+n);if(!r.success)return this._bindingResult=r,r;i=i&&r.supportsGPU}}return!this.rasterInfo||t?(this.sourceRasterInfos=this._getSourceRasterInfos(e),this._bindingResult=this._bindSourceRasters(),this._bindingResult.success&&this._patchRasterInfo(),this._bindingResult.supportsGPU=i&&this._bindingResult.supportsGPU,this.processInputBandIds(),this._bindingResult):(this._bindingResult={success:!0,supportsGPU:!0},this.processInputBandIds(),this._bindingResult)}process(e){const t=this._getRasterValues(),n=0===t.length?e.pixelBlocks??e.primaryPixelBlocks:t.map((t=>this._readRasterValue(t,e)));return this._processPixels({...e,pixelBlocks:n})}processInputBandIds(){const e=this._getRasterValues().filter(this._isRasterFunctionValue);let t;if(e.length>1){const t=e.map((e=>e.processInputBandIds()[0]));this.rawInputBandIds=t,this.isInputBandIdsSwizzled=this.rawInputBandIds.some(((e,t)=>e!==t));const n=e.filter((e=>"ExtractBand"===e.functionName));return n.length&&n.forEach(((e,t)=>{e.isInputBandIdsSwizzled=!0,e.swizzledBandSelection=[t,t,t]})),this.rawInputBandIds}const n=e[0];if(n){if(t=n.processInputBandIds(),n.isInputBandIdsSwizzled)return this.rawInputBandIds=t,t}else{t=[];const{bandCount:e}=this.sourceRasterInfos[0];for(let n=0;n<e;n++)t.push(n)}const r=this._getInputBandIds(t);return this.isInputBandIdsSwizzled=r.some(((e,t)=>e!==t)),this.rawInputBandIds=r,this.rawInputBandIds}getPrimaryRasters(){const e=[],t=[];return this._getPrimaryRasters(this,e,t),{rasters:e,rasterIds:t}}getWebGLProcessorDefinition(){const e=this._getWebGLParameters(),{raster:t,rasters:n}=this.functionArguments;return n&&Array.isArray(n)&&n.length?(e.rasters=n.map((e=>this._isRasterFunctionValue(e)?e.getWebGLProcessorDefinition():"number"==typeof e?{name:"Constant",parameters:{value:e},pixelType:"f32",id:-1,isNoopProcess:!1}:{name:"Identity",parameters:{value:e},pixelType:"f32",id:-1,isNoopProcess:!1})),e.rasters.some((e=>null!=e))||(e.rasters=null)):this._isRasterFunctionValue(t)&&(e.raster=t.getWebGLProcessorDefinition()),{name:this.functionName,parameters:e,pixelType:this.outputPixelType,id:this.id,isNoopProcess:this.isNoopProcess}}getClippingGeometries(){const e=[];"Clip"===this.functionName&&e.push(this.functionArguments);const{raster:t,rasters:n}=this.functionArguments;if(n&&Array.isArray(n)&&n.length)n.forEach((t=>{if(this._isRasterFunctionValue(t)){const n=t.getClippingGeometries();e.push(...n)}}));else if(this._isRasterFunctionValue(t)){const n=t.getClippingGeometries();e.push(...n)}return e}_getOutputPixelType(e){return"unknown"===this.outputPixelType?e:this.outputPixelType??e}_getWebGLParameters(){return{}}_getInputBandIds(e){return e}_removeStatsHistColormapVAT(e){e.statistics=null,e.histograms=null,e.colormap=null,e.attributeTable=null,e.multidimensionalInfo?.variables.forEach((e=>{e.statistics=void 0,e.histograms=void 0}))}_getRasterValues(){const{rasterArgumentNames:e}=this;return"rasters"===e[0]?this.functionArguments.rasters??[]:e.flatMap((e=>this.functionArguments[e]))}_getSourceRasterInfos(e){const t=this._getRasterValues(),{rasterInfos:n,rasterIds:r}=e;if(0===t.length)return n;const i=t.map((e=>e&&"object"==typeof e&&"bind"in e&&e.rasterInfo?e.rasterInfo:"string"==typeof e&&r.includes(e)?n[r.indexOf(e)]:"number"!=typeof e?n[0]:void 0)),s=i.find((e=>e))??n[0];return i.forEach(((e,t)=>{void 0===e&&(i[t]=s)})),i}_getPrimaryRasterId(e){return e?.rasterId}_getPrimaryRasters(e,t=[],n=[]){for(let r=0;r<e.sourceRasters.length;r++){const i=e.sourceRasters[r];if("number"!=typeof i)if("bind"in i)this._getPrimaryRasters(i,t,n);else{const e=i,r=this._getPrimaryRasterId(e);if(null==r)continue;n.includes(r)||(this.mainPrimaryRasterId===r?(t.unshift(e),n.unshift(r)):(t.push(e),n.push(r)))}}}_isRasterFunctionValue(e){return null!=e&&"object"==typeof e&&"getWebGLProcessorDefinition"in e}_readRasterValue(e,t){const{primaryPixelBlocks:n}=t;if(null==e||"$$"===e){const e=n[0];return null==e?null:e.clone()}if("string"==typeof e){const r=t.primaryRasterIds.indexOf(e);return-1===r?null:n[r]}if("number"==typeof e){const t=n[0];if(null==t)return null;const{width:r,height:i,pixelType:s}=t,o=new Float32Array(r*i);o.fill(e);const a=this.sourceRasterInfos[0].bandCount,l=new Array(a).fill(o);return new g.A({width:r,height:i,pixelType:s,pixels:l})}return e.process(t)}_patchRasterInfo(){const{rasterInfo:e}=this;if(!e?.keyProperties)return;const{bandCount:t,keyProperties:n,statistics:r,histograms:i}=e,s=n.BandProperties;s&&s.length!==t&&(e.keyProperties={...n,BandProperties:void 0}),r&&r.length!==t&&(e.statistics=r.length>t?r.slice(0,t):null),i&&i.length!==t&&(e.histograms=i.length>t?i.slice(0,t):null),n.BAND_COUNT&&Number(n.BAND_COUNT)!==t&&(e.keyProperties={...n,BAND_COUNT:"string"==typeof n.BAND_COUNT?String(t):t})}};(0,o._)([(0,a.MZ)({json:{write:!0}})],v.prototype,"functionName",void 0),(0,o._)([(0,a.MZ)({json:{write:!0}})],v.prototype,"functionArguments",void 0),(0,o._)([(0,a.MZ)()],v.prototype,"rasterArgumentNames",void 0),(0,o._)([(0,a.MZ)({json:{write:!0}}),(0,y.w)((e=>e?.toLowerCase()))],v.prototype,"outputPixelType",void 0),(0,o._)([(0,a.MZ)({json:{write:!0}})],v.prototype,"mainPrimaryRasterId",void 0),(0,o._)([(0,a.MZ)()],v.prototype,"sourceRasters",void 0),(0,o._)([(0,a.MZ)({type:[w.A],json:{write:!0}})],v.prototype,"sourceRasterInfos",void 0),(0,o._)([(0,a.MZ)({json:{write:!0}})],v.prototype,"rasterInfo",void 0),(0,o._)([(0,a.MZ)({json:{write:!0}})],v.prototype,"readingBufferSize",void 0),(0,o._)([(0,a.MZ)({json:{write:!0}})],v.prototype,"id",void 0),(0,o._)([(0,a.MZ)()],v.prototype,"isNoopProcess",void 0),(0,o._)([(0,a.MZ)()],v.prototype,"supportsGPU",null),(0,o._)([(0,a.MZ)()],v.prototype,"rawInputBandIds",void 0),(0,o._)([(0,a.MZ)()],v.prototype,"rawSourceRasterInfos",void 0),(0,o._)([(0,a.MZ)()],v.prototype,"isInputBandIdsSwizzled",void 0),(0,o._)([(0,a.MZ)()],v.prototype,"swizzledBandSelection",void 0),(0,o._)([(0,a.MZ)()],v.prototype,"isBranch",void 0),(0,o._)([(0,a.MZ)({readOnly:!0})],v.prototype,"flatWebGLFunctionChain",null),(0,o._)([(0,a.MZ)()],v.prototype,"_bindingResult",void 0),v=(0,o._)([(0,l.$)("esri.layers.support.rasterFunctions.BaseRasterFunction")],v);const x=v,M={userDefined:-1,lineDetectionHorizontal:0,lineDetectionVertical:1,lineDetectionLeftDiagonal:2,lineDetectionRightDiagonal:3,gradientNorth:4,gradientWest:5,gradientEast:6,gradientSouth:7,gradientNorthEast:8,gradientNorthWest:9,smoothArithmeticMean:10,smoothing3x3:11,smoothing5x5:12,sharpening3x3:13,sharpening5x5:14,laplacian3x3:15,laplacian5x5:16,sobelHorizontal:17,sobelVertical:18,sharpen:19,sharpen2:20,pointSpread:21,none:255},A={bitwiseAnd:11,bitwiseLeftShift:12,bitwiseNot:13,bitwiseOr:14,bitwiseRightShift:15,bitwiseXOr:16,booleanAnd:17,booleanNot:18,booleanOr:19,booleanXOr:20,equalTo:24,greaterThan:28,greaterThanEqual:29,lessThan:33,lessThanEqual:34,isNull:31,notEqual:46},I={acos:6,asin:7,atan:8,atanh:9,cos:21,cosh:22,sin:51,sinh:52,tan:56,tanh:57,acosh:59,asinh:60,atan2:61},S={setNull:50,conditional:78},_={plus:1,minus:2,times:3,sqrt:4,power:5,abs:10,divide:23,exp:25,exp10:26,exp2:27,int:30,float:32,ln:35,log10:36,log2:37,mod:44,negate:45,roundDown:48,roundUp:49,square:53,floatDivide:64,floorDivide:65,...A,...I,majority:38,max:39,mean:40,med:41,min:42,minority:43,range:47,stddev:54,sum:55,variety:58,majorityIgnoreNoData:66,maxIgnoreNoData:67,meanIgnoreNoData:68,medIgnoreNoData:69,minIgnoreNoData:70,minorityIgnoreNoData:71,rangeIgnoreNoData:72,stddevIgnoreNoData:73,sumIgnoreNoData:74,varietyIgnoreNoData:75,...S},C=new Map([[I.acos,{domain:[0,Math.PI],isInteger:!1}],[I.asin,{domain:[-Math.PI/2,Math.PI/2],isInteger:!1}],[I.atan,{domain:[-Math.PI/2,Math.PI/2],isInteger:!1}],[I.cos,{domain:[-1,1],isInteger:!1}],[I.sin,{domain:[-1,1],isInteger:!1}],[A.booleanAnd,{domain:[0,1],isInteger:!0}],[A.booleanNot,{domain:[0,1],isInteger:!0}],[A.booleanOr,{domain:[0,1],isInteger:!0}],[A.booleanXOr,{domain:[0,1],isInteger:!0}],[A.equalTo,{domain:[0,1],isInteger:!0}],[A.notEqual,{domain:[0,1],isInteger:!0}],[A.greaterThan,{domain:[0,1],isInteger:!0}],[A.greaterThanEqual,{domain:[0,1],isInteger:!0}],[A.lessThan,{domain:[0,1],isInteger:!0}],[A.lessThanEqual,{domain:[0,1],isInteger:!0}],[A.isNull,{domain:[0,1],isInteger:!0}]]);function T(e){return C.get(e)}const k=[0,2,2,2,1,2,1,1,1,1,1,2,2,1,2,2,2,2,1,2,2,1,1,2,2,1,1,1,2,2,1,1,1,2,2,1,1,1,999,999,999,999,999,999,2,1,2,999,1,1,2,1,1,1,999,999,1,1,999,1,1,2,999,999,2,2,999,999,999,999,999,999,999,999,999,999,3,999,3];function R(e,t,n){const[r,i]=e,s=r.length,o=g.A.createEmptyBand(n,s);for(let e=0;e<s;e++)t&&!t[e]||(o[e]=r[e]+i[e]);return o}function P(e,t,n){const[r]=e,i=r.length,s=g.A.createEmptyBand("f32",i);return s.set(r),s}function N(e,t,n){const[r]=e,i=r.length,s=g.A.createEmptyBand(n,i);for(let e=0;e<i;e++)t&&!t[e]||(s[e]=r[e]*r[e]);return s}function D(e,t,n){const[r,i]=e,s=r.length,o=g.A.createEmptyBand(n,s);for(let e=0;e<s;e++)t&&!t[e]||(o[e]=r[e]-i[e]);return o}function E(e,t,n){const[r,i]=e,s=r.length,o=g.A.createEmptyBand(n,s);for(let e=0;e<s;e++)t&&!t[e]||(o[e]=r[e]*i[e]);return o}function L(e,t,n){const[r]=e,i=r.length,s=g.A.createEmptyBand(n,i);for(let e=0;e<i;e++)t&&!t[e]||(s[e]=Math.sign(r[e])*Math.floor(Math.abs(r[e])));return s}function F(e,t,n){const[r,i]=e,s=r.length,o=g.A.createEmptyBand(n,s);for(let e=0;e<s;e++)t&&!t[e]||(o[e]=r[e]/i[e]);return o}function O(e,t,n){return F(e,t,"f32")}function z(e,t,n){const[r,i]=e,s=r.length,o=g.A.createEmptyBand(n,s);for(let e=0;e<s;e++)t&&!t[e]||(o[e]=Math.floor(r[e]/i[e]));return o}function j(e,t,n,r){const i=e[0],s=i.length,o=g.A.createEmptyBand(n,s);if(r===I.atanh){for(let e=0;e<s;e++)if(t[e]){const n=i[e];Math.abs(n)>=1?t[e]=0:o[e]=Math.atanh(n)}return o}const a=r===I.asin?Math.asin:Math.acos;for(let e=0;e<s;e++)if(t[e]){const n=i[e];Math.abs(n)>1?t[e]=0:o[e]=a(n)}return o}function B(e,t,n,r){const[i]=e,s=i.length,o=g.A.createEmptyBand(n,s);for(let e=0;e<s;e++)t&&!t[e]||(o[e]=r(i[e]));return o}function Z(e,t,n,r){const[i,s]=e,o=i.length,a=g.A.createEmptyBand(n,o);for(let e=0;e<o;e++)t&&!t[e]||(a[e]=r(i[e],s[e]));return a}function U(e,t,n){const[r,i]=e,s=r.length,o=g.A.createEmptyBand(n,s);for(let e=0;e<s;e++)t&&!t[e]||(o[e]=r[e]&i[e]);return o}function V(e,t,n){const[r,i]=e,s=r.length,o=g.A.createEmptyBand(n,s);for(let e=0;e<s;e++)t&&!t[e]||(o[e]=r[e]<<i[e]);return o}function G(e,t,n){const[r]=e,i=r.length,s=g.A.createEmptyBand(n,i);for(let e=0;e<i;e++)t&&!t[e]||(s[e]=~r[e]);return s}function H(e,t,n){const[r,i]=e,s=r.length,o=g.A.createEmptyBand(n,s);for(let e=0;e<s;e++)t&&!t[e]||(o[e]=r[e]|i[e]);return o}function W(e,t,n){const[r,i]=e,s=r.length,o=g.A.createEmptyBand(n,s);for(let e=0;e<s;e++)t&&!t[e]||(o[e]=r[e]>>i[e]);return o}function J(e,t,n){const[r,i]=e,s=r.length,o=g.A.createEmptyBand(n,s);for(let e=0;e<s;e++)t&&!t[e]||(o[e]=r[e]^i[e]);return o}function q(e,t,n){const[r,i]=e,s=r.length,o=g.A.createEmptyBand(n,s);for(let e=0;e<s;e++)t&&!t[e]||(o[e]=r[e]&&i[e]?1:0);return o}function $(e,t,n){const[r]=e,i=r.length,s=g.A.createEmptyBand(n,i);for(let e=0;e<i;e++)t&&!t[e]||(s[e]=r[e]?0:1);return s}function K(e,t,n){const[r,i]=e,s=r.length,o=g.A.createEmptyBand(n,s);for(let e=0;e<s;e++)t&&!t[e]||(o[e]=r[e]||i[e]?1:0);return o}function Y(e,t,n){const[r,i]=e,s=r.length,o=g.A.createEmptyBand(n,s);for(let e=0;e<s;e++)t&&!t[e]||(o[e]=(r[e]?1:0)^(i[e]?1:0));return o}function X(e,t,n){const[r,i]=e,s=r.length,o=g.A.createEmptyBand(n,s);for(let e=0;e<s;e++)t&&!t[e]||(o[e]=r[e]===i[e]?1:0);return o}function Q(e,t,n,r){const[i]=e,s=i.length,o=g.A.createEmptyBand(n,s),a=r===Math.E;for(let e=0;e<s;e++)t&&!t[e]||(o[e]=a?Math.exp(i[e]):r**i[e]);return o}function ee(e,t,n){return Q(e,t,n,10)}function te(e,t,n){return Q(e,t,n,2)}function ne(e,t,n){return Q(e,t,n,Math.E)}function re(e,t,n,r){const[i]=e,s=i.length,o=g.A.createEmptyBand(n,s);for(let e=0;e<s;e++)t&&!t[e]||(i[e]<=0?t[e]=0:o[e]=r(i[e]));return o}function ie(e,t,n){return re(e,t,n,Math.log10)}function se(e,t,n){return re(e,t,n,Math.log2)}function oe(e,t,n){return re(e,t,n,Math.log)}function ae(e,t,n){const[r,i]=e,s=r.length,o=g.A.createEmptyBand(n,s);for(let e=0;e<s;e++)t&&!t[e]||(o[e]=r[e]>i[e]?1:0);return o}function le(e,t,n){const[r,i]=e,s=r.length,o=g.A.createEmptyBand(n,s);for(let e=0;e<s;e++)t&&!t[e]||(o[e]=r[e]>=i[e]?1:0);return o}function ue(e,t,n){const[r,i]=e,s=r.length,o=g.A.createEmptyBand(n,s);for(let e=0;e<s;e++)t&&!t[e]||(o[e]=r[e]<i[e]?1:0);return o}function ce(e,t,n){const[r,i]=e,s=r.length,o=g.A.createEmptyBand(n,s);for(let e=0;e<s;e++)t&&!t[e]||(o[e]=r[e]<=i[e]?1:0);return o}function pe(e,t,n){const[r]=e,i=r.length,s=g.A.createEmptyBand(n,i);if(!t)return s;for(let e=0;e<i;e++)s[e]=t[e]?0:1;return s}function he(e,t,n){const[r,i]=e,s=r.length,o=g.A.createEmptyBand(n,s);for(let e=0;e<s;e++)t&&!t[e]||(o[e]=r[e]%i[e]);return o}function fe(e,t,n){const[r]=e,i=r.length,s=g.A.createEmptyBand(n,i);for(let e=0;e<i;e++)t&&!t[e]||(s[e]=-r[e]);return s}function de(e,t,n){const[r,i]=e,s=r.length,o=g.A.createEmptyBand(n,s);for(let e=0;e<s;e++)t&&!t[e]||(o[e]=r[e]===i[e]?0:1);return o}function me(e,t,n){const[r,i]=e,s=r.length,o=g.A.createEmptyBand(n,s),a=new Uint8Array(s);for(let e=0;e<s;e++)null!=t&&!t[e]||0!==r[e]||(o[e]=i[e],a[e]=255);return{band:o,mask:a}}function ye(e,t,n){const[r,i,s]=e,o=r.length,a=g.A.createEmptyBand(n,o);for(let e=0;e<o;e++)t&&!t[e]||(a[e]=r[e]?i[e]:s[e]);return a}function ge(e,t,n){const r=e.length;if(r<2)return e[0];const[i]=e,s=i.length,o=g.A.createEmptyBand(n,s);for(let n=0;n<s;n++)if(!t||t[n]){let t=i[n];for(let i=1;i<r;i++){const r=e[i][n];t<r&&(t=r)}o[n]=t}return o}function we(e,t,n){const r=e.length;if(r<2)return e[0];const[i]=e,s=i.length,o=g.A.createEmptyBand(n,s);for(let n=0;n<s;n++)if(!t||t[n]){let t=i[n];for(let i=1;i<r;i++){const r=e[i][n];t>r&&(t=r)}o[n]=t}return o}function be(e,t,n){const r=e.length;if(r<2)return e[0];const[i]=e,s=i.length,o=g.A.createEmptyBand(n,s);for(let n=0;n<s;n++)if(!t||t[n]){let t=i[n],s=t;for(let i=1;i<r;i++){const r=e[i][n];s<r?s=r:t>r&&(t=r)}o[n]=s-t}return o}function ve(e,t,n){const r=e.length;if(r<2)return e[0];const[i]=e,s=i.length,o=g.A.createEmptyBand(n,s);for(let n=0;n<s;n++)if(!t||t[n]){let t=0;for(let i=0;i<r;i++)t+=e[i][n];o[n]=t/r}return o}function xe(e,t,n){const r=e.length;if(r<2)return e[0];const[i]=e,s=i.length,o=g.A.createEmptyBand(n,s);for(let n=0;n<s;n++)if(!t||t[n])for(let t=0;t<r;t++){const r=e[t];o[n]+=r[n]}return o}function Me(e,t,n){const r=e.length;if(r<2)return e[0];const[i]=e,s=i.length,o=g.A.createEmptyBand(n,s);for(let n=0;n<s;n++)if(!t||t[n]){const t=new Float32Array(r);let i=0;for(let s=0;s<r;s++){const r=e[s];i+=r[n],t[s]=r[n]}i/=r;let s=0;for(let e=0;e<r;e++)s+=(t[e]-i)**2;o[n]=Math.sqrt(s/r)}return o}function Ae(e,t,n){const r=e.length;if(r<2)return e[0];const i=Math.floor(r/2),[s]=e,o=s.length,a=g.A.createEmptyBand(n,o),l=new Float32Array(r),u=r%2==1;for(let n=0;n<o;n++)if(!t||t[n]){for(let t=0;t<r;t++)l[t]=e[t][n];l.sort(),a[n]=u?l[i]:(l[i]+l[i-1])/2}return a}function Ie(e,t,n){const[r,i]=e;if(null==i)return r;const s=r.length,o=g.A.createEmptyBand(n,s);for(let e=0;e<s;e++)t&&!t[e]||(o[e]=r[e]<i[e]?r[e]:i[e]);return o}function Se(e,t,n){const r=e.length;if(r<=2)return Ie(e,t,n);const i=e[0].length,s=g.A.createEmptyBand(n,i),o=new Map;for(let n=0;n<i;n++)if(!t||t[n]){o.clear();for(let t=0;t<r;t++){const r=e[t][n];o.set(r,o.has(r)?o.get(r)+1:1)}let t=0,i=0;const a=[];for(const e of o.keys())t=o.get(e),t>i?(i=t,a.length=0,a.push(e)):t===i&&a.push(e);a.length>1&&a.sort(((e,t)=>e-t)),s[n]=a[0]}return s}function _e(e,t,n){const r=e.length;if(r<=2)return Ie(e,t,n);const i=e[0].length,s=g.A.createEmptyBand(n,i),o=new Map;for(let n=0;n<i;n++)if(!t||t[n]){o.clear();for(let t=0;t<r;t++){const r=e[t][n];o.set(r,o.has(r)?o.get(r)+1:1)}let t=0,i=e.length;const a=[];for(const e of o.keys())t=o.get(e),t<i?(i=t,a.length=0,a.push(e)):t===i&&a.push(e);a.length>1&&a.sort(((e,t)=>e-t)),s[n]=a[0]}return s}function Ce(e,t,n){const r=e.length;if(r<2)return e[0];const[i]=e,s=i.length,o=g.A.createEmptyBand(n,s),a=new Set;for(let n=0;n<s;n++)if(!t||t[n]){let t;a.clear();for(let i=0;i<r;i++)t=e[i][n],a.add(t);o[n]=a.size}return o}const Te=new Map,ke=new Map,Re=new Map,Pe=new Map;function Ne(){Te.size||(Te.set(4,Math.sqrt),Te.set(6,Math.acos),Te.set(7,Math.asin),Te.set(8,Math.atan),Te.set(9,Math.atanh),Te.set(10,Math.abs),Te.set(21,Math.cos),Te.set(22,Math.cosh),Te.set(48,Math.floor),Te.set(49,Math.ceil),Te.set(51,Math.sin),Te.set(52,Math.sinh),Te.set(56,Math.tan),Te.set(57,Math.tanh),Te.set(59,Math.acosh),Te.set(60,Math.asinh),Te.set(65,Math.floor),ke.set(5,Math.pow),ke.set(61,Math.atan2),Re.set(1,R),Re.set(2,D),Re.set(3,E),Re.set(11,U),Re.set(12,V),Re.set(13,G),Re.set(14,H),Re.set(15,W),Re.set(16,J),Re.set(17,q),Re.set(18,$),Re.set(19,K),Re.set(20,Y),Re.set(23,F),Re.set(24,X),Re.set(25,ne),Re.set(26,ee),Re.set(27,te),Re.set(28,ae),Re.set(29,le),Re.set(30,L),Re.set(31,pe),Re.set(32,P),Re.set(33,ue),Re.set(34,ce),Re.set(35,oe),Re.set(36,ie),Re.set(37,se),Re.set(44,he),Re.set(45,fe),Re.set(46,de),Re.set(53,N),Re.set(64,O),Re.set(65,z),Re.set(76,ye),Re.set(78,ye),Pe.set(38,Se),Pe.set(39,ge),Pe.set(40,ve),Pe.set(41,Ae),Pe.set(42,we),Pe.set(43,_e),Pe.set(47,be),Pe.set(54,Me),Pe.set(55,xe),Pe.set(58,Ce),Pe.set(66,Se),Pe.set(67,ge),Pe.set(68,ve),Pe.set(69,Ae),Pe.set(70,we),Pe.set(71,_e),Pe.set(72,be),Pe.set(73,Me),Pe.set(74,xe),Pe.set(75,Ce))}function De(e,t,n={}){Ne();let r=function(e,t=!1){const n=e.map((e=>e.mask)),r=n.filter((e=>null!=e)),i=e[0].pixels[0].length;if(0===r.length||t&&r.length!==n.length)return new Uint8Array(i).fill(255);const s=r[0],o=new Uint8Array(s);if(1===r.length)return o;if(!t){for(let e=1;e<r.length;e++){const t=r[e];for(let e=0;e<o.length;e++)o[e]&&(o[e]=t[e]?255:0)}return o}for(let e=1;e<r.length;e++){const t=r[e];for(let e=0;e<o.length;e++)0===o[e]&&(o[e]=t[e]?255:0)}return o}(e,t>=66&&t<=75);const{outputPixelType:i="f32"}=n,s=!Pe.has(t)||n.processAsMultiband,o=s?e[0].pixels.length:1,a=[];for(let n=0;n<o;n++){const o=Pe.has(t)&&!s?e.flatMap((e=>e.pixels)):e.map((e=>e.pixels[n]));let l,c=!0;if(t===S.setNull){const e=me(o,r,i);l=e.band,r=e.mask,c=!1}else Re.has(t)?l=Re.get(t)(o,r,"f64"):Te.has(t)?l=t===I.asin||t===I.acos||t===I.atanh?j(o,r,"f64",t):B(o,r,"f64",Te.get(t)):ke.has(t)?l=Z(o,r,"f64",ke.get(t)):Pe.has(t)?l=Pe.get(t)(o,r,"f64"):(l=o[0],c=!1);if(c&&t!==A.isNull&&!C.has(t)){const e=g.A.createEmptyBand(i,l.length);r||(r=new Uint8Array(l.length).fill(255)),(0,u.$p)(l,r),(0,u.yM)(l,r,i,e),l=e}a.push(l)}const l=e[0];return new g.A({width:l.width,height:l.height,pixelType:i,mask:t===A.isNull?null:r,pixels:a})}let Ee=class extends x{constructor(){super(...arguments),this.functionName="Arithmetic",this.functionArguments=null,this.rasterArgumentNames=["raster","raster2"]}_bindSourceRasters(){const{operation:e}=this.functionArguments;if(e<1||e>6)return{success:!1,supportsGPU:!1,error:"unsupported operation"};const t=this.sourceRasterInfos[0].clone();return this.outputPixelType=this._getOutputPixelType(t.pixelType),t.pixelType=this.outputPixelType,this._removeStatsHistColormapVAT(t),this.rasterInfo=t,{success:!0,supportsGPU:t.bandCount<=3}}_processPixels(e){const{pixelBlocks:t}=e;return null==t?.[0]||null==t?.[1]?null:function(e,t,n){return De(e,t=[null,1,2,3,23,5,44][t]??1,{outputPixelType:n})}(t,this.functionArguments.operation,this.outputPixelType)}_getWebGLParameters(){const{operation:e}=this.functionArguments,t=["","plus","minus","times","divide","power","mod"][e],n=this.outputPixelType??"f32";let[r,i]=(0,u.hP)(n);const s=(0,u.zw)(n);return s&&(r-=1e-4,i+=1e-4),{imageCount:2,operationName:t,domainRange:[r,i],isOutputRounded:s}}};(0,o._)([(0,a.MZ)({json:{write:!0,name:"rasterFunction"}})],Ee.prototype,"functionName",void 0),(0,o._)([(0,a.MZ)({type:m,json:{write:!0,name:"rasterFunctionArguments"}})],Ee.prototype,"functionArguments",void 0),(0,o._)([(0,a.MZ)()],Ee.prototype,"rasterArgumentNames",void 0),Ee=(0,o._)([(0,l.$)("esri.layers.support.rasterFunctions.ArithmeticFunction")],Ee);const Le=Ee;var Fe;let Oe=Fe=class extends h{clone(){return new Fe({raster:this.raster})}};Oe=Fe=(0,o._)([(0,l.$)("esri.layers.support.rasterFunctions.AspectFunctionArguments")],Oe);const ze=Oe;var je=n(55469);let Be=class extends x{constructor(){super(...arguments),this.functionName="Aspect",this.functionArguments=null,this.rasterArgumentNames=["raster"],this.isGCS=!1}_bindSourceRasters(){const e=this.sourceRasterInfos[0];this.isGCS=e.spatialReference?.isGeographic??!1,this.outputPixelType=this._getOutputPixelType("f32");const t=e.clone();return t.pixelType=this.outputPixelType,this._removeStatsHistColormapVAT(t),t.statistics=[{min:-1,max:360,avg:180,stddev:30}],t.bandCount=1,this.rasterInfo=t,{success:!0,supportsGPU:!0}}_processPixels(e){const t=e.pixelBlocks?.[0];if(null==t)return null;const{extent:n,primaryPixelSizes:r}=e,i=r?.[0],s=i??(n?{x:n.width/t.width,y:n.height/t.height}:{x:1,y:1});return(0,je.di)(t,{resolution:s})}};(0,o._)([(0,a.MZ)({json:{write:!0,name:"rasterFunction"}})],Be.prototype,"functionName",void 0),(0,o._)([(0,a.MZ)({type:ze,json:{write:!0,name:"rasterFunctionArguments"}})],Be.prototype,"functionArguments",void 0),(0,o._)([(0,a.MZ)()],Be.prototype,"rasterArgumentNames",void 0),(0,o._)([(0,a.MZ)({json:{write:!0}})],Be.prototype,"isGCS",void 0),Be=(0,o._)([(0,l.$)("esri.layers.support.rasterFunctions.AspectFunction")],Be);const Ze=Be;var Ue=n(74376),Ve=n(73037);const Ge=new Set(["+","-","*","/","(",")"]);function He(e,t){return e.toLowerCase().startsWith("b")?t[parseInt(e.slice(1),10)-1]:parseFloat(e)}function We(e,t,n,r){if("number"==typeof n&&"number"==typeof r)return n+r;let i,s,o;"number"==typeof n?(o=r,i=o.length,s=new Float32Array(i),s.fill(n)):(i=n.length,s=n,r.constructor===Number?(o=new Float32Array(i),o.fill(r)):o=r);const a=new Float32Array(i);switch(t){case"+":for(let t=0;t<i;t++)(null==e||e[t])&&(a[t]=s[t]+o[t]);break;case"-":for(let t=0;t<i;t++)(null==e||e[t])&&(a[t]=s[t]-o[t]);break;case"*":for(let t=0;t<i;t++)(null==e||e[t])&&(a[t]=s[t]*o[t]);break;case"/":for(let t=0;t<i;t++)(null==e||e[t])&&o[t]&&(a[t]=s[t]/o[t]);break;case"(":case")":throw new Error("encountered error with custom band index equation")}return a}function Je(e,t){e.splice(t,1);let n=0,r=0;do{n=0,r=0;for(let t=0;t<e.length;t++)if("("===e[t])n=t;else if(")"===e[t]){r=t;break}r===n+1&&e.splice(n,2)}while(r===n+1);return e}function qe(e){if(1===e.length)return{opIndex:0,numIndex:0};let t=0,n=0;for(let r=0;r<e.length;r++)if("("===e[r])t=r;else if(")"===e[r]){n=r;break}const r=0===n?e:e.slice(t+1,n);let i=-1;for(let e=0;e<r.length;e++)if("*"===r[e]||"/"===r[e]){i=e;break}if(i>-1)n>0&&(i+=t+1);else{for(let e=0;e<r.length;e++)if("+"===r[e]||"-"===r[e]){i=e;break}n>0&&(i+=t+1)}let s=0;for(let t=0;t<i;t++)"("===e[t]&&s++;return{opIndex:i,numIndex:i-s}}var $e=n(43264);const Ke=new Ve.J({0:"custom",1:"ndvi",2:"savi",3:"tsavi",4:"msavi",5:"gemi",6:"pvi",7:"gvitm",8:"sultan",9:"vari",10:"gndvi",11:"sr",12:"ndvi-re",13:"sr-re",14:"mtvi2",15:"rtvi-core",16:"ci-re",17:"ci-g",18:"ndwi",19:"evi",20:"iron-oxide",21:"ferrous-minerals",22:"clay-minerals",23:"wndwi",24:"bai",25:"nbr",26:"ndbi",27:"ndmi",28:"ndsi",29:"mndwi"},{useNumericKeys:!0});function Ye(e,t){if(!(0,$e.AB)(e))return e;const{equation:n,method:r}=t,i=t.bandIndexes.map((e=>e-1)),{pixels:s,mask:o}=e;let a;switch(r){case"gndvi":case"nbr":case"ndbi":case"ndvi":case"ndvi-re":case"ndsi":case"ndmi":case"mndwi":a=Qe(o,s[i[0]],s[i[1]]);break;case"ndwi":a=Qe(o,s[i[1]],s[i[0]]);break;case"sr":case"sr-re":case"iron-oxide":case"ferrous-minerals":case"clay-minerals":a=function(e,t,n){const r=n.length,i=new Float32Array(r);for(let s=0;s<r;s++)if(null==e||e[s]){const e=t[s],r=n[s];r&&(i[s]=e/r)}return[i]}(o,s[i[0]],s[i[1]]);break;case"ci-g":case"ci-re":a=function(e,t,n){const r=t.length,i=new Float32Array(r);for(let s=0;s<r;s++)if(null==e||e[s]){const e=t[s],r=n[s];r&&(i[s]=e/r-1)}return[i]}(o,s[i[0]],s[i[1]]);break;case"savi":a=function(e,t,n,r){const i=n.length,s=new Float32Array(i);for(let o=0;o<i;o++)if(null==e||e[o]){const e=n[o],i=t[o],a=i+e+r;a&&(s[o]=(i-e)/a*(1+r))}return[s]}(o,s[i[0]],s[i[1]],i[2]+1);break;case"tsavi":a=function(e,t,n,r,i,s){const o=n.length,a=new Float32Array(o),l=-i*r+s*(1+r*r);for(let s=0;s<o;s++)if(null==e||e[s]){const e=n[s],o=t[s],u=i*o+e+l;u&&(a[s]=r*(o-r*e-i)/u)}return[a]}(o,s[i[0]],s[i[1]],i[2]+1,i[3]+1,i[4]+1);break;case"msavi":a=function(e,t,n){const r=n.length,i=new Float32Array(r);for(let s=0;s<r;s++)if(null==e||e[s]){const e=n[s],r=t[s],o=2*r+1;i[s]=.5*(o-Math.sqrt(o*o-8*(r-e)))}return[i]}(o,s[i[0]],s[i[1]]);break;case"gemi":a=function(e,t,n){const r=n.length,i=new Float32Array(r);for(let s=0;s<r;s++)if(null==e||e[s]){const e=n[s],r=t[s];if(1!==e&&r+e+.5!==0){const t=(2*(r*r-e*e)+1.5*r+.5*e)/(r+e+.5);i[s]=t*(1-.25*t)-(e-.125)/(1-e)}}return[i]}(o,s[i[0]],s[i[1]]);break;case"pvi":a=function(e,t,n,r,i){const s=n.length,o=new Float32Array(s),a=1/Math.sqrt(1+r*r);for(let l=0;l<s;l++)if(null==e||e[l]){const e=n[l],s=t[l];o[l]=(s-r*e-i)*a}return[o]}(o,s[i[0]],s[i[1]],i[2]+1,i[3]+1);break;case"gvitm":a=function(e,t){const[n,r,i,s,o,a]=t,l=n.length,u=new Float32Array(l);for(let t=0;t<l;t++)(null==e||e[t])&&(u[t]=-.2848*n[t]-.2435*r[t]-.5436*i[t]+.7243*s[t]+.084*o[t]-.18*a[t]);return[u]}(o,[s[i[0]],s[i[1]],s[i[2]],s[i[3]],s[i[4]],s[i[5]]]);break;case"sultan":a=function(e,t){const[n,r,i,s,o]=t,a=n.length,l=new Float32Array(a),u=new Float32Array(a),c=new Float32Array(a);for(let t=0;t<a;t++)(null==e||e[t])&&(l[t]=o[t]?s[t]/o[t]*100:0,u[t]=n[t]?s[t]/n[t]*100:0,c[t]=i[t]?r[t]/i[t]*(s[t]/i[t])*100:0);return[l,u,c]}(o,[s[i[0]],s[i[1]],s[i[2]],s[i[3]],s[i[4]]]);break;case"vari":a=function(e,t){const[n,r,i]=t,s=n.length,o=new Float32Array(s);for(let t=0;t<s;t++)if(null==e||e[t])for(t=0;t<s;t++){const e=n[t],s=r[t],a=s+e-i[t];a&&(o[t]=(s-e)/a)}return[o]}(o,[s[i[0]],s[i[1]],s[i[2]]]);break;case"mtvi2":a=function(e,t){const[n,r,i]=t,s=n.length,o=new Float32Array(s);for(let t=0;t<s;t++)if(null==e||e[t])for(t=0;t<s;t++){const e=n[t],s=r[t],a=i[t],l=Math.sqrt((2*e+1)**2-(6*e-5*Math.sqrt(s))-.5);if(l){const n=1.5*(1.2*(e-a)-2.5*(s-a));o[t]=n/l}}return[o]}(o,[s[i[0]],s[i[1]],s[i[2]]]);break;case"rtvi-core":a=function(e,t){const[n,r,i]=t,s=n.length,o=new Float32Array(s);for(let t=0;t<s;t++)if(null==e||e[t])for(t=0;t<s;t++){const e=n[t],s=r[t],a=i[t];o[t]=100*(e-s)-10*(e-a)}return[o]}(o,[s[i[0]],s[i[1]],s[i[2]]]);break;case"evi":a=function(e,t){const[n,r,i]=t,s=n.length,o=new Float32Array(s);for(let t=0;t<s;t++)if(null==e||e[t])for(t=0;t<s;t++){const e=n[t],s=r[t],a=e+6*s-7.5*i[t]+1;a&&(o[t]=2.5*(e-s)/a)}return[o]}(o,[s[i[0]],s[i[1]],s[i[2]]]);break;case"wndwi":a=function(e,t,n=.5){const[r,i,s]=t,o=i.length,a=new Float32Array(o);for(let t=0;t<o;t++)if(null==e||e[t])for(t=0;t<o;t++){const e=r[t],o=i[t],l=s[t],u=e+n*o+(1-n)*l;u&&(a[t]=(e-n*o-(1-n)*l)/u)}return[a]}(o,[s[i[0]],s[i[1]],s[i[2]]],i[3]?i[3]+1:.5);break;case"bai":a=function(e,t,n){const r=n.length,i=new Float32Array(r);for(let s=0;s<r;s++)if(null==e||e[s])for(s=0;s<r;s++){const e=(.1-t[s])**2+(.06-n[s])**2;e&&(i[s]=1/e)}return[i]}(o,s[i[0]],s[i[1]]);break;case"custom":a=function(e,t,n){let r,{ops:i,nums:s}=function(e,t){(e=e.replaceAll(" ","")).startsWith("-")&&(e="0"+e),e.startsWith("+")&&(e=e.slice(1));const n=e.split(""),r=[],i=[];let s="";for(let e=0;e<n.length;e++){const o=n[e];Ge.has(o)?(s.length&&i.push(He(s,t)),r.push(o),s=""):s=s.concat(o)}return s.length&&i.push(He(s,t)),{ops:r,nums:i}}(n,t);if(0===i.length){const e=1===s.length?s[0]:t[0];if(e instanceof Float32Array)return[e];const n=new Float32Array(t[0].length);return"number"==typeof e?n.fill(e):n.set(e),[n]}for(;i.length>0;){const{numIndex:t,opIndex:n}=qe(i);if(r=We(e,i[n],s[t],s[t+1]),1===i.length)break;i=Je(i,n),s.splice(t,2,r)}return[r]}(o,s,n);break;default:return e}const{outputPixelType:l="f32"}=t,c=null!=l&&(0,u.zw)(l);let p;o?(p=new Uint8Array(e.width*e.height),p.set(o)):c&&(p=new Uint8Array(e.width*e.height).fill(255)),c&&(a=a.map((e=>{const t=g.A.createEmptyBand(l,e.length);return(0,u.yM)(e,p,l,t),t})));const h=new g.A({width:e.width,height:e.height,pixelType:l,pixels:a,mask:p});return h.updateStatistics(),h}function Xe(e){const t=new Float32Array(9);return t[3*e[0]]=1,t[3*e[1]+1]=1,t[3*e[2]+2]=1,t}function Qe(e,t,n){const r=n.length,i=new Float32Array(r);for(let s=0;s<r;s++)if(null==e||e[s]){const e=t[s],r=n[s],o=e+r;o&&(i[s]=(e-r)/o)}return[i]}var et;let tt=et=class extends h{constructor(){super(...arguments),this.method="custom"}clone(){return new et({method:this.method,bandIndexes:this.bandIndexes,raster:(0,s.o8)(this.raster)})}};(0,o._)([(0,a.MZ)({json:{type:String,write:!0}})],tt.prototype,"bandIndexes",void 0),(0,o._)([(0,Ue.e)(Ke)],tt.prototype,"method",void 0),tt=et=(0,o._)([(0,l.$)("esri.layers.support.rasterFunctions.BandArithmeticFunctionArguments")],tt);const nt=tt,rt=new Set(["vari","mtvi2","rtvi-core","evi"]);let it=class extends x{constructor(){super(...arguments),this.functionName="BandArithmetic",this.functionArguments=null,this.rasterArgumentNames=["raster"]}_bindSourceRasters(){this.outputPixelType=this._getOutputPixelType("f32");const e=this.sourceRasterInfos[0];if(e.bandCount<2)return{success:!1,supportsGPU:!1,error:"band-arithmetic-function: source raster has insufficient amount of raster bands"};const t=e.clone();return t.pixelType=this.outputPixelType,t.bandCount="sultan"===this.functionArguments.method?3:1,this._removeStatsHistColormapVAT(t),t.keyProperties={...t.keyProperties,BandProperties:void 0},this.rasterInfo=t,{success:!0,supportsGPU:!["custom","gvitm","sultan"].includes(this.functionArguments.method)}}_processPixels(e){const t=e.pixelBlocks?.[0];if(null==t)return t;const{method:n,bandIndexes:r}=this.functionArguments,i=r.split(" ").map((e=>parseFloat(e)));return Ye(t,{method:n,bandIndexes:i,equation:r,outputPixelType:this.outputPixelType})}_getWebGLParameters(){const e=this.functionArguments.bandIndexes.split(" ").map((e=>parseFloat(e)-1));2===e.length&&e.push(0);const t=this.isInputBandIdsSwizzled?[0,1,2]:e;let n,r;const i=new Float32Array(3),{method:s}=this.functionArguments;switch(s){case"gndvi":case"nbr":case"ndbi":case"ndvi":case"ndvi-re":case"ndsi":case"ndmi":case"mndwi":n=Xe([t[0],t[1],0]),r="ndxi";break;case"ndwi":n=Xe([t[1],t[0],0]),r="ndxi";break;case"sr":case"sr-re":case"iron-oxide":case"ferrous-minerals":case"clay-minerals":n=Xe([t[0],t[1],0]),r="sr";break;case"ci-g":case"ci-re":n=Xe([t[0],t[1],0]),r="ci";break;case"savi":n=Xe([t[0],t[1],0]),r="savi",i[0]=e[2]+1;break;case"tsavi":n=Xe([t[0],t[1],0]),r="tsavi",i[0]=e[2]+1,i[1]=e[3]+1,i[2]=e[4]+1;break;case"msavi":n=Xe([t[0],t[1],0]),r="msavi";break;case"gemi":n=Xe([t[0],t[1],0]),r="gemi";break;case"pvi":n=Xe([t[0],t[1],0]),r="tsavi",i[0]=e[2]+1,i[1]=e[3]+1;break;case"vari":n=Xe([t[0],t[1],t[2]]),r="vari";break;case"mtvi2":n=Xe([t[0],t[1],t[2]]),r="mtvi";break;case"rtvi-core":n=Xe([t[0],t[1],t[2]]),r="rtvicore";break;case"evi":n=Xe([t[0],t[1],t[2]]),r="evi";break;case"wndwi":n=Xe([t[0],t[1],0]),r="wndwi",i[0]=e[3]?e[3]+1:.5;break;case"bai":n=Xe([t[1],t[0],0]),r="bai";break;default:n=Xe([0,1,2]),r="custom"}return{bandIndexMat3:n,indexType:r,adjustments:i,isOutputRounded:(0,u.zw)(this.outputPixelType)}}_getInputBandIds(e){if("custom"===this.functionArguments.method)return e;const t=this.functionArguments.bandIndexes.split(" ").map((e=>parseFloat(e)-1)),n=e.length,r=t.map((e=>e>=n?n-1:e)),i=rt.has(this.functionArguments.method)?3:2,s=r.slice(0,i).map((t=>e[t]));return 2===s.length&&s.push(0),s}};(0,o._)([(0,a.MZ)({json:{write:!0,name:"rasterFunction"}})],it.prototype,"functionName",void 0),(0,o._)([(0,a.MZ)({type:nt,json:{write:!0,name:"rasterFunctionArguments"}})],it.prototype,"functionArguments",void 0),(0,o._)([(0,a.MZ)()],it.prototype,"rasterArgumentNames",void 0),it=(0,o._)([(0,l.$)("esri.layers.support.rasterFunctions.BandArithmeticFunction")],it);const st=it;var ot,at=n(50917),lt=n(74697);const ut=new Ve.J({1:"outside",2:"inside"},{useNumericKeys:!0});let ct=ot=class extends h{constructor(){super(...arguments),this.clippingType="outside"}clone(){return new ot({clippingGeometry:this.clippingGeometry.clone(),clippingType:this.clippingType})}};(0,o._)([(0,a.MZ)({types:at.yR,json:{read:lt.rS,write:!0}})],ct.prototype,"clippingGeometry",void 0),(0,o._)([(0,a.MZ)({json:{read:ut.read,write:ut.write}})],ct.prototype,"clippingType",void 0),ct=ot=(0,o._)([(0,l.$)("esri.layers.support.rasterFunctions.ClipFunctionArguments")],ct);const pt=ct;var ht=n(67090),ft=n(80221);let dt=class extends x{constructor(){super(...arguments),this.functionName="Clip",this.functionArguments=null,this.rasterArgumentNames=["raster"],this.isNoopProcess=!0}_bindSourceRasters(){const e=this.sourceRasterInfos[0].clone();this.outputPixelType=this._getOutputPixelType(e.pixelType),e.pixelType=this.outputPixelType,this.rasterInfo=e;const{functionArguments:t}=this,{clippingGeometry:n,clippingType:r}=t;if(!n)return{success:!1,supportsGPU:!1,error:"missing clipping geometry"};if("outside"===r)try{const{spatialReference:t}=e,r="extent"===n.type?(0,ft._l)(n,t):(0,ft.uk)(n,t).extent;r&&(0,ht.Sd)(e,r)}catch{}return{success:!0,supportsGPU:!0}}_processPixels(e){return e.pixelBlocks?.[0]}_getWebGLParameters(){const{clippingGeometry:e,clippingType:t}=this.functionArguments;return{clippingGeometry:e.toJSON(),clippingType:t}}};(0,o._)([(0,a.MZ)({json:{write:!0,name:"rasterFunction"}})],dt.prototype,"functionName",void 0),(0,o._)([(0,a.MZ)({type:pt,json:{write:!0,name:"rasterFunctionArguments"}})],dt.prototype,"functionArguments",void 0),(0,o._)([(0,a.MZ)()],dt.prototype,"rasterArgumentNames",void 0),(0,o._)([(0,a.MZ)()],dt.prototype,"isNoopProcess",void 0),dt=(0,o._)([(0,l.$)("esri.layers.support.rasterFunctions.ClipFunction")],dt);const mt=dt;var yt,gt=n(47332),wt=n(3212),bt=n(85982);let vt=yt=class extends h{castColormapName(e){if(!e)return null;const t=e.toLowerCase();return wt.L7.includes(t)?t:null}readColorRamp(e){return(0,bt.r)(e)}readColorRampName(e,t){if(!e)return null;const n=wt.kH.jsonValues.find((t=>t.toLowerCase()===e.toLowerCase()));return n?wt.kH.fromJSON(n):null}clone(){return new yt({colormap:(0,s.o8)(this.colormap),colormapName:this.colormapName,colorRamp:this.colorRamp?.clone(),colorRampName:this.colorRampName})}};(0,o._)([(0,a.MZ)({type:[[Number]],json:{write:!0}})],vt.prototype,"colormap",void 0),(0,o._)([(0,a.MZ)({type:String,json:{write:!0}})],vt.prototype,"colormapName",void 0),(0,o._)([(0,y.w)("colormapName")],vt.prototype,"castColormapName",null),(0,o._)([(0,a.MZ)({types:bt.g,json:{write:!0}})],vt.prototype,"colorRamp",void 0),(0,o._)([(0,gt.w)("colorRamp")],vt.prototype,"readColorRamp",null),(0,o._)([(0,a.MZ)({type:wt.kH.apiValues,json:{type:wt.kH.jsonValues,write:wt.kH.write}})],vt.prototype,"colorRampName",void 0),(0,o._)([(0,gt.w)("colorRampName")],vt.prototype,"readColorRampName",null),vt=yt=(0,o._)([(0,l.$)("esri.layers.support.rasterFunctions.ColormapFunctionArguments")],vt);const xt=vt,Mt=[[36,0,255],[36,0,255],[36,0,255],[36,0,255],[112,75,3],[113,76,3],[114,77,3],[115,77,3],[116,78,3],[117,79,3],[118,79,3],[119,80,3],[121,81,4],[122,82,4],[123,82,4],[124,83,4],[125,84,4],[126,84,4],[127,85,4],[128,86,4],[129,86,4],[130,87,4],[131,88,4],[132,89,4],[133,89,4],[134,90,4],[135,91,4],[136,91,4],[137,92,4],[138,93,4],[139,94,4],[140,94,4],[142,95,5],[143,96,5],[144,96,5],[145,97,5],[146,98,5],[147,99,5],[148,99,5],[149,100,5],[150,101,5],[151,101,5],[152,102,5],[153,103,5],[154,104,5],[155,104,5],[156,105,5],[157,106,5],[158,106,5],[159,107,5],[160,108,5],[161,108,5],[162,109,5],[164,110,6],[165,111,6],[166,111,6],[167,112,6],[168,113,6],[169,113,6],[170,114,6],[171,115,6],[172,116,6],[173,116,6],[174,117,6],[245,0,0],[245,5,0],[245,10,0],[246,15,0],[246,20,0],[246,25,0],[246,30,0],[247,35,0],[247,40,0],[247,45,0],[247,50,0],[247,55,0],[248,60,0],[248,65,0],[248,70,0],[248,75,0],[249,81,0],[249,86,0],[249,91,0],[249,96,0],[250,101,0],[250,106,0],[250,111,0],[250,116,0],[250,121,0],[251,126,0],[251,131,0],[251,136,0],[251,141,0],[252,146,0],[252,151,0],[252,156,0],[252,156,0],[251,159,0],[250,162,0],[249,165,0],[248,168,0],[247,171,0],[246,174,0],[245,177,0],[245,179,0],[244,182,0],[243,185,0],[242,188,0],[241,191,0],[240,194,0],[239,197,0],[238,200,0],[237,203,0],[236,206,0],[235,209,0],[234,212,0],[233,215,0],[232,218,0],[231,221,0],[230,224,0],[230,226,0],[229,229,0],[228,232,0],[227,235,0],[226,238,0],[225,241,0],[224,244,0],[223,247,0],[165,247,0],[163,244,0],[161,240,0],[158,237,0],[156,233,1],[154,230,1],[152,227,1],[149,223,1],[147,220,1],[145,216,1],[143,213,1],[140,210,2],[138,206,2],[136,203,2],[134,200,2],[132,196,2],[129,193,2],[127,189,2],[125,186,3],[123,183,3],[120,179,3],[118,176,3],[116,172,3],[114,169,3],[111,166,3],[109,162,4],[107,159,4],[105,155,4],[103,152,4],[100,149,4],[98,145,4],[96,142,4],[94,138,5],[91,135,5],[89,132,5],[87,128,5],[85,125,5],[82,121,5],[80,118,5],[78,115,6],[76,111,6],[73,108,6],[71,105,6],[69,101,6],[67,98,6],[65,94,6],[62,91,7],[60,88,7],[58,84,7],[56,81,7],[53,77,7],[51,74,7],[49,71,7],[47,67,8],[44,64,8],[42,60,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8]],At=[[36,0,255],[36,0,255],[36,0,255],[36,0,255],[245,20,0],[245,24,0],[245,29,0],[245,31,0],[247,33,0],[247,33,0],[247,37,0],[247,41,0],[247,41,0],[247,41,0],[247,45,0],[247,45,0],[247,47,0],[247,49,0],[247,49,0],[247,54,0],[247,54,0],[247,56,0],[247,58,0],[247,58,0],[250,62,0],[250,62,0],[250,62,0],[250,67,0],[250,67,0],[250,67,0],[250,69,0],[250,71,0],[250,71,0],[250,75,0],[250,75,0],[250,78,0],[250,79,0],[250,79,0],[250,79,0],[250,81,0],[250,83,0],[250,83,0],[250,87,0],[250,87,0],[250,90,0],[250,92,0],[252,93,0],[252,93,0],[252,97,0],[252,97,0],[252,97,0],[252,97,0],[252,101,0],[252,101,0],[252,101,0],[252,101,0],[252,105,0],[252,105,0],[252,107,0],[252,109,0],[252,109,0],[252,113,13],[255,118,20],[255,119,23],[255,121,25],[255,126,33],[255,132,38],[255,133,40],[255,135,43],[255,141,48],[255,144,54],[255,150,59],[255,152,61],[255,153,64],[255,159,69],[255,163,77],[255,165,79],[255,168,82],[255,174,87],[255,176,92],[255,181,97],[255,183,99],[255,186,102],[255,191,107],[255,197,115],[255,201,120],[255,203,123],[255,205,125],[255,209,130],[255,214,138],[255,216,141],[255,218,143],[255,224,150],[255,228,156],[255,234,163],[255,236,165],[255,238,168],[255,243,173],[255,248,181],[255,252,186],[253,252,186],[250,252,187],[244,250,180],[238,247,176],[234,246,173],[231,245,169],[223,240,163],[217,237,157],[211,235,150],[205,233,146],[200,230,142],[195,227,136],[189,224,132],[184,222,126],[180,220,123],[174,217,119],[169,214,114],[163,212,108],[160,210,105],[154,207,101],[148,204,96],[143,201,93],[138,199,88],[134,197,84],[130,194,81],[126,191,77],[117,189,70],[115,186,68],[112,184,64],[106,181,60],[100,179,55],[94,176,49],[92,174,47],[90,173,45],[81,168,37],[75,166,33],[71,163,28],[66,160,24],[62,158,21],[56,156,14],[51,153,0],[51,153,0],[51,153,0],[50,150,0],[50,150,0],[50,150,0],[50,150,0],[49,148,0],[49,148,0],[49,148,0],[48,145,0],[48,145,0],[48,145,0],[48,145,0],[48,143,0],[48,143,0],[48,143,0],[48,143,0],[47,140,0],[47,140,0],[47,140,0],[47,140,0],[46,138,0],[46,138,0],[46,138,0],[46,138,0],[45,135,0],[45,135,0],[45,135,0],[45,135,0],[44,133,0],[44,133,0],[44,133,0],[43,130,0],[43,130,0],[43,130,0],[43,130,0],[43,130,0],[43,130,0],[42,128,0],[42,128,0],[42,128,0],[42,125,0],[42,125,0],[42,125,0],[42,125,0],[41,122,0],[41,122,0],[41,122,0],[41,122,0],[40,120,0],[40,120,0],[40,120,0],[40,120,0],[40,120,0],[39,117,0],[39,117,0],[39,117,0],[39,117,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0]];function It(e,t){const n=[],r=[];for(let t=0;t<e.length-1;t++)n.push({type:"algorithmic",algorithm:"esriHSVAlgorithm",fromColor:e[t].slice(1),toColor:e[t+1].slice(1)}),r.push(e[t+1][0]-e[t][0]);const i=e[e.length-1][0];return(0,wt.iv)({type:"multipart",colorRamps:n},{numColors:i,weights:t=t??r})}let St=class extends x{constructor(){super(...arguments),this.functionName="Colormap",this.functionArguments=null,this.rasterArgumentNames=["raster"],this.isNoopProcess=!0}_bindSourceRasters(){const e=this.sourceRasterInfos[0];if(e.bandCount>1)return{success:!1,supportsGPU:!1,error:"colormap-function: source data must be single band"};let{colormap:t,colormapName:n,colorRamp:r,colorRampName:i}=this.functionArguments;if(!t?.length)if(r)this.colorRamp=r,t=(0,wt.R8)(r,{interpolateAlpha:!0});else if(i){const e=(0,wt.M5)(i);e&&(t=(0,wt.R8)(e),this.colorRamp=(0,bt.r)(e))}else n&&(t=function(e){let t;switch(e){case"elevation":t=It([[0,0,191,191],[51,0,0,255],[102,255,0,255],[153,255,0,127],[204,191,63,127],[256,20,20,20]]);break;case"gray":t=(0,wt.iv)({type:"algorithmic",algorithm:"esriHSVAlgorithm",fromColor:[0,0,0],toColor:[255,255,255]});break;case"hillshade":t=It([[0,38,41,54],[69,79,82,90],[131,156,156,156],[256,253,253,241]],[.268,.238,.495]);break;case"ndvi":t=Mt;break;case"ndvi2":t=function(){const e=It([[0,255,255,255],[70,0,255,0],[80,205,173,193],[100,150,150,150],[110,120,51,100],[130,120,100,200],[140,28,3,144],[160,6,0,55],[180,10,25,30],[201,6,7,27]]);for(let t=e.length;t<256;t++)e.push([6,27,7]);return e}();break;case"ndvi3":t=At;break;case"random":t=function(){const e=[];for(let t=0;t<256;t++){const t=[];for(let e=0;e<3;e++)t.push(Math.round(255*Math.random()));e.push(t)}return e}()}return t?(t=t.map(((e,t)=>[t,...e])),t):null}(n));if(!t?.length)return{success:!1,supportsGPU:!1,error:"colormap-function: missing colormap argument"};const s=this._getOutputPixelType(e.pixelType);this.outputPixelType=s.startsWith("f")?"s32":s;const o=e.clone();return o.pixelType=this.outputPixelType,o.colormap=t,o.bandCount=1,this.rasterInfo=o,{success:!0,supportsGPU:!0}}_processPixels(e){let t=e.pixelBlocks?.[0];return!t||(0,u.zw)(t.pixelType)||(t=t.clone(),t.clamp(this.outputPixelType)),t}};(0,o._)([(0,a.MZ)({json:{write:!0,name:"rasterFunction"}})],St.prototype,"functionName",void 0),(0,o._)([(0,a.MZ)({type:xt,json:{write:!0,name:"rasterFunctionArguments"}})],St.prototype,"functionArguments",void 0),(0,o._)([(0,a.MZ)()],St.prototype,"rasterArgumentNames",void 0),(0,o._)([(0,a.MZ)()],St.prototype,"isNoopProcess",void 0),(0,o._)([(0,a.MZ)({json:{write:!0}})],St.prototype,"indexedColormap",void 0),(0,o._)([(0,a.MZ)()],St.prototype,"colorRamp",void 0),St=(0,o._)([(0,l.$)("esri.layers.support.rasterFunctions.ColormapFunction")],St);const _t=St;var Ct,Tt=n(42568);let kt=Ct=class extends h{clone(){return new Ct({raster:this.raster})}};kt=Ct=(0,o._)([(0,l.$)("esri.layers.support.rasterFunctions.ColormapToRGBFunctionArguments")],kt);const Rt=kt;var Pt=n(9059);let Nt=class extends x{constructor(){super(...arguments),this.functionName="ColormapToRGB",this.functionArguments=null,this.rasterArgumentNames=["raster"]}_bindSourceRasters(){const e=this.sourceRasterInfos[0];if(e.bandCount>1||!e.colormap?.length)return{success:!1,supportsGPU:!1,error:"colormap-to-rgb-function: source data must be single band with a colormap"};const t=e.clone();t.pixelType=this.outputPixelType=this._getOutputPixelType("u8"),this._removeStatsHistColormapVAT(t),t.bandCount=3,t.statistics=[{min:0,max:255,avg:100,stddev:20},{min:0,max:255,avg:100,stddev:20},{min:0,max:255,avg:100,stddev:20}],this.rasterInfo=t;const n=[...e.colormap].sort(((e,t)=>e[0]-t[0])),{indexedColormap:r,offset:i}=(0,$e.zg)({colormap:n});return r?(this.lookup={indexedColormap:r,offset:i},{success:!0,supportsGPU:(0,Pt.WN)(r)}):{success:!1,supportsGPU:!1,error:"colormap-to-rgb-function: the colormap is not supported"}}_processPixels(e){let t=e.pixelBlocks?.[0];if(!t||!this.lookup)return t;t=t.clone();const n=t.pixels[0],r=t.mask??new Uint8Array(n.length).fill(255),i=new Uint8Array(n.length),s=new Uint8Array(n.length),o=new Uint8Array(n.length),{indexedColormap:a,offset:l}=this.lookup,u=a.length;for(let e=0;e<n.length;e++)if(r[e]){let t=4*(n[e]-l);t<0||t>u-4?r[e]=0:(i[e]=a[t++],s[e]=a[t++],o[e]=a[t++])}return t.pixels=[i,s,o],t.statistics=[new Tt.z(0,255),new Tt.z(0,255),new Tt.z(0,255)],t.pixelType=this.outputPixelType,t}_getWebGLParameters(){return this.lookup}};(0,o._)([(0,a.MZ)({json:{write:!0,name:"rasterFunction"}})],Nt.prototype,"functionName",void 0),(0,o._)([(0,a.MZ)({type:Rt,json:{write:!0,name:"rasterFunctionArguments"}})],Nt.prototype,"functionArguments",void 0),(0,o._)([(0,a.MZ)()],Nt.prototype,"rasterArgumentNames",void 0),(0,o._)([(0,a.MZ)({json:{write:!0}})],Nt.prototype,"lookup",void 0),Nt=(0,o._)([(0,l.$)("esri.layers.support.rasterFunctions.ColormapToRGBFunction")],Nt);const Dt=Nt;var Et,Lt=n(81392);let Ft=Et=class extends h{constructor(){super(...arguments),this.rasters=[]}writeRasters(e,t){t.rasters=e.map((e=>"number"==typeof e||"string"==typeof e?e:e.toJSON()))}clone(){return new Et({rasters:(0,s.o8)(this.rasters)})}};(0,o._)([(0,a.MZ)({json:{write:!0}})],Ft.prototype,"rasters",void 0),(0,o._)([(0,Lt.K)("rasters")],Ft.prototype,"writeRasters",null),Ft=Et=(0,o._)([(0,l.$)("esri.layers.support.rasterFunctions.CompositeBandFunctionArguments")],Ft);const Ot=Ft;let zt=class extends x{constructor(){super(...arguments),this.functionName="CompositeBand",this.functionArguments=null,this.rasterArgumentNames=["rasters"]}_bindSourceRasters(){const{sourceRasterInfos:e}=this,t=e[0];this.outputPixelType=this._getOutputPixelType(t.pixelType);const n=t.clone();if(n.attributeTable=null,n.colormap=null,n.pixelType=this.outputPixelType,n.bandCount=e.map((({bandCount:e})=>e)).reduce(((e,t)=>e+t)),e.every((({statistics:e})=>null!=e&&e.length))){const t=[];e.forEach((({statistics:e})=>null!=e&&t.push(...e))),n.statistics=t}if(e.every((({histograms:e})=>null!=e&&e.length))){const t=[];e.forEach((({histograms:e})=>null!=e&&t.push(...e))),n.histograms=t}n.multidimensionalInfo&&n.multidimensionalInfo.variables.forEach((t=>{const n=e.map((e=>e.multidimensionalInfo?.variables.find((({name:e})=>e===t.name)))),r=n.map((e=>e?.statistics?.length?e.statistics:null)),i=n.map((e=>e?.histograms?.length?e.histograms:null));t.statistics=r.every((e=>null!=e))?r.flat():null,t.histograms=i.every((e=>null!=e))?i.flat():null})),n.bandCount>1&&(n.colormap=null,n.attributeTable=null);const r=e.every((e=>e.keyProperties.BandProperties?.length))?e.flatMap((e=>e.keyProperties.BandProperties)):void 0;return n.keyProperties={...n.keyProperties,BandProperties:r},this.rasterInfo=n,{success:!0,supportsGPU:n.bandCount<=3}}_processPixels(e){const{pixelBlocks:t}=e;if(!t)return null;const n=t?.[0];return null==n?null:(0,$e.Wy)(t)}_getWebGLParameters(){return{bandCount:this.rasterInfo.bandCount}}};(0,o._)([(0,a.MZ)({json:{write:!0,name:"rasterFunction"}})],zt.prototype,"functionName",void 0),(0,o._)([(0,a.MZ)({type:Ot,json:{write:!0,name:"rasterFunctionArguments"}})],zt.prototype,"functionArguments",void 0),(0,o._)([(0,a.MZ)()],zt.prototype,"rasterArgumentNames",void 0),zt=(0,o._)([(0,l.$)("esri.layers.support.rasterFunctions.CompositeBandFunction")],zt);const jt=zt;var Bt=n(56740);const Zt=new Ve.J({0:"difference",1:"relative-difference",2:"categorical",3:"euclidean-distance",4:"angle-difference",5:"band-with-most-change"},{useNumericKeys:!0}),Ut=new Ve.J({0:"all",1:"changed",2:"unchanged"},{useNumericKeys:!0});var Vt;let Gt=Vt=class extends h{constructor(){super(...arguments),this.method="difference",this.keepMethod="all",this.raster2=void 0}get rasters(){return[this.raster,this.raster2]}clone(){return new Vt({raster:this.raster,raster2:this.raster2,method:this.method,keepMethod:this.keepMethod})}};(0,o._)([(0,Ue.e)(Zt)],Gt.prototype,"method",void 0),(0,o._)([(0,Ue.e)(Ut)],Gt.prototype,"keepMethod",void 0),(0,o._)([(0,a.MZ)({json:{write:!0}})],Gt.prototype,"raster2",void 0),(0,o._)([(0,a.MZ)({readOnly:!0})],Gt.prototype,"rasters",null),Gt=Vt=(0,o._)([(0,l.$)("esri.layers.support.rasterFunctions.ComputeChangeFunctionArguments")],Gt);const Ht=Gt;let Wt=class extends x{constructor(){super(...arguments),this.functionName="ComputeChange",this.functionArguments=null,this.rasterArgumentNames=["raster","raster2"]}_bindSourceRasters(){const{method:e}=this.functionArguments,t=this.sourceRasterInfos[0].clone();if(this.outputPixelType=this._getOutputPixelType(t.pixelType),t.pixelType=this.outputPixelType,this._removeStatsHistColormapVAT(t),"categorical"===e){const e=this.sourceRasterInfos.map((e=>e.attributeTable)),n=this._getFieldNames(e,"value"),r=e.map((e=>this._getClassFieldName(e)));if(null==n[0]||null==n[1]||null==r[0]||null==r[1])return{success:!1,supportsGPU:!1,error:"both inputs must have proper attribute table with value and class fields"};this._updateAttributeTable(t,n,r)}return t.bandCount=1,this.rasterInfo=t,{success:!0,supportsGPU:"difference"===e||"relative-difference"===e}}_processPixels(e){const{pixelBlocks:t}=e;if(null==t?.[0]||null==t?.[1])return null;const{method:n}=this.functionArguments;return function(e,t,n,r){const[i,s]=e,o=(0,u.zw)(n)&&!(0,u.zw)(i.pixelType)&&!(0,u.zw)(s.pixelType),a=[i.mask,s.mask].filter((e=>e)),l=g.A.combineBandMasks(a),c=e.map((e=>e.pixels[0])),{width:p,height:h}=i,f=g.A.createEmptyBand(n,p*h);switch(t){case"difference":case"relative-difference":!function(e){const{bands:[t,n],mask:r,isRelative:i,isRoundingNeeded:s,outBand:o}=e,a=t.length;for(let e=0;e<a;e++)if(!r||r[e]){let r=t[e]-n[e];if(i){const i=Math.max(Math.abs(t[e])-Math.abs(n[e]));r=i>0?r/i:0}o[e]=s?Math.round(r):r}}({bands:c,mask:l,outBand:f,isRoundingNeeded:o,isRelative:"relative-difference"===t});break;case"categorical":!function(e){const{bands:[t,n],categoryIndexLookups:[r,i],classNames:[s,o],mask:a,keepMethod:l,outBand:u}=e,c=t.length,p=s.length,h=o.length,f=p*h,d=f+1,m=f+2;for(let e=0;e<c;e++)if(!a||a[e]){const a=t[e],c=n[e],p=r[a],y=i[c],g=s[p],w=o[y];u[e]=null==p||null==y?f:"changed"===l&&g===w?d:"unchanged"===l&&g!==w?m:p*h+y}}({bands:c,mask:l,outBand:f,...r});break;case"euclidean-distance":!function(e){const{pixels:[t,n],mask:r,outBand:i}=e,s=t[0].length,o=t.length;for(let e=0;e<s;e++)if(!r||r[e]){let r=0;for(let i=0;i<o;i++){const s=t[i][e]-n[i][e];r+=s*s}i[e]=Math.sqrt(r)}}({pixels:e.map((e=>e.pixels)),mask:l,outBand:f});break;case"angle-difference":!function(e){const{pixels:[t,n],mask:r,outBand:i}=e,s=t[0].length,o=t.length;for(let e=0;e<s;e++)if(!r||r[e]){let r=0,s=0,a=0;for(let i=0;i<o;i++){const o=t[i][e],l=n[i][e];r+=o*l,s+=o*o,a+=l*l}const l=Math.sqrt(s*a);i[e]=l?Math.acos(r/l):1.5707963267948966}}({pixels:e.map((e=>e.pixels)),mask:l,outBand:f});break;case"band-with-most-change":!function(e){const{pixels:[t,n],mask:r,outBand:i}=e,s=t[0].length,o=t.length;for(let e=0;e<s;e++)if(!r||r[e]){let r=0,s=0;for(let i=0;i<o;i++){const o=Math.abs(t[i][e]-n[i][e]);o>r&&(r=o,s=i)}i[e]=s}}({pixels:e.map((e=>e.pixels)),mask:l,outBand:f})}const d=new g.A({width:p,height:h,pixels:[f],pixelType:n,mask:l});return d.updateStatistics(),d}(t,n,this.outputPixelType,this._categoryConfig)}_getWebGLParameters(){const e=this.outputPixelType??"f32";let[t,n]=(0,u.hP)(e);const r=(0,u.zw)(e);return r&&(t-=1e-4,n+=1e-4),{method:this.functionArguments.method,domainRange:[t,n],isOutputRounded:r}}_updateAttributeTable(e,t,n){const r=this.sourceRasterInfos.map((e=>e.attributeTable)),i=r.map(((e,n)=>e.features.map((e=>e.attributes[t[n]])))),s=r.map(((e,t)=>e.features.map((e=>e.attributes[n[t]])))),o=i.map((e=>{const t=[];return e.forEach(((e,n)=>t[e]=n)),t})),{keepMethod:a}=this.functionArguments;this._categoryConfig={categoryIndexLookups:o,classNames:s,keepMethod:a};const l=r[0].clone();l.fields=[new Bt.A({name:"OID",type:"oid"}),new Bt.A({name:"Value",type:"integer"}),new Bt.A({name:"ClassName",type:"string"}),new Bt.A({name:"Class_From",type:"string"}),new Bt.A({name:"Class_To",type:"string"})];const u=this._getFieldNames(r,"red"),c=this._getFieldNames(r,"green"),p=this._getFieldNames(r,"blue"),h=[],f=2===u.length&&2===c.length&&2===p.length;f&&(h.push(...r.map(((e,t)=>e.features.map((e=>[e.attributes[u[t]],e.attributes[c[t]],e.attributes[p[t]]]))))),l.fields.push(new Bt.A({name:"Red",type:"integer"}),new Bt.A({name:"Green",type:"integer"}),new Bt.A({name:"Blue",type:"integer"})));const d=l.features[0].clone();d.geometry=null;const m=[],[y,g]=i.map((e=>e.length));let w=1;for(let e=0;e<y;e++){const t=s[0][e];for(let n=0;n<g;n++){const r=s[1][n];if("changed"===a&&t===r||"unchanged"===a&&t!==r)continue;const i=d.clone();i.attributes={OID:w++,Value:e*g+n,ClassName:t===r?t:`${t} -> ${r}`,Class_From:t,Class_To:r},f&&(i.attributes.Red=h[0][e][0]+h[1][n][0]>>1,i.attributes.Green=h[0][e][1]+h[1][n][1]>>1,i.attributes.Blue=h[0][e][2]+h[1][n][2]>>1),m.push(i)}}if("changed"===a){const e=d.clone();e.attributes={OID:w++,Value:y*g+1,ClassName:"No Change",Class_From:"Same",Class_To:"Same"},m.push(e)}else if("unchanged"===a){const e=d.clone();e.attributes={OID:w++,Value:y*g+2,ClassName:"Changed",Class_From:"Any",Class_To:"Any"},m.push(e)}l.features=m,e.attributeTable=l}_getFieldNames(e,t){return e.map((({fields:e})=>e.find((e=>e.name.toLowerCase()===t))?.name)).filter((e=>e))}_getClassFieldName(e){const t=e.fields.find((e=>"string"===e.type&&e.name.toLowerCase().startsWith("class")))??e.fields.find((e=>"string"===e.type&&e.name.toLowerCase().includes("class")||e.name.toLowerCase().includes("type")||e.name.toLowerCase().includes("name")))??e.fields.find((e=>"string"===e.type));return t?.name}};(0,o._)([(0,a.MZ)({json:{write:!0,name:"rasterFunction"}})],Wt.prototype,"functionName",void 0),(0,o._)([(0,a.MZ)({type:Ht,json:{write:!0,name:"rasterFunctionArguments"}})],Wt.prototype,"functionArguments",void 0),(0,o._)([(0,a.MZ)()],Wt.prototype,"rasterArgumentNames",void 0),(0,o._)([(0,a.MZ)({json:{write:!0}})],Wt.prototype,"_categoryConfig",void 0),Wt=(0,o._)([(0,l.$)("esri.layers.support.rasterFunctions.ComputeChangeFunction")],Wt);const Jt=Wt;var qt;let $t=qt=class extends h{constructor(){super(...arguments),this.contrastOffset=0,this.brightnessOffset=0}clone(){return new qt({contrastOffset:this.contrastOffset,brightnessOffset:this.brightnessOffset,raster:this.raster})}};(0,o._)([(0,a.MZ)({json:{write:!0}})],$t.prototype,"contrastOffset",void 0),(0,o._)([(0,a.MZ)({json:{write:!0}})],$t.prototype,"brightnessOffset",void 0),$t=qt=(0,o._)([(0,l.$)("esri.layers.support.rasterFunctions.ContrastBrightnessFunctionArguments")],$t);const Kt=$t;var Yt=n(72567);let Xt=class extends x{constructor(){super(...arguments),this.functionName="ContrastBrightness",this.functionArguments=null,this.rasterArgumentNames=["raster"],this.lookup=null}_bindSourceRasters(){const{sourceRasterInfos:e}=this,t=e[0];if("u8"!==t.pixelType)return{success:!1,supportsGPU:!1,error:"Only unsigned 8 bit raster is supported by ContrastBrightness function."};this.outputPixelType=this._getOutputPixelType("u8");const n=t.clone();this._removeStatsHistColormapVAT(n),this.rasterInfo=n;const{contrastOffset:r,brightnessOffset:i}=this.functionArguments;return this.lookup=(0,Yt.zj)(r,i),{success:!0,supportsGPU:!0}}_processPixels(e){const t=e.pixelBlocks?.[0];return null==t?null:(0,$e.eH)(t,{lut:t.pixels.map((()=>this.lookup)),offset:0,outputPixelType:"u8"})}_getWebGLParameters(){const{contrastOffset:e,brightnessOffset:t}=this.functionArguments;return{contrastOffset:e,brightnessOffset:t}}};(0,o._)([(0,a.MZ)({json:{write:!0,name:"rasterFunction"}})],Xt.prototype,"functionName",void 0),(0,o._)([(0,a.MZ)({type:Kt,json:{write:!0,name:"rasterFunctionArguments"}})],Xt.prototype,"functionArguments",void 0),(0,o._)([(0,a.MZ)()],Xt.prototype,"rasterArgumentNames",void 0),(0,o._)([(0,a.MZ)({json:{write:!0}})],Xt.prototype,"lookup",void 0),Xt=(0,o._)([(0,l.$)("esri.layers.support.rasterFunctions.ContrastBrightnessFunction")],Xt);const Qt=Xt;function en(e,t,n,r,i){const s=Math.floor(r/2);for(let r=0;r<s;r++)for(let s=0;s<t;s++)e[r*t+s]=e[(i-1-r)*t+s],e[(n-1-r)*t+s]=e[(n-i+r)*t+s];const o=Math.floor(i/2);for(let r=0;r<n;r++){const n=r*t;for(let r=0;r<o;r++)e[n+r]=e[n+i-1-r],e[n+t-r-1]=e[n+t+r-i]}}const tn=new Map;function nn(e,t,n,r,i,s,o){const a=new Float32Array(t*n),l=s.length,u=o?0:r,c=o?r:0,p=o?1:t;for(let o=u;o<n-u;o++){const n=o*t;for(let o=c;o<t-c;o++){if(i&&!i[n+o])continue;let t=0;for(let i=0;i<l;i++)t+=e[n+o+(i-r)*p]*s[i];a[n+o]=t}}return a}function rn(e,t,n,r,i,s,o){const a=new Float32Array(t*n),l=Math.floor(r/2),u=Math.floor(i/2);for(let c=l;c<n-l;c++){const n=c*t;for(let c=u;c<t-u;c++){if(s&&!s[n+c])continue;let p=0;for(let s=0;s<r;s++)for(let r=0;r<i;r++)p+=e[n+c+(s-l)*t+r-u]*o[s*i+r];a[n+c]=p}}return a}var sn;tn.set(M.none,[0,0,0,0,1,0,0,0,0]),tn.set(M.lineDetectionHorizontal,[-1,-1,-1,2,2,2,-1,-1,-1]),tn.set(M.lineDetectionVertical,[-1,2,-1,-1,2,-1,-1,2,-1]),tn.set(M.lineDetectionLeftDiagonal,[2,-1,-1,-1,2,-1,-1,-1,2]),tn.set(M.lineDetectionRightDiagonal,[-1,-1,2,-1,2,-1,2,-1,-1]),tn.set(M.gradientNorth,[-1,-2,-1,0,0,0,1,2,1]),tn.set(M.gradientWest,[-1,0,1,-2,0,2,-1,0,1]),tn.set(M.gradientEast,[1,0,-1,2,0,-2,1,0,-1]),tn.set(M.gradientSouth,[1,2,1,0,0,0,-1,-2,-1]),tn.set(M.gradientNorthEast,[0,-1,-2,1,0,-1,2,1,0]),tn.set(M.gradientNorthWest,[-2,-1,0,-1,0,1,0,1,2]),tn.set(M.smoothArithmeticMean,[.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111]),tn.set(M.smoothing3x3,[.0625,.125,.0625,.125,.25,.125,.0625,.125,.0625]),tn.set(M.smoothing5x5,[1,1,1,1,1,1,4,4,4,1,1,4,12,4,1,1,4,4,4,1,1,1,1,1,1]),tn.set(M.sharpening3x3,[-1,-1,-1,-1,9,-1,-1,-1,-1]),tn.set(M.sharpening5x5,[-1,-3,-4,-3,-1,-3,0,6,0,-3,-4,6,21,6,-4,-3,0,6,0,-3,-1,-3,-4,-3,-1]),tn.set(M.laplacian3x3,[0,-1,0,-1,4,-1,0,-1,0]),tn.set(M.laplacian5x5,[0,0,-1,0,0,0,-1,-2,-1,0,-1,-2,17,-2,-1,0,-1,-2,-1,0,0,0,-1,0,0]),tn.set(M.sobelHorizontal,[-1,-2,-1,0,0,0,1,2,1]),tn.set(M.sobelVertical,[-1,0,1,-2,0,2,-1,0,1]),tn.set(M.sharpen,[0,-.25,0,-.25,2,-.25,0,-.25,0]),tn.set(M.sharpen2,[-.25,-.25,-.25,-.25,3,-.25,-.25,-.25,-.25]),tn.set(M.pointSpread,[-.627,.352,-.627,.352,2.923,.352,-.627,.352,-.627]);let on=sn=class extends h{constructor(){super(...arguments),this.rows=3,this.cols=3,this.kernel=[0,0,0,0,1,0,0,0,0]}set convolutionType(e){this._set("convolutionType",e);const t=tn.get(e);if(!t||e===M.userDefined||e===M.none)return;const n=Math.sqrt(t.length);this._set("kernel",t),this._set("cols",n),this._set("rows",n)}clone(){return new sn({cols:this.cols,rows:this.rows,kernel:[...this.kernel],convolutionType:this.convolutionType,raster:(0,s.o8)(this.raster)})}};(0,o._)([(0,a.MZ)({json:{type:Number,write:!0}})],on.prototype,"rows",void 0),(0,o._)([(0,a.MZ)({json:{type:Number,write:!0}})],on.prototype,"cols",void 0),(0,o._)([(0,a.MZ)({json:{name:"type",type:Number,write:!0}})],on.prototype,"convolutionType",null),(0,o._)([(0,a.MZ)({json:{type:[Number],write:!0}})],on.prototype,"kernel",void 0),on=sn=(0,o._)([(0,l.$)("esri.layers.support.rasterFunctions.ConvolutionFunctionArguments")],on);const an=on;let ln=class extends x{constructor(){super(...arguments),this.functionName="Convolution",this.rasterArgumentNames=["raster"]}get _normalizedKernel(){const{kernel:e,convolutionType:t}=this.functionArguments,n=e.reduce(((e,t)=>e+t));return-1===t||0===n||1===n?e:e.map((e=>e/n))}_bindSourceRasters(){const{convolutionType:e,rows:t,cols:n,kernel:r}=this.functionArguments;if(!Object.values(M).includes(e))return{success:!1,supportsGPU:!1,error:`convolution-function: the specified kernel type is not supported ${e}`};if(e!==M.none&&t*n!==r.length)return{success:!1,supportsGPU:!1,error:"convolution-function: the specified rows and cols do not match the length of the kernel"};const i=this.sourceRasterInfos[0];this.outputPixelType=this._getOutputPixelType(i.pixelType);const s=i.clone();s.pixelType=this.outputPixelType;const o=[M.none,M.sharpen,M.sharpen2,M.sharpening3x3,M.sharpening5x5];return(-1===e||"u8"!==this.outputPixelType&&!o.includes(e))&&(s.statistics=null,s.histograms=null),s.colormap=null,s.attributeTable=null,this.rasterInfo=s,{success:!0,supportsGPU:r.length<=25}}_processPixels(e){const t=e.pixelBlocks?.[0];if(null==t||this.functionArguments.convolutionType===M.none)return t;const{rows:n,cols:r}=this.functionArguments,{_normalizedKernel:i}=this;return function(e,t){const n=function(e){const t=Math.sqrt(e.length),n=e.slice(0,t),r=[1];for(let n=1;n<t;n++){let i=null;for(let r=0;r<t;r++){const s=e[r+n*t],o=e[r];if(null==i)if(0===o){if(s)return{separable:!1,row:null,col:null}}else i=s/o;else if(s/o!==i)return{separable:!1,row:null,col:null}}if(null==i)return{separable:!1,row:null,col:null};r.push(i)}return{separable:!0,row:n,col:r}}(t.kernel),r=!1!==t.mirrorEdges,i=n.separable?function(e,t,n,r=!0){const{pixels:i,width:s,height:o,pixelType:a,mask:l}=e,u=i.length,c=[],p=t.length,h=n.length,f=Math.floor(p/2),d=Math.floor(h/2);for(let e=0;e<u;e++){let a=nn(i[e],s,o,f,l,t,!0);a=nn(a,s,o,d,l,n,!1),r&&en(a,s,o,p,h),c.push(a)}return new g.A({width:s,height:o,pixelType:a,pixels:c,mask:l})}(e,n.row,n.col,r):function(e,t,n=!0){const{pixels:r,width:i,height:s,pixelType:o,mask:a}=e,l=r.length,u=[],{kernel:c,rows:p,cols:h}=t;for(let e=0;e<l;e++){const t=rn(r[e],i,s,p,h,a,c);n&&en(t,i,s,p,h),u.push(t)}return new g.A({width:i,height:s,pixelType:o,pixels:u,mask:a})}(e,t,r),{outputPixelType:s}=t;return s&&i.clamp(s),i}(t,{kernel:i,rows:n,cols:r,outputPixelType:this.outputPixelType})}_getWebGLParameters(){const e=new Float32Array(25);return e.set(this._normalizedKernel),{kernelRows:this.functionArguments.rows,kernelCols:this.functionArguments.cols,kernel:e,clampRange:(0,u.hP)(this.outputPixelType)}}};(0,o._)([(0,a.MZ)({json:{write:!0,name:"rasterFunction"}})],ln.prototype,"functionName",void 0),(0,o._)([(0,a.MZ)({type:an,json:{write:!0,name:"rasterFunctionArguments"}})],ln.prototype,"functionArguments",void 0),(0,o._)([(0,a.MZ)()],ln.prototype,"rasterArgumentNames",void 0),(0,o._)([(0,a.MZ)()],ln.prototype,"_normalizedKernel",null),ln=(0,o._)([(0,l.$)("esri.layers.support.rasterFunctions.ConvolutionFunction")],ln);const un=ln;var cn;const pn=new Ve.J({0:"standard",1:"planform",2:"profile"},{useNumericKeys:!0});let hn=cn=class extends h{constructor(){super(...arguments),this.curvatureType="standard",this.zFactor=1}readCurvatureType(e,t){return pn.fromJSON(t.type??t.curvatureType??0)}clone(){return new cn({curvatureType:this.curvatureType,zFactor:this.zFactor,raster:this.raster})}};(0,o._)([(0,a.MZ)({json:{write:{target:"type"}}}),(0,Ue.e)(pn)],hn.prototype,"curvatureType",void 0),(0,o._)([(0,gt.w)("curvatureType",["type","curvatureType"])],hn.prototype,"readCurvatureType",null),(0,o._)([(0,a.MZ)({type:Number,json:{write:!0}})],hn.prototype,"zFactor",void 0),hn=cn=(0,o._)([(0,l.$)("esri.layers.support.rasterFunctions.CurvatureFunctionArguments")],hn);const fn=hn;let dn=class extends x{constructor(){super(...arguments),this.functionName="Curvature",this.functionArguments=null,this.rasterArgumentNames=["raster"],this.isGCS=!1}_bindSourceRasters(){this.outputPixelType=this._getOutputPixelType("f32");const e=this.sourceRasterInfos[0].clone();return e.pixelType=this.outputPixelType,e.bandCount=1,this._removeStatsHistColormapVAT(e),this.rasterInfo=e,this.isGCS=e.spatialReference?.isGeographic??!1,{success:!0,supportsGPU:!0}}_processPixels(e){const t=e.pixelBlocks?.[0];if(null==t)return null;const{zFactor:n,curvatureType:r}=this.functionArguments,{extent:i,primaryPixelSizes:s}=e,o=s?.[0],a=o??(i?{x:i.width/t.width,y:i.height/t.height}:{x:1,y:1}),l=this.isGCS&&n>=1?n*je.rk:n;return(0,je.E0)(t,{zFactor:l,curvatureType:r,resolution:a})}_getWebGLParameters(){const{zFactor:e,curvatureType:t}=this.functionArguments;return{curvatureType:t,zFactor:this.isGCS&&e>=1?e*je.rk:e}}};(0,o._)([(0,a.MZ)({json:{write:!0,name:"rasterFunction"}})],dn.prototype,"functionName",void 0),(0,o._)([(0,a.MZ)({type:fn,json:{write:!0,name:"rasterFunctionArguments"}})],dn.prototype,"functionArguments",void 0),(0,o._)([(0,a.MZ)()],dn.prototype,"rasterArgumentNames",void 0),(0,o._)([(0,a.MZ)({json:{write:!0}})],dn.prototype,"isGCS",void 0),dn=(0,o._)([(0,l.$)("esri.layers.support.rasterFunctions.CurvatureFunction")],dn);const mn=dn;var yn;let gn=yn=class extends h{constructor(){super(...arguments),this.bandIds=[],this.bandNames=[],this.bandWavelengths=[],this.missingBandAction=$e.Wb.bestMatch}clone(){return new yn({bandIds:this.bandIds?.slice(),bandNames:this.bandNames?.slice(),bandWavelengths:this.bandWavelengths?.slice(),missingBandAction:this.missingBandAction,method:this.method,wavelengthMatchTolerance:this.wavelengthMatchTolerance})}};(0,o._)([(0,a.MZ)({json:{write:!0}})],gn.prototype,"bandIds",void 0),(0,o._)([(0,a.MZ)({json:{write:!0}})],gn.prototype,"bandNames",void 0),(0,o._)([(0,a.MZ)({json:{write:!0}})],gn.prototype,"bandWavelengths",void 0),(0,o._)([(0,Ue.e)({0:"name",1:"wavelength",2:"id"})],gn.prototype,"method",void 0),(0,o._)([(0,a.MZ)({json:{write:!0}})],gn.prototype,"missingBandAction",void 0),(0,o._)([(0,a.MZ)({json:{write:!0}})],gn.prototype,"wavelengthMatchTolerance",void 0),gn=yn=(0,o._)([(0,l.$)("esri.layers.support.rasterFunctions.ExtractBandFunctionArguments")],gn);const wn=gn;let bn=class extends x{constructor(){super(...arguments),this.functionName="ExtractBand",this.functionArguments=null,this.rasterArgumentNames=["raster"]}_bindSourceRasters(){const{functionArguments:e,sourceRasterInfos:t}=this,n=t[0],{method:r,bandNames:i,bandWavelengths:s,bandIds:o,missingBandAction:a}=e,l=i?.length&&("name"===r||"id"!==r&&!o?.length),u=s?.length&&("wavelength"===r||"id"!==r&&!o?.length),c=a===$e.Wb.fail,p=l?function(e,t){const n=e.bandInfos.map((({name:e})=>e.toLowerCase())),r=[];for(let e=0;e<t.length;e++){const i=t[e].toLowerCase();let s=n.indexOf(i);if(-1===s&&"nearinfrared"===i&&(s=n.findIndex((e=>e.startsWith("nearinfrared_1"))),-1===s&&(s=n.findIndex((e=>e.startsWith("nearinfrared"))))),-1===s)return null;r.push(s)}return r}(n,i):u?function(e,t,{wavelengthMatchTolerance:n},r){const{bandInfos:i}=e,s=[];for(let e=0;e<i.length;e++){const{minWavelength:t,maxWavelength:n}=i[e];if(!t||!n)return null;s.push({minWavelength:t,maxWavelength:n})}const o=[];for(let e=0;e<t.length;e++){const i=t[e];let a=!1,l=-1,u=Number.MAX_VALUE;for(let e=0;e<s.length;e++){const t=s[e],n=i>=t.minWavelength&&i<=t.maxWavelength,r=Math.abs(i-(t.minWavelength+t.maxWavelength)/2);n?r<u&&(a=!0,l=e,u=r):!a&&r<u&&(l=e,u=r)}if(!a&&n&&u<n&&(a=!0),!a&&r)return null;o.push(l)}return o}(n,s,this.functionArguments,c):function(e,t,n){const{bandCount:r}=e;return!t?.length||n&&t.some((e=>e<0||e>=r))?null:t}(n,o,c);if(null==p)return{success:!1,supportsGPU:!1,error:`extract-band-function: Invalid ${l?"band names":u?"band wavelengths":"band ids"} for the imagery data source`};this.functionArguments.bandIds=p,this.functionArguments.method="id",this.outputPixelType=this._getOutputPixelType("f32");const h=n.clone();h.pixelType=this.outputPixelType,h.bandCount=p.length;const{statistics:f,histograms:d}=h;null!=f&&f.length&&(h.statistics=p.map((e=>f[e]||f[f.length-1]))),null!=d&&d.length&&(h.histograms=p.map((e=>d[e]||d[d.length-1]))),h.multidimensionalInfo&&h.multidimensionalInfo.variables.forEach((e=>{const{statistics:t,histograms:n}=e;null!=t&&t.length&&(e.statistics=p.map((e=>t[e]||t[t.length-1]))),null!=n&&n.length&&(e.histograms=p.map((e=>n[e]||n[n.length-1])))}));let m=h.keyProperties?.BandProperties;return m?.length&&(m=p.map((e=>e>=m.length?m[m.length-1]:m[e])),h.keyProperties={...h.keyProperties,BandProperties:m}),this.rasterInfo=h,{success:!0,supportsGPU:h.bandCount<=3}}_processPixels(e){const t=e.pixelBlocks?.[0];if(null==t)return null;const n=t.pixels.length,r=this.functionArguments.bandIds.map((e=>e>=n?n-1:e));return t.extractBands(r)}_getWebGLParameters(){let e;if(this.isInputBandIdsSwizzled)e=this.swizzledBandSelection.length?this.swizzledBandSelection:[0,1,2];else{e=[...this.functionArguments.bandIds],0===e.length?e=[0,1,2]:e.length<3&&(e[1]=e[1]??e[0],e[2]=e[2]??e[1]);for(let t=0;t<3;t++)e[t]=Math.min(e[t],2)}return{bandIndexMat3:Xe(e)}}_getInputBandIds(e){const t=e.length;return this.functionArguments.bandIds.map((e=>e>=t?t-1:e)).map((t=>e[t]))}};(0,o._)([(0,a.MZ)({json:{write:!0,name:"rasterFunction"}})],bn.prototype,"functionName",void 0),(0,o._)([(0,a.MZ)({type:wn,json:{write:!0,name:"rasterFunctionArguments"}})],bn.prototype,"functionArguments",void 0),(0,o._)([(0,a.MZ)()],bn.prototype,"rasterArgumentNames",void 0),bn=(0,o._)([(0,l.$)("esri.layers.support.rasterFunctions.ExtractBandFunction")],bn);const vn=bn;var xn;let Mn=xn=class extends h{clone(){return new xn({conversionParameters:[...this.conversionParameters],raster:this.raster})}};(0,o._)([(0,a.MZ)({type:[Number],json:{write:!0}})],Mn.prototype,"conversionParameters",void 0),Mn=xn=(0,o._)([(0,l.$)("esri.layers.support.rasterFunctions.GrayscaleFunctionArguments")],Mn);const An=Mn;let In=class extends x{constructor(){super(...arguments),this.functionName="Grayscale",this.functionArguments=null,this.rasterArgumentNames=["raster"]}get _normalizedWeights(){const{conversionParameters:e}=this.functionArguments,t=e.reduce(((e,t)=>e+t));return e.map((e=>e/t))}_bindSourceRasters(){const{conversionParameters:e}=this.functionArguments;if(!e?.length)return{success:!1,supportsGPU:!1,error:"missing valid conversion parameters."};const t=this.sourceRasterInfos[0].clone();this.outputPixelType=this._getOutputPixelType(t.pixelType),t.pixelType=this.outputPixelType;const n=3===e.length||3===t.bandCount&&e.length>3;return t.bandCount=1,this._removeStatsHistColormapVAT(t),this.rasterInfo=t,{success:!0,supportsGPU:n}}_processPixels(e){const t=e.pixelBlocks?.[0];return null==t?null:function(e,t,n){const{pixels:r,width:i,height:s,mask:o,bandMasks:a}=e,l=i*s,c=a?.length?g.A.combineBandMasks(a):o,p=Math.min(t.length,r.length),h=n.startsWith("f"),f=!h&&n!==e.pixelType,[d,m]=(0,u.hP)(n),y=g.A.createEmptyBand(n,l);for(let e=0;e<s;e++){let n=e*i;for(let e=0;e<i;e++,n++)if(!c||c[n]){let e=0;for(let i=0;i<p;i++)e+=t[i]*r[i][n];h||(e=Math.round(e),f&&(e=e>m?m:e<d?d:e)),y[n]=e}}const w=new g.A({width:i,height:s,pixels:[y],pixelType:n,mask:c});return w.updateStatistics(),w}(t,this._normalizedWeights,this.outputPixelType)}_getWebGLParameters(){return{weights:this._normalizedWeights}}};(0,o._)([(0,a.MZ)({json:{write:!0,name:"rasterFunction"}})],In.prototype,"functionName",void 0),(0,o._)([(0,a.MZ)({type:An,json:{write:!0,name:"rasterFunctionArguments"}})],In.prototype,"functionArguments",void 0),(0,o._)([(0,a.MZ)()],In.prototype,"rasterArgumentNames",void 0),(0,o._)([(0,a.MZ)()],In.prototype,"_normalizedWeights",null),In=(0,o._)([(0,l.$)("esri.layers.support.rasterFunctions.GrayscaleFunction")],In);const Sn=In;var _n;const Cn=new Ve.J({0:"traditional",1:"multi-directional"},{useNumericKeys:!0}),Tn=new Ve.J({1:"degree",2:"percent-rise",3:"scaled"},{useNumericKeys:!0});let kn=_n=class extends h{constructor(){super(...arguments),this.altitude=45,this.azimuth=315,this.hillshadeType="traditional",this.pixelSizePower=.664,this.pixelSizeFactor=.024,this.slopeType="degree",this.zFactor=1,this.removeEdgeEffect=!1}clone(){return new _n({hillshadeType:this.hillshadeType,altitude:this.altitude,azimuth:this.azimuth,zFactor:this.zFactor,slopeType:this.slopeType,pixelSizeFactor:this.pixelSizeFactor,pixelSizePower:this.pixelSizePower,removeEdgeEffect:this.removeEdgeEffect,raster:this.raster})}};(0,o._)([(0,a.MZ)({type:Number,json:{write:!0}})],kn.prototype,"altitude",void 0),(0,o._)([(0,a.MZ)({type:Number,json:{write:!0}})],kn.prototype,"azimuth",void 0),(0,o._)([(0,a.MZ)(),(0,Ue.e)(Cn)],kn.prototype,"hillshadeType",void 0),(0,o._)([(0,a.MZ)({type:Number,json:{write:!0,name:"psPower"}})],kn.prototype,"pixelSizePower",void 0),(0,o._)([(0,a.MZ)({type:Number,json:{write:!0,name:"psZFactor"}})],kn.prototype,"pixelSizeFactor",void 0),(0,o._)([(0,a.MZ)(),(0,Ue.e)(Tn)],kn.prototype,"slopeType",void 0),(0,o._)([(0,a.MZ)({type:Number,json:{write:!0}})],kn.prototype,"zFactor",void 0),(0,o._)([(0,a.MZ)({type:Boolean,json:{write:!0}})],kn.prototype,"removeEdgeEffect",void 0),kn=_n=(0,o._)([(0,l.$)("esri.layers.support.rasterFunctions.HillshadeFunctionArguments")],kn);const Rn=kn;let Pn=class extends x{constructor(){super(...arguments),this.functionName="Hillshade",this.functionArguments=null,this.rasterArgumentNames=["raster"],this.isGCS=!1}_bindSourceRasters(){const e=this.sourceRasterInfos[0];if(e.bandCount>1)return{success:!1,supportsGPU:!1,error:"hillshade-function: source data must be single band"};this.outputPixelType=this._getOutputPixelType("u8");const t=e.clone();return this._removeStatsHistColormapVAT(t),t.pixelType=this.outputPixelType,t.bandCount=1,t.statistics=[{min:0,max:255,avg:60,stddev:10}],this.rasterInfo=t,this.isGCS=t.spatialReference?.isGeographic??!1,{success:!0,supportsGPU:!0}}_processPixels(e){const t=e.pixelBlocks?.[0];if(!t)return null;const{extent:n,primaryPixelSizes:r}=e,i=r?.[0],s=i??(n?{x:n.width/t.width,y:n.height/t.height}:{x:1,y:1}),o=(0,je.PP)(this.functionArguments,s,this.isGCS),a=(0,je.fw)(t,o);return a.pixelType=this.outputPixelType,a}_getWebGLParameters(){const e=(0,je.PP)(this.functionArguments,{x:1,y:1},this.isGCS),t=(0,je.ng)(e),{slopeType:n,zFactor:r,pixelSizeFactor:i,pixelSizePower:s}=this.functionArguments,o="scaled"===n,a=(0,u.zw)(this.outputPixelType);return{...t,zFactor:r,gcsFactor:this.isGCS?je.rk:1,pixelSizeFactor:o?i:0,pixelSizePower:o?s:0,isOutputRounded:a}}};(0,o._)([(0,a.MZ)({json:{write:!0,name:"rasterFunction"}})],Pn.prototype,"functionName",void 0),(0,o._)([(0,a.MZ)({type:Rn,json:{write:!0,name:"rasterFunctionArguments"}})],Pn.prototype,"functionArguments",void 0),(0,o._)([(0,a.MZ)()],Pn.prototype,"rasterArgumentNames",void 0),(0,o._)([(0,a.MZ)({json:{write:!0}})],Pn.prototype,"isGCS",void 0),Pn=(0,o._)([(0,l.$)("esri.layers.support.rasterFunctions.HillshadeFunction")],Pn);const Nn=Pn;var Dn;let En=Dn=class extends h{constructor(){super(...arguments),this.rasters=[],this.processAsMultiband=!0}writeRasters(e,t){t.rasters=e.map((e=>"number"==typeof e||"string"==typeof e?e:e.toJSON()))}clone(){return new Dn({operation:this.operation,processAsMultiband:this.processAsMultiband,rasters:(0,s.o8)(this.rasters)})}};(0,o._)([(0,a.MZ)({json:{write:!0}})],En.prototype,"operation",void 0),(0,o._)([(0,a.MZ)({json:{write:!0}})],En.prototype,"rasters",void 0),(0,o._)([(0,Lt.K)("rasters")],En.prototype,"writeRasters",null),(0,o._)([(0,a.MZ)({json:{write:!0}})],En.prototype,"processAsMultiband",void 0),En=Dn=(0,o._)([(0,l.$)("esri.layers.support.rasterFunctions.LocalFunctionArguments")],En);const Ln=En;let Fn=class extends x{constructor(){super(...arguments),this.functionName="Local",this.functionArguments=null,this.rasterArgumentNames=["rasters"]}_bindSourceRasters(){const{sourceRasterInfos:e}=this,t=e[0],{bandCount:n}=t,{processAsMultiband:r}=this.functionArguments;if(e.some((e=>e.bandCount!==n)))return{success:!1,supportsGPU:!1,error:"local-function: input rasters do not have same band count"};const{operation:i,rasters:s}=this.functionArguments,o=k[i];if(!(999===o||s.length===o||s.length<=1&&1===o))return{success:!1,supportsGPU:!1,error:`local-function: the length of functionArguments.rasters does not match operation's requirement: ${o}`};const a=t.clone();return a.bandCount=999!==o||r?n:1,this._removeStatsHistColormapVAT(a),this._updateStatistics(a),this._updatePixelType(a),this.rasterInfo=a,{success:!0,supportsGPU:1===a.bandCount&&o<=3}}_processPixels(e){const{pixelBlocks:t}=e;return null==t||t.some((e=>null==e))?null:De(t,this.functionArguments.operation,{processAsMultiband:this.functionArguments.processAsMultiband,outputPixelType:this.outputPixelType??void 0})}_getWebGLParameters(){const{operation:e}=this.functionArguments,t=k[e],n=Object.keys(_).find((t=>_[t]===e))?.toLowerCase()??"undefined",r=this.outputPixelType??"f32";let[i,s]=(0,u.hP)(r);const o=(0,u.zw)(r);return o&&(i-=1e-4,s+=1e-4),{imageCount:t,operationName:n,domainRange:[i,s],isOutputRounded:o}}_updateStatistics(e){const t=this.sourceRasterInfos[0],{operation:n}=this.functionArguments,r=T(n)?.domain;if(r){e.statistics=[];for(let t=0;t<e.bandCount;t++)e.statistics[t]={min:r[0],max:r[1],avg:(r[0]+r[1])/2,stddev:(r[0]+r[1])/10}}else 45===n&&t.statistics?.length&&(e.statistics=t.statistics.map((e=>({min:-e.max,max:-e.min,avg:null!=e.avg?-e.avg:void 0,stddev:null!=e.stddev?-e.stddev:void 0}))))}_updatePixelType(e){const{statistics:t,pixelType:n}=this.sourceRasterInfos[0],{operation:r}=this.functionArguments,{domain:i,isInteger:s}=T(r)??{domain:null,isInteger:!1};let o="f32";if(i&&s)o=(0,u.X1)(i[0],i[1]);else if(30===r){const e=t?.[0];o=e?(0,u.X1)(e.min,e.max):(0,u.zw)(n)?n:"s32"}else if(45===r&&(0,u.zw)(n)){const e=t?.map((({max:e})=>-e)),r=t?.map((({min:e})=>-e)),i=e?.length?Math.min(...e):null,s=r?.length?Math.min(...r):null;o=null!=i&&null!=s?(0,u.X1)(i,s):n.startsWith("s")?n.replace("s","u"):"u1"===n||"u2"===n||"u4"===n?"s8":"u8"===n?"s16":"s32"}e.pixelType=this.outputPixelType=this._getOutputPixelType(o)}};(0,o._)([(0,a.MZ)({json:{write:!0,name:"rasterFunction"}})],Fn.prototype,"functionName",void 0),(0,o._)([(0,a.MZ)({type:Ln,json:{write:!0,name:"rasterFunctionArguments"}})],Fn.prototype,"functionArguments",void 0),(0,o._)([(0,a.MZ)()],Fn.prototype,"rasterArgumentNames",void 0),Fn=(0,o._)([(0,l.$)("esri.layers.support.rasterFunctions.LocalFunction")],Fn);const On=Fn;var zn,jn=n(15774);let Bn=zn=class extends h{constructor(){super(...arguments),this.includedRanges=null,this.noDataValues=null,this.noDataInterpretation=$e.IB.matchAny}get normalizedNoDataValues(){const{noDataValues:e}=this;if(!e?.length)return null;let t=!1;const n=e.map((e=>{if("number"==typeof e)return t=!0,[e];if("string"==typeof e){const n=e.trim().split(" ").filter((e=>""!==e.trim())).map((e=>Number(e)));return t=t||n.length>0,0===n.length?null:n}return null}));return t?n:null}clone(){return new zn({includedRanges:this.includedRanges?.slice()??[],noDataValues:this.noDataValues?.slice()??[],noDataInterpretation:this.noDataInterpretation})}};(0,o._)([(0,a.MZ)({json:{write:!0}})],Bn.prototype,"includedRanges",void 0),(0,o._)([(0,a.MZ)({json:{write:!0}})],Bn.prototype,"noDataValues",void 0),(0,o._)([(0,a.MZ)()],Bn.prototype,"normalizedNoDataValues",null),(0,o._)([(0,a.MZ)({json:{write:!0}})],Bn.prototype,"noDataInterpretation",void 0),Bn=zn=(0,o._)([(0,l.$)("esri.layers.support.rasterFunctions.MaskFunctionArguments")],Bn);const Zn=Bn;let Un=class extends x{constructor(){super(...arguments),this.functionName="Mask",this.functionArguments=null,this.rasterArgumentNames=["raster"]}_bindSourceRasters(){const e=this.sourceRasterInfos[0].clone(),{pixelType:t}=e;this.outputPixelType=this._getOutputPixelType(t),e.pixelType=this.outputPixelType,this.rasterInfo=e;const{includedRanges:n,normalizedNoDataValues:r}=this.functionArguments;if(!n?.length&&!r?.length)return{success:!1,supportsGPU:!1,error:"missing includedRanges or noDataValues argument"};let i=[];for(let s=0;s<e.bandCount;s++){const e=(0,$e.Wt)(t,n?.slice(2*s,2*s+2),r?.[s]);if(null==e){i=null;break}i.push(e)}this.lookups=i;const s=null!=r&&r.every((e=>e?.length===r[0]?.length));return{success:!0,supportsGPU:(!n||n.length<=2*$e.et)&&(!r||s&&r[0].length<=$e.et)}}_processPixels(e){const t=e.pixelBlocks?.[0];if(null==t)return null;const{outputPixelType:n,lookups:r}=this,{includedRanges:i,noDataInterpretation:s,normalizedNoDataValues:o}=this.functionArguments,a=s===$e.IB.matchAll;return(0,$e.dK)(t,{includedRanges:i,noDataValues:o,outputPixelType:n,matchAll:a,lookups:r})}_getWebGLParameters(){const{includedRanges:e,normalizedNoDataValues:t}=this.functionArguments,n=new Float32Array($e.et);n.fill(jn.pq),t?.[0]?.length&&n.set(t[0]);const r=new Float32Array($e.et);for(let t=0;t<r.length;t+=2)r[t]=e?.[t]??-jn.pq,r[t+1]=e?.[t+1]??jn.pq;return e?.length&&r.set(e),{bandCount:this.sourceRasterInfos[0].bandCount,noDataValues:n,includedRanges:r}}};(0,o._)([(0,a.MZ)({json:{write:!0,name:"rasterFunction"}})],Un.prototype,"functionName",void 0),(0,o._)([(0,a.MZ)({type:Zn,json:{write:!0,name:"rasterFunctionArguments"}})],Un.prototype,"functionArguments",void 0),(0,o._)([(0,a.MZ)()],Un.prototype,"rasterArgumentNames",void 0),(0,o._)([(0,a.MZ)({json:{write:!0}})],Un.prototype,"lookups",void 0),Un=(0,o._)([(0,l.$)("esri.layers.support.rasterFunctions.MaskFunction")],Un);const Vn=Un;var Gn;let Hn=Gn=class extends h{constructor(){super(...arguments),this.visibleBandID=0,this.infraredBandID=1,this.scientificOutput=!1}clone(){const{visibleBandID:e,infraredBandID:t,scientificOutput:n}=this;return new Gn({visibleBandID:e,infraredBandID:t,scientificOutput:n})}};(0,o._)([(0,a.MZ)({json:{write:!0}})],Hn.prototype,"visibleBandID",void 0),(0,o._)([(0,a.MZ)({json:{write:!0}})],Hn.prototype,"infraredBandID",void 0),(0,o._)([(0,a.MZ)({json:{write:!0}})],Hn.prototype,"scientificOutput",void 0),Hn=Gn=(0,o._)([(0,l.$)("esri.layers.support.rasterFunctions.NDVIFunctionArguments")],Hn);const Wn=Hn;let Jn=class extends x{constructor(){super(...arguments),this.functionName="NDVI",this.functionArguments=null,this.rasterArgumentNames=["raster"]}_bindSourceRasters(){const{scientificOutput:e,visibleBandID:t,infraredBandID:n}=this.functionArguments;this.outputPixelType=this._getOutputPixelType(e?"f32":"u8");const r=this.sourceRasterInfos[0],i=Math.max(t,n);if(r.bandCount<2||i>=r.bandCount)return{success:!1,supportsGPU:!1,error:"ndvi-function: source raster has insufficient amount of raster bands"};const s=r.clone();s.pixelType=this.outputPixelType,this._removeStatsHistColormapVAT(s),s.bandCount=1,s.keyProperties={...s.keyProperties,BandProperties:void 0};const[o,a,l,u]=e?[-1,1,0,.1]:[0,200,100,10];return s.statistics=[{min:o,max:a,avg:l,stddev:u}],this.rasterInfo=s,{success:!0,supportsGPU:!0}}_processPixels(e){const t=e.pixelBlocks?.[0];if(null==t)return null;const{visibleBandID:n,infraredBandID:r,scientificOutput:i}=this.functionArguments;return function(e,t,n,r){const{mask:i,pixels:s,width:o,height:a}=e,l=s[n],u=s[t],c=u.length,p=r?new Uint8Array(c):new Float32Array(c),h=r?100:1,f=r?100.5:0;for(let e=0;e<c;e++)if(null==i||i[e]){const t=l[e],n=u[e],r=t+n;r&&(p[e]=(t-n)/r*h+f)}const d=new g.A({width:o,height:a,mask:i,pixelType:r?"u8":"f32",pixels:[p]});return d.updateStatistics(),d}(t,n,r,!i)}_getWebGLParameters(){const{visibleBandID:e,infraredBandID:t,scientificOutput:n}=this.functionArguments;return{bandIndexMat3:Xe(this.isInputBandIdsSwizzled?[0,1,2]:[t,e,0]),scaled:!n}}_getInputBandIds(e){const{visibleBandID:t,infraredBandID:n}=this.functionArguments;return[n,t,0].map((t=>e[t]))}};(0,o._)([(0,a.MZ)({json:{write:!0,name:"rasterFunction"}})],Jn.prototype,"functionName",void 0),(0,o._)([(0,a.MZ)({type:Wn,json:{write:!0,name:"rasterFunctionArguments"}})],Jn.prototype,"functionArguments",void 0),(0,o._)([(0,a.MZ)()],Jn.prototype,"rasterArgumentNames",void 0),Jn=(0,o._)([(0,l.$)("esri.layers.support.rasterFunctions.NDVIFunction")],Jn);const qn=Jn;var $n;let Kn=$n=class extends h{constructor(){super(...arguments),this.inputRanges=null,this.outputValues=null,this.noDataRanges=null,this.allowUnmatched=!1,this.isLastInputRangeInclusive=!1}clone(){return new $n({inputRanges:[...this.inputRanges],outputValues:[...this.outputValues],noDataRanges:[...this.noDataRanges],allowUnmatched:this.allowUnmatched,isLastInputRangeInclusive:this.isLastInputRangeInclusive})}};(0,o._)([(0,a.MZ)({json:{write:!0}})],Kn.prototype,"inputRanges",void 0),(0,o._)([(0,a.MZ)({json:{write:!0}})],Kn.prototype,"outputValues",void 0),(0,o._)([(0,a.MZ)({json:{write:!0}})],Kn.prototype,"noDataRanges",void 0),(0,o._)([(0,a.MZ)({json:{write:!0}})],Kn.prototype,"allowUnmatched",void 0),(0,o._)([(0,a.MZ)({json:{write:!0}})],Kn.prototype,"isLastInputRangeInclusive",void 0),Kn=$n=(0,o._)([(0,l.$)("esri.layers.support.rasterFunctions.RemapFunctionArguments")],Kn);const Yn=Kn;let Xn=class extends x{constructor(){super(...arguments),this.functionName="Remap",this.functionArguments=null,this.rasterArgumentNames=["raster"],this.lookup=null}_bindSourceRasters(){const e=this.sourceRasterInfos[0].clone(),{pixelType:t}=e;this.outputPixelType=this._getOutputPixelType(t),e.pixelType=this.outputPixelType,e.bandCount=1;const{statistics:n}=e;this._removeStatsHistColormapVAT(e);const{allowUnmatched:r,outputValues:i,inputRanges:s,noDataRanges:o,isLastInputRangeInclusive:a}=this.functionArguments;if(null!=n&&n.length&&i?.length)if(r){const t=Math.min.apply(null,[...i,n[0].min]),r=Math.max.apply(null,[...i,n[0].max]);e.statistics=[{...n[0],min:t,max:r}]}else{let t=i[0],r=t;for(let e=0;e<i.length;e++)t=t>i[e]?i[e]:t,r=r>i[e]?r:i[e];e.statistics=[{...n[0],min:t,max:r}]}return this.rasterInfo=e,this.lookup=r?null:(0,$e.XU)({srcPixelType:t,inputRanges:s,outputValues:i,noDataRanges:o,allowUnmatched:r,isLastInputRangeInclusive:a,outputPixelType:this.outputPixelType}),{success:!0,supportsGPU:(!i||i.length<=$e.et)&&(!o||o.length<=$e.et)}}_processPixels(e){const t=e.pixelBlocks?.[0];if(null==t)return null;const{lookup:n,outputPixelType:r}=this;if(n){const e=(0,$e.eH)(t,{lut:[n.lut],offset:n.offset,outputPixelType:r});return null!=e&&n.mask&&(e.mask=(0,$e.UK)(t.pixels[0],t.mask,n.mask,n.offset,"u8")),e}const{inputRanges:i,outputValues:s,noDataRanges:o,allowUnmatched:a,isLastInputRangeInclusive:l}=this.functionArguments;return(0,$e.Ew)(t,{inputRanges:i,outputValues:s,noDataRanges:o,outputPixelType:r,allowUnmatched:a,isLastInputRangeInclusive:l})}_getWebGLParameters(){const{allowUnmatched:e,noDataRanges:t,isLastInputRangeInclusive:n}=this.functionArguments,r=new Float32Array(3*$e.et),i=1e-5,s=this.functionArguments.inputRanges??[],o=this.functionArguments.outputValues??[],a=o.length;for(let e=0;e<$e.et;e++)r[3*e]=s[2*e]??jn.pq-1,r[3*e+1]=s[2*e+1]??jn.pq,r[3*e+2]=o[e]??0,e<a&&(e>0&&(r[3*e]-=i),(e<a-1||!n)&&(r[3*e+1]-=i));const l=new Float32Array(2*$e.et);return l.fill(jn.pq),t?.length&&l.set(t),{allowUnmatched:e,rangeMaps:r,noDataRanges:l,clampRange:(0,u.hP)(this.outputPixelType)}}};(0,o._)([(0,a.MZ)({json:{write:!0,name:"rasterFunction"}})],Xn.prototype,"functionName",void 0),(0,o._)([(0,a.MZ)({type:Yn,json:{write:!0,name:"rasterFunctionArguments"}})],Xn.prototype,"functionArguments",void 0),(0,o._)([(0,a.MZ)()],Xn.prototype,"rasterArgumentNames",void 0),(0,o._)([(0,a.MZ)({json:{write:!0}})],Xn.prototype,"lookup",void 0),Xn=(0,o._)([(0,l.$)("esri.layers.support.rasterFunctions.RemapFunction")],Xn);const Qn=Xn;var er;let tr=er=class extends Rn{readColorRamp(e){if("string"==typeof e){const t=wt.kH.jsonValues.find((t=>t.toLowerCase()===e.toLowerCase()));return t?(0,wt.M5)(wt.kH.fromJSON(t)):null}return"toJSON"in e?e.toJSON():e}clone(){return new er({hillshadeType:this.hillshadeType,altitude:this.altitude,azimuth:this.azimuth,zFactor:this.zFactor,slopeType:this.slopeType,pixelSizeFactor:this.pixelSizeFactor,pixelSizePower:this.pixelSizePower,removeEdgeEffect:this.removeEdgeEffect,colorRamp:this.colorRamp,colormap:this.colormap,raster:this.raster})}};(0,o._)([(0,a.MZ)({json:{write:!0}})],tr.prototype,"colorRamp",void 0),(0,o._)([(0,gt.w)("colorRamp")],tr.prototype,"readColorRamp",null),(0,o._)([(0,a.MZ)({type:[[Number]],json:{write:!0}})],tr.prototype,"colormap",void 0),tr=er=(0,o._)([(0,l.$)("esri.layers.support.rasterFunctions.ShadedReliefFunctionArguments")],tr);const nr=tr;let rr=class extends x{constructor(){super(...arguments),this.functionName="ShadedRelief",this.functionArguments=null,this.rasterArgumentNames=["raster"],this.isGCS=!1}_bindSourceRasters(){const e=this.sourceRasterInfos[0];if(e.bandCount>1)return{success:!1,supportsGPU:!1,error:"shadedrelief-function: source data must be single band"};let{colorRamp:t,colormap:n}=this.functionArguments;if(!t&&!n?.length)return{success:!1,supportsGPU:!1,error:"shadedrelief-function: a color ramp argument must be specified"};this.outputPixelType=this._getOutputPixelType("u8");const r=e.clone();this._removeStatsHistColormapVAT(r),r.pixelType=this.outputPixelType,r.bandCount=3,r.statistics=[{min:0,max:255,avg:60,stddev:10},{min:0,max:255,avg:60,stddev:10},{min:0,max:255,avg:60,stddev:10}],this.rasterInfo=r,this.isGCS=r.spatialReference?.isGeographic??!1,n?.length||(n=(0,wt.R8)(t,{interpolateAlpha:!0}));const{indexedColormap:i,offset:s}=(0,$e.zg)({colormap:n});if(!i?.length)return{success:!1,supportsGPU:!1,error:"shadedrelief-function: a valid colorramp is required"};const o=(0,wt.S2)(i);return this.lookup={indexedColormap:i,offset:s,hsvMap:o},{success:!0,supportsGPU:(0,Pt.WN)(i)}}_processPixels(e){const t=e.pixelBlocks?.[0];if(!t||!this.lookup)return null;let n=e.primaryPixelSizes?.[0];if(null==n){const{extent:r}=e;n=r?{x:r.width/t.width,y:r.height/t.height}:{x:1,y:1}}const r=(0,je.PP)(this.functionArguments,n,this.isGCS),i=(0,je.fw)(t,r),s=this.sourceRasterInfos[0].statistics?.[0]??{min:0,max:8e3};return(0,je.SC)(i,t,this.lookup.hsvMap,s),i.pixelType=this.outputPixelType,i}_getWebGLParameters(){const e=(0,je.PP)(this.functionArguments,{x:1,y:1},this.isGCS),t=(0,je.ng)(e),{slopeType:n,zFactor:r,pixelSizeFactor:i,pixelSizePower:s}=this.functionArguments,o="scaled"===n,{indexedColormap:a,offset:l}=this.lookup,c=this.sourceRasterInfos[0].statistics?.[0],p=(0,u.zw)(this.outputPixelType);return{...t,indexedColormap:a,offset:l,zFactor:r,gcsFactor:this.isGCS?je.rk:1,pixelSizeFactor:o?i:0,pixelSizePower:o?s:0,minValue:c?.min??0,maxValue:c?.max??8e3,isOutputRounded:p}}};(0,o._)([(0,a.MZ)({json:{write:!0,name:"rasterFunction"}})],rr.prototype,"functionName",void 0),(0,o._)([(0,a.MZ)({type:nr,json:{write:!0,name:"rasterFunctionArguments"}})],rr.prototype,"functionArguments",void 0),(0,o._)([(0,a.MZ)()],rr.prototype,"rasterArgumentNames",void 0),(0,o._)([(0,a.MZ)({json:{write:!0}})],rr.prototype,"isGCS",void 0),(0,o._)([(0,a.MZ)({json:{write:!0}})],rr.prototype,"lookup",void 0),rr=(0,o._)([(0,l.$)("esri.layers.support.rasterFunctions.ShadedReliefFunction")],rr);const ir=rr;var sr;const or=new Ve.J({1:"degree",2:"percent-rise",3:"adjusted"},{useNumericKeys:!0});let ar=sr=class extends h{constructor(){super(...arguments),this.slopeType="degree",this.zFactor=1,this.pixelSizePower=.664,this.pixelSizeFactor=.024,this.removeEdgeEffect=!1}clone(){return new sr({slopeType:this.slopeType,zFactor:this.zFactor,pixelSizePower:this.pixelSizePower,pixelSizeFactor:this.pixelSizeFactor,removeEdgeEffect:this.removeEdgeEffect,raster:this.raster})}};(0,o._)([(0,Ue.e)(or)],ar.prototype,"slopeType",void 0),(0,o._)([(0,a.MZ)({type:Number,json:{write:!0}})],ar.prototype,"zFactor",void 0),(0,o._)([(0,a.MZ)({type:Number,json:{name:"psPower",write:!0}})],ar.prototype,"pixelSizePower",void 0),(0,o._)([(0,a.MZ)({type:Number,json:{name:"psZFactor",write:!0}})],ar.prototype,"pixelSizeFactor",void 0),(0,o._)([(0,a.MZ)({type:Boolean,json:{write:!0}})],ar.prototype,"removeEdgeEffect",void 0),ar=sr=(0,o._)([(0,l.$)("esri.layers.support.rasterFunctions.SlopeFunctionArguments")],ar);const lr=ar;let ur=class extends x{constructor(){super(...arguments),this.functionName="Slope",this.functionArguments=null,this.rasterArgumentNames=["raster"],this.isGCS=!1}_bindSourceRasters(){this.outputPixelType=this._getOutputPixelType("f32");const e=this.sourceRasterInfos[0].clone();return e.pixelType=this.outputPixelType,this._removeStatsHistColormapVAT(e),e.statistics="percent-rise"!==this.functionArguments.slopeType?[{min:0,max:90,avg:1,stddev:1}]:null,e.bandCount=1,this.rasterInfo=e,this.isGCS=e.spatialReference?.isGeographic??!1,{success:!0,supportsGPU:!0}}_processPixels(e){const t=e.pixelBlocks?.[0];if(null==t)return null;const{zFactor:n,slopeType:r,pixelSizePower:i,pixelSizeFactor:s}=this.functionArguments,{isGCS:o}=this,{extent:a,primaryPixelSizes:l}=e,u=l?.[0],c=u??(a?{x:a.width/t.width,y:a.height/t.height}:{x:1,y:1});return(0,je.yy)(t,{zFactor:n,slopeType:r,pixelSizePower:i,pixelSizeFactor:s,isGCS:o,resolution:c})}_getWebGLParameters(){const{zFactor:e,slopeType:t,pixelSizeFactor:n,pixelSizePower:r}=this.functionArguments;return{zFactor:this.isGCS&&e>=1?e*je.rk:e,slopeType:t,pixelSizeFactor:n??0,pixelSizePower:r??0,isOutputRounded:(0,u.zw)(this.outputPixelType)}}};(0,o._)([(0,a.MZ)({json:{write:!0,name:"rasterFunction"}})],ur.prototype,"functionName",void 0),(0,o._)([(0,a.MZ)({type:lr,json:{write:!0,name:"rasterFunctionArguments"}})],ur.prototype,"functionArguments",void 0),(0,o._)([(0,a.MZ)()],ur.prototype,"rasterArgumentNames",void 0),(0,o._)([(0,a.MZ)({json:{write:!0}})],ur.prototype,"isGCS",void 0),ur=(0,o._)([(0,l.$)("esri.layers.support.rasterFunctions.SlopeFunction")],ur);const cr=ur,pr=new Ve.J({1:"min",2:"max",3:"mean",4:"stddev",5:"median",6:"majority",7:"minority"},{useNumericKeys:!0});function hr(e,t){const{fillNoDataOnly:n}=t,{band:r,width:i,height:s,mask:o,outBand:a}=e;if(n&&!o)return void a.set(r);const{statisticsType:l,kernelRows:u,kernelCols:c}=t,p="stddev"===l,h=i*s,f=new Float64Array(h),d=new Float64Array(h),m=new Uint32Array(h);for(let e=0;e<s;e++){const t=e*i;let n=0,s=0,a=0;for(let e=0;e<c;e++)o&&!o[t+e]||(n+=r[t+e],p&&(s+=r[t+e]**2),a++);f[t]=n,d[t]=s,m[t]=a;for(let e=1;e<=i-c;e++){const i=t+e-1,l=i+c;o?(o[i]&&(a--,n-=r[i],p&&(s-=r[i]**2)),o[l]&&(a++,n+=r[l],p&&(s+=r[l]**2))):(n-=r[i],n+=r[l],p&&(s-=r[i]**2,s+=r[l]**2)),f[t+e]=n,m[t+e]=a,p&&(d[t+e]=s)}}const y=new Float64Array(h),g=new Float64Array(h),w=new Uint32Array(h),b=u*i;for(let e=0;e<=i-c;e++){let t=0,n=0,r=0;for(let s=0;s<u;s++){const o=s*i+e;t+=f[o],r+=m[o],p&&(n+=d[o])}y[e]=t,g[e]=n,w[e]=r;for(let o=1;o<=s-u;o++){const s=(o-1)*i+e,a=s+b;t-=f[s],t+=f[a],r-=m[s],r+=m[a],p&&(n-=d[s],n+=d[a]),y[o*i+e]=t,g[o*i+e]=n,w[o*i+e]=r}}const v=Math.floor(u/2),x=Math.floor(c/2);for(let e=v;e<s-v;e++){const t=e*i;for(let r=x;r<i-x;r++){const s=(e-v)*i+r-x,l=w[s];if(0===l||n&&(!o||o[t+r]))continue;const u=y[s]/l,c=p?Math.sqrt((g[s]-y[s]*u)/l):u;a[t+r]=c,o&&(o[t+r]=255)}}}function fr(e,t){const{fillNoDataOnly:n}=t,{band:r,width:i,height:s,mask:o,outBand:a}=e;if(n&&!o)return void a.set(r);const{kernelRows:l,kernelCols:u,statisticsType:c}=t,p=Math.floor(l/2),h=Math.floor(u/2),f="min"===c,d=a.slice(),m=new Uint32Array(i*s);for(let e=p;e<s-p;e++){const t=e*i;for(let e=h;e<i-h;e++){let n=f?Number.MAX_VALUE:-Number.MAX_VALUE,s=0;for(let a=0;a<l;a++)for(let l=0;l<u;l++){const u=t+e+(a-p)*i+l-h;o&&!o[u]||(n=f?Math.min(n,r[u]):Math.max(n,r[u]),s++)}o?(d[t+e]=0===s?0:n,m[t+e]=s):a[t+e]=0===s?0:n}}if(o)for(let e=p;e<s-p;e++){const t=e*i;for(let e=h;e<i-h;e++)if(m[t+e]){if(n&&o[t+e])continue;a[t+e]=d[t+e],o[t+e]=255}}}function dr(e,t){const{fillNoDataOnly:n}=t,{band:r,width:i,height:s,mask:o,outBand:a}=e;if(n&&!o)return void a.set(r);const{kernelRows:l,kernelCols:u}=t,c=Math.floor(l/2),p=Math.floor(u/2),h=a.slice(),f=new Uint32Array(i*s);for(let e=c;e<s-c;e++){const t=e*i;for(let e=p;e<i-p;e++){if(n&&o?.[t+e])continue;const s=[];for(let n=0;n<l;n++)for(let a=0;a<u;a++){const l=t+e+(n-c)*i+a-p;o&&!o[l]||s.push(r[l])}s.length&&(s.sort(((e,t)=>e-t)),o?(h[t+e]=s[Math.floor((s.length-1)/2)],f[t+e]=s.length):a[t+e]=s[Math.floor((s.length-1)/2)])}}if(o)for(let e=c;e<s-c;e++){const t=e*i;for(let e=p;e<i-p;e++)if(f[t+e]){if(n&&o[t+e])continue;a[t+e]=h[t+e],o[t+e]=255}}}function mr(e,t){const{fillNoDataOnly:n}=t,{band:r,width:i,height:s,mask:o,outBand:a}=e;if(n&&!o)return void a.set(r);const{kernelRows:l,kernelCols:u}=t,c=Math.floor(l/2),p=Math.floor(u/2),h="majority"===t.statisticsType,f=l*u,d=a.slice(),m=new Uint32Array(i*s);for(let e=c;e<s-c;e++){const t=e*i;for(let e=p;e<i-p;e++){if(n&&o?.[t+e])continue;const s=new Map;for(let n=0;n<l;n++)for(let a=0;a<u;a++){const l=t+e+(n-c)*i+a-p;if(o&&!o[l])continue;const u=r[l];s.set(u,s.has(u)?s.get(u)+1:1)}if(0===s.size)continue;let y=0,g=0,w=h?0:f+1;for(const e of s.keys())g=s.get(e),h===g>w&&(w=g,y=e);o?(d[t+e]=y,m[t+e]=s.size):a[t+e]=y}}if(o)for(let e=c;e<s-c;e++){const t=e*i;for(let e=p;e<i-p;e++)if(m[t+e]){if(n&&o[t+e])continue;a[t+e]=d[t+e],o[t+e]=255}}}var yr;let gr=yr=class extends h{constructor(){super(...arguments),this.rows=3,this.cols=3,this.fillNoDataOnly=!1,this.statisticsType="min"}clone(){return new yr({rows:this.rows,cols:this.cols,fillNoDataOnly:this.fillNoDataOnly,statisticsType:this.statisticsType,raster:(0,s.o8)(this.raster)})}};(0,o._)([(0,a.MZ)({json:{write:!0,read:{source:["kernelRows","rows"],reader:(e,t)=>Number(e??t?.kernelRows??3)}}})],gr.prototype,"rows",void 0),(0,o._)([(0,a.MZ)({json:{write:!0,read:{source:["kernelCols","cols"],reader:(e,t)=>Number(e??t?.kernelCols??3)}}})],gr.prototype,"cols",void 0),(0,o._)([(0,a.MZ)({json:{write:!0}})],gr.prototype,"fillNoDataOnly",void 0),(0,o._)([(0,a.MZ)({json:{read:{source:["statisticsType","type"],reader:(e,t)=>pr.fromJSON(t?.statisticsType??t?.type)??"min"},write:{target:"type"}}}),(0,Ue.e)(pr)],gr.prototype,"statisticsType",void 0),gr=yr=(0,o._)([(0,l.$)("esri.layers.support.rasterFunctions.StatisticsFunctionArguments")],gr);const wr=gr;let br=class extends x{constructor(){super(...arguments),this.functionName="Statistics",this.rasterArgumentNames=["raster"]}_bindSourceRasters(){const{type:e}=this.functionArguments.toJSON();if(e<1||e>7)return{success:!1,supportsGPU:!1,error:`statistics-function: the given statistics type is not supported ${e}`};const t=this.sourceRasterInfos[0];this.outputPixelType=this._getOutputPixelType(t.pixelType);const n=t.clone();n.pixelType=this.outputPixelType;const{statisticsType:r}=this.functionArguments;return"stddev"===r&&this._removeStatsHistColormapVAT(n),this.rasterInfo=n,{success:!0,supportsGPU:n.bandCount<=3&&e<5}}_processPixels(e){const t=e.pixelBlocks?.[0];if(null==t)return t;const{statisticsType:n,rows:r,cols:i,fillNoDataOnly:s}=this.functionArguments;return function(e,t){const{mask:n}=e,{fillNoDataOnly:r}=t;if(r&&!n)return e;const{pixels:i,width:s,height:o,bandMasks:a,pixelType:l}=e,u=i.length,c=s*o,p=[],{kernelRows:h,kernelCols:f,statisticsType:d,mirrorEdges:m}=t;if(r&&!n)return e;const y=t.outputPixelType??l,w=[];for(let e=0;e<u;e++){const l=i[e],u=g.A.createEmptyBand(y,c);r&&u.set(l);const b=a?.[e]??n,v=b?.slice()??null,x={band:l,width:s,height:o,mask:v,outBand:u};switch(d){case"min":case"max":fr(x,t);break;case"mean":case"stddev":hr(x,t);break;case"median":dr(x,t);break;case"majority":case"minority":mr(x,t)}m&&!r&&en(u,s,o,h,f),p.push(u),v&&w.push(v)}let b=w[0]??n;w.length!==u&&(w.length=0),u>1&&a?.length&&(b=g.A.combineBandMasks(a));const v=new g.A({pixelType:y,width:s,height:o,pixels:p,bandMasks:a&&w.length?w:null,mask:b});return v.updateStatistics(),v}(t,{kernelRows:r,kernelCols:i,fillNoDataOnly:s,outputPixelType:this.outputPixelType,statisticsType:n,mirrorEdges:!0})}_getWebGLParameters(){const{rows:e,cols:t,statisticsType:n,fillNoDataOnly:r}=this.functionArguments;return{fillNoDataOnly:r,kernelRows:e,kernelCols:t,statisticsType:n,clampRange:(0,u.hP)(this.outputPixelType)}}};(0,o._)([(0,a.MZ)({json:{write:!0,name:"rasterFunction"}})],br.prototype,"functionName",void 0),(0,o._)([(0,a.MZ)({type:wr,json:{write:!0,name:"rasterFunctionArguments"}})],br.prototype,"functionArguments",void 0),(0,o._)([(0,a.MZ)()],br.prototype,"rasterArgumentNames",void 0),br=(0,o._)([(0,l.$)("esri.layers.support.rasterFunctions.StatisticsFunction")],br);const vr=br;var xr;let Mr=xr=class extends h{constructor(){super(...arguments),this.statistics=null,this.histograms=null}readStatistics(e,t){if(!e?.length)return null;const n=[];return e.forEach((e=>{const t={min:e.min,max:e.max,avg:e.avg??e.mean,stddev:e.stddev??e.standardDeviation};n.push(t)})),n}writeStatistics(e,t,n){if(!e?.length)return;const r=[];e.forEach((e=>{const t={...e,mean:e.avg,standardDeviation:e.stddev};delete t.avg,delete t.stddev,r.push(t)})),t[n]=r}clone(){return new xr({statistics:(0,s.o8)(this.statistics),histograms:(0,s.o8)(this.histograms)})}};(0,o._)([(0,a.MZ)({json:{write:!0}})],Mr.prototype,"statistics",void 0),(0,o._)([(0,gt.w)("statistics")],Mr.prototype,"readStatistics",null),(0,o._)([(0,Lt.K)("statistics")],Mr.prototype,"writeStatistics",null),(0,o._)([(0,a.MZ)({json:{write:!0}})],Mr.prototype,"histograms",void 0),Mr=xr=(0,o._)([(0,l.$)("esri.layers.support.rasterFunctions.StatisticsHistogramFunctionArguments")],Mr);const Ar=Mr;let Ir=class extends x{constructor(){super(...arguments),this.functionName="StatisticsHistogram",this.functionArguments=null,this.rasterArgumentNames=["raster"],this.isNoopProcess=!0}_bindSourceRasters(){const e=this.sourceRasterInfos[0];this.outputPixelType=this._getOutputPixelType("u8");const t=e.clone(),{statistics:n,histograms:r}=this.functionArguments;return r&&(t.histograms=r),n&&(t.statistics=n),this.rasterInfo=t,{success:!0,supportsGPU:!0}}_processPixels(e){return e.pixelBlocks?.[0]}};(0,o._)([(0,a.MZ)({json:{write:!0,name:"rasterFunction"}})],Ir.prototype,"functionName",void 0),(0,o._)([(0,a.MZ)({type:Ar,json:{write:!0,name:"rasterFunctionArguments"}})],Ir.prototype,"functionArguments",void 0),(0,o._)([(0,a.MZ)()],Ir.prototype,"rasterArgumentNames",void 0),(0,o._)([(0,a.MZ)({json:{write:!0}})],Ir.prototype,"indexedColormap",void 0),(0,o._)([(0,a.MZ)()],Ir.prototype,"isNoopProcess",void 0),Ir=(0,o._)([(0,l.$)("esri.layers.support.rasterFunctions.StatisticsHistogramFunction")],Ir);const Sr=Ir;var _r;const Cr=new Ve.J({0:"none",3:"standard-deviation",4:"histogram-equalization",5:"min-max",6:"percent-clip",9:"sigmoid"},{useNumericKeys:!0});let Tr=_r=class extends h{constructor(){super(...arguments),this.computeGamma=!1,this.dynamicRangeAdjustment=!1,this.gamma=[],this.histograms=null,this.statistics=null,this.stretchType="none",this.useGamma=!1}writeStatistics(e,t,n){e?.length&&(Array.isArray(e[0])||(e=e.map((e=>[e.min,e.max,e.avg,e.stddev]))),t[n]=e)}clone(){return new _r({stretchType:this.stretchType,outputMin:this.outputMin,outputMax:this.outputMax,useGamma:this.useGamma,computeGamma:this.computeGamma,statistics:(0,s.o8)(this.statistics),gamma:(0,s.o8)(this.gamma),sigmoidStrengthLevel:this.sigmoidStrengthLevel,numberOfStandardDeviations:this.numberOfStandardDeviations,minPercent:this.minPercent,maxPercent:this.maxPercent,histograms:(0,s.o8)(this.histograms),dynamicRangeAdjustment:this.dynamicRangeAdjustment,raster:this.raster})}};(0,o._)([(0,a.MZ)({type:Boolean,json:{write:!0}})],Tr.prototype,"computeGamma",void 0),(0,o._)([(0,a.MZ)({type:Boolean,json:{name:"dra",write:!0}})],Tr.prototype,"dynamicRangeAdjustment",void 0),(0,o._)([(0,a.MZ)({type:[Number],json:{write:!0}})],Tr.prototype,"gamma",void 0),(0,o._)([(0,a.MZ)()],Tr.prototype,"histograms",void 0),(0,o._)([(0,a.MZ)({type:Number,json:{write:!0}})],Tr.prototype,"maxPercent",void 0),(0,o._)([(0,a.MZ)({type:Number,json:{write:!0}})],Tr.prototype,"minPercent",void 0),(0,o._)([(0,a.MZ)({type:Number,json:{write:!0}})],Tr.prototype,"numberOfStandardDeviations",void 0),(0,o._)([(0,a.MZ)({type:Number,json:{name:"max",write:!0}})],Tr.prototype,"outputMax",void 0),(0,o._)([(0,a.MZ)({type:Number,json:{name:"min",write:!0}})],Tr.prototype,"outputMin",void 0),(0,o._)([(0,a.MZ)({type:Number,json:{write:!0}})],Tr.prototype,"sigmoidStrengthLevel",void 0),(0,o._)([(0,a.MZ)({json:{type:[[Number]],write:!0}})],Tr.prototype,"statistics",void 0),(0,o._)([(0,Lt.K)("statistics")],Tr.prototype,"writeStatistics",null),(0,o._)([(0,Ue.e)(Cr)],Tr.prototype,"stretchType",void 0),(0,o._)([(0,a.MZ)({type:Boolean,json:{write:!0}})],Tr.prototype,"useGamma",void 0),Tr=_r=(0,o._)([(0,l.$)("esri.layers.support.rasterFunctions.StretchFunctionArguments")],Tr);const kr=Tr;let Rr=class extends x{constructor(){super(...arguments),this.functionName="Stretch",this.functionArguments=null,this.rasterArgumentNames=["raster"],this.lookup=null,this.cutOffs=null}_bindSourceRasters(){this.lookup=null,this.cutOffs=null;const e=this.sourceRasterInfos[0],{pixelType:t}=e,{functionArguments:n}=this,{dynamicRangeAdjustment:r,gamma:i,useGamma:s}=n;if(!r&&["u8","u16","s8","s16"].includes(t)){const r=(0,Yt.DP)(n.toJSON(),{rasterInfo:e}),o=(0,u.zw)(this.outputPixelType)?"round":"float";this.lookup=(0,Yt.RP)({pixelType:t,...r,gamma:s?i:null,rounding:o}),this.cutOffs=r}else r||(this.cutOffs=(0,Yt.DP)(n.toJSON(),{rasterInfo:e}));this.outputPixelType=this._getOutputPixelType(t);const o=e.clone();o.pixelType=this.outputPixelType,this._removeStatsHistColormapVAT(o),"u8"===this.outputPixelType&&(o.keyProperties.DataType="processed");const{outputMin:a=0,outputMax:l=255}=this.functionArguments;o.statistics=[];for(let e=0;e<o.bandCount;e++)o.statistics[e]={min:a,max:l};return this.rasterInfo=o,{success:!0,supportsGPU:!r}}_processPixels(e){const t=e.pixelBlocks?.[0];if(null==t)return t;const{lookup:n}=this;if(n)return(0,$e.eH)(t,{...n,outputPixelType:this.rasterInfo.pixelType});const{functionArguments:r}=this,i=this.cutOffs||(0,Yt.DP)(r.toJSON(),{rasterInfo:this.sourceRasterInfos[0],pixelBlock:t}),s=r.useGamma?r.gamma:null;return(0,Yt._N)(t,{...i,gamma:s,outputPixelType:this.outputPixelType})}_getWebGLParameters(){const{outputMin:e=0,outputMax:t=255,gamma:n,useGamma:r}=this.functionArguments,i=this.rasterInfo.bandCount>=2?3:1,s=r&&n?.length?(0,Yt.Nh)(i,n):[1,1,1],{minCutOff:o,maxCutOff:a}=this.cutOffs??{minCutOff:[0,0,0],maxCutOff:[255,255,255]};1===o.length&&(o[1]=o[2]=o[0],a[1]=a[2]=a[0]);const l=new Float32Array(i);let c;for(c=0;c<i;c++)l[c]=(t-e)/(a[c]-o[c]);const p=(0,u.zw)(this.outputPixelType);return{bandCount:i,outMin:e,outMax:t,minCutOff:o,maxCutOff:a,factor:l,useGamma:r,gamma:r&&n?n:[1,1,1],gammaCorrection:r&&s?s:[1,1,1],stretchType:this.functionArguments.stretchType,isOutputRounded:p,type:"stretch"}}};(0,o._)([(0,a.MZ)({json:{write:!0,name:"rasterFunction"}})],Rr.prototype,"functionName",void 0),(0,o._)([(0,a.MZ)({type:kr,json:{write:!0,name:"rasterFunctionArguments"}})],Rr.prototype,"functionArguments",void 0),(0,o._)([(0,a.MZ)()],Rr.prototype,"rasterArgumentNames",void 0),(0,o._)([(0,a.MZ)({json:{write:!0}})],Rr.prototype,"lookup",void 0),(0,o._)([(0,a.MZ)({json:{write:!0}})],Rr.prototype,"cutOffs",void 0),Rr=(0,o._)([(0,l.$)("esri.layers.support.rasterFunctions.StretchFunction")],Rr);const Pr=Rr;var Nr;let Dr=Nr=class extends h{constructor(){super(...arguments),this.attributeTableAsRecordSet=null}clone(){return new Nr({attributeTableAsRecordSet:(0,s.o8)(this.attributeTableAsRecordSet)})}};(0,o._)([(0,a.MZ)({json:{write:!0}})],Dr.prototype,"attributeTableAsRecordSet",void 0),Dr=Nr=(0,o._)([(0,l.$)("esri.layers.support.rasterFunctions.TableFunctionArguments")],Dr);const Er=Dr;let Lr=class extends x{constructor(){super(...arguments),this.functionName="Table",this.functionArguments=null,this.rasterArgumentNames=["raster"],this.isNoopProcess=!0}_bindSourceRasters(){const e=this.sourceRasterInfos[0];if(e.bandCount>1||e.pixelType.startsWith("f"))return{success:!1,supportsGPU:!1,error:"table-function: Source data must be single band and integer pixel type."};const{attributeTableAsRecordSet:t}=this.functionArguments;if(!t)return{success:!1,supportsGPU:!1,error:"table-function: Missing attributeTableAsRecordSet argument."};this.outputPixelType=this._getOutputPixelType(e.pixelType);const n=e.clone();return n.pixelType=this.outputPixelType,n.bandCount=1,"thematic"!==n.dataType&&(n.keyProperties=n.keyProperties?{...n.keyProperties,DataType:"thematic"}:{DataType:"thematic"}),this.rasterInfo=n,{success:!0,supportsGPU:!0}}_processPixels(e){return e.pixelBlocks?.[0]}};(0,o._)([(0,a.MZ)({json:{write:!0,name:"rasterFunction"}})],Lr.prototype,"functionName",void 0),(0,o._)([(0,a.MZ)({type:Er,json:{write:!0,name:"rasterFunctionArguments"}})],Lr.prototype,"functionArguments",void 0),(0,o._)([(0,a.MZ)()],Lr.prototype,"rasterArgumentNames",void 0),(0,o._)([(0,a.MZ)()],Lr.prototype,"isNoopProcess",void 0),Lr=(0,o._)([(0,l.$)("esri.layers.support.rasterFunctions.TableFunction")],Lr);const Fr=Lr,Or=new Map;function zr(e,t){const{rasterFunctionArguments:n}=e;n&&(n.rasters||[n.raster,n.raster2]).forEach((e=>{e&&"number"!=typeof e&&("string"==typeof e?e.startsWith("http")&&(t.includes(e)||t.push(e)):"rasterFunctionArguments"in e&&zr(e,t))}))}function jr(e,t){if(t=t??{},"function"in(e=(0,s.o8)(e))&&"arguments"in e&&e.arguments){const n=Wr(e,new Map,t);if(qr(n),!n.renderingRule)throw new i.A("raster-function-helper","Unsupported raster function json.");e=n.renderingRule}if("rasterFunction"in e)return Ur(e=Zr(e),t);throw new i.A("raster-function-helper","unsupported raster function json.")}function Br(e){return!!(e&&"object"==typeof e&&e.rasterFunction&&e.rasterFunctionArguments)}function Zr(e){const{rasterFunction:t,rasterFunctionArguments:n}=e,r={};for(const e in n){let t=n[e];const i=e.toLowerCase();if("rasters"===i&&Array.isArray(t))r.rasters=t.map((e=>Br(e)?Zr(e):e));else switch(Br(t)&&(t=Zr(t)),i){case"dra":r.dra=t;break;case"pspower":r.psPower=t;break;case"pszfactor":r.psZFactor=t;break;case"bandids":r.bandIds=t;break;default:r[e[0].toLowerCase()+e.slice(1)]=t}}return"Local"!==t||r.rasters?.length||(r.rasters=["$$"]),{...e,rasterFunctionArguments:r}}function Ur(e,t){const{rasterFunction:n,rasterFunctionArguments:r}=e,s=e.outputPixelType?.toLowerCase();if(null==n||!Or.has(n))throw new i.A("raster-function-helper",`unsupported raster function: ${n}`);const o=Or.get(n),a=("function"==typeof o.ctor?o.ctor:o.ctor.default).fromJSON({...e,outputPixelType:s}),{rasterArgumentNames:l}=a,u=[],c=function(e,t){return"rasters"===t[0]&&Array.isArray(e.rasters)?e.rasters:t.map((t=>e[t]))}(r,l),p="rasters"===l[0]||l.length>1,h=[];for(let e=0;e<c.length;e++){const n=c[e];let r;null==n||"string"==typeof n&&n.startsWith("$")?u.push(t?.raster):"string"==typeof n?t[n]&&u.push(t[n]):"number"!=typeof n&&"rasterFunction"in n&&(r=Ur(n,t),p||(a.functionArguments[l[e]]=r),u.push(r)),p&&h.push(r??n)}if(p&&("rasters"===l[0]?a.functionArguments.rasters=h:l.forEach(((e,t)=>{a.functionArguments[e]=h[t]}))),t){a.sourceRasters=u;const e=t.raster?.url;e&&(a.mainPrimaryRasterId=e)}return a}function Vr(e,t){if(e&&t)for(const n in e){const r=e[n];r&&"object"==typeof r&&"type"in r&&("RasterFunctionTemplate"===r.type?Vr(r.arguments,t):"RasterFunctionVariable"===r.type&&null!=t[r.name]&&(r.value=t[r.name]))}}function Gr(e,t){if(!e||"object"!=typeof e)return e;const{value:n}=e;if(!n||"object"!=typeof n)return e.isDataset?"$$":n;if(Array.isArray(n))return 0===n.length?[]:n.map((e=>"object"==typeof e&&"RasterFunctionVariable"===e.type?Gr(e,t):e));if("value"in n&&["number","string","boolean"].includes(typeof n.value))return n.value;if(e.isDataset&&"Scalar"!==n.type)return"$$";if(!("type"in n))return n;let r=n;switch(n.type){case"Scalar":r=n.value;break;case"AlgorithmicColorRamp":r=Hr(n);break;case"MultiPartColorRamp":r={type:"multipart",colorRamps:n.ArrayOfColorRamp.map(Hr)};break;case"ArgumentArray":if(n.elements?.length&&"RasterStatistics"!==n.elements[0].type){const e=[];for(let r=0;r<n.elements.length;r++){const s=n.elements[r],{type:o}=s;if(o)if("RasterFunctionTemplate"===o){const{renderingRule:n}=Wr(s,t);e.push(n),null!=s._object_id&&t.set(s._object_id,n)}else{if("RasterFunctionVariable"!==o)throw new i.A("raster-function-helper","unsupported raster function json.");{const n=Gr(s,t);e.push(n),null!=s._object_id&&t.set(s._object_id,n)}}else e.push(s)}r=e}else r=n.elements}return null!=n._object_id&&t.set(n._object_id,r),r}function Hr(e){const t=e.algorithm??"esriHSVAlgorithm";let{FromColor:n,ToColor:i}=e;if(!Array.isArray(n)){const{r:e,g:t,b:i}=(0,r.$)({h:n.Hue,s:n.Saturation,v:n.Value});n=[e,t,i,n.AlphaValue]}if(!Array.isArray(i)){const{r:e,g:t,b:n}=(0,r.$)({h:i.Hue,s:i.Saturation,v:i.Value});i=[e,t,n,i.AlphaValue]}return{type:"algorithmic",algorithm:t,fromColor:n,toColor:i}}function Wr(e,t,n){n&&Vr(e,n);const r={renderingRule:{},templates:t};return Jr(e,r),r}function Jr(e,t){if(!e||!t.renderingRule)return;const{renderingRule:n,templates:r}=t,{function:i,arguments:s,_object_id:o}=e;if(!i||!s)return;null!=o&&r.set(o,n),n.rasterFunction=i.type.replace("Function",""),n.outputPixelType=i.pixelType;const a={};n.rasterFunctionArguments=a;for(const e in s){if("type"===e||"object_id"===e||"_object_ref_id"===e)continue;const t=s[e];t&&"object"==typeof t&&"type"in t&&("RasterFunctionTemplate"===t.type||"RasterFunctionVariable"===t.type)?("RasterFunctionVariable"===t.type?a[e]=Gr(t,r):(n.rasterFunctionArguments[e]={},Jr(t,{renderingRule:n.rasterFunctionArguments[e],templates:r})),null!=t._object_id&&r.set(t._object_id,a[e])):a[e]=t}switch(a.DEM&&!a.Raster&&(a.Raster=a.DEM,delete a.DEM),n.rasterFunction){case"Stretch":!function(e){e.Statistics?.length&&"object"==typeof e.Statistics&&(e.Statistics=e.Statistics.map((e=>[e.min,e.max,e.mean,e.standardDeviation]))),null!=e.NumberOfStandardDeviation&&(e.NumberOfStandardDeviations=e.NumberOfStandardDeviation,delete e.NumberOfStandardDeviation)}(a);break;case"Colormap":!function(e){"randomcolorramp"===e.ColorRamp?.type?.toLowerCase()&&(delete e.ColorRamp,e.ColormapName="Random"),0===e.ColorSchemeType&&delete e.ColorRamp}(a);break;case"Convolution":!function(e){null!=e.ConvolutionType&&(e.Type=e.ConvolutionType,delete e.ConvolutionType)}(a);break;case"Mask":!function(e){e.NoDataValues?.length&&"string"==typeof e.NoDataValues[0]&&(e.NoDataValues=e.NoDataValues.filter((e=>""!==e)).map((e=>Number(e))))}(a)}}function qr(e){const{renderingRule:t,templates:n}=e;if("object"!=typeof t||!t?.rasterFunctionArguments||!n.size)return;const{rasterFunctionArguments:r}=t;for(const e in r){const t=r[e],s="_object_ref_id"===e?t:t&&"object"==typeof t&&"_object_ref_id"in t?t._object_ref_id:null;if(null==s)t&&"object"==typeof t&&(t.rasterFunctionArguments&&qr({renderingRule:t,templates:n}),Array.isArray(t)&&t.forEach(((e,r)=>{if("object"==typeof e)if(null!=e._object_ref_id){if(!n.has(e._object_ref_id))throw new i.A("raster-function-helper",`unsupported raster function json. _object_ref_id: ${t} does not exist`);const o=n.get(s);o&&"object"==typeof o?Object.assign(e,o):t[r]=o}else qr({renderingRule:e,templates:n})})));else{if(!n.has(s))throw new i.A("raster-function-helper",`unsupported raster function json. _object_ref_id: ${s} does not exist`);const t=n.get(s);"_object_ref_id"!==e?r[e]=t:t&&"object"==typeof t&&Object.assign(r,t)}}}Or.set("Arithmetic",{desc:"Arithmetic Function",ctor:Le,rasterArgumentNames:["rasters"]}),Or.set("Aspect",{desc:"Aspect Function",ctor:Ze,rasterArgumentNames:["raster"]}),Or.set("BandArithmetic",{desc:"Band Arithmetic Function",ctor:st,rasterArgumentNames:["raster"]}),Or.set("Colormap",{desc:"Colormap Function",ctor:_t,rasterArgumentNames:["raster"]}),Or.set("ColormapToRGB",{desc:"ColormapToRGB Function",ctor:Dt,rasterArgumentNames:["raster"]}),Or.set("CompositeBand",{desc:"CompositeBand Function",ctor:jt,rasterArgumentNames:["rasters"]}),Or.set("ComputeChange",{desc:"ComputeChange Function",ctor:Jt,rasterArgumentNames:["rasters"]}),Or.set("Convolution",{desc:"Convolution Function",ctor:un,rasterArgumentNames:["raster"]}),Or.set("ContrastBrightness",{desc:"Contrast Brightness Function",ctor:Qt,rasterArgumentNames:["raster"]}),Or.set("ExtractBand",{desc:"ExtractBand Function",ctor:vn,rasterArgumentNames:["raster"]}),Or.set("Curvature",{desc:"Curvature Function",ctor:mn,rasterArgumentNames:["raster"]}),Or.set("Hillshade",{desc:"Hillshade Function",ctor:Nn,rasterArgumentNames:["raster"]}),Or.set("ShadedRelief",{desc:"ShadedRelief Function",ctor:ir,rasterArgumentNames:["raster"]}),Or.set("Grayscale",{desc:"Grayscale Function",ctor:Sn,rasterArgumentNames:["raster"]}),Or.set("Clip",{desc:"Clip Function",ctor:mt,rasterArgumentNames:["raster"]}),Or.set("Local",{desc:"Local Function",ctor:On,rasterArgumentNames:["rasters"]}),Or.set("Mask",{desc:"Mask Function",ctor:Vn,rasterArgumentNames:["raster"]}),Or.set("NDVI",{desc:"NDVI Function",ctor:qn,rasterArgumentNames:["raster"]}),Or.set("Remap",{desc:"Remap Function",ctor:Qn,rasterArgumentNames:["raster"]}),Or.set("Slope",{desc:"Slope Function",ctor:cr,rasterArgumentNames:["raster"]}),Or.set("Statistics",{desc:"Focal Statistics Function",ctor:vr,rasterArgumentNames:["raster"]}),Or.set("StatisticsHistogram",{desc:"Statistics Histogram Function",ctor:Sr,rasterArgumentNames:["raster"]}),Or.set("Stretch",{desc:"Stretch Function",ctor:Pr,rasterArgumentNames:["raster"]}),Or.set("Table",{desc:"Attribute Table Function",ctor:Fr,rasterArgumentNames:["raster"]})},80221:function(e,t,n){n.d(t,{DO:function(){return J},FT:function(){return V},Hh:function(){return _},OM:function(){return W},Ps:function(){return Y},Wo:function(){return T},_I:function(){return N},_l:function(){return B},dK:function(){return ee},eh:function(){return Q},l0:function(){return q},t$:function(){return X},uk:function(){return Z},vI:function(){return C},xh:function(){return m}}),n(50917);var r,i,s=n(50659),o=n(39819),a=n(62938),l=n(38305),u=n(46157),c=n(57652),p=n(91484),h=n(44740),f=n(45532),d=n(57165);function m(e,t,n){return!(0,u.canProjectWithoutEngine)(e,t,n)}function y(e,t,n){const r=m(e,t,n);if(r&&!(0,u.isLoaded)())throw new o.A("rasterprojectionhelper-project","projection engine is not loaded");return r}(i=r||(r={}))[i.None=0]="None",i[i.North=1]="North",i[i.South=2]="South",i[i.Both=3]="Both";const g=(e,t,n,r=0)=>{if(1===n[0])return[0,0];let i=1,s=-1,o=1,a=-1;for(let t=0;t<e.length;t+=2)isNaN(e[t])||(i=i>e[t]?e[t]:i,s=s>e[t]?s:e[t],o=o>e[t+1]?e[t+1]:o,a=a>e[t+1]?a:e[t+1]);const{cols:l,rows:u}=t,c=(s-i)/l/n[0],p=(a-o)/u/n[1],h=2*r;let f=0,d=!1,m=[0,0];for(let t=0;t<l-3;t++){for(let n=0;n<u-3;n++){const r=t*u*2+2*n,i=(e[r]+e[r+4]+e[r+4*u]+e[r+4*u+4])/4,s=(e[r+1]+e[r+5]+e[r+4*u+1]+e[r+4*u+5])/4,o=Math.abs((i-e[r+2*u+2])/c),a=Math.abs((s-e[r+2*u+3])/p);if(o+a>f&&(f=o+a,m=[o,a]),h&&f>h){d=!0;break}}if(d)break}return m},w={3395:20037508.342789244,3410:17334193.943686873,3857:20037508.342788905,3975:17367530.445161372,4087:20037508.342789244,4088:20015108.787169147,6933:17367530.445161372,32662:20037508.342789244,53001:20015086.79602057,53002:10007543.39801029,53003:20015086.79602057,53004:20015086.79602057,53016:14152803.599503474,53017:17333573.624304302,53034:20015086.79602057,53079:20015114.352186374,53080:20015114.352186374,54001:20037508.342789244,54002:10018754.171394624,54003:20037508.342789244,54004:20037508.342789244,54016:14168658.027268292,54017:17367530.44516137,54034:20037508.342789244,54079:20037508.342789244,54080:20037508.342789244,54100:20037508.342789244,54101:20037508.342789244},b=32,v=4,x=v,M=new Map,A=new Map,I=500;let S=null;async function _(){S&&(0,u.isLoaded)()||((0,u.isLoaded)()||await(0,u.load)(),S=await n.e(5418).then(n.bind(n,22162)))}function C(e,t,n){return y(e.spatialReference,t),n?(0,u.getTransformation)(t,e.spatialReference,e):(0,u.getTransformation)(e.spatialReference,t,e)}function T(e,t,n,r=null){const i=e.spatialReference;if(!i||!t||i.equals(t))return e;y(i,t,r);const s=n.center,o=new p.default({xmin:s.x-e.x/2,xmax:s.x+e.x/2,ymin:s.y-e.y/2,ymax:s.y+e.y/2,spatialReference:i}),a=(0,u.project)(o,t,r),l=V(t);return null==a||null!=l&&a.width>=l?k(e,i,t):{x:a.width,y:a.height}}function k(e,t,n){const r=(0,a.GA)(t)/(0,a.GA)(n);return{x:e.x*r,y:e.y*r}}function R(e,t,n){const{spatialReference:r}=n;if(!r||!t||r.equals(t))return e;if(r.isGeographic&&t.isGeographic)return k(e,r,t);if(y(r,t),!S)throw new o.A("raster-projection-helper:project-dataset-resolution","geometry engine is not loaded");let{x:i,y:s}=e;const l=(i+s)/2*(0,a.GA)(r);let c=1;l>30&&(c=30/l,i*=c,s*=c);const p=256,f=i*p/2,d=s*p/2,{x:m,y:g}=n.center,w=[];for(let e=0;e<=p;e++)w.push([m-f,g-d+e*s]);for(let e=1;e<=p;e++)w.push([m-f+e*i,g+d]);for(let e=1;e<=p;e++)w.push([m+f,g+d-e*s]);for(let e=1;e<p;e++)w.push([m+f-e*i,g-d]);w.push(w[0]);const b=new h.A({rings:[w],spatialReference:r}),v=(0,u.project)(b,t);if(!v)return k(e,r,t);const x=v.extent,M=V(t);if(null==x||null!=M&&x.width>=M)return k(e,r,t);const A=S.planarArea(v),I=i*s*p*p,_=Math.sqrt(A/I)/c,C={x:x.width/c/p,y:x.height/c/p},T={x:i*_,y:s*_},R=C.x*C.y;return Math.abs(R-T.x*T.y)/R<.1?C:T}function P(e,t=.01){return(0,a.GA)(e)?t/(0,a.GA)(e):0}function N(e,t,n=null,r=!0){const i=e.spatialReference;if(i.equals(t))return e;y(i,t,n);const s=(0,u.project)(e,t,n);return r&&s?(D([e],[s],i,t),s):s}function D(e,t,n,r){const i=G(n,!0),s=G(r,!0),o=P(n,I),a=P(r,I);if(o&&null!=i&&null!=s)for(let n=0;n<e.length;n++){const r=t[n];if(!r)continue;const{x:l}=e[n],{x:u}=r;u>=s[1]-a&&Math.abs(l-i[0])<o?r.x-=s[1]-s[0]:u<=s[0]+a&&Math.abs(l-i[1])<o&&(r.x+=s[1]-s[0])}}function E(e){const{inSR:t,outSR:n,datumTransformation:r,preferPE:i}=e;if(t.equals(n)){const{points:t}=z(e,null);return t}if(t.isWebMercator&&n.isWGS84||t.isWGS84&&n.isWebMercator)return function(e){const{cols:t,rows:n,xres:r,yres:i,usePixelCenter:s,inSR:o,outSR:a}=e;let{xmin:l,ymax:c}=e;s&&(l+=r/2,c-=i/2);const p=[],h=[],d=Math.max(t,n);for(let e=0;e<d;e++){const s=l+r*Math.min(t,e),d=c-i*Math.min(n,e),m=(0,u.project)(new f.default({x:s,y:d,spatialReference:o}),a);e<=t&&p.push(m.x),e<=n&&h.push(m.y)}const m=[];for(let e=0;e<t;e++)for(let t=0;t<n;t++)m.push([p[e],h[t]]);return m}(e);if(y(t,n,r)&&i){if(t.isGeographic)return L(e);if(null!=F(t))return L(e)}return function(e){const{points:t}=z(e,null),{inSR:n,outSR:r,datumTransformation:i}=e,s=t.map((e=>new f.default(e[0],e[1],n))),o=(0,u.project)(s,r,i);return i&&D(s,o,n,r),o.map((e=>e?[e.x,e.y]:[NaN,NaN]))}(e)}function L(e){const{inSR:t,outSR:n,datumTransformation:r}=e,i=F(t),{points:s,mask:o}=z(e,i);if(!t.isGeographic){const e=t.wkid?l.P.coordsys(t.wkid):l.P.fromString(t.isGeographic?l.a.PE_TYPE_GEOGCS:l.a.PE_TYPE_PROJCS,t.wkt2||t.wkt);l.g.projToGeog(e,s.length,s)}if(null!=r&&r.steps.length){let e;const t=179.9955;if(n.isGeographic&&(e=s.map((([e])=>e>t?1:e<-t?-1:0))),r.steps.forEach((e=>{const t=e.wkid?l.P.geogtran(e.wkid):l.P.fromString(l.a.PE_TYPE_GEOGTRAN,e.wkt);l.h.geogToGeog(t,s.length,s,null,e.isInverse?l.a.PE_TRANSFORM_2_TO_1:l.a.PE_TRANSFORM_1_TO_2)})),e)for(let n=0;n<s.length;n++){const r=e[n],i=s[n][0],o=i>t?1:i<-t?-1:0;r&&o&&r!==o&&(s[n][0]=r>0?i+360:i-360)}}if(!n.isGeographic){const e=F(n,!0),t=null!=e&&e.isEnvelope?[e.bbox[1],e.bbox[3]]:[-90,90];!function(e,t){const[n,r]=t;for(let t=0;t<e.length;t++){const i=e[t][1];(i<n||i>r)&&(e[t]=[NaN,NaN])}}(s,t);const r=n.wkid?l.P.coordsys(n.wkid):l.P.fromString(n.isGeographic?l.a.PE_TYPE_GEOGCS:l.a.PE_TYPE_PROJCS,n.wkt2||n.wkt);l.g.geogToProj(r,s.length,s)}let a=s;if(o&&s.length!==o.length){a=[];for(let e=0,t=0;e<o.length;e++)o[e]?a.push(s[t++]):a.push([NaN,NaN])}return a}function F(e,t=!1){let n=e.wkid||e.wkt2||e.wkt;if(!n||e.isGeographic)return null;if(n=String(n),M.has(n)){const e=M.get(n);return t?e?.gcs:e?.pcs}const r=e.wkid?l.P.coordsys(e.wkid):l.P.fromString(e.isGeographic?l.a.PE_TYPE_GEOGCS:l.a.PE_TYPE_PROJCS,e.wkt2||e.wkt),i=O(r,P(e,1e-4)),s=O(r,0,!0);return M.set(n,{pcs:i,gcs:s}),t?s:i}function O(e,t=0,n=!1){const r=l.j.generate(e),i=n?e.horizonGcsGenerate():e.horizonPcsGenerate();if(!r||!i?.length)return null;let s=!1,o=i.find((e=>1===e.getInclusive()&&1===e.getKind()));if(!o){if(o=i.find((e=>1===e.getInclusive()&&0===e.getKind())),!o)return null;s=!0}const a=n?0:(2===r.getNorthPoleLocation()?1:0)|(2===r.getSouthPoleLocation()?2:0),u=r.isPannableRectangle(),c=o.getCoord();if(s)return{isEnvelope:s,isPannable:u,vertices:c,coef:null,bbox:[c[0][0]-t,c[0][1]-t,c[1][0]+t,c[1][1]+t],poleLocation:a};let p=0;const h=[];let[f,d]=c[0],[m,y]=c[0];for(let e=0,t=c.length;e<t;e++){p++,p===t&&(p=0);const[n,r]=c[e],[i,s]=c[p];if(s===r)h.push([n,i,r,s,2]);else{const e=(i-n)/(s-r||1e-4),t=n-e*r;r<s?h.push([e,t,r,s,0]):h.push([e,t,s,r,1])}f=f<n?f:n,d=d<r?d:r,m=m>n?m:n,y=y>r?y:r}return{isEnvelope:!1,isPannable:u,vertices:c,coef:h,bbox:[f,d,m,y],poleLocation:a}}function z(e,t){const n=[],{cols:r,rows:i,xres:s,yres:o,usePixelCenter:a}=e;let{xmin:l,ymax:u}=e;if(a&&(l+=s/2,u-=o/2),null==t){for(let e=0;e<r;e++)for(let t=0;t<i;t++)n.push([l+s*e,u-o*t]);return{points:n}}const c=new Uint8Array(r*i);if(t.isEnvelope){const{bbox:[e,a,p,h]}=t;for(let f=0,d=0;f<r;f++){const r=l+s*f,m=t.isPannable||r>=e&&r<=p;for(let e=0;e<i;e++,d++){const t=u-o*e;m&&t>=a&&t<=h&&(n.push([r,t]),c[d]=1)}}return{points:n,mask:c}}const p=t.coef,h=[];for(let e=0;e<i;e++){const t=u-o*e,n=[],r=[];for(let e=0;e<p.length;e++){const[i,s,o,a,l]=p[e];if(t===o&&o===a)n.push(i),n.push(s),r.push(2),r.push(2);else if(t>=o&&t<=a){const e=i*t+s;n.push(e),r.push(l)}}let i=n;if(n.length>2){let e=2===r[0]?0:r[0],t=n[0];i=[];for(let s=1;s<r.length;s++)2===r[s]&&s!==r.length-1||(r[s]!==e&&(i.push(0===e?Math.min(t,n[s-1]):Math.max(t,n[s-1])),e=r[s],t=n[s]),s===r.length-1&&i.push(0===r[s]?Math.min(t,n[s]):Math.max(t,n[s])));i.sort(((e,t)=>e-t))}else n[0]>n[1]&&(i=[n[1],n[0]]);h.push(i)}for(let e=0,t=0;e<r;e++){const r=l+s*e;for(let e=0;e<i;e++,t++){const i=u-o*e,s=h[e];if(2===s.length)r>=s[0]&&r<=s[1]&&(n.push([r,i]),c[t]=1);else if(s.length>2){let e=!1;for(let t=0;t<s.length;t+=2)if(r>=s[t]&&r<=s[t+1]){e=!0;break}e&&(n.push([r,i]),c[t]=1)}}}return{points:n,mask:c}}function j(e,t){const n=V(e[0].spatialReference);if(e.length<2||null==n)return e[0];if(t=t??P(e[0].spatialReference),1===(e=e.filter((e=>e.width>t))).length)return e[0];let{xmin:r,xmax:i,ymin:s,ymax:o}=e[0];for(let t=1;t<e.length;t++){const r=e[t];i=r.xmax+n*t,s=Math.min(s,r.ymin),o=Math.max(o,r.ymax)}return new p.default({xmin:r,xmax:i,ymin:s,ymax:o,spatialReference:e[0].spatialReference})}function B(e,t,n=null,i=!0){const o=e.spatialReference;if(o.equals(t))return e;const a=W(e),l=V(o,!0),c=V(t);if(0===a||null==l||null==c){const s=U(e,t,n,i);if(null==l&&null!=c&&Math.abs(s.width-c)<P(t)&&(0,u.isLoaded)()){const n=F(o);if(null!=n&&n.poleLocation===r.None&&e.width<(n.bbox[2]-n.bbox[0])/2)return function(e,t){const n=V(t);if(null==n)return null;let{xmin:r,ymin:i,xmax:s,ymax:o}=e;const a=e.spatialReference,l=new h.A({spatialReference:a,rings:[[[r,i],[s,i],[s,o],[r,o],[r,i]]]}),c=(0,u.project)(l,t);if(2!==c.rings.length||!c.rings[0].length||!c.rings[1].length)return null;const{rings:f}=c,d=P(a),m=new p.default({spatialReference:t});for(let e=0;e<2;e++){r=s=f[e][0][0],i=o=f[e][0][1];for(let t=0;t<f[e].length;t++)r=r>f[e][t][0]?f[e][t][0]:r,s=s<f[e][t][0]?f[e][t][0]:s,i=i>f[e][t][1]?f[e][t][1]:i,o=o<f[e][t][1]?f[e][t][1]:o;if(0===e)m.ymin=i,m.ymax=o,m.xmin=r,m.xmax=s;else if(m.ymin=Math.min(m.ymin,i),m.ymax=Math.max(m.ymax,o),Math.abs(s-n/2)<d)m.xmin=r,m.xmax=m.xmax+n;else{if(!(Math.abs(r+n/2)<d))return null;m.xmax=s+n}}return m}(e,t)||s}return s}const f=e.clone().normalize();if(1===f.length&&e.xmax<l&&e.xmax-l/2>P(o)){const{xmin:t,xmax:n}=e;for(let r=0;r<=a;r++){const i=0===r?t:-l/2,s=r===a?n-l*r:l/2;f[r]=new p.default({xmin:i,xmax:s,ymin:e.ymin,ymax:e.ymax,spatialReference:o})}}return j(f.map((e=>U(e,t,n,i))).filter(s.Ru))}function Z(e,t,n){if("extent"===e.type){const{xmin:t,ymin:n,xmax:r,ymax:i,spatialReference:s}=e;e=new h.A({rings:[[[t,i],[r,i],[r,n],[t,n],[t,i]]],spatialReference:s})}return e.spatialReference.equals(t)?e:(y(e.spatialReference,t,n),(0,u.project)(e,t,n))}function U(e,t,n=null,r=!0,i=!0){const s=e.spatialReference;if(s.equals(t)||!t)return e;y(s,t,n);const o=(0,u.project)(e,t,n);if(i&&t.isWebMercator&&o&&(o.ymax=Math.min(20037508.342787,o.ymax),o.ymin=Math.max(-20037508.342787,o.ymin),o.ymin>=o.ymax))return null;if(!r||!o)return o;const a=G(s,!0),l=G(t,!0);if(null==a||null==l)return o;const c=P(s,.001),p=P(s,I),h=P(t,.001);if(Math.abs(o.xmin-l[0])<h&&Math.abs(o.xmax-l[1])<h){const r=Math.abs(e.xmin-a[0]),i=Math.abs(a[1]-e.xmax);if(r<c&&i>p){o.xmin=l[0];const r=[];r.push(new f.default(e.xmax,e.ymin,s)),r.push(new f.default(e.xmax,(e.ymin+e.ymax)/2,s)),r.push(new f.default(e.xmax,e.ymax,s));const i=r.map((e=>N(e,t,n))).filter((e=>!isNaN(e?.x))).map((e=>e.x));o.xmax=Math.max.apply(null,i)}if(i<c&&r>p){o.xmax=l[1];const r=[];r.push(new f.default(e.xmin,e.ymin,s)),r.push(new f.default(e.xmin,(e.ymin+e.ymax)/2,s)),r.push(new f.default(e.xmin,e.ymax,s));const i=r.map((e=>N(e,t,n))).filter((e=>!isNaN(e?.x))).map((e=>e.x));o.xmin=Math.min.apply(null,i)}}else{const e=P(t,.001);Math.abs(o.xmin-l[0])<e&&(o.xmin=l[0]),Math.abs(o.xmax-l[1])<e&&(o.xmax=l[1])}return o}function V(e,t=!1){if(!e)return null;const n=t?20037508.342787:20037508.342788905;return e.isWebMercator?2*n:e.wkid&&e.isGeographic?360:2*w[e.wkid]||null}function G(e,t=!1){if(e.isGeographic)return[-180,180];const n=V(e,t);return null!=n?[-n/2,n/2]:null}function H(e,t,n,r){let i=(e-t)/n;return i-Math.floor(i)!=0?i=Math.floor(i):r&&(i-=1),i}function W(e,t=!1){const n=V(e.spatialReference);if(null==n)return 0;const r=t?0:-n/2,i=P(e.spatialReference),s=!t&&Math.abs(e.xmax-n/2)<i?n/2:e.xmax,o=!t&&Math.abs(e.xmin+n/2)<i?-n/2:e.xmin;return H(s,r,n,!0)-H(o,r,n,!1)}function J(e){const t=e.storageInfo.origin.x,n=V(e.spatialReference,!0);if(null==n)return{originX:t,halfWorldWidth:null,pyramidsInfo:null};const r=n/2,{nativePixelSize:i,storageInfo:s,extent:o}=e,{maximumPyramidLevel:a,blockWidth:l,pyramidScalingFactor:u}=s;let c=i.x;const p=[],h=null!=e.transform&&"gcs-shift"===e.transform.type,f=t+(h?0:r),d=h?n-t:r-t;for(let e=0;e<=a;e++){const e=(o.xmax-t)/c/l,n=e-Math.floor(e)==0?e:Math.ceil(e),r=d/c/l,i=r-Math.floor(r)==0?r:Math.ceil(r),s=Math.floor(f/c/l),a=Math.round(f/c)%l,h=(l-Math.round(d/c)%l)%l;p.push({resolutionX:c,blockWidth:l,datasetColumnCount:n,worldColumnCountFromOrigin:i,leftMargin:a,rightPadding:h,originColumnOffset:s}),c*=u}return{originX:t,halfWorldWidth:r,pyramidsInfo:p,hasGCSSShiftTransform:h}}function q(e){const t=e.isAdaptive&&null==e.spacing;let n=e.spacing||[b,b],r=$(e),i={cols:r.size[0]+1,rows:r.size[1]+1};const s=r.outofBoundPointCount>0&&r.outofBoundPointCount<r.offsets.length/2;let o=r.outofBoundPointCount===r.offsets.length/2||t&&s?[0,0]:g(r.offsets,i,n,x);const a=(o[0]+o[1])/2,u=e.projectedExtent.spatialReference,c=e.srcBufferExtent.spatialReference;if(t&&(s||a>x)&&(m(u,c,e.datumTransformation)&&(u.isGeographic||F(u)),n=[v,v],r=$({...e,spacing:n}),i={cols:r.size[0]+1,rows:r.size[1]+1},o=g(r.offsets,i,n,x)),r.error=o,n[0]>1&&(r.coefficients=K(r.offsets,i,s)),e.includeGCSGrid&&!u.isGeographic&&!u.isWebMercator)if(c.isGeographic)r.gcsGrid={offsets:r.offsets,coefficients:r.coefficients,spacing:n};else{const t=F(u);if(null!=t&&!t.isEnvelope){const t=function(e){if(!e||e.isGeographic)return e;const t=String(e.wkid||e.wkt2||e.wkt);let n;return A.has(t)?n=A.get(t):(n=(e.wkid?l.P.coordsys(e.wkid):l.P.fromString(l.a.PE_TYPE_PROJCS,e.wkt2||e.wkt)).getGeogcs().getCode(),A.set(t,n)),new d.A({wkid:n})}(u),o=B(e.projectedExtent,t),{offsets:a}=$({...e,srcBufferExtent:o,spacing:n}),c=K(a,i,s);r.gcsGrid={offsets:a,coefficients:c,spacing:n}}}return r}function $(e){const{projectedExtent:t,srcBufferExtent:n,pixelSize:r,datumTransformation:i,rasterTransform:s}=e,o=t.spatialReference,a=n.spatialReference,l=y(o,a),{xmin:u,ymin:c,xmax:p,ymax:h}=t,d=V(a),m=null!=d&&(e.hasWrapAround||"gcs-shift"===s?.type),g=e.spacing||[b,b],w=g[0]*r.x,x=g[1]*r.y,M=1===g[0],A=Math.ceil((p-u)/w-.1/g[0])+(M?0:1),S=Math.ceil((h-c)/x-.1/g[1])+(M?0:1),_=E({cols:A,rows:S,xmin:u,ymax:h,xres:w,yres:x,inSR:o,outSR:a,datumTransformation:i,preferPE:g[0]<=v,usePixelCenter:M}),C=[];let T,k=0;const R=M?-1:NaN,{xmin:N,xmax:D,ymax:L,width:O,height:z}=n,j=P(a,I),B=null!=d&&N>0&&D>d/2;let Z=!1;if(l){const e=F(o);Z=null!=e&&e.poleLocation>0}for(let e=0;e<A;e++){const t=[];for(let n=0;n<S;n++){let r=_[e*S+n];if(m&&r[0]>D&&r[0]>d/2-j?r[0]-=d:m&&0===e&&r[0]<0&&B&&!s&&(r[0]+=d),!r||isNaN(r[0])||isNaN(r[1]))C.push(R),C.push(R),t.push(null),k++;else{if(s){const e=s.inverseTransform(new f.default({x:r[0],y:r[1],spatialReference:a}));r=[e.x,e.y]}t.push(r),e>0&&m&&T[n]&&r[0]<T[n][0]&&(r[0]+=d,Z&&r[0]>D&&r[0]>d&&(r[0]-=d)),C.push((r[0]-N)/O),C.push((L-r[1])/z)}}T=t}return{offsets:C,error:null,coefficients:null,outofBoundPointCount:k,spacing:g,size:M?[A,S]:[A-1,S-1]}}function K(e,t,n){const{cols:r,rows:i}=t,s=new Float32Array((r-1)*(i-1)*2*6),o=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),a=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let t=0;t<r-1;t++){for(let n=0;n<i-1;n++){let l=t*i*2+2*n;const u=e[l],c=e[l+1],p=e[l+2],h=e[l+3];l+=2*i;const f=e[l],d=e[l+1],m=e[l+2],y=e[l+3];let g=0,w=12*(n*(r-1)+t);for(let e=0;e<3;e++)s[w++]=o[g++]*u+o[g++]*p+o[g++]*m;g=0;for(let e=0;e<3;e++)s[w++]=o[g++]*c+o[g++]*h+o[g++]*y;g=0;for(let e=0;e<3;e++)s[w++]=a[g++]*u+a[g++]*f+a[g++]*m;g=0;for(let e=0;e<3;e++)s[w++]=a[g++]*c+a[g++]*d+a[g++]*y}if(n)for(let e=0;e<s.length;e++)isNaN(s[e])&&(s[e]=-1)}return s}function Y(e){const{spatialReference:t}=e,n=(0,c.Vp)(t);if(!n)return e;const[r,i]=n.valid,s=i-r;let o=0;if(e.xmin<r){const t=r-e.xmin;o=Math.ceil(t/s)}else if(e.xmin>i){const t=e.xmin-i;o=-Math.ceil(t/s)}return new p.default({spatialReference:e.spatialReference,xmin:e.xmin+o*s,ymin:e.ymin,xmax:e.xmax+o*s,ymax:e.ymax})}function X(e,t,n){const{storageInfo:r,pixelSize:i}=t;let s=0,o=!1;const{pyramidResolutions:l}=r,u="mixed"===r.tileInfo.format?.toLowerCase()?Math.max(1,Math.min(3,r.tileInfo.dpi/96)):1,c=(e.x+e.y)/2/u;if(null!=l&&l.length){const e=l[l.length-1],r=(e.x+e.y)/2,u=(i.x+i.y)/2;if(c<=u)s=0;else if(c>=r)s=l.length,o=c/r>8;else{let e,t=u;for(let r=1;r<=l.length;r++){if(e=(l[r-1].x+l[r-1].y)/2,c<=e){c===e?s=r:"down"===n?(s=r-1,o=c/t>8):s="up"===n||c-t>e-c||c/t>2?r:r-1;break}t=e}}const p=0===s?i:l[s-1];return o&&Math.min(p.x,p.y)*(0,a.GA)(t.spatialReference)>19567&&(o=!1),{pyramidLevel:s,pyramidResolution:new f.default({x:p.x,y:p.y,spatialReference:t.spatialReference}),excessiveReading:o}}const p=Math.log(e.x/i.x)/Math.LN2,h=Math.log(e.y/i.y)/Math.LN2,d=t.storageInfo.maximumPyramidLevel||0;s="down"===n?Math.floor(Math.min(p,h)):"up"===n?Math.ceil(Math.max(p,h)):Math.round((p+h)/2),s<0?s=0:s>d&&(o=s>d+3,s=d);const m=2**s;return{pyramidLevel:s,pyramidResolution:new f.default({x:m*t.nativePixelSize.x,y:m*t.nativePixelSize.y,spatialReference:t.spatialReference}),excessiveReading:o}}function Q(e,t){const{pixelSize:n,extent:r}=e,i=C(r,t,!1);return B(function(e,t){const n=e.clone().normalize();return 1===n.length?n[0]:j(n,t)}(r,(n.x+n.y)/16),t,i)}function ee(e,t,n){const r=n?.tileSize??512,i=n?.alignGlobalDatasetWithAGOL??!0,s=!!n?.limitToSrcResolution,{extent:o,spatialReference:l,pixelSize:u}=e,c=R(u,t,o);if(null==c)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};const p=(c.x+c.y)/2,h=(0,a.GA)(t),f=p*h*96*39.37,m=t.isGeographic?256/r*295828763.7958547:256/r*591657527.591555;let y="vector-magdir"===e.dataType||"vector-uv"===e.dataType;const g=Q(e,t),w=Math.min(Math.ceil(Math.log(Math.min(e.width,e.height)/32)/Math.LN2),Math.ceil(Math.log(m/2/f)/Math.LN2));if(!y&&i&&(t.isGeographic||t.isWebMercator)){const n=V(t);if(y=W(g)>0||null!=n&&g.width>n/4,!y&&null!=n){let t=-1;if(w<3)t=2**w*p*r;else if(e.storageInfo){const{maximumPyramidLevel:n=0,pyramidScalingFactor:i=2}=e.storageInfo;t=i**n*p*r}const i=Math.ceil(n/t);y=1===i||2===i&&n/2-g.xmax<t}}let b,v=f;const x=1.001,M=Math.min(2,Math.max(1.414,e.storageInfo?.pyramidScalingFactor||2));if(y){v=m;const n=t.isGeographic?1341104507446289e-21:.29858214164761665,r=n*(96*h*39.37),i=t.isGeographic?4326:3857;b=R({x:n,y:n},l,Q(e,new d.A({wkid:i}))),b.x*=v/r,b.y*=v/r}else{b={x:u.x,y:u.y};let e=0;for(;v<m*(x/2)&&e<w;)e++,v*=M,b.x*=M,b.y*=M;Math.max(v,m)/Math.min(v,m)<=x&&(v=m)}const A=[v],I=[{x:b.x,y:b.y}],S=Math.min(70.5310735,f)/x;for(;v>=S;)v/=M,b.x/=M,b.y/=M,A.push(v),I.push({x:b.x,y:b.y});if(s){const e=.001*u.x;let t=I.findIndex((t=>t.x>=u.x-e&&t.x<=u.x+e));t>-1?(I.length=t+1,A.length=t+1):(t=I.findIndex((t=>t.x<=u.x+e)),t>0&&(I.length=t,A.length=t))}return{projectedPixelSize:c,scales:A,srcResolutions:I,isCustomTilingScheme:!y}}},72567:function(e,t,n){n.d(t,{DP:function(){return g},Nh:function(){return w},Pg:function(){return y},RP:function(){return c},WF:function(){return u},_N:function(){return b},eH:function(){return d},f4:function(){return m},fP:function(){return h},zj:function(){return p}});var r=n(95929),i=n(21327),s=n(95738),o=n(41259);const a=1,l=[.299,.587,.114];function u(e,t=256){t=Math.min(t,256);const{size:n,counts:r}=e,i=new Uint8Array(n),s=r.reduce(((e,n)=>e+n/t),0);let o=0,a=0,l=0,u=s;for(let e=0;e<n;e++)if(l+=r[e],!(e<n-1&&l+r[e+1]<u)){for(;o<t-1&&u<l;)o++,u+=s;for(let t=a;t<=e;t++)i[t]=o;a=e+1}for(let e=a;e<n;e++)i[e]=t-1;return i}function c(e){const{minCutOff:t,maxCutOff:n,gamma:r,pixelType:i,rounding:s}=e,o=e.outMin||0,a=e.outMax||255;if(!["u8","u16","s8","s16"].includes(i))return null;const l=t.length;let u,c,h=0;"s8"===i?h=-127:"s16"===i&&(h=-32767);let f=256;["u16","s16"].includes(i)&&(f=65536);const d=[],m=[],y=a-o;for(u=0;u<l;u++)m[u]=n[u]-t[u],d[u]=0===m[u]?0:y/m[u];let g;const b=[];let v,x,M;if(r&&r.length>=l){const e=w(l,r);for(u=0;u<l;u++){for(M=[],c=0;c<f;c++)if(0!==m[u])if(v=c+h,g=(v-t[u])/m[u],x=1,r[u]>1&&(x-=(1/y)**(g*e[u])),v<n[u]&&v>t[u]){const e=x*y*g**(1/r[u])+o;M[c]="floor"===s?Math.floor(e):"round"===s?Math.round(e):e}else v>=n[u]?M[c]=a:M[c]=o;else M[c]=o;b[u]=M}}else for(u=0;u<l;u++){for(M=[],c=0;c<f;c++)if(v=c+h,v<=t[u])M[c]=o;else if(v>=n[u])M[c]=a;else{const e=(v-t[u])*d[u]+o;M[c]="floor"===s?Math.floor(e):"round"===s?Math.round(e):e}b[u]=M}if(null!=e.contrastOffset){const t=p(e.contrastOffset,e.brightnessOffset);for(u=0;u<l;u++)for(M=b[u],c=0;c<f;c++)M[c]=t[M[c]]}return{lut:b,offset:h}}function p(e,t){const n=Math.min(Math.max(e,-100),100),r=Math.min(Math.max(t??0,-100),100);let i=0,s=0;const o=new Uint8Array(256);for(i=0;i<256;i++)n>0&&n<100?s=(200*i-25500+510*r)/(2*(100-n))+128:n<=0&&n>-100?s=(200*i-25500+510*r)*(100+n)/2e4+128:100===n?(s=200*i-25500+256*(100-n)+510*r,s=s>0?255:0):-100===n&&(s=128),o[i]=s>255?255:s<0?0:s;return o}function h(e,t,n){const r=[];for(let i=0;i<t.length;i++){let s=0,o=0,a=0;"min"in t[i]?({min:s,max:o,avg:a}=t[i]):[s,o,a]=t[i];let u=a??0;"u8"!==e&&(u=255*(u-s)/(o-s)),n&&(u*=l[i]),r.push(f(u))}return r}function f(e){if(e<=0||e>=255)return a;let t=0;150!==e&&(t=e<=150?45*Math.cos(.01047*e):17*Math.sin(.021*e));const n=e+t,r=Math.log(e/255),i=Math.log(n/255);if(0===i)return a;const s=r/i;return isNaN(s)?a:Math.min(9.9,Math.max(.01,s))}function d(e){const{pixels:t,mask:n,pixelType:r,bandMasks:i}=e,s=t.map(((e,t)=>function(e,t,n){let r=1/0,i=-1/0,s=0,o=0,a=0,l=0;const u=e.length,c=new Map,p=[];for(let n=0;n<u;n++){const u=e[n];if(!t||t[n]){p.push(u);const e=(c.get(u)??0)+1;c.set(u,e),e>l&&(l=e,a=u),r=u<r?u:r,i=u>i?u:i,s+=u,o++}}if(0===o)return{statistics:{min:0,max:0,avg:0,stddev:0,mode:0,median:0},histogram:null};const h=s/o;let f=0;for(let n=0;n<u;n++)t&&!t[n]||(f+=(e[n]-h)**2);const d=t?t.filter((e=>e)).length:u,m=d<=1?0:Math.sqrt(f/(d-1));p.sort(((e,t)=>e-t));const y=o>>>1,g={min:r,max:i,avg:h,stddev:m,mode:a,median:o%2?p[Math.floor(y)]:(p[y-1]+p[y])/2};if(["u8","s8","u4","u2","u1"].includes(n)){const n=i-r+1,s=new Uint32Array(n);for(let n=0;n<u;n++)t&&!t[n]||s[e[n]-r]++;return{statistics:g,histogram:{min:r-.5,max:i+.5,size:n,counts:s}}}const w=256,b=new Uint32Array(w),v=(i-r)/w;if(0===v)return{statistics:g,histogram:{min:r,max:i,size:1,counts:new Uint32Array(1).fill(o)}};const x=new Uint32Array(257);for(let n=0;n<u;n++)t&&!t[n]||x[Math.floor((e[n]-r)/v)]++;for(let e=0;e<255;e++)b[e]=x[e];return b[255]=x[255]+x[w],{statistics:g,histogram:{min:r,max:i,size:w,counts:b}}}(e,i?.[t]??n,r)));return{statistics:s.map((({statistics:e})=>e)),histograms:s.map((({histogram:e})=>e))}}function m(e){if(!e?.pixels?.length)return null;const{pixels:t,mask:n,bandMasks:r,pixelType:i}=e,s=e.width*e.height,o=t.length,a=[],l=[],u=256;let c,p,h,f;for(let d=0;d<o;d++){h=new Uint32Array(u);const o=t[d],m=r?.[d]??n;if("u8"===i){if(c=255,p=0,m){for(let e=0;e<s;e++)if(m[e]){const t=o[e];c=t<c?t:c,p=t>p?t:p,h[t]++}}else for(let e=0;e<s;e++){const t=o[e];c=t<c?t:c,p=t>p?t:p,h[t]++}h=h.slice(c,p+1)}else{let t=!1;e.statistics||(e.updateStatistics(),t=!0);const n=e.statistics;c=n[d].minValue,p=n[d].maxValue;const r=(p-c)/u;if(0===r){!n||e.validPixelCount||t||e.updateStatistics();const r=(e.validPixelCount||e.width*e.height)/u;for(let e=0;e<u;e++)h[e]=Math.round(r*(e+1))-Math.round(r*e)}else{f=new Uint32Array(257);for(let e=0;e<s;e++)m&&!m[e]||f[Math.floor((o[e]-c)/r)]++;for(let e=0;e<255;e++)h[e]=f[e];h[255]=f[255]+f[u]}}const y="u8"===i?c-.5:c,g="u8"===i?p+.5:p;a.push({min:y,max:g,size:h.length,counts:h});let w=0,b=0,v=0;for(let e=0;e<h.length;e++)w+=h[e],b+=e*h[e];const x=b/w;for(let e=0;e<h.length;e++)v+=h[e]*(e-x)**2;const M=Math.sqrt(v/(w-1)),A=(g-y)/h.length,I=(x+("u8"===i?0:.5))*A+c,S=M*A;l.push({min:c,max:p,avg:I,stddev:S})}return{statistics:l,histograms:a}}function y(e){const t=[];for(let n=0;n<e.length;n++){const{min:r,max:i,size:s,counts:o}=e[n];let a=0,l=0;for(let e=0;e<s;e++)a+=o[e],l+=e*o[e];const u=l/a;let c=0;for(let e=0;e<s;e++)c+=o[e]*(e-u)**2;const p=(i-r)/s,h=(u+.5)*p+r,f=Math.sqrt(c/(a-1))*p;t.push({min:r,max:i,avg:h,stddev:f})}return t}function g(e,t){const{pixelBlock:n,bandIds:i,returnHistogramLut:a,rasterInfo:l}=t;let c=null,p=null,h=e.stretchType;if("number"==typeof h&&(h=o.x[h]),e.dra)if("minMax"===h&&n?.statistics)c=n.statistics.map((e=>[e.minValue,e.maxValue,0,0]));else{const e=m(n);c=null!=e?e.statistics:null,p=null!=e?e.histograms:null}else c=e.statistics?.length?e.statistics:l.statistics,p="histograms"in e?e.histograms:void 0,p||(p=l.histograms);"percentClip"!==h&&"histogramEqualization"!==h||p?.length||(h="minMax");const f=c?.length||p?.length||l.bandCount,d=[],y=[];let g,w,b,v,x,M,A,I,S;c&&!Array.isArray(c[0])&&(c=c.map((e=>[e.min,e.max,e.avg,e.stddev])));const[_,C]=(0,s.hP)(l.pixelType);if(!c?.length){for(c=[],I=0;I<f;I++)c.push([_,C,1,1]);"standardDeviation"===h&&(h="minMax")}switch(h){case"none":for(I=0;I<f;I++)d[I]=_,y[I]=C;break;case"minMax":for(I=0;I<f;I++){const e=c[I];d[I]=e[0],y[I]=e[1]}break;case"standardDeviation":{const{numberOfStandardDeviations:t=2}=e;for(I=0;I<f;I++){const e=c[I];d[I]=e[2]-t*e[3],y[I]=e[2]+t*e[3],d[I]<e[0]&&(d[I]=e[0]),y[I]>e[1]&&(y[I]=e[1])}}break;case"histogramEqualization":for((0,r.Lw)(p),I=0;I<f;I++)d[I]=p[I].min,y[I]=p[I].max;break;case"percentClip":for((0,r.Lw)(p),I=0;I<p.length;I++){for(g=p[I],x=new Uint32Array(g.size),v=[...g.counts],v.length>=20&&(v[0]=v[1]=v[2]=v[v.length-1]=v[v.length-2]=0),b=0,w=(g.max-g.min)/g.size,A=-.5===g.min&&1===w?.5:0,S=0;S<g.size;S++)b+=v[S],x[S]=b;for(M=(e.minPercent||0)*b/100,d[I]=g.min+A,S=0;S<g.size;S++)if(x[S]>M){d[I]=g.min+w*(S+A);break}for(M=(1-(e.maxPercent||0)/100)*b,y[I]=g.max+A,S=g.size-2;S>=0;S--)if(x[S]<M){y[I]=g.min+w*(S+2-A);break}if(y[I]<d[I]){const e=d[I];d[I]=y[I],y[I]=e}}break;default:for(I=0;I<f;I++){const e=c[I];d[I]=e[0],y[I]=e[1]}}let T,k,R;return"histogramEqualization"===h?((0,r.Lw)(p),k=p[0].size||256,T=0,a&&(R=p.map((e=>u(e))))):(k=e.max||255,T=e.min||0),function(e,t){if(null==t||0===t.length)return e;const n=Math.max.apply(null,t),{minCutOff:r,maxCutOff:i,outMin:s,outMax:o,histogramLut:a}=e;return r.length===t.length||r.length<=n?e:{minCutOff:t.map((e=>r[e])),maxCutOff:t.map((e=>i[e])),histogramLut:a?t.map((e=>a[e])):null,outMin:s,outMax:o}}({minCutOff:d,maxCutOff:y,outMax:k,outMin:T,histogramLut:R},i)}function w(e,t){const n=new Float32Array(e);for(let r=0;r<e;r++)t[r]>1?t[r]>2?n[r]=6.5+(t[r]-2)**2.5:n[r]=6.5+100*(2-t[r])**4:n[r]=1;return n}function b(e,t){if(!e?.pixels?.length)return e;const{mask:n,bandMasks:r,width:s,height:o,pixels:a}=e,{minCutOff:l,maxCutOff:u,gamma:c}=t,p=t.outMin||0,h=t.outMax||255,f=s*o,d=t.outputPixelType||"u8",m=e.pixels.map((()=>i.A.createEmptyBand(d,f))),y=m.length,g=h-p,b=[],v=[];for(let e=0;e<y;e++)v[e]=u[e]-l[e],b[e]=0===v[e]?0:g/v[e];const x=d.startsWith("u")||d.startsWith("s"),M=c&&c.length>=y,A=!!t.isRenderer;if(M){const e=w(y,c);for(let t=0;t<y;t++){const i=r?.[t]??n;for(let n=0;n<f;n++)if(null==i||i[n]){if(0===v[t]){m[t][n]=p;continue}const r=a[t][n],i=(r-l[t])/v[t];let s=1;if(c[t]>1&&(s-=(1/g)**(i*e[t])),r<u[t]&&r>l[t]){const e=s*g*i**(1/c[t])+p;m[t][n]=A?Math.floor(e):x?Math.round(e):e}else r>=u[t]?m[t][n]=h:m[t][n]=p}}}else for(let e=0;e<y;e++){const t=r?.[e]??n;for(let n=0;n<f;n++)if(null==t||t[n]){const t=a[e][n];if(t<u[e]&&t>l[e]){const r=(t-l[e])*b[e]+p;m[e][n]=A?Math.floor(r):x?Math.round(r):r}else t>=u[e]?m[e][n]=h:m[e][n]=p}}const I=new i.A({width:s,height:o,mask:n,bandMasks:r,pixels:m,pixelType:d});return I.updateStatistics(),I}},55469:function(e,t,n){n.d(t,{E0:function(){return m},PP:function(){return y},SC:function(){return h},di:function(){return d},fw:function(){return p},ng:function(){return l},rk:function(){return a},yy:function(){return f}});var r=n(21327),i=n(42568),s=n(43264);const o=1,a=1/111e3;function l(e){let{altitude:t,azimuth:n}=e;const{hillshadeType:r,pixelSizePower:i=1,pixelSizeFactor:s=1,scalingType:o,isGCS:l,resolution:u}=e,c="multi-directional"===r?2*e.zFactor:e.zFactor,{x:p,y:h}=u;let f=c/(8*p),d=c/(8*h);if(l&&c>.001&&(f/=a,d/=a),"adjusted"===o)if(l){const e=p*a,t=h*a;f=(c+e**i*s)/(8*e),d=(c+t**i*s)/(8*t)}else f=(c+p**i*s)/(8*p),d=(c+h**i*s)/(8*h);let m=(90-t)*Math.PI/180,y=Math.cos(m),g=(360-n+90)*Math.PI/180,w=Math.sin(m)*Math.cos(g),b=Math.sin(m)*Math.sin(g);const v=[315,270,225,360,180,0],x=[60,60,60,60,60,90],M=new Float32Array([3,5,3,2,1,4]),A=M.reduce(((e,t)=>e+t)),I=M.map((e=>e/A)),S="multi-directional"===r?v.length:1,_=new Float32Array(6),C=new Float32Array(6),T=new Float32Array(6);if("multi-directional"===r)for(let e=0;e<S;e++)t=x[e],n=v[e],m=(90-t)*Math.PI/180,y=Math.cos(m),g=(360-n+90)*Math.PI/180,w=Math.sin(m)*Math.cos(g),b=Math.sin(m)*Math.sin(g),_[e]=y,C[e]=w,T[e]=b;else _.fill(y),C.fill(w),T.fill(b);return{resolution:u,factor:[f,d],sinZcosA:w,sinZsinA:b,cosZ:y,sinZcosAs:C,sinZsinAs:T,cosZs:_,weights:I,hillshadeType:["traditional","multi-directional"].indexOf(r)}}function u(e,t){const{width:n,height:r}=e,i=n*r,s=new Uint8Array(i),a=null!=e.mask;let l;if(a){l=new Uint8Array(e.mask);for(let e=0;e<l.length;e++)l[e]&&(s[e]=1,l[e]=1)}const u=e.pixels[0],c=new Float32Array(i),p=new Float32Array(i);let h,f=0;if(t){const{resolution:e}=t,n=e?(e.x+e.y)/2:1;f=200*t.zFactor/(n*n),h=new Float32Array(i)}const d=t?.curvatureType;let m,y,g,w,b,v,x,M;for(let e=o;e<r-o;e++){const t=e*n;for(let e=o;e<n-o;e++){const r=t+e;if(!l||0!==l[r]){if(l){if(l[r-n-1]+l[r-n]+l[r-n+1]+l[r-1]+l[r+1]+l[r+n-1]+l[r+n]+l[r+n+1]<7){s[r]=0;continue}m=l[r-n-1]?u[r-n-1]:u[r],y=l[r-n]?u[r-n]:u[r],g=l[r-n+1]?u[r-n+1]:u[r],w=l[r-1]?u[r-1]:u[r],b=l[r+1]?u[r+1]:u[r],v=l[r+n-1]?u[r+n-1]:u[r],x=l[r+n]?u[r+n]:u[r],M=l[r+n+1]?u[r+n+1]:u[r]}else m=u[r-n-1],y=u[r-n],g=u[r-n+1],w=u[r-1],b=u[r+1],v=u[r+n-1],x=u[r+n],M=u[r+n+1];if(c[r]=g+b+b+M-(m+w+w+v),p[r]=v+x+x+M-(m+y+y+g),null!=h){const e=u[r],t=.5*(w+b)-e,n=.5*(y+x)-e;if("standard"===d)h[r]=-f*(t+n);else{const e=(-m+g+v-M)/4,i=(-w+b)/2,s=(y-x)/2,o=i*i,a=s*s,l=o+a;l&&(h[r]="profile"===d?f*(t*o+n*a+e*i*s)/l:-f*(t*a+n*o-e*i*s)/l)}}}}}return{outMask:a?s:null,dzxs:c,dzys:p,curvatures:h}}function c(e,t,n){for(let r=0;r<n;r++)e[r*t]=e[r*t+1],e[(r+1)*t-1]=e[(r+1)*t-2];for(let r=1;r<t-1;r++)e[r]=e[r+t],e[r+(n-1)*t]=e[r+(n-2)*t]}function p(e,t){if(!(0,s.AB)(e))return e;const{factor:n,sinZcosA:a,sinZsinA:p,cosZ:h,sinZcosAs:f,sinZsinAs:d,cosZs:m,weights:y}=l(t),[g,w]=n,b="traditional"===t.hillshadeType,{width:v,height:x}=e,M=new Uint8Array(v*x),{dzxs:A,dzys:I,outMask:S}=u(e);for(let e=o;e<x-o;e++){const t=e*v;for(let e=o;e<v-o;e++){const n=t+e;if(!S||S[n]){const e=A[n]*g,t=I[n]*w,r=Math.sqrt(1+e*e+t*t);let i=0;if(b){let n=255*(h+p*t-a*e)/r;n<0&&(n=0),i=n}else{const n=d.length;for(let s=0;s<n;s++){let n=255*(m[s]+d[s]*t-f[s]*e)/r;n<0&&(n=0),i+=n*y[s]}}M[n]=255&i}}}return c(M,v,x),new r.A({width:v,height:x,pixels:[M],mask:S,pixelType:"u8",validPixelCount:e.validPixelCount,statistics:[new i.z(0,255)]})}function h(e,t,n,r){if(!(0,s.AB)(e)||!(0,s.AB)(t))return;const{min:i,max:o}=r,a=e.pixels[0],{pixels:l,mask:u}=t,c=l[0],p=255.00001/(o-i),h=new Uint8ClampedArray(c.length),f=new Uint8ClampedArray(c.length),d=new Uint8ClampedArray(c.length),m=n.length-1;for(let e=0;e<c.length;e++){if(u&&0===u[e])continue;const t=Math.floor((c[e]-i)*p),[r,s]=n[t<0?0:t>m?m:t],o=a[e],l=o*s,y=l*(1-Math.abs(r%2-1)),g=o-l;switch(Math.floor(r)){case 0:h[e]=l+g,f[e]=y+g,d[e]=g;break;case 1:h[e]=y+g,f[e]=l+g,d[e]=g;break;case 2:h[e]=g,f[e]=l+g,d[e]=y+g;break;case 3:h[e]=g,f[e]=y+g,d[e]=l+g;break;case 4:h[e]=y+g,f[e]=g,d[e]=l+g;break;case 5:case 6:h[e]=l+g,f[e]=g,d[e]=y+g}}e.pixels=[h,f,d],e.updateStatistics()}function f(e,t){if(!(0,s.AB)(e))return e;const n=t.zFactor,i=t.pixelSizePower??1,l=t.pixelSizeFactor??1,p=t.slopeType,h=t.isGCS,{x:f,y:d}=t.resolution;let m=n/(8*f),y=n/(8*d);h&&Math.abs(n-1)<1e-4&&(m/=a,y/=a),"adjusted"===p&&(m=(n+f**i*l)/(8*f),y=(n+d**i*l)/(8*d));const{dzxs:g,dzys:w,outMask:b}=u(e),{width:v,height:x}=e,M=new Float32Array(v*x);for(let e=o;e<x-o;e++){const t=e*v;for(let e=o;e<v-o;e++){const n=t+e;if(!b||b[n]){const r=g[n]*m,i=w[n]*y,s=Math.sqrt(r*r+i*i);M[t+e]="percent-rise"===p?100*s:57.2957795*Math.atan(s)}}}c(M,v,x);const A=new r.A({width:v,height:x,pixels:[M],mask:b,pixelType:"f32",validPixelCount:e.validPixelCount});return A.updateStatistics(),A}function d(e,t={}){if(!(0,s.AB)(e))return e;const{resolution:n}=t,a=n?1/n.x:1,l=n?1/n.y:1,{dzxs:p,dzys:h,outMask:f}=u(e),{width:d,height:m}=e,y=new Float32Array(d*m);for(let e=o;e<m-o;e++){const t=e*d;for(let e=o;e<d-o;e++){const n=t+e;if(!f||f[n]){const r=p[n]*a,i=h[n]*l;let s=-1;0===r&&0===i||(s=90-57.29578*Math.atan2(i,-r),s<0&&(s+=360),360===s?s=0:s>360&&(s%=360)),y[t+e]=s}}}return c(y,d,m),new r.A({width:d,height:m,pixels:[y],mask:f,pixelType:"f32",validPixelCount:e.validPixelCount,statistics:[new i.z(-1,360)]})}function m(e,t){if(!(0,s.AB)(e))return e;const{curvatures:n,outMask:i}=u(e,t),{width:o,height:a}=e;c(n,o,a);const l=new r.A({width:o,height:a,pixels:[n],mask:i,pixelType:"f32",validPixelCount:e.validPixelCount});return l.updateStatistics(),l}function y(e,t,n){const{hillshadeType:r,altitude:i,azimuth:s,zFactor:o,pixelSizeFactor:a,pixelSizePower:l,slopeType:u}=e;return{hillshadeType:r,altitude:i,azimuth:s,zFactor:o,pixelSizePower:l,pixelSizeFactor:a,scalingType:"scaled"===u?"adjusted":"none",resolution:t,isGCS:n}}},53611:function(e,t,n){n.d(t,{$Q:function(){return g},FI:function(){return m},KL:function(){return c},Lu:function(){return h},MD:function(){return u},Rn:function(){return y},Ud:function(){return T},Wu:function(){return R},Y2:function(){return d},gf:function(){return k}});var r=n(73037),i=n(21327),s=n(43264);const o=new Map;o.set("meter-per-second",1),o.set("kilometer-per-hour",.277778),o.set("knots",.514444),o.set("feet-per-second",.3048),o.set("mile-per-hour",.44704);const a=180/Math.PI,l=5,u=new r.J({esriMetersPerSecond:"meter-per-second",esriKilometersPerHour:"kilometer-per-hour",esriKnots:"knots",esriFeetPerSecond:"feet-per-second",esriMilesPerHour:"mile-per-hour"});function c(e,t){return o.get(e)/o.get(t)||1}function p(e){return(450-e)%360}function h(e,t="geographic"){const[n,r]=e,i=Math.sqrt(n*n+r*r);let s=Math.atan2(r,n)*a;return s=(360+s)%360,"geographic"===t&&(s=p(s)),[i,s]}function f(e,t="geographic"){let n=e[1];"geographic"===t&&(n=p(n)),n%=360;const r=e[0];return[r*Math.cos(n/a),r*Math.sin(n/a)]}function d(e,t,n,r="geographic"){if(!(0,s.AB)(e)||null==n)return e;const i="vector-magdir"===t?e.clone():m(e,t),o=i.pixels[1];for(let e=0;e<o.length;e++)o[e]="geographic"===r?(o[e]+n[e]+270)%360:(o[e]+360-n[e])%360;return"vector-magdir"===t?i:m(i,"vector-magdir")}function m(e,t,n="geographic",r=1){if(!(0,s.AB)(e))return e;const{pixels:o,width:a,height:l}=e,u=a*l,c=o[0],p=o[1],d=e.pixelType.startsWith("f")?e.pixelType:"f32",m=i.A.createEmptyBand(d,u),y=i.A.createEmptyBand(d,u);let g=0;for(let e=0;e<l;e++)for(let e=0;e<a;e++)"vector-uv"===t?([m[g],y[g]]=h([c[g],p[g]],n),m[g]*=r):([m[g],y[g]]=f([c[g],p[g]],n),m[g]*=r,y[g]*=r),g++;const w=new i.A({pixelType:d,width:e.width,height:e.height,mask:e.mask,validPixelCount:e.validPixelCount,maskIsAlpha:e.maskIsAlpha,pixels:[m,y]});return w.updateStatistics(),w}function y(e,t,n=1){if(1===n||!(0,s.AB)(e))return e;const r=e.clone(),{pixels:i,width:o,height:a}=r,l=i[0],u=i[1];let c=0;for(let e=0;e<a;e++)for(let e=0;e<o;e++)"vector-uv"===t?(l[c]*=n,u[c]*=n):l[c]*=n,c++;return r.updateStatistics(),r}function g(e,t,n,r,i){if(null==i||!i.spatialReference.equals(e.spatialReference))return{extent:e,width:Math.round(t/r),height:Math.round(n/r),resolution:e.width/t};const s=i.xmin,o=i.ymax,a=(e.xmax-e.xmin)/t*r,l=(e.ymax-e.ymin)/n*r,u=(a+l)/2;return e.xmin=s+Math.floor((e.xmin-s)/a)*a,e.xmax=s+Math.ceil((e.xmax-s)/a)*a,e.ymin=o+Math.floor((e.ymin-o)/l)*l,e.ymax=o+Math.ceil((e.ymax-o)/l)*l,{extent:e,width:Math.round(e.width/a),height:Math.round(e.height/l),resolution:u}}const w=b(0,0,0);function b(e=0,t=0,n=Math.PI,r=!0){r&&(n=(2*Math.PI-n)%(2*Math.PI));const i=r?-1:1,s=13*i,o=-7*i,a=-2*i,l=-16*i,u=21.75,[c,p]=x(0,t+s,n,u),[h,f]=x(e-5.5,t+o,n,u),[d,m]=x(e+5.5,t+o,n,u),[y,g]=x(e-1.5,t+a,n,u),[w,b]=x(e+1.5,t+a,n,u),[v,M]=x(e-1.5,t+l,n,u),[A,I]=x(e+1.5,t+l,n,u);return[c,p,h,f,y,g,w,b,d,m,v,M,A,I]}function v(e=0,t=Math.PI,n=!0){n&&(t=(2*Math.PI-t)%(2*Math.PI));const r=n?-1:1,i=5*r,s=20*r,o=25*r,a=45,u=2*r,c=n?1:-1,p=5*c;let[h,f]=[0+p,0-s],[d,m]=[h+2*c,f],[y,g]=[d-0*c,m+u],[w,b]=[0-p,0-o],[v,M]=[w+0*c,b-u],A=Math.ceil(e/l),I=Math.floor(A/10);A-=8*I;const S=[],_=[];for(let e=0;e<A/2;e++,I--){I<=0&&A%2==1&&e===(A-1)/2&&(w=0,v=w+0*c,b=(b+f)/2,M=b-u);const[n,r]=x(w,b,t,a);if(I>0){const[e,i]=x(d,b,t,a),[s,o]=x(h,f,t,a);S.push(e),S.push(i),S.push(n),S.push(r),S.push(s),S.push(o)}else{const[e,i]=x(d,m,t,a),[s,o]=x(y,g,t,a),[l,u]=x(v,M,t,a);_.push(n),_.push(r),_.push(l),_.push(u),_.push(s),_.push(o),_.push(e),_.push(i)}b+=i,f+=i,m+=i,g+=i,M+=i}const[C,T]=x(0+p,0+s,t,a),k=7*c,[R,P]=x(0+k,0+s,t,a),[N,D]=x(0+p,0-o,t,a),[E,L]=x(0+k,0-o,t,a);return{pennants:S,barbs:_,shaft:[C,T,R,P,N,D,E,L]}}function x(e,t,n,r=1){const i=Math.sqrt(e*e+t*t)/r,s=(2*Math.PI+Math.atan2(t,e))%(2*Math.PI);return[i,(2*Math.PI+s-n)%(2*Math.PI)]}const M=[0,1,3,6,10,16,21,27,33,40,47,55,63],A=[0,.5,1,1.5,2],I=[0,.25,.5,1,1.5,2,2.5,3,3.5,4];function S(e,t,n,r){const i=c(r||"knots",n);let s;for(s=1;s<t.length;s++)if(s===t.length-1){if(e<t[s]*i)break}else if(e<=t[s]*i)break;return Math.min(s-1,t.length-2)}function _(e,t,n,r,i){let s=0;switch(t){case"beaufort_kn":s=S(e,M,"knots",n);break;case"beaufort_km":s=S(e,M,"kilometer-per-hour",n);break;case"beaufort_ft":s=S(e,M,"feet-per-second",n);break;case"beaufort_m":s=S(e,M,"meter-per-second",n);break;case"classified_arrow":s=S(e,i??[],r,n);break;case"ocean_current_m":s=S(e,A,"meter-per-second",n);break;case"ocean_current_kn":s=S(e,I,"knots",n)}return s}const C=[];function T(e,t){let n=0,r=0;const{width:i,height:s,mask:o}=e,a=e.pixels[0],p=[],h=[],f=c(u.fromJSON(t.inputUnit),"knots"),d="wind_speed"===t.style?l:Number.MAX_VALUE;for(let e=0;e<s;e++)for(let t=0;t<i;t++){const l=a[e*i+t]*f;if((!o||o[e*i+t])&&l<d){for(let r=0;r<4;r++)p[n++]=(t+.5)/i,p[n++]=(e+.5)/s,p[n++]=r<2?-.5:.5,p[n++]=r%2==0?-.5:.5,p[n++]=0,p[n++]=l;const o=4*(n/24-1);h[r++]=o,h[r++]=o+1,h[r++]=o+2,h[r++]=o+1,h[r++]=o+2,h[r++]=o+3}}return{vertexData:new Float32Array(p),indexData:new Uint32Array(h)}}function k(e,t){return"simple_scalar"===t.style?T(e,t):"wind_speed"===t.style?function(e,t){if(0===C.length)for(let e=0;e<30;e++)C.push(v(5*e,0,!t.invertDirection));const n=c(u.fromJSON(t.inputUnit),"knots"),{width:r,height:i,mask:s}=e,o=e.pixels[0],a=e.pixels[1],p=[],h=[];let f=0,d=0;for(let e=0;e<i;e++)for(let t=0;t<r;t++){const u=e*r+t,c=o[u]*n;if((!s||s[e*r+t])&&c>=l){const n=(a[u]+360)%360/180*Math.PI,{pennants:s,barbs:o,shaft:l}=C[Math.min(Math.floor(c/5),29)];if(s.length+o.length===0)continue;let m=p.length/6;const y=(t+.5)/r,g=(e+.5)/i;for(let e=0;e<s.length;e+=2)p[f++]=y,p[f++]=g,p[f++]=s[e],p[f++]=s[e+1]+n,p[f++]=0,p[f++]=c;for(let e=0;e<o.length;e+=2)p[f++]=y,p[f++]=g,p[f++]=o[e],p[f++]=o[e+1]+n,p[f++]=0,p[f++]=c;for(let e=0;e<l.length;e+=2)p[f++]=y,p[f++]=g,p[f++]=l[e],p[f++]=l[e+1]+n,p[f++]=0,p[f++]=c;for(let e=0;e<s.length/6;e++)h[d++]=m,h[d++]=m+1,h[d++]=m+2,m+=3;for(let e=0;e<o.length/8;e++)h[d++]=m,h[d++]=m+1,h[d++]=m+2,h[d++]=m+1,h[d++]=m+2,h[d++]=m+3,m+=4;h[d++]=m+0,h[d++]=m+1,h[d++]=m+2,h[d++]=m+1,h[d++]=m+3,h[d++]=m+2,m+=4}}return{vertexData:new Float32Array(p),indexData:new Uint32Array(h)}}(e,t):function(e,t){const{style:n,inputUnit:r,outputUnit:i,breakValues:s}=t,o=u.fromJSON(r),a=u.fromJSON(i);let l=0,c=0;const{width:p,height:h,mask:f}=e,d=e.pixels[0],m=e.pixels[1],y=null!=f?f.filter((e=>e>0)).length:p*h,g=new Float32Array(42*y),v=new Uint32Array(15*y),x=t.invertDirection?b(0,0,0,!1):w;for(let e=0;e<h;e++)for(let t=0;t<p;t++){const r=e*p+t;if(!f||f[e*p+t]){const i=(m[r]+360)%360/180*Math.PI,u=_(d[r],n,o,a,s);for(let n=0;n<x.length;n+=2)g[l++]=(t+.5)/p,g[l++]=(e+.5)/h,g[l++]=x[n],g[l++]=x[n+1]+i,g[l++]=u,g[l++]=d[r];const f=7*(l/42-1);v[c++]=f,v[c++]=f+1,v[c++]=f+2,v[c++]=f+0,v[c++]=f+4,v[c++]=f+3,v[c++]=f+0,v[c++]=f+2,v[c++]=f+3,v[c++]=f+2,v[c++]=f+5,v[c++]=f+3,v[c++]=f+5,v[c++]=f+6,v[c++]=f+3}}return{vertexData:g,indexData:v}}(e,t)}function R(e,t,n,r=[0,0],s=.5){const{width:o,height:a,mask:l}=e,[u,c]=e.pixels,[p,d]=r,m=Math.round((o-p)/n),y=Math.round((a-d)/n),g=m*y,w=new Float32Array(g),b=new Float32Array(g),v=new Uint8Array(g),x="vector-uv"===t;for(let e=0;e<y;e++)for(let t=0;t<m;t++){let r=0;const i=e*m+t,y=Math.max(0,e*n+d),g=Math.max(0,t*n+p),M=Math.min(a,y+n),A=Math.min(o,g+n);for(let e=y;e<M;e++)for(let t=g;t<A;t++){const n=e*o+t;if(!l||l[n]){r++;const e=x?[u[n],c[n]]:[u[n],(360+c[n])%360],[t,s]=x?e:f(e);w[i]+=t,b[i]+=s}}if(r>=(M-y)*(A-g)*(1-s)){v[i]=1;const[e,t]=h([w[i]/r,b[i]/r]);w[i]=e,b[i]=t}else v[i]=0,w[i]=0,b[i]=0}const M=new i.A({width:m,height:y,pixels:[w,b],mask:v});return M.updateStatistics(),M}},52477:function(e,t,n){n.d(t,{A:function(){return l}});var r=n(53804),i=n(30905),s=n(23502),o=(n(58941),n(40633),n(13798),n(65953));let a=class extends i.oY{get affectsPixelSize(){return!1}forwardTransform(e){return e}inverseTransform(e){return e}};(0,r._)([(0,s.MZ)()],a.prototype,"affectsPixelSize",null),(0,r._)([(0,s.MZ)({json:{write:!0}})],a.prototype,"spatialReference",void 0),a=(0,r._)([(0,o.$)("esri.layers.support.rasterTransforms.BaseRasterTransform")],a);const l=a},62710:function(e,t,n){n.d(t,{A:function(){return c}});var r,i=n(53804),s=n(23502),o=(n(58941),n(40633),n(13798),n(74376)),a=n(65953),l=n(52477);let u=r=class extends l.A{constructor(){super(...arguments),this.type="gcs-shift",this.tolerance=1e-8}forwardTransform(e){return"point"===(e=e.clone()).type?(e.x>180+this.tolerance&&(e.x-=360),e):(e.xmin>=180-this.tolerance?(e.xmax-=360,e.xmin-=360):e.xmax>180+this.tolerance&&(e.xmin=-180,e.xmax=180),e)}inverseTransform(e){return"point"===(e=e.clone()).type?(e.x<-this.tolerance&&(e.x+=360),e):(e.xmin<-this.tolerance&&(e.xmin+=360,e.xmax+=360),e)}clone(){return new r({tolerance:this.tolerance})}};(0,i._)([(0,o.e)({GCSShiftXform:"gcs-shift"})],u.prototype,"type",void 0),(0,i._)([(0,s.MZ)()],u.prototype,"tolerance",void 0),u=r=(0,i._)([(0,a.$)("esri.layers.support.rasterTransforms.GCSShiftTransform")],u);const c=u},85307:function(e,t,n){n.d(t,{A:function(){return y}});var r,i=n(53804),s=(n(50917),n(23502)),o=(n(58941),n(40633),n(13798),n(74376)),a=n(47332),l=n(65953),u=n(81392),c=n(52477),p=n(45532),h=n(91484);function f(e,t,n){const{x:r,y:i}=t;if(n<2)return{x:e[0]+r*e[2]+i*e[4],y:e[1]+r*e[3]+i*e[5]};if(2===n){const t=r*r,n=i*i,s=r*i;return{x:e[0]+r*e[2]+i*e[4]+t*e[6]+s*e[8]+n*e[10],y:e[1]+r*e[3]+i*e[5]+t*e[7]+s*e[9]+n*e[11]}}const s=r*r,o=i*i,a=r*i,l=s*r,u=s*i,c=r*o,p=i*o;return{x:e[0]+r*e[2]+i*e[4]+s*e[6]+a*e[8]+o*e[10]+l*e[12]+u*e[14]+c*e[16]+p*e[18],y:e[1]+r*e[3]+i*e[5]+s*e[7]+a*e[9]+o*e[11]+l*e[13]+u*e[15]+c*e[17]+p*e[19]}}function d(e,t,n){const{xmin:r,ymin:i,xmax:s,ymax:o,spatialReference:a}=t;let l=[];if(n<2)l.push({x:r,y:o}),l.push({x:s,y:o}),l.push({x:r,y:i}),l.push({x:s,y:i});else{let e=10;for(let t=0;t<e;t++)l.push({x:r,y:i+(o-i)*t/(e-1)}),l.push({x:s,y:i+(o-i)*t/(e-1)});e=8;for(let t=1;t<=e;t++)l.push({x:r+(s-r)*t/e,y:i}),l.push({x:r+(s-r)*t/e,y:o})}l=l.map((t=>f(e,t,n)));const u=l.map((e=>e.x)),c=l.map((e=>e.y));return new h.default({xmin:Math.min.apply(null,u),xmax:Math.max.apply(null,u),ymin:Math.min.apply(null,c),ymax:Math.max.apply(null,c),spatialReference:a})}let m=r=class extends c.A{constructor(){super(...arguments),this.polynomialOrder=1,this.type="polynomial"}readForwardCoefficients(e,t){const{coeffX:n,coeffY:r}=t;if(!n?.length||!r?.length||n.length!==r.length)return null;const i=[];for(let e=0;e<n.length;e++)i.push(n[e]),i.push(r[e]);return i}writeForwardCoefficients(e,t,n){const r=[],i=[];for(let t=0;t<e?.length;t++)t%2==0?r.push(e[t]):i.push(e[t]);t.coeffX=r,t.coeffY=i}get inverseCoefficients(){let e=this._get("inverseCoefficients");const t=this._get("forwardCoefficients");return!e&&t&&this.polynomialOrder<2&&(e=function(e){const[t,n,r,i,s,o]=e,a=r*o-s*i,l=s*i-r*o;return[(s*n-t*o)/a,(r*n-t*i)/l,o/a,i/l,-s/a,-r/l]}(t)),e}set inverseCoefficients(e){this._set("inverseCoefficients",e)}readInverseCoefficients(e,t){const{inverseCoeffX:n,inverseCoeffY:r}=t;if(!n?.length||!r?.length||n.length!==r.length)return null;const i=[];for(let e=0;e<n.length;e++)i.push(n[e]),i.push(r[e]);return i}writeInverseCoefficients(e,t,n){const r=[],i=[];for(let t=0;t<e?.length;t++)t%2==0?r.push(e[t]):i.push(e[t]);t.inverseCoeffX=r,t.inverseCoeffY=i}get affectsPixelSize(){return this.polynomialOrder>0}forwardTransform(e){if("point"===e.type){const t=f(this.forwardCoefficients,e,this.polynomialOrder);return new p.default({x:t.x,y:t.y,spatialReference:e.spatialReference})}return d(this.forwardCoefficients,e,this.polynomialOrder)}inverseTransform(e){if("point"===e.type){const t=f(this.inverseCoefficients,e,this.polynomialOrder);return new p.default({x:t.x,y:t.y,spatialReference:e.spatialReference})}return d(this.inverseCoefficients,e,this.polynomialOrder)}clone(){return new r({polynomialOrder:this.polynomialOrder,forwardCoefficients:this.forwardCoefficients?[...this.forwardCoefficients]:null,inverseCoefficients:this.inverseCoefficients?[...this.inverseCoefficients]:null})}};(0,i._)([(0,s.MZ)({json:{write:!0}})],m.prototype,"polynomialOrder",void 0),(0,i._)([(0,s.MZ)()],m.prototype,"forwardCoefficients",void 0),(0,i._)([(0,a.w)("forwardCoefficients",["coeffX","coeffY"])],m.prototype,"readForwardCoefficients",null),(0,i._)([(0,u.K)("forwardCoefficients")],m.prototype,"writeForwardCoefficients",null),(0,i._)([(0,s.MZ)({json:{write:!0}})],m.prototype,"inverseCoefficients",null),(0,i._)([(0,a.w)("inverseCoefficients",["inverseCoeffX","inverseCoeffY"])],m.prototype,"readInverseCoefficients",null),(0,i._)([(0,u.K)("inverseCoefficients")],m.prototype,"writeInverseCoefficients",null),(0,i._)([(0,s.MZ)()],m.prototype,"affectsPixelSize",null),(0,i._)([(0,o.e)({PolynomialXform:"polynomial"})],m.prototype,"type",void 0),m=r=(0,i._)([(0,l.$)("esri.layers.support.rasterTransforms.PolynomialTransform")],m);const y=m},29606:function(e,t,n){n.d(t,{It:function(){return f},LG:function(){return o},OM:function(){return u},Sm:function(){return c},Y:function(){return a},bK:function(){return l},mm:function(){return h},sQ:function(){return p}});var r=n(46157),i=n(57165),s=n(1644);function o(e,t){if(!a(e,t)){const n=e.typeKeywords;n?n.push(t):e.typeKeywords=[t]}}function a(e,t){return!!e.typeKeywords?.includes(t)}function l(e){return a(e,h.HOSTED_SERVICE)}function u(e,t){const n=e.typeKeywords;if(n){const e=n.indexOf(t);e>-1&&n.splice(e,1)}}function c(e,t,n){n?o(e,t):u(e,t)}async function p(e){const t=e.clone().normalize();let n;if(t.length>1)for(const e of t)n?e.width>n.width&&(n=e):n=e;else n=t[0];return async function(e){const t=e.spatialReference;if(t.isWGS84)return e.clone();if(t.isWebMercator)return(0,s.ci)(e);const n=i.A.WGS84;return await(0,r.initializeProjection)(t,n),(0,r.project)(e,n)}(n)}const h={DEVELOPER_BASEMAP:"DeveloperBasemap",JSAPI:"ArcGIS API for JavaScript",METADATA:"Metadata",MULTI_LAYER:"Multilayer",SINGLE_LAYER:"Singlelayer",TABLE:"Table",HOSTED_SERVICE:"Hosted Service",LOCAL_SCENE:"ViewingMode-Local",TILED_IMAGERY:"Tiled Imagery",GROUP_LAYER_MAP:"Map",ORIENTED_IMAGERY_LAYER:"OrientedImageryLayer"};function f(e){const{portal:t,isOrgItem:n,itemControl:r}=e,i=t.user?.privileges;let s=!i||i.includes("features:user:edit"),o=!!n&&!!i?.includes("features:user:fullEdit");const a="update"===r||"admin"===r;return a?o=s=!0:o&&(s=!0),{features:{edit:s,fullEdit:o},content:{updateItem:a}}}},35060:function(e,t,n){n.d(t,{j:function(){return r}});const r=(0,n(73037).O)()({esriTimeUnitsMilliseconds:"milliseconds",esriTimeUnitsSeconds:"seconds",esriTimeUnitsMinutes:"minutes",esriTimeUnitsHours:"hours",esriTimeUnitsDays:"days",esriTimeUnitsWeeks:"weeks",esriTimeUnitsMonths:"months",esriTimeUnitsYears:"years",esriTimeUnitsDecades:"decades",esriTimeUnitsCenturies:"centuries",esriTimeUnitsUnknown:void 0})},92778:function(e,t,n){n.d(t,{Gj:function(){return h},LF:function(){return d},uy:function(){return p}});var r=n(89001),i=n(74865),s=n(8795),o=n(30185),a=n(29360),l=n(93571),u=n(61065),c=n(80892);const p={key:"type",base:null,typeMap:{"unique-value":u.A,"class-breaks":i.A,"raster-colormap":o.A,"raster-stretch":l.A,"vector-field":c.A,"raster-shaded-relief":a.A,flow:s.A}},h={...p,typeMap:{...p.typeMap}};delete h.typeMap["vector-field"],delete h.typeMap.flow;const f={uniqueValue:u.A,classBreaks:i.A,rasterStretch:l.A,rasterColormap:o.A,vectorField:c.A,rasterShadedRelief:a.A,flowRenderer:s.A};function d(e,t){if(!e)return null;if("classBreaks"===e.type&&e.classificationMethod){const t=e.authoringInfo||{classificationMethod:""};t.classificationMethod=e.classificationMethod,e.authoringInfo=t}"vectorField"===e.type&&e.visualVariables&&!Array.isArray(e.visualVariables)&&(e.visualVariables=[e.visualVariables]);const n=(i=e)&&f[i.type]||null;var i;if(n){const r=new n;return r.read(e,t),r}return t?.messages&&e&&t.messages.push(new r.A("renderer:unsupported","Renderers of type '"+(e.type||"unknown")+"' are not supported",{definition:e,context:t})),null}},74865:function(e,t,n){n.d(t,{A:function(){return T}});var r,i=n(53804),s=n(10748),o=n(73037),a=n(21609),l=n(40633),u=n(23502),c=n(77560),p=n(74376),h=n(47332),f=n(65953),d=n(81392),m=n(67888),y=n(53743),g=n(30047),w=n(29970),b=n(23879),v=n(85336),x=n(16986),M=n(54547);const A="percent-of-total",I="field",S=new o.J({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:A,esriNormalizeByField:I}),_=(0,m.dp)(b.A);let C=r=class extends((0,w.h)(g.A)){constructor(e){super(e),this._compiledValueExpression={valueExpression:null,compiledFunction:null},this.backgroundFillSymbol=null,this.classBreakInfos=null,this.defaultLabel=null,this.defaultSymbol=null,this.field=null,this.isMaxInclusive=!0,this.legendOptions=null,this.normalizationField=null,this.normalizationTotal=null,this.type="class-breaks",this.valueExpression=null,this.valueExpressionTitle=null,this._set("classBreakInfos",[])}readClassBreakInfos(e,t,n){if(!Array.isArray(e))return;let r=t.minValue;return e.map((e=>{const t=new b.A;return t.read(e,n),null==t.minValue&&(t.minValue=r),null==t.maxValue&&(t.maxValue=t.minValue),r=t.maxValue,t}))}writeClassBreakInfos(e,t,n,r){const i=e.map((e=>e.write({},r)));this._areClassBreaksConsecutive()&&i.forEach((e=>delete e.classMinValue)),t[n]=i}castField(e){return null==e?e:"function"==typeof e?(l.A.getLogger(this).error(".field: field must be a string value"),null):(0,m.GX)(e)}get minValue(){return this.classBreakInfos&&this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0}get normalizationType(){let e=this._get("normalizationType");const t=!!this.normalizationField,n=null!=this.normalizationTotal;return t||n?(e=t&&I||n&&A||null,t&&n&&l.A.getLogger(this).warn("warning: both normalizationField and normalizationTotal are set!")):e!==I&&e!==A||(e=null),e}set normalizationType(e){this._set("normalizationType",e)}addClassBreakInfo(e,t,n){let r=null;r="number"==typeof e?new b.A({minValue:e,maxValue:t,symbol:(0,s.dp)(n)}):_((0,a.o8)(e)),this.classBreakInfos.push(r),1===this.classBreakInfos.length&&this.notifyChange("minValue")}removeClassBreakInfo(e,t){const n=this.classBreakInfos.length;for(let r=0;r<n;r++){const n=[this.classBreakInfos[r].minValue,this.classBreakInfos[r].maxValue];if(n[0]===e&&n[1]===t){this.classBreakInfos.splice(r,1);break}}}getBreakIndex(e,t){return this.valueExpression&&null==t?.arcade&&l.A.getLogger(this).warn(""),this.valueExpression?this._getBreakIndexForExpression(e,t):this._getBreakIndexForField(e)}async getClassBreakInfo(e,t){let n=t;this.valueExpression&&null==t?.arcade&&(n={...n,arcade:await(0,M.lw)()});const r=this.getBreakIndex(e,n);return-1!==r?this.classBreakInfos[r]:null}getSymbol(e,t){if(this.valueExpression&&null==t?.arcade)return void l.A.getLogger(this).error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const n=this.getBreakIndex(e,t);return n>-1?this.classBreakInfos[n].symbol:this.defaultSymbol}async getSymbolAsync(e,t){let n=t;if(this.valueExpression&&null==t?.arcade){const e=await(0,M.lw)(),{arcadeUtils:t}=e;t.hasGeometryOperations(this.valueExpression)&&await t.enableGeometryOperations(),n={...n,arcade:e}}const r=this.getBreakIndex(e,n);return r>-1?this.classBreakInfos[r].symbol:this.defaultSymbol}getSymbols(){const e=[];return this.classBreakInfos.forEach((t=>{t.symbol&&e.push(t.symbol)})),this.defaultSymbol&&e.push(this.defaultSymbol),e}getAttributeHash(){return this.visualVariables?.reduce(((e,t)=>e+t.getAttributeHash()),"")??""}getMeshHash(){const e=JSON.stringify(this.backgroundFillSymbol),t=JSON.stringify(this.defaultSymbol),n=`${this.normalizationField}.${this.normalizationType}.${this.normalizationTotal}`;return`${e}.${t}.${this.classBreakInfos.reduce(((e,t)=>e+t.getMeshHash()),"")}.${n}.${this.field}.${this.valueExpression}`}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}clone(){return new r({field:this.field,backgroundFillSymbol:this.backgroundFillSymbol?.clone(),defaultLabel:this.defaultLabel,defaultSymbol:this.defaultSymbol?.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:(0,a.o8)(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:(0,a.o8)(this.visualVariables),legendOptions:(0,a.o8)(this.legendOptions),authoringInfo:(0,a.o8)(this.authoringInfo)})}async collectRequiredFields(e,t){const n=[this.collectVVRequiredFields(e,t),this.collectSymbolFields(e,t)];await Promise.all(n)}async collectSymbolFields(e,t){const n=[...this.getSymbols().map((n=>n.collectRequiredFields(e,t))),(0,y.Dx)(e,t,this.valueExpression)];(0,y.rq)(e,t,this.field),(0,y.rq)(e,t,this.normalizationField),await Promise.all(n)}_getBreakIndexForExpression(e,t){const{viewingMode:n,scale:r,spatialReference:i,arcade:s,timeZone:o}=t??{},{valueExpression:a}=this;let l=this._compiledValueExpression.valueExpression===a?this._compiledValueExpression.compiledFunction:null;const u=s.arcadeUtils;if(!l){const e=u.createSyntaxTree(a);l=u.createFunction(e),this._compiledValueExpression.compiledFunction=l}this._compiledValueExpression.valueExpression=a;const c=u.executeFunction(l,u.createExecContext(e,u.getViewInfo({viewingMode:n,scale:r,spatialReference:i}),o));return this._getBreakIndexfromInfos(c)}_getBreakIndexForField(e){const t=this.field,n=e.attributes,r=this.normalizationType;let i=parseFloat(n[t]);if(r){const e=this.normalizationTotal,t=parseFloat(this.normalizationField?n[this.normalizationField]:void 0);if("log"===r)i=Math.log(i)*Math.LOG10E;else if(r!==A||null==e||isNaN(e)){if(r===I&&!isNaN(t)){if(isNaN(i)||isNaN(t))return-1;i/=t}}else i=i/e*100}return this._getBreakIndexfromInfos(i)}_getBreakIndexfromInfos(e){const t=this.isMaxInclusive;if(null!=e&&"number"==typeof e&&!isNaN(e))for(let n=0;n<this.classBreakInfos.length;n++){const r=[this.classBreakInfos[n].minValue,this.classBreakInfos[n].maxValue];if(r[0]<=e&&(t?e<=r[1]:e<r[1]))return n}return-1}_areClassBreaksConsecutive(){const e=this.classBreakInfos,t=e.length;for(let n=1;n<t;n++)if(e[n-1].maxValue!==e[n].minValue)return!1;return!0}};(0,i._)([(0,u.MZ)(v.As)],C.prototype,"backgroundFillSymbol",void 0),(0,i._)([(0,u.MZ)({type:[b.A]})],C.prototype,"classBreakInfos",void 0),(0,i._)([(0,h.w)("classBreakInfos")],C.prototype,"readClassBreakInfos",null),(0,i._)([(0,d.K)("classBreakInfos")],C.prototype,"writeClassBreakInfos",null),(0,i._)([(0,u.MZ)({type:String,json:{write:!0}})],C.prototype,"defaultLabel",void 0),(0,i._)([(0,u.MZ)(v.z4)],C.prototype,"defaultSymbol",void 0),(0,i._)([(0,u.MZ)({type:String,json:{write:!0}})],C.prototype,"field",void 0),(0,i._)([(0,c.w)("field")],C.prototype,"castField",null),(0,i._)([(0,u.MZ)({type:Boolean})],C.prototype,"isMaxInclusive",void 0),(0,i._)([(0,u.MZ)({type:x.A,json:{write:!0}})],C.prototype,"legendOptions",void 0),(0,i._)([(0,u.MZ)({type:Number,readOnly:!0,value:null,json:{read:!1,write:{overridePolicy(){return 0!==this.classBreakInfos.length&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}})],C.prototype,"minValue",null),(0,i._)([(0,u.MZ)({type:String,json:{write:!0}})],C.prototype,"normalizationField",void 0),(0,i._)([(0,u.MZ)({type:Number,json:{write:!0}})],C.prototype,"normalizationTotal",void 0),(0,i._)([(0,u.MZ)({type:S.apiValues,value:null,json:{type:S.jsonValues,read:S.read,write:S.write}})],C.prototype,"normalizationType",null),(0,i._)([(0,p.e)({classBreaks:"class-breaks"})],C.prototype,"type",void 0),(0,i._)([(0,u.MZ)({type:String,json:{write:!0}})],C.prototype,"valueExpression",void 0),(0,i._)([(0,u.MZ)({type:String,json:{write:!0}})],C.prototype,"valueExpressionTitle",void 0),C=r=(0,i._)([(0,f.$)("esri.renderers.ClassBreaksRenderer")],C);const T=C},8795:function(e,t,n){n.d(t,{A:function(){return g}});var r,i=n(53804),s=n(52874),o=n(73037),a=n(30905),l=n(13520),u=n(23502),c=(n(58941),n(40633),n(13798),n(74376)),p=n(65953),h=n(29970),f=n(53871),d=n(16986);const m=new o.J({flow_from:"flow-from",flow_to:"flow-to"});let y=r=class extends((0,h.h)(a.oY)){constructor(e){super(e),this.density=.8,this.color=new s.A([255,255,255,1]),this.maxPathLength=200,this.trailWidth=1.5,this.flowSpeed=10,this.trailLength=100,this.smoothing=0,this.flowRepresentation="flow-from",this.type="flow",this.authoringInfo=null,this.legendOptions=null,this.trailCap="butt",this.background="none"}clone(){const{density:e,maxPathLength:t,trailWidth:n,flowSpeed:i,trailLength:s,smoothing:o,flowRepresentation:a,trailCap:l,background:u}=this,c=this.color.clone(),p=(this.visualVariables||[]).map((e=>e.clone())),h=this.authoringInfo?.clone(),f=this.legendOptions?.clone();return new r({density:e,color:c,maxPathLength:t,trailWidth:n,flowSpeed:i,trailLength:s,trailCap:l,background:u,smoothing:o,flowRepresentation:a,visualVariables:p,authoringInfo:h,legendOptions:f})}getSymbol(e,t){}async getSymbolAsync(e,t){}getSymbols(){return[]}};(0,i._)([(0,u.MZ)({type:Number,json:{write:!0}})],y.prototype,"density",void 0),(0,i._)([(0,u.MZ)({type:s.A,json:{write:{allowNull:!0}}})],y.prototype,"color",void 0),(0,i._)([(0,u.MZ)({type:Number,cast:l.cr,json:{write:!0}})],y.prototype,"maxPathLength",void 0),(0,i._)([(0,u.MZ)({type:Number,cast:l.cr,json:{write:!0}})],y.prototype,"trailWidth",void 0),(0,i._)([(0,u.MZ)({type:Number,json:{write:!0}})],y.prototype,"flowSpeed",void 0),(0,i._)([(0,u.MZ)({type:Number,json:{write:!0}})],y.prototype,"trailLength",void 0),(0,i._)([(0,u.MZ)({type:Number,cast:l.cr,json:{write:!1}})],y.prototype,"smoothing",void 0),(0,i._)([(0,u.MZ)({type:m.apiValues,json:{type:m.jsonValues,read:{reader:m.read},write:{writer:m.write}}})],y.prototype,"flowRepresentation",void 0),(0,i._)([(0,c.e)({flowRenderer:"flow"})],y.prototype,"type",void 0),(0,i._)([(0,u.MZ)({type:f.A,json:{write:!0}})],y.prototype,"authoringInfo",void 0),(0,i._)([(0,u.MZ)({type:d.A,json:{write:!0}})],y.prototype,"legendOptions",void 0),(0,i._)([(0,u.MZ)({type:String,json:{write:!0}})],y.prototype,"trailCap",void 0),(0,i._)([(0,u.MZ)({type:String,json:{write:!0}})],y.prototype,"background",void 0),y=r=(0,i._)([(0,p.$)("esri.renderers.FlowRenderer")],y);const g=y},30185:function(e,t,n){n.d(t,{A:function(){return m}});var r=n(53804),i=n(30905),s=n(23502),o=(n(58941),n(40633),n(13798),n(74376)),a=n(65953),l=n(52874),u=n(67888);let c=class extends i.oY{constructor(){super(...arguments),this.value=null,this.label=null,this.color=null}};(0,r._)([(0,s.MZ)({type:Number,json:{write:!0}})],c.prototype,"value",void 0),(0,r._)([(0,s.MZ)({type:String,json:{write:!0}})],c.prototype,"label",void 0),(0,r._)([(0,s.MZ)({type:l.A,json:{type:[u.jz],write:!0}})],c.prototype,"color",void 0),c=(0,r._)([(0,a.$)("esri.renderers.support.ColormapInfo")],c);const p=c;var h,f=n(3212);let d=h=class extends i.oY{constructor(e){super(e),this.colormapInfos=null,this.type="raster-colormap"}static createFromColormap(e,t){if(!e)return null;const n=5===e[0].length,r=[...e].sort(((e,t)=>e[0]-t[0])).map((e=>p.fromJSON({value:e[0],color:n?e.slice(1,5):e.slice(1,4).concat([255]),label:t?t[e[0]]??"":e[0]})));return new h({colormapInfos:r})}static createFromColorramp(e){const t=(0,f.R8)(e);return h.createFromColormap(t)}clone(){return new h({colormapInfos:this.colormapInfos.map((e=>e.toJSON()))})}extractColormap(){return this.colormapInfos.map((({value:e,color:t})=>[e,t.r,t.g,t.b,t.a>1?t.a:255*t.a&255])).sort(((e,t)=>e[0]-t[0]))}};(0,r._)([(0,s.MZ)({type:[p],json:{write:!0}})],d.prototype,"colormapInfos",void 0),(0,r._)([(0,o.e)({rasterColormap:"raster-colormap"})],d.prototype,"type",void 0),d=h=(0,r._)([(0,a.$)("esri.renderers.RasterColormapRenderer")],d);const m=d},29360:function(e,t,n){n.d(t,{A:function(){return f}});var r,i=n(53804),s=n(30905),o=n(21609),a=n(23502),l=(n(58941),n(40633),n(74376)),u=n(47332),c=n(65953),p=n(85982);let h=r=class extends s.oY{constructor(e){super(e),this.altitude=45,this.azimuth=315,this.colorRamp=null,this.hillshadeType="traditional",this.pixelSizePower=.664,this.pixelSizeFactor=.024,this.scalingType="none",this.type="raster-shaded-relief",this.zFactor=1}readColorRamp(e){return(0,p.r)(e)}clone(){return new r({hillshadeType:this.hillshadeType,altitude:this.altitude,azimuth:this.azimuth,zFactor:this.zFactor,scalingType:this.scalingType,pixelSizeFactor:this.pixelSizeFactor,pixelSizePower:this.pixelSizePower,colorRamp:(0,o.o8)(this.colorRamp)})}};(0,i._)([(0,a.MZ)({type:Number,json:{write:!0}})],h.prototype,"altitude",void 0),(0,i._)([(0,a.MZ)({type:Number,json:{write:!0}})],h.prototype,"azimuth",void 0),(0,i._)([(0,a.MZ)({types:p.g,json:{write:!0}})],h.prototype,"colorRamp",void 0),(0,i._)([(0,u.w)("colorRamp")],h.prototype,"readColorRamp",null),(0,i._)([(0,a.MZ)({type:["traditional","multi-directional"],json:{write:!0}})],h.prototype,"hillshadeType",void 0),(0,i._)([(0,a.MZ)({type:Number,json:{write:!0}})],h.prototype,"pixelSizePower",void 0),(0,i._)([(0,a.MZ)({type:Number,json:{write:!0}})],h.prototype,"pixelSizeFactor",void 0),(0,i._)([(0,a.MZ)({type:["none","adjusted"],json:{write:!0}})],h.prototype,"scalingType",void 0),(0,i._)([(0,l.e)({rasterShadedRelief:"raster-shaded-relief"})],h.prototype,"type",void 0),(0,i._)([(0,a.MZ)({type:Number,json:{write:!0}})],h.prototype,"zFactor",void 0),h=r=(0,i._)([(0,c.$)("esri.renderers.RasterShadedReliefRenderer")],h);const f=h},93571:function(e,t,n){n.d(t,{A:function(){return g}});var r,i=n(53804),s=n(88022),o=n(30905),a=n(21609),l=n(40633),u=n(23502),c=(n(58941),n(74376)),p=n(47332),h=n(65953),f=n(81392),d=n(41259),m=n(85982);let y=r=class extends o.oY{constructor(e){super(e),this.colorRamp=null,this.computeGamma=!1,this.dynamicRangeAdjustment=!1,this.gamma=[],this.maxPercent=null,this.minPercent=null,this.numberOfStandardDeviations=null,this.outputMax=null,this.outputMin=null,this.sigmoidStrengthLevel=null,this.histograms=null,this.useGamma=!1,this.stretchType="none",this.type="raster-stretch"}readColorRamp(e){if(e)return(0,m.r)(e)}get statistics(){return this._get("statistics")}set statistics(e){(0,s.Lx)(l.A.getLogger(this),"statistics",{replacement:"customStatistics",version:"4.31",warnOnce:!0}),this._set("statistics",e)}get customStatistics(){const e=this.statistics;return e&&Array.isArray(e[0])?e.map((e=>({min:e[0],max:e[1],avg:e[2],stddev:e[3]}))):e}set customStatistics(e){this._set("statistics",e?.map((e=>[e.min,e.max,e.avg??0,e.stddev??1])))}readCustomStatistics(e){return e?.map((e=>({min:e[0],max:e[1],avg:e[2],stddev:e[3]})))}writeCustomStatistics(e,t,n){e?.length&&(t[n]=e.map((e=>[e.min,e.max,e.avg??0,e.stddev??1])))}readStretchType(e,t){let n=t.stretchType;return"number"==typeof n&&(n=d.x[n]),d.u.read(n)}clone(){return new r({stretchType:this.stretchType,outputMin:this.outputMin,outputMax:this.outputMax,useGamma:this.useGamma,computeGamma:this.computeGamma,statistics:(0,a.o8)(this.statistics),customStatistics:(0,a.o8)(this.customStatistics),gamma:(0,a.o8)(this.gamma),sigmoidStrengthLevel:this.sigmoidStrengthLevel,numberOfStandardDeviations:this.numberOfStandardDeviations,minPercent:this.minPercent,maxPercent:this.maxPercent,colorRamp:(0,a.o8)(this.colorRamp),histograms:(0,a.o8)(this.histograms),dynamicRangeAdjustment:this.dynamicRangeAdjustment})}};(0,i._)([(0,u.MZ)({types:m.g,json:{write:!0}})],y.prototype,"colorRamp",void 0),(0,i._)([(0,p.w)("colorRamp")],y.prototype,"readColorRamp",null),(0,i._)([(0,u.MZ)({type:Boolean,json:{write:!0}})],y.prototype,"computeGamma",void 0),(0,i._)([(0,u.MZ)({type:Boolean,json:{write:{target:"dra"},read:{source:"dra"}}})],y.prototype,"dynamicRangeAdjustment",void 0),(0,i._)([(0,u.MZ)({type:[Number],json:{write:!0}})],y.prototype,"gamma",void 0),(0,i._)([(0,u.MZ)({type:Number,json:{write:!0}})],y.prototype,"maxPercent",void 0),(0,i._)([(0,u.MZ)({type:Number,json:{write:!0}})],y.prototype,"minPercent",void 0),(0,i._)([(0,u.MZ)({type:Number,json:{write:!0}})],y.prototype,"numberOfStandardDeviations",void 0),(0,i._)([(0,u.MZ)({type:Number,json:{read:{source:"max"},write:{target:"max"}}})],y.prototype,"outputMax",void 0),(0,i._)([(0,u.MZ)({type:Number,json:{read:{source:"min"},write:{target:"min"}}})],y.prototype,"outputMin",void 0),(0,i._)([(0,u.MZ)({type:Number,json:{write:!0}})],y.prototype,"sigmoidStrengthLevel",void 0),(0,i._)([(0,u.MZ)({})],y.prototype,"statistics",null),(0,i._)([(0,u.MZ)()],y.prototype,"histograms",void 0),(0,i._)([(0,u.MZ)({json:{type:[[Number]],name:"statistics",write:!0}})],y.prototype,"customStatistics",null),(0,i._)([(0,p.w)("customStatistics")],y.prototype,"readCustomStatistics",null),(0,i._)([(0,f.K)("customStatistics")],y.prototype,"writeCustomStatistics",null),(0,i._)([(0,u.MZ)({type:Boolean,json:{write:!0}})],y.prototype,"useGamma",void 0),(0,i._)([(0,u.MZ)({type:d.u.apiValues,json:{type:d.u.jsonValues,write:d.u.write}})],y.prototype,"stretchType",void 0),(0,i._)([(0,p.w)("stretchType",["stretchType"])],y.prototype,"readStretchType",null),(0,i._)([(0,c.e)({rasterStretch:"raster-stretch"})],y.prototype,"type",void 0),y=r=(0,i._)([(0,h.$)("esri.renderers.RasterStretchRenderer")],y);const g=y},30047:function(e,t,n){n.d(t,{A:function(){return p}});var r=n(53804),i=n(73037),s=n(30905),o=n(23502),a=(n(58941),n(40633),n(13798),n(65953)),l=n(53871);const u=new i.J({simple:"simple",uniqueValue:"unique-value",classBreaks:"class-breaks",heatmap:"heatmap",dotDensity:"dot-density",dictionary:"dictionary",pieChart:"pie-chart"},{ignoreUnknown:!0});let c=class extends s.oY{constructor(e){super(e),this.authoringInfo=null,this.type=null}async getRequiredFields(e){if(!this.collectRequiredFields)return[];const t=new Set;return await this.collectRequiredFields(t,e),Array.from(t).sort()}getSymbol(e,t){}async getSymbolAsync(e,t){}getSymbols(){return[]}getAttributeHash(){return JSON.stringify(this)}getMeshHash(){return JSON.stringify(this)}};(0,r._)([(0,o.MZ)({type:l.A,json:{write:!0}})],c.prototype,"authoringInfo",void 0),(0,r._)([(0,o.MZ)({type:u.apiValues,readOnly:!0,json:{type:u.jsonValues,read:!1,write:{writer:u.write,ignoreOrigin:!0}}})],c.prototype,"type",void 0),c=(0,r._)([(0,a.$)("esri.renderers.Renderer")],c);const p=c},61065:function(e,t,n){n.d(t,{A:function(){return W}});var r=n(53804),i=n(10748),s=n(39819),o=n(21609),a=n(40633),l=n(34194),u=n(28181),c=n(23502),p=n(77560),h=n(74376),f=n(47332),d=n(65953),m=n(81392),y=n(72952),g=n(67888),w=n(53743),b=n(51432),v=n(30047),x=n(29970),M=n(85336),A=n(16986),I=n(75743),S=n(30905);n(58941),n(13798);let _=class extends((0,I.O)(S.oY)){constructor(e){super(e),this.value=null,this.value2=null,this.value3=null}};(0,r._)([(0,c.MZ)(M.Ug)],_.prototype,"value",void 0),(0,r._)([(0,c.MZ)(M.Ug)],_.prototype,"value2",void 0),(0,r._)([(0,c.MZ)(M.Ug)],_.prototype,"value3",void 0),_=(0,r._)([(0,d.$)("esri.renderers.support.UniqueValue")],_);const C=_;var T=n(50659);let k=class extends((0,I.O)(S.oY)){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.values=null}castValues(e){if(null==e)return null;const t=typeof(e=Array.isArray(e)?e:[e])[0];return"string"===t||"number"===t?e.map((e=>new C({value:e}))):"object"===t?e[0]instanceof C?e:e.map((e=>new C(e))):null}};(0,r._)([(0,c.MZ)({type:String,json:{write:!0}})],k.prototype,"description",void 0),(0,r._)([(0,c.MZ)({type:String,json:{write:!0}})],k.prototype,"label",void 0),(0,r._)([(0,c.MZ)(M.z4)],k.prototype,"symbol",void 0),(0,r._)([(0,c.MZ)({type:[C],json:{type:[[String]],read:{reader:e=>e?e.map((e=>new C({value:e[0],value2:e[1],value3:e[2]}))):null},write:{writer:(e,t)=>{const n=[];for(const t of e){const e=[t.value,t.value2,t.value3].filter(T.Ru).map((e=>e.toString()));n.push(e)}t.values=n}}}})],k.prototype,"values",void 0),(0,r._)([(0,p.w)("values")],k.prototype,"castValues",null),k=(0,r._)([(0,d.$)("esri.renderers.support.UniqueValueClass")],k);const R=k;let P=class extends((0,I.O)(S.oY)){constructor(e){super(e),this.heading=null,this.classes=null}};(0,r._)([(0,c.MZ)({type:String,json:{write:!0}})],P.prototype,"heading",void 0),(0,r._)([(0,c.MZ)({type:[R],json:{write:!0}})],P.prototype,"classes",void 0),P=(0,r._)([(0,d.$)("esri.renderers.support.UniqueValueGroup")],P);const N=P;var D,E=n(99278),L=n(54547),F=n(60534),O=n(58916),z=n(36e3);const j="esri.renderers.UniqueValueRenderer",B=()=>a.A.getLogger(j),Z="uvInfos-watcher",U="uvGroups-watcher",V=(0,g.dp)(E.A);function G(e){return null!=e&&""!==e&&("string"!=typeof e||""!==e.trim()&&"<null>"!==e.toLowerCase())||(e=null),e+""}let H=D=class extends((0,x.h)(v.A)){constructor(e){super(e),this._valueInfoMap={},this._isDefaultSymbolDerived=!1,this._isInfosSource=null,this.type="unique-value",this.backgroundFillSymbol=null,this.orderByClassesEnabled=!1,this.valueExpressionTitle=null,this.legendOptions=null,this.defaultLabel=null,this.portal=null,this.styleOrigin=null,this.diff={uniqueValueInfos(e,t){if(!e&&!t)return;if(!e||!t)return{type:"complete",oldValue:e,newValue:t};let n=!1;const r={type:"collection",added:[],removed:[],changed:[],unchanged:[]};for(let i=0;i<t.length;i++){const s=e.find((e=>e.value===t[i].value));s?(0,y.Ui)(s,t[i])?(r.changed.push({type:"complete",oldValue:s,newValue:t[i]}),n=!0):r.unchanged.push({oldValue:s,newValue:t[i]}):(r.added.push(t[i]),n=!0)}for(let i=0;i<e.length;i++)t.find((t=>t.value===e[i].value))||(r.removed.push(e[i]),n=!0);return n?r:void 0}},this._set("uniqueValueInfos",[]),this._set("uniqueValueGroups",[])}get _cache(){return{compiledFunc:null}}set field(e){this._set("field",e),this._updateFieldDelimiter(),this._updateUniqueValues()}castField(e){return null==e||"function"==typeof e?e:(0,g.GX)(e)}writeField(e,t,n,r){"string"==typeof e?t[n]=e:r?.messages?r.messages.push(new s.A("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):B().error(".field: cannot write field to JSON since it's not a string value")}set field2(e){this._set("field2",e),this._updateFieldDelimiter(),this._updateUniqueValues()}set field3(e){this._set("field3",e),this._updateUniqueValues()}set valueExpression(e){this._set("valueExpression",e),this._updateUniqueValues()}set defaultSymbol(e){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",e)}set fieldDelimiter(e){this._set("fieldDelimiter",e),this._updateUniqueValues()}readPortal(e,t,n){return n.portal||b.A.getDefault()}readStyleOrigin(e,t,n){if(t.styleName)return Object.freeze({styleName:t.styleName});if(t.styleUrl){const e=(0,F.f)(t.styleUrl,n);return Object.freeze({styleUrl:e})}}writeStyleOrigin(e,t,n,r){e.styleName?t.styleName=e.styleName:e.styleUrl&&(t.styleUrl=(0,F.t)(e.styleUrl,r))}set uniqueValueGroups(e){this.styleOrigin?B().error("#uniqueValueGroups=","Cannot modify unique value groups of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueGroups",e),this._updateInfosFromGroups(),this._isInfosSource=!1,this._watchUniqueValueGroups())}set uniqueValueInfos(e){this.styleOrigin?B().error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",e),this._updateValueInfoMap(),this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos())}addUniqueValueInfo(e,t){if(this.styleOrigin)return void B().error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let n;n="object"==typeof e?V(e):new E.A({value:e,symbol:(0,i.dp)(t)}),this.uniqueValueInfos?.push(n),this._valueInfoMap[G(n.value)]=n,this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}removeUniqueValueInfo(e){if(this.styleOrigin)return void B().error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");const t=this.uniqueValueInfos;if(t)for(let n=0;n<t.length;n++){const r=t[n];if(String(r.value)===String(e)){delete this._valueInfoMap[G(e)],t.splice(n,1);break}}this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}async getUniqueValueInfo(e,t){let n=t;return this.valueExpression&&null==t?.arcade&&(n={...n,arcade:await(0,L.lw)()}),this._getUniqueValueInfo(e,n)}getSymbol(e,t){if(this.valueExpression&&null==t?.arcade)return void B().error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const n=this._getUniqueValueInfo(e,t);return n?.symbol||this.defaultSymbol}async getSymbolAsync(e,t){let n=t;if(this.valueExpression&&null==n?.arcade){const e=await(0,L.lw)(),{arcadeUtils:t}=e;t.hasGeometryOperations(this.valueExpression)&&await t.enableGeometryOperations(),n={...n,arcade:e}}const r=this._getUniqueValueInfo(e,n);return r?.symbol||this.defaultSymbol}getSymbols(){const e=[];for(const t of this.uniqueValueInfos??[])t.symbol&&e.push(t.symbol);return this.defaultSymbol&&e.push(this.defaultSymbol),e}getAttributeHash(){return this.visualVariables?.reduce(((e,t)=>e+t.getAttributeHash()),"")??""}getMeshHash(){const e=JSON.stringify(this.backgroundFillSymbol),t=JSON.stringify(this.defaultSymbol),n=this.uniqueValueInfos?.reduce(((e,t)=>e+t.getMeshHash()),"");return`${e}.${t}.${n}.${this.field}.${this.field2}.${this.field3}.${this.fieldDelimiter}.${this.valueExpression}`}clone(){const e=new D({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:(0,o.o8)(this.defaultSymbol),orderByClassesEnabled:this.orderByClassesEnabled,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:(0,o.o8)(this.visualVariables),legendOptions:(0,o.o8)(this.legendOptions),authoringInfo:(0,o.o8)(this.authoringInfo),backgroundFillSymbol:(0,o.o8)(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(e._isDefaultSymbolDerived=!0),e._set("portal",this.portal);const t=(0,o.o8)(this.uniqueValueInfos),n=(0,o.o8)(this.uniqueValueGroups);return this.styleOrigin&&(e._set("styleOrigin",Object.freeze((0,o.o8)(this.styleOrigin))),Object.freeze(t),Object.freeze(n)),e._set("uniqueValueInfos",t),e._updateValueInfoMap(),e._set("uniqueValueGroups",n),e._isInfosSource=this._isInfosSource,e._watchUniqueValueInfosAndGroups(),e}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}async collectRequiredFields(e,t){const n=[this.collectVVRequiredFields(e,t),this.collectSymbolFields(e,t)];await Promise.all(n)}async collectSymbolFields(e,t){const n=[...this.getSymbols().map((n=>n.collectRequiredFields(e,t))),(0,w.Dx)(e,t,this.valueExpression)];(0,w.rq)(e,t,this.field),(0,w.rq)(e,t,this.field2),(0,w.rq)(e,t,this.field3),await Promise.all(n)}populateFromStyle(){return(0,O.cF)(this.styleOrigin,{portal:this.portal}).then((e=>{const t=[];return this._valueInfoMap={},e?.data&&Array.isArray(e.data.items)&&e.data.items.forEach((n=>{const r=new z.A({styleUrl:e.styleUrl,styleName:e.styleName,portal:this.portal,name:n.name});this.defaultSymbol||n.name!==e.data.defaultItem||(this.defaultSymbol=r,this._isDefaultSymbolDerived=!0);const i=new E.A({value:n.name,symbol:r});t.push(i),this._valueInfoMap[G(n.name)]=i})),this._set("uniqueValueInfos",Object.freeze(t)),this._updateGroupsFromInfos(!0),this._isInfosSource=null,this._watchUniqueValueInfos(),!this.defaultSymbol&&this.uniqueValueInfos?.length&&(this.defaultSymbol=this.uniqueValueInfos[0].symbol,this._isDefaultSymbolDerived=!0),this}))}_updateFieldDelimiter(){this.field&&this.field2&&!this.fieldDelimiter&&this._set("fieldDelimiter",",")}_updateUniqueValues(){null!=this._isInfosSource&&(this._isInfosSource?this._updateGroupsFromInfos():this._updateInfosFromGroups())}_updateValueInfoMap(){this._valueInfoMap={};const{uniqueValueInfos:e}=this;if(e)for(const t of e)this._valueInfoMap[G(t.value)]=t}_watchUniqueValueInfosAndGroups(){this._watchUniqueValueInfos(),this._watchUniqueValueGroups()}_watchUniqueValueInfos(){this.removeHandles(Z);const{uniqueValueInfos:e}=this;if(e){const t=[];for(const n of e)t.push((0,u.watch)((()=>({symbol:n.symbol,value:n.value,label:n.label,description:n.description})),((e,t)=>{e!==t&&(this._updateGroupsFromInfos(),this._isInfosSource=!0)}),{sync:!0}));this.addHandles(t,Z)}}_watchUniqueValueGroups(){this.removeHandles(U);const{uniqueValueGroups:e}=this;if(e){const t=[];for(const n of e){t.push((0,u.watch)((()=>({classes:n.classes})),((e,t)=>{e!==t&&(this._updateInfosFromGroups(),this._isInfosSource=!1)}),{sync:!0}));for(const e of n.classes??[])t.push((0,u.watch)((()=>({symbol:e.symbol,values:e.values,label:e.label,description:e.description})),((e,t)=>{e!==t&&(this._updateInfosFromGroups(),this._isInfosSource=!1)}),{sync:!0}))}this.addHandles(t,U)}}_updateInfosFromGroups(){if(!this.uniqueValueGroups)return this._set("uniqueValueInfos",null),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const e=[],{field:t,field2:n,field3:r,fieldDelimiter:i,uniqueValueGroups:s,valueExpression:o}=this;if(!t&&!o)return this._set("uniqueValueInfos",e),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const a=!(!t||!n);for(const t of s)for(const s of t.classes??[]){const{symbol:t,label:o,values:l,description:u}=s;for(const s of l??[]){const{value:l,value2:c,value3:p}=s,h=[l];n&&h.push(c),r&&h.push(p);const f=a?h.join(i||""):h[0]??void 0;e.push(new E.A({symbol:t,label:o,value:f,description:u}))}}this._set("uniqueValueInfos",e),this._updateValueInfoMap(),this._watchUniqueValueInfos()}_updateGroupsFromInfos(e=!1){if(!this.uniqueValueInfos)return this._set("uniqueValueGroups",null),void this._watchUniqueValueGroups();const{field:t,field2:n,valueExpression:r,fieldDelimiter:i,uniqueValueInfos:s}=this;if(!t&&!r||!s.length)return this._set("uniqueValueGroups",[]),void this._watchUniqueValueGroups();const o=!(!t||!n),a=s.map((e=>{const{symbol:t,label:n,value:r,description:s}=e,[a,l,u]=o?r?.toString()?.split(i||"")||[]:[r];return new R({symbol:t,label:n,description:s,values:[new C({value:a,value2:l,value3:u})]})})),l=[new N({classes:a})];e&&Object.freeze(l),this._set("uniqueValueGroups",l),this._watchUniqueValueGroups()}_getUniqueValueInfo(e,t){return this.valueExpression?this._getUnqiueValueInfoForExpression(e,t):this._getUnqiueValueInfoForFields(e)}_getUnqiueValueInfoForExpression(e,t){const{viewingMode:n,scale:r,spatialReference:i,arcade:s,timeZone:o}=t??{};let a=this._cache.compiledFunc;const l=s.arcadeUtils;if(!a){const e=l.createSyntaxTree(this.valueExpression);a=l.createFunction(e),this._cache.compiledFunc=a}const u=l.executeFunction(a,l.createExecContext(e,l.getViewInfo({viewingMode:n,scale:r,spatialReference:i}),o));return this._valueInfoMap[G(u)]}_getUnqiueValueInfoForFields(e){const t=this.field,n=e.attributes;let r;if(this.field2){const e=this.field2,i=this.field3,s=[];t&&s.push(n[t]),e&&s.push(n[e]),i&&s.push(n[i]),r=s.join(this.fieldDelimiter||"")}else t&&(r=n[t]);return this._valueInfoMap[G(r)]}static fromPortalStyle(e,t){const n=new D(t?.properties);n._set("styleOrigin",Object.freeze({styleName:e})),n._set("portal",t?.portal||b.A.getDefault());const r=n.populateFromStyle();return r.catch((t=>{B().error(`#fromPortalStyle('${e}'[, ...])`,"Failed to create unique value renderer from style name",t)})),r}static fromStyleUrl(e,t){const n=new D(t?.properties);n._set("styleOrigin",Object.freeze({styleUrl:e}));const r=n.populateFromStyle();return r.catch((t=>{B().error(`#fromStyleUrl('${e}'[, ...])`,"Failed to create unique value renderer from style URL",t)})),r}};(0,r._)([(0,c.MZ)({readOnly:!0})],H.prototype,"_cache",null),(0,r._)([(0,h.e)({uniqueValue:"unique-value"})],H.prototype,"type",void 0),(0,r._)([(0,c.MZ)(M.As)],H.prototype,"backgroundFillSymbol",void 0),(0,r._)([(0,c.MZ)({value:null,json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],H.prototype,"field",null),(0,r._)([(0,p.w)("field")],H.prototype,"castField",null),(0,r._)([(0,m.K)("field")],H.prototype,"writeField",null),(0,r._)([(0,c.MZ)({type:String,value:null,json:{write:!0}})],H.prototype,"field2",null),(0,r._)([(0,c.MZ)({type:String,value:null,json:{write:!0}})],H.prototype,"field3",null),(0,r._)([(0,c.MZ)({type:Boolean,json:{name:"drawInClassOrder",default:!1,write:!0,origins:{"web-scene":{write:!1}}}})],H.prototype,"orderByClassesEnabled",void 0),(0,r._)([(0,c.MZ)({type:String,value:null,json:{write:!0}})],H.prototype,"valueExpression",null),(0,r._)([(0,c.MZ)({type:String,json:{write:!0}})],H.prototype,"valueExpressionTitle",void 0),(0,r._)([(0,c.MZ)({type:A.A,json:{write:!0}})],H.prototype,"legendOptions",void 0),(0,r._)([(0,c.MZ)({type:String,json:{write:!0}})],H.prototype,"defaultLabel",void 0),(0,r._)([(0,c.MZ)((0,l.$N)({...M.z4},{json:{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}},origins:{"web-scene":{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}}}}}}))],H.prototype,"defaultSymbol",null),(0,r._)([(0,c.MZ)({type:String,value:null,json:{write:!0}})],H.prototype,"fieldDelimiter",null),(0,r._)([(0,c.MZ)({type:b.A,readOnly:!0})],H.prototype,"portal",void 0),(0,r._)([(0,f.w)("portal",["styleName"])],H.prototype,"readPortal",null),(0,r._)([(0,c.MZ)({readOnly:!0,json:{write:{enabled:!1,overridePolicy:()=>({enabled:!0})}}})],H.prototype,"styleOrigin",void 0),(0,r._)([(0,f.w)("styleOrigin",["styleName","styleUrl"])],H.prototype,"readStyleOrigin",null),(0,r._)([(0,m.K)("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],H.prototype,"writeStyleOrigin",null),(0,r._)([(0,c.MZ)({type:[N],json:{read:{source:["uniqueValueGroups","uniqueValueInfos"],reader:(e,t,n)=>(t.uniqueValueGroups||function(e){const{field1:t,field2:n,field3:r,fieldDelimiter:i,uniqueValueInfos:s,valueExpression:o}=e,a=!(!t||!n);return[{classes:(s??[]).map((e=>{const{symbol:s,label:l,value:u,description:c}=e,[p,h,f]=a?u?.toString()?.split(i||"")||[]:[u],d=[];return(t||o)&&d.push(p),n&&d.push(h),r&&d.push(f),{symbol:s,label:l,values:[d],description:c}}))}]}(t)).map((e=>N.fromJSON(e,n)))},write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],H.prototype,"uniqueValueGroups",null),(0,r._)([(0,c.MZ)({type:[E.A],json:{read:!1,write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],H.prototype,"uniqueValueInfos",null),H=D=(0,r._)([(0,d.$)(j)],H);const W=H},80892:function(e,t,n){n.d(t,{A:function(){return P}});var r,i=n(53804),s=n(52874),o=(n(50917),n(59469)),a=(n(10748),n(73037)),l=n(30905),u=n(21609),c=n(23502),p=(n(58941),n(40633),n(74376)),h=n(47332),f=n(65953),d=n(65298),m=n(53611),y=n(74865),g=n(29970),w=n(23879),b=n(36604),v=n(53096),x=n(70481),M=n(22198),A=n(90363),I=n(89814),S=n(45532),_=n(24411);const C=new Set(["esriMetersPerSecond","esriKilometersPerHour","esriKnots","esriFeetPerSecond","esriMilesPerHour"]),T=new a.J({beaufort_ft:"beaufort-ft",beaufort_km:"beaufort-km",beaufort_kn:"beaufort-kn",beaufort_m:"beaufort-m",beaufort_mi:"beaufort-mi",classified_arrow:"classified-arrow",ocean_current_kn:"ocean-current-kn",ocean_current_m:"ocean-current-m",simple_scalar:"simple-scalar",single_arrow:"single-arrow",wind_speed:"wind-barb"}),k=new a.J({flow_from:"flow-from",flow_to:"flow-to"});let R=r=class extends((0,g.h)(l.oY)){constructor(e){super(e),this.attributeField="Magnitude",this.flowRepresentation="flow-from",this.rotationType="arithmetic",this.style="single-arrow",this.symbolTileSize=50,this.type="vector-field"}readInputUnit(e,t){return C.has(e)?m.MD.fromJSON(e):null}readOutputUnit(e,t){return C.has(e)?m.MD.fromJSON(e):null}get styleRenderer(){const e=this.style,t=this.attributeField,n=this._createStyleRenderer(e);return n.field=t,n}get sizeVariables(){const e=[];if(this.visualVariables)for(const t of this.visualVariables)"size"===t.type&&e.push(t);if(0===e.length){const t=new v.A({field:"Magnitude",minSize:.2*this.symbolTileSize,maxSize:.8*this.symbolTileSize});this.visualVariables?this.visualVariables.push(t):this._set("visualVariables",[t]),e.push(t)}return e}get rotationVariables(){const e=[];if(this.visualVariables)for(const t of this.visualVariables)"rotation"===t.type&&e.push(t);if(0===e.length){const t=new b.A({field:"Direction",rotationType:this.rotationType});this.visualVariables?this.visualVariables.push(t):this._set("visualVariables",[t]),e.push(t)}return e}clone(){return new r({attributeField:this.attributeField,flowRepresentation:this.flowRepresentation,rotationType:this.rotationType,symbolTileSize:this.symbolTileSize,style:this.style,visualVariables:(0,u.o8)(this.visualVariables),inputUnit:this.inputUnit,outputUnit:this.outputUnit})}async getGraphicsFromPixelData(e,t=!1,n=[]){const r=new Array,i=(0,m.KL)(this.inputUnit,this.outputUnit),s=this.rotationVariables[0]?.rotationType||this.rotationType,a=t?(0,m.FI)(e.pixelBlock,"vector-uv",s,i):(0,m.Rn)(e.pixelBlock,"vector-magdir",i);if(null==a)return r;const l=e.extent,u=null!=a.mask&&a.mask.length>0;let c=0;const p=(l.xmax-l.xmin)/a.width,h=(l.ymax-l.ymin)/a.height;for(let e=0;e<a.height;e++)for(let t=0;t<a.width;t++,c++){let i=new S.default({x:l.xmin+t*p+p/2,y:l.ymax-e*h-h/2,spatialReference:l.spatialReference});i=(await(0,d.el)(i))[0];const s=n.some((e=>e.intersects(i)));if((!u||a.mask[c])&&!s){const e={Magnitude:a.pixels[0][c],Direction:a.pixels[1][c]},t=new o.default({geometry:new S.default({x:i.x,y:i.y,spatialReference:l.spatialReference}),attributes:e});t.symbol=this._getVisualVariablesAppliedSymbol(t),r.push(t)}}return r}getSymbol(e,t){}async getSymbolAsync(e,t){}getSymbols(){return[]}getClassBreakInfos(){return this.styleRenderer?.classBreakInfos}getDefaultSymbol(){return this.styleRenderer?.defaultSymbol}_getDefaultSymbol(e){return new A.A({path:"M14,32 14,18 9,23 16,3 22,23 17,18 17,32 z",outline:new M.A({width:0}),size:20,color:e||new s.A([0,92,230])})}_getVisualVariablesAppliedSymbol(e){if(!e)return;const t=this.styleRenderer?.getSymbol(e)?.clone(),n=this.sizeVariables,r=this.rotationVariables;if(n&&n.length&&this.sizeVariables.forEach((n=>(0,I.UQ)(t,(0,x.getAllSizes)([n],e)))),r&&r.length){const n="flow-to"===this.flowRepresentation==("ocean-current-kn"===this.style||"ocean-current-m"===this.style)?0:180;e.attributes.Direction=e.attributes.Direction+n,this.rotationVariables.forEach((n=>(0,I.GG)(t,(0,x.getRotationAngle)(n,e),n.axis)))}return t}_createStyleRenderer(e){let t={defaultSymbol:this._getDefaultSymbol(),classBreakInfos:[]};switch(e){case"single-arrow":t=this._createSingleArrowRenderer();break;case"beaufort-kn":t=this._createBeaufortKnotsRenderer();break;case"beaufort-m":t=this._createBeaufortMeterRenderer();break;case"beaufort-ft":t=this._createBeaufortFeetRenderer();break;case"beaufort-mi":t=this._createBeaufortMilesRenderer();break;case"beaufort-km":t=this._createBeaufortKilometersRenderer();break;case"ocean-current-m":t=this._createCurrentMeterRenderer();break;case"ocean-current-kn":t=this._createCurrentKnotsRenderer();break;case"simple-scalar":t=this._createSimpleScalarRenderer();break;case"wind-barb":t=this._createWindBarbsRenderer();break;case"classified-arrow":t=this._createClassifiedArrowRenderer()}return new y.A(t)}_createSingleArrowRenderer(){return{defaultSymbol:this._getDefaultSymbol()}}_createBeaufortKnotsRenderer(){return{defaultSymbol:this._getDefaultSymbol(new s.A([214,47,39])),classBreakInfos:this._getClassBreaks([0,1,3,6,10,16,21,27,33,40,47,55,63],[[40,146,199],[89,162,186],[129,179,171],[160,194,155],[191,212,138],[218,230,119],[250,250,100],[252,213,83],[252,179,102],[250,141,52],[247,110,42],[240,71,29]])}}_createBeaufortMeterRenderer(){return{defaultSymbol:this._getDefaultSymbol(new s.A([214,47,39])),classBreakInfos:this._getClassBreaks([0,.2,1.8,3.3,5.4,8.5,11,14.1,17.2,20.8,24.4,28.6,32.7],[[69,117,181],[101,137,184],[132,158,186],[162,180,189],[192,204,190],[222,227,191],[255,255,191],[255,220,161],[250,185,132],[245,152,105],[237,117,81],[232,21,21]])}}_createBeaufortFeetRenderer(){const e=this._getDefaultSymbol(new s.A([214,47,39]));let t=[0,.2,1.8,3.3,5.4,8.5,11,14.1,17.2,20.8,24.4,28.6,32.7];return t=t.map((e=>3.28084*e)),{defaultSymbol:e,classBreakInfos:this._getClassBreaks(t,[[69,117,181],[101,137,184],[132,158,186],[162,180,189],[192,204,190],[222,227,191],[255,255,191],[255,220,161],[250,185,132],[245,152,105],[237,117,81],[232,21,21]])}}_createBeaufortMilesRenderer(){const e=this._getDefaultSymbol(new s.A([214,47,39]));let t=[0,.2,1.8,3.3,5.4,8.5,11,14.1,17.2,20.8,24.4,28.6,32.7];return t=t.map((e=>2.23694*e)),{defaultSymbol:e,classBreakInfos:this._getClassBreaks(t,[[69,117,181],[101,137,184],[132,158,186],[162,180,189],[192,204,190],[222,227,191],[255,255,191],[255,220,161],[250,185,132],[245,152,105],[237,117,81],[232,21,21]])}}_createBeaufortKilometersRenderer(){const e=this._getDefaultSymbol(new s.A([214,47,39]));let t=[0,.2,1.8,3.3,5.4,8.5,11,14.1,17.2,20.8,24.4,28.6,32.7];return t=t.map((e=>3.6*e)),{defaultSymbol:e,classBreakInfos:this._getClassBreaks(t,[[69,117,181],[101,137,184],[132,158,186],[162,180,189],[192,204,190],[222,227,191],[255,255,191],[255,220,161],[250,185,132],[245,152,105],[237,117,81],[232,21,21]])}}_createCurrentMeterRenderer(){return{defaultSymbol:this._getDefaultSymbol(new s.A([177,177,177])),classBreakInfos:this._getClassBreaks([0,.5,1,1.5,2],[[78,26,153],[179,27,26],[202,128,26],[177,177,177]])}}_createCurrentKnotsRenderer(){return{defaultSymbol:this._getDefaultSymbol(new s.A([177,177,177])),classBreakInfos:this._getClassBreaks([0,.25,.5,1,1.5,2,2.5,3,3.5,4],[[0,0,0],[0,37,100],[78,26,153],[151,0,100],[179,27,26],[177,78,26],[202,128,26],[177,179,52],[177,177,177]])}}_createClassifiedArrowRenderer(){const e=this._getDefaultSymbol(new s.A([56,168,0]));let t=[0,1e-6,3.5,7,10.5,14];if(this.sizeVariables?.length){const e=this.sizeVariables[0].minDataValue,n=this.sizeVariables[0].maxDataValue;if(e&&n){const r=(n-e)/5;t=Array.from(Array(6).keys()).map((t=>e+r*t))}}return{defaultSymbol:e,classBreakInfos:this._getClassBreaks(t,[[56,168,0],[139,309,0],[255,255,0],[255,128,0],[255,0,0]])}}_createSimpleScalarRenderer(){return{defaultSymbol:_.A.fromJSON({imageData:"iVBORw0KGgoAAAANSUhEUgAAACsAAAArCAQAAABLVLlLAAAABGdBTUEAAYagMeiWXwAAAAJiS0dEAACqjSMyAAAACXBIWXMAAABIAAAASABGyWs+AAAC3ElEQVRIx9XXvW4cVRQH8N982btpsIREJECyiCXsxX4DKh6AliqGKCBBE2SlwlHgAbBD/AKmyEYUeQ1KahPZSZQvBCkQLTHZ7KGY8Xodz4w3a1NwbzVzz/znfJ//zbStVC5q3icKak9GAs2QIdDx3PtW/S011NW3p+M5Eomh11ipTIKe6+4LQzHaQ+G+63pIZNJJQXMpljwTwj1brpgx5w1zZlyx5Z4QnllEIm2xeeSUHBf0hV0bejo1Uh09G3aFvgXk7cCJFBc9EdaRVuHJJaOdKyTV2TVhYLMduNR0Q9gxL5GaaTDw8GzejrDRBpxWoGsySRW0dttKuattwNkIlFw2YXgzOdYq4Ox49PlM+JrKd5OusjTWhBuVxUfMX/KXXZ3WEmkuqa67wspR4BTbwtKr/5u4fFgStse/T7EifFPnnYl9zPq4vmUOPrRndgoHjDti1gOPqlyXoifcRNGQzUd31lDyfHmob1Gp35vSr+P6vilcQ5Egtyd8YF/ySg9NhPM+9M/IOaHwp5+PSZayXTvCogEUwlatC3J8LLwYtcWB8EuDXQVuCkV5/B4eNHb7wGBs87LBDS+xjdVSn09wq1G8dFM+9tSUhIGneLvUdniKxKpTYljCpu3j7rVWlHj/P23v4NPGUEyeCQnexe9lJjzEQqMjJs+EzNAX6B98dBZVRmroJx95x/A/6gln18EyfCUsl+qdXb/tjvfbw+mwforpUOBz4XLVoBwAn3aWnfeH246NyBXhrq7TTN5lNSP9RkU+puUJm3W2Tsdq0nZWM07srk7MwQrZSRysjjGWBLRJNsNbfj2JMR4AbxpU1XLAb9Mxfpsq5EjMuuiR8L0JiHOOBX3hiUvOmavN0nMueSzcceFk0BK4pMqLo7vDD1Z0qrtDx7Itt4Xwm9UqbMmk8S0Dtuzb2pvOU99Z1nLTOfleNmvfZfP2pYZmPfajwosKdDBNpacNpVGGsWX9CyDI8Xq/Sj6QAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE0LTExLTEwVDAzOjE3OjU4LTA1OjAwF+tHyQAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxNC0xMS0xMFQwMzoxNzo1OC0wNTowMGa2/3UAAAAASUVORK5CYII=",height:20,width:20,type:"esriPMS",angle:0})}}_createWindBarbsRenderer(){const e=Array.from(Array(31).keys()).map((e=>5*e)),t=[{range:"0-5",path:"M20 20 M5 20 A15 15 0 1 0 35 20 A15 15 0 1 0 5 20 M20 20 M10 20 A10 10 0 1 0 30 20 A10 10 0 1 0 10 20",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMzJweCIgd2lkdGg9IjMycHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTIwIDIwIE01IDIwIEExNSAxNSAwIDEgMCAzNSAyMCBBMTUgMTUgMCAxIDAgNSAyMCBNMjAgMjAgTTEwIDIwIEExMCAxMCAwIDEgMCAzMCAyMCBBMTAgMTAgMCAxIDAgMTAgMjAiIHN0eWxlPSJzdHJva2U6cmdiKDAsMCwwKTtzdHJva2Utd2lkdGg6MS41Ii8+CiA8L3N2Zz4="},{range:"5-10",path:"M25 0 L25 40 M25 35 L17.5 37.5",imageData:"PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjkgMCAyNyA0NiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cGF0aCBkPSJNMjUgMCBMMjUgNDAgTTI1IDM1IEwxNy41IDM3LjUiIHN0eWxlPSJzdHJva2U6cmdiKDAsMCwwKTtzdHJva2Utd2lkdGg6MS41Ii8+CiA8L3N2Zz4="},{range:"10-15",path:"M25 0 L25 40 L10 45 L25 40",imageData:"PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjkgMCAyNyA0NiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cGF0aCBkPSJNMjUgMCBMMjUgNDAgTDEwIDQ1IEwyNSA0MCIgc3R5bGU9InN0cm9rZTpyZ2IoMCwwLDApO3N0cm9rZS13aWR0aDoxLjUiLz4KIDwvc3ZnPg=="},{range:"15-20",path:"M25 0 L25 40 L10 45 L25 40 M25 35 L17.5 37.5",imageData:"PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjEyIDAgMTUgNDUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0NSBMMjUgNDAgTTI1IDM1IEwxNy41IDM3LjUiIHN0eWxlPSJzdHJva2U6cmdiKDAsMCwwKTtzdHJva2Utd2lkdGg6MS41Ii8+CiA8L3N2Zz4="},{range:"20-25",path:"M25 0 L25 40 L10 45 L25 40 M25 35 L10 40",imageData:"PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjkgMCAyNiA0NiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cGF0aCBkPSJNMjUgMCBMMjUgNDAgTDEwIDQ1IEwyNSA0MCBNMjUgMzUgTDEwIDQwIiBzdHlsZT0ic3Ryb2tlOnJnYigwLDAsMCk7c3Ryb2tlLXdpZHRoOjEuNSIvPgogPC9zdmc+"},{range:"25-30",path:"M25 0 L25 40 L10 45 L25 40 M25 35 L10 40 L25 35 M25 30 L17.5 32.5",imageData:"PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjkgMCAyNiA0NiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cGF0aCBkPSJNMjUgMCBMMjUgNDAgTDEwIDQ1IEwyNSA0MCBNMjUgMzUgTDEwIDQwIEwyNSAzNSBNMjUgMzAgTDE3LjUgMzIuNSIgc3R5bGU9InN0cm9rZTpyZ2IoMCwwLDApO3N0cm9rZS13aWR0aDoxLjUiLz4KIDwvc3ZnPg=="},{range:"30-35",path:"M25 0 L25 40 L10 45 L25 40 M25 35 L10 40 L25 35 M25 30 L10 35",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMHB4IiBoZWlnaHQ9IjIwcHgiIHZpZXdCb3g9IjkgMCAyNiA0NiI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0NSBMMjUgNDAgTTI1IDM1IEwxMCA0MCBMMjUgMzUgTTI1IDMwIEwxMCAzNSIgc3R5bGU9InN0cm9rZTpyZ2IoMCwwLDApO3N0cm9rZS13aWR0aDoxLjUiLz4KIDwvc3ZnPg=="},{range:"35-40",path:"M25 0 L25 40 L10 45 L25 40 M25 35 L10 40 L25 35 M25 30 L10 35 L25 30 M25 25 L17.5 27.5",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMHB4IiBoZWlnaHQ9IjIwcHgiIHZpZXdCb3g9IjkgMCAyNiA0NiI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0NSBMMjUgNDAgTTI1IDM1IEwxMCA0MCBMMjUgMzUgTTI1IDMwIEwxMCAzNSBMMjUgMzAgTTI1IDI1IEwxNy41IDI3LjUiIHN0eWxlPSJzdHJva2U6cmdiKDAsMCwwKTtzdHJva2Utd2lkdGg6MS41Ii8+CiA8L3N2Zz4="},{range:"40-45",path:"M25 0 L25 40 L10 45 L25 40 M25 35 L10 40 L25 35 M25 30 L10 35 L25 30 M25 25 L10 30",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMHB4IiBoZWlnaHQ9IjIwcHgiIHZpZXdCb3g9IjkgMCAyNiA0NiI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0NSBMMjUgNDAgTTI1IDM1IEwxMCA0MCBMMjUgMzUgTTI1IDMwIEwxMCAzNSBMMjUgMzAgTTI1IDI1IEwxMCAzMCIgc3R5bGU9InN0cm9rZTpyZ2IoMCwwLDApO3N0cm9rZS13aWR0aDoxLjUiLz4KIDwvc3ZnPg=="},{range:"45-50",path:"M25 0 L25 40 L10 45 L25 40 M25 35 L10 40 L25 35 M25 30 L10 35 L25 30 M25 25 L10 30 L25 25 M25 20 L17.5 22.5",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMHB4IiBoZWlnaHQ9IjIwcHgiIHZpZXdCb3g9IjkgMCAyNiA0NiI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0NSBMMjUgNDAgTTI1IDM1IEwxMCA0MCBMMjUgMzUgTTI1IDMwIEwxMCAzNSBMMjUgMzAgTTI1IDI1IEwxMCAzMCBMMjUgMjUgTTI1IDIwIEwxNy41IDIyLjUiIHN0eWxlPSJzdHJva2U6cmdiKDAsMCwwKTtzdHJva2Utd2lkdGg6MS41Ii8+CiA8L3N2Zz4="},{range:"50-55",path:"M25 0 L25 40 L10 40 L25 35",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMHB4IiBoZWlnaHQ9IjIwcHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUiIHN0eWxlPSJzdHJva2U6cmdiKDAsMCwwKTtzdHJva2Utd2lkdGg6MS41Ii8+CiA8L3N2Zz4="},{range:"55-60",path:"M25 0 L25 40 L10 40 L25 35 M25 30 L17.5 32.5",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMHB4IiBoZWlnaHQ9IjIwcHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUgTTI1IDMwIEwxNy41IDMyLjUiIHN0eWxlPSJzdHJva2U6cmdiKDAsMCwwKTtzdHJva2Utd2lkdGg6MS41Ii8+CiA8L3N2Zz4="},{range:"60-65",path:"M25 0 L25 40 L10 40 L25 35 M25 30 L10 35",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMnB4IiBoZWlnaHQ9IjMycHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUgTTI1IDMwIEwxMCAzNSIgc3R5bGU9InN0cm9rZTpyZ2IoMCwwLDApO3N0cm9rZS13aWR0aDoxLjUiLz4KIDwvc3ZnPg=="},{range:"65-70",path:"M25 0 L25 40 L10 40 L25 35 M25 30 L10 35 L25 30 M25 25 L17.5 27.5",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMnB4IiBoZWlnaHQ9IjMycHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUgTTI1IDMwIEwxMCAzNSBMMjUgMzAgTTI1IDI1IEwxNy41IDI3LjUiIHN0eWxlPSJzdHJva2U6cmdiKDAsMCwwKTtzdHJva2Utd2lkdGg6MS41Ii8+CiA8L3N2Zz4="},{range:"70-75",path:"M25 0 L25 40 L10 40 L25 35 M25 30 L10 35 L25 30 M25 25 L10 30",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMnB4IiBoZWlnaHQ9IjMycHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUgTTI1IDMwIEwxMCAzNSBMMjUgMzAgTTI1IDI1IEwxMCAzMCIgc3R5bGU9InN0cm9rZTpyZ2IoMCwwLDApO3N0cm9rZS13aWR0aDoxLjUiLz4KIDwvc3ZnPg=="},{range:"75-80",path:"M25 0 L25 40 L10 40 L25 35 M25 30 L10 35 L25 30 M25 25 L10 30 L25 25 M25 20 L17.5 22.5",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMnB4IiBoZWlnaHQ9IjMycHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUgTTI1IDMwIEwxMCAzNSBMMjUgMzAgTTI1IDI1IEwxMCAzMCBMMjUgMjUgTTI1IDIwIEwxNy41IDIyLjUiIHN0eWxlPSJzdHJva2U6cmdiKDAsMCwwKTtzdHJva2Utd2lkdGg6MS41Ii8+CiA8L3N2Zz4="},{range:"80-85",path:"M25 0 L25 40 L10 40 L25 35 M25 30 L10 35 L25 30 M25 25 L10 30 L25 25 M25 20 L10 25",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMnB4IiBoZWlnaHQ9IjMycHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUgTTI1IDMwIEwxMCAzNSBMMjUgMzAgTTI1IDI1IEwxMCAzMCBMMjUgMjUgTTI1IDIwIEwxMCAyNSIgc3R5bGU9InN0cm9rZTpyZ2IoMCwwLDApO3N0cm9rZS13aWR0aDoxLjUiLz4KIDwvc3ZnPg=="},{range:"85-90",path:"M25 0 L25 40 L10 40 L25 35 M25 30 L10 35 L25 30 M25 25 L10 30 L25 25 M25 20 L10 25 L25 20 M25 15 L17.5 17.5",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMnB4IiBoZWlnaHQ9IjMycHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUgTTI1IDMwIEwxMCAzNSBMMjUgMzAgTTI1IDI1IEwxMCAzMCBMMjUgMjUgTTI1IDIwIEwxMCAyNSBMMjUgMjAgTTI1IDE1IEwxNy41IDE3LjUiIHN0eWxlPSJzdHJva2U6cmdiKDAsMCwwKTtzdHJva2Utd2lkdGg6MS41Ii8+CiA8L3N2Zz4="},{range:"90-95",path:"M25 0 L25 40 L10 40 L25 35 M25 30 L10 35 L25 30 M25 25 L10 30 L25 25 M25 20 L10 25 L25 20 M25 15 L10 20",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMnB4IiBoZWlnaHQ9IjMycHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUgTTI1IDMwIEwxMCAzNSBMMjUgMzAgTTI1IDI1IEwxMCAzMCBMMjUgMjUgTTI1IDIwIEwxMCAyNSBMMjUgMjAgTTI1IDE1IEwxMCAyMCIgc3R5bGU9InN0cm9rZTpyZ2IoMCwwLDApO3N0cm9rZS13aWR0aDoxLjUiLz4KIDwvc3ZnPg=="},{range:"95-100",path:"M25 0 L25 40 L10 40 L25 35 M25 30 L10 35 L25 30 M25 25 L10 30 L25 25 M25 20 L10 25 L25 20 M25 15 L10 20 L25 15 M25 10 L17.5 12.5",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMnB4IiBoZWlnaHQ9IjMycHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUgTTI1IDMwIEwxMCAzNSBMMjUgMzAgTTI1IDI1IEwxMCAzMCBMMjUgMjUgTTI1IDIwIEwxMCAyNSBMMjUgMjAgTTI1IDE1IEwxMCAyMCBMMjUgMTUgTTI1IDEwIEwxNy41IDEyLjUiIHN0eWxlPSJzdHJva2U6cmdiKDAsMCwwKTtzdHJva2Utd2lkdGg6MS41Ii8+CiA8L3N2Zz4="},{range:"100-105",path:"M25 0 L25 40 L10 40 L25 35 L10 35 L25 30",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMnB4IiBoZWlnaHQ9IjMycHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUgTDEwIDM1IEwyNSAzMCIgc3R5bGU9InN0cm9rZTpyZ2IoMCwwLDApO3N0cm9rZS13aWR0aDoxLjUiLz4KIDwvc3ZnPg=="},{range:"105-110",path:"M25 0 L25 40 L10 40 L25 35 L10 35 L25 30 M25 25 L17.5 27.5",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMzJweCIgd2lkdGg9IjMycHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUgTDEwIDM1IEwyNSAzMCBNMjUgMjUgTDE3LjUgMjcuNSIgc3R5bGU9InN0cm9rZTpyZ2IoMCwwLDApO3N0cm9rZS13aWR0aDoxLjUiLz4KIDwvc3ZnPg=="},{range:"110-115",path:"M25 0 L25 40 L10 40 L25 35 L10 35 L25 30 M25 25 L10 30",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMzJweCIgd2lkdGg9IjMycHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUgTDEwIDM1IEwyNSAzMCBNMjUgMjUgTDEwIDMwIiBzdHlsZT0ic3Ryb2tlOnJnYigwLDAsMCk7c3Ryb2tlLXdpZHRoOjEuNSIvPgogPC9zdmc+"},{range:"115-120",path:"M25 0 L25 40 L10 40 L25 35 L10 35 L25 30 M25 25 L10 30 M25 25 M25 20 L17.5 22.5",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMzJweCIgd2lkdGg9IjMycHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUgTDEwIDM1IEwyNSAzMCBNMjUgMjUgTDEwIDMwIE0yNSAyNSBNMjUgMjAgTDE3LjUgMjIuNSIgc3R5bGU9InN0cm9rZTpyZ2IoMCwwLDApO3N0cm9rZS13aWR0aDoxLjUiLz4KIDwvc3ZnPg=="},{range:"120-125",path:"M25 0 L25 40 L10 40 L25 35 L10 35 L25 30 M25 25 L10 30 M25 25 M25 20 L10 25",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMzJweCIgd2lkdGg9IjMycHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUgTDEwIDM1IEwyNSAzMCBNMjUgMjUgTDEwIDMwIE0yNSAyNSBNMjUgMjAgTDEwIDI1IiBzdHlsZT0ic3Ryb2tlOnJnYigwLDAsMCk7c3Ryb2tlLXdpZHRoOjEuNSIvPgogPC9zdmc+"},{range:"125-130",path:"M25 0 L25 40 L10 40 L25 35 L10 35 L25 30 M25 25 L10 30 M25 25 M25 20 L10 25 M25 20 M25 15 L17.5 17.5",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMzJweCIgd2lkdGg9IjMycHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUgTDEwIDM1IEwyNSAzMCBNMjUgMjUgTDEwIDMwIE0yNSAyNSBNMjUgMjAgTDEwIDI1IE0yNSAyMCBNMjUgMTUgTDE3LjUgMTcuNSIgc3R5bGU9InN0cm9rZTpyZ2IoMCwwLDApO3N0cm9rZS13aWR0aDoxLjUiLz4KIDwvc3ZnPg=="},{range:"130-135",path:"M25 0 L25 40 L10 40 L25 35 L10 35 L25 30 M25 25 L10 30 M25 25 M25 20 L10 25 M25 20 M25 15 L10 20",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMzJweCIgd2lkdGg9IjMycHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUgTDEwIDM1IEwyNSAzMCBNMjUgMjUgTDEwIDMwIE0yNSAyNSBNMjUgMjAgTDEwIDI1IE0yNSAyMCBNMjUgMTUgTDEwIDIwIiBzdHlsZT0ic3Ryb2tlOnJnYigwLDAsMCk7c3Ryb2tlLXdpZHRoOjEuNSIvPgogPC9zdmc+"},{range:"135-140",path:"M25 0 L25 40 L10 40 L25 35 L10 35 L25 30 M25 25 L10 30 M25 25 M25 20 L10 25 M25 20 M25 15 L10 20 M25 15 M25 10 L17.5 12.5",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMzJweCIgd2lkdGg9IjMycHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUgTDEwIDM1IEwyNSAzMCBNMjUgMjUgTDEwIDMwIE0yNSAyNSBNMjUgMjAgTDEwIDI1IE0yNSAyMCBNMjUgMTUgTDEwIDIwIE0yNSAxNSBNMjUgMTAgTDE3LjUgMTIuNSIgc3R5bGU9InN0cm9rZTpyZ2IoMCwwLDApO3N0cm9rZS13aWR0aDoxLjUiLz4KIDwvc3ZnPg=="},{range:"140-145",path:"M25 0 L25 40 L10 40 L25 35 L10 35 L25 30 M25 25 L10 30 M25 25 M25 20 L10 25 M25 20 M25 15 L10 20 M25 15 M25 10 L17.5 12.5",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMzJweCIgd2lkdGg9IjMycHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUgTDEwIDM1IEwyNSAzMCBNMjUgMjUgTDEwIDMwIE0yNSAyNSBNMjUgMjAgTDEwIDI1IE0yNSAyMCBNMjUgMTUgTDEwIDIwIE0yNSAxNSBNMjUgMTAgTDEwIDE1IiBzdHlsZT0ic3Ryb2tlOnJnYigwLDAsMCk7c3Ryb2tlLXdpZHRoOjEuNSIvPgogPC9zdmc+"},{range:"145-150",path:"M25 0 L25 40 L10 40 L25 35 L10 35 L25 30 M25 25 L10 30 M25 25 M25 20 L10 25 M25 20 M25 15 L10 20 M25 15 M25 10 L17.5 12.5",imageData:"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMzJweCIgd2lkdGg9IjMycHgiIHZpZXdCb3g9IjkgMCAyNiA0MSI+CiAgPHBhdGggZD0iTTI1IDAgTDI1IDQwIEwxMCA0MCBMMjUgMzUgTDEwIDM1IEwyNSAzMCBNMjUgMjUgTDEwIDMwIE0yNSAyNSBNMjUgMjAgTDEwIDI1IE0yNSAyMCBNMjUgMTUgTDEwIDIwIE0yNSAxNSBNMjUgMTAgTDEwIDE1IE0yNSAxMCBNMjUgNSBMMTcuNSA3LjUiIHN0eWxlPSJzdHJva2U6cmdiKDAsMCwwKTtzdHJva2Utd2lkdGg6MS41Ii8+CiA8L3N2Zz4="}],n=_.A.fromJSON({imageData:"iVBORw0KGgoAAAANSUhEUgAAACgAAAApCAQAAADtq6NDAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAJiS0dEAP+Hj8y/AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAEY0lEQVRIx5XXWWxWRRQH8N+d+31tUdGAVjGglYJABFEBY91jfDAg7piYaFTccA++uMQEFRcSXlATtxiXqMQt4G4iisYl0ai4sIQYtVFZ1KIFKdTS0l4f7vRCS5fPebozc+bM/2z/Mzcx0AgSiUxXnKfIdMn875FIhX53U2n/B/s+kKM4UINTjTBZImixxnrv+9a2iL6zEoUBXcoudrWj/OtHm3wt02lfU9Qao9OnHvIhgmww84MEl1qnxfNmGrqHxAizLdPpC6chGcAxKGGcL+30gOERf1BSpUqVslQSV8d5ReZFe8VQ9avufJn31cWwlJV7iafKStGOE/1qvfH9qUxxu8ydUdmuSKbGO8YUdT2inKLG69pM70tliktl5qIkCAJGmusDG7Vqsc0WjZa4UBlBiA5YZIcjYzB7qDtH5kaUJFLs7RGZTZ42W4PRRmtwvbdt1+wGiaS4drEtDttdZYIDNVuAclR3vA3+dI3qHqmVSy7U6Tv1MScCPvPR7nIpFlsdCy3FdTLPGhK92e2CUITjMJ9ocwKxnsZqc3O3JwMma3d6UVLnyVxB4aXemZqvPqLdpJhW3KVVbY4yYImPo6M5Urv50fj+0z/FG9YaEiENs8UtMfXUaTeTePNHlhXfA1UU+2lyD1Il3Gtt9+adfpNG7dNlpg2U/T3KYLZ2dUWFdTgp3/rQ4sK973qnInV5TIf40x3dhvrJPBiqyWUo4wAtLqhQYS71qK+QKOFRywmGK/kpikzV6WMKhh58vGWs4TIJNjiEYLIuP8Tt4/zmLyqk+AyrJSbF+Qq1DgqRUPMxyl+9q3IQhX/rMCJ6tEunriDs1oSyQZKlr9AkhT2ZIARbJfaJS1vtVbHB+Rgi0RK/y1q1BWsEEyLoz40xtGKcARPVWB1BTPO7f4LNtpkUl1aoMbViLyZo0GRjPD3BxnxjqXeLYlvhqYrzMMG3HoyJXa3JjfnGlbYYFlP7Jh3qKsKY4hQ7TY0nG+xwRL61n63mxHtqNHosigyMLmClNwvuecFnOZB88nNBDzNkzhxEZaKMBVoKapggMzvHHXBEpNSSFAvtcFRsVn0bW8LlMmcXs+c0Kne3gRR32+zg4uXwjC6zit6Wt4a8LXVfcp/MtQXHn2ynGbuCmb8GvvFeJLEE82ReU9/n6+dkq2x3buG9Wn94smcgAw631RPR7BTH+kbmHReZoEpOdEe7zWqZl40s0JWs9Hmv7hjBHqPDwsjGKVJnWWqjbdZp1KhJi0aPmxYZsIRhlttgeF+Jlke41QcOQKoqilSb6HJzSvNG3G/UoWnxwsmt+sVaYwd63dRbqdnMyCPVeyRPvpYgdavM22oGKoMUVRbJfOWMwidJ8Zzb1UvmWK/VVUXzHaTjjrVYh1897HT7xxYEVUaa5SWb/WO+YUWa9SrwvigzM8YlzlYv2GSdVCYxxlBtVnnFq5olwp5/BEk/OLsf5LUmG2+inRJdVvjZ97ZH9/zP34ug1O91pf4p+D+JYBpvrKxfbwAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxNC0xMS0xMFQwMzoxMjowOS0wNTowMB9ViV0AAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTQtMTEtMTBUMDM6MTI6MDktMDU6MDBuCDHhAAAAAElFTkSuQmCC",height:20,width:20,type:"esriPMS",angle:0}),r=e.map(((r,i)=>{let s;if(i!==e.length-1)if(0===i)s={minValue:r,maxValue:e[i+1],symbol:n};else{const n=_.A.fromJSON({type:"esriPMS",imageData:t[i].imageData,contentType:"image/svg+xml",height:32,width:32,angle:0});s={minValue:r,maxValue:e[i+1],symbol:n}}return new w.A(s)}));return{defaultSymbol:n,classBreakInfos:r}}_getClassBreaks(e,t){return t.map(((t,n)=>new w.A({minValue:e[n],maxValue:e[n+1],symbol:this._getDefaultSymbol(new s.A(t))})))}};(0,i._)([(0,c.MZ)({type:["Magnitude"],json:{write:!0}})],R.prototype,"attributeField",void 0),(0,i._)([(0,c.MZ)({type:k.apiValues,json:{type:k.jsonValues,read:{reader:k.read},write:{writer:k.write}}})],R.prototype,"flowRepresentation",void 0),(0,i._)([(0,c.MZ)({type:["geographic","arithmetic"],json:{write:!0}})],R.prototype,"rotationType",void 0),(0,i._)([(0,c.MZ)({type:T.apiValues,json:{type:T.jsonValues,read:{reader:T.read},write:{writer:T.write}}})],R.prototype,"style",void 0),(0,i._)([(0,c.MZ)({json:{write:!0}})],R.prototype,"symbolTileSize",void 0),(0,i._)([(0,c.MZ)({type:m.MD.apiValues,json:{type:m.MD.jsonValues,write:{writer:m.MD.write}}})],R.prototype,"inputUnit",void 0),(0,i._)([(0,h.w)("inputUnit")],R.prototype,"readInputUnit",null),(0,i._)([(0,c.MZ)({type:m.MD.apiValues,json:{type:m.MD.jsonValues,read:{reader:m.MD.read},write:{writer:m.MD.write}}})],R.prototype,"outputUnit",void 0),(0,i._)([(0,h.w)("outputUnit")],R.prototype,"readOutputUnit",null),(0,i._)([(0,p.e)({vectorField:"vector-field"})],R.prototype,"type",void 0),(0,i._)([(0,c.MZ)({type:y.A})],R.prototype,"styleRenderer",null),(0,i._)([(0,c.MZ)({type:v.A})],R.prototype,"sizeVariables",null),(0,i._)([(0,c.MZ)({type:b.A})],R.prototype,"rotationVariables",null),R=r=(0,i._)([(0,f.$)("esri.renderers.VectorFieldRenderer")],R);const P=R},29970:function(e,t,n){n.d(t,{h:function(){return S}});var r=n(53804),i=n(23502),s=(n(58941),n(40633)),o=(n(13798),n(47332)),a=n(65953),l=n(81392),u=n(53743);const c=/^hash\(\$feature\['((\\'|[^'])+)'\]\) \* 8\.381e-8$/;var p=n(74843),h=n(14170),f=n(36604),d=n(53096),m=n(64494),y=n(83525),g=n(73037),w=n(89001);const b={color:p.A,size:d.A,opacity:h.A,rotation:f.A},v=new g.J({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),x=/^\[([^\]]+)\]$/i;let M=class extends y.A{constructor(){super(...arguments),this.colorVariables=null,this.opacityVariables=null,this.rotationVariables=null,this.sizeVariables=null}set visualVariables(e){if(this._resetVariables(),e=e?.filter((e=>!!e)),e?.length){for(const t of e)switch(t.type){case"color":this.colorVariables.push(t);break;case"opacity":this.opacityVariables.push(t);break;case"rotation":this.rotationVariables.push(t);break;case"size":this.sizeVariables.push(t)}this.sizeVariables.length&&this.sizeVariables.some((e=>!!e.target))&&e.sort(((e,t)=>{let n=null;return n=e.target===t.target?0:e.target?1:-1,n}));for(let t=0;t<e.length;t++)e[t].index=t;this._set("visualVariables",e)}else this._set("visualVariables",e)}readVariables(e,t,n){const{rotationExpression:r,rotationType:i}=t,o=r?.match(x),a=o?.[1];if(a&&(e||(e=[]),e.push({type:"rotationInfo",rotationType:i,field:a})),e)return e.map((e=>{const t=v.read(e.type),r=b[t];r||(s.A.getLogger(this).warn(`Unknown variable type: ${t}`),n?.messages&&n.messages.push(new w.A("visual-variable:unsupported",`visualVariable of type '${t}' is not supported`,{definition:e,context:n})));const i=new r;return i.read(e,n),i}))}writeVariables(e,t){const n=[];for(const r of e){const e=r.toJSON(t);e&&n.push(e)}return n}_resetVariables(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]}};(0,r._)([(0,i.MZ)()],M.prototype,"visualVariables",null),M=(0,r._)([(0,a.$)("esri.renderers.visualVariables.VisualVariableFactory")],M);const A=M,I={base:m.A,key:"type",typeMap:{opacity:h.A,color:p.A,rotation:f.A,size:d.A}},S=e=>{let t=class extends e{constructor(){super(...arguments),this._vvFactory=new A}set visualVariables(e){this._vvFactory.visualVariables=e,this._set("visualVariables",this._vvFactory.visualVariables)}readVisualVariables(e,t,n){return this._vvFactory.readVariables(e,t,n)}writeVisualVariables(e,t,n,r){t[n]=this._vvFactory.writeVariables(e,r)}get arcadeRequiredForVisualVariables(){if(!this.visualVariables)return!1;for(const e of this.visualVariables)if(e.arcadeRequired)return!0;return!1}hasVisualVariables(e,t){return e?this.getVisualVariablesForType(e,t).length>0:this.getVisualVariablesForType("size",t).length>0||this.getVisualVariablesForType("color",t).length>0||this.getVisualVariablesForType("opacity",t).length>0||this.getVisualVariablesForType("rotation",t).length>0}getVisualVariablesForType(e,t){const n=this.visualVariables;return n?n.filter((n=>n.type===e&&("string"==typeof t?n.target===t:!1!==t||!n.target))):[]}async collectVVRequiredFields(e,t){let n=[];this.visualVariables&&(n=n.concat(this.visualVariables));for(const r of n)r&&(r.field&&(0,u.rq)(e,t,r.field),r.normalizationField&&(0,u.rq)(e,t,r.normalizationField),r.valueExpression&&(_(r.valueExpression,e,t)||await(0,u.Dx)(e,t,r.valueExpression)))}};return(0,r._)([(0,i.MZ)({types:[I],value:null,json:{write:!0}})],t.prototype,"visualVariables",null),(0,r._)([(0,o.w)("visualVariables",["visualVariables","rotationType","rotationExpression"])],t.prototype,"readVisualVariables",null),(0,r._)([(0,l.K)("visualVariables")],t.prototype,"writeVisualVariables",null),t=(0,r._)([(0,a.$)("esri.renderers.mixins.VisualVariablesMixin")],t),t};function _(e,t,n){const r=(i=e,i.match(c)?.[1]?.replace(/\\'/g,"'")??null);var i;return null!=r&&((0,u.rq)(t,n,r),!0)}},53871:function(e,t,n){n.d(t,{A:function(){return L}});var r,i=n(53804),s=n(73037),o=n(30905),a=n(21609),l=n(23502),u=n(67888),c=n(47332),p=n(65953);n(58941),n(40633),n(13798);let h=r=class extends o.oY{constructor(e){super(e),this.minValue=0,this.maxValue=0}clone(){return new r({minValue:this.minValue,maxValue:this.maxValue})}};var f;(0,i._)([(0,l.MZ)({type:Number,json:{write:!0}})],h.prototype,"minValue",void 0),(0,i._)([(0,l.MZ)({type:Number,json:{write:!0}})],h.prototype,"maxValue",void 0),h=r=(0,i._)([(0,p.$)("esri.renderers.support.AuthoringInfoClassBreakInfo")],h);let d=f=class extends o.oY{constructor(e){super(e),this.field="",this.normalizationField="",this.label="",this.classBreakInfos=new Array}clone(){return new f({field:this.field,normalizationField:this.normalizationField,label:this.label,classBreakInfos:(0,a.o8)(this.classBreakInfos)})}};(0,i._)([(0,l.MZ)({type:String,json:{write:!0}})],d.prototype,"field",void 0),(0,i._)([(0,l.MZ)({type:String,json:{write:!0}})],d.prototype,"normalizationField",void 0),(0,i._)([(0,l.MZ)({type:String,json:{write:!0}})],d.prototype,"label",void 0),(0,i._)([(0,l.MZ)({type:[h],json:{write:!0}})],d.prototype,"classBreakInfos",void 0),d=f=(0,i._)([(0,p.$)("esri.renderers.support.AuthoringInfoFieldInfo")],d);var m,y=n(77560);let g=m=class extends o.oY{constructor(e){super(e),this.label=null,this.size=null,this.value=null}clone(){return new m({label:this.label,value:this.value,size:this.size})}};(0,i._)([(0,l.MZ)({type:String,json:{write:!0}})],g.prototype,"label",void 0),(0,i._)([(0,l.MZ)({type:Number,json:{write:!0}})],g.prototype,"size",void 0),(0,i._)([(0,l.MZ)({type:Number,json:{write:!0}})],g.prototype,"value",void 0),g=m=(0,i._)([(0,p.$)("esri.renderers.support.AuthoringInfoSizeStop")],g);const w=g;var b;const v=new s.J({percentTotal:"percent-of-total",ratio:"ratio",percent:"percent"}),x=new s.J({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),M={key:e=>"number"==typeof e?"number":"string",typeMap:{number:Number,string:String},base:null},A=["high-to-low","above-and-below","centered-on","extremes"],I=[...new Set(["high-to-low","above-and-below","centered-on","extremes","above","below","high-to-low","above-and-below","above","below","reference-size"])],S=["seconds","minutes","hours","days","months","years"];let _=b=class extends o.oY{constructor(e){super(e),this.endTime=null,this.field=null,this.maxSliderValue=null,this.minSliderValue=null,this.startTime=null,this.type=null,this.units=null}castEndTime(e){return"string"==typeof e||"number"==typeof e?e:null}get normalizationField(){return"reference-size"===this.theme?this._get("normalizationField"):null}set normalizationField(e){this._set("normalizationField",e)}get referenceSizeScale(){return"reference-size"===this.theme?this._get("referenceSizeScale"):null}set referenceSizeScale(e){this._set("referenceSizeScale",e)}get referenceSizeSymbolStyle(){return"reference-size"===this.theme?this._get("referenceSizeSymbolStyle"):null}set referenceSizeSymbolStyle(e){this._set("referenceSizeSymbolStyle",e)}castStartTime(e){return"string"==typeof e||"number"==typeof e?e:null}get sizeStops(){return"reference-size"===this.theme?this._get("sizeStops"):null}set sizeStops(e){this._set("sizeStops",e)}get style(){return"color"===this.type?this._get("style"):null}set style(e){this._set("style",e)}get theme(){return"color"===this.type||"size"===this.type?this._get("theme")||"high-to-low":null}set theme(e){this._set("theme",e)}clone(){return new b({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,normalizationField:this.normalizationField,referenceSizeScale:this.referenceSizeScale,referenceSizeSymbolStyle:this.referenceSizeSymbolStyle,sizeStops:(0,a.o8)(this.sizeStops),startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})}};(0,i._)([(0,l.MZ)({types:M,json:{write:!0}})],_.prototype,"endTime",void 0),(0,i._)([(0,y.w)("endTime")],_.prototype,"castEndTime",null),(0,i._)([(0,l.MZ)({type:String,json:{write:!0}})],_.prototype,"field",void 0),(0,i._)([(0,l.MZ)({type:Number,json:{write:!0}})],_.prototype,"maxSliderValue",void 0),(0,i._)([(0,l.MZ)({type:Number,json:{write:!0}})],_.prototype,"minSliderValue",void 0),(0,i._)([(0,l.MZ)({type:String,json:{origins:{"web-scene":{write:!1}},write:!0}})],_.prototype,"normalizationField",null),(0,i._)([(0,l.MZ)({type:Number,value:null,json:{origins:{"web-scene":{write:!1}},write:!0}})],_.prototype,"referenceSizeScale",null),(0,i._)([(0,l.MZ)({type:["circle","diamond","hexagon-flat","hexagon-pointy","square"],value:null,json:{origins:{"web-scene":{write:!1}},write:!0}})],_.prototype,"referenceSizeSymbolStyle",null),(0,i._)([(0,l.MZ)({types:M,json:{write:!0}})],_.prototype,"startTime",void 0),(0,i._)([(0,y.w)("startTime")],_.prototype,"castStartTime",null),(0,i._)([(0,l.MZ)({type:[w],json:{origins:{"web-scene":{write:!1}},write:!0}})],_.prototype,"sizeStops",null),(0,i._)([(0,l.MZ)({type:v.apiValues,value:null,json:{type:v.jsonValues,read:v.read,write:v.write}})],_.prototype,"style",null),(0,i._)([(0,l.MZ)({type:I,value:null,json:{type:I,origins:{"web-scene":{type:A,write:{writer:(e,t)=>{A.includes(e)&&(t.theme=e)}}}},write:!0}})],_.prototype,"theme",null),(0,i._)([(0,l.MZ)({type:x.apiValues,json:{type:x.jsonValues,read:x.read,write:x.write}})],_.prototype,"type",void 0),(0,i._)([(0,l.MZ)({type:S,json:{type:S,write:!0}})],_.prototype,"units",void 0),_=b=(0,i._)([(0,p.$)("esri.renderers.support.AuthoringInfoVisualVariable")],_);const C=_;var T,k=n(85982);const R=new s.J({esriClassifyDefinedInterval:"defined-interval",esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),P=new s.J({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density",flow:"flow"}),N=new s.J({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density"}),D=["inches","feet","yards","miles","nautical-miles","millimeters","centimeters","decimeters","meters","kilometers"];let E=T=class extends o.oY{constructor(e){super(e),this.colorRamp=null,this.fadeRatio=null,this.isAutoGenerated=!1,this.lengthUnit=null,this.maxSliderValue=null,this.minSliderValue=null,this.visualVariables=null}get classificationMethod(){const e=this._get("classificationMethod"),t=this.type;return t&&"relationship"!==t?"class-breaks-size"===t||"class-breaks-color"===t?e||"manual":null:e}set classificationMethod(e){this._set("classificationMethod",e)}readColorRamp(e){return e?(0,k.r)(e):void 0}get fields(){return this.type&&"predominance"!==this.type?null:this._get("fields")}set fields(e){this._set("fields",e)}get field1(){return this.type&&"relationship"!==this.type?null:this._get("field1")}set field1(e){this._set("field1",e)}get field2(){return this.type&&"relationship"!==this.type?null:this._get("field2")}set field2(e){this._set("field2",e)}get flowTheme(){return"flow"===this.type?this._get("flowTheme"):null}set flowTheme(e){this._set("flowTheme",e)}get focus(){return this.type&&"relationship"!==this.type?null:this._get("focus")}set focus(e){this._set("focus",e)}get numClasses(){return this.type&&"relationship"!==this.type?null:this._get("numClasses")}set numClasses(e){this._set("numClasses",e)}get statistics(){return"univariate-color-size"===this.type&&"above-and-below"===this.univariateTheme?this._get("statistics"):null}set statistics(e){this._set("statistics",e)}get standardDeviationInterval(){const e=this.type;return e&&"relationship"!==e&&"class-breaks-size"!==e&&"class-breaks-color"!==e||this.classificationMethod&&"standard-deviation"!==this.classificationMethod?null:this._get("standardDeviationInterval")}set standardDeviationInterval(e){this._set("standardDeviationInterval",e)}get type(){return this._get("type")}set type(e){let t=e;"classed-size"===e?t="class-breaks-size":"classed-color"===e&&(t="class-breaks-color"),this._set("type",t)}get univariateSymbolStyle(){return"univariate-color-size"===this.type&&"above-and-below"===this.univariateTheme?this._get("univariateSymbolStyle"):null}set univariateSymbolStyle(e){this._set("univariateSymbolStyle",e)}get univariateTheme(){return"univariate-color-size"===this.type?this._get("univariateTheme"):null}set univariateTheme(e){this._set("univariateTheme",e)}clone(){return new T({classificationMethod:this.classificationMethod,colorRamp:(0,a.o8)(this.colorRamp),fadeRatio:(0,a.o8)(this.fadeRatio),fields:this.fields?.slice(),field1:(0,a.o8)(this.field1),field2:(0,a.o8)(this.field2),isAutoGenerated:this.isAutoGenerated,focus:this.focus,numClasses:this.numClasses,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,lengthUnit:this.lengthUnit,statistics:this.statistics,standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map((e=>e.clone())),univariateSymbolStyle:this.univariateSymbolStyle,univariateTheme:this.univariateTheme,flowTheme:this.flowTheme})}};(0,i._)([(0,l.MZ)({type:R.apiValues,value:null,json:{type:R.jsonValues,read:R.read,write:R.write,origins:{"web-document":{default:"manual",type:R.jsonValues,read:R.read,write:R.write}}}})],E.prototype,"classificationMethod",null),(0,i._)([(0,l.MZ)({types:k.g,json:{write:!0}})],E.prototype,"colorRamp",void 0),(0,i._)([(0,c.w)("colorRamp")],E.prototype,"readColorRamp",null),(0,i._)([(0,l.MZ)({json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],E.prototype,"fadeRatio",void 0),(0,i._)([(0,l.MZ)({type:[String],value:null,json:{write:!0}})],E.prototype,"fields",null),(0,i._)([(0,l.MZ)({type:d,value:null,json:{write:!0}})],E.prototype,"field1",null),(0,i._)([(0,l.MZ)({type:d,value:null,json:{write:!0}})],E.prototype,"field2",null),(0,i._)([(0,l.MZ)({type:["flow-line","wave-front"],value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],E.prototype,"flowTheme",null),(0,i._)([(0,l.MZ)({type:["HH","HL","LH","LL"],value:null,json:{write:!0}})],E.prototype,"focus",null),(0,i._)([(0,l.MZ)({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1}}}})],E.prototype,"isAutoGenerated",void 0),(0,i._)([(0,l.MZ)({type:Number,value:null,json:{type:u.jz,write:!0}})],E.prototype,"numClasses",null),(0,i._)([(0,l.MZ)({type:D,json:{type:D,read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],E.prototype,"lengthUnit",void 0),(0,i._)([(0,l.MZ)({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],E.prototype,"maxSliderValue",void 0),(0,i._)([(0,l.MZ)({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],E.prototype,"minSliderValue",void 0),(0,i._)([(0,l.MZ)({type:Object,value:null,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],E.prototype,"statistics",null),(0,i._)([(0,l.MZ)({type:[.25,.33,.5,1],value:null,json:{type:[.25,.33,.5,1],write:!0}})],E.prototype,"standardDeviationInterval",null),(0,i._)([(0,l.MZ)({type:P.apiValues,value:null,json:{type:P.jsonValues,read:P.read,write:P.write,origins:{"web-scene":{type:N.jsonValues,write:{writer:N.write,overridePolicy:e=>({enabled:"flow"!==e})}}}}})],E.prototype,"type",null),(0,i._)([(0,l.MZ)({type:[C],json:{write:!0}})],E.prototype,"visualVariables",void 0),(0,i._)([(0,l.MZ)({type:["caret","circle-caret","arrow","circle-arrow","plus-minus","circle-plus-minus","square","circle","triangle","happy-sad","thumb","custom"],value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],E.prototype,"univariateSymbolStyle",null),(0,i._)([(0,l.MZ)({type:["high-to-low","above-and-below","above","below"],value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],E.prototype,"univariateTheme",null),E=T=(0,i._)([(0,p.$)("esri.renderers.support.AuthoringInfo")],E);const L=E},23879:function(e,t,n){n.d(t,{A:function(){return c}});var r,i=n(53804),s=n(30905),o=n(23502),a=(n(58941),n(40633),n(13798),n(65953)),l=n(85336);let u=r=class extends s.oY{constructor(e){super(e),this.description=null,this.label=null,this.minValue=null,this.maxValue=0,this.symbol=null}clone(){return new r({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:this.symbol?.clone()??null})}getMeshHash(){const e=JSON.stringify(this.symbol);return`${this.minValue}.${this.maxValue}.${e}`}};(0,i._)([(0,o.MZ)({type:String,json:{write:!0}})],u.prototype,"description",void 0),(0,i._)([(0,o.MZ)({type:String,json:{write:!0}})],u.prototype,"label",void 0),(0,i._)([(0,o.MZ)({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],u.prototype,"minValue",void 0),(0,i._)([(0,o.MZ)({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],u.prototype,"maxValue",void 0),(0,i._)([(0,o.MZ)(l.Wp)],u.prototype,"symbol",void 0),u=r=(0,i._)([(0,a.$)("esri.renderers.support.ClassBreakInfo")],u);const c=u},31233:function(e,t,n){n.d(t,{A:function(){return m}});var r=n(53804),i=n(30905),s=n(40633),o=n(23502),a=(n(58941),n(13798),n(65953)),l=n(98521),u=n(43264),c=n(72567),p=n(55469),h=n(3212),f=n(9059);let d=class extends i.oY{constructor(e){super(e)}bind(){const{rendererJSON:e}=this;if(!e)return{success:!1};let t;switch(this.lookup={rendererJSON:{}},e.type){case"uniqueValue":t=this._updateUVRenderer(e);break;case"rasterColormap":t=this._updateColormapRenderer(e);break;case"rasterStretch":t=this._updateStretchRenderer(e);break;case"classBreaks":t=this._updateClassBreaksRenderer(e);break;case"rasterShadedRelief":t=this._updateShadedReliefRenderer(e);break;case"vectorField":t=this._updateVectorFieldRenderer();break;case"flowRenderer":t=this._updateFlowRenderer()}return t}symbolize(e){let t=e?.pixelBlock;if(!y(t))return t;if(e.simpleStretchParams&&"rasterStretch"===this.rendererJSON.type)return this.simpleStretch(t,e.simpleStretchParams);try{let n;switch(t.pixels.length>3&&(t=t.extractBands(e.bandIds??[0,1,2])),this.rendererJSON.type){case"uniqueValue":case"rasterColormap":n=this._symbolizeColormap(t);break;case"classBreaks":n=this._symbolizeClassBreaks(t);break;case"rasterStretch":n=this._symbolizeStretch(t,e.bandIds);break;case"rasterShadedRelief":{const r=e.extent,i=r.spatialReference.isGeographic,s={x:(r.xmax-r.xmin)/t.width,y:(r.ymax-r.ymin)/t.height};n=this._symbolizeShadedRelief(t,{isGCS:i,resolution:s});break}}return n}catch(e){return s.A.getLogger(this).error("symbolize",e.message),t}}simpleStretch(e,t){if(!y(e))return e;try{return e.pixels.length>3&&(e=e.extractBands([0,1,2])),(0,c._N)(e,{...t,isRenderer:!0})}catch(t){return s.A.getLogger(this).error("symbolize",t.message),e}}generateWebGLParameters(e){if(["uniqueValue","rasterColormap","classBreaks"].includes(this.rendererJSON.type)){const{indexedColormap:e,offset:t}=this.lookup.colormapLut||{};return{colormap:e,colormapOffset:t,isClassBreaks:"classBreaks"===this.rendererJSON.type,type:"lut"}}const{pixelBlock:t,isGCS:n,resolution:r,bandIds:i}=e,{rendererJSON:s}=this;return"rasterStretch"===s.type?this._generateStretchWebGLParams(t,s,i):"rasterShadedRelief"===s.type?this._generateShadedReliefWebGLParams(s,n,r??void 0):"vectorField"===s.type?this._generateVectorFieldWebGLParams(s):null}_isLUTChanged(e){if(!this.lookup||!this.lookup.rendererJSON)return!0;if("colorRamp"in this.rendererJSON){const t=this.rendererJSON.colorRamp;return e?JSON.stringify(t)!==JSON.stringify(this.lookup.rendererJSON.colorRamp):(this.rendererJSON,this.lookup.rendererJSON,JSON.stringify(this.rendererJSON)!==JSON.stringify(this.lookup.rendererJSON))}return JSON.stringify(this.rendererJSON)!==JSON.stringify(this.lookup.rendererJSON)}_symbolizeColormap(e){return this._isLUTChanged()&&!this.bind().success?e:(0,u.qL)(e,this.lookup.colormapLut)}_symbolizeClassBreaks(e){const{canUseIndexedLUT:t}=this._analyzeClassBreaks(this.rendererJSON);return this._isLUTChanged()&&!this.bind().success?e:t?(0,u.qL)(e,this.lookup.colormapLut):(0,u.Hx)(e,this.lookup.remapLut??[])}_symbolizeStretch(e,t){const{rasterInfo:n}=this,{pixelType:r,bandCount:i}=n,s=this.rendererJSON,o=["u8","u16","s8","s16"].includes(r);let a,l;const{dra:p}=s,{gamma:h}=this.lookup;if("histogramEqualization"===s.stretchType){const r=p?null:this.lookup?.histogramLut,i=(0,c.DP)(s,{rasterInfo:n,pixelBlock:e,bandIds:t,returnHistogramLut:!r}),o=(0,c._N)(e,{...i,gamma:h,isRenderer:!0});l=(0,u.eH)(o,{lut:p?i.histogramLut:r,offset:0})}else if(o){if(p){const i=(0,c.DP)(s,{rasterInfo:n,pixelBlock:e,bandIds:t});a=(0,c.RP)({pixelType:r,...i,gamma:h,rounding:"floor"})}else if(this._isLUTChanged()){if(!this.bind().success)return e;a=this.lookup?this.lookup.stretchLut:null}else a=this.lookup?this.lookup.stretchLut:null;if(!a)return e;i>1&&null!=t&&t.length===e?.pixels.length&&a?.lut.length===i&&(a={lut:t.map((e=>a.lut[e])),offset:a.offset}),l=(0,u.eH)(e,a)}else{const r=(0,c.DP)(s,{rasterInfo:n,pixelBlock:e,bandIds:t});l=(0,c._N)(e,{...r,gamma:h,isRenderer:!0})}if(s.colorRamp){if(this._isLUTChanged(!0)&&!this.bind().success)return e;l=(0,u.qL)(l,this.lookup?.colormapLut)}return l}_symbolizeShadedRelief(e,t){const n=this.rendererJSON,r={...n,...t},i=(0,p.fw)(e,r);if(!n.colorRamp)return i;let s;if(this._isLUTChanged(!0)){if(!this.bind().success)return i;s=this.lookup?this.lookup.hsvMap:null}else s=this.lookup?this.lookup.hsvMap:null;if(!s)return i;const o=this.rasterInfo.statistics?.[0]??{min:0,max:8e3};return(0,p.SC)(i,e,s,o),i}_isVectorFieldData(){const{bandCount:e,dataType:t}=this.rasterInfo;return 2===e&&("vector-magdir"===t||"vector-uv"===t)}_updateVectorFieldRenderer(){return this._isVectorFieldData()?{success:!0}:{success:!1,error:`Unsupported data type "${this.rasterInfo.dataType}"; VectorFieldRenderer only supports "vector-magdir" and "vector-uv".`}}_updateFlowRenderer(){return this._isVectorFieldData()?{success:!0}:{success:!1,error:`Unsupported data type "${this.rasterInfo.dataType}"; FlowRenderer only supports "vector-magdir" and "vector-uv".`}}_updateUVRenderer(e){const{bandCount:t,attributeTable:n,pixelType:r}=this.rasterInfo,i=e.field1;if(!i)return{success:!1,error:"Unsupported renderer; missing UniqueValueRenderer.field."};const s=e.defaultSymbol,o=1===t&&["u8","s8"].includes(r);if(!(0,f.hu)(this.rasterInfo,i)&&!o)return{success:!1,error:"Unsupported data; UniqueValueRenderer is only supported on single band data with a valid raster attribute table."};const a=[];if(null!=n){const t=n.fields.find((e=>"value"===e.name.toLowerCase()));if(!t)return{success:!1,error:"Unsupported data; the data's raster attribute table does not have a value field."};n.features.forEach((n=>{const r=e.uniqueValueInfos?.find((e=>String(e.value)===String(n.attributes[i]))),o=r?.symbol?.color;o?a.push([n.attributes[t.name]].concat(o)):s&&a.push([n.attributes[t.name]].concat(s.color))}))}else{if("value"!==i.toLowerCase())return{success:!1,error:'Unsupported renderer; UniqueValueRenderer.field must be "Value" when raster attribute table is not available.'};e.uniqueValueInfos?.forEach((e=>{const t=e?.symbol?.color;t?a.push([parseInt(""+e.value,10)].concat(t)):s&&a.push([parseInt(""+e.value,10)].concat(s?.color))}))}if(0===a.length)return{success:!1,error:"Invalid UniqueValueRenderer. Cannot find matching records in the raster attribute table."};const l=(0,u.zg)({colormap:a});return this.lookup={rendererJSON:e,colormapLut:l},this.canRenderInWebGL=(0,f.WN)(l?.indexedColormap),{success:!0}}_updateColormapRenderer(e){if(!(0,f.FA)(this.rasterInfo))return{success:!1,error:"Unsupported data; the data source does not have a colormap."};const t=e.colormapInfos.map((e=>[e.value].concat(e.color))).sort(((e,t)=>e[0]-t[0]));if(!t||0===t.length)return{success:!1,error:"Unsupported renderer; ColormapRenderer must have meaningful colormapInfos."};const n=(0,u.zg)({colormap:t});return this.lookup={rendererJSON:e,colormapLut:n},this.canRenderInWebGL=(0,f.WN)(n?.indexedColormap),{success:!0}}_updateShadedReliefRenderer(e){if(!(0,f.iL)(this.rasterInfo))return{success:!1,error:`Unsupported data type "${this.rasterInfo.dataType}"; ShadedReliefRenderer only supports "elevation", or single band float/s16 data.`};if(e.colorRamp){const t=(0,h.R8)(e.colorRamp,{interpolateAlpha:!0}),n=(0,u.zg)({colormap:t}),r=(0,h.S2)(n.indexedColormap);this.lookup={rendererJSON:e,colormapLut:n,hsvMap:r}}else this.lookup=null;return this.canRenderInWebGL=!0,{success:!0}}_analyzeClassBreaks(e){const{attributeTable:t,pixelType:n}=this.rasterInfo,r=null!=t?t.fields.find((e=>"value"===e.name.toLowerCase())):null,i=null!=t?t.fields.find((t=>t.name.toLowerCase()===e.field.toLowerCase())):null,s=null!=r&&null!==i;return{canUseIndexedLUT:["u8","u16","s8","s16"].includes(n)||s,tableValueField:r,tableBreakField:i}}_updateClassBreaksRenderer(e){const{attributeTable:t}=this.rasterInfo,{canUseIndexedLUT:n,tableValueField:r,tableBreakField:i}=this._analyzeClassBreaks(e),s=e.classBreakInfos;if(!s?.length)return{success:!1,error:"Unsupported renderer; missing or invalid ClassBreaksRenderer.classBreakInfos."};const o=s.sort(((e,t)=>e.classMaxValue-t.classMaxValue)),a=o[o.length-1];let l=e.minValue;if(!n){const t=[];for(let e=0;e<o.length;e++)t.push({value:o[e].classMinValue??l,mappedColor:o[e].symbol.color}),l=o[e].classMaxValue;return t.push({value:a.classMaxValue,mappedColor:a.symbol.color}),this.lookup={rendererJSON:e,remapLut:t},this.canRenderInWebGL=!1,{success:!0}}const c=[];if(null!=t&&null!=r&&null!==i&&r!==i){const n=r.name,s=i.name,a=o[o.length-1],{classMaxValue:u}=a;l=e.minValue;for(const e of t.features){const t=e.attributes[n],r=e.attributes[s],i=r===u?a:r<l?null:o.find((({classMaxValue:e})=>e>r));i&&c.push([t].concat(i.symbol.color))}}else{l=Math.floor(e.minValue);for(let e=0;e<o.length;e++){const t=o[e];for(let e=l;e<t.classMaxValue;e++)c.push([e].concat(t.symbol.color));l=Math.ceil(t.classMaxValue)}a.classMaxValue===l&&c.push([a.classMaxValue].concat(a.symbol.color))}const p=(0,u.zg)({colormap:c,fillUnspecified:!1});return this.lookup={rendererJSON:e,colormapLut:p},this.canRenderInWebGL=(0,f.WN)(p?.indexedColormap),{success:!0}}_updateStretchRenderer(e){let{stretchType:t,dra:n}=e;if(!("none"===t||e.statistics?.length||function(e){return null!=e&&e.length>0&&null!=e[0].min&&null!=e[0].max}(this.rasterInfo.statistics)||n))return{success:!1,error:"Unsupported renderer; StretchRenderer.statistics is required when dynamic range adjustment is not used."};const r=e.histograms||this.rasterInfo.histograms;!function(e){return"percentClip"===e||"histogramEqualization"===e}(e.stretchType)||r?.length||n||(t="minMax");const{computeGamma:i,useGamma:s,colorRamp:o}=e;let{gamma:a}=e;if(s&&i&&!a?.length){const t=e.statistics?.length?e.statistics:this.rasterInfo.statistics;a=(0,c.fP)(this.rasterInfo.pixelType,t)}const l=this.rasterInfo.pixelType,p=!n&&["u8","u16","s8","s16"].includes(l);if("histogramEqualization"===t){const t=r.map((e=>(0,c.WF)(e)));this.lookup={rendererJSON:e,histogramLut:t}}else if(p){const t=(0,c.DP)(e,{rasterInfo:this.rasterInfo}),n=(0,c.RP)({pixelType:l,...t,gamma:s?a:null,rounding:"floor"});this.lookup={rendererJSON:e,stretchLut:n}}if(o&&!function(e){return"algorithmic"===e.type&&["0,0,0,255","0,0,0"].includes(e.fromColor.join(","))&&["255,255,255,255","255,255,255"].includes(e.toColor.join(","))}(o)){const t=(0,h.R8)(o,{interpolateAlpha:!0});this.lookup||(this.lookup={rendererJSON:e}),this.lookup.colormapLut=(0,u.zg)({colormap:t}),this.lookup.rendererJSON=e}return this.lookup.gamma=s&&a?.length?a:null,this.canRenderInWebGL=!0,{success:!0}}_generateStretchWebGLParams(e,t,n){let r=null,i=null;const s=this.lookup?.colormapLut;t.colorRamp&&s&&(r=s.indexedColormap,i=s.offset),"histogramEqualization"===t.stretchType&&(t={...t,stretchType:"minMax"});const{gamma:o}=this.lookup,a=!(!t.useGamma||!o?.some((e=>1!==e))),{minCutOff:l,maxCutOff:u,outMin:p,outMax:h}=(0,c.DP)(t,{rasterInfo:this.rasterInfo,pixelBlock:e,bandIds:n});let f=0;null!=e&&(f=e.getPlaneCount(),2===f&&((e=e.clone()).statistics=[e.statistics[0]],e.pixels=[e.pixels[0]]));const{bandCount:d}=this.rasterInfo,m=Math.min(3,n?.length||f||d,d),y=new Float32Array(m),g=r||a?1:255;let w;for(w=0;w<l.length;w++)y[w]=u[w]===l[w]?0:(h-p)/(u[w]-l[w])/g;const b=new Float32Array(m);if(a&&o)for(w=0;w<m;w++)o[w]>1?o[w]>2?b[w]=6.5+(o[w]-2)**2.5:b[w]=6.5+100*(2-o[w])**4:b[w]=1;return{bandCount:m,outMin:p/g,outMax:h/g,minCutOff:l,maxCutOff:u,factor:y,useGamma:a,gamma:a?o:[1,1,1],gammaCorrection:a?b:[1,1,1],colormap:r,colormapOffset:i,stretchType:t.stretchType,type:"stretch"}}_generateShadedReliefWebGLParams(e,t=!1,n={x:0,y:0}){let r=null,i=null;const s=this.lookup?.colormapLut;e.colorRamp&&s&&(r=s.indexedColormap,i=s.offset);const o={...e,isGCS:t,resolution:n},a=(0,p.ng)(o),l=this.rasterInfo.statistics?.[0];return{...a,minValue:l?.min??0,maxValue:l?.max??8e3,hillshadeType:"traditional"===e.hillshadeType?0:1,type:"hillshade",colormap:r,colormapOffset:i}}_generateVectorFieldWebGLParams(e){const{style:t,inputUnit:n,outputUnit:r,visualVariables:i,symbolTileSize:s,flowRepresentation:o}=e;let a;const l=this.rasterInfo.statistics?.[0].min??0,u=this.rasterInfo.statistics?.[0].max??50,c=i?.find((e=>"sizeInfo"===e.type))??{type:"sizeInfo",field:"Magnitude",maxDataValue:u,maxSize:.8*s,minDataValue:l,minSize:.2*s},p=c.minDataValue??l,h=c.maxDataValue??u,f=null!=c.maxSize&&null!=c.minSize?[c.minSize/s,c.maxSize/s]:[.2,.8];if("wind_speed"===t){const e=(f[0]+f[1])/2;f[0]=f[1]=e}const d=null!=p&&null!=h?[p,h]:null;if("classified_arrow"===t)if(null!=p&&null!=h&&null!=c){a=[];const e=(c.maxDataValue-c.minDataValue)/5;for(let t=0;t<6;t++)a.push(c.minDataValue+e*t)}else a=[0,1e-6,3.5,7,10.5,14];const m="flow_to"===o==("ocean_current_kn"===t||"ocean_current_m"===t)?0:Math.PI,y=i?.find((e=>"rotationInfo"===e.type));return{breakValues:a,dataRange:d,inputUnit:n,outputUnit:r,symbolTileSize:s,symbolPercentRange:f,style:t||"single_arrow",rotation:m,rotationType:this.rasterInfo.storageInfo?.tileInfo&&"vector-uv"===this.rasterInfo.dataType?"geographic":y?.rotationType||e.rotationType,type:"vectorField"}}};(0,r._)([(0,o.MZ)({json:{write:!0}})],d.prototype,"rendererJSON",void 0),(0,r._)([(0,o.MZ)({type:l.A,json:{write:!0}})],d.prototype,"rasterInfo",void 0),(0,r._)([(0,o.MZ)({json:{write:!0}})],d.prototype,"lookup",void 0),(0,r._)([(0,o.MZ)()],d.prototype,"canRenderInWebGL",void 0),d=(0,r._)([(0,a.$)("esri.renderers.support.RasterSymbolizer")],d);const m=d;function y(e){return(0,u.AB)(e)&&0!==e.validPixelCount}},16986:function(e,t,n){n.d(t,{A:function(){return h}});var r=n(53804),i=n(75743),s=n(73037),o=n(30905),a=n(23502),l=(n(58941),n(40633),n(13798),n(74376)),u=n(65953);const c=(0,s.O)()({ascendingValues:"ascending-values",descendingValues:"descending-values"});let p=class extends((0,i.O)(o.oY)){constructor(e){super(e),this.title=null,this.order=null}};(0,r._)([(0,a.MZ)({type:String,json:{write:!0}})],p.prototype,"title",void 0),(0,r._)([(0,l.e)(c)],p.prototype,"order",void 0),p=(0,r._)([(0,u.$)("esri.renderers.support.RendererLegendOptions")],p);const h=p},99278:function(e,t,n){n.d(t,{A:function(){return c}});var r,i=n(53804),s=n(30905),o=n(23502),a=(n(58941),n(40633),n(13798),n(65953)),l=n(85336);let u=r=class extends s.oY{constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.value=null}clone(){return new r({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const e=JSON.stringify(this.symbol?.toJSON());return`${this.value}.${e}`}};(0,i._)([(0,o.MZ)({type:String,json:{write:!0}})],u.prototype,"description",void 0),(0,i._)([(0,o.MZ)({type:String,json:{write:!0}})],u.prototype,"label",void 0),(0,i._)([(0,o.MZ)(l.Wp)],u.prototype,"symbol",void 0),(0,i._)([(0,o.MZ)(l.Ug)],u.prototype,"value",void 0),u=r=(0,i._)([(0,a.$)("esri.renderers.support.UniqueValueInfo")],u);const c=u},3212:function(e,t,n){n.d(t,{L7:function(){return a},M5:function(){return d},R8:function(){return w},S2:function(){return b},hf:function(){return M},hs:function(){return f},iv:function(){return g},kH:function(){return u},vL:function(){return A},vj:function(){return l}});var r=n(52874),i=n(75505),s=n(73037),o=n(30905);const a=["random","ndvi","ndvi2","ndvi3","elevation","gray","hillshade"],l=[{id:"aspect",type:"multipart",colorRamps:[{fromColor:[190,190,190],toColor:[255,45,8]},{fromColor:[255,45,8],toColor:[255,181,61]},{fromColor:[255,181,61],toColor:[255,254,52]},{fromColor:[255,254,52],toColor:[0,251,50]},{fromColor:[0,251,50],toColor:[255,254,52]},{fromColor:[0,253,255],toColor:[0,181,255]},{fromColor:[0,181,255],toColor:[26,35,253]},{fromColor:[26,35,253],toColor:[255,57,251]},{fromColor:[255,57,251],toColor:[255,45,8]}]},{id:"black-to-white",fromColor:[0,0,0],toColor:[255,255,255]},{id:"blue-bright",fromColor:[204,204,255],toColor:[0,0,224]},{id:"blue-light-to-dark",fromColor:[211,229,232],toColor:[46,100,140]},{id:"blue-green-bright",fromColor:[203,245,234],toColor:[48,207,146]},{id:"blue-green-light-to-dark",fromColor:[216,242,237],toColor:[21,79,74]},{id:"brown-light-to-dark",fromColor:[240,236,170],toColor:[102,72,48]},{id:"brown-to-blue-green-diverging-right",type:"multipart",colorRamps:[{fromColor:[156,85,31],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[33,130,145]}]},{id:"brown-to-blue-green-diverging-dark",type:"multipart",colorRamps:[{fromColor:[110,70,45],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[48,100,102]}]},{id:"coefficient-bias",fromColor:[214,214,255],toColor:[0,57,148]},{id:"cold-to-hot-diverging",type:"multipart",colorRamps:[{fromColor:[69,117,181],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[214,47,39]}]},{id:"condition-number",type:"multipart",colorRamps:[{fromColor:[0,97,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,34,0]}]},{id:"cyan-to-purple",type:"multipart",colorRamps:[{fromColor:[0,245,245],toColor:[0,0,245]},{fromColor:[0,0,245],toColor:[245,0,245]}]},{id:"cyan-light-to-blue-dark",type:"multipart",colorRamps:[{fromColor:[182,237,240],toColor:[31,131,224]},{fromColor:[31,131,224],toColor:[9,9,145]}]},{id:"distance",fromColor:[255,200,0],toColor:[0,0,255]},{id:"elevation1",type:"multipart",colorRamps:[{fromColor:[175,240,233],toColor:[255,255,179]},{fromColor:[255,255,179],toColor:[0,128,64]},{fromColor:[0,128,64],toColor:[252,186,3]},{fromColor:[252,186,3],toColor:[128,0,0]},{fromColor:[120,0,0],toColor:[105,48,13]},{fromColor:[105,48,13],toColor:[171,171,171]},{fromColor:[171,171,171],toColor:[255,252,255]}]},{id:"elevation2",type:"multipart",colorRamps:[{fromColor:[118,219,211],toColor:[255,255,199]},{fromColor:[255,255,199],toColor:[255,255,128]},{fromColor:[255,255,128],toColor:[217,194,121]},{fromColor:[217,194,121],toColor:[135,96,38]},{fromColor:[135,96,38],toColor:[150,150,181]},{fromColor:[150,150,181],toColor:[181,150,181]},{fromColor:[181,150,181],toColor:[255,252,255]}]},{id:"errors",fromColor:[255,235,214],toColor:[196,10,10]},{id:"gray-light-to-dark",fromColor:[219,219,219],toColor:[69,69,69]},{id:"green-bright",fromColor:[204,255,204],toColor:[14,204,14]},{id:"green-light-to-dark",fromColor:[220,245,233],toColor:[34,102,51]},{id:"green-to-blue",type:"multipart",colorRamps:[{fromColor:[32,204,16],toColor:[0,242,242]},{fromColor:[0,242,242],toColor:[2,33,227]}]},{id:"orange-bright",fromColor:[255,235,204],toColor:[240,118,5]},{id:"orange-light-to-dark",fromColor:[250,233,212],toColor:[171,65,36]},{id:"partial-spectrum",type:"multipart",colorRamps:[{fromColor:[242,241,162],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]},{fromColor:[252,3,69],toColor:[176,7,237]},{fromColor:[176,7,237],toColor:[2,29,173]}]},{id:"partial-spectrum-1-diverging",type:"multipart",colorRamps:[{fromColor:[135,38,38],toColor:[240,149,12]},{fromColor:[240,149,12],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[74,80,181]},{fromColor:[74,80,181],toColor:[39,32,122]}]},{id:"partial-spectrum-2-diverging",type:"multipart",colorRamps:[{fromColor:[115,77,42],toColor:[201,137,52]},{fromColor:[201,137,52],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[91,63,176]},{fromColor:[91,63,176],toColor:[81,13,97]}]},{id:"pink-to-yellow-green-diverging-bright",type:"multipart",colorRamps:[{fromColor:[158,30,113],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[99,110,45]}]},{id:"pink-to-yellow-green-diverging-dark",type:"multipart",colorRamps:[{fromColor:[97,47,73],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[22,59,15]}]},{id:"precipitation",type:"multipart",colorRamps:[{fromColor:[194,82,60],toColor:[237,161,19]},{fromColor:[237,161,19],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[0,219,0]},{fromColor:[0,219,0],toColor:[32,153,143]},{fromColor:[32,153,143],toColor:[11,44,122]}]},{id:"prediction",type:"multipart",colorRamps:[{fromColor:[40,146,199],toColor:[250,250,100]},{fromColor:[250,250,100],toColor:[232,16,20]}]},{id:"purple-bright",fromColor:[255,204,255],toColor:[199,0,199]},{id:"purple-to-green-diverging-bright",type:"multipart",colorRamps:[{fromColor:[77,32,150],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[20,122,11]}]},{id:"purple-to-green-diverging-dark",type:"multipart",colorRamps:[{fromColor:[67,14,89],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[24,79,15]}]},{id:"purple-blue-bright",fromColor:[223,184,230],toColor:[112,12,242]},{id:"purple-blue-light-to-dark",fromColor:[229,213,242],toColor:[93,44,112]},{id:"purple-red-bright",fromColor:[255,204,225],toColor:[199,0,99]},{id:"purple-red-light-to-dark",fromColor:[250,215,246],toColor:[143,17,57]},{id:"red-bright",fromColor:[255,204,204],toColor:[219,0,0]},{id:"red-light-to-dark",fromColor:[255,224,224],toColor:[143,10,10]},{id:"red-to-blue-diverging-bright",type:"multipart",colorRamps:[{fromColor:[196,69,57],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[48,95,207]}]},{id:"red-to-blue-diverging-dark",type:"multipart",colorRamps:[{fromColor:[107,13,13],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[13,53,97]}]},{id:"red-to-green",type:"multipart",colorRamps:[{fromColor:[245,0,0],toColor:[245,245,0]},{fromColor:[245,245,0],toColor:[0,245,0]}]},{id:"red-to-green-diverging-bright",type:"multipart",colorRamps:[{fromColor:[186,20,20],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[54,145,33]}]},{id:"red-to-green-diverging-dark",type:"multipart",colorRamps:[{fromColor:[97,21,13],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[16,69,16]}]},{id:"slope",type:"multipart",colorRamps:[{fromColor:[56,168,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]}]},{id:"spectrum-full-bright",type:"multipart",colorRamps:[{fromColor:[255,0,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[0,0,255]}]},{id:"spectrum-full-dark",type:"multipart",colorRamps:[{fromColor:[153,0,0],toColor:[153,153,0]},{fromColor:[153,153,0],toColor:[0,153,153]},{fromColor:[0,153,153],toColor:[0,0,153]}]},{id:"spectrum-full-light",type:"multipart",colorRamps:[{fromColor:[255,153,153],toColor:[255,255,153]},{fromColor:[255,255,153],toColor:[153,255,255]},{fromColor:[153,255,255],toColor:[153,153,255]}]},{id:"surface",type:"multipart",colorRamps:[{fromColor:[112,153,89],toColor:[242,238,162]},{fromColor:[242,238,162],toColor:[242,206,133]},{fromColor:[242,206,133],toColor:[194,140,124]},{fromColor:[194,140,124],toColor:[255,242,255]}]},{id:"temperature",type:"multipart",colorRamps:[{fromColor:[255,252,255],toColor:[255,0,255]},{fromColor:[255,0,255],toColor:[0,0,255]},{fromColor:[0,0,255],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[0,255,0]},{fromColor:[0,255,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,128,0]},{fromColor:[255,128,0],toColor:[128,0,0]}]},{id:"white-to-black",fromColor:[255,255,255],toColor:[0,0,0]},{id:"yellow-to-dark-red",type:"multipart",colorRamps:[{fromColor:[255,255,128],toColor:[242,167,46]},{fromColor:[242,167,46],toColor:[107,0,0]}]},{id:"yellow-to-green-to-dark-blue",type:"multipart",colorRamps:[{fromColor:[255,255,128],toColor:[56,224,9]},{fromColor:[56,224,9],toColor:[26,147,171]},{fromColor:[26,147,171],toColor:[12,16,120]}]},{id:"yellow-to-red",fromColor:[245,245,0],toColor:[255,0,0]},{id:"yellow-green-bright",fromColor:[236,252,204],toColor:[157,204,16]},{id:"yellow-green-light-to-dark",fromColor:[215,240,175],toColor:[96,107,45]}],u=new s.J({Aspect:"aspect","Black to White":"black-to-white","Blue Bright":"blue-bright","Blue Light to Dark":"blue-light-to-dark","Blue-Green Bright":"blue-green-bright","Blue-Green Light to Dark":"blue-green-light-to-dark","Brown Light to Dark":"brown-light-to-dark","Brown to Blue Green Diverging, Bright":"brown-to-blue-green-diverging-right","Brown to Blue Green Diverging, Dark":"brown-to-blue-green-diverging-dark","Coefficient Bias":"coefficient-bias","Cold to Hot Diverging":"cold-to-hot-diverging","Condition Number":"condition-number","Cyan to Purple":"cyan-to-purple","Cyan-Light to Blue-Dark":"cyan-light-to-blue-dark",Distance:"distance","Elevation #1":"elevation1","Elevation #2":"elevation2",Errors:"errors","Gray Light to Dark":"gray-light-to-dark","Green Bright":"green-bright","Green Light to Dark":"green-light-to-dark","Green to Blue":"green-to-blue","Orange Bright":"orange-bright","Orange Light to Dark":"orange-light-to-dark","Partial Spectrum":"partial-spectrum","Partial Spectrum 1 Diverging":"partial-spectrum-1-diverging","Partial Spectrum 2 Diverging":"partial-spectrum-2-diverging","Pink to YellowGreen Diverging, Bright":"pink-to-yellow-green-diverging-bright","Pink to YellowGreen Diverging, Dark":"pink-to-yellow-green-diverging-dark",Precipitation:"precipitation",Prediction:"prediction","Purple Bright":"purple-bright","Purple to Green Diverging, Bright":"purple-to-green-diverging-bright","Purple to Green Diverging, Dark":"purple-to-green-diverging-dark","Purple-Blue Bright":"purple-blue-bright","Purple-Blue Light to Dark":"purple-blue-light-to-dark","Purple-Red Bright":"purple-red-bright","Purple-Red Light to Dark":"purple-red-light-to-dark","Red Bright":"red-bright","Red Light to Dark":"red-light-to-dark","Red to Blue Diverging, Bright":"red-to-blue-diverging-bright","Red to Blue Diverging, Dark":"red-to-blue-diverging-dark","Red to Green":"red-to-green","Red to Green Diverging, Bright":"red-to-green-diverging-bright","Red to Green Diverging, Dark":"red-to-green-diverging-dark",Slope:"slope","Spectrum-Full Bright":"spectrum-full-bright","Spectrum-Full Dark":"spectrum-full-dark","Spectrum-Full Light":"spectrum-full-light",Surface:"surface",Temperature:"temperature","White to Black":"white-to-black","Yellow to Dark Red":"yellow-to-dark-red","Yellow to Green to Dark Blue":"yellow-to-green-to-dark-blue","Yellow to Red":"yellow-to-red","Yellow-Green Bright":"yellow-green-bright","Yellow-Green Light to Dark":"yellow-green-light-to-dark"});function c(e,t){if(!e||!t||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]>t[n]+2||e[n]<t[n]-2)return!1;return!0}function p(e){const t=e.clone();return t.fromColor=e.toColor,t.toColor=e.fromColor,t.algorithm=e.algorithm,t}function h(e,t){if(!e)return;const n=t??l;let i=null;return"algorithmic"===e.type?n.some((t=>{if(c(e.fromColor.toRgb(),t.fromColor)&&c(e.toColor.toRgb(),t.toColor))return i=t.id,!0})):"multipart"===e.type&&n.some((t=>{const n=e.colorRamps,s=t.colorRamps;if(n&&s&&n.length===s.length&&!s.some(((e,t)=>{if(!c(n[t].fromColor.toRgb(),new r.A(e.fromColor).toRgb())||!c(n[t].toColor.toRgb(),new r.A(e.toColor).toRgb()))return!0}))){if(i)return!0;i=t.id}})),i}function f(e,t=!1){const n="string"==typeof e?e:function(e,t,n=!1){if(!e)return;let r=!1,i=h(e,t);return null!=i||n||(r=!0,i=h(e=function(e){if("multipart"===e.type){const t=e.clone();return t.colorRamps?.length?(t.colorRamps=t.colorRamps.reverse().map((e=>p(e))),t):t}return p(e)}(e),t)),i?{id:i,inverted:r}:void 0}(e,void 0,t)?.id;return n?u.toJSON(n):null}function d(e,t="esriCIELabAlgorithm"){const n=l.find((({id:t})=>t===e));return n?n.colorRamps?{type:"multipart",colorRamps:n.colorRamps.map((e=>({type:"algorithmic",algorithm:t,fromColor:[...e.fromColor],toColor:[...e.toColor]})))}:{type:"algorithmic",algorithm:t,fromColor:[...n.fromColor],toColor:[...n.toColor]}:null}function m(e){const t=(e=e||{}).numColors||256,n=e.distanceOffset||0,r=null!=e.isCustomInterval?e.isCustomInterval:null!==e.distanceInterval&&e.distanceInterval!==1/(t-1),i=e.distanceInterval||1/(t-1);return{...e,numColors:t,distanceOffset:n,interpolateAlpha:!!e.interpolateAlpha,distanceInterval:i,isCustomInterval:r,weights:e.weights}}function y(e,t){let{fromColor:n,toColor:r}=e;n=[...n],r=[...r],3===n.length&&(n=n.concat([255])),3===r.length&&(r=r.concat([255]));const s=e.algorithm||"esriCIELabAlgorithm",o=m(t),{numColors:a,distanceOffset:l,isCustomInterval:u,interpolateAlpha:c}=o;if(1===a&&0===l)return[n];if(2===a&&0===l&&!u)return[n,r];const p={r:n[0],g:n[1],b:n[2]},h={r:r[0],g:r[1],b:r[2]},f="esriCIELabAlgorithm"===s?function(e,t,n){const{numColors:r,distanceOffset:i,distanceInterval:s,isCustomInterval:o}=n;let{l:a,a:l,b:u}=e;const c=(t.l-a)*s,p=(t.a-l)*s,h=(t.b-u)*s,f=[];if(i){const e=i/s;a+=e*c,l+=e*p,u+=e*h}for(let e=0;e<r-1;e++)f.push({l:a,a:l,b:u}),a+=c,l+=p,u+=h;return f.push(o?{l:a,a:l,b:u}:t),f}((0,i.ZD)(p),(0,i.ZD)(h),o):"esriHSVAlgorithm"===s?function(e,t,n){const{numColors:r,distanceOffset:i,distanceInterval:s,isCustomInterval:o}=n,a=0===e.s,l=0===t.s;let u=e.h,c=t.h;a&&!l?u=c:l&&!a&&(t={...t,h:u},c=u);let p,h=Math.abs(c-u);const f=360;h<180?p=(c-u)*s:(h=f-h,p=u>c?h*s:-h*s);const d=(t.s-e.s)*s,m=(t.v-e.v)*s;let{s:y,v:g}=e,w=u;if(i){const e=i/s;w=(w+e*p+f)%f,y+=e*d,g+=e*m}const b=[];for(let e=0;e<r-1;e++)b.push({h:w,s:y,v:g}),w=(w+p+f)%f,y+=d,g+=m;return b.push(o?{h:w,s:y,v:g}:t),b}((0,i.N2)(p),(0,i.N2)(h),o):function(e,t,n){const{numColors:r,distanceOffset:i,distanceInterval:s,isCustomInterval:o}=n,a=e.h,l=t.h,u=2*Math.PI;let c;if(a<=l){const e=l-a,t=l-a-u;c=Math.abs(t)<Math.abs(e)?t:e}else{const e=l+u-a,t=l-a;c=Math.abs(t)<Math.abs(e)?t:e}const p=c*s,h=(t.l-e.l)*s,f=(t.c-e.c)*s;let{l:d,c:m,h:y}=e;if(i){const e=i/s;d+=e*h,m+=e*f,y=(y+e*p+u)%u}const g=[];for(let e=0;e<r-1;e++)g.push({l:d,c:m,h:y}),d+=h,m+=f,y=(y+p+u)%u;return g.push(o?{l:d,c:m,h:y}:t),g}((0,i.RH)(p),(0,i.RH)(h),o),d=[],y=n[3]??255,g=((r[3]??255)-y)/(a-1);for(let e=0;e<a;e++){const{r:t,g:n,b:r}=(0,i.$)(f[e]),s=c?Math.round(y+g*e):255;d.push([t,n,r,s])}return d}function g(e,t){const n=(0,o.Wj)(e)?e.toJSON():e;return"multipart"===n.type?function(e,t){const{numColors:n,interpolateAlpha:r}=m(t);let i=t?.weights;const{colorRamps:s}=e;if(i){const e=i.reduce(((e,t)=>e+t));i=i.map((t=>t/e))}else{i=[];for(let e=0;e<s.length;e++)i[e]=1/s.length}const o=[],a=1/(n-1);let l=0,u=!1;for(let e=0;e<s.length;e++){const t=o.length,c=u?0:t*a-l;l+=i[e];let p=e===s.length-1?n-1-t:(i[e]-c)/a;if(u=Math.ceil(p)===p,p=Math.ceil(p),0===p)continue;const h=y(s[e],{numColors:p,interpolateAlpha:r,distanceOffset:c/i[e],distanceInterval:a/i[e]});o.push(...h)}const c=[...s[s.length-1].toColor];return 3===c.length&&c.push(255),o.push(c),o}(n,t):y(n,t)}function w(e,t){const n=g(e,t),r=t?.interpolateAlpha;return n.forEach(((e,t)=>{e.unshift(t),r||e.pop()})),n}function b(e){const t=[];for(let n=0;n<e.length;n+=4){const r=(0,i.N2)({r:e[n],g:e[n+1],b:e[n+2]});t.push([r.h/60,r.s/100,255*r.v/100])}return t}function v(e){const t=(0,i.N2)(e);return{type:"HsvColor",Hue:t.h,Saturation:t.s,Value:t.v,AlphaValue:255}}function x(e){const t=e.toJSON();return{Algorithm:t?.Algorithm||"esriHSVAlgorithm",type:"AlgorithmicColorRamp",FromColor:v(e.fromColor),ToColor:v(e.toColor)}}function M(e){const t=f(e);if(!t)return null;if("algorithmic"===e.type)return{...x(e),Name:t};if(e.colorRamps){const n=e.colorRamps.map(x);return{type:"MultiPartColorRamp",NumColorRamps:n.length,ArrayOfColorRamp:n,Name:t}}return null}function A(e){const t=e.reverse().map((e=>{const t=e.toString(16);return t.length<2?"0"+t:t}));return 4294967295&Number.parseInt(t.join(""),16)}},85336:function(e,t,n){n.d(t,{As:function(){return p},Ug:function(){return h},Wp:function(){return c},z4:function(){return u}});var r=n(10748),i=n(34194),s=n(51575),o=n(8404),a=n(34563),l=n(15186);const u={types:r.xK,json:{write:{writer:o.M9},origins:{"web-scene":{types:r.On,write:{writer:o.M9},read:{reader:(0,s.C)({types:r.On})}}}}},c=(0,i.$N)({json:{origins:{"web-scene":{write:{isRequired:!0}}}}},u),p={types:{base:a.A,key:"type",typeMap:{"simple-fill":r.Es.typeMap["simple-fill"],"picture-fill":r.Es.typeMap["picture-fill"],"polygon-3d":r.Es.typeMap["polygon-3d"],cim:r.Es.typeMap.cim}},json:{write:{writer:o.M9},origins:{"web-scene":{type:l.A,write:{writer:o.M9}}}}},h={cast:e=>null==e||"string"==typeof e||"number"==typeof e?e:`${e}`,json:{type:String,write:{writer:(e,t)=>{t.value=e?.toString()}}}}},9059:function(e,t,n){function r(e,t){const{attributeTable:n,bandCount:r}=e;return!((null!=n||(i=e,!["u8","s8"].includes(i.pixelType)||null==i.statistics?.[0]?.min||null==i.statistics[0]?.max||1!==i.bandCount))&&(null==n||r>1||t&&null==n.fields.find((e=>e.name.toLowerCase()===t.toLowerCase()))));var i}function i(e){const{bandCount:t,dataType:n,pixelType:r}=e;return"elevation"===n||"generic"===n&&1===t&&("s16"===r||"s32"===r||"f32"===r||"f64"===r)}function s(e,t=!1){const{bandCount:n,colormap:r,pixelType:i}=e;return 1===n&&(!!r?.length||!t&&"u8"===i)}function o(e,t=!1){const{attributeTable:n,bandCount:r}=e;return 1===r&&(!t||null!=n||null!=e.histograms)}function a(e){const{dataType:t}=e;return"vector-uv"===t||"vector-magdir"===t}function l(e){const{dataType:t}=e;return"vector-uv"===t||"vector-magdir"===t}function u(e){return!!e?.length&&e.length<=16384}n.d(t,{FA:function(){return s},QJ:function(){return l},WN:function(){return u},hu:function(){return r},iL:function(){return i},rd:function(){return a},xX:function(){return o}})},41262:function(e,t,n){n.d(t,{$P:function(){return N},I8:function(){return v},Mm:function(){return A},PD:function(){return x},ci:function(){return C},fp:function(){return M},m7:function(){return _},w6:function(){return I}});var r=n(52874),i=(n(92778),n(62938),n(56740)),s=(n(8795),n(53871)),o=(n(23879),n(3212)),a=n(9059),l=n(99278),u=(n(74843),n(53096)),c=(n(71859),n(74373),n(49241),n(96245)),p=n(8740),h=n(93571),f=n(61065),d=n(30185),m=(n(29360),n(74865),n(80892));const y=.25,g=c.A.fromJSON({type:"multipart",colorRamps:[{fromColor:[0,0,255],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]}]}),w=c.A.fromJSON(o.vj[0]),b=new Set(["scientific","standard-time","vector-uv","vector-magdir","vector-u","vector-v","vector-magnitude","vector-direction"]);function v(e){return e.presetRenderers?.find((({method:t,value:n})=>"raster-function-template"===t?n===e.rasterFunctionName:"variable"===t&&n===e.variableName))}function x(e,t){const{attributeTable:n,colormap:i}=e;if((0,a.rd)(e)){const t=function(e){if(!(0,a.rd)(e))return null;let t;if(null!=e.statistics&&e.statistics.length&&("vector-magdir"===e.dataType||"vector-uv"===e.dataType)){const{minMagnitude:n,maxMagnitude:r}=function(e,t){let n,r;if("vector-magdir"===e)n=t[0].min,r=t[0].max;else{const e=t[0].min,i=t[0].max,s=t[1].min,o=t[1].max;n=0,r=Math.max(Math.abs(e),Math.abs(s),Math.abs(i),Math.abs(o))}return{minMagnitude:n,maxMagnitude:r}}(e.dataType,e.statistics);t=[new u.A({field:"Magnitude",minSize:10,maxSize:40,minDataValue:n,maxDataValue:r})]}const n=null!=e.multidimensionalInfo?R.get(e.multidimensionalInfo.variables[0].unit):void 0,r=new m.A({visualVariables:t,inputUnit:n,rotationType:"geographic"});return r.visualVariables=[...r.sizeVariables,...r.rotationVariables],r}(e);if(null!=t)return t}if(t?.rasterFunctionColorRamp){const n=S(e,t);return n.colorRamp=t.rasterFunctionColorRamp,n}if(null!=i){const t=function(e){if(!(0,a.FA)(e))return null;let t;const{attributeTable:n,colormap:r}=e;if(null!=n){const e=k(n,"value"),r=T(n,null,!0);"string"===r.type&&(t={},n.features.forEach((n=>{const i=n.attributes;t[i[e.name]]=r?i[r.name]:i[e.name]})))}return d.A.createFromColormap(r,t)}(e);if(null!=t)return t}if(null!=n){const t=function(e,t){if(!(0,a.hu)(e,t))return null;const{attributeTable:n,statistics:i}=e,u=T(n,t),c=k(n,"red"),h=k(n,"green"),d=k(n,"blue"),m=new s.A,y=[],g=new Set,b=!!(c&&h&&d);if(null!=n)n.features.forEach((e=>{const t=e.attributes[u.name];if(!g.has(e.attributes[u.name])&&null!=t){g.add(t);const i=b&&("single"===c.type||"double"===c.type)&&("single"===h.type||"double"===h.type)&&("single"===d.type||"double"===d.type)&&!n.features.some((e=>e.attributes[c.name]>1||e.attributes[h.name]>1||e.attributes[d.name]>1)),s=i?255:1;y.push(new l.A({value:e.attributes[u.name],label:e.attributes[u.name]+"",symbol:new p.A({style:"solid",outline:null,color:new r.A(b?[e.attributes[c.name]*s,e.attributes[h.name]*s,e.attributes[d.name]*s,1]:[0,0,0,0])})}))}}));else if(i?.[0])for(let e=i[0].min;e<=i[0].max;e++)y.push(new l.A({value:e,label:e.toString(),symbol:new p.A({style:"solid",outline:null,color:new r.A([0,0,0,0])})}));if(y.sort(((e,t)=>e.value&&"string"==typeof e.value.valueOf()?0:e.value>t.value?1:-1)),!b){const e=(0,o.R8)(w,{numColors:y.length});y.forEach(((t,n)=>t.symbol.color=new r.A(e[n].slice(1,4)))),m.colorRamp=w}return new f.A({field:u.name,uniqueValueInfos:y,authoringInfo:m})}(e);if(null!=t)return t}return S(e,t)}function M(e,t=!1){const n=["raster-stretch"];return(0,a.FA)(e,t)&&n.push("raster-colormap"),(0,a.hu)(e)&&n.push("unique-value"),(0,a.xX)(e,t)&&n.push("class-breaks"),(0,a.iL)(e)&&n.push("raster-shaded-relief"),(0,a.rd)(e)&&n.push("vector-field"),(0,a.QJ)(e)&&n.push("flow"),n}function A(e){return"Function"===e.datasetFormat&&"Colormap"===e.rasterFunction.functionName?e.rasterFunction.colorRamp:void 0}function I(e,t,n){const r=n?.toLowerCase().replace("bicubic","cubic"),i=["nearest","bilinear","cubic","majority"].find((e=>e===r));return"Map"===t?i??"bilinear":"standard-time"===e.dataType?i??"nearest":"thematic"===e.dataType||e.attributeTable||e.colormap?"nearest"===i||"majority"===i?i:"nearest":i??"bilinear"}function S(e,t){e=_(e,t?.variableName);const{bandCount:n}=e;let{bandIds:r,stretchType:i}=t||{};r?.some((e=>e>=n))&&(r=null);let s=e.statistics,o=e.histograms;n>1?(r=r?.length?r:C(e),s=null==s?null:r?.map((e=>s[e])),o=null==o?null:r?.map((e=>o[e]))):r=[0],null==i&&(i=function(e){let t="percent-clip";const{pixelType:n,dataType:r,histograms:i,statistics:s,multidimensionalInfo:o}=e,a=b.has(r)||"generic"===r&&null!=o;return"u8"!==n||"processed"!==r&&null!=i&&null!=s?"u8"===n||"elevation"===r||a?t="min-max":null!=i?t="percent-clip":null!=s&&(t="min-max"):t="none",t}(e)),t?.includeStatisticsInStretch&&("percent-clip"===i||"histogram-equalization"===i)&&e.statistics?.length&&(i="min-max");let a=!1;switch(i){case"none":a=!1;break;case"percent-clip":a=!o?.length;break;default:a=!s?.length}const{dataType:l}=e,u=1===r?.length&&b.has(l)?g:null,c=new h.A({stretchType:i,dynamicRangeAdjustment:a,colorRamp:u,outputMin:0,outputMax:255,gamma:1===r?.length?[1]:[1,1,1],useGamma:!1});return"percent-clip"===i?c.maxPercent=c.minPercent=y:"standard-deviation"===i&&(c.numberOfStandardDeviations=2),a||null==e.multidimensionalInfo&&!t?.includeStatisticsInStretch||("percent-clip"===i?c.histograms=o:"min-max"!==i&&"standard-deviation"!==i||(c.statistics=s)),c}function _(e,t){const{multidimensionalInfo:n}=e;if(!t||!n)return e;const r=n.variables.find((e=>e.name===t));if(!r)return e;if(e=e.clone(),r){const{statistics:t,histograms:n}=r;t?.length&&(e.statistics=t.map((e=>({min:e.min,max:e.max,avg:e.avg,stddev:e.stddev})))),n?.length&&(e.histograms=n)}return e}function C(e){const t=e.bandCount;if(1===t)return null;if(2===t)return[0];const{bandInfos:n}=e;let r;if(n.length===t){const{red:e,green:t,blue:i,nir:s}=function(e){const t={};for(let n=0;n<e.length;n++){const r=e[n],i=r.name.toLowerCase();if("red"===i)t.red=n;else if("green"===i)t.green=n;else if("blue"===i)t.blue=n;else if("nearinfrared"===i||"nearinfrared_1"===i||"nir"===i)t.nir=n;else if(r.maxWavelength&&r.minWavelength){const e=r.minWavelength,i=r.maxWavelength;null==t.blue&&e>=410&&e<=480&&i>=480&&i<=540?t.blue=n:null==t.green&&e>=490&&e<=560&&i>=560&&i<=610?t.green=n:null==t.red&&e>=595&&e<=670&&i>=660&&i<=730?t.red=n:null==t.nir&&e>=700&&e<=860&&i>=800&&i<=950&&(t.nir=n)}}return t}(n);null!=e&&null!=t&&null!=i?r=[e,t,i]:null!=s&&null!=e&&null!=t&&(r=[s,e,t])}return!r&&t>=3&&(r=[0,1,2]),r}function T(e,t,n){let r;return null!=e?(r=t?e.fields.find((e=>t.toLowerCase()===e.name.toLowerCase())):function(e){let t;for(let n=0;n<e.length;n++){const r=e[n].name.toLowerCase();if("string"===e[n].type){if(r.startsWith("class")){t=e[n];break}null==t&&(r.endsWith("name")||r.endsWith("type"))&&(t=e[n])}}return t}(e.fields),r||(n||(r=e.fields.find((e=>"string"===e.type))),r||(r=k(e,"value")))):r=new i.A({name:"value"}),r}function k(e,t){return null==e?null:e.fields.find((e=>e.name.toLowerCase()===t))}const R=new Map([["m/s","meter-per-second"],["km/h","kilometer-per-hour"],["knots","knots"],["ft/s","feet-per-second"],["mph","mile-per-hour"]]);function P(e){return{color:e.symbolLayers[0].material?.color,type:"esriSFS",style:"esriSFSSolid"}}function N(e){if("uniqueValue"===e.type){const t=e.uniqueValueInfos,n=t?.[0].symbol;return n?.symbolLayers?.length&&(e.uniqueValueInfos=t?.map((e=>({value:e.value,label:e.label,symbol:e.symbol?P(e.symbol):null})))),e}if("classBreaks"===e.type){const t=e.classBreakInfos,n=t[0].symbol;return n?.symbolLayers?.length&&(e.classBreakInfos=t.map((e=>({classMinValue:e.classMinValue,classMaxValue:e.classMaxValue,label:e.label,symbol:e.symbol?P(e.symbol):null})))),e}return e}},41259:function(e,t,n){n.d(t,{u:function(){return r},x:function(){return i}});const r=new(n(73037).J)({none:"none",standardDeviation:"standard-deviation",histogramEqualization:"histogram-equalization",minMax:"min-max",percentClip:"percent-clip",sigmoid:"sigmoid"}),i={0:"none",3:"standardDeviation",4:"histogramEqualization",5:"minMax",6:"percentClip",9:"sigmoid"}},74843:function(e,t,n){n.d(t,{A:function(){return c}});var r,i=n(53804),s=n(23502),o=(n(58941),n(40633),n(13798),n(65953)),a=n(64494),l=n(71859);let u=r=class extends a.A{constructor(e){super(e),this.type="color",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(e){e&&Array.isArray(e)&&(e=e.filter((e=>!!e))).sort(((e,t)=>e.value-t.value)),this._set("stops",e)}clone(){return new r({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map((e=>e.clone())),legendOptions:this.legendOptions?.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map((e=>e.value||0))}};(0,i._)([(0,s.MZ)({readOnly:!0})],u.prototype,"cache",null),(0,i._)([(0,s.MZ)({type:["color"],json:{type:["colorInfo"]}})],u.prototype,"type",void 0),(0,i._)([(0,s.MZ)({type:String,json:{write:!0}})],u.prototype,"normalizationField",void 0),(0,i._)([(0,s.MZ)({type:[l.A],json:{write:!0}})],u.prototype,"stops",null),u=r=(0,i._)([(0,o.$)("esri.renderers.visualVariables.ColorVariable")],u);const c=u},14170:function(e,t,n){n.d(t,{A:function(){return g}});var r,i=n(53804),s=n(23502),o=(n(58941),n(40633),n(13798),n(65953)),a=n(64494),l=n(30905),u=n(67888),c=n(47332),p=n(81392),h=n(59798);let f=r=class extends l.oY{constructor(e){super(e),this.label=null,this.opacity=null,this.value=null}readOpacity(e,t){return(0,h.D)(t.transparency)}writeOpacity(e,t,n){t[n]=(0,h.p)(e)}clone(){return new r({label:this.label,opacity:this.opacity,value:this.value})}};(0,i._)([(0,s.MZ)({type:String,json:{write:!0}})],f.prototype,"label",void 0),(0,i._)([(0,s.MZ)({type:Number,json:{type:u.jz,write:{target:"transparency"}}})],f.prototype,"opacity",void 0),(0,i._)([(0,c.w)("opacity",["transparency"])],f.prototype,"readOpacity",null),(0,i._)([(0,p.K)("opacity")],f.prototype,"writeOpacity",null),(0,i._)([(0,s.MZ)({type:Number,json:{write:!0}})],f.prototype,"value",void 0),f=r=(0,i._)([(0,o.$)("esri.renderers.visualVariables.support.OpacityStop")],f);const d=f;var m;let y=m=class extends a.A{constructor(e){super(e),this.type="opacity",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(e){e&&Array.isArray(e)&&(e=e.filter((e=>!!e))).sort(((e,t)=>e.value-t.value)),this._set("stops",e)}clone(){return new m({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map((e=>e.clone())),legendOptions:this.legendOptions?.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map((e=>e.value||0))}};(0,i._)([(0,s.MZ)({readOnly:!0})],y.prototype,"cache",null),(0,i._)([(0,s.MZ)({type:["opacity"],json:{type:["transparencyInfo"]}})],y.prototype,"type",void 0),(0,i._)([(0,s.MZ)({type:String,json:{write:!0}})],y.prototype,"normalizationField",void 0),(0,i._)([(0,s.MZ)({type:[d],json:{write:!0}})],y.prototype,"stops",null),y=m=(0,i._)([(0,o.$)("esri.renderers.visualVariables.OpacityVariable")],y);const g=y},36604:function(e,t,n){n.d(t,{A:function(){return u}});var r,i=n(53804),s=n(23502),o=(n(58941),n(40633),n(13798),n(65953)),a=n(64494);let l=r=class extends a.A{constructor(e){super(e),this.axis=null,this.type="rotation",this.rotationType="geographic"}get cache(){return{hasExpression:!!this.valueExpression,compiledFunc:null}}clone(){return new r({axis:this.axis,rotationType:this.rotationType,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:this.legendOptions?.clone()})}};(0,i._)([(0,s.MZ)({readOnly:!0})],l.prototype,"cache",null),(0,i._)([(0,s.MZ)({type:["heading","tilt","roll"],json:{origins:{"web-scene":{default:"heading",write:!0}}}})],l.prototype,"axis",void 0),(0,i._)([(0,s.MZ)({type:["rotation"],json:{type:["rotationInfo"]}})],l.prototype,"type",void 0),(0,i._)([(0,s.MZ)({type:["geographic","arithmetic"],json:{write:!0,origins:{"web-document":{write:!0,default:"geographic"}}}})],l.prototype,"rotationType",void 0),l=r=(0,i._)([(0,o.$)("esri.renderers.visualVariables.RotationVariable")],l);const u=l},53096:function(e,t,n){n.d(t,{A:function(){return _}});var r=n(53804),i=n(39819),s=n(73037),o=n(40633),a=n(23502),l=n(77560),u=n(47332),c=n(65953),p=n(81392),h=n(64494),f=n(13520),d=n(59423),m=(n(58941),n(13798),n(96893));let y=class extends m.A{constructor(){super(...arguments),this.customValues=null}};(0,r._)([(0,a.MZ)({type:[Number],json:{write:!0}})],y.prototype,"customValues",void 0),y=(0,r._)([(0,c.$)("esri.renderers.visualVariables.support.SizeVariableLegendOptions")],y);const g=y;var w,b=n(32974),v=n(70481);const x=new s.J({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),M=new s.J({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers"});function A(e){if(null!=e)return"string"==typeof e||"number"==typeof e?function(e){return(0,f.cr)(e)}(e):"size"===e.type?(0,b.of)(e)?e:(delete(e={...e}).type,new S(e)):void 0}function I(e,t,n){if("object"!=typeof e)return e;const r=new S;return r.read(e,n),r}let S=w=class extends h.A{constructor(e){super(e),this.axis=null,this.legendOptions=null,this.normalizationField=null,this.scaleBy=null,this.target=null,this.type="size",this.useSymbolValue=null,this.valueExpression=null,this.valueRepresentation=null,this.valueUnit=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,isScaleDriven:null!=this.valueExpression&&v.viewScaleRE.test(this.valueExpression)}}set index(e){(0,b.of)(this.maxSize)&&(this.maxSize.index=`visualVariables[${e}].maxSize`),(0,b.of)(this.minSize)&&(this.minSize.index=`visualVariables[${e}].minSize`),this._set("index",e)}get inputValueType(){return(0,b.eh)(this)}set maxDataValue(e){e&&this.stops&&(o.A.getLogger(this).warn("cannot set maxDataValue when stops is not null."),e=null),this._set("maxDataValue",e)}set maxSize(e){e&&this.stops&&(o.A.getLogger(this).warn("cannot set maxSize when stops is not null."),e=null),this._set("maxSize",e)}castMaxSize(e){return A(e)}readMaxSize(e,t,n){return I(e,0,n)}set minDataValue(e){e&&this.stops&&(o.A.getLogger(this).warn("cannot set minDataValue when stops is not null."),e=null),this._set("minDataValue",e)}set minSize(e){e&&this.stops&&(o.A.getLogger(this).warn("cannot set minSize when stops is not null."),e=null),this._set("minSize",e)}castMinSize(e){return A(e)}readMinSize(e,t,n){return I(e,0,n)}get arcadeRequired(){return!!this.valueExpression||null!=this.minSize&&"object"==typeof this.minSize&&this.minSize.arcadeRequired||null!=this.maxSize&&"object"==typeof this.maxSize&&this.maxSize.arcadeRequired}set stops(e){null==this.minDataValue&&null==this.maxDataValue&&null==this.minSize&&null==this.maxSize?e&&Array.isArray(e)&&(e=e.filter((e=>!!e))).sort(((e,t)=>e.value-t.value)):e&&(o.A.getLogger(this).warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),e=null),this._set("stops",e)}get transformationType(){return(0,b.KZ)(this,this.inputValueType)}readValueExpression(e,t){return e||t.expression&&"$view.scale"}writeValueExpressionWebScene(e,t,n,r){if("$view.scale"===e){if(r?.messages){const e=this.index,t="string"==typeof e?e:`visualVariables[${e}]`;r.messages.push(new i.A("property:unsupported",this.type+"VisualVariable.valueExpression = '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:t+".valueExpression",context:r}))}}else t[n]=e}readValueUnit(e){return e?M.read(e):null}clone(){return new w({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:(0,b.of)(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:(0,b.of)(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops?.map((e=>e.clone())),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions?.clone()})}flipSizes(){if(this.transformationType===b._w.ClampedLinear){const{minSize:e,maxSize:t}=this;return this.minSize=t,this.maxSize=e,this}if(this.transformationType===b._w.Stops){const e=this.stops;if(!e)return this;const t=e.map((e=>e.size)).reverse(),n=e.length;for(let r=0;r<n;r++)e[r].size=t[r];return this}return this}getAttributeHash(){return`${super.getAttributeHash()}-${this.target}-${this.normalizationField}`}_interpolateData(){return this.stops?.map((e=>e.value||0))}};(0,r._)([(0,a.MZ)({readOnly:!0})],S.prototype,"cache",null),(0,r._)([(0,a.MZ)({type:x.apiValues,json:{type:x.jsonValues,origins:{"web-map":{read:!1}},read:x.read,write:x.write}})],S.prototype,"axis",void 0),(0,r._)([(0,a.MZ)()],S.prototype,"index",null),(0,r._)([(0,a.MZ)({type:String,readOnly:!0})],S.prototype,"inputValueType",null),(0,r._)([(0,a.MZ)({type:g,json:{write:!0}})],S.prototype,"legendOptions",void 0),(0,r._)([(0,a.MZ)({type:Number,value:null,json:{write:!0}})],S.prototype,"maxDataValue",null),(0,r._)([(0,a.MZ)({type:Number,value:null,json:{write:!0}})],S.prototype,"maxSize",null),(0,r._)([(0,l.w)("maxSize")],S.prototype,"castMaxSize",null),(0,r._)([(0,u.w)("maxSize")],S.prototype,"readMaxSize",null),(0,r._)([(0,a.MZ)({type:Number,value:null,json:{write:!0}})],S.prototype,"minDataValue",null),(0,r._)([(0,a.MZ)({type:Number,value:null,json:{write:!0}})],S.prototype,"minSize",null),(0,r._)([(0,l.w)("minSize")],S.prototype,"castMinSize",null),(0,r._)([(0,u.w)("minSize")],S.prototype,"readMinSize",null),(0,r._)([(0,a.MZ)({type:String,json:{write:!0}})],S.prototype,"normalizationField",void 0),(0,r._)([(0,a.MZ)({readOnly:!0})],S.prototype,"arcadeRequired",null),(0,r._)([(0,a.MZ)({type:String})],S.prototype,"scaleBy",void 0),(0,r._)([(0,a.MZ)({type:[d.A],value:null,json:{write:!0}})],S.prototype,"stops",null),(0,r._)([(0,a.MZ)({type:["outline"],json:{write:!0}})],S.prototype,"target",void 0),(0,r._)([(0,a.MZ)({type:String,readOnly:!0})],S.prototype,"transformationType",null),(0,r._)([(0,a.MZ)({type:["size"],json:{type:["sizeInfo"]}})],S.prototype,"type",void 0),(0,r._)([(0,a.MZ)({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],S.prototype,"useSymbolValue",void 0),(0,r._)([(0,a.MZ)({type:String,json:{write:!0}})],S.prototype,"valueExpression",void 0),(0,r._)([(0,u.w)("valueExpression",["valueExpression","expression"])],S.prototype,"readValueExpression",null),(0,r._)([(0,p.K)("web-scene","valueExpression")],S.prototype,"writeValueExpressionWebScene",null),(0,r._)([(0,a.MZ)({type:["radius","diameter","area","width","distance"],json:{write:!0}})],S.prototype,"valueRepresentation",void 0),(0,r._)([(0,a.MZ)({type:M.apiValues,json:{write:M.write,origins:{"web-map":{read:!1},"web-scene":{write:!0},"portal-item":{write:!0}}}})],S.prototype,"valueUnit",void 0),(0,r._)([(0,u.w)("valueUnit")],S.prototype,"readValueUnit",null),S=w=(0,r._)([(0,c.$)("esri.renderers.visualVariables.SizeVariable")],S);const _=S},64494:function(e,t,n){n.d(t,{A:function(){return d}});var r=n(53804),i=n(73037),s=n(30905),o=n(40633),a=n(23502),l=n(77560),u=n(65953),c=n(67888),p=n(96893);const h=new i.J({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"});let f=class extends s.oY{constructor(e){super(e),this.index=null,this.type=null,this.field=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null}castField(e){return null==e?e:"function"==typeof e?(o.A.getLogger(this).error(".field: field must be a string value"),null):(0,c.GX)(e)}get arcadeRequired(){return!!this.valueExpression}clone(){}getAttributeHash(){return`${this.type}-${this.field}-${this.valueExpression}`}};(0,r._)([(0,a.MZ)()],f.prototype,"index",void 0),(0,r._)([(0,a.MZ)({type:h.apiValues,readOnly:!0,json:{read:h.read,write:h.write}})],f.prototype,"type",void 0),(0,r._)([(0,a.MZ)({type:String,json:{write:!0}})],f.prototype,"field",void 0),(0,r._)([(0,l.w)("field")],f.prototype,"castField",null),(0,r._)([(0,a.MZ)({type:String,json:{write:!0}})],f.prototype,"valueExpression",void 0),(0,r._)([(0,a.MZ)({type:String,json:{write:!0}})],f.prototype,"valueExpressionTitle",void 0),(0,r._)([(0,a.MZ)({readOnly:!0})],f.prototype,"arcadeRequired",null),(0,r._)([(0,a.MZ)({type:p.A,json:{write:!0}})],f.prototype,"legendOptions",void 0),f=(0,r._)([(0,u.$)("esri.renderers.visualVariables.VisualVariable")],f);const d=f},71859:function(e,t,n){n.d(t,{A:function(){return h}});var r,i=n(53804),s=n(52874),o=n(30905),a=n(23502),l=n(67888),u=(n(13798),n(58941),n(65953)),c=n(81392);let p=r=class extends o.oY{constructor(e){super(e),this.color=null,this.label=null,this.value=null}writeValue(e,t,n){t[n]=e??0}clone(){return new r({color:this.color&&this.color.clone(),label:this.label,value:this.value})}};(0,i._)([(0,a.MZ)({type:s.A,json:{type:[l.jz],write:!0}})],p.prototype,"color",void 0),(0,i._)([(0,a.MZ)({type:String,json:{write:!0}})],p.prototype,"label",void 0),(0,i._)([(0,a.MZ)({type:Number,json:{write:{writerEnsuresNonNull:!0}}})],p.prototype,"value",void 0),(0,i._)([(0,c.K)("value")],p.prototype,"writeValue",null),p=r=(0,i._)([(0,u.$)("esri.renderers.visualVariables.support.ColorStop")],p);const h=p},59423:function(e,t,n){n.d(t,{A:function(){return c}});var r,i=n(53804),s=n(30905),o=n(13520),a=n(23502),l=(n(58941),n(40633),n(13798),n(65953));let u=r=class extends s.oY{constructor(e){super(e),this.label=null,this.size=null,this.value=null,this.useMinValue=null,this.useMaxValue=null}clone(){return new r({label:this.label,size:this.size,value:this.value,useMaxValue:this.useMaxValue,useMinValue:this.useMinValue})}};(0,i._)([(0,a.MZ)({type:String,json:{write:!0}})],u.prototype,"label",void 0),(0,i._)([(0,a.MZ)({type:Number,cast:o.cr,json:{write:!0}})],u.prototype,"size",void 0),(0,i._)([(0,a.MZ)({type:Number,json:{write:!0}})],u.prototype,"value",void 0),(0,i._)([(0,a.MZ)({type:Boolean,json:{write:!1}})],u.prototype,"useMinValue",void 0),(0,i._)([(0,a.MZ)({type:Boolean,json:{write:!1}})],u.prototype,"useMaxValue",void 0),u=r=(0,i._)([(0,l.$)("esri.renderers.visualVariables.support.SizeStop")],u);const c=u},96893:function(e,t,n){n.d(t,{A:function(){return u}});var r=n(53804),i=n(75743),s=n(30905),o=n(23502),a=(n(58941),n(40633),n(13798),n(65953));let l=class extends((0,i.O)(s.oY)){constructor(){super(...arguments),this.showLegend=null,this.title=null}};(0,r._)([(0,o.MZ)({type:Boolean,json:{write:!0}})],l.prototype,"showLegend",void 0),(0,r._)([(0,o.MZ)({type:String,json:{write:!0}})],l.prototype,"title",void 0),l=(0,r._)([(0,a.$)("esri.renderers.visualVariables.support.VisualVariableLegendOptions")],l);const u=l},32974:function(e,t,n){var r,i;function s(e){return e&&"esri.renderers.visualVariables.SizeVariable"===e.declaredClass}function o(e){return null!=e&&!isNaN(e)&&isFinite(e)}function a(e){return e.valueExpression?r.Expression:e.field&&"string"==typeof e.field?r.Field:r.Unknown}function l(e,t){const n=t||a(e),s=e.valueUnit||"unknown";return n===r.Unknown?i.Constant:e.stops?i.Stops:null!=e.minSize&&null!=e.maxSize&&null!=e.minDataValue&&null!=e.maxDataValue?i.ClampedLinear:"unknown"===s?null!=e.minSize&&null!=e.minDataValue?e.minSize&&e.minDataValue?i.Proportional:i.Additive:i.Identity:i.RealWorldSize}n.d(t,{KZ:function(){return l},Yf:function(){return r},_w:function(){return i},eh:function(){return a},gf:function(){return o},of:function(){return s}}),function(e){e.Unknown="unknown",e.Expression="expression",e.Field="field"}(r||(r={})),function(e){e.Unknown="unknown",e.Stops="stops",e.ClampedLinear="clamped-linear",e.Proportional="proportional",e.Additive="additive",e.Constant="constant",e.Identity="identity",e.RealWorldSize="real-world-size"}(i||(i={}))},70481:function(e,t,n){n.r(t),n.d(t,{getAllSizes:function(){return S},getColor:function(){return m},getOpacity:function(){return y},getRotationAngle:function(){return g},getSize:function(){return w},getSizeForValue:function(){return x},getSizeFromNumberOrVariable:function(){return b},getSizeRangeAtScale:function(){return M},getVisualVariableValues:function(){return A},viewScaleRE:function(){return d}});var r=n(52874),i=n(59469),s=n(82547),o=n(40633),a=n(85031),l=n(32974);const u=()=>o.A.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),c=e=>u().warn(`The visualVariable should be an instance of esri.renderers.visualVariables.${e}`),p=()=>u().error("Use of arcade expressions requires an arcade context"),h=new i.default,f=Math.PI,d=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function m(e,t,n){const i="visualVariables"in e&&e.visualVariables?e.visualVariables.find((e=>"color"===e.type)):e;if(!i)return;if("esri.renderers.visualVariables.ColorVariable"!==i.declaredClass)return void c("ColorVariable");const s="number"==typeof t,o=s?null:t,a=o?.attributes;let l=s?t:null;const u=i.field,{ipData:h,hasExpression:f}=i.cache;let d=i.cache.compiledFunc;if(!u&&!f){const e=i.stops;return e&&e[0]&&e[0].color}if("number"!=typeof l)if(f){if(null==n?.arcade)return void p();const e={viewingMode:n.viewingMode,scale:n.scale,spatialReference:n.spatialReference},t=n.arcade.arcadeUtils,r=t.getViewInfo(e),s=t.createExecContext(o,r,n.timeZone);if(!d){const e=t.createSyntaxTree(i.valueExpression);d=t.createFunction(e),i.cache.compiledFunc=d}l=t.executeFunction(d,s)}else a&&(l=a[u]);const m=i.normalizationField,y=null!=a&&null!=m?parseFloat(a[m]):void 0;if(null!=l&&(!m||s||!isNaN(y)&&0!==y)){isNaN(y)||s||(l/=y);const e=I(l,h);if(e){const t=e[0],s=e[1],o=t===s?i.stops[t].color:r.A.blendColors(i.stops[t].color,i.stops[s].color,e[2],null!=n?n.color:void 0);return new r.A(o)}}}function y(e,t,n){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.find((e=>"opacity"===e.type)):e;if(!r)return;if("esri.renderers.visualVariables.OpacityVariable"!==r.declaredClass)return void c("OpacityVariable");const i="number"==typeof t,s=i?null:t,o=s?.attributes;let a=i?t:null;const l=r.field,{ipData:u,hasExpression:h}=r.cache;let f=r.cache.compiledFunc;if(!l&&!h){const e=r.stops;return e&&e[0]&&e[0].opacity}if("number"!=typeof a)if(h){if(null==n?.arcade)return void p();const e={viewingMode:n.viewingMode,scale:n.scale,spatialReference:n.spatialReference},t=n.arcade.arcadeUtils,i=t.getViewInfo(e),o=t.createExecContext(s,i,n.timeZone);if(!f){const e=t.createSyntaxTree(r.valueExpression);f=t.createFunction(e),r.cache.compiledFunc=f}a=t.executeFunction(f,o)}else o&&(a=o[l]);const d=r.normalizationField,m=null!=o&&null!=d?parseFloat(o[d]):void 0;if(null!=a&&(!d||i||!isNaN(m)&&0!==m)){isNaN(m)||i||(a/=m);const e=I(a,u);if(e){const t=e[0],n=e[1];if(t===n)return r.stops[t].opacity;{const i=r.stops[t].opacity;return i+(r.stops[n].opacity-i)*e[2]}}}}function g(e,t,n){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.find((e=>"rotation"===e.type)):e;if(!r)return;if("esri.renderers.visualVariables.RotationVariable"!==r.declaredClass)return void c("RotationVariable");const i=r.axis||"heading",s="heading"===i&&"arithmetic"===r.rotationType?90:0,o="heading"===i&&"arithmetic"===r.rotationType?-1:1,a="number"==typeof t?null:t,l=a?.attributes,u=r.field,{hasExpression:h}=r.cache;let f=r.cache.compiledFunc,d=0;if(!u&&!h)return d;if(h){if(null==n?.arcade)return void p();const e={viewingMode:n.viewingMode,scale:n.scale,spatialReference:n.spatialReference},t=n.arcade.arcadeUtils,i=t.getViewInfo(e),s=t.createExecContext(a,i,n.timeZone);if(!f){const e=t.createSyntaxTree(r.valueExpression);f=t.createFunction(e),r.cache.compiledFunc=f}d=t.executeFunction(f,s)}else l&&(d=l[u]||0);return d="number"!=typeof d||isNaN(d)?null:s+o*d,d}function w(e,t,n){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.find((e=>"size"===e.type)):e;if(!r)return;if("esri.renderers.visualVariables.SizeVariable"!==r.declaredClass)return void c("SizeVariable");const i=x(function(e,t,n){const r="number"==typeof t,i=r?null:t,s=i?.attributes;let o=r?t:null;const{isScaleDriven:a}=e.cache;let u=e.cache.compiledFunc;if(a){const t=null!=n?n.scale:void 0,r=null!=n?n.view:void 0;o=null==t||"3d"===r?function(e){let t=null,n=null;const r=e.stops;return r?(t=r[0].value,n=r[r.length-1].value):(t=e.minDataValue||0,n=e.maxDataValue||0),(t+n)/2}(e):t}else if(!r)switch(e.inputValueType){case l.Yf.Expression:{if(null==n?.arcade)return void p();const t={viewingMode:n.viewingMode,scale:n.scale,spatialReference:n.spatialReference},r=n.arcade.arcadeUtils,s=r.getViewInfo(t),a=r.createExecContext(i,s,n.timeZone);if(!u){const t=r.createSyntaxTree(e.valueExpression);u=r.createFunction(t),e.cache.compiledFunc=u}o=r.executeFunction(u,a);break}case l.Yf.Field:s&&(o=s[e.field]);break;case l.Yf.Unknown:o=null}if(!(0,l.gf)(o))return null;if(r||!e.normalizationField)return o;const c=s?parseFloat(s[e.normalizationField]):null;return(0,l.gf)(c)&&0!==c?o/c:null}(r,t,n),r,t,n,r.cache.ipData);return null==i||isNaN(i)?0:i}function b(e,t,n){return null==e?null:(0,l.of)(e)?w(e,t,n):(0,l.gf)(e)?e:null}function v(e,t,n){return(0,l.gf)(n)&&e>n?n:(0,l.gf)(t)&&e<t?t:e}function x(e,t,n,r,i){switch(t.transformationType){case l._w.Additive:return function(e,t,n,r){return e+((b(t.minSize,n,r)||t.minDataValue)??0)}(e,t,n,r);case l._w.Constant:return function(e,t,n){const r=e.stops;let i=r?.length&&r[0].size;return null==i&&(i=e.minSize),b(i,t,n)}(t,n,r);case l._w.ClampedLinear:return function(e,t,n,r){const i=(e-t.minDataValue)/(t.maxDataValue-t.minDataValue),s=b(t.minSize,n,r),o=b(t.maxSize,n,r),a=null!=r?r.shape:void 0;if(e<=t.minDataValue)return s;if(e>=t.maxDataValue)return o;if(null==s||null==o)return null;if("area"===t.scaleBy&&a){const e="circle"===a,t=e?f*(s/2)**2:s*s,n=t+i*((e?f*(o/2)**2:o*o)-t);return e?2*Math.sqrt(n/f):Math.sqrt(n)}return s+i*(o-s)}(e,t,n,r);case l._w.Proportional:return function(e,t,n,r){const i=null!=r?r.shape:void 0,s=e/t.minDataValue,o=b(t.minSize,n,r),a=b(t.maxSize,n,r);let l=null;return l="circle"===i?2*Math.sqrt(s*(o/2)**2):"square"===i||"diamond"===i||"image"===i?Math.sqrt(s*o**2):s*o,v(l,o,a)}(e,t,n,r);case l._w.Stops:return function(e,t,n,r,i){const[s,o,a]=I(e,i);if(s===o)return b(t.stops?.[s].size,n,r);{const e=b(t.stops?.[s].size,n,r);return e+(b(t.stops?.[o].size,n,r)-e)*a}}(e,t,n,r,i);case l._w.RealWorldSize:return function(e,t,n,r){const i=(r?.resolution??1)*a.j[t.valueUnit],s=b(t.minSize,n,r),o=b(t.maxSize,n,r),{valueRepresentation:l}=t;let u=null;return u="area"===l?2*Math.sqrt(e/f)/i:"radius"===l||"distance"===l?2*e/i:e/i,v(u,s,o)}(e,t,n,r);case l._w.Identity:return e;case l._w.Unknown:return null}}function M(e,t,n){const{isScaleDriven:r}=e.cache;if(!(r&&"3d"===n||t))return null;const i={scale:t,view:n};let s=b(e.minSize,h,i),o=b(e.maxSize,h,i);if(null!=s||null!=o){if(s>o){const e=o;o=s,s=e}return{minSize:s,maxSize:o}}}function A(e,t,n){if(!e.visualVariables)return;const r=[],i=[],s=[],o=[],a=[];for(const t of e.visualVariables)switch(t.type){case"color":i.push(t);break;case"opacity":s.push(t);break;case"rotation":a.push(t);break;case"size":o.push(t)}return i.forEach((e=>{const i=m(e,t,n);r.push({variable:e,value:i})})),s.forEach((e=>{const i=y(e,t,n);r.push({variable:e,value:i})})),a.forEach((e=>{const i=g(e,t,n);r.push({variable:e,value:i})})),o.forEach((e=>{const i=w(e,t,n);r.push({variable:e,value:i})})),r.filter((e=>null!=e.value))}function I(e,t){if(!t)return;let n=0,r=t.length-1;return t.some(((t,i)=>e<t?(r=i,!0):(n=i,!1))),[n,r,(e-t[n])/(t[r]-t[n])]}function S(e,t,n){const r=["proportional","proportional","proportional"];for(const i of e){const e=i.useSymbolValue?"symbol-value":w(i,t,n);switch(i.axis){case"width":r[0]=e;break;case"depth":r[1]=e;break;case"height":r[2]=e;break;case"width-and-depth":r[0]=e,r[1]=e;break;case"all":case void 0:case null:r[0]=e,r[1]=e,r[2]=e;break;default:(0,s.Xb)(i.axis)}}return r}},26765:function(e,t,n){n.d(t,{V:function(){return s},X:function(){return i}});var r=n(74697);function i(e){return{geometryType:(0,r.$B)(e[0]),geometries:e.map((e=>e.toJSON()))}}function s(e,t,n){const i=(0,r.xD)(t);return e.map((e=>{const t=i.fromJSON(e);return t.spatialReference=n,t}))}},30164:function(e,t,n){n.d(t,{E9:function(){return d},Tw:function(){return h},X6:function(){return f}});var r=n(93040),i=n(91484),s=n(45532),o=n(57165),a=n(98521),l=n(70850),u=n(39397),c=n(51084);async function p(e,t,n){const p=(0,u.Dl)(e),{rasterFunction:h,sourceJSON:f}=t||{},d=h?JSON.stringify(h.rasterFunctionDefinition||h):null,m=(0,u.lF)({...p.query,renderingRule:d,f:"json"}),y=(0,u.jV)(m,n);e=p.path;const g=f||await(0,r.A)(e,y).then((e=>e.data)),w=g.hasRasterAttributeTable?(0,r.A)(`${e}/rasterAttributeTable`,y):null,b=g.hasColormap?(0,r.A)(`${e}/colormap`,y):null,v=g.hasHistograms?(0,r.A)(`${e}/histograms`,y):null,x=g.currentVersion>=10.3?(0,r.A)(`${e}/keyProperties`,y):null,M=g.hasMultidimensions?(0,r.A)(`${e}/multidimensionalInfo`,y):null,A=await Promise.allSettled([w,b,v,x,M]);let I=null;if(g.minValues&&g.minValues.length===g.bandCount){I=[];for(let e=0;e<g.minValues.length;e++)I.push({min:g.minValues[e],max:g.maxValues[e],avg:g.meanValues[e],stddev:g.stdvValues[e]})}const S=i.default.fromJSON(g.extent),_=Math.ceil(S.width/g.pixelSizeX-.1),C=Math.ceil(S.height/g.pixelSizeY-.1),T=o.A.fromJSON(g.spatialReference||g.extent.spatialReference),k="fulfilled"===A[0].status?A[0].value?.data:null,R=k?.features?.length?c.A.fromJSON(k):null,P="fulfilled"===A[1].status?A[1].value?.data.colormap:null,N=P?.length?P:null,D="fulfilled"===A[2].status?A[2].value?.data.histograms:null,E=D?.[0]?.counts?.length?D:null,L="fulfilled"===A[3].status?A[3].value?.data??{}:{},F="fulfilled"===A[4].status?A[4].value?.data.multidimensionalInfo:null,O=F?.variables?.length?F:null;O&&O.variables.forEach((e=>{e.statistics?.length&&e.statistics.forEach((e=>{e.avg=e.mean,e.stddev=e.standardDeviation}))}));const{defaultVariable:z,serviceDataType:j}=g;z&&z!==L.DefaultVariable&&(L.DefaultVariable=z),j?.includes("esriImageServiceDataTypeVector")&&!j.includes(L.DataType)&&(L.DataType=j.replace("esriImageServiceDataType",""));let B=g.noDataValue;g.noDataValues?.length&&g.noDataValues.some((e=>e!==B))&&(B=g.noDataValues);const Z=g.transposeInfo?new l.A({blockWidth:256,blockHeight:256,pyramidBlockWidth:256,pyramidBlockHeight:256,pyramidScalingFactor:2,compression:"lerc",origin:new s.default({x:g.extent.xmin,y:g.extent.ymax,spatialReference:T}),firstPyramidLevel:1,maximumPyramidLevel:Math.max(0,Math.round(Math.log(Math.max(_,C))/Math.LN2-8)),transposeInfo:g.transposeInfo}):void 0;return new a.A({width:_,height:C,bandCount:g.bandCount,extent:i.default.fromJSON(g.extent),spatialReference:T,pixelSize:new s.default({x:g.pixelSizeX,y:g.pixelSizeY,spatialReference:T}),pixelType:g.pixelType.toLowerCase(),statistics:I,attributeTable:R,colormap:N,histograms:E,keyProperties:L,noDataValue:B,multidimensionalInfo:O,storageInfo:Z})}function h(e,t,n){return p(e,{sourceJSON:t},n)}function f(e,t,n){return p(e,{rasterFunction:t},n)}function d(e,t){e.attributeTable||(t.hasRasterAttributeTable=!1),e.histograms||(t.hasHistograms=!1),e.colormap||(t.hasColormap=!1),e.multidimensionalInfo||(t.hasMultidimensions=!1)}},30698:function(e,t,n){n.d(t,{A:function(){return f}});var r,i=n(53804),s=n(52874),o=n(21609),a=n(23502),l=n(67888),u=n(74376),c=n(65953),p=n(9035);let h=r=class extends p.A{constructor(e){super(e),this.algorithm=null,this.fromColor=null,this.toColor=null,this.type="algorithmic"}clone(){return new r({fromColor:(0,o.o8)(this.fromColor),toColor:(0,o.o8)(this.toColor),algorithm:this.algorithm})}};(0,i._)([(0,u.e)({esriCIELabAlgorithm:"cie-lab",esriHSVAlgorithm:"hsv",esriLabLChAlgorithm:"lab-lch"})],h.prototype,"algorithm",void 0),(0,i._)([(0,a.MZ)({type:s.A,json:{type:[l.jz],write:!0}})],h.prototype,"fromColor",void 0),(0,i._)([(0,a.MZ)({type:s.A,json:{type:[l.jz],write:!0}})],h.prototype,"toColor",void 0),(0,i._)([(0,a.MZ)({type:["algorithmic"]})],h.prototype,"type",void 0),h=r=(0,i._)([(0,c.$)("esri.rest.support.AlgorithmicColorRamp")],h);const f=h},74373:function(e,t,n){n.d(t,{A:function(){return h}});var r=n(53804),i=n(73037),s=n(30905),o=n(23502),a=(n(58941),n(40633),n(13798),n(74376)),l=n(65953);const u=new i.J({esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation",esriClassifyDefinedInterval:"defined-interval"}),c=new i.J({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:"percent-of-total",esriNormalizeByField:"field"});let p=class extends s.oY{constructor(e){super(e),this.type="class-breaks-definition",this.breakCount=null,this.classificationField=null,this.classificationMethod=null,this.normalizationField=null,this.normalizationType=null}set standardDeviationInterval(e){"standard-deviation"===this.classificationMethod&&this._set("standardDeviationInterval",e)}set definedInterval(e){"defined-interval"===this.classificationMethod&&this._set("definedInterval",e)}};(0,r._)([(0,a.e)({classBreaksDef:"class-breaks-definition"})],p.prototype,"type",void 0),(0,r._)([(0,o.MZ)({json:{write:!0}})],p.prototype,"breakCount",void 0),(0,r._)([(0,o.MZ)({json:{write:!0}})],p.prototype,"classificationField",void 0),(0,r._)([(0,o.MZ)({type:String,json:{read:u.read,write:u.write}})],p.prototype,"classificationMethod",void 0),(0,r._)([(0,o.MZ)({json:{write:!0}})],p.prototype,"normalizationField",void 0),(0,r._)([(0,o.MZ)({json:{read:c.read,write:c.write}})],p.prototype,"normalizationType",void 0),(0,r._)([(0,o.MZ)({value:null,json:{write:!0}})],p.prototype,"standardDeviationInterval",null),(0,r._)([(0,o.MZ)({value:null,json:{write:!0}})],p.prototype,"definedInterval",null),p=(0,r._)([(0,l.$)("esri.rest.support.ClassBreaksDefinition")],p);const h=p},9035:function(e,t,n){n.d(t,{A:function(){return l}});var r=n(53804),i=n(30905),s=n(23502),o=(n(58941),n(40633),n(13798),n(65953));let a=class extends i.oY{constructor(e){super(e),this.type=null}};(0,r._)([(0,s.MZ)({readOnly:!0,json:{read:!1,write:!0}})],a.prototype,"type",void 0),a=(0,r._)([(0,o.$)("esri.rest.support.ColorRamp")],a);const l=a},51084:function(e,t,n){n.d(t,{A:function(){return b}});var r,i=n(53804),s=n(50917),o=n(59469),a=n(73037),l=n(30905),u=n(21609),c=n(23502),p=(n(58941),n(40633),n(47332)),h=n(65953),f=n(81392),d=n(57165),m=n(74697),y=n(56740);const g=new a.J({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let w=r=class extends l.oY{constructor(e){super(e),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(e,t){const n=d.A.fromJSON(t.spatialReference),r=[];for(let t=0;t<e.length;t++){const i=e[t],s=o.default.fromJSON(i),a=i.geometry?.spatialReference;null==s.geometry||a||(s.geometry.spatialReference=n);const l=i.aggregateGeometries,u=s.aggregateGeometries;if(l&&null!=u)for(const e in u){const t=u[e],r=l[e],i=r?.spatialReference;null==t||i||(t.spatialReference=n)}r.push(s)}return r}writeGeometryType(e,t,n,r){if(e)return void g.write(e,t,n,r);const{features:i}=this;if(i)for(const e of i)if(null!=e?.geometry)return void g.write(e.geometry.type,t,n,r)}readQueryGeometry(e,t){if(!e)return null;const n=!!e.spatialReference,r=(0,m.rS)(e);return r&&!n&&t.spatialReference&&(r.spatialReference=d.A.fromJSON(t.spatialReference)),r}writeSpatialReference(e,t){if(e)return void(t.spatialReference=e.toJSON());const{features:n}=this;if(n)for(const e of n)if(e&&null!=e.geometry&&e.geometry.spatialReference)return void(t.spatialReference=e.geometry.spatialReference.toJSON())}clone(){return new r(this.cloneProperties())}cloneProperties(){return(0,u.o8)({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(e){const t=this.write();if(t.features&&Array.isArray(e)&&e.length>0)for(let n=0;n<t.features.length;n++){const r=t.features[n];if(r.geometry){const t=e?.[n];r.geometry=t?.toJSON()||r.geometry}}return t}quantize(e){const{scale:[t,n],translate:[r,i]}=e,s=this.features,o=this._getQuantizationFunction(this.geometryType,(e=>Math.round((e-r)/t)),(e=>Math.round((i-e)/n)));for(let e=0,t=s.length;e<t;e++)o?.(s[e].geometry)||(s.splice(e,1),e--,t--);return this.transform=e,this}unquantize(){const{geometryType:e,features:t,transform:n}=this;if(!n)return this;const{translate:[r,i],scale:[s,o]}=n;let a=null,l=null;if(this.hasZ&&null!=n?.scale?.[2]){const{translate:[,,e],scale:[,,t]}=n;a=n=>n*t+e}if(this.hasM&&null!=n?.scale?.[3]){const{translate:[,,,e],scale:[,,,t]}=n;l=n=>null==n?n:n*t+e}const u=this._getHydrationFunction(e,(e=>e*s+r),(e=>i-e*o),a,l);for(const{geometry:e}of t)null!=e&&u&&u(e);return this.transform=null,this}_quantizePoints(e,t,n){let r,i;const s=[];for(let o=0,a=e.length;o<a;o++){const a=e[o];if(o>0){const e=t(a[0]),o=n(a[1]);e===r&&o===i||(s.push([e-r,o-i]),r=e,i=o)}else r=t(a[0]),i=n(a[1]),s.push([r,i])}return s.length>0?s:null}_getQuantizationFunction(e,t,n){return"point"===e?e=>(e.x=t(e.x),e.y=n(e.y),e):"polyline"===e||"polygon"===e?e=>{const r=(0,m.Bi)(e)?e.rings:e.paths,i=[];for(let e=0,s=r.length;e<s;e++){const s=r[e],o=this._quantizePoints(s,t,n);o&&i.push(o)}return i.length>0?((0,m.Bi)(e)?e.rings=i:e.paths=i,e):null}:"multipoint"===e?e=>{const r=this._quantizePoints(e.points,t,n);return r&&r.length>0?(e.points=r,e):null}:"extent"===e?e=>e:null}_getHydrationFunction(e,t,n,r,i){return"point"===e?e=>{e.x=t(e.x),e.y=n(e.y),r&&(e.z=r(e.z))}:"polyline"===e||"polygon"===e?e=>{const s=(0,m.Bi)(e)?e.rings:e.paths;let o,a;for(let e=0,r=s.length;e<r;e++){const r=s[e];for(let e=0,i=r.length;e<i;e++){const i=r[e];e>0?(o+=i[0],a+=i[1]):(o=i[0],a=i[1]),i[0]=t(o),i[1]=n(a)}}if(r&&i)for(let e=0,t=s.length;e<t;e++){const t=s[e];for(let e=0,n=t.length;e<n;e++){const n=t[e];n[2]=r(n[2]),n[3]=i(n[3])}}else if(r)for(let e=0,t=s.length;e<t;e++){const t=s[e];for(let e=0,n=t.length;e<n;e++){const n=t[e];n[2]=r(n[2])}}else if(i)for(let e=0,t=s.length;e<t;e++){const t=s[e];for(let e=0,n=t.length;e<n;e++){const n=t[e];n[2]=i(n[2])}}}:"extent"===e?e=>{e.xmin=t(e.xmin),e.ymin=n(e.ymin),e.xmax=t(e.xmax),e.ymax=n(e.ymax),r&&null!=e.zmax&&null!=e.zmin&&(e.zmax=r(e.zmax),e.zmin=r(e.zmin)),i&&null!=e.mmax&&null!=e.mmin&&(e.mmax=i(e.mmax),e.mmin=i(e.mmin))}:"multipoint"===e?e=>{const s=e.points;let o,a;for(let e=0,r=s.length;e<r;e++){const r=s[e];e>0?(o+=r[0],a+=r[1]):(o=r[0],a=r[1]),r[0]=t(o),r[1]=n(a)}if(r&&i)for(let e=0,t=s.length;e<t;e++){const t=s[e];t[2]=r(t[2]),t[3]=i(t[3])}else if(r)for(let e=0,t=s.length;e<t;e++){const t=s[e];t[2]=r(t[2])}else if(i)for(let e=0,t=s.length;e<t;e++){const t=s[e];t[2]=i(t[2])}}:null}};(0,i._)([(0,c.MZ)({type:String,json:{write:!0}})],w.prototype,"displayFieldName",void 0),(0,i._)([(0,c.MZ)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],w.prototype,"exceededTransferLimit",void 0),(0,i._)([(0,c.MZ)({type:[o.default],json:{write:!0}})],w.prototype,"features",void 0),(0,i._)([(0,p.w)("features")],w.prototype,"readFeatures",null),(0,i._)([(0,c.MZ)({type:[y.A],json:{write:!0}})],w.prototype,"fields",void 0),(0,i._)([(0,c.MZ)({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:g.read}}})],w.prototype,"geometryType",void 0),(0,i._)([(0,f.K)("geometryType")],w.prototype,"writeGeometryType",null),(0,i._)([(0,c.MZ)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],w.prototype,"hasM",void 0),(0,i._)([(0,c.MZ)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],w.prototype,"hasZ",void 0),(0,i._)([(0,c.MZ)({types:s.yR,json:{write:!0}})],w.prototype,"queryGeometry",void 0),(0,i._)([(0,p.w)("queryGeometry")],w.prototype,"readQueryGeometry",null),(0,i._)([(0,c.MZ)({type:d.A,json:{write:!0}})],w.prototype,"spatialReference",void 0),(0,i._)([(0,f.K)("spatialReference")],w.prototype,"writeSpatialReference",null),(0,i._)([(0,c.MZ)({json:{write:!0}})],w.prototype,"transform",void 0),w=r=(0,i._)([(0,h.$)("esri.rest.support.FeatureSet")],w),w.prototype.toJSON.isDefaultToJSON=!0;const b=w},78263:function(e,t,n){n.d(t,{A:function(){return g}});var r,i=n(53804),s=n(50917),o=n(30905),a=n(21609),l=n(23502),u=(n(58941),n(40633),n(65953)),c=n(81392),p=n(74697),h=n(84284),f=n(77345),d=n(52038),m=n(45532);let y=r=class extends o.oY{constructor(){super(...arguments),this.geometry=null,this.mosaicRule=null,this.rasterFunction=null,this.pixelSize=null,this.raster=void 0,this.timeExtent=null}writeGeometry(e,t,n){null!=e&&(t.geometryType=(0,p.$B)(e),t[n]=e.toJSON())}clone(){return new r((0,a.o8)({geometry:this.geometry,mosaicRule:this.mosaicRule,rasterFunction:this.rasterFunction,pixelSize:this.pixelSize,raster:this.raster,timeExtent:this.timeExtent}))}};(0,i._)([(0,l.MZ)({types:s.yR,json:{read:p.rS}})],y.prototype,"geometry",void 0),(0,i._)([(0,c.K)("geometry")],y.prototype,"writeGeometry",null),(0,i._)([(0,l.MZ)({type:h.A,json:{write:!0}})],y.prototype,"mosaicRule",void 0),(0,i._)([(0,l.MZ)({type:f.A,json:{write:!0,name:"renderingRule"}})],y.prototype,"rasterFunction",void 0),(0,i._)([(0,l.MZ)({type:m.default,json:{write:!0}})],y.prototype,"pixelSize",void 0),(0,i._)([(0,l.MZ)({json:{write:!0}})],y.prototype,"raster",void 0),(0,i._)([(0,l.MZ)({type:d.A,json:{read:{source:"time"},write:{target:"time"}}})],y.prototype,"timeExtent",void 0),y=r=(0,i._)([(0,u.$)("esri.rest.support.ImageHistogramParameters")],y);const g=y},96245:function(e,t,n){n.d(t,{A:function(){return p}});var r,i=n(53804),s=n(21609),o=n(23502),a=(n(58941),n(40633),n(65953)),l=n(30698),u=n(9035);let c=r=class extends u.A{constructor(e){super(e),this.colorRamps=null,this.type="multipart"}clone(){return new r({colorRamps:(0,s.o8)(this.colorRamps)})}};(0,i._)([(0,o.MZ)({type:[l.A],json:{write:!0}})],c.prototype,"colorRamps",void 0),(0,i._)([(0,o.MZ)({type:["multipart"]})],c.prototype,"type",void 0),c=r=(0,i._)([(0,a.$)("esri.rest.support.MultipartColorRamp")],c);const p=c},85982:function(e,t,n){n.d(t,{g:function(){return o},r:function(){return a}});var r=n(30698),i=n(9035),s=n(96245);const o={key:"type",base:i.A,typeMap:{algorithmic:r.A,multipart:s.A}};function a(e){return e?.type?"algorithmic"===e.type?r.A.fromJSON(e):"multipart"===e.type?s.A.fromJSON(e):null:null}},49241:function(e,t,n){n.d(t,{t:function(){return o}});var r=n(40633);const i=()=>r.A.getLogger("esri.rest.support.generateRendererUtils");function s(e,t){return Number(e.toFixed(t))}function o(e){const{normalizationTotal:t}=e;return{classBreaks:a(e),normalizationTotal:t}}function a(e){const t=e.definition,{classificationMethod:n,normalizationType:r,definedInterval:i}=t,o=t.breakCount??1,a=[];let c=e.values;if(0===c.length)return[];c=c.sort(((e,t)=>e-t));const p=c[0],h=c[c.length-1];if("equal-interval"===n)if(c.length>=o){const e=(h-p)/o;let t=p;for(let n=1;n<o;n++){const i=s(p+n*e,6);a.push({minValue:t,maxValue:i,label:l(t,i,r)}),t=i}a.push({minValue:t,maxValue:h,label:l(t,h,r)})}else c.forEach((e=>{a.push({minValue:e,maxValue:e,label:l(e,e,r)})}));else if("natural-breaks"===n){const t=function(e){const t=[],n=[];let r=Number.MIN_VALUE,i=1,s=-1;for(let o=0;o<e.length;o++){const a=e[o];a===r?(i++,n[s]=i):null!==a&&(t.push(a),r=a,i=1,n.push(i),s++)}return{uniqueValues:t,valueFrequency:n}}(c),n=e.valueFrequency||t.valueFrequency,i=u(t.uniqueValues,n,o);let f=p;for(let e=1;e<o;e++)if(t.uniqueValues.length>e){const n=s(t.uniqueValues[i[e]],6);a.push({minValue:f,maxValue:n,label:l(f,n,r)}),f=n}a.push({minValue:f,maxValue:h,label:l(f,h,r)})}else if("quantile"===n)if(c.length>=o&&p!==h){let e=p,t=Math.ceil(c.length/o),n=0;for(let i=1;i<o;i++){let s=t+n-1;s>c.length&&(s=c.length-1),s<0&&(s=0),a.push({minValue:e,maxValue:c[s],label:l(e,c[s],r)}),e=c[s],n+=t,t=Math.ceil((c.length-n)/(o-i))}a.push({minValue:e,maxValue:h,label:l(e,h,r)})}else{let e=-1;for(let t=0;t<c.length;t++){const n=c[t];n!==e&&(e=n,a.push({minValue:e,maxValue:n,label:l(e,n,r)}),e=n)}}else if("standard-deviation"===n){const e=function(e){let t=0;for(let n=0;n<e.length;n++)t+=e[n];return t/=e.length,t}(c),t=function(e,t){let n=0;for(let r=0;r<e.length;r++){const i=e[r];n+=(i-t)*(i-t)}return n/=e.length,Math.sqrt(n)}(c,e);if(0===t)a.push({minValue:c[0],maxValue:c[0],label:l(c[0],c[0],r)});else{const n=function(e,t,n,r,i){let s=Math.max(r-e,t-r)/i/n;return s=s>=1?1:s>=.5?.5:.25,s}(p,h,o,e,t)*t;let i=0,u=p;for(let t=o;t>=1;t--){const o=s(e-(t-.5)*n,6);a.push({minValue:u,maxValue:o,label:l(u,o,r)}),u=o,i++}let c=s(e+.5*n,6);a.push({minValue:u,maxValue:c,label:l(u,c,r)}),u=c,i++;for(let t=1;t<=o;t++)c=i===2*o?h:s(e+(t+.5)*n,6),a.push({minValue:u,maxValue:c,label:l(u,c,r)}),u=c,i++}}else if("defined-interval"===n){if(!i)return a;const e=c[0],t=c[c.length-1],n=Math.ceil((t-e)/i);let o=e;for(let t=1;t<n;t++){const n=s(e+t*i,6);a.push({minValue:o,maxValue:n,label:l(o,n,r)}),o=n}a.push({minValue:o,maxValue:t,label:l(o,t,r)})}return a}function l(e,t,n){let r=null;return r=e===t?n&&"percent-of-total"===n?e+"%":e.toString():n&&"percent-of-total"===n?e+"% - "+t+"%":e+" - "+t,r}function u(e,t,n){const r=e.length,i=[];n>r&&(n=r);for(let e=0;e<n;e++)i.push(Math.round(e*r/n-1));i.push(r-1);let s=c(i,e,t,n);return function(e,t,n,r,i,s){let o=0,a=0,l=0,u=0,c=!0;for(let h=0;h<2&&c;h++){0===h&&(c=!1);for(let h=0;h<s-1;h++)for(;n[h+1]+1!==n[h+2];){n[h+1]=n[h+1]+1;const s=p(h,n,r,i);l=s.sbMean,o=s.sbSdcm;const f=p(h+1,n,r,i);if(u=f.sbMean,a=f.sbSdcm,!(o+a<t[h]+t[h+1])){n[h+1]=n[h+1]-1;break}t[h]=o,t[h+1]=a,e[h]=l,e[h+1]=u,c=!0}for(let h=s-1;h>0;h--)for(;n[h]!==n[h-1]+1;){n[h]=n[h]-1;const s=p(h-1,n,r,i);l=s.sbMean,o=s.sbSdcm;const f=p(h,n,r,i);if(u=f.sbMean,a=f.sbSdcm,!(o+a<t[h-1]+t[h])){n[h]=n[h]+1;break}t[h-1]=o,t[h]=a,e[h-1]=l,e[h]=u,c=!0}}return c}(s.mean,s.sdcm,i,e,t,n)&&(s=c(i,e,t,n)),i}function c(e,t,n,r){let i=[],s=[],o=[],a=0;const l=[],u=[];for(let i=0;i<r;i++){const r=p(i,e,t,n);l.push(r.sbMean),u.push(r.sbSdcm),a+=u[i]}let c,h=a,f=!0;for(;f||a<h;){f=!1,i=[];for(let t=0;t<r;t++)i.push(e[t]);for(let n=0;n<r;n++)for(let i=e[n]+1;i<=e[n+1];i++)if(c=t[i],n>0&&i!==e[n+1]&&Math.abs(c-l[n])>Math.abs(c-l[n-1]))e[n]=i;else if(n<r-1&&e[n]!==i-1&&Math.abs(c-l[n])>Math.abs(c-l[n+1])){e[n+1]=i-1;break}h=a,a=0,s=[],o=[];for(let i=0;i<r;i++){s.push(l[i]),o.push(u[i]);const r=p(i,e,t,n);l[i]=r.sbMean,u[i]=r.sbSdcm,a+=u[i]}}if(a>h){for(let t=0;t<r;t++)e[t]=i[t],l[t]=s[t],u[t]=o[t];a=h}return{mean:l,sdcm:u}}function p(e,t,n,r){let s=0,o=0;for(let i=t[e]+1;i<=t[e+1];i++){const e=r[i];s+=n[i]*e,o+=e}o<=0&&i().warn("Exception in Natural Breaks calculation");const a=s/o;let l=0;for(let i=t[e]+1;i<=t[e+1];i++)l+=r[i]*(n[i]-a)**2;return{sbMean:a,sbSdcm:l}}},39397:function(e,t,n){n.d(t,{Dl:function(){return o},jV:function(){return s},lF:function(){return a}}),n(25591),n(7156);var r=n(21609),i=n(90683);function s(e,t){return t?{...t,query:{...e??{},...t.query}}:{query:e}}function o(e){return"string"==typeof e?(0,i.An)(e):(0,r.o8)(e)}function a(e,t,n){const r={};for(const i in e){if("declaredClass"===i)continue;const s=e[i];if(null!=s&&"function"!=typeof s)if(Array.isArray(s))r[i]=s.map((e=>a(e)));else if("object"==typeof s)if(s.toJSON){const e=s.toJSON(n?.[i]);r[i]=t?e:JSON.stringify(e)}else r[i]=t?s:JSON.stringify(s);else r[i]=s}return r}n(48893)},18950:function(e,t,n){n.d(t,{DQ:function(){return c},tn:function(){return u}});var r=n(90473),i=n(53743),s=n(57435),o=(n(58439),n(57746),n(44433),n(48212)),a=(n(40401),n(16621),n(12966),n(84847),n(33504)),l=n(49595);function u({displayField:e,editFieldsInfo:t,fields:n,objectIdField:l,title:u},c){if(!n)return null;const d=function(e,t){const n=t?.visibleFieldNames;return function({fields:e,ignoreFieldTypes:t,sortDisabled:n}){const r=e;return t&&(e=e.filter((e=>!t.includes(e.type)))),e===r&&(e=e.slice()),!0!==n&&e.sort(h),e}({fields:e.fields??[],ignoreFieldTypes:t?.ignoreFieldTypes||m,sortDisabled:t?.sortDisabled}).map((t=>new a.A({fieldName:t.name,isEditable:(0,i.R$)(t,e),label:t.alias,format:f(t),visible:p(t,{...e,visibleFieldNames:n})})))}({editFieldsInfo:t,fields:n,objectIdField:l},c);if(!d.length)return null;const y=function(e){const t=(0,i.mB)(e),{titleBase:n}=e;return t?`${n}: {${t.trim()}}`:n??""}({titleBase:u,fields:n,displayField:e}),g=[new o.A,new s.A];return new r.A({title:y,content:g,fieldInfos:d})}function c(e){const{title:t,graphic:n}=e??{},{attributes:r,sourceLayer:i}=n??{},s=i&&"displayField"in i?i.displayField:null,o=s?r?.[s]:null,a=n?.getObjectId()?.toString();return t||o||a||""}const p=(e,t)=>t.visibleFieldNames?t.visibleFieldNames.has(e.name):(0,i.Bz)(e,t);function h(e,t){return"oid"===e.type?-1:"oid"===t.type?1:d(e)?-1:d(t)?1:(e.alias||e.name).toLocaleLowerCase().localeCompare((t.alias||t.name).toLocaleLowerCase())}function f(e){switch(e.type){case"small-integer":case"integer":case"single":return new l.A({digitSeparator:!0,places:0});case"double":return new l.A({digitSeparator:!0,places:2});case"string":return(0,i.JL)(e.name)?new l.A({digitSeparator:!0,places:0}):void 0;default:return}}function d(e){if("name"===(e.name&&e.name.toLowerCase()))return!0;const t=e.alias?.toLowerCase();return"name"===t}const m=["geometry","blob","raster","guid","xml"]},23532:function(e,t,n){n.d(t,{$:function(){return r},u:function(){return i}});const r="20241122",i="f6f7099a0e79cf518abdcf87c5aa8b6f24ecdcd8"},38821:function(e,t,n){n.d(t,{D:function(){return s},K:function(){return i}});var r=n(33389);const i={color:[128,128,128,1],outlinecolor:[0,0,0,1],backgroundcolor:[128,128,128,1],borderlinecolor:[0,0,0,1],tintcolor:[255,255,255,1]},s={CIMVectorMarker:{scalesymbolsproportionally:!1,respectframe:!0,anchorpointunits:"Relative",offsetx:0,offsety:0,rotateclockwise:!1,rotation:0,size:10,enable:!0,colorlocked:!1},CIMPictureMarker:{scalex:1,texturefilter:"Draft",anchorpointunits:"Relative",offsetx:0,offsety:0,rotateclockwise:!1,rotation:0,size:10,enable:!0,colorlocked:!1},CIMTextSymbol:{angle:0,anglex:0,angley:0,halosize:1,height:10,horizontalalignment:"Left",kerning:!0,letterspacing:0,letterwidth:100,ligatures:!0,linegap:0,offsetx:0,offsety:0,strikethrough:!1,textcase:"Normal",textstring:"",underline:!1,verticalalignment:"Bottom",enable:!0,colorlocked:!1},CIMSolidStroke:{capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMPictureStroke:{texturefilter:"Draft",capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMGradientStroke:{capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMSolidFill:{enable:!0,colorlocked:!1},CIMPictureFill:{offsetx:0,offsety:0,rotation:0,scalex:1,height:10,texturefilter:"Draft",enable:!0,colorlocked:!1},CIMHatchFill:{offsetx:0,offsety:0,rotation:0,separation:4,enable:!0,colorlocked:!1},CIMGeometricEffectAddControlPoints:{angletolerance:120},CIMGeometricEffectArrow:{arrowtype:"OpenEnded",width:5},CIMGeometricEffectBuffer:{size:1},CIMGeometricEffectCut:{begincut:1,endcut:1,middlecut:0,invert:!1},CIMGeometricEffectDashes:{customendingoffset:0,linedashending:"NoConstraint",offsetalongline:0},CIMGeometricEffectDonut:{method:"Mitered",option:"Accurate",width:2},CIMGeometricEffectJog:{angle:225,length:20,position:50},CIMGeometricEffectControlMeasureLine:{rule:"FullGeometry"},CIMGeometricEffectMove:{offsetx:1,offsety:-1},CIMGeometricEffectOffset:{method:"Square",offset:1,option:"Fast"},CIMGeometricEffectRotate:{angle:15},CIMGeometricEffectScale:{xscalefactor:1.15,yscalefactor:1.15},CIMGeometricEffectWave:{amplitude:2,period:3,seed:1,waveform:"Sinus"},CIMMarkerPlacementAlongLine:{customendingoffset:0,endings:"WithHalfGap",offsetalongline:0,placeperpart:!0,angletoline:!0,offset:0},CIMMarkerPlacementAtExtremities:{extremityplacement:"Both",offsetalongline:0,angletoline:!0,offset:0},CIMMarkerPlacementAtRatioPositions:{beginposition:0,endposition:0,flipfirst:!0,angletoline:!0,offset:0},CIMMarkerPlacementInsidePolygon:{gridangle:0,gridtype:"Fixed",offsetx:0,offsety:0,randomness:100,seed:0,shiftoddrows:!1,stepx:16,stepy:16,clipping:"ClipAtBoundary"},CIMMarkerPlacementOnLine:{relativeto:"LineMiddle",startpointoffset:0,angletoline:!0,offset:0},CIMMarkerPlacementOnVertices:{placeperpart:!0,placeoncontrolpoints:!0,placeonendpoints:!0,placeonregularvertices:!0,angletoline:!0,offset:0},CIMMarkerPlacementPolygonCenter:{method:"OnPolygon",offsetx:0,offsety:0,clipatboundary:!1},CIMAnimatedSymbolProperties:{playanimation:!1,reverseanimation:!1,randomizestarttime:!1,randomizestartseed:0,starttimeoffset:0,duration:3,endingduration:3,useendingduration:!1,repeattype:r.fu.Loop,repeatdelay:0,easing:r.Hz.Linear},CIMSymbolAnimationSize:{tosize:10},CIMSymbolAnimationScale:{scalefactor:1},CIMSymbolAnimationColor:{tocolor:[255,255,255,1]},CIMSymbolAnimationTransparency:{totransparency:0},CIMSymbolAnimationRotation:{torotation:0},CIMSymbolAnimationOffset:{offsetx:0,offsety:0}}},33389:function(e,t,n){var r,i,s,o,a,l,u,c,p,h,f,d,m,y,g,w,b,v,x,M,A,I,S,_,C,T,k,R,P,N,D,E,L,F,O,z,j,B,Z,U,V,G,H,W,J,q,$,K,Y,X,Q,ee,te,ne,re,ie,se,oe,ae,le,ue,ce;n.d(t,{$2:function(){return a},C1:function(){return s},Hz:function(){return d},JO:function(){return i},M1:function(){return S},O$:function(){return oe},Q1:function(){return $},TZ:function(){return b},WE:function(){return P},Y:function(){return u},YI:function(){return Y},bj:function(){return c},e_:function(){return q},f0:function(){return se},fu:function(){return f},g7:function(){return p},ip:function(){return K},mU:function(){return N},oF:function(){return A},uQ:function(){return I},uT:function(){return j},vG:function(){return le},wd:function(){return V},xR:function(){return r},xn:function(){return v},xw:function(){return T},yS:function(){return B}}),function(e){e[e.BUTT=0]="BUTT",e[e.ROUND=1]="ROUND",e[e.SQUARE=2]="SQUARE",e[e.UNKNOWN=4]="UNKNOWN"}(r||(r={})),function(e){e[e.BEVEL=0]="BEVEL",e[e.ROUND=1]="ROUND",e[e.MITER=2]="MITER",e[e.UNKNOWN=4]="UNKNOWN"}(i||(i={})),function(e){e[e.SCREEN=0]="SCREEN",e[e.MAP=1]="MAP"}(s||(s={})),function(e){e[e.Tint=0]="Tint",e[e.Ignore=1]="Ignore",e[e.Multiply=99]="Multiply"}(o||(o={})),function(e){e.Both="Both",e.JustBegin="JustBegin",e.JustEnd="JustEnd",e.None="None"}(a||(a={})),function(e){e[e.Mosaic=0]="Mosaic",e[e.Centered=1]="Centered"}(l||(l={})),function(e){e[e.Normal=0]="Normal",e[e.Superscript=1]="Superscript",e[e.Subscript=2]="Subscript"}(u||(u={})),function(e){e[e.MSSymbol=0]="MSSymbol",e[e.Unicode=1]="Unicode"}(c||(c={})),function(e){e[e.Unspecified=0]="Unspecified",e[e.TrueType=1]="TrueType",e[e.PSOpenType=2]="PSOpenType",e[e.TTOpenType=3]="TTOpenType",e[e.Type1=4]="Type1"}(p||(p={})),function(e){e[e.Display=0]="Display",e[e.Map=1]="Map"}(h||(h={})),function(e){e.None="None",e.Loop="Loop",e.Oscillate="Oscillate"}(f||(f={})),function(e){e.Linear="Linear",e.EaseIn="EaseIn",e.EaseOut="EaseOut",e.EaseInOut="EaseInOut"}(d||(d={})),function(e){e[e.Z=0]="Z",e[e.X=1]="X",e[e.Y=2]="Y"}(m||(m={})),function(e){e[e.XYZ=0]="XYZ",e[e.ZXY=1]="ZXY",e[e.YXZ=2]="YXZ"}(y||(y={})),function(e){e[e.Rectangle=0]="Rectangle",e[e.RoundedRectangle=1]="RoundedRectangle",e[e.Oval=2]="Oval"}(g||(g={})),function(e){e[e.None=0]="None",e[e.Alpha=1]="Alpha",e[e.Screen=2]="Screen",e[e.Multiply=3]="Multiply",e[e.Add=4]="Add"}(w||(w={})),function(e){e[e.TTB=0]="TTB",e[e.RTL=1]="RTL",e[e.BTT=2]="BTT"}(b||(b={})),function(e){e[e.None=0]="None",e[e.SignPost=1]="SignPost",e[e.FaceNearPlane=2]="FaceNearPlane"}(v||(v={})),function(e){e[e.Float=0]="Float",e[e.String=1]="String",e[e.Boolean=2]="Boolean"}(x||(x={})),function(e){e[e.Intersect=0]="Intersect",e[e.Subtract=1]="Subtract"}(M||(M={})),function(e){e.OpenEnded="OpenEnded",e.Block="Block",e.Crossed="Crossed"}(A||(A={})),function(e){e.FullGeometry="FullGeometry",e.PerpendicularFromFirstSegment="PerpendicularFromFirstSegment",e.ReversedFirstSegment="ReversedFirstSegment",e.PerpendicularToSecondSegment="PerpendicularToSecondSegment",e.SecondSegmentWithTicks="SecondSegmentWithTicks",e.DoublePerpendicular="DoublePerpendicular",e.OppositeToFirstSegment="OppositeToFirstSegment",e.TriplePerpendicular="TriplePerpendicular",e.HalfCircleFirstSegment="HalfCircleFirstSegment",e.HalfCircleSecondSegment="HalfCircleSecondSegment",e.HalfCircleExtended="HalfCircleExtended",e.OpenCircle="OpenCircle",e.CoverageEdgesWithTicks="CoverageEdgesWithTicks",e.GapExtentWithDoubleTicks="GapExtentWithDoubleTicks",e.GapExtentMidline="GapExtentMidline",e.Chevron="Chevron",e.PerpendicularWithArc="PerpendicularWithArc",e.ClosedHalfCircle="ClosedHalfCircle",e.TripleParallelExtended="TripleParallelExtended",e.ParallelWithTicks="ParallelWithTicks",e.Parallel="Parallel",e.PerpendicularToFirstSegment="PerpendicularToFirstSegment",e.ParallelOffset="ParallelOffset",e.OffsetOpposite="OffsetOpposite",e.OffsetSame="OffsetSame",e.CircleWithArc="CircleWithArc",e.DoubleJog="DoubleJog",e.PerpendicularOffset="PerpendicularOffset",e.LineExcludingLastSegment="LineExcludingLastSegment",e.MultivertexArrow="MultivertexArrow",e.CrossedArrow="CrossedArrow",e.ChevronArrow="ChevronArrow",e.ChevronArrowOffset="ChevronArrowOffset",e.PartialFirstSegment="PartialFirstSegment",e.Arch="Arch",e.CurvedParallelTicks="CurvedParallelTicks",e.Arc90Degrees="Arc90Degrees",e.TipWithPerpendicularAndTicks="TipWithPerpendicularAndTicks",e.ConcentricCircles="ConcentricCircles",e.DoubleJogArrow="DoubleJogArrow",e.LinkedChevrons="LinkedChevrons",e.SegmentThenHalfCircle="SegmentThenHalfCircle",e.LineWithStraightTicks="LineWithStraightTicks",e.DoubleCurve="DoubleCurve",e.ParallelWithTicksByWidth="ParallelWithTicksByWidth",e.EnclosingRoundedRectangle="EnclosingRoundedRectangle"}(I||(I={})),function(e){e.Mitered="Mitered",e.Bevelled="Bevelled",e.Rounded="Rounded",e.Square="Square",e.TrueBuffer="TrueBuffer"}(S||(S={})),function(e){e.ClosePath="ClosePath",e.ConvexHull="ConvexHull",e.RectangularBox="RectangularBox"}(_||(_={})),function(e){e.BeginningOfLine="BeginningOfLine",e.EndOfLine="EndOfLine"}(C||(C={})),function(e){e.Mitered="Mitered",e.Bevelled="Bevelled",e.Rounded="Rounded",e.Square="Square"}(T||(T={})),function(e){e.Fast="Fast",e.Accurate="Accurate"}(k||(k={})),function(e){e.BeginningOfLine="BeginningOfLine",e.EndOfLine="EndOfLine"}(R||(R={})),function(e){e.Sinus="Sinus",e.Square="Square",e.Triangle="Triangle",e.Random="Random"}(P||(P={})),function(e){e[e.None=0]="None",e[e.Default=1]="Default",e[e.Force=2]="Force"}(N||(N={})),function(e){e[e.Buffered=0]="Buffered",e[e.Left=1]="Left",e[e.Right=2]="Right",e[e.AlongLine=3]="AlongLine"}(D||(D={})),function(e){e[e.Linear=0]="Linear",e[e.Rectangular=1]="Rectangular",e[e.Circular=2]="Circular",e[e.Buffered=3]="Buffered"}(E||(E={})),function(e){e[e.Discrete=0]="Discrete",e[e.Continuous=1]="Continuous"}(L||(L={})),function(e){e[e.AcrossLine=0]="AcrossLine",e[e.AloneLine=1]="AloneLine"}(F||(F={})),function(e){e[e.Left=0]="Left",e[e.Right=1]="Right",e[e.Center=2]="Center",e[e.Justify=3]="Justify"}(O||(O={})),function(e){e[e.Base=0]="Base",e[e.MidPoint=1]="MidPoint",e[e.ThreePoint=2]="ThreePoint",e[e.FourPoint=3]="FourPoint",e[e.Underline=4]="Underline",e[e.CircularCW=5]="CircularCW",e[e.CircularCCW=6]="CircularCCW"}(z||(z={})),function(e){e.Butt="Butt",e.Round="Round",e.Square="Square"}(j||(j={})),function(e){e.NoConstraint="NoConstraint",e.HalfPattern="HalfPattern",e.HalfGap="HalfGap",e.FullPattern="FullPattern",e.FullGap="FullGap",e.Custom="Custom"}(B||(B={})),function(e){e[e.None=-1]="None",e[e.Custom=0]="Custom",e[e.Circle=1]="Circle",e[e.OpenArrow=2]="OpenArrow",e[e.ClosedArrow=3]="ClosedArrow",e[e.Diamond=4]="Diamond"}(Z||(Z={})),function(e){e[e.ExtraLeading=0]="ExtraLeading",e[e.Multiple=1]="Multiple",e[e.Exact=2]="Exact"}(U||(U={})),function(e){e.Bevel="Bevel",e.Round="Round",e.Miter="Miter"}(V||(V={})),function(e){e[e.Default=0]="Default",e[e.String=1]="String",e[e.Numeric=2]="Numeric"}(G||(G={})),function(e){e[e.InsidePolygon=0]="InsidePolygon",e[e.PolygonCenter=1]="PolygonCenter",e[e.RandomlyInsidePolygon=2]="RandomlyInsidePolygon"}(H||(H={})),function(e){e[e.Tint=0]="Tint",e[e.Replace=1]="Replace",e[e.Multiply=2]="Multiply"}(W||(W={})),function(e){e[e.ClipAtBoundary=0]="ClipAtBoundary",e[e.RemoveIfCenterOutsideBoundary=1]="RemoveIfCenterOutsideBoundary",e[e.DoNotTouchBoundary=2]="DoNotTouchBoundary",e[e.DoNotClip=3]="DoNotClip"}(J||(J={})),function(e){e.NoConstraint="NoConstraint",e.WithMarkers="WithMarkers",e.WithFullGap="WithFullGap",e.WithHalfGap="WithHalfGap",e.Custom="Custom"}(q||(q={})),function(e){e.Fixed="Fixed",e.Random="Random",e.RandomFixedQuantity="RandomFixedQuantity"}($||($={})),function(e){e.LineMiddle="LineMiddle",e.LineBeginning="LineBeginning",e.LineEnd="LineEnd",e.SegmentMidpoint="SegmentMidpoint"}(K||(K={})),function(e){e.OnPolygon="OnPolygon",e.CenterOfMass="CenterOfMass",e.BoundingBoxCenter="BoundingBoxCenter"}(Y||(Y={})),function(e){e[e.Low=0]="Low",e[e.Medium=1]="Medium",e[e.High=2]="High"}(X||(X={})),function(e){e[e.MarkerCenter=0]="MarkerCenter",e[e.MarkerBounds=1]="MarkerBounds"}(Q||(Q={})),function(e){e[e.None=0]="None",e[e.PropUniform=1]="PropUniform",e[e.PropNonuniform=2]="PropNonuniform",e[e.DifUniform=3]="DifUniform",e[e.DifNonuniform=4]="DifNonuniform"}(ee||(ee={})),function(e){e.Tube="Tube",e.Strip="Strip",e.Wall="Wall"}(te||(te={})),function(e){e[e.Random=0]="Random",e[e.Increasing=1]="Increasing",e[e.Decreasing=2]="Decreasing",e[e.IncreasingThenDecreasing=3]="IncreasingThenDecreasing"}(ne||(ne={})),function(e){e[e.Relative=0]="Relative",e[e.Absolute=1]="Absolute"}(re||(re={})),function(e){e[e.Normal=0]="Normal",e[e.LowerCase=1]="LowerCase",e[e.Allcaps=2]="Allcaps"}(ie||(ie={})),function(e){e[e.LTR=0]="LTR",e[e.RTL=1]="RTL"}(se||(se={})),function(e){e.Draft="Draft",e.Picture="Picture",e.Text="Text"}(oe||(oe={})),function(e){e[e.Top=0]="Top",e[e.Center=1]="Center",e[e.Baseline=2]="Baseline",e[e.Bottom=3]="Bottom"}(ae||(ae={})),function(e){e[e.Right=0]="Right",e[e.Upright=1]="Upright"}(le||(le={})),function(e){e[e.Small=0]="Small",e[e.Medium=1]="Medium",e[e.Large=2]="Large"}(ue||(ue={})),function(e){e[e.Calm=0]="Calm",e[e.Rippled=1]="Rippled",e[e.Slight=2]="Slight",e[e.Moderate=3]="Moderate"}(ce||(ce={}))},7590:function(e,t,n){n.d(t,{$w:function(){return g},Bu:function(){return R},DW:function(){return _},FH:function(){return B},FM:function(){return u},G9:function(){return s},GV:function(){return b},Go:function(){return c},K3:function(){return j},Kn:function(){return I},MM:function(){return f},MO:function(){return V},Nl:function(){return P},Ny:function(){return v},O2:function(){return N},UE:function(){return D},YC:function(){return U},YF:function(){return L},ZO:function(){return O},_1:function(){return T},_H:function(){return M},_W:function(){return w},_d:function(){return S},bs:function(){return Z},dI:function(){return $},e6:function(){return p},gQ:function(){return l},iA:function(){return z},jn:function(){return m},lW:function(){return h},mA:function(){return d},n5:function(){return E},pM:function(){return C},pV:function(){return A},pk:function(){return G},rB:function(){return H},s4:function(){return i},xo:function(){return k},yH:function(){return x},zb:function(){return F},zr:function(){return y}});var r=n(38821);function i(e,t,n,r){return function(e){return"function"==typeof e}(e)?e(t,n,r):e}function s(e){return[e.r,e.g,e.b,e.a]}const o=" /-,\n";function a(e){let t=e.length;for(;t--;)if(!o.includes(e.charAt(t)))return!1;return!0}function l(e,t){const n=[];let r=0,i=-1;do{if(i=e.indexOf("[",r),i>=r){if(i>r){const t=e.slice(r,i);n.push([t,null,a(t)])}if(r=i+1,i=e.indexOf("]",r),i>=r){if(i>r){const s=t[e.slice(r,i)];s&&n.push([null,s,!1])}r=i+1}}}while(-1!==i);if(r<e.length){const t=e.slice(r);n.push([t,null,a(t)])}return n}function u(e,t,n,r){let i="",s=null;for(const r of t){const[t,o,a]=r;if(t)a?s=t:(s&&(i+=s,s=null),i+=t);else{let t=o;null!=n&&(t=V(o,n));const r=e.attributes[t];r&&(s&&(i+=s,s=null),i+=r)}}return function(e,t){switch("string"!=typeof e&&(e=String(e)),t){case"LowerCase":return e.toLowerCase();case"Allcaps":return e.toUpperCase();default:return e}}(i,r)}function c(e,t,n,r,i,s,o=!0){const a=t/i,l=n/s,u=Math.ceil(a/2),c=Math.ceil(l/2);for(let n=0;n<s;n++)for(let p=0;p<i;p++){const h=4*(p+(o?s-n-1:n)*i);let f=0,d=0,m=0,y=0,g=0,w=0,b=0;const v=(n+.5)*l;for(let r=Math.floor(n*l);r<(n+1)*l;r++){const n=Math.abs(v-(r+.5))/c,i=(p+.5)*a,s=n*n;for(let n=Math.floor(p*a);n<(p+1)*a;n++){let o=Math.abs(i-(n+.5))/u;const a=Math.sqrt(s+o*o);a>=-1&&a<=1&&(f=2*a*a*a-3*a*a+1,f>0&&(o=4*(n+r*t),b+=f*e[o+3],m+=f,e[o+3]<255&&(f=f*e[o+3]/250),y+=f*e[o],g+=f*e[o+1],w+=f*e[o+2],d+=f))}}r[h]=y/d,r[h+1]=g/d,r[h+2]=w/d,r[h+3]=b/m}}function p(e){return e?[e[0],e[1],e[2],e[3]/255]:[0,0,0,0]}function h(e){return e.data?.symbol??null}function f(e){return"CIMVectorMarker"===e.type||"CIMPictureMarker"===e.type||"CIMBarChartMarker"===e.type||"CIMCharacterMarker"===e.type||"CIMPieChartMarker"===e.type||"CIMStackedBarChartMarker"===e.type}function d(e){return"CIMGradientStroke"===e.type||"CIMPictureStroke"===e.type||"CIMSolidStroke"===e.type}function m(e){return null!=e&&("CIMGradientFill"===e.type||"CIMHatchFill"===e.type||"CIMPictureFill"===e.type||"CIMSolidFill"===e.type||"CIMWaterFill"===e.type)}function y(e){return null!=e&&("CIMMarkerPlacementAlongLineRandomSize"===e.type||"CIMMarkerPlacementAlongLineSameSize"===e.type||"CIMMarkerPlacementAlongLineVariableSize"===e.type||"CIMMarkerPlacementAtExtremities"===e.type||"CIMMarkerPlacementAtMeasuredUnits"===e.type||"CIMMarkerPlacementAtRatioPositions"===e.type||"CIMMarkerPlacementOnLine"===e.type||"CIMMarkerPlacementOnVertices"===e.type)}const g=(e,t=0)=>null==e||isNaN(e)?t:e,w=(e,t)=>null!=e?e:t,b=(e,t)=>e??t,v=e=>e.tintColor?p(e.tintColor):[255,255,255,1],x=e=>{if(!e)return!1;for(const t of e)switch(t.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":case"CIMGeometricEffectDonut":return!0}return!1};function M(){return n.e(4696).then(n.bind(n,28356))}function A(e){if(!e)return"normal";switch(e.toLowerCase()){case"italic":return"italic";case"oblique":return"oblique";default:return"normal"}}function I(e){if(!e)return"normal";switch(e.toLowerCase()){case"bold":return"bold";case"bolder":return"bolder";case"lighter":return"lighter";default:return"normal"}}function S(e){let t="normal",n="normal";if(e){const r=e.toLowerCase();r.includes("italic")?t="italic":r.includes("oblique")&&(t="oblique"),r.includes("bold")?n="bold":r.includes("light")&&(n="lighter")}return{style:t,weight:n}}function _(e){return e.underline?"underline":e.strikethrough?"line-through":"none"}function C(e){if(!e)return null;switch(e.type){case"CIMPolygonSymbol":if(e.symbolLayers)for(const t of e.symbolLayers){const e=C(t);if(null!=e)return e}break;case"CIMTextSymbol":return C(e.symbol);case"CIMSolidFill":return e.color}return null}function T(e){if(e)switch(e.type){case"CIMPolygonSymbol":case"CIMLineSymbol":{const t=e.symbolLayers;if(t)for(const e of t){const t=T(e);if(null!=t)return t}break}case"CIMTextSymbol":return T(e.symbol);case"CIMSolidStroke":return e.color}}function k(e){if(e)switch(e.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(e.symbolLayers)for(const t of e.symbolLayers){const e=k(t);if(void 0!==e)return e}break;case"CIMTextSymbol":return k(e.symbol);case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return e.width}}function R(e){switch(e){case"Left":default:return"left";case"Right":return"right";case"Center":case"Justify":return"center"}}function P(e){switch(e){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function N(e){return(e?Object.keys(e):[]).map((t=>({name:t,alias:t,type:"string"==typeof e[t]?"esriFieldTypeString":"esriFieldTypeDouble"})))}const D=e=>e.includes("data:image/svg+xml");function E(e){if(!e)return null;switch(e.type){case"CIMPointSymbol":case"CIMTextSymbol":return"esriGeometryPoint";case"CIMLineSymbol":return"esriGeometryPolyline";case"CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}}function L(e){return e?e.charAt(0).toLowerCase()+e.slice(1):e}function F(e,t,n,r,i,s,o=!0){const{infos:a}=s;let l=1,u=0,c=0,p=0,h=1;for(const{absoluteAnchorPoint:e,offsetX:t,offsetY:n,rotation:r,size:i,frameHeight:s,rotateClockWise:f,scaleSymbolsProportionally:d}of a)h=e?1:l,c=J(t,n,u,h,c),p=W(t,n,u,h,p),s&&(d||o)&&(l*=i/s),u=q(r,f,u);const f=J(r,i,u,h,c),d=W(r,i,u,h,p);return{size:e*l,rotation:q(t,n,u),offsetX:f,offsetY:d}}function O(e){if(null==e)return!1;if(Array.isArray(e))return e.every((e=>O(e)));switch(typeof e){case"string":return!!e;case"number":return!isNaN(e)}}function z(e,t){if("color"===t||"outlinecolor"===t||"backgroundcolor"===t||"borderlinecolor"===t||"tintcolor"===t)return[...r.K[t]];const n=r.D[e];if(!n)throw new Error(`InternalError: default value for type ${e}.`);return n[t]}function j(e){return"string"==typeof e?function(e){return e.split(" ").map((e=>Number(e)))}(e):e}function B(e){return e?.dashTemplate&&(e.dashTemplate=j(e.dashTemplate)),e}function Z(e){if(null==e)return"Normal";switch(e.type){case"CIMTextSymbol":return e.textCase??"Normal";case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const t=e.symbolLayers;if(!t)return"Normal";for(const e of t)if("CIMVectorMarker"===e.type)return Z(e)}break;case"CIMVectorMarker":{const t=e.markerGraphics;if(!t)return"Normal";for(const e of t)if(e.symbol)return Z(e.symbol)}}return"Normal"}function U(e){if(e)switch(e.type){case"CIMTextSymbol":return e.height;case"CIMPointSymbol":{let t=0;if(e.symbolLayers)for(const n of e.symbolLayers)if(n)switch(n.type){case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":{const e=n.size??r.D.CIMVectorMarker.size;e>t&&(t=e);break}}return t}case"CIMLineSymbol":case"CIMPolygonSymbol":{let t=0;if(e.symbolLayers)for(const n of e.symbolLayers)if(n)switch(n.type){case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":{const e=n.width;null!=e&&e>t&&(t=e);break}case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":if(n.markerPlacement&&y(n.markerPlacement)){const e=n.size??r.D.CIMVectorMarker.size;e>t&&(t=e)}break;case"CIMPictureFill":{const e=n.height;null!=e&&e>t&&(t=e)}}return t}}}function V(e,t){if(null!==t){const n=t.get(e);return n?n.name:e}return e}function G(e){return e.map((e=>({...e,propertyName:L(e.propertyName)})))}function H(e){const t={};for(const n in e){const r=e[n];t[L(n)]=r}return t}function W(e,t,n,r,i){const s=n*Math.PI/180;if(s){const n=Math.cos(s);return(Math.sin(s)*e+n*t)*r+i}return t*r+i}function J(e,t,n,r,i){const s=n*Math.PI/180;return s?(Math.cos(s)*e-Math.sin(s)*t)*r+i:e*r+i}function q(e,t,n){return t?n-e:n+e}function $(e,t,n){const r="Color"===n||"TintColor"===n||"ToColor"===n,i="Rotation"===n||"Angle"===n||"ToRotation"===n;let s=t[L(n)];if(null!=s&&(r?s=[s[0]/255,s[1]/255,s[2]/255,s[3]/255]:i&&(s*=Math.PI/180)),null==s&&(s=z(t.type,n.toLowerCase()),null!=s&&(r?s=[s[0]/255,s[1]/255,s[2]/255,s[3]]:i&&(s*=Math.PI/180))),null!=t.primitiveName){const o=e[t.primitiveName];if(null!=o){const e=o[n];null==e||("string"==typeof e||"number"==typeof e||Array.isArray(e)?(s=e,null!=s&&(r?s=[s[0]/255,s[1]/255,s[2]/255,s[3]/255]:i&&(s*=Math.PI/180))):(s={valueExpressionInfo:e,defaultValue:s},null!=s&&(r?s={type:"Process",op:"ArcadeColor",value:s}:i&&(s={type:"Process",op:"Divide",left:s,right:180/Math.PI}))))}}if(null==s)throw new Error(`Failed to derive a value or an expression for "${n}".`);return s}},77927:function(e,t,n){n.d(t,{Fe:function(){return p},Km:function(){return s},Nk:function(){return l}});var r=n(52874),i=n(7590);function s(e,t,n,r){if(e)if("CIMTextSymbol"!==e.type){if(n&&e.effects)for(const n of e.effects)a(n,t);if(e.symbolLayers)for(const n of e.symbolLayers)switch(n.type){case"CIMPictureMarker":case"CIMVectorMarker":o(n,t,r);break;case"CIMPictureStroke":case"CIMSolidStroke":!r?.preserveOutlineWidth&&n.width&&(n.width*=t);break;case"CIMPictureFill":n.height&&(n.height*=t),n.offsetX&&(n.offsetX*=t),n.offsetY&&(n.offsetY*=t);break;case"CIMHatchFill":s(n.lineSymbol,t,!0,{...r,preserveOutlineWidth:!1}),n.offsetX&&(n.offsetX*=t),n.offsetY&&(n.offsetY*=t),n.separation&&(n.separation*=t)}}else null!=e.height&&(e.height*=t)}function o(e,t,n){if(e&&(e.markerPlacement&&function(e,t){switch((0,i.zr)(e)&&e.offset&&(e.offset*=t),e.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(e.customEndingOffset&&(e.customEndingOffset*=t),e.offsetAlongLine&&(e.offsetAlongLine*=t),e.placementTemplate&&e.placementTemplate.length){const n=e.placementTemplate.map((e=>e*t));e.placementTemplate=n}break;case"CIMMarkerPlacementAlongLineVariableSize":if(e.maxRandomOffset&&(e.maxRandomOffset*=t),e.placementTemplate&&e.placementTemplate.length){const n=e.placementTemplate.map((e=>e*t));e.placementTemplate=n}break;case"CIMMarkerPlacementOnLine":e.startPointOffset&&(e.startPointOffset*=t);break;case"CIMMarkerPlacementAtExtremities":e.offsetAlongLine&&(e.offsetAlongLine*=t);break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":e.beginPosition&&(e.beginPosition*=t),e.endPosition&&(e.endPosition*=t);break;case"CIMMarkerPlacementPolygonCenter":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t);break;case"CIMMarkerPlacementInsidePolygon":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t),e.stepX&&(e.stepX*=t),e.stepY&&(e.stepY*=t)}}(e.markerPlacement,t),e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t),e.anchorPoint&&"Absolute"===e.anchorPointUnits&&(e.anchorPoint={x:e.anchorPoint.x*t,y:e.anchorPoint.y*t}),e.size=null!=e.size?e.size*t:0,"CIMVectorMarker"===e.type&&e.markerGraphics))for(const r of e.markerGraphics)e.scaleSymbolsProportionally||s(r.symbol,t,!0,n)}function a(e,t){switch(e.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":e.width&&(e.width*=t);break;case"CIMGeometricEffectBuffer":e.size&&(e.size*=t);break;case"CIMGeometricEffectCut":e.beginCut&&(e.beginCut*=t),e.endCut&&(e.endCut*=t),e.middleCut&&(e.middleCut*=t);break;case"CIMGeometricEffectDashes":if(e.customEndingOffset&&(e.customEndingOffset*=t),e.offsetAlongLine&&(e.offsetAlongLine*=t),e.dashTemplate&&e.dashTemplate.length){const n=e.dashTemplate.map((e=>e*t));e.dashTemplate=n}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":e.length&&(e.length*=t);break;case"CIMGeometricEffectMove":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t);break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":e.offset&&(e.offset*=t);break;case"CIMGeometricEffectRegularPolygon":e.radius&&(e.radius*=t);break;case"CIMGeometricEffectTaperedPolygon":e.fromWidth&&(e.fromWidth*=t),e.length&&(e.length*=t),e.toWidth&&(e.toWidth*=t);break;case"CIMGeometricEffectWave":e.amplitude&&(e.amplitude*=t),e.period&&(e.period*=t)}}function l(e){const t=[];return u((0,i.lW)(e),t),t.length?new r.A((0,i.e6)(t[0])):null}function u(e,t){if(!e)return;let n;n="CIMTextSymbol"===e.type?e.symbol:e;const r="CIMPolygonSymbol"===e.type;if(n?.symbolLayers)for(const e of n.symbolLayers)if(!(e.colorLocked||r&&((0,i.mA)(e)||(0,i.MM)(e)&&e.markerPlacement&&(0,i.zr)(e.markerPlacement))))switch(e.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":e.tintColor&&c(t,e.tintColor);break;case"CIMVectorMarker":e.markerGraphics?.forEach((e=>{u(e.symbol,t)}));break;case"CIMSolidStroke":case"CIMSolidFill":c(t,e.color);break;case"CIMHatchFill":u(e.lineSymbol,t)}}function c(e,t){for(const n of e)if(n.join(".")===t.join("."))return;e.push(t)}function p(e,t,n){t instanceof r.A||(t=new r.A(t));const s=(0,i.lW)(e);s&&h(s,t,n)}function h(e,t,n){if(!e)return;let r;r="CIMTextSymbol"===e.type?e.symbol:e;const s="CIMPolygonSymbol"===r?.type;if(r?.symbolLayers)for(const e of r.symbolLayers){if(e.colorLocked)continue;if(s)if(n){const{layersToColor:t}=n;if(((0,i.mA)(e)||(0,i.MM)(e)&&e.markerPlacement&&(0,i.zr)(e.markerPlacement))&&"fill"===t||(0,i.jn)(e)&&"outline"===t)continue}else if((0,i.mA)(e)||(0,i.MM)(e)&&e.markerPlacement&&(0,i.zr)(e.markerPlacement))continue;const r=t.toArray();switch(e.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":e.tintColor=r;break;case"CIMVectorMarker":e.markerGraphics?.forEach((e=>{h(e.symbol,t,n)}));break;case"CIMSolidStroke":case"CIMSolidFill":e.color=r;break;case"CIMHatchFill":h(e.lineSymbol,t,n)}}}},74661:function(e,t,n){n.d(t,{A7:function(){return u},Cx:function(){return c},Hk:function(){return p},JJ:function(){return m},SF:function(){return h},UK:function(){return l},jM:function(){return f},x3:function(){return d}}),n(58941);var r=n(8740),i=n(22198),s=n(90363),o=n(90972),a=n(6259);const l=s.A.fromJSON(a.Cb),u=i.A.fromJSON(a.yM),c=r.A.fromJSON(a.WR),p=o.A.fromJSON(a.JZ);function h(e){if(null==e)return null;switch(e.type){case"mesh":return null;case"point":case"multipoint":return l;case"polyline":return u;case"polygon":case"extent":return c}return null}const f=s.A.fromJSON(a.nC),d=i.A.fromJSON(a.HW),m=r.A.fromJSON(a.b6)},40990:function(e,t,n){n.d(t,{af:function(){return v},al:function(){return b},dX:function(){return x}});var r=n(52874),i=(n(10748),n(78879)),s=(n(58941),n(13520)),o=n(22762),a=n(56150),l=n(97025),u=n(78018),c=n(15186),p=n(10052),h=n(74661),f=n(6259),d=n(77529);const m=u.A.fromSimpleMarkerSymbol(h.UK),y=a.A.fromSimpleLineSymbol(h.A7),g=c.A.fromSimpleFillSymbol(h.Cx),w=new l.A({symbolLayers:new i.A([new o.A({material:{color:f.fT},edges:new p.A({size:(0,s.PN)(1),color:new r.A(f.JR)})})])}),b=new a.A({symbolLayers:new i.A([new d.A({material:{color:new r.A([0,0,0])},size:(0,s.PN)(1)})])}),v=new c.A({symbolLayers:new i.A([new o.A({outline:{color:new r.A([0,0,0]),size:(0,s.PN)(1)}})])});function x(e){if(null==e)return null;switch(e.type){case"mesh":return w;case"point":case"multipoint":return m;case"polyline":return y;case"polygon":case"extent":return g}return null}},6259:function(e,t,n){n.d(t,{Cb:function(){return s},HW:function(){return c},JR:function(){return i},JZ:function(){return l},WR:function(){return a},b6:function(){return p},fT:function(){return r},nC:function(){return u},yM:function(){return o}});const r=[252,146,31,255],i=[153,153,153,255],s={type:"esriSMS",style:"esriSMSCircle",size:6,color:r,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},o={type:"esriSLS",style:"esriSLSSolid",width:.75,color:r},a={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},l={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},u={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},c={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},p={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null}},31827:function(e,t,n){n.d(t,{$4:function(){return b},O0:function(){return v},O1:function(){return x},Sw:function(){return M},eH:function(){return g},rc:function(){return w}});var r=n(53216),i=n(52874),s=n(93040),o=n(99680),a=n(13520),l=n(77927);const u="picture-fill",c="simple-fill",p="simple-line",h="simple-marker",f="text",d="cim",m=new Map([["dash",[4,3]],["dashdot",[4,3,1,3]],["dot",[1,3]],["longdash",[8,3]],["longdashdot",[8,3,1,3]],["longdashdotdot",[8,3,1,3,1,3]],["shortdash",[4,1]],["shortdashdot",[4,1,1,1]],["shortdashdotdot",[4,1,1,1,1,1]],["shortdot",[1,1]],["solid",[]]]),y=new o.q(1e3);function g(e){const t=e.style;let n=null;if(e)switch(e.type){case h:"cross"!==t&&"x"!==t&&(n=e.color);break;case c:t&&"solid"!==t?"none"!==t&&(n={type:"pattern",x:0,y:0,src:(0,r.s)(`esri/symbols/patterns/${t}.png`),width:5,height:5}):n=e.color;break;case u:n={type:"pattern",src:e.url,width:(0,a.Lz)(e.width)*e.xscale,height:(0,a.Lz)(e.height)*e.yscale,x:(0,a.Lz)(e.xoffset),y:(0,a.Lz)(e.yoffset)};break;case f:n=e.color;break;case d:n=(0,l.Nk)(e)}return n}function w(e,t){const n=e+"-"+t;return void 0!==y.get(n)?Promise.resolve(y.get(n)):(0,s.A)(e,{responseType:"image"}).then((e=>{const r=e.data,i=r.naturalWidth,s=r.naturalHeight,o=document.createElement("canvas");o.width=i,o.height=s;const a=o.getContext("2d");a.fillStyle=t,a.fillRect(0,0,i,s),a.globalCompositeOperation="destination-in",a.drawImage(r,0,0);const l=o.toDataURL();return y.put(n,l),l}))}function b(e){if(!e)return null;let t=null;switch(e.type){case c:case u:case h:t=b(e.outline);break;case p:{const n=(0,a.Lz)(e.width);null!=e.style&&"none"!==e.style&&0!==n&&(t={color:e.color,style:x(e.style),width:n,cap:e.cap,join:"miter"===e.join?(0,a.Lz)(e.miterLimit):e.join},t.dashArray=v(t).join(",")||"none");break}default:t=null}return t}function v(e){if(!e?.style)return[];const{dashArray:t,style:n,width:r}=e;if("string"==typeof t&&"none"!==t)return t.split(",").map((e=>Number(e)));const i=r??0,s=m.has(n)?m.get(n).map((e=>e*i)):[];if("butt"!==e.cap)for(const[e,t]of s.entries())s[e]=e%2==1?t+i:Math.max(t-i,1);return s}const x=(()=>{const e={};return t=>{if(e[t])return e[t];const n=t.replaceAll("-","");return e[t]=n,n}})(),M=new i.A([128,128,128])},8404:function(e,t,n){n.d(t,{M9:function(){return u},oO:function(){return c},rS:function(){return f}});var r=n(10748),i=n(39819),s=n(11432),o=n(97992),a=n(11299),l=n(36e3);function u(e,t,n,r){const i=h(e,{},{context:r,isLabelSymbol:!1});null!=i&&(t[n]=i)}function c(e,t,n,r){const i=h(e,{},{context:r,isLabelSymbol:!0});null!=i&&(t[n]=i)}function p(e){return e instanceof o.A||e instanceof l.A}function h(e,t,n){if(null==e)return null;const{context:r,isLabelSymbol:l}=n,u=r?.origin,c=r?.messages;if("web-scene"===u&&!p(e)){const n=(0,a.t)(e,{retainCIM:!0,hasLabelingContext:l});return null!=n.symbol?n.symbol.write(t,r):(c?.push(new i.A("symbol:unsupported",`Symbols of type '${e.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:e,context:r,error:n.error})),null)}return(0,s.TU)(r?.layer)&&function(e){return e instanceof o.A&&("polygon-3d"===e.type||"line-3d"===e.type)}(e)?(c?.push(new i.A("symbol:unsupported",`Symbols of type '${e.declaredClass}' are not supported on layers of type '${r?.layer?.declaredClass}'.`,{symbol:e,context:r})),null):("web-map"===u||"portal-item"===u&&!(0,s.TU)(r?.layer))&&p(e)?(c?.push(new i.A("symbol:unsupported",`Symbols of type '${e.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:e,context:r})),null):e.write(t,r)}function f(e,t){return(0,r.Bu)(e,null,t)}},58916:function(e,t,n){n.d(t,{jg:function(){return g},cF:function(){return p},bo:function(){return h},yA:function(){return d},o5:function(){return f}});var r=n(93040),i=n(39819),s=n(58941),o=n(60539),a=n(90683),l=n(51432),u=n(26544);const c=new Map;function p(e,t,n){return null!=e?.styleUrl?async function(e,t){try{return{data:(await d(e,t)).data,baseUrl:(0,a.nM)(e),styleUrl:e}}catch(e){return(0,o.QP)(e),null}}(e.styleUrl,n):null!=e?.styleName?function(e,t,n){const r=null!=t.portal?t.portal:l.A.getDefault();let s;const o=`${r.url} - ${r.user?.username} - ${e}`,a=c.get(o);if(a)return a;const p=function(e,t,n){return t.load(n).then((()=>{const r=new u.A({disableExtraQuery:!0,query:`owner:${m} AND type:${y} AND typekeywords:"${e}"`});return t.queryItems(r,n)})).then((({results:t})=>{let r=null;const s=e.toLowerCase();if(t&&Array.isArray(t))for(const e of t){const t=e.typeKeywords?.some((e=>e.toLowerCase()===s));if(t&&e.type===y&&e.owner===m){r=e;break}}if(!r)throw new i.A("symbolstyleutils:style-not-found",`The style '${e}' could not be found`,{styleName:e});return r.load(n)}))}(e,r,n).then((e=>(s=e,e.fetchData()))).then((t=>({data:t,baseUrl:s.itemUrl??"",styleName:e})));return c.set(o,p),p}(e.styleName,t,n):Promise.reject(new i.A("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function h(e){return null===e||"CIMSymbolReference"===e.type?e:{type:"CIMSymbolReference",symbol:e}}function f(e,t,n=["gltf"]){if("cimRef"===t)return encodeURI(e.cimRef);if(e.formatInfos&&!(0,s.A)("enable-feature:force-wosr"))for(const t of n){const n=e.formatInfos.find((e=>e.type===t));if(n)return n.href}return encodeURI(e.webRef)}function d(e,t){const n={responseType:"json",query:{f:"json"},...t};return(0,r.A)((0,a.S8)(e),n)}const m="esri_en",y="Style",g="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json"},11299:function(e,t,n){n.d(t,{c:function(){return w},t:function(){return b}});var r=n(10748),i=n(39819),s=n(40990),o=n(36e3),a=n(78018),l=n(22198),u=n(56150),c=n(90363),p=n(24411),h=n(8740),f=n(97025),d=n(15186),m=n(90972),y=n(56922);const g="#useCIMFallbackSymbology()",w={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function b(e,t=w){if(!e)return{symbol:null};const{retainId:n=w.retainId,ignoreDrivers:b=w.ignoreDrivers,hasLabelingContext:v=w.hasLabelingContext,retainCIM:x=w.retainCIM,cimFallbackEnabled:M=w.cimFallbackEnabled}=t;let A=null;if((0,r.wk)(e)||e instanceof o.A)A=e.clone();else if("cim"===e.type){const n=e.data?.symbol?.type;switch(n){case"CIMPointSymbol":A=x?e.clone():a.A.fromCIMSymbol(e);break;case"CIMLineSymbol":M&&(A=s.al.clone(),t?.logWarning?.(g,"Unsupported CIM line symbology converted to fallback 3D line symbology"));break;case"CIMPolygonSymbol":M&&(A=s.af.clone(),t?.logWarning?.(g,"Unsupported CIM polygon symbology converted to fallback 3D polygon symbology"))}if(!A)return{error:new i.A("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${n||"unknown"}' is unsupported in 3D`,{symbol:e})}}else if(e instanceof l.A)A=u.A.fromSimpleLineSymbol(e);else if(e instanceof c.A)A=a.A.fromSimpleMarkerSymbol(e);else if(e instanceof p.A)A=a.A.fromPictureMarkerSymbol(e);else if(e instanceof h.A)A=t.geometryType&&"mesh"===t.geometryType?f.A.fromSimpleFillSymbol(e):d.A.fromSimpleFillSymbol(e);else{if(!(e instanceof m.A))return{error:new i.A("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${e.type||e.declaredClass}' is unsupported in 3D`,{symbol:e})};A=v?y.A.fromTextSymbol(e):a.A.fromTextSymbol(e)}return n&&A&&"cim"!==A.type&&(A.id=e.id),b&&(0,r.wk)(A)&&A.symbolLayers.forEach((e=>e.ignoreDrivers=!0)),{symbol:A}}},89814:function(e,t,n){n.d(t,{$d:function(){return d},GG:function(){return A},N7:function(){return m},Sx:function(){return y},UQ:function(){return M},di:function(){return I},dt:function(){return w},f3:function(){return S},k_:function(){return f},yG:function(){return _}});var r=n(52874),i=n(10748),s=n(77472),o=(n(58941),n(13520)),a=n(32501),l=n(60318),u=n(77927),c=n(31827),p=n(13109);const h=new r.A("white");function f(e){if(!e)return 0;if((0,i.wk)(e)){const t=function(e){const t=e.symbolLayers?.at(-1);if(t&&"outline"in t)return t?.outline?.size}(e);return null!=t?t:0}return(0,o.PN)((0,c.$4)(e)?.width)}function d(e){if(null==e||!("symbolLayers"in e)||null==e.symbolLayers)return!1;switch(e.type){case"point-3d":return e.symbolLayers.some((e=>"object"===e.type));case"line-3d":return e.symbolLayers.some((e=>"path"===e.type));case"polygon-3d":return e.symbolLayers.some((e=>"object"===e.type||"extrude"===e.type));default:return!1}}function m(e){return e.resource?.href??""}function y(e,t){if(!e)return null;let n=null;return(0,i.wk)(e)?n=function(e){const t=e.symbolLayers;if(!t)return null;let n=null;return t.forEach((e=>{"object"===e.type&&e.resource?.href||(n="water"===e.type?e.color:e.material?e.material.color:null)})),n?new r.A(n):null}(e):(0,i.$y)(e)&&(n="cim"===e.type?(0,u.Nk)(e):e.color?new r.A(e.color):null),n?g(n,t):null}function g(e,t){if(null==t||null==e)return e;const n=e.toRgba();return n[3]=n[3]*t,new r.A(n)}function w(e,t,n){var s,o,a;e&&(t||null!=n)&&(t&&(t=new r.A(t)),(0,i.wk)(e)?function(e,t,n){const r=e.symbolLayers;if(!r)return;const i=e=>g(t=t??e??(null!=n?h:null),n);r.forEach((e=>{if("object"!==e.type||!e.resource?.href||t)if("water"===e.type)e.color=i(e.color);else{const t=null!=e.material?e.material.color:null,r=i(t);null==e.material?e.material=new p.N({color:r}):e.material.color=r,null!=n&&"outline"in e&&null!=e.outline?.color&&(e.outline.color=g(e.outline.color,n))}}))}(e,t,n):(0,i.$y)(e)&&(s=e,a=n,(o=(o=t)??s.color)&&(s.color=g(o,a)),null!=a&&"outline"in s&&s.outline?.color&&(s.outline.color=g(s.outline.color,a))))}function b(e){for(const t of e)if("number"==typeof t)return t;return null}function v(e,t,n){for(let r=0;r<3;r++){const i=e[r];switch(i){case"symbol-value":{const e=n[r];return null!=e?e/t[r]:1}case"proportional":break;default:if(i&&t[r])return i/t[r]}}return 1}function x(e,t,n,r){switch(e){case"proportional":return n*r;case"symbol-value":return null!=t?t:n;default:return e}}async function M(e,t){if(e&&t)return(0,i.wk)(e)?async function(e,t){const r=e.symbolLayers;r&&await(0,s.jJ)(r,(async e=>async function(e,t){switch(e.type){case"extrude":!function(e,t){e.size="number"==typeof t[2]?t[2]:0}(e,t);break;case"icon":case"line":case"text":!function(e,t){const n=b(t);null!=n&&(e.size=n)}(e,t);break;case"path":!function(e,t){const n=v(t,a.Un,[e.width,void 0,e.height]);e.width=x(t[0],e.width,1,n),e.height=x(t[2],e.height,1,n)}(e,t);break;case"object":await async function(e,t){const{resourceSize:r,symbolSize:i}=await async function(e){const{computeObjectLayerResourceSize:t}=await n.e(7269).then(n.bind(n,9141)),r=await t(e,10),{width:i,height:s,depth:o}=e,a=[i,o,s];let l=1;for(let e=0;e<3;e++){const t=a[e];if(null!=t){l=t/r[e];break}}for(let e=0;e<3;e++)null==a[e]&&(a[e]=r[e]*l);return{resourceSize:r,symbolSize:a}}(e),s=v(t,r,i);e.width=x(t[0],i[0],r[0],s),e.depth=x(t[1],i[1],r[1],s),e.height=x(t[2],i[2],r[2],s)}(e,t)}}(e,t)))}(e,t):void((0,i.$y)(e)&&function(e,t){const n=b(t);if(null!=n)switch(e.type){case"simple-marker":e.size=n;break;case"picture-marker":{const t=e.width/e.height;t>1?(e.width=n,e.height=n*t):(e.width=n*t,e.height=n);break}case"simple-line":e.width=n;break;case"text":e.font.size=n}}(e,t))}function A(e,t,n){if(e&&null!=t)if((0,i.wk)(e)){const r=e.symbolLayers;r&&r.forEach((e=>{if("object"===e.type)switch(n){case"tilt":e.tilt=(e.tilt??0)+t;break;case"roll":e.roll=(e.roll??0)+t;break;default:e.heading=(e.heading??0)+t}"icon"===e.type&&(e.angle+=t)}))}else(0,i.$y)(e)&&("simple-marker"!==e.type&&"picture-marker"!==e.type&&"text"!==e.type||(e.angle+=t))}function I(e){if(!e)return null;const t=e.effects.filter((e=>"bloom"!==e.type)).map((e=>e.toJSON()));return(0,l.zu)(t)}function S(e){return null!=e&&"polygon-3d"===e.type&&e.symbolLayers.some((e=>"extrude"===e.type))}async function _(e,t){return await e.fetchSymbol(t)||e.fetchCIMSymbol(t)}},92777:function(e,t,n){n.d(t,{A:function(){return D}});var r=n(53804),i=n(30905),s=n(21609),o=n(23502),a=n(77560),l=n(47332),u=n(65953),c=n(81392);let p=class extends i.oY{constructor(e){super(e),this.description=null,this.label=null,this.type=null}};(0,r._)([(0,o.MZ)({type:String,json:{write:!0}})],p.prototype,"description",void 0),(0,r._)([(0,o.MZ)({type:String,json:{write:!0}})],p.prototype,"label",void 0),(0,r._)([(0,o.MZ)()],p.prototype,"type",void 0),p=(0,r._)([(0,u.$)("esri.tables.elements.AttributeTableElement")],p);const h=p;var f,d=n(67888);n(58941),n(40633),n(13798);let m=f=class extends h{constructor(e){super(e),this.displayType="auto",this.type="attachment"}clone(){return new f({description:this.description,displayType:this.displayType,label:this.label})}};(0,r._)([(0,o.MZ)({type:["auto"],json:{write:!0}})],m.prototype,"displayType",void 0),(0,r._)([(0,o.MZ)({type:["attachment"],readOnly:!0,json:{read:!1,write:!0}})],m.prototype,"type",void 0),m=f=(0,r._)([(0,u.$)("esri.tables.elements.AttributeTableAttachmentElement")],m);const y=m;var g;let w=g=class extends h{constructor(e){super(e),this.fieldName=null,this.type="field"}clone(){return new g({description:this.description,fieldName:this.fieldName,label:this.label})}};(0,r._)([(0,o.MZ)({type:String,json:{write:!0}})],w.prototype,"fieldName",void 0),(0,r._)([(0,o.MZ)({type:String,json:{read:!1,write:!0}})],w.prototype,"type",void 0),w=g=(0,r._)([(0,u.$)("esri.tables.elements.AttributeTableFieldElement")],w);const b=w;var v;let x=v=class extends h{constructor(e){super(e),this.relationshipId=null,this.type="relationship"}clone(){return new v({description:this.description,label:this.label,relationshipId:this.relationshipId})}};(0,r._)([(0,o.MZ)({type:Number,json:{write:!0}})],x.prototype,"relationshipId",void 0),(0,r._)([(0,o.MZ)({type:["relationship"],json:{read:!1,write:!0}})],x.prototype,"type",void 0),x=v=(0,r._)([(0,u.$)("esri.tables.elements.AttributeTableRelationshipElement")],x);const M=x;function A(e){return{typesWithGroup:{base:h,key:"type",typeMap:{attachment:y,field:b,group:e,relationship:M}},typesWithoutGroup:{base:h,key:"type",typeMap:{attachment:y,field:b,relationship:M}}}}function I(e,t,n=!0){if(!e)return null;const r=n?t.typesWithGroup.typeMap:t.typesWithoutGroup.typeMap;return e.filter((e=>r[e.type])).map((e=>r[e.type].fromJSON(e)))}function S(e,t,n=!0){if(!e)return null;const r=n?t.typesWithGroup.typeMap:t.typesWithoutGroup.typeMap;return e.filter((e=>r[e.type])).map((e=>e.toJSON()))}function _(e,t,n=!0){return e?e.map((e=>(0,d.aq)(n?t.typesWithGroup:t.typesWithoutGroup,e))):null}var C;let T=C=class extends h{constructor(e){super(e),this.elements=null,this.type="group"}castElements(e){return _(e,k,!1)}readElements(e,t){return I(t.attributeTableElements,k,!1)}writeElements(e,t){t.attributeTableElements=S(e,k,!1)}clone(){return new C({description:this.description,elements:(0,s.o8)(this.elements),label:this.label})}};(0,r._)([(0,o.MZ)({json:{write:!0}})],T.prototype,"elements",void 0),(0,r._)([(0,a.w)("elements")],T.prototype,"castElements",null),(0,r._)([(0,l.w)("elements",["attributeTableElements"])],T.prototype,"readElements",null),(0,r._)([(0,c.K)("elements")],T.prototype,"writeElements",null),(0,r._)([(0,o.MZ)({type:String,json:{read:!1,write:!0}})],T.prototype,"type",void 0),T=C=(0,r._)([(0,u.$)("esri.tables.elements.AttributeTableGroupElement")],T);const k=A(T);var R;const P=A(T);let N=R=class extends i.oY{constructor(e){super(e),this.elements=null,this.orderByFields=null}castElements(e){return _(e,P)}readElements(e,t){return I(t.attributeTableElements,P)}writeElements(e,t){t.attributeTableElements=S(e,P)}clone(){return new R({elements:(0,s.o8)(this.elements),orderByFields:this.orderByFields})}};(0,r._)([(0,o.MZ)({json:{write:!0}})],N.prototype,"elements",void 0),(0,r._)([(0,a.w)("elements")],N.prototype,"castElements",null),(0,r._)([(0,l.w)("elements",["attributeTableElements"])],N.prototype,"readElements",null),(0,r._)([(0,c.K)("elements")],N.prototype,"writeElements",null),(0,r._)([(0,o.MZ)({type:[Object],json:{write:!0}})],N.prototype,"orderByFields",void 0),N=R=(0,r._)([(0,u.$)("esri.tables.AttributeTableTemplate")],N);const D=N},92427:function(e,t,n){n.d(t,{A:function(){return h}});var r=n(53804),i=n(75743),s=n(30905),o=n(45139),a=n(23502),l=(n(58941),n(40633),n(13798),n(74376)),u=n(65953),c=n(35060);let p=class extends((0,i.O)(s.oY)){constructor(e){super(e),this.unit="milliseconds",this.value=0}toMilliseconds(){return(0,o.t)(this.value,this.unit,"milliseconds")}};(0,r._)([(0,l.e)(c.j,{nonNullable:!0})],p.prototype,"unit",void 0),(0,r._)([(0,a.MZ)({type:Number,json:{write:!0},nonNullable:!0})],p.prototype,"value",void 0),p=(0,r._)([(0,u.$)("esri.time.TimeInterval")],p);const h=p},20106:function(e,t,n){n.d(t,{CW:function(){return h},pH:function(){return y}}),n(50917);var r=n(58941),i=n(40633),s=n(15774),o=n(60539),a=n(13798),l=n(57652),u=n(91484);const c=()=>i.A.getLogger("esri.views.2d.engine.flow.dataUtils"),p=10;async function h(e,t,n,i){const s=performance.now(),l=function(e,t){const n=function(e,t,n,r){if(0===r)return e;const i=Math.round(3*r),s=new Array(2*i+1);let o=0;for(let e=-i;e<=i;e++){const t=Math.exp(-e*e/(r*r));s[e+i]=t,o+=t}for(let e=-i;e<=i;e++)s[e+i]/=o;const a=new Float32Array(e.length);for(let r=0;r<n;r++)for(let n=0;n<t;n++){let o=0,l=0;for(let a=-i;a<=i;a++){if(n+a<0||n+a>=t)continue;const u=s[a+i];o+=u*e[2*(r*t+(n+a))],l+=u*e[2*(r*t+(n+a))+1]}a[2*(r*t+n)]=o,a[2*(r*t+n)+1]=l}const l=new Float32Array(e.length);for(let e=0;e<t;e++)for(let r=0;r<n;r++){let o=0,u=0;for(let l=-i;l<=i;l++){if(r+l<0||r+l>=n)continue;const c=s[l+i];o+=c*a[2*((r+l)*t+e)],u+=c*a[2*((r+l)*t+e)+1]}l[2*(r*t+e)]=o,l[2*(r*t+e)+1]=u}return l}(t.data,t.width,t.height,e.smoothing);return e.interpolate?(e,r)=>{const i=Math.floor(e),s=Math.floor(r);if(i<0||i>=t.width)return[0,0];if(s<0||s>=t.height)return[0,0];const o=e-i,a=r-s,l=i,u=s,c=i<t.width-1?i+1:i,p=s<t.height-1?s+1:s,h=n[2*(u*t.width+l)],f=n[2*(u*t.width+c)],d=n[2*(p*t.width+l)],m=n[2*(p*t.width+c)],y=n[2*(u*t.width+l)+1],g=n[2*(u*t.width+c)+1];return[(h*(1-a)+d*a)*(1-o)+(f*(1-a)+m*a)*o,(y*(1-a)+n[2*(p*t.width+l)+1]*a)*(1-o)+(g*(1-a)+n[2*(p*t.width+c)+1]*a)*o]}:(e,r)=>{const i=Math.round(e),s=Math.round(r);return i<0||i>=t.width||s<0||s>=t.height?[0,0]:[n[2*(s*t.width+i)],n[2*(s*t.width+i)+1]]}}(t,n),u=performance.now(),h=d(t,l,n.width,n.height),f=performance.now(),m=function(e){const t=new a.A,n=e.reduce(((e,t)=>e+t.length),0),r=new Float32Array(4*n),i=new Array(e.length);let s=0,o=0;for(const n of e){const e=s;for(const e of n)r[4*s]=e.x,r[4*s+1]=e.y,r[4*s+2]=e.t,r[4*s+3]=e.speed,s++;i[o++]={startVertex:e,numberOfVertices:n.length,totalTime:n[n.length-1].t,timeSeed:t.getFloat()}}return{lineVertices:r,lineDescriptors:i}}(h),y=performance.now(),g="Streamlines"===e?function(e,t){const{lineVertices:n,lineDescriptors:r}=e;let i=0,s=0;for(const e of r)i+=2*e.numberOfVertices,s+=6*(e.numberOfVertices-1);const o=new Float32Array(9*i),a=new Uint32Array(s);let l=0,u=0;function c(){a[u++]=l-2,a[u++]=l,a[u++]=l-1,a[u++]=l,a[u++]=l+1,a[u++]=l-1}function p(e,t,n,r,i,s,a,u){const c=9*l;let p=0;o[c+p++]=e,o[c+p++]=t,o[c+p++]=1,o[c+p++]=n,o[c+p++]=s,o[c+p++]=a,o[c+p++]=r/2,o[c+p++]=i/2,o[c+p++]=u,l++,o[c+p++]=e,o[c+p++]=t,o[c+p++]=-1,o[c+p++]=n,o[c+p++]=s,o[c+p++]=a,o[c+p++]=-r/2,o[c+p++]=-i/2,o[c+p++]=u,l++}for(const e of r){const{totalTime:r,timeSeed:i}=e;let s=null,o=null,a=null,l=null,u=null,h=null;for(let f=0;f<e.numberOfVertices;f++){const d=n[4*(e.startVertex+f)],m=n[4*(e.startVertex+f)+1],y=n[4*(e.startVertex+f)+2],g=n[4*(e.startVertex+f)+3];let w=null,b=null,v=null,x=null;if(f>0){w=d-s,b=m-o;const e=Math.sqrt(w*w+b*b);if(w/=e,b/=e,f>1){let e=w+u,n=b+h;const r=Math.sqrt(e*e+n*n);e/=r,n/=r;const i=Math.min(1/(e*w+n*b),t);e*=i,n*=i,v=-n,x=e}else v=-b,x=w;null!==v&&null!==x&&(p(s,o,a,v,x,r,i,g),c())}s=d,o=m,a=y,u=w,h=b,l=g}p(s,o,a,-h,u,r,i,l)}return{vertexData:o,indexData:a}}(m,p):function(e){const{lineVertices:t,lineDescriptors:n}=e;let r=0,i=0;for(const e of n){const t=e.numberOfVertices-1;r+=4*t*2,i+=6*t*2}const s=new Float32Array(16*r),o=new Uint32Array(i);let a,l,u,c,p,h,f,d,m,y,g,w,b,v,x=0,M=0;function A(){o[M++]=x-8,o[M++]=x-7,o[M++]=x-6,o[M++]=x-7,o[M++]=x-5,o[M++]=x-6,o[M++]=x-4,o[M++]=x-3,o[M++]=x-2,o[M++]=x-3,o[M++]=x-1,o[M++]=x-2}function I(e,t,n,r,i,o,a,l,u,c,p,h,f,d){const m=16*x;let y=0;for(const g of[1,2])for(const w of[1,2,3,4])s[m+y++]=e,s[m+y++]=t,s[m+y++]=n,s[m+y++]=r,s[m+y++]=a,s[m+y++]=l,s[m+y++]=u,s[m+y++]=c,s[m+y++]=g,s[m+y++]=w,s[m+y++]=f,s[m+y++]=d,s[m+y++]=i/2,s[m+y++]=o/2,s[m+y++]=p/2,s[m+y++]=h/2,x++}function S(e,t){let n=m+g,r=y+w;const i=Math.sqrt(n*n+r*r);n/=i,r/=i;const s=m*n+y*r;n/=s,r/=s;let o=g+b,x=w+v;const M=Math.sqrt(o*o+x*x);o/=M,x/=M;const S=g*o+w*x;o/=S,x/=S,I(a,l,u,c,-r,n,p,h,f,d,-x,o,e,t),A()}function _(e,t,n,r,i,s){if(m=g,y=w,g=b,w=v,null==m&&null==y&&(m=g,y=w),null!=p&&null!=h){b=e-p,v=t-h;const n=Math.sqrt(b*b+v*v);b/=n,v/=n}null!=m&&null!=y&&S(i,s),a=p,l=h,u=f,c=d,p=e,h=t,f=n,d=r}function C(e,t){m=g,y=w,g=b,w=v,null==m&&null==y&&(m=g,y=w),null!=m&&null!=y&&S(e,t)}for(const e of n){a=null,l=null,u=null,c=null,p=null,h=null,f=null,d=null,m=null,y=null,g=null,w=null,b=null,v=null;const{totalTime:n,timeSeed:r}=e;for(let i=0;i<e.numberOfVertices;i++)_(t[4*(e.startVertex+i)],t[4*(e.startVertex+i)+1],t[4*(e.startVertex+i)+2],t[4*(e.startVertex+i)+3],n,r);C(n,r)}return{vertexData:s,indexData:o}}(m),w=performance.now();return(0,r.A)("esri-2d-profiler")&&(c().info("I.1","_createFlowFieldFromData (ms)",Math.round(u-s)),c().info("I.2","_getStreamlines (ms)",Math.round(f-u)),c().info("I.3","createAnimatedLinesData (ms)",Math.round(y-f)),c().info("I.4","create{Streamlines|Particles}Mesh (ms)",Math.round(w-y)),c().info("I.5","createFlowMesh (ms)",Math.round(w-s)),c().info("I.6","Mesh size (bytes)",g.vertexData.buffer.byteLength+g.indexData.buffer.byteLength)),await Promise.resolve(),(0,o.Te)(i),g}function f(e,t,n,r,i,s,o,a,l){const u=[];let c=n,p=r,h=0,[f,d]=t(c,p);f*=e.velocityScale,d*=e.velocityScale;const m=Math.sqrt(f*f+d*d);let y,g;u.push({x:c,y:p,t:h,speed:m});for(let n=0;n<e.verticesPerLine;n++){let[n,r]=t(c,p);n*=e.velocityScale,r*=e.velocityScale;const f=Math.sqrt(n*n+r*r);if(f<e.minSpeedThreshold)return u;const d=n/f,m=r/f;if(c+=d*e.segmentLength,p+=m*e.segmentLength,h+=e.segmentLength/f,Math.acos(d*y+m*g)>e.maxTurnAngle)return u;if(e.collisions){const e=Math.round(c*l),t=Math.round(p*l);if(e<0||e>o-1||t<0||t>a-1)return u;const n=s[t*o+e];if(-1!==n&&n!==i)return u;s[t*o+e]=i}u.push({x:c,y:p,t:h,speed:f}),y=d,g=m}return u}function d(e,t,n,r){const i=[],s=new a.A,o=1/Math.max(e.lineCollisionWidth,1),l=Math.round(n*o),u=Math.round(r*o),c=new Int32Array(l*u);for(let e=0;e<c.length;e++)c[e]=-1;const p=[];for(let t=0;t<r;t+=e.lineSpacing)for(let r=0;r<n;r+=e.lineSpacing)p.push({x:r,y:t,sort:s.getFloat()});p.sort(((e,t)=>e.sort-t.sort));for(const{x:n,y:r}of p)if(s.getFloat()<e.density){const s=f(e,t,n,r,i.length,c,l,u,o);if(s.length<2)continue;i.push(s)}return i}function m(e,t){const n=t.pixels,{width:r,height:i}=t,o=new Float32Array(r*i*2),a=t.mask||new Uint8Array(r*i*2);if(t.mask||a.fill(255),"vector-uv"===e)for(let e=0;e<r*i;e++)o[2*e]=n[0][e],o[2*e+1]=-n[1][e];else if("vector-magdir"===e)for(let e=0;e<r*i;e++){const t=n[0][e],r=(0,s.kU)(n[1][e]),i=Math.cos(r-Math.PI/2),a=Math.sin(r-Math.PI/2);o[2*e]=i*t,o[2*e+1]=a*t}return{data:o,mask:a,width:r,height:i}}async function y(e,t,n,i,s,o){const a=performance.now(),p=(0,l.Vp)(t.spatialReference);if(!p){const l=await g(e,t,n,i,s,o);return(0,r.A)("esri-2d-profiler")&&c().info("I.7","loadImagery, early exit (ms)",Math.round(performance.now()-a)),(0,r.A)("esri-2d-profiler")&&c().info("I.9","Number of parts",1),l}const[h,f]=p.valid,d=f-h,m=Math.ceil(t.width/d),y=t.width/m,w=Math.round(n/m);let b=t.xmin;const v=[],x=performance.now();for(let n=0;n<m;n++){const n=new u.default({xmin:b,xmax:b+y,ymin:t.ymin,ymax:t.ymax,spatialReference:t.spatialReference});v.push(g(e,n,w,i,s,o)),b+=y}const M=await Promise.all(v);(0,r.A)("esri-2d-profiler")&&c().info("I.8","All calls to _fetchPart (ms)",Math.round(performance.now()-x)),(0,r.A)("esri-2d-profiler")&&c().info("I.9","Number of parts",M.length);const A={data:new Float32Array(n*i*2),mask:new Uint8Array(n*i),width:n,height:i};let I=0;for(const e of M){for(let t=0;t<e.height;t++)for(let r=0;r<e.width;r++)I+r>=n||(A.data[2*(t*n+I+r)]=e.data[2*(t*e.width+r)],A.data[2*(t*n+I+r)+1]=e.data[2*(t*e.width+r)+1],A.mask[t*n+I+r]=e.mask[t*e.width+r]);I+=e.width}return(0,r.A)("esri-2d-profiler")&&c().info("I.10","loadImagery, general exit (ms)",Math.round(performance.now()-a)),A}async function g(e,t,n,r,i,s){const o={requestProjectedLocalDirections:!0,signal:s};if(null!=i&&(o.timeExtent=i),"imagery"===e.type){await e.load({signal:s});const i=e.rasterInfo.dataType,a=await e.fetchImage(t,n,r,o);return null==a?.pixelData?.pixelBlock?{data:new Float32Array(n*r*2),mask:new Uint8Array(n*r),width:n,height:r}:m(i,a.pixelData.pixelBlock)}await e.load({signal:s});const a=e.serviceRasterInfo.dataType,l=await e.fetchPixels(t,n,r,o);return null==l?.pixelBlock?{data:new Float32Array(n*r*2),mask:new Uint8Array(n*r),width:n,height:r}:m(a,l.pixelBlock)}},46863:function(e,t,n){n.d(t,{e:function(){return c}}),n(58941);var r=n(95929),i=n(60539),s=n(51846),o=n(62790),a=n(74087),l=n(85445);class u{constructor(e,t){this.item=e,this.controller=t,this.promise=null}}class c{constructor(e){this._schedule=null,this._task=null,this._deferreds=new o.A,this._controllers=new o.A,this._processingItems=new o.A,this._pausedSignal=(0,l.v)(!1),this.concurrency=1,e.concurrency&&(this.concurrency=e.concurrency),this._queue=new s.A(e.peeker),this.process=e.process;const t=e.scheduler;e.priority&&t&&(this._task=t.registerTask(e.priority,this))}destroy(){this.clear(),this._schedule=(0,r.xt)(this._schedule),this._task=(0,r.xt)(this._task)}get updating(){return!!this._task?.updating||this.running}get length(){return this._processingItems.size+this._queue.length}abort(e){const t=this._controllers.get(e);t&&t.abort()}clear(){this._queue.clear();const e=[];this._controllers.forEach((t=>e.push(t))),this._controllers.clear(),e.forEach((e=>e.abort())),this._processingItems.clear(),this._cancelNext()}forEach(e){this._deferreds.forEach(((t,n)=>e(n)))}get(e){const t=this._deferreds.get(e);return t?t.promise:void 0}isOngoing(e){return this._processingItems.has(e)}has(e){return this._deferreds.has(e)}pause(){this._pausedSignal.value||(this._pausedSignal.value=!0,this._cancelNext())}push(e,t){const n=this.get(e);if(n)return n;const r=new AbortController;let s=null;t&&(s=(0,i.u7)(t,(()=>r.abort())));const o=()=>{a.remove(),null!=s&&s.remove(),this._removeItem(e),this._queue.remove(e),this._scheduleNext()},a=(0,i.NY)(r.signal,(()=>{const t=this._processingItems.get(e);t&&t.controller.abort(),o(),l.reject((0,i.NK)())})),l=(0,i.Tw)();return this._deferreds.set(e,l),this._controllers.set(e,r),l.promise.then(o,o),this._queue.push(e),this._scheduleNext(),l.promise}last(){return this._queue.last()}lastPromise(){const e=this.last();return e?this.get(e):null}peek(){return this._queue.peek()}popLast(){const e=this._queue.popLast();return e&&(this._deferreds.get(e)?.reject((0,i.NK)()),this._removeItem(e)),e}reset(){const e=Array.from(this._processingItems.values());this._processingItems.clear();for(const t of e)this._queue.push(t.item),t.controller.abort();this._scheduleNext()}resume(){this._pausedSignal.value&&(this._pausedSignal.value=!1,this._scheduleNext())}takeAll(){const e=[];for(;this._queue.length;)e.push(this._queue.pop());return this.clear(),e}get running(){return!this._pausedSignal.value&&this._queue.length>0&&this._processingItems.size<this.concurrency}runTask(e){for(;!e.done&&this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop()),e.madeProgress()}_removeItem(e){this._deferreds.delete(e),this._controllers.delete(e),this._processingItems.delete(e)}_scheduleNext(){this._task||this._pausedSignal.value||this._schedule||(this._schedule=(0,a._)((()=>{this._schedule=null,this._next()})))}_next(){for(;this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())}_cancelNext(){this._schedule&&(this._schedule.remove(),this._schedule=null)}_processResult(e,t){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).resolve(t))}_processError(e,t){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).reject(t))}_canProcessFulfillment(e){return!!this._deferreds.get(e.item)&&this._processingItems.get(e.item)===e}_process(e){if(null==e)return;let t;const n=new AbortController,r=new u(e,n);this._processingItems.set(e,r);try{t=this.process(e,n.signal)}catch(e){this._processError(r,e)}(0,i.$X)(t)?(r.promise=t,t.then((e=>this._processResult(r,e)),(e=>this._processError(r,e)))):this._processResult(r,t)}get test(){}}},91448:function(e,t,n){var r;n.d(t,{X:function(){return r}}),function(e){e[e.SAVE=0]="SAVE",e[e.SAVE_AS=1]="SAVE_AS"}(r||(r={}))}}]);
//# sourceMappingURL=ImageryTileLayer.js.map