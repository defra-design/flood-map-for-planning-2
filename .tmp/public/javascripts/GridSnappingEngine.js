"use strict";(self.webpackChunkdefra=self.webpackChunkdefra||[]).push([[8369],{65298:function(e,t,n){n.d(t,{O7:function(){return b},Hr:function(){return P},el:function(){return A},mT:function(){return X},XX:function(){return S}});var r=n(25591),i=n(39819),o=n(40633),s=n(44740),u=n(91508),c=n(65417),l=n(57652),a=n(1644),f=(n(50917),n(93040)),p=n(74697),h=n(39397),d=n(90683),g=n(26765);const y=()=>o.A.getLogger("esri.geometry.support.normalizeUtils");function m(e){return"polygon"===e[0].type}function M(e){return"polyline"===e[0].type}function x(e){const t=[];let n=0,r=0;for(let i=0;i<e.length;i++){const o=e[i];let s=null;for(let e=0;e<o.length;e++)s=o[e],t.push(s),0===e?(n=s[0],r=n):(n=Math.min(n,s[0]),r=Math.max(r,s[0]));s&&t.push([(n+r)/2,0])}return t}function S(e,t){if(!(e instanceof u.A||e instanceof s.A)){const e="straightLineDensify: the input geometry is neither polyline nor polygon";throw y().error(e),new i.A(e)}const n=(0,c.r8)(e),r=[];for(const e of n){const n=[];r.push(n),n.push([e[0][0],e[0][1]]);for(let r=0;r<e.length-1;r++){const i=e[r][0],o=e[r][1],s=e[r+1][0],u=e[r+1][1],c=Math.sqrt((s-i)*(s-i)+(u-o)*(u-o)),l=(u-o)/c,a=(s-i)/c,f=c/t;if(f>1){for(let e=1;e<=f-1;e++){const r=e*t,s=a*r+i,u=l*r+o;n.push([s,u])}const e=(c+Math.floor(f-1)*t)/2,r=a*e+i,s=l*e+o;n.push([r,s])}n.push([s,u])}}return function(e){return"polygon"===e.type}(e)?new s.A({rings:r,spatialReference:e.spatialReference}):new u.A({paths:r,spatialReference:e.spatialReference})}function w(e,t,n){if(t){const t=S(e,1e6);e=(0,a.ci)(t,!0)}return n&&(e=(0,c.kS)(e,n)),e}function v(e,t,n){if(Array.isArray(e)){const r=e[0];if(r>t){const n=(0,c.kd)(r,t);e[0]=r+n*(-2*t)}else if(r<n){const t=(0,c.kd)(r,n);e[0]=r+t*(-2*n)}}else{const r=e.x;if(r>t){const n=(0,c.kd)(r,t);e=e.clone().offset(n*(-2*t),0)}else if(r<n){const t=(0,c.kd)(r,n);e=e.clone().offset(t*(-2*n),0)}}return e}function R(e,t){let n=-1;for(let r=0;r<t.cutIndexes.length;r++){const i=t.cutIndexes[r],o=t.geometries[r],s=(0,c.r8)(o);for(let e=0;e<s.length;e++){const t=s[e];t.some((n=>{if(n[0]<180)return!0;{let n=0;for(let e=0;e<t.length;e++){const r=t[e][0];n=r>n?r:n}n=Number(n.toFixed(9));const r=-360*(0,c.kd)(n,180);for(let n=0;n<t.length;n++){const t=o.getPoint(e,n);o.setPoint(e,n,t.clone().offset(r,0))}return!0}}))}if(i===n){if(m(e))for(const t of(0,c.r8)(o))e[i]=e[i].addRing(t);else if(M(e))for(const t of(0,c.r8)(o))e[i]=e[i].addPath(t)}else n=i,e[i]=o}return e}async function A(e,t,n){if(!Array.isArray(e))return A([e],t);t&&"string"!=typeof t&&y().warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");const i="string"==typeof t?t:t?.url??r.default.geometryServiceUrl;let o,m,M,x,S,P,b,X,k=0;const G=[],_=[];for(const t of e)if(null!=t)if(o||(o=t.spatialReference,m=(0,l.Vp)(o),M=o.isWebMercator,P=M?102100:4326,x=c.j7[P].maxX,S=c.j7[P].minX,b=c.j7[P].plus180Line,X=c.j7[P].minus180Line),m)if("mesh"===t.type)_.push(t);else if("point"===t.type)_.push(v(t.clone(),x,S));else if("multipoint"===t.type){const e=t.clone();e.points=e.points.map((e=>v(e,x,S))),_.push(e)}else if("extent"===t.type){const e=t.clone()._normalize(!1,!1,m);_.push(e.rings?new s.A(e):e)}else if(t.extent){const e=t.extent,n=(0,c.kd)(e.xmin,S)*(2*x);let r=0===n?t.clone():(0,c.kS)(t.clone(),n);e.offset(n,0);let{xmin:i,xmax:o}=e;i=Number(i.toFixed(9)),o=Number(o.toFixed(9)),e.intersects(b)&&o!==x?(k=o>k?o:k,r=w(r,M),G.push(r),_.push("cut")):e.intersects(X)&&i!==S?(k=o*(2*x)>k?o*(2*x):k,r=w(r,M,360),G.push(r),_.push("cut")):_.push(r)}else _.push(t.clone());else _.push(t);else _.push(t);let j=(0,c.kd)(k,x),O=-90;const L=j,C=new u.A;for(;j>0;){const e=360*j-180;C.addPath([[e,O],[e,-1*O]]),O*=-1,j--}if(G.length>0&&L>0){const t=R(G,await async function(e,t,n,r){const i=(0,h.Dl)(e),o=t[0].spatialReference,s={...r,responseType:"json",query:{...i.query,f:"json",sr:(0,l.YX)(o),target:JSON.stringify({geometryType:(0,p.$B)(t[0]),geometries:t}),cutter:JSON.stringify(n)}},u=await(0,f.A)(i.path+"/cut",s),{cutIndexes:c,geometries:a=[]}=u.data;return{cutIndexes:c,geometries:a.map((e=>{const t=(0,p.rS)(e);return t.spatialReference=o,t}))}}(i,G,C,n)),r=[],o=[];for(let n=0;n<_.length;n++){const i=_[n];if("cut"!==i)o.push(i);else{const i=t.shift(),s=e[n];null!=s&&"polygon"===s.type&&s.rings&&s.rings.length>1&&i.rings.length>=s.rings.length?(r.push(i),o.push("simplify")):o.push(M?(0,a.Gh)(i):i)}}if(!r.length)return o;const s=await async function(e,t,n){const r="string"==typeof e?(0,d.An)(e):e,i=t[0].spatialReference,o=(0,p.$B)(t[0]),s={...n,query:{...r.query,f:"json",sr:(0,l.YX)(i),geometries:JSON.stringify((0,g.X)(t))}},{data:u}=await(0,f.A)(r.path+"/simplify",s);return(0,g.V)(u.geometries,o,i)}(i,r,n),u=[];for(let e=0;e<o.length;e++){const t=o[e];"simplify"!==t?u.push(t):u.push(M?(0,a.Gh)(s.shift()):s.shift())}return u}const N=[];for(let e=0;e<_.length;e++){const t=_[e];if("cut"!==t)N.push(t);else{const e=G.shift();N.push(!0===M?(0,a.Gh)(e):e)}}return N}function P(e){if(!e)return null;const t=e.extent;if(!t)return null;const n=e.spatialReference&&(0,l.Vp)(e.spatialReference);if(!n)return t;const[r,i]=n.valid,o=2*i,{width:s}=t;let u,{xmin:c,xmax:a}=t;if([c,a]=[a,c],"extent"===e.type||0===s||s<=i||s>o||c<r||a>i)return t;switch(e.type){case"polygon":if(!(e.rings.length>1))return t;u=x(e.rings);break;case"polyline":if(!(e.paths.length>1))return t;u=x(e.paths);break;case"multipoint":u=e.points}const f=t.clone();for(let e=0;e<u.length;e++){let t=u[e][0];t<0?(t+=i,a=Math.max(t,a)):(t-=i,c=Math.min(t,c))}return f.xmin=c,f.xmax=a,f.width<s?(f.xmin-=i,f.xmax-=i,f):t}function b(e,t,n){const r=(0,l.Vp)(n);if(null==r)return e;const[i,o]=r.valid,s=2*o;let u=0,c=0;t>o?u=Math.ceil(Math.abs(t-o)/s):t<i&&(u=-Math.ceil(Math.abs(t-i)/s)),e>o?c=Math.ceil(Math.abs(e-o)/s):e<i&&(c=-Math.ceil(Math.abs(e-i)/s));let a=e+(u-c)*s;const f=a-t;return f>o?a-=s:f<i&&(a+=s),a}function X(e,t){const n=(0,l.Vp)(t);if(n){const[t,r]=n.valid,i=r-t;if(e<t)for(;e<t;)e+=i;if(e>r)for(;e>r;)e-=i}return e}},65417:function(e,t,n){n.d(t,{j7:function(){return s},kS:function(){return c},kd:function(){return u},r8:function(){return l}});var r=n(91508),i=n(57165),o=n(74697);const s={102100:{maxX:20037508.342788905,minX:-20037508.342788905,plus180Line:new r.A({paths:[[[20037508.342788905,-20037508.342788905],[20037508.342788905,20037508.342788905]]],spatialReference:i.A.WebMercator}),minus180Line:new r.A({paths:[[[-20037508.342788905,-20037508.342788905],[-20037508.342788905,20037508.342788905]]],spatialReference:i.A.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new r.A({paths:[[[180,-180],[180,180]]],spatialReference:i.A.WGS84}),minus180Line:new r.A({paths:[[[-180,-180],[-180,180]]],spatialReference:i.A.WGS84})}};function u(e,t){return Math.ceil((e-t)/(2*t))}function c(e,t){const n=l(e);for(const e of n)for(const n of e)n[0]+=t;return e}function l(e){return(0,o.Bi)(e)?e.rings:e.paths}},7415:function(e,t,n){n.d(t,{X_:function(){return s},i1:function(){return u},zx:function(){return c}});var r=n(15774),i=n(62938);const o=96;function s(e,t){const n=t||e.extent,r=e.width,s=(0,i.GA)(n?.spatialReference);return n&&r?n.width/r*s*i.dy*o:0}function u(e,t){return e/((0,i.GA)(t)*i.dy*o)}function c(e,t,n){return function(e,t){return 0===t||(0,r.Sp)(e,t)||e<t}(e,t)&&function(e,t){return 0===t||(0,r.Sp)(e,t)||e>t}(e,n)}},26765:function(e,t,n){n.d(t,{V:function(){return o},X:function(){return i}});var r=n(74697);function i(e){return{geometryType:(0,r.$B)(e[0]),geometries:e.map((e=>e.toJSON()))}}function o(e,t,n){const i=(0,r.xD)(t);return e.map((e=>{const t=i.fromJSON(e);return t.spatialReference=n,t}))}},39397:function(e,t,n){n.d(t,{Dl:function(){return s},jV:function(){return o},lF:function(){return u}}),n(25591),n(7156);var r=n(21609),i=n(90683);function o(e,t){return t?{...t,query:{...e??{},...t.query}}:{query:e}}function s(e){return"string"==typeof e?(0,i.An)(e):(0,r.o8)(e)}function u(e,t,n){const r={};for(const i in e){if("declaredClass"===i)continue;const o=e[i];if(null!=o&&"function"!=typeof o)if(Array.isArray(o))r[i]=o.map((e=>u(e)));else if("object"==typeof o)if(o.toJSON){const e=o.toJSON(n?.[i]);r[i]=t?e:JSON.stringify(e)}else r[i]=t?o:JSON.stringify(o);else r[i]=o}return r}n(48893)},3101:function(e,t,n){n.d(t,{X:function(){return r},b:function(){return i}});const r=50,i=5},11765:function(e,t,n){n.d(t,{Ge:function(){return p},WT:function(){return h}}),n(50917);var r=n(62938),i=n(57862),o=n(65298),s=n(57652),u=n(1644),c=n(3101),l=n(57165),a=n(45532),f=n(91508);function p(e,t,n){const r=1===e?10:e;return r**(n?Math.round(function(e,t){return Math.log(e)/Math.log(t)}(c.X/t,r)):0)}function h(e,t,n){const c="number"==typeof e?null:e,p=n??c?.spatialReference;if(null==p||!(0,s.fn)(p)||function(e){const{isGeographic:t,isWebMercator:n}=e;return!t&&!n}(p))return(0,r.GA)(p);let h=c?.x??e,d=c?.y??t;const g=1/Math.sqrt(2);let y=h+g,m=d+g;const{isWebMercator:M,isGeographic:x}=p;let S=x&&!(0,i.TT)(p)?l.A.WGS84:p;if(M){let e=new a.default({x:h,y:d,spatialReference:p});(0,u.ci)(e,!0,e),h=e.x,d=e.y,e=new a.default({x:y,y:m,spatialReference:p}),(0,u.ci)(e,!0,e),y=e.x,m=e.y,S=l.A.WGS84}const w=new f.A({paths:[[[h,d],[y,m]]],spatialReference:S}),v=(0,o.XX)(w,10);let R;try{[R]=(0,i.l1)([v],"meters")}catch{return(0,r.GA)(p)}return R}},93580:function(e,t,n){n.d(t,{GridSnappingEngine:function(){return S}});var r=n(53804),i=n(83525),o=n(40633),s=n(15774),u=n(62938),c=n(23502),l=(n(58941),n(13798),n(65953)),a=n(20551),f=n(46157),p=n(65298),h=n(7415),d=n(3101),g=n(11765),y=n(28397),m=n(44425),M=n(16433),x=n(60100);let S=class extends i.A{constructor(e){super(e),this.options=null}destroy(){this._set("options",null)}get grid(){return this.view.grid}get effectiveViewRotation(){return this.grid?.rotateWithMap?0:(0,s.kU)(this.view.rotation??0)}get gridRotation(){return(0,s.kU)(this.grid?.rotation??0)}get gridCenter(){const{spatialReference:e,grid:t}=this;if(!t||!e||!(0,f.isLoadedOrLoadFor)(t.center.spatialReference,e))return null;try{const n=(0,f.project)(t.center,e),r=e.isWrappable&&null!=this.view?.center?(0,p.O7)(n.x,this.view.center.x,e):n.x;return(0,y.vt)(r,n.y,n.z)}catch(e){return o.A.getLogger(this).errorOnce("Grid Snapping - Failed to project grid center.",e),null}}get offsetScaleFactor(){const{pixelsPerStride:e,grid:t}=this;if(!t||!e)return 1;const{majorLineInterval:n,dynamicScaling:r}=t;return n<1?null:(0,g.Ge)(n,e,r)}get spatialReference(){return this.view.spatialReference}get gridMetersPerStride(){const{grid:e}=this;return e?(0,u.oU)(e.spacing,e.units,"meters"):null}get viewMetersPerPixel(){const{viewMetersPerSRUnit:e}=this;return null==e?null:e*(0,h.i1)(this.view.scale,this.view.spatialReference)}get viewMetersPerSRUnit(){const{spatialReference:e}=this.view;return this.gridCenter?(0,g.WT)(this.gridCenter[0],this.gridCenter[1],e):null}get pixelsPerStride(){const{gridMetersPerStride:e,viewMetersPerPixel:t}=this;return t&&e?e/t:null}get updating(){return null!=this.grid&&null!=this.spatialReference&&null==this.viewMetersPerSRUnit}async fetchCandidates(e,t,n){const{options:r,view:i}=this;if(!r?.effectiveGridEnabled||!i.grid||n.feature?.attributes&&m.io in n.feature.attributes)return[];const o=n.coordinateHelper.arrayToPoint(e),s=r.distance*("touch"===n.pointer?r.touchSensitivityMultiplier:1);return this.fetchCandidatesSync(o,s)}fetchCandidatesSync(e,t){const n=[],{grid:r,effectiveViewRotation:i,gridRotation:o,gridCenter:s,viewMetersPerPixel:u,viewMetersPerSRUnit:c,offsetScaleFactor:l,spatialReference:a,gridMetersPerStride:p,pixelsPerStride:h}=this;if(!(r&&u&&c&&s&&a&&l&&p&&h))return n;if(!r.dynamicScaling&&h<d.b)return n;if(!(0,f.isLoadedOrLoadFor)(e.spatialReference,a))return n;const g=(0,f.project)(e,a),m=(0,y.vt)(g.x,g.y,g.z),S=w(m,-o,s,-i),P=p/c*l,b=v(S,P,s),{shouldSnapX:X,shouldSnapY:k}=R(b,S,t,u,c);if(!X&&!k)return[];const G=(0,y.vt)((X?b:S)[0],(k?b:S)[1]),_=w(G,o,s,i),j=w(b,o,s,i);if(k){const e=A(b,S,P,"y"),t=w(e,o,s,i);n.push(new x.o({lineStart:j,lineEnd:t,targetPoint:_,isDraped:!1}))}if(X){const e=A(b,S,P,"x"),t=w(e,o,s,i);n.push(new x.o({lineStart:j,lineEnd:t,targetPoint:_,isDraped:!1}))}return X&&k&&n.push(new M.N(_,n[0],n[1],!1)),n}};(0,r._)([(0,c.MZ)({constructOnly:!0})],S.prototype,"view",void 0),(0,r._)([(0,c.MZ)()],S.prototype,"options",void 0),(0,r._)([(0,c.MZ)()],S.prototype,"grid",null),(0,r._)([(0,c.MZ)()],S.prototype,"effectiveViewRotation",null),(0,r._)([(0,c.MZ)()],S.prototype,"gridRotation",null),(0,r._)([(0,c.MZ)()],S.prototype,"gridCenter",null),(0,r._)([(0,c.MZ)()],S.prototype,"offsetScaleFactor",null),(0,r._)([(0,c.MZ)()],S.prototype,"spatialReference",null),(0,r._)([(0,c.MZ)()],S.prototype,"gridMetersPerStride",null),(0,r._)([(0,c.MZ)()],S.prototype,"viewMetersPerPixel",null),(0,r._)([(0,c.MZ)()],S.prototype,"viewMetersPerSRUnit",null),(0,r._)([(0,c.MZ)()],S.prototype,"pixelsPerStride",null),(0,r._)([(0,c.MZ)()],S.prototype,"updating",null),S=(0,r._)([(0,l.$)("esri.views.interactive.snapping.GridSnappingEngine")],S);const w=(e,t,n,r)=>{const i=(0,y.Hh)(e[0],e[1],e[2]);return(0,a.K)(i,(0,a.K)(i,i,n,t),n,r)},v=(e,t,n)=>{const r=(e[0]-n[0])/t,i=(e[1]-n[1])/t,o=Math.trunc(r),s=Math.trunc(i),u=Math.round(r%1),c=Math.round(i%1),l=n[0]+(o+u)*t,a=n[1]+(s+c)*t;return(0,y.vt)(l,a)},R=(e,t,n,r,i)=>{if(r<=0)return{shouldSnapX:!1,shouldSnapY:!1};const o=(e[0]-t[0])/r,s=(e[1]-t[1])/r;return{shouldSnapX:Math.abs(o*i)<n,shouldSnapY:Math.abs(s*i)<n}},A=(e,t,n,r)=>{if("y"===r){const r=t[0]>e[0]?1:-1;return(0,y.vt)(e[0]+n*r,e[1])}const i=t[1]>e[1]?1:-1;return(0,y.vt)(e[0],e[1]+n*i)}}}]);
//# sourceMappingURL=GridSnappingEngine.js.map