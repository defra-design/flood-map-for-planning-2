"use strict";(self.webpackChunkdefra=self.webpackChunkdefra||[]).push([[5657],{9688:function(t,e,i){i.d(e,{lY:function(){return h},mT:function(){return d}});var n,r=i(50944),s=i(92955),o=i(96285);(n||(n={})).TimeZoneNotRecognized="TimeZoneNotRecognized";const a={[n.TimeZoneNotRecognized]:"Timezone identifier has not been recognized."};class l extends Error{constructor(t,e){super((0,r.HC)(a[t],e)),this.declaredRootClass="esri.arcade.arcadedate.dateerror",Error.captureStackTrace&&Error.captureStackTrace(this,l)}}function u(t,e,i){return t<e?t-e:t>i?t-i:0}function c(t,e,i){return t<e?e:t>i?i:t}class h{constructor(t){this._date=t,this.declaredRootClass="esri.arcade.arcadedate"}static fromParts(t=0,e=1,i=1,n=0,r=0,s=0,a=0,l){if(isNaN(t)||isNaN(e)||isNaN(i)||isNaN(n)||isNaN(r)||isNaN(s)||isNaN(a))return null;const f=o.c9.local(t,e).daysInMonth;let p=o.c9.fromObject({day:c(i,1,f),year:t,month:c(e,1,12),hour:c(n,0,23),minute:c(r,0,59),second:c(s,0,59),millisecond:c(a,0,999)},{zone:d(l)});return p=p.plus({months:u(e,1,12),days:u(i,1,f),hours:u(n,0,23),minutes:u(r,0,59),seconds:u(s,0,59),milliseconds:u(a,0,999)}),new h(p)}static get systemTimeZoneCanonicalName(){return Intl.DateTimeFormat().resolvedOptions().timeZone??"system"}static arcadeDateAndZoneToArcadeDate(t,e){const i=d(e);return t.isUnknownTimeZone||i===s.GB.instance?h.fromParts(t.year,t.monthJS+1,t.day,t.hour,t.minute,t.second,t.millisecond,i):new h(t._date.setZone(i))}static dateJSToArcadeDate(t){return new h(o.c9.fromJSDate(t,{zone:"system"}))}static dateJSAndZoneToArcadeDate(t,e="system"){const i=d(e);return new h(o.c9.fromJSDate(t,{zone:i}))}static unknownEpochToArcadeDate(t){return new h(o.c9.fromMillis(t,{zone:s.GB.instance}))}static unknownDateJSToArcadeDate(t){return new h(o.c9.fromMillis(t.getTime(),{zone:s.GB.instance}))}static epochToArcadeDate(t,e="system"){const i=d(e);return new h(o.c9.fromMillis(t,{zone:i}))}static dateTimeToArcadeDate(t){return new h(t)}clone(){return new h(this._date)}changeTimeZone(t){const e=d(t);return h.dateTimeToArcadeDate(this._date.setZone(e))}static dateTimeAndZoneToArcadeDate(t,e){const i=d(e);return t.zone===s.GB.instance||i===s.GB.instance?h.fromParts(t.year,t.month,t.day,t.hour,t.minute,t.second,t.millisecond,i):new h(t.setZone(i))}static nowToArcadeDate(t){const e=d(t);return new h(o.c9.fromJSDate(new Date,{zone:e}))}static nowUTCToArcadeDate(){return new h(o.c9.utc())}get isSystem(){return"system"===this.timeZone||this.timeZone===h.systemTimeZoneCanonicalName}equals(t){return this.isSystem&&t.isSystem?this.toNumber()===t.toNumber():this.isUnknownTimeZone===t.isUnknownTimeZone&&this._date.equals(t._date)}get isUnknownTimeZone(){return this._date.zone===s.GB.instance}get isValid(){return this._date.isValid}get hour(){return this._date.hour}get second(){return this._date.second}get day(){return this._date.day}get dayOfWeekISO(){return this._date.weekday}get dayOfWeekJS(){let t=this._date.weekday;return t>6&&(t=0),t}get millisecond(){return this._date.millisecond}get monthISO(){return this._date.month}get weekISO(){return this._date.weekNumber}get yearISO(){return this._date.weekYear}get monthJS(){return this._date.month-1}get year(){return this._date.year}get minute(){return this._date.minute}get zone(){return this._date.zone}get timeZoneOffset(){return this.isUnknownTimeZone?0:this._date.offset}get timeZone(){if(this.isUnknownTimeZone)return"unknown";if("system"===this._date.zone.type)return"system";const t=this.zone;return"fixed"===t.type?0===t.fixed?"UTC":t.formatOffset(0,"short"):t.name}stringify(){return JSON.stringify(this.toJSDate())}plus(t){return new h(this._date.plus(t))}diff(t,e="milliseconds"){return this._date.diff(t._date,e)[e]}toISODate(){return this._date.toISODate()}toISOString(t){return t?this._date.toISO({suppressMilliseconds:!0,includeOffset:!this.isUnknownTimeZone}):this._date.toISO({includeOffset:!this.isUnknownTimeZone})}toISOTime(t,e){return this._date.toISOTime({suppressMilliseconds:t,includeOffset:e&&!this.isUnknownTimeZone})}toFormat(t,e){return this.isUnknownTimeZone&&(t=t.replaceAll("Z","")),this._date.toFormat(t,e)}toJSDate(){return this._date.toJSDate()}toSQLValue(){return this._date.toFormat("yyyy-LL-dd HH:mm:ss")}toSQLWithKeyword(){return`timestamp '${this.toSQLValue()}'`}toDateTime(){return this._date}toNumber(){return this._date.toMillis()}getTime(){return this._date.toMillis()}toUTC(){return new h(this._date.toUTC())}toLocal(){return new h(this._date.toLocal())}toString(){return this.toISOString(!0)}static fromReaderAsTimeStampOffset(t){if(!t)return null;const e=o.c9.fromISO(t,{setZone:!0});return new h(e)}}function d(t,e=!0){if(t instanceof o.bo)return t;if("system"===t.toLowerCase())return"system";if("utc"===t.toLowerCase())return"UTC";if("unknown"===t.toLowerCase())return s.GB.instance;if(/^[+-]?[0-9]{1,2}([:][0-9]{2})?$/.test(t)){const e=o.mQ.parseSpecifier("UTC"+(t.startsWith("+")||t.startsWith("-")?"":"+")+t);if(e)return e}const i=o.oh.create(t);if(!i.isValid){if(e)throw new l(n.TimeZoneNotRecognized);return null}return i}},80749:function(t,e,i){i.d(e,{Fq:function(){return l},SQ:function(){return o},Yc:function(){return s},Yq:function(){return a},uf:function(){return r}});var n=i(91484);function r(t){if(null==t)return null;if("number"==typeof t)return t;let e=t.toLowerCase();switch(e=e.replaceAll(/\s/g,""),e=e.replaceAll("-",""),e){case"meters":case"meter":case"m":case"squaremeters":case"squaremeter":return 109404;case"miles":case"mile":case"squaremile":case"squaremiles":return 109439;case"kilometers":case"kilometer":case"squarekilometers":case"squarekilometer":case"km":return 109414;case"acres":case"acre":case"ac":return 109402;case"hectares":case"hectare":case"ha":return 109401;case"yard":case"yd":case"yards":case"squareyards":case"squareyard":return 109442;case"feet":case"ft":case"foot":case"squarefeet":case"squarefoot":return 109405;case"nmi":case"nauticalmile":case"nauticalmiles":case"squarenauticalmile":case"squarenauticalmiles":return 109409}return null}function s(t){if(null==t)return null;switch(t.type){case"polygon":case"multipoint":case"polyline":return t.extent;case"point":return new n.default({xmin:t.x,ymin:t.y,xmax:t.x,ymax:t.y,spatialReference:t.spatialReference});case"extent":return t}return null}function o(t){if(null==t)return null;if("number"==typeof t)return t;let e=t.toLowerCase();switch(e=e.replaceAll(/\s/g,""),e=e.replaceAll("-",""),e){case"meters":case"meter":case"m":case"squaremeters":case"squaremeter":return 9001;case"miles":case"mile":case"squaremile":case"squaremiles":return 9093;case"kilometers":case"kilometer":case"squarekilometers":case"squarekilometer":case"km":return 9036;case"yard":case"yd":case"yards":case"squareyards":case"squareyard":return 9096;case"feet":case"ft":case"foot":case"squarefeet":case"squarefoot":return 9002;case"nmi":case"nauticalmile":case"nauticalmiles":case"squarenauticalmile":case"squarenauticalmiles":return 9030}return null}function a(t){if(null==t)return null;const e=t.clone();return void 0!==t.cache._geVersion&&(e.cache._geVersion=t.cache._geVersion),e}function l(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t}},59122:function(t,e,i){function n(t,e,i){i=i||2;var n,s,a,l,u,c,d,f=e&&e.length,p=f?e[0]*i:t.length,_=r(t,0,p,i,!0),m=[];if(!_||_.next===_.prev)return m;if(f&&(_=h(t,e,_,i)),t.length>80*i){n=a=t[0],s=l=t[1];for(var g=i;g<p;g+=i)(u=t[g])<n&&(n=u),(c=t[g+1])<s&&(s=c),u>a&&(a=u),c>l&&(l=c);d=0!==(d=Math.max(a-n,l-s))?1/d:0}return o(_,m,i,n,s,d),m}function r(t,e,i,n,r){var s,o;if(r===R(t,e,i,n)>0)for(s=e;s<i;s+=n)o=A(s,t[s],t[s+1],o);else for(s=i-n;s>=e;s-=n)o=A(s,t[s],t[s+1],o);if(o&&S(o,o.next)){var a=o.next;C(o),o=a}return o}function s(t,e){if(!t)return t;e||(e=t);var i,n=t;do{if(i=!1,n.steiner||!S(n,n.next)&&0!==b(n.prev,n,n.next))n=n.next;else{var r=n.prev;if(C(n),(n=e=r)===n.next)break;i=!0}}while(i||n!==e);return e}function o(t,e,i,n,r,h,d){if(t){!d&&h&&m(t,n,r,h);for(var f,p,_=t;t.prev!==t.next;)if(f=t.prev,p=t.next,h?l(t,n,r,h):a(t))e.push(f.i/i),e.push(t.i/i),e.push(p.i/i),C(t),t=p.next,_=p.next;else if((t=p)===_){d?1===d?o(t=u(s(t),e,i),e,i,n,r,h,2):2===d&&c(t,e,i,n,r,h):o(s(t),e,i,n,r,h,1);break}}}function a(t){var e=t.prev,i=t,n=t.next;if(b(e,i,n)>=0)return!1;for(var r=t.next.next;r!==t.prev;){if(v(e.x,e.y,i.x,i.y,n.x,n.y,r.x,r.y)&&b(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function l(t,e,i,n){var r=t.prev,s=t,o=t.next;if(b(r,s,o)>=0)return!1;for(var a=r.x<s.x?r.x<o.x?r.x:o.x:s.x<o.x?s.x:o.x,l=r.y<s.y?r.y<o.y?r.y:o.y:s.y<o.y?s.y:o.y,u=r.x>s.x?r.x>o.x?r.x:o.x:s.x>o.x?s.x:o.x,c=r.y>s.y?r.y>o.y?r.y:o.y:s.y>o.y?s.y:o.y,h=g(a,l,e,i,n),d=g(u,c,e,i,n),f=t.prevZ,p=t.nextZ;f&&f.z>=h&&p&&p.z<=d;){if(f!==t.prev&&f!==t.next&&v(r.x,r.y,s.x,s.y,o.x,o.y,f.x,f.y)&&b(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,p!==t.prev&&p!==t.next&&v(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&b(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;f&&f.z>=h;){if(f!==t.prev&&f!==t.next&&v(r.x,r.y,s.x,s.y,o.x,o.y,f.x,f.y)&&b(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;p&&p.z<=d;){if(p!==t.prev&&p!==t.next&&v(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&b(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function u(t,e,i){var n=t;do{var r=n.prev,o=n.next.next;!S(r,o)&&w(r,n,n.next,o)&&I(r,o)&&I(o,r)&&(e.push(r.i/i),e.push(n.i/i),e.push(o.i/i),C(n),C(n.next),n=t=o),n=n.next}while(n!==t);return s(n)}function c(t,e,i,n,r,a){var l=t;do{for(var u=l.next.next;u!==l.prev;){if(l.i!==u.i&&x(l,u)){var c=M(l,u);return l=s(l,l.next),c=s(c,c.next),o(l,e,i,n,r,a),void o(c,e,i,n,r,a)}u=u.next}l=l.next}while(l!==t)}function h(t,e,i,n){var o,a,l,u=[];for(o=0,a=e.length;o<a;o++)(l=r(t,e[o]*n,o<a-1?e[o+1]*n:t.length,n,!1))===l.next&&(l.steiner=!0),u.push(y(l));for(u.sort(d),o=0;o<u.length;o++)i=s(i=p(u[o],i),i.next);return i}function d(t,e){return t.x-e.x}function f(t){if(t.next.prev===t)return t;let e=t;for(;;){const i=e.next;if(i.prev===e||i===e||i===t)break;e=i}return e}function p(t,e){var i=function(t,e){var i,n=e,r=t.x,s=t.y,o=-1/0;do{if(s<=n.y&&s>=n.next.y&&n.next.y!==n.y){var a=n.x+(s-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=r&&a>o){if(o=a,a===r){if(s===n.y)return n;if(s===n.next.y)return n.next}i=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!i)return null;if(r===o)return i;var l,u=i,c=i.x,h=i.y,d=1/0;n=i;do{r>=n.x&&n.x>=c&&r!==n.x&&v(s<h?r:o,s,c,h,s<h?o:r,s,n.x,n.y)&&(l=Math.abs(s-n.y)/(r-n.x),I(n,t)&&(l<d||l===d&&(n.x>i.x||n.x===i.x&&_(i,n)))&&(i=n,d=l)),n=n.next}while(n!==u);return i}(t,e);if(!i)return e;var n=M(i,t),r=s(i,i.next);let o=f(n);return s(o,o.next),r=f(r),f(e===i?r:e)}function _(t,e){return b(t.prev,t,e.prev)<0&&b(e.next,t,t.next)<0}function m(t,e,i,n){var r=t;do{null===r.z&&(r.z=g(r.x,r.y,e,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){var e,i,n,r,s,o,a,l,u=1;do{for(i=t,t=null,s=null,o=0;i;){for(o++,n=i,a=0,e=0;e<u&&(a++,n=n.nextZ);e++);for(l=u;a>0||l>0&&n;)0!==a&&(0===l||!n||i.z<=n.z)?(r=i,i=i.nextZ,a--):(r=n,n=n.nextZ,l--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;i=n}s.nextZ=null,u*=2}while(o>1)}(r)}function g(t,e,i,n,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function y(t){var e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function v(t,e,i,n,r,s,o,a){return(r-o)*(e-a)-(t-o)*(s-a)>=0&&(t-o)*(n-a)-(i-o)*(e-a)>=0&&(i-o)*(s-a)-(r-o)*(n-a)>=0}function x(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&w(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(I(t,e)&&I(e,t)&&function(t,e){var i=t,n=!1,r=(t.x+e.x)/2,s=(t.y+e.y)/2;do{i.y>s!=i.next.y>s&&i.next.y!==i.y&&r<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==t);return n}(t,e)&&(b(t.prev,t,e.prev)||b(t,e.prev,e))||S(t,e)&&b(t.prev,t,t.next)>0&&b(e.prev,e,e.next)>0)}function b(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function S(t,e){return t.x===e.x&&t.y===e.y}function w(t,e,i,n){var r=P(b(t,e,i)),s=P(b(t,e,n)),o=P(b(i,n,t)),a=P(b(i,n,e));return r!==s&&o!==a||!(0!==r||!T(t,i,e))||!(0!==s||!T(t,n,e))||!(0!==o||!T(i,t,n))||!(0!==a||!T(i,e,n))}function T(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function P(t){return t>0?1:t<0?-1:0}function I(t,e){return b(t.prev,t,t.next)<0?b(t,e,t.next)>=0&&b(t,t.prev,e)>=0:b(t,e,t.prev)<0||b(t,t.next,e)<0}function M(t,e){var i=new E(t.i,t.x,t.y),n=new E(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,n.next=i,i.prev=n,s.next=n,n.prev=s,n}function A(t,e,i,n){var r=new E(t,e,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function C(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function E(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function R(t,e,i,n){for(var r=0,s=e,o=i-n;s<i;s+=n)r+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return r}i.d(e,{e:function(){return n}}),n.deviation=function(t,e,i,n){var r=e&&e.length,s=r?e[0]*i:t.length,o=Math.abs(R(t,0,s,i));if(r)for(var a=0,l=e.length;a<l;a++){var u=e[a]*i,c=a<l-1?e[a+1]*i:t.length;o-=Math.abs(R(t,u,c,i))}var h=0;for(a=0;a<n.length;a+=3){var d=n[a]*i,f=n[a+1]*i,p=n[a+2]*i;h+=Math.abs((t[d]-t[p])*(t[f+1]-t[d+1])-(t[d]-t[f])*(t[p+1]-t[d+1]))}return 0===o&&0===h?0:Math.abs((h-o)/o)},n.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},n=0,r=0;r<t.length;r++){for(var s=0;s<t[r].length;s++)for(var o=0;o<e;o++)i.vertices.push(t[r][s][o]);r>0&&(n+=t[r-1].length,i.holes.push(n))}return i}},67750:function(t,e,i){i.d(e,{A:function(){return P}});const n=[["(",")"],[")","("],["<",">"],[">","<"],["[","]"],["]","["],["{","}"],["}","{"],["«","»"],["»","«"],["‹","›"],["›","‹"],["⁽","⁾"],["⁾","⁽"],["₍","₎"],["₎","₍"],["≤","≥"],["≥","≤"],["〈","〉"],["〉","〈"],["﹙","﹚"],["﹚","﹙"],["﹛","﹜"],["﹜","﹛"],["﹝","﹞"],["﹞","﹝"],["﹤","﹥"],["﹥","﹤"]],r=["آ","أ","إ","ا"],s=["ﻵ","ﻷ","ﻹ","ﻻ"],o=["ﻶ","ﻸ","ﻺ","ﻼ"],a=["ا","ب","ت","ث","ج","ح","خ","د","ذ","ر","ز","س","ش","ص","ض","ط","ظ","ع","غ","ف","ق","ك","ل","م","ن","ه","و","ي","إ","أ","آ","ة","ى","ل","م","ن","ه","و","ي","إ","أ","آ","ة","ى","ی","ئ","ؤ"],l=["ﺍ","ﺏ","ﺕ","ﺙ","ﺝ","ﺡ","ﺥ","ﺩ","ﺫ","ﺭ","ﺯ","ﺱ","ﺵ","ﺹ","ﺽ","ﻁ","ﻅ","ﻉ","ﻍ","ﻑ","ﻕ","ﻙ","ﻝ","ﻡ","ﻥ","ﻩ","ﻭ","ﻱ","ﺇ","ﺃ","ﺁ","ﺓ","ﻯ","ﯼ","ﺉ","ﺅ","ﹰ","ﹲ","ﹴ","ﹶ","ﹸ","ﹺ","ﹼ","ﹾ","ﺀ","ﺉ","ﺅ"],u=["ﺎ","ﺐ","ﺖ","ﺚ","ﺞ","ﺢ","ﺦ","ﺪ","ﺬ","ﺮ","ﺰ","ﺲ","ﺶ","ﺺ","ﺾ","ﻂ","ﻆ","ﻊ","ﻎ","ﻒ","ﻖ","ﻚ","ﻞ","ﻢ","ﻦ","ﻪ","ﻮ","ﻲ","ﺈ","ﺄ","ﺂ","ﺔ","ﻰ","ﯽ","ﺊ","ﺆ","ﹰ","ﹲ","ﹴ","ﹶ","ﹸ","ﹺ","ﹼ","ﹾ","ﺀ","ﺊ","ﺆ"],c=["ﺎ","ﺒ","ﺘ","ﺜ","ﺠ","ﺤ","ﺨ","ﺪ","ﺬ","ﺮ","ﺰ","ﺴ","ﺸ","ﺼ","ﻀ","ﻄ","ﻈ","ﻌ","ﻐ","ﻔ","ﻘ","ﻜ","ﻠ","ﻤ","ﻨ","ﻬ","ﻮ","ﻴ","ﺈ","ﺄ","ﺂ","ﺔ","ﻰ","ﯿ","ﺌ","ﺆ","ﹱ","ﹲ","ﹴ","ﹷ","ﹹ","ﹻ","ﹽ","ﹿ","ﺀ","ﺌ","ﺆ"],h=["ﺍ","ﺑ","ﺗ","ﺛ","ﺟ","ﺣ","ﺧ","ﺩ","ﺫ","ﺭ","ﺯ","ﺳ","ﺷ","ﺻ","ﺿ","ﻃ","ﻇ","ﻋ","ﻏ","ﻓ","ﻗ","ﻛ","ﻟ","ﻣ","ﻧ","ﻫ","ﻭ","ﻳ","ﺇ","ﺃ","ﺁ","ﺓ","ﻯ","ﯾ","ﺋ","ﺅ","ﹰ","ﹲ","ﹴ","ﹶ","ﹸ","ﹺ","ﹼ","ﹾ","ﺀ","ﺋ","ﺅ"],d=["ء","آ","أ","ؤ","إ","ا","ة","د","ذ","ر","ز","و","ى"],f=["ً","ً","ٌ","؟","ٍ","؟","َ","َ","ُ","ُ","ِ","ِ","ّ","ّ","ْ","ْ","ء","آ","آ","أ","أ","ؤ","ؤ","إ","إ","ئ","ئ","ئ","ئ","ا","ا","ب","ب","ب","ب","ة","ة","ت","ت","ت","ت","ث","ث","ث","ث","ج","ج","ج","ج","ح","ح","ح","ح","خ","خ","خ","خ","د","د","ذ","ذ","ر","ر","ز","ز","س","س","س","س","ش","ش","ش","ش","ص","ص","ص","ص","ض","ض","ض","ض","ط","ط","ط","ط","ظ","ظ","ظ","ظ","ع","ع","ع","ع","غ","غ","غ","غ","ف","ف","ف","ف","ق","ق","ق","ق","ك","ك","ك","ك","ل","ل","ل","ل","م","م","م","م","ن","ن","ن","ن","ه","ه","ه","ه","و","و","ى","ى","ي","ي","ي","ي","ﻵ","ﻶ","ﻷ","ﻸ","ﻹ","ﻺ","ﻻ","ﻼ","؟","؟","؟"],p=["ء","ف"],_=["غ","ي"],m=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],g=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],y=10,v=11,x=12,b=18,S=["UBAT_L","UBAT_R","UBAT_EN","UBAT_AN","UBAT_ON","UBAT_B","UBAT_S","UBAT_AL","UBAT_WS","UBAT_CS","UBAT_ES","UBAT_ET","UBAT_NSM","UBAT_LRE","UBAT_RLE","UBAT_PDF","UBAT_LRO","UBAT_RLO","UBAT_BN"],w=[100,0,0,0,0,101,102,103,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,104,4,4,4,0,4,0,4,0,4,4,4,0,0,4,4,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,4,4,0,0,4,4,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,0,105,7,7,106,107],T=[[b,b,b,b,b,b,b,b,b,6,5,6,8,5,b,b,b,b,b,b,b,b,b,b,b,b,b,b,5,5,5,6,8,4,4,v,v,v,4,4,4,4,4,y,9,y,9,9,2,2,2,2,2,2,2,2,2,2,9,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,b,b,b,b,b,b,5,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,9,4,v,v,v,v,4,4,4,4,0,4,4,b,4,4,v,v,2,2,4,0,4,4,4,2,0,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,4,4,4,4,4,4,4,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,1,x,1,x,x,1,x,x,1,x,4,4,4,4,4,4,4,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4,4,4,4,4,1,1,1,1,1,4,4,4,4,4,4,4,4,4,4,4],[3,3,3,3,4,4,4,4,7,v,v,7,9,7,4,4,x,x,x,x,x,x,x,x,x,x,x,7,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,3,3,3,3,3,3,3,3,3,3,v,3,3,7,7,7,x,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,x,x,x,x,x,x,x,3,4,x,x,x,x,x,x,7,7,x,x,4,x,x,x,x,7,7,2,2,2,2,2,2,2,2,2,2,7,7,7,7,7,7],[7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,7,7,x,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,x,x,x,x,x,x,x,x,x,x,x,7,4,4,4,4,4,4,4,4,4,4,4,4,4,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,x,x,x,x,x,x,x,x,x,1,1,4,4,4,4,1,4,4,4,4,4],[8,8,8,8,8,8,8,8,8,8,8,b,b,b,0,1,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,8,5,13,14,15,16,17,9,v,v,v,v,v,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,9,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,8,b,b,b,b,b,4,4,4,4,4,b,b,b,b,b,b,2,0,4,4,2,2,2,2,2,2,y,y,4,4,4,0,2,2,2,2,2,2,2,2,2,2,y,y,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,4,4,4,4,4,1,x,1,1,1,1,1,1,1,1,1,1,y,1,1,1,1,1,1,1,1,1,1,1,1,1,4,1,1,1,1,1,4,1,4,1,1,4,1,1,4,1,1,1,1,1,1,1,1,1,1,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],[x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,x,x,x,x,x,x,x,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,9,4,9,4,4,9,4,4,4,4,4,4,4,4,4,v,4,4,y,y,4,4,4,4,4,v,v,4,4,4,4,4,7,7,7,7,7,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,4,b],[4,4,4,v,v,v,4,4,4,4,4,y,9,y,9,9,2,2,2,2,2,2,2,2,2,2,9,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,0,0,0,0,0,0,4,4,0,0,0,0,0,0,4,4,0,0,0,0,0,0,4,4,0,0,0,4,4,4,v,v,4,4,4,v,v,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4]];class P{constructor(){this.inputFormat="ILYNN",this.outputFormat="VLNNN",this.sourceToTarget=[],this.targetToSource=[],this.levels=[]}bidiTransform(t,e,i){if(this.sourceToTarget=[],this.targetToSource=[],!t)return"";if(function(t,e,i){$=[],q=[];for(let n=0;n<i;n++)t[n]=n,e[n]=n,$[n]=n}(this.sourceToTarget,this.targetToSource,t.length),!this.checkParameters(e,i))return t;e=this.inputFormat,i=this.outputFormat;let n=t;const a=X,c=Y(e.charAt(1)),d=Y(i.charAt(1)),p=("I"===e.charAt(0)?"L":e.charAt(0))+c,_=("I"===i.charAt(0)?"L":i.charAt(0))+d,m=e.charAt(2)+i.charAt(2);a.defInFormat=p,a.defOutFormat=_,a.defSwap=m;const g=I(t,p,_,m,a);let y=!1;return"R"===i.charAt(1)?y=!0:"C"!==i.charAt(1)&&"D"!==i.charAt(1)||(y="rtl"===this.checkContextual(g)),this.sourceToTarget=$,this.targetToSource=function(t){const e=new Array(t.length);for(let i=0;i<t.length;i++)e[t[i]]=i;return e}(this.sourceToTarget),j=this.targetToSource,n=e.charAt(3)===i.charAt(3)?g:"S"===i.charAt(3)?function(t,e){if(0===e.length)return"";void 0===t&&(t=!0);const i=(e=String(e)).split("");let n=0,r=1,a=i.length;t||(n=i.length-1,r=-1,a=1);const c=function(t,e,i,n){let r=0;const a=[];let c=0;for(let d=e;d*i<n;d+=i)if(z(t[d])||G(t[d])){if("ل"===t[d]&&L(t,d+i,i,n)){t[d]=H(t[d+i],0===r?s:o),d+=i,Z(t,d,i,n),a[c]=d,c++,r=0;continue}const e=t[d];1===r?t[d]=D(t,d+i,i,n)?B(t[d]):U(t[d],u):!0===D(t,d+i,i,n)?t[d]=U(t[d],h):t[d]=U(t[d],l),G(e)||(r=1),!0===k(e)&&(r=0)}else r=0;return a}(i,n,r,a);let d="";for(let e=0;e<i.length;e++)O(c,c.length,e)>-1?(W(j,e,!t,-1),$.splice(e,1)):d+=i[e];return d}(y,g):function(t,e){if(0===t.length)return"";void 0===e&&(e=!0);let i="";const n=(t=String(t)).split("");for(let s=0;s<t.length;s++){let o=!1;if(n[s]>="ﹰ"&&n[s]<"\ufeff"){const a=t.charCodeAt(s);n[s]>="ﻵ"&&n[s]<="ﻼ"?(e?(s>0&&" "===n[s-1]?i=i.slice(0,-1)+"ل":(i+="ل",o=!0),i+=r[(a-65269)/2]):(i+=r[(a-65269)/2],i+="ل",s+1<t.length&&" "===n[s+1]?s++:o=!0),o&&(W(j,s,!0,1),$.splice(s,0,$[s]))):i+=f[a-65136]}else i+=n[s]}return i}(g,y),this.sourceToTarget=$,this.targetToSource=j,this.levels=q,n}_inputFormatSetter(t){if(!et.test(t))throw new Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.inputFormat=t}_outputFormatSetter(t){if(!et.test(t))throw new Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.outputFormat=t}checkParameters(t,e){return t?this._inputFormatSetter(t):t=this.inputFormat,e?this._outputFormatSetter(e):e=this.outputFormat,t!==e}checkContextual(t){let e=M(t);if("ltr"!==e&&"rtl"!==e){try{e=document.dir.toLowerCase()}catch(t){}"ltr"!==e&&"rtl"!==e&&(e="ltr")}return e}hasBidiChar(t){return it.test(t)}}function I(t,e,i,n,r){const s=function(t,e,i){if(void 0===e.inFormat&&(e.inFormat=i.defInFormat),void 0===e.outFormat&&(e.outFormat=i.defOutFormat),void 0===e.swap&&(e.swap=i.defSwap),e.inFormat===e.outFormat)return e;const n=e.inFormat.slice(0,1),r=e.outFormat.slice(0,1);let s,o=e.inFormat.slice(1,4),a=e.outFormat.slice(1,4);return"C"===o.charAt(0)&&(s=M(t),o="ltr"===s||"rtl"===s?s.toUpperCase():"L"===e.inFormat.charAt(2)?"LTR":"RTL",e.inFormat=n+o),"C"===a.charAt(0)&&(s=M(t),"rtl"===s?a="RTL":"ltr"===s?(s=function(t){const e=t.split("");return e.reverse(),M(e.join(""))}(t),a=s.toUpperCase()):a="L"===e.outFormat.charAt(2)?"LTR":"RTL",e.outFormat=r+a),e}(t,{inFormat:e,outFormat:i,swap:n},r);if(s.inFormat===s.outFormat)return t;e=s.inFormat,i=s.outFormat,n=s.swap;const o=e.slice(0,1),a=e.slice(1,4),l=i.slice(0,1),u=i.slice(1,4);if(r.inFormat=e,r.outFormat=i,r.swap=n,"L"===o&&"VLTR"===i){if("LTR"===a)return r.dir=J,A(t,r);if("RTL"===a)return r.dir=tt,A(t,r)}if("V"===o&&"V"===l)return r.dir="RTL"===a?tt:J,R(t,r);if("L"===o&&"VRTL"===i)return"LTR"===a?(r.dir=J,t=A(t,r)):(r.dir=tt,t=A(t,r)),R(t);if("VLTR"===e&&"LLTR"===i)return r.dir=J,A(t,r);if("V"===o&&"L"===l&&a!==u)return t=R(t),"RTL"===a?I(t,"LLTR","VLTR",n,r):I(t,"LRTL","VRTL",n,r);if("VRTL"===e&&"LRTL"===i)return I(t,"LRTL","VRTL",n,r);if("L"===o&&"L"===l){const e=r.swap;return r.swap=e.slice(0,1)+"N","RTL"===a?(r.dir=tt,t=A(t,r),r.swap="N"+e.slice(1,3),r.dir=J,t=A(t,r)):(r.dir=J,t=A(t,r),r.swap="N"+e.slice(1,3),t=I(t,"VLTR","LRTL",r.swap,r)),t}return t}function M(t){const e=/[A-Za-z\u05d0-\u065f\u066a-\u06ef\u06fa-\u07ff\ufb1d-\ufdff\ufe70-\ufefc]/.exec(t);return e?e[0]<="z"?"ltr":"rtl":""}function A(t,e){const i=t.split(""),n=[];return C(i,n,e),function(t,e,i){if(0!==i.hiLevel&&i.swap[0]!==i.swap[1])for(let i=0;i<t.length;i++)1===e[i]&&(t[i]=N(t[i]))}(i,n,e),F(2,i,n,e),F(1,i,n,e),q=n,i.join("")}function C(t,e,i){const n=t.length,r=i.dir?g:m;let s=0,o=-1;const a=[],l=[];i.hiLevel=i.dir,i.lastArabic=!1,i.hasUbatAl=!1,i.hasUbatB=!1,i.hasUbatS=!1;for(let e=0;e<n;e++)a[e]=E(t[e]);for(let u=0;u<n;u++){const n=s,c=V(t,a,l,u,i);l[u]=c,s=r[n][c];const h=240&s;s&=15;const d=r[s][K];if(e[u]=d,h>0)if(16===h){for(let t=o;t<u;t++)e[t]=1;o=-1}else o=-1;if(r[s][Q])-1===o&&(o=u);else if(o>-1){for(let t=o;t<u;t++)e[t]=d;o=-1}5===a[u]&&(e[u]=0),i.hiLevel|=d}i.hasUbatS&&function(t,e,i,n){for(let r=0;r<i;r++)if(6===t[r]){e[r]=n.dir;for(let i=r-1;i>=0&&8===t[i];i--)e[i]=n.dir}}(a,e,n,i)}function E(t){const e=t.charCodeAt(0),i=w[e>>8];return i<100?i:T[i-100][255&e]}function R(t,e){const i=t.split("");if(e){const t=[];C(i,t,e),q=t}return i.reverse(),$.reverse(),i.join("")}function O(t,e,i){for(let n=0;n<e;n++)if(t[n]===i)return n;return-1}function z(t){for(let e=0;e<p.length;e++)if(t>=p[e]&&t<=_[e])return!0;return!1}function D(t,e,i,n){for(;e*i<n&&G(t[e]);)e+=i;return!!(e*i<n&&z(t[e]))}function L(t,e,i,n){for(;e*i<n&&G(t[e]);)e+=i;let s=" ";if(!(e*i<n))return!1;s=t[e];for(let t=0;t<r.length;t++)if(r[t]===s)return!0;return!1}function F(t,e,i,n){if(n.hiLevel<t)return;if(1===t&&n.dir===tt&&!n.hasUbatB)return e.reverse(),void $.reverse();const r=e.length;let s,o,a,l,u,c=0;for(;c<r;){if(i[c]>=t){for(s=c+1;s<r&&i[s]>=t;)s++;for(o=c,a=s-1;o<a;o++,a--)l=e[o],e[o]=e[a],e[a]=l,u=$[o],$[o]=$[a],$[a]=u;c=s}c++}}function V(t,e,i,n,r){const s=e[n];return{UBAT_L:()=>(r.lastArabic=!1,0),UBAT_R:()=>(r.lastArabic=!1,1),UBAT_ON:()=>4,UBAT_AN:()=>3,UBAT_EN:()=>r.lastArabic?3:2,UBAT_AL:()=>(r.lastArabic=!0,r.hasUbatAl=!0,1),UBAT_WS:()=>4,UBAT_CS:()=>{let t,s;return n<1||n+1>=e.length||2!==(t=i[n-1])&&3!==t||2!==(s=e[n+1])&&3!==s?4:(r.lastArabic&&(s=3),s===t?s:4)},UBAT_ES:()=>2===(n>0?i[n-1]:5)&&n+1<e.length&&2===e[n+1]?2:4,UBAT_ET:()=>{if(n>0&&2===i[n-1])return 2;if(r.lastArabic)return 4;let t=n+1;const s=e.length;for(;t<s&&e[t]===v;)t++;return t<s&&2===e[t]?2:4},UBAT_NSM:()=>{if("VLTR"===r.inFormat){const i=e.length;let r=n+1;for(;r<i&&e[r]===x;)r++;if(r<i){const i=t[n].charCodeAt(0),s=i>=1425&&i<=2303||64286===i,o=e[r];if(s&&(1===o||7===o))return 1}}return n<1||5===e[n-1]?4:i[n-1]},UBAT_B:()=>(r.lastArabic=!0,r.hasUbatB=!0,r.dir),UBAT_S:()=>(r.hasUbatS=!0,4),UBAT_LRE:()=>(r.lastArabic=!1,4),UBAT_RLE:()=>(r.lastArabic=!1,4),UBAT_LRO:()=>(r.lastArabic=!1,4),UBAT_RLO:()=>(r.lastArabic=!1,4),UBAT_PDF:()=>(r.lastArabic=!1,4),UBAT_BN:()=>4}[S[s]]()}function N(t){let e,i=0,r=n.length-1;for(;i<=r;)if(e=Math.floor((i+r)/2),t<n[e][0])r=e-1;else{if(!(t>n[e][0]))return n[e][1];i=e+1}return t}function k(t){for(let e=0;e<d.length;e++)if(d[e]===t)return!0;return!1}function B(t){for(let e=0;e<a.length;e++)if(t===a[e])return c[e];return t}function U(t,e){for(let i=0;i<a.length;i++)if(t===a[i])return e[i];return t}function G(t){return t>="ً"&&t<="ٕ"}function Y(t){return"L"===t?"LTR":"R"===t?"RTL":"C"===t?"CLR":"D"===t?"CRL":""}function Z(t,e,i,n){for(;e*i<n&&G(t[e]);)e+=i;return e*i<n&&(t[e]=" ",!0)}function H(t,e){for(let i=0;i<r.length;i++)if(t===r[i])return e[i];return t}function W(t,e,i,n){for(let r=0;r<t.length;r++)(t[r]>e||!i&&t[r]===e)&&(t[r]+=n)}let $=[],j=[],q=[];const X={dir:0,defInFormat:"LLTR",defoutFormat:"VLTR",defSwap:"YN",inFormat:"LLTR",outFormat:"VLTR",swap:"YN",hiLevel:0,lastArabic:!1,hasUbatAl:!1,hasBlockSep:!1,hasSegSep:!1,defOutFormat:""},K=5,Q=6,J=0,tt=1,et=/^[(I|V)][(L|R|C|D)][(Y|N)][(S|N)][N]$/,it=/[\u0591-\u06ff\ufb1d-\ufefc]/},90152:function(t,e,i){i.d(e,{y:function(){return r}});const n=new(i(67750).A);function r(t){if(null==t)return["",!1];if(!n.hasBidiChar(t))return[t,!1];let e;return e="rtl"===n.checkContextual(t)?"IDNNN":"ICNNN",[n.bidiTransform(t,e,"VLYSN"),!0]}},80683:function(t,e,i){i.d(e,{Al:function(){return u},NZ:function(){return c},Vb:function(){return r},af:function(){return h},rK:function(){return d}});var n=i(25591);const r="arial-unicode-ms",s="woff2",o=new Map,a=new Set;class l{constructor(t,e){this.fontFace=t,this.promise=e}}async function u(t){const e=f(t),i=d(t),r=o.get(e);if(r)return r.promise;const u=new FontFace(t.family,`url('${n.default.fontsUrl}/woff2/${i}.${s}') format('${s}')`,{style:t.style,weight:t.weight}),c=document.fonts;if(c.has(u)&&"loading"===u.status)return u.loaded;const h=u.load().then((()=>(c.add(u),u)));return o.set(e,new l(u,h)),a.add(u),h}function c(t){return a.has(t)}function h(t){if(!t)return r;const e=t.toLowerCase().split(" ").join("-");switch(e){case"serif":return"noto-serif";case"sans-serif":return"arial-unicode-ms";case"monospace":return"ubuntu-mono";case"fantasy":return"cabin-sketch";case"cursive":return"redressed";default:return e}}function d(t){const e=p(t)+_(t);return h(t.family)+(e.length>0?e:"-regular")}function f(t){const e=p(t)+_(t);return(t.family||r)+(e.length>0?e:"-regular")}function p(t){if(!t.weight)return"";switch(t.weight.toLowerCase()){case"bold":case"bolder":return"-bold"}return""}function _(t){if(!t.style)return"";switch(t.style.toLowerCase()){case"italic":case"oblique":return"-italic"}return""}},43274:function(t,e,i){function n(){return new Float32Array(3)}function r(t){const e=new Float32Array(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function s(t,e,i){const n=new Float32Array(3);return n[0]=t,n[1]=e,n[2]=i,n}function o(){return n()}function a(){return s(1,1,1)}function l(){return s(1,0,0)}function u(){return s(0,1,0)}function c(){return s(0,0,1)}i.d(e,{fA:function(){return s},o8:function(){return r},vt:function(){return n}});const h=o(),d=a(),f=l(),p=u(),_=c();Object.freeze(Object.defineProperty({__proto__:null,ONES:d,UNIT_X:f,UNIT_Y:p,UNIT_Z:_,ZEROS:h,clone:r,create:n,createView:function(t,e){return new Float32Array(t,e,3)},fromValues:s,ones:a,unitX:l,unitY:u,unitZ:c,zeros:o},Symbol.toStringTag,{value:"Module"}))},43745:function(t,e,i){function n(){return new Float32Array(4)}function r(t,e,i,n){const r=new Float32Array(4);return r[0]=t,r[1]=e,r[2]=i,r[3]=n,r}function s(){return n()}function o(){return r(1,1,1,1)}function a(){return r(1,0,0,0)}function l(){return r(0,1,0,0)}function u(){return r(0,0,1,0)}function c(){return r(0,0,0,1)}i.d(e,{fA:function(){return r}});const h=s(),d=o(),f=a(),p=l(),_=u(),m=c();Object.freeze(Object.defineProperty({__proto__:null,ONES:d,UNIT_W:m,UNIT_X:f,UNIT_Y:p,UNIT_Z:_,ZEROS:h,clone:function(t){const e=new Float32Array(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},create:n,createView:function(t,e){return new Float32Array(t,e,4)},fromValues:r,ones:o,unitW:c,unitX:a,unitY:l,unitZ:u,zeros:s},Symbol.toStringTag,{value:"Module"}))},42042:function(t,e,i){i.d(e,{n:function(){return a}});var n=i(9688),r=i(22739),s=i(96285);function o(t){t=t.replaceAll(/LTS|LT|L{1,4}|l{1,4}/g,"[$&]");let e="";const i=/(\[[^[]*\])|(\\)?([Hh]mm(ss)?|Mo|M{1,4}|Do|DDDo|D{1,4}|d{2,4}|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;for(const n of t.match(i)||[])switch(n){case"D":e+="d";break;case"DD":e+="dd";break;case"DDD":e+="o";break;case"d":e+="c";break;case"ddd":e+="ccc";break;case"dddd":e+="cccc";break;case"M":e+="L";break;case"MM":e+="LL";break;case"MMM":e+="LLL";break;case"MMMM":e+="LLLL";break;case"YY":e+="yy";break;case"Y":case"YYYY":e+="yyyy";break;case"Q":e+="q";break;case"X":case"x":e+=n;break;default:n.length>=2&&"["===n.slice(0,1)&&"]"===n.slice(-1)?e+=`'${n.slice(1,-1)}'`:e+=`'${n}'`}return e}class a{constructor(t,e,i){this._year=t,this._month=e,this._day=i,this.declaredRootClass="esri.core.sql.dateonly"}get month(){return this._month}get monthJS(){return this._month-1}get year(){return this._year}get day(){return this._day}get isValid(){return this.toDateTime("unknown").isValid}equals(t){return t instanceof a&&t.day===this.day&&t.month===this.month&&t.year===this.year}clone(){return new a(this._year,this._month,this._day)}toDateTime(t){return s.c9.fromObject({day:this.day,month:this.month,year:this.year},{zone:(0,n.mT)(t)})}toDateTimeLuxon(t){return s.c9.fromObject({day:this.day,month:this.month,year:this.year},{zone:(0,n.mT)(t)})}toString(){return`${this.year.toString().padStart(4,"0")}-${this.month.toString().padStart(2,"0")}-${this.day.toString().padStart(2,"0")}`}toFormat(t=null,e=!0){if(null===t||""===t)return this.toString();if(e&&(t=o(t)),!t)return"";const i=this.toDateTime("unknown");return n.lY.dateTimeToArcadeDate(i).toFormat(t,{locale:(0,r.JK)(),numberingSystem:"latn"})}toArcadeDate(){const t=this.toDateTime("unknown");return n.lY.dateTimeToArcadeDate(t)}toNumber(){return this.toDateTime("unknown").toMillis()}toJSDate(){return this.toDateTime("unknown").toJSDate()}toStorageFormat(){return this.toFormat("yyyy-LL-dd",!1)}toSQLValue(){return this.toFormat("yyyy-LL-dd",!1)}toSQLWithKeyword(){return"date '"+this.toFormat("yyyy-LL-dd",!1)+"'"}plus(t,e){return a.fromDateTime(this.toUTCDateTime().plus({[t]:e}))}toUTCDateTime(){return s.c9.utc(this.year,this.month,this.day,0,0,0,0)}difference(t,e){switch(e.toLowerCase()){case"days":case"day":case"d":return this.toUTCDateTime().diff(t.toUTCDateTime(),"days").days;case"months":case"month":return this.toUTCDateTime().diff(t.toUTCDateTime(),"months").months;case"minutes":case"minute":case"m":return"M"===e?this.toUTCDateTime().diff(t.toUTCDateTime(),"months").months:this.toUTCDateTime().diff(t.toUTCDateTime(),"minutes").minutes;case"seconds":case"second":case"s":return this.toUTCDateTime().diff(t.toUTCDateTime(),"seconds").seconds;case"milliseconds":case"millisecond":case"ms":default:return this.toUTCDateTime().diff(t.toUTCDateTime(),"milliseconds").milliseconds;case"hours":case"hour":case"h":return this.toUTCDateTime().diff(t.toUTCDateTime(),"hours").hours;case"years":case"year":case"y":return this.toUTCDateTime().diff(t.toUTCDateTime(),"years").years}}static fromMilliseconds(t){const e=s.c9.fromMillis(t,{zone:s.mQ.utcInstance});return e.isValid?a.fromParts(e.year,e.month,e.day):null}static fromSeconds(t){const e=s.c9.fromSeconds(t,{zone:s.mQ.utcInstance});return e.isValid?a.fromParts(e.year,e.month,e.day):null}static fromReader(t){if(!t)return null;const e=t.split("-");return 3!==e.length?null:new a(parseInt(e[0],10),parseInt(e[1],10),parseInt(e[2],10))}static fromParts(t,e,i){const n=new a(t,e,i);return!1===n.isValid?null:n}static fromDateJS(t){return a.fromParts(t.getFullYear(),t.getMonth()+1,t.getDay())}static fromDateTime(t){return a.fromParts(t.year,t.month,t.day)}static fromSqlTimeStampOffset(t){return this.fromDateTime(t.toDateTime())}static fromString(t,e=null){if(""===t)return null;if(null===t)return null;const i=[];if(e)(e=o(e))&&i.push(e);else if(null===e||""===e){const e=s.c9.fromISO(t,{setZone:!0});return e.isValid?a.fromParts(e.year,e.month,e.day):null}for(const n of i){const i=s.c9.fromFormat(t,e??n);if(i.isValid)return new a(i.year,i.month,i.day)}return null}static fromNow(t="system"){const e=s.c9.fromJSDate(new Date).setZone((0,n.mT)(t));return new a(e.year,e.month,e.day)}}},70891:function(t,e,i){i.d(e,{k:function(){return a}});var n=i(80749),r=i(22739),s=i(96285);function o(t){if(!t)return"";const e=/(a|A|hh?|HH?|mm?|ss?|SSS|S|.)/g;let i="";for(const n of t.match(e)||[])switch(n){case"SSS":case"m":case"mm":case"h":case"hh":case"H":case"HH":case"s":case"ss":i+=n;break;case"A":case"a":i+="a";break;default:i+=`'${n}'`}return i}class a{constructor(t,e,i,n){this._hour=t,this._minute=e,this._second=i,this._millisecond=n,this.declaredRootClass="esri.core.sql.timeonly"}get hour(){return this._hour}get minute(){return this._minute}get second(){return this._second}get millisecond(){return this._millisecond}equals(t){return t instanceof a&&t.hour===this.hour&&t.minute===this.minute&&t.second===this.second&&t.millisecond===this.millisecond}clone(){return new a(this.hour,this.minute,this.second,this.millisecond)}isValid(){return(0,n.Fq)(this.hour)&&(0,n.Fq)(this.minute)&&(0,n.Fq)(this.second)&&(0,n.Fq)(this.millisecond)&&this.hour>=0&&this.hour<24&&this.minute>=0&&this.minute<60&&this.second>=0&&this.second<60&&this.millisecond>=0&&this.millisecond<1e3}toString(){return`${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}`+(this.millisecond>0?"."+this.millisecond.toString().padStart(3,"0"):"")}toSQLValue(){return this.toString()}toSQLWithKeyword(){return`time '${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}${this.millisecond>0?"."+this.millisecond.toString().padStart(3,"0"):""}'`}toStorageString(){return`${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}`}toFormat(t=null){return null===t||""===t?this.toString():(t=o(t))?s.c9.local(1970,1,1,this._hour,this._minute,this._second,this._millisecond).toFormat(t,{locale:(0,r.JK)(),numberingSystem:"latn"}):""}toNumber(){return this.millisecond+1e3*this.second+1e3*this.minute*60+60*this.hour*60*1e3}static fromParts(t,e,i,n){const r=new a(t,e,i,n);return r.isValid()?r:null}static fromReader(t){if(!t)return null;const e=t.split(":");return 3!==e.length?null:new a(parseInt(e[0],10),parseInt(e[1],10),parseInt(e[2],10),0)}static fromMilliseconds(t){if(t>864e5||t<0)return null;const e=Math.floor(t/1e3%60),i=Math.floor(t/6e4%60),n=Math.floor(t/36e5%24),r=Math.floor(t%1e3);return new a(n,i,e,r)}static fromDateJS(t){return new a(t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds())}static fromDateTime(t){return new a(t.hour,t.minute,t.second,t.millisecond)}static fromSqlTimeStampOffset(t){return this.fromDateTime(t.toDateTime())}static fromString(t,e=null){if(""===t)return null;if(null===t)return null;const i=[];e?(e=o(e))&&i.push(e):null!==e&&""!==e||(i.push("HH:mm:ss"),i.push("HH:mm:ss.SSS"),i.push("hh:mm:ss a"),i.push("hh:mm:ss.SSS a"),i.push("HH:mm"),i.push("hh:mm a"),i.push("H:mm"),i.push("h:mm a"),i.push("H:mm:ss"),i.push("h:mm:ss a"),i.push("H:mm:ss.SSS"),i.push("h:mm:ss.SSS a"));for(const e of i){const i=s.c9.fromFormat(t,e);if(i.isValid)return new a(i.hour,i.minute,i.second,i.millisecond)}return null}plus(t,e){switch(t){case"days":case"years":case"months":return this.clone();case"hours":case"minutes":case"seconds":case"milliseconds":return a.fromDateTime(this.toUTCDateTime().plus({[t]:e}))}return null}toUTCDateTime(){return s.c9.utc(1970,1,1,this.hour,this.minute,this.second,this.millisecond)}difference(t,e){switch(e.toLowerCase()){case"days":case"day":case"d":return this.toUTCDateTime().diff(t.toUTCDateTime(),"days").days;case"months":case"month":return this.toUTCDateTime().diff(t.toUTCDateTime(),"months").months;case"minutes":case"minute":case"m":return"M"===e?this.toUTCDateTime().diff(t.toUTCDateTime(),"months").months:this.toUTCDateTime().diff(t.toUTCDateTime(),"minutes").minutes;case"seconds":case"second":case"s":return this.toUTCDateTime().diff(t.toUTCDateTime(),"seconds").seconds;case"milliseconds":case"millisecond":case"ms":default:return this.toUTCDateTime().diff(t.toUTCDateTime(),"milliseconds").milliseconds;case"hours":case"hour":case"h":return this.toUTCDateTime().diff(t.toUTCDateTime(),"hours").hours;case"years":case"year":case"y":return this.toUTCDateTime().diff(t.toUTCDateTime(),"years").years}}}},33134:function(t,e,i){i.d(e,{z:function(){return a}});var n=i(21609),r=i(49077),s=i(74697),o=i(76613);class a{static fromOptimized(t,e,i=!1,n=!1,r=1){return(new l).initialize(t,e,i,n,r)}static fromJSON(t,e=!1,i=!1){const[n,r]=c(t);return(new h).initialize(n,r,e,i,1)}static fromOptimizedCIM(t,e,i=!1,n=!1,r=1){return(new d).initialize(t,e,i,n,r)}static fromJSONCIM(t,e=!1,i=!1,n=1){const[r,s]=c(t);return(new f).initialize(r,s,e,i,n)}static fromFeatureSetReader(t){const e=t.readGeometryForDisplay(),i=t.geometryType;return e&&i?this.fromOptimized(e,i):null}static fromFeatureSetReaderCIM(t){const e=t.readGeometryForDisplay(),i=t.geometryType;return e&&i?this.fromOptimizedCIM(e,i):null}static createEmptyOptimized(t,e=!1,i=!1,n=1){return(new l).initialize(new o.A,t,e,i,n)}static createEmptyJSON(t,e=!1,i=!1){return(new h).initialize([],t,e,i,1)}static createEmptyOptimizedCIM(t,e=!1,i=!1,n=1){return(new d).initialize(new o.A,t,e,i,n)}static createEmptyJSONCIM(t,e=!1,i=!1,n=1){return(new f).initialize([],t,e,i,n)}asJSON(){const t=(0,r.x)(this);return"esriGeometryEnvelope"===this.geometryType?{xmin:t[0][0][0],ymin:t[0][0][1],xmax:t[0][2][0],ymax:t[0][2][1]}:"esriGeometryMultipoint"===this.geometryType?{points:t.flat()}:"esriGeometryPoint"===this.geometryType?{x:t[0][0][0],y:t[0][0][1]}:"esriGeometryPolygon"===this.geometryType?{rings:t}:{paths:t}}getCurrentRingArea(){if(this.pathSize<3)return 0;let t,e,i=0;if(this.seekPathStart(),!this.nextPoint())return 0;t=this.x,e=this.y;const n=t,r=e;for(;this.nextPoint();)i+=(t-this.x)*(e+this.y),t=this.x,e=this.y;return i+=(t-n)*(e+r),-.5*i}invertY(){this.yFactor*=-1}}class l extends a{constructor(){super(...arguments),this._end=-1}initialize(t,e,i,n,r){return this.hasZ=i,this.hasM=n,this.geometryType=e,this._stride=2+Number(i)+Number(n),this._geometry=t,this._pathIndex=-1,this._pathOffset=0,this._pointOffset=-this._stride,this._end=-1,this.yFactor=r,this}reset(){this.initialize(this._geometry,this.geometryType,this.hasZ,this.hasM,this.yFactor)}seekPath(t){if(t>=0&&t<this.totalSize){if(this._pathIndex<t)for(;this._pathIndex<t&&this.nextPath(););else if(this._pathIndex>t)for(;this._pathIndex>t&&this.prevPath(););return!0}return!1}seekPathStart(){this._pointOffset=this._pathOffset-this._stride}seekPathEnd(){this._pointOffset=this._end}seekInPath(t){const e=this._pathOffset+t*this._stride;return e>=0&&e<this._end&&(this._pointOffset=e,!0)}nextPoint(){return(this._pointOffset+=this._stride)<this._end}prevPoint(){return(this._pointOffset-=this._stride)>=this._pathOffset}nextPath(){return!(this.pathIndex>=this.totalSize-1||(this._pathIndex>=0&&(this._pathOffset+=this._stride*this.pathSize),this._pathIndex++,this._pointOffset=this._pathOffset-this._stride,this._end=this._pointOffset+this._stride+this._stride*this.pathSize,0))}prevPath(){return!(this.pathIndex<=0||(this._pathIndex--,this._end=this._pathOffset,this._pathOffset-=this._stride*this.pathSize,this._pointOffset=this._pathOffset-this._stride,0))}getCurrentPath(){const t=this._end,e=this._geometry.coords,i=this._pathOffset;return(new l).initialize(new o.A([this.pathSize],e.slice(i,t)),this.geometryType,this.hasZ,this.hasM,this.yFactor)}pathLength(){const t=this._end,e=this._stride,i=this._geometry.coords;let n=0;for(let r=this._pathOffset+e;r<t;r+=e){const t=i[r-e],s=i[r-e+1],o=i[r]-t,a=i[r+1]-s;n+=Math.sqrt(o*o+a*a)}return n}startPath(){this._geometry.lengths.push(0)}pushPath(t){this.startPath(),this.pushPoints(t)}pushPoint(t){for(let e=0;e<this._stride;++e)this._geometry.coords.push(t[e]);this._geometry.lengths[this.totalSize-1]++}pushXY(t,e){this._geometry.coords.push(t,e),this._geometry.lengths[this.totalSize-1]++}pushPoints(t){for(const e of t)for(let t=0;t<this._stride;++t)this._geometry.coords.push(e[t]);this._geometry.lengths[this.totalSize-1]+=t.length}pushCursor(t){const e=t.asOptimized();this._geometry.coords.push(...e.coords),this._geometry.lengths.push(...e.lengths)}asOptimized(){const t=this._geometry.clone();if(1!==this.yFactor)for(let e=1;e<t.coords.length;e+=this._stride)t.coords[e]*=this.yFactor;return"esriGeometryPoint"===this.geometryType&&(t.lengths.length=0),t}isClosed(){const t=this._geometry.coords,e=this._pathOffset,i=this._end-this._stride;for(let n=0;n<this._stride;n++)if(t[e+n]!==t[i+n])return!1;return!0}clone(){return(new l).initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._geometry.isPoint?1:this._geometry.lengths.reduce(((t,e)=>t+e))}get pathSize(){const{lengths:t}=this._geometry;return this._geometry.isPoint?1:this._pathIndex<0||this._pathIndex>t.length-1?0:t[this._pathIndex]}get totalSize(){return this._geometry.isPoint?1:this._geometry.lengths.length}get x(){return this._geometry.coords[this._pointOffset]}set x(t){this._geometry.coords[this._pointOffset]=t}get y(){return this.yFactor*this._geometry.coords[this._pointOffset+1]}set y(t){this._geometry.coords[this._pointOffset+1]=this.yFactor*t}get z(){return this._geometry.coords[this._pointOffset+2]}set z(t){this._geometry.coords[this._pointOffset+2]=t}get m(){const t=this.hasZ?3:2;return this._geometry.coords[this._pointOffset+t]}set m(t){this._geometry.coords[this._pointOffset+3]=t}get pathIndex(){return this._pathIndex}get _coordIndex(){return this._pointOffset/this._stride}}function u(t){const e=[t.x,t.y];return t.z&&e.push(t.z),t.m&&e.push(t.m),e}function c(t){return(0,s.Bi)(t)?[t.rings,"esriGeometryPolygon"]:(0,s.Rg)(t)?[t.paths,"esriGeometryPolyline"]:(0,s.U9)(t)?[[t.points],"esriGeometryMultipoint"]:(0,s.ZC)(t)?[[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]],"esriGeometryEnvelope"]:(0,s.fT)(t)?[[[u(t)]],"esriGeometryPoint"]:[[],"esriGeometryPolyline"]}class h extends a{initialize(t,e,i,n,r){return this._paths=t,this.geometryType=e,this.hasZ=i,this.hasM=n,this._pathIndex=this._pointIndex=-1,this.yFactor=r,this._mIndex=this.hasZ?3:2,this}reset(){this._pathIndex=this._pointIndex=-1}seekPath(t){return this._pathIndex=t,this._pointIndex=-1,t>=0&&t<this.totalSize&&(this._currentPath=this._paths[t],!0)}seekPathStart(){this._pointIndex=-1}seekPathEnd(){this._pointIndex=this._currentPath.length}seekInPath(t){return t>=0&&t<this._currentPath.length&&(this._pointIndex=t,this._currentPoint=this._currentPath[this._pointIndex],!0)}nextPoint(){return this._currentPoint=this._currentPath[++this._pointIndex],this._pointIndex<this._currentPath.length}prevPoint(){return this._currentPoint=this._currentPath[--this._pointIndex],this._pointIndex>=0}nextPath(){return this._pointIndex=-1,this._currentPath=this._paths[++this._pathIndex],this._pathIndex<this.totalSize}prevPath(){return this.pathIndex>0&&(this._pointIndex=-1,this._pathIndex--,this._currentPath=this._paths[this._pathIndex],!0)}pathLength(){const t=this._currentPath.length,e=this._currentPath;let i=0;for(let n=1;n<t;n++){const t=e[n-1],r=e[n],s=t[0],o=t[1],a=r[0]-s,l=r[1]-o;i+=Math.sqrt(a*a+l*l)}return i}startPath(){this._paths.push([])}getCurrentPath(){return(new h).initialize([this._currentPath],this.geometryType,this.hasZ,this.hasM,this.yFactor)}pushPath(t){this._paths.push(t)}pushPoint(t){this._paths[this.totalSize-1].push(t)}pushXY(t,e){this._paths[this.totalSize-1].push([t,e])}pushPoints(t){this._paths[this.totalSize-1].push(...t)}pushCursor(t){const e=(0,r.x)(t);for(const t of e)this.pushPath(t)}asOptimized(){const t=new o.A;if("esriGeometryPoint"===this.geometryType)t.coords.push(...this._paths[0][0]),t.lengths.length=0;else for(const e of this._paths){for(const i of e)t.coords.push(i[0]),t.coords.push(i[1]*this.yFactor),this.hasZ&&t.coords.push(i[2]),this.hasM&&t.coords.push(i[this._mIndex]);t.lengths.push(e.length)}return t}isClosed(){const t=this._currentPath[0],e=this._currentPath[this._currentPath.length-1];for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}clone(){return(new h).initialize((0,n.o8)(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._paths.map((t=>t.length)).reduce(((t,e)=>t+e))}get pathSize(){return this._pathIndex<0||this._pathIndex>this.totalSize-1?-1:this._paths[this._pathIndex].length}get totalSize(){return this._paths.length}get x(){return this._currentPoint[0]}set x(t){this._currentPoint[0]=t}get y(){return this.yFactor*this._currentPoint[1]}set y(t){this._currentPoint[1]=this.yFactor*t}get z(){return this._currentPoint[2]}set z(t){this._currentPoint[2]=t}get m(){return this._currentPoint[this._mIndex]}set m(t){this._currentPoint[this._mIndex]=t}get pathIndex(){return this._pathIndex}}class d extends l{initialize(t,e,i,n,r){return super.initialize(t,e,i,n,r),this._controlPoints||(this._controlPoints=this._controlPoints=new Array(this.totalSize).fill(void 0).map((t=>new Set))),this}startPath(){super.startPath(),this._controlPoints.push(new Set)}clone(){const t=(new d).initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor);return t._controlPoints=this._controlPoints,t}setControlPoint(){this._controlPoints[this.pathIndex].add(this._coordIndex)}getControlPoint(){return this._controlPoints[this.pathIndex].has(this._coordIndex)}setControlPointAt(t){this._controlPoints[this.pathIndex].add(t)}getControlPointAt(t){return this._controlPoints[this.pathIndex].has(t)}}class f extends h{initialize(t,e,i,n,r){return super.initialize(t,e,i,n,r)}clone(){return(new f).initialize((0,n.o8)(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}setControlPoint(){this._paths[this.pathIndex][this._pointIndex][4]=1}getControlPoint(){return 1===this._paths[this.pathIndex][this._pointIndex][4]}setControlPointAt(t){this._paths[this.pathIndex][t][4]=1}getControlPointAt(t){return 1===this._paths[this.pathIndex][t][4]}}},86029:function(t,e,i){i.d(e,{g:function(){return n}});const n={convertToGEGeometry:function(t,e){return null==e?null:t.convertJSONToGeometry(e)},exportPoint:function(t,e,i){const n=new r(t.getPointX(e),t.getPointY(e),i),s=t.hasZ(e),o=t.hasM(e);return s&&(n.z=t.getPointZ(e)),o&&(n.m=t.getPointM(e)),n},exportPolygon:function(t,e,i){return new s(t.exportPaths(e),i,t.hasZ(e),t.hasM(e))},exportPolyline:function(t,e,i){return new o(t.exportPaths(e),i,t.hasZ(e),t.hasM(e))},exportMultipoint:function(t,e,i){return new a(t.exportPoints(e),i,t.hasZ(e),t.hasM(e))},exportExtent:function(t,e,i){const n=t.hasZ(e),r=t.hasM(e),s=new l(t.getXMin(e),t.getYMin(e),t.getXMax(e),t.getYMax(e),i);if(n){const i=t.getZExtent(e);s.zmin=i.vmin,s.zmax=i.vmax}if(r){const i=t.getMExtent(e);s.mmin=i.vmin,s.mmax=i.vmax}return s}};class r{constructor(t,e,i){this.x=t,this.y=e,this.spatialReference=i,this.z=void 0,this.m=void 0}}class s{constructor(t,e,i,n){this.rings=t,this.spatialReference=e,this.hasZ=void 0,this.hasM=void 0,i&&(this.hasZ=i),n&&(this.hasM=n)}}class o{constructor(t,e,i,n){this.paths=t,this.spatialReference=e,this.hasZ=void 0,this.hasM=void 0,i&&(this.hasZ=i),n&&(this.hasM=n)}}class a{constructor(t,e,i,n){this.points=t,this.spatialReference=e,this.hasZ=void 0,this.hasM=void 0,i&&(this.hasZ=i),n&&(this.hasM=n)}}class l{constructor(t,e,i,n,r){this.xmin=t,this.ymin=e,this.xmax=i,this.ymax=n,this.spatialReference=r,this.zmin=void 0,this.zmax=void 0,this.mmin=void 0,this.mmax=void 0}}},30804:function(t,e,i){i.d(e,{d:function(){return u}});var n=i(87416),r=i(35068),s=i(72228),o=i(38441),a=i(96127);const l=222045e-19;function u(t){if(0===t.totalSize)return null;const e=(0,r.z8)(t);if(!e)return null;const i=4*(Math.abs(e[0])+Math.abs(e[2])+Math.abs(e[1])+Math.abs(e[3])+1)*l;let o=0,a=0;t.reset();for(let e=0;t.nextPath();e++){const i=t.getCurrentRingArea();i>a&&(a=i,o=e)}if(t.seekPath(o),0===t.pathSize)return null;t.seekPathStart();const u=(0,r.B$)(t);if(Math.abs(a)<=2*i*i)return[(u[0]+u[2])/2,(u[1]+u[3])/2];t.seekPathStart();const f=(0,s.w2)(t,(0,n.vt)());if(null===f)return null;if(t.totalPoints<4)return f;const p=[[NaN,NaN],[NaN,NaN],[NaN,NaN],[NaN,NaN]],_=[NaN,NaN,NaN,NaN],m=[NaN,NaN,NaN,NaN];let g=!1,y=h(f,t,!0);0===y.distance&&(g=!0,p[0][0]=f[0],p[0][1]=f[1],y=h(f,t,!1)),_[0]=y.distance,m[0]=0;const v=[NaN,NaN];let w=!1,T=.25,P=-1,I=NaN;do{if(I=NaN,p[1]=d(t,x(u[0],u[2],T),0,e),isNaN(p[1][0])||isNaN(p[1][1])||(y=h(p[1],t,!1),I=y.distance),!isNaN(I)&&I>i&&c(p[1],t))w=!0,_[1]=I,m[1]=b(p[1],f);else if(!isNaN(I)&&I>P&&(P=I,v[0]=p[1][0],v[1]=p[1][1]),T-=.01,T<.1){if(!(P>=0))break;w=!0,_[1]=P,p[1][0]=v[0],p[1][1]=v[1],m[1]=b(p[1],f)}}while(!w);w=!1,T=.5,P=-1;let M=.01,A=1;do{if(I=NaN,p[2]=d(t,x(u[0],u[2],T),0,e),isNaN(p[2][0])||isNaN(p[2][1])||(y=h(p[2],t,!1),I=y.distance),!isNaN(I)&&I>i&&c(p[2],t))w=!0,_[2]=I,m[2]=b(p[2],f);else if(!isNaN(I)&&I>P)P=I,v[0]=p[2][0],v[1]=p[2][1];else if(I>P&&(P=I,v[0]=p[2][0],v[1]=p[2][1]),T=.5+M*A,M+=.01,A*=-1,T<.3||T>.7){if(!(P>=0))break;w=!0,_[2]=P,p[2][0]=v[0],p[2][1]=v[1],m[2]=b(p[2],f)}}while(!w);w=!1,T=.75,P=-1;do{if(I=NaN,p[3]=d(t,x(u[0],u[2],T),0,e),isNaN(p[3][0])||isNaN(p[3][1])||(y=h(p[3],t,!1),I=y.distance),!isNaN(I)&&I>i&&c(p[3],t))w=!0,_[3]=I,m[3]=b(p[3],f);else if(I>P&&(P=I,v[0]=p[3][0],v[1]=p[3][1]),T+=.01,T>.9){if(!(P>=0))break;w=!0,_[3]=P,p[3][0]=v[0],p[3][1]=v[1],m[3]=b(p[3],f)}}while(!w);const C=[0,1,2,3],E=g?0:1;let R;for(let t=E;t<4;t++)for(let t=E;t<3;t++){const e=m[t],i=m[t+1];S(e,i)>0&&(R=C[t],C[t]=C[t+1],C[t+1]=R,m[t]=i,m[t+1]=e)}let O=E,z=0,D=0;for(let t=E;t<4;t++){switch(t){case 0:D=2*_[C[t]];break;case 1:D=1.66666666*_[C[t]];break;case 2:D=1.33333333*_[C[t]];break;case 3:D=_[C[t]]}D>z&&(z=D,O=C[t])}return p[O]}function c(t,e){let i,n,r,s,o=0;for(e.reset();e.nextPath()&&e.nextPoint();)for(i=e.x,n=e.y;e.nextPoint();i=r,n=s)r=e.x,s=e.y,n>t[1]!=s>t[1]&&((r-i)*(t[1]-n)-(s-n)*(t[0]-i)>0?o++:o--);return 0!==o}function h(t,e,i){if(i&&c(t,e))return{coord:t,distance:0};let n=1/0,r=0,s=0,a=[0,0],l=[0,0];const u=[0,0];for(e.reset();e.nextPath()&&e.nextPoint();)if(!(e.pathSize<2))for(a[0]=e.x,a[1]=e.y;e.nextPoint();a=l){l=[e.x,e.y],(0,o.gR)(u,t,a,l);const i=b(t,u);i<n&&(n=i,r=u[0],s=u[1])}return{coord:[r,s],distance:Math.sqrt(n)}}function d(t,e,i,r){const s=[e,0];let o=1/0,l=1/0,u=!1,c=!1;const h=[[e,r[1]-1],[e,r[3]+1]],d=[0,0],p=[0,0],_=[0,0],m=[[0,0],[0,0]],g=(0,n.vt)();for(t.reset();t.nextPath()&&t.nextPoint();)if(!(t.pathSize<2))for(m[0][0]=t.x,m[0][1]=t.y;t.nextPoint();m[0][0]=m[1][0],m[0][1]=m[1][1]){if(m[1][0]=t.x,m[1][1]=t.y,null===f(g,m))continue;if(p[0]=h[0][0],p[1]=h[0][1],_[0]=h[1][0],_[1]=h[1][1],0===y(g,p,_))continue;if(!(0,a.Ql)(h[0],h[1],m[0],m[1],d))continue;const e=d[1];o>l?e<o&&(o=e,u=!0):e<l&&(l=e,c=!0)}return u&&c?s[1]=(o+l)/2:s[0]=s[1]=NaN,s}function f(t,e){if(e.length<2)return null;t||(t=(0,n.vt)());const[i,r]=e[0],[s,o]=e[1];return t[0]=Math.min(i,s),t[1]=Math.min(r,o),t[2]=Math.max(i,s),t[3]=Math.max(r,o),t}const p=1,_=4,m=3,g=12;function y(t,e,i){let n=v(e,t),r=v(i,t);const s=t[0],o=t[1],a=t[2],l=t[3];if(n&r)return 0;if(!(n|r))return 4;const u=(n?1:0)|(r?2:0);do{const u=i[0]-e[0],c=i[1]-e[1];if(u>c)n&m?(n&p?(e[1]+=c*(s-e[0])/u,e[0]=s):(e[1]+=c*(a-e[0])/u,e[0]=a),n=v(e,t)):r&m?(r&p?(i[1]+=c*(s-i[0])/u,i[0]=s):(i[1]+=c*(a-i[0])/u,i[0]=a),r=v(i,t)):n?(n&_?(e[0]+=u*(o-e[1])/c,e[1]=o):(e[0]+=u*(l-e[1])/c,e[1]=l),n=v(e,t)):(r&_?(i[0]+=u*(o-i[1])/c,i[1]=o):(i[0]+=u*(l-i[1])/c,i[1]=l),r=v(i,t));else if(n&g?(n&_?(e[0]+=u*(o-e[1])/c,e[1]=o):(e[0]+=u*(l-e[1])/c,e[1]=l),n=v(e,t)):r&g?(r&_?(i[0]+=u*(o-i[1])/c,i[1]=o):(i[0]+=u*(l-i[1])/c,i[1]=l),r=v(i,t)):n?(n&p?(e[1]+=c*(s-e[0])/u,e[0]=s):(e[1]+=c*(a-e[0])/u,e[0]=a),n=v(e,t)):(r&p?(i[1]+=c*(s-i[0])/u,i[0]=s):(i[1]+=c*(a-i[0])/u,i[0]=a),r=v(i,t)),n&r)return 0}while(n|r);return u}function v(t,e){return(t[0]<e[0]?1:0)|(t[0]>e[2]?1:0)<<1|(t[1]<e[1]?1:0)<<2|(t[1]>e[3]?1:0)<<3}function x(t,e,i){return t+(e-t)*i}function b(t,e){return(t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])}function S(t,e){if(t<e)return-1;if(t>e)return 1;if(t===e)return 0;const i=isNaN(t),n=isNaN(e);return i<n?-1:i>n?1:0}},80207:function(t,e,i){i.d(e,{b3:function(){return h},jZ:function(){return c}});var n=i(30905),r=i(87416),s=i(35068),o=i(38441),a=i(74697),l=i(65417),u=i(57652);function c(t){return d(t,!0)}function h(t){return d(t,!1)}function d(t,e){if(null==t)return null;const i=t.spatialReference,r=(0,u.Vp)(i),o=(0,n.Wj)(t)?t.toJSON():t;if(!r)return o;const c=(0,u.K8)(i)?102100:4326,h=l.j7[c].maxX,d=l.j7[c].minX;if((0,a.fT)(o))return p(o,h,d);if((0,a.U9)(o))return o.points=o.points.map((t=>p(t,h,d))),o;if((0,a.ZC)(o))return f(o,r);if((0,a.Bi)(o)||(0,a.Rg)(o)){const t=(0,s.Rg)(x,o),i={xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3]},n=(0,l.kd)(i.xmin,d)*(2*h),r=0===n?o:(0,l.kS)(o,n);return i.xmin+=n,i.xmax+=n,i.xmax>h?y(r,h,e):i.xmin<d?y(r,d,e):r}return o}function f(t,e){if(!e)return t;const i=function(t,e){const i=[],{ymin:n,ymax:r,xmin:s,xmax:o}=t,a=t.xmax-t.xmin,[l,u]=e.valid,{x:c,frameId:h}=_(t.xmin,e),{x:d,frameId:f}=_(t.xmax,e),p=c===d&&a>0;if(a>2*u){const t={xmin:s<o?c:d,ymin:n,xmax:u,ymax:r},e={xmin:l,ymin:n,xmax:s<o?d:c,ymax:r},a={xmin:0,ymin:n,xmax:u,ymax:r},p={xmin:l,ymin:n,xmax:0,ymax:r},_=[],g=[];m(t,a)&&_.push(h),m(t,p)&&g.push(h),m(e,a)&&_.push(f),m(e,p)&&g.push(f);for(let t=h+1;t<f;t++)_.push(t),g.push(t);i.push(new v(t,[h]),new v(e,[f]),new v(a,_),new v(p,g))}else c>d||p?i.push(new v({xmin:c,ymin:n,xmax:u,ymax:r},[h]),new v({xmin:l,ymin:n,xmax:d,ymax:r},[f])):i.push(new v({xmin:c,ymin:n,xmax:d,ymax:r},[h]));return i}(t,e).map((t=>t.extent));return i.length<2?i[0]||t:i.length>2?(t.xmin=e.valid[0],t.xmax=e.valid[1],t):{rings:i.map((t=>[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]))}}function p(t,e,i){if(Array.isArray(t)){const n=t[0];if(n>e){const i=(0,l.kd)(n,e);t[0]=n+i*(-2*e)}else if(n<i){const e=(0,l.kd)(n,i);t[0]=n+e*(-2*i)}}else{const n=t.x;if(n>e){const i=(0,l.kd)(n,e);t.x+=i*(-2*e)}else if(n<i){const e=(0,l.kd)(n,i);t.x+=e*(-2*i)}}return t}function _(t,e){const[i,n]=e.valid,r=2*n;let s,o=0;return t>n?(s=Math.ceil(Math.abs(t-n)/r),t-=s*r,o=s):t<i&&(s=Math.ceil(Math.abs(t-i)/r),t+=s*r,o=-s),{x:t,frameId:o}}function m(t,e){const{xmin:i,ymin:n,xmax:r,ymax:s}=e;return g(t,i,n)&&g(t,i,s)&&g(t,r,s)&&g(t,r,n)}function g(t,e,i){return e>=t.xmin&&e<=t.xmax&&i>=t.ymin&&i<=t.ymax}function y(t,e,i=!0){const n=!(0,a.Rg)(t);if(n&&(0,o.m3)(t),i)return(new b).cut(t,e);const r=n?t.rings:t.paths,s=n?4:2,l=r.length,u=-2*e;for(let t=0;t<l;t++){const e=r[t];if(e&&e.length>=s){const t=[];for(const i of e)t.push([i[0]+u,i[1]]);r.push(t)}}return n?t.rings=r:t.paths=r,t}class v{constructor(t,e){this.extent=t,this.frameIds=e}}const x=(0,r.vt)();class b{constructor(){this._linesIn=[],this._linesOut=[]}cut(t,e){let i;if(this._xCut=e,t.rings)this._closed=!0,i=t.rings,this._minPts=4;else{if(!t.paths)return null;this._closed=!1,i=t.paths,this._minPts=2}for(const t of i){if(!t||t.length<this._minPts)continue;let e=!0;for(const i of t)e?(this.moveTo(i),e=!1):this.lineTo(i);this._closed&&this.close()}this._pushLineIn(),this._pushLineOut(),i=[];for(const t of this._linesIn)t&&t.length>=this._minPts&&i.push(t);const n=-2*this._xCut;for(const t of this._linesOut)if(t&&t.length>=this._minPts){for(const e of t)e[0]+=n;i.push(t)}return this._closed?t.rings=i:t.paths=i,t}moveTo(t){this._pushLineIn(),this._pushLineOut(),this._prevSide=this._side(t[0]),this._moveTo(t[0],t[1],this._prevSide),this._prevPt=t,this._firstPt=t}lineTo(t){const e=this._side(t[0]);if(e*this._prevSide==-1){const i=this._intersect(this._prevPt,t);this._lineTo(this._xCut,i,0),this._prevSide=0,this._lineTo(t[0],t[1],e)}else this._lineTo(t[0],t[1],e);this._prevSide=e,this._prevPt=t}close(){const t=this._firstPt,e=this._prevPt;t[0]===e[0]&&t[1]===e[1]||this.lineTo(t),this._checkClosingPt(this._lineIn),this._checkClosingPt(this._lineOut)}_moveTo(t,e,i){this._closed?(this._lineIn.push([i<=0?t:this._xCut,e]),this._lineOut.push([i>=0?t:this._xCut,e])):(i<=0&&this._lineIn.push([t,e]),i>=0&&this._lineOut.push([t,e]))}_lineTo(t,e,i){this._closed?(S(this._lineIn,i<=0?t:this._xCut,e),S(this._lineOut,i>=0?t:this._xCut,e)):i<0?(0===this._prevSide&&this._pushLineOut(),this._lineIn.push([t,e])):i>0?(0===this._prevSide&&this._pushLineIn(),this._lineOut.push([t,e])):this._prevSide<0?(this._lineIn.push([t,e]),this._lineOut.push([t,e])):this._prevSide>0&&(this._lineOut.push([t,e]),this._lineIn.push([t,e]))}_checkClosingPt(t){const e=t.length;e>3&&t[0][0]===this._xCut&&t[e-2][0]===this._xCut&&t[1][0]===this._xCut&&(t[0][1]=t[e-2][1],t.pop())}_side(t){return t<this._xCut?-1:t>this._xCut?1:0}_intersect(t,e){const i=(this._xCut-t[0])/(e[0]-t[0]);return t[1]+i*(e[1]-t[1])}_pushLineIn(){this._lineIn&&this._lineIn.length>=this._minPts&&this._linesIn.push(this._lineIn),this._lineIn=[]}_pushLineOut(){this._lineOut&&this._lineOut.length>=this._minPts&&this._linesOut.push(this._lineOut),this._lineOut=[]}}function S(t,e,i){const n=t.length;n>1&&t[n-1][0]===e&&t[n-2][0]===e?t[n-1][1]=i:t.push([e,i])}},36729:function(t,e,i){i.d(e,{$B:function(){return d}});var n=i(53804),r=i(83525),s=i(58941),o=i(21609),a=i(40633),l=i(23502),u=i(65953),c=i(70994),h=i(25128);let d=class extends r.A{constructor(t){super(t),this._from=null,this._to=null,this._final=null,this._current=[],this._time=0,this.duration=(0,s.A)("mapview-transitions-duration"),this.effects=[]}set effect(t){if(this._get("effect")!==(t=t||"")){this._set("effect",t);try{this._transitionTo(f(t))}catch(e){this._transitionTo([]),a.A.getLogger(this).warn("Invalid Effect",{effect:t,error:e})}}}get final(){return this._final}get hasEffects(){return this.transitioning||!!this.effects.length}set scale(t){this._updateForScale(t)}get transitioning(){return null!==this._to}canTransitionTo(t){try{return this.scale>0&&p(this._current,f(t),this.scale)}catch{return!1}}transitionStep(t,e){this._applyTimeTransition(t),this._updateForScale(e)}endTransition(){this._applyTimeTransition(this.duration)}_transitionTo(t){this.scale>0&&p(this._current,t,this.scale)?(this._final=t,this._to=(0,o.o8)(t),function(t,e,i){const n=t.length>e.length?t:e,r=t.length>e.length?e:t,s=r[r.length-1],o=s?.scale??i,a=s?.effects??[];for(let t=r.length;t<n.length;t++)r.push({scale:o,effects:[...a]});for(let t=0;t<n.length;t++)r[t].scale=-1===r[t].scale?i:r[t].scale,n[t].scale=-1===n[t].scale?i:n[t].scale,(0,h.O9)(r[t].effects,n[t].effects)}(this._current,this._to,this.scale),this._from=(0,o.o8)(this._current),this._time=0):(this._from=this._to=this._final=null,this._current=t),this._set("effects",this._current[0]?(0,o.o8)(this._current[0].effects):[])}_applyTimeTransition(t){if(!(this._to&&this._from&&this._current&&this._final))return;this._time+=t;const e=Math.min(1,this._time/this.duration);for(let t=0;t<this._current.length;t++){const i=this._current[t],n=this._from[t],r=this._to[t];i.scale=_(n.scale,r.scale,e);for(let t=0;t<i.effects.length;t++){const s=i.effects[t],o=n.effects[t],a=r.effects[t];s.interpolate(o,a,e)}}1===e&&(this._current=this._final,this._set("effects",this._current[0]?(0,o.o8)(this._current[0].effects):[]),this._from=this._to=this._final=null)}_updateForScale(t){if(this._set("scale",t),0===this._current.length)return;const e=this._current,i=this._current.length-1;let n,r,s=1;if(1===e.length||t>=e[0].scale)r=n=e[0].effects;else if(t<=e[i].scale)r=n=e[i].effects;else for(let o=0;o<i;o++){const i=e[o],a=e[o+1];if(i.scale>=t&&a.scale<=t){s=(t-i.scale)/(a.scale-i.scale),n=i.effects,r=a.effects;break}}for(let t=0;t<this.effects.length;t++)this.effects[t].interpolate(n[t],r[t],s)}};function f(t){const e=(0,c.q)(t)||[];return function(t){const e=t[0];return!!e&&"type"in e}(e)?[{scale:-1,effects:e}]:e}function p(t,e,i){return!t[0]?.effects||!e[0]?.effects||!((-1===t[0]?.scale||-1===e[0]?.scale)&&(t.length>1||e.length>1)&&i<=0)&&(0,h.mj)(t[0].effects,e[0].effects)}function _(t,e,i){return t+(e-t)*i}(0,n._)([(0,l.MZ)()],d.prototype,"_to",void 0),(0,n._)([(0,l.MZ)()],d.prototype,"duration",void 0),(0,n._)([(0,l.MZ)({value:""})],d.prototype,"effect",null),(0,n._)([(0,l.MZ)({readOnly:!0})],d.prototype,"effects",void 0),(0,n._)([(0,l.MZ)({readOnly:!0})],d.prototype,"final",null),(0,n._)([(0,l.MZ)({readOnly:!0})],d.prototype,"hasEffects",null),(0,n._)([(0,l.MZ)({value:0})],d.prototype,"scale",null),(0,n._)([(0,l.MZ)({readOnly:!0})],d.prototype,"transitioning",null),d=(0,n._)([(0,u.$)("esri.layers.effects.EffectView")],d)},65215:function(t,e,i){i.d(e,{N3:function(){return s},Om:function(){return r}});var n=i(76613);class r{constructor(t=null,e={},i,n){this.geometry=t,this.attributes=e,this.centroid=i,this.objectId=n,this.displayId=0,this.geohashX=0,this.geohashY=0}static fromJSON(t,e){const i=t.geometry?n.A.fromJSON(t.geometry):null,s=t.centroid?n.A.fromJSON(t.centroid):null,o=t.attributes[e];return new r(i,t.attributes,s,o)}weakClone(){const t=new r(this.geometry,this.attributes,this.centroid,this.objectId);return t.displayId=this.displayId,t.geohashX=this.geohashX,t.geohashY=this.geohashY,t}clone(){const t=this.geometry?.clone(),e=new r(t,{...this.attributes},this.centroid?.clone(),this.objectId);return e.displayId=this.displayId,e.geohashX=this.geohashX,e.geohashY=this.geohashY,e}}function s(t){return!!t.geometry?.coords?.length}},72887:function(t,e,i){i.d(e,{A:function(){return n}});class n{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const t=new n;return t.objectIdFieldName=this.objectIdFieldName,t.globalIdFieldName=this.globalIdFieldName,t.geohashFieldName=this.geohashFieldName,t.geometryProperties=this.geometryProperties,t.geometryType=this.geometryType,t.spatialReference=this.spatialReference,t.hasZ=this.hasZ,t.hasM=this.hasM,t.features=this.features,t.fields=this.fields,t.transform=this.transform,t.exceededTransferLimit=this.exceededTransferLimit,t.uniqueIdField=this.uniqueIdField,t.queryGeometry=this.queryGeometry,t.queryGeometryType=this.queryGeometryType,t}}},76613:function(t,e,i){i.d(e,{A:function(){return n}});class n{constructor(t=[],e=[]){this.lengths=t??[],this.coords=e??[]}static fromJSON(t){return new n(t.lengths,t.coords)}static fromRect(t){const[e,i,r,s]=t,o=r-e,a=s-i;return new n([5],[e,i,o,0,0,a,-o,0,0,-a])}get isPoint(){return 0===this.lengths.length&&this.coords.length>=2}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce(((t,e)=>t+e))}forEachVertex(t){let e=0;this.lengths.length||t(this.coords[0],this.coords[1]);for(let i=0;i<this.lengths.length;i++){const n=this.lengths[i];for(let i=0;i<n;i++)t(this.coords[2*(i+e)],this.coords[2*(i+e)+1]);e+=n}}deltaDecode(){const t=this.clone(),{coords:e,lengths:i}=t;let n=0;for(const t of i){for(let i=1;i<t;i++)e[2*(n+i)]+=e[2*(n+i)-2],e[2*(n+i)+1]+=e[2*(n+i)-1];n+=t}return t}clone(t){if(0===this.lengths.length)return new n([],[this.coords[0],this.coords[1]]);const e=2*(0===this.lengths.length?1:this.lengths.reduce(((t,e)=>t+e))),i=this.coords.slice(0,e);return t?(t.set(i),new n(this.lengths,t)):new n(Array.from(this.lengths),Array.from(i))}}},40302:function(t,e,i){function n(t,e){return t?e?4:3:e?3:2}function r(t,e,i,r){if(!e?.lengths.length)return null;t.lengths.length&&(t.lengths.length=0),t.coords.length&&(t.coords.length=0);const a=t.coords,l=[],u=i?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:c,coords:h}=e,d=n(i,r);let f=0;for(const t of c){const e=s(u,h,f,t,i,r);e&&l.push(e),f+=t*d}if(l.sort(((t,e)=>{let n=t[2]-e[2];return 0===n&&i&&(n=t[4]-e[4]),n})),l.length){let t=6*l[0][2];a[0]=l[0][0]/t,a[1]=l[0][1]/t,i&&(t=6*l[0][4],a[2]=0!==t?l[0][3]/t:0),(a[0]<u[0]||a[0]>u[1]||a[1]<u[2]||a[1]>u[3]||i&&(a[2]<u[4]||a[2]>u[5]))&&(a.length=0)}if(!a.length){const t=e.lengths[0]?o(h,0,c[0],i,r):null;if(!t)return null;a[0]=t[0],a[1]=t[1],i&&t.length>2&&(a[2]=t[2])}return t}function s(t,e,i,r,s,o){const a=n(s,o);let l=i,u=i+a,c=0,h=0,d=0,f=0,p=0;for(let i=0,n=r-1;i<n;i++,l+=a,u+=a){const i=e[l],n=e[l+1],r=e[l+2],o=e[u],a=e[u+1],_=e[u+2];let m=i*a-o*n;f+=m,c+=(i+o)*m,h+=(n+a)*m,s&&(m=i*_-o*r,d+=(r+_)*m,p+=m),i<t[0]&&(t[0]=i),i>t[1]&&(t[1]=i),n<t[2]&&(t[2]=n),n>t[3]&&(t[3]=n),s&&(r<t[4]&&(t[4]=r),r>t[5]&&(t[5]=r))}if(f>0&&(f*=-1),p>0&&(p*=-1),!f)return null;const _=[c,h,.5*f];return s&&(_[3]=d,_[4]=.5*p),_}function o(t,e,i,r,s){const o=n(r,s);let h=e,d=e+o,f=0,p=0,_=0,m=0;for(let e=0,n=i-1;e<n;e++,h+=o,d+=o){const e=t[h],i=t[h+1],n=t[h+2],s=t[d],o=t[d+1],g=t[d+2],y=r?l(e,i,n,s,o,g):a(e,i,s,o);if(y)if(f+=y,r){const t=c(e,i,n,s,o,g);p+=y*t[0],_+=y*t[1],m+=y*t[2]}else{const t=u(e,i,s,o);p+=y*t[0],_+=y*t[1]}}return f>0?r?[p/f,_/f,m/f]:[p/f,_/f]:i>0?r?[t[e],t[e+1],t[e+2]]:[t[e],t[e+1]]:null}function a(t,e,i,n){const r=i-t,s=n-e;return Math.sqrt(r*r+s*s)}function l(t,e,i,n,r,s){const o=n-t,a=r-e,l=s-i;return Math.sqrt(o*o+a*a+l*l)}function u(t,e,i,n){return[t+.5*(i-t),e+.5*(n-e)]}function c(t,e,i,n,r,s){return[t+.5*(n-t),e+.5*(r-e),i+.5*(s-i)]}i.d(e,{Q:function(){return r}})},78956:function(t,e,i){i.d(e,{LQ:function(){return u},ag:function(){return h},pL:function(){return c}});var n=i(58081),r=i(76613);const s=new r.A,o=new r.A,a=new r.A,l={esriGeometryPoint:n.DF,esriGeometryPolyline:n.BW,esriGeometryPolygon:n.z5,esriGeometryMultipoint:n.qK};function u(t,e,i,r=t.hasZ,s=t.hasM){if(null==e)return null;const o=t.hasZ&&r,l=t.hasM&&s;if(i){const u=(0,n.Nl)(a,e,t.hasZ,t.hasM,"esriGeometryPoint",i,r,s);return(0,n.DF)(u,o,l)}return(0,n.DF)(e,o,l)}function c(t,e,i,r,u,c,h=e,d=i){const f=e&&h,p=i&&d,_=null!=r?"coords"in r?r:r.geometry:null;if(null==_)return null;if(u){let r=(0,n.kz)(o,_,e,i,t,u,h,d);return c&&(r=(0,n.Nl)(a,r,f,p,t,c)),l[t]?.(r,f,p)??null}if(c){const r=(0,n.Nl)(a,_,e,i,t,c,h,d);return l[t]?.(r,f,p)??null}return(0,n.Q4)(s,_,e,i,h,d),l[t]?.(s,f,p)??null}function h(t){return t&&d in t?JSON.parse(JSON.stringify(t,f)):t}const d="_geVersion",f=(t,e)=>t!==d?e:void 0},74841:function(t,e,i){i.d(e,{Cv:function(){return m},Nk:function(){return f},lK:function(){return y}});var n=i(50659),r=i(60539),s=i(46157),o=i(86029),a=i(57652),l=i(1644);const u=[0,0];function c(t,e){if(!e)return null;if("x"in e){const i={x:0,y:0};return[i.x,i.y]=t(e.x,e.y,u),null!=e.z&&(i.z=e.z),null!=e.m&&(i.m=e.m),i}if("xmin"in e){const i={xmin:0,ymin:0,xmax:0,ymax:0};return[i.xmin,i.ymin]=t(e.xmin,e.ymin,u),[i.xmax,i.ymax]=t(e.xmax,e.ymax,u),e.hasZ&&(i.zmin=e.zmin,i.zmax=e.zmax,i.hasZ=!0),e.hasM&&(i.mmin=e.mmin,i.mmax=e.mmax,i.hasM=!0),i}return"rings"in e?{rings:h(e.rings,t),hasM:e.hasM,hasZ:e.hasZ}:"paths"in e?{paths:h(e.paths,t),hasM:e.hasM,hasZ:e.hasZ}:"points"in e?{points:d(e.points,t),hasM:e.hasM,hasZ:e.hasZ}:null}function h(t,e){const i=[];for(const n of t)i.push(d(n,e));return i}function d(t,e){const i=[];for(const n of t){const t=e(n[0],n[1],[0,0]);i.push(t),n.length>2&&t.push(n[2]),n.length>3&&t.push(n[3])}return i}async function f(t,e){if(!t||!e)return;const i=Array.isArray(t)?t.map((t=>null!=t.geometry?t.geometry.spatialReference:null)).filter(n.Ru):[t];await(0,s.initializeProjection)(i.map((t=>({source:t,dest:e}))))}const p=c.bind(null,l.je),_=c.bind(null,l.tD);function m(t,e,i,n){if(!t)return t;if(i||(i=e,e=t.spatialReference),!(0,a.fn)(e)||!(0,a.fn)(i)||(0,a.aI)(e,i))return t;if((0,l.y7)(e,i)){const e=(0,a.K8)(i)?p(t):_(t);return e.spatialReference=i,e}return(0,s.projectMany)(o.g,[t],e,i,null,n)[0]}const g=new class{constructor(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}async push(t,e,i,n){if(!t?.length||!e||!i||(0,a.aI)(e,i))return t;const s={geometries:t,inSpatialReference:e,outSpatialReference:i,geographicTransformation:n,resolve:(0,r.Tw)()};return this._jobs.push(s),this._timer??=setTimeout(this._process,10),s.resolve.promise}_process(){this._timer=null;const t=this._jobs.shift();if(!t)return;const{geometries:e,inSpatialReference:i,outSpatialReference:n,resolve:r,geographicTransformation:u}=t;(0,l.y7)(i,n)?(0,a.K8)(n)?r(e.map(p)):r(e.map(_)):r((0,s.projectMany)(o.g,e,i,n,u,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}};function y(t,e,i,n){return g.push(t,e,i,n)}},20932:function(t,e,i){i.d(e,{GC:function(){return f},T2:function(){return p},VY:function(){return h},v8:function(){return d}});var n=i(73037),r=i(62938),s=i(46157),o=i(38503),a=i(74697),l=i(65298),u=i(57652),c=i(74841);const h=new n.J({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),d=Object.freeze({});async function f(t,e,i){const{outFields:n,orderByFields:r,groupByFieldsForStatistics:s,outStatistics:o}=t;if(n)for(let t=0;t<n.length;t++)n[t]=n[t].trim();if(r)for(let t=0;t<r.length;t++)r[t]=r[t].trim();if(s)for(let t=0;t<s.length;t++)s[t]=s[t].trim();if(o)for(let t=0;t<o.length;t++)o[t].onStatisticField&&(o[t].onStatisticField=o[t].onStatisticField.trim());return t.geometry&&!t.outSR&&(t.outSR=t.geometry.spatialReference),p(t,e,i)}async function p(t,e,n){if(!t)return null;let{where:s}=t;if(t.where=s=s?.trim(),(!s||/^1 *= *1$/.test(s)||e&&e===s)&&(t.where=null),!t.geometry)return t;let f=await async function(t){const{distance:e,units:n}=t,s=t.geometry;if(null==e||"vertexAttributes"in s)return s;const o=s.spatialReference,a=n?h.fromJSON(n):(0,r.Ij)(o),l=o&&((0,u.EA)(o)||(0,u.K8)(o))?s:await(0,c.Nk)(o,u.KK).then((()=>(0,c.Cv)(s,u.KK)));return(await async function(){return(await i.e(4696).then(i.bind(i,28356))).geodesicBuffer}())(l.spatialReference,l,e,a)}(t);if(t.distance=0,t.units=null,"esriSpatialRelEnvelopeIntersects"===t.spatialRel){const{spatialReference:e}=t.geometry;f=(0,o.HA)(f),f.spatialReference=e}if(f){await(0,c.Nk)(f.spatialReference,n),f=function(t,e){const i=t.spatialReference;return _(t,e)&&(0,a.ZC)(t)?{spatialReference:i,rings:[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]}:t}(f,n);const e=(await(0,l.el)((0,a.rS)(f)))[0];if(null==e)throw d;const i="quantizationParameters"in t&&t.quantizationParameters?.tolerance||"maxAllowableOffset"in t&&t.maxAllowableOffset||0,r=i&&_(f,n)?{densificationStep:8*i}:void 0,s=e.toJSON(),o=(0,c.Cv)(s,s.spatialReference,n,r);if(!o)throw d;o.spatialReference=n,t.geometry=o}return t}function _(t,e){if(!t)return!1;const i=t.spatialReference;return((0,a.ZC)(t)||(0,a.Bi)(t)||(0,a.Rg)(t))&&!(0,u.aI)(i,e)&&!(0,s.canProjectWithoutEngine)(i,e)}},62512:function(t,e,i){i.d(e,{tC:function(){return b},c0:function(){return x},xt:function(){return v}});var n=i(39819),r=i(61273),s=i(96127),o=i(74697),a=i(57652);function l(t,e){return t?e?4:3:e?3:2}function u(t,e,i,n,r,s){const o=l(r,s),{coords:a,lengths:u}=n;if(!u)return!1;for(let n=0,r=0;n<u.length;n++,r+=o)if(!c(t,e,i,a[r],a[r+1]))return!1;return!0}function c(t,e,i,n,r){if(!t)return!1;const s=l(e,i),{coords:o,lengths:a}=t;let u=!1,c=0;for(const t of a)u=h(u,o,s,c,t,n,r),c+=t*s;return u}function h(t,e,i,n,r,s,o){let a=t,l=n;for(let t=n,u=n+r*i;t<u;t+=i){l=t+i,l===u&&(l=n);const r=e[t],c=e[t+1],h=e[l],d=e[l+1];(c<o&&d>=o||d<o&&c>=o)&&r+(o-c)/(d-c)*(h-r)<s&&(a=!a)}return a}var d=i(58081),f=i(76613),p=i(78956),_=i(74841);const m="unsupported-query",g={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},y={spatialRelationship:{esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},queryGeometry:{esriGeometryPoint:!0,esriGeometryMultiPatch:!1,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},layerGeometry:{esriGeometryPoint:!0,esriGeometryMultiPatch:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1}};function v(t,e,n,a,l){if((0,o.Bi)(e)&&"esriGeometryPoint"===n&&("esriSpatialRelIntersects"===t||"esriSpatialRelContains"===t)){const t=(0,d.Ye)(new f.A,e,!1,!1);return Promise.resolve((e=>function(t,e,i,n){return c(t,!1,!1,n.coords[0],n.coords[1])}(t,0,0,e)))}if((0,o.Bi)(e)&&"esriGeometryMultipoint"===n){const i=(0,d.Ye)(new f.A,e,!1,!1);if("esriSpatialRelContains"===t)return Promise.resolve((t=>u(i,!1,!1,t,a,l)))}if((0,o.ZC)(e)&&"esriGeometryPoint"===n&&("esriSpatialRelIntersects"===t||"esriSpatialRelContains"===t))return Promise.resolve((t=>(0,r.qz)(e,(0,p.pL)(n,a,l,t))));if((0,o.ZC)(e)&&"esriGeometryMultipoint"===n&&"esriSpatialRelContains"===t)return Promise.resolve((t=>(0,r.rL)(e,(0,p.pL)(n,a,l,t))));if((0,o.ZC)(e)&&"esriSpatialRelIntersects"===t){const t="mesh"===(h=n)?s.xB:(0,s.xK)(h);return Promise.resolve((i=>t(e,(0,p.pL)(n,a,l,i))))}var h;return i.e(4696).then(i.bind(i,28356)).then((i=>{const r=i[g[t]].bind(null,e.spatialReference,e);return t=>r((0,p.pL)(n,a,l,t))}))}async function x(t,e,i){const{spatialRel:r,geometry:s}=t;if(s){if(!function(t){return null!=t&&!0===y.spatialRelationship[t]}(r))throw new n.A(m,"Unsupported query spatial relationship",{query:t});if((0,a.fn)(s.spatialReference)&&(0,a.fn)(i)){if(!function(t){return null!=t&&!0===y.queryGeometry[(0,o.$B)(t)]}(s))throw new n.A(m,"Unsupported query geometry type",{query:t});if(!function(t){return null!=t&&!0===y.layerGeometry[t]}(e))throw new n.A(m,"Unsupported layer geometry type",{query:t});if(t.outSR)return(0,_.Nk)(t.geometry?.spatialReference,t.outSR)}}}function b(t){if((0,o.ZC)(t))return!0;if((0,o.Bi)(t)){for(const e of t.rings){if(5!==e.length)return!1;if(e[0][0]!==e[1][0]||e[0][0]!==e[4][0]||e[2][0]!==e[3][0]||e[0][1]!==e[3][1]||e[0][1]!==e[4][1]||e[1][1]!==e[2][1])return!1}return!0}return!1}},20973:function(t,e,i){async function n(t,e){if(!t)return null;const i=e.featureAdapter,{startTimeField:n,endTimeField:r}=t;let s=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;if(n&&r)await e.forEach((t=>{const e=i.getAttribute(t,n),a=i.getAttribute(t,r);null==e||isNaN(e)||(s=Math.min(s,e)),null==a||isNaN(a)||(o=Math.max(o,a))}));else{const t=n||r;await e.forEach((e=>{const n=i.getAttribute(e,t);null==n||isNaN(n)||(s=Math.min(s,n),o=Math.max(o,n))}))}return{start:s,end:o}}function r(t,e,i){if(!e||!t)return null;const{startTimeField:n,endTimeField:r}=t;if(!n&&!r)return null;const{start:s,end:o}=e;if(null===s&&null===o)return null;if(void 0===s&&void 0===o)return()=>!1;const a=i.getAttributeAsTimestamp?.bind(i)??i.getAttribute.bind(i);return n&&r?function(t,e,i,n,r){return null!=n&&null!=r?s=>{const o=t(s,e),a=t(s,i);return(null==o||o<=r)&&(null==a||a>=n)}:null!=n?e=>{const r=t(e,i);return null==r||r>=n}:null!=r?i=>{const n=t(i,e);return null==n||n<=r}:void 0}(a,n,r,s,o):function(t,e,i,n){return null!=i&&null!=n&&i===n?n=>t(n,e)===i:null!=i&&null!=n?r=>{const s=t(r,e);return null!=s&&s>=i&&s<=n}:null!=i?n=>{const r=t(n,e);return null!=r&&r>=i}:null!=n?i=>{const r=t(i,e);return null!=r&&r<=n}:void 0}(a,n||r,s,o)}i.d(e,{I:function(){return r},W:function(){return n}})},58081:function(t,e,i){i.d(e,{B2:function(){return b},BW:function(){return F},Ch:function(){return rt},DF:function(){return w},Di:function(){return Z},E2:function(){return Y},IE:function(){return x},Nl:function(){return J},Q4:function(){return st},Rk:function(){return at},Ux:function(){return W},Ye:function(){return k},ZF:function(){return q},eU:function(){return B},eY:function(){return K},jH:function(){return Q},jQ:function(){return nt},kz:function(){return tt},oN:function(){return H},q3:function(){return X},qK:function(){return D},qN:function(){return z},z5:function(){return N},zv:function(){return $}});var n=i(39819),r=i(40633),s=i(95929),o=i(24761),a=i(87416),l=i(74697),u=i(65215),c=i(72887),h=i(76613);function d(t,e){return t?e?4:3:e?3:2}const f=()=>r.A.getLogger("esri.layers.graphics.featureConversionUtils"),p={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryMultiPatch:3,esriGeometryEnvelope:0},_=(t,e,i,n,r,s)=>{t[i]=r,t[i+1]=s},m=(t,e,i,n,r,s)=>{t[i]=r,t[i+1]=s,t[i+2]=e[n+2]},g=(t,e,i,n,r,s)=>{t[i]=r,t[i+1]=s,t[i+2]=e[n+3]},y=(t,e,i,n,r,s)=>{t[i]=r,t[i+1]=s,t[i+2]=e[n+2],t[i+3]=e[n+3]};function v(t,e,i,n){if(t){if(i)return e&&n?y:m;if(e&&n)return g}else if(e&&n)return m;return _}function x({scale:t,translate:e},i){return Math.round((i-e[0])/t[0])}function b({scale:t,translate:e},i){return Math.round((e[1]-i)/t[1])}function S({scale:t,translate:e},i,n){return i*t[n]+e[n]}function w(t,e,i){return t?e?i?E(t):I(t):i?A(t):T(t):null}function T(t){const e=t.coords;return{x:e[0],y:e[1]}}function P(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t}function I(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2]}}function M(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t}function A(t){const e=t.coords;return{x:e[0],y:e[1],m:e[2]}}function C(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.m,t}function E(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2],m:e[3]}}function R(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t.coords[3]=e.m,t}function O(t,e){return t&&e?R:t?M:e?C:P}function z(t,e,i=O(null!=e.z,null!=e.m)){return i(t,e)}function D(t,e,i){if(null==t)return null;const n=d(e,i),r=[];for(let e=0;e<t.coords.length;e+=n){const i=[];for(let r=0;r<n;r++)i.push(t.coords[e+r]);r.push(i)}return e?i?{points:r,hasZ:e,hasM:i}:{points:r,hasZ:e}:i?{points:r,hasM:i}:{points:r}}function L(t,e,i=d(e.hasZ,e.hasM)){t.lengths[0]=e.points.length;const n=t.coords;let r=0;for(const t of e.points)for(let e=0;e<i;e++)n[r++]=t[e];return t}function F(t,e,i){if(!t)return null;const n=d(e,i),{coords:r,lengths:s}=t,o=[];let a=0;for(const t of s){const e=[];for(let i=0;i<t;i++){const t=[];for(let e=0;e<n;e++)t.push(r[a++]);e.push(t)}o.push(e)}return e?i?{paths:o,hasZ:e,hasM:i}:{paths:o,hasZ:e}:i?{paths:o,hasM:i}:{paths:o}}function V(t,e,i=d(e.hasZ,e.hasM)){const{lengths:n,coords:r}=t;let s=0;for(const t of e.paths){for(const e of t)for(let t=0;t<i;t++)r[s++]=e[t];n.push(t.length)}return t}function N(t,e,i){if(!t)return null;const n=d(e,i),{coords:r,lengths:s}=t,o=[];let a=0;for(const t of s){const e=[];for(let i=0;i<t;i++){const t=[];for(let e=0;e<n;e++)t.push(r[a++]);e.push(t)}o.push(e)}return e?i?{rings:o,hasZ:e,hasM:i}:{rings:o,hasZ:e}:i?{rings:o,hasM:i}:{rings:o}}function k(t,e,i=e.hasZ,n=e.hasM){return B(t,e.rings,i,n)}function B(t,e,i,n){const r=d(i,n),{lengths:s,coords:o}=t;let a=0;lt(t);for(const t of e){for(const e of t)for(let t=0;t<r;t++)o[a++]=e[t];s.push(t.length)}return t}const U=[],G=[];function Y(t,e,i,n,r){U[0]=t;const[s]=Z(G,U,e,i,n,r);return ut(U),ut(G),s}function Z(t,e,i,r,s,o){if(ut(t),!i){for(const i of e){const e=o?i.attributes[o]:void 0;t.push(new u.Om(null,i.attributes,null,e))}return t}switch(i){case"esriGeometryPoint":return function(t,e,i,n,r){const s=O(i,n);for(const{geometry:i,attributes:n}of e){const e=null!=i?s(new h.A,i):null;t.push(new u.Om(e,n,null,r?n[r]:void 0))}return t}(t,e,r,s,o);case"esriGeometryMultipoint":return function(t,e,i,n,r){const s=d(i,n);for(const{geometry:i,attributes:n}of e){const e=null!=i?L(new h.A,i,s):null;t.push(new u.Om(e,n,null,r?n[r]:void 0))}return t}(t,e,r,s,o);case"esriGeometryPolyline":return function(t,e,i,n,r){const s=d(i,n);for(const{geometry:i,attributes:n,centroid:o}of e){const e=null!=i?V(new h.A,i,s):null,a=null!=o?z(new h.A,o):null;t.push(new u.Om(e,n,a,r?n[r]:void 0))}return t}(t,e,r,s,o);case"esriGeometryPolygon":case"esriGeometryMultiPatch":return function(t,e,i,n,r){for(const{geometry:s,centroid:o,attributes:a}of e){const e=null!=s?k(new h.A,s,i,n):null,l=r?a[r]:void 0;null!=o?t.push(new u.Om(e,a,P(new h.A,o),l)):t.push(new u.Om(e,a,null,l))}return t}(t,e,r,s,o);default:f().error("convertToFeatureSet:unknown-geometry",new n.A(`Unable to parse unknown geometry type '${i}'`)),ut(t)}return t}function H(t,e,i,n){G[0]=t,j(U,G,e,i,n);const r=U[0];return ut(U),ut(G),r}function W(t,e,i){if(null==t)return null;const r=new h.A;return"hasZ"in t&&null==e&&(e=t.hasZ),"hasM"in t&&null==i&&(i=t.hasM),(0,l.fT)(t)?O(null!=e?e:null!=t.z,null!=i?i:null!=t.m)(r,t):(0,l.Bi)(t)?k(r,t,e,i):(0,l.Rg)(t)?V(r,t,d(e,i)):(0,l.U9)(t)?L(r,t,d(e,i)):void f().error("convertFromGeometry:unknown-geometry",new n.A(`Unable to parse unknown geometry type '${t}'`))}function $(t,e,i,r){const s=t&&("coords"in t?t:t.geometry);if(null==s)return null;switch(e){case"esriGeometryPoint":{let t=T;return i&&r?t=E:i?t=I:r&&(t=A),t(s)}case"esriGeometryMultipoint":return D(s,i,r);case"esriGeometryPolyline":return F(s,i,r);case"esriGeometryPolygon":return N(s,i,r);default:return f().error("convertToGeometry:unknown-geometry",new n.A(`Unable to parse unknown geometry type '${e}'`)),null}}function j(t,e,i,r,s){if(ut(t),null==i)return function(t,e){for(const i of e)t.push({attributes:i.attributes});return t}(t,e);switch(i){case"esriGeometryPoint":return function(t,e,i,n){let r=T;i&&n?r=E:i?r=I:n&&(r=A);for(const i of e){const{geometry:e,attributes:n}=i,s=null!=e?r(e):null;t.push({attributes:n,geometry:s})}return t}(t,e,r,s);case"esriGeometryMultipoint":return function(t,e,i,n){for(const{geometry:r,attributes:s}of e)t.push({attributes:s,geometry:null!=r?D(r,i,n):null});return t}(t,e,r,s);case"esriGeometryPolyline":return function(t,e,i,n){for(const{geometry:r,attributes:s}of e)t.push({attributes:s,geometry:null!=r?F(r,i,n):null});return t}(t,e,r,s);case"esriGeometryPolygon":return function(t,e,i,n){for(const{geometry:r,attributes:s,centroid:o}of e){const e=null!=r?N(r,i,n):null;if(null!=o){const i=T(o);t.push({attributes:s,centroid:i,geometry:e})}else t.push({attributes:s,geometry:e})}return t}(t,e,r,s);default:f().error("convertToFeatureSet:unknown-geometry",new n.A(`Unable to parse unknown geometry type '${i}'`))}return t}function q(t){const{objectIdFieldName:e,spatialReference:i,transform:n,fields:r,hasM:s,hasZ:o,features:a,geometryType:l,exceededTransferLimit:u,uniqueIdField:c,queryGeometry:h,queryGeometryType:d}=t,f={features:j([],a,l,o,s),fields:r,geometryType:l,objectIdFieldName:e,spatialReference:i,uniqueIdField:c,queryGeometry:$(h,d,!1,!1)};return n&&(f.transform=n),u&&(f.exceededTransferLimit=u),s&&(f.hasM=s),o&&(f.hasZ=o),f}function X(t,e){const i=new c.A,{hasM:r,hasZ:s,features:o,objectIdFieldName:a,spatialReference:l,geometryType:u,exceededTransferLimit:h,transform:d,fields:p}=t;return p&&(i.fields=p),i.geometryType=u??null,i.objectIdFieldName=a??e??null,i.spatialReference=l??null,i.objectIdFieldName?(o&&Z(i.features,o,u,s,r,i.objectIdFieldName),h&&(i.exceededTransferLimit=h),r&&(i.hasM=r),s&&(i.hasZ=s),d&&(i.transform=d),i):(f().error(new n.A("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),i)}function K(t){const{transform:e,features:i,hasM:n,hasZ:r}=t;if(!e)return t;for(const t of i)null!=t.geometry&&rt(t.geometry,t.geometry,n,r,e),null!=t.centroid&&rt(t.centroid,t.centroid,n,r,e);return t.transform=null,t}function Q(t,e){const{geometryType:i,features:n,hasM:r,hasZ:s}=e;if(!t)return e;for(let e=0;e<n.length;e++){const o=n[e],a=o.weakClone();a.geometry=new h.A,J(a.geometry,o.geometry,r,s,i,t),o.centroid&&(a.centroid=new h.A,J(a.centroid,o.centroid,r,s,"esriGeometryPoint",t)),n[e]=a}return e.transform=t,e}function J(t,e,i,n,r,s,o=i,a=n){if(lt(t),!e?.coords.length)return null;const l=p[r],{coords:u,lengths:c}=e,h=d(i,n),f=d(i&&o,n&&a),_=v(i,n,o,a);if(!c.length)return _(t.coords,u,0,0,x(s,u[0]),b(s,u[1])),lt(t,h,0),t;let m,g,y,S,w=0,T=0,P=T;for(const e of c){if(e<l)continue;let i=0;T=P,y=m=x(s,u[w]),S=g=b(s,u[w+1]),_(t.coords,u,T,w,y,S),i++,w+=h,T+=f;for(let n=1;n<e;n++,w+=h)y=x(s,u[w]),S=b(s,u[w+1]),y===m&&S===g||(_(t.coords,u,T,w,y-m,S-g),T+=f,i++,m=y,g=S);i>=l&&(t.lengths.push(i),P=T)}return ut(t.coords,P),t.coords.length?t:null}function tt(t,e,i,n,r,s,o=i,a=n){if(lt(t),!e?.coords.length)return null;const l=p[r],{coords:u,lengths:c}=e,h=d(i,n),f=d(i&&o,n&&a),_=v(i,n,o,a);if(!c.length)return _(t.coords,u,0,0,u[0],u[1]),lt(t,h,0),t;let m=0;const g=s*s;for(const e of c){if(e<l){m+=e*h;continue}const i=t.coords.length/f,n=m,r=m+(e-1)*h;_(t.coords,u,t.coords.length,n,u[n],u[n+1]),it(t.coords,u,h,g,_,n,r),_(t.coords,u,t.coords.length,r,u[r],u[r+1]);const s=t.coords.length/f-i;s>=l?t.lengths.push(s):ut(t.coords,i*f),m+=e*h}return t.coords.length?t:null}function et(t,e,i,n){const r=t[e],s=t[e+1],o=t[i],a=t[i+1],l=t[n],u=t[n+1];let c=o,h=a,d=l-c,f=u-h;if(0!==d||0!==f){const t=((r-c)*d+(s-h)*f)/(d*d+f*f);t>1?(c=l,h=u):t>0&&(c+=d*t,h+=f*t)}return d=r-c,f=s-h,d*d+f*f}function it(t,e,i,n,r,s,o){let a,l=n,u=0;for(let t=s+i;t<o;t+=i)a=et(e,t,s,o),a>l&&(u=t,l=a);l>n&&(u-s>i&&it(t,e,i,n,r,s,u),r(t,e,t.length,u,e[u],e[u+1]),o-u>i&&it(t,e,i,n,r,u,o))}function nt(t,e,i,n){if(!e?.coords?.length)return null;const r=d(i,n);let s=Number.POSITIVE_INFINITY,l=Number.POSITIVE_INFINITY,u=Number.NEGATIVE_INFINITY,c=Number.NEGATIVE_INFINITY;if(e&&e.coords){const t=e.coords;for(let e=0;e<t.length;e+=r){const i=t[e],n=t[e+1];s=Math.min(s,i),u=Math.max(u,i),l=Math.min(l,n),c=Math.max(c,n)}}return(0,o.is)(t)?(0,o.BI)(t,s,l,u,c):(0,a.fA)(s,l,u,c,t),t}function rt(t,e,i,n,r){const{coords:o,lengths:a}=e,l=d(i,n);if(!o.length)return t!==e&&lt(t),t;(0,s.Lw)(r);const{originPosition:u,scale:c,translate:h}=r,f=ct;f.originPosition=u;const p=f.scale;p[0]=c[0]??1,p[1]=-(c[1]??1),p[2]=c[2]??1,p[3]=c[3]??1;const _=f.translate;if(_[0]=h[0]??0,_[1]=h[1]??0,_[2]=h[2]??0,_[3]=h[3]??0,!a.length){for(let e=0;e<l;++e)t.coords[e]=S(f,o[e],e);return t!==e&&lt(t,l,0),t}let m=0;for(let e=0;e<a.length;e++){const i=a[e];t.lengths[e]=i;for(let e=0;e<l;++e)t.coords[m+e]=S(f,o[m+e],e);let n=t.coords[m],r=t.coords[m+1];m+=l;for(let e=1;e<i;e++,m+=l){n+=o[m]*p[0],r+=o[m+1]*p[1],t.coords[m]=n,t.coords[m+1]=r;for(let e=2;e<l;++e)t.coords[m+e]=S(f,o[m+e],e)}}return t!==e&&lt(t,o.length,a.length),t}function st(t,e,i,n,r,s){if(lt(t),t.lengths.push(...e.lengths),i===r&&n===s)for(let i=0;i<e.coords.length;i++)t.coords.push(e.coords[i]);else{const o=d(i,n),a=v(i,n,r,s),l=e.coords;for(let e=0;e<l.length;e+=o)a(t.coords,l,t.coords.length,e,l[e],l[e+1])}return t}function ot(t,e,i,n){let r=0,s=t[n*e],o=t[n*(e+1)];for(let a=1;a<i;a++){const i=s+t[n*(e+a)],l=o+t[n*(e+a)+1],u=(i-s)*(l+o);s=i,o=l,r+=u}return.5*r}function at(t,e){const{coords:i,lengths:n}=t;let r=0,s=0;for(let t=0;t<n.length;t++){const o=n[t];s+=ot(i,r,o,e),r+=o}return Math.abs(s)}function lt(t,e=0,i=0){ut(t.lengths,i),ut(t.coords,e)}function ut(t,e=0){t.length!==e&&(t.length=e)}const ct={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]}},23454:function(t,e,i){i.d(e,{Aq:function(){return r},pC:function(){return s},rx:function(){return o}});var n=i(29076);function r(t,e){t[4]=e}class s{constructor(t,e=!0,i=!0,r=0){this.isClosed=!1,this.geometryCursor=null,this.geometryCursor=!e&&"esriGeometryPolygon"===t.geometryType||!i&&"esriGeometryPolyline"===t.geometryType?null:t,this.geomUnitsPerPoint=r,this.iterateMultiPath=!1,this.iteratePath=!1,this.internalPlacement=new n.W}next(){if(!this.geometryCursor)return null;const t=this.processMultiPath(this.geometryCursor);return this.iterateMultiPath&&t||(this.geometryCursor=null),t}processMultiPath(t){for(;this.iteratePath||t.pathIndex<t.totalSize-1;){this.iteratePath||t.nextPath(),this.iterateMultiPath=!0;const e=this.processPath(t);if(e)return e}return this.iterateMultiPath=!1,null}}class o{constructor(t,e,i,n=0){this.isClosed=!1,this.inputGeometries=t,this.acceptPolygon=e,this.acceptPolyline=i,this.geomUnitsPerPoint=n,this.iteratePath=!1,this.multiPathCursor=null}next(){for(;;){if(!this.multiPathCursor){let t=this.inputGeometries.next();for(;t&&(this.isClosed=this.acceptPolygon&&"esriGeometryPolygon"===t.geometryType||"esriGeometryEnvelope"===t.geometryType,this.multiPathCursor=t,!this.multiPathCursor);)t=this.inputGeometries.next();if(!this.multiPathCursor)return null}for(;this.iteratePath||this.multiPathCursor.nextPath();){this.multiPathCursor.seekPathStart();const t=this.processPath(this.multiPathCursor);if(t)return t}this.multiPathCursor=null}}}},62096:function(t,e,i){i.d(e,{k:function(){return a},q:function(){return l}});var n=i(33134),r=i(72139);const s=512;let o;class a{constructor(t){this._geometry=t}next(){const t=this._geometry;return this._geometry=null,t}}function l(t,e){o||(o=new r.O3(0,0,0,1));const i="esriGeometryPolygon"===t.geometryType,a=i?r.dC.Polygon:r.dC.LineString,l=i?3:2;let u,c;for(o.reset(a),o.setPixelMargin(e+1),o.setExtent(s);t.nextPath();)if(!(t.pathSize<l)){for(t.nextPoint(),u=t.x,c=-t.y,o.moveTo(u,c);t.nextPoint();)u=t.x,c=-t.y,o.lineTo(u,c);i&&o.close()}const h=o.result(!1);if(h){const e=n.z.createEmptyOptimizedCIM(t.geometryType);for(const t of h){e.startPath();for(const i of t)e.pushXY(i.x,-i.y)}return e.reset(),e}return null}},9635:function(t,e,i){i.d(e,{A:function(){return T},c:function(){return P}});var n=i(63514),r=i(82112),s=i(20391),o=i(11672),a=i(12281),l=i(2969),u=i(7889),c=i(48645),h=i(7088),d=i(17706),f=i(10183),p=i(1646),_=i(79323),m=i(34476),g=i(31771),y=i(15987),v=i(19511),x=i(20305),b=i(58892),S=i(80585),w=i(58676);function T(t){if(!t)return null;switch(t.type){case"CIMGeometricEffectAddControlPoints":return n.N.local();case"CIMGeometricEffectArrow":return r.B.local();case"CIMGeometricEffectBuffer":return s.s.local();case"CIMGeometricEffectControlMeasureLine":return o.v.local();case"CIMGeometricEffectCut":return a.y.local();case"CIMGeometricEffectDashes":return l.I.local();case"CIMGeometricEffectDonut":return u.O.local();case"CIMGeometricEffectJog":return c.U.local();case"CIMGeometricEffectMove":return h.V.local();case"CIMGeometricEffectOffset":return d.V.local();case"CIMGeometricEffectReverse":return f.C.local();case"CIMGeometricEffectRotate":return p.v.local();case"CIMGeometricEffectScale":return _.W.local();case"CIMGeometricEffectWave":return m.l.local()}return null}function P(t){if(!t)return null;switch(t.type){case"CIMMarkerPlacementAlongLineSameSize":return g.e.local();case"CIMMarkerPlacementAtExtremities":return y.y.local();case"CIMMarkerPlacementAtRatioPositions":return v.S.local();case"CIMMarkerPlacementInsidePolygon":return x.M.local();case"CIMMarkerPlacementOnLine":return b.R.local();case"CIMMarkerPlacementOnVertices":return S.A.local();case"CIMMarkerPlacementPolygonCenter":return w.L.local()}return null}},29076:function(t,e,i){i.d(e,{W:function(){return n}});class n{constructor(){this.setIdentity()}getAngle(){return(null==this.rz||0===this.rz&&1!==this.rzCos&&0!==this.rzSin)&&(this.rz=Math.atan2(this.rzSin,this.rzCos)),this.rz}setIdentity(){this.tx=0,this.ty=0,this.tz=0,this.s=1,this.rx=0,this.ry=0,this.rz=0,this.rzCos=1,this.rzSin=0}setTranslate(t,e){this.tx=t,this.ty=e}setTranslateZ(t){this.tz=t}setRotateCS(t,e){this.rz=void 0,this.rzCos=t,this.rzSin=e}setRotate(t){this.rz=t,this.rzCos=void 0,this.rzSin=void 0}setRotateY(t){this.ry=t}setScale(t){this.s=t}setMeasure(t){this.m=t}}},14817:function(t,e,i){i.d(e,{Rj:function(){return F},mx:function(){return D},CK:function(){return L},IT:function(){return O},QF:function(){return B}});var n=i(80683),r=i(58941),s=i(21609),o=i(40633),a=i(56996),l=i(13520),u=i(33134),c=i(87416),h=i(35068),d=i(72228),f=i(74697),p=i(62096);class _{applyColorSubstitution(t,e){if(!e)return t;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const{width:i,height:n}=t,r=this._rasterizationCanvas,s=r.getContext("2d",{willReadFrequently:!0});t!==r&&(r.width=i,r.height=n,s.drawImage(t,0,0,i,n));const o=s.getImageData(0,0,i,n).data;if(e)for(const t of e)if(t&&t.oldColor&&4===t.oldColor.length&&t.newColor&&4===t.newColor.length){const[e,i,n,r]=t.oldColor,[s,a,l,u]=t.newColor;if(e===s&&i===a&&n===l&&r===u)continue;for(let t=0;t<o.length;t+=4)e===o[t]&&i===o[t+1]&&n===o[t+2]&&r===o[t+3]&&(o[t]=s,o[t+1]=a,o[t+2]=l,o[t+3]=u)}const a=new ImageData(o,i,n);return s.putImageData(a,0,0),r}tintImageData(t,e){if(!e||e.length<4)return t;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const{width:i,height:n}=t,r=this._rasterizationCanvas,s=r.getContext("2d",{willReadFrequently:!0});t!==r&&(r.width=i,r.height=n,s.drawImage(t,0,0,i,n));const o=s.getImageData(0,0,i,n),a=new Uint8Array(o.data),l=[e[0]/255,e[1]/255,e[2]/255,e[3]/255];for(let t=0;t<a.length;t+=4)a[t]*=l[0],a[t+1]*=l[1],a[t+2]*=l[2],a[t+3]*=l[3];const u=new ImageData(new Uint8ClampedArray(a.buffer),i,n);return s.putImageData(u,0,0),r}}var m=i(9635),g=i(29076),y=i(38821),v=i(33389);function x(t){const e=t.getFrame(0);if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement)return e;const i=document.createElement("canvas");i.width=t.width,i.height=t.height;const n=i.getContext("2d");return e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0),i}var b=i(82497),S=i(64303);function w(t){return`rgba(${t.slice(0,3).toString()},${t[3]})`}class T{constructor(t){t&&(this._textRasterizationCanvas=t)}rasterizeText(t,e){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const i=this._textRasterizationCanvas,n=i.getContext("2d",{willReadFrequently:!0});P(n,e),this._parameters=e,this._textLines=t.split(/\r?\n/),this._lineHeight=this._computeLineHeight();const{decoration:r,weight:s}=e.font;this._lineThroughWidthOffset=r&&"line-through"===r?.1*this._lineHeight:0;const o=null!=e.backgroundColor||null!=e.borderLine,a=o?S.y7:0,l=this._computeTextWidth(n,e)+2*a,u=this._lineHeight*this._textLines.length+2*a;if(i.width=l+2*this._lineThroughWidthOffset,i.height=u,0===i.width||0===i.height)return i.width=i.height=1,{size:[0,0],image:new Uint32Array(0),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0,canvas:i};this._renderedLineHeight=Math.round(this._lineHeight),this._renderedOutlineSize=(e.outline.size||0)*e.pixelRatio,this._renderedHaloSize=(e.halo.size||0)*e.pixelRatio,this._renderedWidth=l,this._renderedHeight=u,this._lineThroughWidthOffset*=e.pixelRatio;const c=(e.outline&&e.outline.color)??[0,0,0,0],h=e.color??[0,0,0,0],d=e.halo&&e.halo.color?e.halo.color:[0,0,0,0];this._fillStyle=w(h),this._outlineStyle=w(c),this._haloStyle=function(t){return`rgb(${t.slice(0,3).toString()})`}(d);const f=this._renderedLineHeight,p=this._renderedOutlineSize,_=this._renderedHaloSize;n.save(),n.clearRect(0,0,i.width,i.height),P(n,e);const m=a*e.pixelRatio,g=function(t,e,i){return"center"===t?.5*e:"right"===t?e-i:i}(n.textAlign,this._renderedWidth-2*m,this._renderedHaloSize+this._renderedOutlineSize)+m,y=_+p+m,v=_>0;let x=this._lineThroughWidthOffset,b=0;if(o){n.save();const t=e.backgroundColor??[0,0,0,0],r=e.borderLine?.color??[0,0,0,0],s=2*(e.borderLine?.size??0);n.fillStyle=w(t),n.strokeStyle=w(r),n.lineWidth=s,n.fillRect(0,0,i.width,i.height),n.strokeRect(0,0,i.width,i.height),n.restore()}v&&this._renderHalo(n,g,y,x,b,e),p>0&&this._renderOutline(n,g,y,x,b,e),b+=y,x+=g;for(const t of this._textLines)v?(n.globalCompositeOperation="destination-out",n.fillStyle="rgb(0, 0, 0)",n.fillText(t,x,b),n.globalCompositeOperation="source-over",n.fillStyle=this._fillStyle,n.fillText(t,x,b)):(n.fillStyle=this._fillStyle,n.fillText(t,x,b)),r&&"none"!==r&&this._renderDecoration(n,x,b,r,s),b+=f;n.restore();const T=this._renderedWidth+2*this._lineThroughWidthOffset,I=this._renderedHeight,M=n.getImageData(0,0,T,I),A=new Uint8Array(M.data);if(e.premultiplyColors){let t;for(let e=0;e<A.length;e+=4)t=A[e+3]/255,A[e]=A[e]*t,A[e+1]=A[e+1]*t,A[e+2]=A[e+2]*t}let C,E;switch(e.horizontalAlignment){case"left":C=-.5;break;case"right":C=.5;break;default:C=0}switch(e.verticalAlignment){case"bottom":E=-.5;break;case"top":E=.5;break;case"baseline":E=-1/6;break;default:E=0}return{size:[T,I],image:new Uint32Array(A.buffer),sdf:!1,simplePattern:!1,anchorX:C,anchorY:E,canvas:i}}_renderHalo(t,e,i,n,r,s){const o=this._renderedWidth,a=this._renderedHeight;this._outlineRasterizationCanvas||(this._outlineRasterizationCanvas=document.createElement("canvas")),this._outlineRasterizationCanvas.width=o,this._outlineRasterizationCanvas.height=a;const l=this._outlineRasterizationCanvas,u=l.getContext("2d");u.clearRect(0,0,o,a),P(u,s);const{decoration:c,weight:h}=s.font;u.fillStyle=this._haloStyle,u.strokeStyle=this._haloStyle,u.lineJoin="round",this._renderOutlineNative(u,e,i,c,h,this._renderedHaloSize+this._renderedOutlineSize),t.globalAlpha=this._parameters.halo.color[3],t.drawImage(l,0,0,o,a,n,r,o,a),t.globalAlpha=1}_renderOutline(t,e,i,n,r,s){const o=this._renderedWidth,a=this._renderedHeight;this._outlineRasterizationCanvas||(this._outlineRasterizationCanvas=document.createElement("canvas")),this._outlineRasterizationCanvas.width=o,this._outlineRasterizationCanvas.height=a;const l=this._outlineRasterizationCanvas,u=l.getContext("2d");u.clearRect(0,0,o,a),P(u,s);const{decoration:c,weight:h}=s.font;u.fillStyle=this._outlineStyle,u.strokeStyle=this._outlineStyle,u.lineJoin="round",this._renderOutlineNative(u,e,i,c,h,this._renderedOutlineSize),t.globalAlpha=this._parameters.outline.color[3],t.drawImage(l,0,0,o,a,n,r,o,a),t.globalAlpha=1}_renderOutlineNative(t,e,i,n,r,s){const o=this._renderedLineHeight;for(const a of this._textLines){const l=2*s,u=5,c=.1;for(let s=0;s<u;s++){const o=(1-(u-1)*c+s*c)*l;t.lineWidth=o,t.strokeText(a,e,i),n&&"none"!==n&&this._renderDecoration(t,e,i,n,r,o)}i+=o}}computeTextSize(t,e){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const i=this._textRasterizationCanvas,n=i.getContext("2d");P(n,e),this._parameters=e,this._textLines=t.split(/\r?\n/),this._lineHeight=this._computeLineHeight();const r=this._computeTextWidth(n,e),s=this._lineHeight*this._textLines.length;return i.width=r,i.height=s,[r*e.pixelRatio,s*e.pixelRatio]}_computeTextWidth(t,e){let i=0;for(const e of this._textLines)i=Math.max(i,t.measureText(e).width);const n=e.font;return("italic"===n.style||"oblique"===n.style||"string"==typeof n.weight&&("bold"===n.weight||"bolder"===n.weight)||"number"==typeof n.weight&&n.weight>600)&&(i+=.3*t.measureText("w").width),i+=2*(0,l.Lz)(this._parameters.halo.size),Math.round(i)}_computeLineHeightBase(){return 1.275*this._parameters.size}_computeLineHeight(){let t=this._computeLineHeightBase();const e=this._parameters.font.decoration;return e&&"underline"===e&&(t*=1.3),Math.round(t+2*(0,l.Lz)(this._parameters.halo.size))}_renderDecoration(t,e,i,n,r,s){let o=.9*this._lineHeight;const a="bold"===r?.06:"bolder"===r?.09:.04;switch(t.textAlign){case"center":e-=this._renderedWidth/2;break;case"right":e-=this._renderedWidth}const l=t.textBaseline;if("underline"===n)switch(o=.9*this._computeLineHeightBase(),l){case"top":i+=o;break;case"middle":i+=o/2}else if("line-through"===n)switch(l){case"top":i+=o/1.5;break;case"middle":i+=o/3}const u=s?1.5*s:Math.ceil(o*a);t.save(),t.beginPath(),t.strokeStyle=t.fillStyle,t.lineWidth=u,t.moveTo(e-this._lineThroughWidthOffset,i),t.lineTo(e+this._renderedWidth+2*this._lineThroughWidthOffset,i),t.stroke(),t.restore()}}function P(t,e){const i=Math.max(e.size,.5),n=e.font,r=`${n.style} ${n.weight} ${(0,l.Lz)(i).toFixed(1)}px ${n.family}, sans-serif`;let s;switch(t.font=r,t.textBaseline="top",e.horizontalAlignment){case"left":default:s="left";break;case"right":s="right";break;case"center":s="center"}t.textAlign=s}var I=i(7590),M=i(16043),A=i(39686),C=i(17469),E=i(96700);const R=Math.PI/180;class O{constructor(t){this._t=t}static createIdentity(){return new O([1,0,0,0,1,0])}clone(){const t=this._t;return new O(t.slice())}transform(t){const e=this._t;return[e[0]*t[0]+e[1]*t[1]+e[2],e[3]*t[0]+e[4]*t[1]+e[5]]}static createScale(t,e){return new O([t,0,0,0,e,0])}scale(t,e){const i=this._t;return i[0]*=t,i[1]*=t,i[2]*=t,i[3]*=e,i[4]*=e,i[5]*=e,this}scaleRatio(){return Math.sqrt(this._t[0]*this._t[0]+this._t[1]*this._t[1])}static createTranslate(t,e){return new O([0,0,t,0,0,e])}translate(t,e){const i=this._t;return i[2]+=t,i[5]+=e,this}static createRotate(t){const e=Math.cos(t),i=Math.sin(t);return new O([e,-i,0,i,e,0])}rotate(t){return O.multiply(this,O.createRotate(t),this)}angle(){const t=this._t[0],e=this._t[3],i=Math.sqrt(t*t+e*e);return[t/i,e/i]}static multiply(t,e,i){const n=t._t,r=e._t,s=n[0]*r[0]+n[3]*r[1],o=n[1]*r[0]+n[4]*r[1],a=n[2]*r[0]+n[5]*r[1]+r[2],l=n[0]*r[3]+n[3]*r[4],u=n[1]*r[3]+n[4]*r[4],c=n[2]*r[3]+n[5]*r[4]+r[5],h=i._t;return h[0]=s,h[1]=o,h[2]=a,h[3]=l,h[4]=u,h[5]=c,i}invert(){const t=this._t;let e=t[0]*t[4]-t[1]*t[3];if(0===e)return new O([0,0,0,0,0,0]);e=1/e;const i=(t[1]*t[5]-t[2]*t[4])*e,n=(t[2]*t[3]-t[0]*t[5])*e,r=t[4]*e,s=-t[1]*e,o=-t[3]*e,a=t[0]*e;return new O([r,s,i,o,a,n])}}class z{constructor(t,e){this._resourceManager=t,this._transfos=[],this._sizeTransfos=[],this._geomUnitsPerPoint=1,this._placementPool=new a.A(g.W,void 0,void 0,100),this._earlyReturn=!1,this._mapRotation=0,this._transfos.push(e||O.createIdentity()),this._sizeTransfos.push(e?e.scaleRatio():1)}setTransform(t,e){this._transfos=[t||O.createIdentity()],this._sizeTransfos=[e||(t?t.scaleRatio():1)]}setGeomUnitsPerPoint(t){this._geomUnitsPerPoint=t}transformPt(t){return this._transfos[this._transfos.length-1].transform(t)}transformSize(t){return t*this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformPt(t){return this._transfos[this._transfos.length-1].invert().transform(t)}reverseTransformSize(t){return t/this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformScalar(t){return t/this._transfos[this._transfos.length-1].scaleRatio()}getTransformAngle(){return this._transfos[this._transfos.length-1].angle()}geomUnitsPerPoint(){return this.isEmbedded()?1:this._geomUnitsPerPoint}prevGeomUnitsPerPoint(){return this._transfos.length>2?1:this._geomUnitsPerPoint}isEmbedded(){return this._transfos.length>1}back(){return this._transfos[this._transfos.length-1]}push(t,e){const i=e?t.scaleRatio():1;O.multiply(t,this.back(),t),this._transfos.push(t),this._sizeTransfos.push(this._sizeTransfos[this._sizeTransfos.length-1]*i)}pop(){this._transfos.splice(-1,1),this._sizeTransfos.splice(-1,1)}drawSymbol(t,e,i){if(t)switch(t.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":this.drawMultiLayerSymbol(t,e);break;case"CIMTextSymbol":this.drawTextSymbol(t,e,i)}}drawMultiLayerSymbol(t,e){if(!t||!e)return;const i=t.symbolLayers;if(!i)return;const n=t.effects;if(n&&n.length>0){const t=this.executeEffects(n,e);if(t){let e=t.next();for(;e;)this.drawSymbolLayers(i,e.asJSON()),e=t.next()}}else this.drawSymbolLayers(i,e)}executeEffects(t,e){const i=this._resourceManager.geometryEngine;let n=new p.k(u.z.fromJSONCIM(e));for(const e of t){const t=(0,m.A)(e);t&&(n=t.execute(n,e,this.geomUnitsPerPoint(),null,i))}return n}drawSymbolLayers(t,e){let i=t.length;for(;i--;){const n=t[i];if(!n||!1===n.enable)continue;const r=n.effects;if(r&&r.length>0){const t=this.executeEffects(r,e);if(t){let e=null;for(;(e=t.next())&&(this.drawSymbolLayer(n,e.asJSON()),!this._earlyReturn););}}else this.drawSymbolLayer(n,e);if(this._earlyReturn)return}}drawSymbolLayer(t,e){switch(t.type){case"CIMSolidFill":this.drawSolidFill(e,t.color,t.path);break;case"CIMHatchFill":this.drawHatchFill(e,t);break;case"CIMPictureFill":this.drawPictureFill(e,t);break;case"CIMGradientFill":this.drawGradientFill(e,t);break;case"CIMSolidStroke":this.drawSolidStroke(e,t.color,t.width,t.capStyle,t.joinStyle,t.miterLimit,t.path);break;case"CIMPictureStroke":this.drawPictureStroke(e,t);break;case"CIMGradientStroke":this.drawGradientStroke(e,t);break;case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":this.drawMarkerLayer(t,e)}}drawHatchFill(t,e){const i=function(t,e,i){let n=(0,I.$w)(t.separation,y.D.CIMHatchFill.separation)*i,r=(0,I.$w)(t.rotation);if(0===n)return null;n<0&&(n=-n);let s=0;const o=.5*n;for(;s>o;)s-=n;for(;s<-o;)s+=n;const a=(0,c.vt)();(0,h.Rg)(a,e),a[0]-=o,a[1]-=o,a[2]+=o,a[3]+=o;const l=[[a[0],a[1]],[a[0],a[3]],[a[2],a[3]],[a[2],a[1]]];for(;r>180;)r-=180;for(;r<0;)r+=180;const u=Math.cos(r*R),d=Math.sin(r*R),f=-n*d,p=n*u;let _,m,g,v;s=(0,I.$w)(t.offsetX)*i*d-(0,I.$w)(t.offsetY)*i*u,_=g=Number.MAX_VALUE,m=v=-Number.MAX_VALUE;for(const t of l){const e=t[0],i=t[1],n=u*e+d*i,r=-d*e+u*i;_=Math.min(_,n),g=Math.min(g,r),m=Math.max(m,n),v=Math.max(v,r)}g=Math.floor(g/n)*n;let x=u*_-d*g-f*s/n,b=d*_+u*g-p*s/n,S=u*m-d*g-f*s/n,w=d*m+u*g-p*s/n;const T=1+Math.round((v-g)/n),P=[];for(let t=0;t<T;t++)x+=f,b+=p,S+=f,w+=p,P.push([[x,b],[S,w]]);return{paths:P}}(e,t,this.geomUnitsPerPoint());i&&(this.pushClipPath(t),this.drawMultiLayerSymbol(e.lineSymbol,i),this.popClipPath())}drawPictureFill(t,e){}drawGradientFill(t,e){}drawPictureStroke(t,e){}drawGradientStroke(t,e){}drawMarkerLayer(t,e){const i=t.markerPlacement;if(i){const n=(0,m.c)(i);if(n){const r="CIMMarkerPlacementInsidePolygon"===i.type||"CIMMarkerPlacementPolygonCenter"===i.type&&i.clipAtBoundary;r&&this.pushClipPath(e);const s=n.execute(u.z.fromJSONCIM(e),i,this.geomUnitsPerPoint(),null,this._resourceManager.geometryEngine);if(s){let e=null;for(;(e=s.next())&&(this.drawMarker(t,e),!this._earlyReturn););}r&&this.popClipPath()}}else{const i=this._placementPool.acquire();if((0,f.fT)(e))i.tx=e.x,i.ty=e.y,this.drawMarker(t,i);else if((0,f.Bi)(e)){const n=(0,d.l8)(e);n&&([i.tx,i.ty]=n,this.drawMarker(t,i))}else for(const n of e.points)if(i.tx=n[0],i.ty=n[1],this.drawMarker(t,i),this._earlyReturn)break;this._placementPool.release(i)}}drawMarker(t,e){switch(t.type){case"CIMCharacterMarker":case"CIMPictureMarker":this.drawPictureMarker(t,e);break;case"CIMVectorMarker":this.drawVectorMarker(t,e)}}drawPictureMarker(t,e){if(!t)return;const i=this._resourceManager.getResource(t.url),n=(0,I.$w)(t.size,y.D.CIMPictureMarker.size);if(null==i||n<=0)return;const r=i.width,s=i.height;if(!r||!s)return;const o=r/s,a=(0,I.$w)(t.scaleX,1),l=O.createIdentity(),u=t.anchorPoint;if(u){let e=u.x,i=u.y;"Absolute"!==t.anchorPointUnits&&(e*=n*o*a,i*=n),l.translate(-e,-i)}let c=(0,I.$w)(t.rotation);t.rotateClockwise&&(c=-c),this._mapRotation&&(c+=this._mapRotation),c&&l.rotate(c*R);let h=(0,I.$w)(t.offsetX),d=(0,I.$w)(t.offsetY);if(h||d){if(this._mapRotation){const t=R*this._mapRotation,e=Math.cos(t),i=Math.sin(t),n=h*i+d*e;h=h*e-d*i,d=n}l.translate(h,d)}const f=this.geomUnitsPerPoint();1!==f&&l.scale(f,f);const p=e.getAngle();p&&l.rotate(p),l.translate(e.tx,e.ty),this.push(l,!1),this.drawImage(t,n),this.pop()}drawVectorMarker(t,e){if(!t)return;const i=t.markerGraphics;if(!i)return;const n=(0,I.$w)(t.size,y.D.CIMVectorMarker.size),r=t.frame,s=r?r.ymax-r.ymin:0,a=n&&s?n/s:1,l=O.createIdentity();r&&l.translate(.5*-(r.xmax+r.xmin),.5*-(r.ymax+r.ymin));const u=t.anchorPoint;if(u){let e=u.x,i=u.y;"Absolute"!==t.anchorPointUnits?r&&(e*=r.xmax-r.xmin,i*=r.ymax-r.ymin):(e/=a,i/=a),l.translate(-e,-i)}1!==a&&l.scale(a,a);let c=(0,I.$w)(t.rotation);t.rotateClockwise&&(c=-c),this._mapRotation&&(c+=this._mapRotation),c&&l.rotate(c*R);let h=(0,I.$w)(t.offsetX),d=(0,I.$w)(t.offsetY);if(h||d){if(this._mapRotation){const t=R*this._mapRotation,e=Math.cos(t),i=Math.sin(t),n=h*i+d*e;h=h*e-d*i,d=n}l.translate(h,d)}const f=this.geomUnitsPerPoint();1!==f&&l.scale(f,f);const p=e.getAngle();p&&l.rotate(p),l.translate(e.tx,e.ty),this.push(l,t.scaleSymbolsProportionally);for(const t of i){t?.symbol&&t.geometry||o.A.getLogger("esri.symbols.cim.CIMSymbolDrawHelper").error("Invalid marker graphic",t);let e=t.textString;if("number"==typeof e&&(e=e.toString()),this.drawSymbol(t.symbol,t.geometry,e),this._earlyReturn)break}this.pop()}drawTextSymbol(t,e,i){if(!t)return;if(!(0,f.fT)(e))return;if((0,I.$w)(t.height,y.D.CIMTextSymbol.height)<=0)return;const n=O.createIdentity();let r=(0,I.$w)(t.angle);r=-r,r&&n.rotate(r*R);const s=(0,I.$w)(t.offsetX),o=(0,I.$w)(t.offsetY);(s||o)&&n.translate(s,o);const a=this.geomUnitsPerPoint();1!==a&&n.scale(a,a),n.translate(e.x,e.y),this.push(n,!1),this.drawText(t,i),this.pop()}}class D extends z{constructor(t,e){super(t,e),this.reset()}reset(){this._xmin=this._ymin=1/0,this._xmax=this._ymax=-1/0,this._clipCount=0}envelope(){return new b.A(this._xmin,this._ymin,this._xmax-this._xmin,this._ymax-this._ymin)}bounds(){return(0,c.fA)(this._xmin,this._ymin,this._xmax,this._ymax)}drawSolidFill(t){if(t&&!(this._clipCount>0))if((0,f.Bi)(t))this._processPath(t.rings,0);else if((0,f.Rg)(t))this._processPath(t.paths,0);else if((0,f.ZC)(t)){const e=k(t);e&&this._processPath(e.rings,0)}else console.error("drawSolidFill Unexpected geometry type!")}drawSolidStroke(t,e,i){if(!t||this._clipCount>0||null==i||i<=0)return;const n=Math.max(.5*this.transformSize((0,I.$w)(i,y.D.CIMSolidStroke.width)),.25);if((0,f.Bi)(t))this._processPath(t.rings,n);else if((0,f.Rg)(t))this._processPath(t.paths,n);else if((0,f.ZC)(t)){const e=k(t);e&&this._processPath(e.rings,n)}else console.error("drawSolidStroke unexpected geometry type!")}drawMarkerLayer(t,e){(0,f.Bi)(e)&&t.markerPlacement&&("CIMMarkerPlacementInsidePolygon"===t.markerPlacement.type||"CIMMarkerPlacementPolygonCenter"===t.markerPlacement.type&&t.markerPlacement.clipAtBoundary)?this._processPath(e.rings,0):super.drawMarkerLayer(t,e)}drawHatchFill(t,e){this.drawSolidFill(t)}drawPictureFill(t,e){this.drawSolidFill(t)}drawGradientFill(t,e){this.drawSolidFill(t)}drawPictureStroke(t,e){this.drawSolidStroke(t,null,e.width)}drawGradientStroke(t,e){this.drawSolidStroke(t,null,e.width)}pushClipPath(t){this.drawSolidFill(t),this._clipCount++}popClipPath(){this._clipCount--}drawImage(t,e){const{url:i}=t,n=(0,I.$w)(t.scaleX,1);let r=n*e,s=e;const o=this._resourceManager.getResource(i);if(null!=o){const t=o.height/o.width;r=n*(e?t>1?e:e/t:o.width),s=e?t>1?e*t:e:o.height}this._merge(this.transformPt([-r/2,-s/2]),0),this._merge(this.transformPt([-r/2,s/2]),0),this._merge(this.transformPt([r/2,-s/2]),0),this._merge(this.transformPt([r/2,s/2]),0)}drawText(t,e){if(!e||0===e.length)return;this._textRasterizer||(this._textRasterizer=new T);const i=U(t);let[n,r]=this._textRasterizer.computeTextSize(e,i);n=(0,l.PN)(n),r=(0,l.PN)(r);const s=this.transformSize(1)*this.reverseTransformScalar(1);n*=s,r*=s;let o=0;switch(t.horizontalAlignment){case"Left":o=n/2;break;case"Right":o=-n/2}let a=0;switch(t.verticalAlignment){case"Bottom":a=r/2;break;case"Top":a=-r/2;break;case"Baseline":a=r/6}this._merge(this.transformPt([-n/2+o,-r/2+a]),0),this._merge(this.transformPt([-n/2+o,r/2+a]),0),this._merge(this.transformPt([n/2+o,-r/2+a]),0),this._merge(this.transformPt([n/2+o,r/2+a]),0)}_processPath(t,e){if(t)for(const i of t){const t=i?i.length:0;if(t>1){this._merge(this.transformPt(i[0]),e);for(let n=1;n<t;n++)this._merge(this.transformPt(i[n]),e)}}}_merge(t,e){t[0]-e<this._xmin&&(this._xmin=t[0]-e),t[0]+e>this._xmax&&(this._xmax=t[0]+e),t[1]-e<this._ymin&&(this._ymin=t[1]-e),t[1]+e>this._ymax&&(this._ymax=t[1]+e)}}class L extends z{constructor(){super(...arguments),this._searchPoint=[0,0],this._searchDistPoint=0,this._textInfo=null,this._svg=null,this._path=null,this._canvas=null}destroy(){this._svg=(0,M.pK)(this._svg),this._path=null,this._canvas=null}hitTest(t,e,i,n,s,o){const a=o*(0,l.Lz)(1);this.setTransform(),this.setGeomUnitsPerPoint(a),this._searchPoint=[(t[0]+t[2])/2,(t[1]+t[3])/2],this._searchDistPoint=(t[2]-t[0])/2/a,this._textInfo=n;const u=e&&("CIMPointSymbol"===e.type&&"Map"!==e.angleAlignment||"CIMTextSymbol"===e.type);if(this._mapRotation=u?s:0,!(0,r.A)("esri-mobile")){const t=(0,l.PN)(A._M*window.devicePixelRatio),i=(0,l.PN)(A.ie);("CIMLineSymbol"!==e?.type&&"CIMPolygonSymbol"!==e?.type||!e.symbolLayers?.some(I.jn))&&"CIMMeshSymbol"!==e?.type&&((0,I.YC)(e)??0)<i&&(this._searchDistPoint=t)}return this._earlyReturn=!1,this.drawSymbol(e,i),this._earlyReturn}executeEffects(t,e){return"CIMGeometricEffectDashes"===t.at(-1)?.type&&(t=t.slice(0,-1)),super.executeEffects(t,e)}drawSolidFill(t,e,i){null!=i?this._hittestSvgPath(t,i,!0):this._hitTestFill(t)}drawHatchFill(t,e){this._hitTestFill(t)}drawPictureFill(t,e){this._hitTestFill(t)}drawGradientFill(t,e){this._hitTestFill(t)}drawSolidStroke(t,e,i,n,r,s,o){null!=o?this._hittestSvgPath(t,o,!1,i):this._hitTestStroke(t,i)}drawPictureStroke(t,e){this._hitTestStroke(t,e.width)}drawGradientStroke(t,e){this._hitTestStroke(t,e.width)}drawMarkerLayer(t,e){t.markerPlacement&&("CIMMarkerPlacementInsidePolygon"===t.markerPlacement.type||"CIMMarkerPlacementPolygonCenter"===t.markerPlacement.type&&t.markerPlacement.clipAtBoundary)?this._hitTestFill(e):super.drawMarkerLayer(t,e)}pushClipPath(t){}popClipPath(){}drawImage(t,e){const{url:i}=t,n=(0,I.$w)(t.scaleX,1),r=this._resourceManager.getResource(i);if(null==r||0===r.height||0===e)return;const s=e*this.geomUnitsPerPoint(),o=s*n*(r.width/r.height),a=this.reverseTransformPt(this._searchPoint),l=this._searchDistPoint;Math.abs(a[0])<o/2+l&&Math.abs(a[1])<s/2+l&&(this._earlyReturn=!0)}drawText(t,e){const i=this._textInfo;if(!i)return;const n=i.get(t);if(!n)return;if(!n.glyphMosaicItems.glyphs.length)return;const r=(0,E.hV)((0,I.$w)(t.height,y.D.CIMTextSymbol.height)),{lineGapType:s,lineGap:o}=t,a=s?B(s,(0,I.$w)(o),r):0,l="CIMBackgroundCallout"===t.callout?.type,u=(0,C.Tl)(n.glyphMosaicItems,{scale:r/A.eG,angle:0,xOffset:0,yOffset:0,horizontalAlignment:t.horizontalAlignment,verticalAlignment:t.verticalAlignment,maxLineWidth:(0,E.Lu)(t.lineWidth),lineHeight:A.DY*Math.max(.25,Math.min(a||1,4)),decoration:t.font.decoration||"none",useCIMAngleBehavior:!0,hasBackground:l}),c=this.reverseTransformPt(this._searchPoint),h=c[0],d=c[1];for(const t of u.glyphs)if(h>t.xTopLeft&&h<t.xBottomRight&&d>-t.yBottomRight&&d<-t.yTopLeft){this._earlyReturn=!0;break}}_hitTestFill(t){let e=null;if((0,f.ZC)(t)){const i=t;e=[[[i.xmin,i.ymin],[i.xmin,i.ymax],[i.xmax,i.ymax],[i.xmax,i.ymin],[i.xmin,i.ymin]]]}else if((0,f.Bi)(t))e=t.rings;else{if(!(0,f.Rg)(t))return;e=t.paths}const i=this.reverseTransformPt(this._searchPoint);(function(t,e){let i=0;for(const n of e){const e=n.length;for(let r=1;r<e;r++){const e=n[r-1],s=n[r];e[1]>t[1]!=s[1]>t[1]&&((s[0]-e[0])*(t[1]-e[1])-(s[1]-e[1])*(t[0]-e[0])>0?i++:i--)}}return 0!==i})(i,e)&&(this._earlyReturn=!0),this._earlyReturn||V(i,e,this.reverseTransformScalar(this._searchDistPoint)*this.prevGeomUnitsPerPoint())&&(this._earlyReturn=!0)}_getSvgPath(){return null!=this._svg&&null!=this._path||(this._svg??=(0,M.p)(),this._path??=(0,M.FJ)("path"),this._svg.appendChild(this._path)),this._path}_getCanvas(){return this._canvas??=document.createElement("canvas"),this._canvas}_hittestSvgPath(t,e,i,n){const r=(0,c.vt)();(0,h.Rg)(r,t);const s=r[0],o=r[1],a=r[2]-r[0],l=r[3]-r[1],u=this._getSvgPath();u.setAttribute("d",e);const d=u.getBBox(),f=d.width/a,p=d.height/l,_=this._getCanvas();_.width=d.width,_.height=d.height;const m=_.getContext("2d",{willReadFrequently:!0});m.setTransform(1,0,0,1,d.x,-d.y);const g=new Path2D(e);i?m.fill(g):(m.lineWidth=n*f,m.stroke(g));const y=this.reverseTransformScalar(this._searchDistPoint)*this.prevGeomUnitsPerPoint(),v=this.reverseTransformPt(this._searchPoint),x=(v[0]-s-y)*f,b=(l-(v[1]-o)-y)*p,S=2*y*f,w=2*y*p,T=m.getImageData(x,b,S,w).data;for(let t=3;t<T.length;t+=4)if(T[t]>127.5)return void(this._earlyReturn=!0)}_hitTestStroke(t,e){let i=null;if((0,f.ZC)(t)){const e=t;i=[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]}else if((0,f.Bi)(t))i=t.rings;else{if(!(0,f.Rg)(t))return;i=t.paths}V(this.reverseTransformPt(this._searchPoint),i,(0,I.$w)(e,y.D.CIMSolidStroke.width)*this.geomUnitsPerPoint()/2+this.reverseTransformScalar(this._searchDistPoint)*this.prevGeomUnitsPerPoint())&&(this._earlyReturn=!0)}}class F extends z{constructor(t,e,i,n){super(e,i),this._applyAdditionalRenderProps=n,this._colorSubstitutionHelper=new _,this._ctx=t}drawSolidFill(t,e){if(!t)return;if((0,f.Bi)(t))this._buildPath(t.rings,!0);else if((0,f.Rg)(t))this._buildPath(t.paths,!0);else if((0,f.ZC)(t))this._buildPath(k(t).rings,!0);else{if(!(0,f.U9)(t))return;console.log("CanvasDrawHelper.drawSolidFill - No implementation!")}const i=this._ctx;i.fillStyle="string"==typeof e?e:"rgba("+Math.round(e[0])+","+Math.round(e[1])+","+Math.round(e[2])+","+(e[3]??255)/255+")",i.fill("evenodd")}drawSolidStroke(t,e,i,n,r,s){if(!t||!e||0===i)return;if((0,f.Bi)(t))this._buildPath(t.rings,!0);else if((0,f.Rg)(t))this._buildPath(t.paths,!1);else{if(!(0,f.ZC)(t))return void console.log("CanvasDrawHelper.drawSolidStroke isn't implemented!");this._buildPath(k(t).rings,!0)}const o=this._ctx;o.strokeStyle="string"==typeof e?e:"rgba("+Math.round(e[0])+","+Math.round(e[1])+","+Math.round(e[2])+","+(e[3]??255)/255+")",o.lineWidth=Math.max(this.transformSize(i),.5),this._setCapStyle(n),this._setJoinStyle(r),o.miterLimit=s,o.stroke()}pushClipPath(t){if(this._ctx.save(),(0,f.Bi)(t))this._buildPath(t.rings,!0);else if((0,f.Rg)(t))this._buildPath(t.paths,!0);else{if(!(0,f.ZC)(t))return;this._buildPath(k(t).rings,!0)}this._ctx.clip("evenodd")}popClipPath(){this._ctx.restore()}drawImage(t,e){const{colorSubstitutions:i,url:n,tintColor:r}=t,s=(0,I.$w)(t.scaleX,1),o=this._resourceManager.getResource(n);if(null==o)return;let a=e*(o.width/o.height),l=e;e||(a=o.width,l=o.height);const u=(0,I.UE)(n)||"src"in o&&(0,I.UE)(o.src);let c="getFrame"in o?x(o):o;i&&(c=this._colorSubstitutionHelper.applyColorSubstitution(c,i)),this._applyAdditionalRenderProps&&!u&&r&&(c=this._colorSubstitutionHelper.tintImageData(c,r));const h=this.transformPt([0,0]),[d,f]=this.getTransformAngle(),p=this.transformSize(1),_=this._ctx;_.save(),_.setTransform({m11:s*p*d,m12:s*p*f,m21:-p*f,m22:p*d,m41:h[0],m42:h[1]}),_.drawImage(c,-a/2,-l/2,a,l),_.restore()}drawText(t,e){if(!e||0===e.length)return;this._textRasterizer||(this._textRasterizer=new T);const i=U(t,this.transformSize((0,l.PN)(1))),n=this._textRasterizer.rasterizeText(e,i);if(!n)return;const{size:r,anchorX:s,anchorY:o,canvas:a}=n,u=r[0]*(s+.5),c=r[1]*(o-.5),h=this._ctx,d=this.transformPt([0,0]),[f,p]=this.getTransformAngle();h.save(),h.setTransform({m11:1*f,m12:1*p,m21:-1*p,m22:1*f,m41:d[0]-1*u,m42:d[1]+1*c}),h.drawImage(a,0,0),h.restore()}drawPictureFill(t,e){if(!t)return;let{colorSubstitutions:i,height:n,offsetX:r,offsetY:s,rotation:o,scaleX:a,tintColor:l,url:u}=e;const c=this._resourceManager.getResource(u);if(null==c)return;if((0,f.Bi)(t))this._buildPath(t.rings,!0);else if((0,f.Rg)(t))this._buildPath(t.paths,!0);else if((0,f.ZC)(t))this._buildPath(k(t).rings,!0);else{if(!(0,f.U9)(t))return;console.log("CanvasDrawHelper.drawPictureFill - No implementation!")}const h=this._ctx,d=(0,I.UE)(u)||"src"in c&&(0,I.UE)(c.src);let p,_="getFrame"in c?x(c):c;if(i&&(_=this._colorSubstitutionHelper.applyColorSubstitution(_,i)),this._applyAdditionalRenderProps){d||l&&(_=this._colorSubstitutionHelper.tintImageData(_,l)),p=h.createPattern(_,"repeat");const t=this.transformSize(1);o||(o=0),r?r*=t:r=0,s?s*=t:s=0,n&&(n*=t);const e=n?n/c.height:1,i=a&&n?a*n/c.width:1;if(0!==o||1!==e||1!==i||0!==r||0!==s){const t=new DOMMatrix;t.rotateSelf(0,0,-o).translateSelf(r,s).scaleSelf(i,e,1),p.setTransform(t)}}else p=h.createPattern(_,"repeat");h.save(),h.fillStyle=p,h.fill("evenodd"),h.restore()}drawPictureStroke(t,e){if(!t)return;let{colorSubstitutions:i,capStyle:n,joinStyle:r,miterLimit:o,tintColor:a,url:u,width:c}=e;const h=this._resourceManager.getResource(u);if(null==h)return;let d;if((0,f.Bi)(t))d=t.rings;else if((0,f.Rg)(t))d=t.paths;else{if(!(0,f.ZC)(t))return(0,f.U9)(t)?void console.log("CanvasDrawHelper.drawPictureStroke - No implementation!"):void 0;d=k(t).rings}c||(c=h.width);const p=(0,I.UE)(u)||"src"in h&&(0,I.UE)(h.src);let _="getFrame"in h?x(h):h;i&&(_=this._colorSubstitutionHelper.applyColorSubstitution(_,i)),this._applyAdditionalRenderProps&&(p||a&&(_=this._colorSubstitutionHelper.tintImageData(_,a)));const m=Math.max(this.transformSize((0,l.Lz)(c)),.5),g=m/_.width,y=this._ctx,v=y.createPattern(_,"repeat-y");let b,S;y.save(),this._setCapStyle(n),this._setJoinStyle(r),void 0!==o&&(y.miterLimit=o),y.lineWidth=m;for(let t of d)if(t=(0,s.o8)(t),Y(t),t&&!(t.length<=1)){b=this.transformPt(t[0]);for(let e=1;e<t.length;e++){S=this.transformPt(t[e]);const i=N(b,S),n=new DOMMatrix;n.translateSelf(0,b[1]-m/2).scaleSelf(g,g,1).rotateSelf(0,0,90-i),v.setTransform(n),y.strokeStyle=v,y.beginPath(),y.moveTo(b[0],b[1]),y.lineTo(S[0],S[1]),y.stroke(),b=S}}y.restore()}_buildPath(t,e){const i=this._ctx;if(i.beginPath(),t)for(const n of t){const t=n?n.length:0;if(t>1){let r=this.transformPt(n[0]);i.moveTo(r[0],r[1]);for(let e=1;e<t;e++)r=this.transformPt(n[e]),i.lineTo(r[0],r[1]);e&&i.closePath()}}}_setCapStyle(t){switch(t){case v.uT.Butt:this._ctx.lineCap="butt";break;case v.uT.Round:this._ctx.lineCap="round";break;case v.uT.Square:this._ctx.lineCap="square"}}_setJoinStyle(t){switch(t){case v.wd.Bevel:this._ctx.lineJoin="bevel";break;case v.wd.Round:this._ctx.lineJoin="round";break;case v.wd.Miter:this._ctx.lineJoin="miter"}}}function V(t,e,i){for(const n of e){const e=n.length;for(let r=1;r<e;r++){const e=n[r-1],s=n[r];let o=(s[0]-e[0])*(s[0]-e[0])+(s[1]-e[1])*(s[1]-e[1]);if(0===o)continue;o=Math.sqrt(o);const a=((s[0]-e[0])*(t[1]-e[1])-(s[1]-e[1])*(t[0]-e[0]))/o;if(Math.abs(a)<i){const n=((s[0]-e[0])*(t[0]-e[0])+(s[1]-e[1])*(t[1]-e[1]))/o;if(n>-i&&n<o+i)return!0}}}return!1}function N(t,e){const i=e[0]-t[0],n=e[1]-t[1];return 180/Math.PI*Math.atan2(n,i)}const k=t=>t?{spatialReference:t.spatialReference,rings:[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]}:null,B=(t,e,i)=>{switch(t){case"ExtraLeading":return 1+e/i;case"Multiple":return e;case"Exact":return e/i}};function U(t,e=1){const i=(0,I.DW)(t),r=(0,I._d)(t.fontStyleName),s=t.fontFamilyName??n.Vb,{weight:o,style:a}=r,l=e*(t.height||5),u=(0,I.Bu)(t.horizontalAlignment),c=(0,I.Nl)(t.verticalAlignment),h=(0,I.pM)(t),d=(0,I.pM)(t.haloSymbol),f=null!=d?e*(t.haloSize??0):0,p=(0,I._1)(t.symbol),_=e*((0,I.xo)(t.symbol)||0),m="CIMBackgroundCallout"===t.callout?.type?t.callout.backgroundSymbol:null,g=(0,I.pM)(m),y=(0,I.xo)(m),v=(0,I._1)(m);return{color:h,size:l,horizontalAlignment:u,verticalAlignment:c,font:{family:s,style:(0,I.pV)(a),weight:(0,I.Kn)(o),decoration:i},outline:{size:_||0,color:p},halo:{size:f||0,color:d,style:a},backgroundColor:g,borderLine:null!=y&&null!=v?{size:y,color:v}:null,pixelRatio:1,premultiplyColors:!0}}const G=1e-4;function Y(t){let e,i,n,r,s,o=t[0],a=1;for(;a<t.length;)e=t[a][0]-o[0],i=t[a][1]-o[1],r=0!==e?i/e:Math.PI/2,void 0!==n&&r-n<=G?(t.splice(a-1,1),o=s):(s=o,o=t[a],a++),n=r}},57176:function(t,e,i){i.d(e,{BW:function(){return Y},Sc:function(){return O},Vb:function(){return M},ll:function(){return R},wp:function(){return z}});var n=i(90152),r=i(58941),s=i(21609),o=i(40633),a=i(13798),l=i(13520),u=i(87416),c=i(35068),h=i(90046),d=i(29076),f=i(14817),p=i(38821),_=i(33389),m=i(7590),g=i(74661),y=i(7056),v=i(39686),x=i(17469),b=i(96700);const S=Math.PI,w=S/2,T=Math.PI/180,P=96/72,I=()=>o.A.getLogger("esri.symbols.cim.CIMSymbolHelper");function M(t){let e;switch(t.type){case"cim":return t.data;case"web-style":return t;case"simple-marker":{const i=z.fromSimpleMarker(t);if(!i)throw new Error("InternalError: Cannot convert symbol to CIM");e=i;break}case"picture-marker":e=z.fromPictureMarker(t);break;case"simple-line":e=z.fromSimpleLineSymbol(t);break;case"simple-fill":e=z.fromSimpleFillSymbol(t);break;case"picture-fill":e=z.fromPictureFillSymbol(t);break;case"text":e=z.fromTextSymbol(t)}return{type:"CIMSymbolReference",symbol:e}}function A(t,e,i){switch(e.type){case"CIMSymbolReference":return A(t,e.symbol,i);case"CIMPointSymbol":null==i&&(i={x:0,y:0}),t.drawSymbol(e,i);break;case"CIMLineSymbol":null==i&&(i={paths:[[[0,0],[10,0]]]}),t.drawSymbol(e,i);break;case"CIMPolygonSymbol":null==i&&(i={rings:[[[0,0],[0,10],[10,10],[10,0],[0,0]]]}),t.drawSymbol(e,i);break;case"CIMTextSymbol":{const i={x:0,y:0};t.drawSymbol(e,i);break}case"CIMVectorMarker":{const i=new d.W;t.drawMarker(e,i);break}}return t.envelope()}function C(t){if(!t)return 0;switch(t.type){case"CIMMarkerPlacementAlongLineSameSize":case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAtExtremities":case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementAtRatioPositions":case"CIMMarkerPlacementOnLine":case"CIMMarkerPlacementOnVertices":return Math.abs(t.offset);default:return 0}}function E(t){if(!t)return 0;switch(t.type){case"CIMGeometricEffectArrow":return Math.abs(.5*t.width);case"CIMGeometricEffectBuffer":return Math.abs(t.size);case"CIMGeometricEffectControlMeasureLine":return 500;case"CIMGeometricEffectExtension":case"CIMGeometricEffectRadial":return Math.abs(t.length);case"CIMGeometricEffectJog":return Math.abs(.5*t.length);case"CIMGeometricEffectMove":return Math.max(Math.abs((0,m.$w)(t.offsetX)),Math.abs((0,m.$w)(t.offsetY)));case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":return Math.abs(t.offset);case"CIMGeometricEffectRegularPolygon":return Math.abs(t.radius);case"CIMGeometricEffectRotate":case"CIMGeometricEffectScale":default:return 0;case"CIMGeometricEffectTaperedPolygon":return.5*Math.max(Math.abs(t.fromWidth),Math.abs(t.toWidth));case"CIMGeometricEffectWave":return Math.abs(t.amplitude);case"CIMGeometricEffectDonut":return Math.abs(t.width)}}function R(t){if(!t)return 0;let e=0;for(const i of t)e+=E(i);return e}class O{static getSymbolInflateSize(t,e,i,n,r){return t||(t=[0,0,0,0]),e?this._getInflateSize(t,e,i,n,r):t}static safeSize(t){const e=Math.max(Math.abs(t[0]),Math.abs(t[2])),i=Math.max(Math.abs(t[1]),Math.abs(t[3]));return Math.sqrt(e*e+i*i)}static _vectorMarkerBounds(t,e,i,n){let r=!0;const s=(0,u.vt)();if(e?.markerGraphics)for(const o of e.markerGraphics){const e=[0,0,0,0];o.geometry&&((0,c.Rg)(s,o.geometry),e[0]=0,e[1]=0,e[2]=0,e[3]=0,this.getSymbolInflateSize(e,o.symbol,i,0,n),s[0]+=e[0],s[1]+=e[1],s[2]+=e[2],s[3]+=e[3],r?(t[0]=s[0],t[1]=s[1],t[2]=s[2],t[3]=s[3],r=!1):(t[0]=Math.min(t[0],s[0]),t[1]=Math.min(t[1],s[1]),t[2]=Math.max(t[2],s[2]),t[3]=Math.max(t[3],s[3])))}return t}static _getInflateSize(t,e,i,n,r){if(function(t){return void 0!==t.symbolLayers}(e)){const s=this._getLayersInflateSize(t,e.symbolLayers,i,n,r),o=R(e.effects);return o>0&&(s[0]-=o,s[1]-=o,s[2]+=o,s[3]+=o),s}return this._getTextInflatedSize(t,e,r)}static _getLayersInflateSize(t,e,i,n,r){let s=!0;if(!e)return t;for(const o of e){if(!o)continue;let e=[0,0,0,0];switch(o.type){case"CIMSolidFill":case"CIMPictureFill":case"CIMHatchFill":case"CIMGradientFill":break;case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":{const t=o;let i=t.width;null!=i&&(t.capStyle===_.uT.Square||t.joinStyle===_.wd.Miter?i/=1.4142135623730951:i/=2,e[0]=-i,e[1]=-i,e[2]=i,e[3]=i);break}case"CIMCharacterMarker":case"CIMVectorMarker":case"CIMPictureMarker":{const t=o;if("CIMVectorMarker"===o.type){const t=o;if(e=this._vectorMarkerBounds(e,t,i,r),t.frame){const i=(t.frame.xmin+t.frame.xmax)/2,n=(t.frame.ymin+t.frame.ymax)/2;if(e[0]-=i,e[1]-=n,e[2]-=i,e[3]-=n,null!=t.size){const i=t.size/(t.frame.ymax-t.frame.ymin);e[0]*=i,e[1]*=i,e[2]*=i,e[3]*=i}}}else if("CIMPictureMarker"===o.type){const n=o,r=i.getResource(n.url);let s=1;if(null!=r&&r.height&&(s=r.width/r.height),null!=t.size){const i=t.size/2,r=t.size*s*n.scaleX/2;e=[-r,-i,r,i]}}else if(null!=t.size){const i=t.size/2;e=[-i,-i,i,i]}if(t.anchorPoint){let i,n;"Absolute"===t.anchorPointUnits?(i=t.anchorPoint.x,n=t.anchorPoint.y):(i=t.anchorPoint.x*(e[2]-e[0]),n=t.anchorPoint.y*(e[3]-e[1]));const r=1.25*Math.sqrt(i*i+n*n);e[0]-=r,e[1]-=r,e[2]+=r,e[3]+=r}let s=(0,m.$w)(t.rotation);if(t.rotateClockwise&&(s=-s),n&&(s-=n),s){const t=T*s,i=Math.cos(t),n=Math.sin(t),r=(0,u.vt)([y.MG,y.MG,-y.MG,-y.MG]);(0,u.tK)(r,[e[0]*i-e[1]*n,e[0]*n+e[1]*i]),(0,u.tK)(r,[e[0]*i-e[3]*n,e[0]*n+e[3]*i]),(0,u.tK)(r,[e[2]*i-e[1]*n,e[2]*n+e[1]*i]),(0,u.tK)(r,[e[2]*i-e[3]*n,e[2]*n+e[3]*i]),e=r}let a=(0,m.$w)(t.offsetX),l=(0,m.$w)(t.offsetY);if(n){const t=T*n,e=Math.cos(t),i=Math.sin(t),r=a*i+l*e;a=a*e-l*i,l=r}e[0]+=a,e[1]+=l,e[2]+=a,e[3]+=l;const c=C(t.markerPlacement);c>0&&(e[0]-=c,e[1]-=c,e[2]+=c,e[3]+=c);break}}const a=R(o.effects);a>0&&(e[0]-=a,e[1]-=a,e[2]+=a,e[3]+=a),s?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],s=!1):(t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[2]),t[3]=Math.max(t[3],e[3]))}return t}static _getTextInflatedSize(t,e,i){const n=(0,b.hV)(e.height??p.D.CIMTextSymbol.height);if(t[0]=-n/2,t[1]=-n/2,t[2]=n/2,t[3]=n/2,!i)return t;const r=i.get(e);if(!r)return t;if(!r.glyphMosaicItems.glyphs.length)return t;const{lineGapType:s,lineGap:o}=e,a=s?(0,f.QF)(s,o??0,n):0,l="CIMBackgroundCallout"===e.callout?.type,u=(0,x.Tl)(r.glyphMosaicItems,{scale:n/v.eG,angle:(0,m.$w)(e.angle),xOffset:(0,m.$w)(e.offsetX),yOffset:(0,m.$w)(e.offsetY),horizontalAlignment:e.horizontalAlignment,verticalAlignment:e.verticalAlignment,maxLineWidth:(0,b.Lu)(e.lineWidth),lineHeight:v.DY*Math.max(.25,Math.min(a||1,4)),decoration:e.font.decoration||"none",useCIMAngleBehavior:!0,hasBackground:l}).boundsT,c=Math.sqrt(u.width*u.width+u.height*u.height);return t[0]-=u.x+c,t[1]-=u.y-c,t[2]+=u.x+c,t[3]+=-u.y+c,t}}class z{static getEnvelope(t,e,i){if(!t)return null;const n=new f.mx(i);if(Array.isArray(t)){let i;for(const r of t)i?i.union(A(n,r,e)):i=A(n,r,e);return i}return A(n,t,e)}static getTextureAnchor(t,e){const i=this.getEnvelope(t,null,e);if(!i)return[0,0,0];const n=(i.x+.5*i.width)*P,r=(i.y+.5*i.height)*P,s=i.width*P+2,o=i.height*P+2;return[-n/s,-r/o,o]}static rasterize(t,e,i,n,r=!0,s){const o=i||this.getEnvelope(e,null,n);if(!o)return[null,0,0,0,0];const a=Math.max(o.width,o.height)*P;let l=null!=s?Math.max(s/a,1):1;l*=P;const u=(o.x+.5*o.width)*l,c=(o.y+.5*o.height)*l;t.width=o.width*l,t.height=o.height*l,i||(t.width+=2,t.height+=2);const h=t.getContext("2d",{willReadFrequently:!0}),p=f.IT.createScale(l,-l);p.translate(.5*t.width-u,.5*t.height+c);const _=new f.Rj(h,n,p);switch(e.type){case"CIMPointSymbol":{const t={type:"point",x:0,y:0};_.drawSymbol(e,t);break}case"CIMVectorMarker":{const t=new d.W;_.drawMarker(e,t);break}}const m=h.getImageData(0,0,t.width,t.height),g=new Uint8Array(m.data);if(r){let t;for(let e=0;e<g.length;e+=4)t=g[e+3]/255,g[e]=g[e]*t,g[e+1]=g[e+1]*t,g[e+2]=g[e+2]*t}return[g,t.width,t.height,-u/t.width,-c/t.height]}static fromTextSymbol(t){const{text:e}=t;return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPointUnits:"Relative",dominantSizeAxis3D:"Y",size:10,billboardMode3D:"FaceNearPlane",frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{x:0,y:0},symbol:z.createCIMTextSymbolfromTextSymbol(t),textString:e}],scaleSymbolsProportionally:!0,respectFrame:!0}],scaleX:1,angleAlignment:"Display"}}static fromPictureFillSymbol(t){const{height:e,outline:i,width:n,xoffset:r,xscale:s,yoffset:o,yscale:a}=t,l=[],u={type:"CIMPolygonSymbol",symbolLayers:l};if(i){const t=W(i);t&&l.push(t)}let c=t.url;"esriPFS"===t.type&&t.imageData&&(c=t.imageData);const h="angle"in t?t.angle??0:0,d=(n??0)*(s||1),f=(e??0)*(a||1);return l.push({type:"CIMPictureFill",invertBackfaceTexture:!1,scaleX:1,textureFilter:_.O$.Picture,tintColor:null,url:c,height:f,width:d,offsetX:(0,m.$w)(r),offsetY:(0,m.$w)(o),rotation:(0,m.$w)(-h),colorSubstitutions:null}),u}static fromSimpleFillSymbol(t){const{color:e,style:i,outline:n}=t,r=[],o={type:"CIMPolygonSymbol",symbolLayers:r};if(n){const t=W(n);t&&r.push(t)}if(i&&"solid"!==i&&"none"!==i&&"esriSFSSolid"!==i&&"esriSFSNull"!==i){const t={type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",color:k(e),capStyle:_.uT.Butt,joinStyle:_.wd.Miter,width:.75}]};let n=0;const o=(0,l.PN)(H(i)?8:10);switch(i){case"vertical":case"esriSFSVertical":n=90;break;case"forward-diagonal":case"esriSFSForwardDiagonal":case"diagonal-cross":case"esriSFSDiagonalCross":n=-45;break;case"backward-diagonal":case"esriSFSBackwardDiagonal":n=45;break;case"cross":case"esriSFSCross":n=0}r.push({type:"CIMHatchFill",lineSymbol:t,offsetX:0,offsetY:0,rotation:n,separation:o}),"cross"===i||"esriSFSCross"===i?r.push({type:"CIMHatchFill",lineSymbol:(0,s.o8)(t),offsetX:0,offsetY:0,rotation:90,separation:o}):"diagonal-cross"!==i&&"esriSFSDiagonalCross"!==i||r.push({type:"CIMHatchFill",lineSymbol:(0,s.o8)(t),offsetX:0,offsetY:0,rotation:45,separation:o})}else!i||"solid"!==i&&"esriSFSSolid"!==i||r.push({type:"CIMSolidFill",enable:!0,color:k(e)});return o}static fromSimpleLineSymbol(t){const{cap:e,color:i,join:n,marker:r,miterLimit:s,style:o,width:a}=t;let l=null;"solid"!==o&&"none"!==o&&"esriSLSSolid"!==o&&"esriSLSNull"!==o&&(l=[{type:"CIMGeometricEffectDashes",dashTemplate:Y(o,e),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]);const u=[];if(r){let t;switch(r.placement){case"begin-end":t=_.$2.Both;break;case"begin":t=_.$2.JustBegin;break;case"end":t=_.$2.JustEnd;break;default:t=_.$2.None}const e=z.fromSimpleMarker(r,a,i).symbolLayers[0];e.markerPlacement={type:"CIMMarkerPlacementAtExtremities",placePerPart:!1,angleToLine:!0,offset:0,extremityPlacement:t,offsetAlongLine:0},u.push(e)}return u.push({type:"CIMSolidStroke",color:"none"!==o&&"esriSLSNull"!==o?k(i):[0,0,0,0],capStyle:L(e),joinStyle:F(n),miterLimit:s,width:a,effects:l}),{type:"CIMLineSymbol",symbolLayers:u}}static fromPictureMarker(t){const{angle:e,height:i,width:n,xoffset:r,yoffset:s}=t;let o=t.url;return"esriPMS"===t.type&&t.imageData&&(o=t.imageData),{type:"CIMPointSymbol",symbolLayers:[{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:_.O$.Picture,tintColor:null,url:o,size:i,width:n,offsetX:(0,m.$w)(r),offsetY:(0,m.$w)(s),rotation:(0,m.$w)(-e)}]}}static createCIMTextSymbolfromTextSymbol(t){const{angle:e,color:i,font:r,haloColor:s,haloSize:o,horizontalAlignment:a,kerning:l,lineWidth:u,text:c,verticalAlignment:h,xoffset:d,yoffset:f,backgroundColor:p,borderLineColor:g,borderLineSize:y}=t;let v,x,b,S,w,T;r&&(v=r.family,x=r.style,b=r.weight,S=r.size,w=r.decoration);let P=!1;return c&&(P=(0,n.y)(c)[1]),(p||y)&&(T={type:"CIMBackgroundCallout",margin:null,backgroundSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",color:k(p)},{type:"CIMSolidStroke",color:k(g),width:y}]},accentBarSymbol:null,gap:null,leaderLineSymbol:null,lineStyle:null}),{type:"CIMTextSymbol",angle:e,blockProgression:_.TZ.BTT,depth3D:1,extrapolateBaselines:!0,fontEffects:_.Y.Normal,fontEncoding:_.bj.Unicode,fontFamilyName:v||"Arial",fontStyleName:B(x,b),fontType:_.g7.Unspecified,haloSize:o,height:S,hinting:_.mU.Default,horizontalAlignment:V(a??"center"),kerning:l,letterWidth:100,ligatures:!0,lineGapType:"Multiple",lineWidth:u,offsetX:(0,m.$w)(d),offsetY:(0,m.$w)(f),strikethrough:"line-through"===w,underline:"underline"===w,symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:k(i)}]},haloSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:k(s)}]},shadowColor:[0,0,0,255],shadowOffsetX:1,shadowOffsetY:1,textCase:"Normal",textDirection:P?_.f0.RTL:_.f0.LTR,verticalAlignment:N(h??"baseline"),verticalGlyphOrientation:_.vG.Right,wordSpacing:100,billboardMode3D:_.xn.FaceNearPlane,callout:T}}static createPictureMarkerRasterizationParam(t){const{angle:e,height:i,width:n,xoffset:r,yoffset:s}=t,o=t.url??t.source?.url??t.source?.imageData;return o?{type:"sprite-rasterization-param",overrides:[],resource:{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:_.O$.Picture,tintColor:null,url:o,size:i,width:n,offsetX:(0,m.$w)(r),offsetY:(0,m.$w)(s),rotation:(0,m.$w)(-e)}}:null}static createPictureFillRasterizationParam(t){const{width:e,height:i,xoffset:n,yoffset:r,url:s}=t;return s?{type:"sprite-rasterization-param",overrides:[],resource:{type:"CIMPictureFill",scaleX:1,textureFilter:_.O$.Picture,tintColor:null,url:s,width:e,height:i,offsetX:(0,m.$w)(n),offsetY:(0,m.$w)(r),rotation:0}}:null}static fromSimpleMarker(t,e,i){const{style:n}=t,r=t.color??i;if("path"===n||"esriSMSPath"===n){const e=[];if("outline"in t&&t.outline){const i=t.outline;e.push({type:"CIMSolidStroke",enable:!0,width:i.width,color:k(i.color),path:t.path})}e.push({type:"CIMSolidFill",enable:!0,color:k(r),path:t.path});const[i,n]=Z("square");return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:-(0,m.$w)(t.angle),size:(0,m.$w)(t.size||6),offsetX:(0,m.$w)(t.xoffset),offsetY:(0,m.$w)(t.yoffset),scaleSymbolsProportionally:!1,frame:i,markerGraphics:[{type:"CIMMarkerGraphic",geometry:n,symbol:{type:"CIMPolygonSymbol",symbolLayers:e}}]}]}}const s=[];let o,a,l=t.size;if("outline"in t&&t.outline&&"none"!==t.outline.style&&"esriSLSNull"!==t.outline.style){const e=t.outline,i="solid"!==e.style&&"esriSLSSolid"!==e.style;[o,a]=i?Z(n,t.size):Z(n);const r=e.width??g.A7.width;if(i){const e=r/t.size,i=(o.xmax-o.xmin)*e/2,n=(o.ymax-o.ymin)*e/2;o.xmin-=i,o.xmax+=i,o.ymin-=n,o.ymax+=n,l&&(l+=r)}const u="cross"!==t.style&&"x"!==t.style||"dot"===t?.outline.style||"short-dot"===t?.outline.style?_.yS.HalfGap:_.yS.FullPattern,c=i?[{type:"CIMGeometricEffectAddControlPoints"},{type:"CIMGeometricEffectDashes",dashTemplate:Y(e.style,null).map((t=>e.width&&e.width>0?t*e.width:t)),lineDashEnding:u,controlPointEnding:_.yS.FullPattern}]:void 0;s.push({type:"CIMSolidStroke",capStyle:i?_.uT.Round:_.uT.Butt,enable:!0,width:r,color:k(e.color),effects:c})}else!e||"line-marker"!==t.type||"cross"!==t.style&&"x"!==t.style?[o,a]=Z(n):([o,a]=Z(n),s.push({type:"CIMSolidStroke",enable:!0,width:e,color:k(r)}));s.push({type:"CIMSolidFill",enable:!0,color:k(r)});const u={type:"CIMPolygonSymbol",symbolLayers:s};return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:(0,m.$w)(-t.angle),size:(0,m.$w)(l||6*e),offsetX:(0,m.$w)(t.xoffset),offsetY:(0,m.$w)(t.yoffset),scaleSymbolsProportionally:!1,frame:o,markerGraphics:[{type:"CIMMarkerGraphic",geometry:a,symbol:u}]}]}}static fromCIMHatchFill(t,e){const i=e*(t.separation??p.D.CIMHatchFill.separation),n=i/2,r=(0,s.o8)(t.lineSymbol);r.symbolLayers?.forEach((t=>{switch(t.type){case"CIMSolidStroke":null!=t.width&&(t.width*=e),t.effects?.forEach((t=>{if("CIMGeometricEffectDashes"===t.type){const i=t.dashTemplate;t.dashTemplate=i?.map((t=>t*e))}}));break;case"CIMVectorMarker":{null!=t.size&&(t.size*=e);const i=t.markerPlacement;null!=i&&"placementTemplate"in i&&(i.placementTemplate=i.placementTemplate.map((t=>t*e)));break}}}));let o=this._getLineSymbolPeriod(r)||4;for(;o<4;)o*=2;const a=o/2;return{type:"CIMVectorMarker",frame:{xmin:-a,xmax:a,ymin:-n,ymax:n},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[-a,0],[a,0]]]},symbol:r}],size:i}}static fetchResources(t,e,i,n=null){return t&&e?(D(t,(t=>{(function(t,e,i){t.effects&&null==e.geometryEngine&&(e.geometryEnginePromise?i.push(e.geometryEnginePromise):(0,m.yH)(t.effects)&&(e.geometryEnginePromise=(0,m._H)(),i.push(e.geometryEnginePromise),e.geometryEnginePromise.then((t=>e.geometryEngine=t))))})(t,e,i),"url"in t&&t.url&&i.push(e.fetchResource(t.url,{signal:n}))})),i):i}static fetchFonts(t,e,i){if(t&&e)if("symbolLayers"in t&&t.symbolLayers){for(const n of t.symbolLayers)if("CIMVectorMarker"===n.type&&n.markerGraphics)for(const t of n.markerGraphics)t?.symbol&&z.fetchFonts(t.symbol,e,i)}else if("CIMTextSymbol"===t.type){const{fontFamilyName:n,fontStyleName:r}=t;if(!n||"calcitewebcoreicons"===n.toLowerCase())return;const{style:s,weight:o}=(0,m._d)(r),a=(0,m.DW)(t),l=new h.A({family:n,style:s,weight:o,decoration:a});i.push(e.loadFont(l).catch((()=>{I().error(`Unsupported font ${n} in CIM symbol`)})))}}static _getLineSymbolPeriod(t){if(t){const e=this._getEffectsRepeat(t.effects);if(e)return e;if(t.symbolLayers)for(const e of t.symbolLayers)if(e){const t=this._getEffectsRepeat(e.effects);if(t)return t;switch(e.type){case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":{const t=this._getPlacementRepeat(e.markerPlacement);if(t)return t}}}}return 0}static _getEffectsRepeat(t){if(t)for(const e of t)if(e)switch(e.type){case"CIMGeometricEffectDashes":{const t=e.dashTemplate;if(t&&t.length){let e=0;for(const i of t)e+=i;return 1&t.length&&(e*=2),e}break}case"CIMGeometricEffectWave":return e.period;default:I().error(`unsupported geometric effect type ${e.type}`)}return 0}static _getPlacementRepeat(t){if(t)switch(t.type){case"CIMMarkerPlacementAlongLineSameSize":case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineVariableSize":{const e=t.placementTemplate;if(e&&e.length){let t=0;for(const i of e)t+=+i;return 1&e.length&&(t*=2),t}break}}return 0}static fromCIMInsidePolygon(t){const e=t.markerPlacement,i={...t};i.markerPlacement=null,i.anchorPoint=null;const n=Math.abs(e.stepX),r=Math.abs(e.stepY),s=(e.randomness??100)/100;let o,u,c,h;if("Random"===e.gridType){const t=(0,l.PN)(v.yv),i=Math.max(Math.floor(t/n),1),d=Math.max(Math.floor(t/r),1);o=i*n/2,u=d*r/2,c=2*u;const f=new a.A(e.seed),p=s*n/1.5,_=s*r/1.5;h=[];for(let t=0;t<i;t++)for(let e=0;e<d;e++){const i=t*n-o+p*(.5-f.getFloat()),s=e*r-u+_*(.5-f.getFloat());h.push({x:i,y:s}),0===t&&h.push({x:i+2*o,y:s}),0===e&&h.push({x:i,y:s+2*u})}}else!0===e.shiftOddRows?(o=n/2,u=r,c=2*r,h=[{x:-o,y:0},{x:o,y:0},{x:0,y:u},{x:0,y:-u}]):(o=n/2,u=r/2,c=r,h=[{x:-n,y:0},{x:0,y:-r},{x:-n,y:-r},{x:0,y:0},{x:n,y:0},{x:0,y:r},{x:n,y:r},{x:-n,y:r},{x:n,y:-r}]);return{type:"CIMVectorMarker",frame:{xmin:-o,xmax:o,ymin:-u,ymax:u},markerGraphics:h.map((t=>({type:"CIMMarkerGraphic",geometry:t,symbol:{type:"CIMPointSymbol",symbolLayers:[i]}}))),size:c}}}function D(t,e){if(t)switch(t.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const i=t.symbolLayers;if(!i)return;for(const t of i)if(e(t),"CIMVectorMarker"===t.type){const i=t.markerGraphics;if(!i)continue;for(const t of i)if(t){const i=t.symbol;i&&D(i,e)}}break}}}const L=t=>{if(!t)return _.uT.Butt;switch(t){case"butt":return _.uT.Butt;case"square":return _.uT.Square;case"round":return _.uT.Round}},F=t=>{if(!t)return _.wd.Miter;switch(t){case"miter":return _.wd.Miter;case"round":return _.wd.Round;case"bevel":return _.wd.Bevel}},V=t=>{if(null==t)return"Center";switch(t){case"left":return"Left";case"right":return"Right";case"center":return"Center"}},N=t=>{if(null==t)return"Center";switch(t){case"baseline":return"Baseline";case"top":return"Top";case"middle":return"Center";case"bottom":return"Bottom"}},k=t=>{if(!t)return[0,0,0,0];const{r:e,g:i,b:n,a:r}=t;return[e,i,n,255*r]},B=(t,e)=>{const i=U(e),n=G(t);return i&&n?`${i}-${n}`:`${i}${n}`},U=t=>{if(!t)return"";switch(t.toLowerCase()){case"bold":case"bolder":return"bold"}return""},G=t=>{if(!t)return"";switch(t.toLowerCase()){case"italic":case"oblique":return"italic"}return""},Y=(t,e)=>{const i=(0,r.A)("safari")?.001:0,n="butt"===e;switch(t){case"dash":case"esriSLSDash":return n?[4,3]:[3,4];case"dash-dot":case"esriSLSDashDot":return n?[4,3,1,3]:[3,4,i,4];case"dot":case"esriSLSDot":return n?[1,3]:[i,4];case"long-dash":case"esriSLSLongDash":return n?[8,3]:[7,4];case"long-dash-dot":case"esriSLSLongDashDot":return n?[8,3,1,3]:[7,4,i,4];case"long-dash-dot-dot":case"esriSLSDashDotDot":return n?[8,3,1,3,1,3]:[7,4,i,4,i,4];case"short-dash":case"esriSLSShortDash":return n?[4,1]:[3,2];case"short-dash-dot":case"esriSLSShortDashDot":return n?[4,1,1,1]:[3,2,i,2];case"short-dash-dot-dot":case"esriSLSShortDashDotDot":return n?[4,1,1,1,1,1]:[3,2,i,2,i,2];case"short-dot":case"esriSLSShortDot":return n?[1,1]:[i,2];case"solid":case"esriSLSSolid":case"none":return I().error("Unexpected: style does not require rasterization"),[0,0];default:return I().error(`Tried to rasterize SLS, but found an unexpected style: ${t}!`),[0,0]}},Z=(t,e=100)=>{const i=e/2;let n,r;const s=t;if("circle"===s||"esriSMSCircle"===s){const t=.25;let e=Math.acos(1-t/i),s=Math.ceil(S/e/4);0===s&&(s=1),e=w/s,s*=4;const o=[];o.push([i,0]);for(let t=1;t<s;t++)o.push([i*Math.cos(t*e),-i*Math.sin(t*e)]);o.push([i,0]),n={rings:[o]},r={xmin:-i,ymin:-i,xmax:i,ymax:i}}else if("cross"===s||"esriSMSCross"===s){const t=0;n={paths:[[[t,i],[t,-i]],[[i,t],[-i,t]]]},r={xmin:-i,ymin:-i,xmax:i,ymax:i}}else if("diamond"===s||"esriSMSDiamond"===s)n={rings:[[[-i,0],[0,i],[i,0],[0,-i],[-i,0]]]},r={xmin:-i,ymin:-i,xmax:i,ymax:i};else if("square"===s||"esriSMSSquare"===s)n={rings:[[[-i,-i],[-i,i],[i,i],[i,-i],[-i,-i]]]},r={xmin:-i,ymin:-i,xmax:i,ymax:i};else if("x"===s||"esriSMSX"===s)n={paths:[[[i,i],[-i,-i]],[[i,-i],[-i,i]]]},r={xmin:-i,ymin:-i,xmax:i,ymax:i};else if("triangle"===s||"esriSMSTriangle"===s){const t=.5773502691896257*e,i=-t,s=2/3*e,o=s-e;n={rings:[[[i,o],[0,s],[t,o],[i,o]]]},r={xmin:i,ymin:o,xmax:t,ymax:s}}else"arrow"===s&&(n={rings:[[[-50,50],[50,0],[-50,-50],[-33,-20],[-33,20],[-50,50]]]},r={xmin:-i,ymin:-i,xmax:i,ymax:i});return[r,n]},H=t=>"vertical"===t||"horizontal"===t||"cross"===t||"esriSFSCross"===t||"esriSFSVertical"===t||"esriSFSHorizontal"===t;function W(t){if(!t)return null;let e=null;const{cap:i,color:n,join:r,miterLimit:s,style:o,width:a}=t;return"solid"!==o&&"none"!==o&&"esriSLSSolid"!==o&&"esriSLSNull"!==o&&(e=[{type:"CIMGeometricEffectDashes",dashTemplate:Y(o,i),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]),{type:"CIMSolidStroke",color:"esriSLSNull"!==o&&"none"!==o?k(n):[0,0,0,0],capStyle:L(i),joinStyle:F(r),miterLimit:s,width:a,effects:e}}},93996:function(t,e,i){i.d(e,{I:function(){return o},U:function(){return s}});var n=i(33134),r=i(33389);const s=.03;class o{constructor(t=0,e=!1){}isEmpty(t){if(!t.nextPoint())return!0;let e,i,n,r;for(e=t.x,i=t.y;t.nextPoint();e=i,i=r)if(n=t.x,r=t.y,n!==e||r!==i)return t.seekPathStart(),!1;return t.seekPathStart(),!0}normalize(t){const e=Math.sqrt(t[0]*t[0]+t[1]*t[1]);0!==e&&(t[0]/=e,t[1]/=e)}getLength(t,e,i,n){const r=i-t,s=n-e;return Math.sqrt(r*r+s*s)}getSegLength(t){const[[e,i],[n,r]]=t;return this.getLength(e,i,n,r)}getCoord2D(t,e,i,n,r){return[t+(i-t)*r,e+(n-e)*r]}getSegCoord2D(t,e){const[[i,n],[r,s]]=t;return this.getCoord2D(i,n,r,s,e)}getAngle(t,e,i,n,r){const s=i-t,o=n-e;return Math.atan2(o,s)}getAngleCS(t,e,i,n,r){const s=i-t,o=n-e,a=Math.sqrt(s*s+o*o);return a>0?[s/a,o/a]:[1,0]}getSegAngleCS(t,e){const[[i,n],[r,s]]=t;return this.getAngleCS(i,n,r,s,e)}cut(t,e,i,n,r,s){return[r<=0?[t,e]:this.getCoord2D(t,e,i,n,r),s>=1?[i,n]:this.getCoord2D(t,e,i,n,s)]}getSubCurve(t,e,i){const r=n.z.createEmptyOptimizedCIM("esriGeometryPolyline");return this.appendSubCurve(r,t,e,i)?r:null}appendSubCurve(t,e,i,n){t.startPath(),e.seekPathStart();let r=0,s=!0;if(!e.nextPoint())return!1;let o=e.x,a=e.y;for(;e.nextPoint();){const l=this.getLength(o,a,e.x,e.y);if(0!==l){if(s){if(r+l>i){const u=(i-r)/l;let c=1,h=!1;r+l>=n&&(c=(n-r)/l,h=!0);const d=this.cut(o,a,e.x,e.y,u,c);if(d&&t.pushPoints(d),h)break;s=!1}}else{if(r+l>n){const i=this.cut(o,a,e.x,e.y,0,(n-r)/l);i&&t.pushPoint(i[1]);break}t.pushXY(e.x,e.y)}r+=l,o=e.x,a=e.y}else o=e.x,a=e.y}return!0}getCIMPointAlong(t,e){if(!t.nextPoint())return null;let i,n,r,s,o=0;for(i=t.x,n=t.y;t.nextPoint();i=r,n=s){r=t.x,s=t.y;const a=this.getLength(i,n,r,s);if(0!==a){if(o+a>e){const t=(e-o)/a;return this.getCoord2D(i,n,r,s,t)}o+=a}}return null}offset(t,e,i,n,s){if(!t||t.length<2)return null;let o=0,a=t[o++],l=o;for(;o<t.length;){const e=t[o];e[0]===a[0]&&e[1]===a[1]||(o!==l&&(t[l]=t[o]),a=t[l++]),o++}const u=t[0][0]===t[l-1][0]&&t[0][1]===t[l-1][1];if(u&&--l,l<(u?3:2))return null;const c=[];a=u?t[l-1]:null;let h=t[0];for(let s=0;s<l;s++){const o=s===l-1?u?t[0]:null:t[s+1];if(a)if(o){const t=[o[0]-h[0],o[1]-h[1]];this.normalize(t);const s=[h[0]-a[0],h[1]-a[1]];this.normalize(s);const l=s[0]*t[1]-s[1]*t[0],u=s[0]*t[0]+s[1]*t[1];if(0===l&&1===u){h=o;continue}if(l>=0==e<=0){if(u<1){const i=[t[0]-s[0],t[1]-s[1]];this.normalize(i);const r=Math.sqrt((1+u)/2);if(r>1/n){const t=-Math.abs(e)/r;c.push([h[0]-i[0]*t,h[1]-i[1]*t])}}}else switch(i){case r.xw.Mitered:{const i=Math.sqrt((1+u)/2);if(i>0&&1/i<n){const n=[t[0]-s[0],t[1]-s[1]];this.normalize(n);const r=Math.abs(e)/i;c.push([h[0]-n[0]*r,h[1]-n[1]*r]);break}}case r.xw.Bevelled:c.push([h[0]+s[1]*e,h[1]-s[0]*e]),c.push([h[0]+t[1]*e,h[1]-t[0]*e]);break;case r.xw.Rounded:if(u<1){c.push([h[0]+s[1]*e,h[1]-s[0]*e]);const i=Math.floor(2.5*(1-u));if(i>0){const n=1/i;let r=n;for(let o=1;o<i;o++,r+=n){const i=[s[1]*(1-r)+t[1]*r,-s[0]*(1-r)-t[0]*r];this.normalize(i),c.push([h[0]+i[0]*e,h[1]+i[1]*e])}}c.push([h[0]+t[1]*e,h[1]-t[0]*e])}break;case r.xw.Square:default:if(l<0)c.push([h[0]+(s[1]+s[0])*e,h[1]+(s[1]-s[0])*e]),c.push([h[0]+(t[1]-t[0])*e,h[1]-(t[0]+t[1])*e]);else{const i=Math.sqrt((1+Math.abs(u))/2),n=[t[0]-s[0],t[1]-s[1]];this.normalize(n);const r=e/i;c.push([h[0]-n[0]*r,h[1]-n[1]*r])}}}else{const t=[h[0]-a[0],h[1]-a[1]];this.normalize(t),c.push([h[0]+t[1]*e,h[1]-t[0]*e])}else{const t=[o[0]-h[0],o[1]-h[1]];this.normalize(t),c.push([h[0]+t[1]*e,h[1]-t[0]*e])}a=h,h=o}return c.length<(u?3:2)?null:(u&&c.push([c[0][0],c[0][1]]),c)}}},65661:function(t,e,i){i.d(e,{VA:function(){return a},YQ:function(){return n},Z1:function(){return c},ps:function(){return l}});var n,r,s=i(33134),o=i(93996);class a{constructor(){this._values=[],this.extPtGap=0,this.ctrlPtGap=0,this._length=0,this._currentValue=0}isEmpty(){return 0===this._values.length}size(){return this._values.length}init(t,e,i=!0){if(this._setEmpty(),!t||0===t.length)return!1;for(let e=0;e<t.length;e++){let n=Math.abs(t[e]);i&&n<1e-7&&(n=1e-7),this._values.push(n),this._length+=n}return e&&1&t.length&&(this._length*=2),0!==this._length&&(this.ctrlPtGap=this.extPtGap=0,this._currentValue=-1,!0)}scale(t){const e=this._values?this._values.length:0;for(let i=0;i<e;++i)this._values[i]*=t;this._length*=t,this.extPtGap*=t,this.ctrlPtGap*=t}addValue(t){this._length+=t,this._values.push(t)}firstValue(){return this._values[0]}lastValue(){return this._values[this._values.length-1]}nextValue(){return this._currentValue++,this._currentValue===this._values.length&&(this._currentValue=0),this._values[this._currentValue]}reset(){this._currentValue=-1}length(){return this._length}_setEmpty(){this.extPtGap=this.ctrlPtGap=this._length=0,this._currentValue=-1,this._values.length=0}}class l{constructor(){this.pt=null,this.ca=0,this.sa=0}}(r=n||(n={}))[r.FAIL=0]="FAIL",r[r.END=1]="END",r[r.CONTINUE=2]="CONTINUE";class u{constructor(){this.reset()}reset(){this.segment=null,this.segmentLength=0,this.abscissa=0,this.isPathEnd=!1,this.isPartEnd=!1}isValid(){return null!==this.segment}copyTo(t){t.segment=this.segment,t.segmentLength=this.segmentLength,t.abscissa=this.abscissa,t.isPathEnd=this.isPathEnd,t.isPartEnd=this.isPartEnd}}class c extends o.I{constructor(t=0,e=!1){super(t,e),this._tolerance=o.U,this._currentPosition=new u}updateTolerance(t){this._tolerance=o.U*t}init(t,e,i=!0){return i?(this._patternLength=e.length(),this._partExtPtGap=e.extPtGap,this._partCtrlPtGap=e.ctrlPtGap):(this._patternLength=0,this._partExtPtGap=0,this._partCtrlPtGap=0),this._currentPosition.reset(),this._partSegCount=0,this._pathCursor=t,this._seg=-1,this._setPosAtNextPart()}curPositionIsValid(){return this._currentPosition.isValid()}nextPosition(t,e=n.FAIL){const i=new u;return!!this._nextPosition(t,i,null,e)&&(i.copyTo(this._currentPosition),!0)}curPointAndAngle(t){t.pt=this._getPoint(this._currentPosition);const[e,i]=this._getAngleCS(this._currentPosition);t.ca=e,t.sa=i}nextPointAndAngle(t,e,i=n.FAIL){const r=new u;if(!this._nextPosition(t,r,null,i))return!1;r.copyTo(this._currentPosition),e.pt=this._getPoint(r);const[s,o]=this._getAngleCS(r);return e.ca=s,e.sa=o,!0}nextCurve(t){if(0===t)return null;const e=s.z.createEmptyOptimizedCIM("esriGeometryPolyline");e.startPath(),e.nextPath();const i=new u;return this._nextPosition(t,i,e,n.END)?(i.copyTo(this._currentPosition),e):null}isPathEnd(){return this._currentPosition.isPathEnd}getPathEnd(){return this._currentPosition.segment[1]}getPt(t){return this._pathCursor.seekInPath(t),[this._pathCursor.x,this._pathCursor.y]}getSeg(t){return[this.getPt(t),this.getPt(t+1)]}_nextPosition(t,e,i,r){if(this._currentPosition.isPathEnd)return!1;let s=this._currentPosition.abscissa;for(this._currentPosition.segmentLength>0&&(s/=this._currentPosition.segmentLength),this._currentPosition.copyTo(e);e.abscissa+t*this._partLengthRatio>e.segmentLength+this._tolerance;){if(i){if(0===i.pathSize)if(0===s){const t=e.segment[0];i.pushXY(t[0],t[1])}else i.pushPoint(this.getSegCoord2D(e.segment,s));const t=e.segment[1];i.pushXY(t[0],t[1])}if(s=0,t-=(e.segmentLength-e.abscissa)/this._partLengthRatio,this._partSegCount)e.segment=this._nextSegment(),e.segmentLength=this.getSegLength(e.segment),e.abscissa=0,this._partSegCount--;else{if(!this._setPosAtNextPart())return r!==n.FAIL&&(e.segmentLength=this.getSegLength(e.segment),e.isPartEnd=!0,r===n.END?(e.abscissa=e.segmentLength,e.isPathEnd=!0):e.abscissa=e.segmentLength+t,!0);this._currentPosition.copyTo(e)}}if(e.abscissa+=t*this._partLengthRatio,i){0===i.pathSize&&(0===s?i.pushPoint(e.segment[0]):i.pushPoint(this.getSegCoord2D(e.segment,s)));const t=e.abscissa/e.segmentLength;1===t?i.pushPoint(e.segment[1]):i.pushPoint(this.getSegCoord2D(e.segment,t))}return this._partSegCount||Math.abs(e.abscissa-e.segmentLength)<this._tolerance&&(e.isPathEnd=this._partIsLast,e.isPartEnd=!0),!0}_getPoint(t){const e=t.segmentLength<=0?0:t.abscissa/t.segmentLength;return this.getSegCoord2D(this._currentPosition.segment,e)}_getAngleCS(t){const e=t.segmentLength<=0?0:t.abscissa/t.segmentLength;return this.getSegAngleCS(this._currentPosition.segment,e)}_setPosAtNextPart(){for(;this._partSegCount;)this._hasNextSegment()&&this._nextSegment(),this._partSegCount--;if(!this._hasNextSegment())return!1;for(this._partLength=0,this._partIsLast=!0,this._partSegCount=0;this._hasNextSegment();)if(this._partLength+=this.getSegLength(this._nextSegment()),this._partSegCount++,this._pathCursor.getControlPointAt(this._getEndPointIndex())){this._partIsLast=!this._hasNextSegment();break}let t=this._partSegCount;for(;t;)this._previousSegment(),--t;this._currentPosition.segment=this._nextSegment(),this._currentPosition.segmentLength=this.getSegLength(this._currentPosition.segment),this._currentPosition.abscissa=0,this._currentPosition.isPathEnd=this._currentPosition.isPartEnd=!1,--this._partSegCount;const e=this._getStartPointIndex();this._ctrlPtBegin=this._pathCursor.getControlPointAt(e);let i=e+this._partSegCount+1;if(i>=this._pathCursor.pathSize&&(i=0),this._ctrlPtEnd=this._pathCursor.getControlPointAt(i),this._patternLength>0){const t=this._ctrlPtBegin?this._partCtrlPtGap:this._partExtPtGap,e=this._ctrlPtEnd?this._partCtrlPtGap:this._partExtPtGap;let i=Math.round((this._partLength-(t+e))/this._patternLength);i<=0&&(i=t+e>0?0:1),this._partLengthRatio=this._partLength/(t+e+i*this._patternLength),this._partLengthRatio<.01&&(this._partLengthRatio=1)}else this._partLengthRatio=1;return!0}_hasNextSegment(){return this._seg<this._pathCursor.pathSize-2}_previousSegment(){return this.getSeg(--this._seg)}_nextSegment(){return this.getSeg(++this._seg)}_getStartPointIndex(){return this._seg}_getEndPointIndex(){return this._seg+1}}},82497:function(t,e,i){i.d(e,{A:function(){return n}});class n{constructor(t=0,e=0,i=0,n=0){this.x=t,this.y=e,this.width=i,this.height=n}static fromExtent(t){return new n(t.xmin,-t.ymax,t.xmax-t.xmin,t.ymax-t.ymin)}get isEmpty(){return this.width<=0||this.height<=0}union(t){this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.width=Math.max(this.width,t.width),this.height=Math.max(this.height,t.height)}}},3247:function(t,e,i){i.d(e,{H:function(){return r}});var n=i(58941);const r=new class{get forceStaticPath(){return"disabled"===(0,n.A)("esri-cim-animations-enable-status")}get forceAnimatedPath(){return"forced"===(0,n.A)("esri-cim-animations-enable-status")}get freezeGlobalTime(){return(0,n.A)("esri-cim-animations-freeze-time")??!1}get spotlightAnimatedSymbols(){return!!(0,n.A)("esri-cim-animations-spotlight")}get forceGlobalTimeOrigin(){return!1!==(0,n.A)("esri-cim-animations-freeze-time")}}},2014:function(t,e,i){i.d(e,{$o:function(){return n},$u:function(){return o},gR:function(){return s},zA:function(){return r}});const n=15.5,r=4,s=64,o=1024},63514:function(t,e,i){i.d(e,{N:function(){return n}});class n{static local(){return null===n.instance&&(n.instance=new n),n.instance}execute(t,e,i,n,s){return new r(t,e,i)}}n.instance=null;class r{constructor(t,e,i){this._inputGeometries=t,this._angleTolerance=void 0!==e.angleTolerance?e.angleTolerance:120,this._maxCosAngle=Math.cos((1-Math.abs(this._angleTolerance)/180)*Math.PI)}next(){let t=this._inputGeometries.next();for(;t;){if("esriGeometryPolygon"===t.geometryType)this._isClosed=!0;else if("esriGeometryPolyline"===t.geometryType)this._isClosed=!1;else{if("esriGeometryEnvelope"!==t.geometryType){t=this._inputGeometries.next();continue}if(this._maxCosAngle)return t;this._isClosed=!0}for(;t.nextPath();)this._processPath(t);return t.reset(),t}return null}_processPath(t){if(t.nextPoint()){const e=t.x,i=t.y;let n=e,r=i,s=t.pathSize,o=0,a=0,l=0,u=0,c=0,h=0;this._isClosed&&++s;for(let d=1;t.nextPoint()||d<s;++d){let f,p;this._isClosed&&d===s-1?(f=e,p=i):(f=t.x,p=t.y);const _=f-n,m=p-r,g=Math.sqrt(_*_+m*m);d>1&&g>0&&l>0&&(o*_+a*m)/g/l<=this._maxCosAngle&&t.setControlPointAt(d-1),1===d&&(u=_,c=m,h=g),g>0&&(n=f,r=p,o=_,a=m,l=g)}this._isClosed&&l>0&&h>0&&(o*u+a*c)/h/l<=this._maxCosAngle&&t.setControlPointAt(0)}}}},82112:function(t,e,i){i.d(e,{B:function(){return c}});var n=i(33134),r=i(49077),s=i(23454),o=i(93996),a=i(33389);const l=1.7320508075688772,u=a.oF.OpenEnded;class c{static local(){return null===c.instance&&(c.instance=new c),c.instance}execute(t,e,i,n,r){return new h(t,e,i)}}c.instance=null;class h extends s.rx{constructor(t,e,i){super(t,!1,!0),this._curveHelper=new o.I,this._width=(void 0!==e.width?e.width:5)*i,this._arrowType=void 0!==e.geometricEffectArrowType?e.geometricEffectArrowType:void 0!==e.arrowType?e.arrowType:u,this._offsetFlattenError=o.U*i}processPath(t){const e=n.z.createEmptyOptimizedCIM(t.geometryType);switch(this._arrowType){case a.oF.OpenEnded:default:this._constructSimpleArrow(e,t,!0);break;case a.oF.Block:this._constructSimpleArrow(e,t,!1);break;case a.oF.Crossed:this._constructCrossedArrow(e,t)}return e}_constructSimpleArrow(t,e,i){const n=e.pathLength();let s=this._width;n<2*s&&(s=n/2);const o=this._curveHelper.getSubCurve(e,0,n-s);if(!o||!o.nextPath())return;o.seekPathStart();const a=s/2;if(this._curveHelper.isEmpty(o))return;const l=(0,r.A)(o),u=this._constructOffset(l,-a);if(!u)return;const c=this._constructOffset(l,a);if(!c)return;const h=this._constructArrowBasePoint(u,-a/2);if(!h)return;const d=this._constructArrowBasePoint(c,a/2);if(!d)return;e.seekInPath(e.pathSize-1);const f=[e.x,e.y];t.pushPath(c),t.nextPath(),t.nextPoint(),t.setControlPoint(),t.pushPoint(d),t.nextPoint(),t.setControlPoint(),t.pushPoint(f),t.nextPoint(),t.setControlPoint(),t.pushPoint(h),t.nextPoint(),t.setControlPoint(),t.pushPoints(u.reverse()),t.setControlPoint(),i||(t.setControlPointAt(0),t.setControlPointAt(t.pathSize-1),t.pushPoint(c[0])),t.reset()}_constructCrossedArrow(t,e){const i=e.pathLength();let n=this._width;i<n*(1+l+1)&&(n=i/(1+l+1)),e.seekPathStart();const s=this._curveHelper.getSubCurve(e,0,i-n*(1+l));if(!s)return;s.nextPath();const o=n/2;if(this._curveHelper.isEmpty(s))return;const a=(0,r.A)(s),u=this._constructOffset(a,o);if(!u)return;const c=this._constructOffset(a,-o);if(!c)return;const h=this._curveHelper.getSubCurve(e,0,i-n);if(!h)return;if(h.nextPath(),this._curveHelper.isEmpty(h))return;const d=(0,r.A)(h),f=this._constructOffset(d,o);if(!f)return;const p=this._constructOffset(d,-o);if(!p)return;const _=f[f.length-1],m=this._constructArrowBasePoint(f,o/2);if(!m)return;const g=p[p.length-1],y=this._constructArrowBasePoint(p,-o/2);if(!y)return;e.seekInPath(e.pathSize-1);const v=[e.x,e.y];t.pushPath(u),t.nextPath(),t.nextPoint(),t.setControlPoint(),t.pushPoint(g),t.nextPoint(),t.setControlPoint(),t.pushPoint(y),t.nextPoint(),t.setControlPoint(),t.pushPoint(v),t.nextPoint(),t.setControlPoint(),t.pushPoint(m),t.nextPoint(),t.setControlPoint(),t.pushPoint(_),t.nextPoint(),t.setControlPoint(),t.pushPoints(c.reverse()),t.nextPoint(),t.setControlPoint(),t.reset()}_constructOffset(t,e){return this._curveHelper.offset(t,e,a.xw.Rounded,4,this._offsetFlattenError)}_constructArrowBasePoint(t,e){if(!t||t.length<2)return null;const i=t[t.length-2],n=t[t.length-1],r=[n[0]-i[0],n[1]-i[1]];return this._curveHelper.normalize(r),[n[0]+r[1]*e,n[1]-r[0]*e]}}},20391:function(t,e,i){i.d(e,{s:function(){return u}}),i(50917);var n=i(33134),r=i(49077),s=i(62096),o=i(93996),a=i(33389),l=i(57165);class u{static local(){return null===u.instance&&(u.instance=new u),u.instance}execute(t,e,i,n,r,s){return new c(t,e,i,n,r,s)}}u.instance=null;class c{constructor(t,e,i,n,r,s){this._inputGeometries=t,this._tileKey=n,this._geometryEngine=r,this._curveHelper=new o.I,this._size=(void 0!==e.size?e.size:1)*i,this._maxInflateSize=s*i,this._offsetFlattenError=o.U*i}next(){let t;for(;t=this._inputGeometries.next();){if(0===this._size)return t;if("esriGeometryEnvelope"===t.geometryType)if(this._size>0){const e=n.z.createEmptyOptimizedCIM(t.geometryType),i=(0,r.x)(t)[0],s=this._curveHelper.offset(i,this._size,a.xw.Rounded,4,this._offsetFlattenError);if(s)return e.pushPath(s),e}else if(this._size<0){const e=t.asJSON();if(Math.min(e.xmax-e.xmin,e.ymax-e.ymin)+2*this._size>0)return n.z.fromJSONCIM({xmin:e.xmin-this._size,xmax:e.xmax+this._size,ymin:e.ymin-this._size,ymax:e.ymax+this._size})}const e=this._geometryEngine;if(null==e)return null;const i=this._tileKey?(0,s.q)(t,this._maxInflateSize):t;if(!i)continue;const o=e.buffer(l.A.WebMercator,i.asJSON(),this._size,1);return o?n.z.fromJSONCIM(o):null}return null}}},11672:function(t,e,i){i.d(e,{v:function(){return l}});var n=i(33134),r=i(49077),s=i(38441),o=i(23454),a=i(33389);class l{static local(){return null===l.instance&&(l.instance=new l),l.instance}execute(t,e,i,n,r){return new u(t,e,i)}}l.instance=null;class u{constructor(t,e,i){this._defaultPointSize=20,this._inputGeometries=t,this._geomUnitsPerPoint=i,this._rule=e.rule??a.uQ.FullGeometry,this._defaultSize=this._defaultPointSize*i}next(){let t;for(;t=this._inputGeometries.next();){const e=this._processGeom((0,r.x)(t));if(e?.length)return n.z.fromJSONCIM({paths:e})}return null}_clone(t){return[t[0],t[1]]}_mid(t,e){return[(t[0]+e[0])/2,(t[1]+e[1])/2]}_mix(t,e,i,n){return[t[0]*e+i[0]*n,t[1]*e+i[1]*n]}_add(t,e){return[t[0]+e[0],t[1]+e[1]]}_add2(t,e,i){return[t[0]+e,t[1]+i]}_sub(t,e){return[t[0]-e[0],t[1]-e[1]]}_dist(t,e){return Math.sqrt((t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1]))}_norm(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}_normalize(t,e=1){const i=e/this._norm(t);t[0]*=i,t[1]*=i}_leftPerpendicular(t){const e=-t[1],i=t[0];t[0]=e,t[1]=i}_leftPerp(t){return[-t[1],t[0]]}_rightPerpendicular(t){const e=t[1],i=-t[0];t[0]=e,t[1]=i}_rightPerp(t){return[t[1],-t[0]]}_dotProduct(t,e){return t[0]*e[0]+t[1]*e[1]}_crossProduct(t,e){return t[0]*e[1]-t[1]*e[0]}_rotateDirect(t,e,i){const n=t[0]*e-t[1]*i,r=t[0]*i+t[1]*e;t[0]=n,t[1]=r}_makeCtrlPt(t){const e=[t[0],t[1]];return(0,o.Aq)(e,1),e}_addAngledTicks(t,e,i,n){const r=this._sub(i,e);this._normalize(r);const s=this._crossProduct(r,this._sub(n,e));let o;o=s>0?this._rightPerp(r):this._leftPerp(r);const a=Math.abs(s)/2,l=[];l.push([e[0]+(o[0]-r[0])*a,e[1]+(o[1]-r[1])*a]),l.push(e),l.push(i),l.push([i[0]+(o[0]+r[0])*a,i[1]+(o[1]+r[1])*a]),t.push(l)}_addBezier2(t,e,i,n,r){if(0==r--)return void t.push(n);const s=this._mid(e,i),o=this._mid(i,n),a=this._mid(s,o);this._addBezier2(t,e,s,a,r),this._addBezier2(t,a,o,n,r)}_addBezier3(t,e,i,n,r,s){if(0==s--)return void t.push(r);const o=this._mid(e,i),a=this._mid(i,n),l=this._mid(n,r),u=this._mid(o,a),c=this._mid(a,l),h=this._mid(u,c);this._addBezier3(t,e,o,u,h,s),this._addBezier3(t,h,c,l,r,s)}_add90DegArc(t,e,i,n,r){const s=r??this._crossProduct(this._sub(i,e),this._sub(n,e))>0,o=this._mid(e,i),a=this._sub(o,e);s?this._leftPerpendicular(a):this._rightPerpendicular(a),o[0]+=a[0],o[1]+=a[1],this._addBezier3(t,e,this._mix(e,.33333,o,.66667),this._mix(i,.33333,o,.66667),i,4)}_addArrow(t,e,i){const n=e[0],r=e[1],s=e[e.length-1],o=this._sub(n,r),a=this._norm(o);this._normalize(o);const l=Math.abs(this._crossProduct(o,this._sub(s,r)));let u=this._dotProduct(o,this._sub(s,r));u<.05*a?u=.05*a:u>.95*a&&(u=.95*a);const c=.5*l,h=this._leftPerp(o),d=[r[0]+o[0]*u,r[1]+o[1]*u],f=e.length-1,p=[];p.push(i?[-h[0],-h[1]]:h);let _=[-o[0],-o[1]];for(let t=1;t<f-1;t++){const i=this._sub(e[t+1],e[t]);this._normalize(i);const n=this._dotProduct(i,_),r=this._crossProduct(i,_),s=Math.sqrt((1+n)/2),o=this._sub(i,_);this._normalize(o),o[0]/=s,o[1]/=s,p.push(r<0?[-o[0],-o[1]]:o),_=i}p.push(this._rightPerp(_));for(let i=p.length-1;i>0;i--)t.push([e[i][0]+p[i][0]*c,e[i][1]+p[i][1]*c]);t.push([d[0]+p[0][0]*c,d[1]+p[0][1]*c]),t.push([d[0]+p[0][0]*l,d[1]+p[0][1]*l]),t.push(n),t.push([d[0]-p[0][0]*l,d[1]-p[0][1]*l]),t.push([d[0]-p[0][0]*c,d[1]-p[0][1]*c]);for(let i=1;i<p.length;i++)t.push([e[i][0]-p[i][0]*c,e[i][1]-p[i][1]*c])}_addDash(t,e,i){const n=this._norm(i)/7;this._normalize(i);let r=[];for(let s=0;s<=7;s++)r.push([e[0]+i[0]*s*n,e[1]+i[1]*s*n]),1&s&&(t.push(r),r=[])}_cp2(t,e,i){return t.length>=2?t[1]:this._add2(t[0],e*this._defaultSize,i*this._defaultSize)}_cp3(t,e,i,n){if(t.length>=3)return t[2];const r=this._mix(t[0],1-i,e,i),s=this._sub(e,t[0]);return this._normalize(s),this._rightPerpendicular(s),[r[0]+s[0]*n*this._defaultSize,r[1]+s[1]*n*this._defaultSize]}_arrowPath(t){if(t.length>2)return t;const e=t[0],i=this._cp2(t,-4,0),n=this._sub(e,i);this._normalize(n);const r=this._rightPerp(n);return[e,i,[e[0]+(r[0]-n[0])*this._defaultSize,e[1]+(r[1]-n[1])*this._defaultSize]]}_arrowLastSeg(t){const e=t[0],i=this._cp2(t,-4,0);let n;if(t.length>=3)n=t[t.length-1];else{const t=this._sub(e,i);this._normalize(t);const r=this._rightPerp(t);n=[e[0]+(r[0]-t[0])*this._defaultSize,e[1]+(r[1]-t[1])*this._defaultSize]}return[i,n]}_processGeom(t){if(!t)return null;const e=[];for(const i of t){const t=i.length>1&&(0,s.Yl)(i)<this._defaultSize;if(!i||0===i.length||t)continue;const n=i.length;let r=i[0];switch(this._rule){case a.uQ.PerpendicularFromFirstSegment:{const t=this._cp2(i,0,-1),n=this._cp3(i,t,.5,4),s=[];s.push(n),s.push(this._mid(r,t)),e.push(s);break}case a.uQ.ReversedFirstSegment:{const t=this._cp2(i,0,-1);e.push([t,r]);break}case a.uQ.PerpendicularToSecondSegment:{if(i.length<3)return[];const t=this._cp2(i,-4,1),n=this._cp3(i,t,.882353,-1.94),s=[];s.push(this._mid(t,n)),s.push(r),e.push(s);break}case a.uQ.SecondSegmentWithTicks:{if(i.length<3)return[];const t=this._cp2(i,-4,1),n=this._cp3(i,t,.882353,-1.94),s=this._sub(n,t);let o;o=this._crossProduct(s,this._sub(r,t))>0?this._rightPerp(s):this._leftPerp(s);const a=[];a.push([t[0]+(o[0]-s[0])/3,t[1]+(o[1]-s[1])/3]),a.push(t),a.push(n),a.push([n[0]+(o[0]+s[0])/3,n[1]+(o[1]+s[1])/3]),e.push(a);break}case a.uQ.DoublePerpendicular:{const t=this._cp2(i,0,-1),n=this._cp3(i,t,.5,3),s=this._mid(r,t),o=this._sub(s,n);this._normalize(o);const a=this._crossProduct(o,this._sub(r,n));this._leftPerpendicular(o);const l=[];l.push(r),l.push([n[0]+o[0]*a,n[1]+o[1]*a]),e.push(l);const u=[];u.push([n[0]-o[0]*a,n[1]-o[1]*a]),u.push(t),e.push(u);break}case a.uQ.OppositeToFirstSegment:{const t=this._cp2(i,0,-1),n=this._cp3(i,t,.5,3),s=this._mid(r,t),o=this._sub(s,n);this._normalize(o);const a=this._crossProduct(o,this._sub(r,n));this._leftPerpendicular(o);const l=[];l.push([n[0]+o[0]*a,n[1]+o[1]*a]),l.push([n[0]-o[0]*a,n[1]-o[1]*a]),e.push(l);break}case a.uQ.TriplePerpendicular:{const t=this._cp2(i,0,-1),n=this._cp3(i,t,.5,4),s=this._mid(r,t),o=this._sub(s,n);this._normalize(o);const a=this._crossProduct(o,this._sub(r,n));this._leftPerpendicular(o);const l=[];l.push([n[0]+o[0]*a*.8,n[1]+o[1]*a*.8]),l.push([s[0]+.8*(r[0]-s[0]),s[1]+.8*(r[1]-s[1])]),e.push(l),e.push([n,s]);const u=[];u.push([n[0]-o[0]*a*.8,n[1]-o[1]*a*.8]),u.push([s[0]+.8*(t[0]-s[0]),s[1]+.8*(t[1]-s[1])]),e.push(u);break}case a.uQ.HalfCircleFirstSegment:{const t=this._cp2(i,0,-1),n=this._cp3(i,t,.5,4),s=this._mid(r,t);let o=this._sub(t,r);const a=Math.cos(Math.PI/18),l=Math.sin(Math.PI/18),u=Math.sqrt((1+a)/2),c=Math.sqrt((1-a)/2),h=[];let d;this._crossProduct(o,this._sub(n,r))>0?(h.push(r),o=this._sub(r,s),d=t):(h.push(t),o=this._sub(t,s),d=r),this._rotateDirect(o,u,c),o[0]/=u,o[1]/=u;for(let t=1;t<=18;t++)h.push(this._add(s,o)),this._rotateDirect(o,a,l);h.push(d),e.push(h);break}case a.uQ.HalfCircleSecondSegment:{const t=this._cp2(i,0,-1),n=this._cp3(i,t,1,-1);let s=this._sub(r,t);this._normalize(s);const o=this._crossProduct(s,this._sub(n,t))/2;this._leftPerpendicular(s);const a=[t[0]+s[0]*o,t[1]+s[1]*o];s=this._sub(t,a);const l=Math.cos(Math.PI/18);let u=Math.sin(Math.PI/18);o>0&&(u=-u);const c=[t];for(let t=1;t<=18;t++)this._rotateDirect(s,l,u),c.push(this._add(a,s));e.push(c);break}case a.uQ.HalfCircleExtended:{const t=this._cp2(i,0,-2),s=this._cp3(i,t,1,-1);let o;if(n>=4)o=i[3];else{const e=this._sub(r,t);o=this._add(s,e)}const a=this._dist(t,s)/2/.75,l=this._sub(t,r);this._normalize(l,a);const u=this._sub(s,o);this._normalize(u,a);const c=[o,s];e.push(c);const h=[this._clone(s)];this._addBezier3(h,s,this._add(s,u),this._add(t,l),t,4),h.push(r),e.push(h);break}case a.uQ.OpenCircle:{const t=this._cp2(i,-2,0),n=this._sub(t,r),s=Math.cos(Math.PI/18),o=-Math.sin(Math.PI/18),a=[t];for(let t=1;t<=33;t++)this._rotateDirect(n,s,o),a.push(this._add(r,n));e.push(a);break}case a.uQ.CoverageEdgesWithTicks:{const t=this._cp2(i,0,-1);let s,o;if(n>=3)s=i[2];else{const e=this._sub(t,r),i=this._leftPerp(e);s=[r[0]+i[0]-.25*e[0],r[1]+i[1]-.25*e[1]]}if(n>=4)o=i[3];else{const e=this._mid(r,t),i=this._sub(r,t);this._normalize(i),this._leftPerpendicular(i);const n=this._crossProduct(i,this._sub(s,e));this._rightPerpendicular(i),o=[s[0]+i[0]*n*2,s[1]+i[1]*n*2]}const a=this._sub(t,r);let l,u;l=this._crossProduct(a,this._sub(s,r))>0?this._rightPerp(a):this._leftPerp(a),u=[],u.push(s),u.push(r),u.push([r[0]+(l[0]-a[0])/3,r[1]+(l[1]-a[1])/3]),e.push(u),l=this._crossProduct(a,this._sub(o,t))>0?this._rightPerp(a):this._leftPerp(a),u=[],u.push([t[0]+(l[0]+a[0])/3,t[1]+(l[1]+a[1])/3]),u.push(t),u.push(o),e.push(u);break}case a.uQ.GapExtentWithDoubleTicks:{const t=this._cp2(i,0,2),s=this._cp3(i,t,0,1);let o;if(n>=4)o=i[3];else{const e=this._sub(t,r);o=this._add(s,e)}this._addAngledTicks(e,r,t,this._mid(s,o)),this._addAngledTicks(e,s,o,this._mid(r,t));break}case a.uQ.GapExtentMidline:{const t=this._cp2(i,2,0),s=this._cp3(i,t,0,1);let o;if(n>=4)o=i[3];else{const e=this._sub(t,r);o=this._add(s,e)}const a=[];a.push(this._mid(r,s)),a.push(this._mid(t,o)),e.push(a);break}case a.uQ.Chevron:{const t=this._cp2(i,-1,-1);let s;if(n>=3)s=i[2];else{const e=this._sub(t,r);this._leftPerpendicular(e),s=this._add(r,e)}e.push([t,this._makeCtrlPt(r),s]);break}case a.uQ.PerpendicularWithArc:{const t=this._cp2(i,0,-2),s=this._cp3(i,t,.5,-1),o=this._sub(t,r),a=this._norm(o);o[0]/=a,o[1]/=a;const l=this._crossProduct(o,this._sub(s,r));let u=this._dotProduct(o,this._sub(s,r));u<.05*a?u=.05*a:u>.95*a&&(u=.95*a);const c=[r[0]+o[0]*u,r[1]+o[1]*u];let h=this._leftPerp(o),d=[];if(d.push([c[0]-h[0]*l,c[1]-h[1]*l]),d.push([c[0]+h[0]*l,c[1]+h[1]*l]),e.push(d),n>=4){const t=i[3];let n=this._dotProduct(o,this._sub(t,r));n<.1*a?n=.1*a:n>.9*a&&(n=.9*a);const s=[r[0]+o[0]*n,r[1]+o[1]*n],l=this._crossProduct(o,this._sub(t,r)),u=[];u.push([s[0]-h[0]*l,s[1]-h[1]*l]),u.push([s[0]+h[0]*l,s[1]+h[1]*l]),e.push(u)}const f=[t[0]+h[0]*l,t[1]+h[1]*l];h=this._sub(t,f);const p=Math.cos(Math.PI/18);let _=Math.sin(Math.PI/18);l<0&&(_=-_),d=[r,t];for(let t=1;t<=9;t++)this._rotateDirect(h,p,_),d.push(this._add(f,h));e.push(d);break}case a.uQ.ClosedHalfCircle:{const t=this._cp2(i,2,0),n=this._mid(r,t),s=this._sub(t,n),o=Math.cos(Math.PI/18),a=Math.sin(Math.PI/18),l=[r,t];for(let t=1;t<=18;t++)this._rotateDirect(s,o,a),l.push(this._add(n,s));e.push(l);break}case a.uQ.TripleParallelExtended:{const t=this._cp2(i,0,-2),n=this._cp3(i,t,1,-2),s=this._mid(r,t),a=this._sub(n,t);this._normalize(a);const l=Math.abs(this._crossProduct(a,this._sub(s,t)))/2,u=this._dist(t,n),c=[t,r];c.push([r[0]+a[0]*u*.5,r[1]+a[1]*u*.5]),e.push(c);const h=[];h.push([s[0]-a[0]*l,s[1]-a[1]*l]),h.push([s[0]+a[0]*u*.375,s[1]+a[1]*u*.375]),(0,o.Aq)(h[h.length-1],1),h.push([s[0]+a[0]*u*.75,s[1]+a[1]*u*.75]),e.push(h);const d=[t,n];e.push(d);break}case a.uQ.ParallelWithTicks:{const t=this._cp2(i,3,0),n=this._cp3(i,t,.5,-1),s=this._sub(n,t);this._normalize(s);const o=this._crossProduct(s,this._sub(n,r));this._leftPerpendicular(s),this._addAngledTicks(e,r,t,n),this._addAngledTicks(e,this._mix(r,1,s,o),this._mix(t,1,s,o),this._mid(r,t));break}case a.uQ.Parallel:{const t=this._cp2(i,3,0),n=this._cp3(i,t,.5,-1),s=this._sub(t,r);this._normalize(s);const o=this._leftPerp(s),a=this._crossProduct(s,this._sub(n,r));let l=[r,t];e.push(l),l=[],l.push([r[0]+o[0]*a,r[1]+o[1]*a]),l.push([t[0]+o[0]*a,t[1]+o[1]*a]),e.push(l);break}case a.uQ.PerpendicularToFirstSegment:{const t=this._cp2(i,3,0),n=this._cp3(i,t,.5,-1),s=this._mid(r,t),o=this._sub(t,r);this._normalize(o);const a=this._crossProduct(o,this._sub(n,r));this._leftPerpendicular(o);const l=[];l.push([s[0]-o[0]*a*.25,s[1]-o[1]*a*.25]),l.push([s[0]+o[0]*a*1.25,s[1]+o[1]*a*1.25]),e.push(l);break}case a.uQ.ParallelOffset:{const t=this._cp2(i,3,0),n=this._cp3(i,t,.5,-1),s=this._sub(t,r);this._normalize(s);const o=this._crossProduct(s,this._sub(n,r));this._leftPerpendicular(s);const a=[];a.push([r[0]-s[0]*o,r[1]-s[1]*o]),a.push([t[0]-s[0]*o,t[1]-s[1]*o]),e.push(a);const l=[];l.push([r[0]+s[0]*o,r[1]+s[1]*o]),l.push([t[0]+s[0]*o,t[1]+s[1]*o]),e.push(l);break}case a.uQ.OffsetOpposite:{const t=this._cp2(i,3,0),n=this._cp3(i,t,.5,-1),s=this._sub(t,r);this._normalize(s);const o=this._crossProduct(s,this._sub(n,r));this._leftPerpendicular(s);const a=[];a.push([r[0]-s[0]*o,r[1]-s[1]*o]),a.push([t[0]-s[0]*o,t[1]-s[1]*o]),e.push(a);break}case a.uQ.OffsetSame:{const t=this._cp2(i,3,0),n=this._cp3(i,t,.5,-1),s=this._sub(t,r);this._normalize(s);const o=this._crossProduct(s,this._sub(n,r));this._leftPerpendicular(s);const a=[];a.push([r[0]+s[0]*o,r[1]+s[1]*o]),a.push([t[0]+s[0]*o,t[1]+s[1]*o]),e.push(a);break}case a.uQ.CircleWithArc:{let t=this._cp2(i,3,0);const s=this._cp3(i,t,.5,-1);let a,l;if(n>=4)a=i[3],l=this._crossProduct(this._sub(a,t),this._sub(s,t))>0;else{a=t,l=this._crossProduct(this._sub(a,r),this._sub(s,r))>0;const e=24*this._geomUnitsPerPoint,i=this._sub(a,r);this._normalize(i,e);const n=Math.sqrt(2)/2;this._rotateDirect(i,n,l?n:-n),t=this._add(r,i)}const u=this._sub(t,r),c=Math.cos(Math.PI/18),h=Math.sin(Math.PI/18),d=[t];for(let t=1;t<=36;t++)this._rotateDirect(u,c,h),d.push(this._add(r,u));this._add90DegArc(d,t,a,s,l),(0,o.Aq)(d[d.length-8],1),e.push(d);break}case a.uQ.DoubleJog:{let t,s=this._cp2(i,-3,1),o=this._cp3(i,s,-1,-.5);if(n>=4)t=i[3];else{const e=r;r=s,t=o;const i=this._dist(r,e),n=this._dist(t,e);let a=30*this._geomUnitsPerPoint;.5*i<a&&(a=.5*i),.5*n<a&&(a=.5*n),s=this._mix(r,a/i,e,(i-a)/i),o=this._mix(t,a/n,e,(n-a)/n)}const a=this._mid(r,s),l=this._mid(t,o),u=this._dist(r,s),c=this._dist(o,t);let h=Math.min(u,c)/8;h=Math.min(h,24*this._geomUnitsPerPoint);const d=Math.cos(Math.PI/4);let f=this._sub(r,s);this._normalize(f,h),this._crossProduct(f,this._sub(t,s))>0?this._rotateDirect(f,d,-d):this._rotateDirect(f,d,d);let p=[];p.push(s),p.push(this._add(a,f)),p.push(this._sub(a,f)),p.push(r),e.push(p),f=this._sub(t,o),this._normalize(f,h),this._crossProduct(f,this._sub(r,o))<0?this._rotateDirect(f,d,d):this._rotateDirect(f,d,-d),p=[],p.push(o),p.push(this._add(l,f)),p.push(this._sub(l,f)),p.push(t),e.push(p);break}case a.uQ.PerpendicularOffset:{const t=this._cp2(i,-4,1),n=this._cp3(i,t,.882353,-1.94),s=this._sub(n,t);this._crossProduct(s,this._sub(r,t))>0?this._rightPerpendicular(s):this._leftPerpendicular(s);const o=[s[0]/8,s[1]/8],a=this._sub(this._mid(t,n),o);e.push([a,r]);break}case a.uQ.LineExcludingLastSegment:{const t=this._arrowPath(i),n=[];let r=t.length-2;for(;r--;)n.push(t[r]);e.push(n);break}case a.uQ.MultivertexArrow:{const t=this._arrowPath(i),n=[];this._addArrow(n,t,!1),e.push(n);break}case a.uQ.CrossedArrow:{const t=this._arrowPath(i),n=[];this._addArrow(n,t,!0),e.push(n);break}case a.uQ.ChevronArrow:{const[t,n]=this._arrowLastSeg(i),s=10*this._geomUnitsPerPoint,o=this._sub(r,t),a=this._norm(o);this._normalize(o);const l=this._crossProduct(o,this._sub(n,t));let u=this._dotProduct(o,this._sub(n,t));u<.05*a?u=.05*a:u>.95*a-s&&(u=.95*a-s);const c=[t[0]+o[0]*u,t[1]+o[1]*u],h=this._leftPerp(o),d=[];d.push([c[0]+h[0]*l+o[0]*s,c[1]+h[1]*l+o[1]*s]),d.push(r),d.push([c[0]-h[0]*l+o[0]*s,c[1]-h[1]*l+o[1]*s]),e.push(d);break}case a.uQ.ChevronArrowOffset:{const[t,n]=this._arrowLastSeg(i),s=this._sub(r,t),o=this._norm(s);this._normalize(s);const a=this._crossProduct(s,this._sub(n,t));let l=this._dotProduct(s,this._sub(n,t));l<.05*o?l=.05*o:l>.95*o&&(l=.95*o);const u=[t[0]+s[0]*l,t[1]+s[1]*l];this._leftPerpendicular(s);const c=[];c.push([u[0]+s[0]*a*.5,u[1]+s[1]*a*.5]),c.push(this._mid(u,r)),c.push([u[0]-s[0]*a*.5,u[1]-s[1]*a*.5]),e.push(c);break}case a.uQ.PartialFirstSegment:{const[t,n]=this._arrowLastSeg(i),s=this._sub(r,t),o=this._norm(s);this._normalize(s);let a=this._dotProduct(s,this._sub(n,t));a<.05*o?a=.05*o:a>.95*o&&(a=.95*o);const l=[t[0]+s[0]*a,t[1]+s[1]*a];e.push([t,l]);break}case a.uQ.Arch:{const t=this._cp2(i,0,-1),n=this._cp3(i,t,.5,1),s=this._sub(r,t),o=this._mix(n,1,s,.55),a=this._mix(n,1,s,-.55),l=[r];this._addBezier2(l,r,o,n,4),this._addBezier2(l,n,a,t,4),e.push(l);break}case a.uQ.CurvedParallelTicks:{const t=this._cp2(i,-4,1),n=this._cp3(i,t,.882353,-1.94),s=this._sub(n,t);this._crossProduct(s,this._sub(r,t))>0?this._rightPerpendicular(s):this._leftPerpendicular(s);const o=[s[0]/8,s[1]/8],a=this._sub(this._mid(t,n),o),l=this._sub(this._mix(t,.75,n,.25),o),u=this._sub(this._mix(t,.25,n,.75),o),c=[t];this._addBezier2(c,t,l,a,3),this._addBezier2(c,a,u,n,3),e.push(c);for(let t=0;t<8;t++){const i=c[2*t+1],n=[this._clone(i)];n.push(this._add(i,[s[0]/4,s[1]/4])),e.push(n)}break}case a.uQ.Arc90Degrees:{const t=this._cp2(i,0,-1),n=this._cp3(i,t,.5,1),s=[t];this._add90DegArc(s,t,r,n),e.push(s);break}case a.uQ.TipWithPerpendicularAndTicks:{const[t,n]=this._arrowLastSeg(i),s=10*this._geomUnitsPerPoint,o=this._sub(r,t),a=this._norm(o);this._normalize(o);let l=this._crossProduct(o,this._sub(n,t)),u=this._dotProduct(o,this._sub(n,t));u<.05*a?u=.05*a:u>.95*a-s&&(u=.95*a-s);const c=this._leftPerp(o),h=[r[0]-o[0]*s,r[1]-o[1]*s],d=.5*Math.max(a-u-s,s);l=Math.abs(l);const f=[];f.push([h[0]+c[0]*(l+d)-o[0]*d,h[1]+c[1]*(l+d)-o[1]*d]),f.push([h[0]+c[0]*l,h[1]+c[1]*l]),f.push([h[0]-c[0]*l,h[1]-c[1]*l]),f.push([h[0]-c[0]*(l+d)-o[0]*d,h[1]-c[1]*(l+d)-o[1]*d]),e.push(f),e.push([h,r]);break}case a.uQ.ConcentricCircles:{const t=this._cp2(i,1,0),s=this._cp3(i,t,2,0),a=Math.cos(Math.PI/18),l=Math.sin(Math.PI/18);let u=this._dist(t,r),c=[u,0],h=[];for(let t=0;t<=36;t++)h.push(this._add(r,c)),this._rotateDirect(c,a,l);if(e.push(h),n>=4){h=[];const t=i[3];u=this._dist(t,r),c=[u,0];for(let t=0;t<=36;t++)h.push(this._add(r,c)),0===t&&(h.push(this._add(r,c)),(0,o.Aq)(h[1],1)),this._rotateDirect(c,a,l);e.push(h)}h=[],u=this._dist(s,r),c=[u,0];for(let t=0;t<=36;t++)h.push(this._add(r,c)),this._rotateDirect(c,a,l);e.push(h);break}case a.uQ.DoubleJogArrow:{r=this._arrowPath(i)[0];const[t,n]=this._arrowLastSeg(i),s=this._sub(r,t),o=this._norm(s);this._normalize(s);const a=Math.abs(this._crossProduct(s,this._sub(n,r)));let l=Math.abs(this._dotProduct(s,this._sub(n,r)));l<.05*o?l=.05*o:l>.95*o&&(l=.95*o);const u=Math.max(a,l),c=this._leftPerp(s);let h=[];const d=[r[0]-s[0]*l*.5+c[0]*a*.5,r[1]-s[1]*l*.5+c[1]*a*.5];h.push([d[0],d[1]]),d[0]+=s[0]*u*.5+c[0]*u*.4,d[1]+=s[1]*u*.5+c[1]*u*.4,h.push([d[0],d[1]]),d[0]-=c[0]*u*.25,d[1]-=c[1]*u*.25,h.push([d[0],d[1]]),d[0]+=s[0]*u*.5+c[0]*u*.4,d[1]+=s[1]*u*.5+c[1]*u*.4,h.push([d[0],d[1]]),e.push(h),h=[],d[0]=r[0]-s[0]*l*.5-c[0]*a*.5,d[1]=r[1]-s[1]*l*.5-c[1]*a*.5,h.push([d[0],d[1]]),d[0]+=s[0]*u*.5-c[0]*u*.4,d[1]+=s[1]*u*.5-c[1]*u*.4,h.push([d[0],d[1]]),d[0]+=c[0]*u*.25,d[1]+=c[1]*u*.25,h.push([d[0],d[1]]),d[0]+=s[0]*u*.5-c[0]*u*.4,d[1]+=s[1]*u*.5-c[1]*u*.4,h.push([d[0],d[1]]),e.push(h);break}case a.uQ.LinkedChevrons:{const t=this._cp2(i,-5,0),n=this._cp3(i,t,-.2,1),s=this._sub(r,t);this._normalize(s);const o=this._leftPerp(s),a=Math.abs(this._crossProduct(s,this._sub(n,t)));e.push([t,r]);const l=[];l.push([r[0]-s[0]*a+o[0]*a,r[1]-s[1]*a+o[1]*a]),l.push(r),l.push([r[0]-s[0]*a-o[0]*a,r[1]-s[1]*a-o[1]*a]),e.push(l),this._addDash(e,t,[-s[0]*a+o[0]*a,-s[1]*a+o[1]*a]),this._addDash(e,t,[-s[0]*a-o[0]*a,-s[1]*a-o[1]*a]);break}case a.uQ.SegmentThenHalfCircle:{const t=this._cp2(i,2,0),s=this._cp3(i,t,1.5,0);let o;o=n>=4?i[3]:this._cp3(i,t,1.25,-.5);const a=this._sub(t,r);this._normalize(a);const l=.5*this._dist(t,s),u=this._crossProduct(a,this._sub(o,r))>0,c=Math.cos(Math.PI/18);let h=Math.sin(Math.PI/18);u&&(h=-h);const d=[r,t];a[0]*=l,a[1]*=l;const f=this._add(t,a);a[0]=-a[0],a[1]=-a[1];for(let t=1;t<=18;t++)this._rotateDirect(a,c,h),d.push(this._add(f,a));e.push(d);break}case a.uQ.LineWithStraightTicks:{const t=this._cp2(i,-2,1),n=this._cp3(i,t,-1,-.5),s=this._sub(n,t);this._normalize(s);const o=this._dotProduct(s,this._sub(t,r)),a=this._dotProduct(s,this._sub(n,r));let l=[r];l.push([r[0]+s[0]*o,r[1]+s[1]*o]),l.push(t),e.push(l),l=[r],l.push([r[0]+s[0]*a,r[1]+s[1]*a]),l.push(n),e.push(l);break}case a.uQ.DoubleCurve:{const t=this._cp2(i,-5,-1),n=this._cp3(i,t,2,0),s=Math.atan2(1,5),a=Math.cos(s),l=Math.sin(s),u=this._sub(t,r),c=this._dist(r,t);this._normalize(u),this._rotateDirect(u,a,-l);const h=[r];h.push([r[0]+u[0]*c*.5,r[1]+u[1]*c*.5]),(0,o.Aq)(h[1],1),h.push([r[0]+u[0]*c*.8,r[1]+u[1]*c*.8]),this._addBezier2(h,h[2],[r[0]+u[0]*c,r[1]+u[1]*c],t,3);const d=this._sub(n,t),f=this._dist(t,n);this._normalize(d),this._rotateDirect(d,a,-l),this._addBezier2(h,t,[n[0]-d[0]*f,n[1]-d[1]*f],[n[0]-d[0]*f*.8,n[1]-d[1]*f*.8],3),h.push(n),e.push(h);break}case a.uQ.ParallelWithTicksByWidth:{const t=this._cp2(i,0,-1),n=this._cp3(i,t,.5,3),s=this._sub(t,r);this._normalize(s);const o=this._crossProduct(s,this._sub(n,r));this._leftPerpendicular(s),o>0?(this._addAngledTicks(e,r,[r[0]+s[0]*o,r[1]+s[1]*o],t),this._addAngledTicks(e,t,[t[0]+s[0]*o,t[1]+s[1]*o],r)):(this._addAngledTicks(e,[r[0]+s[0]*o,r[1]+s[1]*o],r,t),this._addAngledTicks(e,[t[0]+s[0]*o,t[1]+s[1]*o],r,t));break}case a.uQ.EnclosingRoundedRectangle:{const t=this._cp2(i,3,-2),e=[Math.min(r[0],t[0]),Math.max(r[1],t[1])],n=[Math.max(r[0],t[0]),Math.min(r[1],t[1])],s=n[0]-e[0],o=e[1]-n[1],a=Math.min(s,o)/10,l=[];l.push([e[0]+a+.75*(s-2*a),e[1]]),l.push([n[0]-a,e[1]]),this._add90DegArc(l,[n[0]-a,e[1]],[n[0],e[1]-a],[n[0],e[1]]),l.push([n[0],n[1]+a]),this._add90DegArc(l,[n[0],n[1]+a],[n[0]-a,n[1]],n),l.push([e[0]+a,n[1]]),this._add90DegArc(l,[e[0]+a,n[1]],[e[0],n[1]+a],[e[0],n[1]]),l.push([e[0],e[1]-a]),this._add90DegArc(l,[e[0],e[1]-a],[e[0]+a,e[1]],e),l.push([e[0]+a+.75*(s-2*a),e[1]]);break}case a.uQ.FullGeometry:default:e.push(i)}}return e}}},12281:function(t,e,i){i.d(e,{y:function(){return o}});var n=i(33134),r=i(23454),s=i(93996);class o{static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(t,e,i,n,r){return new a(t,e,i)}}o.instance=null;class a extends r.rx{constructor(t,e,i){super(t,!0,!0),this._curveHelper=new s.I,this._beginCut=(void 0!==e.beginCut?e.beginCut:1)*i,this._endCut=(void 0!==e.endCut?e.endCut:1)*i,this._middleCut=(void 0!==e.middleCut?e.middleCut:0)*i,this._invert=void 0!==e.invert&&e.invert,this._beginCut<0&&(this._beginCut=0),this._endCut<0&&(this._endCut=0),this._middleCut<0&&(this._middleCut=0)}processPath(t){const{_beginCut:e,_endCut:i,_middleCut:r}=this,s=t.pathLength(),o=n.z.createEmptyOptimizedCIM("esriGeometryPolyline");if(this._invert){if(0!==e||0!==i||0!==r)if(e+i+r>=s)for(o.startPath();t.nextPoint();)o.pushXY(t.x,t.y);else this._curveHelper.appendSubCurve(o,t,0,e),this._curveHelper.appendSubCurve(o,t,.5*(s-r),.5*(s+r)),this._curveHelper.appendSubCurve(o,t,s-i,i)}else if(0===e&&0===i&&0===r)for(o.startPath();t.nextPoint();)o.pushXY(t.x,t.y);else e+i+r<s&&(0===r?this._curveHelper.appendSubCurve(o,t,e,s-i):(this._curveHelper.appendSubCurve(o,t,e,.5*(s-r)),this._curveHelper.appendSubCurve(o,t,.5*(s+r),s-i)));return 0===o.totalSize?null:o}}},2969:function(t,e,i){i.d(e,{I:function(){return u}});var n=i(33134),r=i(49077),s=i(23454),o=i(33389),a=i(65661),l=i(7590);class u{static local(){return null===u.instance&&(u.instance=new u),u.instance}execute(t,e,i,n,r){return new c(t,e,i)}}u.instance=null;class c extends s.rx{constructor(t,e,i){super(t,!0,!0),this._firstCurve=null,this._walker=new a.Z1,this._walker.updateTolerance(i),this._endings=e.lineDashEnding,this._customDashPos=-(e.offsetAlongLine??0)*i,this._offsetAtEnd=(e.customEndingOffset??0)*i;let n=(0,l.FH)(e).dashTemplate;null==n&&(n=[]),n.length%2&&(n=[...n,...n]),this._pattern=new a.VA,this._pattern.init(n,!0),this._pattern.scale(i)}processPath(t){if(0===this._pattern.length()){this.iteratePath=!1;const e=(0,r.A)(t);return n.z.fromJSONCIM({paths:[e]})}if(!this.iteratePath){let e=!0;switch(this._endings){case o.yS.HalfPattern:case o.yS.HalfGap:default:this._pattern.extPtGap=0;break;case o.yS.FullPattern:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.firstValue());break;case o.yS.FullGap:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.lastValue());break;case o.yS.NoConstraint:this.isClosed||(e=!1);break;case o.yS.Custom:this.isClosed||(this._pattern.extPtGap=.5*this._offsetAtEnd)}const i=t.pathLength();if(this._pattern.isEmpty()||i<.1*this._pattern.length()){const e=(0,r.A)(t);return n.z.fromJSONCIM({paths:[e]})}if(!this._walker.init(t,this._pattern,e)){const e=(0,r.A)(t);return n.z.fromJSONCIM({paths:[e]})}}let e;if(this.iteratePath)e=this._pattern.nextValue();else{let t;switch(this._endings){case o.yS.HalfPattern:default:t=.5*this._pattern.firstValue();break;case o.yS.HalfGap:t=.5*-this._pattern.lastValue();break;case o.yS.FullGap:t=-this._pattern.lastValue();break;case o.yS.FullPattern:t=0;break;case o.yS.NoConstraint:case o.yS.Custom:t=-this._customDashPos}let i=t/this._pattern.length();i-=Math.floor(i),t=i*this._pattern.length(),this._pattern.reset(),e=this._pattern.nextValue();let n=!1;for(;t>=e;)t-=e,e=this._pattern.nextValue(),n=!n;e-=t,n?(this._walker.nextPosition(e),e=this._pattern.nextValue()):this.isClosed&&(this._firstCurve=this._walker.nextCurve(e),e=this._pattern.nextValue(),this._walker.nextPosition(e),e=this._pattern.nextValue())}let i=this._walker.nextCurve(e);if(i)if(this._walker.isPathEnd()){if(this.iteratePath=!1,this._firstCurve){for(this._firstCurve.nextPath();this._firstCurve.nextPoint();)i.pushXY(this._firstCurve.x,this._firstCurve.y);this._firstCurve=null}}else e=this._pattern.nextValue(),!this._walker.nextPosition(e)||this._walker.isPathEnd()?(this.iteratePath=!1,this._firstCurve&&(i.pushCursor(this._firstCurve),this._firstCurve=null)):this.iteratePath=!0;else this.iteratePath=!1,i=this._firstCurve,this._firstCurve=null;return i?.reset(),i}}},7889:function(t,e,i){i.d(e,{O:function(){return a}}),i(50917);var n=i(33134),r=i(62096),s=i(33389),o=i(57165);class a{static local(){return null===a.instance&&(a.instance=new a),a.instance}execute(t,e,i,n,r,s){return new l(t,e,i,n,r,s)}}a.instance=null;class l{constructor(t,e,i,n,r,o){switch(this._inputGeometries=t,this._tileKey=n,this._geometryEngine=r,this._maxInflateSize=o*i,this._width=(void 0!==e.width?e.width:2)*i,e.method){case s.M1.Mitered:case s.M1.Bevelled:case s.M1.Rounded:case s.M1.TrueBuffer:case s.M1.Square:}this._option=e.option}next(){let t;for(;t=this._inputGeometries.next();){if("esriGeometryEnvelope"===t.geometryType&&this._width>0){const e=t.asJSON();return Math.min(e.xmax-e.xmin,e.ymax-e.ymin)-2*this._width<0?t:n.z.fromJSONCIM({paths:[[[e.xmin+this._width,e.ymin+this._width],[e.xmax-this._width,e.ymin+this._width],[e.xmax-this._width,e.ymax-this._width],[e.xmin+this._width,e.ymax-this._width],[e.xmin+this._width,e.ymin+this._width]],[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]})}if("esriGeometryPolygon"===t.geometryType){if(0===this._width)return t.clone();const e=this._geometryEngine;if(null==e)return null;const i=this._tileKey?(0,r.q)(t,this._maxInflateSize):t.clone();if(!i)continue;const n=e.buffer(o.A.WebMercator,i.asJSON(),-this._width,1);if(n)for(const t of n.rings)if(t){i.startPath();for(const e of t.reverse())i.pushXY(e[0],i.yFactor*e[1])}return i}}return null}}},48645:function(t,e,i){i.d(e,{U:function(){return o}});var n=i(33134),r=i(23454),s=i(93996);class o{static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(t,e,i,n,r){return new a(t,e,i)}}o.instance=null;class a extends r.rx{constructor(t,e,i){super(t,!1,!0),this._curveHelper=new s.I,this._length=(void 0!==e.length?e.length:20)*i,this._angle=void 0!==e.angle?e.angle:225,this._position=void 0!==e.position?e.position:50,this._length<0&&(this._length=-this._length),this._position<20&&(this._position=20),this._position>80&&(this._position=80),this._mirror=!1}processPath(t){const e=n.z.createEmptyOptimizedCIM("esriGeometryPolyline");if(this._curveHelper.isEmpty(t))return null;t.seekInPath(0);const i=t.x,r=t.y;t.seekInPath(t.pathSize-1);const s=t.x,o=t.y,a=[s-i,o-r];this._curveHelper.normalize(a);const l=i+(s-i)*this._position/100,u=r+(o-r)*this._position/100,c=Math.cos((90-this._angle)/180*Math.PI);let h=Math.sin((90-this._angle)/180*Math.PI);this._mirror&&(h=-h),this._mirror=!this._mirror;const d=[l-this._length/2*c,u-this._length/2*h],f=[l+this._length/2*c,u+this._length/2*h];return e.pushPath([[i,r],d,f,[s,o]]),e}}},7088:function(t,e,i){i.d(e,{V:function(){return n}});class n{static local(){return null===n.instance&&(n.instance=new n),n.instance}execute(t,e,i,n,s){return new r(t,e,i)}}n.instance=null;class r{constructor(t,e,i){this._inputGeometries=t,this._offsetX=void 0!==e.offsetX?e.offsetX*i:0,this._offsetY=void 0!==e.offsetY?e.offsetY*i:0}next(){let t=this._inputGeometries.next();for(;t;){if(t.totalSize>0)return this._move(t.clone(),this._offsetX,this._offsetY);t=this._inputGeometries.next()}return null}_move(t,e,i){for(;t.nextPath();)for(;t.nextPoint();)t.x=t.x+e,t.y=t.y+i;return t.reset(),t}}},17706:function(t,e,i){i.d(e,{V:function(){return c}}),i(50917);var n=i(33134),r=i(49077),s=i(74697),o=i(62096),a=i(93996),l=i(33389),u=i(57165);class c{static local(){return null===c.instance&&(c.instance=new c),c.instance}execute(t,e,i,n,r,s){return new h(t,e,i,n,r,s)}}c.instance=null;class h{constructor(t,e,i,n,r,s){this._inputGeometries=t,this._tileKey=n,this._geometryEngine=r,this._curveHelper=new a.I,this._offset=(e.offset??1)*i,this._method=e.method,this._maxInflateSize=Math.max(Math.abs(s*i),10),this._option=e.option,this._offsetFlattenError=a.U*i}next(){let t;for(;t=this._inputGeometries.next();){if(0===this._offset)return t.clone();if("esriGeometryEnvelope"===t.geometryType){if(this._method===l.xw.Rounded&&this._offset>0){const e=(0,r.A)(t),i=this._curveHelper.offset(e,-this._offset,this._method,4,this._offsetFlattenError);if(i){const e=n.z.createEmptyOptimizedCIM(t.geometryType);return e.pushPath(i),e}return null}const e=t.asJSON();if((0,s.ZC)(e)&&Math.min(e.xmax-e.xmin,e.ymax-e.ymin)+2*this._offset>0)return n.z.fromJSONCIM({xmin:e.xmin-this._offset,xmax:e.xmax+this._offset,ymin:e.ymin-this._offset,ymax:e.ymax+this._offset})}const e=this._geometryEngine;if(null==e)continue;const i=this._tileKey?(0,o.q)(t,this._maxInflateSize):t.clone();if(!i)continue;const a=e.offset(u.A.WebMercator,i.asJSON(),-this._offset,1,this._method,4,this._offsetFlattenError);return a?n.z.fromJSONCIM(a):null}return null}}},10183:function(t,e,i){i.d(e,{C:function(){return n}});class n{static local(){return null===n.instance&&(n.instance=new n),n.instance}execute(t,e,i,n,s){return new r(t,e,i)}}n.instance=null;class r{constructor(t,e,i){this._inputGeometries=t,this._reverse=void 0===e.reverse||e.reverse}next(){let t=this._inputGeometries.next();for(;t;){if(!this._reverse)return t;if("esriGeometryPolyline"===t.geometryType)return s(t.clone());t=this._inputGeometries.next()}return null}}function s(t){for(;t.nextPath();)for(let e=0;e<t.pathSize/2;e++){t.seekInPath(e);const i=t.x,n=t.y;t.seekInPath(t.pathSize-e-1);const r=t.x,s=t.y;t.x=i,t.y=n,t.seekInPath(e),t.x=r,t.y=s}return t.reset(),t}},1646:function(t,e,i){i.d(e,{v:function(){return r}});var n=i(35068);class r{static local(){return null===r.instance&&(r.instance=new r),r.instance}execute(t,e,i,n,r){return new s(t,e,i)}}r.instance=null;class s{constructor(t,e,i){this._inputGeometries=t,this._rotateAngle=void 0!==e.angle?e.angle*Math.PI/180:0}next(){let t=this._inputGeometries.next();for(;t;){if(0===this._rotateAngle||"esriGeometryPoint"===t.geometryType)return t;if(t.totalSize>0){const e=(0,n.z8)(t),i=(e[2]+e[0])/2,r=(e[3]+e[1])/2;return t.reset(),this._rotate(t.clone(),i,r)}t=this._inputGeometries.next()}return null}_rotate(t,e,i){const n=Math.cos(this._rotateAngle),r=Math.sin(this._rotateAngle);for(;t.nextPath();)for(;t.nextPoint();){const s=t.x-e,o=t.y-i;t.x=e+s*n-o*r,t.y=i+s*r+o*n}return t.reset(),t}}},79323:function(t,e,i){i.d(e,{W:function(){return r}});var n=i(35068);class r{static local(){return null===r.instance&&(r.instance=new r),r.instance}execute(t,e,i,n,r){return new s(t,e,i)}}r.instance=null;class s{constructor(t,e,i){this._inputGeometries=t,this._xFactor=void 0!==e.xScaleFactor?e.xScaleFactor:1.15,this._yFactor=void 0!==e.yScaleFactor?e.yScaleFactor:1.15}next(){const t=this._inputGeometries.next();if(t){if(1===this._xFactor&&1===this._yFactor)return t;if("esriGeometryPoint"===t.geometryType)return t;if(t.totalSize>0){const e=(0,n.z8)(t),i=(e[2]+e[0])/2,r=(e[3]+e[1])/2;return t.reset(),this._scaleCursor(t.clone(),i,r)}}return null}_scaleCursor(t,e,i){for(;t.nextPath();)for(;t.nextPoint();)t.x=e+(t.x-e)*this._xFactor,t.y=i+(t.y-i)*this._yFactor;return t.reset(),t}}},34476:function(t,e,i){i.d(e,{l:function(){return o}});var n=i(33134),r=i(33389),s=i(65661);class o{static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(t,e,i,n,r){return new a(t,e,i)}}o.instance=null;class a{constructor(t,e,i){this._inputGeometries=t,this._height=(void 0!==e.amplitude?e.amplitude:2)*i,this._period=(void 0!==e.period?e.period:3)*i,this._style=e.waveform,this._height<=0&&(this._height=Math.abs(this._height)),this._period<=0&&(this._period=Math.abs(this._period)),this._pattern=new s.VA,this._pattern.addValue(this._period),this._pattern.addValue(this._period),this._walker=new s.Z1,this._walker.updateTolerance(i)}next(){let t=this._inputGeometries.next();for(;t;){if(0===this._height||0===this._period)return t;const e=this._processGeom(t);if(e)return e;t=this._inputGeometries.next()}return null}_processGeom(t){const e=n.z.createEmptyOptimizedCIM(t.geometryType);for(;t.nextPath();){e.startPath();const i=t.pathLength();if(this._walker.init(t,this._pattern))switch(this._style){case r.WE.Sinus:default:this._constructCurve(e,i,!1);break;case r.WE.Square:this._constructSquare(e,i);break;case r.WE.Triangle:this._constructTriangle(e,i);break;case r.WE.Random:this._constructCurve(e,i,!0)}else for(;t.nextPoint();)e.pushXY(t.x,t.y)}return e}_constructCurve(t,e,i){let n=Math.round(e/this._period);0===n&&(n=1);const r=16*n+1,o=e/n,a=this._period/16,l=1/r,u=2*Math.PI*e/o,c=2*Math.PI*Math.random(),h=2*Math.PI*Math.random(),d=2*Math.PI*Math.random(),f=.75-Math.random()/2,p=.75-Math.random()/2,_=new s.ps;this._walker.curPointAndAngle(_),t.pushPoint(_.pt);let m=0;for(;;){if(!this._walker.nextPointAndAngle(a,_)){t.pushPoint(this._walker.getPathEnd());break}{const e=m;let n;if(m+=l,i){const t=this._height/2*(1+.3*Math.sin(f*u*e+c));n=t*Math.sin(u*e+h),n+=t*Math.sin(p*u*e+d),n/=2}else n=.5*this._height*Math.sin(.5*u*e);t.pushXY(_.pt[0]-n*_.sa,_.pt[1]+n*_.ca)}}}_constructSquare(t,e){Math.round(e/this._period);let i=!0;for(;;){let e=!1;if(this._walker.curPositionIsValid()){const n=new s.ps;this._walker.curPointAndAngle(n);const r=new s.ps;if(this._walker.nextPointAndAngle(this._period,r)){const o=new s.ps;this._walker.nextPointAndAngle(this._period,o)&&(i?(t.pushPoint(n.pt),i=!1):t.pushPoint(n.pt),t.pushXY(n.pt[0]-this._height/2*n.sa,n.pt[1]+this._height/2*n.ca),t.pushXY(r.pt[0]-this._height/2*r.sa,r.pt[1]+this._height/2*r.ca),t.pushXY(r.pt[0]+this._height/2*r.sa,r.pt[1]-this._height/2*r.ca),t.pushXY(o.pt[0]+this._height/2*o.sa,o.pt[1]-this._height/2*o.ca),e=!0)}}if(!e){t.pushPoint(this._walker.getPathEnd());break}}}_constructTriangle(t,e){Math.round(e/this._period);let i=!0;for(;;){let e=!1;if(this._walker.curPositionIsValid()){const n=new s.ps;this._walker.curPointAndAngle(n);const r=new s.ps;if(this._walker.nextPointAndAngle(this._period/2,r)){const o=new s.ps;this._walker.nextPointAndAngle(this._period,o)&&(this._walker.nextPosition(this._period/2)&&(i?(t.pushPoint(n.pt),i=!1):t.pushPoint(n.pt),t.pushXY(r.pt[0]-this._height/2*r.sa,r.pt[1]+this._height/2*r.ca),t.pushXY(o.pt[0]+this._height/2*o.sa,o.pt[1]-this._height/2*o.ca)),e=!0)}}if(!e){t.pushPoint(this._walker.getPathEnd());break}}}}},31771:function(t,e,i){i.d(e,{e:function(){return o}});var n=i(23454),r=i(33389),s=i(65661);class o{static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(t,e,i,n,r){return new a(t,e,i)}}o.instance=null;class a extends n.pC{constructor(t,e,i){super(t),this._geometryWalker=new s.Z1,this._geometryWalker.updateTolerance(i),this._angleToLine=e.angleToLine??!0,this._offset=(e.offset?e.offset:0)*i,this._originalEndings=e.endings,this._offsetAtEnd=(e.customEndingOffset?e.customEndingOffset:0)*i,this._position=-(e.offsetAlongLine?e.offsetAlongLine:0)*i,this._pattern=new s.VA,this._pattern.init(e.placementTemplate,!1),this._pattern.scale(i),this._endings=this._originalEndings}processPath(t){if(this._pattern.isEmpty())return null;let e;if(this.iteratePath)e=this._pattern.nextValue();else{this._originalEndings===r.e_.WithFullGap&&this.isClosed?this._endings=r.e_.WithMarkers:this._endings=this._originalEndings,this._pattern.extPtGap=0;let i,n=!0;switch(this._endings){case r.e_.NoConstraint:i=-this._position,i=this._adjustPosition(i),n=!1;break;case r.e_.WithHalfGap:default:i=-this._pattern.lastValue()/2;break;case r.e_.WithFullGap:i=-this._pattern.lastValue(),this._pattern.extPtGap=this._pattern.lastValue();break;case r.e_.WithMarkers:i=0;break;case r.e_.Custom:i=-this._position,i=this._adjustPosition(i),this._pattern.extPtGap=.5*this._offsetAtEnd}if(!this._geometryWalker.init(t,this._pattern,n))return null;this._pattern.reset();let s=0;for(;i>s;)i-=s,s=this._pattern.nextValue();s-=i,e=s,this.iteratePath=!0}const i=new s.ps;return this._geometryWalker.nextPointAndAngle(e,i)?this._endings===r.e_.WithFullGap&&this._geometryWalker.isPathEnd()?(this.iteratePath=!1,null):this._endings===r.e_.WithMarkers&&this._geometryWalker.isPathEnd()&&(this.iteratePath=!1,this.isClosed)?null:(this.internalPlacement.setTranslate(i.pt[0]-this._offset*i.sa,i.pt[1]+this._offset*i.ca),this._angleToLine&&this.internalPlacement.setRotateCS(i.ca,i.sa),this.internalPlacement):(this.iteratePath=!1,null)}_adjustPosition(t){let e=t/this._pattern.length();return e-=Math.floor(e),e*this._pattern.length()}}},15987:function(t,e,i){i.d(e,{y:function(){return o}});var n=i(23454),r=i(93996),s=i(33389);class o{static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(t,e,i,n,r){return new a(t,e,i)}}o.instance=null;class a extends n.pC{constructor(t,e,i){super(t,!1,!0),this._curveHelper=new r.I,this._placePerPart=e.placePerPart??!1,this._angleToLine=void 0===e.angleToLine||e.angleToLine,this._offset=void 0!==e.offset?e.offset*i:0,this._type=e.extremityPlacement,this._position=void 0!==e.offsetAlongLine?e.offsetAlongLine*i:0,this._beginProcessed=!1}processMultiPath(t){return this._placePerPart?super.processMultiPath(t):this.processPath(t)}processPath(t){let e;switch(this._type){case s.$2.Both:default:this._beginProcessed?(e=this._atExtremities(t,this._position,!1),this._beginProcessed=!1,this.iterateMultiPath=!1,this.iteratePath=!1):(e=this._atExtremities(t,this._position,!0),this._beginProcessed=!0,this.iterateMultiPath=!0,this.iteratePath=!0);break;case s.$2.JustBegin:e=this._atExtremities(t,this._position,!0);break;case s.$2.JustEnd:e=this._atExtremities(t,this._position,!1);case s.$2.None:}return e}_atExtremities(t,e,i){if(this._placePerPart||(i?t.seekPath(0):t.seekPath(t.totalSize-1)),i||t.seekPathEnd(),i?t.nextPoint():t.prevPoint()){let n=0,[r,s]=[0,0],[o,a]=[t.x,t.y];for(;i?t.nextPoint():t.prevPoint();){r=o,s=a,o=t.x,a=t.y;const i=this._curveHelper.getLength(r,s,o,a);if(n+i>e){const t=(e-n)/i,[l,u]=this._curveHelper.getAngleCS(r,s,o,a,t),c=this._curveHelper.getCoord2D(r,s,o,a,t);return this.internalPlacement.setTranslate(c[0]-this._offset*u,c[1]+this._offset*l),this._angleToLine&&this.internalPlacement.setRotateCS(-l,-u),this.internalPlacement}n+=i}}return null}}},19511:function(t,e,i){i.d(e,{S:function(){return s}});var n=i(23454),r=i(65661);class s{static local(){return null===s.instance&&(s.instance=new s),s.instance}execute(t,e,i,n,r){return new o(t,e,i)}}s.instance=null;class o extends n.pC{constructor(t,e,i){super(t),this._walker=new r.Z1,this._walker.updateTolerance(i),this._angleToLine=void 0===e.angleToLine||e.angleToLine,this._offset=void 0!==e.offset?e.offset*i:0,this._beginGap=void 0!==e.beginPosition?e.beginPosition*i:0,this._endGap=void 0!==e.endPosition?e.endPosition*i:0,this._flipFirst=void 0===e.flipFirst||e.flipFirst,this._pattern=new r.VA,this._pattern.init(e.positionArray,!1,!1),this._subPathLen=0,this._posCount=this._pattern.size(),this._isFirst=!0,this._prevPos=0}processPath(t){if(this._pattern.isEmpty())return null;let e;if(this.iteratePath){const t=this._pattern.nextValue()*this._subPathLen,i=this._beginGap+t;e=i-this._prevPos,this._prevPos=i}else{if(this._posCount=this._pattern.size(),this._isFirst=!0,this._prevPos=0,this._subPathLen=t.pathLength()-this._beginGap-this._endGap,this._subPathLen<0)return this.iteratePath=!1,null;if(!this._walker.init(t,this._pattern,!1))return null;this._pattern.reset();const i=this._pattern.nextValue()*this._subPathLen,n=this._beginGap+i;e=n-this._prevPos,this._prevPos=n,this.iteratePath=!0}const i=new r.ps;if(!this._walker.nextPointAndAngle(e,i,r.YQ.END))return this.iteratePath=!1,null;this.internalPlacement.setTranslate(i.pt[0]-this._offset*i.sa,i.pt[1]+this._offset*i.ca);const n=this._isFirst&&this._flipFirst;let s,o;return this._angleToLine?(s=i.ca,o=i.sa):(s=1,o=0),n&&(s=-s,o=-o),this.internalPlacement.setRotateCS(s,o),this._isFirst=!1,this._posCount--,0===this._posCount&&(this.iteratePath=!1),this.internalPlacement}}},20305:function(t,e,i){i.d(e,{M:function(){return u}});var n=i(13798),r=i(29076),s=i(33389);const o=512,a=24,l=1e-6;class u{static local(){return null===u.instance&&(u.instance=new u),u.instance}execute(t,e,i,n,r){return new c(t,e,i,n,r)}}u.instance=null;class c{constructor(t,e,i,a,l){if(this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,this._currentX=0,this._currentY=0,this._accelerationMap=null,this._testInsidePolygon=!1,this._verticalSubdivision=!0,this._stepX=Math.abs(e.stepX??16)*i,this._stepY=Math.abs(e.stepY??16)*i,this._stepX=Math.round(128*this._stepX)/128,this._stepY=Math.round(128*this._stepY)/128,0!==this._stepX&&0!==this._stepY){if(this._gridType=e.gridType??s.Q1.Fixed,this._gridType===s.Q1.Random){const t=e.seed??13,i=1;this._randomLCG=new n.A(t*i),this._randomness=(e.randomness??100)/100,this._gridAngle=0,this._shiftOddRows=!1,this._cosAngle=1,this._sinAngle=0,this._offsetX=0,this._offsetY=0,this._buildRandomValues()}else{if(this._randomness=0,this._gridAngle=e.gridAngle??0,this._shiftOddRows=e.shiftOddRows??!1,this._offsetX=(e.offsetX??0)*i,this._offsetY=(e.offsetY??0)*i,this._cosAngle=Math.cos(this._gridAngle/180*Math.PI),this._sinAngle=-Math.sin(this._gridAngle/180*Math.PI),this._stepX)if(this._offsetX<0)for(;this._offsetX<-.5*this._stepX;)this._offsetX+=this._stepX;else for(;this._offsetX>=.5*this._stepX;)this._offsetX-=this._stepX;if(this._stepY)if(this._offsetY<0)for(;this._offsetY<-.5*this._stepY;)this._offsetY+=this._stepY;else for(;this._offsetY>=.5*this._stepY;)this._offsetY-=this._stepY}if(this._graphicOriginX=0,this._graphicOriginY=0,null!=a){const[t,e,i,n]=a.split("/"),r=parseFloat(t),s=parseFloat(e),l=parseFloat(i),u=parseFloat(n);this._graphicOriginX=-(u*2**r+l)*o,this._graphicOriginY=s*o,this._testInsidePolygon=!0}this._internalPlacement=new r.W,this._calculateMinMax(t),this._geometryCursor=t}}next(){return this._geometryCursor?this._nextInside():null}_buildRandomValues(){if(!c._randValues){c._randValues=[];for(let t=0;t<a;t++)for(let t=0;t<a;t++)c._randValues.push(this._randomLCG.getFloat()),c._randValues.push(this._randomLCG.getFloat())}}_calculateMinMax(t){let e,i,n,r,s,a,l,u,c,h,d,f,p,_;this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,l=u=p=d=Number.MAX_VALUE,c=h=_=f=-Number.MAX_VALUE;const m=1!==this._cosAngle;for(t.reset();t.nextPath();)for(;t.nextPoint();)a=t.x,s=t.y,e=a-this._graphicOriginX-this._offsetX,i=s-this._graphicOriginY-this._offsetY,m?(n=this._cosAngle*e-this._sinAngle*i,r=this._sinAngle*e+this._cosAngle*i):(n=e,r=i),l=Math.min(l,n),c=Math.max(c,n),u=Math.min(u,r),h=Math.max(h,r),d=Math.min(d,s),f=Math.max(f,s),p=Math.min(p,a),_=Math.max(_,a);d=d!==Number.MAX_VALUE?d:-o-this._stepY,f=f!==-Number.MAX_VALUE?f:this._stepY,p=p!==Number.MAX_VALUE?p:-this._stepX,_=_!==-Number.MAX_VALUE?_:o+this._stepX;const g=f-d,y=_-p;if(this._verticalSubdivision=g>=y,this._polygonMin=this._verticalSubdivision?d:p,this._testInsidePolygon){let t=0-this._graphicOriginX-this._offsetX-this._stepX,e=o-this._graphicOriginX-this._offsetX+this._stepX,i=-o-this._graphicOriginY-this._offsetY-this._stepY,n=0-this._graphicOriginY-this._offsetY+this._stepY;if(m){const r=[[t,i],[t,n],[e,i],[e,n]];t=i=Number.MAX_VALUE,e=n=-Number.MAX_VALUE;for(const s of r){const r=this._cosAngle*s[0]-this._sinAngle*s[1],o=this._sinAngle*s[0]+this._cosAngle*s[1];t=Math.min(t,r),e=Math.max(e,r),i=Math.min(i,o),n=Math.max(n,o)}}l=l!==Number.MAX_VALUE?Math.max(l,t):t,u=u!==Number.MAX_VALUE?Math.max(u,i):i,c=c!==-Number.MAX_VALUE?Math.min(c,e):e,h=h!==-Number.MAX_VALUE?Math.min(h,n):n}this._xMin=Math.round(l/this._stepX),this._xMax=Math.round(c/this._stepX),this._yMin=Math.round(u/this._stepY),this._yMax=Math.round(h/this._stepY),this._currentX=this._xMax+1,this._currentY=this._yMin-1,this._buildAccelerationMap(t,p,_,d,f)}_buildAccelerationMap(t,e,i,n,r){t.reset();const s=new Map,a=this._verticalSubdivision,l=a?r-n:i-e;let u=Math.ceil(l/10);if(u<=1)return;const c=Math.floor(l/u);let d,f,p,_,m,g,y,v,x,b,S;for(u++,this._delta=c,a?(x=-o-2*this._stepY,b=2*this._stepY,S=n):(x=-2*this._stepX,b=o+2*this._stepX,S=e);t.nextPath();)if(!(t.pathSize<2)&&t.nextPoint())for(d=t.x,f=t.y;t.nextPoint();d=p,f=_){if(p=t.x,_=t.y,a){if(f===_||f<x&&_<x||f>b&&_>b)continue;m=Math.min(f,_),g=Math.max(f,_)}else{if(d===p||d<x&&p<x||d>b&&p>b)continue;m=Math.min(d,p),g=Math.max(d,p)}for(;m<g;)y=Math.floor((m-S)/c),h(y,d,f,p,_,s),m+=c;v=Math.floor((g-S)/c),v>y&&h(v,d,f,p,_,s)}this._accelerationMap=s}_nextInside(){for(;;){if(this._currentX>this._xMax){if(this._currentY++,this._currentY>this._yMax)return null;this._currentX=this._xMin,this._shiftOddRows&&this._currentY%2&&this._currentX--}let t=this._currentX*this._stepX+this._offsetX;this._shiftOddRows&&this._currentY%2&&(t+=.5*this._stepX);const e=this._currentY*this._stepY+this._offsetY;let i,n;if(this._currentX++,this._gridType===s.Q1.Random){const r=(this._currentX%a+a)%a,s=(this._currentY%a+a)%a;i=this._graphicOriginX+t+this._stepX*this._randomness*(.5-c._randValues[s*a+r])*2/3,n=this._graphicOriginY+e+this._stepY*this._randomness*(.5-c._randValues[s*a+r+1])*2/3}else i=this._graphicOriginX+this._cosAngle*t+this._sinAngle*e,n=this._graphicOriginY-this._sinAngle*t+this._cosAngle*e;if(!this._testInsidePolygon||this._isInsidePolygon(i,n,this._geometryCursor))return this._internalPlacement.setTranslate(i,n),this._internalPlacement}}_isInsidePolygon(t,e,i){if(null==this._accelerationMap)return function(t,e,i){let n,r,s,o,a=0;for(t+=l,e+=l,i.reset();i.nextPath();)if(i.nextPoint())for(n=i.x,r=i.y;i.nextPoint();n=s,r=o)s=i.x,o=i.y,r>e!=o>e&&((s-n)*(e-r)-(o-r)*(t-n)>0?a++:a--);return 0!==a}(t,e,i);t+=l,e+=l;const n=this._verticalSubdivision,r=n?e:t,s=Math.floor((r-this._polygonMin)/this._delta),o=this._accelerationMap.get(s);if(!o)return!1;let a,u,c,h=0;for(const i of o){if(a=i[0],u=i[1],n){if(a[1]>e==u[1]>e)continue;c=(u[0]-a[0])*(e-a[1])-(u[1]-a[1])*(t-a[0])}else{if(a[0]>t==u[0]>t)continue;c=(u[1]-a[1])*(t-a[0])-(u[0]-a[0])*(e-a[1])}c>0?h++:h--}return 0!==h}}function h(t,e,i,n,r,s){let o=s.get(t);o||(o=[],s.set(t,o)),o.push([[e,i],[n,r]])}},58892:function(t,e,i){i.d(e,{R:function(){return o}});var n=i(23454),r=i(93996),s=i(33389);class o{static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(t,e,i,n,r){return new a(t,e,i)}}o.instance=null;class a extends n.pC{constructor(t,e,i){super(t),this._curveHelper=new r.I,this._angleToLine=void 0===e.angleToLine||e.angleToLine,this._offset=void 0!==e.offset?e.offset*i:0,this._relativeTo=e.relativeTo,this._position=void 0!==e.startPointOffset?e.startPointOffset*i:0,this._epsilon=.001*i}processPath(t){const e=this._position;if(this._relativeTo===s.ip.SegmentMidpoint){if(this.iteratePath||(this.iteratePath=!0),t.nextPoint()){let[e,i]=[t.x,t.y],[n,r]=[0,0];for(;t.nextPoint();){n=t.x,r=t.y;const s=this._curveHelper.getLength(e,i,n,r);if(s<this._epsilon){e=n,i=r;continue}const o=.5+this._position/s,[a,l]=this._curveHelper.getAngleCS(e,i,n,r,o),u=this._curveHelper.getCoord2D(e,i,n,r,o);return this.internalPlacement.setTranslate(u[0]-this._offset*l,u[1]+this._offset*a),this._angleToLine&&this.internalPlacement.setRotateCS(a,l),this.internalPlacement}}return this.iteratePath=!1,null}const i=this._relativeTo===s.ip.LineEnd;return this.onLine(t,e,i)}onLine(t,e,i){let n,r=!1;switch(this._relativeTo){case s.ip.LineMiddle:default:t.seekPathStart(),n=t.pathLength()/2+e;break;case s.ip.LineBeginning:n=e;break;case s.ip.LineEnd:n=e,r=!0}i?t.seekPathEnd():t.seekPathStart();let o=0;if(i?t.prevPoint():t.nextPoint()){let[e,s]=[t.x,t.y],[a,l]=[0,0];for(;i?t.prevPoint():t.nextPoint();){a=t.x,l=t.y;const i=this._curveHelper.getLength(e,s,a,l);if(o+i>n){const t=(n-o)/i,[u,c]=this._curveHelper.getAngleCS(e,s,a,l,t),h=this._curveHelper.getCoord2D(e,s,a,l,t),d=r?-this._offset:this._offset;return this.internalPlacement.setTranslate(h[0]-d*c,h[1]+d*u),this._angleToLine&&(r?this.internalPlacement.setRotateCS(-u,-c):this.internalPlacement.setRotateCS(u,c)),this.internalPlacement}e=a,s=l,o+=i}}return null}}},80585:function(t,e,i){i.d(e,{A:function(){return s}});var n=i(23454),r=i(93996);class s{static local(){return null===s.instance&&(s.instance=new s),s.instance}execute(t,e,i,n,r){return new o(t,e,i)}}s.instance=null;class o extends n.pC{constructor(t,e,i){super(t),this._curveHelper=new r.I,this._angleToLine=void 0===e.angleToLine||e.angleToLine,this._offset=void 0!==e.offset?e.offset*i:0,this._endPoints=void 0===e.placeOnEndPoints||e.placeOnEndPoints,this._controlPoints=void 0===e.placeOnControlPoints||e.placeOnControlPoints,this._regularVertices=void 0===e.placeOnRegularVertices||e.placeOnRegularVertices,this._tags=[],this._tagIterator=0}processPath(t){if(this.iteratePath||(this._preparePath(t),this.iteratePath=!0),this._tagIterator>=this._tags.length)return this._tags.length=0,this._tagIterator=0,this.iteratePath=!1,null;const e=this._tags[this._tagIterator];this._angleToLine&&this.internalPlacement.setRotate(e[2]);let i=e[0],n=e[1];if(0!==this._offset){const t=Math.cos(e[2]),r=Math.sin(e[2]);i-=this._offset*r,n+=this._offset*t}return this.internalPlacement.setTranslate(i,n),this._tagIterator++,this.internalPlacement}_preparePath(t){this._tags.length=0,this._tagIterator=0,t.seekPathStart();const e=t.isClosed();let i=0,n=!1,r=0,s=0;if(t.seekPathStart(),t.nextPoint()){let o=t.x,l=t.y,u=t.getControlPoint(),c=!0,h=t.nextPoint();for(;h;){const d=t.x,f=t.y,p=t.getControlPoint();(this._angleToLine||0!==this._offset)&&(r=this._curveHelper.getAngle(o,l,d,f,0)),c?(c=!1,e?(i=r,n=u):(this._endPoints||this._controlPoints&&u)&&this._tags.push([o,l,r])):u?this._controlPoints&&this._tags.push([o,l,a(s,r)]):this._regularVertices&&this._tags.push([o,l,a(s,r)]),(this._angleToLine||0!==this._offset)&&(s=this._curveHelper.getAngle(o,l,d,f,1)),h=t.nextPoint(),h||(e?p||n?this._controlPoints&&this._tags.push([d,f,a(s,i)]):this._regularVertices&&this._tags.push([d,f,a(s,i)]):(this._endPoints||this._controlPoints&&p)&&this._tags.push([d,f,s])),o=d,l=f,u=p}}this._tagIterator=0}}function a(t,e){const i=Math.PI;for(;Math.abs(e-t)>i+2e-15;)e-t>i?e-=2*i:e+=2*i;return(t+e)/2}},58676:function(t,e,i){i.d(e,{L:function(){return l}});var n=i(35068),r=i(72228),s=i(30804),o=i(29076),a=i(33389);class l{static local(){return null===l.instance&&(l.instance=new l),l.instance}execute(t,e,i,n,r){return new u(t,e,i)}}l.instance=null;class u{constructor(t,e,i){this._geometryCursor=t,this._offsetX=void 0!==e.offsetX?e.offsetX*i:0,this._offsetY=void 0!==e.offsetY?e.offsetY*i:0,this._method=void 0!==e.method?e.method:a.YI.OnPolygon,this._placementPerPart=void 0!==e.placePerPart&&e.placePerPart,this._internalPlacement=new o.W}next(){const t=this._geometryCursor;if(!t)return null;if(!this._placementPerPart)return this._geometryCursor=null,this._polygonCenter(t);for(;t.nextPath();)if(!(t.getCurrentRingArea()<0))return this._polygonCenter(t.getCurrentPath());return this._geometryCursor=null,null}_polygonCenter(t){let e=!1;switch(this._method){case a.YI.CenterOfMass:{const i=(0,r.TP)(t);i&&(this._internalPlacement.setTranslate(i[0]+this._offsetX,i[1]+this._offsetY),e=!0)}break;case a.YI.BoundingBoxCenter:{const i=(0,n.z8)(t);i&&(this._internalPlacement.setTranslate((i[2]+i[0])/2+this._offsetX,(i[3]+i[1])/2+this._offsetY),e=!0)}break;case a.YI.OnPolygon:default:{const i=(0,s.d)(t);null!==i&&(this._internalPlacement.setTranslate(i[0]+this._offsetX,i[1]+this._offsetY),e=!0)}}return e?this._internalPlacement:null}}},89838:function(t,e,i){i.d(e,{OP:function(){return o},V4:function(){return r},rZ:function(){return s}}),i(58941);var n=i(40633);function r(t,e,i){if(null==t)return null;const r=e.readArcadeFeature();e.contextTimeZone=i.$view?.timeZone;try{return t.evaluate({...i,$feature:r},t.services)}catch(t){return n.A.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",t),null}}function s(t){return null==t||t===1/0||t===-1/0||"number"==typeof t&&isNaN(t)}function o(t,e,i,n){if(null==t)return null!=n?n:null;const r=e.readArcadeFeature();e.contextTimeZone=i.$view?.timeZone;const o=t.evaluate({...i,$feature:r},t.services);return s(o)?null!=n?n:null:o}},53838:function(t,e,i){i.d(e,{j:function(){return m}});var n=i(39819),r=i(58941),s=i(40633),o=i(39686),a=i(7459),l=i(88413),u=i(85456),c=i(96402),h=i(12285),d=i(10956);class f{constructor(t,e,i){this._texture=null,this._lastTexture=null,this._fbos={},this.texelSize=4;const{buffer:n,pixelType:r,textureOnly:s}=t,o=(0,l.Qz)(r);this.blockIndex=i,this.pixelType=r,this.size=e,this.textureOnly=s,s||(this.data=new o(n)),this._resetRange()}destroy(){this._texture?.dispose();for(const t in this._fbos){const e=this._fbos[t];e&&("0"===t&&e.detachColorTexture(),e.dispose()),this._fbos[t]=null}this._texture=null}get _textureDesc(){const t=new d.R;return t.wrapMode=u.pF.CLAMP_TO_EDGE,t.samplingMode=u.Cj.NEAREST,t.dataType=this.pixelType,t.width=this.size,t.height=this.size,t}setData(t,e,i){const n=(0,a.Q4)(t),r=this.data,s=n*this.texelSize+e;!r||s>=r.length||(r[s]=i,this.dirtyStart=Math.min(this.dirtyStart,n),this.dirtyEnd=Math.max(this.dirtyEnd,n))}getData(t,e){if(null==this.data)return null;const i=(0,a.Q4)(t)*this.texelSize+e;return!this.data||i>=this.data.length?null:this.data[i]}getTexture(t){return this._texture??this._initTexture(t)}getFBO(t,e=0){if(!this._fbos[e]){const i=0===e?this.getTexture(t):this._textureDesc;this._fbos[e]=new c.H(t,i)}return this._fbos[e]}get hasDirty(){const t=this.dirtyStart;return this.dirtyEnd>=t}updateTexture(t,e){try{const i=this.dirtyStart,o=this.dirtyEnd;if(!this.hasDirty)return;(0,r.A)("esri-2d-update-debug")&&console.debug(`Version[${e}] AttributeStoreView.updateTexture`,{start:i,end:o,firstBytes:new Uint8Array(this.data.buffer.slice(0,16)),block:this}),this._resetRange();const a=this.data.buffer,u=this.getTexture(t),c=4,h=(i-i%this.size)/this.size,d=(o-o%this.size)/this.size,f=h,p=this.size,_=d,m=h*this.size*c,g=(p+_*this.size)*c-m,y=(0,l.Qz)(this.pixelType),v=new y(a,m*y.BYTES_PER_ELEMENT,g),x=this.size,b=_-f+1;if(b>this.size)return void s.A.getLogger("esri.views.2d.engine.webgl.AttributeStoreView").error(new n.A("mapview-webgl","Out-of-bounds index when updating AttributeData"));u.updateData(0,0,f,x,b,v)}catch(t){}}update(t){const{data:e,start:i,end:n}=t;if(null!=e&&null!=this.data){const n=this.data,r=i*this.texelSize;for(let i=0;i<e.length;i++){const s=1<<i%this.texelSize;t.layout&s&&(n[r+i]=e[i])}}this.dirtyStart=Math.min(this.dirtyStart,i),this.dirtyEnd=Math.max(this.dirtyEnd,n)}resize(t,e){const i=this.size;if(this.size=e,this.textureOnly)return void(i!==this.size&&(this._lastTexture=this._texture,this._texture=null));const n=(0,l.Qz)(this.pixelType);this.destroy(),this.data=new n(t.buffer)}_resetRange(){this.dirtyStart=2147483647,this.dirtyEnd=0}_initTexture(t){const e=new h.g(t,this._textureDesc,this.data??void 0);if(null!=this._lastTexture&&this._fbos[0]){const i=this._lastTexture.descriptor.width,n=this._lastTexture.descriptor.height,r=this._lastTexture.descriptor.dataType,s=this._lastTexture.descriptor.pixelFormat,o=this.getFBO(t),a=(0,l.AV)(r),u=new((0,l.Qz)(r))(new ArrayBuffer(i*n*a*this.texelSize)),c=t.getBoundFramebufferObject(),{x:h,y:d,width:f,height:p}=t.getViewport();t.bindFramebuffer(o),o.readPixels(0,0,i,n,s,r,u),e.updateData(0,0,0,2*i,n/2,u),t.setViewport(h,d,f,p),t.bindFramebuffer(c)}return this.destroy(),this._texture=e,this._texture}}class p{constructor(){this.size=0,this._pendingAttributeUpdates=[],this._version=0,this._epoch=0,this._locked=!1}_initialize(t){if(!t)throw new Error("InternalError: initArgs must be defined");const e=t.blockDescriptors;if(this.size=t.blockSize,(0,r.A)("esri-2d-update-debug")&&console.debug("AttributeStoreView.initialize",{message:t}),null==this._data)this._data=e.map(((t,e)=>null!=t?new f(t,this.size,e):null));else for(let t=0;t<this._data.length;t++){const i=this._data[t],n=e[t];null!=n&&(null==i?this._data[t]=new f(n,this.size,t):i.resize(n,this.size))}}destroy(){for(const t of this._data??[])t?.destroy();this._defaultTexture?.dispose(),this._defaultTexture=null,this._pendingAttributeUpdates=[]}isEmpty(){return null==this._data}getBlock(t){return null==this._data?null:this._data[t]}setLabelMinZoom(t,e){this.setData(t,o.dV.FilterFlags,1,e)}setLocalTimeOrigin(t,e){this.setData(t,o.dV.LocalTimeOrigin,0,e)}getLabelMinZoom(t){return this.getData(t,o.dV.FilterFlags,1,255)}getFilterFlags(t){return this.getData(t,o.dV.FilterFlags,0,0)}getVisualVariableData(t,e){return this.getData(t,o.dV.VV,e,0)}getData(t,e,i,n){if(!this._data)return 0;const r=this._data[e];if(null==r)return 0;const s=r.getData(t,i);return null!=s?s:n}setData(t,e,i,n){this._data[e].setData(t,i,n)}lockTextureUploads(){this._locked=!0}unlockTextureUploads(){this._locked=!1,this.update()}requestUpdate(t){this._version=t.version,this._pendingAttributeUpdates.push(t),(0,r.A)("esri-2d-update-debug")&&console.debug(`Version[${this._version}] AttributeStoreView.requestUpdate`,{message:t})}get currentEpoch(){return this._epoch}update(){if(this._locked)return;const t=this._pendingAttributeUpdates;this._pendingAttributeUpdates=[];for(const e of t){const{blockData:t,initArgs:i,sendUpdateEpoch:n,version:s}=e;(0,r.A)("esri-2d-update-debug")&&console.debug(`Version[${this._version}] Epoch[${n}] AttributeStoreView.applyUpdate`),this._version=s,this._epoch=n,null!=i&&this._initialize(i);const o=this._data;for(let e=0;e<t.length;e++){const i=t[e],n=o[e];null!=n&&null!=i&&((0,r.A)("esri-2d-update-debug")&&console.debug(`Version[${this._version}] CpuBlock[${e}] AttributeStoreView.update`,{block:i}),n.update(i))}}}getUniforms(t){return{filterFlags:{texture:this._getTexture(t,o.dV.FilterFlags),unit:o.uM},animation:{texture:this._getTexture(t,o.dV.Animation),unit:o.z2},gpgpu:{texture:this._getTexture(t,o.dV.GPGPU),unit:o.Sr},localTimeOrigin:{texture:this._getTexture(t,o.dV.LocalTimeOrigin),unit:o.zt},visualVariableData:{texture:this._getTexture(t,o.dV.VV),unit:o.nM},dataDriven0:{texture:this._getTexture(t,o.dV.DD0),unit:o.lL},dataDriven1:{texture:this._getTexture(t,o.dV.DD1),unit:o.sn},dataDriven2:{texture:this._getTexture(t,o.dV.DD2),unit:o.n9},size:this.size}}_getTexture(t,e){const i=this._data?.[e];return i?(i.updateTexture(t,this._version),i.getTexture(t)):this._getDefaultTexture(t)}_getDefaultTexture(t){if(null==this._defaultTexture){const e=new d.R;e.wrapMode=u.pF.CLAMP_TO_EDGE,e.samplingMode=u.Cj.NEAREST,e.width=1,e.height=1,this._defaultTexture=new h.g(t,e,new Uint8Array(4))}return this._defaultTexture}}var _=i(82087);class m extends _.A{constructor(t){super(t),this._statisticsByLevel=new Map,this._entityIndex=new Map,this.attributeView=new p}destroy(){this.children.forEach((t=>t.destroy())),this.removeAllChildren(),this.attributeView.destroy()}doRender(t){t.context.capabilities.enable("textureFloatLinear"),super.doRender(t)}get hasAnimations(){for(const t of this.children)if(t.hasAnimations)return!0;return!1}_reindexAndUpdateFeaturesIfNeeded(){if(this.hasAnimations&&(this._reindexFeatures(),0!==this.attributeView.size))for(const t of this._entityIndex.values())t.dirty&&(this.attributeView.setData(t.displayId,o.dV.LocalTimeOrigin,0,t.firstIndexed),t.dirty=!1)}restartAnimation(t){const e=this._entityIndex.get(t);if(!e)return;const i=performance.now()/1e3;e.firstIndexed=i,e.dirty=!0}restartAllAnimations(){const t=performance.now()/1e3;for(const[e,i]of this._entityIndex)i.firstIndexed=t,i.dirty=!0}_reindexFeatures(){const t=performance.now()/1e3;for(const e of this.children)for(const i of e.entityIds){const{objectId:e}=i;let n=this._entityIndex.get(e);n||(n={objectId:e,displayId:0,firstIndexed:t,lastIndexed:0,dirty:!0},this._entityIndex.set(e,n)),n.lastIndexed=t,n.displayId=i.displayId}for(const[e,i]of this._entityIndex)t-i.lastIndexed>60&&this._entityIndex.delete(e)}_updateAttributeView(){this.attributeView.update(),this._reindexAndUpdateFeaturesIfNeeded()}createRenderParams(t){const e=super.createRenderParams(t);return e.attributeView=this.attributeView,e.instanceStore=this._instanceStore,e.statisticsByLevel=this._statisticsByLevel,e}}},7965:function(t,e,i){i.d(e,{m:function(){return l}});var n=i(44567),r=i(87085),s=i(25090),o=i(36729),a=i(77515);class l extends a.q{constructor(){super(...arguments),this._childrenSet=new Set,this._needsSort=!1,this._children=[],this._childrenObservable=new r.I,this._effectView=null,this._highlightGradient=null}get blendMode(){return this._blendMode}set blendMode(t){this._blendMode=t,this.requestRender()}get children(){return(0,n.gc)(this._childrenObservable),this._children}get clips(){return this._clips}set clips(t){this._clips=t,this.children.forEach((e=>e.clips=t))}get computedEffects(){return this._effectView?.effects??null}get effect(){return this._effectView?.effect??""}set effect(t){(this._effectView||t)&&(this._effectView||(this._effectView=new o.$B,this.addTransitionable(this._effectView)),this._effectView.effect=t,this.requestRender())}get highlightGradient(){return this._highlightGradient}set highlightGradient(t){this._highlightGradient=t,this.requestRender()}get hasBlending(){return!!this.blendMode}get hasHighlight(){return this.children.some((t=>t.hasHighlight))}get hasLabels(){return this.children.some((t=>t.hasLabels))}get requiresDedicatedFBO(){return this.children.some((t=>"blendMode"in t&&t.blendMode&&"normal"!==t.blendMode))}get isReady(){return this.children.every((t=>t.isReady))}get sortFunction(){return this._sortFunction}set sortFunction(t){this._sortFunction=t,t&&(this._needsSort=!0)}doRender(t){const e=this.createRenderParams(t),{painter:i}=e;i.beforeRenderLayer(e,this._clips?.length?255:0,this.computedOpacity),this.renderChildren(e),i.afterRenderLayer(e,this.computedOpacity)}addChild(t){return this.addChildAt(t,this.children.length)}addChildAt(t,e=this.children.length){if(!t)return t;if(this.contains(t))return t;this._needsSort=!0;const i=t.parent;return i&&i!==this&&i.removeChild(t),e>=this.children.length?this.children.push(t):this.children.splice(e,0,t),this._childrenSet.add(t),t.parent=this,t.stage=this.stage,this!==this.stage&&(t.clips=this.clips),this.requestRender(),this._childrenObservable.notify(),t}contains(t){return(0,n.gc)(this._childrenObservable),this._childrenSet.has(t)}removeAllChildren(){this._childrenSet.clear(),this._needsSort=!0;for(const t of this.children)this!==this.stage&&(t.clips=null),t.stage=null,t.parent=null;this.children.length=0,this._childrenObservable.notify()}removeChild(t){return this.contains(t)?this.removeChildAt(this.children.indexOf(t)):t}removeChildAt(t){if(t<0||t>=this.children.length)return null;this._needsSort=!0;const e=this.children.splice(t,1)[0];return this._childrenSet.delete(e),this!==this.stage&&(e.clips=null),e.stage=null,e.parent=null,this._childrenObservable.notify(),e}beforeRender(t){super.beforeRender(t),this.sortFunction&&this._needsSort&&(this.children.sort(this.sortFunction),this._needsSort=!1,this._childrenObservable.notify());for(const e of this.children)e.beforeRender(t)}afterRender(t){super.afterRender(t);for(const e of this.children)e.afterRender(t)}_createTransforms(){return{displayViewScreenMat3:(0,s.vt)()}}onAttach(){super.onAttach();const t=this.stage;for(const e of this.children)e.stage=t}onDetach(){super.onDetach();for(const t of this.children)t.stage=null}renderChildren(t){for(const e of this.children)e.processRender(t)}createRenderParams(t){return{...t,requireFBO:this.requiresDedicatedFBO,blendMode:this.blendMode,effects:this.computedEffects,globalOpacity:t.globalOpacity*this.computedOpacity,inFadeTransition:this.inFadeTransition,highlightGradient:this._highlightGradient||t.highlightGradient}}isTransitioning(){return super.isTransitioning()||this.children.some((t=>t.transitioning))}}},77515:function(t,e,i){i.d(e,{q:function(){return o}});var n=i(50659),r=i(48996),s=i(86668);class o extends r.A{constructor(){super(...arguments),this._transitionables=null,this._clips=null,this._fadeTransition=null,this._isReady=!1,this._opacity=1,this.parent=null,this._stage=null,this._visible=!0}get computedOpacity(){return this._fadeTransition?.computedOpacity??this.opacity}get clips(){return this._clips}set clips(t){this._clips=t,this.requestRender()}get fadeTransitionEnabled(){return null!==this._fadeTransition}set fadeTransitionEnabled(t){!this._fadeTransition&&t?(this._fadeTransition=new s.A({opacity:this.opacity,visible:this.visible}),this.addTransitionable(this._fadeTransition)):this._fadeTransition&&!t&&(this.removeTransitionable(this._fadeTransition),this._fadeTransition=null)}get inFadeTransition(){return this._fadeTransition?.transitioning??!1}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(t){this._opacity!==t&&(this._opacity=Math.min(1,Math.max(t,0)),this._fadeTransition&&(this._fadeTransition.opacity=this._opacity),this.requestRender())}get stage(){return this._stage}set stage(t){if(this._stage===t)return;const e=this._stage;this._stage=t,t?this._stage?.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):e?.trashDisplayObject(this)}get transforms(){return null==this._transforms&&(this._transforms=this._createTransforms()),this._transforms}get transitioning(){return this.isTransitioning()}get visible(){return this._visible}set visible(t){this._visible!==t&&(this._visible=t,this._fadeTransition&&(this._fadeTransition.visible=this._visible),this.requestRender())}get hasLabels(){return!1}get hasHighlight(){return!1}get hasBlending(){return!1}addTransitionable(t){this._transitionables??=[],this._transitionables.push(t),this.requestRender()}removeTransitionable(t){t.endTransition(),this._transitionables&&(0,n.TF)(this._transitionables,t),this.requestRender()}fadeIn(){this.fadeTransitionEnabled=!0;const t=this._fadeTransition.fadeIn();return this.opacity=1,this.requestRender(),t}fadeOut(){this.fadeTransitionEnabled=!0;const t=this._fadeTransition.fadeOut();return this.opacity=0,this.requestRender(),t}endTransitions(){if(this._transitionables){for(const t of this._transitionables)t.endTransition();this.requestRender()}}beforeRender(t){this.transitionStep(t.deltaTime,t.state.scale),this.setTransform(t.state)}afterRender(t){this.transitioning&&this.requestRender()}remove(){this.parent?.removeChild(this)}setTransform(t){}processRender(t){this.stage&&(this._fadeTransition?.computedVisible??this.visible)&&this.doRender(t)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this.endTransitions(),this.onDetach(),this.emit("detach")}isTransitioning(){return this._transitionables?.some((t=>t.transitioning))??!1}transitionStep(t,e){if(this._transitionables)for(const i of this._transitionables)i.transitionStep(t,e)}onAttach(){}onDetach(){}doRender(t){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}}},80708:function(t,e,i){i.d(e,{d:function(){return C}});var n=i(73936),r=i(43745),s=i(88413),o=i(52937),a=i(94020),l=i(85456),u=i(10904);class c extends o.A{constructor(){super(...arguments),this._color=(0,r.fA)(0,1,0,1)}dispose(){this._program&&this._program.dispose()}prepareState({context:t}){t.setStencilTestEnabled(!0),t.setBlendingEnabled(!1),t.setFaceCullingEnabled(!1),t.setColorMask(!1,!1,!1,!1),t.setStencilOp(l.eA.KEEP,l.eA.KEEP,l.eA.REPLACE),t.setStencilWriteMask(255),t.setStencilFunction(l.MT.ALWAYS,0,255)}draw(t,e){const{context:i,state:n,requestRender:r,allowDelayedRender:o}=t,c=(0,s.ES)("clip",{geometry:[{location:0,name:"a_pos",count:2,type:l.pe.SHORT}]}),h=e.getVAO(i,n,c.attributes,c.bufferLayouts);null!=h.indexBuffer&&(this._program||(this._program=(0,u.r)(i,a.T)),!o||null==r||this._program.compiled?(i.useProgram(this._program),this._program.setUniform2fv("u_coord_range",[1,1]),this._program.setUniform4fv("u_color",this._color),this._program.setUniformMatrix3fv("u_dvsMat3",n.displayMat3),i.bindVAO(h),i.drawElements(l.WR.TRIANGLES,h.indexBuffer.size,l.pe.UNSIGNED_INT,0),i.bindVAO()):r())}}var h=i(829),d=i(55382),f=i(15774),p=i(25090),_=i(39686),m=i(86305),g=i(81438);class y extends o.A{constructor(){super(...arguments),this._color=(0,r.fA)(1,0,0,1),this._patternMatrix=(0,p.vt)(),this._programOptions={id:!1,pattern:!1}}dispose(){this._vao&&(this._vao.dispose(),this._vao=null)}drawMany(t,e){const{context:i,painter:n,requestRender:r,allowDelayedRender:s}=t;this._loadWGLResources(t);const o=t.displayLevel,a=t.styleLayer,u=a.backgroundMaterial,c=n.vectorTilesMaterialManager,h=a.getPaintValue("background-color",o),d=a.getPaintValue("background-opacity",o),p=a.getPaintValue("background-pattern",o),m=void 0!==p,g=1|window.devicePixelRatio,y=t.spriteMosaic;let v,x;const b=g>_.C_?2:1,S=this._programOptions;S.pattern=m;const w=c.getMaterialProgram(i,u,S);if(!s||null==r||w.compiled){if(i.bindVAO(this._vao),i.useProgram(w),m){const t=y.getMosaicItemPosition(p,!0);if(null!=t){const{tl:e,br:n,page:r}=t;v=n[0]-e[0],x=n[1]-e[1];const s=y.getPageSize(r);null!=s&&(y.bind(i,l.Cj.LINEAR,r,_.$U),w.setUniform4f("u_tlbr",e[0],e[1],n[0],n[1]),w.setUniform2fv("u_mosaicSize",s),w.setUniform1i("u_texture",_.$U))}w.setUniform1f("u_opacity",d)}else{const t=h[3]*d;this._color[0]=t*h[0],this._color[1]=t*h[1],this._color[2]=t*h[2],this._color[3]=t,w.setUniform4fv("u_color",this._color)}w.setUniform1f("u_depth",a.z||0);for(const t of e){if(w.setUniform1f("u_coord_range",t.rangeX),w.setUniformMatrix3fv("u_dvsMat3",t.transforms.displayViewScreenMat3),m){const e=Math.max(2**(Math.round(o)-t.key.level),1),i=b*t.width*e,n=i/(0,f.yR)(v),r=i/(0,f.yR)(x);this._patternMatrix[0]=n,this._patternMatrix[4]=r,w.setUniformMatrix3fv("u_pattern_matrix",this._patternMatrix)}i.setStencilFunction(l.MT.EQUAL,0,255),i.drawArrays(l.WR.TRIANGLE_STRIP,0,4)}}else r()}_loadWGLResources(t){if(this._vao)return;const{context:e,styleLayer:i}=t,n=i.backgroundMaterial,r=new Int8Array([0,0,1,0,0,1,1,1]),s=m.g.createVertex(e,l._U.STATIC_DRAW,r),o=new g.Z(e,n.getAttributeLocations(),n.getLayoutInfo(),new Map([["geometry",s]]));this._vao=o}}var v=i(5367);class x extends o.A{constructor(){super(...arguments),this._programOptions={id:!1}}dispose(){}drawMany(t,e){const{context:i,displayLevel:n,requiredLevel:r,state:s,painter:o,spriteMosaic:a,styleLayerUID:u,requestRender:c,allowDelayedRender:h}=t;if(!e.some((t=>t.layerData.get(u)?.circleIndexCount??!1)))return;const d=t.styleLayer,f=d.circleMaterial,p=o.vectorTilesMaterialManager,_=d.getPaintValue("circle-translate",n),m=d.getPaintValue("circle-translate-anchor",n),g=this._programOptions,y=p.getMaterialProgram(i,f,g);if(h&&null!=c&&!y.compiled)return void c();i.useProgram(y),y.setUniformMatrix3fv("u_displayMat3",m===v.Cq.VIEWPORT?s.displayMat3:s.displayViewMat3),y.setUniform2fv("u_circleTranslation",_),y.setUniform1f("u_depth",d.z),y.setUniform1f("u_antialiasingWidth",1.2);let x=-1;for(const t of e){if(!t.layerData.has(u))continue;t.key.level!==x&&(x=t.key.level,f.setDataUniforms(y,n,d,x,a));const e=t.layerData.get(u);if(!e.circleIndexCount)continue;e.prepareForRendering(i);const s=e.vao;null!=s&&(i.bindVAO(s),y.setUniformMatrix3fv("u_dvsMat3",t.transforms.displayViewScreenMat3),r!==t.key.level?i.setStencilFunction(l.MT.EQUAL,t.stencilRef,255):i.setStencilFunction(l.MT.GREATER,255,255),i.drawElements(l.WR.TRIANGLES,e.circleIndexCount,l.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*e.circleIndexStart),t.triangleCount+=e.circleIndexCount/3)}}}const b=1/65536;class S extends o.A{constructor(){super(...arguments),this._fillProgramOptions={id:!1,pattern:!1},this._outlineProgramOptions={id:!1}}dispose(){}drawMany(t,e){const{displayLevel:i,renderPass:n,spriteMosaic:r,styleLayerUID:s}=t;let o=!1;for(const t of e)if(t.layerData.has(s)){const e=t.layerData.get(s);if(e.fillIndexCount>0||e.outlineIndexCount>0){o=!0;break}}if(!o)return;const a=t.styleLayer,l=a.getPaintProperty("fill-pattern"),u=void 0!==l,c=u&&l.isDataDriven;let h;if(u&&!c){const t=l.getValue(i);h=r.getMosaicItemPosition(t,!0)}const d=!u&&a.getPaintValue("fill-antialias",i);let f=!0,p=1;if(!u){const t=a.getPaintProperty("fill-color"),e=a.getPaintProperty("fill-opacity");if(!t?.isDataDriven&&!e?.isDataDriven){const t=a.getPaintValue("fill-color",i);p=a.getPaintValue("fill-opacity",i)*t[3],p>=1&&(f=!1)}}if(f&&"opaque"===n)return;const _=a.getPaintValue("fill-translate",i),m=a.getPaintValue("fill-translate-anchor",i);(f||"translucent"!==n)&&this._drawFill(t,s,a,e,_,m,u,h,c);const g=!a.hasDataDrivenOutlineColor&&a.outlineUsesFillColor&&p<1;d&&"opaque"!==n&&!g&&this._drawOutline(t,s,a,e,_,m)}_drawFill(t,e,i,n,r,s,o,a,u){if(o&&!u&&null==a)return;const{context:c,displayLevel:h,state:d,painter:f,pixelRatio:p,spriteMosaic:m,requestRender:g,allowDelayedRender:y}=t,x=i.fillMaterial,S=f.vectorTilesMaterialManager,w=p>_.C_?2:1,T=this._fillProgramOptions;T.pattern=o;const P=S.getMaterialProgram(c,x,T);if(y&&null!=g&&!P.compiled)return void g();if(c.useProgram(P),null!=a){const{page:t}=a,e=m.getPageSize(t);null!=e&&(m.bind(c,l.Cj.LINEAR,t,_.$U),P.setUniform2fv("u_mosaicSize",e),P.setUniform1i("u_texture",_.$U))}P.setUniformMatrix3fv("u_displayMat3",s===v.Cq.VIEWPORT?d.displayMat3:d.displayViewMat3),P.setUniform2fv("u_fillTranslation",r),P.setUniform1f("u_depth",i.z+b);let I=-1;for(const t of n){if(!t.layerData.has(e))continue;t.key.level!==I&&(I=t.key.level,x.setDataUniforms(P,h,i,I,m));const n=t.layerData.get(e);if(!n.fillIndexCount)continue;n.prepareForRendering(c);const r=n.fillVAO;if(null!=r){if(c.bindVAO(r),P.setUniformMatrix3fv("u_dvsMat3",t.transforms.displayViewScreenMat3),c.setStencilFunction(l.MT.EQUAL,t.stencilRef,255),o){const e=Math.max(2**(Math.round(h)-t.key.level),1),i=t.rangeX/(w*t.width*e);P.setUniform1f("u_patternFactor",i)}if(u){const t=n.patternMap;if(!t)continue;for(const[e,i]of t){const t=m.getPageSize(e);null!=t&&(m.bind(c,l.Cj.LINEAR,e,_.$U),P.setUniform2fv("u_mosaicSize",t),P.setUniform1i("u_texture",_.$U),c.drawElements(l.WR.TRIANGLES,i[1],l.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*i[0]))}}else c.drawElements(l.WR.TRIANGLES,n.fillIndexCount,l.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*n.fillIndexStart);t.triangleCount+=n.fillIndexCount/3}}}_drawOutline(t,e,i,n,r,s){const{context:o,displayLevel:a,state:u,painter:c,pixelRatio:h,spriteMosaic:d,requestRender:f,allowDelayedRender:p}=t,_=i.outlineMaterial,m=c.vectorTilesMaterialManager,g=.75/h,y=this._outlineProgramOptions,x=m.getMaterialProgram(o,_,y);if(p&&null!=f&&!x.compiled)return void f();o.useProgram(x),x.setUniformMatrix3fv("u_displayMat3",s===v.Cq.VIEWPORT?u.displayMat3:u.displayViewMat3),x.setUniform2fv("u_fillTranslation",r),x.setUniform1f("u_depth",i.z+b),x.setUniform1f("u_outline_width",g);let S=-1;for(const t of n){if(!t.layerData.has(e))continue;t.key.level!==S&&(S=t.key.level,_.setDataUniforms(x,a,i,S,d));const n=t.layerData.get(e);if(n.prepareForRendering(o),!n.outlineIndexCount)continue;const r=n.outlineVAO;null!=r&&(o.bindVAO(r),x.setUniformMatrix3fv("u_dvsMat3",t.transforms.displayViewScreenMat3),o.setStencilFunction(l.MT.EQUAL,t.stencilRef,255),o.drawElements(l.WR.TRIANGLES,n.outlineIndexCount,l.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*n.outlineIndexStart),t.triangleCount+=n.outlineIndexCount/3)}}}class w extends o.A{constructor(){super(...arguments),this._programOptions={id:!1,pattern:!1,sdf:!1}}dispose(){}drawMany(t,e){const{context:i,displayLevel:n,state:r,painter:s,pixelRatio:o,spriteMosaic:a,styleLayerUID:u,requestRender:c,allowDelayedRender:h}=t;if(!e.some((t=>t.layerData.get(u)?.lineIndexCount??!1)))return;const d=t.styleLayer,f=d.lineMaterial,p=s.vectorTilesMaterialManager,m=d.getPaintValue("line-translate",n),g=d.getPaintValue("line-translate-anchor",n),y=d.getPaintProperty("line-pattern"),x=void 0!==y,b=x&&y.isDataDriven;let S,w;if(x&&!b){const t=y.getValue(n);S=a.getMosaicItemPosition(t)}let T=!1;if(!x){const t=d.getPaintProperty("line-dasharray");if(w=void 0!==t,T=w&&t.isDataDriven,w&&!T){const e=t.getValue(n),i=d.getDashKey(e,d.getLayoutValue("line-cap",n));S=a.getMosaicItemPosition(i)}}const P=1/o,I=this._programOptions;I.pattern=x,I.sdf=w;const M=p.getMaterialProgram(i,f,I);if(h&&null!=c&&!M.compiled)return void c();if(i.useProgram(M),M.setUniformMatrix3fv("u_displayViewMat3",r.displayViewMat3),M.setUniformMatrix3fv("u_displayMat3",g===v.Cq.VIEWPORT?r.displayMat3:r.displayViewMat3),M.setUniform2fv("u_lineTranslation",m),M.setUniform1f("u_depth",d.z),M.setUniform1f("u_antialiasing",P),S&&null!=S){const{page:t}=S,e=a.getPageSize(t);null!=e&&(a.bind(i,l.Cj.LINEAR,t,_.$U),M.setUniform2fv("u_mosaicSize",e),M.setUniform1i("u_texture",_.$U))}let A=-1;for(const t of e){if(!t.layerData.has(u))continue;t.key.level!==A&&(A=t.key.level,f.setDataUniforms(M,n,d,A,a));const e=2**(n-A)/o;M.setUniform1f("u_zoomFactor",e);const r=t.layerData.get(u);if(!r.lineIndexCount)continue;r.prepareForRendering(i);const s=r.vao;if(null!=s){if(i.bindVAO(s),M.setUniformMatrix3fv("u_dvsMat3",t.transforms.displayViewScreenMat3),i.setStencilFunction(l.MT.EQUAL,t.stencilRef,255),b||T){const t=r.patternMap;if(!t)continue;for(const[e,n]of t){const t=a.getPageSize(e);null!=t&&(a.bind(i,l.Cj.LINEAR,e,_.$U),M.setUniform2fv("u_mosaicSize",t),M.setUniform1i("u_texture",_.$U),i.drawElements(l.WR.TRIANGLES,n[1],l.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*n[0]))}}else i.drawElements(l.WR.TRIANGLES,r.lineIndexCount,l.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*r.lineIndexStart);t.triangleCount+=r.lineIndexCount/3}}}}var T=i(14583),P=i(92422),I=i(36753);const M=1/65536;class A extends o.A{constructor(){super(...arguments),this._iconProgramOptions={id:!1,sdf:!1},this._sdfProgramOptions={id:!1},this._spritesTextureSize=(0,T.vt)()}dispose(){}drawMany(t,e){const i=t.styleLayer;this._drawIcons(t,i,e),this._drawText(t,i,e)}_drawIcons(t,e,i){const{context:n,displayLevel:r,painter:s,spriteMosaic:o,state:a,styleLayerUID:l,requestRender:u,allowDelayedRender:c}=t,h=e.iconMaterial,d=s.vectorTilesMaterialManager;let f,p=!1;for(const t of i)if(t.layerData.has(l)&&(f=t.layerData.get(l),f.iconPerPageElementsMap.size>0)){p=!0;break}if(!p)return;const m=e.getPaintValue("icon-translate",r),g=e.getPaintValue("icon-translate-anchor",r);let y=e.getLayoutValue("icon-rotation-alignment",r);y===v.I5.AUTO&&(y=e.getLayoutValue("symbol-placement",r)===v.kt.POINT?v.I5.VIEWPORT:v.I5.MAP);const x=y===v.I5.MAP,b=e.getLayoutValue("icon-keep-upright",r)&&x,S=f.isIconSDF,w=this._iconProgramOptions;w.sdf=S;const T=d.getMaterialProgram(n,h,w);if(c&&null!=u&&!T.compiled)return void u();n.useProgram(T),T.setUniformMatrix3fv("u_displayViewMat3",y===v.I5.MAP?a.displayViewMat3:a.displayMat3),T.setUniformMatrix3fv("u_displayMat3",g===v.Cq.VIEWPORT?a.displayMat3:a.displayViewMat3),T.setUniform2fv("u_iconTranslation",m),T.setUniform1f("u_depth",e.z),T.setUniform1f("u_mapRotation",(0,I.wV)(a.rotation)),T.setUniform1f("u_keepUpright",b?1:0),T.setUniform1f("u_level",10*r),T.setUniform1i("u_texture",_.$U),T.setUniform1f("u_fadeDuration",P.zk/1e3);let M=-1;for(const s of i){if(!s.layerData.has(l))continue;if(s.key.level!==M&&(M=s.key.level,h.setDataUniforms(T,r,e,M,o)),f=s.layerData.get(l),0===f.iconPerPageElementsMap.size)continue;f.prepareForRendering(n),f.updateOpacityInfo();const i=f.iconVAO;if(null!=i){n.bindVAO(i),T.setUniformMatrix3fv("u_dvsMat3",s.transforms.displayViewScreenMat3),T.setUniform1f("u_time",(performance.now()-f.lastOpacityUpdate)/1e3);for(const[e,i]of f.iconPerPageElementsMap)this._renderIconRange(t,T,i,e,s)}}}_renderIconRange(t,e,i,n,r){const{context:s,spriteMosaic:o}=t;this._spritesTextureSize[0]=o.getWidth(n)/4,this._spritesTextureSize[1]=o.getHeight(n)/4,e.setUniform2fv("u_mosaicSize",this._spritesTextureSize),o.bind(s,l.Cj.LINEAR,n,_.$U),this._setStencilState(t,r),s.drawElements(l.WR.TRIANGLES,i[1],l.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*i[0]),r.triangleCount+=i[1]/3}_drawText(t,e,i){const{context:n,displayLevel:r,glyphMosaic:s,painter:o,pixelRatio:a,spriteMosaic:l,state:u,styleLayerUID:c,requestRender:h,allowDelayedRender:d}=t,f=e.textMaterial,p=o.vectorTilesMaterialManager;let m,g=!1;for(const t of i)if(t.layerData.has(c)&&(m=t.layerData.get(c),m.glyphPerPageElementsMap.size>0)){g=!0;break}if(!g)return;const y=e.getPaintProperty("text-opacity");if(y&&!y.isDataDriven&&0===y.getValue(r))return;const x=e.getPaintProperty("text-color"),b=!x||x.isDataDriven||x.getValue(r)[3]>0,S=e.getPaintProperty("text-halo-width"),w=e.getPaintProperty("text-halo-color"),A=(!S||S.isDataDriven||S.getValue(r)>0)&&(!w||w.isDataDriven||w.getValue(r)[3]>0);if(!b&&!A)return;let C=e.getLayoutValue("text-rotation-alignment",r);C===v.I5.AUTO&&(C=e.getLayoutValue("symbol-placement",r)===v.kt.POINT?v.I5.VIEWPORT:v.I5.MAP);const E=C===v.I5.MAP,R=e.getLayoutValue("text-keep-upright",r)&&E,O=.8*3/a;this._glyphTextureSize||(this._glyphTextureSize=(0,T.fA)(s.width/4,s.height/4));const z=e.getPaintValue("text-translate",r),D=e.getPaintValue("text-translate-anchor",r),L=this._sdfProgramOptions,F=p.getMaterialProgram(n,f,L);if(d&&null!=h&&!F.compiled)return void h();n.useProgram(F),F.setUniformMatrix3fv("u_displayViewMat3",C===v.I5.MAP?u.displayViewMat3:u.displayMat3),F.setUniformMatrix3fv("u_displayMat3",D===v.Cq.VIEWPORT?u.displayMat3:u.displayViewMat3),F.setUniform2fv("u_textTranslation",z),F.setUniform1f("u_depth",e.z+M),F.setUniform2fv("u_mosaicSize",this._glyphTextureSize),F.setUniform1f("u_mapRotation",(0,I.wV)(u.rotation)),F.setUniform1f("u_keepUpright",R?1:0),F.setUniform1f("u_level",10*r),F.setUniform1i("u_texture",_.mg),F.setUniform1f("u_antialiasingWidth",O),F.setUniform1f("u_fadeDuration",P.zk/1e3);let V=-1;for(const o of i){if(!o.layerData.has(c))continue;if(o.key.level!==V&&(V=o.key.level,f.setDataUniforms(F,r,e,V,l)),m=o.layerData.get(c),0===m.glyphPerPageElementsMap.size)continue;m.prepareForRendering(n),m.updateOpacityInfo();const i=m.textVAO;if(null==i)continue;n.bindVAO(i),F.setUniformMatrix3fv("u_dvsMat3",o.transforms.displayViewScreenMat3),this._setStencilState(t,o);const a=(performance.now()-m.lastOpacityUpdate)/1e3;F.setUniform1f("u_time",a),m.glyphPerPageElementsMap.forEach(((t,e)=>{this._renderGlyphRange(n,t,e,s,F,A,b,o)}))}}_renderGlyphRange(t,e,i,n,r,s,o,a){n.bind(t,l.Cj.LINEAR,i,_.mg),s&&(r.setUniform1f("u_halo",1),t.drawElements(l.WR.TRIANGLES,e[1],l.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*e[0]),a.triangleCount+=e[1]/3),o&&(r.setUniform1f("u_halo",0),t.drawElements(l.WR.TRIANGLES,e[1],l.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*e[0]),a.triangleCount+=e[1]/3)}_setStencilState(t,e){const{context:i,is3D:n,stencilSymbols:r}=t;if(i.setStencilTestEnabled(!0),r)return i.setStencilWriteMask(255),void i.setStencilFunction(l.MT.ALWAYS,e.stencilRef,255);i.setStencilWriteMask(0),n?i.setStencilFunction(l.MT.EQUAL,e.stencilRef,255):i.setStencilFunction(l.MT.GREATER,255,255)}}const C={clip:c,stencil:h.A,bitmap:n.A,tileDebugInfo:d.A,vtlBackground:y,vtlFill:S,vtlLine:w,vtlCircle:x,vtlSymbol:A}},16043:function(t,e,i){function n(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function r(){const t=n("svg");return t.setAttribute("style","position: absolute;"),t.setAttribute("width","0"),t.setAttribute("height","0"),t.setAttribute("aria-hidden","true"),t.setAttribute("role","presentation"),document.body.appendChild(t),t}function s(t){return null!=t&&document.body.removeChild(t),null}i.d(e,{FJ:function(){return n},p:function(){return r},pK:function(){return s}})},86668:function(t,e,i){i.d(e,{A:function(){return u}});var n=i(53804),r=i(83525),s=i(58941),o=i(60539),a=i(23502),l=(i(40633),i(13798),i(65953));let u=class extends r.A{constructor(t){super(t),this.computedOpacity=1,this.computedVisible=!0,this.opacity=1,this.visible=!0,this._fadeOutResolver=null,this._fadeInResolver=null}get transitioning(){return(this._fadeOutResolver||!this.visible?0:this.opacity)!==this.computedOpacity}endTransition(){this._fadeInResolver?.(),this._fadeOutResolver?.(),this._fadeInResolver=this._fadeOutResolver=null,this.computedOpacity=this.visible?this.opacity:0}fadeIn(){return this._fadeInResolver||(this.opacity=1,this.computedOpacity=0,this._fadeOutResolver?.(),this._fadeOutResolver=null,this._fadeInResolver=(0,o.Tw)()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this.opacity=0,this._fadeInResolver?.(),this._fadeInResolver=null,this._fadeOutResolver=(0,o.Tw)()),this._fadeOutResolver.promise}transitionStep(t,e){const i=(0,s.A)("mapview-transitions-duration"),n=i?1/i:0;if(0===n)this.computedOpacity=this.opacity,this.computedVisible=this.visible;else{const e=this._fadeOutResolver||!this.visible?0:this.opacity,i=this.computedOpacity;if(i===e)this.computedVisible=this.visible;else{const r=t*n;this.computedOpacity=i>e?Math.max(e,i-r):Math.min(e,i+r),this.computedVisible=this.computedOpacity>0}}this.transitioning||(this._fadeInResolver?.(),this._fadeOutResolver?.(),this._fadeOutResolver=this._fadeInResolver=null)}};(0,n._)([(0,a.MZ)()],u.prototype,"computedOpacity",void 0),(0,n._)([(0,a.MZ)()],u.prototype,"computedVisible",void 0),(0,n._)([(0,a.MZ)()],u.prototype,"opacity",void 0),(0,n._)([(0,a.MZ)()],u.prototype,"visible",void 0),(0,n._)([(0,a.MZ)()],u.prototype,"transitioning",null),(0,n._)([(0,a.MZ)()],u.prototype,"_fadeOutResolver",void 0),(0,n._)([(0,a.MZ)()],u.prototype,"_fadeInResolver",void 0),u=(0,n._)([(0,l.$)("esri.views.2d.engine.transitions.FadeTransition")],u)},92422:function(t,e,i){i.d(e,{IT:function(){return n},av:function(){return s},o2:function(){return r},zk:function(){return o}});const n=!0,r=32,s=1.5,o=200},58013:function(t,e,i){i.d(e,{u:function(){return f}});var n=i(67348),r=i(10793),s=i(44705),o=i(25090),a=i(20551),l=i(43274),u=i(39686),c=i(54631);const h=(0,o.vt)(),d=(0,l.vt)();class f extends c.Y{constructor(t,e,i,n){super(t,e,i,n,u.CQ,u.CQ)}destroy(){super.destroy()}setTransform(t){const e=this.resolution/t.resolution,i=this.transforms.tileMat3,[o,a]=t.toScreenNoRotation([0,0],[this.x,this.y]),l=this.width/this.rangeX*e,u=this.height/this.rangeY*e;(0,s.hZ)(i,l,0,0,0,u,0,o,a,1),(0,s.lw)(this.transforms.displayViewScreenMat3,t.displayViewMat3,i);const c=(0,n.hZ)((0,r.vt)(),l,0,0,u,o,a);(0,n.lw)(this.transforms.labelMat2d,t.viewMat2d,c)}_createTransforms(){return{labelMat2d:(0,r.vt)(),tileMat3:(0,o.vt)(),displayViewScreenMat3:(0,o.vt)()}}containsScreenPoint(t,e,i){const n=(0,s.lw)(h,t.viewMat3,this.transforms.tileMat3),r=(0,s.B8)(h,n);if(null==r)return!0;(0,a.i)(d,...e,1);const o=(0,a.q)(d,d,r),l=i*(this.resolution/t.resolution);return o[0]>=-l&&o[0]<this.width+l&&o[1]>=-l&&o[1]<this.height+l}}},94860:function(t,e,i){i.d(e,{Pd:function(){return s},VS:function(){return a},oI:function(){return o}});var n=i(85456),r=i(3817);const s=new Map([["geometry",[new r._("a_pos",2,n.pe.BYTE,0,2)]]]),o=new Map([["geometry",[new r._("a_pos",2,n.pe.BYTE,0,4),new r._("a_tex",2,n.pe.BYTE,2,4)]]]),a=new Map([["geometry",[new r._("a_pos",2,n.pe.UNSIGNED_SHORT,0,4)]]])},46065:function(t,e,i){i.d(e,{A:function(){return s}});var n=i(88231),r=i(24964);class s{constructor(t,e){this.id=t,this.sortKey=e,this.records=[]}serialize(t){return t.push(this.id),t.writeF32(this.sortKey),(0,r.j)(t,this.records),t}static deserialize(t){const e=t.readInt32(),i=t.readF32(),o=new s(e,i);return o.records=(0,r._)(t,n.A)??[],o}}s.byteSizeHint=2*Uint32Array.BYTES_PER_ELEMENT+n.A.byteSizeHint},7459:function(t,e,i){i.d(e,{KQ:function(){return n},Q4:function(){return s},Ss:function(){return o}});const n=8388607,r=8388608,s=t=>t&n;function o(t,e){return((e?r:0)|t)>>>0}},88231:function(t,e,i){i.d(e,{A:function(){return n}});class n{constructor(t,e,i,n,r,s,o){this.instanceId=t,this.textureKey=e,this.indexStart=i,this.indexCount=n,this.vertexStart=r,this.vertexCount=s,this.overlaps=o}updateBaseOffsets(t){this.vertexStart+=t.vertexFrom,this.indexStart+=t.indexFrom}clone(){return new n(this.instanceId,this.textureKey,this.indexStart,this.indexCount,this.vertexStart,this.vertexCount,this.overlaps)}static write(t,e,i,n,r,s,o,a){t.push(e),t.push(i),t.push(n),t.push(r),t.push(s),t.push(o),t.push(a)}serialize(t){return t.push(this.instanceId),t.push(this.textureKey),t.push(this.indexStart),t.push(this.indexCount),t.push(this.vertexStart),t.push(this.vertexCount),t.push(this.overlaps),t}static deserialize(t){const e=t.readInt32(),i=t.readInt32(),r=t.readInt32(),s=t.readInt32(),o=t.readInt32(),a=t.readInt32(),l=t.readInt32();return new n(e,i,r,s,o,a,l)}}n.byteSizeHint=7*Uint32Array.BYTES_PER_ELEMENT},27657:function(t,e,i){i.d(e,{R:function(){return R}});var n=i(58941),r=i(40633),s=i(10793),o=i(58013),a=i(39686),l=i(46065),u=i(28230),c=i(83258),h=i(86847),d=i(85456);function f(t,e){return t<<16|255&e}class p{constructor(t,e,i,n,r){this.instance=t,this.materialKey=e,this.target=i,this.start=n,this.count=r}get textureKey(){return 255&this.materialKey}get indexEnd(){return this.start+this.count}extend(t){this.count+=t}render(t){this.instance.techniqueRef.render(t,this)}getStencilReference(){return this.target.stencilRef}getAttributePrecisionPackFactors(){const t=this.instance.instanceId;return this.target.getMesh(t).getAttributePrecisionPackFactors()}draw(t,e){(0,h.Eq)(t)?this.drawCompute(t.context,e):this.drawGeometry(t.context,e)}drawCompute(t,e){const i=this.instance.instanceId,n=this.target.getMesh(i).getComputeVAO(t,e),r=this.start*Uint32Array.BYTES_PER_ELEMENT/3;t.bindVAO(n),t.drawElements(d.WR.POINTS,this.count/3,d.pe.UNSIGNED_INT,r),t.bindVAO(null)}drawGeometry(t,e){const i=this.instance.instanceId,n=this.target.getMesh(i).getGeometryVAO(t,e),r=this.start*Uint32Array.BYTES_PER_ELEMENT;t.bindVAO(n),t.drawElements(d.WR.TRIANGLES,this.count,d.pe.UNSIGNED_INT,r),t.bindVAO(null)}}class _{constructor(){this._length=0,this._minOrderedLength=0,this._materialKeys=new Set}static fromDisplayEntities(t,e,i,n){const r=new _;for(const s of t.values())for(const t of s.records){const s=i.getInstance(t.instanceId),o=f(s.instanceId,t.textureKey);r.addRecord(s,o,t.indexStart,t.indexCount,t.vertexStart,t.vertexCount,e,n)}return r}get length(){return this._length}get minOrderedLength(){return this._minOrderedLength}get minUnorderedLength(){return this._materialKeys.size}render(t,e){const{drawPhase:i}=t;for(const n of this.infos()){const r=n.instance.techniqueRef;r.drawPhase&i&&(null==e||r.type===e)&&n.render(t)}}addRecord(t,e,i,n,r,s,o,a){let l=i,h=n;if(h||(l=r,h=s),!h)return;if(null==this._head){const i=new p(t,e,o,l,h);return this._head=new c.B(i),this._tail=this._head,this._length++,void this._minOrderedLength++}if(a===u.ch.STRICT_ORDER)return this._insert(t,e,o,l,h,this._tail,null);let d=null,f=this._head;const _=t.instanceId,m=t.techniqueRef.symbologyPlane;if(a===u.ch.STRICT_MARKERS_AND_TEXT&&(m===u.uC.MARKER||m===u.uC.TEXT))return this._insert(t,e,o,l,h,this._tail,null);for(;f;){const i=f.data.instance,n=i.instanceId,r=i.techniqueRef.symbologyPlane,s=d?.data.instance.instanceId;if(m<r||_===s&&_!==n)return this._insert(t,e,o,l,h,d,f);d=f,f=f.next}this._insert(t,e,o,l,h,d,null)}*infos(){if(null!=this._head)for(const t of this._head.values())yield t}_insert(t,e,i,n,r,s,o){if(null==s&&null==o){const s=new p(t,e,i,n,r);return this._head=new c.B(s),this._tail=this._head,this._length++,void this._minOrderedLength++}return e!==this._tail.data.materialKey&&this._minOrderedLength++,this._materialKeys.add(e),null==s&&null!=o?this._insertAtHead(t,e,i,n,r,o):null!=s&&null==o?this._insertAtEnd(t,e,i,n,r,s):null!=s&&null!=o?this._insertAtMiddle(t,e,i,n,r,s,o):void 0}_insertAtHead(t,e,i,n,r,s){const o=n+r;if(e===s.data.materialKey&&i===s.data.target&&o===s.data.start)s.data.start=n,s.data.count+=r;else{const o=new p(t,e,i,n,r);this._head=new c.B(o),this._head.next=s,this._length++}}_insertAtEnd(t,e,i,n,r,s){if(s.data.materialKey===e&&s.data.indexEnd===n)s.data.count+=r;else{const o=new p(t,e,i,n,r);this._tail=new c.B(o),s.next=this._tail,this._length++}}_insertAtMiddle(t,e,i,n,r,s,o){const a=n+r;if(s.data.materialKey===e&&s.data.target===i&&s.data.indexEnd===n)s.data.count+=r,s.data.materialKey===o.data.materialKey&&s.data.target===o.data.target&&s.data.indexEnd===o.data.start&&(s.data.count+=o.data.count,s.next=o.next,this._length--);else if(e===o.data.materialKey&&i===o.data.target&&a===o.data.start)o.data.start=n,o.data.count+=r;else{const a=new p(t,e,i,n,r),l=new c.B(a);s.next=l,l.next=o,this._length++}}}class m{constructor(t){this._indexOnly=t,this.vertex={count:0,operations:[]},this.index={count:0,operations:[]}}copyRecord(t){let e=0;this._indexOnly||(e=this.vertex.count-t.vertexStart,this.vertex.operations.push({srcFrom:t.vertexStart,dstFrom:this.vertex.count,count:t.vertexCount,mutate:0}),t.vertexStart=this.vertex.count,this.vertex.count+=t.vertexCount);let i=!1;if(this._indexOnly&&this.index.operations.length>=1){const e=this.index.operations[this.index.operations.length-1];e.srcFrom+e.count===t.indexStart&&(e.count+=t.indexCount,i=!0)}i||this.index.operations.push({srcFrom:t.indexStart,dstFrom:this.index.count,count:t.indexCount,mutate:e}),t.indexStart=this.index.count,this.index.count+=t.indexCount}}var g=i(57650),y=i(95929),v=i(85475),x=i(28055),b=i(86305);class S{constructor(t,e,i,n){this._pool=n;const r=x.W.create(e*i*Uint32Array.BYTES_PER_ELEMENT,this._pool);this.size=e,this.strideInt=i,this.bufferType=t,this.dirty={start:1/0,end:0},this.memoryStats={bytesUsed:0,bytesReserved:e*i*Uint32Array.BYTES_PER_ELEMENT},this._gpu=null,this._cpu=r,this.clear()}get elementSize(){return this._cpu.length/this.strideInt}get intSize(){return this.fillPointer*this.strideInt}get byteSize(){return this.intSize*Uint32Array.BYTES_PER_ELEMENT}get invalidated(){return this.bufferSize>0&&!this._gpu}get invalidatedComputeBuffer(){return this.bufferSize>0&&!this._gpuComputeTriangles}invalidate(){this._invalidateTriangleBuffer(),this._gpu?.dispose(),this._gpu=null}_invalidateTriangleBuffer(){this._gpuComputeTriangles?.dispose(),this._gpuComputeTriangles=null}destroy(){this._gpu?.dispose(),this._gpuComputeTriangles?.dispose(),this._cpu?.destroy()}clear(){this.dirty.start=1/0,this.dirty.end=0,this.freeList=new c.P({start:0,end:this._cpu.length/this.strideInt}),this.fillPointer=0}ensure(t){if(!(this.maxAvailableSpace()>=t)&&t*this.strideInt>this._cpu.length-this.fillPointer){this.invalidate();const e=this._cpu.length/this.strideInt,i=Math.round(1.25*(e+t)),n=i*this.strideInt;this._cpu.expand(n*Uint32Array.BYTES_PER_ELEMENT),this.freeList.free(e,i-e),this.memoryStats.bytesReserved+=(i-e)*this.strideInt*Uint32Array.BYTES_PER_ELEMENT}}set(t,e){this._cpu.array[t]!==e&&(this._cpu.array[t]=e,this.dirty.start=Math.min(t,this.dirty.start),this.dirty.end=Math.max(t+1,this.dirty.end))}getGPUBuffer(t,e=!1){if(!this.bufferSize)return null;if(e){if("index"!==this.bufferType)throw new Error("Tired to get triangle buffer, but target is not an index buffer");return null==this._gpuComputeTriangles&&(this._gpuComputeTriangles=this._createComputeBuffer(t)),this._gpuComputeTriangles}return null==this._gpu&&(this._gpu=this._createBuffer(t)),this._gpu}getView(t,e){return this._cpu.getUint32View(t,e/Uint32Array.BYTES_PER_ELEMENT)}get bufferSize(){return this._cpu.length/this.strideInt}maxAvailableSpace(){return this.freeList.maxAvailableSpace()}insert(t,e,i,n){const r=i*this.strideInt;if(!r)return 0;const s=e*this.strideInt*Uint32Array.BYTES_PER_ELEMENT,o=new Uint32Array(t,s,r),a=this.freeList.firstFit(i);(0,y.Lw)(a,"First fit region must be defined");const l=a*this.strideInt,u=r;if(this._cpu.array.set(o,l),0!==n)for(let t=0;t<o.length;t++)this._cpu.array[t+l]+=n;return this.dirty.start=Math.min(this.dirty.start,l),this.dirty.end=Math.max(this.dirty.end,l+u),this.fillPointer=Math.max(this.fillPointer,l+u),this.memoryStats.bytesUsed+=i*this.strideInt*Uint32Array.BYTES_PER_ELEMENT,a}copyFrom(t,e,i,n,r){const s=i*this.strideInt;if(!s)return 0;const o=e*this.strideInt*Uint32Array.BYTES_PER_ELEMENT,a=t._cpu.getUint32View(o,s),l=this.freeList.firstFit(i);(0,y.Lw)(l,"First fit region must be defined");const u=l*this.strideInt,c=s;if(this._cpu.array.set(a,u),0!==n)for(let t=0;t<s;t++)this._cpu.array[u+t*this.strideInt+r]+=n;return this.dirty.start=Math.min(this.dirty.start,u),this.dirty.end=Math.max(this.dirty.end,u+c),this.fillPointer=Math.max(this.fillPointer,u+c),this.memoryStats.bytesUsed+=i*this.strideInt*Uint32Array.BYTES_PER_ELEMENT,l}free(t,e,i){const n=t*this.strideInt,r=(t+e)*this.strideInt;if(!0===i)for(let i=t;i!==t+e;i++)this._cpu.array[i*this.strideInt]=2147450879;this.dirty.start=Math.min(this.dirty.start,n),this.dirty.end=Math.max(this.dirty.end,r),this.freeList.free(t,e),this.memoryStats.bytesUsed-=e*this.strideInt*Uint32Array.BYTES_PER_ELEMENT}upload(){if(this.dirty.end){if(this._invalidateTriangleBuffer(),null==this._gpu)return this.dirty.start=1/0,void(this.dirty.end=0);this._gpu.setSubData(this._cpu.array,this.dirty.start,this.dirty.start,this.dirty.end),this.dirty.start=1/0,this.dirty.end=0}}reshuffle(t,e){if(0===e.length)return;const i=this.byteSize,n=t*this.strideInt*Uint32Array.BYTES_PER_ELEMENT,r=i>n,s=this._cpu,o=x.W.create(n,this._pool);r||o.array.set(this._cpu.getUint32View(0,this.intSize));for(const t of e)if(r||t.srcFrom!==t.dstFrom||0!==t.mutate){this.dirty.start=Math.min(this.dirty.start,t.dstFrom*this.strideInt),this.dirty.end=Math.max(this.dirty.end,(t.dstFrom+t.count)*this.strideInt);for(let e=0;e<t.count;e++){const i=(t.dstFrom+e)*this.strideInt,n=(t.srcFrom+e)*this.strideInt;for(let e=0;e<this.strideInt;e++)o.array[i+e]=s.array[n+e]+t.mutate}}this._cpu.destroy(),this._cpu=o,r&&this.invalidate(),this.freeList.clear(),this.memoryStats.bytesUsed=this.memoryStats.bytesReserved=n}_createBuffer(t){const e=d._U.DYNAMIC_DRAW;return"index"===this.bufferType?b.g.createIndex(t,e,this._cpu.array):b.g.createVertex(t,e,this._cpu.array)}_createComputeBuffer(t){const e=d._U.DYNAMIC_DRAW,i=new Uint32Array(this.fillPointer/3);for(let t=0;t<this.fillPointer;t+=3)i[t/3]=this._cpu.array[t];return b.g.createIndex(t,e,i)}}var w=i(5544),T=i(81438);class P{constructor(t,e){if(this._bufferPool=t,this._layout=e,this._invalidatedGeometry=!1,this._invalidatedCompute=!1,this._position=this._layout.attributes.find((t=>"pos"===t.name||"position"===t.name)),!this._position)throw new Error("InternalError: Unable to find position attribute")}destroy(){this._indexBuffer=(0,y.pR)(this._indexBuffer),this._vertexBuffer=(0,y.pR)(this._vertexBuffer),this._computeVAO?.disposeVAOOnly(),this._geometryVAO?.disposeVAOOnly()}get layout(){return this._layout}getDrawArgs(t,e,i,n){return n?{primitive:d.WR.POINTS,count:e/3,offset:i/3}:{primitive:t,count:e,offset:i}}getAttributePrecisionPackFactors(){const t={};for(const e of this.layout.attributes)e.packPrecisionFactor&&(t[e.name]=e.packPrecisionFactor);return t}getDebugVertexInfo(t=!1,e){if(!this._vertexBuffer)return null;const i=this._layout,n=i.stride,r=this._vertexBuffer.getView(0,this._vertexBuffer.byteSize),s=[];if(t)if(null==e)console.log("must provide location info to see compute attributes");else for(const t of i.attributes){const i=e.computeAttributeMap[t.name];null!=i&&2===i.length&&(s.push({...t,name:i[0],offset:t.offset+n}),s.push({...t,name:i[1],offset:t.offset+2*n}))}const o=new DataView(r.slice().buffer);let a=r.byteLength/n;t&&(a=this._indexBuffer.fillPointer/3);const l=this._indexBuffer.getView(0,this._indexBuffer.byteSize);let u=0;const c=[];for(let e=0;e<a;e++){t&&(u=l[3*e]*n);const r={};for(const t of[...i.attributes,...s]){let e=`${t.offset} ${t.name}`,i=(0,w.q)(o,t,u);if(t.packPrecisionFactor)if(e+=` (precision: ${t.packPrecisionFactor})`,"number"==typeof i)i/=t.packPrecisionFactor;else for(let e=0;e<i.length;e++)i[e]/=t.packPrecisionFactor;r[e]=i}u+=n,c.push(r)}return{vertices:c,layout:i}}_ensure(t,e){if(this._vertexBuffer&&this._indexBuffer)this._indexBuffer.ensure(Math.max(t,1e3)),this._vertexBuffer.ensure(Math.max(e,1e3));else{const i=this._layout.stride/Uint32Array.BYTES_PER_ELEMENT;this._indexBuffer=new S("index",Math.max(t,1e3),1,this._bufferPool),this._vertexBuffer=new S("vertex",Math.max(e,1e3),i,this._bufferPool)}}append(t){const e=t.layout.stride,i=t.indices.byteLength/Uint32Array.BYTES_PER_ELEMENT,n=t.vertices.byteLength/e;this._ensure(i,n);const{vertices:r,indices:s}=t,o=this._vertexBuffer.insert(r,0,r.byteLength/e,0);return{vertexFrom:o,indexFrom:this._indexBuffer.insert(s,0,s.byteLength/4,o)}}copyRecordFrom(t,e,i,n){const{indexStart:r,indexCount:s,vertexStart:o,vertexCount:a}=e;this._ensure(s,a);const l=t._position,u=i*(l.packPrecisionFactor??1),c=n*(l.packPrecisionFactor??1),h=l.offset,d=(0,v.M9)(u,c),f=this._vertexBuffer.copyFrom(t._vertexBuffer,o,a,d,h),p=this._indexBuffer.copyFrom(t._indexBuffer,r,s,f-o,0),_=e.clone();return _.vertexStart=f,_.indexStart=p,_.overlaps=0,_}remove(t,e,i,n){this._indexBuffer.free(t,e),this._vertexBuffer.free(i,n)}upload(){this._invalidatedGeometry=!0,this._invalidatedCompute=!0}getGeometryVAO(t,e){if(!this._vertexBuffer||!this._indexBuffer||!this._vertexBuffer.bufferSize)return null;if(this._invalidatedGeometry){(this._vertexBuffer.invalidated||this._indexBuffer.invalidated)&&(this._vertexBuffer.invalidate(),this._indexBuffer.invalidate(),this._geometryVAO?.disposeVAOOnly(),this._geometryVAO=null),this._vertexBuffer.upload(),this._indexBuffer.upload();const i=this._indexBuffer.getGPUBuffer(t,!1),n=this._vertexBuffer.getGPUBuffer(t);this._geometryVAO||(this._geometryVAO=new T.Z(t,e.locations,function(t,e){const i=t.attributes.filter((t=>e.locations.has(t.name))).map((e=>({name:e.name,type:e.type,count:e.count,divisor:0,normalized:e.normalized??!1,offset:e.offset,stride:t.stride})));return new Map([["geometry",i]])}(this.layout,e),new Map([["geometry",n]]),i)),this._invalidatedGeometry=!1}return this._geometryVAO}getComputeVAO(t,e){if(!this._vertexBuffer||!this._indexBuffer||!this._vertexBuffer.bufferSize)return null;if(this._invalidatedCompute){(this._vertexBuffer.invalidated||this._indexBuffer.invalidatedComputeBuffer)&&(this._vertexBuffer.invalidate(),this._indexBuffer.invalidate(),this._computeVAO?.disposeVAOOnly(),this._computeVAO=null),this._vertexBuffer.upload(),this._indexBuffer.upload();const i=this._indexBuffer.getGPUBuffer(t,!0),n=this._vertexBuffer.getGPUBuffer(t);this._computeVAO||(this._computeVAO=new T.Z(t,e.locations,function(t,e){const i=[],n=t.attributes.filter((t=>e.locations.has(t.name)));for(const r of n){i.push({name:r.name,type:r.type,count:r.count,divisor:0,normalized:r.normalized??!1,offset:r.offset,stride:t.stride});const n=e.computeAttributeMap[r.name];null!=n&&2===n.length&&(i.push({name:n[0],count:r.count,divisor:0,type:r.type,normalized:r.normalized??!1,offset:r.offset+t.stride,stride:t.stride}),i.push({name:n[1],count:r.count,divisor:0,type:r.type,normalized:r.normalized??!1,offset:r.offset+2*t.stride,stride:t.stride}))}return new Map([["geometry",i]])}(this.layout,e),new Map([["geometry",n]]),i),this._invalidatedCompute=!1)}return this._computeVAO}get memoryStats(){return{bytesUsed:this._vertexBuffer.memoryStats.bytesUsed+this._indexBuffer.memoryStats.bytesUsed,bytesReserved:this._vertexBuffer.memoryStats.bytesReserved+this._indexBuffer.memoryStats.bytesReserved,vertex:this._vertexBuffer.memoryStats,index:this._indexBuffer.memoryStats}}reshuffle(t){this._vertexBuffer&&this._vertexBuffer.reshuffle(t.vertex.count,t.vertex.operations),this._indexBuffer&&this._indexBuffer.reshuffle(t.index.count,t.index.operations)}}class I{constructor(t){this._pos=0,this._buffer=t,this._i32View=new Int32Array(this._buffer),this._f32View=new Float32Array(this._buffer)}readInt32(){return this._i32View[this._pos++]}readF32(){return this._f32View[this._pos++]}}var M=i(24964);function A(t){return t?{entities:(0,M._)(new I(t.entities),l.A),vertexData:t.data.map(C)}:null}function C(t){const e=t.layout.stride,i=new DataView(t.vertices),n=[],r=t.vertices.byteLength/e;let s=0;for(let o=0;o<r;o++){const r={};for(const e of t.layout.attributes){let t=`${e.offset} ${e.name}`,n=(0,w.q)(i,e,s);if(e.packPrecisionFactor)if(t+=` (precision: ${e.packPrecisionFactor})`,"number"==typeof n)n/=e.packPrecisionFactor;else for(let t=0;t<n.length;t++)n[t]/=e.packPrecisionFactor;r[t]=n}s+=e,n.push(r)}return{vertices:n,layout:t.layout}}let E=0;class R extends o.u{constructor(t,e,i,n,r=!1){super(t,e,i,n),this._meshes=new Map,this._entities=[],this._invalidated=!1,this._nextUploadAllowed=!1,this.tileAge=E++,this._metrics=[],this._entityIds=new Set,this._entityIdsFromBuffer=new Set,this._attributeEpoch=0,this._encounteredEnd=!1,this._objectIdMap=null,this.visible=!0,this.transforms.labelMat2d=(0,s.vt)(),this.enableDeferredUploads=r}destroy(){super.destroy(),this.clear()}clear(){for(const t of this._meshes.values())t.destroy();this._meshes.clear(),this._entities=[],this._metrics=[],this._displayList=null,this._invalidated=!0,this._entityIds.clear(),this._nextUploadAllowed=!0}beforeRender(t){super.beforeRender(t),this._needsReshuffle&&t.reshuffleManager.schedule(this)}tryReady(t){const e=this._invalidated&&!this._uploadAllowed;return!(this.isReady||e||!this._encounteredEnd||!(t>=this._attributeEpoch)||((0,n.A)("esri-2d-update-debug")&&console.debug(`Tile[${this.key.id}] FeatureTile.ready [epoch=${t}]`),this.ready(),this.requestRender(),0))}get labelMetrics(){return this._metrics}get hasData(){return!!this._meshes.size}get hasAnimations(){return!!this._objectIdMap}get needsUpload(){return this._invalidated}get _uploadAllowed(){return!this.enableDeferredUploads||this._nextUploadAllowed}upload(){this._nextUploadAllowed=!0}getDisplayList(t,e){if(this._uploadAllowed&&this._invalidated){this._entities.sort(((t,e)=>{const i=e.sortKey,n=t.sortKey;return n===i?t.id-e.id:n-i})),e===u.ch.BATCHING&&this.reshuffle(!0),this._displayList=_.fromDisplayEntities(this._entities,this,t,e);for(const t of this._meshes.values())t.upload();this.debugInfo.display.length=this._displayList.length,this.debugInfo.display.minOrderedLength=this._displayList.minOrderedLength,this.debugInfo.display.minUnorderedLength=this._displayList.minUnorderedLength,this.requestRender(),this._invalidated=!1,this._nextUploadAllowed=!1}return this._displayList}getMesh(t){if(!this._meshes.has(t))throw new Error(`InternalError: Unable to find VAO for instance: ${t}`);return this._meshes.get(t)}getSortKeys(t){const e=new Map;for(const{id:i,sortKey:n}of this._entities)if(t.has(i)&&e.set(i,n),e.size===t.size)break;return e}onMessage(t){if(t.objectIdMap)for(const e in t.objectIdMap)this._objectIdMap||(this._objectIdMap={}),this._objectIdMap[e]=t.objectIdMap[e];switch(t.type){case"append":this._onAppendMessage(t);break;case"update":this._onUpdateMessage(t)}if(this._aggregateMemoryStats(),this.requestRender(),t.end){if((0,n.A)("esri-2d-update-debug")&&console.debug(`Tile[${this.key.id}] FeatureTile.end [epoch=${t.attributeEpoch}]`),!t.attributeEpoch)throw new Error("InternalError: Attribute epoch not defined.");this._attributeEpoch=t.attributeEpoch,this._encounteredEnd=!0}}_onAppendMessage(t){if((0,n.A)("esri-2d-update-debug")&&console.debug(`Tile[${this.key.id}] FeatureTile.append`,{append:A(t?.append)}),t.clear&&this.clear(),!t.append)return;const e=(0,M._)(new I(t.append.entities),l.A);this._insert(e,t.append.data,!1)}_onUpdateMessage(t){(0,n.A)("esri-2d-update-debug")&&console.debug(`Tile[${this.key.id}] FeatureTile.update`,{isPixelBuffer:t.isPixelBuffer,modify:A(t.modify),remove:t.remove});const e=(0,M._)(new I(t.modify.entities),l.A),i=e.map((t=>t.id)),r=t.isPixelBuffer??!1,s=[...t.remove,...i];r?this._removeByIdsFromBuffer(s):this._removeByIds(s),this._insert(e,t.modify.data,r)}reshuffle(t=!1){if(this.destroyed)return;const e=new Map;for(const i of this._entities)for(const n of i.records){const i=this._meshes.get(n.instanceId);let r=e.get(i);r||(r=new m(t),e.set(i,r)),r.copyRecord(n)}for(const[t,i]of e)t.reshuffle(i);this._invalidated=!0,this._aggregateMemoryStats(),(0,n.A)("esri-2d-update-debug")&&r.A.getLogger("esri.views.2d.engine.webgl.FeatureTile").info(`Tile ${this.key.id} was reshuffled.`)}copyPixelBufferedEntitesFrom(t,e,i,n){const r=i*a.CQ,s=n*a.CQ;for(const i of t._entities){let n=null;for(const o of i.records)if(o.overlaps&e){const e=t.getMesh(o.instanceId),a=this._ensureMesh(o.instanceId,e.layout).copyRecordFrom(e,o,r,s);n||(n=new l.A(i.id,i.sortKey),this._entityIdsFromBuffer.add(i.id),this._entities.push(n)),n.records.push(a)}}this._invalidated=!0}_ensureMesh(t,e){return this._meshes.has(t)||this._meshes.set(t,new P(this._stage.bufferPool,e)),this._meshes.get(t)}_insert(t,e,i){if(!t.length)return;this._removeDuplicatedBufferedEntites(t);const n=this._insertVertexData(e);for(const e of t){for(const t of e.records)t.updateBaseOffsets(n.get(t.instanceId));i?this._tryInsertBufferedEntity(e):this._insertEntity(e)}this._invalidated=!0}_insertVertexData(t){const e=new Map;for(const i of t){const{instanceId:t,layout:n}=i,r=this._ensureMesh(t,n).append(i);if(i.metrics){const t=(0,M._)(new I(i.metrics),g.f)??[];this._metrics.push(...t)}e.set(t,r)}return e}_insertEntity(t){(0,n.A)("esri-2d-update-debug")&&this._entityIds.has(t.id)&&console.error(`Tile ${this.key.id} insertEnitty: Already have entityId ${t.id}`),this._entityIds.add(t.id),this._entities.push(t)}_tryInsertBufferedEntity(t){this._entityIds.has(t.id)?this._removeRecordsFromMesh(t.records):(this._entityIdsFromBuffer.add(t.id),this._entities.push(t))}_removeDuplicatedBufferedEntites(t){if(!this._entityIdsFromBuffer.size)return;const e=[];for(const i of t)this._entityIdsFromBuffer.has(i.id)&&e.push(i.id);this._removeByIds(e)}_removeByIdsFromBuffer(t){this._removeByIds(t.filter((t=>this._entityIdsFromBuffer.has(t))))}_removeByIds(t){if(0===t.length)return;const e=new Set(t),i=[];for(const t of this._entities)e.has(t.id)?this._remove(t):i.push(t);this._entities=i,this._invalidated=!0}_remove(t){this._removeRecordsFromMesh(t.records),this._entityIds.delete(t.id),this._entityIdsFromBuffer.delete(t.id);for(let e=this._metrics.length-1;e>=0;e--)this._metrics[e].entityTexel===t.id&&this._metrics.splice(e,1)}_removeRecordsFromMesh(t){for(const e of t){const{instanceId:t,indexStart:i,indexCount:n,vertexStart:r,vertexCount:s}=e;this._meshes.get(t)?.remove(i,n,r,s)}}_aggregateMemoryStats(){this.debugInfo.memory.bytesUsed=0,this.debugInfo.memory.bytesReserved=0;for(const t of this._meshes.values())this.debugInfo.memory.bytesUsed+=t.memoryStats.bytesUsed,this.debugInfo.memory.bytesReserved+=t.memoryStats.bytesReserved}get _needsReshuffle(){if(this.destroyed)return!1;const{bytesUsed:t,bytesReserved:e}=this.debugInfo.memory,i=t/e,{minOrderedLength:n,length:r}=this.debugInfo.display;return e>a._x&&i<a.eI||r>a.Xh&&n/r<a.Vl}get entityIds(){return this._objectIdMap?this._entities.map((({id:t})=>({objectId:this._objectIdMap[t],displayId:t}))):[]}}},36753:function(t,e,i){i.d(e,{p6:function(){return o},wV:function(){return s}}),Math.PI;const n=256/360,r=1/Math.LN2;function s(t){return function(t,e){return(t%=e)>=0?t:t+e}(t*n,256)}function o(t){return Math.log(t)*r}},28055:function(t,e,i){i.d(e,{W:function(){return a},o:function(){return u}});var n=i(58941),r=i(95929),s=i(83258);const o=(0,n.A)("esri-2d-log-allocations");class a{static create(t,e){const i=e.acquireUint32Array(t);return new a(i,e)}constructor(t,e){this._array=t,this._pool=e}get array(){return this._array}get length(){return this._array.length}getUint32View(t,e){return new Uint32Array(this._array.buffer,t+this._array.byteOffset,e)}expand(t){if(t<=this._array.byteLength)return;const e=this._pool.acquireUint32Array(t);e.set(this._array),this._pool.releaseUint32Array(this._array),this._array=e}destroy(){this._pool.releaseUint32Array(this._array)}}class l{constructor(){this._data=new ArrayBuffer(l.BYTE_LENGTH),this._freeList=new s.P({start:0,end:this._data.byteLength})}static get BYTE_LENGTH(){return 16e6}get buffer(){return this._data}acquireUint32Array(t){const e=this._freeList.firstFit(t);return null==e?null:new Uint32Array(this._data,e,t/Uint32Array.BYTES_PER_ELEMENT)}releaseUint32Array(t){this._freeList.free(t.byteOffset,t.byteLength)}}class u{constructor(){this._pages=[],this._pagesByBuffer=new Map,this._bytesAllocated=0}destroy(){this._pages=[],this._pagesByBuffer=null}get _bytesTotal(){return this._pages.length*l.BYTE_LENGTH}acquireUint32Array(t){if(this._bytesAllocated+=t,o&&console.log(`Allocating ${t}, (${this._bytesAllocated} / ${this._bytesTotal})`),t>=l.BYTE_LENGTH)return new Uint32Array(t/Uint32Array.BYTES_PER_ELEMENT);for(const e of this._pages){const i=e.acquireUint32Array(t);if(null!=i)return i}const e=this._addPage().acquireUint32Array(t);return(0,r.Lw)(e,"Expected to allocate page"),e}releaseUint32Array(t){this._bytesAllocated-=t.byteLength,o&&console.log(`Freeing ${t.byteLength}, (${this._bytesAllocated} / ${this._bytesTotal})`);const e=this._pagesByBuffer.get(t.buffer);e&&e.releaseUint32Array(t)}_addPage(){const t=new l;return this._pages.push(t),this._pagesByBuffer.set(t.buffer,t),t}}},54904:function(t,e,i){i.d(e,{A:function(){return n}});class n{constructor(t=0,e=0,i=0,n=0){this.x=t,this.y=e,this.width=i,this.height=n}get isEmpty(){return this.width<=0||this.height<=0}union(t){this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.width=Math.max(this.width,t.width),this.height=Math.max(this.height,t.height)}}},82087:function(t,e,i){i.d(e,{A:function(){return u}});var n=i(58941),r=i(28230),s=i(57672),o=i(829),a=i(55382);const l=(t,e)=>t.key.level-e.key.level!=0?t.key.level-e.key.level:t.key.row-e.key.row!=0?t.key.row-e.key.row:t.key.col-e.key.col;class u extends s.A{constructor(t){super(),this.tileInfoView=t,this.sortFunction=l}renderChildren(t){this.setStencilReference(t),super.renderChildren(t)}createRenderParams(t){const{state:e}=t,i=super.createRenderParams(t);return i.requiredLevel=this.tileInfoView.getClosestInfoForScale(e.scale).level,i.displayLevel=this.tileInfoView.tileInfo.scaleToZoom(e.scale),i}prepareRenderPasses(t){const e=super.prepareRenderPasses(t);return e.push(t.registerRenderPass({name:"stencil",brushes:[o.A],drawPhase:r.S5.DEBUG|r.S5.MAP|r.S5.HIGHLIGHT|r.S5.LABEL,target:()=>this.getStencilTarget()})),(0,n.A)("esri-tiles-debug")&&e.push(t.registerRenderPass({name:"tileInfo",brushes:[a.A],drawPhase:r.S5.DEBUG,target:()=>this.children})),e}getStencilTarget(){return this.children}setStencilReference(t){let e=1;for(const t of this.children)t.stencilRef=e++}}},54631:function(t,e,i){i.d(e,{Y:function(){return o}});var n=i(44705),r=i(77515),s=i(36008);class o extends r.q{constructor(t,e,i,n,r,o,a=r,l=o){super(),this.tileDebugInfoTexture=null,this.debugInfo={display:{length:0,minOrderedLength:0,minUnorderedLength:0,triangleCount:0},memory:{bytesUsed:0,bytesReserved:0}},this._destroyed=!1,this.key=new s.A(t),this.resolution=e,this.x=i,this.y=n,this.width=r,this.height=o,this.rangeX=a,this.rangeY=l}destroy(){this.tileDebugInfoTexture&&(this.tileDebugInfoTexture.dispose(),this.tileDebugInfoTexture=null),this._destroyed=!0}get debugSlot(){let t=this;for(;t.parent!==this._stage;){if(!t.parent)return 0;t=t.parent}return this._stage.children.indexOf(t)}setTransform(t){const e=this.resolution/(t.resolution*t.pixelRatio),i=this.transforms.tileMat3,[r,s]=t.toScreenNoRotation([0,0],[this.x,this.y]),o=this.width/this.rangeX*e,a=this.height/this.rangeY*e;(0,n.hZ)(i,o,0,0,0,a,0,r,s,1),(0,n.lw)(this.transforms.displayViewScreenMat3,t.displayViewMat3,i)}get destroyed(){return this._destroyed}}},88413:function(t,e,i){i.d(e,{AV:function(){return h},ES:function(){return m},IF:function(){return x},Qz:function(){return d},UE:function(){return g},bX:function(){return y},sZ:function(){return v}});var n=i(39819),r=i(40633),s=(i(33389),i(13798),i(58941),i(41835),i(85456)),o=(i(96402),i(69452),i(48347)),a=i(12285),l=i(10956),u=i(3817);const c=()=>r.A.getLogger("esri.views.2d.engine.webgl.Utils");function h(t){switch(t){case s.ld.UNSIGNED_BYTE:return 1;case s.ld.UNSIGNED_SHORT_4_4_4_4:return 2;case s.ld.FLOAT:return 4;default:return void c().error(new n.A("webgl-utils",`Unable to handle type ${t}`))}}function d(t){switch(t){case s.ld.UNSIGNED_BYTE:return Uint8Array;case s.ld.UNSIGNED_SHORT_4_4_4_4:return Uint16Array;case s.ld.FLOAT:return Float32Array;default:return void c().error(new n.A("webgl-utils",`Unable to handle type ${t}`))}}const f=t=>{const e=new Map;for(const i in t)for(const n of t[i])e.set(n.name,n.location);return e},p=t=>{const e={};return t.forEach(((t,i)=>e[i]=t?.length?t[0].stride:0)),e},_=new Map,m=(t,e)=>{if(!_.has(t)){const i=function(t){const e=new Map;for(const i in t){const n=t[i];let r=0;e.set(i,n.map((t=>{const e=new u._(t.name,t.count,t.type,r,0,t.normalized||!1);return r+=t.count*(0,o._)(t.type),e}))),e.get(i).forEach((t=>t.stride=r))}return e}(e),n={strides:p(i),bufferLayouts:i,attributes:f(e)};_.set(t,n)}return _.get(t)},g=t=>t.includes("data:image/svg+xml");function y(t){const e=[];for(let i=0;i<t.length;i++)e.push(t.charCodeAt(i));return e}function v(t,e,i){const n=new l.R(e.width,e.height);return n.dataType=e.dataType,e.depth&&(n.depth=e.depth),e.flipped&&(n.flipped=e.flipped),e.hasMipmap&&(n.hasMipmap=e.hasMipmap),n.internalFormat=e.internalFormat,e.isImmutable&&(n.isImmutable=e.isImmutable),e.isOpaque&&(n.isOpaque=e.isOpaque),e.maxAnisotropy&&(n.maxAnisotropy=e.maxAnisotropy),n.pixelFormat=e.pixelFormat,e.preMultiplyAlpha&&(n.preMultiplyAlpha=e.preMultiplyAlpha),e.samplingMode&&(n.samplingMode=e.samplingMode),e.target&&(n.target=e.target),n.uniform=e.uniform,e.unpackAlignment&&(n.unpackAlignment=e.unpackAlignment),e.wrapMode&&(n.wrapMode=e.wrapMode),new a.g(t,n,i)}function x(t){return"url"in t&&"urlHash"in t?{...t,url:""}:t}},77416:function(t,e,i){i.d(e,{A:function(){return l}});var n=i(25731),r=i(86305),s=i(85456),o=i(81438),a=i(3817);class l{constructor(t,e){this._rctx=t,this._attributes=[{name:"position",offset:0,type:s.pe.SHORT,count:2}],this.layout={hash:(0,n.hU)(this._attributes),attributes:this._attributes,stride:4},this._vertexBuffer=r.g.createVertex(t,s._U.STATIC_DRAW,new Uint16Array(e)),this._vao=new o.Z(t,new Map([["a_position",0]]),new Map([["geometry",[new a._("a_position",2,s.pe.SHORT,0,4)]]]),new Map([["geometry",this._vertexBuffer]])),this._count=e.length/2}bind(){this._rctx.bindVAO(this._vao)}unbind(){this._rctx.bindVAO(null)}dispose(){this._vao.dispose()}draw(){this._rctx.bindVAO(this._vao),this._rctx.drawArrays(s.WR.TRIANGLE_STRIP,0,this._count)}}},57672:function(t,e,i){i.d(e,{A:function(){return P}}),i(58941);var n=i(80708),r=i(7965),s=i(39819),o=i(40633),a=i(28181),l=i(25090),u=i(77515),c=i(59122),h=i(13786),d=i(1932),f=i(58081),p=i(76613),_=i(85475),m=i(86305),g=i(85456);const y=(t,e,i,n)=>{let r=0;for(let n=1;n<i;n++){const i=t[2*(e+n-1)],s=t[2*(e+n-1)+1];r+=(t[2*(e+n)]-i)*(t[2*(e+n)+1]+s)}return n?r>0:r<0},v=({coords:t,lengths:e},i)=>{const n=[];for(let r=0,s=0;r<e.length;s+=e[r],r+=1){const o=s,a=[];for(;r<e.length-1&&y(t,s+e[r],e[r+1],i);r+=1,s+=e[r])a.push(s+e[r]-o);const l=t.slice(2*o,2*(s+e[r])),u=(0,c.e)(l,a,2);for(const t of u)n.push(t+o)}return n};class x{constructor(t,e,i,n=!1){this._cache={},this.vertices=t,this.indices=e,this.primitiveType=i,this.isMapSpace=n}static fromPath(t){const e=(0,f.eU)(new p.A,t.path,!1,!1),i=e.coords,n=new Uint32Array(v(e,!0)),r=new Uint32Array(i.length/2);for(let t=0;t<r.length;t++)r[t]=(0,_.M9)(Math.floor(i[2*t]),Math.floor(i[2*t+1]));return new x({geometry:r},n,g.WR.TRIANGLES)}static fromGeometry(t,e){const i=e.geometry?.type;switch(i){case"polygon":return x.fromPolygon(t,e.geometry);case"extent":return x.fromMapExtent(t,e.geometry);default:return o.A.getLogger("esri.views.2d.engine.webgl.Mesh2D").error(new s.A("mapview-bad-type",`Unable to create a mesh from type ${i}`,e)),x.fromScreenExtent({xmin:0,ymin:0,xmax:1,ymax:1})}}static fromPolygon(t,e){const i=(0,f.Ye)(new p.A,e,!1,!1),n=i.coords,r=new Uint32Array(v(i,!1)),s=new Uint32Array(n.length/2),o=(0,d.vt)(),a=(0,d.vt)();for(let e=0;e<s.length;e++)(0,h.hZ)(o,n[2*e],n[2*e+1]),t.toScreen(a,o),s[e]=(0,_.M9)(Math.floor(a[0]),Math.floor(a[1]));return new x({geometry:s},r,g.WR.TRIANGLES,!0)}static fromScreenExtent({xmin:t,xmax:e,ymin:i,ymax:n}){const r={geometry:new Uint32Array([(0,_.M9)(t,i),(0,_.M9)(e,i),(0,_.M9)(t,n),(0,_.M9)(t,n),(0,_.M9)(e,i),(0,_.M9)(e,n)])},s=new Uint32Array([0,1,2,3,4,5]);return new x(r,s,g.WR.TRIANGLES)}static fromMapExtent(t,e){const[i,n]=t.toScreen([0,0],[e.xmin,e.ymin]),[r,s]=t.toScreen([0,0],[e.xmax,e.ymax]),o={geometry:new Uint32Array([(0,_.M9)(i,n),(0,_.M9)(r,n),(0,_.M9)(i,s),(0,_.M9)(i,s),(0,_.M9)(r,n),(0,_.M9)(r,s)])},a=new Uint32Array([0,1,2,3,4,5]);return new x(o,a,g.WR.TRIANGLES)}destroy(){null!=this._cache.indexBuffer&&this._cache.indexBuffer.dispose(),this._cache.vertexBuffers?.forEach((t=>t?.dispose())),this._cache.indexBuffer=this._cache.vertexBuffers=null}get elementType(){return(()=>{switch(this.indices.BYTES_PER_ELEMENT){case 1:return g.pe.UNSIGNED_BYTE;case 2:return g.pe.UNSIGNED_SHORT;case 4:return g.pe.UNSIGNED_INT;default:throw new s.A("Cannot get DataType of array")}})()}getIndexBuffer(t,e=g._U.STATIC_DRAW){return this._cache.indexBuffer??=m.g.createIndex(t,e,this.indices),this._cache.indexBuffer}getVertexBuffers(t,e=g._U.STATIC_DRAW){return this._cache.vertexBuffers??=new Map(Object.keys(this.vertices).reduce(((i,n)=>(i.push([n,m.g.createVertex(t,e,this.vertices[n])]),i)),new Array)),this._cache.vertexBuffers}}var b=i(57008),S=i(81438);class w extends u.q{constructor(t,e){super(),this._clip=e,this._cache={},this.stage=t,this._handle=(0,a.watch)((()=>e.version),(()=>this._invalidate())),this.ready()}static fromClipArea(t,e){return new w(t,e)}_destroyGL(){null!=this._cache.mesh&&(this._cache.mesh.destroy(),this._cache.mesh=null),null!=this._cache.vao&&(this._cache.vao.dispose(),this._cache.vao=null)}destroy(){this._destroyGL(),this._handle.remove()}getVAO(t,e,i,n){const[r,s]=e.size;if("geometry"!==this._clip.type&&this._lastWidth===r&&this._lastHeight===s||(this._lastWidth=r,this._lastHeight=s,this._destroyGL()),null==this._cache.vao){const r=this._createMesh(e,this._clip),s=r.getIndexBuffer(t),o=r.getVertexBuffers(t);this._cache.mesh=r,this._cache.vao=new S.Z(t,i,n,o,s)}return this._cache.vao}_createTransforms(){return{displayViewScreenMat3:(0,l.vt)()}}_invalidate(){this._destroyGL(),this.requestRender()}_createMesh(t,e){switch(e.type){case"rect":return x.fromScreenExtent((0,b.p)(e,t.size[0],t.size[1]));case"path":return x.fromPath(e);case"geometry":return x.fromGeometry(t,e);default:return o.A.getLogger("esri.views.2d.engine.webgl.ClippingInfo").error(new s.A("mapview-bad-type","Unable to create ClippingInfo mesh from clip of type: ${clip.type}")),x.fromScreenExtent({xmin:0,ymin:0,xmax:1,ymax:1})}}}var T=i(28230);class P extends r.m{set clips(t){super.clips=t,this._updateClippingInfo(t)}renderChildren(t){t.painter.setPipelineState(null),null==this._renderPasses&&(this._renderPasses=this.prepareRenderPasses(t.painter));for(const e of this._renderPasses)try{e.render(t)}catch(t){}}prepareRenderPasses(t){return[t.registerRenderPass({name:"clip",brushes:[n.d.clip],target:()=>this._clippingInfos,drawPhase:T.S5.MAP|T.S5.LABEL|T.S5.LABEL_ALPHA|T.S5.DEBUG|T.S5.HIGHLIGHT})]}_updateClippingInfo(t){null!=this._clippingInfos&&(this._clippingInfos.forEach((t=>t.destroy())),this._clippingInfos=null),null!=t&&t.length&&(this._clippingInfos=t.items.map((t=>w.fromClipArea(this.stage,t)))),this.requestRender()}}},96564:function(t,e,i){i.d(e,{Dy:function(){return d},UD:function(){return u},fO:function(){return c},gy:function(){return o},iT:function(){return h},xy:function(){return l}});var n=i(40633);const r=()=>n.A.getLogger("esri.views.2d.engine.webgl.alignmentUtils");var s,o,a;function l(t){if(!t)return s.Center;switch(t){case"Left":case"left":return s.Left;case"Right":case"right":return s.Right;case"Justify":return r().warnOnce("Horizontal alignment 'justify' is not implemented. Falling back to 'center'."),s.Center;case"Center":case"center":return s.Center}}function u(t){if(!t)return o.Center;switch(t){case"Top":case"top":return o.Top;case"Center":case"middle":return o.Center;case"Baseline":case"baseline":return o.Baseline;case"Bottom":case"bottom":return o.Bottom}}function c(t){switch(t){case"above-left":case"esriServerPointLabelPlacementAboveLeft":return["right","bottom"];case"above-center":case"above-along":case"esriServerPointLabelPlacementAboveCenter":case"esriServerLinePlacementAboveAlong":return["center","bottom"];case"above-right":case"esriServerPointLabelPlacementAboveRight":return["left","bottom"];case"center-left":case"esriServerPointLabelPlacementCenterLeft":return["right","middle"];case"center-center":case"center-along":case"esriServerPointLabelPlacementCenterCenter":case"esriServerLinePlacementCenterAlong":case"always-horizontal":case"esriServerPolygonPlacementAlwaysHorizontal":return["center","middle"];case"center-right":case"esriServerPointLabelPlacementCenterRight":return["left","middle"];case"below-left":case"esriServerPointLabelPlacementBelowLeft":return["right","top"];case"below-center":case"below-along":case"esriServerPointLabelPlacementBelowCenter":case"esriServerLinePlacementBelowAlong":return["center","top"];case"below-right":case"esriServerPointLabelPlacementBelowRight":return["left","top"];default:return console.debug(`Found invalid placement type ${t}`),["center","middle"]}}function h(t){switch(t){case s.Right:case"right":return-1;case s.Center:case"center":return 0;case s.Left:case"left":return 1;default:return console.debug(`Found invalid horizontal alignment ${t}`),0}}function d(t){switch(t){case o.Top:case"top":return 1;case o.Center:case"middle":return 0;case o.Bottom:case o.Baseline:case"baseline":case"bottom":return-1;default:return console.debug(`Found invalid vertical alignment ${t}`),0}}(a=s||(s={}))[a.Left=-1]="Left",a[a.Center=0]="Center",a[a.Right=1]="Right",function(t){t[t.Top=1]="Top",t[t.Center=0]="Center",t[t.Bottom=-1]="Bottom",t[t.Baseline=2]="Baseline"}(o||(o={}))},99121:function(t,e,i){var n;i.d(e,{DW:function(){return p},GA:function(){return h},mv:function(){return n}}),function(t){t.Local="Local",t.Global="Global"}(n||(n={}));class r{generateSource(t){const e=[];for(let i=1;i<this.length;i++)e.push(`vec4 atom${i} = texture(${t.animationTexture}, (pointer + 0.5) / size);`),e.push("pointer.x += 1.0;");for(let t=0;t<this.ins;t++)e.push("top--;"),e.push(`vec4 in${this.ins-t-1} = stack[top];`);for(let t=0;t<this.outs;t++)e.push(`vec4 out${t};`);const{microcode:i}=this;for(const t of i)e.push(t);for(let t=0;t<this.outs;t++)e.push(`stack[top] = out${t};`),e.push("top++;"),e.push(`if (top >= ${f}) { top = ${f-1}; }`);return e}}let s=128;function o(t){return[`float duration = clamp(${t.duration}, 0.05, 3600.0);`,`float startTimeOffset = ${t.startTimeOffset};`,`float repeatDelay = ${t.repeatDelay};`,`float timeOriginSelector = ${t.timeOriginSelector};`,`float repeatType = ${t.repeatType};`,`float easing = ${t.easing};`,`float playAnimation = ${t.playAnimation} * (1.0 - step(0.0, -${t.duration}));`,`float reverseAnimation = ${t.reverseAnimation};`,"float time = globalTime - (timeOriginSelector == 1.0 ? localTimeOrigin : 0.0);","time *= playAnimation;","time *= 1.0 - reverseAnimation * 2.0;","float period = duration + repeatDelay;","time += reverseAnimation == 1.0 ? (period - startTimeOffset - 0.001) : startTimeOffset + 0.001;","float omega = time / period;","float oi = floor(omega);","omega = repeatType == 1.0 || repeatType == 3.0 ? omega - oi : omega;","float of = omega * period;","of = (clamp(of, reverseAnimation * repeatDelay, period - (1.0 - reverseAnimation) * repeatDelay) - reverseAnimation * repeatDelay) / duration;","of = easing == 2.0 ? pow(of, 3.0) : of;","of = easing == 3.0 ? 1.0 - pow(1.0 - of, 3.0) : of;","of = easing == 4.0 ? of < 0.5 ? 4.0 * pow(of, 3.0) : 1.0 - pow(-2.0 * of + 2.0, 3.0) / 2.0 : of;","bool oscillate = repeatType == 3.0 && mod(oi, 2.0) == 1.0;",`${t.out} = oscillate ? 1.0 - of : of;`]}const a={Linear:1,EaseIn:2,EaseOut:3,EaseInOut:4},l={Loop:1,None:2,Oscillate:3},u={Local:1,Global:2};function c(t){const e=a[t.easing],i=l[t.repeatType],n=u[t.timeOriginSelector];return[[t.duration,t.startTimeOffset,t.repeatDelay,n],[i,e,t.playAnimation,t.reverseAnimation]]}const h={scalar:new class extends r{constructor(){super(...arguments),this.opcode=++s,this.length=1,this.ins=0,this.outs=1,this.microcode=["out0 = vec4(atom0.y, atom0.y, atom0.y, atom0.y);"]}encode(t){return[[this.opcode,t,0,0]]}},vector3:new class extends r{constructor(){super(...arguments),this.opcode=++s,this.length=1,this.ins=0,this.outs=1,this.microcode=["out0 = vec4(atom0.yzw, 0.0);"]}encode(t){return[[this.opcode,t[0]||0,t[1]||0,t[2]||0]]}},vector4:new class extends r{constructor(){super(...arguments),this.opcode=++s,this.length=2,this.ins=0,this.outs=1,this.microcode=["out0 = atom1;"]}encode(t){return[[this.opcode,0,0,0],t]}},animatedTransform:new class extends r{constructor(){super(...arguments),this.opcode=++s,this.length=10,this.ins=1,this.outs=1,this.microcode=["vec2 fromTranslation = atom1.xy;","vec2 toTranslation = atom1.zw;","float fromRotation = atom2.x;","float toRotation = atom2.y;","float fromScale = atom2.z;","float toScale = atom2.w;","bool relativeTranslation = atom9.x == 1.0;","bool absoluteScale = atom9.y == 1.0;","vec2 translationMultiplier = relativeTranslation ? pixelDimensions : vec2(1.0, 1.0);","float scaleDivisor = absoluteScale ? pixelDimensions.y : 1.0;","float fTranslation;","{",...o({duration:"atom3.x",startTimeOffset:"atom3.y",repeatDelay:"atom3.z",timeOriginSelector:"atom3.w",repeatType:"atom4.x",easing:"atom4.y",playAnimation:"atom4.z",reverseAnimation:"atom4.w",out:"fTranslation"}),"}","float fRotation;","{",...o({duration:"atom5.x",startTimeOffset:"atom5.y",repeatDelay:"atom5.z",timeOriginSelector:"atom5.w",repeatType:"atom6.x",easing:"atom6.y",playAnimation:"atom6.z",reverseAnimation:"atom6.w",out:"fRotation"}),"}","float fScale;","{",...o({duration:"atom7.x",startTimeOffset:"atom7.y",repeatDelay:"atom7.z",timeOriginSelector:"atom7.w",repeatType:"atom8.x",easing:"atom8.y",playAnimation:"atom8.z",reverseAnimation:"atom8.w",out:"fScale"}),"}","vec2 aTranslation = mix(fromTranslation, toTranslation, fTranslation);","float aRotation = mix(fromRotation, toRotation, fRotation);","float aScale = mix(fromScale, toScale, fScale);","vec2 pTranslation = in0.xy;","float pRotation = in0.z;","float pScale = in0.w;","aTranslation *= translationMultiplier;","aScale /= scaleDivisor;","float rotation = pRotation + aRotation;","float scale = pScale * aScale;","float sin1 = sin(pRotation);","float cos1 = cos(pRotation);","float s1 = pScale;","float x1 = pTranslation.x;","float y1 = pTranslation.y;","float x2 = aTranslation.x;","float y2 = aTranslation.y;","\n    vec2 translation = vec2(\n      cos1 * s1 * x2 - sin1 * s1 * y2 + x1,\n      sin1 * s1 * x2 + cos1 * s1 * y2 + y1\n    );\n    ","out0 = vec4(translation, rotation, scale);"]}encode(t){return[[this.opcode,0,0,0],[t.translation.from[0],t.translation.from[1],t.translation.to[0],t.translation.to[1]],[t.rotation.from,t.rotation.to,t.scale.from,t.scale.to],...c(t.translation.timing),...c(t.rotation.timing),...c(t.scale.timing),[t.relativeTranslation?1:0,t.absoluteScale?1:0,0,0]]}},animatedColor:new class extends r{constructor(){super(...arguments),this.opcode=++s,this.length=7,this.ins=1,this.outs=1,this.microcode=["float fromOpacity = atom0.y;","float toOpacity = atom0.z;","vec4 fromColor = atom1;","vec4 toColor = atom2;","float fColor;","{",...o({duration:"atom3.x",startTimeOffset:"atom3.y",repeatDelay:"atom3.z",timeOriginSelector:"atom3.w",repeatType:"atom4.x",easing:"atom4.y",playAnimation:"atom4.z",reverseAnimation:"atom4.w",out:"fColor"}),"}","float fOpacity;","{",...o({duration:"atom5.x",startTimeOffset:"atom5.y",repeatDelay:"atom5.z",timeOriginSelector:"atom5.w",repeatType:"atom6.x",easing:"atom6.y",playAnimation:"atom6.z",reverseAnimation:"atom6.w",out:"fOpacity"}),"}","vec4 aColor = mix(fromColor, toColor, fColor);","aColor.a *= mix(fromOpacity, toOpacity, fOpacity);","vec4 pColor = in0;","out0 = aColor * pColor;"]}encode(t){return[[this.opcode,t.opacity.from,t.opacity.to,0],[t.color.from[0],t.color.from[1],t.color.from[2],t.color.from[3]],[t.color.to[0],t.color.to[1],t.color.to[2],t.color.to[3]],...c(t.color.timing),...c(t.opacity.timing)]}},ret:new class extends r{constructor(){super(...arguments),this.opcode=++s,this.length=1,this.ins=0,this.outs=0,this.microcode=["break;"]}encode(){return[[this.opcode,0,0,0]]}}},d=40,f=4;function p(t){const e=[];e.push(`float globalTime = ${t.globalTime};`),e.push(`float localTimeOrigin = ${t.localTimeOrigin};`),e.push(`vec2 pointer = ${t.animationPointer};`),e.push(`vec2 size = ${t.animationTextureSize};`),e.push("int top = 0;"),e.push(`vec4 stack[${f}];`),e.push(`for (int counter = 0; counter < ${d}; counter++) {`),e.push(`vec4 atom0 = texture(${t.animationTexture}, (pointer + 0.5) / size);`),e.push("pointer.x += 1.0;"),e.push(`vec2 pixelDimensions = ${t.pixelDimensions};`),e.push("if (false) {");for(const i in h){const n=h[i];e.push(`} else if (int(atom0.x) == ${n.opcode}) {`);for(const i of n.generateSource(t))e.push(i)}return e.push("} // End if-else."),e.push("} // End for."),e.push(`${t.out} = top > 0 ? stack[top - 1] : vec4(0.0);`),e.join("\n")}},73936:function(t,e,i){i.d(e,{A:function(){return u}});var n=i(39686),r=i(77416),s=i(52937),o=i(85456);const a={nearest:{defines:[],samplingMode:o.Cj.NEAREST,mips:!1},bilinear:{defines:[],samplingMode:o.Cj.LINEAR,mips:!1},bicubic:{defines:["bicubic"],samplingMode:o.Cj.LINEAR,mips:!1},trilinear:{defines:[],samplingMode:o.Cj.LINEAR_MIPMAP_LINEAR,mips:!0}},l=(t,e,i)=>{if("dynamic"===i.samplingMode){const{state:i}=t,n=e.resolution/e.pixelRatio/i.resolution,r=Math.round(t.pixelRatio)!==t.pixelRatio,s=n>1.05||n<.95;return i.rotation||s||r||e.isSourceScaled||e.rotation?a.bilinear:a.nearest}return a[i.samplingMode]};class u extends s.A{constructor(){super(...arguments),this._desc={vsPath:"raster/bitmap",fsPath:"raster/bitmap",attributes:new Map([["a_pos",0]])}}dispose(){this._quad&&this._quad.dispose()}prepareState({context:t}){t.setBlendingEnabled(!0),t.setColorMask(!0,!0,!0,!0),t.setStencilWriteMask(0),t.setStencilTestEnabled(!0)}draw(t,e){const{context:i,renderingOptions:s,painter:a,requestRender:u,allowDelayedRender:c}=t;if(!e.source||!e.isReady)return;const h=l(t,e,s),d=a.materialManager.getProgram(this._desc,h.defines);if(c&&null!=u&&!d.compiled)return void u();t.timeline.begin(this.name),"additive"===e.blendFunction?i.setBlendFunctionSeparate(o.dn.ONE,o.dn.ONE,o.dn.ONE,o.dn.ONE):i.setBlendFunctionSeparate(o.dn.ONE,o.dn.ONE_MINUS_SRC_ALPHA,o.dn.ONE,o.dn.ONE_MINUS_SRC_ALPHA),i.setStencilFunction(o.MT.EQUAL,e.stencilRef,255),this._quad||(this._quad=new r.A(i,[0,0,1,0,0,1,1,1]));const{coordScale:f,computedOpacity:p,transforms:_}=e;e.setSamplingProfile(h),e.bind(t.context,n.YS),i.useProgram(d),d.setUniformMatrix3fv("u_dvsMat3",_.displayViewScreenMat3),d.setUniform1i("u_texture",n.YS),d.setUniform2fv("u_coordScale",f),d.setUniform1f("u_opacity",p),this._quad.draw(),t.timeline.end(this.name)}}},52937:function(t,e,i){i.d(e,{A:function(){return n}});class n{constructor(){this.name=this.constructor.name||"UnnamedBrush",this.brushEffect=null}prepareState(t,e){}draw(t,e,i){}drawMany(t,e,i){for(const n of e)n.visible&&this.draw(t,n,i)}}},829:function(t,e,i){i.d(e,{A:function(){return h}});var n=i(43745),r=i(94860),s=i(52937),o=i(94020),a=i(86305),l=i(85456),u=i(10904),c=i(81438);class h extends s.A{constructor(){super(...arguments),this._color=(0,n.fA)(1,0,0,1),this._initialized=!1}dispose(){this._solidProgram&&(this._solidProgram.dispose(),this._solidProgram=null),this._solidVertexArrayObject&&(this._solidVertexArrayObject.dispose(),this._solidVertexArrayObject=null)}prepareState({context:t}){t.setDepthWriteEnabled(!1),t.setDepthTestEnabled(!1),t.setStencilTestEnabled(!0),t.setBlendingEnabled(!1),t.setColorMask(!1,!1,!1,!1),t.setStencilOp(l.eA.KEEP,l.eA.KEEP,l.eA.REPLACE),t.setStencilWriteMask(255)}draw(t,e){const{context:i,requestRender:n,allowDelayedRender:r}=t;this._initialized||this._initialize(i),!r||null==n||this._solidProgram.compiled?(i.setStencilFunctionSeparate(l.Y7.FRONT_AND_BACK,l.MT.GREATER,e.stencilRef,255),i.bindVAO(this._solidVertexArrayObject),i.useProgram(this._solidProgram),this._solidProgram.setUniformMatrix3fv("u_dvsMat3",e.transforms.displayViewScreenMat3),this._solidProgram.setUniform2fv("u_coord_range",[e.rangeX,e.rangeY]),this._solidProgram.setUniform1f("u_depth",0),this._solidProgram.setUniform4fv("u_color",this._color),i.drawArrays(l.WR.TRIANGLE_STRIP,0,4),i.bindVAO()):n()}_initialize(t){if(this._initialized)return!0;const e=(0,u.r)(t,o.T);if(!e)return!1;const i=new Int8Array([0,0,1,0,0,1,1,1]),n=a.g.createVertex(t,l._U.STATIC_DRAW,i),s=new c.Z(t,o.T.attributes,r.Pd,new Map([["geometry",n]]));return this._solidProgram=e,this._solidVertexArrayObject=s,this._initialized=!0,!0}}},55382:function(t,e,i){i.d(e,{A:function(){return m}});var n=i(43745),r=i(94860),s=i(27657),o=i(52937),a=i(94020),l=i(47272),u=i(86305),c=i(85456),h=i(10904),d=i(12285),f=i(10956),p=i(81438);const _=16;class m extends o.A{constructor(){super(...arguments),this._color=(0,n.fA)(1,0,0,1)}dispose(){this._outlineProgram?.dispose(),this._outlineProgram=null,this._tileInfoProgram?.dispose(),this._tileInfoProgram=null,this._outlineVertexArrayObject?.dispose(),this._outlineVertexArrayObject=null,this._tileInfoVertexArrayObject?.dispose(),this._tileInfoVertexArrayObject=null,this._ctx=null}prepareState({context:t}){t.setBlendingEnabled(!0),t.setBlendFunctionSeparate(c.dn.ONE,c.dn.ONE_MINUS_SRC_ALPHA,c.dn.ONE,c.dn.ONE_MINUS_SRC_ALPHA),t.setColorMask(!0,!0,!0,!0),t.setStencilWriteMask(0),t.setStencilTestEnabled(!1)}draw(t,e){const{context:i,requestRender:n,allowDelayedRender:r}=t;if(!e.isReady&&e instanceof s.R&&e.hasData)return;if(this._loadWGLResources(i),r&&null!=n&&(!this._outlineProgram.compiled||!this._tileInfoProgram.compiled))return void n();i.bindVAO(this._outlineVertexArrayObject),i.useProgram(this._outlineProgram),this._outlineProgram.setUniformMatrix3fv("u_dvsMat3",e.transforms.displayViewScreenMat3),this._outlineProgram.setUniform2f("u_coord_range",e.rangeX,e.rangeY),this._outlineProgram.setUniform1f("u_depth",0),this._outlineProgram.setUniform4fv("u_color",this._color),i.drawArrays(c.WR.LINE_STRIP,0,4);const o=this._getTexture(i,e);o?(i.bindVAO(this._tileInfoVertexArrayObject),i.useProgram(this._tileInfoProgram),i.bindTexture(o,0),this._tileInfoProgram.setUniformMatrix3fv("u_dvsMat3",e.transforms.displayViewScreenMat3),this._tileInfoProgram.setUniform1f("u_depth",0),this._tileInfoProgram.setUniform2f("u_coord_ratio",e.rangeX/e.width,e.rangeY/e.height),this._tileInfoProgram.setUniform2f("u_delta",0,0),this._tileInfoProgram.setUniform2f("u_dimensions",o.descriptor.width,o.descriptor.height),i.drawArrays(c.WR.TRIANGLE_STRIP,0,4),i.bindVAO()):i.bindVAO()}_loadWGLResources(t){if(this._outlineProgram&&this._tileInfoProgram)return;const e=(0,h.r)(t,a.T),i=(0,h.r)(t,l.H),n=new Int8Array([0,0,1,0,1,1,0,1]),s=u.g.createVertex(t,c._U.STATIC_DRAW,n),o=new p.Z(t,a.T.attributes,r.Pd,new Map([["geometry",s]])),d=new Int8Array([0,0,1,0,0,1,1,1]),f=u.g.createVertex(t,c._U.STATIC_DRAW,d),_=new p.Z(t,l.H.attributes,r.Pd,new Map([["geometry",f]]));this._outlineProgram=e,this._tileInfoProgram=i,this._outlineVertexArrayObject=o,this._tileInfoVertexArrayObject=_}_getTexture(t,e){if(!this._ctx){const t=document.createElement("canvas");t.width=512,t.height=512,this._ctx=t.getContext("2d")}if(!e.tileDebugInfoTexture){const i=new f.R;i.wrapMode=c.pF.CLAMP_TO_EDGE,i.samplingMode=c.Cj.LINEAR,i.isImmutable=!0,i.width=512,i.height=512,e.tileDebugInfoTexture=new d.g(t,i)}const i=this._ctx;i.clearRect(0,0,i.canvas.width,i.canvas.height),i.textAlign="left",i.textBaseline="top",i.font="14px sans-serif",i.lineWidth=2,i.fillStyle="white",i.strokeStyle="black";const{debugSlot:n}=e;let r=8+99.2*n;const s=`${n}) ${e.key.id} (${e.constructor.name})`;i.strokeText(s,8,r),i.fillText(s,8,r),r+=_;const{debugInfo:o}=e;if(o){const{length:t,minOrderedLength:e,minUnorderedLength:n,triangleCount:s}=o.display;if(t>0){const e=`Length: ${t}`;i.strokeText(e,8,r),i.fillText(e,8,r),r+=_}if(e){const t=`Min ordered length: ${e}`;i.strokeText(t,8,r),i.fillText(t,8,r),r+=_}if(n){const t=`Min unordered length: ${n}`;i.strokeText(t,8,r),i.fillText(t,8,r),r+=_}if(s>0){s>1e5&&(i.fillStyle="red",i.strokeStyle="white");const t=`Triangle count: ${s}`;i.strokeText(t,8,r),i.fillText(t,8,r),r+=_}const{bytesUsed:a,bytesReserved:l}=o.memory;if(i.fillStyle="white",i.strokeStyle="black",a>0||l>0){const t=`Memory usage: ${a} of ${l} bytes`;i.strokeText(t,8,r),i.fillText(t,8,r),r+=_}}return e.tileDebugInfoTexture.setData(i.canvas),e.tileDebugInfoTexture}}},87573:function(t,e,i){i.d(e,{A:function(){return r}});var n=i(14583);class r{constructor(t,e,i,r){this.transformedX=0,this.transformedY=0,this.center=(0,n.fA)(t,e),this.centerT=(0,n.vt)(),this.halfWidth=i/2,this.halfHeight=r/2,this.width=i,this.height=r}get x(){return this.center[0]}get y(){return this.center[1]}get blX(){return this.center[0]+this.halfWidth}get blY(){return this.center[1]+this.halfHeight}get trX(){return this.center[0]-this.halfWidth}get trY(){return this.center[1]-this.halfHeight}get xmin(){return this.x-this.halfWidth}get xmax(){return this.x+this.halfWidth}get ymin(){return this.y-this.halfHeight}get ymax(){return this.y+this.halfHeight}set x(t){this.center[0]=t}set y(t){this.center[1]=t}clone(){return new r(this.x,this.y,this.width,this.height)}serialize(t){return t.writeF32(this.center[0]),t.writeF32(this.center[1]),t.push(this.width),t.push(this.height),t}findCollisionDelta(t,e=4){const i=Math.abs(t.centerT[0]-this.centerT[0]),n=Math.abs(t.centerT[1]-this.centerT[1]),r=(t.halfWidth+this.halfWidth+e)/i,s=(t.halfHeight+this.halfHeight+e)/n,o=Math.min(r,s);return Math.log2(o)}extend(t){const e=Math.min(this.xmin,t.xmin),i=Math.min(this.ymin,t.ymin),n=Math.max(this.xmax,t.xmax)-e,r=Math.max(this.ymax,t.ymax)-i,s=e+n/2,o=i+r/2;this.width=n,this.height=r,this.halfWidth=n/2,this.halfHeight=r/2,this.x=s,this.y=o}static deserialize(t){const e=t.readF32(),i=t.readF32(),n=t.readInt32(),s=t.readInt32();return new r(e,i,n,s)}}},57650:function(t,e,i){i.d(e,{f:function(){return s}});var n=i(87573),r=i(24964);class s{constructor(t,e,i,n,r,s,o,a,l=[]){this.entityTexel=t,this.anchorX=e,this.anchorY=i,this.directionX=n,this.directionY=r,this.maxScale=s,this.minScale=o,this.referenceBounds=a,this.bounds=l}serialize(t){t.push(this.entityTexel),t.writeF32(this.anchorX),t.writeF32(this.anchorY),t.writeF32(this.directionX),t.writeF32(this.directionY),t.writeF32(this.maxScale),t.writeF32(this.minScale),null===this.referenceBounds?(t.writeF32(0),t.writeF32(0),t.writeF32(0)):(t.writeF32(this.referenceBounds.size),t.writeF32(this.referenceBounds.offsetX),t.writeF32(this.referenceBounds.offsetY)),(0,r.j)(t,this.bounds)}static deserialize(t){const e=t.readInt32(),i=t.readF32(),o=t.readF32(),a=t.readF32(),l=t.readF32(),u=t.readF32(),c=t.readF32(),h=t.readF32(),d=t.readF32(),f=t.readF32(),p=(0,r._)(t,n.A)??[];return new s(e,i,o,a,l,u,c,{size:h,offsetX:d,offsetY:f},p)}}},83258:function(t,e,i){i.d(e,{B:function(){return n},P:function(){return r}});class n{constructor(t){if(this.next=null,!Array.isArray(t))return void(this.data=t);this.data=t[0];let e=this;for(let i=1;i<t.length;i++)e.next=new n([t[i]]),e=e.next}*values(){let t=this;for(;t;)yield t.data,t=t.next}forEach(t){let e=this;for(;e;)t(e.data),e=e.next}get last(){return this.next?this.next.last:this}}class r{constructor(t){this._head=null,null!=t&&(this._head=new n(t))}get head(){return this._head}maxAvailableSpace(){if(null==this._head)return 0;let t=0;return this._head.forEach((e=>{const i=e.end-e.start;t=Math.max(t,i)})),t}firstFit(t){if(null==this._head)return null;let e=null,i=this._head;for(;i;){const n=i.data.end-i.data.start;if(n===t)return e?e.next=i.next:this._head=i.next,i.data.start;if(n>t){const e=i.data.start;return i.data.start+=t,e}e=i,i=i.next}return null}free(t,e){const i=t+e;if(null==this._head){const e=new n({start:t,end:i});return void(this._head=e)}if(i<=this._head.data.start){if(i===this._head.data.start)return void(this._head.data.start-=e);const r=new n({start:t,end:i});return r.next=this._head,void(this._head=r)}let r=this._head,s=r.next;for(;s;){if(s.data.start>=i){if(r.data.end===t){if(r.data.end+=e,r.data.end===s.data.start){const t=s.data.end-s.data.start;return r.data.end+=t,void(r.next=s.next)}return}if(s.data.start===i)return void(s.data.start-=e);const o=new n({start:t,end:i});return o.next=r.next,void(r.next=o)}r=s,s=s.next}if(t===r.data.end)return void(r.data.end+=e);const o=new n({start:t,end:i});r.next=o}clear(){this._head=null}}},80308:function(t,e,i){i.d(e,{U:function(){return a}});var n=i(46065),r=i(88231);class s{get length(){return this._pos}constructor(t,e){this._pos=0;const i=e?this._roundToNearest(e,t.BYTES_PER_ELEMENT):40;this._array=new ArrayBuffer(i),this._buffer=new t(this._array),this._ctor=t,this._i16View=new Int16Array(this._array)}_roundToNearest(t,e){const i=Math.round(t);return 1===e?i:i+(e-i%e)}_ensureSize(t){if(this._pos+t>=this._buffer.length){const e=this._roundToNearest(1.25*(this._array.byteLength+t*this._buffer.BYTES_PER_ELEMENT),this._buffer.BYTES_PER_ELEMENT),i=new ArrayBuffer(e),n=new this._ctor(i);n.set(this._buffer,0),this._array=i,this._buffer=n,this._i16View=new Int16Array(this._array)}}ensureSize(t){this._ensureSize(t)}writeF32(t){this._ensureSize(1);const e=this._pos;return new Float32Array(this._array,4*this._pos,1)[0]=t,this._pos++,e}push(t){this._ensureSize(1);const e=this._pos;return this._buffer[this._pos++]=t,e}writeFixed(t){this._buffer[this._pos++]=t}setValue(t,e){this._buffer[t]=e}i1616Add(t,e,i){this._i16View[2*t]+=e,this._i16View[2*t+1]+=i}getValue(t){return this._buffer[t]}getValueF32(t){return new Float32Array(this._array,4*t,1)[0]}incr(t){if(this._buffer.length<t)throw new Error("Increment index overflows the target buffer");this._buffer[t]++}decr(t){this._buffer[t]--}writeRegion(t){this._ensureSize(t.length);const e=this._pos;return this._buffer.set(t,this._pos),this._pos+=t.length,e}writeManyFrom(t,e,i){this._ensureSize(i-e);for(let n=e;n!==i;n++)this.writeFixed(t._buffer[n])}buffer(){const t=this._array.slice(0,4*this._pos);return this.destroy(),t}toArray(){return[...this._buffer]}seek(t){this._pos=t}destroy(){this._array=null,this._buffer=null}}class o{constructor(t,e,i=0){const n=6*i*Uint32Array.BYTES_PER_ELEMENT,r=4*i*e.stride,o=e.stride/4,a=e.attributes.find((t=>"pos"===t.name||"position"===t.name));if(!a)throw new Error("InternalError: Unable to find position attribute");this.layout={...e,position:a},this._indices=new s(Uint32Array,n),this._vertices=new s(Uint32Array,r),this._metrics=new s(Uint32Array,0),this._metricCountOffset=this._metrics.push(0),this._strideInt=o,this._instanceId=t}serialize(t){const e=this._indices.buffer(),i=this._vertices.buffer(),n=this._metrics.length?this._metrics.buffer():null;return t.push(e,i),{instanceId:this._instanceId,layout:this.layout,indices:e,vertices:i,metrics:n}}get strideInt(){return this._strideInt}get vertexCount(){return this._vertices.length/this._strideInt}get indexCount(){return this._indices.length}get indexWriter(){return this._indices}get vertexWriter(){return this._vertices}get metricWriter(){return this._metrics}vertexEnsureSize(t){this._vertices.ensureSize(t)}indexEnsureSize(t){this._indices.ensureSize(t)}writeIndex(t){this._indices.push(t)}writeVertex(t){this._vertices.push(t)}writeVertexRegion(t){this._vertices.writeRegion(t)}writeVertexF32(t){this._vertices.writeF32(t)}writeMetric(t){this._metrics.incr(this._metricCountOffset),t.serialize(this._metrics)}}class a{constructor(t,e=0){this._id=t,this._sizeHint=e,this._entityRecordCountOffset=0,this._entityCountOffset=0,this._entityIdIndex=0,this._entitySortKeyIndex=0,this._didEntityStart=!1,this._instanceIdToVertexData=new Map,this._recordIndexStart=0,this._recordIndexCount=0,this._recordVertexStart=0,this._recordVertexCount=0,this._current={metric:null,writer:null,start:0,sortKey:0,instanceId:0,layoutHash:0,indexStart:0,vertexStart:0,textureKey:0,metricBoxLenPointer:0},this._entities=new s(Uint32Array,this._sizeHint*n.A.byteSizeHint),this._entityCountOffset=this._entities.push(0)}get id(){return this._id}serialize(){const t=new Array,e=[],i=this._entities.buffer();for(const i of this._instanceIdToVertexData.values())e.push(i.serialize(t));return{message:{data:e,entities:i},transferList:t}}vertexCount(){return this._current.writer?.vertexCount??0}indexCount(){return this._current.writer?.indexCount??0}vertexEnsureSize(t){this._current.writer.vertexEnsureSize(t)}indexEnsureSize(t){this._current.writer.indexEnsureSize(t)}vertexWrite(t){this._current.writer.writeVertex(t)}vertexWriteRegion(t){this._current.writer.writeVertexRegion(t)}vertexWriteF32(t){this._current.writer.writeVertexF32(t)}recordBounds(t,e,i,n){}indexWrite(t){this._current.writer.writeIndex(t)}metricStart(t){this._current.metric=t}metricEnd(){const t=this._current.writer;this._current.metric.bounds.length&&t.writeMetric(this._current.metric)}metricBoxWrite(t){this._current.metric.bounds.push(t)}entityStart(t,e=t){this._entityIdIndex=this._entities.push(t),this._entitySortKeyIndex=this._entities.writeF32(e),this._entityRecordCountOffset=this._entities.push(0),this._didEntityStart=!0}entityRecordCount(){return this._entities.getValue(this._entityRecordCountOffset)}entityEnd(){this._didEntityStart&&(0===this.entityRecordCount()?this._entities.seek(this._entityIdIndex):this._entities.incr(this._entityCountOffset),this._didEntityStart=!1)}recordCount(){return this._entities.getValue(this._entityRecordCountOffset)}recordStart(t,e,i=0){this._current.writer=this._getVertexWriter(t,e),this._current.indexStart=this._current.writer.indexCount,this._current.vertexStart=this._current.writer.vertexCount,this._current.instanceId=t,this._current.layoutHash=e.hash,this._current.textureKey=i}recordEnd(t=0){const e=this._current.vertexStart,i=this._current.writer.vertexCount-e;if(!i)return!1;const n=this._current.indexStart,s=this._current.writer.indexCount-n;return this._recordIndexStart=n,this._recordIndexCount=s,this._recordVertexStart=e,this._recordVertexCount=i,this._entities.incr(this._entityRecordCountOffset),r.A.write(this._entities,this._current.instanceId,this._current.textureKey,n,s,e,i,t),!0}copyLast(t,e){const i=this._recordVertexStart+this._recordVertexCount;this._entities.incr(this._entityRecordCountOffset),r.A.write(this._entities,this._current.instanceId,this._current.textureKey,this._recordIndexStart+this._recordIndexCount,this._recordIndexCount,i,this._recordVertexCount,0);const n=this._current.writer.indexWriter,s=this._current.writer.vertexWriter,o=this._recordIndexStart+this._recordIndexCount,a=this._recordVertexCount;for(let t=this._recordIndexStart;t!==o;t++){const e=n.getValue(t);n.push(e+a)}const l=this._current.writer.layout.stride/Uint32Array.BYTES_PER_ELEMENT,u=this._recordVertexStart*l,c=(this._recordVertexStart+this._recordVertexCount)*l;for(let t=u;t!==c;t++){const e=s.getValue(t);s.push(e)}const h=this._current.writer.layout.position,d=h.packPrecisionFactor??1,f=h.offset/Uint32Array.BYTES_PER_ELEMENT,p=t*d,_=e*d;for(let t=i*l;t<=s.length;t+=l)s.i1616Add(t+f,p,_)}copyLastFrom(t,e,i){const n=t._entities.getValue(t._entityIdIndex);if(n!==this._entities.getValue(this._entityIdIndex)){const e=t._entities.getValueF32(t._entitySortKeyIndex);this.entityStart(n,e)}this.recordStart(t._current.instanceId,t._current.writer.layout,t._current.textureKey);const r=this._current.writer.layout.stride/Uint32Array.BYTES_PER_ELEMENT,s=this._current.vertexStart,o=t._current.vertexStart-s,a=this._current.writer.indexWriter,l=this._current.writer.vertexWriter,u=t._current.writer.indexWriter,c=t._current.writer.vertexWriter;for(let e=t._current.indexStart;e!==u.length;e++){const t=u.getValue(e);a.push(t-o)}for(let e=t._current.vertexStart*r;e!==c.length;e++){const t=c.getValue(e);l.push(t)}const h=this._current.writer.layout.position,d=h.packPrecisionFactor??1,f=h.offset/Uint32Array.BYTES_PER_ELEMENT,p=e*d,_=i*d;for(let t=s*r;t<=l.length;t+=r)l.i1616Add(t+f,p,_);this.recordEnd()}_getVertexWriter(t,e){const i=this._instanceIdToVertexData;return i.has(t)||i.set(t,new o(t,e,this._sizeHint)),i.get(t)}}},93561:function(t,e,i){i.d(e,{J:function(){return o}});var n=i(50944),r=i(88413);class s{}class o extends s{constructor(t){super(),this._fetcher=t,this._controller=new AbortController,this._pendingIds=new Set,this._pendingRequests=[],this._resourceIdToResource=new Map}destroy(){this._controller.abort()}get _abortOptions(){return{signal:this._controller.signal}}enqueueRequest(t){const e=(0,r.IF)(t.resource),i=(0,n.Wm)(JSON.stringify(e));return this._pendingIds.has(i)||(this._pendingIds.add(i),this._pendingRequests.push({...t,resourceId:i})),i}async fetchEnqueuedResources(){const t=this._pendingRequests;this._pendingIds.clear(),this._pendingRequests=[];const e=await this._fetcher.fetch(t,this._abortOptions);for(let i=0;i<e.length;i++){const n=t[i].resourceId;this._resourceIdToResource.set(n,e[i])}}async fetchResourceImmediate(t){const e=await this._fetcher.fetch([t],this._abortOptions);if(1!==e.length)throw new Error("FeaturePipelineResourceProxy: failed to fetch resources");return e[0]}async fetchDictionaryResourceImmediate(t){const e=await this._fetcher.fetchDictionary([t],this._abortOptions);if(1!==e.length)throw new Error("FeaturePipelineResourceProxy: failed to fetch dictionary resources");return e[0]}getResource(t){return this._resourceIdToResource.get(t)}}},17469:function(t,e,i){i.d(e,{Tl:function(){return T}});var n=i(67348),r=i(10793),s=i(13786),o=i(14583),a=i(96564),l=i(54904),u=i(87573);const c=22,h=4,d=c+h,f=c-6,p=3,_=Math.PI/180;class m{constructor(t,e,i,n){this._rotationT=(0,r.vt)(),this._xBounds=0,this._yBounds=0,this.minZoom=0,this.maxZoom=255,this._bounds=null;const s=i.rect,o=new Float32Array(8);t*=n,e*=n;const a=i.code?s.width*n:i.metrics.width,l=i.code?s.height*n:i.metrics.height;this.width=a,this.height=l,o[0]=t,o[1]=e,o[2]=t+a,o[3]=e,o[4]=t,o[5]=e+l,o[6]=t+a,o[7]=e+l,this._data=o,this._setTextureCoords(s),this._scale=n,this._mosaic=i,this.x=t,this.y=e,this.maxOffset=Math.max(t+a,e+l)}get mosaic(){return this._mosaic}set angle(t){this._angle=t,(0,n.$0)(this._rotationT,-t),this._setOffsets()}get angle(){return this._angle}get xTopLeft(){return this._data[0]}get yTopLeft(){return this._data[1]}get xBottomRight(){return this._data[6]}get yBottomRight(){return this._data[7]}get texcoords(){return this._texcoords}get textureBinding(){return this._mosaic.textureBinding}get offsets(){return this._offsets||this._setOffsets(),this._offsets}get char(){return String.fromCharCode(this._mosaic.code)}get code(){return this._mosaic.code}get bounds(){if(!this._bounds){const{height:t,width:e}=this._mosaic.metrics,i=e*this._scale,s=Math.abs(t)*this._scale,o=new Float32Array(8);o[0]=this.x,o[1]=this.y,o[2]=this.x+i,o[3]=this.y,o[4]=this.x,o[5]=this.y+s,o[6]=this.x+i,o[7]=this.y+s;const a=(0,n.lw)((0,r.vt)(),this._rotationT,this._transform);(0,r.gb)(o,o,a);let l=1/0,c=1/0,h=-1/0,d=-1/0;for(let t=0;t<4;t++){const e=o[2*t],i=o[2*t+1];l=Math.min(l,e),c=Math.min(c,i),h=Math.max(h,e),d=Math.max(d,i)}const f=h-l,p=d-c,_=l+f/2,m=c+p/2;this._bounds=new u.A(_,m,f,p)}return this._bounds}setTransform(t){this._transform=t,this._offsets=null}_setOffsets(){this._offsets||(this._offsets={topLeft:[0,0],topRight:[0,0],bottomLeft:[0,0],bottomRight:[0,0]});const t=(0,n.lw)((0,r.vt)(),this._rotationT,this._transform);this._offsets.topLeft[0]=this._data[0],this._offsets.topLeft[1]=this._data[1],this._offsets.topRight[0]=this._data[2],this._offsets.topRight[1]=this._data[3],this._offsets.bottomLeft[0]=this._data[4],this._offsets.bottomLeft[1]=this._data[5],this._offsets.bottomRight[0]=this._data[6],this._offsets.bottomRight[1]=this._data[7],(0,s.l0)(this._offsets.topLeft,this._offsets.topLeft,t),(0,s.l0)(this._offsets.topRight,this._offsets.topRight,t),(0,s.l0)(this._offsets.bottomLeft,this._offsets.bottomLeft,t),(0,s.l0)(this._offsets.bottomRight,this._offsets.bottomRight,t)}_setTextureCoords({x:t,y:e,width:i,height:n}){this._texcoords={topLeft:[t,e],topRight:[t+i,e],bottomLeft:[t,e+n],bottomRight:[t+i,e+n]}}}const g=(t,e)=>({code:0,page:0,sdf:!0,rect:new l.A(0,0,11,8),textureBinding:e,metrics:{advance:0,height:4,width:t,left:0,top:0}});function y(t,e){return t.forEach((t=>(0,s.l0)(t,t,e))),{topLeft:t[0],topRight:t[1],bottomLeft:t[2],bottomRight:t[3]}}class v{constructor(t,e,i){this._rotation=0,this._decorate(t,e,i),this.glyphs=t,this.bounds=this._createBounds(t),this.isMultiline=e.length>1,this._hasRotation=0!==i.angle,this._transform=this._createGlyphTransform(this.bounds,i),this._borderLineSizePx=i.borderLineSizePx,(i.borderLineSizePx||i.hasBackground)&&([this.bounds,this.textBox]=this.shapeBackground(this._transform));for(const e of t)e.setTransform(this._transform)}setRotation(t){if(0===t&&0===this._rotation)return;this._rotation=t;const e=this._transform,i=(0,n.$0)((0,r.vt)(),t);(0,n.lw)(e,i,e);for(const t of this.glyphs)t.setTransform(this._transform)}_decorate(t,e,i){if(!i.decoration||"none"===i.decoration||!t.length)return;const n=i.scale,r="underline"===i.decoration?d:f,s=t[0].textureBinding;for(const i of e){const e=i.startX*n,o=i.startY*n,a=(i.width+i.glyphWidthEnd)*n;t.push(new m(e,o+r*n,g(a,s),1))}}shapeBackground(t){const e=(1.5+(this._borderLineSizePx||0))/2,i=this._borderLineSizePx?e:0,{xmin:n,ymin:r,xmax:s,ymax:o,x:a,y:l,width:c,height:h}=this.bounds,d=[n-8,r-8],f=[s+8,r-8],p=[n-8,o+8],_=[s+8,o+8],m=y([[d[0]-e,d[1]-e],[f[0]+e,f[1]-e],[d[0]+i,d[1]+i],[f[0]-i,f[1]+i]],t),g=y([[p[0]+i,p[1]-i],[_[0]-i,_[1]-i],[p[0]-e,p[1]+e],[_[0]+e,_[1]+e]],t),v=y([[d[0]-e,d[1]-e],[d[0]+i,d[1]+i],[p[0]-e,p[1]+e],[p[0]+i,p[1]-i]],t),x=y([[f[0]-i,f[1]+i],[f[0]+e,f[1]-e],[_[0]-i,_[1]-i],[_[0]+e,_[1]+e]],t),b={main:y([d,f,p,_],t),top:m,bot:g,left:v,right:x};return[new u.A(a,l,c+2*e,h+2*e),b]}get boundsT(){const t=this.bounds,e=(0,s.hZ)((0,o.vt)(),t.x,t.y);if((0,s.l0)(e,e,this._transform),this._hasRotation){const i=Math.max(t.width,t.height);return new u.A(e[0],e[1],i,i)}return new u.A(e[0],e[1],t.width,t.height)}_createBounds(t){let e=1/0,i=1/0,n=0,r=0;for(const s of t)e=Math.min(e,s.xTopLeft),i=Math.min(i,s.yTopLeft),n=Math.max(n,s.xBottomRight),r=Math.max(r,s.yBottomRight);const s=n-e,o=r-i;return new u.A(e+s/2,i+o/2,s,o)}_createGlyphTransform(t,e){const i=_*e.angle,a=(0,r.vt)(),l=(0,o.vt)();return(0,n.Tl)(a,a,(0,s.hZ)(l,e.xOffset,-e.yOffset)),e.useCIMAngleBehavior?(0,n.e$)(a,a,i):((0,n.Tl)(a,a,(0,s.hZ)(l,t.x,t.y)),(0,n.e$)(a,a,i),(0,n.Tl)(a,a,(0,s.hZ)(l,-t.x,-t.y))),a}}class x{constructor(t,e,i,n,r,s){this.glyphWidthEnd=0,this.startX=0,this.startY=0,this.start=Math.max(0,Math.min(e,i)),this.end=Math.max(0,Math.max(e,i)),this.end<t.length&&(this.glyphWidthEnd=t[this.end].metrics.width),this.width=n,this.yMin=r,this.yMax=s}}const b=t=>10===t,S=t=>32===t;function w(t,e){let i=0;for(let e=0;e<t.length;e++){const{width:n}=t[e];i=Math.max(n,i)}const n="underline"===e.decoration?h:0,r=t[0].yMin;return{x:0,y:r,height:t[t.length-1].yMax+e.lineHeight*(t.length-1)+n-r,width:i}}function T(t,e){const i=e.scale,n=new Array,{glyphs:r,isRightToLeft:s}=t,o=function(t,e,i){const n=new Array,r=1/i.scale,s=i.maxLineWidth*r,o=e?t.length-1:0,a=e?-1:t.length,l=e?-1:1;let u=o,c=0,h=0,d=u,f=d,p=0,_=1/0,m=0;for(;u!==a;){const{code:e,metrics:i}=t[u],r=Math.abs(i.top);if(b(e)||S(e)||(_=Math.min(_,r),m=Math.max(m,r+i.height)),b(e))u!==o&&(n.push(new x(t,d,u-l,c,_===1/0?0:_,m)),_=1/0,m=0),c=0,d=u+l,f=u+l,h=0;else if(S(e))f=u+l,h=0,p=i.advance,c+=i.advance;else if(c>s){if(f!==d){const e=f-2*l;c-=p,n.push(new x(t,d,e,c-h,_,m)),_=1/0,m=0,d=f,c=h}else n.push(new x(t,d,u-l,c,_,m)),_=1/0,m=0,d=u,f=u,c=0;c+=i.advance,h+=i.advance}else c+=i.advance,h+=i.advance;u+=l}const g=new x(t,d,u-l,c,_,m);return g.start>=0&&g.end<t.length&&n.push(g),n}(r,s,e),l=o.length?w(o,e):{x:0,y:0,height:0,width:0},u=(0,a.xy)(e.horizontalAlignment),h=(0,a.UD)(e.verticalAlignment),d=h===a.gy.Baseline?1:0,f=d?0:h-1,_=(1-d)*-l.y+f*(l.height/2)+(d?1:0)*-c;for(let s=0;s<o.length;s++){const{start:a,end:l,width:c}=o[s];let h=-1*(u+1)*(c/2)-p;const d=(t.isRightToLeft?o.length-1-s:s)*e.lineHeight+_-p;o[s].startX=h,o[s].startY=d;for(let t=a;t<=l;t++){const e=r[t];if(b(e.code))continue;const s=new m(h+e.metrics.left,d-e.metrics.top,e,i);h+=e.metrics.advance,n.push(s)}}return new v(n,o,e)}},10899:function(t,e,i){i.d(e,{e:function(){return l}});var n=i(84354),r=i(86305),s=i(85456),o=i(81438),a=i(3817);class l{constructor(t,e){this._boundPart=null,this.vertexBuffers=new Map;for(const[i,n]of Object.entries(e.vertex)){const e=r.g.createVertex(t,s._U.STATIC_DRAW,n);this.vertexBuffers.set(i,e)}const i=new Map;for(const[n,o]of Object.entries(e.index??{})){const e=r.g.createIndex(t,s._U.STATIC_DRAW,o);i.set(n,e)}this.groups=[];for(const n of e.groups){let r;if(null!=n.index){if(!e.index?.[n.index])throw new Error("No index data.");const{BYTES_PER_ELEMENT:t}=e.index[n.index];2===t?r=s.pe.UNSIGNED_SHORT:4===t&&(r=s.pe.UNSIGNED_INT)}const l=null!=n.index?i.get(n.index):null,u=new Map,c=new Map;for(const t of n.attributes){const{name:e,count:i,type:n,offset:r,normalized:s,divisor:o,stride:l,vertex:h,location:d}=t;let f=c.get(h);f||(f=[],c.set(h,f));const p=new a._(e,i,n,r,l,s,o);f.push(p),u.set(e,d)}const h=new o.Z(t,u,c,this.vertexBuffers,l);this.groups.push({...n,vertexArray:h,locations:u,layout:c,indexing:r})}this.parts=e.parts}bind(t,e){this._boundPart=e;const{group:i}=this.parts[this._boundPart],{vertexArray:n}=this.groups[i];t.bindVAO(n)}draw(t){if(null==this._boundPart)throw new Error("Mesh.bind() has not been called.");const{start:e,count:i}=this.parts[this._boundPart],{group:r}=this.parts[this._boundPart],{indexing:s,primitive:o}=this.groups[r];s?t.drawElements(o,i,s,e*n.I[s]):t.drawArrays(o,e,i)}unbind(t){this._boundPart=null,t.bindVAO(null)}destroy(){for(const{vertexArray:t}of this.groups)t.dispose()}}},61117:function(t,e,i){i.d(e,{g:function(){return a}});var n=i(84354),r=i(10899),s=i(85456);const o={position:{type:s.pe.SHORT,count:2}};class a extends r.e{static create(t,e,i){const r=[];let{stride:s}=e;if(null==s){s=0;for(const[t,{count:i,type:r,offset:o}]of Object.entries(e.layout)){if(null!=o)throw new Error("Stride cannot be computed automatically when attribute offsets are supplied explicitly.");s+=i*n.I[r]}}let o=0;for(const[t,{count:a,offset:l,type:u,normalized:c}]of Object.entries(e.layout)){null!=l&&(o=l);const e=i.get(t);if(null==e)throw new Error("Locations must be specified at mesh initialization.");const h={name:t,location:e,vertex:"vertexData",count:a,type:u,offset:o,stride:s,divisor:0,normalized:null!=c&&c};r.push(h),o+=a*n.I[u]}const l={attributes:r,primitive:e.primitive};null!=e.index&&(l.index="indexData");let{count:u}=e;if(null==u&&(u=e.index?e.index.length:e.vertex.byteLength/s,Math.floor(u)!==u))throw new Error(`The byte length of vertex data must be an exact multiple of the stride, which is ${s}.`);const c={start:0,count:u,group:0,primitive:e.primitive},h={vertex:{vertexData:e.vertex},parts:[c],groups:[l]};return null!=e.index&&(h.index={indexData:e.index}),new a(t,h,e.layout)}static fromVertexStream(t,e){return a.create(t,{primitive:s.WR.TRIANGLE_STRIP,vertex:new Uint16Array(e),layout:o},new Map([["position",0]]))}constructor(t,e,i){super(t,e),this._spec=i}bind(t,e=0){super.bind(t,e)}}},84354:function(t,e,i){i.d(e,{I:function(){return r}});var n=i(85456);const r={[n.pe.BYTE]:1,[n.pe.UNSIGNED_BYTE]:1,[n.pe.SHORT]:2,[n.pe.UNSIGNED_SHORT]:2,[n.pe.HALF_FLOAT]:2,[n.pe.INT]:4,[n.pe.UNSIGNED_INT]:4,[n.pe.FLOAT]:4}},85475:function(t,e,i){i.d(e,{Kl:function(){return l},M9:function(){return o},fw:function(){return a}});const n=new Float32Array(1),r=new Uint32Array(n.buffer);function s(t){return n[0]=t,r[0]}function o(t,e){return 65535&t|e<<16}function a(t){const e=s(t),i=e>>>31;let n=e>>>23&255,r=8388607&e;return n-=127,n>15?i<<15|31744:n<-25?0:(n<-14&&(r+=8388608,r/=2**(-14-n),n=-15),n+=15,r/=8192,r=function(t){const e=Math.floor(t),i=t-e;return e<1023&&(i>.5||.5===i&&e%2==1)?e+1:e}(r),i<<15|n<<10|r)}function l(t){let e=t>>>15,i=t>>10&31,n=1023&t;return e=e?-1:1,i-=15,n/=1024,i>-15?n+=1:i=-14,e*2**i*n}},98282:function(t,e,i){i.d(e,{Y7:function(){return F},HS:function(){return V},mm:function(){return N},A:function(){return B},k2:function(){return k},ZA:function(){return L},E8:function(){return z},hF:function(){return E},C5:function(){return C},uK:function(){return O},Pi:function(){return R}});var n=i(53804),r=(i(58941),i(40633)),s=i(50944),o=i(39819),a=i(54516),l=i(90553);class u{constructor(){this._includedModules=new Map}include(t,e){this._includedModules.has(t)?this._includedModules.get(t):(this._includedModules.set(t,e),t(this.builder,e))}}class c extends u{constructor(){super(...arguments),this.vertex=new f,this.fragment=new f,this.attributes=new p,this.varyings=new _,this.extensions=new m,this.constants=new g}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(t,e=!0){const i=this.extensions.generateSource(t),n=this.attributes.generateSource(t),r=this.varyings.generateSource(t),s="vertex"===t?this.vertex:this.fragment,o=s.uniforms.generateSource(),a=s.code.generateSource(),l="vertex"===t?y:"#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif\n",u=this.constants.generateSource().concat(s.constants.generateSource());return`${e?"#version 300 es":""}\n${i.join("\n")}\n${l}\n${u.join("\n")}\n${o.join("\n")}\n${n.join("\n")}\n${r.join("\n")}\n${a.join("\n")}`}generateBindPass(t){const e=new Map;this.vertex.uniforms.entries.forEach((t=>{const i=t.bind[a.c.Pass];i&&e.set(t.name,i)})),this.fragment.uniforms.entries.forEach((t=>{const i=t.bind[a.c.Pass];i&&e.set(t.name,i)}));const i=Array.from(e.values()),n=i.length;return(e,r)=>{for(let s=0;s<n;++s)i[s](t,e,r)}}generateBindDraw(t){const e=new Map;this.vertex.uniforms.entries.forEach((t=>{const i=t.bind[a.c.Draw];i&&e.set(t.name,i)})),this.fragment.uniforms.entries.forEach((t=>{const i=t.bind[a.c.Draw];i&&e.set(t.name,i)}));const i=Array.from(e.values()),n=i.length;return(e,r,s)=>{for(let o=0;o<n;++o)i[o](t,s,e,r)}}}class h{constructor(){this._entries=new Map}add(...t){for(const e of t)this._add(e)}get(t){return this._entries.get(t)}_add(t){if(null!=t){if(this._entries.has(t.name)&&!this._entries.get(t.name).equals(t))throw new o.A(`Duplicate uniform name ${t.name} for different uniform type`);this._entries.set(t.name,t)}else r.A.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder").error(`Trying to add null Uniform from ${(new Error).stack}.`)}generateSource(){return Array.from(this._entries.values()).map((t=>null!=t.arraySize?`uniform ${t.type} ${t.name}[${t.arraySize}];`:`uniform ${t.type} ${t.name};`))}get entries(){return Array.from(this._entries.values())}}class d{constructor(){this._entries=new Array}add(t){this._entries.push(t)}generateSource(){return this._entries}}class f extends u{constructor(){super(...arguments),this.uniforms=new h,this.code=new d,this.constants=new g}get builder(){return this}}class p{constructor(){this._entries=new Array}add(t,e){this._entries.push([t,e])}generateSource(t){return"fragment"===t?[]:this._entries.map((t=>`in ${t[1]} ${t[0]};`))}}class _{constructor(){this._entries=new Map}add(t,e){this._entries.has(t)&&(0,l.vA)(this._entries.get(t)===e),this._entries.set(t,e)}generateSource(t){const e=new Array;return this._entries.forEach(((i,n)=>e.push("vertex"===t?`out ${i} ${n};`:`in ${i} ${n};`))),e}}class m{constructor(){this._entries=new Set}add(t){this._entries.add(t)}generateSource(t){const e="vertex"===t?m.ALLOWLIST_VERTEX:m.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter((t=>e.includes(t))).map((t=>`#extension ${t} : enable`))}}m.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],m.ALLOWLIST_VERTEX=[];class g{constructor(){this._entries=new Set}add(t,e,i){let n="ERROR_CONSTRUCTOR_STRING";switch(e){case"float":n=g._numberToFloatStr(i);break;case"int":n=g._numberToIntStr(i);break;case"bool":n=i.toString();break;case"vec2":n=`vec2(${g._numberToFloatStr(i[0])},                            ${g._numberToFloatStr(i[1])})`;break;case"vec3":n=`vec3(${g._numberToFloatStr(i[0])},                            ${g._numberToFloatStr(i[1])},                            ${g._numberToFloatStr(i[2])})`;break;case"vec4":n=`vec4(${g._numberToFloatStr(i[0])},                            ${g._numberToFloatStr(i[1])},                            ${g._numberToFloatStr(i[2])},                            ${g._numberToFloatStr(i[3])})`;break;case"ivec2":n=`ivec2(${g._numberToIntStr(i[0])},                             ${g._numberToIntStr(i[1])})`;break;case"ivec3":n=`ivec3(${g._numberToIntStr(i[0])},                             ${g._numberToIntStr(i[1])},                             ${g._numberToIntStr(i[2])})`;break;case"ivec4":n=`ivec4(${g._numberToIntStr(i[0])},                             ${g._numberToIntStr(i[1])},                             ${g._numberToIntStr(i[2])},                             ${g._numberToIntStr(i[3])})`;break;case"mat2":case"mat3":case"mat4":n=`${e}(${Array.prototype.map.call(i,(t=>g._numberToFloatStr(t))).join(", ")})`}return this._entries.add(`const ${e} ${t} = ${n};`),this}static _numberToIntStr(t){return t.toFixed(0)}static _numberToFloatStr(t){return Number.isInteger(t)?t.toFixed(1):t.toString()}generateSource(){return Array.from(this._entries)}}const y="precision highp float;\nprecision highp sampler2D;";var v=i(70931);function x(t,e,i){const n=e.split("\n");for(const e of n)if(e.trim().length){{let e="";null!=i&&(e+=`/*id:${i??"000"}*/   `),t.body+=e.padEnd(14)}t.body+=" ".repeat(t.indent)+e+"\n"}}class b{write(t){for(const e of t.rootOutputNodes())t.shouldPruneOutputNode(e)||(e.variableName=this._write(t,e.node));return t}_createVarName(t,e){let i="";return"boolean"!=typeof e&&"number"!=typeof e&&e.debugInfo.name&&(i=`${e.debugInfo.name}_`),`${i}v${t.varCount++}`}_write(t,e,i=!1){if("number"==typeof e)return e.toString();if("boolean"==typeof e)return e.toString();let n=t.getEmit(e);if(n)return n;switch(e.shaderType){case"scope-node":n=this._writeScopeNode(t,e);break;case"primitive-node":n=this._writePrimitiveNode(t,e,i);break;case"function-node":n=this._writeFunctionNode(t,e);break;case"property-access-node":n=this._writePropertyAccessNode(t,e);break;case"text-node":n=e.text;break;case"block-node":n=this._writeBlockNode(t,e);break;case"condition-node":n=this._writeConditionNode(t,e)}return t.setEmit(e,n),n}_writeScopeNode(t,e){const i=new e.child.constructor;i.setDebugName(e.debugInfo.name);const n=this._write(t,i,!0);return x(t,`{ /*ScopeStart: ${e.uid} ${e.debugInfo.name}*/`),t.indent+=2,x(t,`${n} = ${this._write(t,e.child)};`),t.indent-=2,x(t,`} /*ScopeEnd: ${e.uid} ${e.debugInfo.name}*/`),n}_writeConditionNode(t,e){const i=new e.ifTrue.constructor,n=this._write(t,i,!0);x(t,`if (${this._write(t,e.condition)}) {`),t.indent+=2;const r=t.createSubgraphContext(),s=this._write(r,e.ifTrue);if(t.body+=r.body,s&&x(t,`${n} = ${s};`),t.indent-=2,x(t,"}"),e.ifFalse){x(t,"else {"),t.indent+=2;const i=t.createSubgraphContext(),r=this._write(i,e.ifFalse);t.body+=i.body,r&&x(t,`${n} = ${r};`),t.indent-=2,x(t,"}")}return n}_writeBlockNode(t,e){const{captureList:i,generator:n,returnType:r}=e,s={};for(const e in i){if(!i[e])continue;const n=this._write(t,i[e]);s[e]=n}const o=new r,a=this._write(t,o,!0);if(s.out=a,e.subgraph){const i=t.createSubgraphContext(),n=this._write(i,e.subgraph.child),r=i.body;s.subgraph={varName:n,body:r}}const l=n(s);return x(t,"{\n"),t.indent+=2,x(t,l),t.indent-=2,x(t,"}\n"),a}_writePropertyAccessNode(t,e){const i=this._write(t,e.target);return"string"==typeof e.property&&e.property.includes("[")?`${i}${e.property}`:"string"!=typeof e.property?`${i}[${this._write(t,e.property)}]`:`${i}.${e.property}`}_writeFunctionNode(t,e){const i=e.returnType.type;if(e.isInfix){const[n,r]=e.children.map((e=>this._write(t,e))),s=this._createVarName(t,e);return x(t,`${i.padEnd(5)} ${s} = ${n} ${e.token} ${r};`,e.uid),s}const n=e.children.map((e=>this._write(t,e))).join(", "),r=this._createVarName(t,e);return x(t,`${i.padEnd(5)} ${r} = ${e.token}(${n});`,e.uid),r}_writePrimitiveNode(t,e,i=!1){const n=t.getInput(e);if(n)return n.isUsed=!0,n.variableName;const r=1===e.children.length&&e.children[0]?.type===e.type;if(e.isImplicit||r)return this._write(t,e.children[0]);const s=this._createVarName(t,e);if(i)return x(t,`${e.type.padEnd(5)} ${s};`,e.uid),s;const o=!e.debugInfo.name&&!e.isMutable;if(o&&"float"===e.type&&"number"==typeof e.children[0])return Number.isInteger(e.children[0])?e.children[0].toFixed(1):e.children[0].toString();if(o&&"int"===e.type&&"number"==typeof e.children[0]&&Number.isInteger(e.children[0]))return e.children[0].toString();const a=e.children.map((e=>this._write(t,e))).join(", ");return"array"===e.type?(x(t,`${e.type.padEnd(5)} ${s} = [${a}];`,e.uid),s):o?`${e.type}(${a})`:(x(t,`${e.type.padEnd(5)} ${s} = ${e.type}(${a});`,e.uid),s)}}var S=i(44784);class w{constructor(t,e,i){this.variableName=t,this.variableInputType=e,this.node=i,this.type="shader-input",this.isUsed=!1}clone(){return new w(this.variableName,this.variableInputType,(0,S.vA)(this.node))}}class T{constructor(t,e,i){this.outVariableName=t,this.outVariableType=e,this.node=i,this.type="shader-output"}clone(){const t=new T(this.outVariableName,this.outVariableType,(0,S.vA)(this.node));return t.variableName=this.variableName,t}}class P{static createVertex(t,e,i,n,r,s){const o=[];for(const e in t){const n=t[e],r=i.get(e);r?o.push(new w(r,"builtin",n)):o.push(new w("a_"+e,"in",n))}for(const t of n){const e=t.uniformHydrated;o.push(new w(t.uniformName,"uniform",e))}const a=[];for(const t in e){const i=e[t];"glPosition"===t?a.push(new T("gl_Position","builtin",i)):"glPointSize"===t?a.push(new T("gl_PointSize","builtin",i)):a.push(new T("v_"+t,"out",i))}return new P(o,a,r,s)}static createFragment(t,e,i,n,r,s){const o=[],a=Array.from(r.rootOutputNodes());for(const e in t){const n=t[e],r=i.get(e);if(r){o.push(new w(r,"builtin",n));continue}const s=a.find((t=>t.node===n));s&&o.push(new w(s.outVariableName,"in",n))}for(const t of n){const e=t.uniformHydrated;o.push(new w(t.uniformName,"uniform",e))}const l=[];for(const t in e){const n=e[t],r=i.get(t);"discard"===t?l.push(new T(null,"discard",n)):r?l.push(new T(r,"builtin",n)):l.push(new T(t,"out",n))}return new P(o,l,s)}constructor(t,e,i,n){this.type="shader-graph-context",this.indent=0,this.body="",this.varCount=0,this._inputShaderTypesByNodeUid=new Map,this._nodeEmitMap=new Map;for(const e of t)this._inputShaderTypesByNodeUid.set(e.node.uid,e);this._outputShaderTypes=e,this._transformFeedbackBindings=i,this._transformFeedbackNames=new Set(i.map((t=>"v_"+t.propertyKey))),this._usedInFragmentShader=n}shouldPruneOutputNode(t){return!!this._usedInFragmentShader&&"builtin"!==t.outVariableType&&!this._transformFeedbackNames.has(t.outVariableName)&&!this._usedInFragmentShader.has(t.node.uid)}setEmit(t,e){this._nodeEmitMap.set(t.uid,e)}getEmit(t){return this._nodeEmitMap.get(t.uid)}inputs(){return this._inputShaderTypesByNodeUid.values()}getInput(t){return this._inputShaderTypesByNodeUid.get(t.uid)}*rootOutputNodes(){for(const t of this._outputShaderTypes)yield t}*nodes(){const t=[];for(const e of this._outputShaderTypes.values())t.push(e.node);for(;t.length;){const e=t.pop();"number"!=typeof e&&"boolean"!=typeof e&&t.push(...e.children.filter(Boolean)),yield e}}*nodesOfTypeOrFunction(){for(const t of this.nodes())"number"!=typeof t&&"boolean"!=typeof t&&(yield t)}createSubgraphContext(){const t=this.clone();return t.body="",t.indent=this.indent+2,t._nodeEmitMap=new Map(this._nodeEmitMap),t}clone(){const t=new P([],this._outputShaderTypes,this._transformFeedbackBindings,this._usedInFragmentShader);return t._inputShaderTypesByNodeUid=this._inputShaderTypesByNodeUid,t.indent=this.indent,t.body=this.body,t.varCount=this.varCount,t._nodeEmitMap=this._nodeEmitMap,t}insertVertexShader(t){t.vertex.code.add(""),this._insertInputs(t,"vertex"),t.vertex.code.add(""),t.vertex.code.add("// OUTPUTS: "),t.vertex.code.add("// --------------------------------------------------------- ");for(const e of this.rootOutputNodes()){const i="builtin"===e.outVariableType;this.shouldPruneOutputNode(e)||(i?t.vertex.code.add(`// ${e.outVariableType.padEnd(7)} ${e.node.type.padEnd(9)} ${e.outVariableName};`):t.vertex.code.add(`${e.outVariableType.padEnd(10)} ${e.node.type.padEnd(9)} ${e.outVariableName};`))}t.vertex.code.add(""),t.vertex.code.add("void main() {"),t.vertex.code.add("  "+this.body.split("\n").join("\n  "));for(const e of this.rootOutputNodes())this.shouldPruneOutputNode(e)||t.vertex.code.add(`  ${e.outVariableName} = ${e.variableName};`);t.vertex.code.add("}")}insertFragmentShader(t){this._insertInputs(t,"fragment"),t.fragment.code.add(""),t.fragment.code.add("// OUTPUTS: "),t.fragment.code.add("// --------------------------------------------------------- ");for(const e of this.rootOutputNodes())"builtin"===e.outVariableType?t.fragment.code.add(`// ${e.outVariableType.padEnd(7)} ${e.node.type.padEnd(9)} ${e.outVariableName};`):t.fragment.code.add(`${e.outVariableType.padEnd(10)} ${e.node.type.padEnd(9)} ${e.outVariableName};`);t.fragment.code.add(""),t.fragment.code.add("void main() {"),t.fragment.code.add("  "+this.body.split("\n").join("\n  "));for(const e of this.rootOutputNodes())"discard"===e.outVariableType?(t.fragment.code.add("  // TODO: Should ensure codegen for discard appears first in fragment shader"),t.fragment.code.add(`  if (${e.variableName}) {`),t.fragment.code.add("    discard;"),t.fragment.code.add("  }"),t.fragment.code.add("  ")):t.fragment.code.add(`  ${e.outVariableName} = ${e.variableName};`);t.fragment.code.add("}")}_insertInputs(t,e){t[e].code.add("// INPUTS: "),t[e].code.add("// --------------------------------------------------------- ");for(const i of this.inputs())i.isUsed&&"builtin"!==i.variableInputType&&("array"===i.node.type?t[e].code.add(`${i.variableInputType.padEnd(10)} ${i.node.elementType.type.padEnd(9)} ${i.variableName}[${i.node.size}];`):t[e].code.add(`${i.variableInputType.padEnd(10)} ${i.node.type.padEnd(9)} ${i.variableName};`))}}var I=i(22516);function M(t){return new t}function A(t,e,i){const n=t.constructor[e]??[];t.constructor.hasOwnProperty(e)||Object.defineProperty(t.constructor,e,{value:n.slice()}),t.constructor[e].push(i)}function C(t,e){return(i,n)=>{A(i,"locations",{typeCtor:e,propertyKey:n,parameterIndex:null,index:t})}}const E=t=>(e,i,n)=>{A(e,"inputs",{inputCtor:t,propertyKey:i,parameterIndex:n})},R=t=>(e,i)=>{A(e,"uniforms",{typeCtor:t,propertyKey:i})},O=t=>(e,i)=>{A(e,"options",{typeCtor:t,propertyKey:i})},z=(t,e)=>{A(t,"defines",{propertyKey:e})},D=(t,e)=>(i,n)=>{i.constructor.builtins.push({builtin:t,propertyKey:n,typeCtor:e})};class L{}L.builtins=[],(0,n._)([D("gl_VertexID",v.Ai)],L.prototype,"glVertexID",void 0);class F{}class V{}V.builtins=[],(0,n._)([D("gl_FragCoord",v.Zb)],V.prototype,"glFragCoord",void 0),(0,n._)([D("gl_PointCoord",v.ZY)],V.prototype,"glPointCoord",void 0);class N{}class k{constructor(){this.type="uniform-group"}get _uniforms(){return this.constructor.uniforms??[]}}class B{constructor(){this.logShader=!1,this.computeAttributes={}}get vertexInput(){const t=this._shaderModuleClass.inputs.findLast((t=>"vertex"===t.propertyKey&&0===t.parameterIndex));if(!t)throw new Error("Unable to find vertex input parameter");return t}get computeInput(){return this._shaderModuleClass.inputs.findLast((t=>"vertex"===t.propertyKey&&1===t.parameterIndex))}get fragmentInput(){const t=this._shaderModuleClass.inputs.findLast((t=>"fragment"===t.propertyKey));if(!t)throw new Error("Unable to find fragment input parameter");return t}get transformFeedbackBindings(){return this.fragmentInput.inputCtor.transformFeedbackBindings??[]}get locations(){return[...this.vertexInput.inputCtor.locations,...this.computeInput?.inputCtor.locations??[]]}get locationsMap(){const t=new Map,e=new Set;for(const i of this.locations)e.has(i.index)?r.A.getLogger("esri.views.2d.engine.webgl.shaderGraph.GraphShaderModule").warnOnce("mapview-rendering",`Unable to assigned attribute ${i.propertyKey} to ${i.index}. Index already in use`,{locationsMap:t}):(t.set(i.propertyKey,i.index),e.add(i.index));return t}get locationInfo(){if(!this._locationInfo){const t=this.locationsMap,e=Array.from(t.entries()).map((([t,e])=>`${t}.${e}`)).join("."),i=(0,s.Wm)(e),n=this.computeAttributes;this._locationInfo={hash:i,locations:t,computeAttributeMap:n}}return this._locationInfo}get renamedLocationsMap(){const t=new Map;for(const e of this.locations)t.set("a_"+e.propertyKey,e.index);return t}get optionPropertyKeys(){if(!this._optionPropertyKeys){const t=new Set;for(const e of this._options)t.add(e.propertyKey);this._optionPropertyKeys=t}return this._optionPropertyKeys}get _shaderModuleClass(){return this.constructor}get _defines(){return this._shaderModuleClass.defines??[]}get _options(){return this._shaderModuleClass.options??[]}get _uniforms(){return this._shaderModuleClass.uniforms??[]}getProgram(t,e,i,n){try{const{vertex:r,fragment:s,uniformBindings:o}=this._generateShaders(t,e,i,n);return new I.K(r,s,this.renamedLocationsMap,this.locationInfo,o,this.transformFeedbackBindings)}catch(t){return new I.K("","",this.renamedLocationsMap,this.locationInfo,[],this.transformFeedbackBindings)}}getDebugUniformClassInfo(t){const e=this._options.find((e=>e.propertyKey===t));if(e)return{type:"option",className:e.typeCtor};const i=this._uniforms.find((e=>e.propertyKey===t));if(!i)throw new Error(`Unable to find uniform class type for property: ${t}`);return{type:"required",className:i.typeCtor}}getShaderKey(t,e,i,n){const r=Object.keys(t).map((e=>`${e}.${t[e]}`)).join("."),s=Object.keys(i).map((t=>`${t}.${i[t]}`)).join("."),o=Object.keys(n).map((t=>`${t}.${n[t]}`)).join("."),a=Object.keys(e).filter((t=>this.optionPropertyKeys.has(t)&&e[t])).join(".");return`${this.constructor.name}.${r}.${s}.${o}.${a}`}_generateShaders(t,e,i,n){const r=[];this._setDefines(i),this._setOptionalUniforms(r,e),this._setRequiredUniforms(r);const s=this._hydrateVertexInput(n),o=this._injectPackPrecisionFactor(s,t),a=this._hydrateComputeInput(),l=a&&this._injectComputePackPrecisionFactor(a,t),u=this.vertex(o,l),c=this._hydrateFragmentInput(u),h=this.fragment(c),d=new Set;for(const t in h){const e=h[t];(0,S.rz)(d,e)}const f=this._getVertexInputBuiltins(),p=P.createVertex({...s,...a},u,f,r,this.transformFeedbackBindings,d);(new b).write(p);const _=this._getFragmentInputBuiltins(h);_.set("glPointCoord","gl_PointCoord");const m=P.createFragment(c,h,_,r,p,this.transformFeedbackBindings);(new b).write(m);const g=this._createShaderBuilder(p,m),y=g.generate("vertex",!0),v=g.generate("fragment",!0);return this.logShader&&(console.log(y),console.log(v)),{vertex:y,fragment:v,uniformBindings:r}}_setDefines(t){for(const e in t)this[e]=t[e]}_setOptionalUniforms(t,e){for(const i of this._options)e[i.propertyKey]?this[i.propertyKey]=this._hydrateUniformGroup(t,i):this[i.propertyKey]=null}_setRequiredUniforms(t){for(const e of this._uniforms)this[e.propertyKey]=this._hydrateUniformGroup(t,e)}_hydrateUniformGroup(t,e){const i=new(0,e.typeCtor);for(const n of i._uniforms??[]){const r=M(n.typeCtor),s=`u_${e.propertyKey}_${n.propertyKey}`,o=r.type,a=[e.propertyKey,n.propertyKey].join(".");if("type"in n.typeCtor&&"array"===n.typeCtor.type){const e=r;t.push({shaderModulePath:a,uniformName:s,uniformType:o,uniformArrayLength:e.size,uniformArrayElementType:e.elementType.type,uniformHydrated:r})}else t.push({shaderModulePath:a,uniformName:s,uniformType:o,uniformHydrated:r});i[n.propertyKey]=r}return i}_hydrateVertexInput(t){const e=this.vertexInput.inputCtor,i=e.locations.reduce(((e,i)=>!1===t[i.propertyKey]?e:{...e,[i.propertyKey]:M(i.typeCtor)}),{});for(const{propertyKey:t,typeCtor:n}of e.builtins){const e=M(n);i[t]=e}return i}_hydrateComputeInput(){return null==this.computeInput?null:this.computeInput.inputCtor.locations.reduce(((t,e)=>({...t,[e.propertyKey]:M(e.typeCtor)})),{})}_injectPackPrecisionFactor(t,e){const i={};for(const n in t){const r=t[n],s=e[n];if(s){if("float"!==r.type&&"vec2"!==r.type&&"vec3"!==r.type&&"vec4"!==r.type)throw new Error(`InternalError: packPrecisionFactor requires GenType, but found ${r.type}`);i[n]=r.divide(new v.nt(s))}else i[n]=r}return i}_injectComputePackPrecisionFactor(t,e){const i={},n=new Map;for(const t in this.computeAttributes)for(const e of this.computeAttributes[t]??[])n.set(e,t);for(const r in t){const s=t[r],o=n.get(r);if(!o)continue;const a=e[o];if(a){if("float"!==s.type&&"vec2"!==s.type&&"vec3"!==s.type&&"vec4"!==s.type)throw new Error(`InternalError: packPrecisionFactor requires GenType, but found ${s.type}`);i[r]=s.divide(new v.nt(a))}else i[r]=s}return i}_hydrateFragmentInput(t){const e={};for(const i in t)e[i]=t[i];for(const{propertyKey:t,typeCtor:i}of V.builtins){const n=M(i);e[t]=n}return e}_getVertexInputBuiltins(){const t=this.vertexInput.inputCtor,e=new Map;for(const{builtin:i,propertyKey:n}of t.builtins)e.set(n,i);return e}_getFragmentInputBuiltins(t){const e=t.constructor,i=new Map;for(const t of e.builtins??[])i.set(t.propertyKey,t.builtin);return i}_createShaderBuilder(t,e){const i=new c;return this._insertDebugInfo(i),t.insertVertexShader(i),e.insertFragmentShader(i),i}_insertDebugInfo(t){t.vertex.code.add("// DEFINES: "),t.vertex.code.add("// --------------------------------------------------------- ");for(const e of this._defines)this[e.propertyKey]?t.vertex.code.add(`//   ${e.propertyKey}: true`):t.vertex.code.add(`//   ${e.propertyKey}: false`);t.vertex.code.add(""),t.vertex.code.add("// OPTIONS: "),t.vertex.code.add("// --------------------------------------------------------- ");for(const e of this._options)this[e.propertyKey]?t.vertex.code.add(`//   ${e.propertyKey}: true`):t.vertex.code.add(`//   ${e.propertyKey}: false`)}}},44784:function(t,e,i){function n(t,e){const i=[];for(i.push(e);i.length;){const e=i.pop();if("object"==typeof e&&!t.has(e.uid)){t.add(e.uid);for(const t of e.children)i.push(t)}}}i.d(e,{XL:function(){return u},aw:function(){return h},rR:function(){return c},rz:function(){return n},vA:function(){return s},vL:function(){return o},zg:function(){return l}});class r{constructor(){this.uid=r.NodeCount++,this._debugName=null,this._isMutable=!1,this.isImplicit=!1}get isMutable(){return this._isMutable}setMutable(){return this._isMutable=!0,this}setDebugName(t){return t=t.split(" ").map(((t,e)=>e>0?t.charAt(0).toUpperCase()+t.slice(1):t)).join(""),this._debugName=t,this.isImplicit&&this.children[0]instanceof r&&this.children[0].setDebugName(t),this}get debugInfo(){return{name:this._debugName??""}}cloneInto(t){t._debugName=this._debugName,t._isMutable=this._isMutable,t.isImplicit=this.isImplicit,t.uid=this.uid}}function s(t){return"object"==typeof t?t.clone():t}r.NodeCount=0;class o extends r{constructor(){super(...arguments),this.shaderType="primitive-node"}}class a extends r{constructor(t){super(),this.child=t,this.shaderType="scope-node"}get children(){return[this.child]}clone(){const t=new a(s(this.child));return this.cloneInto(t),t}}class l extends r{constructor(t,e,i){super(),this.property=t,this.target=e,this.returnType=i,this.shaderType="property-access-node"}get children(){const t=[this.target];return"string"!=typeof this.property&&t.push(this.property),t}clone(){const t=new l(this.property,s(this.target),this.returnType);return this.cloneInto(t),t}}class u extends r{constructor(t,e,i){super(),this.condition=t,this.ifTrue=e,this.ifFalse=i,this.shaderType="condition-node"}get children(){return[this.condition,this.ifTrue,this.ifFalse]}clone(){const t=s(this.ifTrue),e=this.ifFalse?s(this.ifFalse):null,i=new u(this.condition,t,e);return this.cloneInto(i),i}}class c extends r{constructor(t,e,i,n){super(),this.captureList=t,this.returnType=e,this.generator=n,this.shaderType="block-node",i&&(this.subgraph=new a(i))}get children(){return Object.keys(this.captureList).map((t=>this.captureList[t])).concat(this.subgraph??[])}clone(){const t={};for(const e in this.captureList)t[e]=s(this.captureList[e]);const e=new c(t,this.returnType,this.subgraph?s(this.subgraph.child):this.subgraph,this.generator);return this.cloneInto(e),e}}class h extends r{constructor(t,e,i,n,r,s=!1){super(),this.token=t,this._children=e,this.isInfix=i,this.isPropertyAccess=n,this.returnType=r,this.isTernary=s,this.shaderType="function-node"}get children(){return this._children}clone(){const t=new h(this.token,this._children.map(s),this.isInfix,this.isPropertyAccess,this.returnType,this.isTernary);return this.cloneInto(t),t}}},70931:function(t,e,i){i.d(e,{$5:function(){return _t},$I:function(){return Y},AU:function(){return Vt},Ai:function(){return V},Bw:function(){return Rt},F8:function(){return Bt},Gb:function(){return ct},Io:function(){return Mt},LC:function(){return ft},LI:function(){return kt},MM:function(){return mt},My:function(){return S},Ny:function(){return U},Om:function(){return At},PM:function(){return Yt},RI:function(){return Ct},RZ:function(){return Gt},S8:function(){return Ft},Sj:function(){return ht},T9:function(){return Ot},TF:function(){return Ut},Tk:function(){return rt},U:function(){return G},US:function(){return Zt},Uo:function(){return vt},Wh:function(){return H},Xe:function(){return pt},ZY:function(){return P},Zb:function(){return M},Zc:function(){return $},aX:function(){return gt},eB:function(){return I},eR:function(){return j},fV:function(){return W},gn:function(){return It},j1:function(){return st},jc:function(){return Et},jh:function(){return Dt},jk:function(){return zt},ln:function(){return q},lw:function(){return ot},mk:function(){return Tt},n7:function(){return Nt},nf:function(){return dt},nt:function(){return T},om:function(){return nt},or:function(){return yt},qE:function(){return Pt},rY:function(){return wt},tn:function(){return xt},w0:function(){return X},x:function(){return O},z7:function(){return w},ze:function(){return it},zi:function(){return Lt}});var n,r,s,o,a,l,u,c,h,d,f,p,_,m,g=i(53804),y=i(44784);function v(t){return new Proxy(t,{get(e,i){if("constructor"===i)return new Proxy(e.constructor,{construct:(t,e,i)=>v(new t(...e))});if(i in e)return e[i];if("string"==typeof i){const e=function(t){const e=[["float","vec2","vec3","vec4"],["int","ivec2","ivec3","ivec4"],["uint","uvec2","uvec3","uvec4"],["bool","bvec2","bvec3","bvec4"]];for(const i of e)if(i.includes(t))return i.map((t=>Z[t]));throw new Error("Unable to find type family")}(t.type);return K(t,i,e[i.length-1])}}})}function x(t){return new Proxy(t,{construct:(t,e,i)=>v(new t(...e))})}class b extends Error{}let S=n=class extends y.vL{constructor(t,e){super(),this.elementType=t,this.size=e,this.children=[],this.type="array"}clone(){const t=new n(this.elementType,this.size);return super.cloneInto(t),t}get(t){if("number"==typeof t){const e=new V(t);return e.isImplicit=!0,K(this,e,this.elementType.constructor)}return K(this,t,this.elementType.constructor)}last(){return this.get(this.size-1)}first(){return this.get(0)}findIndex(t,e,i){return function(t,e,i=0,n=t.size){const r=new V(i).setMutable().setDebugName("FindIndexIterator"),s=e(t.get(r)).setDebugName("FindIndexPredicate"),o=nt({iter:r},V,s,(({out:t,iter:e,subgraph:i})=>`\n${t} = -1;\n\nfor (; ${e} < ${n}; ${e}++) {\n\n${i.body}\n\n  if (${i.varName}) {\n    ${t} = ${e};\n    break;\n  }\n\n}\n`)).setDebugName("FindIndexBlock");return o}(this,t,e,i)}glslFindIndex(t,e,i){return function(t,e,i=0,n=t.size){const r=nt({array:t},V,null,(({out:t,array:r})=>`\n${t} = -1;\nfor (int i = ${i}; i < ${n}; i++) {\n  bool condition;\n  ${e({array:r,i:"i",out:"condition"})}\n  if (condition) {\n    ${t} = i;\n    break;\n  }\n}\n`)).setDebugName("GlslFindIndexBlock");return r}(this,t,e,i)}static ofType(t,e){const i={construct:(i,r)=>new n(new t,e)};return new Proxy(n,i)}};S.type="array",S=n=(0,g._)([function(t){return new Proxy(t,{construct:(t,e,i)=>function(t){return new Proxy(t,{get(e,i){if(i in e)return e[i];if("string"==typeof i){const e=parseInt(i,10);if(!isNaN(e))return K(t,`[${e}]`,t.elementType.constructor)}}})}(new t(...e))})}],S);class w extends y.vL{constructor(){super(...arguments),this.type="sampler2D",this.children=[]}clone(){const t=new w;return t.children=this.children.map(y.vA),super.cloneInto(t),t}}w.type="sampler2D";class T extends y.vL{constructor(t){super(),this.type="float",this.children=[t]}clone(){const t=new T((0,y.vA)(this.children[0]));return super.cloneInto(t),t}multiply(t){return ot(this,"number"==typeof t?L(t,T):t)}divide(t){return at(this,"number"==typeof t?L(t,T):t)}add(t){return lt(this,"number"==typeof t?L(t,T):t)}subtract(t){return ut(this,"number"==typeof t?L(t,T):t)}}T.type="float";let P=r=class extends y.vL{constructor(t,e){super(),this.type="vec2",this.children=[t,e].filter((t=>null!=t))}clone(){const t=new r((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]));return super.cloneInto(t),t}get 0(){return K(this,"[0]",T)}get 1(){return K(this,"[1]",T)}get 2(){throw new b}get 3(){throw new b}multiply(t){return ot(this,"number"==typeof t?L(t,T):t)}divide(t){return at(this,"number"==typeof t?L(t,T):t)}add(t){return lt(this,"number"==typeof t?L(t,T):t)}subtract(t){return ut(this,"number"==typeof t?L(t,T):t)}};P.type="vec2",P=r=(0,g._)([x],P);let I=s=class extends y.vL{constructor(t,e,i){super(),this.type="vec3",this.children=[t,e,i].filter((t=>null!=t))}get 0(){return K(this,"[0]",T)}get 1(){return K(this,"[1]",T)}get 2(){return K(this,"[2]",T)}get 3(){throw new b}clone(){const t=new s((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]));return super.cloneInto(t),t}multiply(t){return ot(this,"number"==typeof t?L(t,T):t)}divide(t){return at(this,"number"==typeof t?L(t,T):t)}add(t){return lt(this,"number"==typeof t?L(t,T):t)}subtract(t){return ut(this,"number"==typeof t?L(t,T):t)}};I.type="vec3",I=s=(0,g._)([x],I);let M=o=class extends y.vL{constructor(t,e,i,n){super(),this.type="vec4",this.children=[t,e,i,n].filter((t=>null!=t))}clone(){const t=new o((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]),(0,y.vA)(this.children[3]));return super.cloneInto(t),t}get 0(){return K(this,"[0]",T)}get 1(){return K(this,"[1]",T)}get 2(){return K(this,"[2]",T)}get 3(){return K(this,"[3]",T)}multiply(t){return ot(this,"number"==typeof t?L(t,T):t)}divide(t){return at(this,"number"==typeof t?L(t,T):t)}add(t){return lt(this,"number"==typeof t?L(t,T):t)}subtract(t){return ut(this,"number"==typeof t?L(t,T):t)}};M.type="vec4",M=o=(0,g._)([x],M);let A=a=class extends y.vL{constructor(t){super(),this.type="uint",this.children=[t]}clone(){const t=new a((0,y.vA)(this.children[0]));return super.cloneInto(t),t}};A.type="uint",A=a=(0,g._)([x],A);let C=l=class extends y.vL{constructor(t,e){super(),this.type="uvec2",this.children=[t,e].filter((t=>null!=t))}clone(){const t=new l((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]));return super.cloneInto(t),t}};C.type="uvec2",C=l=(0,g._)([x],C);let E=u=class extends y.vL{constructor(t,e,i){super(),this.type="uvec3",this.children=[t,e,i].filter((t=>null!=t))}clone(){const t=new u((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]));return super.cloneInto(t),t}};E.type="uvec3",E=u=(0,g._)([x],E);let R=c=class extends y.vL{constructor(t,e,i,n){super(),this.type="uvec4",this.children=[t,e,i,n].filter((t=>null!=t))}clone(){const t=new c((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]),(0,y.vA)(this.children[3]));return super.cloneInto(t),t}};R.type="uvec4",R=c=(0,g._)([x],R);class O extends y.vL{constructor(t){super(),this.type="bool",this.children=[t]}and(t){return vt(this,t)}or(t){return yt(this,t)}clone(){const t=new O((0,y.vA)(this.children[0]));return super.cloneInto(t),t}}O.type="bool";let z=h=class extends y.vL{constructor(t,e){super(),this.type="bvec2",this.children=[t,e].filter((t=>null!=t))}all(){return bt(this)}any(){return St(this)}clone(){const t=new h((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]));return super.cloneInto(t),t}};z.type="bvec2",z=h=(0,g._)([x],z);let D=d=class extends y.vL{constructor(t,e,i){super(),this.type="bvec3",this.children=[t,e,i].filter((t=>null!=t))}all(){return bt(this)}any(){return St(this)}clone(){const t=new d((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]));return super.cloneInto(t),t}};function L(t,e){return"number"==typeof t?new e(t):t}D.type="bvec3",D=d=(0,g._)([x],D);let F=f=class extends y.vL{constructor(t,e,i,n){super(),this.type="bvec4",this.children=[t,e,i,n].filter((t=>null!=t))}all(){return bt(this)}any(){return St(this)}clone(){const t=new f((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]),(0,y.vA)(this.children[3]));return super.cloneInto(t),t}};F.type="bvec4",F=f=(0,g._)([x],F);class V extends y.vL{constructor(t){super(),this.type="int",this.children=[t]}multiply(t){return ot(this,L(t,V))}add(t){return lt(this,L(t,V))}subtract(t){return ut(this,L(t,V))}divide(t){return at(this,L(t,V))}clone(){const t=new V((0,y.vA)(this.children[0]));return super.cloneInto(t),t}}V.type="int";let N=p=class extends y.vL{constructor(t,e){super(),this.type="ivec2",this.children=[t,e].filter((t=>null!=t))}clone(){const t=new p((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]));return super.cloneInto(t),t}};N.type="ivec2",N=p=(0,g._)([x],N);let k=_=class extends y.vL{constructor(t,e,i){super(),this.type="ivec3",this.children=[t,e,i].filter((t=>null!=t))}clone(){const t=new _((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]));return super.cloneInto(t),t}};k.type="ivec3",k=_=(0,g._)([x],k);let B=m=class extends y.vL{constructor(t,e,i,n){super(),this.type="ivec4",this.children=[t,e,i,n].filter((t=>null!=t))}clone(){const t=new m((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]),(0,y.vA)(this.children[3]));return super.cloneInto(t),t}};B.type="ivec4",B=m=(0,g._)([x],B);class U extends y.vL{constructor(t,e,i,n){super(),this.type="mat2",this.children=[t,e,i,n]}clone(){const t=new U((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]),(0,y.vA)(this.children[3]));return super.cloneInto(t),t}multiply(t){return ot(this,t)}}U.type="mat2";class G extends y.vL{static identity(){return new G(1,0,0,0,1,0,0,0,1)}static fromRotation(t){const e=Bt(t),i=It(t);return new G(i,e,0,it(e),i,0,0,0,1)}constructor(t,e,i,n,r,s,o,a,l){super(),this.type="mat3",this.children=[t,e,i,n,r,s,o,a,l]}add(t){return lt(this,t)}multiply(t){return ot(this,t)}clone(){const t=new G((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]),(0,y.vA)(this.children[3]),(0,y.vA)(this.children[4]),(0,y.vA)(this.children[5]),(0,y.vA)(this.children[6]),(0,y.vA)(this.children[7]),(0,y.vA)(this.children[8]));return super.cloneInto(t),t}}G.type="mat3";class Y extends y.vL{static identity(){return new Y(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}constructor(t,e,i,n,r,s,o,a,l,u,c,h,d,f,p,_){super(),this.type="mat4",this.children=[t,e,i,n,r,s,o,a,l,u,c,h,d,f,p,_]}static fromColumns(t,e,i,n){return new Y(t.x,t.y,t.z,t.w,e.x,e.y,e.z,e.w,i.x,i.y,i.z,i.w,n.x,n.y,n.z,n.w)}multiply(t){return ot(this,t)}clone(){const t=new Y((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]),(0,y.vA)(this.children[3]),(0,y.vA)(this.children[4]),(0,y.vA)(this.children[5]),(0,y.vA)(this.children[6]),(0,y.vA)(this.children[7]),(0,y.vA)(this.children[8]),(0,y.vA)(this.children[9]),(0,y.vA)(this.children[10]),(0,y.vA)(this.children[11]),(0,y.vA)(this.children[12]),(0,y.vA)(this.children[13]),(0,y.vA)(this.children[14]),(0,y.vA)(this.children[15]));return super.cloneInto(t),t}}Y.type="mat4";const Z={float:T,vec2:P,vec3:I,vec4:M,int:V,ivec2:N,ivec3:k,ivec4:B,uint:A,uvec2:C,uvec3:E,uvec4:R,bool:O,bvec2:z,bvec3:D,bvec4:F},H=(...t)=>new V(...t),W=(...t)=>new T(...t),$=(...t)=>new P(...t),j=(...t)=>new I(...t),q=(...t)=>new M(...t),X=(...t)=>new G(...t);function K(t,e,i){const n=new i(new y.zg(e,t,i));return n.isImplicit=!0,n}function Q(t,e,i,n=null){if(n){const r=new n,s=new n(new y.aw(t,[e,i],!0,!1,r));return s.isImplicit=!0,s}if("float"===e.type||"int"===e.type){const n=new i.constructor(new y.aw(t,[e,i],!0,!1,i.constructor));return n.isImplicit=!0,n}if(("mat2"===e.type||"mat3"===e.type||"mat4"===e.type)&&"float"!==i.type){const n=new i.constructor(new y.aw(t,[e,i],!0,!1,i.constructor));return n.isImplicit=!0,n}const r=new e.constructor(new y.aw(t,[e,i],!0,!1,e.constructor));return r.isImplicit=!0,r}function J(t,e,i=e.constructor){const n=new i(new y.aw(t,[e],!1,!1,i));return n.isImplicit=!0,n}function tt(t,e,i,n=e.constructor){const r=new n(new y.aw(t,[e,i],!1,!1,n));return r.isImplicit=!0,r}function et(t,e,i,n,r=e.constructor){const s=new r(new y.aw(t,[e,i,n],!1,!1,r));return s.isImplicit=!0,s}function it(t){return ot(t,W(-1))}function nt(t,e,i,n){return new e(new y.rR(t,e,i,n))}function rt(t,e,i){const n="function"==typeof e?e():e,r="function"==typeof i?i():i,s=new n.constructor(new y.XL(t,n,r));return s.isImplicit=!0,s}function st(...t){const e=t.map((([t,e])=>"function"==typeof e?[t,e()]:[t,e])),i=e[0][1].constructor,n=e.findIndex((t=>!0===t[0]));if(-1===n)throw new Error("A cond must have a fallthrough case with `true`/; ");const r=e.slice(0,n),s=e[n][1],o=new i(r.reduceRight(((t,e)=>rt(e[0],e[1],t)),s));return o.isImplicit=!0,o}function ot(t,e){return Q("*",t,e)}function at(t,e){return Q("/",t,e)}function lt(t,e){return Q("+",t,e)}function ut(t,e){return Q("-",t,e)}function ct(t,e){return Q("%",t,e)}function ht(t,e){return Q(">>",t,e)}function dt(t,e){return Q("&",t,e)}function ft(t,e){return Q("==",t,e,O)}function pt(t,e){return Q("<",t,e,O)}function _t(t,e){return Q("<=",t,e,O)}function mt(t,e){return Q(">",t,e,O)}function gt(t,e){return Q(">=",t,e,O)}function yt(...t){return t.length<=1?t[0]:t.slice(1).reduce(((t,e)=>function(t,e){return Q("||",t,e,O)}(t,e)),t[0])}function vt(...t){return t.length<=1?t[0]:t.slice(1).reduce(((t,e)=>function(t,e){return Q("&&",t,e,O)}(t,e)),t[0])}function xt(t){return J("abs",t)}function bt(t){return J("all",t,O)}function St(t){return J("any",t,O)}function wt(t,e){return null==e?J("atan",t):tt("atan",t,e,t.constructor)}function Tt(t){return J("ceil",t)}function Pt(t,e,i){return et("clamp",t,e,i,t.constructor)}function It(t){return J("cos",t)}function Mt(t,e){return tt("distance",t,e,T)}function At(t,e){return tt("dot",t,e,T)}function Ct(t){return J("floor",t)}function Et(t){return J("fract",t)}function Rt(t){return J("length",t,T)}function Ot(t,e){return tt("max",t,e)}function zt(t,e){return tt("min",t,e)}function Dt(t,e,i){return et("mix",t,e,i)}function Lt(t,e){return tt("mod",t,e)}function Ft(t){return J("normalize",t)}function Vt(t){return"bool"===t.type?J("!",t):J("not",t)}function Nt(t,e){return tt("pow",t,e)}function kt(t){return J("round",t)}function Bt(t){return J("sin",t)}function Ut(t,e,i){return et("smoothstep",t,e,i)}function Gt(t){return J("sqrt",t)}function Yt(t,e){return tt("step",t,e,e.constructor)}function Zt(t,e){return tt("texture",t,e,M)}},53400:function(t,e,i){i.d(e,{j:function(){return r}});var n=i(28230);class r{constructor(){this.drawPhase=n.S5.MAP|n.S5.HITTEST|n.S5.HIGHLIGHT|n.S5.DEBUG}startup(){}shutdown(t){}}},92543:function(t,e,i){i.d(e,{c:function(){return r}});var n=i(86329);class r{constructor(t,e,i){this._instanceId=t,this.techniqueRef=e,this._input=i}get instanceId(){return(0,n.P)(this._instanceId)}createMeshInfo(t){return{id:(0,n.P)(this._instanceId),techniqueType:this.techniqueRef.type,inputParams:t,optionalAttributes:this._input.optionalAttributes}}getInput(){return this._input}setInput(t){this._input=t}}},63812:function(t,e,i){i.d(e,{YS:function(){return le},n_:function(){return ce},Wn:function(){return ue}});var n=i(81728),r=i(53804),s=i(3247),o=i(98282),a=i(70931),l=i(99121);class u extends o.k2{}(0,r._)([(0,o.Pi)(a.nt)],u.prototype,"globalTime",void 0),(0,r._)([(0,o.Pi)(a.ZY)],u.prototype,"animationTextureSize",void 0),(0,r._)([(0,o.Pi)(a.z7)],u.prototype,"animationTexture",void 0),(0,r._)([(0,o.Pi)(a.U)],u.prototype,"toScreen",void 0),(0,r._)([(0,o.Pi)(a.U)],u.prototype,"toNdc",void 0),(0,r._)([(0,o.Pi)(a.nt)],u.prototype,"mapRotation",void 0),(0,r._)([(0,o.Pi)(a.nt)],u.prototype,"pixelRatio",void 0);var c=i(33702),h=i(40846),d=i(39979),f=i(86486),p=i(81432),_=i(12026);class m extends o.k2{getVVRotationMat4(t){return(0,a.Tk)((0,f.M8)(t),a.$I.identity(),(()=>{const e=this.getNormalizedAngle(t).multiply(h.os),i=(0,a.F8)(e),n=(0,a.gn)(e);return new a.$I(n,i,0,0,i.multiply(new a.nt(-1)),n,0,0,0,0,1,0,0,0,0,1)}))}getVVRotationMat3(t){return(0,a.Tk)((0,f.M8)(t),a.U.identity(),(()=>{const e=this.getNormalizedAngle(t).multiply(h.os),i=(0,a.F8)(e),n=(0,a.gn)(e);return new a.U(n,i,0,i.multiply(new a.nt(-1)),n,0,0,0,1)}))}getNormalizedAngle(t){const e=(0,a.LC)(this.rotationType,new a.nt(h.H_.Arithmatic));return(0,a.Tk)(e,new a.nt(90).subtract(t),t)}}(0,r._)([(0,o.Pi)(a.nt)],m.prototype,"rotationType",void 0);var g,y=i(13635),v=i(21385),x=i(21813),b=i(76347),S=i(90906);class w extends c.rz{}(0,r._)([(0,o.C5)(3,a.Zb)],w.prototype,"animationPointerAndBaseSizeAndReferenceSize",void 0),(0,r._)([(0,o.C5)(4,a.ZY)],w.prototype,"zoomRange",void 0);class T extends c.DM{}class P extends c.f_{_getScreenPosition(t){const{pos:e,translation:i,rotation:n,scale:r,offset:s,id:o,vvScale:l}=t,u=(0,S.g_)(this,o).multiply(Math.PI/180),c=i.x.multiply(4/3),h=i.y.multiply(-1).multiply(4/3),d=(0,a.F8)(n.subtract(u)),f=(0,a.gn)(n.subtract(u)),p=new a.nt(0),_=new a.nt(1),{pixelRatio:m}=this.animationInfo,g=new a.U(_,p,p,p,_,p,c.multiply(m),h.multiply(m),_),y=new a.U(f,d.multiply(-1),p,d,f,p,0,0,_),v=r.multiply(l).multiply(m).multiply(4/3),x=y.multiply(v),b=this.animationInfo.toScreen.multiply(new a.eB(e,1)),w=g.multiply(b).xy,T=x.multiply(new a.eB(s,0)).xy;return w.add(T)}_clip(t,e){let i=super.clip(t,e);const n=(0,a.$5)(this._getLocalTimeOrigin(t),new a.nt(0));return s.H.forceGlobalTimeOrigin||(i=i.add((0,a.j1)([n,()=>new a.nt(2)],[!0,()=>new a.nt(0)]))),i}_getLocalTimeOrigin(t){return this.storage.getLocalTimeOrigin(t)}_toNdc(t){return this.animationInfo.toNdc.multiply(new a.eB(t,1)).xy}_getEvalParams(t,e){const{globalTime:i,animationTextureSize:n,animationTexture:r}=this.animationInfo;return{globalTime:i,localTimeOrigin:this._getLocalTimeOrigin(t.id),animationTextureSize:n,animationTexture:r,pixelDimensions:e}}_getColor(t,e){return(0,a.Tk)((0,a.LC)(e.isSDF,new a.nt(1)),this._getSDFColor(t,e),this._getSpriteColor(t,e))}_getSpriteColor(t,e){return(0,a.US)(this.mosaicInfo.texture,t).multiply(e.color)}_getSDFColor(t,e){const i=(0,a.US)(this.mosaicInfo.texture,t),n=new a.nt(.5).subtract((0,f.Rj)(i)).multiply(e.distanceToPx).multiply(h.V5),r=(0,a.qE)(new a.nt(.5).subtract(n),new a.nt(0),new a.nt(1)),s=e.color.multiply(r),o=e.outlineSize.multiply(.5),l=(0,a.tn)(n).subtract(o),u=(0,a.qE)(new a.nt(.5).subtract(l),new a.nt(0),new a.nt(1)),c=e.outlineColor.multiply(u);return new a.nt(1).subtract(c.a).multiply(s).add(c)}}function I(t,e,i){const n=t.add(new a.ZY(e,0)),r=(0,a.US)(i.animationTexture,n.add(.5).divide(i.animationTextureSize)).xy;return t=t.add(r),(0,a.om)({animationPointer:t,...i},a.Zb,null,(t=>{const{out:e}=t;if(!e)throw new Error("out is null");return(0,l.DW)({...t,out:e})}))}(0,r._)([(0,o.Pi)(d.b)],P.prototype,"mosaicInfo",void 0),(0,r._)([(0,o.Pi)(u)],P.prototype,"animationInfo",void 0),(0,r._)([(0,o.uK)(p._)],P.prototype,"visualVariableColor",void 0),(0,r._)([(0,o.uK)(_.i)],P.prototype,"visualVariableOpacity",void 0),(0,r._)([(0,o.uK)(y.n)],P.prototype,"visualVariableSizeMinMaxValue",void 0),(0,r._)([(0,o.uK)(v.F)],P.prototype,"visualVariableSizeScaleStops",void 0),(0,r._)([(0,o.uK)(x.N)],P.prototype,"visualVariableSizeStops",void 0),(0,r._)([(0,o.uK)(b.d)],P.prototype,"visualVariableSizeUnitValue",void 0),(0,r._)([(0,o.uK)(m)],P.prototype,"visualVariableRotation",void 0),function(t){t[t.transform=0]="transform",t[t.fromColor=1]="fromColor",t[t.toColor=2]="toColor",t[t.colorMix=3]="colorMix",t[t.toOpacity=4]="toOpacity",t[t.opacityMix=5]="opacityMix"}(g||(g={}));var M=i(97473),A=i(66425);class C extends w{}(0,r._)([(0,o.C5)(5,a.ZY)],C.prototype,"offset",void 0),(0,r._)([(0,o.C5)(6,a.ZY)],C.prototype,"uv",void 0),(0,r._)([(0,o.C5)(7,a.Zb)],C.prototype,"sizing",void 0),(0,r._)([(0,o.C5)(8,a.nt)],C.prototype,"angle",void 0);class E extends o.Y7{}function R(t,e,i,n){return e.multiply(t.x).add(i.multiply(t.y)).add(n.multiply(t.z))}(0,r._)([(0,o.C5)(12,a.ZY)],E.prototype,"offsetNextVertex1",void 0),(0,r._)([(0,o.C5)(13,a.ZY)],E.prototype,"offsetNextVertex2",void 0),(0,r._)([(0,o.C5)(14,a.ZY)],E.prototype,"textureUVNextVertex1",void 0),(0,r._)([(0,o.C5)(15,a.ZY)],E.prototype,"textureUVNextVertex2",void 0);class O extends P{constructor(){super(...arguments),this.computeAttributes={offset:["offsetNextVertex1","offsetNextVertex2"],uv:["textureUVNextVertex1","textureUVNextVertex2"]}}_vertexPreamble(t){const{id:e,pos:i,offset:n,animationPointerAndBaseSizeAndReferenceSize:r,uv:s,sizing:o,angle:l}=t,u=r.xy,c=r.z,d=r.w,p=o.xy,_=o.z,m=(0,f.mh)(t.bitset,M.c.bitset.isStroke),y=o.w,v=(0,f.mh)(t.bitset,M.c.bitset.scaleSymbolsProportionally),x=this._getEvalParams(t,p),b=I(u,g.transform,x),w=(0,a.j1)([(0,a.LC)((0,f.mh)(t.bitset,M.c.bitset.isMapAligned),new a.nt(1)),this.view.rotation.divide(180).multiply(Math.PI)],[!0,new a.nt(0)]),T=new a.Ny((0,a.gn)(w),(0,a.F8)(w.multiply(-1)),(0,a.F8)(w),(0,a.gn)(w)).multiply(b.xy),P=b.z.subtract(w).subtract(l.multiply(h.rp)),A=b.w,C=(0,f.mh)(t.bitset,M.c.bitset.isSDF),E=(0,S.Mg)(this,e,new a.nt(d)).divide(new a.nt(d));return{baseSize:c,animationPointer:u,strokeWidth:_,isOutline:m,unscaledDistanceToPx:y,scaleSymbolsProportionally:v,isSDF:C,position:this._getScreenPosition({id:e,pos:i,offset:n,referenceSize:d,translation:T,rotation:P,scale:A,vvScale:E}),uv:s,evalParams:x,vvScale:E,scale:A}}vertex(t,e){const{position:i,animationPointer:n,evalParams:r,isOutline:s,unscaledDistanceToPx:o,vvScale:l,uv:u,strokeWidth:c,scaleSymbolsProportionally:h,scale:d,isSDF:p,baseSize:_}=this._vertexPreamble(t),m=this._toNdc(i);let y=I(n,g.fromColor,r);y=new a.Zb(y.rgb.multiply(y.a),y.a);let v=I(n,g.toColor,r);v=new a.Zb(v.rgb.multiply(v.a),v.a);let x=I(n,g.colorMix,r);x=new a.Zb(x.rgb.multiply(x.a),x.a);const b=I(n,g.toOpacity,r).a,w=I(n,g.opacityMix,r).a,T=(0,S.G7)(this,t.id,y,(0,a.or)((0,f.K5)(t.bitset,M.c.bitset.colorLocked),new a.x(s))),P=(0,a.jh)(T,v,x),A=(0,S.cF)(this,t.id),C=(0,a.jh)(A,b,w),E=P.multiply(C),R=this.clip(t.id,t.zoomRange),O=o.multiply(l);return{glPosition:new a.Zb(m,R,1),uv:u.divide(this.mosaicInfo.size),color:E.multiply(new a.nt(1).subtract(s)),outlineColor:E.multiply(s),distanceToPx:O,strokeWidth:c.multiply((0,a.jh)(new a.nt(1),d,h)),isOutline:s,isSDF:p,...this.maybeRunHittest(t,e,{pos:t.pos,size:_,sizeCorrection:new a.nt(1),isMapAligned:new a.nt(1),vvRotationMat3:new a.U(1,0,0,0,1,0,0,0,1),placementMat3:new a.U(1,0,0,0,1,0,0,0,1),outlineSize:new a.nt(1),distanceToPx:O,isSDF:p})}}fragment(t){let e=this._getColor(t.uv,{color:t.color,distanceToPx:t.distanceToPx,isSDF:t.isSDF,outlineColor:t.outlineColor,outlineSize:t.strokeWidth});return s.H.spotlightAnimatedSymbols&&(e=e.add(new a.Zb(0,.3,0,.3))),this.getFragmentOutput(e,t)}hittest(t,e,i){return(0,a.Tk)((0,a.Xe)(i.size,this.hittestRequest.smallSymbolSizeThreshold),this._hittestSmallMarker(t,e,i),this._hittestMarker(t,e,i))}_hittestSmallMarker(t,e,i){const{position:n,distance:r,smallSymbolDistance:s}=this.hittestRequest,o=r.subtract(s),{viewMat3:l,tileMat3:u}=this.view,c=l.multiply(u).multiply(new a.eB(i.pos,1)).xy,h=i.size.multiply(.5);return(0,a.Io)(c,n).subtract(h).add(o)}_hittestMarker(t,e,i){const n=this._vertexPreamble({...t}).position,r=this._vertexPreamble({...t,offset:e.offsetNextVertex1,uv:e.textureUVNextVertex1}).position,s=this._vertexPreamble({...t,offset:e.offsetNextVertex2,uv:e.textureUVNextVertex2}).position,o=this.hittestRequest.position,l=this.hittestRequest.distance,u=(0,A.Bo)(o,n,r,s);return(0,a.Tk)((0,a.MM)(u,l),u,this._hittestSamples(n,r,s,t,e,i))}_hittestSamples(t,e,i,n,r,s){const{outlineSize:o,isSDF:l,distanceToPx:u}=s,c=this.hittestRequest.position,h=this.hittestRequest.distance,d=(0,A.Bs)(c.add(new a.ZY((0,a.ze)(h),(0,a.ze)(h))),t,e,i),f=(0,A.Bs)(c.add(new a.ZY(0,(0,a.ze)(h))),t,e,i),p=(0,A.Bs)(c.add(new a.ZY(h,(0,a.ze)(h))),t,e,i),_=(0,A.Bs)(c.add(new a.ZY((0,a.ze)(h),0)),t,e,i),m=(0,A.Bs)(c,t,e,i),g=(0,A.Bs)(c.add(new a.ZY(h,0)),t,e,i),y=(0,A.Bs)(c.add(new a.ZY((0,a.ze)(h),h)),t,e,i),v=(0,A.Bs)(c.add(new a.ZY(0,h)),t,e,i),x=(0,A.Bs)(c.add(new a.ZY(h,h)),t,e,i),b=n.uv.divide(this.mosaicInfo.size),S=r.textureUVNextVertex1.divide(this.mosaicInfo.size),w=r.textureUVNextVertex2.divide(this.mosaicInfo.size),T={color:new a.Zb(1,1,1,1),outlineSize:o,outlineColor:new a.Zb(1,1,1,1),isSDF:l,distanceToPx:u};let P=new a.nt(0);return P=P.add((0,A.kW)(d).multiply(this._getColor(R(d,b,S,w),T).a)),P=P.add((0,A.kW)(f).multiply(this._getColor(R(f,b,S,w),T).a)),P=P.add((0,A.kW)(p).multiply(this._getColor(R(p,b,S,w),T).a)),P=P.add((0,A.kW)(_).multiply(this._getColor(R(_,b,S,w),T).a)),P=P.add((0,A.kW)(m).multiply(this._getColor(R(m,b,S,w),T).a)),P=P.add((0,A.kW)(g).multiply(this._getColor(R(g,b,S,w),T).a)),P=P.add((0,A.kW)(y).multiply(this._getColor(R(y,b,S,w),T).a)),P=P.add((0,A.kW)(v).multiply(this._getColor(R(v,b,S,w),T).a)),P=P.add((0,A.kW)(x).multiply(this._getColor(R(x,b,S,w),T).a)),(0,a.PM)(P,new a.nt(.05)).multiply((0,A.My)(this.hittestRequest))}}(0,r._)([(0,r.a)(0,(0,o.hF)(C)),(0,r.a)(1,(0,o.hF)(E))],O.prototype,"vertex",null),(0,r._)([(0,r.a)(0,(0,o.hF)(class extends T{}))],O.prototype,"fragment",null);var z=i(44705),D=i(25090),L=i(28230),F=i(53400);class V extends F.j{constructor(){super(...arguments),this.symbologyPlane=L.uC.FILL,this._input=null}}var N=i(86847);class k extends V{render(t,e){const{context:i,painter:n}=t,{target:r}=e,{freezeGlobalTime:o}=s.H,a=n.textureManager.animationStore.getTexture(i,0),l=[2/t.state.size[0],0,0,0,-2/t.state.size[1],0,-1,1,1],u=Array.from((0,z.B8)((0,D.vt)(),l)),c=Array.from((0,z.lw)((0,D.vt)(),u,r.transforms.displayViewScreenMat3)),h=e.instance.getInput();n.setShader({shader:this.shaders.geometry,uniforms:{...(0,N.r3)(t,e.target,h.uniforms),...(0,N.QA)(t,e.target),mosaicInfo:n.textureManager.getMosaicInfo(i,e.textureKey,!0),animationInfo:{globalTime:!1===o?t.time/1e3:o,animationTextureSize:[a.descriptor.width,a.descriptor.height],animationTexture:{unit:6,texture:a},toScreen:c,toNdc:l,mapRotation:t.state.rotation,pixelRatio:t.state.pixelRatio}},defines:{...(0,N.vT)(t)},optionalAttributes:{zoomRange:!0},useComputeBuffer:!0}),n.setPipelineState({...(0,N.Qu)(t)}),n.submitDraw(t,e),!1===o&&r.requestRender()}}var B=i(39686),U=i(97673),G=i(64522);class Y extends o.ZA{}(0,r._)([(0,o.C5)(0,a.ZY)],Y.prototype,"pos",void 0);class Z extends c.DM{}class H extends o.k2{}(0,r._)([(0,o.Pi)(a.nt)],H.prototype,"dotSize",void 0);class W extends o.k2{}(0,r._)([(0,o.Pi)(a.z7)],W.prototype,"locations",void 0),(0,r._)([(0,o.Pi)(a.nt)],W.prototype,"pixelRatio",void 0),(0,r._)([(0,o.Pi)(a.nt)],W.prototype,"tileZoomFactor",void 0);class $ extends o.A{vertex(t){const e=new a.U(1,0,0,0,-1,0,0,1,1).multiply(new a.eB(t.pos.xy.divide(B.CQ),1)),i=(0,a.US)(this.draw.locations,e.xy),n=(0,a.T9)(this.instance.dotSize.divide(2),new a.nt(1));let r=new a.nt(0);r=r.add((0,a.PM)(i.a,new a.nt(1e-6)).multiply(2));let s=n.add(this.instance.dotSize);const o=this.view.displayViewScreenMat3.multiply(new a.eB(t.pos.add(.5),1)),l=new a.Zb(o.xy,r,1),u=this.instance.dotSize.divide(s),c=new a.nt(-1).divide(n.divide(s));return s=s.multiply(this.draw.pixelRatio.multiply(this.draw.tileZoomFactor)),{glPosition:l,glPointSize:s,color:i,ratio:u,invEdgeRatio:c}}fragment(t){const e=(0,a.Bw)(t.glPointCoord.subtract(.5)).multiply(2),i=(0,a.TF)(new a.nt(0),new a.nt(1),t.invEdgeRatio.multiply(e.subtract(t.ratio)).add(1)),n=new o.mm;return n.glFragColor=t.color.multiply(i),n}}(0,r._)([(0,o.Pi)(H)],$.prototype,"instance",void 0),(0,r._)([(0,o.Pi)(W)],$.prototype,"draw",void 0),(0,r._)([(0,o.Pi)(G.o)],$.prototype,"view",void 0),(0,r._)([(0,r.a)(0,(0,o.hF)(Y))],$.prototype,"vertex",null),(0,r._)([(0,r.a)(0,(0,o.hF)(Z))],$.prototype,"fragment",null);class j extends c.rz{}(0,r._)([(0,o.C5)(3,a.nt)],j.prototype,"inverseArea",void 0);class q extends o.k2{}(0,r._)([(0,o.Pi)(a.My.ofType(a.Zb,2))],q.prototype,"isActive",void 0),(0,r._)([(0,o.Pi)(a.My.ofType(a.Zb,8))],q.prototype,"colors",void 0),(0,r._)([(0,o.Pi)(a.nt)],q.prototype,"dotValue",void 0);class X extends o.k2{}(0,r._)([(0,o.Pi)(a.z7)],X.prototype,"dotTexture0",void 0),(0,r._)([(0,o.Pi)(a.z7)],X.prototype,"dotTexture1",void 0),(0,r._)([(0,o.Pi)(a.nt)],X.prototype,"tileZoomFactor",void 0),(0,r._)([(0,o.Pi)(a.nt)],X.prototype,"pixelRatio",void 0),(0,r._)([(0,o.Pi)(a.nt)],X.prototype,"tileDotsOverArea",void 0);class K extends c.f_{_dotThreshold(t,e,i){return t.divide(e).divide(i)}vertex(t){const e=new a.U(2/B.CQ,0,0,0,-2/B.CQ,0,-1,1,1).multiply(new a.eB(t.pos,1)),i=this.clip(t.id),n=new a.Zb(e.xy,i,1),r=this.storage.getVVData(t.id).multiply(this.instance.isActive.get(0)).multiply(t.inverseArea),s=this.storage.getDataDrivenData0(t.id).multiply(this.instance.isActive.get(1)).multiply(t.inverseArea),o=this.draw.tileZoomFactor.multiply(B.CQ).divide(this.draw.pixelRatio),l=this._dotThreshold(r,this.instance.dotValue,this.draw.tileDotsOverArea),u=this._dotThreshold(s,this.instance.dotValue,this.draw.tileDotsOverArea),c=t.pos.add(.5).divide(o);return{glPosition:n,color:new a.Zb(0,0,0,0),textureCoords:c,thresholds0:l,thresholds1:u}}fragment(t){const e=new o.mm,i=(0,a.US)(this.draw.dotTexture0,t.textureCoords),n=(0,a.US)(this.draw.dotTexture1,t.textureCoords),r=t.thresholds0.subtract(i),s=t.thresholds1.subtract(n);let l;const u=a.$I.fromColumns(this.instance.colors[0],this.instance.colors[1],this.instance.colors[2],this.instance.colors[3]),c=a.$I.fromColumns(this.instance.colors[4],this.instance.colors[5],this.instance.colors[6],this.instance.colors[7]);if(this.blending){const t=(0,a.PM)(new a.nt(0),r),e=(0,a.PM)(new a.nt(0),s),i=(0,a.Om)(t,r).add((0,a.Om)(e,s)),n=(0,a.PM)(i,new a.nt(0)),o=new a.nt(1).subtract(n),h=i.add(n),d=r.multiply(t).divide(h),f=s.multiply(e).divide(h),p=u.multiply(d).add(c.multiply(f));l=o.multiply(p)}else{const t=(0,a.T9)((0,f.xf)(r),(0,f.xf)(s)),e=(0,a.PM)(t,new a.nt(0)),i=new a.nt(1).subtract(e),n=(0,a.PM)(t,r),o=(0,a.PM)(t,s),h=u.multiply(n).add(c.multiply(o));l=i.multiply(h)}return e.glFragColor=l,e}hittest(t){return(0,A.My)(this.hittestRequest)}}(0,r._)([o.E8],K.prototype,"blending",void 0),(0,r._)([(0,o.Pi)(q)],K.prototype,"instance",void 0),(0,r._)([(0,o.Pi)(X)],K.prototype,"draw",void 0),(0,r._)([(0,r.a)(0,(0,o.hF)(j))],K.prototype,"vertex",null),(0,r._)([(0,r.a)(0,(0,o.hF)(c.DM))],K.prototype,"fragment",null);var Q=i(13798),J=i(61117),tt=i(85456),et=i(96402),it=i(49414),nt=i(15167),rt=i(12285),st=i(10956);const ot={pos:{count:2,type:tt.pe.UNSIGNED_SHORT}};class at{constructor(){this._dotTextureSize=0,this._dotTextures=null,this._dotMesh=null}destroy(){this._disposeTextures(),this._dotFBO&&this._dotFBO.dispose(),this._dotMesh&&this._dotMesh.destroy()}getFBO(t){if(null==this._dotFBO){const e=B.CQ,i=B.CQ,n=new st.R(e,i);n.samplingMode=tt.Cj.NEAREST,n.wrapMode=tt.pF.CLAMP_TO_EDGE;const r=new it.l(t,new nt.q(tt.yQ.DEPTH_STENCIL,e,i));this._dotFBO=new et.H(t,n,r)}return this._dotFBO}getDotDensityMesh(t,e){if(null==this._dotMesh){const i=B.CQ,n=i*i,r=2,s=new Int16Array(n*r);for(let t=0;t<i;t++)for(let e=0;e<i;e++)s[r*(e+t*i)]=e,s[r*(e+t*i)+1]=t;this._dotMesh=J.g.create(t,{primitive:tt.WR.POINTS,vertex:s,count:n,layout:ot},e)}return this._dotMesh}getDotDensityTextures(t,e,i){if(this._dotTextureSize===e&&this._seed===i||(this._disposeTextures(),this._dotTextureSize=e,this._seed=i),null===this._dotTextures){const n=new Q.A(i);this._dotTextures=[this._allocDotDensityTexture(t,e,n),this._allocDotDensityTexture(t,e,n)]}return this._dotTextures}_disposeTextures(){if(this._dotTextures){for(let t=0;t<this._dotTextures.length;t++)this._dotTextures[t].dispose();this._dotTextures=null}}_allocDotDensityTexture(t,e,i){const n=new Float32Array(e*e*4);for(let t=0;t<n.length;t++)n[t]=i.getFloat();const r=new st.R;return r.dataType=tt.ld.FLOAT,r.samplingMode=tt.Cj.NEAREST,r.width=e,r.height=e,new rt.g(t,r,n)}}var lt=i(42203),ut=i(58991);function ct(t){const e=1/t;return{antialiasing:e,blur:0+e}}var ht=i(47461),dt=i(54537),ft=i(51741),pt=i(15087),_t=i(40633),mt=i(95929),gt=i(39819);class yt{constructor(t,e,i,n){this.dataType=t,this.samplingMode=e,this.pixelFormat=i,this.internalFormat=n}}new yt(tt.ld.HALF_FLOAT,tt.Cj.NEAREST,tt.Ab.RGBA,tt.Ab.RGBA);class vt{destroy(){this._accumulateFramebuffer=(0,mt.WD)(this._accumulateFramebuffer),this._resolveGradientTexture=(0,mt.WD)(this._resolveGradientTexture),this._prevGradientHash=null,this._qualityProfile=null}get initialized(){return null!=this._accumulateFramebuffer&&null!=this._resolveGradientTexture}get accumulateFramebuffer(){return this._accumulateFramebuffer}get resolveGradientTexture(){return this._resolveGradientTexture}loadQualityProfile(t){if(null==this._qualityProfile){const e=function(t,e){const{textureFloatLinear:i,colorBufferFloat:n}=t.capabilities,r=n?.textureFloat,s=n?.textureHalfFloat,o=n?.floatBlend,a=t.driverTest.floatBufferBlend.result;if(!r&&!s)throw new gt.A("heatmap:missing-color-buffer-float","HeatmapRenderer requires the WebGL extension EXT_color_buffer_float or EXT_color_buffer_half_float or WEBGL_color_buffer_float.");if(!(o&&a||s))throw new gt.A("heatmap:missing-float-blend","HeatmapRenderer requires the WebGL extension EXT_float_blend or EXT_color_buffer_half_float."+(a?"":" This device claims support for EXT_float_blend, but does not actually support it."));const l=r&&o&&a,u=s,c=i,h=!!n?.R32F,d=!!n?.R16F;if(l&&c)return c||e.warnOnce("Missing WebGL extension OES_texture_float_linear. Heatmap quality may be reduced."),new yt(tt.ld.FLOAT,c?tt.Cj.LINEAR:tt.Cj.NEAREST,h?tt.Ab.RED:tt.Ab.RGBA,h?tt.H0.R32F:tt.Ab.RGBA);if(u)return new yt(tt.ld.HALF_FLOAT,tt.Cj.LINEAR,d?tt.Ab.RED:tt.Ab.RGBA,d?tt.H0.R16F:tt.Ab.RGBA);throw new gt.A("heatmap:missing-hardware-support","HeatmapRenderer requires WebGL extensions that allow it to render and blend to float or half float textures.")}(t,_t.A.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.heatmap.HeatmapResources"));this._qualityProfile={...e,defines:{usesHalfFloatPrecision:e.dataType!==tt.ld.FLOAT}}}return this._qualityProfile}ensureAccumulateFBO(t,e,i){if(null==this._accumulateFramebuffer){const{dataType:n,samplingMode:r,pixelFormat:s,internalFormat:o}=this.loadQualityProfile(t),a=new st.R(e,i);a.pixelFormat=s,a.internalFormat=o,a.dataType=n,a.samplingMode=r,a.wrapMode=tt.pF.CLAMP_TO_EDGE;const l=new nt.q(tt.yQ.DEPTH_STENCIL,e,i);this._accumulateFramebuffer=new et.H(t,a,l)}else{const{width:t,height:n}=this._accumulateFramebuffer;t===e&&n===i||this._accumulateFramebuffer.resize(e,i)}return this._accumulateFramebuffer}ensureResolveGradientTexture(t,e,i){if(null==this._resolveGradientTexture){const e=new st.R;e.wrapMode=tt.pF.CLAMP_TO_EDGE,this._resolveGradientTexture=new rt.g(t,e)}else this._prevGradientHash!==e&&(this._resolveGradientTexture.resize(i.length/4,1),this._resolveGradientTexture.setData(i),this._prevGradientHash=e);return this._resolveGradientTexture}}function xt(t){return t?.25:1}class bt extends c.rz{}(0,r._)([(0,o.C5)(5,a.ZY)],bt.prototype,"offset",void 0);class St extends c.DM{}class wt extends o.k2{}(0,r._)([(0,o.Pi)(a.nt)],wt.prototype,"radius",void 0),(0,r._)([(0,o.Pi)(a.nt)],wt.prototype,"isFieldActive",void 0);class Tt extends c.f_{constructor(){super(...arguments),this.usesHalfFloatPrecision=!1}vertex(t){const{radius:e,isFieldActive:i}=this.kernelControls,n=t.offset,r=i.multiply(this.storage.getVVData(t.id).x).add(new a.nt(1).subtract(i)),s=this.view.displayViewScreenMat3.multiply(new a.eB(t.pos,1)).add(this.view.displayViewMat3.multiply(new a.eB(n,0)).multiply(e)),o=this.clip(t.id);return{glPosition:new a.Zb(s.xy,o,1),offset:n,fieldValue:r,color:new a.Zb(0),...this.maybeRunHittest(t,{},null)}}fragment(t){const{offset:e,fieldValue:i}=t,n=(0,a.Bw)(e),r=(0,a.PM)(n,new a.nt(1)),s=new a.nt(1).subtract(n.multiply(n)),o=s.multiply(s),l=r.multiply(o).multiply(i).multiply(new a.nt(xt(this.usesHalfFloatPrecision)));return this.getFragmentOutput(new a.Zb(l),t)}hittest(t){const{viewMat3:e,tileMat3:i}=this.view,n=e.multiply(i).multiply(new a.eB(t.pos,1));return(0,A.g$)(n.xy,this.kernelControls.radius,this.hittestRequest.position)}}(0,r._)([o.E8],Tt.prototype,"usesHalfFloatPrecision",void 0),(0,r._)([(0,o.Pi)(wt)],Tt.prototype,"kernelControls",void 0),(0,r._)([(0,r.a)(0,(0,o.hF)(bt))],Tt.prototype,"vertex",null),(0,r._)([(0,r.a)(0,(0,o.hF)(St))],Tt.prototype,"fragment",null);class Pt extends o.ZA{}(0,r._)([(0,o.C5)(0,a.ZY)],Pt.prototype,"position",void 0);class It extends o.HS{}class Mt extends o.k2{}(0,r._)([(0,o.Pi)(a.z7)],Mt.prototype,"texture",void 0),(0,r._)([(0,o.Pi)(a.ZY)],Mt.prototype,"minAndInvRange",void 0),(0,r._)([(0,o.Pi)(a.nt)],Mt.prototype,"normalization",void 0);class At extends o.k2{}(0,r._)([(0,o.Pi)(a.z7)],At.prototype,"texture",void 0);class Ct extends o.A{constructor(){super(...arguments),this.usesHalfFloatPrecision=!1}vertex(t){return{glPosition:new a.Zb(t.position.multiply(2).subtract(1),1,1),uv:t.position}}fragment(t){const{accumulatedDensity:e,gradient:i}=this;let n=(0,a.US)(e.texture,t.uv).r.divide(new a.nt(xt(this.usesHalfFloatPrecision)));n=n.multiply(e.normalization),n=n.subtract(e.minAndInvRange.x).multiply(e.minAndInvRange.y);const r=(0,a.US)(i.texture,new a.ZY(n,.5)),s=new o.mm;return s.glFragColor=new a.Zb(r.rgb.multiply(r.a),r.a),s}}function Et(t){return t.key.level+1}(0,r._)([o.E8],Ct.prototype,"usesHalfFloatPrecision",void 0),(0,r._)([(0,o.Pi)(Mt)],Ct.prototype,"accumulatedDensity",void 0),(0,r._)([(0,o.Pi)(At)],Ct.prototype,"gradient",void 0),(0,r._)([(0,r.a)(0,(0,o.hF)(Pt))],Ct.prototype,"vertex",null),(0,r._)([(0,r.a)(0,(0,o.hF)(It))],Ct.prototype,"fragment",null);const Rt={color:{write:[!0,!0,!0,!0],blendMode:"additive"},depth:!1,stencil:{write:!1,test:{ref:Et,compare:tt.MT.GEQUAL,mask:255,op:{fail:tt.eA.KEEP,zFail:tt.eA.KEEP,zPass:tt.eA.REPLACE}}}},Ot={...Rt,stencil:!1},zt={color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1};function Dt(t,e){const{referenceScale:i,radius:n}=t.uniforms;return n*(0!==i?i/e.scale:1)}const Lt=360/254;var Ft;!function(t){t[t.Color=0]="Color",t[t.Outline=1]="Outline",t[t.Halo=2]="Halo"}(Ft||(Ft={}));class Vt extends c.rz{}(0,r._)([(0,o.C5)(3,a.Zb)],Vt.prototype,"color",void 0),(0,r._)([(0,o.C5)(4,a.ZY)],Vt.prototype,"offset",void 0),(0,r._)([(0,o.C5)(5,a.ZY)],Vt.prototype,"textureUV",void 0),(0,r._)([(0,o.C5)(6,a.nt)],Vt.prototype,"fontSize",void 0),(0,r._)([(0,o.C5)(7,a.nt)],Vt.prototype,"referenceSize",void 0),(0,r._)([(0,o.C5)(8,a.Zb)],Vt.prototype,"outlineColor",void 0),(0,r._)([(0,o.C5)(9,a.Zb)],Vt.prototype,"haloColor",void 0),(0,r._)([(0,o.C5)(10,a.ZY)],Vt.prototype,"outlineAndHaloSize",void 0),(0,r._)([(0,o.C5)(11,a.ZY)],Vt.prototype,"zoomRange",void 0),(0,r._)([(0,o.C5)(12,a.nt)],Vt.prototype,"clipAngle",void 0),(0,r._)([(0,o.C5)(13,a.Zb)],Vt.prototype,"referenceSymbol",void 0);class Nt extends o.Y7{}(0,r._)([(0,o.C5)(14,a.ZY)],Nt.prototype,"offsetNextVertex1",void 0),(0,r._)([(0,o.C5)(15,a.ZY)],Nt.prototype,"offsetNextVertex2",void 0);class kt extends c.DM{}class Bt extends c.f_{constructor(){super(...arguments),this.computeAttributes={offset:["offsetNextVertex1","offsetNextVertex2"]},this.textRenderPassType=Ft.Color,this.isBackgroundPass=!1,this.isLabel=!1}clipLabel(t,e,i){const n=e.multiply(Lt),r=(0,a.tn)(this.view.rotation.subtract(n)),s=(0,a.jk)(new a.nt(360).subtract(r),r);let o=new a.nt(0);const l=(0,a.RI)(this.view.currentZoom.multiply(B.fq)).divide(B.fq),u=t.x,c=t.y,h=new a.nt(1).subtract((0,a.PM)(u,l)).multiply(2),d=(0,a.PM)(new a.nt(90),s).multiply(2),f=new a.nt(2).multiply(new a.nt(1).subtract((0,a.PM)(l,c)));return o=o.add(i.multiply(h)),o=o.add(i.multiply(d)),o=o.add(f),o}vertex(t,e){const i=(0,f.mh)(t.bitset,h.bg),n=new a.nt(1).subtract(i);let r=t.fontSize,s=r.divide(h.au);const o=this.textRenderPassType===Ft.Outline?t.outlineColor:this.textRenderPassType===Ft.Halo?t.haloColor:this._getVertexColor(t),l=this.isLabel?this.storage.getLabelVisibility(t.id):new a.nt(1),u=this.isLabel?o.multiply(l):o,c=this.view.displayViewScreenMat3.multiply(new a.eB(t.pos,1));let d=t.offset,p=new a.nt(1),_=a.U.identity(),m=new a.ZY(0);if(this.isLabel){if(!t.referenceSymbol)throw new Error("InternalError: Optional attribute 'referenceSymbol' expected for labels");const e=t.referenceSymbol,i=e.xy,n=e.z,r=this._unpackDirection(e.w),s=(0,S.Mg)(this,t.id,n).divide(2),o=r.multiply(s.add(B.C2));m=i.add(o),d=d.add(m)}else p=(0,S.Mg)(this,t.id,t.referenceSize).divide(t.referenceSize),r=r.multiply(p),s=s.multiply(p),d=d.multiply(p),_=(0,S.TL)(this,t.id),d=_.multiply(new a.eB(d,0)).xy;const g=(0,f.mh)(t.bitset,h.ti),y=this._getViewRotationMatrix(g).multiply(new a.eB(d,0));let v=this.isLabel?this.clipLabel(t.zoomRange,t.clipAngle,g):this.clip(t.id,t.zoomRange);v=this.isBackgroundPass?v.add(n.multiply(2)):v.add(i.multiply(2));const x=this.isLabel?(0,a.or)((0,a.MM)(v,new a.nt(1)),(0,a.LC)(l,new a.nt(0))):new a.x(!1),b=new a.Zb(c.xy.add(y.xy),v,1),w=t.textureUV.divide(this.mosaicInfo.size);let T=new a.nt(0);if(this.textRenderPassType===Ft.Outline&&((0,a.LC)(t.outlineAndHaloSize.x,new a.nt(0))&&(v=v.add(new a.nt(2))),T=new a.nt(t.outlineAndHaloSize.x).divide(s).divide(h.$w)),this.textRenderPassType===Ft.Halo){const e=t.outlineAndHaloSize.x,i=new a.nt(t.outlineAndHaloSize.y);(0,a.LC)(i,new a.nt(0))&&(v=v.add(new a.nt(2))),T=i.add(e).divide(s).divide(h.$w)}return{glPosition:b,color:u,size:s,textureUV:w,antialiasingWidth:new a.nt(.105*h.au).divide(r).divide(this.view.pixelRatio),outlineDistanceOffset:T,...this.maybeRunHittest(t,e,{vvSizeAdjustment:p,vvRotation:_,labelOffset:m,labelClipped:x})}}_getViewRotationMatrix(t){const e=this.view.displayViewMat3,i=this.view.displayMat3,n=new a.nt(1).subtract(t);return e.multiply(t).add(i.multiply(n))}fragment(t){const e=new a.nt(2/8),i=new a.nt(1).subtract(e),n=(0,a.US)(this.mosaicInfo.texture,t.textureUV).a;let r=i.subtract(t.outlineDistanceOffset);this.highlight&&(r=r.divide(2));const s=t.antialiasingWidth,o=(0,a.TF)(r.subtract(s),r.add(s),n);return this.getFragmentOutput(t.color.multiply(o),t)}hittest(t,e,{vvSizeAdjustment:i,vvRotation:n,labelOffset:r,labelClipped:s}){let o,l,u;this.isLabel?(o=new a.eB(t.offset.add(r),0),l=new a.eB(e.offsetNextVertex1.add(r),0),u=new a.eB(e.offsetNextVertex2.add(r),0)):(o=n.multiply(new a.eB(t.offset.multiply(i),0)),l=n.multiply(new a.eB(e.offsetNextVertex1.multiply(i),0)),u=n.multiply(new a.eB(e.offsetNextVertex2.multiply(i),0)));const{viewMat3:c,tileMat3:h}=this.view,d=c.multiply(h).multiply(new a.eB(t.pos,1)),f=d.add(h.multiply(o)).xy,p=d.add(h.multiply(l)).xy,_=d.add(h.multiply(u)).xy,m=(0,A.Bo)(this.hittestRequest.position,f.xy,p.xy,_.xy);return this.isLabel?(0,a.Tk)(s,(0,A.My)(this.hittestRequest),m):m}_unpackDirection(t){const e=new a.Ai(t),i=(0,a.Sj)(e,new a.Ai(2)),n=(0,a.nf)(e,new a.Ai(3));return new a.ZY(new a.nt(i).subtract(1),new a.nt(n).subtract(1))}_getVertexColor(t){let e=t.color;if(this.visualVariableColor){const i=this.storage.getColorValue(t.id);e=this.visualVariableColor.getColor(i,t.color,new a.x(!1))}if(this.visualVariableOpacity){const i=this.storage.getOpacityValue(t.id),n=this.visualVariableOpacity.getOpacity(i);e=e.multiply(n)}return e}}(0,r._)([(0,o.uK)(p._)],Bt.prototype,"visualVariableColor",void 0),(0,r._)([(0,o.uK)(_.i)],Bt.prototype,"visualVariableOpacity",void 0),(0,r._)([(0,o.uK)(m)],Bt.prototype,"visualVariableRotation",void 0),(0,r._)([(0,o.uK)(y.n)],Bt.prototype,"visualVariableSizeMinMaxValue",void 0),(0,r._)([(0,o.uK)(v.F)],Bt.prototype,"visualVariableSizeScaleStops",void 0),(0,r._)([(0,o.uK)(x.N)],Bt.prototype,"visualVariableSizeStops",void 0),(0,r._)([(0,o.uK)(b.d)],Bt.prototype,"visualVariableSizeUnitValue",void 0),(0,r._)([(0,o.Pi)(d.b)],Bt.prototype,"mosaicInfo",void 0),(0,r._)([o.E8],Bt.prototype,"textRenderPassType",void 0),(0,r._)([o.E8],Bt.prototype,"isBackgroundPass",void 0),(0,r._)([o.E8],Bt.prototype,"isLabel",void 0),(0,r._)([(0,r.a)(0,(0,o.hF)(Vt)),(0,r.a)(1,(0,o.hF)(Nt))],Bt.prototype,"vertex",null),(0,r._)([(0,r.a)(0,(0,o.hF)(kt))],Bt.prototype,"fragment",null);var Ut=i(59224),Gt=i(13520),Yt=i(2014);class Zt extends Ut.Xc{}(0,r._)([(0,o.C5)(9,a.nt)],Zt.prototype,"accumulatedDistance",void 0),(0,r._)([(0,o.C5)(10,a.ZY)],Zt.prototype,"segmentDirection",void 0),(0,r._)([(0,o.C5)(11,a.nt)],Zt.prototype,"offsetAlongLine",void 0),(0,r._)([(0,o.C5)(12,a.nt)],Zt.prototype,"capType",void 0),(0,r._)([(0,o.C5)(13,a.Zb)],Zt.prototype,"tlbr",void 0);class Ht extends Ut.cM{_getDistanceRatio(t,e){const i=(0,f.mh)(t.bitset,h.kx);return i.multiply((0,a.T9)(e,new a.nt(.25)).multiply(new a.nt(2))).add(new a.nt(1).subtract(i).multiply((0,Gt.Lz)(1)))}_getSDFAlpha(t){const{halfWidth:e,normal:i,tlbr:n,patternSize:r,accumulatedDistance:s,offsetAlongLine:o,dashToPx:l,capType:u}=t,c=r.x.divide(Yt.zA).multiply(l),h=(0,a.jc)(s.add(o).divide(c)),d=(0,a.jh)(n.xy,n.zw,new a.ZY(h,.5)),p=(0,f.Rj)((0,a.US)(this.mosaicInfo.texture,d)).multiply(2).subtract(1).multiply(Yt.gR).multiply(l),_=i.y.multiply(e),m=(0,a.j1)([(0,a.LC)(u,new a.nt(1)),p.subtract(e)],[(0,a.LC)(u,new a.nt(2)),(0,a.RZ)((0,a.n7)((0,a.T9)(p,new a.nt(0)),new a.nt(2)).add(_.multiply(_))).subtract(e)],[!0,p]),g=(0,a.qE)(new a.nt(.25).subtract(m),new a.nt(0),new a.nt(1));return new a.Zb(g)}_getPatternColor(t){const{halfWidth:e,normal:i,color:n,accumulatedDistance:r,patternSize:s,sampleAlphaOnly:o,tlbr:l}=t,u=s.y.multiply(new a.nt(2).multiply(e).divide(s.x)),c=(0,a.jc)(r.divide(u)),h=new a.nt(.5).multiply(i.y).add(new a.nt(.5)),d=(0,a.jh)(l.xy,l.zw,new a.ZY(h,c));let f=(0,a.US)(this.mosaicInfo.texture,d);return null!=this.visualVariableColor&&(f=(0,a.Tk)((0,a.MM)(o,new a.nt(.5)),new a.Zb(n.a),n)),f}vertex(t,e){const{segmentDirection:i,tlbr:n,bitset:r}=t,s=(0,Ut.$0)(this,t),o=t.accumulatedDistance.divide(this.view.displayZoomFactor).add((0,a.Om)(i,s.scaledOffset)),l=new a.ZY(n.z.subtract(n.x),n.w.subtract(n.y)),u=n.divide(this.mosaicInfo.size.xyxy),c=(0,f.mh)(r,h.b5),d=(0,f.mh)(r,h.cn),p=(0,a.Tk)((0,a.MM)(c,new a.nt(.5)),this._getDistanceRatio(t,s.scaledHalfWidth),new a.nt(1));return{...s,tlbr:u,patternSize:l,accumulatedDistance:o,isSDF:c,sampleAlphaOnly:d,dashToPx:p,offsetAlongLine:t.offsetAlongLine,capType:t.capType,...this.maybeRunHittest(t,e,s.halfWidth)}}fragment(t){const{color:e,opacity:i,isSDF:n}=t,r=(0,Ut.xw)(t,this.antialiasingControls.blur),s=(0,a.Tk)((0,a.MM)(n,new a.nt(.5)),this._getSDFAlpha(t),this._getPatternColor(t)),o=e.multiply(i).multiply(r).multiply(s);return this.getFragmentOutput(o,t)}}(0,r._)([(0,o.Pi)(d.b)],Ht.prototype,"mosaicInfo",void 0),(0,r._)([(0,r.a)(0,(0,o.hF)(Zt)),(0,r.a)(1,(0,o.hF)(c.$Z))],Ht.prototype,"vertex",null);class Wt extends c.rz{}(0,r._)([(0,o.C5)(3,a.Zb)],Wt.prototype,"color",void 0),(0,r._)([(0,o.C5)(4,a.Zb)],Wt.prototype,"outlineColor",void 0),(0,r._)([(0,o.C5)(5,a.ZY)],Wt.prototype,"offset",void 0),(0,r._)([(0,o.C5)(6,a.ZY)],Wt.prototype,"textureUV",void 0),(0,r._)([(0,o.C5)(7,a.Zb)],Wt.prototype,"sizing",void 0),(0,r._)([(0,o.C5)(8,a.nt)],Wt.prototype,"placementAngle",void 0),(0,r._)([(0,o.C5)(9,a.nt)],Wt.prototype,"sdfDecodeCoeff",void 0),(0,r._)([(0,o.C5)(10,a.ZY)],Wt.prototype,"zoomRange",void 0);class $t extends o.Y7{}(0,r._)([(0,o.C5)(12,a.ZY)],$t.prototype,"offsetNextVertex1",void 0),(0,r._)([(0,o.C5)(13,a.ZY)],$t.prototype,"offsetNextVertex2",void 0),(0,r._)([(0,o.C5)(14,a.ZY)],$t.prototype,"textureUVNextVertex1",void 0),(0,r._)([(0,o.C5)(15,a.ZY)],$t.prototype,"textureUVNextVertex2",void 0);class jt extends c.DM{}function qt(t,e,i,n){return e.multiply(t.x).add(i.multiply(t.y)).add(n.multiply(t.z))}function Xt(t){return t.multiply(t).divide(128)}class Kt extends c.f_{constructor(){super(...arguments),this.computeAttributes={offset:["offsetNextVertex1","offsetNextVertex2"],textureUV:["textureUVNextVertex1","textureUVNextVertex2"]}}vertex(t,e){const i=Xt(t.sizing.x),n=Xt(t.sizing.y),r=Xt(t.sizing.z),s=t.placementAngle,o=(0,f.mh)(t.bitset,M.c.bitset.isSDF),l=(0,f.mh)(t.bitset,M.c.bitset.isMapAligned),u=(0,f.mh)(t.bitset,M.c.bitset.scaleSymbolsProportionally),c=(0,f.K5)(t.bitset,M.c.bitset.colorLocked),d=(0,S.cF)(this,t.id),p=(0,S.G7)(this,t.id,t.color,c).multiply(d),_=this.view.displayViewScreenMat3.multiply(new a.eB(t.pos.xy,1)),m=(0,S.Mg)(this,t.id,r).divide(r),g=i.multiply(m),y=t.offset.xy.multiply(m);let v=n.multiply(u.multiply(m.subtract(1)).add(1));v=(0,a.jk)(v,(0,a.T9)(g.subtract(.99),new a.nt(0)));const x=(0,a.T9)(v,new a.nt(1)),b=(0,a.jk)(v,new a.nt(1)),w=a.U.fromRotation(s.multiply(h.rp)),T=(0,S.TL)(this,t.id),P=this._getViewRotationMatrix(l).multiply(T).multiply(w).multiply(new a.eB(y.xy,0)),I=this.clip(t.id,t.zoomRange),A=new a.Zb(_.xy.add(P.xy),I,1),C=t.textureUV.divide(this.mosaicInfo.size),E=t.outlineColor.multiply(b),R=(0,f.mh)(t.bitset,M.c.bitset.overrideOutlineColor),O=t.sdfDecodeCoeff.multiply(g);return{glPosition:A,color:p,textureUV:C,outlineColor:E,outlineSize:x,distanceToPx:O,isSDF:o,overrideOutlineColor:R,...this.maybeRunHittest(t,e,{pos:t.pos,size:g,sizeCorrection:m,isMapAligned:l,vvRotationMat3:T,placementMat3:w,outlineSize:x,distanceToPx:O,isSDF:o})}}fragment(t){const e=this._getColor(t.textureUV,t);return this.getFragmentOutput(e,t)}hittest(t,e,i){return(0,a.Tk)((0,a.Xe)(i.size,this.hittestRequest.smallSymbolSizeThreshold),this._hittestSmallMarker(t,e,i),this._hittestMarker(t,e,i))}_getViewRotationMatrix(t){const e=this.view.displayViewMat3,i=this.view.displayMat3,n=new a.nt(1).subtract(t);return e.multiply(t).add(i.multiply(n))}_getViewScreenMatrix(t){const e=this.view.viewMat3.multiply(this.view.tileMat3),i=this.view.tileMat3,n=new a.nt(1).subtract(t);return e.multiply(t).add(i.multiply(n))}_getColor(t,e){return(0,a.Tk)((0,a.LC)(e.isSDF,new a.nt(1)),this._getSDFColor(t,e),this._getSpriteColor(t,e))}_getSpriteColor(t,e){return(0,a.US)(this.mosaicInfo.texture,t).multiply(e.color)}_getSDFColor(t,e){const i=(0,a.US)(this.mosaicInfo.texture,t),n=new a.nt(.5).subtract((0,f.Rj)(i)).multiply(e.distanceToPx).multiply(h.V5),r=(0,a.qE)(new a.nt(.5).subtract(n),new a.nt(0),new a.nt(1)),s=e.color.multiply(r);let o=e.outlineSize;this.highlight&&(o=(0,a.T9)(o,e.overrideOutlineColor.multiply(4)));const l=o.multiply(.5),u=(0,a.tn)(n).subtract(l),c=(0,a.qE)(new a.nt(.5).subtract(u),new a.nt(0),new a.nt(1)),d=(0,a.jh)(e.outlineColor,e.color,e.overrideOutlineColor).multiply(c);return new a.nt(1).subtract(d.a).multiply(s).add(d)}_hittestSmallMarker(t,e,i){const{position:n,distance:r,smallSymbolDistance:s}=this.hittestRequest,o=r.subtract(s),{viewMat3:l,tileMat3:u}=this.view,c=l.multiply(u).multiply(new a.eB(i.pos,1)).xy,h=i.size.multiply(.5);return(0,a.Io)(c,n).subtract(h).add(o)}_hittestMarker(t,e,i){const{pos:n,sizeCorrection:r,isMapAligned:s}=i,o=new a.eB(t.offset.multiply(r),0),l=new a.eB(e.offsetNextVertex1.multiply(r),0),u=new a.eB(e.offsetNextVertex2.multiply(r),0),{viewMat3:c,tileMat3:h}=this.view,d=c.multiply(h).multiply(new a.eB(n,1)),f=this._getViewScreenMatrix(s).multiply(i.vvRotationMat3).multiply(i.placementMat3),p=d.add(f.multiply(o)).xy,_=d.add(f.multiply(l)).xy,m=d.add(f.multiply(u)).xy,g=this.hittestRequest.position,y=this.hittestRequest.distance,v=(0,A.Bo)(g,p,_,m);return(0,a.Tk)((0,a.MM)(v,y),v,this._hittestSamples(p,_,m,t,e,i))}_hittestSamples(t,e,i,n,r,s){const{outlineSize:o,isSDF:l,distanceToPx:u}=s,c=this.hittestRequest.position,h=this.hittestRequest.distance,d=(0,A.Bs)(c.add(new a.ZY((0,a.ze)(h),(0,a.ze)(h))),t,e,i),f=(0,A.Bs)(c.add(new a.ZY(0,(0,a.ze)(h))),t,e,i),p=(0,A.Bs)(c.add(new a.ZY(h,(0,a.ze)(h))),t,e,i),_=(0,A.Bs)(c.add(new a.ZY((0,a.ze)(h),0)),t,e,i),m=(0,A.Bs)(c,t,e,i),g=(0,A.Bs)(c.add(new a.ZY(h,0)),t,e,i),y=(0,A.Bs)(c.add(new a.ZY((0,a.ze)(h),h)),t,e,i),v=(0,A.Bs)(c.add(new a.ZY(0,h)),t,e,i),x=(0,A.Bs)(c.add(new a.ZY(h,h)),t,e,i),b=n.textureUV.divide(this.mosaicInfo.size),S=r.textureUVNextVertex1.divide(this.mosaicInfo.size),w=r.textureUVNextVertex2.divide(this.mosaicInfo.size),T={color:new a.Zb(1),outlineColor:new a.Zb(1),overrideOutlineColor:new a.nt(1),outlineSize:o,distanceToPx:u,isSDF:l};let P=new a.nt(0);return P=P.add((0,A.kW)(d).multiply(this._getColor(qt(d,b,S,w),T).a)),P=P.add((0,A.kW)(f).multiply(this._getColor(qt(f,b,S,w),T).a)),P=P.add((0,A.kW)(p).multiply(this._getColor(qt(p,b,S,w),T).a)),P=P.add((0,A.kW)(_).multiply(this._getColor(qt(_,b,S,w),T).a)),P=P.add((0,A.kW)(m).multiply(this._getColor(qt(m,b,S,w),T).a)),P=P.add((0,A.kW)(g).multiply(this._getColor(qt(g,b,S,w),T).a)),P=P.add((0,A.kW)(y).multiply(this._getColor(qt(y,b,S,w),T).a)),P=P.add((0,A.kW)(v).multiply(this._getColor(qt(v,b,S,w),T).a)),P=P.add((0,A.kW)(x).multiply(this._getColor(qt(x,b,S,w),T).a)),(0,a.PM)(P,new a.nt(.05)).multiply((0,A.My)(this.hittestRequest))}}(0,r._)([(0,o.uK)(p._)],Kt.prototype,"visualVariableColor",void 0),(0,r._)([(0,o.uK)(_.i)],Kt.prototype,"visualVariableOpacity",void 0),(0,r._)([(0,o.uK)(m)],Kt.prototype,"visualVariableRotation",void 0),(0,r._)([(0,o.uK)(y.n)],Kt.prototype,"visualVariableSizeMinMaxValue",void 0),(0,r._)([(0,o.uK)(v.F)],Kt.prototype,"visualVariableSizeScaleStops",void 0),(0,r._)([(0,o.uK)(x.N)],Kt.prototype,"visualVariableSizeStops",void 0),(0,r._)([(0,o.uK)(b.d)],Kt.prototype,"visualVariableSizeUnitValue",void 0),(0,r._)([(0,o.Pi)(d.b)],Kt.prototype,"mosaicInfo",void 0),(0,r._)([(0,r.a)(0,(0,o.hF)(Wt)),(0,r.a)(1,(0,o.hF)($t))],Kt.prototype,"vertex",null),(0,r._)([(0,r.a)(0,(0,o.hF)(jt))],Kt.prototype,"fragment",null);var Qt=i(50944),Jt=i(22516);class te{constructor(){this.computeAttributes={}}get locationsMap(){const t=new Map;for(const e in this.locations)t.set(e,this.locations[e].index);return t}get optionPropertyKeys(){if(!this._optionPropertyKeys){const t=new Set(Object.keys(this.options));this._optionPropertyKeys=t}return this._optionPropertyKeys}get _transformFeedbackBindings(){return[]}get locationInfo(){if(!this._locationInfo){const t=this.locationsMap,e=Array.from(t.entries()).map((([t,e])=>`${t}.${e}`)).join("."),i=(0,Qt.Wm)(e);this._locationInfo={hash:i,locations:t,computeAttributeMap:this.computeAttributes}}return this._locationInfo}get renamedLocationsMap(){const t=new Map;for(const[e,i]of this.locationsMap.entries())t.set("a_"+e,i);return t}getShaderKey(t,e,i){return`${Object.keys(t).map((e=>`${e}.${t[e]}`)).join(".")}.${Object.keys(i).filter((t=>i[t])).map((t=>`${t}_${i[t].toString()}`)).join(".")}.${Object.keys(e).filter((t=>this.optionPropertyKeys.has(t))).join(".")}`}getProgram(t,e,i,n){let r="",s="";for(const t in i)if(i[t]){const e="boolean"==typeof i[t]?`#define ${t}\n`:`#define ${t} ${i[t]}\n`;r+=e,s+=e}return r+=this.vertexShader,s+=this.fragmentShader,new Jt.K(r,s,this.renamedLocationsMap,this.locationInfo,this._getUniformBindings(e),this._transformFeedbackBindings)}_getUniformBindings(t){const e=[];for(const t in this.required){const i=this.required[t];e.push({uniformHydrated:null,shaderModulePath:t,uniformName:t,uniformType:i.type,uniformArrayElementType:ee(i),uniformArrayLength:ie(i)})}for(const i in t){const n=this.options[i];if(t[i])for(const t in n){const r=n[t];e.push({uniformHydrated:null,shaderModulePath:`${i}.${t}`,uniformName:t,uniformType:r.type,uniformArrayElementType:ee(r),uniformArrayLength:ie(r)})}}return e}}const ee=t=>"array"===t.type?t.elementType?.type:void 0,ie=t=>"array"===t.type?t.size:void 0;var ne=i(44723);const re={hittestDist:a.nt,hittestPos:a.ZY},se={filterFlags:a.z7,animation:a.z7,visualVariableData:a.z7,dataDriven0:a.z7,dataDriven1:a.z7,dataDriven2:a.z7,gpgpu:a.z7,size:a.nt},oe={displayViewScreenMat3:a.U,displayViewMat3:a.U,displayMat3:a.U,viewMat3:a.U,tileMat3:a.U,displayZoomFactor:a.nt,requiredZoomFactor:a.nt,tileOffset:a.ZY,currentScale:a.nt,currentZoom:a.nt,metersPerSRUnit:a.nt};class ae extends te{constructor(){super(...arguments),this.vertexShader=(0,ne.Q)("materials/pie/pie.vert"),this.fragmentShader=(0,ne.Q)("materials/pie/pie.frag"),this.required={...se,...oe,outlineWidth:a.nt,colors:a.My,defaultColor:a.Zb,othersColor:a.Zb,outlineColor:a.Zb,donutRatio:a.nt,sectorThreshold:a.nt},this.options={hittestUniforms:re,visualVariableSizeMinMaxValue:{minMaxValueAndSize:a.Zb},visualVariableSizeScaleStops:{sizes:{...a.My.ofType(a.nt,8),type:"array",elementType:a.nt,size:8},values:{...a.My.ofType(a.nt,8),type:"array",elementType:a.nt,size:8}},visualVariableSizeStops:{sizes:{...a.My.ofType(a.nt,8),type:"array",elementType:a.nt,size:8},values:{...a.My.ofType(a.nt,8),type:"array",elementType:a.nt,size:8}},visualVariableSizeUnitValue:{unitValueToPixelsRatio:a.nt},visualVariableOpacity:{opacities:{...a.My.ofType(a.nt,8),type:"array",elementType:a.nt,size:8},opacityValues:{...a.My.ofType(a.nt,8),type:"array",elementType:a.nt,size:8}}},this.locations={pos:{index:0,type:a.ZY},id:{index:1,type:a.eB},bitset:{index:2,type:a.nt},offset:{index:3,type:a.ZY},texCoords:{index:4,type:a.ZY},size:{index:5,type:a.ZY},referenceSize:{index:6,type:a.nt},zoomRange:{index:7,type:a.ZY}},this.defines={VV_SIZE_MIN_MAX_VALUE:"boolean",VV_SIZE_SCALE_STOPS:"boolean",VV_SIZE_FIELD_STOPS:"boolean",VV_SIZE_UNIT_VALUE:"boolean",VV_OPACITY:"boolean",HITTEST:"boolean",numberOfFields:"number",highlight:"boolean",inside:"boolean",outside:"boolean"}}setNumberOfFields(t){this.required.colors={...a.My.ofType(a.Zb,t),type:"array",elementType:a.Zb,size:t}}}const le={fill:new class extends V{constructor(){super(...arguments),this.type=n.N.Fill,this.shaders={geometry:new lt.z}}render(t,e){const{painter:i}=t,n=e.instance.getInput();i.setShader({shader:this.shaders.geometry,uniforms:{...(0,N.r3)(t,e.target,n.uniforms),...(0,N.QA)(t,e.target)},defines:(0,N.vT)(t),optionalAttributes:n.optionalAttributes,useComputeBuffer:(0,N.Eq)(t)}),i.setPipelineState((0,N.Qu)(t)),i.submitDraw(t,e)}},patternFill:new class extends V{constructor(){super(...arguments),this.type=n.N.PatternFill,this.shaders={geometry:new ft.vx}}render(t,e){const{context:i,painter:n}=t,r=e.instance.getInput();n.setShader({shader:this.shaders.geometry,uniforms:{...(0,N.r3)(t,e.target,r.uniforms),...(0,N.QA)(t,e.target),mosaicInfo:n.textureManager.getMosaicInfo(i,e.textureKey),localTileOffset:(0,N.Pr)(e.target)},defines:{...(0,N.vT)(t)},optionalAttributes:r.optionalAttributes,useComputeBuffer:(0,N.Eq)(t)}),n.setPipelineState((0,N.Qu)(t)),n.submitDraw(t,e)}},complexFill:new class extends V{constructor(){super(...arguments),this.type=n.N.ComplexFill,this.shaders={geometry:new ut.Ps}}render(t,e){const{context:i,painter:n}=t,r=e.instance.getInput();n.setShader({shader:this.shaders.geometry,uniforms:{...(0,N.r3)(t,e.target,r.uniforms),...(0,N.QA)(t,e.target),mosaicInfo:n.textureManager.getMosaicInfo(i,e.textureKey),localTileOffset:(0,N.Pr)(e.target)},defines:{...(0,N.vT)(t)},optionalAttributes:r.optionalAttributes,useComputeBuffer:(0,N.Eq)(t)}),n.setPipelineState((0,N.Qu)(t)),n.submitDraw(t,e)}},outlineFill:new class extends V{constructor(){super(...arguments),this.type=n.N.OutlineFill,this.shaders={geometry:new dt.nj}}render(t,e){const{painter:i,pixelRatio:n}=t,r=e.instance.getInput();i.setShader({shader:this.shaders.geometry,uniforms:{...(0,N.r3)(t,e.target,r.uniforms),...(0,N.QA)(t,e.target),antialiasingControls:ct(n)},defines:{...(0,N.vT)(t)},optionalAttributes:r.optionalAttributes,useComputeBuffer:(0,N.Eq)(t)}),i.setPipelineState((0,N.Qu)(t)),i.submitDraw(t,e)}},patternOutlineFill:new class extends V{constructor(){super(...arguments),this.type=n.N.PatternOutlineFill,this.shaders={geometry:new pt.tA}}render(t,e){const{context:i,painter:n,pixelRatio:r}=t,s=e.instance.getInput();n.setShader({shader:this.shaders.geometry,uniforms:{...(0,N.r3)(t,e.target,s.uniforms),...(0,N.QA)(t,e.target),antialiasingControls:ct(r),mosaicInfo:n.textureManager.getMosaicInfo(i,e.textureKey),localTileOffset:(0,N.Pr)(e.target)},defines:{...(0,N.vT)(t)},optionalAttributes:s.optionalAttributes,useComputeBuffer:(0,N.Eq)(t)}),n.setPipelineState((0,N.Qu)(t)),n.submitDraw(t,e)}},complexOutlineFill:new class extends V{constructor(){super(...arguments),this.type=n.N.ComplexOutlineFill,this.shaders={geometry:new ht.RH}}render(t,e){const{context:i,painter:n,pixelRatio:r}=t,s=e.instance.getInput();n.setShader({shader:this.shaders.geometry,uniforms:{...(0,N.r3)(t,e.target,s.uniforms),...(0,N.QA)(t,e.target),antialiasingControls:ct(r),mosaicInfo:n.textureManager.getMosaicInfo(i,e.textureKey),localTileOffset:(0,N.Pr)(e.target)},defines:{...(0,N.vT)(t)},optionalAttributes:s.optionalAttributes,useComputeBuffer:(0,N.Eq)(t)}),n.setPipelineState((0,N.Qu)(t)),n.submitDraw(t,e)}},marker:new class extends V{constructor(){super(...arguments),this.type=n.N.Marker,this.shaders={geometry:new Kt},this.symbologyPlane=L.uC.MARKER}render(t,e){const{context:i,painter:n}=t,r=e.instance.getInput();n.setShader({shader:this.shaders.geometry,uniforms:{...(0,N.r3)(t,e.target,r.uniforms),...(0,N.QA)(t,e.target),mosaicInfo:n.textureManager.getMosaicInfo(i,e.textureKey,!0)},defines:{...(0,N.vT)(t)},optionalAttributes:r.optionalAttributes,useComputeBuffer:(0,N.Eq)(t)}),n.setPipelineState((0,N.Qu)(t)),n.submitDraw(t,e)}},pieChart:new class extends V{constructor(){super(...arguments),this.type=n.N.PieChart,this.shaders={geometry:new ae},this.symbologyPlane=L.uC.MARKER}render(t,e){const{painter:i}=t,{instance:n,target:r}=e,s=this.shaders.geometry,o=n.getInput(),a=o.uniforms.numberOfFields,l=(0,N.Eq)(t),u=(0,N.QA)(t,r),c=(0,N.vT)(t);s.setNumberOfFields(a),i.setShader({shader:s,uniforms:{...(0,N.r3)(t,e.target,o.uniforms.shader),...u.storage,...u.view,hittestUniforms:u.hittestRequest?{hittestDist:u.hittestRequest?.distance,hittestPos:u.hittestRequest?.position}:null},defines:{VV_SIZE_MIN_MAX_VALUE:!!o.uniforms.shader.visualVariableSizeMinMaxValue,VV_SIZE_SCALE_STOPS:!!o.uniforms.shader.visualVariableSizeScaleStops,VV_SIZE_FIELD_STOPS:!!o.uniforms.shader.visualVariableSizeStops,VV_SIZE_UNIT_VALUE:!!o.uniforms.shader.visualVariableSizeUnitValue,VV_OPACITY:!!o.uniforms.shader.visualVariableOpacity,HITTEST:l,highlight:u.highlight?1:0,...c,numberOfFields:a},optionalAttributes:{},useComputeBuffer:l}),i.setPipelineState((0,N.Qu)(t)),i.submitDraw(t,e)}},line:new class extends V{constructor(){super(...arguments),this.type=n.N.Line,this.shaders={geometry:new Ut.cM},this.symbologyPlane=L.uC.LINE}render(t,e){const{painter:i,pixelRatio:n}=t,r=e.instance.getInput();i.setShader({shader:this.shaders.geometry,uniforms:{...(0,N.r3)(t,e.target,r.uniforms),...(0,N.QA)(t,e.target),antialiasingControls:ct(n)},defines:{...(0,N.vT)(t)},optionalAttributes:r.optionalAttributes,useComputeBuffer:(0,N.Eq)(t)}),i.setPipelineState((0,N.Qu)(t)),i.submitDraw(t,e)}},texturedLine:new class extends V{constructor(){super(...arguments),this.type=n.N.TexturedLine,this.shaders={geometry:new Ht},this.symbologyPlane=L.uC.LINE}render(t,e){const{context:i,painter:n,pixelRatio:r}=t,s=e.instance.getInput();n.setShader({shader:this.shaders.geometry,uniforms:{...(0,N.r3)(t,e.target,s.uniforms),...(0,N.QA)(t,e.target),antialiasingControls:ct(r),mosaicInfo:n.textureManager.getMosaicInfo(i,e.textureKey)},defines:{...(0,N.vT)(t)},optionalAttributes:s.optionalAttributes,useComputeBuffer:(0,N.Eq)(t)}),n.setPipelineState((0,N.Qu)(t)),n.submitDraw(t,e)}},text:new class extends V{constructor(){super(...arguments),this.type=n.N.Text,this.shaders={geometry:new Bt},this.symbologyPlane=L.uC.TEXT}render(t,e){const{context:i,painter:n}=t,r=(0,N.vT)(t),s=e.instance.getInput(),o={shader:this.shaders.geometry,uniforms:{...(0,N.r3)(t,e.target,s.uniforms),...(0,N.QA)(t,e.target),mosaicInfo:n.textureManager.getMosaicInfo(i,e.textureKey)},defines:{...r,isBackgroundPass:!0,isLabel:!1,textRenderPassType:Ft.Color},optionalAttributes:s.optionalAttributes,useComputeBuffer:(0,N.Eq)(t)};n.setShader(o),n.setPipelineState((0,N.Qu)(t)),n.submitDraw(t,e),n.setShader({...o,defines:{...r,isBackgroundPass:!1,isLabel:!1,textRenderPassType:Ft.Halo}}),n.submitDraw(t,e),n.setShader({...o,defines:{...r,isBackgroundPass:!1,isLabel:!1,textRenderPassType:Ft.Outline}}),n.submitDraw(t,e),n.setShader({...o,defines:{...r,isBackgroundPass:!1,isLabel:!1,textRenderPassType:Ft.Color}}),n.submitDraw(t,e)}},label:new class extends V{constructor(){super(...arguments),this.type=n.N.Label,this.shaders={geometry:new Bt},this.drawPhase=L.S5.LABEL|L.S5.LABEL_ALPHA|L.S5.HITTEST,this.symbologyPlane=L.uC.TEXT}render(t,e){const{context:i,painter:n}=t,r=(0,N.vT)(t),s={...(0,N.Qu)(t)},o=e.instance.getInput(),a={shader:this.shaders.geometry,uniforms:{...(0,N.r3)(t,e.target,o.uniforms),...(0,N.QA)(t,e.target),mosaicInfo:n.textureManager.getMosaicInfo(i,e.textureKey)},defines:{...r,textRenderPassType:Ft.Color,isBackgroundPass:!0,isLabel:!0},optionalAttributes:o.optionalAttributes,useComputeBuffer:(0,N.Eq)(t)};n.setShader(a),n.setPipelineState(s),n.submitDraw(t,e),n.setShader({...a,defines:{...r,textRenderPassType:Ft.Halo,isBackgroundPass:!1,isLabel:!0}}),n.setPipelineState(s),n.submitDraw(t,e),n.setShader({...a,defines:{...r,textRenderPassType:Ft.Color,isBackgroundPass:!1,isLabel:!0}}),n.setPipelineState(s),n.submitDraw(t,e)}},heatmap:new class extends V{constructor(){super(...arguments),this.type=n.N.Heatmap,this.drawPhase=L.S5.MAP|L.S5.HITTEST|L.S5.DEBUG,this.shaders={accumulate:new Tt,resolve:new Ct},this._isBound=!1,this._resources=new Map}shutdown(t){super.shutdown(t),this._resources.get(t)?.destroy(),this._resources.delete(t),this._prevFBO=null,this._unbind()}render(t,e){const{context:i,painter:n,state:r}=t,s=e.instance.getInput(),{isFieldActive:o}=s.uniforms,a=this._getOrCreateResourcesRecord(i),l=a.loadQualityProfile(i);(0,N.Eq)(t)||this._bind(t,a,s),n.setShader({shader:this.shaders.accumulate,uniforms:{...(0,N.QA)(t,e.target),kernelControls:{radius:Dt(s,r),isFieldActive:o?1:0}},defines:{...(0,N.vT)(t),...l.defines},optionalAttributes:{},useComputeBuffer:(0,N.Eq)(t)});const u=(0,N.Eq)(t)?Ot:Rt;n.setPipelineState(u),n.submitDraw(t,e)}getStencilReference(t){return Et(t)}renderResolvePass(t,e){if((0,N.Eq)(t))return;const{context:i,painter:n}=t,r=this._resources.get(i);if(null==this._prevFBO||null==this._prevViewport||!r?.initialized)return;const{defines:s}=r.loadQualityProfile(i),{minDensity:o,maxDensity:a,radius:l}=e.getInput().uniforms,u=r.accumulateFramebuffer,c=r.resolveGradientTexture,h={shader:this.shaders.resolve,uniforms:{accumulatedDensity:{texture:{unit:8,texture:u.colorTexture},minAndInvRange:[o,1/(a-o)],normalization:3/(l*l*Math.PI)},gradient:{texture:{unit:9,texture:c}}},defines:s,optionalAttributes:{},useComputeBuffer:!1};i.bindFramebuffer(this._prevFBO),i.setViewport(0,0,this._prevViewport.width,this._prevViewport.height),i.bindTexture(u.colorTexture,8),i.bindTexture(c,9),n.setPipelineState(zt),n.submitDrawMesh(i,h,n.quadMesh),this._unbind()}_getOrCreateResourcesRecord(t){let e=this._resources.get(t);return null==e&&(e=new vt,this._resources.set(t,e)),e}_unbind(){this._prevFBO=null,this._prevViewport=null,this._isBound=!1}_bind(t,e,i){if(this._isBound)return;const{context:n,state:r,pixelRatio:s}=t,o=n.getBoundFramebufferObject(),a=n.getViewport();this._prevFBO=o,this._prevViewport=a;const{gradient:l,gradientHash:u}=i.uniforms;e.ensureResolveGradientTexture(n,u,l);const{width:c,height:h}=a,d=function(t,e){const i=e>1.5?.25:.5;return t<1/(2*i)?1:i}(Dt(i,r),s),f=c*d,p=h*d,_=e.ensureAccumulateFBO(n,f,p);n.blitFramebuffer(o,_,0,0,o.width,o.height,0,0,_.width,_.height,tt.NV.STENCIL,tt.Cj.NEAREST),n.bindFramebuffer(_),n.setViewport(0,0,_.width,_.height),n.setColorMask(!0,!0,!0,!0),n.setClearColor(0,0,0,0),n.clear(tt.NV.COLOR),this._isBound=!0}},dotDensity:new class extends V{constructor(){super(...arguments),this.type=n.N.DotDensity,this.shaders={polygon:new K,point:new $,fill:new lt.z},this._resources=new Map}render(t,e){(0,N.dJ)(t)||(0,N.Eq)(t)?this._renderPolygons(t,e):this._renderDotDensity(t,e)}_renderPolygons(t,e){const{painter:i}=t;i.setShader({shader:this.shaders.fill,uniforms:{...(0,N.QA)(t,e.target),visualVariableColor:null,visualVariableOpacity:null},defines:{...(0,N.vT)(t)},optionalAttributes:{zoomRange:!1},useComputeBuffer:(0,N.Eq)(t)}),i.setPipelineState((0,N.Qu)(t)),i.submitDraw(t,e)}_renderDotDensity(t,e){const{context:i,painter:n,requiredLevel:r}=t,s=e.instance.getInput().uniforms,o=this._getOrCreateResourcesRecord(i),a=o.getDotDensityTextures(i,B.CQ,s.seed),l=1/2**(r-e.target.key.level),u=B.CQ,c=u*window.devicePixelRatio*u*window.devicePixelRatio,h=1/l*(1/l),d=s.dotScale?t.state.scale/s.dotScale:1,f=s.dotValue*d*h;n.setShader({shader:this.shaders.polygon,uniforms:{...(0,N.QA)(t,e.target),instance:{isActive:s.isActive,colors:s.colors,dotValue:Math.max(1,f)},draw:{dotTexture0:{unit:B.Cp,texture:a[0]},dotTexture1:{unit:B.vN,texture:a[1]},tileZoomFactor:l,pixelRatio:window.devicePixelRatio,tileDotsOverArea:c/(B.CQ*window.devicePixelRatio*B.CQ*window.devicePixelRatio)}},defines:{...(0,N.vT)(t),blending:s.blending},optionalAttributes:{},useComputeBuffer:!1});const p=i.getViewport();i.setViewport(0,0,B.CQ,B.CQ);const _=i.getBoundFramebufferObject(),m=o.getFBO(i);i.bindFramebuffer(m),i.setClearColor(0,0,0,0),i.clear(tt.NV.COLOR),n.setPipelineState({color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1}),n.updatePipelineState(i),n.submitDraw(t,e),i.bindFramebuffer(_),i.setViewport(p.x,p.y,p.width,p.height);const g=o.getFBO(i).colorTexture,y={shader:this.shaders.point,uniforms:{view:(0,N.L4)(t,e.target),instance:{dotSize:s.dotSize},draw:{locations:{unit:B.Cp,texture:g},tileZoomFactor:1,pixelRatio:window.devicePixelRatio}},defines:{...(0,N.vT)(t)},optionalAttributes:{},useComputeBuffer:!1};n.setPipelineState((0,N.Qu)(t)),n.submitDrawMesh(i,y,o.getDotDensityMesh(i,(0,U.V)(this.shaders.point)))}shutdown(t){super.shutdown(t),this._resources.get(t)?.destroy(),this._resources.delete(t)}_getOrCreateResourcesRecord(t){let e=this._resources.get(t);return null==e&&(e=new at,this._resources.set(t,e)),e}},animatedMarker:new class extends k{constructor(){super(...arguments),this.type=n.N.AnimatedMarker,this.shaders={geometry:new O}}}};function ue(){for(const t in le)le[t].startup()}function ce(t){for(const e in le)le[e].shutdown(t)}},81728:function(t,e,i){var n;i.d(e,{N:function(){return n}}),function(t){t[t.AnimatedMarker=0]="AnimatedMarker",t[t.Blend=1]="Blend",t[t.ComplexFill=2]="ComplexFill",t[t.ComplexOutlineFill=3]="ComplexOutlineFill",t[t.DotDensity=4]="DotDensity",t[t.Fill=5]="Fill",t[t.Grid=6]="Grid",t[t.Heatmap=7]="Heatmap",t[t.Label=8]="Label",t[t.Line=9]="Line",t[t.Magnifier=10]="Magnifier",t[t.Marker=11]="Marker",t[t.OutlineFill=12]="OutlineFill",t[t.Overlay=13]="Overlay",t[t.PatternFill=14]="PatternFill",t[t.PatternOutlineFill=15]="PatternOutlineFill",t[t.PieChart=16]="PieChart",t[t.Test=17]="Test",t[t.Text=18]="Text",t[t.TexturedLine=19]="TexturedLine"}(n||(n={}))},97473:function(t,e,i){i.d(e,{c:function(){return n}});const n={bitset:{isSDF:0,isMapAligned:1,scaleSymbolsProportionally:2,overrideOutlineColor:3,colorLocked:4,isStroke:5}}},5544:function(t,e,i){i.d(e,{F:function(){return s},q:function(){return o}});var n=i(85475),r=i(85456);function s(t,e,i,s){const o=i.packPrecisionFactor??1;switch(i.type){case r.pe.BYTE:if(1===i.count)t.setInt8(s+i.offset,e*o);else for(let n=0;n<i.count;n++){const r=n*Int8Array.BYTES_PER_ELEMENT;t.setInt8(s+i.offset+r,e[n]*o)}break;case r.pe.UNSIGNED_BYTE:if(1===i.count)t.setUint8(s+i.offset,e*o);else for(let n=0;n<i.count;n++){const r=n*Uint8Array.BYTES_PER_ELEMENT;t.setUint8(s+i.offset+r,e[n]*o)}break;case r.pe.SHORT:if(1===i.count)t.setInt16(s+i.offset,e*o,!0);else for(let n=0;n<i.count;n++){const r=n*Int16Array.BYTES_PER_ELEMENT;t.setInt16(s+i.offset+r,e[n]*o,!0)}break;case r.pe.UNSIGNED_SHORT:if(1===i.count)t.setUint16(s+i.offset,e*o,!0);else for(let n=0;n<i.count;n++){const r=n*Uint16Array.BYTES_PER_ELEMENT;t.setUint16(s+i.offset+r,e[n]*o,!0)}break;case r.pe.INT:if(1===i.count)t.setInt32(s+i.offset,e*o,!0);else for(let n=0;n<i.count;n++){const r=n*Int32Array.BYTES_PER_ELEMENT;t.setInt32(s+i.offset+r,e[n]*o,!0)}break;case r.pe.UNSIGNED_INT:if(1===i.count)t.setUint32(s+i.offset,e*o,!0);else for(let n=0;n<i.count;n++){const r=n*Uint32Array.BYTES_PER_ELEMENT;t.setUint32(s+i.offset+r,e[n]*o,!0)}break;case r.pe.FLOAT:if(1===i.count)t.setFloat32(s+i.offset,e*o,!0);else for(let n=0;n<i.count;n++){const r=n*Float32Array.BYTES_PER_ELEMENT;t.setFloat32(s+i.offset+r,e[n]*o,!0)}break;case r.pe.HALF_FLOAT:if(1===i.count)t.setUint16(s+i.offset,(0,n.fw)(e*o),!0);else for(let r=0;r<i.count;r++){const a=r*Uint16Array.BYTES_PER_ELEMENT;t.setUint16(s+i.offset+a,(0,n.fw)(e[r]*o),!0)}}}function o(t,e,i){switch(e.type){case r.pe.BYTE:{if(1===e.count)return t.getInt8(i+e.offset);const n=[];for(let r=0;r<e.count;r++){const s=r*Int8Array.BYTES_PER_ELEMENT;n.push(t.getInt8(i+e.offset+s))}return n}case r.pe.UNSIGNED_BYTE:{if(1===e.count)return t.getUint8(i+e.offset);const n=[];for(let r=0;r<e.count;r++){const s=r*Uint8Array.BYTES_PER_ELEMENT;n.push(t.getUint8(i+e.offset+s))}return n}case r.pe.SHORT:{if(1===e.count)return t.getInt16(i+e.offset,!0);const n=[];for(let r=0;r<e.count;r++){const s=r*Int16Array.BYTES_PER_ELEMENT;n.push(t.getInt16(i+e.offset+s,!0))}return n}case r.pe.UNSIGNED_SHORT:{if(1===e.count)return t.getUint16(i+e.offset,!0);const n=[];for(let r=0;r<e.count;r++){const s=r*Uint16Array.BYTES_PER_ELEMENT;n.push(t.getUint16(i+e.offset+s,!0))}return n}case r.pe.INT:{if(1===e.count)return t.getInt32(i+e.offset,!0);const n=[];for(let r=0;r<e.count;r++){const s=r*Int32Array.BYTES_PER_ELEMENT;n.push(t.getInt32(i+e.offset+s,!0))}return n}case r.pe.UNSIGNED_INT:{if(1===e.count)return t.getUint32(i+e.offset,!0);const n=[];for(let r=0;r<e.count;r++){const s=r*Uint32Array.BYTES_PER_ELEMENT;n.push(t.getUint32(i+e.offset+s,!0))}return n}case r.pe.FLOAT:{if(1===e.count)return t.getFloat32(i+e.offset,!0);const n=[];for(let r=0;r<e.count;r++){const s=r*Float32Array.BYTES_PER_ELEMENT;n.push(t.getFloat32(i+e.offset+s,!0))}return n}case r.pe.HALF_FLOAT:{if(1===e.count)return(0,n.Kl)(t.getUint16(i+e.offset,!0));const r=[];for(let s=0;s<e.count;s++){const o=s*Uint16Array.BYTES_PER_ELEMENT;r.push((0,n.Kl)(t.getUint16(i+e.offset+o,!0)))}return r}}}},86329:function(t,e,i){function n(t){return t}function r(t){return t}i.d(e,{P:function(){return n},U:function(){return r}})},25731:function(t,e,i){i.d(e,{Ph:function(){return s},Z0:function(){return a},hU:function(){return r}});var n=i(50944);function r(t){const e=t.map((({name:t,count:e,type:i})=>`${t}.${e}.${i}`)).join(",");return(0,n.Wm)(e)}function s(t,e,i,n,r,o,a){if(t.primitiveName===e){let e=n?.readWithDefault(r,o,t[i]&&a);return"text"===t.type&&(e=e.toString()),void(t[i]=e)}if("type"in t&&null!=t.type){if(t.effects)for(const l of t.effects)s(l,e,i,n,r,o,a);switch(t.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(t.symbolLayers)for(const l of t.symbolLayers)s(l,e,i,n,r,o,a);break;case"CIMTextSymbol":t.symbol&&s(t.symbol,e,i,n,r,o,a);break;case"CIMHatchFill":t.lineSymbol&&s(t.lineSymbol,e,i,n,r,o,a);break;case"CIMPictureMarker":case"CIMCharacterMarker":case"CIMVectorMarker":if(t.markerPlacement&&s(t.markerPlacement,e,i,n,r,o,a),"CIMVectorMarker"===t.type&&t.markerGraphics)for(const l of t.markerGraphics)s(l,e,i,n,r,o,a),s(l.symbol,e,i,n,r,o,a)}}}const o=400;function a(t){const e=t.width;return null!=t.effects?o:Math.max(1.25*e,8)}},33702:function(t,e,i){i.d(e,{f_:function(){return m},$Z:function(){return p},DM:function(){return _},rz:function(){return f}});var n=i(53804),r=i(39686),s=i(98282),o=i(70931),a=i(58941),l=i(86486);class u extends s.k2{getVisualVariableData(t){if(!this._vvData){const e=this.getAttributeDataCoords(t);this._vvData=(0,o.US)(this.visualVariableData,e).setDebugName("storage2")}return this._vvData}getAttributeDataCoords(t){if(!this._uv){const e=(0,l.Kt)(t),i=this.size,n=(0,o.Wh)(e.x),r=(0,o.Wh)(e.y).multiply((0,o.Wh)(256)),s=(0,o.Wh)(e.z).multiply((0,o.Wh)(256)).multiply((0,o.Wh)(256)),a=(0,o.fV)(n.add(r).add(s)),u=(0,o.zi)(a,i),c=a.subtract(u).divide(i);this._uv=new o.ZY(u,c).add(.5).divide(i)}return this._uv}getFilterData(t){const e=this.getAttributeDataCoords(t);return(0,o.US)(this.filterFlags,e).setDebugName("storage0")}getAnimationData(t){const e=this.getAttributeDataCoords(t);return(0,o.US)(this.animation,e).setDebugName("storage1")}getVVData(t){return this.getVisualVariableData(t)}getDataDrivenData0(t){const e=this.getAttributeDataCoords(t);return(0,o.US)(this.dataDriven0,e).setDebugName("storage30")}getDataDrivenData1(t){const e=this.getAttributeDataCoords(t);return(0,o.US)(this.dataDriven1,e).setDebugName("storage31")}getDataDrivenData2(t){const e=this.getAttributeDataCoords(t);return(0,o.US)(this.dataDriven2,e).setDebugName("storage32")}getGPGPUData(t){const e=this.getAttributeDataCoords(t);return(0,o.US)(this.gpgpu,e).setDebugName("storage4")}getLocalTimeOrigin(t){const e=this.getAttributeDataCoords(t);return(0,o.US)(this.localTimeOrigin,e).x.setDebugName("storage5")}getFilterFlags(t){return(0,a.A)("webgl-ignores-sampler-precision")?(0,o.mk)(this.getFilterData(t).x.multiply((0,o.fV)(255))):this.getFilterData(t).x.multiply((0,o.fV)(255))}getLabelVisibility(t){const e=this.getFilterData(t).y.multiply(255);return new o.nt(1).subtract(e)}getAnimationValue(t){return this.getAnimationData(t).x}getSizeValue(t){return this.getVisualVariableData(t).x}getColorValue(t){return this.getVisualVariableData(t).y}getOpacityValue(t){return this.getVisualVariableData(t).z}getRotationValue(t){return this.getVisualVariableData(t).w}}(0,n._)([(0,s.Pi)(o.z7)],u.prototype,"filterFlags",void 0),(0,n._)([(0,s.Pi)(o.z7)],u.prototype,"animation",void 0),(0,n._)([(0,s.Pi)(o.z7)],u.prototype,"gpgpu",void 0),(0,n._)([(0,s.Pi)(o.z7)],u.prototype,"localTimeOrigin",void 0),(0,n._)([(0,s.Pi)(o.z7)],u.prototype,"visualVariableData",void 0),(0,n._)([(0,s.Pi)(o.z7)],u.prototype,"dataDriven0",void 0),(0,n._)([(0,s.Pi)(o.z7)],u.prototype,"dataDriven1",void 0),(0,n._)([(0,s.Pi)(o.z7)],u.prototype,"dataDriven2",void 0),(0,n._)([(0,s.Pi)(o.nt)],u.prototype,"size",void 0);class c extends s.k2{}(0,n._)([(0,s.Pi)(o.nt)],c.prototype,"activeReasons",void 0),(0,n._)([(0,s.Pi)(o.nt)],c.prototype,"highlightAll",void 0);class h extends s.k2{}(0,n._)([(0,s.Pi)(o.ZY)],h.prototype,"position",void 0),(0,n._)([(0,s.Pi)(o.nt)],h.prototype,"distance",void 0),(0,n._)([(0,s.Pi)(o.nt)],h.prototype,"smallSymbolDistance",void 0),(0,n._)([(0,s.Pi)(o.nt)],h.prototype,"smallSymbolSizeThreshold",void 0);var d=i(64522);class f extends s.ZA{}(0,n._)([(0,s.C5)(0,o.eB)],f.prototype,"id",void 0),(0,n._)([(0,s.C5)(1,o.nt)],f.prototype,"bitset",void 0),(0,n._)([(0,s.C5)(2,o.ZY)],f.prototype,"pos",void 0);class p extends s.Y7{}(0,n._)([(0,s.C5)(14,o.ZY)],p.prototype,"nextPos1",void 0),(0,n._)([(0,s.C5)(15,o.ZY)],p.prototype,"nextPos2",void 0);class _ extends s.HS{}class m extends s.A{clip(t,e){let i=new o.nt(0);const n=this.storage.getFilterFlags(t);if(i=i.add((0,o.fV)(2).multiply((0,o.fV)(1).subtract((0,l.i6)(n,0)))),this.inside?i=i.add((0,o.fV)(2).multiply((0,o.fV)(1).subtract((0,l.i6)(n,1)))):this.outside?i=i.add((0,o.fV)(2).multiply((0,l.i6)(n,1))):this.highlight&&(i=i.add((0,o.fV)(2).multiply((0,o.fV)(1).subtract(this._checkHighlight(n))))),null!=e){const t=new o.nt(1).subtract((0,o.PM)(e.x,this.view.currentZoom)),n=(0,o.PM)(e.y,this.view.currentZoom);i=i.add(new o.nt(2).multiply(t.add(n)))}return i}getFragmentOutput(t,e,i=new o.nt(1/255)){const n=new s.mm;return n.glFragColor=this._maybeWriteHittest(e)??this._maybeHighlight(t,i)??t,n}_maybeHighlight(t,e){return this.highlight?new o.Zb(t.rgb,(0,o.PM)(e,t.a)):null}_checkHighlight(t){let e=this._checkHighlightBit(t,0);for(let i=1;i<r.U5;i++)e=e.add(this._checkHighlightBit(t,i));return(0,o.PM)(new o.nt(.1),e.add(this.highlight.highlightAll))}_checkHighlightBit(t,e){return(0,l.yS)(t,e).multiply((0,l.mh)(this.highlight.activeReasons,e))}maybeRunHittest(t,e,i){if(null==this.hittestRequest)return null;const n=this.hittest(t,e,i);let r=(0,o.Tk)((0,o.MM)(n,this.hittestRequest.distance),new o.nt(2),new o.nt(0));const s=this.storage.getAttributeDataCoords(t.id),a=(0,l.nb)(s);r=r.add(this.clip(t.id,t.zoomRange));const u=new o.Zb(new o.nt(1/255),0,0,0);return{glPointSize:new o.nt(1),glPosition:new o.Zb(a,r,1),color:u}}_maybeWriteHittest(t){return null!=this.hittestRequest?t.color:null}}(0,n._)([s.E8],m.prototype,"inside",void 0),(0,n._)([s.E8],m.prototype,"outside",void 0),(0,n._)([(0,s.uK)(c)],m.prototype,"highlight",void 0),(0,n._)([(0,s.Pi)(u)],m.prototype,"storage",void 0),(0,n._)([(0,s.Pi)(d.o)],m.prototype,"view",void 0),(0,n._)([(0,s.uK)(h)],m.prototype,"hittestRequest",void 0)},58991:function(t,e,i){i.d(e,{Bh:function(){return _},KP:function(){return p},Ps:function(){return m}});var n=i(53804),r=i(98282),s=i(70931),o=i(33702),a=i(40846),l=i(42203),u=i(31299),c=i(39979),h=i(86486);class d extends l._{}(0,n._)([(0,r.C5)(5,s.Zb)],d.prototype,"tlbr",void 0),(0,n._)([(0,r.C5)(6,s.nt)],d.prototype,"width",void 0),(0,n._)([(0,r.C5)(7,s.nt)],d.prototype,"height",void 0),(0,n._)([(0,r.C5)(8,s.ZY)],d.prototype,"offset",void 0),(0,n._)([(0,r.C5)(9,s.ZY)],d.prototype,"scale",void 0),(0,n._)([(0,r.C5)(10,s.nt)],d.prototype,"angle",void 0);class f extends o.DM{}function p(t,e){const i=t.view.requiredZoomFactor,n=new s.ZY(e.width,e.height),r=n.multiply(e.scale).multiply(i),o=e.angle.multiply(a.rp),l=(0,s.F8)(o),u=(0,s.gn)(o),c=function(t,e,i,n,r){const o=(0,s.LC)((0,h.mh)(r,a.Fz),(0,s.fV)(1)),l=(0,h.Rj)(new s.Zb(t,0));return(0,s.Tk)(o,(0,s.w0)(n.divide(e.x),i.divide(e.y),0,(0,s.ze)(i.divide(e.x)),n.divide(e.y),0,(0,h._9)((0,s.Zc)(l,0)),(0,h._9)((0,s.Zc)(0,l)),1),(0,s.w0)(n.divide(e.x),i.divide(e.y),0,(0,s.ze)(i.divide(e.x)),n.divide(e.y),0,0,0,1))}(e.id,r,l,u,e.bitset),d=t.localTileOffset.getPatternOffsetAtTileOrigin(n,l,u),f=i.multiply(e.scale).multiply(e.offset.subtract(d)).divide(r),p=new s.eB(e.pos,1),_=c.multiply(p).xy.subtract(f),m=e.tlbr.divide(t.mosaicInfo.size.xyxy);let g=(0,h.mh)(e.bitset,a.cn);return null!=t.visualVariableColor&&(g=(0,s.Tk)((0,h.M8)(t.storage.getColorValue(e.id)),new s.nt(0),g)),{tileTextureCoord:_,tlbr:m,sampleAlphaOnly:g}}function _(t,e){const i=(0,s.zi)(e.tileTextureCoord,new s.nt(1)),n=(0,s.jh)(e.tlbr.xy,e.tlbr.zw,i);let r=(0,s.US)(t.mosaicInfo.texture,n);return r=(0,s.Tk)((0,s.MM)(e.sampleAlphaOnly,new s.nt(.5)),r.aaaa,r),e.color.multiply(r)}class m extends l.z{vertex(t,e){return{...super.vertex(t,e),...p(this,t)}}fragment(t){const e=_(this,t);return this.getFragmentOutput(e,t,new s.nt(0))}}(0,n._)([(0,r.Pi)(c.b)],m.prototype,"mosaicInfo",void 0),(0,n._)([(0,r.Pi)(u.P)],m.prototype,"localTileOffset",void 0),(0,n._)([(0,n.a)(0,(0,r.hF)(d)),(0,n.a)(1,(0,r.hF)(o.$Z))],m.prototype,"vertex",null),(0,n._)([(0,n.a)(0,(0,r.hF)(f))],m.prototype,"fragment",null)},47461:function(t,e,i){i.d(e,{RH:function(){return v},cZ:function(){return p},v9:function(){return m}});var n=i(53804),r=i(98282),s=i(70931),o=i(33702),a=i(58991),l=i(66425),u=i(59224),c=i(31299),h=i(39979),d=i(54537),f=i(15087);const p=16,_=1/p,m=128;class g extends o.rz{}(0,n._)([(0,r.C5)(3,s.Zb)],g.prototype,"color",void 0),(0,n._)([(0,r.C5)(4,s.Zb)],g.prototype,"tlbr",void 0),(0,n._)([(0,r.C5)(5,s.nt)],g.prototype,"angle",void 0),(0,n._)([(0,r.C5)(6,s.nt)],g.prototype,"aux1",void 0),(0,n._)([(0,r.C5)(7,s.nt)],g.prototype,"aux2",void 0),(0,n._)([(0,r.C5)(8,s.ZY)],g.prototype,"aux3",void 0),(0,n._)([(0,r.C5)(9,s.ZY)],g.prototype,"aux4",void 0),(0,n._)([(0,r.C5)(10,s.ZY)],g.prototype,"zoomRange",void 0);class y extends f.A1{}class v extends d.My{vertex(t,e){const{aux1:i,aux2:n,aux3:r,aux4:o}=t,l={...t,width:i,height:n,offset:r,scale:o.multiply(_)},u={...t,halfWidth:i,referenceHalfWidth:n,offset:r,normal:o.subtract(m).multiply(_)},c=(0,d.Yb)(this,u),h=(0,a.KP)(this,l),f=(0,s.MM)(c.isOutline,new s.nt(.5));return{...c,...h,...this.maybeRunHittest(t,e,f)}}fragment(t){const{isOutline:e}=t,i=(0,s.MM)(e,new s.nt(.5)),n=(0,u.o7)(t,this.antialiasingControls.blur),r=(0,a.Bh)(this,t),o=(0,s.Tk)(i,n,r),l=(0,s.Tk)(i,new s.nt(1/255),new s.nt(0));return this.getFragmentOutput(o,t,l)}hittest(t,e,i){return(0,s.Tk)(i,(0,l.My)(this.hittestRequest),(0,l.Lq)(this,t,e))}}(0,n._)([(0,r.Pi)(h.b)],v.prototype,"mosaicInfo",void 0),(0,n._)([(0,r.Pi)(c.P)],v.prototype,"localTileOffset",void 0),(0,n._)([(0,n.a)(0,(0,r.hF)(g)),(0,n.a)(1,(0,r.hF)(o.$Z))],v.prototype,"vertex",null),(0,n._)([(0,n.a)(0,(0,r.hF)(y))],v.prototype,"fragment",null)},42203:function(t,e,i){i.d(e,{_:function(){return h},z:function(){return d}});var n=i(53804),r=i(98282),s=i(70931),o=i(33702),a=i(66425),l=i(81432),u=i(12026),c=i(90906);class h extends o.rz{}(0,n._)([(0,r.C5)(3,s.Zb)],h.prototype,"color",void 0),(0,n._)([(0,r.C5)(4,s.ZY)],h.prototype,"zoomRange",void 0);class d extends o.f_{constructor(){super(...arguments),this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(t,e){const i=(0,c.cF)(this,t.id),n=(0,c.G7)(this,t.id,t.color).multiply(i),r=this.view.displayViewScreenMat3.multiply(new s.eB(t.pos.xy,1)),o=this.clip(t.id,t.zoomRange);return{glPosition:new s.Zb(r.xy,o,1),color:n,...this.maybeRunHittest(t,e,null)}}fragment(t){return this.getFragmentOutput(t.color,t,new s.nt(0))}hittest(t,e){return(0,a.Lq)(this,t,e)}}(0,n._)([(0,r.uK)(l._)],d.prototype,"visualVariableColor",void 0),(0,n._)([(0,r.uK)(u.i)],d.prototype,"visualVariableOpacity",void 0),(0,n._)([(0,n.a)(0,(0,r.hF)(h)),(0,n.a)(1,(0,r.hF)(o.$Z))],d.prototype,"vertex",null),(0,n._)([(0,n.a)(0,(0,r.hF)(o.DM))],d.prototype,"fragment",null)},59224:function(t,e,i){i.d(e,{$0:function(){return b},Xc:function(){return m},cM:function(){return w},fF:function(){return g},fg:function(){return y},o7:function(){return S},xw:function(){return x}});var n=i(53804),r=i(98282),s=i(70931),o=i(33702),a=i(40846),l=i(66425),u=i(81432),c=i(12026),h=i(13635),d=i(21385),f=i(21813),p=i(76347),_=i(90906);class m extends o.rz{}(0,n._)([(0,r.C5)(3,s.Zb)],m.prototype,"color",void 0),(0,n._)([(0,r.C5)(4,s.ZY)],m.prototype,"offset",void 0),(0,n._)([(0,r.C5)(5,s.ZY)],m.prototype,"normal",void 0),(0,n._)([(0,r.C5)(6,s.nt)],m.prototype,"halfWidth",void 0),(0,n._)([(0,r.C5)(7,s.nt)],m.prototype,"referenceHalfWidth",void 0),(0,n._)([(0,r.C5)(8,s.ZY)],m.prototype,"zoomRange",void 0);class g extends o.DM{}class y extends r.k2{}function v(t){return(0,s.T9)(new s.nt(a.Fb).multiply((0,s.PM)(t,new s.nt(a.J5))),new s.nt(1))}function x(t,e){const{halfWidth:i,normal:n}=t,r=v(i),o=(0,s.Bw)(n).multiply(i);return(0,s.qE)(r.multiply(i.subtract(o)).divide(e.add(r).subtract(new s.nt(1))),new s.nt(0),new s.nt(1))}function b(t,e){const{id:i,offset:n,pos:r,normal:o,zoomRange:l}=e,{displayViewScreenMat3:u,displayViewMat3:c}=t.view,h=(0,_.G7)(t,i,e.color),d=(0,_.cF)(t,i),f=function(t,e){const{id:i,halfWidth:n,referenceHalfWidth:r}=e;if((0,_.G5)(t)){const e=new s.nt(2).multiply(r),o=(0,_.Mg)(t,i,e);return new s.nt(.5).multiply(n.divide((0,s.T9)(r,new s.nt(a.Ni)))).multiply(o)}return n}(t,e),p=new s.nt(.5).multiply(t.antialiasingControls.antialiasing),m=(0,s.T9)(f.add(p),new s.nt(.45)).add(new s.nt(.1).multiply(p)),g=v(m).multiply(m).multiply(n),y=c.multiply(new s.eB(g,new s.nt(0))),x=u.multiply(new s.eB(r,new s.nt(1))).add(y),b=new s.nt(2).multiply((0,s.PM)(f,new s.nt(0))).add(t.clip(i,l)),S=new s.Zb(x.xy,b,1);return{color:h,opacity:d,halfWidth:m,normal:o,scaledOffset:g,scaledHalfWidth:f,glPosition:new s.Zb(S.xy,b,1)}}function S(t,e){const{opacity:i,color:n}=t,r=x(t,e);return i.multiply(n).multiply(r)}(0,n._)([(0,r.Pi)(s.nt)],y.prototype,"antialiasing",void 0),(0,n._)([(0,r.Pi)(s.nt)],y.prototype,"blur",void 0);class w extends o.f_{constructor(){super(...arguments),this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(t,e){const i=b(this,t);return{...i,...this.maybeRunHittest(t,e,i.halfWidth)}}fragment(t){const e=S(t,this.antialiasingControls.blur);return this.getFragmentOutput(e,t)}hittest(t,e,i){const{viewMat3:n,tileMat3:r}=this.view,o=n.multiply(r),a=o.multiply(new s.eB(t.pos,1)),u=o.multiply(new s.eB(e.nextPos1,1)),c=o.multiply(new s.eB(e.nextPos2,1)),{distance:h,smallSymbolDistance:d,smallSymbolSizeThreshold:f}=this.hittestRequest,p=(0,s.PM)(i,f.multiply(.5)).multiply(h.subtract(d)),_=this.hittestRequest.position;return(0,s.jk)((0,l.E2)(_,a.xy,u.xy),(0,l.E2)(_,a.xy,c.xy)).subtract(i).add(p)}}(0,n._)([(0,r.Pi)(y)],w.prototype,"antialiasingControls",void 0),(0,n._)([(0,r.uK)(u._)],w.prototype,"visualVariableColor",void 0),(0,n._)([(0,r.uK)(c.i)],w.prototype,"visualVariableOpacity",void 0),(0,n._)([(0,r.uK)(h.n)],w.prototype,"visualVariableSizeMinMaxValue",void 0),(0,n._)([(0,r.uK)(d.F)],w.prototype,"visualVariableSizeScaleStops",void 0),(0,n._)([(0,r.uK)(f.N)],w.prototype,"visualVariableSizeStops",void 0),(0,n._)([(0,r.uK)(p.d)],w.prototype,"visualVariableSizeUnitValue",void 0),(0,n._)([(0,n.a)(0,(0,r.hF)(m)),(0,n.a)(1,(0,r.hF)(o.$Z))],w.prototype,"vertex",null),(0,n._)([(0,n.a)(0,(0,r.hF)(g))],w.prototype,"fragment",null)},31299:function(t,e,i){i.d(e,{P:function(){return a}});var n=i(53804),r=i(98282),s=i(70931),o=i(40846);class a extends r.k2{getPatternOffsetAtTileOrigin(t,e=new s.nt(0),i=new s.nt(1)){const n=new s.ZY(o.YV).divide(t);let r=t.multiply((0,s.jc)(this.maxIntsToLocalOrigin.multiply(n))).add(this.tileOffsetFromLocalOrigin).subtract(new s.nt(.5).multiply(t));return r=new s.ZY(r.x.multiply(i).subtract(r.y.multiply(e)),r.x.multiply(e).add(r.y.multiply(i))),(0,s.zi)(r,t)}}(0,n._)([(0,r.Pi)(s.ZY)],a.prototype,"tileOffsetFromLocalOrigin",void 0),(0,n._)([(0,r.Pi)(s.ZY)],a.prototype,"maxIntsToLocalOrigin",void 0)},39979:function(t,e,i){i.d(e,{b:function(){return o}});var n=i(53804),r=i(98282),s=i(70931);class o extends r.k2{}(0,n._)([(0,r.Pi)(s.ZY)],o.prototype,"size",void 0),(0,n._)([(0,r.Pi)(s.z7)],o.prototype,"texture",void 0)},54537:function(t,e,i){i.d(e,{A7:function(){return v},My:function(){return b},Yb:function(){return x},nj:function(){return S},wG:function(){return y}});var n=i(53804),r=i(98282),s=i(70931),o=i(33702),a=i(40846),l=i(66425),u=i(59224),c=i(86486),h=i(81432),d=i(12026),f=i(13635),p=i(21385),_=i(21813),m=i(76347),g=i(90906);class y extends o.rz{}(0,n._)([(0,r.C5)(3,s.ZY)],y.prototype,"offset",void 0),(0,n._)([(0,r.C5)(4,s.Zb)],y.prototype,"color",void 0),(0,n._)([(0,r.C5)(5,s.ZY)],y.prototype,"normal",void 0),(0,n._)([(0,r.C5)(6,s.nt)],y.prototype,"halfWidth",void 0),(0,n._)([(0,r.C5)(7,s.nt)],y.prototype,"referenceHalfWidth",void 0),(0,n._)([(0,r.C5)(8,s.ZY)],y.prototype,"zoomRange",void 0);class v extends u.fF{}function x(t,e,i){const{id:n,bitset:r}=e,o=(0,c.mh)(r,a.Xx),l=(0,s.MM)(o,new s.nt(.5)),h=(0,u.$0)(t,e),d=(0,s.Tk)(l,h.halfWidth,new s.nt(0)),f=(0,g.cF)(t,n),p=(0,g.G7)(t,n,e.color),_=(0,s.Tk)(l,e.color,p.multiply(f)),m=t.view.displayViewScreenMat3.multiply(new s.eB(e.pos.xy,1)),y=t.clip(e.id),v=new s.Zb(m.xy,y,1),x=(0,s.Tk)(l,h.glPosition,v),b=i&&t.maybeRunHittest(e,i,l);return{isOutline:o,color:_,opacity:new s.nt(1),halfWidth:d,normal:h.normal,glPosition:x,...b}}class b extends o.f_{constructor(){super(...arguments),this.computeAttributes={pos:["nextPos1","nextPos2"]}}}(0,n._)([(0,r.Pi)(u.fg)],b.prototype,"antialiasingControls",void 0),(0,n._)([(0,r.uK)(h._)],b.prototype,"visualVariableColor",void 0),(0,n._)([(0,r.uK)(d.i)],b.prototype,"visualVariableOpacity",void 0),(0,n._)([(0,r.uK)(f.n)],b.prototype,"visualVariableSizeMinMaxValue",void 0),(0,n._)([(0,r.uK)(p.F)],b.prototype,"visualVariableSizeScaleStops",void 0),(0,n._)([(0,r.uK)(_.N)],b.prototype,"visualVariableSizeStops",void 0),(0,n._)([(0,r.uK)(m.d)],b.prototype,"visualVariableSizeUnitValue",void 0);class S extends b{vertex(t,e){return x(this,t,e)}fragment(t){const{color:e,isOutline:i}=t,n=(0,s.MM)(i,new s.nt(.5)),r=(0,u.o7)(t,this.antialiasingControls.blur),o=(0,s.Tk)(n,r,e),a=(0,s.Tk)(n,new s.nt(1/255),new s.nt(0));return this.getFragmentOutput(o,t,a)}hittest(t,e,i){return(0,s.Tk)(i,(0,l.My)(this.hittestRequest),(0,l.Lq)(this,t,e))}}(0,n._)([(0,n.a)(0,(0,r.hF)(y)),(0,n.a)(1,(0,r.hF)(o.$Z))],S.prototype,"vertex",null),(0,n._)([(0,n.a)(0,(0,r.hF)(v))],S.prototype,"fragment",null)},51741:function(t,e,i){i.d(e,{_u:function(){return d},dW:function(){return f},vx:function(){return p}});var n=i(53804),r=i(98282),s=i(70931),o=i(33702),a=i(42203),l=i(31299),u=i(39979);class c extends a._{}(0,n._)([(0,r.C5)(5,s.Zb)],c.prototype,"tlbr",void 0),(0,n._)([(0,r.C5)(6,s.nt)],c.prototype,"inverseRasterizationScale",void 0);class h extends o.DM{}function d(t,e){const i=e.tlbr.xy,n=e.tlbr.zw,r=n.x.subtract(i.x),o=i.y.subtract(n.y),a=new s.ZY(r,o).multiply(e.inverseRasterizationScale),l=a.multiply(t.view.requiredZoomFactor),u=function(t){const e=new s.nt(1),i=new s.nt(0);return new s.U(e.divide(t.x),i.divide(t.y),0,(0,s.ze)(i.divide(t.x)),e.divide(t.y),0,0,0,1)}(l),c=t.localTileOffset.getPatternOffsetAtTileOrigin(a).divide(l),h=new s.eB(e.pos,1);return{tileTextureCoord:u.multiply(h).xy.subtract(c),tlbr:e.tlbr.divide(t.mosaicInfo.size.xyxy)}}function f(t,e){const i=(0,s.zi)(t.tileTextureCoord,new s.nt(1)),n=(0,s.jh)(t.tlbr.xy,t.tlbr.zw,i),r=(0,s.US)(e.texture,n);return t.color.multiply(r)}class p extends a.z{vertex(t,e){return{...super.vertex(t,e),...d(this,t)}}fragment(t){const e=f(t,this.mosaicInfo);return this.getFragmentOutput(e,t,new s.nt(0))}}(0,n._)([(0,r.Pi)(u.b)],p.prototype,"mosaicInfo",void 0),(0,n._)([(0,r.Pi)(l.P)],p.prototype,"localTileOffset",void 0),(0,n._)([(0,n.a)(0,(0,r.hF)(c)),(0,n.a)(1,(0,r.hF)(o.$Z))],p.prototype,"vertex",null),(0,n._)([(0,n.a)(0,(0,r.hF)(h))],p.prototype,"fragment",null)},15087:function(t,e,i){i.d(e,{A1:function(){return f},tA:function(){return p}});var n=i(53804),r=i(98282),s=i(70931),o=i(33702),a=i(59224),l=i(31299),u=i(39979),c=i(54537),h=i(51741);class d extends c.wG{}(0,n._)([(0,r.C5)(9,s.Zb)],d.prototype,"tlbr",void 0),(0,n._)([(0,r.C5)(10,s.nt)],d.prototype,"inverseRasterizationScale",void 0);class f extends c.A7{}class p extends c.nj{vertex(t,e){return{...(0,c.Yb)(this,t,e),...(0,h._u)(this,t)}}fragment(t){const{isOutline:e}=t,i=(0,s.MM)(e,new s.nt(.5)),n=(0,a.o7)(t,this.antialiasingControls.blur),r=(0,h.dW)(t,this.mosaicInfo),o=(0,s.Tk)(i,n,r),l=(0,s.Tk)(i,new s.nt(1/255),new s.nt(0));return this.getFragmentOutput(o,t,l)}}(0,n._)([(0,r.Pi)(u.b)],p.prototype,"mosaicInfo",void 0),(0,n._)([(0,r.Pi)(l.P)],p.prototype,"localTileOffset",void 0),(0,n._)([(0,n.a)(0,(0,r.hF)(d)),(0,n.a)(1,(0,r.hF)(o.$Z))],p.prototype,"vertex",null),(0,n._)([(0,n.a)(0,(0,r.hF)(f))],p.prototype,"fragment",null)},64522:function(t,e,i){i.d(e,{o:function(){return o}});var n=i(53804),r=i(98282),s=i(70931);class o extends r.k2{}(0,n._)([(0,r.Pi)(s.U)],o.prototype,"displayViewScreenMat3",void 0),(0,n._)([(0,r.Pi)(s.U)],o.prototype,"displayViewMat3",void 0),(0,n._)([(0,r.Pi)(s.U)],o.prototype,"displayMat3",void 0),(0,n._)([(0,r.Pi)(s.U)],o.prototype,"viewMat3",void 0),(0,n._)([(0,r.Pi)(s.U)],o.prototype,"tileMat3",void 0),(0,n._)([(0,r.Pi)(s.nt)],o.prototype,"displayZoomFactor",void 0),(0,n._)([(0,r.Pi)(s.nt)],o.prototype,"requiredZoomFactor",void 0),(0,n._)([(0,r.Pi)(s.ZY)],o.prototype,"tileOffset",void 0),(0,n._)([(0,r.Pi)(s.nt)],o.prototype,"currentScale",void 0),(0,n._)([(0,r.Pi)(s.nt)],o.prototype,"currentZoom",void 0),(0,n._)([(0,r.Pi)(s.nt)],o.prototype,"metersPerSRUnit",void 0),(0,n._)([(0,r.Pi)(s.nt)],o.prototype,"rotation",void 0),(0,n._)([(0,r.Pi)(s.nt)],o.prototype,"pixelRatio",void 0)},81432:function(t,e,i){i.d(e,{_:function(){return a}});var n=i(53804),r=i(98282),s=i(70931),o=i(86486);class a extends r.k2{getColor(t,e,i){return(0,s.j1)([(0,s.or)((0,o.M8)(t),i),e],[(0,s.$5)(t,this.values.first()),this.colors.first()],[(0,s.aX)(t,this.values.last()),this.colors.last()],[!0,()=>{const e=this.values.findIndex((e=>(0,s.MM)(e,t))),i=this.values.get(e),n=e.subtract(1),r=this.values.get(n),o=t.subtract(r).divide(i.subtract(r));return(0,s.jh)(this.colors.get(n),this.colors.get(e),o)}])}}(0,n._)([(0,r.Pi)(s.My.ofType(s.Zb,8))],a.prototype,"colors",void 0),(0,n._)([(0,r.Pi)(s.My.ofType(s.nt,8))],a.prototype,"values",void 0)},12026:function(t,e,i){i.d(e,{i:function(){return a}});var n=i(53804),r=i(98282),s=i(70931),o=i(86486);class a extends r.k2{getOpacity(t){return(0,s.j1)([(0,o.M8)(t),new s.nt(1)],[(0,s.$5)(t,this.opacityValues.first()),this.opacities.first()],[(0,s.aX)(t,this.opacityValues.last()),this.opacities.last()],[!0,()=>{const e=this.opacityValues.findIndex((e=>(0,s.MM)(e,t))),i=this.opacityValues.get(e),n=e.subtract(1),r=this.opacityValues.get(n),o=t.subtract(r).divide(i.subtract(r));return(0,s.jh)(this.opacities.get(n),this.opacities.get(e),o)}])}}(0,n._)([(0,r.Pi)(s.My.ofType(s.nt,8))],a.prototype,"opacities",void 0),(0,n._)([(0,r.Pi)(s.My.ofType(s.nt,8))],a.prototype,"opacityValues",void 0)},13635:function(t,e,i){i.d(e,{n:function(){return a}});var n=i(53804),r=i(98282),s=i(70931),o=i(86486);class a extends r.k2{getSize(t,e){const i=this.minMaxValueAndSize.xy,n=this.minMaxValueAndSize.zw;return(0,s.Tk)((0,o.M8)(t),e,(()=>{const e=t.subtract(i.x).divide(i.y.subtract(i.x)),r=(0,s.qE)(e,new s.nt(0),new s.nt(1));return n.x.add(r.multiply(n.y.subtract(n.x)))}))}}(0,n._)([(0,r.Pi)(s.Zb)],a.prototype,"minMaxValueAndSize",void 0)},21385:function(t,e,i){i.d(e,{F:function(){return o}});var n=i(53804),r=i(98282),s=i(70931);class o extends r.k2{getSizeForViewScale(t){return(0,s.j1)([(0,s.$5)(t,this.values.first()),this.sizes.first()],[(0,s.aX)(t,this.values.last()),this.sizes.last()],[!0,()=>{const e=this.values.findIndex((e=>(0,s.MM)(e,t))),i=this.values.get(e),n=e.subtract(1),r=this.values.get(n),o=t.subtract(r).divide(i.subtract(r));return(0,s.jh)(this.sizes.get(n),this.sizes.get(e),o)}])}}(0,n._)([(0,r.Pi)(s.My.ofType(s.nt,8))],o.prototype,"sizes",void 0),(0,n._)([(0,r.Pi)(s.My.ofType(s.nt,8))],o.prototype,"values",void 0)},21813:function(t,e,i){i.d(e,{N:function(){return a}});var n=i(53804),r=i(98282),s=i(70931),o=i(86486);class a extends r.k2{getSize(t,e){const i=(0,s.j1)([(0,o.M8)(t),e],[(0,s.$5)(t,this.values.first()),this.sizes.first()],[(0,s.aX)(t,this.values.last()),this.sizes.last()],[!0,()=>{const e=this.values.findIndex((e=>(0,s.MM)(e,t))),i=this.values.get(e),n=e.subtract(1),r=this.values.get(n),o=t.subtract(r).divide(i.subtract(r));return(0,s.jh)(this.sizes.get(n),this.sizes.get(e),o)}]);return(0,s.Tk)((0,o.M8)(i),e,i)}}(0,n._)([(0,r.Pi)(s.My.ofType(s.nt,8))],a.prototype,"sizes",void 0),(0,n._)([(0,r.Pi)(s.My.ofType(s.nt,8))],a.prototype,"values",void 0)},76347:function(t,e,i){i.d(e,{d:function(){return a}});var n=i(53804),r=i(98282),s=i(70931),o=i(86486);class a extends r.k2{getSize(t,e){return(0,s.Tk)((0,o.M8)(t),e,t.multiply(this.unitValueToPixelsRatio))}}(0,n._)([(0,r.Pi)(s.nt)],a.prototype,"unitValueToPixelsRatio",void 0)},40846:function(t,e,i){var n;i.d(e,{$w:function(){return c},Fb:function(){return a},Fz:function(){return m},H_:function(){return n},J5:function(){return l},M:function(){return d},Ni:function(){return h},V5:function(){return o},Xx:function(){return _},YV:function(){return b},au:function(){return u},b5:function(){return y},bg:function(){return v},cn:function(){return p},eo:function(){return S},kx:function(){return g},os:function(){return r},qM:function(){return f},rp:function(){return s},ti:function(){return x}}),function(t){t[t.Geographic=0]="Geographic",t[t.Arithmatic=1]="Arithmatic"}(n||(n={}));const r=3.14159265359/180,s=3.14159265359/128,o=1,a=1.1,l=1,u=24,c=8,h=1e-5,d=.05,f=1e-30,p=4,_=0,m=2,g=2,y=3,v=0,x=3,b=16777216,S=1.1},66425:function(t,e,i){i.d(e,{Bo:function(){return c},Bs:function(){return l},E2:function(){return o},Lq:function(){return d},My:function(){return h},g$:function(){return f},kW:function(){return a}});var n=i(70931),r=i(40846),s=i(86486);function o(t,e,i){const r=i.subtract(e),s=(a=t.subtract(e),l=r,(0,n.Om)(a,(0,n.S8)(l))),o=(0,n.qE)(s.divide((0,n.Bw)(r)),new n.nt(0),new n.nt(1));var a,l;return(0,n.Io)(t,e.add(o.multiply(i.subtract(e))))}function a(t){const e=(0,n.tn)(t);return(0,n.PM)(e.x.add(e.y).add(e.z),new n.nt(1.05))}function l(t,e,i,r){const s=new n.U(i.x.multiply(r.y).subtract(r.x.multiply(i.y)),r.x.multiply(e.y).subtract(e.x.multiply(r.y)),e.x.multiply(i.y).subtract(i.x.multiply(e.y)),i.y.subtract(r.y),r.y.subtract(e.y),e.y.subtract(i.y),r.x.subtract(i.x),e.x.subtract(r.x),i.x.subtract(e.x)),o=e.x.multiply(i.y.subtract(r.y)),a=i.x.multiply(r.y.subtract(e.y)),l=r.x.multiply(e.y.subtract(i.y)),u=o.add(a).add(l);return new n.nt(1).divide(u).multiply(s.multiply(new n.eB(1,t)))}function u(t,e,i,r){return(0,n.LC)(a(l(t,e,i,r)),new n.nt(1))}function c(t,e,i,a){const l=i.subtract(e),c=a.subtract(e),h=(0,s.tL)(l,c),d=(0,n.Uo)((0,n.Xe)(h,new n.nt(r.M)),(0,n.MM)(h,new n.nt(-r.M)));return(0,n.j1)([(0,n.Uo)((0,n.AU)(d),u(t.xy,e,i,a)),new n.nt(-1)],[!0,()=>{const r=o(t,e,i),s=o(t,i,a),l=o(t,a,e);return(0,n.jk)((0,n.jk)(r,s),l)}])}function h(t){return t.distance.add(1)}function d(t,e,i){const{viewMat3:r,tileMat3:s}=t.view,o=r.multiply(s),a=o.multiply(new n.eB(e.pos,1)),l=o.multiply(new n.eB(i.nextPos1,1)),u=o.multiply(new n.eB(i.nextPos2,1));return c(t.hittestRequest.position,a.xy,l.xy,u.xy)}function f(t,e,i){return(0,n.Io)(t,i).subtract(e)}},86486:function(t,e,i){i.d(e,{K5:function(){return h},Kt:function(){return p},M8:function(){return a},Rj:function(){return _},_9:function(){return o},i6:function(){return d},mh:function(){return c},nb:function(){return u},p8:function(){return y},tL:function(){return l},xf:function(){return m},yS:function(){return f},zb:function(){return g},zy:function(){return v}});var n=i(39686),r=i(70931),s=i(40846);function o(t){const e=(0,r.fV)(12.9898),i=(0,r.fV)(78.233),n=(0,r.fV)(43758.5453),s=(0,r.Om)(t,(0,r.Zc)(e,i)),o=(0,r.zi)(s,(0,r.fV)(3.14));return(0,r.jc)((0,r.F8)(o).multiply(n))}function a(t){return(0,r.LC)(t,(0,r.fV)(s.qM))}function l(t,e){return t.x.multiply(e.y).subtract(e.x.multiply(t.y))}function u(t){return t.multiply(2).subtract(1)}function c(t,e){const i=(0,r.fV)(2**e);return(0,r.zi)((0,r.RI)(t.divide(i)),(0,r.fV)(2))}function h(t,e){return(0,r.MM)(c(t,e),(0,r.fV)(.5))}function d(t,e){return c(t,e+n.U5)}function f(t,e){return c(t,e)}function p(t){const e=c(t.z,7),i=(0,r.fV)(1).subtract(e),n=t.xyz.subtract((0,r.eR)(0,0,(0,r.fV)(128)));return i.multiply(t).add(e.multiply(n))}function _(t){const e=(0,r.ln)(255/256,255/65536,255/16777216,255/4294967296);return(0,r.Om)(t,e)}function m(t){return(0,r.T9)((0,r.T9)((0,r.T9)(t.x,t.y),t.z),t.w)}function g(t){return new r.nt(1).subtract(t)}function y(t){return t.subtract(new r.nt(1))}function v(t,e){return t.subtract(new r.nt(e))}},90906:function(t,e,i){i.d(e,{G5:function(){return r},G7:function(){return o},Mg:function(){return s},TL:function(){return l},cF:function(){return a},g_:function(){return u}});var n=i(70931);function r(t){return null!=t.visualVariableSizeMinMaxValue||null!=t.visualVariableSizeScaleStops||null!=t.visualVariableSizeStops||null!=t.visualVariableSizeUnitValue}function s(t,e,i){if(r(t)){const n=t.storage.getSizeValue(e);return t.visualVariableSizeMinMaxValue?.getSize(n,i)??t.visualVariableSizeScaleStops?.getSizeForViewScale(t.view.currentScale)??t.visualVariableSizeStops?.getSize(n,i)??t.visualVariableSizeUnitValue?.getSize(n,i)}return i}function o(t,e,i,r=new n.x(!1)){if(null==t.visualVariableColor)return i;const s=t.storage.getColorValue(e);return t.visualVariableColor.getColor(s,i,r)}function a(t,e){if(null==t.visualVariableOpacity)return new n.nt(1);const i=t.storage.getOpacityValue(e);return t.visualVariableOpacity.getOpacity(i)}function l(t,e){if(null==t.visualVariableRotation)return n.U.identity();const i=t.storage.getRotationValue(e);return t.visualVariableRotation.getVVRotationMat3(i)}function u(t,e){if(null==t.visualVariableRotation)return new n.nt(0);const i=t.storage.getRotationValue(e);return t.visualVariableRotation.getNormalizedAngle(i)}},22516:function(t,e,i){i.d(e,{K:function(){return u}});var n=i(39819),r=i(40633),s=i(34194),o=(i(13798),i(58941),i(41835),i(85456),i(96402),i(95904)),a=(i(69452),i(12285),i(88413));function l(t,e,i){const s=e.length;if(s!==i){const o=new n.A("Invalid Uniform",`Invalid length, expected ${i} but got ${s}`,{uniformName:t,values:e});r.A.getLogger("esri.views.2d.engine.webgl.shaderGraph.typed.TypedShaderProgram").errorOnce(o)}}class u{constructor(t,e,i,n,r,s){this._program=null,this._vao=null,this._temporaryTextures=[],this.vertexShader=t,this.fragmentShader=e,this._locations=i,this._locationInfo=n,this._uniformBindings=r,this._transformFeedbackBindings=s}destroy(){this._program&&this._program.dispose(),this.cleanupTemporaryTextures()}get locations(){return this._locations}get locationInfo(){return this._locationInfo}setUniforms(t){this._uniforms=t}cleanupTemporaryTextures(){for(const t of this._temporaryTextures)t.dispose();this._temporaryTextures=[]}bind(t){const e=this._uniforms;if(!this._program){const e=new Map;for(const[t,i]of this._locations)e.set(t,i);const i=[];for(const t of this._transformFeedbackBindings??[]){const{index:e,propertyKey:n}=t;i[e]=`v_${n}`}this._program=new o.B(t,this.vertexShader,this.fragmentShader,e,new Map,i)}const i=this._program;t.useProgram(i);for(const n of this._uniformBindings){const{shaderModulePath:r,uniformName:o,uniformType:u,uniformArrayLength:c}=n,h=(0,s.wc)(r,e);if(null==h){if("sampler2D"===u)continue;throw new Error(`Failed to find uniform value for ${r}`)}switch("array"===u?n.uniformArrayElementType:u){case"sampler2D":{const{unit:e,texture:n}=h;if(i.setUniform1i(o,e),"type"in n)t.bindTexture(n,e);else{const i=(0,a.sZ)(t,n.descriptor,n.data);t.bindTexture(i,e)}break}case"int":if(!c){i.setUniform1i(o,h);break}l(n.uniformName,h,c),i.setUniform1iv(o,h);break;case"float":if(!c){i.setUniform1f(o,h);break}l(n.uniformName,h,c),i.setUniform1fv(o,h);break;case"vec2":if(!c){i.setUniform2f(o,h[0],h[1]);break}l(n.uniformName,h,c),i.setUniform2fv(o,h.flat());break;case"vec3":if(!c){i.setUniform3f(o,h[0],h[1],h[2]);break}l(n.uniformName,h,c),i.setUniform3fv(o,h.flat());break;case"vec4":if(!c){i.setUniform4f(o,h[0],h[1],h[2],h[3]);break}l(n.uniformName,h,c),i.setUniform4fv(o,h.flat());break;case"mat3":i.setUniformMatrix3fv(o,h);break;case"mat4":i.setUniformMatrix4fv(o,h);break;default:throw new Error(`Unable to set uniform for type ${u}`)}}}}},97673:function(t,e,i){function n(t){return t.locationsMap}i.d(e,{V:function(){return n},i:function(){return r}});const r={color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1}},94020:function(t,e,i){i.d(e,{T:function(){return r}});var n=i(44723);const r={shaders:{vertexShader:(0,n.Q)("background/background.vert"),fragmentShader:(0,n.Q)("background/background.frag")},attributes:new Map([["a_pos",0]])}},47272:function(t,e,i){i.d(e,{H:function(){return r}});var n=i(44723);const r={shaders:{vertexShader:(0,n.Q)("tileInfo/tileInfo.vert"),fragmentShader:(0,n.Q)("tileInfo/tileInfo.frag")},attributes:new Map([["a_pos",0]])}},44723:function(t,e,i){i.d(e,{Q:function(){return s}});const n=new(i(65644).Z)((r={background:{"background.frag":"uniform lowp vec4 u_color;\nvoid main() {\ngl_FragColor = u_color;\n}","background.vert":"attribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform mediump vec2 u_coord_range;\nuniform mediump float u_depth;\nvoid main() {\nvec3 v_pos = u_dvsMat3 * vec3(u_coord_range * a_pos, 1.0);\ngl_Position = vec4(v_pos.xy, 0.0, 1.0);\n}"},bitBlit:{"bitBlit.frag":"uniform lowp sampler2D u_tex;\nuniform lowp float u_opacity;\nvarying mediump vec2 v_uv;\nvoid main() {\nlowp vec4 color = texture2D(u_tex, v_uv);\ngl_FragColor = color * u_opacity;\n}","bitBlit.vert":"attribute vec2 a_pos;\nattribute vec2 a_tex;\nvarying mediump vec2 v_uv;\nvoid main(void) {\ngl_Position = vec4(a_pos , 0.0, 1.0);\nv_uv = a_tex;\n}"},debug:{overlay:{"overlay.frag":"precision mediump float;\nvarying vec4 v_color;\nvoid main(void) {\ngl_FragColor = v_color;\n}","overlay.vert":"attribute vec3 a_PositionAndFlags;\nuniform mat3 u_dvsMat3;\nuniform vec4 u_colors[4];\nuniform float u_opacities[4];\nvarying vec4 v_color;\nvoid main(void) {\nvec2 position = a_PositionAndFlags.xy;\nfloat flags = a_PositionAndFlags.z;\nint colorIndex = int(mod(flags, 4.0));\nvec4 color;\nfor (int i = 0; i < 4; i++) {\ncolor = u_colors[i];\nif (i == colorIndex) {\nbreak;\n}\n}\nint opacityIndex = int(mod(floor(flags / 4.0), 4.0));\nfloat opacity;\nfor (int i = 0; i < 4; i++) {\nopacity = u_opacities[i];\nif (i == opacityIndex) {\nbreak;\n}\n}\nv_color = color * opacity;\ngl_Position = vec4((u_dvsMat3 * vec3(position, 1.0)).xy, 0.0, 1.0);\n}"}},dot:{dot:{"dot.frag":"precision mediump float;\nvarying vec4 v_color;\nvarying float v_dotRatio;\nvarying float v_invEdgeRatio;\nuniform highp float u_tileZoomFactor;\nvoid main()\n{\nfloat dist = length(gl_PointCoord - vec2(.5, .5)) * 2.;\nfloat alpha = smoothstep(0., 1., v_invEdgeRatio * (dist - v_dotRatio) + 1.);\ngl_FragColor = v_color * alpha;\n}","dot.vert":"precision highp float;\nattribute vec2 a_pos;\nuniform sampler2D u_texture;\nuniform highp mat3 u_dvsMat3;\nuniform highp float u_tileZoomFactor;\nuniform highp float u_dotSize;\nuniform highp float u_pixelRatio;\nvarying vec2 v_pos;\nvarying vec4 v_color;\nvarying float v_dotRatio;\nvarying float v_invEdgeRatio;\nconst float EPSILON = 0.000001;\nvoid main()\n{\nmat3 tileToTileTexture = mat3(  1., 0., 0.,\n0., -1., 0.,\n0., 1., 1.  );\nvec3 texCoords = tileToTileTexture * vec3(a_pos.xy / 512., 1.);\nv_color = texture2D(u_texture, texCoords.xy);\nfloat smoothEdgeWidth = max(u_dotSize / 2., 1.) ;\nfloat z = 0.;\nz += 2.0 * step(v_color.a, EPSILON);\ngl_PointSize = (smoothEdgeWidth + u_dotSize);\ngl_Position = vec4((u_dvsMat3 * vec3(a_pos + .5, 1.)).xy, z, 1.);\nv_dotRatio = u_dotSize / gl_PointSize;\nv_invEdgeRatio = -1. / ( smoothEdgeWidth / gl_PointSize );\ngl_PointSize  *= (u_pixelRatio * u_tileZoomFactor);\n}"}},filtering:{"bicubic.glsl":"vec4 computeWeights(float v) {\nfloat b = 1.0 / 6.0;\nfloat v2 = v * v;\nfloat v3 = v2 * v;\nfloat w0 = b * (-v3 + 3.0 * v2 - 3.0 * v + 1.0);\nfloat w1 = b * (3.0 * v3  - 6.0 * v2 + 4.0);\nfloat w2 = b * (-3.0 * v3 + 3.0 * v2 + 3.0 * v + 1.0);\nfloat w3 = b * v3;\nreturn vec4(w0, w1, w2, w3);\n}\nvec4 bicubicOffsetsAndWeights(float v) {\nvec4 w = computeWeights(v);\nfloat g0 = w.x + w.y;\nfloat g1 = w.z + w.w;\nfloat h0 = 1.0 - (w.y / g0) + v;\nfloat h1 = 1.0 + (w.w / g1) - v;\nreturn vec4(h0, h1, g0, g1);\n}\nvec4 sampleBicubicBSpline(sampler2D sampler, vec2 coords, vec2 texSize) {\nvec2 eX = vec2(1.0 / texSize.x, 0.0);\nvec2 eY = vec2(0.0, 1.0 / texSize.y);\nvec2 texel = coords * texSize - 0.5;\nvec3 hgX = bicubicOffsetsAndWeights(fract(texel).x).xyz;\nvec3 hgY = bicubicOffsetsAndWeights(fract(texel).y).xyz;\nvec2 coords10 = coords + hgX.x * eX;\nvec2 coords00 = coords - hgX.y * eX;\nvec2 coords11 = coords10 + hgY.x * eY;\nvec2 coords01 = coords00 + hgY.x * eY;\ncoords10 = coords10 - hgY.y * eY;\ncoords00 = coords00 - hgY.y * eY;\nvec4 color00 = texture2D(sampler, coords00);\nvec4 color10 = texture2D(sampler, coords10);\nvec4 color01 = texture2D(sampler, coords01);\nvec4 color11 = texture2D(sampler, coords11);\ncolor00 = mix(color00, color01, hgY.z);\ncolor10 = mix(color10, color11, hgY.z);\ncolor00 = mix(color00, color10, hgX.z);\nreturn color00;\n}","bilinear.glsl":"vec4 sampleBilinear(sampler2D sampler, vec2 coords, vec2 texSize) {\nvec2 texelStart = floor(coords * texSize);\nvec2 coord0 = texelStart / texSize;\nvec2 coord1 = (texelStart +  vec2(1.0, 0.0)) / texSize;\nvec2 coord2 = (texelStart +  vec2(0.0, 1.0)) / texSize;\nvec2 coord3 = (texelStart +  vec2(1.0, 1.0)) / texSize;\nvec4 color0 = texture2D(sampler, coord0);\nvec4 color1 = texture2D(sampler, coord1);\nvec4 color2 = texture2D(sampler, coord2);\nvec4 color3 = texture2D(sampler, coord3);\nvec2 blend = fract(coords * texSize);\nvec4 color01 = mix(color0, color1, blend.x);\nvec4 color23 = mix(color2, color3, blend.x);\nvec4 color = mix(color01, color23, blend.y);\n#ifdef NNEDGE\nfloat alpha = floor(color0.a * color1.a * color2.a * color3.a + 0.5);\ncolor = color * alpha + (1.0 - alpha) * texture2D(sampler, coords);\n#endif\nreturn color;\n}","epx.glsl":"vec4 sampleEPX(sampler2D sampler, float size, vec2 coords, vec2 texSize) {\nvec2 invSize = 1.0 / texSize;\nvec2 texel = coords * texSize;\nvec2 texel_i = floor(texel);\nvec2 texel_frac = fract(texel);\nvec4 colorP = texture2D(sampler, texel_i * invSize);\nvec4 colorP1 = vec4(colorP);\nvec4 colorP2 = vec4(colorP);\nvec4 colorP3 = vec4(colorP);\nvec4 colorP4 = vec4(colorP);\nvec4 colorA = texture2D(sampler, (texel_i - vec2(0.0, 1.0)) * invSize);\nvec4 colorB = texture2D(sampler, (texel_i + vec2(1.0, 0.0)) * invSize);\nvec4 colorC = texture2D(sampler, (texel_i - vec2(1.0, 0.0)) * invSize);\nvec4 colorD = texture2D(sampler, (texel_i + vec2(0.0, 1.0)) * invSize);\nif (colorC == colorA && colorC != colorD && colorA != colorB) {\ncolorP1 = colorA;\n}\nif (colorA == colorB && colorA != colorC && colorB != colorD) {\ncolorP2 = colorB;\n}\nif (colorD == colorC && colorD != colorB && colorC != colorA) {\ncolorP3 = colorC;\n}\nif (colorB == colorD && colorB != colorA && colorD != colorC) {\ncolorP4 = colorD;\n}\nvec4 colorP12 = mix(colorP1, colorP2, texel_frac.x);\nvec4 colorP34 = mix(colorP1, colorP2, texel_frac.x);\nreturn mix(colorP12, colorP34, texel_frac.y);\n}"},heatmap:{heatmapResolve:{"heatmapResolve.frag":"precision highp float;\n#ifdef HEATMAP_PRECISION_HALF_FLOAT\n#define COMPRESSION_FACTOR 4.0\n#else\n#define COMPRESSION_FACTOR 1.0\n#endif\nuniform sampler2D u_texture;\nuniform sampler2D u_gradient;\nuniform vec2 u_densityMinAndInvRange;\nuniform float u_densityNormalization;\nvarying vec2 v_uv;\nvoid main() {\nvec4 data = texture2D(u_texture, v_uv);\nfloat density = data.r * COMPRESSION_FACTOR;\ndensity *= u_densityNormalization;\ndensity = (density - u_densityMinAndInvRange.x) * u_densityMinAndInvRange.y;\nvec4 color = texture2D(u_gradient, vec2(density, 0.5));\ngl_FragColor = vec4(color.rgb * color.a, color.a);\n}","heatmapResolve.vert":"precision highp float;\nattribute vec2 a_pos;\nvarying vec2 v_uv;\nvoid main() {\nv_uv = a_pos;\ngl_Position = vec4(a_pos * 2.0 - 1.0, 1., 1.);\n}"}},highlight:{"blur.frag":"varying mediump vec2 v_texcoord;\nuniform mediump vec4 u_direction;\nuniform mediump mat4 u_channelSelector;\nuniform mediump float u_sigma;\nuniform sampler2D u_texture;\nmediump float gauss1(mediump vec2 dir) {\nreturn exp(-dot(dir, dir) / (2.0 * u_sigma * u_sigma));\n}\nmediump vec4 selectChannel(mediump vec4 sample) {\nreturn u_channelSelector * sample;\n}\nvoid accumGauss1(mediump float i, inout mediump float tot, inout mediump float weight) {\nmediump float w = gauss1(i * u_direction.xy);\ntot += selectChannel(texture2D(u_texture, v_texcoord + i * u_direction.zw))[3] * w;\nweight += w;\n}\nvoid main(void) {\nmediump float tot = 0.0;\nmediump float weight = 0.0;\naccumGauss1(-5.0, tot, weight);\naccumGauss1(-4.0, tot, weight);\naccumGauss1(-3.0, tot, weight);\naccumGauss1(-2.0, tot, weight);\naccumGauss1(-1.0, tot, weight);\naccumGauss1(0.0, tot, weight);\naccumGauss1(1.0, tot, weight);\naccumGauss1(2.0, tot, weight);\naccumGauss1(3.0, tot, weight);\naccumGauss1(4.0, tot, weight);\naccumGauss1(5.0, tot, weight);\ngl_FragColor = vec4(0.0, 0.0, 0.0, tot / weight);\n}","highlight.frag":"varying mediump vec2 v_texcoord;\nuniform sampler2D u_texture;\nuniform mediump float u_sigma;\nuniform sampler2D u_shade;\nuniform mediump vec2 u_minMaxDistance;\nmediump float estimateDistance() {\nmediump float y = texture2D(u_texture, v_texcoord)[3];\nconst mediump float y0 = 0.5;\nmediump float m0 = 1.0 / (sqrt(2.0 * 3.1415) * u_sigma);\nmediump float d = (y - y0) / m0;\nreturn d;\n}\nmediump vec4 shade(mediump float d) {\nmediump float mappedDistance = (d - u_minMaxDistance.x) / (u_minMaxDistance.y - u_minMaxDistance.x);\nmappedDistance = clamp(mappedDistance, 0.0, 1.0);\nreturn texture2D(u_shade, vec2(mappedDistance, 0.5));\n}\nvoid main(void) {\nmediump float d = estimateDistance();\ngl_FragColor = shade(d);\n}","textured.vert":"attribute mediump vec2 a_position;\nattribute mediump vec2 a_texcoord;\nvarying mediump vec2 v_texcoord;\nvoid main(void) {\ngl_Position = vec4(a_position, 0.0, 1.0);\nv_texcoord = a_texcoord;\n}"},materials:{"attributeData.glsl":"uniform highp sampler2D filterFlags;\nuniform highp sampler2D animation;\nuniform highp sampler2D gpgpu;\nuniform highp sampler2D visualVariableData;\nuniform highp sampler2D dataDriven0;\nuniform highp sampler2D dataDriven1;\nuniform highp sampler2D dataDriven2;\nuniform float size;\nhighp vec2 getAttributeDataCoords(in highp vec3 id) {\nhighp vec3  texel = unpackDisplayIdTexel(id);\nhighp float u32 = float(int(texel.r) + int(texel.g) * 256 + int(texel.b) * 256 * 256);\nhighp float col = mod(u32, size);\nhighp float row = (u32 - col) / size;\nhighp float u = col / size;\nhighp float v = row / size;\nreturn vec2(u, v);\n}\nhighp vec2 getAttributeDataTextureCoords(in highp vec3 id) {\nreturn (getAttributeDataCoords(id) * 2.0) - 1.0 + (.5 / vec2(size));\n}\nhighp vec4 getFilterData(in highp vec3 id) {\nvec2 coords = getAttributeDataCoords(id);\nreturn texture2D(filterFlags, coords);\n}\nhighp vec4 getAnimation(in highp vec3 id) {\nhighp vec2 coords = getAttributeDataCoords(id);\nreturn texture2D(animation, coords);\n}\nhighp vec4 getVisualVariableData(in highp vec3 id) {\nhighp vec2 coords = getAttributeDataCoords(id);\nreturn texture2D(visualVariableData, coords);\n}\nhighp vec4 getDataDriven0(in highp vec3 id) {\nhighp vec2 coords = getAttributeDataCoords(id);\nreturn texture2D(dataDriven0, coords);\n}\nhighp vec4 getDataDriven1(in highp vec3 id) {\nhighp vec2 coords = getAttributeDataCoords(id);\nreturn texture2D(dataDriven1, coords);\n}\nhighp vec4 getGPGPU(in highp vec3 id) {\nhighp vec2 coords = getAttributeDataCoords(id);\nreturn texture2D(gpgpu, coords);\n}\nhighp vec4 getDataDriven2(in highp vec3 id) {\nhighp vec2 coords = getAttributeDataCoords(id);\nreturn texture2D(dataDriven2, coords);\n}\nfloat u88VVToFloat(in vec2 v) {\nbool isMagic = v.x == 255.0 && v.y == 255.0;\nif (isMagic) {\nreturn NAN_MAGIC_NUMBER;\n}\nreturn (v.x + v.y * float(0x100)) - 32768.0;\n}","barycentric.glsl":"float inTriangle(vec3 bary) {\nvec3 absBary = abs(bary);\nreturn step((absBary.x + absBary.y + absBary.z), 1.05);\n}\nvec3 xyToBarycentric(in vec2 pos, in vec2 v0,  in vec2 v1, in vec2 v2) {\nmat3 xyToBarycentricMat3 = mat3(\nv1.x * v2.y - v2.x * v1.y, v2.x * v0.y - v0.x * v2.y, v0.x * v1.y - v1.x * v0.y,\nv1.y - v2.y, v2.y - v0.y, v0.y - v1.y,\nv2.x - v1.x, v0.x - v2.x, v1.x - v0.x\n);\nfloat A2 = v0.x * (v1.y - v2.y) + v1.x * (v2.y - v0.y) + v2.x * (v0.y - v1.y);\nreturn (1. / A2) * xyToBarycentricMat3 * vec3(1., pos);\n}","constants.glsl":"const float C_DEG_TO_RAD = 3.14159265359 / 180.0;\nconst float C_256_TO_RAD = 3.14159265359 / 128.0;\nconst float C_RAD_TO_DEG = 180.0 / 3.141592654;\nconst float POSITION_PRECISION = 1.0 / 8.0;\nconst float FILL_POSITION_PRECISION = 1.0 / 1.0;\nconst float SOFT_EDGE_RATIO = 1.0;\nconst float THIN_LINE_WIDTH_FACTOR = 1.1;\nconst float THIN_LINE_HALF_WIDTH = 1.0;\nconst float EXTRUDE_SCALE_PLACEMENT_PADDING = 1.0 / 4.0;\nconst float OFFSET_PRECISION = 1.0 / 8.0;\nconst float OUTLINE_SCALE = 1.0 / 5.0;\nconst float SDF_FONT_SIZE = 24.0;\nconst float MAX_SDF_DISTANCE = 8.0;\nconst float PLACEMENT_PADDING = 8.0;\nconst float EPSILON = 0.00001;\nconst float EPSILON_HITTEST = 0.05;\nconst int MAX_FILTER_COUNT = 2;\nconst int ATTR_VV_SIZE = 0;\nconst int ATTR_VV_COLOR = 1;\nconst int ATTR_VV_OPACITY = 2;\nconst int ATTR_VV_ROTATION = 3;\nconst highp float NAN_MAGIC_NUMBER = 1e-30;\nconst int BITSET_GENERIC_LOCK_COLOR = 1;\nconst int BITSET_GENERIC_CONSIDER_ALPHA_ONLY = 4;\nconst int BITSET_MARKER_ALIGNMENT_MAP = 0;\nconst int BITSET_MARKER_OUTLINE_ALLOW_COLOR_OVERRIDE = 2;\nconst int BITSET_MARKER_SCALE_SYMBOLS_PROPORTIONALLY = 3;\nconst int BITSET_TYPE_FILL_OUTLINE = 0;\nconst int BITSET_FILL_RANDOM_PATTERN_OFFSET = 2;\nconst int BITSET_FILL_HAS_UNRESOLVED_REPLACEMENT_COLOR = 3;\nconst int BITSET_FILL_HAS_PATTERN_HEIGHT_PRECISION_FACTOR = 5;\nconst int BITSET_FILL_HAS_PATTERN_WIDTH_PRECISION_FACTOR = 6;\nconst int BITSET_LINE_SCALE_DASH = 2;",fill:{"common.glsl":"#include <materials/symbologyTypeUtils.glsl>\n#ifdef PATTERN\nuniform mediump vec2 u_mosaicSize;\nvarying mediump float v_sampleAlphaOnly;\n#endif\n#if SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_DOT_DENSITY\nuniform lowp vec4 u_isActive[ 2 ];\nuniform highp float u_dotValue;\nuniform highp float u_tileDotsOverArea;\nuniform highp float u_dotTextureDotCount;\nuniform mediump float u_tileZoomFactor;\n#endif\nvarying highp vec3 v_id;\nvarying lowp vec4 v_color;\nvarying lowp float v_opacity;\nvarying mediump vec4 v_aux1;\n#ifdef PATTERN\nvarying mediump vec2 v_tileTextureCoord;\n#endif\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\nvarying lowp float v_isOutline;\n#endif\n#if SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_DOT_DENSITY\nvarying highp vec2 v_dotTextureCoords;\nvarying highp vec4 v_dotThresholds[ 2 ];\n#endif","fill.frag":"precision highp float;\n#include <materials/constants.glsl>\n#include <materials/utils.glsl>\n#include <materials/fill/common.glsl>\n#ifdef PATTERN\nuniform lowp sampler2D u_texture;\n#endif\n#if SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_DOT_DENSITY\nuniform mediump mat4 u_dotColors[ 2 ];\nuniform sampler2D u_dotTextures[ 2 ];\nuniform vec4 u_dotBackgroundColor;\n#endif\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#include <materials/shared/line/common.glsl>\n#include <materials/shared/line/line.frag>\nlowp vec4 drawLine() {\nfloat v_lineWidth = v_aux1.x;\nvec2  v_normal    = v_aux1.yz;\nLineData inputs = LineData(\nv_color,\nv_normal,\nv_lineWidth,\nv_opacity,\nv_id\n);\nreturn shadeLine(inputs);\n}\n#endif\nlowp vec4 drawFill() {\nlowp vec4 out_color = vec4(0.);\n#ifdef HITTEST\nout_color = v_color;\n#elif defined(PATTERN)\nmediump vec4 v_tlbr = v_aux1;\nmediump vec2 normalizedTextureCoord = mod(v_tileTextureCoord, 1.0);\nmediump vec2 samplePos = mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color = texture2D(u_texture, samplePos);\nif (v_sampleAlphaOnly > 0.5) {\ncolor.rgb = vec3(color.a);\n}\nout_color = v_opacity * v_color * color;\n#elif SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_DOT_DENSITY && !defined(HIGHLIGHT)\nvec4 textureThresholds0 = texture2D(u_dotTextures[0], v_dotTextureCoords);\nvec4 textureThresholds1 = texture2D(u_dotTextures[1], v_dotTextureCoords);\nvec4 difference0 = v_dotThresholds[0] - textureThresholds0;\nvec4 difference1 = v_dotThresholds[1] - textureThresholds1;\n#ifdef DD_DOT_BLENDING\nvec4 isPositive0 = step(0.0, difference0);\nvec4 isPositive1 = step(0.0, difference1);\nfloat weightSum = dot(isPositive0, difference0) + dot(isPositive1, difference1);\nfloat lessThanEqZero = step(weightSum, 0.0);\nfloat greaterThanZero = 1.0 - lessThanEqZero ;\nfloat divisor = (weightSum + lessThanEqZero);\nvec4 weights0 = difference0 * isPositive0 / divisor;\nvec4 weights1 = difference1 * isPositive1 / divisor;\nvec4 dotColor = u_dotColors[0] * weights0 + u_dotColors[1] * weights1;\nvec4 preEffectColor = greaterThanZero * dotColor + lessThanEqZero * u_dotBackgroundColor;\n#else\nfloat diffMax = max(max4(difference0), max4(difference1));\nfloat lessThanZero = step(diffMax, 0.0);\nfloat greaterOrEqZero = 1.0 - lessThanZero;\nvec4 isMax0 = step(diffMax, difference0);\nvec4 isMax1 = step(diffMax, difference1);\nvec4 dotColor = u_dotColors[0] * isMax0 + u_dotColors[1] * isMax1;\nvec4 preEffectColor = greaterOrEqZero * dotColor + lessThanZero * u_dotBackgroundColor;\n#endif\nout_color = preEffectColor;\n#else\nout_color = v_opacity * v_color;\n#endif\n#ifdef HIGHLIGHT\nout_color.a = 1.0;\n#endif\nreturn out_color;\n}\nvoid main() {\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\nif (v_isOutline > 0.5) {\ngl_FragColor = drawLine();\n} else {\ngl_FragColor = drawFill();\n}\n#else\ngl_FragColor = drawFill();\n#endif\n}","fill.vert":"#include <materials/symbologyTypeUtils.glsl>\n#define PACKED_LINE\nprecision highp float;\nattribute float a_bitset;\n#if SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_DOT_DENSITY\nattribute float a_inverseArea;\nvec4 a_color = vec4(0.0, 0.0, 0.0, 1.0);\nvec2 a_zoomRange = vec2(0.0, 10000.0);\n#else\nattribute vec4 a_color;\nattribute vec4 a_aux2;\nattribute vec4 a_aux3;\n#ifndef SYMBOLOGY_TYPE_IS_SIMPLE_LIKE\nattribute vec4 a_aux1;\nattribute vec2 a_zoomRange;\n#else\nvec2 a_zoomRange = vec2(0.0, 10000.0);\n#endif\n#endif\nuniform vec2 u_tileOffset;\nuniform vec2 u_maxIntNumOfCrossing;\n#include <util/encoding.glsl>\n#include <materials/vcommon.glsl>\n#include <materials/fill/common.glsl>\n#include <materials/fill/hittest.glsl>\nconst float INV_SCALE_COMPRESSION_FACTOR = 1.0 / 128.0;\nconst float MAX_REPRESENTABLE_INT = 16777216.0;\n#if SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_DOT_DENSITY\nvec4 dotThreshold(vec4 featureAttrOverFeatureArea, float dotValue, float tileDotsOverArea) {\nreturn featureAttrOverFeatureArea * (1.0 / dotValue)  * (1.0 / tileDotsOverArea);\n}\n#endif\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#include <materials/shared/line/common.glsl>\n#include <materials/shared/line/line.vert>\nvoid drawLine(out lowp vec4 out_color, out highp vec3 out_pos) {\nLineData outputs = buildLine(\nout_pos,\na_id,\na_pos,\na_color,\n(a_aux3.xy - 128.) / 16.,\n(a_aux3.zw - 128.) / 16.,\n0.,\na_aux2.z / 16.,\na_bitset,\nvec4(0.),\nvec2(0.),\na_aux2.w / 16.\n);\nv_id      = outputs.id;\nv_opacity = outputs.opacity;\nv_aux1    = vec4(outputs.lineHalfWidth, outputs.normal, 0.);\nout_color = outputs.color;\n}\n#endif\nvoid drawFill(out lowp vec4 out_color, out highp vec3 out_pos) {\nfloat a_bitSet = a_bitset;\nout_color = getColor(a_color, a_bitSet, BITSET_GENERIC_LOCK_COLOR);\nv_opacity = getOpacity();\nv_id      = norm(a_id);\n#if SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_DOT_DENSITY\nmat3 tileToTileNormalized = mat3(  2. / 512.,  0.,  0.,\n0., -2. / 512.,  0.,\n-1.,  1.,  1.  );\nout_pos   = tileToTileNormalized * vec3((a_pos * FILL_POSITION_PRECISION), 1.);\n#else\nout_pos   = u_dvsMat3 * vec3(a_pos * FILL_POSITION_PRECISION, 1.);\n#endif\n#ifdef PATTERN\nvec4  a_tlbr   = a_aux1;\nfloat a_width  = a_aux2.x;\nfloat a_height = a_aux2.y;\nvec2  a_offset = a_aux2.zw;\nvec2  a_scale  = a_aux3.xy;\nfloat a_angle  = a_aux3.z;\nif (getBit(a_bitset, BITSET_FILL_HAS_PATTERN_WIDTH_PRECISION_FACTOR) > 0.5) {\na_width *= INV_SCALE_COMPRESSION_FACTOR;\n}\nif (getBit(a_bitset, BITSET_FILL_HAS_PATTERN_HEIGHT_PRECISION_FACTOR) > 0.5) {\na_height *= INV_SCALE_COMPRESSION_FACTOR;\n}\nvec2 scale = INV_SCALE_COMPRESSION_FACTOR * a_scale;\nfloat width = u_zoomFactor * a_width * scale.x;\nfloat height = u_zoomFactor * a_height * scale.y;\nfloat angle = C_256_TO_RAD * a_angle;\nfloat sinA = sin(angle);\nfloat cosA = cos(angle);\nfloat dx = 0.0;\nfloat dy = 0.0;\nif (getBit(a_bitset, BITSET_FILL_RANDOM_PATTERN_OFFSET) > 0.5) {\nfloat id = rgba2float(vec4(a_id, 0.0));\ndx = rand(vec2(id, 0.0));\ndy = rand(vec2(0.0, id));\n}\nmat3 patternMatrix = mat3(cosA / width, sinA / height, 0,\n-sinA / width, cosA / height, 0,\ndx,            dy,           1);\nvec2 patternSize = vec2(a_width, a_height);\nvec2 numPatternsPerMaxInt = vec2(MAX_REPRESENTABLE_INT) / patternSize;\nvec2 maxIntCrossingOffsetCorrection = patternSize * fract(u_maxIntNumOfCrossing * numPatternsPerMaxInt);\nvec2 tileOffset = u_tileOffset + maxIntCrossingOffsetCorrection - 0.5 * patternSize;\ntileOffset = vec2(tileOffset.x * cosA - tileOffset.y * sinA, tileOffset.x * sinA + tileOffset.y * cosA);\ntileOffset = mod(tileOffset, patternSize);\nvec2 symbolOffset = u_zoomFactor * scale * vec2(a_offset - tileOffset) / vec2(width, height);\nv_tileTextureCoord = (patternMatrix * vec3(a_pos * FILL_POSITION_PRECISION, 1.0)).xy - symbolOffset;\nv_aux1 = a_tlbr / u_mosaicSize.xyxy;\nv_sampleAlphaOnly = getBit(a_bitset, BITSET_GENERIC_CONSIDER_ALPHA_ONLY);\nif (getBit(a_bitSet, BITSET_FILL_HAS_UNRESOLVED_REPLACEMENT_COLOR) > 0.5) {\n#ifdef VV_COLOR\nv_sampleAlphaOnly *= (1.0 - float(isNan(VV_ADATA[ATTR_VV_COLOR]))) * (1.0 - getBit(a_bitSet, BITSET_GENERIC_LOCK_COLOR));\n#else\nv_sampleAlphaOnly = 0.0;\n#endif\n}\n#elif SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_DOT_DENSITY\nvec4 ddAttributeData0 = getAttributeData2(a_id) * u_isActive[0] * a_inverseArea;\nvec4 ddAttributeData1 = getAttributeData3(a_id) * u_isActive[1] * a_inverseArea;\nfloat size = u_tileZoomFactor * 512.0 * 1.0 / u_pixelRatio;\nv_dotThresholds[0] = dotThreshold(ddAttributeData0, u_dotValue, u_tileDotsOverArea);\nv_dotThresholds[1] = dotThreshold(ddAttributeData1, u_dotValue, u_tileDotsOverArea);\nv_dotTextureCoords = (a_pos * FILL_POSITION_PRECISION + 0.5) / size;\n#endif\n}\n#ifdef HITTEST\nvoid draw(out lowp vec4 out_color, out highp vec3 out_pos) {\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\nif (getBit(a_bitset, BITSET_TYPE_FILL_OUTLINE) > 0.5) {\nout_pos = vec3(0., 0., 2.);\nreturn;\n}\n#endif\nhittestFill(out_color, out_pos);\ngl_PointSize = 1.0;\n}\n#elif defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE)\nvoid draw(out lowp vec4 out_color, out highp vec3 out_pos) {\nv_isOutline = getBit(a_bitset, BITSET_TYPE_FILL_OUTLINE);\nif (v_isOutline > 0.5) {\ndrawLine(out_color, out_pos);\n} else {\ndrawFill(out_color, out_pos);\n}\n}\n#else\n#define draw drawFill\n#endif\nvoid main()\n{\nINIT;\nhighp vec3 pos  = vec3(0.);\nhighp vec4 color  = vec4(0.);\ndraw(color, pos);\nv_color = color;\ngl_Position = vec4(clip(v_color, pos, getFilterFlags(), a_zoomRange), 1.0);\n}","hittest.glsl":"#ifdef HITTEST\n#include <materials/hittest/common.glsl>\nattribute vec2 a_pos1;\nattribute vec2 a_pos2;\nvoid hittestFill(\nout lowp vec4 out_color,\nout highp vec3 out_pos\n) {\nvec3 pos        = u_viewMat3 * u_tileMat3 * vec3(a_pos  * FILL_POSITION_PRECISION, 1.);\nvec3 pos1       = u_viewMat3 * u_tileMat3 * vec3(a_pos1 * FILL_POSITION_PRECISION, 1.);\nvec3 pos2       = u_viewMat3 * u_tileMat3 * vec3(a_pos2 * FILL_POSITION_PRECISION, 1.);\nfloat hittestDist = u_hittestDist;\nfloat dist = distPointTriangle(u_hittestPos, pos.xy, pos1.xy, pos2.xy);\nout_pos = vec3(getAttributeDataTextureCoords(a_id), 0.0);\nif (dist < 0. || dist >= hittestDist) {\nout_pos.z += 2.0;\n}\nout_color = vec4(1. / 255., 0, 0, dist == 0. ? (1. / 255.) : 0.);\n}\n#endif"},hittest:{"common.glsl":"#ifdef HITTEST\nuniform float hittestDist;\nuniform highp vec2 hittestPos;\nfloat projectScalar(vec2 a, vec2 b) {\nreturn dot(a, normalize(b));\n}\nfloat distPointSegment(vec2 p0, vec2 p1, vec2 p2) {\nvec2 L = p2 - p1;\nvec2 A = p0 - p1;\nfloat projAL = projectScalar(A, L);\nfloat t = clamp(projAL / length(L), 0., 1.);\nreturn distance(p0, p1 + t * (p2 - p1));\n}\nvoid hittestMarker(out lowp vec4 out_color, out highp vec3 out_pos, in highp vec3 pos, float size) {\nfloat dist = distance(pos, vec3(hittestPos, 1.));\nout_pos = vec3(getAttributeDataTextureCoords(a_id), 0.0);\nif ((dist - size) > hittestDist) {\nout_pos.z += 2.0;\n}\nout_color = vec4(1. / 255., 0, 0, (dist - size) < 0. ? (1. / 255.) : 0.);\n}\nfloat intersectPointTriangleBary(vec2 p, vec2 a, vec2 b, vec2 c) {\nreturn inTriangle(xyToBarycentric(p, a, b, c));\n}\nfloat distPointTriangle(vec2 p, vec2 a, vec2 b, vec2 c) {\nvec2 ba = b - a;\nvec2 ca = c - a;\nfloat crossProduct = ba.x * ca.y - ca.x * ba.y;\nbool isParallel = crossProduct < EPSILON_HITTEST && crossProduct > -EPSILON_HITTEST;\nif (isParallel) {\nreturn -1.;\n}\nif (intersectPointTriangleBary(p.xy, a, b, c) == 1.) {\nreturn 0.;\n}\nfloat distAB = distPointSegment(p, a, b);\nfloat distBC = distPointSegment(p, b, c);\nfloat distCA = distPointSegment(p, c, a);\nreturn min(min(distAB, distBC), distCA);\n}\n#endif"},icon:{"common.glsl":"#include <util/encoding.glsl>\nuniform lowp vec2 u_mosaicSize;\nvarying lowp vec4 v_color;\nvarying highp vec3 v_id;\nvarying highp vec4 v_sizeTex;\nvarying mediump vec3 v_pos;\nvarying lowp float v_opacity;\nuniform lowp sampler2D u_texture;\n#ifdef SDF\nvarying lowp vec4 v_outlineColor;\nvarying mediump float v_outlineWidth;\nvarying mediump float v_distRatio;\nvarying mediump float v_overridingOutlineColor;\nvarying mediump float v_isThin;\n#endif\n#ifdef SDF\nvec4 getColor(vec2 v_size, vec2 v_tex) {\n#ifdef HITTEST\nlowp vec4 fillPixelColor = vec4(1.0);\n#else\nlowp vec4 fillPixelColor = v_color;\n#endif\nfloat d = 0.5 - rgba2float(texture2D(u_texture, v_tex));\nfloat size = max(v_size.x, v_size.y);\nfloat dist = d * size * SOFT_EDGE_RATIO * v_distRatio;\nfillPixelColor *= clamp(0.5 - dist, 0.0, 1.0);\nfloat outlineWidth = v_outlineWidth;\n#ifdef HIGHLIGHT\noutlineWidth = max(outlineWidth, 4.0 * v_isThin);\n#endif\nif (outlineWidth > 0.25) {\nlowp vec4 outlinePixelColor = v_overridingOutlineColor * v_color + (1.0 - v_overridingOutlineColor) * v_outlineColor;\nfloat clampedOutlineSize = min(outlineWidth, size);\noutlinePixelColor *= clamp(0.5 - abs(dist) + clampedOutlineSize * 0.5, 0.0, 1.0);\nreturn v_opacity * ((1.0 - outlinePixelColor.a) * fillPixelColor + outlinePixelColor);\n}\nreturn v_opacity * fillPixelColor;\n}\n#else\nvec4 getColor(vec2 _v_size, vec2 v_tex) {\nlowp vec4 texColor = texture2D(u_texture, v_tex);\nreturn v_opacity * texColor * v_color;\n}\n#endif",heatmapAccumulate:{"common.glsl":"varying lowp vec4 v_hittestResult;\nvarying mediump vec2 v_offsetFromCenter;\nvarying highp float v_fieldValue;","heatmapAccumulate.frag":"precision mediump float;\n#include <materials/icon/heatmapAccumulate/common.glsl>\n#ifdef HEATMAP_PRECISION_HALF_FLOAT\n#define COMPRESSION_FACTOR 0.25\n#else\n#define COMPRESSION_FACTOR 1.0\n#endif\nuniform lowp sampler2D u_texture;\nvoid main() {\n#ifdef HITTEST\ngl_FragColor = v_hittestResult;\n#else\nfloat radius = length(v_offsetFromCenter);\nfloat shapeWeight = step(radius, 1.0);\nfloat oneMinusRadiusSquared = 1.0 - radius * radius;\nfloat kernelWeight = oneMinusRadiusSquared * oneMinusRadiusSquared;\ngl_FragColor = vec4(shapeWeight * kernelWeight * v_fieldValue * COMPRESSION_FACTOR);\n#endif\n}","heatmapAccumulate.vert":"precision highp float;\nattribute vec2 a_vertexOffset;\nvec4 a_color = vec4(0.0);\nvec2 a_zoomRange = vec2(0.0, 10000.0);\nuniform float u_radius;\nuniform float u_isFieldActive;\n#include <materials/vcommon.glsl>\n#include <materials/hittest/common.glsl>\n#include <materials/icon/heatmapAccumulate/common.glsl>\nvoid main() {\nfloat filterFlags = getFilterFlags();\n#ifdef HITTEST\nhighp vec4 out_hittestResult = vec4(0.);\nhighp vec3 out_pos = vec3(0.);\nvec3 pos = u_viewMat3 * u_tileMat3 * vec3(a_pos * POSITION_PRECISION, 1.0);\nhittestMarker(out_hittestResult, out_pos, pos, u_radius);\nv_hittestResult = out_hittestResult;\ngl_PointSize = 1.;\ngl_Position = vec4(clip(a_color, out_pos, filterFlags, a_zoomRange), 1.0);\n#else\nv_offsetFromCenter = sign(a_vertexOffset);\nv_fieldValue = getAttributeData2(a_id).x * u_isFieldActive + 1.0 - u_isFieldActive;\nvec3 centerPos = u_dvsMat3 * vec3(a_pos * POSITION_PRECISION, 1.0);\nvec3 vertexPos = centerPos + u_displayViewMat3 * vec3(v_offsetFromCenter, 0.0) * u_radius;\ngl_Position = vec4(clip(a_color, vertexPos, filterFlags, a_zoomRange), 1.0);\n#endif\n}"},"hittest.glsl":"#ifdef HITTEST\n#include <materials/hittest/common.glsl>\nattribute vec2 a_vertexOffset1;\nattribute vec2 a_vertexOffset2;\nattribute vec2 a_texCoords1;\nattribute vec2 a_texCoords2;\nvec2 getTextureCoords(in vec3 bary, in vec2 texCoords0, in vec2 texCoords1, in vec2 texCoords2) {\nreturn texCoords0 * bary.x + texCoords1 * bary.y + texCoords2 * bary.z;\n}\nvoid hittestIcon(\ninout lowp vec4 out_color,\nout highp vec3 out_pos,\nin vec3 pos,\nin vec3 offset,\nin vec2 size,\nin float scaleFactor,\nin float isMapAligned\n) {\nout_pos = vec3(getAttributeDataTextureCoords(a_id), 0.0);\nvec3 posBase = u_viewMat3 * u_tileMat3  * pos;\nvec3 offset1 = scaleFactor * vec3(a_vertexOffset1 / 16.0, 0.);\nvec3 offset2 = scaleFactor * vec3(a_vertexOffset2 / 16.0, 0.);\nvec2 pos0    = (posBase + getMatrixNoDisplay(isMapAligned) * offset).xy;\nvec2 pos1    = (posBase + getMatrixNoDisplay(isMapAligned) * offset1).xy;\nvec2 pos2    = (posBase + getMatrixNoDisplay(isMapAligned) * offset2).xy;\nvec3 bary0 = xyToBarycentric(u_hittestPos + vec2(-u_hittestDist, -u_hittestDist), pos0, pos1, pos2);\nvec3 bary1 = xyToBarycentric(u_hittestPos + vec2(0., -u_hittestDist), pos0, pos1, pos2);\nvec3 bary2 = xyToBarycentric(u_hittestPos + vec2(u_hittestDist, -u_hittestDist), pos0, pos1, pos2);\nvec3 bary3 = xyToBarycentric(u_hittestPos + vec2(-u_hittestDist, 0.), pos0, pos1, pos2);\nvec3 bary4 = xyToBarycentric(u_hittestPos, pos0, pos1, pos2);\nvec3 bary5 = xyToBarycentric(u_hittestPos + vec2(u_hittestDist, 0.), pos0, pos1, pos2);\nvec3 bary6 = xyToBarycentric(u_hittestPos + vec2(-u_hittestDist, u_hittestDist), pos0, pos1, pos2);\nvec3 bary7 = xyToBarycentric(u_hittestPos + vec2(0., u_hittestDist), pos0, pos1, pos2);\nvec3 bary8 = xyToBarycentric(u_hittestPos + vec2(u_hittestDist, u_hittestDist), pos0, pos1, pos2);\nvec2 tex0 = a_texCoords  / u_mosaicSize;\nvec2 tex1 = a_texCoords1 / u_mosaicSize;\nvec2 tex2 = a_texCoords2 / u_mosaicSize;\nfloat alphaSum = 0.;\nalphaSum += inTriangle(bary0) * getColor(size, getTextureCoords(bary0, tex0, tex1, tex2)).a;\nalphaSum += inTriangle(bary1) * getColor(size, getTextureCoords(bary1, tex0, tex1, tex2)).a;\nalphaSum += inTriangle(bary2) * getColor(size, getTextureCoords(bary2, tex0, tex1, tex2)).a;\nalphaSum += inTriangle(bary3) * getColor(size, getTextureCoords(bary3, tex0, tex1, tex2)).a;\nalphaSum += inTriangle(bary4) * getColor(size, getTextureCoords(bary4, tex0, tex1, tex2)).a;\nalphaSum += inTriangle(bary5) * getColor(size, getTextureCoords(bary5, tex0, tex1, tex2)).a;\nalphaSum += inTriangle(bary6) * getColor(size, getTextureCoords(bary6, tex0, tex1, tex2)).a;\nalphaSum += inTriangle(bary7) * getColor(size, getTextureCoords(bary7, tex0, tex1, tex2)).a;\nout_pos.z += step(alphaSum, .05) * 2.0;\nout_color = vec4(1. / 255., 0., 0., alphaSum / 255.);\n}\n#endif","icon.frag":"precision mediump float;\n#include <materials/constants.glsl>\n#include <materials/utils.glsl>\n#include <materials/icon/common.glsl>\nvoid main()\n{\n#ifdef HITTEST\nvec4 color = v_color;\n#else\nvec4 color = getColor(v_sizeTex.xy, v_sizeTex.zw);\n#endif\n#ifdef HIGHLIGHT\ncolor.a = step(1.0 / 255.0, color.a);\n#endif\ngl_FragColor = color;\n}","icon.vert":"precision highp float;\nattribute vec4 a_color;\nattribute vec4 a_outlineColor;\nattribute vec4 a_sizeAndOutlineWidth;\nattribute vec2 a_vertexOffset;\nattribute vec2 a_texCoords;\nattribute vec2 a_bitSetAndDistRatio;\nattribute vec2 a_zoomRange;\n#include <materials/vcommon.glsl>\n#include <materials/icon/common.glsl>\n#include <materials/icon/hittest.glsl>\nfloat getMarkerScaleFactor(inout vec2 size, in float referenceSize) {\n#ifdef VV_SIZE\nfloat f = getSize(size.y) / size.y;\nfloat sizeFactor = size.y / referenceSize;\nreturn getSize(referenceSize) / referenceSize;\n#else\nreturn 1.;\n#endif\n}\nvoid main()\n{\nINIT;\nfloat a_bitSet = a_bitSetAndDistRatio.x;\nvec3  pos           = vec3(a_pos * POSITION_PRECISION, 1.0);\nvec2  size          = a_sizeAndOutlineWidth.xy * a_sizeAndOutlineWidth.xy / 128.0;\nvec3  offset        = vec3(a_vertexOffset / 16.0, 0.);\nfloat outlineSize   = a_sizeAndOutlineWidth.z * a_sizeAndOutlineWidth.z / 128.0;\nfloat isMapAligned  = getBit(a_bitSet, BITSET_MARKER_ALIGNMENT_MAP);\nfloat referenceSize = a_sizeAndOutlineWidth.w * a_sizeAndOutlineWidth.w / 128.0;\nfloat scaleSymbolProportionally = getBit(a_bitSet, BITSET_MARKER_SCALE_SYMBOLS_PROPORTIONALLY);\nfloat scaleFactor               = getMarkerScaleFactor(size, referenceSize);\nsize.xy     *= scaleFactor;\noffset.xy   *= scaleFactor;\noutlineSize *= scaleSymbolProportionally * (scaleFactor - 1.0) + 1.0;\nvec2 v_tex   = a_texCoords / u_mosaicSize;\nfloat filterFlags = getFilterFlags();\nv_color    = getColor(a_color, a_bitSet, BITSET_GENERIC_LOCK_COLOR);\nv_opacity  = getOpacity();\nv_id       = norm(a_id);\nv_pos      = u_dvsMat3 * pos + getMatrix(isMapAligned) * getRotation()  * offset;\nv_sizeTex  = vec4(size.xy, v_tex.xy);\n#ifdef SDF\nv_isThin   = getBit(a_bitSet, BITSET_MARKER_OUTLINE_ALLOW_COLOR_OVERRIDE);\n#ifdef VV_COLOR\nv_overridingOutlineColor = v_isThin;\n#else\nv_overridingOutlineColor = 0.0;\n#endif\nv_outlineWidth = min(outlineSize, max(max(size.x, size.y) - 0.99, 0.0));\nv_outlineColor = a_outlineColor;\nv_distRatio = a_bitSetAndDistRatio.y / 128.0;\n#endif\n#ifdef HITTEST\nhighp vec4 out_color = vec4(0.);\nhighp vec3 out_pos   = vec3(0.);\nhittestIcon(out_color, out_pos, pos, offset, size, scaleFactor, isMapAligned);\nv_color = out_color;\ngl_PointSize = 1.;\ngl_Position = vec4(clip(v_color, out_pos, filterFlags, a_zoomRange), 1.0);\n#else\ngl_Position = vec4(clip(v_color, v_pos, filterFlags, a_zoomRange), 1.0);\n#endif\n}"},label:{"common.glsl":"uniform mediump float u_zoomLevel;\nuniform mediump float u_mapRotation;\nuniform mediump float u_mapAligned;\nuniform mediump vec2 u_mosaicSize;\nvarying mediump float v_antialiasingWidth;\nvarying mediump float v_edgeDistanceOffset;\nvarying mediump vec2 v_tex;\nvarying mediump vec4 v_color;\nvarying lowp vec4 v_animation;","label.frag":"#include <materials/text/text.frag>","label.vert":"precision highp float;\n#include <materials/vcommon.glsl>\n#include <materials/text/common.glsl>\nattribute vec4 a_color;\nattribute vec4 a_haloColor;\nattribute vec4 a_texAndSize;\nattribute vec4 a_refSymbolAndPlacementOffset;\nattribute vec4 a_glyphData;\nattribute vec2 a_vertexOffset;\nattribute vec2 a_texCoords;\nuniform float u_isHaloPass;\nuniform float u_isBackgroundPass;\nuniform float u_mapRotation;\nuniform float u_mapAligned;\nfloat getZ(in float minZoom, in float maxZoom, in float angle) {\nfloat glyphAngle = angle * 360.0 / 254.0;\nfloat mapAngle = u_mapRotation * 360.0 / 254.0;\nfloat diffAngle = min(360.0 - abs(mapAngle - glyphAngle), abs(mapAngle - glyphAngle));\nfloat z = 0.0;\nz += u_mapAligned * (2.0 * (1.0 - step(minZoom, u_currentZoom)));\nz += u_mapAligned * 2.0 * step(90.0, diffAngle);\nz += 2.0 * (1.0 - step(u_currentZoom, maxZoom));\nreturn z;\n}\nvoid main()\n{\nINIT;\nfloat groupMinZoom    = getMinZoom();\nfloat glyphMinZoom    = a_glyphData.x;\nfloat glyphMaxZoom    = a_glyphData.y;\nfloat glyphAngle      = a_glyphData.z;\nfloat a_isBackground  = a_glyphData.w;\nfloat a_minZoom          = max(groupMinZoom, glyphMinZoom);\nfloat a_placementPadding = a_refSymbolAndPlacementOffset.x * EXTRUDE_SCALE_PLACEMENT_PADDING;\nvec2  a_placementDir     = unpack_u8_nf32(a_refSymbolAndPlacementOffset.zw);\nfloat a_refSymbolSize    = a_refSymbolAndPlacementOffset.y;\nfloat fontSize           = a_texAndSize.z;\nfloat haloSize           = a_texAndSize.w * OUTLINE_SCALE;\nvec2  vertexOffset = a_vertexOffset * OFFSET_PRECISION;\nvec3  pos          = vec3(a_pos * POSITION_PRECISION, 1.0);\nfloat z            = getZ(a_minZoom, glyphMaxZoom, glyphAngle);\nfloat fontScale    = fontSize / SDF_FONT_SIZE;\nfloat halfSize     = getSize(a_refSymbolSize) / 2.0;\nfloat animation    = pow(getAnimationState(), vec4(2.0)).r;\nfloat isText = 1.0 - a_isBackground;\nfloat isBackground = u_isBackgroundPass * a_isBackground;\nvec4  nonHaloColor = (isBackground + isText) * a_color;\nv_color     = animation * ((1.0 - u_isHaloPass) * nonHaloColor + (u_isHaloPass * a_haloColor));\nv_opacity   = 1.0;\nv_tex       = a_texCoords / u_mosaicSize;\nv_edgeDistanceOffset = u_isHaloPass * haloSize / fontScale / MAX_SDF_DISTANCE;\nv_antialiasingWidth  = 0.105 * SDF_FONT_SIZE / fontSize / u_pixelRatio;\nvec2 placementOffset = a_placementDir * (halfSize + a_placementPadding);\nvec3 glyphOffset     = u_displayMat3 * vec3(vertexOffset + placementOffset, 0.0);\nvec3 v_pos           = vec3((u_dvsMat3 * pos + glyphOffset).xy, z);\nfloat isHidden = u_isBackgroundPass * isText + (1.0 - u_isBackgroundPass) * a_isBackground;\nv_pos.z += 2.0 * isHidden;\ngl_Position = vec4(v_pos, 1.0);\n#ifdef DEBUG\nv_color = vec4(a_color.rgb, z == 0.0 ? 1.0 : 0.645);\n#endif\n}"},line:{"common.glsl":"varying lowp vec4 v_color;\nvarying highp vec3 v_id;\nvarying mediump vec2 v_normal;\nvarying mediump float v_lineHalfWidth;\nvarying lowp float v_opacity;\n#ifdef PATTERN\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\n#endif\n#if defined(PATTERN) || defined(SDF)\nvarying highp float v_accumulatedDistance;\n#endif\n#ifdef SDF\nvarying mediump float v_lineWidthRatio;\n#endif","hittest.glsl":"#include <materials/hittest/common.glsl>\n#ifdef HITTEST\nattribute vec2 a_pos1;\nattribute vec2 a_pos2;\nvoid hittestLine(out lowp vec4 out_color, out highp vec3 out_pos, float halfWidth) {\nvec3 pos        = u_viewMat3 * u_tileMat3 * vec3(a_pos  * POSITION_PRECISION, 1.);\nvec3 pos1       = u_viewMat3 * u_tileMat3 * vec3(a_pos1 * POSITION_PRECISION, 1.);\nvec3 pos2       = u_viewMat3 * u_tileMat3 * vec3(a_pos2 * POSITION_PRECISION, 1.);\nvec3 outTextureCoords = vec3(getAttributeDataTextureCoords(a_id), 0.0);\nfloat dist = min(distPointSegment(u_hittestPos, pos.xy, pos1.xy),\ndistPointSegment(u_hittestPos, pos.xy, pos2.xy)) - halfWidth;\nout_pos = vec3(getAttributeDataTextureCoords(a_id), 0.0);\nif (dist >= u_hittestDist) {\nout_pos.z += 2.0;\n}\nout_color = vec4(1. / 255., 0, 0, dist <= 0. ? (1. / 255.) : 0.);\n}\n#endif","line.frag":"precision lowp float;\n#include <util/encoding.glsl>\n#include <materials/constants.glsl>\n#include <materials/symbologyTypeUtils.glsl>\n#include <materials/line/common.glsl>\n#include <materials/shared/line/common.glsl>\n#include <materials/shared/line/line.frag>\n#ifdef HITTEST\nvoid main() {\ngl_FragColor = v_color;\n}\n#else\nvoid main() {\nLineData inputs = LineData(\nv_color,\nv_normal,\nv_lineHalfWidth,\nv_opacity,\n#ifndef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#ifdef PATTERN\nv_tlbr,\nv_patternSize,\n#endif\n#ifdef SDF\nv_lineWidthRatio,\n#endif\n#if defined(PATTERN) || defined(SDF)\nv_accumulatedDistance,\n#endif\n#endif\nv_id\n);\ngl_FragColor = shadeLine(inputs);\n}\n#endif","line.vert":"precision highp float;\nattribute vec4 a_color;\nattribute vec4 a_offsetAndNormal;\nattribute vec2 a_accumulatedDistanceAndHalfWidth;\nattribute vec4 a_tlbr;\nattribute vec4 a_segmentDirection;\nattribute vec2 a_aux;\nattribute vec2 a_zoomRange;\n#include <materials/vcommon.glsl>\n#include <materials/symbologyTypeUtils.glsl>\n#include <materials/line/common.glsl>\n#include <materials/line/hittest.glsl>\n#include <materials/shared/line/common.glsl>\n#include <materials/shared/line/line.vert>\n#ifdef HITTEST\nvoid draw() {\nfloat aa        = 0.5 * u_antialiasing;\nfloat a_halfWidth = a_accumulatedDistanceAndHalfWidth.y / 16.;\nfloat a_cimHalfWidth = a_aux.x / 16. ;\nvec2  a_offset = a_offsetAndNormal.xy / 16.;\nfloat baseWidth = getBaseLineHalfWidth(a_halfWidth, a_cimHalfWidth);\nfloat halfWidth = getLineHalfWidth(baseWidth, aa);\nhighp vec3 pos  = vec3(0.);\nv_color = vec4(0.);\nhittestLine(v_color, pos, halfWidth);\ngl_PointSize = 1.;\ngl_Position = vec4(clip(v_color, pos, getFilterFlags(), a_zoomRange), 1.0);\n}\n#else\nvoid draw()\n{\nhighp vec3 pos = vec3(0.);\nLineData outputs = buildLine(\npos,\na_id,\na_pos,\na_color,\na_offsetAndNormal.xy / 16.,\na_offsetAndNormal.zw / 16.,\na_accumulatedDistanceAndHalfWidth.x,\na_accumulatedDistanceAndHalfWidth.y / 16.,\na_segmentDirection.w,\na_tlbr,\na_segmentDirection.xy / 16.,\na_aux.x / 16.\n);\nv_id              = outputs.id;\nv_color           = outputs.color;\nv_normal          = outputs.normal;\nv_lineHalfWidth   = outputs.lineHalfWidth;\nv_opacity         = outputs.opacity;\n#ifndef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#ifdef PATTERN\nv_tlbr          = outputs.tlbr;\nv_patternSize   = outputs.patternSize;\n#endif\n#ifdef SDF\nv_lineWidthRatio = outputs.lineWidthRatio;\n#endif\n#if defined(PATTERN) || defined(SDF)\nv_accumulatedDistance = outputs.accumulatedDistance;\n#endif\n#endif\ngl_Position = vec4(clip(outputs.color, pos, getFilterFlags(), a_zoomRange), 1.0);\n}\n#endif\nvoid main() {\nINIT;\ndraw();\n}"},pie:{"pie.common.glsl":"uniform float outlineWidth;\nuniform mediump float sectorThreshold;\nvarying vec3  v_id;\nvarying vec3  v_pos;\nvarying vec2  v_offset;\nvarying vec4  v_color;\nvarying float v_size;\nvarying float v_numOfEntries;\nvarying float v_maxSectorAngle;\nvarying vec2  v_filteredSectorToColorId[numberOfFields];\nvarying vec2  v_texCoords;\nvarying float v_outlineWidth;\nvarying float v_opacity;\nstruct FilteredChartInfo {\nfloat endSectorAngle;\nint colorId;\n};","pie.frag":"precision highp float;\n#include <util/atan2.glsl>\n#include <materials/constants.glsl>\n#include <materials/utils.glsl>\n#include <materials/pie/pie.common.glsl>\nuniform lowp vec4 colors[numberOfFields];\nuniform lowp vec4 defaultColor;\nuniform lowp vec4 othersColor;\nuniform lowp vec4 outlineColor;\nuniform float donutRatio;\nlowp vec4 getSectorColor(in int index, in vec2 filteredSectorToColorId[numberOfFields]) {\nmediump int colorIndex = int(filteredSectorToColorId[index].y);\nreturn colors[colorIndex];\n}\nconst int OTHER_SECTOR_ID = 255;\n#ifdef HITTEST\nvec4 getColor() {\nfloat distanceSize = length(v_offset) * v_size;\nfloat donutSize = donutRatio * v_size;\nfloat alpha = step(donutSize, distanceSize) * (1.0 - step(v_size, distanceSize));\nreturn v_color;\n}\n#else\nvec4 getColor() {\nfloat angle = 90.0 - C_RAD_TO_DEG * atan2(v_offset.y, v_offset.x);\nif (angle < 0.0) {\nangle += 360.0;\n} else if (angle > 360.0) {\nangle = mod(angle, 360.0);\n}\nint numOfEntries = int(v_numOfEntries);\nfloat maxSectorAngle = v_maxSectorAngle;\nlowp vec4 fillColor = (maxSectorAngle > 0.0 || sectorThreshold > 0.0) ? othersColor : defaultColor;\nlowp vec4 prevColor = vec4(0.0);\nlowp vec4 nextColor = vec4(0.0);\nfloat startSectorAngle = 0.0;\nfloat endSectorAngle = 0.0;\nif (angle < maxSectorAngle) {\nfor (int index = 0; index < numberOfFields; ++index) {\nstartSectorAngle = endSectorAngle;\nendSectorAngle = v_filteredSectorToColorId[index].x;\nif (endSectorAngle > angle) {\nfillColor = getSectorColor(index, v_filteredSectorToColorId);\nprevColor = sectorThreshold != 0.0 && index == 0 && abs(360.0 - maxSectorAngle) < EPSILON ? othersColor :\ngetSectorColor(index > 0 ? index - 1 : numOfEntries - 1, v_filteredSectorToColorId);\nnextColor = sectorThreshold != 0.0 && abs(endSectorAngle - maxSectorAngle) < EPSILON ? othersColor :\ngetSectorColor(index < numOfEntries - 1 ? index + 1 : 0, v_filteredSectorToColorId);\nbreak;\n}\nif (index == numOfEntries - 1) {\nbreak;\n}\n}\n} else {\nprevColor = getSectorColor(numOfEntries - 1, v_filteredSectorToColorId);\nnextColor = getSectorColor(0, v_filteredSectorToColorId);\nstartSectorAngle = maxSectorAngle;\nendSectorAngle = 360.0;\n}\nlowp vec4 outlineColor = outlineColor;\nfloat offset = length(v_offset);\nfloat distanceSize = offset * v_size;\nif (startSectorAngle != 0.0 || endSectorAngle != 360.0) {\nfloat distanceToStartSector = (angle - startSectorAngle);\nfloat distanceToEndSector = (endSectorAngle - angle);\nfloat sectorThreshold = 0.6;\nfloat beginSectorAlpha = smoothstep(0.0, sectorThreshold, distanceToStartSector * offset);\nfloat endSectorAlpha = smoothstep(0.0, sectorThreshold, distanceToEndSector * offset);\nif (endSectorAlpha > 0.0) {\nfillColor = mix(nextColor, fillColor, endSectorAlpha);\n} else if (beginSectorAlpha > 0.0) {\nfillColor = mix(prevColor, fillColor, beginSectorAlpha);\n}\n}\nfloat donutSize = donutRatio * (v_size - v_outlineWidth);\nfloat endOfDonut = donutSize - v_outlineWidth;\nfloat aaThreshold = 0.75;\nfloat innerCircleAlpha = endOfDonut - aaThreshold > 0.0 ? smoothstep(endOfDonut - aaThreshold, endOfDonut + aaThreshold, distanceSize) : 1.0;\nfloat outerCircleAlpha = 1.0 - smoothstep(v_size - aaThreshold, v_size + aaThreshold , distanceSize);\nfloat circleAlpha = innerCircleAlpha * outerCircleAlpha;\nfloat startOfOutline = v_size - v_outlineWidth;\nif (startOfOutline > 0.0 && v_outlineWidth > 0.25) {\nfloat outlineFactor = smoothstep(startOfOutline - aaThreshold, startOfOutline + aaThreshold, distanceSize);\nfloat innerLineFactor = donutSize - aaThreshold > 0.0 ? 1.0 - smoothstep(donutSize - aaThreshold, donutSize + aaThreshold , distanceSize) : 0.0;\nfillColor = mix(fillColor, outlineColor, innerLineFactor + outlineFactor);\n}\nreturn v_opacity * circleAlpha * fillColor;\n}\n#endif\nvoid main()\n{\nvec4 color = getColor();\n#ifdef highlight\ncolor.a = step(1.0 / 255.0, color.a);\n#endif\ngl_FragColor = color;\n}","pie.vert":"#include <materials/constants.glsl>\n#include <materials/utils.glsl>\n#include <materials/barycentric.glsl>\n#include <materials/vcommon.glsl>\n#include <materials/vv.glsl>\n#include <materials/attributeData.glsl>\n#include <materials/pie/pie.common.glsl>\n#include <materials/hittest/common.glsl>\nattribute float a_bitSet;\nattribute vec2  a_offset;\nattribute vec2  a_texCoords;\nattribute vec2  a_size;\nattribute float a_referenceSize;\nattribute vec2  a_zoomRange;\nint filterValue(in float sectorAngle,\nin int currentIndex,\ninout FilteredChartInfo filteredInfo,\ninout vec2 filteredSectorToColorId[numberOfFields]) {\nif (sectorAngle > sectorThreshold * 360.0) {\nfilteredInfo.endSectorAngle += sectorAngle;\nfilteredSectorToColorId[filteredInfo.colorId] = vec2(filteredInfo.endSectorAngle, currentIndex);\n++filteredInfo.colorId;\n}\nreturn 0;\n}\nint filterValues(inout vec2 filteredSectorToColorId[numberOfFields],\ninout FilteredChartInfo filteredInfo,\nin float sectorAngles[numberOfFields]) {\nfor (int index = 0; index < numberOfFields; ++index) {\nfloat sectorValue = sectorAngles[index];\nfilterValue(sectorValue, index, filteredInfo, filteredSectorToColorId);\n}\nreturn filteredInfo.colorId;\n}\nvec2 getMarkerSize(inout vec2 offset, inout vec2 baseSize, inout float outlineSize, in float a_referenceSize, in float bitSet) {\nvec2 outSize = baseSize;\n#ifdef VV_SIZE\nfloat r = getSize(a_referenceSize, currentScale) / a_referenceSize;\noutSize.xy *= r;\noffset.xy *= r;\nfloat scaleSymbolProportionally = getBit(bitSet, BITSET_MARKER_SCALE_SYMBOLS_PROPORTIONALLY);\noutlineSize *= scaleSymbolProportionally * (r - 1.0) + 1.0;\n#endif\nreturn outSize;\n}\nvec3 getOffset(in vec2 in_offset, float a_bitSet) {\nfloat isMapAligned = getBit(a_bitSet, BITSET_MARKER_ALIGNMENT_MAP);\nvec3  offset       = vec3(in_offset, 0.0);\nreturn getMatrix(isMapAligned) * offset;\n}\nfloat filterNaNValues(in float value) {\nreturn value != NAN_MAGIC_NUMBER && value > 0.0 ? value : 0.0;\n}\nvoid main()\n{\nINIT;\nvec2  a_size   = a_size;\nvec2  a_offset = a_offset / 16.0;\nfloat outlineSize = outlineWidth;\nfloat a_bitSet = a_bitSet;\nfloat a_referenceSize = a_referenceSize;\nvec2 a_texCoords = a_texCoords / 4.0;\nvec2 markerSize = getMarkerSize(a_offset, a_size, outlineSize, a_referenceSize, a_bitSet);\nfloat filterFlags = getFilterFlags();\nvec3  pos         = vec3(a_pos / 10.0, 1.0);\nv_opacity      = getOpacity();\nv_id           = norm(a_id);\nv_pos          = displayViewScreenMat3 * pos + getOffset(a_offset, a_bitSet);\nv_offset       = sign(a_texCoords - 0.5);\nv_size         = max(markerSize.x, markerSize.y);\nv_outlineWidth = outlineSize;\nfloat attributeData[10];\nvec4 attributeData3 = getDataDriven0(a_id);\nattributeData[0] = filterNaNValues(attributeData3.x);\nattributeData[1] = filterNaNValues(attributeData3.y);\nattributeData[2] = filterNaNValues(attributeData3.z);\nattributeData[3] = filterNaNValues(attributeData3.w);\n#if (numberOfFields > 4)\nvec4 attributeData4 = getDataDriven1(a_id);\nattributeData[4] = filterNaNValues(attributeData4.x);\nattributeData[5] = filterNaNValues(attributeData4.y);\nattributeData[6] = filterNaNValues(attributeData4.z);\nattributeData[7] = filterNaNValues(attributeData4.w);\n#endif\n#if (numberOfFields > 8)\nvec4 attributeData5 = getDataDriven2(a_id);\nattributeData[8] = filterNaNValues(attributeData5.x);\nattributeData[9] = filterNaNValues(attributeData5.y);\n#endif\nfloat sum = 0.0;\nfor (int i = 0; i < numberOfFields; ++i) {\nsum += attributeData[i];\n}\nfloat sectorAngles[numberOfFields];\nfor (int i = 0; i < numberOfFields; ++i) {\nsectorAngles[i] = 360.0 * attributeData[i] / sum;\n}\nvec2 filteredSectorToColorId[numberOfFields];\nFilteredChartInfo filteredInfo = FilteredChartInfo(0.0, 0);\nint numOfEntries = filterValues(filteredSectorToColorId, filteredInfo, sectorAngles);\nv_numOfEntries = float(numOfEntries);\nv_maxSectorAngle = filteredInfo.endSectorAngle;\nv_filteredSectorToColorId = filteredSectorToColorId;\n#ifdef HITTEST\nhighp vec3 out_pos = vec3(0.0);\nv_color            = vec4(0.0);\nhittestMarker(v_color, out_pos, viewMat3 * tileMat3 *  pos, v_size);\ngl_PointSize = 1.0;\ngl_Position = vec4(clip(v_color, out_pos, filterFlags, a_zoomRange), 1.0);\n#else\ngl_Position = vec4(clip(v_color, v_pos, filterFlags, a_zoomRange), 1.0);\n#endif\n}"},shared:{line:{"common.glsl":"#if !defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE) && defined(PATTERN)\nuniform mediump vec2 u_mosaicSize;\nvarying mediump float v_sampleAlphaOnly;\n#endif\nstruct LineData {\nlowp vec4 color;\nmediump vec2 normal;\nmediump float lineHalfWidth;\nlowp float opacity;\n#ifndef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#ifdef PATTERN\nmediump vec4 tlbr;\nmediump vec2 patternSize;\n#endif\n#ifdef SDF\nmediump float lineWidthRatio;\n#endif\n#if defined(PATTERN) || defined(SDF)\nhighp float accumulatedDistance;\n#endif\n#endif\nhighp vec3 id;\n};","line.frag":"uniform lowp float u_blur;\n#if !defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE) && !defined(HIGHLIGHT)\n#if defined(PATTERN) || defined(SDF)\nuniform sampler2D u_texture;\nuniform highp float u_pixelRatio;\n#endif\n#endif\n#if defined(SDF) && !defined(HIGHLIGHT) && !defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE)\nlowp vec4 getLineColor(LineData line) {\nmediump float adjustedPatternWidth = line.patternSize.x * 2.0 * line.lineWidthRatio;\nmediump float relativeTexX = fract(line.accumulatedDistance / adjustedPatternWidth);\nmediump float relativeTexY = 0.5 + 0.25 * line.normal.y;\nmediump vec2 texCoord = mix(line.tlbr.xy, line.tlbr.zw, vec2(relativeTexX, relativeTexY));\nmediump float d = rgba2float(texture2D(u_texture, texCoord)) - 0.5;\nfloat dist = d * line.lineHalfWidth;\nreturn line.opacity * clamp(0.5 - dist, 0.0, 1.0) * line.color;\n}\n#elif defined(PATTERN) && !defined(HIGHLIGHT) && !defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE)\nlowp vec4 getLineColor(LineData line) {\nmediump float lineHalfWidth = line.lineHalfWidth;\nmediump float adjustedPatternHeight = line.patternSize.y * 2.0 * lineHalfWidth / line.patternSize.x;\nmediump float relativeTexY = fract(line.accumulatedDistance / adjustedPatternHeight);\nmediump float relativeTexX = 0.5 + 0.5 * line.normal.y;\nmediump vec2 texCoord = mix(line.tlbr.xy, line.tlbr.zw, vec2(relativeTexX, relativeTexY));\nlowp vec4 color = texture2D(u_texture, texCoord);\n#ifdef VV_COLOR\nif (v_sampleAlphaOnly > 0.5) {\ncolor.rgb = vec3(color.a);\n}\n#endif\nreturn line.opacity * line.color * color;\n}\n#else\nlowp vec4 getLineColor(LineData line) {\nreturn line.opacity * line.color;\n}\n#endif\nvec4 shadeLine(LineData line)\n{\nmediump float thinLineFactor = max(THIN_LINE_WIDTH_FACTOR * step(line.lineHalfWidth, THIN_LINE_HALF_WIDTH), 1.0);\nmediump float fragDist = length(line.normal) * line.lineHalfWidth;\nlowp float alpha = clamp(thinLineFactor * (line.lineHalfWidth - fragDist) / (u_blur + thinLineFactor - 1.0), 0.0, 1.0);\nlowp vec4 out_color = getLineColor(line) * alpha;\n#ifdef HIGHLIGHT\nout_color.a = step(1.0 / 255.0, out_color.a);\n#endif\n#ifdef ID\nif (out_color.a < 1.0 / 255.0) {\ndiscard;\n}\nout_color = vec4(line.id, 0.0);\n#endif\nreturn out_color;\n}","line.vert":"float getBaseLineHalfWidth(in float lineHalfWidth, in float referenceHalfWidth) {\n#ifdef VV_SIZE\nfloat refLineWidth = 2.0 * referenceHalfWidth;\nreturn 0.5 * (lineHalfWidth / max(referenceHalfWidth, EPSILON)) * getSize(refLineWidth);\n#else\nreturn lineHalfWidth;\n#endif\n}\nfloat getLineHalfWidth(in float baseWidth, in float aa) {\nfloat halfWidth = max(baseWidth + aa, 0.45) + 0.1 * aa;\n#ifdef HIGHLIGHT\nhalfWidth = max(halfWidth, 2.0);\n#endif\nreturn halfWidth;\n}\nvec2 getDist(in vec2 offset, in float halfWidth) {\nfloat thinLineFactor = max(THIN_LINE_WIDTH_FACTOR * step(halfWidth, THIN_LINE_HALF_WIDTH), 1.0);\nreturn thinLineFactor * halfWidth * offset;\n}\nLineData buildLine(\nout vec3 out_pos,\nin vec3 in_id,\nin vec2 in_pos,\nin vec4 in_color,\nin vec2 in_offset,\nin vec2 in_normal,\nin float in_accumulatedDist,\nin float in_lineHalfWidth,\nin float in_bitSet,\nin vec4 in_tlbr,\nin vec2 in_segmentDirection,\nin float in_referenceHalfWidth\n)\n{\nfloat aa        = 0.5 * u_antialiasing;\nfloat baseWidth = getBaseLineHalfWidth(in_lineHalfWidth, in_referenceHalfWidth);\nfloat halfWidth = getLineHalfWidth(baseWidth, aa);\nfloat z         = 2.0 * step(baseWidth, 0.0);\nvec2  dist      = getDist(in_offset, halfWidth);\nvec3  offset    = u_displayViewMat3 * vec3(dist, 0.0);\nvec3  pos       = u_dvsMat3 * vec3(in_pos * POSITION_PRECISION, 1.0) + offset;\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\nvec4  color     = in_color;\nfloat opacity   = 1.0;\n#else\nvec4  color     = getColor(in_color, in_bitSet, BITSET_GENERIC_LOCK_COLOR);\nfloat opacity   = getOpacity();\n#ifdef SDF\nconst float SDF_PATTERN_HALF_WIDTH = 15.5;\nfloat scaleDash = getBit(in_bitSet, BITSET_LINE_SCALE_DASH);\nfloat lineWidthRatio = (scaleDash * max(halfWidth - 0.55 * u_antialiasing, 0.25) + (1.0 - scaleDash)) / SDF_PATTERN_HALF_WIDTH;\n#endif\n#endif\n#if !defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE) && defined(PATTERN)\nv_sampleAlphaOnly = getBit(in_bitSet, BITSET_GENERIC_CONSIDER_ALPHA_ONLY);\n#endif\nout_pos = vec3(pos.xy, z);\nreturn LineData(\ncolor,\nin_normal,\nhalfWidth,\nopacity,\n#ifndef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#ifdef PATTERN\nin_tlbr / u_mosaicSize.xyxy,\nvec2(in_tlbr.z - in_tlbr.x, in_tlbr.w - in_tlbr.y),\n#endif\n#ifdef SDF\nlineWidthRatio,\n#endif\n#if defined(PATTERN) || defined(SDF)\nin_accumulatedDist * u_zoomFactor + dot(in_segmentDirection, dist),\n#endif\n#endif\nnorm(in_id)\n);\n}"}},"symbologyTypeUtils.glsl":"#if SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_OUTLINE_FILL || SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_OUTLINE_FILL_SIMPLE\n#define SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#endif\n#if SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_SIMPLE || SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_OUTLINE_FILL_SIMPLE\n#define SYMBOLOGY_TYPE_IS_SIMPLE_LIKE\n#endif",text:{"common.glsl":"uniform highp vec2 u_mosaicSize;\nvarying highp vec3 v_id;\nvarying mediump vec3 v_pos;\nvarying lowp float v_opacity;\nvarying lowp vec4 v_color;\nvarying highp vec2 v_tex;\nvarying mediump float v_antialiasingWidth;\nvarying mediump float v_edgeDistanceOffset;\nvarying lowp float v_transparency;","hittest.glsl":"#include <materials/hittest/common.glsl>","text.frag":"precision mediump float;\n#include <materials/text/common.glsl>\nuniform lowp sampler2D u_texture;\n#ifdef HITTEST\nvec4 getColor() {\nreturn v_color;\n}\n#else\nvec4 getColor()\n{\nfloat SDF_CUTOFF = (2.0 / 8.0);\nfloat SDF_BASE_EDGE_DIST = 1.0 - SDF_CUTOFF;\nlowp float dist = texture2D(u_texture, v_tex).a;\nmediump float edge = SDF_BASE_EDGE_DIST - v_edgeDistanceOffset;\n#ifdef HIGHLIGHT\nedge /= 2.0;\n#endif\nlowp float aa = v_antialiasingWidth;\nlowp float alpha = smoothstep(edge - aa, edge + aa, dist);\nreturn alpha * v_color * v_opacity;\n}\n#endif\nvoid main()\n{\ngl_FragColor = getColor();\n}","text.vert":"precision highp float;\n#include <materials/utils.glsl>\n#include <materials/vcommon.glsl>\n#include <materials/text/common.glsl>\n#include <materials/text/hittest.glsl>\nattribute vec4 a_color;\nattribute vec4 a_haloColor;\nattribute vec4 a_texFontSize;\nattribute vec4 a_aux;\nattribute vec2 a_zoomRange;\nattribute vec2 a_vertexOffset;\nattribute vec2 a_texCoords;\nuniform float u_isHaloPass;\nuniform float u_isBackgroundPass;\nfloat getTextSize(inout vec2 offset, inout float baseSize, in float referenceSize) {\n#ifdef VV_SIZE\nfloat r = getSize(referenceSize) / referenceSize;\nbaseSize *= r;\noffset.xy *= r;\nreturn baseSize;\n#endif\nreturn baseSize;\n}\nvoid main()\n{\nINIT;\nfloat a_isBackground  = a_aux.y;\nfloat a_referenceSize = a_aux.z * a_aux.z / 256.0;\nfloat a_bitSet        = a_aux.w;\nfloat a_fontSize      = a_texFontSize.z;\nvec2  a_offset        = a_vertexOffset * OFFSET_PRECISION;\nvec3  in_pos        = vec3(a_pos * POSITION_PRECISION, 1.0);\nfloat fontSize      = getTextSize(a_offset, a_fontSize, a_referenceSize);\nfloat fontScale     = fontSize / SDF_FONT_SIZE;\nvec3  offset        = getRotation() * vec3(a_offset, 0.0);\nmat3  extrudeMatrix = getBit(a_bitSet, 0) == 1.0 ? u_displayViewMat3 : u_displayMat3;\nfloat isText = 1.0 - a_isBackground;\nfloat isBackground = u_isBackgroundPass * a_isBackground;\nvec4  nonHaloColor  = (isBackground * a_color) + (isText * getColor(a_color, a_bitSet, 1));\nv_color   = u_isHaloPass * a_haloColor + (1.0 - u_isHaloPass) * nonHaloColor;\nv_opacity = getOpacity();\nv_id      = norm(a_id);\nv_tex     = a_texCoords / u_mosaicSize;\nv_pos     = u_dvsMat3 * in_pos + extrudeMatrix * offset;\nfloat isHidden = u_isBackgroundPass * isText + (1.0 - u_isBackgroundPass) * a_isBackground;\nv_pos.z += 2.0 * isHidden;\nv_edgeDistanceOffset = u_isHaloPass * OUTLINE_SCALE * a_texFontSize.w / fontScale / MAX_SDF_DISTANCE;\nv_antialiasingWidth  = 0.105 * SDF_FONT_SIZE / fontSize / u_pixelRatio;\n#ifdef HITTEST\nhighp vec3 out_pos  = vec3(0.);\nv_color = vec4(0.);\nhittestMarker(v_color, out_pos, u_viewMat3 * u_tileMat3 *  vec3(a_pos * POSITION_PRECISION, 1.0)\n+ u_tileMat3 * offset, fontSize / 2.);\ngl_PointSize = 1.;\ngl_Position = vec4(clip(v_color, out_pos, getFilterFlags(), a_zoomRange), 1.0);\n#else\ngl_Position =  vec4(clip(v_color, v_pos, getFilterFlags(), a_zoomRange), 1.0);\n#endif\n}"},"utils.glsl":"float rshift(in float u32, in int amount) {\nreturn floor(u32 / pow(2.0, float(amount)));\n}\nfloat getBit(in float bitset, in int bitIndex) {\nfloat offset = pow(2.0, float(bitIndex));\nreturn mod(floor(bitset / offset), 2.0);\n}\nconst int maxHighlightReasons = 6;\nfloat getFilterBit(in float bitset, in int bitIndex) {\nreturn getBit(bitset, bitIndex + maxHighlightReasons);\n}\nfloat getHighlightBit(in float bitset, in int bitIndex) {\nreturn getBit(bitset, bitIndex);\n}\nhighp vec3 unpackDisplayIdTexel(in highp vec3 bitset) {\nfloat isAggregate = getBit(bitset.b, 7);\nreturn (1.0 - isAggregate) * bitset + isAggregate * (vec3(bitset.rgb) - vec3(0.0, 0.0, float(0x80)));\n}\nvec4 unpack(in float u32) {\nfloat r = mod(rshift(u32, 0), 255.0);\nfloat g = mod(rshift(u32, 8), 255.0);\nfloat b = mod(rshift(u32, 16), 255.0);\nfloat a = mod(rshift(u32, 24), 255.0);\nreturn vec4(r, g, b, a);\n}\nvec3 norm(in vec3 v) {\nreturn v /= 255.0;\n}\nvec4 norm(in vec4 v) {\nreturn v /= 255.0;\n}\nfloat max4(vec4 target) {\nreturn max(max(max(target.x, target.y), target.z), target.w);\n}\nvec2 unpack_u8_nf32(vec2 bytes) {\nreturn (bytes - 127.0) / 127.0;\n}\nhighp float rand(in vec2 co) {\nhighp float a = 12.9898;\nhighp float b = 78.233;\nhighp float c = 43758.5453;\nhighp float dt = dot(co, vec2(a,b));\nhighp float sn = mod(dt, 3.14);\nreturn fract(sin(sn) * c);\n}","vcommon.glsl":"#include <materials/constants.glsl>\n#include <materials/utils.glsl>\n#include <materials/attributeData.glsl>\n#include <materials/vv.glsl>\n#include <materials/barycentric.glsl>\nattribute vec2 a_pos;\nattribute highp vec3 a_id;\nuniform highp mat3 displayViewScreenMat3;\nuniform highp mat3 displayViewMat3;\nuniform highp mat3 displayMat3;\nuniform highp mat3 tileMat3;\nuniform highp mat3 viewMat3;\nuniform highp float pixelRatio;\nuniform mediump float zoomFactor;\nuniform mediump float antialiasing;\nuniform mediump float currentScale;\nuniform mediump float currentZoom;\nuniform mediump float metersPerSRUnit;\nvec4 VV_ADATA = vec4(0.0);\nvoid loadVisualVariableData(inout vec4 target) {\ntarget.rgba = getVisualVariableData(a_id);\n}\n#ifdef VV\n#define INIT loadVisualVariableData(VV_ADATA)\n#else\n#define INIT\n#endif\nvec4 getColor(in vec4 a_color, in float a_bitSet, int index) {\n#ifdef VV_COLOR\nfloat isColorLocked   = getBit(a_bitSet, index);\nreturn getVVColor(VV_ADATA[ATTR_VV_COLOR], a_color, isColorLocked);\n#else\nreturn a_color;\n#endif\n}\nfloat getOpacity() {\n#ifdef VV_OPACITY\nreturn getVVOpacity(VV_ADATA[ATTR_VV_OPACITY]);\n#else\nreturn 1.0;\n#endif\n}\nfloat getSize(in float in_size, in float currentScale) {\n#ifdef VV_SIZE\nreturn getVVSize(in_size, VV_ADATA[ATTR_VV_SIZE], currentScale);\n#else\nreturn in_size;\n#endif\n}\nmat3 getRotation() {\n#ifdef VV_ROTATION\nreturn getVVRotationMat3(mod(VV_ADATA[ATTR_VV_ROTATION], 360.0));\n#else\nreturn mat3(1.0);\n#endif\n}\nfloat getFilterFlags() {\n#ifdef IGNORES_SAMPLER_PRECISION\nreturn ceil(getFilterData(a_id).x * 255.0);\n#else\nreturn getFilterData(a_id).x * 255.0;\n#endif\n}\nvec4 getAnimationState() {\nreturn getAnimation(a_id);\n}\nfloat getMinZoom() {\nvec4 data0 = getFilterData(a_id) * 255.0;\nreturn data0.g;\n}\nmat3 getMatrixNoDisplay(float isMapAligned) {\nreturn isMapAligned * viewMat3 * tileMat3 + (1.0 - isMapAligned) * tileMat3;\n}\nmat3 getMatrix(float isMapAligned) {\nreturn isMapAligned * displayViewMat3 + (1.0 - isMapAligned) * displayMat3;\n}\nfloat checkHighlightBit(float filterFlags, int index) {\nreturn getHighlightBit(filterFlags, index);\n}\nfloat checkHighlight(float filterFlags) {\nfloat result = checkHighlightBit(filterFlags, 0);\nfor (int i = 1; i < maxHighlightReasons; i++) {\nresult = result + checkHighlightBit(filterFlags, i);\n}\nreturn step(0.1, result);\n}\nvec3 clip(inout vec4 color, inout vec3 pos, in float filterFlags, in vec2 minMaxZoom) {\npos.z += 2.0 * (1.0 - getFilterBit(filterFlags, 0));\n#ifdef inside\npos.z += 2.0 * (1.0 - getFilterBit(filterFlags, 1));\n#elif defined(outside)\npos.z += 2.0 * getFilterBit(filterFlags, 1);\n#elif defined(highlight)\n#if !defined(highlight_all)\npos.z += 2.0 * (1.0 - checkHighlight(filterFlags));\n#endif\n#endif\npos.z += 2.0 * (step(minMaxZoom.y, currentZoom) + (1.0 - step(minMaxZoom.x, currentZoom)));\nreturn pos;\n}","vv.glsl":"#if defined(VV_SIZE_MIN_MAX_VALUE) || defined(VV_SIZE_SCALE_STOPS) || defined(VV_SIZE_FIELD_STOPS) || defined(VV_SIZE_UNIT_VALUE)\n#define VV_SIZE\n#endif\n#if defined(VV_COLOR) || defined(VV_SIZE) || defined(VV_OPACITY) || defined(VV_ROTATION)\n#define VV\n#endif\n#ifdef VV_COLOR\nuniform highp float colorValues[8];\nuniform vec4 colors[8];\n#endif\n#ifdef VV_SIZE_MIN_MAX_VALUE\nuniform highp vec4 minMaxValueAndSize;\n#endif\n#ifdef VV_SIZE_SCALE_STOPS\nuniform highp float values[8];\nuniform float sizes[8];\n#endif\n#ifdef VV_SIZE_FIELD_STOPS\nuniform highp float values[8];\nuniform float sizes[8];\n#endif\n#ifdef VV_SIZE_UNIT_VALUE\nuniform highp float unitMeterRatio;\n#endif\n#ifdef VV_OPACITY\nuniform highp float opacityValues[8];\nuniform float opacities[8];\n#endif\n#ifdef VV_ROTATION\nuniform lowp float rotationType;\n#endif\nbool isNan(float val) {\nreturn (val == NAN_MAGIC_NUMBER);\n}\n#ifdef VV_SIZE_MIN_MAX_VALUE\nfloat getVVMinMaxSize(float sizeValue, float fallback) {\nif (isNan(sizeValue)) {\nreturn fallback;\n}\nfloat interpolationRatio = (sizeValue  - minMaxValueAndSize.x) / (minMaxValueAndSize.y - minMaxValueAndSize.x);\ninterpolationRatio = clamp(interpolationRatio, 0.0, 1.0);\nreturn minMaxValueAndSize.z + interpolationRatio * (minMaxValueAndSize.w - minMaxValueAndSize.z);\n}\n#endif\n#ifdef VV_SIZE_SCALE_STOPS\nfloat getVVScaleStopsSize(float currentScale) {\nfloat outSize;\nif (currentScale <= values[0]) {\noutSize = sizes[0];\n} else {\nif (currentScale >= values[7]) {\noutSize = sizes[7];\n} else {\nint index;\nindex = -1;\nfor (int i = 0; i < 8; i++) {\nif (values[i] > currentScale) {\nindex = i;\nbreak;\n}\n}\nint prevIndex = index - 1;\nfloat a = currentScale - values[prevIndex];\nfloat b = values[index] - values[prevIndex];\noutSize = mix(sizes[prevIndex], sizes[index], a / b);\n}\n}\nreturn outSize;\n}\n#endif\n#ifdef VV_SIZE_FIELD_STOPS\nconst int VV_SIZE_N = 8;\nfloat getVVStopsSize(float sizeValue, float fallback) {\nif (isNan(sizeValue)) {\nreturn fallback;\n}\nif (sizeValue <= values[0]) {\nreturn sizes[0];\n}\nif (sizeValue >= values[VV_SIZE_N - 1]) {\nreturn sizes[VV_SIZE_N - 1];\n}\nfor (int i = 1; i < VV_SIZE_N; ++i) {\nif (values[i] >= sizeValue) {\nfloat f = (sizeValue - values[i-1]) / (values[i] - values[i-1]);\nreturn mix(sizes[i-1], sizes[i], f);\n}\n}\nreturn sizes[VV_SIZE_N - 1];\n}\n#endif\n#ifdef VV_SIZE_UNIT_VALUE\nfloat getVVUnitValue(float sizeValue, float fallback) {\nif (isNan(sizeValue)) {\nreturn fallback;\n}\nreturn sizeValue * (metersPerSRUnit / unitMeterRatio);\n}\n#endif\n#ifdef VV_OPACITY\nconst int VV_OPACITY_N = 8;\nfloat getVVOpacity(float opacityValue) {\nif (isNan(opacityValue)) {\nreturn 1.0;\n}\nif (opacityValue <= opacityValues[0]) {\nreturn opacities[0];\n}\nfor (int i = 1; i < VV_OPACITY_N; ++i) {\nif (opacityValues[i] >= opacityValue) {\nfloat f = (opacityValue - opacityValues[i-1]) / (opacityValues[i] - opacityValues[i-1]);\nreturn mix(opacities[i-1], opacities[i], f);\n}\n}\nreturn opacities[VV_OPACITY_N - 1];\n}\n#endif\n#ifdef VV_ROTATION\nmat4 getVVRotation(float rotationValue) {\nif (isNan(rotationValue)) {\nreturn mat4(1, 0, 0, 0,\n0, 1, 0, 0,\n0, 0, 1, 0,\n0, 0, 0, 1);\n}\nfloat rotation = rotationValue;\nif (rotationType == 1.0) {\nrotation = 90.0 - rotation;\n}\nfloat angle = C_DEG_TO_RAD * rotation;\nfloat sinA = sin(angle);\nfloat cosA = cos(angle);\nreturn mat4(cosA, sinA, 0, 0,\n-sinA,  cosA, 0, 0,\n0,     0, 1, 0,\n0,     0, 0, 1);\n}\nmat3 getVVRotationMat3(float rotationValue) {\nif (isNan(rotationValue)) {\nreturn mat3(1, 0, 0,\n0, 1, 0,\n0, 0, 1);\n}\nfloat rotation = rotationValue;\nif (rotationType == 1.0) {\nrotation = 90.0 - rotation;\n}\nfloat angle = C_DEG_TO_RAD * -rotation;\nfloat sinA = sin(angle);\nfloat cosA = cos(angle);\nreturn mat3(cosA, -sinA, 0,\nsinA, cosA, 0,\n0,    0,    1);\n}\n#endif\n#ifdef VV_COLOR\nconst int VV_COLOR_N = 8;\nvec4 getVVColor(float colorValue, vec4 fallback, float isColorLocked) {\nif (isNan(colorValue) || isColorLocked == 1.0) {\nreturn fallback;\n}\nif (colorValue <= colorValues[0]) {\nreturn colors[0];\n}\nfor (int i = 1; i < VV_COLOR_N; ++i) {\nif (colorValues[i] >= colorValue) {\nfloat f = (colorValue - colorValues[i-1]) / (colorValues[i] - colorValues[i-1]);\nreturn mix(colors[i-1], colors[i], f);\n}\n}\nreturn colors[VV_COLOR_N - 1];\n}\n#endif\nfloat getVVSize(in float size, in float vvSize, in float currentScale)  {\n#ifdef VV_SIZE_MIN_MAX_VALUE\nreturn getVVMinMaxSize(vvSize, size);\n#elif defined(VV_SIZE_SCALE_STOPS)\nfloat outSize = getVVScaleStopsSize(currentScale);\nreturn isNan(outSize) ? size : outSize;\n#elif defined(VV_SIZE_FIELD_STOPS)\nfloat outSize = getVVStopsSize(vvSize, size);\nreturn isNan(outSize) ? size : outSize;\n#elif defined(VV_SIZE_UNIT_VALUE)\nreturn getVVUnitValue(vvSize, size);\n#else\nreturn size;\n#endif\n}"},"post-processing":{blit:{"blit.frag":"precision mediump float;\nuniform sampler2D u_texture;\nvarying vec2 v_uv;\nvoid main() {\ngl_FragColor = texture2D(u_texture, v_uv);\n}"},bloom:{composite:{"composite.frag":"precision mediump float;\nvarying vec2 v_uv;\nuniform sampler2D u_blurTexture1;\nuniform sampler2D u_blurTexture2;\nuniform sampler2D u_blurTexture3;\nuniform sampler2D u_blurTexture4;\nuniform sampler2D u_blurTexture5;\nuniform float u_bloomStrength;\nuniform float u_bloomRadius;\nuniform float u_bloomFactors[NUMMIPS];\nuniform vec3 u_bloomTintColors[NUMMIPS];\nfloat lerpBloomFactor(const in float factor) {\nfloat mirrorFactor = 1.2 - factor;\nreturn mix(factor, mirrorFactor, u_bloomRadius);\n}\nvoid main() {\nvec4 color = u_bloomStrength * (\nlerpBloomFactor(u_bloomFactors[0]) * vec4(u_bloomTintColors[0], 1.0) * texture2D(u_blurTexture1, v_uv) +\nlerpBloomFactor(u_bloomFactors[1]) * vec4(u_bloomTintColors[1], 1.0) * texture2D(u_blurTexture2, v_uv) +\nlerpBloomFactor(u_bloomFactors[2]) * vec4(u_bloomTintColors[2], 1.0) * texture2D(u_blurTexture3, v_uv) +\nlerpBloomFactor(u_bloomFactors[3]) * vec4(u_bloomTintColors[3], 1.0) * texture2D(u_blurTexture4, v_uv) +\nlerpBloomFactor(u_bloomFactors[4]) * vec4(u_bloomTintColors[4], 1.0) * texture2D(u_blurTexture5, v_uv)\n);\ngl_FragColor = clamp(color, 0.0, 1.0);\n}"},gaussianBlur:{"gaussianBlur.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nuniform vec2 u_texSize;\nuniform vec2 u_direction;\nvarying vec2 v_uv;\n#define KERNEL_RADIUS RADIUS\n#define SIGMA RADIUS\nfloat gaussianPdf(in float x, in float sigma) {\nreturn 0.39894 * exp(-0.5 * x * x / ( sigma * sigma)) / sigma;\n}\nvoid main() {\nvec2 invSize = 1.0 / u_texSize;\nfloat fSigma = float(SIGMA);\nfloat weightSum = gaussianPdf(0.0, fSigma);\nvec4 pixelColorSum = texture2D(u_colorTexture, v_uv) * weightSum;\nfor (int i = 1; i < KERNEL_RADIUS; i ++) {\nfloat x = float(i);\nfloat w = gaussianPdf(x, fSigma);\nvec2 uvOffset = u_direction * invSize * x;\nvec4 sample1 = texture2D(u_colorTexture, v_uv + uvOffset);\nvec4 sample2 = texture2D(u_colorTexture, v_uv - uvOffset);\npixelColorSum += (sample1 + sample2) * w;\nweightSum += 2.0 * w;\n}\ngl_FragColor = pixelColorSum /weightSum;\n}"},luminosityHighPass:{"luminosityHighPass.frag":"precision mediump float;\nuniform sampler2D u_texture;\nuniform vec3 u_defaultColor;\nuniform float u_defaultOpacity;\nuniform float u_luminosityThreshold;\nuniform float u_smoothWidth;\nvarying vec2 v_uv;\nvoid main() {\nvec4 texel = texture2D(u_texture, v_uv);\nvec3 luma = vec3(0.299, 0.587, 0.114);\nfloat v = dot(texel.xyz, luma);\nvec4 outputColor = vec4(u_defaultColor.rgb, u_defaultOpacity);\nfloat alpha = smoothstep(u_luminosityThreshold, u_luminosityThreshold + u_smoothWidth, v);\ngl_FragColor = mix(outputColor, texel, alpha);\n}"}},blur:{gaussianBlur:{"gaussianBlur.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nuniform vec2 u_texSize;\nuniform vec2 u_direction;\nuniform float u_sigma;\nvarying vec2 v_uv;\n#define KERNEL_RADIUS RADIUS\nfloat gaussianPdf(in float x, in float sigma) {\nreturn 0.39894 * exp(-0.5 * x * x / ( sigma * sigma)) / sigma;\n}\nvoid main() {\nvec2 invSize = 1.0 / u_texSize;\nfloat fSigma = u_sigma;\nfloat weightSum = gaussianPdf(0.0, fSigma);\nvec4 pixelColorSum = texture2D(u_colorTexture, v_uv) * weightSum;\nfor (int i = 1; i < KERNEL_RADIUS; i ++) {\nfloat x = float(i);\nfloat w = gaussianPdf(x, fSigma);\nvec2 uvOffset = u_direction * invSize * x;\nvec4 sample1 = texture2D(u_colorTexture, v_uv + uvOffset);\nvec4 sample2 = texture2D(u_colorTexture, v_uv - uvOffset);\npixelColorSum += (sample1 + sample2) * w;\nweightSum += 2.0 * w;\n}\ngl_FragColor = pixelColorSum /weightSum;\n}"},"radial-blur":{"radial-blur.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nvarying vec2 v_uv;\nconst float sampleDist = 1.0;\nconst float sampleStrength = 2.2;\nvoid main(void) {\nfloat samples[10];\nsamples[0] = -0.08;\nsamples[1] = -0.05;\nsamples[2] = -0.03;\nsamples[3] = -0.02;\nsamples[4] = -0.01;\nsamples[5] =  0.01;\nsamples[6] =  0.02;\nsamples[7] =  0.03;\nsamples[8] =  0.05;\nsamples[9] =  0.08;\nvec2 dir = 0.5 - v_uv;\nfloat dist = sqrt(dir.x * dir.x + dir.y * dir.y);\ndir = dir / dist;\nvec4 color = texture2D(u_colorTexture,v_uv);\nvec4 sum = color;\nfor (int i = 0; i < 10; i++) {\nsum += texture2D(u_colorTexture, v_uv + dir * samples[i] * sampleDist);\n}\nsum *= 1.0 / 11.0;\nfloat t = dist * sampleStrength;\nt = clamp(t, 0.0, 1.0);\ngl_FragColor = mix(color, sum, t);\n}"}},dra:{"dra.frag":"precision mediump float;\nuniform sampler2D u_minColor;\nuniform sampler2D u_maxColor;\nuniform sampler2D u_texture;\nvarying vec2 v_uv;\nvoid main() {\nvec4 minColor = texture2D(u_minColor, vec2(0.5));\nvec4 maxColor = texture2D(u_maxColor, vec2(0.5));\nvec4 color = texture2D(u_texture, v_uv);\nvec3 minColorUnpremultiply = minColor.rgb / minColor.a;\nvec3 maxColorUnpremultiply = maxColor.rgb / maxColor.a;\nvec3 colorUnpremultiply = color.rgb / color.a;\nvec3 range = maxColorUnpremultiply - minColorUnpremultiply;\ngl_FragColor = vec4(color.a * (colorUnpremultiply - minColorUnpremultiply) / range, color.a);\n}","min-max":{"min-max.frag":"#extension GL_EXT_draw_buffers : require\nprecision mediump float;\n#define CELL_SIZE 2\nuniform sampler2D u_minTexture;\nuniform sampler2D u_maxTexture;\nuniform vec2 u_srcResolution;\nuniform vec2 u_dstResolution;\nvarying vec2 v_uv;\nvoid main() {\nvec2 srcPixel = floor(gl_FragCoord.xy) * float(CELL_SIZE);\nvec2 onePixel = vec2(1.0) / u_srcResolution;\nvec2 uv = (srcPixel + 0.5) / u_srcResolution;\nvec4 minColor = vec4(1.0);\nvec4 maxColor = vec4(0.0);\nfor (int y = 0; y < CELL_SIZE; ++y) {\nfor (int x = 0; x < CELL_SIZE; ++x) {\nvec2 offset = uv + vec2(x, y) * onePixel;\nminColor = min(minColor, texture2D(u_minTexture, offset));\nmaxColor = max(maxColor, texture2D(u_maxTexture, offset));\n}\n}\ngl_FragData[0] = minColor;\ngl_FragData[1] = maxColor;\n}"}},"drop-shadow":{composite:{"composite.frag":"precision mediump float;\nuniform sampler2D u_layerFBOTexture;\nuniform sampler2D u_blurTexture;\nuniform vec4 u_shadowColor;\nuniform vec2 u_shadowOffset;\nuniform highp mat3 u_displayViewMat3;\nvarying vec2 v_uv;\nvoid main() {\nvec3 offset = u_displayViewMat3 * vec3(u_shadowOffset, 0.0);\nvec4 layerColor = texture2D(u_layerFBOTexture, v_uv);\nvec4 blurColor = texture2D(u_blurTexture, v_uv - offset.xy / 2.0);\ngl_FragColor = ((1.0 - layerColor.a) * blurColor.a * u_shadowColor + layerColor);\n}"}},"edge-detect":{"frei-chen":{"frei-chen.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nuniform vec2 u_texSize;\nvarying vec2 v_uv;\nvec2 texel = vec2(1.0 / u_texSize.x, 1.0 / u_texSize.y);\nmat3 G[9];\nconst mat3 g0 = mat3( 0.3535533845424652, 0, -0.3535533845424652, 0.5, 0, -0.5, 0.3535533845424652, 0, -0.3535533845424652 );\nconst mat3 g1 = mat3( 0.3535533845424652, 0.5, 0.3535533845424652, 0, 0, 0, -0.3535533845424652, -0.5, -0.3535533845424652 );\nconst mat3 g2 = mat3( 0, 0.3535533845424652, -0.5, -0.3535533845424652, 0, 0.3535533845424652, 0.5, -0.3535533845424652, 0 );\nconst mat3 g3 = mat3( 0.5, -0.3535533845424652, 0, -0.3535533845424652, 0, 0.3535533845424652, 0, 0.3535533845424652, -0.5 );\nconst mat3 g4 = mat3( 0, -0.5, 0, 0.5, 0, 0.5, 0, -0.5, 0 );\nconst mat3 g5 = mat3( -0.5, 0, 0.5, 0, 0, 0, 0.5, 0, -0.5 );\nconst mat3 g6 = mat3( 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.6666666865348816, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204 );\nconst mat3 g7 = mat3( -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, 0.6666666865348816, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408 );\nconst mat3 g8 = mat3( 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408 );\nvoid main() {\nG[0] = g0,\nG[1] = g1,\nG[2] = g2,\nG[3] = g3,\nG[4] = g4,\nG[5] = g5,\nG[6] = g6,\nG[7] = g7,\nG[8] = g8;\nmat3 I;\nfloat cnv[9];\nvec3 sample;\nfor (float i = 0.0; i < 3.0; i++) {\nfor (float j = 0.0; j < 3.0; j++) {\nsample = texture2D(u_colorTexture, v_uv + texel * vec2(i - 1.0,j - 1.0)).rgb;\nI[int(i)][int(j)] = length(sample);\n}\n}\nfor (int i = 0; i < 9; i++) {\nfloat dp3 = dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);\ncnv[i] = dp3 * dp3;\n}\nfloat M = (cnv[0] + cnv[1]) + (cnv[2] + cnv[3]);\nfloat S = (cnv[4] + cnv[5]) + (cnv[6] + cnv[7]) + (cnv[8] + M);\ngl_FragColor = vec4(vec3(sqrt(M / S)), texture2D(u_colorTexture, v_uv).a);\n}"},sobel:{"sobel.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nvarying vec2 v_uv;\nuniform vec2 u_texSize;\nvec2 texel = vec2(1.0 / u_texSize.x, 1.0 / u_texSize.y);\nmat3 G[2];\nconst mat3 g0 = mat3( 1.0, 2.0, 1.0, 0.0, 0.0, 0.0, -1.0, -2.0, -1.0 );\nconst mat3 g1 = mat3( 1.0, 0.0, -1.0, 2.0, 0.0, -2.0, 1.0, 0.0, -1.0 );\nvoid main() {\nmat3 I;\nfloat cnv[2];\nvec3 sample;\nG[0] = g0;\nG[1] = g1;\nfor (float i = 0.0; i < 3.0; i++) {\nfor (float j = 0.0; j < 3.0; j++) {\nsample = texture2D( u_colorTexture, v_uv + texel * vec2(i-1.0,j-1.0) ).rgb;\nI[int(i)][int(j)] = length(sample);\n}\n}\nfor (int i = 0; i < 2; i++) {\nfloat dp3 = dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);\ncnv[i] = dp3 * dp3;\n}\ngl_FragColor = vec4(vec3(0.5 * sqrt(cnv[0] * cnv[0] + cnv[1] * cnv[1])), texture2D(u_colorTexture, v_uv).a);\n}"}},"edge-enhance":{"edge-enhance.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nvarying vec2 v_uv;\nuniform vec2 u_texSize;\nvec2 texel = vec2(1.0 / u_texSize.x, 1.0 / u_texSize.y);\nmat3 G[2];\nconst mat3 g0 = mat3( 1.0, 0.0, -1.0, 1.0, 0.0, -1.0, 1.0, 0.0, -1.0 );\nconst mat3 g1 = mat3( 1.0, 1.0, 1.0, 0.0, 0.0, 0.0, -1.0, -1.0, -1.0 );\nvoid main() {\nmat3 I;\nfloat cnv[2];\nvec3 sample;\nG[0] = g0;\nG[1] = g1;\nfor (float i = 0.0; i < 3.0; i++) {\nfor (float j = 0.0; j < 3.0; j++) {\nsample = texture2D( u_colorTexture, v_uv + texel * vec2(i-1.0,j-1.0) ).rgb;\nI[int(i)][int(j)] = length(sample);\n}\n}\nfor (int i = 0; i < 2; i++) {\nfloat dp3 = dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);\ncnv[i] = dp3 * dp3;\n}\nvec4 color = texture2D(u_colorTexture, v_uv);\ngl_FragColor = vec4(0.5 * sqrt(cnv[0] * cnv[0] + cnv[1] * cnv[1]) * color);\n}"},filterEffect:{"filterEffect.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nuniform mat4 u_coefficients;\nvarying vec2 v_uv;\nvoid main() {\nvec4 color = texture2D(u_colorTexture, v_uv);\nvec4 rgbw = u_coefficients * vec4(color.a > 0.0 ? color.rgb / color.a : vec3(0.0), 1.0);\nfloat a = color.a;\ngl_FragColor = vec4(a * rgbw.rgb, a);\n}"},pp:{"pp.vert":"precision mediump float;\nattribute vec2 a_position;\nvarying vec2 v_uv;\nvoid main() {\ngl_Position = vec4(a_position, 0.0, 1.0);\nv_uv = (a_position + 1.0) / 2.0;\n}"}},raster:{bitmap:{"bitmap.frag":"precision mediump float;\nvarying highp vec2 v_texcoord;\nuniform sampler2D u_texture;\nuniform highp vec2 u_coordScale;\nuniform lowp float u_opacity;\n#include <filtering/bicubic.glsl>\nvoid main() {\n#ifdef BICUBIC\nvec4 color = sampleBicubicBSpline(u_texture, v_texcoord, u_coordScale);\n#else\nvec4 color = texture2D(u_texture, v_texcoord);\n#endif\ngl_FragColor = vec4(color.rgb * u_opacity, color.a * u_opacity);\n}","bitmap.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\nv_texcoord = a_pos;\ngl_Position = vec4(u_dvsMat3 * vec3(a_pos * u_coordScale, 1.0), 1.0);\n}"},common:{"common.glsl":"uniform sampler2D u_image;\nuniform int u_bandCount;\nuniform bool u_flipY;\nuniform float u_opacity;\nuniform int u_resampling;\nuniform vec2 u_srcImageSize;\n#ifdef APPLY_PROJECTION\n#include <raster/common/projection.glsl>\n#endif\n#ifdef BICUBIC\n#include <filtering/bicubic.glsl>\n#endif\n#ifdef BILINEAR\n#include <filtering/bilinear.glsl>\n#endif\nvec2 getPixelLocation(vec2 coords) {\nvec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;\n#ifdef APPLY_PROJECTION\ntargetLocation = projectPixelLocation(targetLocation);\n#endif\nreturn targetLocation;\n}\nbool isOutside(vec2 coords){\nif (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {\nreturn true;\n} else {\nreturn false;\n}\n}\nvec4 getPixel(vec2 pixelLocation) {\n#ifdef BICUBIC\nvec4 color = sampleBicubicBSpline(u_image, pixelLocation, u_srcImageSize);\n#elif defined(BILINEAR)\nvec4 color = sampleBilinear(u_image, pixelLocation, u_srcImageSize);\n#else\nvec4 color = texture2D(u_image, pixelLocation);\n#endif\nreturn color;\n}","common.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nuniform highp float u_scale;\nuniform highp vec2 u_offset;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\nv_texcoord = a_pos * u_scale + u_offset;\ngl_Position = vec4(u_dvsMat3 * vec3(a_pos * u_coordScale, 1.0), 1.0);\n}","contrastBrightness.glsl":"uniform float u_contrastOffset;\nuniform float u_brightnessOffset;\nvec4 adjustContrastBrightness(vec4 currentPixel, bool isFloat) {\nvec4 pixelValue = isFloat ? currentPixel * 255.0 : currentPixel;\nfloat maxI = 255.0;\nfloat mid = 128.0;\nfloat c = u_contrastOffset;\nfloat b = u_brightnessOffset;\nvec4 v;\nif (c > 0.0 && c < 100.0) {\nv = (200.0 * pixelValue - 100.0 * maxI + 2.0 * maxI * b) / (2.0 * (100.0 - c)) + mid;\n} else if (c <= 0.0 && c > -100.0) {\nv = (200.0 * pixelValue - 100.0 * maxI + 2.0 * maxI * b) * (100.0 + c) / 20000.0 + mid;\n} else if (c == 100.0) {\nv = (200.0 * pixelValue - 100.0 * maxI + (maxI + 1.0) * (100.0 - c) + 2.0 * maxI * b);\nv = (sign(v) + 1.0) / 2.0;\n} else if (c == -100.0) {\nv = vec4(mid, mid, mid, currentPixel.a);\n}\nvec3 rgb = clamp(v.rgb / 255.0, 0.0, 1.0);\nreturn vec4(rgb, currentPixel.a);\n}","getSurfaceValues.glsl":"#include <raster/common/mirror.glsl>\nvoid getSurfaceValues(sampler2D imageTexture, vec2 texCoord, vec2 srcImageSize, inout float values[10]) {\nvec2 onePixel = 1.0 / srcImageSize;\nvec4 va = texture2D(imageTexture, mirror(texCoord + onePixel * vec2(-1.0, -1.0)));\nvec4 vb = texture2D(imageTexture, mirror(texCoord + onePixel * vec2(0.0, -1.0)));\nvec4 vc = texture2D(imageTexture, mirror(texCoord + onePixel * vec2(1.0, -1.0)));\nvec4 vd = texture2D(imageTexture, mirror(texCoord + onePixel * vec2(-1.0, 0.0)));\nvec4 ve = texture2D(imageTexture, mirror(texCoord));\nvec4 vf = texture2D(imageTexture, mirror(texCoord + onePixel * vec2(1.0, 0.0)));\nvec4 vg = texture2D(imageTexture, mirror(texCoord + onePixel * vec2(-1.0, 1.0)));\nvec4 vh = texture2D(imageTexture, mirror(texCoord + onePixel * vec2(0.0, 1.0)));\nvec4 vi = texture2D(imageTexture, mirror(texCoord + onePixel * vec2(1.0, 1.0)));\nfloat alpha = va.a * vb.a * vc.a * vd.a * ve.a * vf.a * vg.a * vh.a * vi.a;\nvalues[0] = va.r;\nvalues[1] = vb.r;\nvalues[2] = vc.r;\nvalues[3] = vd.r;\nvalues[4] = ve.r;\nvalues[5] = vf.r;\nvalues[6] = vg.r;\nvalues[7] = vh.r;\nvalues[8] = vi.r;\nvalues[9] = alpha;\n}","inverse.glsl":"float invertValue(float value) {\nfloat s = sign(value);\nreturn (s * s) / (value + abs(s) - 1.0);\n}","mirror.glsl":"vec2 mirror(vec2 pos) {\nvec2 pos1 = abs(pos);\nreturn step(pos1, vec2(1.0, 1.0)) * pos1 + step(1.0, pos1) * (2.0 - pos1);\n}","projection.glsl":"uniform sampler2D u_transformGrid;\nuniform vec2 u_transformSpacing;\nuniform vec2 u_transformGridSize;\nuniform vec2 u_targetImageSize;\nvec2 projectPixelLocation(vec2 coords) {\n#ifdef LOOKUP_PROJECTION\nvec4 pv = texture2D(u_transformGrid, coords);\nreturn vec2(pv.r, pv.g);\n#endif\nvec2 index_image = floor(coords * u_targetImageSize);\nvec2 oneTransformPixel = vec2(0.25 / u_transformGridSize.s, 1.0 / u_transformGridSize.t);\nvec2 index_transform = floor(index_image / u_transformSpacing) / u_transformGridSize;\nvec2 pos = fract((index_image + vec2(0.5, 0.5)) / u_transformSpacing);\nvec2 srcLocation;\nvec2 transform_location = index_transform + oneTransformPixel * 0.5;\nif (pos.s <= pos.t) {\nvec4 ll_abc = texture2D(u_transformGrid, vec2(transform_location.s, transform_location.t));\nvec4 ll_def = texture2D(u_transformGrid, vec2(transform_location.s + oneTransformPixel.s, transform_location.t));\nsrcLocation.s = dot(ll_abc.rgb, vec3(pos, 1.0));\nsrcLocation.t = dot(ll_def.rgb, vec3(pos, 1.0));\n} else {\nvec4 ur_abc = texture2D(u_transformGrid, vec2(transform_location.s + 2.0 * oneTransformPixel.s, transform_location.t));\nvec4 ur_def = texture2D(u_transformGrid, vec2(transform_location.s + 3.0 * oneTransformPixel.s, transform_location.t));\nsrcLocation.s = dot(ur_abc.rgb, vec3(pos, 1.0));\nsrcLocation.t = dot(ur_def.rgb, vec3(pos, 1.0));\n}\nreturn srcLocation;\n}"},flow:{"getFadeOpacity.glsl":"uniform float u_decayRate;\nuniform float u_fadeToZero;\nfloat getFadeOpacity(float x) {\nfloat cutOff = mix(0.0, exp(-u_decayRate), u_fadeToZero);\nreturn (exp(-u_decayRate * x) - cutOff) / (1.0 - cutOff);\n}","getFragmentColor.glsl":"vec4 getFragmentColor(vec4 color, float dist, float size, float featheringSize) {\nfloat featheringStart = clamp(0.5 - featheringSize / size, 0.0, 0.5);\nif (dist > featheringStart) {\ncolor *= 1.0 - (dist - featheringStart) / (0.5 - featheringStart);\n}\nreturn color;\n}",imagery:{"imagery.frag":"precision highp float;\nvarying vec2 v_texcoord;\nuniform sampler2D u_texture;\nuniform float u_Min;\nuniform float u_Max;\nuniform float u_featheringSize;\n#include <raster/flow/vv.glsl>\nfloat getIntensity(float v) {\nreturn u_Min + v * (u_Max - u_Min);\n}\nvoid main(void) {\nvec4 sampled = texture2D(u_texture, v_texcoord);\nfloat intensity = getIntensity(sampled.r);\ngl_FragColor = getColor(intensity);\ngl_FragColor.a *= getOpacity(sampled.r);\ngl_FragColor.a *= sampled.a;\ngl_FragColor.rgb *= gl_FragColor.a;\n}","imagery.vert":"attribute vec2 a_position;\nattribute vec2 a_texcoord;\nuniform mat3 u_dvsMat3;\nvarying vec2 v_texcoord;\nvoid main(void) {\nvec2 xy = (u_dvsMat3 * vec3(a_position, 1.0)).xy;\ngl_Position = vec4(xy, 0.0, 1.0);\nv_texcoord = a_texcoord;\n}"},particles:{"particles.frag":"precision highp float;\nvarying vec4 v_color;\nvarying vec2 v_texcoord;\nvarying float v_size;\nuniform float u_featheringSize;\n#include <raster/flow/getFragmentColor.glsl>\nvoid main(void) {\ngl_FragColor = getFragmentColor(v_color, length(v_texcoord - 0.5), v_size, u_featheringSize);\n}","particles.vert":"attribute vec4 a_xyts0;\nattribute vec4 a_xyts1;\nattribute vec4 a_typeIdDurationSeed;\nattribute vec4 a_extrudeInfo;\nuniform mat3 u_dvsMat3;\nuniform mat3 u_displayViewMat3;\nuniform float u_time;\nuniform float u_trailLength;\nuniform float u_flowSpeed;\nvarying vec4 v_color;\nvarying vec2 v_texcoord;\nvarying float v_size;\nuniform float u_featheringSize;\nuniform float u_introFade;\n#include <raster/flow/vv.glsl>\n#include <raster/flow/getFadeOpacity.glsl>\nvoid main(void) {\nvec2 position0 = a_xyts0.xy;\nfloat t0 = a_xyts0.z;\nfloat speed0 = a_xyts0.w;\nvec2 position1 = a_xyts1.xy;\nfloat t1 = a_xyts1.z;\nfloat speed1 = a_xyts1.w;\nfloat type = a_typeIdDurationSeed.x;\nfloat id = a_typeIdDurationSeed.y;\nfloat duration = a_typeIdDurationSeed.z;\nfloat seed = a_typeIdDurationSeed.w;\nvec2 e0 = a_extrudeInfo.xy;\nvec2 e1 = a_extrudeInfo.zw;\nfloat animationPeriod = duration + u_trailLength;\nfloat scaledTime = u_time * u_flowSpeed;\nfloat randomizedTime = scaledTime + seed * animationPeriod;\nfloat t = mod(randomizedTime, animationPeriod);\nfloat fUnclamped = (t - t0) / (t1 - t0);\nfloat f = clamp(fUnclamped, 0.0, 1.0);\nfloat clampedTime = mix(t0, t1, f);\nfloat speed = mix(speed0, speed1, f);\nvec2 extrude;\nvec2 position;\nfloat fadeOpacity;\nfloat introOpacity;\nif (type == 2.0) {\nif (fUnclamped < 0.0 || (fUnclamped > 1.0 && t1 != duration)) {\ngl_Position = vec4(0.0, 0.0, -2.0, 1.0);\nreturn;\n}\nvec2 ortho = mix(e0, e1, f);\nvec2 parallel;\nparallel = normalize(position1 - position0) * 0.5;\nif (id == 1.0) {\nextrude = ortho;\nv_texcoord = vec2(0.5, 0.0);\n} else if (id == 2.0) {\nextrude = -ortho;\nv_texcoord = vec2(0.5, 1.0);\n} else if (id == 3.0) {\nextrude = ortho + parallel;\nv_texcoord = vec2(1.0, 0.0);\n} else if (id == 4.0) {\nextrude = -ortho + parallel;\nv_texcoord = vec2(1.0, 1.0);\n}\nfadeOpacity = getFadeOpacity((t - clampedTime) / u_trailLength);\nintroOpacity = 1.0 - exp(-clampedTime);\nv_size = getSize(speed);\nv_color = getColor(speed);\nv_color.a *= getOpacity(speed);\nposition = mix(position0, position1, f);\n} else {\nif (fUnclamped < 0.0) {\ngl_Position = vec4(0.0, 0.0, -2.0, 1.0);\nreturn;\n}\nif (id == 1.0) {\nextrude = e0;\nv_texcoord = vec2(0.5, 0.0);\nfadeOpacity = getFadeOpacity((t - t0) / u_trailLength);\nintroOpacity = 1.0 - exp(-t0);\nv_size = getSize(speed0);\nv_color = getColor(speed0);\nv_color.a *= getOpacity(speed0);\nposition = position0;\n} else if (id == 2.0) {\nextrude = -e0;\nv_texcoord = vec2(0.5, 1.0);\nfadeOpacity = getFadeOpacity((t - t0) / u_trailLength);\nintroOpacity = 1.0 - exp(-t0);\nv_size = getSize(speed0);\nv_color = getColor(speed0);\nv_color.a *= getOpacity(speed0);\nposition = position0;\n} else if (id == 3.0) {\nextrude = mix(e0, e1, f);\nv_texcoord = vec2(0.5, 0.0);\nfadeOpacity = getFadeOpacity((t - clampedTime) / u_trailLength);\nintroOpacity = 1.0 - exp(-clampedTime);\nv_size = getSize(speed);\nv_color = getColor(speed);\nv_color.a *= getOpacity(speed);\nposition = mix(position0, position1, f);\n} else if (id == 4.0) {\nextrude = -mix(e0, e1, f);\nv_texcoord = vec2(0.5, 1.0);\nfadeOpacity = getFadeOpacity((t - clampedTime) / u_trailLength);\nintroOpacity = 1.0 - exp(-clampedTime);\nv_size = getSize(speed);\nv_color = getColor(speed);\nv_color.a *= getOpacity(speed);\nposition = mix(position0, position1, f);\n}\n}\nvec2 xy = (u_dvsMat3 * vec3(position, 1.0) + u_displayViewMat3 * vec3(extrude * v_size, 0.0)).xy;\ngl_Position = vec4(xy, 0.0, 1.0);\nv_color.a *= fadeOpacity;\nv_color.a *= mix(1.0, introOpacity, u_introFade);\nv_color.rgb *= v_color.a;\n}"},streamlines:{"streamlines.frag":"precision highp float;\nvarying float v_side;\nvarying float v_time;\nvarying float v_totalTime;\nvarying float v_timeSeed;\nvarying vec4 v_color;\nvarying float v_size;\nuniform float u_time;\nuniform float u_trailLength;\nuniform float u_flowSpeed;\nuniform float u_featheringSize;\nuniform float u_introFade;\n#include <raster/flow/getFragmentColor.glsl>\n#include <raster/flow/getFadeOpacity.glsl>\nvoid main(void) {\nfloat t = mod(v_timeSeed * (v_totalTime + u_trailLength) + u_time * u_flowSpeed, v_totalTime + u_trailLength) - v_time;\nvec4 color = v_color * step(0.0, t) * getFadeOpacity(t / u_trailLength);\ncolor *= mix(1.0, 1.0 - exp(-v_time), u_introFade);\ngl_FragColor = getFragmentColor(color, length((v_side + 1.0) / 2.0 - 0.5), v_size, u_featheringSize);\n}","streamlines.vert":"attribute vec3 a_positionAndSide;\nattribute vec3 a_timeInfo;\nattribute vec2 a_extrude;\nattribute float a_speed;\nuniform mat3 u_dvsMat3;\nuniform mat3 u_displayViewMat3;\nvarying float v_time;\nvarying float v_totalTime;\nvarying float v_timeSeed;\nvarying vec4 v_color;\nvarying float v_side;\nvarying float v_size;\nuniform float u_featheringSize;\n#include <raster/flow/vv.glsl>\nvoid main(void) {\nvec4 lineColor = getColor(a_speed);\nfloat lineOpacity = getOpacity(a_speed);\nfloat lineSize = getSize(a_speed);\nvec2 position = a_positionAndSide.xy;\nv_side = a_positionAndSide.z;\nvec2 xy = (u_dvsMat3 * vec3(position, 1.0) + u_displayViewMat3 * vec3(a_extrude * lineSize, 0.0)).xy;\ngl_Position = vec4(xy, 0.0, 1.0);\nv_time = a_timeInfo.x;\nv_totalTime = a_timeInfo.y;\nv_timeSeed = a_timeInfo.z;\nv_color = lineColor;\nv_color.a *= lineOpacity;\nv_color.rgb *= v_color.a;\nv_size = lineSize;\n}"},"vv.glsl":"#define MAX_STOPS 8\n#ifdef VV_COLOR\nuniform float u_color_stops[MAX_STOPS];\nuniform vec4 u_color_values[MAX_STOPS];\nuniform int u_color_count;\n#else\nuniform vec4 u_color;\n#endif\n#ifdef VV_OPACITY\nuniform float u_opacity_stops[MAX_STOPS];\nuniform float u_opacity_values[MAX_STOPS];\nuniform int u_opacity_count;\n#else\nuniform float u_opacity;\n#endif\n#ifdef VV_SIZE\nuniform float u_size_stops[MAX_STOPS];\nuniform float u_size_values[MAX_STOPS];\nuniform int u_size_count;\n#else\nuniform float u_size;\n#endif\nuniform float u_featheringOffset;\nvec4 getColor(float x) {\n#ifdef VV_COLOR\nvec4 color = u_color_values[0];\n{\nfor (int i = 1; i < MAX_STOPS; i++) {\nif (i >= u_color_count) {\nbreak;\n}\nfloat x1 = u_color_stops[i - 1];\nif (x < x1) {\nbreak;\n}\nfloat x2 = u_color_stops[i];\nvec4 y2 = u_color_values[i];\nif (x < x2) {\nvec4 y1 = u_color_values[i - 1];\ncolor = y1 + (y2 - y1) * (x - x1) / (x2 - x1);\n} else {\ncolor = y2;\n}\n}\n}\n#else\nvec4 color = u_color;\n#endif\nreturn color;\n}\nfloat getOpacity(float x) {\n#ifdef VV_OPACITY\nfloat opacity = u_opacity_values[0];\n{\nfor (int i = 1; i < MAX_STOPS; i++) {\nif (i >= u_opacity_count) {\nbreak;\n}\nfloat x1 = u_opacity_stops[i - 1];\nif (x < x1) {\nbreak;\n}\nfloat x2 = u_opacity_stops[i];\nfloat y2 = u_opacity_values[i];\nif (x < x2) {\nfloat y1 = u_opacity_values[i - 1];\nopacity = y1 + (y2 - y1) * (x - x1) / (x2 - x1);\n} else {\nopacity = y2;\n}\n}\n}\n#else\nfloat opacity = u_opacity;\n#endif\nreturn opacity;\n}\nfloat getSize(float x) {\n#ifdef VV_SIZE\nfloat size = u_size_values[0];\n{\nfor (int i = 1; i < MAX_STOPS; i++) {\nif (i >= u_size_count) {\nbreak;\n}\nfloat x1 = u_size_stops[i - 1];\nif (x < x1) {\nbreak;\n}\nfloat x2 = u_size_stops[i];\nfloat y2 = u_size_values[i];\nif (x < x2) {\nfloat y1 = u_size_values[i - 1];\nsize = y1 + (y2 - y1) * (x - x1) / (x2 - x1);\n} else {\nsize = y2;\n}\n}\n}\n#else\nfloat size = u_size;\n#endif\nreturn size + 2.0 * u_featheringSize * u_featheringOffset;\n}"},hillshade:{"hillshade.frag":"precision mediump float;\nvarying highp vec2 v_texcoord;\n#include <raster/common/common.glsl>\nuniform int u_hillshadeType;\nuniform float u_sinZcosAs[6];\nuniform float u_sinZsinAs[6];\nuniform float u_cosZs[6];\nuniform float u_weights[6];\nuniform vec2 u_factor;\nuniform float u_minValue;\nuniform float u_maxValue;\nuniform float u_scaling;\n#include <raster/lut/colorize.glsl>\n#include <raster/common/getSurfaceValues.glsl>\nvec3 rgb2hsv(vec3 c) {\nvec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\nvec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\nvec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\nfloat d = q.x - min(q.w, q.y);\nfloat e = 1.0e-10;\nreturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);\n}\nvec3 hsv2rgb(vec3 c) {\nvec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\nvec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\nreturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\nvec4 overlay(float val, float minValue, float maxValue, float hillshade) {\nval = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);\nvec4 rgb = colorize(vec4(val, val, val, 1.0), 255.0);\nvec3 hsv = rgb2hsv(rgb.xyz);\nhsv.z = hillshade;\nreturn vec4(hsv2rgb(hsv) * u_scaling, 1.0) * rgb.a;\n}\nvoid main() {\nvec2 pixelLocation = getPixelLocation(v_texcoord);\nif (isOutside(pixelLocation)) {\ngl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\nvec4 currentPixel = getPixel(pixelLocation);\nif (currentPixel.a == 0.0) {\ngl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\nfloat pv[10];\ngetSurfaceValues(u_image, pixelLocation, u_srcImageSize, pv);\nfloat alpha = pv[9];\nfloat dzx = (pv[2] + 2.0 * pv[5] + pv[8] - pv[0] - 2.0 * pv[3] - pv[6]) * u_factor.s;\nfloat dzy = (pv[6] + 2.0 * pv[7] + pv[8] - pv[0] - 2.0 * pv[1] - pv[2]) * u_factor.t;\nfloat dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);\nfloat hillshade = 0.0;\nif (u_hillshadeType == 0){\nfloat cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;\nfloat z = (u_cosZs[0] + cosDelta) / dzd;\nif (z < 0.0)  z = 0.0;\nhillshade = z;\n} else {\nfor (int k = 0; k < 6; k++) {\nfloat cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;\nfloat z = (u_cosZs[k] + cosDelta) / dzd;\nif (z < 0.0) z = 0.0;\nhillshade = hillshade + z * u_weights[k];\nif (k == 5) break;\n}\n}\n#ifdef APPLY_COLORMAP\nvec4 result = overlay(pv[4], u_minValue, u_maxValue, hillshade) * alpha * u_opacity;\n#else\nhillshade *= u_scaling;\nvec4 result = vec4(hillshade, hillshade, hillshade, 1.0) * alpha * u_opacity;\n#endif\n#ifdef ROUND_OUTPUT\nresult = vec4(floor(result.xyz + 0.5), result.a);\n#endif\ngl_FragColor = result;\n}"},lut:{"colorize.glsl":"uniform sampler2D u_colormap;\nuniform float u_colormapOffset;\nuniform float u_colormapMaxIndex;\nvec4 colorize(vec4 currentPixel, float scaleFactor) {\nfloat clrIndex = clamp(currentPixel.r * scaleFactor - u_colormapOffset, 0.0, u_colormapMaxIndex);\nvec2 clrPosition = vec2((clrIndex + 0.5) / (u_colormapMaxIndex + 1.0), 0.0);\nvec4 color = texture2D(u_colormap, clrPosition);\nvec4 result = vec4(color.rgb, color.a * currentPixel.a);\nreturn result;\n}\nvec4 colorizeNoClamp(vec4 currentPixel, float scaleFactor) {\nfloat value = currentPixel.r * scaleFactor - u_colormapOffset;\nvec4 result = colorize(currentPixel, scaleFactor);\nreturn result * step(0.0, value) * step(value, u_colormapMaxIndex);\n}","lut.frag":"precision mediump float;\nvarying highp vec2 v_texcoord;\n#include <raster/common/common.glsl>\n#include <raster/lut/colorize.glsl>\nvoid main() {\nvec2 pixelLocation = getPixelLocation(v_texcoord);\nif (isOutside(pixelLocation)) {\ngl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\nvec4 currentPixel = getPixel(pixelLocation);\nvec4 result = colorizeNoClamp(currentPixel, 1.0);\ngl_FragColor = vec4(result.xyz, 1.0) * result.a * u_opacity;\n}"},magdir:{"magdir.frag":"precision mediump float;\nvarying vec4 v_color;\nuniform lowp float u_opacity;\nvoid main() {\ngl_FragColor = v_color * u_opacity;\n}","magdir.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_vv;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nuniform vec2 u_symbolSize;\nuniform vec2 u_symbolPercentRange;\nuniform vec2 u_dataRange;\nuniform float u_rotation;\nuniform vec4 u_colors[12];\nvarying vec4 v_color;\nvoid main()\n{\nfloat angle = a_offset.y + u_rotation;\n#ifndef ROTATION_GEOGRAPHIC\nangle = 3.14159265359 * 2.0 - angle - 3.14159265359 / 2.0;\n#endif\nvec2 offset = vec2(cos(angle), sin(angle)) * a_offset.x;\n#ifdef DATA_RANGE\nfloat valuePercentage = clamp((a_vv.y - u_dataRange.x) / (u_dataRange.y - u_dataRange.x), 0.0, 1.0);\nfloat sizeRatio = u_symbolPercentRange.x + valuePercentage * (u_symbolPercentRange.y - u_symbolPercentRange.x);\nfloat sizePercentage = clamp(sizeRatio, u_symbolPercentRange.x, u_symbolPercentRange.y);\n#else\nfloat sizePercentage = (u_symbolPercentRange.x + u_symbolPercentRange.y) / 2.0;\n#endif\nvec2 pos = a_pos + offset * sizePercentage * u_symbolSize;\nv_color = u_colors[int(a_vv.x)];\ngl_Position = vec4(u_dvsMat3 * vec3(pos * u_coordScale, 1.0), 1.0);\n}"},reproject:{"reproject.frag":"precision mediump float;\nvarying vec2 v_texcoord;\n#include <raster/common/common.glsl>\nvoid main() {\nvec2 pixelLocation = getPixelLocation(v_texcoord);\nif (isOutside(pixelLocation)) {\ngl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\nreturn;\n}\nvec4 currentPixel = getPixel(pixelLocation);\ngl_FragColor = vec4(currentPixel.rgb, 1.0) * currentPixel.a * u_opacity;\n}","reproject.vert":"precision mediump float;\nattribute vec2 a_position;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\nv_texcoord = a_position;\ngl_Position = vec4(2.0 * (a_position - 0.5), 0.0, 1.0);\n}"},rfx:{aspect:{"aspect.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform vec2 u_cellSize;\nuniform vec2 u_srcImageSize;\n#include <raster/common/getSurfaceValues.glsl>\nconst float pi = 3.14159265359;\nvoid main() {\nfloat pv[10];\ngetSurfaceValues(u_image, v_texcoord, u_srcImageSize, pv);\nfloat alpha = pv[9];\nfloat dzx = (pv[2] + 2.0 * pv[5] + pv[8] - pv[0] - 2.0 * pv[3] - pv[6]) / (8.0 * u_cellSize[0]);\nfloat dzy = -(pv[6] + 2.0 * pv[7] + pv[8] - pv[0] - 2.0 * pv[1] - pv[2]) / (8.0 * u_cellSize[1]);\nalpha *= sign(abs(dzx) + abs(dzy));\nfloat aspect_rad = (dzx == 0.0) ? (step(0.0, dzy) * 0.5 * pi + step(dzy, 0.0) * 1.5 * pi) : mod((2.5 * pi + atan(dzy, -dzx)), 2.0 * pi);\nfloat aspect = aspect_rad * 180.0 / pi;\ngl_FragColor = vec4(aspect, aspect, aspect, 1.0) * alpha;\n}"},bandarithmetic:{"bandarithmetic.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform mediump mat3 u_bandIndexMat3;\nuniform float u_adjustments[3];\n#include <raster/common/inverse.glsl>\nvoid main() {\nvec4 pv = texture2D(u_image, v_texcoord);\nvec3 pv2 = u_bandIndexMat3 * pv.rgb;\nfloat nir = pv2.r;\nfloat red = pv2.g;\nfloat index;\n#ifdef NDXI\nindex = (nir - red) * invertValue(nir + red);\n#elif defined(SR)\nindex = nir * invertValue(red);\n#elif defined(CI)\nindex = nir * invertValue(red) - 1.0;\n#elif defined(SAVI)\nindex = (nir - red) * invertValue(nir + red + u_adjustments[0]) * (1.0 + u_adjustments[0]);\n#elif defined(TSAVI)\nfloat s = u_adjustments[0];\nfloat a = u_adjustments[1];\nfloat x = u_adjustments[2];\nfloat y = -a * s + x * (1.0 + s * s);\nindex = (s * (nir - s * red - a)) * invertValue(a * nir + red + y);\n#elif defined(MSAVI)\nfloat nir2 = 2.0 * nir + 1.0;\nindex = 0.5 * (nir2 - sqrt(nir2 * nir2 - 8.0 * (nir - red)));\n#elif defined(GEMI)\nfloat eta = (2.0 * (nir * nir - red * red) + 1.5 * nir + 0.5 * red) * invertValue(nir + red + 0.5);\nindex = eta * (1.0 - 0.25 * eta) - (red - 0.125) * invertValue(1.0 - red);\n#elif defined(PVI)\nfloat a = u_adjustments[0];\nfloat b = u_adjustments[1];\nfloat y = sqrt(1.0 + a * a);\nindex = (nir - a * red - b) * invertValue(y);\n#elif defined(VARI)\nindex = (pv2.g - pv2.r) * invertValue(pv2.g + pv2.r - pv2.b);\n#elif defined(MTVI)\nfloat green = pv2.b;\nfloat v = sqrt(pow((2.0 * nir + 1.0), 2.0) - (6.0 * nir - 5.0 * sqrt(red)) - 0.5);\nindex = 1.5 * (1.2 * (nir - green) - 2.5 * (red - green)) * invertValue(v);\n#elif defined(RTVICORE)\nfloat green = pv2.b;\nindex = 100.0 * (nir - red) - 10.0 * (nir - green);\n#elif defined(EVI)\nfloat blue = pv2.b;\nfloat denom = nir + 6.0 * red - 7.5 * blue + 1.0;\nindex =  (2.5 * (nir - red)) * invertValue(denom);\n#elif defined(WNDWI)\nfloat g = pv2.r;\nfloat n = pv2.g;\nfloat s = pv2.b;\nfloat a = u_adjustments[0];\nfloat denom = g + a * n + (1.0 - a) * s;\nindex = (g - a * n - (1.0 - a) * s) * invertValue(denom);\n#elif defined(BAI)\nindex = invertValue(pow((0.1 - red), 2.0) + pow((0.06 - nir), 2.0));\n#else\ngl_FragColor = pv;\nreturn;\n#endif\n#ifdef ROUND_OUTPUT\nindex = floor(index + 0.5);\n#endif\ngl_FragColor = vec4(index, index, index, pv.a);\n}"},colormap2rgb:{"colormap2rgb.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\n#include <raster/lut/colorize.glsl>\nvoid main() {\nvec4 pv = texture2D(u_image, v_texcoord);\nvec4 result = colorizeNoClamp(vec4(pv.r, pv.r, pv.r, 1.0), 1.0);\ngl_FragColor = vec4(result.xyz * 255.0, 1.0) * result.a * pv.a;\n}"},compositeband:{"compositeband.frag":"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nuniform sampler2D u_image2;\n#ifdef ONE_CONSTANT\nuniform float u_image1Const;\n#ifdef TWO_CONSTANT\nuniform float u_image2Const;\n#endif\nuniform mat3 u_imageSwap;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\nvec4 pv0 = texture2D(u_image, v_texcoord);\nfloat a = pv0.r;\nfloat alpha = pv0.a;\n#ifdef TWO_CONSTANT\nfloat b = u_image1Const;\nfloat c = u_image2Const;\nvec3 abc = u_imageSwap * vec3(a, b, c);\na = abc.s;\nb = abc.t;\nc = abc.p;\n#elif defined(ONE_CONSTANT)\nvec4 pv1 = texture2D(u_image1, v_texcoord);\nfloat b = pv1.r;\nfloat c = u_image1Const;\nvec3 abc = u_imageSwap * vec3(a, b, c);\na = abc.s;\nb = abc.t;\nc = abc.p;\nalpha *= pv1.a;\n#else\nvec4 pv1 = texture2D(u_image1, v_texcoord);\nvec4 pv2 = texture2D(u_image2, v_texcoord);\nfloat b = pv1.r;\nfloat c = pv2.r;\nalpha = alpha * pv1.a * pv2.a;\n#endif\ngl_FragColor = vec4(a, b, c, alpha);\n}"},computechange:{"computechange.frag":"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\n#ifdef ONE_CONSTANT\nuniform float u_image1Const;\nuniform mat3 u_imageSwap;\n#endif\nvarying vec2 v_texcoord;\nuniform vec2 u_domainRange;\n#include <raster/common/inverse.glsl>\nvoid main() {\nvec4 pv0 = texture2D(u_image, v_texcoord);\nfloat a = pv0.r;\n#ifdef ONE_CONSTANT\nfloat b = u_image1Const;\nvec3 abc = u_imageSwap * vec3(a, b, 0);\na = abc.s;\nb = abc.t;\n#else\nvec4 pv1 = texture2D(u_image1, v_texcoord);\nfloat b = pv1.r;\n#endif\nfloat result = a;\nfloat alpha = pv0.a;\n#ifdef DIFFERENCE\nresult = a - b;\n#elif defined(RELATIVE)\nresult = (a - b) * invertValue(max(abs(a), abs(b)));\n#endif\nbool isInvalid = result < u_domainRange.s || result > u_domainRange.t;\nresult = isInvalid ? 0.0 : result;\nalpha *= float(!isInvalid);\n#ifdef ROUND_OUTPUT\nresult = floor(result + 0.5);\n#endif\ngl_FragColor = vec4(result, result, result, alpha);\n}"},contrast:{"contrast.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\n#include <raster/common/contrastBrightness.glsl>\nvoid main() {\nvec4 pv = texture2D(u_image, v_texcoord);\nvec4 result = adjustContrastBrightness(pv, false);\ngl_FragColor = vec4(floor(result.rgb * 255.0 + 0.5), result.a);\n}"},convolution:{"convolution.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform vec2 u_srcImageSize;\n#define KERNEL_SIZE_ROWS ROWS\n#define KERNEL_SIZE_COLS COLS\nuniform vec2 u_clampRange;\nuniform float u_kernel[25];\n#include <raster/common/mirror.glsl>\nvoid main() {\nvec3 rgb = vec3(0.0, 0.0, 0.0);\nvec2 resolution = 1.0 / u_srcImageSize;\nfloat rowOffset = -float(floor(float(KERNEL_SIZE_ROWS) / 2.0));\nfloat colOffset = -float(floor(float(KERNEL_SIZE_COLS) / 2.0));\nfloat alpha = 1.0;\nfor (int row = 0; row < KERNEL_SIZE_ROWS; row++) {\nfloat pos_row = rowOffset + float(row);\nfor (int col = 0; col < KERNEL_SIZE_COLS; col++) {\nvec2 pos = v_texcoord + vec2(colOffset + float(col), pos_row) * resolution;\nvec4 pv = texture2D(u_image, mirror(pos));\nrgb += pv.rgb * u_kernel[row * KERNEL_SIZE_COLS + col];\nalpha *= pv.a;\n}\n}\nrgb = clamp(rgb, u_clampRange.s, u_clampRange.t);\ngl_FragColor = vec4(rgb * alpha, alpha);\n}"},curvature:{"curvature.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform float u_zlFactor;\nuniform vec2 u_srcImageSize;\n#include <raster/common/getSurfaceValues.glsl>\nvoid main() {\nfloat pv[10];\ngetSurfaceValues(u_image, v_texcoord, u_srcImageSize, pv);\nfloat alpha = pv[9];\nfloat d = ((pv[3] + pv[5]) * 0.5 - pv[4]);\nfloat e = ((pv[1] + pv[7]) * 0.5 - pv[4]);\nfloat curvature = 0.0;\n#ifdef STANDARD\ncurvature = -u_zlFactor * (d + e);\ngl_FragColor = vec4(curvature, curvature, curvature, alpha);\n#else\nfloat f = (-pv[0] + pv[2] + pv[6] - pv[8]) / 4.0;\nfloat g = (-pv[3] + pv[5]) / 2.0;\nfloat h = (pv[1] - pv[7]) / 2.0;\nfloat g2 = g * g;\nfloat h2 = h * h;\n#ifdef PROFILE\ncurvature = (u_zlFactor * (d * g2 + e * h2 + f * g * h)) / (g2 + h2);\n#else\ncurvature = (-u_zlFactor * (d * h2 + e * g2 - f * g * h)) / (g2 + h2);\n#endif\n#endif\ngl_FragColor = vec4(curvature, curvature, curvature, alpha);\n}"},extractband:{"extractband.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform mediump mat3 u_bandIndexMat3;\nvoid main() {\nvec4 pv = texture2D(u_image, v_texcoord);\nvec3 pv2 = u_bandIndexMat3 * pv.rgb;\ngl_FragColor = vec4(pv2, pv.a);\n}"},focalstatistics:{"focalstatistics.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform vec2 u_srcImageSize;\n#define KERNEL_SIZE_ROWS ROWS\n#define KERNEL_SIZE_COLS COLS\nuniform vec2 u_clampRange;\n#include <raster/common/mirror.glsl>\n#include <raster/common/inverse.glsl>\nvoid main() {\nvec2 resolution = 1.0 / u_srcImageSize;\nfloat rowOffset = -float(floor(float(KERNEL_SIZE_ROWS) / 2.0));\nfloat colOffset = -float(floor(float(KERNEL_SIZE_COLS) / 2.0));\nfloat count = 0.0;\n#ifdef STDDEV\nvec3 sum = vec3(0.0, 0.0, 0.0);\nvec3 sum2 = vec3(0.0, 0.0, 0.0);\n#endif\nvec4 currentPixel = texture2D(u_image, v_texcoord);\nvec3 rgb = currentPixel.rgb;\nfor (int row = 0; row < KERNEL_SIZE_ROWS; row++) {\nfloat pos_row = rowOffset + float(row);\nfor (int col = 0; col < KERNEL_SIZE_COLS; col++) {\nvec2 pos = v_texcoord + vec2(colOffset + float(col), pos_row) * resolution;\nvec4 pv = texture2D(u_image, mirror(pos));\ncount += pv.a;\n#ifdef MIN\nrgb = min(rgb, pv.rgb);\n#elif defined(MAX)\nrgb = max(rgb, pv.rgb);\n#elif defined(MEAN)\nrgb += pv.rgb;\n#elif defined(STDDEV)\nsum += pv.rgb;\nsum2 += (pv.rgb * pv.rgb);\n#endif\n}\n}\n#ifdef MEAN\nrgb *= invertValue(count);\n#elif defined(STDDEV)\nrgb = sqrt((sum2 - sum * sum * invertValue(count)) * invertValue(count));\n#endif\nfloat alpha = step(0.9999, count);\nrgb = clamp(rgb, u_clampRange.s, u_clampRange.t);\n#ifdef FILL\nrgb = (1.0 - currentPixel.a) * rgb + currentPixel.a * currentPixel.rgb;\n#endif\ngl_FragColor = vec4(rgb * alpha, alpha);\n}"},grayscale:{"grayscale.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform vec3 u_weights;\nvoid main() {\nvec4 pv = texture2D(u_image, v_texcoord);\nfloat value = dot(u_weights, pv.rgb);\ngl_FragColor = vec4(value, value, value, pv.a);\n}"},local:{"local.frag":"precision highp float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\n#ifdef ONE_CONSTANT\nuniform float u_image1Const;\n#ifdef TWO_CONSTANT\nuniform float u_image2Const;\n#endif\nuniform mat3 u_imageSwap;\n#endif\nvarying vec2 v_texcoord;\nuniform vec2 u_domainRange;\n#include <raster/common/inverse.glsl>\nvoid main() {\nvec4 pv0 = texture2D(u_image, v_texcoord);\nfloat a = pv0.r;\n#ifdef TWO_IMAGES\n#ifdef ONE_CONSTANT\nfloat b = u_image1Const;\nvec3 abc = u_imageSwap * vec3(a, b, 0);\na = abc.s;\nb = abc.t;\n#else\nvec4 pv1 = texture2D(u_image1, v_texcoord);\nfloat b = pv1.r;\n#endif\n#elif defined(CONDITIONAL)\n#ifdef TWO_CONSTANT\nfloat b = u_image1Const;\nfloat c = u_image2Const;\nvec3 abc = u_imageSwap * vec3(a, b, c);\na = abc.s;\nb = abc.t;\nc = abc.p;\n#elif defined(ONE_CONSTANT)\nvec4 pv1 = texture2D(u_image1, v_texcoord);\nfloat b = pv1.r;\nfloat c = u_image1Const;\nvec3 abc = u_imageSwap * vec3(a, b, c);\na = abc.s;\nb = abc.t;\nc = abc.p;\n#else\nvec4 pv1 = texture2D(u_image1, v_texcoord);\nvec4 pv2 = texture2D(u_image2, v_texcoord);\nfloat b = pv1.r;\nfloat c = pv2.r;\n#endif\n#endif\nfloat result = a;\nfloat alpha = pv0.a;\n#ifdef PLUS\nresult = a + b;\n#elif defined(MINUS)\nresult = a - b;\n#elif defined(TIMES)\nresult = a * b;\n#elif defined(DIVIDE)\nresult = a * invertValue(b);\nalpha *= float(abs(sign(b)));\n#elif defined(FLOATDIVIDE)\nresult = a * invertValue(b);\nalpha *= float(abs(sign(b)));\n#elif defined(FLOORDIVIDE)\nresult = floor(a * invertValue(b));\nalpha *= float(abs(sign(b)));\n#elif defined(SQUARE)\nresult = a * a;\n#elif defined(SQRT)\nresult = sqrt(a);\n#elif defined(POWER)\nresult = pow(a, b);\n#elif defined(LN)\nresult = a <= 0.0 ? 0.0: log(a);\nalpha *= float(a > 0.0);\n#elif defined(LOG_1_0)\nresult = a <= 0.0 ? 0.0: log2(a) * invertValue(log2(10.0));\nalpha *= float(a > 0.0);\n#elif defined(LOG_2)\nresult = a <= 0.0 ? 0.0: log2(a);\nalpha *= float(a > 0.0);\n#elif defined(EXP)\nresult = exp(a);\n#elif defined(EXP_1_0)\nresult = pow(10.0, a);\n#elif defined(EXP_2)\nresult = pow(2.0, a);\n#elif defined(ROUNDDOWN)\nresult = floor(a);\n#elif defined(ROUNDUP)\nresult = ceil(a);\n#elif defined(INT)\nresult = float(sign(a)) * floor(abs(a));\n#elif defined(MOD)\nresult = mod(a, b);\n#elif defined(NEGATE)\nresult = -a;\n#elif defined(ABS)\nresult = abs(a);\n#elif defined(ACOS)\nresult = abs(a) > 1.0 ? 0.0: acos(a);\nalpha *= step(abs(a), 1.00001);\n#elif defined(ACOSH)\nresult = acosh(a);\n#elif defined(ASIN)\nresult = abs(a) > 1.0 ? 0.0: asin(a);\nalpha *= step(abs(a), 1.00001);\n#elif defined(ASINH)\nresult = asinh(a);\n#elif defined(ATAN)\nresult = atan(a);\n#elif defined(ATANH)\nresult = abs(a) > 1.0 ? 0.0: atanh(a);\nalpha *= step(abs(a), 1.0);\n#elif defined(ATAN_2)\nresult = atan(a, b);\n#elif defined(COS)\nresult = cos(a);\n#elif defined(COSH)\nresult = cosh(a);\n#elif defined(SIN)\nresult = sin(a);\n#elif defined(SINH)\nresult = sinh(a);\n#elif defined(TAN)\nresult = tan(a);\n#elif defined(TANH)\nresult = tanh(a);\n#elif defined(BITWISEAND)\nresult = float(int(a) & int(b));\n#elif defined(BITWISEOR)\nresult = float(int(a) | int(b));\n#elif defined(BITWISELEFTSHIFT)\nresult = float(int(a) << int(b));\n#elif defined(BITWISERIGHTSHIFT)\nresult = float(int(a) >> int(b));\n#elif defined(BITWISENOT)\nresult = float(~(int(a)));\n#elif defined(BITWISEXOR)\nresult = float(int(a) ^ int(b));\n#elif defined(BOOLEANAND)\nresult = float((a != 0.0) && (b != 0.0));\n#elif defined(BOOLEANNOT)\nresult = float(a == 0.0);\n#elif defined(BOOLEANOR)\nresult = float((a != 0.0) || (b != 0.0));\n#elif defined(BOOLEANXOR)\nresult = float((a != 0.0) ^^ (b != 0.0));\n#elif defined(GREATERTHAN)\nresult = float(a > b);\n#elif defined(GREATERTHANEQUAL)\nresult = float(a >= b);\n#elif defined(LESSTHAN)\nresult = float(a < b);\n#elif defined(LESSTHANEQUAL)\nresult = float(a <= b);\n#elif defined(EQUALTO)\nresult = float(a == b);\n#elif defined(NOTEQUAL)\nresult = float(a != b);\n#elif defined(ISNULL)\nresult = float(alpha == 0.0);\nalpha = 1.0;\n#elif defined(SETNULL)\nfloat maskValue = float(a == 0.0);\nresult = maskValue * b;\nalpha *= maskValue;\n#elif defined(CONDITIONAL)\nfloat weight = float(abs(sign(a)));\nresult = weight * b + (1.0 - weight) * c;\n#endif\nfloat rangeFactor = step(u_domainRange.s, result) * step(result, u_domainRange.t);\nresult *= rangeFactor;\nalpha *= rangeFactor;\n#ifdef ROUND_OUTPUT\nresult = floor(result + 0.5);\n#endif\ngl_FragColor = vec4(result, result, result, alpha);\n}"},mask:{"mask.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\n#define LEN_INCLUDED_RANGES 6\n#define LEN_NODATA_VALUES 6\nuniform highp float u_includedRanges[6];\nuniform highp float u_noDataValues[6];\nfloat maskFactor(float bandValue, float fromValue, float to) {\nfloat factor = 1.0;\nfor (int i = 0; i < LEN_NODATA_VALUES; i++) {\nfactor *= float(u_noDataValues[i] != bandValue);\n}\nfactor *= step(fromValue, bandValue) * step(bandValue, to);\nreturn factor;\n}\nvoid main() {\nvec4 pv = texture2D(u_image, v_texcoord);\nfloat redFactor = maskFactor(pv.r, u_includedRanges[0], u_includedRanges[1]);\n#ifdef MULTI_BAND\nfloat greenFactor = maskFactor(pv.g, u_includedRanges[2], u_includedRanges[3]);\nfloat blueFactor = maskFactor(pv.b, u_includedRanges[4], u_includedRanges[5]);\nfloat maskFactor = redFactor * greenFactor * blueFactor;\ngl_FragColor = pv * maskFactor;\n#else\ngl_FragColor = pv * redFactor;\n#endif\n}"},ndvi:{"ndvi.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform mediump mat3 u_bandIndexMat3;\n#include <raster/common/inverse.glsl>\nvoid main() {\nvec4 pv = texture2D(u_image, v_texcoord);\nvec3 pv2 = u_bandIndexMat3 * pv.rgb;\nfloat nir = pv2.r;\nfloat red = pv2.g;\nfloat index = (nir - red) * invertValue(nir + red);\n#ifdef SCALED\nindex = floor((index + 1.0) * 100.0 + 0.5);\n#endif\ngl_FragColor = vec4(index, index, index, pv.a);\n}"},remap:{"remap.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\n#define LEN_REMAP_RANGES 18\n#define LEN_NODATA_RANGES 12\nuniform highp float u_rangeMaps[18];\nuniform highp float u_noDataRanges[12];\nuniform highp float u_unmatchMask;\nuniform vec2 u_clampRange;\nvoid main() {\nvec4 pv = texture2D(u_image, v_texcoord);\nfloat factor = 1.0;\nfloat bandValue = pv.r;\nfor (int i = 0; i < LEN_NODATA_RANGES; i+=2) {\nfloat inside = 1.0 - step(u_noDataRanges[i], bandValue) * step(bandValue, u_noDataRanges[i+1]);\nfactor *= inside;\n}\nfloat mapValue = 0.0;\nfloat includeMask = 0.0;\nfor (int i = 0; i < LEN_REMAP_RANGES; i+=3) {\nfloat stepMask = step(u_rangeMaps[i], bandValue) * step(bandValue, u_rangeMaps[i+1]);\nincludeMask = (1.0 - stepMask) * includeMask + stepMask;\nmapValue = (1.0 - stepMask) * mapValue + stepMask * u_rangeMaps[i+2];\n}\nbandValue = factor * (mapValue + (1.0 - includeMask) * u_unmatchMask * pv.r);\nfloat bandMask = factor * max(u_unmatchMask, includeMask);\nbandValue = clamp(bandValue, u_clampRange.s, u_clampRange.t);\ngl_FragColor = vec4(bandValue, bandValue, bandValue, bandMask * pv.a);\n}"},slope:{"slope.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform vec2 u_cellSize;\nuniform float u_zFactor;\nuniform vec2 u_srcImageSize;\nuniform float u_pixelSizePower;\nuniform float u_pixelSizeFactor;\n#include <raster/common/getSurfaceValues.glsl>\nvoid main() {\nfloat pv[10];\ngetSurfaceValues(u_image, v_texcoord, u_srcImageSize, pv);\nfloat alpha = pv[9];\nfloat xf = (u_zFactor + pow(u_cellSize[0], u_pixelSizePower) * u_pixelSizeFactor) / (8.0 * u_cellSize[0]);\nfloat yf = (u_zFactor + pow(u_cellSize[1], u_pixelSizePower) * u_pixelSizeFactor) / (8.0 * u_cellSize[1]);\nfloat dzx = (pv[2] + 2.0 * pv[5] + pv[8] - pv[0] - 2.0 * pv[3] - pv[6]) * xf;\nfloat dzy = -(pv[6] + 2.0 * pv[7] + pv[8] - pv[0] - 2.0 * pv[1] - pv[2]) * yf;\nfloat rise2run = sqrt(dzx * dzx + dzy * dzy);\n#ifdef PERCENT_RISE\nfloat result = rise2run * 100.0;\n#else\nfloat result = atan(rise2run) * 57.2957795;\n#endif\n#ifdef ROUND_OUTPUT\nresult = floor(result + 0.5);\n#endif\ngl_FragColor = vec4(result, result, result, alpha);\n}"},stretch:{"stretch.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying highp vec2 v_texcoord;\nuniform float u_minCutOff[3];\nuniform float u_maxCutOff[3];\nuniform float u_minOutput;\nuniform float u_maxOutput;\nuniform float u_factor[3];\nuniform float u_gamma[3];\nuniform float u_gammaCorrection[3];\nfloat stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, float gamma, float gammaCorrection) {\nval = clamp(val, minCutOff, maxCutOff);\nfloat stretchedVal;\n#ifdef USE_GAMMA\nfloat tempf = 1.0;\nfloat outRange = maxOutput - minOutput;\nfloat relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);\ntempf -= step(1.0, gamma) * sign(gamma - 1.0) * pow(1.0 / outRange, relativeVal * gammaCorrection);\nstretchedVal = tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput;\nstretchedVal = clamp(stretchedVal, minOutput, maxOutput);\n#else\nstretchedVal = minOutput + (val - minCutOff) * factor;\n#endif\n#ifdef ROUND_OUTPUT\nstretchedVal = floor(stretchedVal + 0.5);\n#endif\nreturn stretchedVal;\n}\nvoid main() {\nvec4 currentPixel = texture2D(u_image, v_texcoord);\nfloat redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_gamma[0], u_gammaCorrection[0]);\n#ifdef MULTI_BAND\nfloat greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_gamma[1], u_gammaCorrection[1]);\nfloat blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_gamma[2], u_gammaCorrection[2]);\ngl_FragColor = vec4(redVal, greenVal, blueVal, currentPixel.a);\n#else\ngl_FragColor = vec4(redVal, redVal, redVal, currentPixel.a);\n#endif\n}"},vs:{"vs.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\nv_texcoord = a_pos;\ngl_Position = vec4(u_dvsMat3 * vec3(a_pos * u_coordScale, 1.0), 1.0);\n}"}},scalar:{"scalar.frag":"precision mediump float;\nuniform lowp float u_opacity;\nvarying vec2 v_pos;\nconst vec4 outlineColor = vec4(0.2, 0.2, 0.2, 1.0);\nconst float outlineSize = 0.02;\nconst float innerRadius = 0.25;\nconst float outerRadius = 0.42;\nconst float innerSquareLength = 0.15;\nvoid main() {\nmediump float dist = length(v_pos);\nmediump float fillalpha1 = smoothstep(outerRadius, outerRadius + outlineSize, dist);\nfillalpha1 *= (1.0-smoothstep(outerRadius + outlineSize, outerRadius + 0.1 + outlineSize, dist));\n#ifdef INNER_CIRCLE\nmediump float fillalpha2 = smoothstep(innerRadius, innerRadius + outlineSize, dist);\nfillalpha2 *= (1.0-smoothstep(innerRadius + outlineSize, innerRadius + 0.1 + outlineSize, dist));\n#else\nmediump float fillalpha2 = (abs(v_pos.x) < innerSquareLength ? 1.0 : 0.0) * (abs(v_pos.y) < innerSquareLength ? 1.0 : 0.0);\n#endif\ngl_FragColor = (fillalpha2 + fillalpha1) * outlineColor * u_opacity;\n}","scalar.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_vv;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nuniform vec2 u_symbolSize;\nuniform vec2 u_symbolPercentRange;\nuniform vec2 u_dataRange;\nvarying vec2 v_pos;\nvoid main()\n{\n#ifdef DATA_RANGE\nfloat valuePercentage = clamp((a_vv.y - u_dataRange.x) / (u_dataRange.y - u_dataRange.x), 0.0, 1.0);\nfloat sizeRatio = u_symbolPercentRange.x + valuePercentage * (u_symbolPercentRange.y - u_symbolPercentRange.x);\nfloat sizePercentage = clamp(sizeRatio, u_symbolPercentRange.x, u_symbolPercentRange.y);\n#else\nfloat sizePercentage = (u_symbolPercentRange.x + u_symbolPercentRange.y) / 2.0;\n#endif\nvec2 size = u_symbolSize * sizePercentage;\nvec2 pos = a_pos + a_offset * size;\nv_pos = a_offset;\ngl_Position = vec4(u_dvsMat3 * vec3(pos * u_coordScale, 1.0), 1.0);\n}"},stretch:{"stretch.frag":"precision mediump float;\nvarying highp vec2 v_texcoord;\n#include <raster/common/common.glsl>\nuniform float u_minCutOff[3];\nuniform float u_maxCutOff[3];\nuniform float u_minOutput;\nuniform float u_maxOutput;\nuniform float u_factor[3];\nuniform bool u_useGamma;\nuniform float u_gamma[3];\nuniform float u_gammaCorrection[3];\n#include <raster/lut/colorize.glsl>\nfloat stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {\nif (val >= maxCutOff) {\nreturn maxOutput;\n} else if (val <= minCutOff) {\nreturn minOutput;\n}\nfloat stretchedVal;\nif (useGamma) {\nfloat tempf = 1.0;\nfloat outRange = maxOutput - minOutput;\nfloat relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);\nif (gamma > 1.0) {\ntempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);\n}\nstretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;\n} else {\nstretchedVal = minOutput + (val - minCutOff) * factor;\n}\n#ifdef ROUND_OUTPUT\nstretchedVal = floor(stretchedVal + 0.5);\n#endif\nreturn stretchedVal;\n}\nvoid main() {\nvec2 pixelLocation = getPixelLocation(v_texcoord);\nif (isOutside(pixelLocation)) {\ngl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\nvec4 currentPixel = getPixel(pixelLocation);\n#ifdef NOOP\ngl_FragColor = vec4(currentPixel.rgb, 1.0) * currentPixel.a * u_opacity;\nreturn;\n#endif\nif (u_bandCount == 1) {\nfloat grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);\n#ifdef APPLY_COLORMAP\nvec4 result = colorize(vec4(grayVal, grayVal, grayVal, 1.0), u_useGamma ? 255.0 : 1.0);\ngl_FragColor = vec4(result.xyz, 1.0) * result.a * currentPixel.a * u_opacity;\n#else\ngl_FragColor = vec4(grayVal, grayVal, grayVal, 1.0) * currentPixel.a * u_opacity;\n#endif\n} else {\nfloat redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);\nfloat greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);\nfloat blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);\ngl_FragColor = vec4(redVal, greenVal, blueVal, 1.0) * currentPixel.a * u_opacity;\n}\n}"}},stencil:{"stencil.frag":"void main() {\ngl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);\n}","stencil.vert":"attribute vec2 a_pos;\nuniform mat3 u_worldExtent;\nvoid main() {\ngl_Position = vec4(u_worldExtent * vec3(a_pos, 1.0), 1.0);\n}"},test:{"TestShader.common.glsl":"#ifndef RETURN_RED\nvarying    vec4      v_color;\n#endif\nvarying    vec2      v_offset;","TestShader.frag":"precision highp float;\n#include <test/TestShader.common.glsl>\nvoid main() {\nif (v_offset.x > -.5 && v_offset.y > -.5 && v_offset.x < .5 && v_offset.y < .5) {\ndiscard;\n}\n#ifdef RETURN_RED\ngl_FragColor = vec4(1., 0., 0., 1.);\n#else\ngl_FragColor = v_color;\n#endif\n}","TestShader.vert":"const float POS_PRECISION_FACTOR = 10.;\nconst float OFFSET_PRECISION_FACTOR = 10.;\nconst float SIZE_PRECISION_FACTOR = 10.;\nattribute  vec2      a_pos_packed;\nattribute  vec2      a_offset_packed;\nattribute  float     a_size_packed;\n#ifdef DATA_DRIVEN_COLOR\nconst float u_dataDrivenColor_validValues[4] = float[4](0., 0., 1., 0.);\nuniform    vec4      u_dataDrivenColor_colorFallback;\nuniform    vec4      u_dataDrivenColor_color;\n#endif\nuniform    float     u_view_zoomLevel;\n#include <test/TestShader.common.glsl>\n#ifdef DATA_DRIVEN_COLOR\nvec4 getColor(float value) {\nint index = -1;\nfor (int i = 0; i < 4; i++) {\nif (u_dataDrivenColor_validValues[i] == value) {\nindex = i;\nbreak;\n}\n}\nif (index == -1) {\nreturn u_dataDrivenColor_colorFallback;\n}\nreturn u_dataDrivenColor_color;\n}\n#endif\nvoid main() {\nvec2  a_pos = a_pos_packed / POS_PRECISION_FACTOR;\nvec2  a_offset = a_offset_packed / OFFSET_PRECISION_FACTOR;\nfloat a_size = a_size_packed / SIZE_PRECISION_FACTOR;\nvec4 color = vec4(1., 0., 0., 1.);\n#ifdef DATA_DRIVEN_COLOR\ncolor = getColor(1.);\n#endif\nvec2 offsetScaled = a_offset * a_size;\nvec4 pos = vec4(a_pos.xy + offsetScaled, 0., 1.);\ngl_Position = pos;\n#ifndef RETURN_RED\nv_color = color;\n#endif\nv_offset = a_offset;\n}"},tileInfo:{"tileInfo.frag":"uniform mediump sampler2D u_texture;\nvarying mediump vec2 v_tex;\nvoid main(void) {\nlowp vec4 color = texture2D(u_texture, v_tex);\ncolor.rgb *= color.a;\ngl_FragColor = color;\n}","tileInfo.vert":"attribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform mediump float u_depth;\nuniform mediump vec2 u_coord_ratio;\nuniform mediump vec2 u_delta;\nuniform mediump vec2 u_dimensions;\nvarying mediump vec2 v_tex;\nvoid main() {\nmediump vec2 offset = u_coord_ratio * vec2(u_delta + a_pos * u_dimensions);\nvec3 v_pos = u_dvsMat3 * vec3(offset, 1.0);\ngl_Position = vec4(v_pos.xy, 0.0, 1.0);\nv_tex = a_pos;\n}"},util:{"atan2.glsl":"float atan2(in float y, in float x) {\nfloat t0, t1, t2, t3, t4;\nt3 = abs(x);\nt1 = abs(y);\nt0 = max(t3, t1);\nt1 = min(t3, t1);\nt3 = 1.0 / t0;\nt3 = t1 * t3;\nt4 = t3 * t3;\nt0 =         - 0.013480470;\nt0 = t0 * t4 + 0.057477314;\nt0 = t0 * t4 - 0.121239071;\nt0 = t0 * t4 + 0.195635925;\nt0 = t0 * t4 - 0.332994597;\nt0 = t0 * t4 + 0.999995630;\nt3 = t0 * t3;\nt3 = (abs(y) > abs(x)) ? 1.570796327 - t3 : t3;\nt3 = x < 0.0 ?  3.141592654 - t3 : t3;\nt3 = y < 0.0 ? -t3 : t3;\nreturn t3;\n}","encoding.glsl":"const vec4 rgba2float_factors = vec4(\n255.0 / (256.0),\n255.0 / (256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n);\nfloat rgba2float(vec4 rgba) {\nreturn dot(rgba, rgba2float_factors);\n}"}},function(t){let e=r;return t.split("/").forEach((t=>{e&&(e=e[t])})),e}));var r;function s(t){return n.resolveIncludes(t)}},24964:function(t,e,i){function n(t,e){if(null!==e){t.push(e.length);for(const i of e)i.serialize(t);return t}t.push(0)}function r(t,e,i){const n=t.readInt32(),r=new Array(n);for(let n=0;n<r.length;n++)r[n]=e.deserialize(t,i);return r}i.d(e,{_:function(){return r},j:function(){return n}})},93259:function(t,e,i){i.r(e),i.d(e,{default:function(){return g}});var n=i(53804),r=i(59469),s=i(50659),o=i(78879),a=i(61226),l=i(95929),u=i(23502),c=(i(58941),i(40633),i(65953)),h=i(60021),d=i(17215),f=i(56625),p=i(89872),_=i(58251);let m=class extends((0,h.e)(_.A)){constructor(){super(...arguments),this._highlightCounter=new p.t}attach(){this.graphicsView=new f.A({requestUpdateCallback:()=>this.requestUpdate(),view:this.view,graphics:this.layer.graphics,container:new d.A(this.view.featuresTilingScheme),layerId:this.layer.id}),this.container.addChild(this.graphicsView.container),this.addAttachHandles([this.layer.on("graphic-update",this.graphicsView.graphicUpdateHandler),this.watch("layer.visible",(t=>{t&&(this.graphicsView.update({state:this.view.state}),this.graphicsView.pushUpdate())}))]),this._updateHighlights()}detach(){this.container.removeAllChildren(),this.graphicsView=(0,l.pR)(this.graphicsView)}async hitTest(t){return this.graphicsView?this.graphicsView.hitTest(t).map((e=>({type:"graphic",graphic:e,mapPoint:t,layer:this.layer}))):null}queryGraphics(){return Promise.resolve(this.graphicsView.graphics)}update(t){this.graphicsView.processUpdate(t)}viewChange(){this.graphicsView.viewChange()}moveEnd(){}isUpdating(){return!this.graphicsView||this.graphicsView.updating}highlight(t,e="default"){let i;"number"==typeof t?i=[t]:t instanceof r.default?i=[t.uid]:Array.isArray(t)&&t.length>0?i="number"==typeof t[0]?t:t.map((t=>t&&t.uid)):o.A.isCollection(t)&&t.length>0&&(i=t.map((t=>t&&t.uid)).toArray());const n=i?.filter(s.Ru);return n?.length?(this._addHighlight(n,e),(0,a.hA)((()=>this._removeHighlight(n,e)))):(0,a.hA)()}_addHighlight(t,e){this._highlightCounter.addGroup(t,e),this._updateHighlights()}_removeHighlight(t,e){this._highlightCounter.deleteGroup(t,e),this._updateHighlights()}_updateHighlights(){const t=[];for(const e of this._highlightCounter.ids()){const i=this._highlightCounter.getHighlightGroups(e),n=this._getHighlightBits(i);t.push({objectId:e,highlightFlags:n})}this.graphicsView?.setHighlight(t)}};(0,n._)([(0,u.MZ)()],m.prototype,"graphicsView",void 0),m=(0,n._)([(0,c.$)("esri.views.2d.layers.GraphicsLayerView2D")],m);const g=m},60021:function(t,e,i){i.d(e,{e:function(){return I}});var n,r=i(53804),s=i(78879),o=i(61500),a=i(39819),l=i(40633),u=i(28181),c=i(23502),h=(i(58941),i(13798),i(65953)),d=i(7965),f=i(30488),p=i(28712),_=i(70963),m=i(95952),g=i(94548);let y=n=class extends g.A{constructor(t){super(t),this.type="rect",this.left=null,this.right=null,this.top=null,this.bottom=null}clone(){return new n({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}commitVersionProperties(){this.commitProperty("left"),this.commitProperty("right"),this.commitProperty("top"),this.commitProperty("bottom")}};(0,r._)([(0,c.MZ)({type:[Number,String],json:{write:!0}})],y.prototype,"left",void 0),(0,r._)([(0,c.MZ)({type:[Number,String],json:{write:!0}})],y.prototype,"right",void 0),(0,r._)([(0,c.MZ)({type:[Number,String],json:{write:!0}})],y.prototype,"top",void 0),(0,r._)([(0,c.MZ)({type:[Number,String],json:{write:!0}})],y.prototype,"bottom",void 0),y=n=(0,r._)([(0,h.$)("esri.views.layers.support.ClipRect")],y);const v=y;var x=i(29627);let b=class extends g.A{constructor(t){super(t),this.type="path",this.path=[]}commitVersionProperties(){this.commitProperty("path")}};(0,r._)([(0,c.MZ)({type:[[[Number]]],json:{write:!0}})],b.prototype,"path",void 0),b=(0,r._)([(0,h.$)("esri.views.layers.support.Path")],b);const S=b;var w=i(39715);const T=s.A.ofType({key:"type",base:null,typeMap:{rect:v,path:S,geometry:x.A}}),P=new(s.A.ofType(p.W)),I=t=>{let e=class extends t{constructor(){super(...arguments),this.attached=!1,this.clips=new T,this.highlights=null,this.lastUpdateId=-1,this.moving=!1,this.updateRequested=!1,this._visibleAtCurrentScale=!0}initialize(){const t=this.view?.spatialReferenceLocked??!0,e=this.view?.spatialReference;e&&t&&!this.spatialReferenceSupported?this.addResolvingPromise(Promise.reject(new a.A("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new d.m),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.addHandles([(0,u.watch)((()=>this.suspended),(t=>{this.container&&(this.container.visible=!t)}),u.pc),(0,u.watch)((()=>this.updateSuspended),(t=>{this.view&&!t&&this.updateRequested&&this.view.requestUpdate()}),u.pc),(0,u.watch)((()=>this.layer?.opacity??1),(t=>{this.container&&(this.container.opacity=t)}),u.pc),(0,u.watch)((()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal"),(t=>{this.container&&(this.container.blendMode=t)}),u.pc),(0,u.watch)((()=>this.layer&&"effect"in this.layer?this.layer.effect:null),(t=>{this.container&&(this.container.effect=t)}),u.pc),(0,u.watch)((()=>this._mergedHighlights.items.map((t=>({name:t.name,options:{fillColor:t.options.color,haloColor:t.options.haloColor,fillOpacity:t.options.fillOpacity,haloOpacity:t.options.haloOpacity,haloWidth:t.options.haloWidth,haloBlur:t.options.haloBlur}})))),(()=>{this.container.highlightGradient=(0,f.u4)(this.container.highlightGradient,this._mergedHighlights.items)}),u.pc),(0,u.watch)((()=>this._mergedHighlights.items.map((t=>t.name))),(()=>{this._updateHighlights()})),(0,u.on)((()=>this.clips),"change",(()=>{this.container&&(this.container.clips=this.clips)}),u.pc),(0,u.watch)((()=>({scale:this.view?.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null})),(({scale:t,scaleRange:e})=>{const i=(0,w.E5)(e,t);i!==this._visibleAtCurrentScale&&(this._visibleAtCurrentScale=i)}),u.pc)],"constructor"),this.view?.whenLayerView?this.view.whenLayerView(this.layer).then((t=>{t===this&&this.processAttach()}),(()=>{})):this.when().then((()=>{this.processAttach()}),(()=>{})))}_updateHighlights(){}destroy(){this.processDetach(),this.updateRequested=!1}get highlightOptions(){return(0,_.ax)(this)}set highlightOptions(t){(0,_.ou)(this,t)}get _mergedHighlights(){if(!this.view)return P;if(!this.highlights)return this.view.highlights;const t=this.view.highlights.clone();for(const e of this.highlights){const i=t.find((t=>t.name===e.name));i&&(i.options=e.options)}return t}get scheduler(){return this.view.scheduler}get spatialReferenceSupported(){const t=this.view?.spatialReference;return null==t||this.supportsSpatialReference(t)}get updating(){return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!!this._updatingHandles?.updating||this.container.transitioning)}get visibleAtCurrentScale(){return this._visibleAtCurrentScale}processAttach(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())}processDetach(){this.attached&&(this.attached=!1,this.removeHandles("attach"),this.detach(),this.updateRequested=!1)}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.updateSuspended||this.view.requestUpdate())}processUpdate(t){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",t),this.updateRequested&&!this.updateSuspended&&(this.updateRequested=!1,this.update(t))):this.updateRequested=!1}hitTest(t,e){return Promise.resolve(null)}supportsSpatialReference(t){return!0}canResume(){if(!this.spatialReferenceSupported)return!1;switch(this.layer?.type){case"link-chart":case"knowledge-graph-sublayer":break;default:if(null!=(t=this.view)&&"object"==typeof t&&"2d"===t.type&&"linkchart"===t.view2dType&&!this.view.inGeographicLayout)return!1}var t;return!!super.canResume()&&this.visibleAtCurrentScale}getSuspendInfo(){const t=super.getSuspendInfo(),e=!this.spatialReferenceSupported;return e&&(t.spatialReferenceNotSupported=e),t}addAttachHandles(t){this.addHandles(t,"attach")}_getHighlightBits(t){t=new Set(t);let e=1,i=0;if(!this.view)return 0;const n=this._mergedHighlights;for(const{name:r}of n)t.delete(r)&&(i=e),e<<=1;for(const e of t)l.A.getLogger(this).error("#highlights",`${e} was not found. Features in this group will not be highlighted.`);return i}};return(0,r._)([(0,c.MZ)()],e.prototype,"attached",void 0),(0,r._)([(0,c.MZ)({type:T,set(t){const e=(0,o.V)(t,this._get("clips"),T);this._set("clips",e)}})],e.prototype,"clips",void 0),(0,r._)([(0,c.MZ)()],e.prototype,"container",void 0),(0,r._)([(0,c.MZ)({type:m.A})],e.prototype,"highlightOptions",null),(0,r._)([(0,c.MZ)({type:s.A.ofType(p.W)})],e.prototype,"highlights",void 0),(0,r._)([(0,c.MZ)()],e.prototype,"_mergedHighlights",null),(0,r._)([(0,c.MZ)()],e.prototype,"moving",void 0),(0,r._)([(0,c.MZ)({readOnly:!0})],e.prototype,"spatialReferenceSupported",null),(0,r._)([(0,c.MZ)({readOnly:!0})],e.prototype,"updateParameters",void 0),(0,r._)([(0,c.MZ)()],e.prototype,"updateRequested",void 0),(0,r._)([(0,c.MZ)()],e.prototype,"updating",null),(0,r._)([(0,c.MZ)()],e.prototype,"view",void 0),(0,r._)([(0,c.MZ)()],e.prototype,"_visibleAtCurrentScale",void 0),(0,r._)([(0,c.MZ)({readOnly:!0})],e.prototype,"visibleAtCurrentScale",null),e=(0,r._)([(0,h.$)("esri.views.2d.layers.LayerView2D")],e),e}},6578:function(t,e,i){i.d(e,{Z:function(){return n}});class n{getObjectId(t){return t.getObjectId()}getAttributes(t){return t.readAttributes()}getAttribute(t,e){return t.readAttribute(e)}getAttributeAsTimestamp(t,e){return t.readAttributeAsTimestamp(e)}cloneWithGeometry(t,e){return t}getGeometry(t){return t.readGeometryWorldSpace()}getCentroid(t,e){return t.readCentroidForDisplay()}}n.Shared=new n},29739:function(t,e,i){i.d(e,{Jz:function(){return c},T9:function(){return a}});var n=i(50659),r=i(28230),s=i(51008),o=i(2746);function a(t,e){return{type:"simple",filters:e,capabilities:{maxTextureSize:(0,o.C)().maxTextureSize},bindings:u(t)}}function l(t){switch(t){case"opacity":return r.Gn.OPACITY;case"color":return r.Gn.COLOR;case"rotation":return r.Gn.ROTATION;case"size":return r.Gn.SIZE;default:return null}}function u(t){if(!t)return[];switch(t.type){case"simple":case"class-breaks":case"unique-value":case"dictionary":return c(t);case"dot-density":return function(t){const e=[];for(const i of t.attributes)e.push({binding:e.length,expression:i.valueExpression,field:i.field});return e}(t);case"pie-chart":return function(t){const e=c(t);let i=4;for(const n of t.attributes)e.push({binding:i++,expression:n.valueExpression,field:n.field});return e}(t);case"heatmap":return function({valueExpression:t,field:e}){return t||e?[{binding:0,expression:t,field:e}]:[]}(t)}}function c(t){return"visualVariables"in t&&t.visualVariables?.length?(0,s.R)(t.visualVariables).map((t=>function(t){switch(t.type){case"size":return function(t){return"$view.scale"===t.valueExpression?null:{binding:l(t.type),field:t.field,normalizationField:t.normalizationField,expression:t.valueExpression,valueRepresentation:t.valueRepresentation}}(t);case"color":case"opacity":return function(t){return{binding:l(t.type),field:t.field,normalizationField:t.normalizationField,expression:t.valueExpression}}(t);case"rotation":return function(t){return{binding:l(t.type),expression:t.valueExpression,field:t.field}}(t)}}(t))).filter(n.Ru):[]}},44327:function(t,e,i){i.d(e,{Dk:function(){return x},K4:function(){return S},j0:function(){return b}}),i(58941);var n=i(13520),r=i(62938),s=i(85031),o=i(39686),a=i(40846),l=i(29397),u=i(51008);const c=1.25,h=128,d=128;function f(t){if(!t.stops?.length)return null;const e=t.stops.sort(((t,e)=>t.value-e.value)),i=(0,l.r)(e,8),n=i.map((({value:t})=>t)),r=i.map((({color:t})=>(0,l.p)(t)));return{values:n,colors:r}}function p(t){if(!t.stops?.length)return null;const e=t.stops.sort(((t,e)=>t.value-e.value)),i=(0,l.r)(e,8);return{opacityValues:i.map((({value:t})=>t)),opacities:i.map((({opacity:t})=>t))}}function _(t){return{rotationType:"geographic"===t.rotationType?a.H_.Geographic:a.H_.Arithmatic}}function m(t){if(!t.stops?.length)return null;if(t.stops.some((t=>t.useMaxValue||t.useMinValue)))return(e,i)=>{const r=e.statisticsByLevel.get(i.key.level),s=t.stops.map((e=>({value:e.useMaxValue?r?.get(t.field)?.maxValue??0:e.useMinValue?r?.get(t.field)?.minValue??0:e.value,size:e.size?(0,n.Lz)(e.size):o.qM}))).sort(((t,e)=>t.value-e.value)),a=(0,l.r)(s,8);return{values:a.map((({value:t})=>t)),sizes:a.map((({size:t})=>t))}};const e=t.stops.sort(((t,e)=>t.value-e.value)),i=(0,l.r)(e,8);return{values:i.map((({value:t})=>t)),sizes:i.map((({size:t})=>(0,n.Lz)(t)))}}function g(t){return e=>{const{state:i}=e;return{unitValueToPixelsRatio:(0,r.GA)(i.spatialReference)/s.j[t.valueUnit??"meters"]/i.resolution}}}function y(t,e){const i=e.length;if(t<e[0].value||1===i)return e[0].size;for(let n=1;n<i;n++)if(t<e[n].value){const i=(t-e[n-1].value)/(e[n].value-e[n-1].value);return e[n-1].size+i*(e[n].size-e[n-1].size)}return e[i-1].size}function v(t){const{minDataValue:e,maxDataValue:i,minSize:r,maxSize:s}=t;if("object"==typeof r&&"object"==typeof s)return(t,o)=>{const a=t.state.scale,l=(0,n.Lz)(y(a,r.stops)),u=(0,n.Lz)(y(a,s.stops));return{minMaxValueAndSize:[e,i,l,u]}};if("object"==typeof r||"object"==typeof s)throw new Error("InternalError: Found a partial VisualVariableSizeMinMaxValue");return{minMaxValueAndSize:[e,i,(0,n.Lz)(r),(0,n.Lz)(s)]}}const x={visualVariableColor:null,visualVariableOpacity:null,visualVariableRotation:null,visualVariableSizeStops:null,visualVariableSizeScaleStops:null,visualVariableSizeOutlineScaleStops:null,visualVariableSizeUnitValue:null,visualVariableSizeMinMaxValue:null};function b(t,e=d,i=c){if(t.visualVariableSizeMinMaxValue)return t.visualVariableSizeMinMaxValue instanceof Function?h:Math.max(t.visualVariableSizeMinMaxValue.minMaxValueAndSize[3]*i,e);if(t.visualVariableSizeScaleStops){if(t.visualVariableSizeScaleStops instanceof Function)return h;const n=t.visualVariableSizeScaleStops.sizes;return Math.max(n[n.length-1]*i,e)}if(t.visualVariableSizeStops){if(t.visualVariableSizeStops instanceof Function)return h;const n=t.visualVariableSizeStops.sizes;return Math.max(n[n.length-1]*i,e)}return t.visualVariableSizeUnitValue?2*h:0}function S(t){const e={...x};if(!t||!("visualVariables"in t)||!t.visualVariables)return e;for(const i of(0,u.R)(t.visualVariables))switch(i.type){case"color":e.visualVariableColor=f(i);break;case"opacity":e.visualVariableOpacity=p(i);break;case"rotation":e.visualVariableRotation=_(i);break;case"size":switch(w(i)){case"field-stops":e.visualVariableSizeStops=m(i);break;case"scale-stops":"outline"===i.target?e.visualVariableSizeOutlineScaleStops=m(i):e.visualVariableSizeScaleStops=m(i);break;case"min-max":e.visualVariableSizeMinMaxValue=v(i);break;case"unit-value":e.visualVariableSizeUnitValue=g(i)}}return e}function w(t){return"number"==typeof t.minDataValue&&"number"==typeof t.maxDataValue&&null!=t.minSize&&null!=t.maxSize?"min-max":"$view.scale"===t?.valueExpression&&Array.isArray(t.stops)?"scale-stops":null==t.field&&"$view.scale"===t?.valueExpression||!(Array.isArray(t.stops)||"levels"in t&&t.levels)?null!=t.field||"$view.scale"!==t?.valueExpression?"unit-value":null:"field-stops"}},29397:function(t,e,i){function n(t,e){const i=t.slice(0,e),n=e-i.length;for(let t=0;t<n;t++){const t=i[i.length-1];i.push(t)}return i}function r(t){if(!t)return[0,0,0,0];const{r:e,g:i,b:n,a:r}=t;return[e*(r/255),i*(r/255),n*(r/255),r]}i.d(e,{p:function(){return r},r:function(){return n}})},81672:function(t,e,i){i.d(e,{EM:function(){return b},Gn:function(){return _},IQ:function(){return w},Jk:function(){return h},NZ:function(){return x},TY:function(){return u},Zi:function(){return p},gF:function(){return f},oF:function(){return g}});var n=i(57176),r=i(38821),s=i(33389),o=i(63812),a=i(44327),l=i(80958);function u(t){return t.minScale||t.maxScale?{minScale:t.minScale??0,maxScale:t.maxScale??0}:null}function c(t){if(null==t)return null;if(Array.isArray(t)){const[e,i,n,r]=t;return[e,i,n,255*r]}return"string"==typeof t?t:{...t,defaultValue:c(t?.defaultValue)}}async function h(t,e){const{cimResourceManager:i,cimAnalyzer:r,scaleExpression:s}=e.schemaOptions;await Promise.all(n.wp.fetchResources(t.symbol,i,[]));const o=r.analyzeSymbolReference(t,!1),a={scaleInfo:u(t),scaleExpression:s},l=[];for(const t of o)switch(t.type){case"marker":l.push(...d(t,e,a));break;case"fill":l.push(...m(t,e,a));break;case"line":l.push(...y(t,e,a));break;case"text":l.push(...S(t,e,a))}return l}function d(t,e,i){const{uniforms:n,schemaOptions:r}=e,{store:s}=r,l=t.isOutline?{...a.Dk,visualVariableSizeScaleStops:n.visualVariableSizeOutlineScaleStops}:{visualVariableColor:n.visualVariableColor,visualVariableOpacity:n.visualVariableOpacity,visualVariableSizeMinMaxValue:n.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:n.visualVariableSizeScaleStops,visualVariableSizeStops:n.visualVariableSizeStops,visualVariableSizeUnitValue:n.visualVariableSizeUnitValue,visualVariableRotation:n.visualVariableRotation};return t.animationParams?f(s.ensureInstance(o.YS.animatedMarker,{uniforms:l,optionalAttributes:{zoomRange:!0}}),t,a.Dk,i):p(s.ensureInstance(o.YS.marker,{uniforms:l,optionalAttributes:{zoomRange:!!i.scaleInfo}}),t,n,i)}function f(t,e,i,n){return e.animationParams?[t.createMeshInfo({pixelDimensions:e.pixelDimensions,texelDimensions:e.texelDimensions,effects:e.effects?{type:"cim-effect-infos",effectInfos:e.effects}:null,sprite:e.spriteRasterizationParam,animations:e.animationParams,scaleInfo:n.scaleInfo,scaleSymbolsProportionally:e.scaleSymbolsProportionally,strokeWidth:e.outlineWidth,isMapAligned:e.alignment===s.C1.MAP,colorLocked:e.colorLocked,isStroke:e.isStroke,baseSize:e.baseSize,referenceSize:e.referenceSize,angleToLine:!!e.markerPlacement&&e.markerPlacement.placement&&"angleToLine"in e.markerPlacement.placement&&e.markerPlacement.placement.angleToLine,sizeRatio:e.sizeRatio})]:[]}function p(t,e,i,{scaleInfo:n,scaleExpression:s}){const o=(0,l.I)(i);return[t.createMeshInfo({size:e.size,scaleX:e.scaleX,anchorX:e.anchorPoint.x,anchorY:e.anchorPoint.y,angle:e.rotation,color:c(e.color)??[0,0,0,0],colorLocked:e.colorLocked,frameHeight:e.frameHeight,widthRatio:e.widthRatio,scaleInfo:n,offsetX:e.offsetX,offsetY:e.offsetY,outlineColor:c(e.outlineColor)??[0,0,0,0],outlineSize:e.outlineWidth,referenceSize:e.referenceSize||r.D.CIMVectorMarker.size,rotateClockwise:e.rotateClockwise,scaleFactor:s??1,sizeRatio:e.sizeRatio,alignment:e.alignment,isAbsoluteAnchorPoint:e.isAbsoluteAnchorPoint,scaleSymbolsProportionally:e.scaleSymbolsProportionally,sprite:e.spriteRasterizationParam,hasSizeVV:o,placement:e.markerPlacement,effects:e.effects?{type:"cim-effect-infos",effectInfos:e.effects}:null,transforms:e.transform,minPixelBuffer:(0,a.j0)(i)})]}function _(t,e,{scaleInfo:i}){return[t.createMeshInfo({color:c(e.color)??[0,0,0,0],scaleInfo:i,effects:e.effects?{type:"cim-effect-infos",effectInfos:e.effects}:null})]}function m(t,e,i){if(!t.spriteRasterizationParam)return function(t,e,i){const{uniforms:n,schemaOptions:r}=e,{store:s}=r;return _(s.ensureInstance(o.YS.fill,{uniforms:{visualVariableColor:t.colorLocked?null:n.visualVariableColor,visualVariableOpacity:n.visualVariableOpacity},optionalAttributes:{zoomRange:!!i.scaleInfo}}),t,i)}(t,e,i);const{uniforms:n,schemaOptions:r}=e,{store:s}=r;return g(s.ensureInstance(o.YS.complexFill,{uniforms:{visualVariableColor:t.colorLocked?null:n.visualVariableColor,visualVariableOpacity:n.visualVariableOpacity},optionalAttributes:{zoomRange:!!i.scaleInfo}}),t,null!=n.visualVariableColor,i)}function g(t,e,i,{scaleInfo:n}){if(!e.spriteRasterizationParam)throw new Error("InternalError: Sprite should always be defined");const r=!!e.hasUnresolvedReplacementColor&&(!i||e.colorLocked),s=e.sampleAlphaOnly&&!r,o=e.spriteRasterizationParam;return[t.createMeshInfo({color:c(e.color)??[0,0,0,0],height:e.height,aspectRatio:e.scaleX,offsetX:e.offsetX,offsetY:e.offsetY,scaleX:1,scaleY:1,angle:e.angle,applyRandomOffset:e.applyRandomOffset,sampleAlphaOnly:s,scaleProportionally:"CIMHatchFill"===o.resource.type,sprite:o,scaleInfo:n,effects:e.effects?{type:"cim-effect-infos",effectInfos:e.effects}:null})]}function y(t,e,i){const{uniforms:n,schemaOptions:r}=e,{store:s}=r,l=t.isOutline?{...a.Dk,visualVariableSizeScaleStops:n.visualVariableSizeOutlineScaleStops}:{visualVariableColor:t.colorLocked?null:n.visualVariableColor,visualVariableOpacity:n.visualVariableOpacity,visualVariableSizeMinMaxValue:n.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:n.visualVariableSizeScaleStops,visualVariableSizeStops:n.visualVariableSizeStops,visualVariableSizeUnitValue:n.visualVariableSizeUnitValue},u={uniforms:l,optionalAttributes:{zoomRange:!!i.scaleInfo}},c=!!(l.visualVariableSizeMinMaxValue||l.visualVariableSizeScaleStops||l.visualVariableSizeStops||l.visualVariableSizeUnitValue);return t.spriteRasterizationParam?b(s.ensureInstance(o.YS.texturedLine,u),t,c,i):x(s.ensureInstance(o.YS.line,u),t,c,i)}function v(t,e,{scaleInfo:i}){return{color:c(t.color)??[0,0,0,0],width:t.width,referenceWidth:t.referenceWidth,capType:t.cap,joinType:t.join,miterLimit:t.miterLimit,scaleInfo:i,hasSizeVV:e,effects:t.effects?{type:"cim-effect-infos",effectInfos:t.effects}:null}}function x(t,e,i,n){if(e.spriteRasterizationParam)throw new Error("InternalError: Sprite should not be defined");const r=v(e,i,n);return[t.createMeshInfo(r)]}function b(t,e,i,n){const{spriteRasterizationParam:r,scaleDash:s,sampleAlphaOnly:o}=e;if(!r)throw new Error("InternalError: Sprite should be defined");return[t.createMeshInfo({...v(e,i,n),offsetAlongLine:e.offsetAlongLine??0,shouldScaleDash:s??!1,shouldSampleAlphaOnly:o,isSDF:"CIMPictureStroke"!==r.resource.type,sprite:r})]}function S(t,e,i){const{uniforms:n,schemaOptions:r}=e,{store:s}=r;return w(s.ensureInstance(o.YS.text,{uniforms:{visualVariableColor:t.colorLocked?null:n.visualVariableColor,visualVariableOpacity:n.visualVariableOpacity,visualVariableRotation:n.visualVariableRotation,visualVariableSizeMinMaxValue:n.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:n.visualVariableSizeScaleStops,visualVariableSizeStops:n.visualVariableSizeStops,visualVariableSizeUnitValue:n.visualVariableSizeUnitValue},optionalAttributes:{zoomRange:!!i.scaleInfo,referenceSymbol:!1,clipAngle:!1}}),t,n,i)}function w(t,e,i,{scaleInfo:n,scaleExpression:r}){return[t.createMeshInfo({boxBackgroundColor:c(e.backgroundColor),boxBorderLineColor:c(e.borderLineColor),boxBorderLineSize:e.borderLineWidth??0,color:c(e.color)??[0,0,0,0],offsetX:e.offsetX,offsetY:e.offsetY,postAngle:e.angle,fontSize:e.size,referenceSize:e.referenceSize,decoration:e.decoration,haloColor:c(e.haloColor)??[0,0,0,0],haloSize:e.haloSize??0,outlineColor:c(e.outlineColor)??[0,0,0,0],outlineSize:e.outlineSize,lineWidth:e.lineWidth||512,lineHeightRatio:1,horizontalAlignment:e.horizontalAlignment??"center",verticalAlignment:e.verticalAlignment??"baseline",useCIMAngleBehavior:!1,glyphs:e.textRasterizationParam,scaleInfo:n,effects:e.effects?{type:"cim-effect-infos",effectInfos:e.effects}:null,placement:e.markerPlacement,transforms:e.transform,scaleFactor:r??1,minPixelBuffer:(0,a.j0)(i),repeatLabel:null,repeatLabelDistance:null,allowOverrun:null,labelPosition:null})]}},80958:function(t,e,i){function n(t){return!!(t.visualVariableSizeMinMaxValue||t.visualVariableSizeScaleStops||t.visualVariableSizeStops||t.visualVariableSizeUnitValue||t.visualVariableSizeOutlineScaleStops)}function r(t){return!!t.visualVariableRotation}i.d(e,{I:function(){return n},N:function(){return r}})},7910:function(t,e,i){i.d(e,{L:function(){return n}});class n{destroy(){}}},12564:function(t,e,i){i.d(e,{K:function(){return v}});var n=i(39819),r=i(58941),s=i(40633),o=i(72952),a=i(39686),l=i(7459),u=i(88413),c=i(40846);class h{constructor(t){this.data=t,this._referenceCount=0}increment(){this._referenceCount+=1}decrement(){this._referenceCount-=1}empty(){return 0===this._referenceCount}}class d{constructor(){this._freeIdsGenerationA=[],this._freeIdsGenerationB=[],this._idCounter=1,this._freeIds=this._freeIdsGenerationA,this._objectIdToDisplayId=new Map}createIdForObjectId(t){let e=this._objectIdToDisplayId.get(t);return e?e.increment():(e=new h((0,l.Ss)(this._getFreeId(),!1)),e.increment(),this._objectIdToDisplayId.set(t,e)),e.data}releaseIdForObjectId(t){const e=this._objectIdToDisplayId.get(t);e&&(e.decrement(),e.empty()&&(this._objectIdToDisplayId.delete(t),this._freeIds.push(e.data)))}getDisplayIdForObjectId(t){const e=this._objectIdToDisplayId.get(t);return null!=e?e.data:null}releaseAll(){for(const t of this._objectIdToDisplayId.values())this._freeIds.push(t.data);this._objectIdToDisplayId.clear()}incrementGeneration(){this._freeIds=this._freeIds===this._freeIdsGenerationA?this._freeIdsGenerationB:this._freeIdsGenerationA}_getFreeId(){return this._freeIds.length?this._freeIds.pop():this._idCounter++}}var f=i(70132),p=i(85456);const _=()=>s.A.getLogger("esri.views.layers.2d.features.support.AttributeStore"),m=(_(),()=>null),g=(0,r.A)("esri-shared-array-buffer");(0,r.A)("esri-atomics");class y{constructor(t,e,i){this.size=0,this.texelSize=4,this.dirtyStart=0,this.dirtyEnd=0;const{pixelType:n,layout:r,textureOnly:s}=e;this.textureOnly=s||!1,this.pixelType=n,this.layout=r,this._resetRange(),this.size=t,this.isLocal=i,s||(this.data=this._initData(n,t))}get buffer(){return this.data?.buffer}unsetComponentAllTexels(t,e){const i=this.data;for(let n=0;n<this.size*this.size;n++)i[n*this.texelSize+t]&=~e;this.dirtyStart=0,this.dirtyEnd=this.size*this.size-1}setComponentAllTexels(t,e){const i=this.data;for(let n=0;n<this.size*this.size;n++)i[n*this.texelSize+t]|=255&e;this.dirtyStart=0,this.dirtyEnd=this.size*this.size-1}setComponent(t,e,i){const n=this.data;for(const r of i)n[r*this.texelSize+t]|=e,this.dirtyStart=Math.min(this.dirtyStart,r),this.dirtyEnd=Math.max(this.dirtyEnd,r)}setComponentTexel(t,e,i){this.data[i*this.texelSize+t]|=e,this.dirtyStart=Math.min(this.dirtyStart,i),this.dirtyEnd=Math.max(this.dirtyEnd,i)}unsetComponentTexel(t,e,i){this.data[i*this.texelSize+t]&=~e,this.dirtyStart=Math.min(this.dirtyStart,i),this.dirtyEnd=Math.max(this.dirtyEnd,i)}getData(t,e){const i=(0,l.Q4)(t);return this.data[i*this.texelSize+e]}setData(t,e,i){const n=(0,l.Q4)(t),r=1<<e;this.layout&r?null!=this.data&&(this.data[n*this.texelSize+e]=i,this.dirtyStart=Math.min(this.dirtyStart,n),this.dirtyEnd=Math.max(this.dirtyEnd,n)):_().error("mapview-attributes-store","Tried to set a value for a texel's readonly component")}expand(t){if(this.size=t,!this.textureOnly){const e=this._initData(this.pixelType,t),i=this.data;e.set(i),this.data=e}}toMessage(){const t=this.dirtyStart,e=this.dirtyEnd,i=this.texelSize;if(t>e)return null;this._resetRange();const n=!this.isLocal,r=this.pixelType,s=this.layout,o=this.data;return{start:t,end:e,data:n&&o.slice(t*i,(e+1)*i)||null,pixelType:r,layout:s}}_initData(t,e){const i=ArrayBuffer,n=(0,u.Qz)(t),r=new n(new i(e*e*4*n.BYTES_PER_ELEMENT));for(let t=0;t<r.length;t+=4)r[t+1]=255;return r}_resetRange(){this.dirtyStart=2147483647,this.dirtyEnd=0}}class v{constructor(t){this._client=t,this._filters=[],this._blocks=new Array,this._attributeComputeInfo=null,this._abortController=new AbortController,this._size=a.TB,this._idsToHighlight=new Map,this._referencesScale=!1,this._referencesGeometry=!1,this._initialized=!1,this.version=0,this._idGenerator=new d,this._epoch=1}destroy(){this._abortController.abort()}_initialize(){if(null!=this._blockDescriptors)return;const t=p.ld.FLOAT;m(`Creating AttributeStore ${g?"with":"without"} shared memory`),this._blockDescriptors=[{pixelType:p.ld.UNSIGNED_BYTE,layout:1},{pixelType:p.ld.UNSIGNED_BYTE,layout:15,textureOnly:!0},{pixelType:p.ld.UNSIGNED_BYTE,layout:15,textureOnly:!0},{pixelType:t,layout:15},{pixelType:t,layout:15},{pixelType:t,layout:15},{pixelType:t,layout:15},{pixelType:p.ld.FLOAT,layout:15}],this._blocks=this._blockDescriptors.map((()=>null))}get referencesScale(){return this._referencesScale}get referencesGeometry(){return this._referencesGeometry}get hasHighlight(){return this._idsToHighlight.size>0}createDisplayIdForObjectId(t){return this._idGenerator.createIdForObjectId(t)}releaseDisplayIdForObjectId(t){return this._idGenerator.releaseIdForObjectId(t)}getDisplayIdForObjectId(t){return this._idGenerator.getDisplayIdForObjectId(t)}incrementDisplayIdGeneration(){this._idGenerator.incrementGeneration()}releaseAllIds(){this._idGenerator.releaseAll()}async update(t,e,i,n,s=0){const a=(0,o.Ui)(this._schema,t);if(this.version=s,a&&((0,r.A)("esri-2d-update-debug")&&console.debug(`Version[${s}] AttributeStore.update`,{changed:a}),this._schema=t,this._attributeComputeInfo=null,this._initialize(),null!=t))if(i&&(this._filters=await Promise.all(t.filters.map((t=>t?f.A.create({geometryType:i.geometryType,hasM:!1,hasZ:!1,timeInfo:i.timeInfo,fieldsIndex:i.fieldsIndex,spatialReference:n??i.spatialReference,filterJSON:t}):null)))),"subtype"!==t.type)this._attributeComputeInfo={isSubtype:!1,map:new Map},await Promise.all(t.bindings.map((async t=>{const i=await this._bind(e,t);this._referencesGeometry=this._referencesGeometry||(i?.referencesGeometry()??!1),this._referencesScale=this._referencesScale||(i?.referencesScale()??!1)})));else{this._attributeComputeInfo={isSubtype:!0,subtypeField:t.subtypeField,map:new Map},this._referencesScale=!1,this._referencesGeometry=!1;for(const i in t.bindings){const n=t.bindings[i];await Promise.all(n.map((async t=>{const n=await this._bind(e,t,parseInt(i,10));this._referencesGeometry=this._referencesGeometry||(n?.referencesGeometry()??!1),this._referencesScale=this._referencesScale||(n?.referencesScale()??!1)})))}}}setHighlight(t,e){const i=this._getBlock(0);i.unsetComponentAllTexels(0,(1<<a.U5)-1);for(const{displayId:e,highlightFlags:n}of t){if(null==e)continue;const t=(0,l.Q4)(e);i.setComponent(0,n,[t])}this._idsToHighlight.clear();for(const{objectId:e,highlightFlags:i}of t)this._idsToHighlight.set(e,i);for(const{objectId:t,highlightFlags:i}of e)this._idsToHighlight.set(t,i)}setData(t,e,i,n){const r=(0,l.Q4)(t);this._ensureSizeForTexel(r),this._getBlock(e).setData(t,i,n)}getData(t,e,i){return this._getBlock(e).getData(t,i)}getHighlightFlags(t){return this._idsToHighlight.get(t)||0}unsetAttributeData(t){const e=(0,l.Q4)(t);this._getBlock(0).setData(e,0,0)}setAttributeData(t,e,i){const n=(0,l.Q4)(t);this._ensureSizeForTexel(n),this._getBlock(0).setData(n,0,this.getFilterFlags(e));const r=this._attributeComputeInfo;let s=null;r&&(s=r.isSubtype?r.map.get(e.readAttribute(r.subtypeField)):r.map,s?.size&&s.forEach(((t,r)=>{const s=1*r%4,o=Math.floor(1*r/4),l=this._getBlock(o+a.dV.VV);let u=t.field?.read(e,i);t.valueRepresentation&&(u=function(t,e){if(!t||!e)return t;switch(e){case"radius":case"distance":return 2*t;case"diameter":case"width":return t;case"area":return Math.sqrt(t)}return t}(u,t.valueRepresentation)),(null===u||isNaN(u)||u===1/0||u===-1/0)&&(u=c.qM),l.setData(n,s,u)})))}get epoch(){return this._epoch}sendUpdates(){const t=this._blocks.map((t=>null!=t?t.toMessage():null)),e=this._getInitArgs();(0,r.A)("esri-2d-log-updating")&&console.log("AttributeStore: _doSendUpdate.start"),this._client.update({initArgs:e,blockData:t,version:this.version,sendUpdateEpoch:this._epoch}),this._epoch+=1,(0,r.A)("esri-2d-log-updating")&&console.log("AttributeStore: _doSendUpdate.end")}_ensureSizeForTexel(t){for(;t>=this._size*this._size;)if(this._expand())return}async _bind(t,e,i){const n=await t.createComputedField(e),{valueRepresentation:r}=e,s=this._attributeComputeInfo;if(s.isSubtype){const t=s.map.get(i)??new Map;t.set(e.binding,{field:n,valueRepresentation:r}),s.map.set(i,t)}else s.map.set(e.binding,{field:n,valueRepresentation:r});return n}_getInitArgs(){return this._initialized?null:(this._initialized=!0,this._getBlock(a.dV.Animation),this._getBlock(a.dV.GPGPU),this._getBlock(a.dV.LocalTimeOrigin),{blockSize:this._size,blockDescriptors:this._blocks.map((t=>null!=t?{textureOnly:t.textureOnly,buffer:t.buffer,pixelType:t.pixelType}:null))})}_getBlock(t){const e=this._blocks[t];if(null!=e)return e;m(`Initializing AttributeBlock at index ${t}`);const i=new y(this._size,this._blockDescriptors[t],this._client.isLocal);return this._blocks[t]=i,this._initialized=!1,i}_expand(){if(this._size<this._schema.capabilities.maxTextureSize){const t=this._size<<=1;m("Expanding block size to",t,this._blocks);for(const e of this._blocks)e?.expand(t);return this._initialized=!1,this._size=t,0}return _().error(new n.A("mapview-limitations","Maximum number of onscreen features exceeded.")),-1}isVisible(t){return!!(this._getBlock(0).getData(t,0)&1<<a.U5)}getFilterFlags(t){let e=0;for(let i=0;i<this._filters.length;i++){const n=!!(1<<i),r=this._filters[i];e|=(!n||null==r||r.check(t)?1:0)<<i}let i=0;if(this._idsToHighlight.size){const e=t.getObjectId();i=this.getHighlightFlags(e)}return e<<a.U5|i}}},67057:function(t,e,i){i.d(e,{l:function(){return P}});var n=i(39819),r=i(40633),s=i(24761),o=i(7459),a=i(7910);class l extends a.L{constructor(t){super(),this._field=t}resize(t){throw new Error("Method not implemented.")}read(t,e){return t.readAttribute(this._field)}readWithDefault(t,e){return t.readAttribute(this._field)}referencesScale(){return!1}referencesGeometry(){return!1}}var u=i(50944),c=i(54547),h=i(89838);class d extends a.L{static async create(t,e){const i=await(0,c.Ad)(t,e.spatialReference,e.fields),n=(0,u.Wm)(t);return new d(i,n)}constructor(t,e){super(),this._compiled=t,this._cacheKey=e}resize(t){}read(t,e){return this.referencesScale()||"system"!==e.$view.timeZone?(0,h.V4)(this._compiled,t,e):this._readCached(t,e)}readWithDefault(t,e,i){return this.referencesScale()||"system"!==e.$view.timeZone?(0,h.OP)(this._compiled,t,e,i):this._readWithDefaultCached(t,e,i)}referencesScale(){return this._compiled?.referencesScale()??!1}referencesGeometry(){return this._compiled?.referencesGeometry()??!1}_readCached(t,e){if(t.setCache(this._cacheKey),t.hasCachedValue())return t.getCachedValue();const i=(0,h.V4)(this._compiled,t,e);return t.setCachedValue(i),i}_readWithDefaultCached(t,e,i){if(t.setCache(this._cacheKey),t.hasCachedValue())return t.getCachedValue();const n=(0,h.OP)(this._compiled,t,e,i);return t.setCachedValue(n),n}}var f=i(8289),p=i(2900),_=i(16645),m=i(53743),g=i(6361);class y extends a.L{static async create(t,e){const i=(0,g.lc)(t);return new y((t=>i.replaceAll(/{[^}]*}/g,(e=>{const i=e.slice(1,-1),n=t.metadata.fieldsIndex.get(i);if(null==n)return e;const r=t.readAttribute(i);return null==r?"":function(t,e){if(null==t)return"";const i=e.domain;if(i)if("codedValue"===i.type||"coded-value"===i.type){const e=t;for(const t of i.codedValues)if(t.code===e)return t.name}else if("range"===i.type){const{max:n,min:r}=(0,_.A5)(e),s=+t;if(null!=r&&null!=n&&r<=s&&s<=n)return i.name}let n=t;return(0,m.vE)(e)?n=(0,f.Yq)(n,(0,f.J2)("short-date")):(0,m.WA)(e)&&(n=(0,p.ZV)(+n)),n||""}(r,n)}))))}constructor(t){super(),this._evaluator=t}resize(t){}read(t,e){return this._evaluator(t)}readWithDefault(t,e,i){const n=this._evaluator(t);return(0,h.rZ)(n)?i:n}referencesScale(){return!1}referencesGeometry(){return!1}}class v extends a.L{constructor(t,e){super(),this._field=t,this._normalizationInfo=e}resize(t){throw new Error("Method not implemented.")}read(t,e){return this._readNormalized(t)}readWithDefault(t,e){return this._readNormalized(t)}referencesScale(){return!1}referencesGeometry(){return!1}_readNormalized(t){const e=t.readAttribute(this._field);if(null==e)return null;const{normalizationField:i,normalizationTotal:n,normalizationType:r}=this._normalizationInfo,s=t.readAttribute(i);switch(r??"esriNormalizeByField"){case"esriNormalizeByField":return s?s?e/s:void 0:null;case"esriNormalizeByLog":return Math.log(e)*Math.LOG10E;case"esriNormalizeByPercentOfTotal":return n?e/n*100:null}}}var x=i(45273),b=i(19886);const S=()=>r.A.getLogger("esri.views.2d.layers.features.support.ComputedAttributeStorage"),w=4294967295;function T(t,e,i){if(!(t.length>e))for(;t.length<=e;)t.push(i)}class P{constructor(t){this._numerics=[],this._strings=[],this._allocatedSize=256,this._bitsets=[],this._instanceIds=[],this._bounds=[],this._dirtyBitset=this.getBitset(this.createBitset()),this.compilationOptions=t}createBitset(){const t=this._bitsets.length;return this._bitsets.push(x.y.create(this._allocatedSize,o.KQ)),t+1}async createComputedField(t,e=!1){if(t.expression)try{if(!this.compilationOptions)throw new Error("InternalError: Compilation options not defined");return e?await y.create(t.expression,this.compilationOptions):await d.create(t.expression,this.compilationOptions)}catch(e){const i=new n.A("featurelayer","Failed to compile arcade expression",{error:e,expression:t.expression});return S().error(i),null}if(t.normalizationType||t.normalizationField)return new v(t.field,t);if(t.field)return new l(t.field);const i=new n.A("featurelayer","Unable to create computed field. No expression or field found",{info:t});return S().error(i),null}async createWhereClause(t){return t?(0,b.$)(t,this.compilationOptions.fields):null}getBitset(t){return this._bitsets[t-1]}getComputedNumeric(t,e){return this.getComputedNumericAtIndex(t&o.KQ,0)}setComputedNumeric(t,e,i){return this.setComputedNumericAtIndex(t&o.KQ,i,0)}getComputedString(t,e){return this.getComputedStringAtIndex(t&o.KQ,0)}setComputedString(t,e,i){return this.setComputedStringAtIndex(t&o.KQ,0,i)}getComputedNumericAtIndex(t,e){const i=t&o.KQ;return this._ensureNumeric(e,i),this._numerics[e][i]}setComputedNumericAtIndex(t,e,i){const n=t&o.KQ;this._ensureNumeric(e,n),this._numerics[e][n]=i}getPackedChunkId(t){const e=t&o.KQ;return this._ensureInstanceId(e),this._instanceIds[e]}setPackedChunkId(t,e){const i=t&o.KQ;this._ensureInstanceId(i),this._instanceIds[i]=e}getComputedStringAtIndex(t,e){const i=t&o.KQ;return this._ensureString(e,i),this._strings[e][i]}setComputedStringAtIndex(t,e,i){const n=t&o.KQ;this._ensureString(e,n),this._strings[e][n]=i}getXMin(t){return this._bounds[4*(t&o.KQ)]}getYMin(t){return this._bounds[4*(t&o.KQ)+1]}getXMax(t){return this._bounds[4*(t&o.KQ)+2]}getYMax(t){return this._bounds[4*(t&o.KQ)+3]}setBounds(t,e,i=!1){const n=t&o.KQ;if(!i&&!this._dirtyBitset.has(t))return this._bounds[4*n]!==w;this._dirtyBitset.unset(t);const r=e.readGeometryWorldSpace();if(T(this._bounds,4*n+4,0),!r||!r.coords.length)return this._bounds[4*n]=w,this._bounds[4*n+1]=w,this._bounds[4*n+2]=w,this._bounds[4*n+3]=w,!1;let s=1/0,a=1/0,l=-1/0,u=-1/0;return r.forEachVertex(((t,e)=>{s=Math.min(s,t),a=Math.min(a,e),l=Math.max(l,t),u=Math.max(u,e)})),this._bounds[4*n]=s,this._bounds[4*n+1]=a,this._bounds[4*n+2]=l,this._bounds[4*n+3]=u,!0}getBounds(t,e){const i=this.getXMin(e),n=this.getYMin(e),r=this.getXMax(e),o=this.getYMax(e);return(0,s.BI)(t,i,n,r,o),i!==w}_ensureNumeric(t,e){this._numerics[t]||(this._numerics[t]=[]),T(this._numerics[t],e,0)}_ensureInstanceId(t){T(this._instanceIds,t,0)}_ensureString(t,e){this._strings[t]||(this._strings[t]=[]),T(this._strings[t],e,null)}}},70132:function(t,e,i){i.d(e,{A:function(){return f}});var n=i(39819),r=i(40633),s=i(87416),o=i(35068),a=i(20932),l=i(62512),u=i(20973),c=i(7926),h=i(6578),d=i(19886);class f{constructor(t){this._geometryBounds=(0,s.vt)(),this._idToVisibility=new Map,this._serviceInfo=t}static async create(t){const e=new f(t);return await e.update(t.filterJSON,t.spatialReference),e}get hash(){return this._hash}check(t){return this._applyFilter(t)}clear(){const t=this._resetAllHiddenIds();return this.update(),{show:t,hide:[]}}invalidate(){this._idToVisibility.forEach(((t,e)=>{this._idToVisibility.set(e,0)}))}setKnownIds(t){for(const e of t)this._idToVisibility.set(e,1)}setTrue(t){const e=[],i=[],n=new Set(t);return this._idToVisibility.forEach(((t,r)=>{const s=!!(1&this._idToVisibility.get(r)),o=n.has(r);!s&&o?e.push(r):s&&!o&&i.push(r),this._idToVisibility.set(r,o?3:0)})),{show:e,hide:i}}createQuery(){const{geometry:t,spatialRel:e,where:i,timeExtent:n,objectIds:r}=this;return c.A.fromJSON({geometry:t,spatialRel:e,where:i,timeExtent:n,objectIds:r})}async update(t,e){this._hash=JSON.stringify(t);const i=await(0,a.T2)(t,null,e);await Promise.all([this._setGeometryFilter(i),this._setIdFilter(i),this._setAttributeFilter(i),this._setTimeFilter(i)])}async _setAttributeFilter(t){if(!t?.where)return this._clause=null,void(this.where=null);this._clause=await(0,d.$)(t.where,this._serviceInfo.fieldsIndex),this.where=t.where}_setIdFilter(t){this._idsToShow=t?.objectIds&&new Set(t.objectIds),this._idsToHide=t?.hiddenIds&&new Set(t.hiddenIds),this.objectIds=t?.objectIds}async _setGeometryFilter(t){if(!t?.geometry)return this._spatialQueryOperator=null,this.geometry=null,void(this.spatialRel=null);const e=t.geometry,i=t.spatialRel||"esriSpatialRelIntersects",n=await(0,l.xt)(i,e,this._serviceInfo.geometryType,this._serviceInfo.hasZ,this._serviceInfo.hasM);(0,o.Rg)(this._geometryBounds,e),this._spatialQueryOperator=n,this.geometry=e,this.spatialRel=i}_setTimeFilter(t){if(this.timeExtent=this._timeOperator=null,t?.timeExtent)if(this._serviceInfo.timeInfo)this.timeExtent=t.timeExtent,this._timeOperator=(0,u.I)(this._serviceInfo.timeInfo,t.timeExtent,h.Z.Shared);else{const e=new n.A("feature-layer-view:time-filter-not-available","Unable to apply time filter, as layer doesn't have time metadata.",t.timeExtent);r.A.getLogger("esri.views.2d.layers.features.controllers.FeatureFilter").error(e)}}_applyFilter(t){return this._filterByGeometry(t)&&this._filterById(t)&&this._filterByTime(t)&&this._filterByExpression(t)}_filterByExpression(t){return!this.where||this._clause(t)}_filterById(t){return(!this._idsToHide?.size||!this._idsToHide.has(t.getObjectId()))&&(!this._idsToShow?.size||this._idsToShow.has(t.getObjectId()))}_filterByGeometry(t){if(!this.geometry)return!0;const e=t.readGeometryWorldSpace();return!!e&&this._spatialQueryOperator(e)}_filterByTime(t){return null==this._timeOperator||this._timeOperator(t)}_resetAllHiddenIds(){const t=[];return this._idToVisibility.forEach(((e,i)=>{1&e||(this._idToVisibility.set(i,1),t.push(i))})),t}}},24231:function(t,e,i){i.d(e,{h:function(){return o},i:function(){return s}});var n=i(57165),r=i(7103);class s{static minimal(t,e,i=[]){return new s({geometryType:t,fieldsIndex:new r.A(i).toJSON(),objectIdField:e,subtypes:null,subtypeField:null,types:null,globalIdField:null,spatialReference:null,timeInfo:null,timeReferenceUnknownClient:null,typeIdField:null})}static createFeature(t){return new s(t)}constructor(t){this._options=t,this._fieldsIndex=r.A.fromJSON(t.fieldsIndex),t.spatialReference&&(this._spatialReference=n.A.fromJSON(t.spatialReference)),this._arcadeSchema={fields:this.fieldsIndex.fields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,objectIdField:this.objectIdField,globalIdField:this._options.globalIdField,spatialReference:this._spatialReference,timeInfo:this._options.timeInfo,typeIdField:this._options.typeIdField??void 0,types:this._options.types??void 0,subtypeField:this._options.subtypeField,subtypes:this._options.subtypes??void 0}}get fieldsIndex(){return this._fieldsIndex}get geometryType(){return"esriGeometryMultiPatch"===this._options.geometryType?"esriGeometryPolygon":this._options.geometryType}get serviceGeometryType(){return this._options.geometryType}get subtypeField(){return this._options.subtypeField}get timeInfo(){return this._options.timeInfo}get objectIdField(){return this._options.objectIdField}get globalIdField(){return this._options.globalIdField}get arcadeSchema(){return this._arcadeSchema}get spatialReference(){return this._spatialReference}get timeReferenceUnknownClient(){return this._options.timeReferenceUnknownClient}}class o extends s{static createGraphics(t){return new o({fieldsIndex:(new r.A).toJSON(),objectIdField:"uid",geometryType:null,spatialReference:t,globalIdField:null,subtypeField:null,subtypes:null,timeInfo:null,typeIdField:null,types:null,timeReferenceUnknownClient:null})}}},87036:function(t,e,i){i.d(e,{P:function(){return r}});var n=i(45273);class r{constructor(t){this._valid=n.y.create(t),this._data=new Array(t)}has(t){return this._valid.has(t)}set(t,e){this._valid.set(t),this._data[t]=e}get(t){return this._data[t]}}},63139:function(t,e,i){i.d(e,{Y:function(){return R}}),i(50917);var n=i(9688),r=i(58941),s=i(95929),o=i(42042),a=i(70891),l=i(33134),u=i(24761),c=i(30804),h=i(40302),d=i(58081),f=i(65215),p=i(76613),_=i(21168),m=i(87036),g=i(45273),y=i(74697);const v=(0,r.A)("featurelayer-simplify-thresholds")??[.5,.5,.5,.5],x=v[0],b=v[1],S=v[2],w=v[3],T=(0,r.A)("featurelayer-simplify-payload-size-factors")??[1,2,4],P=T[0],I=T[1],M=T[2],A=(0,r.A)("featurelayer-simplify-mobile-factor")??2,C=(0,r.A)("esri-mobile"),E=4294967295;class R{constructor(t){this.metadata=t,this.type="FeatureSetReader",this._deleted=null,this._joined=[],this._objectIdToIndex=null,this._boundsBuffer=[],this._caches=new Map,this.arcadeDeclaredClass="esri.arcade.Feature",this._contextTimeZone=null}destroy(){}[Symbol.dispose](){this.destroy()}get isEmpty(){return null!=this._deleted&&this._deleted.countSet()===this.getSize()}getAreaSimplificationThreshold(t,e){let i=1;const n=C?A:1;e>4e6?i=M*n:e>1e6?i=I*n:e>5e5?i=P*n:e>1e5&&(i=n);let r=0;return t>4e3?r=w*i:t>2e3?r=S*i:t>100?r=b:t>15&&(r=x),r}getBounds(t){if(function(t,e){if(!(t.length>e))for(;t.length<=e;)t.push(0)}(this._boundsBuffer,4*this.getIndex()+4),this.getBoundsXMin()===E)return!1;if(0===this.getBoundsXMin()){const e=this.readGeometryWorldSpace();if(!e)return this.setBoundsXMin(E),!1;let i=1/0,n=1/0,r=-1/0,s=-1/0;return e.forEachVertex(((t,e)=>{i=Math.min(i,t),n=Math.min(n,e),r=Math.max(r,t),s=Math.max(s,e)})),this.setBoundsXMin(i),this.setBoundsYMin(n),this.setBoundsXMax(r),this.setBoundsYMax(s),(0,u.BI)(t,i,n,r,s),!0}const e=this.getBoundsXMin(),i=this.getBoundsYMin(),n=this.getBoundsXMax(),r=this.getBoundsYMax();return(0,u.BI)(t,e,i,n,r),!0}getBoundsXMin(){return this._boundsBuffer[4*this.getIndex()]}setBoundsXMin(t){this._boundsBuffer[4*this.getIndex()]=t}getBoundsYMin(){return this._boundsBuffer[4*this.getIndex()+1]}setBoundsYMin(t){this._boundsBuffer[4*this.getIndex()+1]=t}getBoundsXMax(){return this._boundsBuffer[4*this.getIndex()+2]}setBoundsXMax(t){this._boundsBuffer[4*this.getIndex()+2]=t}getBoundsYMax(){return this._boundsBuffer[4*this.getIndex()+3]}setBoundsYMax(t){this._boundsBuffer[4*this.getIndex()+3]=t}readAttributeAsTimestamp(t){const e=this.readAttribute(t);return"string"==typeof e?new Date(e).getTime():"number"==typeof e||null==e?e:null}readAttribute(t,e=!1){const i=this._readAttribute(t,e);if(void 0!==i)return i;for(const i of this._joined){i.setIndex(this.getIndex());const n=i._readAttribute(t,e);if(void 0!==n)return n}}readAttributes(){const t=this._readAttributes();for(const e of this._joined){e.setIndex(this.getIndex());const i=e._readAttributes();for(const e of Object.keys(i))t[e]=i[e]}return t}joinAttributes(t){this._joined.push(t)}removeIds(t){if(null==this._objectIdToIndex){const t=new Map,e=this.getCursor();for(;e.next();){const i=e.getObjectId();(0,s.Lw)(i),t.set(i,e.getIndex())}this._objectIdToIndex=t}const e=this._objectIdToIndex;for(const i of t.values())e.has(i)&&this._removeAtIndex(e.get(i))}readOptimizedFeatureWorldSpace(){const t=this.readGeometryWorldSpace(),e=this.readAttributes(),i=this.readCentroidWorldSpace(),n=new f.Om(t,e,i);return n.objectId=this.getObjectId(),n.displayId=this.getDisplayId(),n}readLegacyFeatureForDisplay(){const t=this.readCentroidForDisplay();return{attributes:this.readAttributes(),geometry:this.readLegacyGeometryForDisplay(),centroid:(t&&{x:t.coords[0],y:t.coords[1]})??null}}readLegacyFeatureWorldSpace(){const t=this.readCentroidWorldSpace();return{attributes:this.readAttributes(),geometry:this._readLegacyGeometryWorldSpace(),centroid:(t&&{x:t.coords[0],y:t.coords[1]})??null}}readLegacyGeometryForDisplay(){const t=this.readGeometryForDisplay();return(0,d.zv)(t,this.geometryType,!1,!1)}readXForDisplay(){return this._readX()}readYForDisplay(){return this._readY()}readXWorldSpace(){const t=this._readX(),e=this.getInTransform();return null==e?t:t*e.scale[0]+e.translate[0]}readYWorldSpace(){const t=this._readY(),e=this.getInTransform();return null==e?t:e.translate[1]-t*e.scale[1]}readGeometryForDisplay(){const t=this._readGeometryDeltaDecoded(!0);if(!t){const t=this._createGeometryFromServerCentroid();return t?t.deltaDecode():null}return t}readGeometryWorldSpace(){let t=this._readGeometry();if(t||(t=this._createGeometryFromServerCentroid()),!t)return null;const e=t.clone(),i=this.getInTransform();return null!=i&&(0,d.Ch)(e,e,this.hasZ,this.hasM,i),e}readCentroidForDisplay(){const t=this.readGeometryForDisplay();return t?this._computeDisplayCentroid(t):this._readServerCentroid()}readCentroidWorldSpace(){const t=this.readGeometryForDisplay(),e=t?this._computeDisplayCentroid(t):this._readServerCentroid();if(!e)return null;const i=e.clone(),n=this.getInTransform();return null!=n&&(0,d.Ch)(i,i,this.hasZ,this.hasM,n),i}setCache(t){let e=this._caches.get(t);null==e&&(e=new m.P(this.getSize()),this._caches.set(t,e)),this._activeCache=e}setCachedValue(t){this._activeCache.set(this.getIndex(),t)}hasCachedValue(){return this._activeCache.has(this.getIndex())}getCachedValue(){return this._activeCache.get(this.getIndex())}_readGeometryDeltaDecoded(t){const e=this._readGeometry(t);return"esriGeometryPoint"!==this.geometryType&&e&&this.getInTransform()?e.deltaDecode():e}get contextTimeZone(){return this._contextTimeZone}set contextTimeZone(t){this._contextTimeZone=t}readArcadeFeature(){return this}hasField(t){return this.fields.has(t)||this._joined.some((e=>e.hasField(t)))}geometry(){const t=this.readGeometryWorldSpace(),e=(0,d.zv)(t,this.geometryType,this.hasZ,this.hasM),i=(0,y.rS)(e);if(i){if(!this.metadata.spatialReference)throw new Error("InternalError: Expected spatial reference to be defined");i.spatialReference=this.metadata.spatialReference}return i}autocastArcadeDate(t,e){return e&&e instanceof Date?this.isUnknownDateTimeField(t)?n.lY.unknownDateJSToArcadeDate(e):n.lY.dateJSAndZoneToArcadeDate(e,this.contextTimeZone??_.qU):e}isUnknownDateTimeField(t){return this.metadata.fieldsIndex.getTimeZone(t)===_.L5}field(t){let e=this.fields.get(t);if(e)switch(e.type){case"date-only":case"esriFieldTypeDateOnly":return o.n.fromReader(this.readAttribute(t,!1));case"time-only":case"esriFieldTypeTimeOnly":return a.k.fromReader(this.readAttribute(t,!1));case"esriFieldTypeTimestampOffset":case"timestamp-offset":return n.lY.fromReaderAsTimeStampOffset(this.readAttribute(t,!1));case"date":case"esriFieldTypeDate":return this.autocastArcadeDate(t,this.readAttribute(t,!0));default:return this.readAttribute(t,!1)}for(const i of this._joined)if(i.setIndex(this.getIndex()),e=i.fields.get(t),e)switch(e.type){case"date-only":case"esriFieldTypeDateOnly":return o.n.fromReader(i._readAttribute(t,!1));case"time-only":case"esriFieldTypeTimeOnly":return a.k.fromReader(i._readAttribute(t,!1));case"esriFieldTypeTimestampOffset":case"timestamp-offset":return n.lY.fromReaderAsTimeStampOffset(i._readAttribute(t,!1));case"date":case"esriFieldTypeDate":return this.autocastArcadeDate(t,i._readAttribute(t,!0));default:return this.readAttribute(t,!1)}throw new Error(`Field ${t} does not exist`)}setField(t,e){throw new Error("Unable to update feature attribute values, feature is readonly")}keys(){return this.fields.fields.map((t=>t.name))}castToText(t=!1){if(!t)return JSON.stringify(this.readLegacyFeatureForDisplay());const e=this.readLegacyFeatureForDisplay();if(!e)return JSON.stringify(null);const i={geometry:e.geometry,attributes:{...e.attributes??{}}};for(const t in i.attributes){const e=i.attributes[t];e instanceof Date&&(i.attributes[t]=e.getTime())}return JSON.stringify(i)}gdbVersion(){return null}fullSchema(){return this.metadata.arcadeSchema}castAsJson(t=null){return{attributes:this._readAttributes(),geometry:!0===t?.keepGeometryType?this.geometry():this.geometry()?.toJSON()??null}}castAsJsonAsync(t=null,e=null){return Promise.resolve(this.castAsJson(e))}_getExists(){return null==this._deleted||!this._deleted.has(this.getIndex())}_computeDisplayCentroid(t){if(null==this.getInTransform())return(0,h.Q)(new p.A,t,this.hasM,this.hasZ);const e=l.z.fromOptimized(t,this.geometryType);e.yFactor*=-1;const i=(0,c.d)(e);return i?(i[1]*=-1,new p.A([],i)):null}copyInto(t){t._joined=this._joined,t._deleted=this._deleted,t._objectIdToIndex=this._objectIdToIndex,t._boundsBuffer=this._boundsBuffer,t._activeCache=this._activeCache,t._caches=this._caches,t._contextTimeZone=this._contextTimeZone}_readLegacyGeometryWorldSpace(){const t=this.readGeometryWorldSpace();return(0,d.zv)(t,this.geometryType,!1,!1)}_createGeometryFromServerCentroid(){const t=this._readServerCentroid();if(!t)return null;const[e,i]=t.coords;return this._createQuantizedExtrudedGeometry(e,i)}_createQuantizedExtrudedGeometry(t,e){return"esriGeometryPolyline"===this.geometryType?this._createQuantizedExtrudedLine(t,e):this._createQuantizedExtrudedQuad(t,e)}_createQuantizedExtrudedQuad(t,e){return new p.A([5],[t-1,e,1,-1,1,1,-1,1,-1,-1])}_createQuantizedExtrudedLine(t,e){return new p.A([2],[t-1,e+1,1,-1])}_removeAtIndex(t){null==this._deleted&&(this._deleted=g.y.create(this.getSize())),this._deleted.set(t)}}},45273:function(t,e,i){i.d(e,{y:function(){return n}});class n{static fromBuffer(t,e){return new n(t,e)}static create(t,e=4294967295){const i=new Uint32Array(Math.ceil(t/32));return new n(i,e)}constructor(t,e){this._mask=0,this._buf=t,this._mask=e}_getIndex(t){return Math.floor(t/32)}has(t){const e=this._mask&t;return!!(this._buf[this._getIndex(e)]&1<<e%32)}hasRange(t,e){let i=t,n=e;for(;i%32&&i!==n;){if(this.has(i))return!0;i++}for(;n%32&&i!==n;){if(this.has(i))return!0;n--}if(i===n)return!1;for(let t=i/32;t!==n/32;t++)if(this._buf[t])return!0;return!1}set(t){const e=this._mask&t,i=this._getIndex(e),n=1<<e%32;this._buf[i]|=n}setRange(t,e){let i=t,n=e;for(;i%32&&i!==n;)this.set(i++);for(;n%32&&i!==n;)this.set(n--);if(i!==n)for(let t=i/32;t!==n/32;t++)this._buf[t]=4294967295}unset(t){const e=this._mask&t,i=this._getIndex(e),n=1<<e%32;this._buf[i]&=4294967295^n}resize(t){const e=this._buf,i=new Uint32Array(Math.ceil(t/32));i.set(e),this._buf=i}or(t){for(let e=0;e<this._buf.length;e++)this._buf[e]|=t._buf[e];return this}and(t){for(let e=0;e<this._buf.length;e++)this._buf[e]&=t._buf[e];return this}xor(t){for(let e=0;e<this._buf.length;e++)this._buf[e]^=t._buf[e];return this}ior(t){for(let e=0;e<this._buf.length;e++)this._buf[e]|=~t._buf[e];return this}iand(t){for(let e=0;e<this._buf.length;e++)this._buf[e]&=~t._buf[e];return this}ixor(t){for(let e=0;e<this._buf.length;e++)this._buf[e]^=~t._buf[e];return this}any(){for(let t=0;t<this._buf.length;t++)if(this._buf[t])return!0;return!1}copy(t){for(let e=0;e<this._buf.length;e++)this._buf[e]=t._buf[e];return this}clone(){return new n(this._buf.slice(),this._mask)}clear(){for(let t=0;t<this._buf.length;t++)this._buf[t]=0;return this}forEachSet(t){for(let e=0;e<this._buf.length;e++){let i=this._buf[e],n=32*e;if(i)for(;i;)1&i&&t(n),i>>>=1,n++}}countSet(){let t=0;return this.forEachSet((e=>{t++})),t}}},51008:function(t,e,i){i.d(e,{R:function(){return c},e:function(){return d}});var n=i(39819),r=i(40633),s=i(13520),o=i(2746);const a=8,l=a-2,u=()=>r.A.getLogger("esri.views.2d.layers.features.support.rendererUtils");function c(t){return t.map((t=>function(t){return("size"===t.type||"color"===t.type||"opacity"===t.type)&&null!=t.stops}(t)?function(t){return t.stops=function(t,e){return e.length<=a?e:(u().warn(`Found ${e.length} Visual Variable stops, but MapView only supports ${a}. Displayed stops will be simplified.`),e.length>2*a?function(t,e){const[i,...n]=e,r=n.pop(),o=n[0].value,a=n[n.length-1].value,u=(a-o)/l,c=[];for(let i=o;i<a;i+=u){let r=0;for(;i>=n[r].value;)r++;const o=n[r],a=e[r-1],l=i-a.value,u=o.value===a.value?1:l/(o.value-a.value);if("color"===t){const t=n[r],s=e[r-1],o=t.color.clone();o.r=h(s.color.r,o.r,u),o.g=h(s.color.g,o.g,u),o.b=h(s.color.b,o.b,u),o.a=h(s.color.a,o.a,u),c.push({value:i,color:o,label:t.label})}else if("size"===t){const t=n[r],o=e[r-1],a=(0,s.cr)(t.size),l=h((0,s.cr)(o.size),a,u);c.push({value:i,size:l,label:t.label})}else{const t=n[r],s=h(e[r-1].opacity,t.opacity,u);c.push({value:i,opacity:s,label:t.label})}}return[i,...c,r]}(t,e):function(t){const[e,...i]=t,n=i.pop();for(;i.length>l;){let t=0,e=0;for(let n=1;n<i.length;n++){const r=i[n-1],s=i[n],o=Math.abs(s.value-r.value);o>e&&(e=o,t=n)}i.splice(t,1)}return[e,...i,n]}(e))}(t.type,t.stops??[]),t}(t.clone()):t))}function h(t,e,i){return(1-i)*t+i*e}function d(t){if(!t)return!0;switch(t.type){case"dot-density":break;case"heatmap":if(!function(){const{supportsColorBufferFloat:t,supportsColorBufferFloatBlend:e,supportsColorBufferHalfFloat:i}=(0,o.C)();return t&&e||i}()){const t=(0,o.C)(),e=["supportsColorBufferFloat","supportsColorBufferFloatBlend","supportsColorBufferHalfFloat"].filter((e=>!t[e])).join(", ");return u().errorOnce(new n.A("webgl-missing-extension",`Missing WebGL2 requirements for Heatmap: ${e}`)),!1}}return!0}},19886:function(t,e,i){i.d(e,{$:function(){return l}});var n=i(39819),r=i(40633),s=i(98737);const o=()=>r.A.getLogger("esri.views.2d.layers.features.support.whereUtils"),a={getAttribute:(t,e)=>t.readAttribute(e)};async function l(t,e){try{const i=await(0,s.G)(t,e);if(!i.isStandardized){const t=new n.A("mapview - bad input","Unable to apply filter's definition expression, as expression is not standardized.",i);o().error(t)}return e=>{const n=e.readArcadeFeature();try{return i.testFeature(n,a)}catch(e){return o().warn("mapview-bad-where-clause","Encountered an error when evaluating where clause",t),!0}}}catch(e){return o().warn("mapview-bad-where-clause","Encountered an error when evaluating where clause",t),t=>!0}}},64853:function(t,e,i){i.d(e,{f:function(){return I}});var n=i(95929),r=i(53838),s=i(28230),o=i(92543),a=i(63812),l=i(86329);let u=0;function c(t,e){return new o.c((0,l.U)(u++),t,e)}const h={visualVariableColor:null,visualVariableOpacity:null,visualVariableSizeMinMaxValue:null,visualVariableSizeScaleStops:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null,visualVariableRotation:null,visualVariableSizeOutlineScaleStops:null};class d{constructor(){this.instances={fill:c(a.YS.fill,{uniforms:h,optionalAttributes:{zoomRange:!0}}),marker:c(a.YS.marker,{uniforms:h,optionalAttributes:{zoomRange:!0}}),line:c(a.YS.line,{uniforms:h,optionalAttributes:{zoomRange:!0}}),text:c(a.YS.text,{uniforms:h,optionalAttributes:{zoomRange:!0,referenceSymbol:!1,clipAngle:!1}}),complexFill:c(a.YS.complexFill,{uniforms:h,optionalAttributes:{zoomRange:!0}}),texturedLine:c(a.YS.texturedLine,{uniforms:h,optionalAttributes:{zoomRange:!0}}),animatedMarker:c(a.YS.animatedMarker,{uniforms:h,optionalAttributes:{zoomRange:!0}})},this._instancesById=Object.values(this.instances).reduce(((t,e)=>(t.set(e.instanceId,e),t)),new Map)}getInstance(t){return this._instancesById.get(t)}}var f=i(44705),p=i(25090),_=i(14583),m=i(43274),g=i(65298),y=i(77515),v=i(88413),x=i(86305),b=i(85456),S=i(81438);const w=Math.PI/180;class T extends y.q{constructor(t){super(),this._program=null,this._vao=null,this._vertexBuffer=null,this._indexBuffer=null,this._dvsMat3=(0,p.vt)(),this._localOrigin={x:0,y:0},this._getBounds=t}destroy(){this._vao&&(this._vao.dispose(),this._vao=null,this._vertexBuffer=null,this._indexBuffer=null),this._program=(0,n.WD)(this._program)}doRender(t){const{context:e}=t,i=this._getBounds();if(i.length<1)return;this._createShaderProgram(e),this._updateMatricesAndLocalOrigin(t),this._updateBufferData(e,i),e.setBlendingEnabled(!0),e.setDepthTestEnabled(!1),e.setStencilWriteMask(0),e.setStencilTestEnabled(!1),e.setBlendFunction(b.dn.ONE,b.dn.ONE_MINUS_SRC_ALPHA),e.setColorMask(!0,!0,!0,!0);const n=this._program;e.bindVAO(this._vao),e.useProgram(n),n.setUniformMatrix3fv("u_dvsMat3",this._dvsMat3),e.gl.lineWidth(1),e.drawElements(b.WR.LINES,8*i.length,b.pe.UNSIGNED_INT,0),e.bindVAO()}_createTransforms(){return{displayViewScreenMat3:(0,p.vt)()}}_createShaderProgram(t){this._program||(this._program=t.programCache.acquire("precision highp float;\n        uniform mat3 u_dvsMat3;\n\n        attribute vec2 a_position;\n\n        void main() {\n          mediump vec3 pos = u_dvsMat3 * vec3(a_position, 1.0);\n          gl_Position = vec4(pos.xy, 0.0, 1.0);\n        }","precision mediump float;\n      void main() {\n        gl_FragColor = vec4(0.75, 0.0, 0.0, 0.75);\n      }",P().attributes))}_updateMatricesAndLocalOrigin(t){const{state:e}=t,{displayMat3:i,size:n,resolution:r,pixelRatio:s,rotation:o,viewpoint:a}=e,l=w*o,{x:u,y:c}=a.targetGeometry,h=(0,g.mT)(u,e.spatialReference);this._localOrigin.x=h,this._localOrigin.y=c;const d=s*n[0],p=s*n[1],y=r*d,v=r*p,x=(0,f.D_)(this._dvsMat3);(0,f.lw)(x,x,i),(0,f.Tl)(x,x,(0,_.fA)(d/2,p/2)),(0,f.hs)(x,x,(0,m.fA)(n[0]/y,-p/v,1)),(0,f.e$)(x,x,-l)}_updateBufferData(t,e){const{x:i,y:n}=this._localOrigin,r=8*e.length,s=new Float32Array(r),o=new Uint32Array(8*e.length);let a=0,l=0;for(const t of e)t&&(s[2*a]=t[0]-i,s[2*a+1]=t[1]-n,s[2*a+2]=t[0]-i,s[2*a+3]=t[3]-n,s[2*a+4]=t[2]-i,s[2*a+5]=t[3]-n,s[2*a+6]=t[2]-i,s[2*a+7]=t[1]-n,o[l]=a+0,o[l+1]=a+3,o[l+2]=a+3,o[l+3]=a+2,o[l+4]=a+2,o[l+5]=a+1,o[l+6]=a+1,o[l+7]=a+0,a+=4,l+=8);if(this._vertexBuffer?this._vertexBuffer.setData(s.buffer):this._vertexBuffer=x.g.createVertex(t,b._U.DYNAMIC_DRAW,s.buffer),this._indexBuffer?this._indexBuffer.setData(o):this._indexBuffer=x.g.createIndex(t,b._U.DYNAMIC_DRAW,o),!this._vao){const e=P();this._vao=new S.Z(t,e.attributes,e.bufferLayouts,new Map([["geometry",this._vertexBuffer]]),this._indexBuffer)}}}const P=()=>(0,v.ES)("bounds",{geometry:[{location:0,name:"a_position",count:2,type:b.pe.FLOAT}]});class I extends r.j{constructor(t){super(t),this._instanceStore=new d,this.checkHighlight=()=>!0}destroy(){super.destroy(),this._boundsRenderer=(0,n.pR)(this._boundsRenderer)}get instanceStore(){return this._instanceStore}enableRenderingBounds(t){this._boundsRenderer=new T(t),this.requestRender()}get hasHighlight(){return this.checkHighlight()}onTileData(t,e){t.onMessage(e),this.contains(t)||this.addChild(t),this.requestRender()}_renderChildren(t,e){t.selection=e;for(const e of this.children){if(!e.visible)continue;const i=e.getDisplayList(this._instanceStore,s.ch.STRICT_ORDER);i?.render(t)}}}},17215:function(t,e,i){i.d(e,{A:function(){return o}});var n=i(28230),r=i(64853),s=i(30488);class o extends r.f{renderChildren(t){for(const e of this.children)e.setTransform(t.state);if(super.renderChildren(t),this._updateAttributeView(),this.children.some((t=>t.hasData))){switch(t.drawPhase){case n.S5.MAP:this._renderChildren(t,n.RI.All);break;case n.S5.HIGHLIGHT:this.hasHighlight&&this._renderHighlight(t)}this._boundsRenderer&&this._boundsRenderer.doRender(t)}}_renderHighlight(t){(0,s.lB)(t,!1,(t=>{this._renderChildren(t,n.RI.Highlight)}))}}},56625:function(t,e,i){i.d(e,{A:function(){return J}});var n=i(53804),r=i(83525),s=i(50659),o=i(58941),a=i(88781),l=i(95929),u=i(60539),c=i(28181),h=i(23502),d=(i(40633),i(65953)),f=i(87416),p=i(74697),_=i(7103),m=i(57176),g=i(67895),y=i(74661),v=i(39686),x=i(27657),b=i(80308),S=i(93561),w=i(44327),T=i(81672),P=i(29739),I=i(12564),M=i(67057),A=i(24231),C=i(72228),E=i(58081),R=i(76613),O=i(63139);class z extends O.Y{static from(t,e,i){return new z(t,e,i)}constructor(t,e,i){super(i),this._items=t,this._tile=e,this._index=-1,this._cachedGeometry=null;const n=e.lod;n.wrap&&(this._wrappingInfo={worldSizeX:n.worldSize[0]})}get _current(){return this._items[this._index]}getItem(){return this._current}getZOrder(){return this._current.zOrder}getMeshWriters(){return this._current.symbolResource?.symbolInfo.meshWriters??[]}hasField(t){return null!=this._current.attributes[t]}field(t){return this.readAttribute(t)}get geometryType(){const t=(0,p.$B)(this._current.geometry);return"esriGeometryPoint"===t?"esriGeometryMultipoint":t}getCursor(){return this.copy()}copy(){const t=new z(this._items,this._tile,this.metadata);return this.copyInto(t),t}copyInto(t){super.copyInto(t),t._cachedGeometry=this._cachedGeometry,t._index=this._index}get fields(){throw new Error("Fields reading not supported to graphics.")}get hasFeatures(){return!!this._items.length}get hasNext(){return this._index+1<this._items.length}get exceededTransferLimit(){throw new Error("InternalError: exceededTransferLimit not implemented for graphics.")}get hasZ(){return!1}get hasM(){return!1}getInTransform(){return this._tile.transform}getSize(){return this._items.length}getAttributeHash(){let t="";for(const e in this._current.attributes)t+=this._current.attributes[e];return t}getObjectId(){return this._items[this._index].objectId}getDisplayId(){return this._current.displayId}setDisplayId(t){throw new Error("InternalError: Setting displayId not supported for graphics.")}setIndex(t){this._index=t}getIndex(){return this._index}next(){for(this._cachedGeometry=null;++this._index<this._items.length&&!this._getExists(););return this._index<this._items.length}readGeometryArea(){throw new Error("InternalError: readGeometryArea not supported for graphics.")}_readGeometry(){if(!this._cachedGeometry){let t=(0,E.Ux)(this._current.projectedGeometry,this.hasZ,this.hasM);if("esriGeometryPolyline"===this.geometryType&&(t=(0,E.kz)(new R.A,t,this.hasZ,this.hasM,this.geometryType,this._tile.transform.scale[0])),this._cachedGeometry=(0,E.Nl)(new R.A,t,this.hasZ,this.hasM,this.geometryType,this._tile.transform),!this._cachedGeometry)return null;this._wrapGeometry(this._cachedGeometry)}return this._cachedGeometry}_wrapGeometry(t){if(!this._wrappingInfo)return;const{worldSizeX:e}=this._wrappingInfo;if(t.isPoint)return 1===e?(t.coords.push(v.CQ,0),t.coords.push(2*-v.CQ,0),void t.lengths.push(3)):2===e?(t.coords.push(2*v.CQ,0),t.coords.push(4*-v.CQ,0),void t.lengths.push(3)):void this._wrapVertex(t.coords,0,2,e);if("esriGeometryMultipoint"!==this.geometryType);else{if(1===e){const e=t.coords.slice();e[0]-=512;const i=t.coords.slice();i[0]+=512,t.coords.push(...e,...i);const n=t.lengths[0];return void t.lengths.push(n,n)}this._wrapVertex(t.coords,0,2,e)}}_wrapVertex(t,e,i,n){const r=e*i,s=t[r];s<-v.CQ*(n-2)?t[r]=s+v.CQ*n:s>v.CQ*(n-1)&&(t[r]=s-v.CQ*n)}_readX(){const t=this._readGeometry();return null!=t?t.coords[0]:0}_readY(){const t=this._readGeometry();return null!=t?t.coords[1]:0}_readServerCentroid(){switch(this.geometryType){case"esriGeometryPolygon":{const t=(0,C.l8)(this._current.projectedGeometry),e=new R.A([],t);return(0,E.Nl)(new R.A,e,this.hasZ,this.hasM,this.geometryType,this._tile.transform)}case"esriGeometryPolyline":{const t=this._current.projectedGeometry,e=(0,C.S8)(t.paths,this.hasZ),i=new R.A([],e);return(0,E.Nl)(new R.A,i,this.hasZ,this.hasM,this.geometryType,this._tile.transform)}}return null}_readAttribute(t,e){const i=this._current.attributes[t];if(void 0!==i)return i;const n=t.toLowerCase();for(const t in this._current.attributes)if(t.toLowerCase()===n)return this._current.attributes[t]}_readAttributes(){return this._current.attributes}}var D=i(13520),L=i(78952),F=i(35068),V=i(65298),N=i(57652),k=i(14817),B=i(38441),U=i(80207),G=i(74841),Y=i(96700);class Z{static fromGraphic(t,e,i,n){return new Z(t.geometry,e,t.attributes,t.visible,t.uid,t.version,i,n)}constructor(t,e,i,n,r,s,o,a){this.geometry=t,this.symbol=e,this.attributes=i,this.visible=n,this.objectId=r,this._version=s,this.zOrder=o,this.displayId=a,this.bounds=(0,f.vt)(),this.prevBounds=(0,f.vt)(),this.size=[0,0,0,0]}get linearCIM(){return this.symbolResource?.symbolInfo.linearCIM}get hasAnimations(){const{linearCIM:t}=this;return!!t&&t.some((t=>"animationParams"in t&&!!t.animationParams))}update(t,e,i){return(this._version!==t.version||this.zOrder!==i||this.symbol!==e)&&(this.prevBounds=this.bounds,this.bounds=(0,f.vt)(),this.zOrder=i,this.geometry=t.geometry,this.attributes=t.attributes,this.symbol=e,this.visible=t.visible,this._version=t.version,this.symbolResource=null,this.projectedGeometry=null,!0)}async projectAndNormalize(t){let e=this.geometry;if(!e||!e.spatialReference||"mesh"===e.type)return;"extent"===e.type&&(e=(0,Y.DF)(e)),await(0,G.Nk)(e.spatialReference,t);const i=(0,U.b3)(e);if(!i)return;const n=(0,G.Cv)(i,e.spatialReference,t);n&&(0,B.uC)(n),this.projectedGeometry=(0,p.ZC)(n)?(0,Y.DF)(n):n}}class H{constructor(t,e,i){this.added=t,this.updated=e,this.removed=i}hasAnyUpdate(){return!!(this.added.length||this.updated.length||this.removed.length)}}const W=1e-5;function $(t,e){return e.zOrder-t.zOrder}class j{constructor(t,e,i,n,r){this._items=new Map,this._boundsDirty=!1,this._outSpatialReference=t,this._cimResourceManager=e,this._hittestDrawHelper=new k.CK(e),this._tileInfoView=i,this._store=r;const s=i.getClosestInfoForScale(n);this._resolution=this._tileInfoView.getTileResolution(s.level)}destroy(){this._hittestDrawHelper.destroy()}items(){return this._items.values()}getItem(t){return this._items.get(t)}async update(t,e,i){const n=[],r=[],s=[],o=new Set,a=[];let l=0;for(const s of t.items){l++;const t=s.uid,u=this._items.get(t),c=e(s);if(o.add(t),u){u.update(s,c,l)&&(r.push(u),a.push(this._updateItem(u,i)));continue}const h=this._store.createDisplayIdForObjectId(t),d=Z.fromGraphic(s,c,l,h);a.push(this._updateItem(d,i)),this._items.set(d.objectId,d),n.push(d)}for(const[t,e]of this._items.entries())o.has(t)||(this._store.releaseDisplayIdForObjectId(t),this._items.delete(t),s.push(e));return await Promise.all(a),this._index=null,new H(n,r,s)}updateLevel(t){this._resolution!==t&&(this._index=null,this._boundsDirty=!0,this._resolution=t)}hitTest(t,e,i,n,r){const s=(0,o.A)("esri-mobile"),a=s?v.fy:v.V3,l=a+(s?0:v._M);t=(0,V.mT)(t,this._tileInfoView.spatialReference);const u=n*window.devicePixelRatio*l,c=(0,f.vt)();c[0]=t-u,c[1]=e-u,c[2]=t+u,c[3]=e+u;const h=n*window.devicePixelRatio*a,d=(0,f.vt)();d[0]=t-h,d[1]=e-h,d[2]=t+h,d[3]=e+h;const p=.5*n*(l+Y.RA),_=this._searchIndex(t-p,e-p,t+p,e+p);if(!_||0===_.length)return[];const m=[],g=(0,f.vt)(),y=(0,f.vt)();for(const t of _){if(!t.visible)continue;const{projectedGeometry:e,symbolResource:i}=t;this._getSymbolBounds(g,i,e,y,r),y[3]=y[2]=y[1]=y[0]=0,(0,f.HY)(g,c)&&m.push(t)}if(0===m.length)return[];const x=this._hittestDrawHelper,b=[];for(const t of m){const{projectedGeometry:e,symbolResource:i}=t;if(!i)continue;const{textInfo:s,symbolInfo:o}=i,a=o.cimSymbol;x.hitTest(d,a.symbol,e,s,r,n)&&b.push(t)}return b.sort($),b.map((t=>t.objectId))}queryItems(t){return 0===this._items.size?[]:this._searchForItems(t)}clear(){this._items.clear(),this._index=null}async _updateItem(t,e){await t.projectAndNormalize(this._outSpatialReference),await e(t);const{size:i}=t;i[0]=i[1]=i[2]=i[3]=0,this._getSymbolBounds(t.bounds,t.symbolResource,t.projectedGeometry,t.size,0)}_searchIndex(t,e,i,n){return this._boundsDirty&&(this._items.forEach((t=>this._getSymbolBounds(t.bounds,t.symbolResource,t.projectedGeometry,t.size,0))),this._boundsDirty=!1),this._index||(this._index=(0,L.r)(9,(t=>({minX:t.bounds[0],minY:t.bounds[1],maxX:t.bounds[2],maxY:t.bounds[3]}))),this._index.load(Array.from(this._items.values()))),this._index.search({minX:t,minY:e,maxX:i,maxY:n})}_searchForItems(t){const e=this._tileInfoView.spatialReference,i=t.bounds,n=(0,N.Vp)(e);if(n&&e.isWrappable){const[e,r]=n.valid,s=Math.abs(i[2]-r)<W,o=Math.abs(i[0]-e)<W;if((!s||!o)&&(s||o)){const n=t.resolution;let o;o=(0,f.vt)(s?[e,i[1],e+n*Y.RA,i[3]]:[r-n*Y.RA,i[1],r,i[3]]);const a=this._searchIndex(i[0],i[1],i[2],i[3]),l=this._searchIndex(o[0],o[1],o[2],o[3]);return[...new Set([...a,...l])]}}return this._searchIndex(i[0],i[1],i[2],i[3])}_getSymbolBounds(t,e,i,n,r){if(!e||!e.symbolInfo.linearCIM||!i)return null;if(t||(t=(0,f.vt)()),(0,F.Rg)(t,i),!n||0===n[0]&&0===n[1]&&0===n[2]&&0===n[3]){const{textInfo:t,symbolInfo:i}=e,s=i.cimSymbol;n||(n=[0,0,0,0]);const o=m.Sc.getSymbolInflateSize(n,s.symbol,this._cimResourceManager,r,t);n[0]=(0,D.Lz)(o[0]),n[1]=(0,D.Lz)(o[1]),n[2]=(0,D.Lz)(o[2]),n[3]=(0,D.Lz)(o[3])}const s=this._resolution,o=m.Sc.safeSize(n);return t[0]-=o*s,t[1]-=o*s,t[2]+=o*s,t[3]+=o*s,t}}var q=i(21884),X=i(60478);class K{static getOrCreate(t,e,i){let n=e.get(t.id);return n||(n=new K(t,i),e.set(t.id,n)),n}static fromItems(t,e,i){const n=new K(t,i);for(const t of e)n.append(t);return n}constructor(t,e){this.tile=t,this.metadata=e,this.addedOrModified=[],this.removed=[],this.objectIdMap=null}get reader(){return this._reader||(this._reader=z.from(this.addedOrModified,this.tile,this.metadata)),this._reader}append(t){this.addedOrModified.push(t),t.hasAnimations&&(this.objectIdMap=this.objectIdMap||{},this.objectIdMap[t.displayId]=t.objectId)}}let Q=class extends((0,a.sA)(r.A)){constructor(t){super(t),this._attached=!1,this._tiles=new Map,this._controller=new AbortController,this._hashToSymbolInfo=new Map,this._lastCleanup=performance.now(),this._cleanupRequired=!0,this.lastUpdateId=-1,this.renderer=null,this._updateTracking=new X.F({debugName:"GraphicsView2D"}),this.updateRequested=!1,this.defaultPointSymbolEnabled=!0,this._commandQueue=new q.A({process:t=>{if("update"===t.type)return this._update();throw new Error("InternalError: Unsupported command")}}),this.graphicUpdateHandler=this.graphicUpdateHandler.bind(this)}destroy(){this.container.destroy(),this.view=null,this.renderer=null,this._set("graphics",null),this._controller.abort(),this._graphicStore.clear(),this._graphicStore.destroy(),this._attributeStore=null,this._hashToSymbolInfo.clear(),this._updateTracking.destroy(),this._commandQueue.destroy()}_initAttributeStore(){this._storage=new M.l({spatialReference:this.view.spatialReference,fields:new _.A}),this._attributeStore=new I.K({isLocal:!0,update:t=>{(0,o.A)("esri-2d-update-debug")&&console.debug(`[Id: ${this.layerId}] GraphicsView2D.AttributeStoreView.updateStart`,{message:t}),this.container.attributeView.requestUpdate(t),this.container.requestRender(),(0,o.A)("esri-2d-update-debug")&&console.debug(`[Id: ${this.layerId}] GraphicsView2D.AttributeStoreView.updateEnd`,{message:t})}});const t=(0,P.T9)(null,[]);this._attributeStore.update(t,this._storage,null),this.container.checkHighlight=()=>this._attributeStore.hasHighlight}initialize(){this._initAttributeStore(),this._metadata=A.h.createGraphics(this.view.spatialReference),this._resourceProxy=new S.J({fetch:t=>Promise.all(t.map((t=>this.view.stage.textureManager.rasterizeItem(t)))),fetchDictionary:t=>{throw new Error("InternalError: Graphics do not support Dictionary requests")}}),this.addHandles([(0,c.watch)((()=>this._effectiveRenderer),(()=>this._pushUpdate())),this.view.graphicsTileStore.on("update",this._onTileUpdate.bind(this)),this.container.on("attach",(()=>{this.addHandles([this.graphics.on("change",(()=>this._pushUpdate()))]),this._graphicStore?.destroy(),this._graphicStore=new j(this.view.spatialReference,this._cimResourceManager,this.view.featuresTilingScheme,this.view.state.scale,this._attributeStore),this._attached=!0,this.requestUpdate(),this._pushUpdate()}))]),this._updateTracking.addUpdateTracking("CommandQueue",this._commandQueue.updateTracking);const t=this.view.graphicsTileStore.tiles;this._onTileUpdate({added:t,removed:[]})}get _effectiveRenderer(){return"function"==typeof this.renderer?this.renderer():this.renderer}get _cimResourceManager(){return this.view.stage.textureManager.resourceManager}get updating(){const t=!this._attached||this._updateTracking.updating;return(0,o.A)("esri-2d-log-updating")&&console.log(`Updating GraphicsView2D: ${t}\n  -> attaching ${!this._attached}\n  -> updateTracking ${this._updateTracking.updating}`),t}hitTest(t){if(!this.view||this.view.suspended)return[];const{resolution:e,rotation:i}=this.view.state,n=this._graphicStore.hitTest(t.x,t.y,2,e,i),r=new Set(n),o=this.graphics.items.reduce(((t,e)=>(r.has(e.uid)&&t.set(e.uid,e),t)),new Map);return n.map((t=>o.get(t))).filter(s.Ru)}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.requestUpdateCallback()),this.notifyChange("updating")}processUpdate(t){this.updateRequested&&(this.updateRequested=!1,this.update(t))}viewChange(){this.requestUpdate()}setHighlight(t){const e=[];for(const{objectId:i,highlightFlags:n}of t){const t=this._graphicStore.getItem(i)?.displayId;e.push({objectId:i,highlightFlags:n,displayId:t})}this._attributeStore.setHighlight(e,t),this._pushUpdate()}graphicUpdateHandler(t){this._pushUpdate()}update(t){this.updateRequested=!1,this._attached&&this._graphicStore.updateLevel(t.state.resolution)}pushUpdate(){this._pushUpdate()}_pushUpdate(){(0,u.QZ)(this._commandQueue.push({type:"update"}))}async _update(){try{(0,o.A)("esri-2d-update-debug")&&console.debug(`[Id: ${this.layerId}] GraphicsView._update start`);const t=await this._graphicStore.update(this.graphics,(t=>this._getSymbolForGraphic(t)),(t=>this._ensureSymbolResource(t)));for(const e of t.updated)this.container.restartAnimation(e.objectId);if(!t.hasAnyUpdate())return void this._attributeStore.sendUpdates();t.removed.length&&(this._cleanupRequired=!0),(0,o.A)("esri-2d-update-debug")&&console.debug(`[Id: ${this.layerId}] GraphicsView updateMessage`,t);const e=this._createTileMessages(t);await this._fetchResources(e),this._write(e);for(const e of t.added)this._setFilterState(e);for(const e of t.updated)this._setFilterState(e);(0,o.A)("esri-2d-update-debug")&&console.debug(`[Id: ${this.layerId}] GraphicsView sendUpdate`,t),this._attributeStore.sendUpdates(),(0,o.A)("esri-2d-update-debug")&&console.debug(`[Id: ${this.layerId}] GraphicsView sendUpdate.await`,t)}catch(t){}this._cleanupSharedResources()}_createTileMessages(t){const e=new Map;for(const i of t.added){const t=this.view.graphicsTileStore.getIntersectingTiles(i.bounds);for(const n of t)K.getOrCreate(n,e,this._metadata).append(i)}for(const i of t.updated){const t=this.view.graphicsTileStore.getIntersectingTiles(i.prevBounds),n=this.view.graphicsTileStore.getIntersectingTiles(i.bounds);for(const n of t)K.getOrCreate(n,e,this._metadata).removed.push(i.displayId);for(const t of n)K.getOrCreate(t,e,this._metadata).append(i)}for(const i of t.removed){const t=this.view.graphicsTileStore.getIntersectingTiles(i.bounds);for(const n of t)K.getOrCreate(n,e,this._metadata).removed.push(i.displayId)}return Array.from(e.values())}async _fetchResources(t){for(const{tile:e,reader:i}of t){(0,o.A)("esri-2d-update-debug")&&console.debug(`Id[${this.layerId}] Tile[${e.id}] GraphicsView fetchResources`,t);const n=i.getCursor();for(;n.next();)for(const t of n.getMeshWriters())t.enqueueRequest(this._resourceProxy,n,e.createArcadeEvaluationOptions(this.view.timeZone))}await this._resourceProxy.fetchEnqueuedResources()}_write(t){for(const e of t){(0,o.A)("esri-2d-update-debug")&&console.debug(`Id[${this.layerId}] Tile[${e.tile.id}] GraphicsView write`,e);const t=this._writeMeshes(e);let i=this._tiles.get(e.tile.key);i||(i=this._createFeatureTile(e.tile.key)),(0,o.A)("esri-2d-update-debug")&&console.debug(`Id[${this.layerId}] Tile[${e.tile.id}] GraphicsView onTileData`,e),this.container.onTileData(i,{type:"update",modify:t,remove:e.removed,end:!1,attributeEpoch:this._attributeStore.epoch,objectIdMap:e.objectIdMap}),this.container.requestRender()}}_writeMeshes(t){const e=new b.U(t.tile.id),i=t.reader.getCursor();for(;i.next();){e.entityStart(i.getDisplayId(),i.getZOrder());for(const n of i.getMeshWriters())n.write(e,this._resourceProxy,i,t.tile.createArcadeEvaluationOptions(this.view.timeZone),t.tile.level);e.entityEnd()}return{...e.serialize().message,tileId:t.tile.id}}_setFilterState(t){const e=t.displayId,i=this._attributeStore.getHighlightFlags(t.objectId);this._attributeStore.setData(e,0,0,i|(t.visible?v.LY:0))}_getSymbolForGraphic(t){return null!=t.symbol?t.symbol:null!=this._effectiveRenderer?this._effectiveRenderer.getSymbol(t):this._getNullSymbol(t)}async _ensureSymbolResource(t){if(!t.symbol)return;const e=await this._getSymbolInfo(t.symbol);if(!e)return;const i=e.linearCIM.filter((t=>"text"===t.type));if(i.length>0){const n=await this._getTextResources(t,i);t.symbolResource={symbolInfo:e,textInfo:n}}else t.symbolResource={symbolInfo:e}}_getSymbolInfo(t){const e=t.hash();return this._hashToSymbolInfo.has(e)||this._hashToSymbolInfo.set(e,this._createSymbolInfo(e,t).catch((t=>null))),this._hashToSymbolInfo.get(e)}async _createSymbolInfo(t,e){const i=await this._convertToCIMSymbol(e),n=await this._createLinearCIM(i);return{hash:t,cimSymbol:i,linearCIM:n,meshWriters:await this._createMeshWriters(i,n)}}async _convertToCIMSymbol(t){const e=(0,m.Vb)(t);return"web-style"===e.type?(await e.fetchCIMSymbol()).data:e}async _createLinearCIM(t){return await Promise.all(m.wp.fetchResources(t.symbol,this._cimResourceManager,[])),this.view.stage.cimAnalyzer.analyzeSymbolReference(t,!1)}async _createMeshWriters(t,e){(0,u.Te)(this._controller.signal);const i=this.container.instanceStore,n=this.view.stage.meshWriterRegistry,r=await async function(t,e,i){const n=[],r={scaleInfo:(0,T.TY)(t),scaleExpression:null};for(const t of e)switch(t.type){case"marker":if(t.animationParams){n.push(...(0,T.gF)(i.instances.animatedMarker,t,w.Dk,r));break}n.push(...(0,T.Zi)(i.instances.marker,t,w.Dk,r));break;case"fill":null==t.spriteRasterizationParam?n.push(...(0,T.Gn)(i.instances.fill,t,r)):n.push(...(0,T.oF)(i.instances.complexFill,t,!1,r));break;case"line":t.spriteRasterizationParam?n.push(...(0,T.EM)(i.instances.texturedLine,t,!1,r)):n.push(...(0,T.NZ)(i.instances.line,t,!1,r));break;case"text":n.push(...(0,T.IQ)(i.instances.text,t,w.Dk,r))}return n}(t,e,i);return Promise.all(r.map((t=>n.createMeshWriter(this._storage,this._resourceProxy,{tileInfo:this.view.featuresTilingScheme.tileInfo},t))))}_onTileUpdate(t){if(t.added&&t.added.length>0)for(const e of t.added)this._updateTracking.addPromise(this._addTile(e));if(t.removed&&t.removed.length>0)for(const e of t.removed)this._removeTile(e.key)}_createFeatureTile(t){const e=this.view.featuresTilingScheme.getTileBounds((0,f.vt)(),t),i=this.view.featuresTilingScheme.getTileResolution(t.level),n=new x.R(t,i,e[0],e[3]);return this._tiles.set(t,n),this.container.addChild(n),n}async _addTile(t){if(!this._attached)return;const e=this._graphicStore.queryItems(t);if(!e.length)return;const i=this._createFeatureTile(t.key),n=K.fromItems(t,e,this._metadata);await this._fetchResources([n]);const r=this._writeMeshes(n);i.onMessage({type:"append",append:r,clear:!1,end:!0,attributeEpoch:this._attributeStore.epoch,objectIdMap:n.objectIdMap})}_removeTile(t){if(!this._tiles.has(t))return;const e=this._tiles.get(t);this.container.removeChild(e),e.destroy(),this._tiles.delete(t)}_getNullSymbol(t){const e=t.geometry;return(0,p.Rg)(e)?y.x3:(0,p.Bi)(e)||(0,p.ZC)(e)?y.JJ:this.defaultPointSymbolEnabled?y.jM:null}async _getTextResources(t,e){const i=new Array,n=new Array;for(let r=0;r<e.length;r++){const s=e[r],{resource:o,overrides:a}=s.textRasterizationParam;if(a?.length>0){const e=g.$.resolveSymbolOverrides({type:"CIMSymbolReference",primitiveOverrides:a,symbol:{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,size:o.symbol.height,anchorPointUnits:"Relative",frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{x:0,y:0},symbol:o.symbol,textString:o.textString}],scaleSymbolsProportionally:!0,respectFrame:!0}]}},t,this.view.spatialReference,null,(0,p.$B)(t.projectedGeometry),null,null);e.then((t=>{const e=t.symbolLayers[0],{textString:i}=e.markerGraphics[0];n.push({type:"cim-rasterization-info",resource:{type:"text",textString:i||"",font:o.font}}),s.text=o.textString=i||""})),i.push(e)}else n.push({type:"cim-rasterization-info",resource:o})}i.length>0&&await Promise.all(i);const r=n.map((t=>this.view.stage.textureManager.rasterizeItem(t))),s=await Promise.all(r);(0,l.Lw)(s);const o=new Map;for(let t=0;t<e.length;t++){const i=e[t];o.set(i.textRasterizationParam.resource.symbol,{text:i.text,glyphMosaicItems:s[t]})}return o}_cleanupSharedResources(){if(!this._cleanupRequired)return;const t=performance.now();if(t-this._lastCleanup<5e3)return;this._cleanupRequired=!1,this._lastCleanup=t;const e=new Set;for(const t of this._graphicStore.items()){const i=t.symbolResource?.symbolInfo.hash;e.add(i)}const i=new Set(this._hashToSymbolInfo.keys());for(const t of i.values())e.has(t)||this._hashToSymbolInfo.delete(t)}};(0,n._)([(0,h.MZ)()],Q.prototype,"_effectiveRenderer",null),(0,n._)([(0,h.MZ)({constructOnly:!0})],Q.prototype,"layerId",void 0),(0,n._)([(0,h.MZ)({constructOnly:!0})],Q.prototype,"requestUpdateCallback",void 0),(0,n._)([(0,h.MZ)()],Q.prototype,"container",void 0),(0,n._)([(0,h.MZ)({constructOnly:!0})],Q.prototype,"graphics",void 0),(0,n._)([(0,h.MZ)()],Q.prototype,"renderer",void 0),(0,n._)([(0,h.MZ)()],Q.prototype,"_updateTracking",void 0),(0,n._)([(0,h.MZ)()],Q.prototype,"updating",null),(0,n._)([(0,h.MZ)()],Q.prototype,"view",void 0),(0,n._)([(0,h.MZ)()],Q.prototype,"updateRequested",void 0),(0,n._)([(0,h.MZ)()],Q.prototype,"defaultPointSymbolEnabled",void 0),Q=(0,n._)([(0,d.$)("esri.views.2d.layers.graphics.GraphicsView2D")],Q);const J=Q},96700:function(t,e,i){i.d(e,{DF:function(){return a},Lu:function(){return u},RA:function(){return o},hV:function(){return l}});var n=i(13520),r=i(44740),s=(i(87416),i(57652),i(39686));const o=50;function a(t){if(!t)return null;const{xmin:e,ymin:i,xmax:n,ymax:s,spatialReference:o}=t;return new r.A({rings:[[[e,i],[e,s],[n,s],[n,i],[e,i]]],spatialReference:o})}function l(t){return(0,n.PN)(Math.round((0,n.Lz)(t)))}function u(t){const e=(0,n.PN)(s.GR),i=(0,n.PN)(s.cp);return Math.max(e,Math.min(t||i,i))}},21884:function(t,e,i){i.d(e,{A:function(){return o}});var n=i(60539),r=i(60478),s=i(46863);class o{constructor(t){this.updateTracking=new r.F({debugName:"FeatureCommandQueue"}),this._queueProcessor=new s.e({concurrency:1,process:t.process})}destroy(){this.updateTracking.destroy(),this._queueProcessor.destroy(),this.clear()}clear(){this._queueProcessor.clear()}async push(t){return(0,n.QZ)(this.updateTracking.addPromise(this._doPush(t)))}async _doPush(t){const e=this._queueProcessor,i=e.last();switch(t.type){case"update":case"highlight":if(i?.type===t.type)return;return e.push(t);case"edit-by-id":case"edit-by-feature":return e.push(t)}}}},89872:function(t,e,i){i.d(e,{t:function(){return r}});const n=new Set;class r{constructor(){this._idToCounters=new Map}get empty(){return 0===this._idToCounters.size}addGroup(t,e){for(const i of t){let t=this._idToCounters.get(i);t||(t=new Map,this._idToCounters.set(i,t)),t.set(e,(t.get(e)||0)+1)}}deleteGroup(t,e){for(const i of t){const t=this._idToCounters.get(i);if(!t)continue;let n=t.get(e);if(null==n)return;n--,n>0?t.set(e,n):t.delete(e),0===t.size&&this._idToCounters.delete(i)}}getHighlightGroups(t){const e=this._idToCounters.get(t);if(!e)return n;const i=new Set;for(const[t,n]of e)n>0&&i.add(t);return i}ids(){return this._idToCounters.keys()}}},60478:function(t,e,i){i.d(e,{F:function(){return h}});var n=i(53804),r=i(83525),s=i(58941),o=i(62790),a=i(28181),l=i(23502),u=(i(40633),i(13798),i(65953)),c=i(20248);let h=class extends r.A{constructor(t){super(t),this.debugName="",this._updatingHandles=new c.U,this._idToUpdatingState=new o.A}get updating(){const t=this._updatingHandles.updating||Array.from(this._idToUpdatingState.values()).some((t=>t));if((0,s.A)("esri-2d-log-updating")){const e=Array.from(this._idToUpdatingState.entries()).map((([t,e])=>`-> ${t}: ${e}`)).join("\n");console.log(`${this.debugName}: Updating: ${t}\n-> Handles: ${this._updatingHandles.updating}\n${e}`)}return t}addUpdateTracking(t,e){const i=(0,a.watch)((()=>e.updating),(e=>this._idToUpdatingState.set(t,e)),{sync:!0});this.addHandles(i)}addPromise(t){return this._updatingHandles.addPromise(t)}};(0,n._)([(0,l.MZ)({constructOnly:!0})],h.prototype,"debugName",void 0),(0,n._)([(0,l.MZ)({readOnly:!0})],h.prototype,"updating",null),h=(0,n._)([(0,u.$)("esri.views.2d.layers.support.UpdateTracking2D")],h)},54516:function(t,e,i){var n;i.d(e,{c:function(){return n}}),function(t){t[t.Pass=0]="Pass",t[t.Draw=1]="Draw"}(n||(n={}))},90553:function(t,e,i){i.d(e,{L:function(){return l},MX:function(){return o},O_:function(){return a},kL:function(){return u},vA:function(){return s},zH:function(){return c}});var n=i(1932);i(33400),(0,i(41546).vt)();class r{constructor(t){this.message=t}toString(){return`AssertException: ${this.message}`}}function s(t,e="Assertion"){if(!t){const t=new Error(e).stack;throw new r(`${e} at ${t}`)}}function o(t,e){t||(e=e||"",console.warn("Verify failed: "+e+"\n"+new Error("verify").stack))}function a(t,e,i,n){let r,s=(i[0]-t[0])/e[0],o=(n[0]-t[0])/e[0];s>o&&(r=s,s=o,o=r);let a=(i[1]-t[1])/e[1],l=(n[1]-t[1])/e[1];if(a>l&&(r=a,a=l,l=r),s>l||a>o)return!1;a>s&&(s=a),l<o&&(o=l);let u=(i[2]-t[2])/e[2],c=(n[2]-t[2])/e[2];return u>c&&(r=u,u=c,c=r),!(s>c||u>o||(c<o&&(o=c),o<0))}function l(t,e,i,r,s,o=(0,n.vt)()){const a=(r[s]-i[s])*(e[0]-t[0])-(r[0]-i[0])*(e[s]-t[s]),l=(r[0]-i[0])*(t[s]-i[s])-(r[s]-i[s])*(t[0]-i[0]);if(0===a)return!1;const u=l/a;return o[0]=t[0]+u*(e[0]-t[0]),o[1]=t[s]+u*(e[s]-t[s]),!0}function u(t,e){return Math.log(t)/Math.log(e)}function c(t){return 1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&0===t[4]&&1===t[5]&&0===t[6]&&0===t[7]&&0===t[8]&&0===t[9]&&1===t[10]&&0===t[11]&&1===t[15]}},58251:function(t,e,i){i.d(e,{A:function(){return _}});var n=i(53804),r=i(83525),s=i(48996),o=i(88781),a=i(40633),l=i(95929),u=i(62560),c=i(23502),h=(i(58941),i(13798),i(65953)),d=i(20248),f=i(39715);let p=class extends((0,o.sA)((0,u.g)(s.A.EventedMixin(r.A)))){constructor(t){super(t),this._updatingHandles=new d.U,this.layer=null,this.parent=null}initialize(){this.when().catch((t=>{if("layerview:create-error"!==t.name){const e=this.layer&&this.layer.id||"no id",i=this.layer?.title||"no title";a.A.getLogger(this).error("#resolve()",`Failed to resolve layer view (layer title: '${i}', id: '${e}')`,t)}}))}destroy(){this._updatingHandles=(0,l.pR)(this._updatingHandles)}get fullOpacity(){return(this.layer?.opacity??1)*(this.parent?.fullOpacity??1)}get suspended(){return this.destroyed||!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){return!this.suspended&&!0===this.layer?.legendEnabled}get updating(){return!(!this._updatingHandles?.updating&&!this.isUpdating())}get updatingProgress(){return this.updating?0:1}get updateSuspended(){return this.suspended}get visible(){return!0===this.layer?.visible}set visible(t){this._overrideIfSome("visible",t)}get visibleAtCurrentScale(){return!0}get visibleAtCurrentTimeExtent(){const t=this.view.timeExtent,e=this.layer?.visibilityTimeExtent;return!t||!e||!t.intersection(e).isEmpty}canResume(){const t=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return this.visible&&this.layer?.loaded&&!this.parent?.suspended&&this.view?.ready&&(0,f.g7)(t)&&this.visibleAtCurrentScale&&this.visibleAtCurrentTimeExtent||!1}getSuspendInfo(){const t=this.parent?.suspended?this.parent.suspendInfo:{};this.view?.ready||(t.viewNotReady=!0),this.layer&&this.layer.loaded||(t.layerNotLoaded=!0);const e=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return(0,f.g7)(e)&&this.visibleAtCurrentScale||(t.outsideScaleRange=!0),this.visibleAtCurrentTimeExtent||(t.outsideVisibilityTimeExtent=!0),this.visible||(t.layerInvisible=!0),t}isUpdating(){return!1}};(0,n._)([(0,c.MZ)()],p.prototype,"view",void 0),(0,n._)([(0,c.MZ)()],p.prototype,"fullOpacity",null),(0,n._)([(0,c.MZ)()],p.prototype,"layer",void 0),(0,n._)([(0,c.MZ)()],p.prototype,"parent",void 0),(0,n._)([(0,c.MZ)({readOnly:!0})],p.prototype,"suspended",null),(0,n._)([(0,c.MZ)({readOnly:!0})],p.prototype,"suspendInfo",null),(0,n._)([(0,c.MZ)({readOnly:!0})],p.prototype,"legendEnabled",null),(0,n._)([(0,c.MZ)({type:Boolean,readOnly:!0})],p.prototype,"updating",null),(0,n._)([(0,c.MZ)({readOnly:!0})],p.prototype,"updatingProgress",null),(0,n._)([(0,c.MZ)()],p.prototype,"updateSuspended",null),(0,n._)([(0,c.MZ)()],p.prototype,"visible",null),(0,n._)([(0,c.MZ)({readOnly:!0})],p.prototype,"visibleAtCurrentScale",null),(0,n._)([(0,c.MZ)({readOnly:!0})],p.prototype,"visibleAtCurrentTimeExtent",null),p=(0,n._)([(0,h.$)("esri.views.layers.LayerView")],p);const _=p},94548:function(t,e,i){i.d(e,{A:function(){return l}});var n=i(53804),r=i(30905),s=i(23502),o=(i(58941),i(40633),i(13798),i(65953));let a=class extends r.oY{get version(){return this.commitVersionProperties(),(this._get("version")||0)+1}};(0,n._)([(0,s.MZ)({readOnly:!0})],a.prototype,"version",null),a=(0,n._)([(0,o.$)("esri.views.layers.support.ClipArea")],a);const l=a},29627:function(t,e,i){i.d(e,{A:function(){return p}});var n,r=i(53804),s=(i(50917),i(23502)),o=(i(58941),i(40633),i(13798),i(65953)),a=i(46556),l=i(74697),u=i(94548),c=i(91484),h=i(44740);const d={base:a.A,key:"type",typeMap:{extent:c.default,polygon:h.A}};let f=n=class extends u.A{constructor(t){super(t),this.type="geometry",this.geometry=null}clone(){return new n({geometry:this.geometry?.clone()??null})}commitVersionProperties(){this.commitProperty("geometry")}};(0,r._)([(0,s.MZ)({types:d,json:{read:l.rS,write:!0}})],f.prototype,"geometry",void 0),f=n=(0,r._)([(0,o.$)("esri.views.layers.support.Geometry")],f);const p=f},39715:function(t,e,i){function n(t){return t&&"function"==typeof t.highlight}function r(t,e,i){return null==t||t>=i&&(0===e||t<=e)}function s(t,e){if(e&&t){const{minScale:i,maxScale:n}=t;if(function(t,e){return null!=t&&t>0||null!=e&&e>0}(i,n))return r(e,i,n)}return!0}function o(t){return!t?.minScale||!t.maxScale||t.minScale>=t.maxScale}i.d(e,{E5:function(){return s},JU:function(){return r},Of:function(){return n},g7:function(){return o}}),i(39819)},86305:function(t,e,i){i.d(e,{g:function(){return u}});var n=i(50659),r=(i(58941),i(40633)),s=i(24540),o=i(41835),a=i(85456);const l=()=>r.A.getLogger("esri.views.webgl.BufferObject");class u{static createIndex(t,e,i){return new u(t,a.NZ.ELEMENT_ARRAY_BUFFER,e,i)}static createVertex(t,e,i){return new u(t,a.NZ.ARRAY_BUFFER,e,i)}static createUniform(t,e,i){return new u(t,a.NZ.UNIFORM_BUFFER,e,i)}static createPixelPack(t,e=a._U.STREAM_READ,i){const n=new u(t,a.NZ.PIXEL_PACK_BUFFER,e);return i&&n.setSize(i),n}static createPixelUnpack(t,e=a._U.STREAM_DRAW,i){return new u(t,a.NZ.PIXEL_UNPACK_BUFFER,e,i)}static createTransformFeedback(t,e=a._U.STATIC_DRAW,i){const n=new u(t,a.NZ.TRANSFORM_FEEDBACK_BUFFER,e);return n.setSize(i),n}constructor(t,e,i,n){this._context=t,this.bufferType=e,this.usage=i,this._glName=null,this._size=-1,this._indexType=void 0,t.instanceCounter.increment(a.vt.BufferObject,this),this._glName=this._context.gl.createBuffer(),(0,o.Y2)(this._context.gl),n&&this.setData(n)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get usedMemory(){if(this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER){if(this._indexType===a.pe.UNSIGNED_INT)return 4*this._size;if(this._indexType===a.pe.UNSIGNED_SHORT)return 2*this._size}return this._size}get _isVAOAware(){return this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER||this.bufferType===a.NZ.ARRAY_BUFFER}dispose(){this._context?.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(a.vt.BufferObject,this),this._context=null):this._glName&&l().warn("Leaked WebGL buffer object")}setSize(t,e=null){if(this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER&&null!=e)switch(this._indexType=e,e){case a.pe.UNSIGNED_SHORT:t*=2;break;case a.pe.UNSIGNED_INT:t*=4}this._setBufferData(t)}setData(t){if(!t)return;let e=t.byteLength;this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER&&((0,s.mg)(t)?this._indexType=a.pe.UNSIGNED_BYTE:(0,s.jq)(t)?(e/=2,this._indexType=a.pe.UNSIGNED_SHORT):(0,s.XJ)(t)&&(e/=4,this._indexType=a.pe.UNSIGNED_INT)),this._setBufferData(e,t)}_setBufferData(t,e=null){this._size=t;const i=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const n=this._context.gl;null!=e?n.bufferData(this.bufferType,e,this.usage):n.bufferData(this.bufferType,t,this.usage),(0,o.Y2)(n),this._isVAOAware&&this._context.bindVAO(i)}setSubData(t,e,i,n){if(!t)return;const r=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const{gl:s}=this._context;s.bufferSubData(this.bufferType,e*t.BYTES_PER_ELEMENT,t,i,n-i),(0,o.Y2)(s),this._isVAOAware&&this._context.bindVAO(r)}getSubData(t,e=0,i,r){if(i<0||r<0)return;const s=function(t){return(0,n.Xj)(t)}(t)?t.BYTES_PER_ELEMENT:1;if(s*((i??0)+(r??0))>t.byteLength)return;e+s*(r??0)>this.usedMemory&&l().warn("Potential problem getting subdata: requested data exceeds buffer size!");const o=this._context.gl;this.bufferType===a.NZ.TRANSFORM_FEEDBACK_BUFFER?(this._context.bindBuffer(this,a.NZ.TRANSFORM_FEEDBACK_BUFFER),o.getBufferSubData(a.NZ.TRANSFORM_FEEDBACK_BUFFER,e,t,i,r),this._context.unbindBuffer(a.NZ.TRANSFORM_FEEDBACK_BUFFER)):(this._context.bindBuffer(this,a.NZ.COPY_READ_BUFFER),o.getBufferSubData(a.NZ.COPY_READ_BUFFER,e,t,i,r),this._context.unbindBuffer(a.NZ.COPY_READ_BUFFER))}async getSubDataAsync(t,e=0,i,n){await this._context.clientWaitAsync(),this.getSubData(t,e,i,n)}}},96402:function(t,e,i){i.d(e,{H:function(){return h}}),i(58941);var n=i(40633),r=i(95929),s=i(86305),o=i(41835),a=i(85456),l=i(69452),u=i(49414),c=i(12285);class h{constructor(t,e,i=null){this._context=t,this._glName=null,this._colorAttachments=new Map,this._depthStencilBuffer=null,this._depthStencilTexture=null,this._initialized=!1,t.instanceCounter.increment(a.vt.FramebufferObject,this);const n=d(e)?e:new c.g(this._context,e);if(this._colorAttachments.set(a.Nm.COLOR_ATTACHMENT0,n),this._validateTextureDescriptor(n.descriptor),this._validateColorAttachmentPoint(a.Nm.COLOR_ATTACHMENT0),null!=i)if(function(t){return d(t)||null!=t&&"pixelFormat"in t}(i))this._depthStencilTexture=d(i)?i:new c.g(this._context,i),this._validateTextureDescriptor(this._depthStencilTexture.descriptor);else{const t=function(t){return null!=t&&"type"in t&&t.type===l.p.RenderBuffer}(i)?i:new u.l(this._context,i);this._depthStencilBuffer=t,this._validateRenderBufferDescriptor(t.descriptor)}}dispose(){if(0===this._colorAttachments.size&&!this._glName)return;const t=this._context.getBoundFramebufferObject();this._colorAttachments.forEach(((t,e)=>this.detachColorTexture(e)?.dispose())),this.detachDepthStencilBuffer()?.dispose(),this.detachDepthStencilTexture()?.dispose(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(t),this._context.instanceCounter.decrement(a.vt.FramebufferObject,this)}get glName(){return this._glName}get colorTexture(){return this._colorAttachments.get(a.Nm.COLOR_ATTACHMENT0)}get depthStencil(){return this._depthStencilTexture||this._depthStencilBuffer}get depthStencilTexture(){return this._depthStencilTexture}get width(){const t=this._colorAttachments.get(a.Nm.COLOR_ATTACHMENT0);return t?.descriptor?.width??0}get height(){const t=this._colorAttachments.get(a.Nm.COLOR_ATTACHMENT0);return t?.descriptor?.height??0}get usedMemory(){return[...this._colorAttachments].reduce(((t,[e,i])=>t+i.usedMemory),this.depthStencil?.usedMemory??0)}getColorTexture(t){const e=this._colorAttachments.get(t);return e&&d(e)?e:null}get colorAttachments(){return[...this._colorAttachments.keys()]}attachColorTexture(t,e=a.Nm.COLOR_ATTACHMENT0){if(!t)return;this._validateColorAttachmentPoint(e);const i=t.descriptor;this._validateTextureDescriptor(i),this.detachColorTexture(e)?.dispose(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(t.glName,e)),this._colorAttachments.set(e,t)}detachColorTexture(t=a.Nm.COLOR_ATTACHMENT0){const e=this._colorAttachments.get(t);if(e){if(this._initialized){const e=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this),this._framebufferTexture2D(null,t),this._context.bindFramebuffer(e)}return this._colorAttachments.delete(t),e}}setColorTextureTarget(t,e=a.Nm.COLOR_ATTACHMENT0){const i=this._colorAttachments.get(e);i&&this._framebufferTexture2D(i.glName,e,t)}attachDepthStencil(t){if(t)switch(t.type){case l.p.Texture:return this._attachDepthStencilTexture(t);case l.p.RenderBuffer:return this._attachDepthStencilBuffer(t)}}_attachDepthStencilTexture(t){if(null==t)return;const e=t.descriptor;e.pixelFormat!==a.Ab.DEPTH_STENCIL&&e.pixelFormat!==a.Ab.DEPTH24_STENCIL8&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),e.dataType!==a.ld.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._validateTextureDescriptor(e),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(t.glName,a.nI)),this._depthStencilTexture?.dispose(),this._depthStencilTexture=t}detachDepthStencilTexture(){const t=this._depthStencilTexture;if(t&&this._initialized){const t=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this),this._framebufferTexture2D(null,a.nI),this._context.bindFramebuffer(t)}return this._depthStencilTexture=null,t}_attachDepthStencilBuffer(t){if(null==t)return;const e=t.descriptor;if(this._validateRenderBufferDescriptor(e),this._disposeDepthStencilAttachments(),this._initialized){this._context.bindFramebuffer(this);const i=this._context.gl,n=this._getGLAttachmentPoint(e);i.framebufferRenderbuffer(a.R.FRAMEBUFFER,n,i.RENDERBUFFER,t.glName)}this._depthStencilBuffer=t}detachDepthStencilBuffer(){const t=this._depthStencilBuffer;if(t&&this._initialized){const e=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this);const i=this._context.gl,n=this._getGLAttachmentPoint(t.descriptor);i.framebufferRenderbuffer(a.R.FRAMEBUFFER,n,i.RENDERBUFFER,null),this._context.bindFramebuffer(e)}return this._depthStencilBuffer=null,t}copyToTexture(t,e,i,n,r,s,o){(t<0||e<0||r<0||s<0)&&console.error("Offsets cannot be negative!"),(i<=0||n<=0)&&console.error("Copy width and height must be greater than zero!");const l=o.descriptor;o.descriptor.target!==a.Ap.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),(null==l?.width||null==l?.height||t+i>this.width||e+n>this.height||r+i>l.width||s+n>l.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const u=this._context,h=u.bindTexture(o,c.g.TEXTURE_UNIT_FOR_UPDATES);u.setActiveTexture(c.g.TEXTURE_UNIT_FOR_UPDATES),u.bindFramebuffer(this),u.gl.copyTexSubImage2D(a.Ap.TEXTURE_2D,0,r,s,t,e,i,n),u.bindTexture(h,c.g.TEXTURE_UNIT_FOR_UPDATES)}readPixels(t,e,i,n,r,s,o){(i<=0||n<=0)&&console.error("Copy width and height must be greater than zero!"),o||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(t,e,i,n,r,s,o)}async readPixelsAsync(t,e,i,n,r,o,l){const{gl:u}=this._context,c=s.g.createPixelPack(this._context,a._U.STREAM_READ,l.byteLength);this._context.bindBuffer(c);const h=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this),u.readPixels(t,e,i,n,r,o,0),this._context.unbindBuffer(a.NZ.PIXEL_PACK_BUFFER),this._context.bindFramebuffer(h),await c.getSubDataAsync(l),c.dispose()}resize(t,e){if(this.width===t&&this.height===e)return;const i={width:t,height:e};f(i,this._context.parameters.maxTextureSize),this._colorAttachments.forEach((t=>t.resize(i.width,i.height))),this._depthStencilTexture?.resize(i.width,i.height),this._initialized&&(f(i,this._context.parameters.maxRenderbufferSize),this._depthStencilBuffer?.resize(i.width,i.height),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1)}initializeAndBind(t=a.R.FRAMEBUFFER){const e=this._context.gl;if(this._initialized)return void e.bindFramebuffer(t,this.glName);this._glName&&e.deleteFramebuffer(this._glName);const i=e.createFramebuffer();if(e.bindFramebuffer(t,i),this._colorAttachments.forEach(((e,i)=>this._framebufferTexture2D(e.glName,i,p(e),t))),this._depthStencilBuffer){const i=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);e.framebufferRenderbuffer(t,i,e.RENDERBUFFER,this._depthStencilBuffer.glName)}else this._depthStencilTexture&&this._framebufferTexture2D(this._depthStencilTexture.glName,e.DEPTH_STENCIL_ATTACHMENT,p(this._depthStencilTexture),t);(0,o.en)()&&e.checkFramebufferStatus(t)!==e.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=i,this._initialized=!0}_framebufferTexture2D(t,e=a.Nm.COLOR_ATTACHMENT0,i=a.Ap.TEXTURE_2D,n=a.R.FRAMEBUFFER,r=0){this._context.gl.framebufferTexture2D(n,e,i,t,r)}_disposeDepthStencilAttachments(){const t=this._context.gl;if(this._depthStencilBuffer){if(this._initialized){this._context.bindFramebuffer(this);const e=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);t.framebufferRenderbuffer(a.R.FRAMEBUFFER,e,t.RENDERBUFFER,null)}this._depthStencilBuffer=(0,r.WD)(this._depthStencilBuffer)}this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,t.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture=(0,r.WD)(this._depthStencilTexture))}_validateTextureDescriptor(t){t.target!==a.Ap.TEXTURE_2D&&t.target!==a.Ap.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),f(t,this._context.parameters.maxTextureSize),this._validateBufferDimensions(t)}_validateRenderBufferDescriptor(t){f(t,this._context.parameters.maxRenderbufferSize),this._validateBufferDimensions(t)}_validateBufferDimensions(t){t.width<=0&&(t.width=this.width),t.height<=0&&(t.height=this.height),this.width>0&&this.height>0&&(this.width===t.width&&this.height===t.height||console.error("Attachment size must match framebuffer size!"))}_getGLAttachmentPoint(t){switch(t.internalFormat){case a.yQ.DEPTH_COMPONENT16:case a.yQ.DEPTH_COMPONENT24:case a.yQ.DEPTH_COMPONENT32F:return this._context.gl.DEPTH_ATTACHMENT;case a.yQ.DEPTH24_STENCIL8:case a.yQ.DEPTH32F_STENCIL8:case a.yQ.DEPTH_STENCIL:return this._context.gl.DEPTH_STENCIL_ATTACHMENT;case a.yQ.STENCIL_INDEX8:return this._context.gl.STENCIL_ATTACHMENT}}_validateColorAttachmentPoint(t){if(-1===h._MAX_COLOR_ATTACHMENTS){const{gl:t}=this._context;h._MAX_COLOR_ATTACHMENTS=t.getParameter(t.MAX_COLOR_ATTACHMENTS)}const e=t-a.Nm.COLOR_ATTACHMENT0;e+1>h._MAX_COLOR_ATTACHMENTS&&n.A.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${e+1}. Implementation supports up to ${h._MAX_COLOR_ATTACHMENTS} color attachments`)}}function d(t){return null!=t&&"type"in t&&t.type===l.p.Texture}function f(t,e){const i=Math.max(t.width,t.height);if(i>e){n.A.getLogger("esri.views.webgl.FramebufferObject").warn(`Resizing FBO attachment size ${t.width}x${t.height} to device limit ${e}`);const r=e/i;return t.width=Math.round(t.width*r),t.height=Math.round(t.height*r),!1}return!0}function p(t){return t.descriptor.target===a.Ap.TEXTURE_CUBE_MAP?a.Ap.TEXTURE_CUBE_MAP_POSITIVE_X:a.Ap.TEXTURE_2D}h._MAX_COLOR_ATTACHMENTS=-1},95904:function(t,e,i){i.d(e,{B:function(){return x}}),i(58941);var n=i(41835),r=i(85456);const s=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"],o=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"],a=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"],l=["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT","textureSize","texelFetch"];var u=999,c=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function h(t){return function(t){var e=function(){var t,e,i,n=0,r=0,s=u,h=[],d=[],f=1,p=0,_=0,m=!1,g=!1,y="";return function(t){return d=[],null!==t?x(t.replace?t.replace(/\r\n/g,"\n"):t):(h.length&&v(h.join("")),s=10,v("(eof)"),d)};function v(t){t.length&&d.push({type:c[s],data:t,position:_,line:f,column:p})}function x(e){var o;for(n=0,i=(y+=e).length;t=y[n],n<i;){switch(o=n,s){case 0:n=T();break;case 1:case 2:n=w();break;case 3:n=P();break;case 4:n=A();break;case 11:n=M();break;case 5:n=C();break;case 9999:n=E();break;case 9:n=S();break;case u:n=b()}o!==n&&("\n"===y[o]?(p=0,++f):++p)}return r+=n,y=y.slice(n),d}function b(){return h=h.length?[]:h,"/"===e&&"*"===t?(_=r+n-1,s=0,e=t,n+1):"/"===e&&"/"===t?(_=r+n-1,s=1,e=t,n+1):"#"===t?(s=2,_=r+n,n):/\s/.test(t)?(s=9,_=r+n,n):(m=/\d/.test(t),g=/[^\w_]/.test(t),_=r+n,s=m?4:g?3:9999,n)}function S(){return/[^\s]/g.test(t)?(v(h.join("")),s=u,n):(h.push(t),e=t,n+1)}function w(){return"\r"!==t&&"\n"!==t||"\\"===e?(h.push(t),e=t,n+1):(v(h.join("")),s=u,n)}function T(){return"/"===t&&"*"===e?(h.push(t),v(h.join("")),s=u,n+1):(h.push(t),e=t,n+1)}function P(){if("."===e&&/\d/.test(t))return s=5,n;if("/"===e&&"*"===t)return s=0,n;if("/"===e&&"/"===t)return s=1,n;if("."===t&&h.length){for(;I(h););return s=5,n}if(";"===t||")"===t||"("===t){if(h.length)for(;I(h););return v(t),s=u,n+1}var i=2===h.length&&"="!==t;if(/[\w_\d\s]/.test(t)||i){for(;I(h););return s=u,n}return h.push(t),e=t,n+1}function I(t){for(var e,i,n=0;;){if(e=a.indexOf(t.slice(0,t.length+n).join("")),i=a[e],-1===e){if(n--+t.length>0)continue;i=t.slice(0,1).join("")}return v(i),_+=i.length,(h=h.slice(i.length)).length}}function M(){return/[^a-fA-F0-9]/.test(t)?(v(h.join("")),s=u,n):(h.push(t),e=t,n+1)}function A(){return"."===t||/[eE]/.test(t)?(h.push(t),s=5,e=t,n+1):"x"===t&&1===h.length&&"0"===h[0]?(s=11,h.push(t),e=t,n+1):/[^\d]/.test(t)?(v(h.join("")),s=u,n):(h.push(t),e=t,n+1)}function C(){return"f"===t&&(h.push(t),e=t,n+=1),/[eE]/.test(t)||"-"===t&&/[eE]/.test(e)?(h.push(t),e=t,n+1):/[^\d]/.test(t)?(v(h.join("")),s=u,n):(h.push(t),e=t,n+1)}function E(){if(/[^\d\w_]/.test(t)){var i=h.join("");return s=o.indexOf(i)>-1?8:l.indexOf(i)>-1?7:6,v(h.join("")),s=u,n}return h.push(t),e=t,n+1}}(),i=[];return(i=i.concat(e(t))).concat(e(null))}(t)}const d=new Set(["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"]);function f(t,e){for(let i=e-1;i>=0;i--){const e=t[i];if("whitespace"!==e.type&&"block-comment"!==e.type){if("keyword"!==e.type)break;if("attribute"===e.data||"in"===e.data)return!0}}return!1}function p(t,e,i,n){n=n||i;for(const r of t)if("ident"===r.type&&r.data===i)return n in e?e[n]++:e[n]=0,p(t,e,n+"_"+e[n],n);return i}function _(t,e,i="afterVersion"){function n(t,e){for(let i=e;i<t.length;i++){const e=t[i];if("operator"===e.type&&";"===e.data)return i}return null}const r={data:"\n",type:"whitespace"},s=e=>e<t.length&&/[^\r\n]$/.test(t[e].data);let o=function(t){let e=-1,r=0,s=-1;for(let o=0;o<t.length;o++){const a=t[o];if("preprocessor"===a.type&&(/#(if|ifdef|ifndef)\s+.+/.test(a.data)?++r:/#endif\s*.*/.test(a.data)&&--r),"afterVersion"!==i&&"afterPrecision"!==i||"preprocessor"===a.type&&a.data.startsWith("#version")&&(s=Math.max(s,o)),"afterPrecision"===i&&"keyword"===a.type&&"precision"===a.data){const e=n(t,o);if(null===e)throw new Error("precision statement not followed by any semicolons!");s=Math.max(s,e)}e<s&&0===r&&(e=o)}return e+1}(t);s(o-1)&&t.splice(o++,0,r);for(const i of e)t.splice(o++,0,i);s(o-1)&&s(o)&&t.splice(o,0,r)}function m(t,e,i,n="lowp"){_(t,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:n},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function g(t,e,i,n,r="lowp"){_(t,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:n.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function y(t,e){let i,n,r=-1;for(let s=e;s<t.length;s++){const e=t[s];if("operator"===e.type&&("["===e.data&&(i=s),"]"===e.data)){n=s;break}"integer"===e.type&&(r=parseInt(e.data,10))}return i&&n&&t.splice(i,n-i+1),r}function v(t,e){if(t.startsWith("#version 300"))return t;const i=h(t);if("300 es"===function(t,e="100",i="300 es"){const n=/^\s*#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const r of t)if("preprocessor"===r.type){const t=n.exec(r.data);if(t){const n=t[1].replaceAll(/\s{2,}/g," ");if(n===i)return n;if(n===e)return r.data="#version "+i,e;throw new Error("unknown glsl version: "+n)}}return t.splice(0,0,{type:"preprocessor",data:"#version "+i},{type:"whitespace",data:"\n"}),null}(i,"100","300 es"))return t;let n=null,o=null;const a={},l={};for(let t=0;t<i.length;++t){const u=i[t];switch(u.type){case"keyword":e===r.Co.VERTEX_SHADER&&"attribute"===u.data?u.data="in":"varying"===u.data&&(u.data=e===r.Co.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(u.data.trim())&&(u.data=u.data.replaceAll(/(2D|Cube|EXT)/g,"")),e===r.Co.FRAGMENT_SHADER&&"gl_FragColor"===u.data&&(n||(n=p(i,a,"fragColor"),m(i,n,"vec4")),u.data=n),e===r.Co.FRAGMENT_SHADER&&"gl_FragData"===u.data){const e=y(i,t+1),n=p(i,a,"fragData");g(i,n,"vec4",e,"mediump"),u.data=n}else e===r.Co.FRAGMENT_SHADER&&"gl_FragDepthEXT"===u.data&&(o||(o=p(i,a,"gl_FragDepth")),u.data=o);break;case"ident":if(s.includes(u.data)){if(e===r.Co.VERTEX_SHADER&&f(i,t))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");u.data in l||(l[u.data]=p(i,a,u.data)),u.data=l[u.data]}}}for(let t=i.length-1;t>=0;--t){const e=i[t];if("preprocessor"===e.type){const n=e.data.match(/#extension\s+(.*):/);if(n?.[1]&&d.has(n[1].trim())){const e=i[t+1];i.splice(t,e&&"whitespace"===e.type?2:1)}const r=e.data.match(/#ifdef\s+(.*)/);r?.[1]&&d.has(r[1].trim())&&(e.data="#if 1");const s=e.data.match(/#ifndef\s+(.*)/);s?.[1]&&d.has(s[1].trim())&&(e.data="#if 0")}}return u=function(t){return t.map((t=>"eof"!==t.type?t.data:"")).join("")}(i),u;var u}new Map;class x{constructor(t,e,i,s,o=new Map,a=[]){this._context=t,this._locations=s,this._uniformBlockBindings=o,this._transformFeedbackVaryings=a,this._refCount=1,this._compiled=!1,this._linesOfCode=0,this._nameToUniformLocation=new Map,this._nameToUniform1=new Map,this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,t||console.error("RenderingContext isn't initialized!"),0===e.length&&console.error("Shaders source should not be empty!"),e=v(e,r.Co.VERTEX_SHADER),i=v(i,r.Co.FRAGMENT_SHADER),this._vShader=b(this._context,r.Co.VERTEX_SHADER,e),this._fShader=b(this._context,r.Co.FRAGMENT_SHADER,i),w.enabled&&(this._linesOfCode=e.match(/\n/g).length+i.match(/\n/g).length+2,this._context.instanceCounter.increment(r.vt.LinesOfCode,this._vShader,this._linesOfCode)),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(r.vt.Shader,this),(0,n.Xc)()&&(this.vertexShader=e,this.fragmentShader=i),this.usedMemory=e.length+i.length;const l=this._context.gl,u=l.createProgram();l.attachShader(u,this._vShader),l.attachShader(u,this._fShader),this._locations.forEach(((t,e)=>l.bindAttribLocation(u,t,e))),this._transformFeedbackVaryings?.length&&l.transformFeedbackVaryings(u,this._transformFeedbackVaryings,l.SEPARATE_ATTRIBS),l.linkProgram(u),(0,n.Xc)()&&!l.getProgramParameter(u,l.LINK_STATUS)&&console.error(`Could not link shader\nvalidated: ${l.getProgramParameter(u,l.VALIDATE_STATUS)}, gl error ${l.getError()}, vertex: ${l.getShaderParameter(this._vShader,l.COMPILE_STATUS)}, fragment: ${l.getShaderParameter(this._fShader,l.COMPILE_STATUS)}, info log: ${l.getProgramInfoLog(u)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`);for(const[t,e]of this._uniformBlockBindings){const i=l.getUniformBlockIndex(u,t);i<4294967295&&l.uniformBlockBinding(u,i,e)}this._glName=u,this._context.instanceCounter.increment(r.vt.Program,this)}get glName(){return this._glName}get hasGLName(){return null!=this._glName}get hasTransformFeedbackVaryings(){return!!this._transformFeedbackVaryings?.length}get compiled(){if(this._compiled)return!0;const t=this._context.gl.getExtension("KHR_parallel_shader_compile");return null==t||null==this.glName?(this._compiled=!0,!0):(this._compiled=!!this._context.gl.getProgramParameter(this.glName,t.COMPLETION_STATUS_KHR),this._compiled)}dispose(){if(--this._refCount>0)return;const t=this._context.gl,e=this._context.instanceCounter;this._nameToUniformLocation.forEach((t=>t&&e.decrement(r.vt.Uniform,t))),this._nameToUniformLocation.clear(),this._vShader&&(this._linesOfCode>0&&(e.decrement(r.vt.LinesOfCode,this._vShader,this._linesOfCode),this._linesOfCode=0),t.deleteShader(this._vShader),this._vShader=null,e.decrement(r.vt.Shader,this)),this._fShader&&(t.deleteShader(this._fShader),this._fShader=null),this._glName&&(t.deleteProgram(this._glName),this._glName=null,e.decrement(r.vt.Program,this))}ref(){++this._refCount}_getUniformLocation(t){const e=this._nameToUniformLocation.get(t);if(void 0!==e)return e;if(this.glName){const e=this._context.gl.getUniformLocation(this.glName,t);return this._nameToUniformLocation.set(t,e),e&&this._context.instanceCounter.increment(r.vt.Uniform,e),e}return null}hasUniform(t){return null!=this._getUniformLocation(t)}setUniform1i(t,e){const i=this._nameToUniform1.get(t);void 0!==i&&e===i||(this._context.gl.uniform1i(this._getUniformLocation(t),e),this._nameToUniform1.set(t,e))}setUniform1iv(t,e){S(this._nameToUniform1v,t,e)&&this._context.gl.uniform1iv(this._getUniformLocation(t),e)}setUniform2iv(t,e){S(this._nameToUniform2,t,e)&&this._context.gl.uniform2iv(this._getUniformLocation(t),e)}setUniform3iv(t,e){S(this._nameToUniform3,t,e)&&this._context.gl.uniform3iv(this._getUniformLocation(t),e)}setUniform4iv(t,e){S(this._nameToUniform4,t,e)&&this._context.gl.uniform4iv(this._getUniformLocation(t),e)}setUniform1f(t,e){const i=this._nameToUniform1.get(t);void 0!==i&&e===i||(this._context.gl.uniform1f(this._getUniformLocation(t),e),this._nameToUniform1.set(t,e))}setUniform1fv(t,e){S(this._nameToUniform1v,t,e)&&this._context.gl.uniform1fv(this._getUniformLocation(t),e)}setUniform2f(t,e,i){const n=this._nameToUniform2.get(t);void 0===n?(this._context.gl.uniform2f(this._getUniformLocation(t),e,i),this._nameToUniform2.set(t,[e,i])):e===n[0]&&i===n[1]||(this._context.gl.uniform2f(this._getUniformLocation(t),e,i),n[0]=e,n[1]=i)}setUniform2fv(t,e){S(this._nameToUniform2,t,e)&&this._context.gl.uniform2fv(this._getUniformLocation(t),e)}setUniform3f(t,e,i,n){const r=this._nameToUniform3.get(t);void 0===r?(this._context.gl.uniform3f(this._getUniformLocation(t),e,i,n),this._nameToUniform3.set(t,[e,i,n])):e===r[0]&&i===r[1]&&n===r[2]||(this._context.gl.uniform3f(this._getUniformLocation(t),e,i,n),r[0]=e,r[1]=i,r[2]=n)}setUniform3fv(t,e){const i=this._getUniformLocation(t);null!=i&&S(this._nameToUniform3,t,e)&&this._context.gl.uniform3fv(i,e)}setUniform4f(t,e,i,n,r){const s=this._nameToUniform4.get(t);void 0===s?(this._context.gl.uniform4f(this._getUniformLocation(t),e,i,n,r),this._nameToUniform4.set(t,[e,i,n,r])):void 0!==s&&e===s[0]&&i===s[1]&&n===s[2]&&r===s[3]||(this._context.gl.uniform4f(this._getUniformLocation(t),e,i,n,r),s[0]=e,s[1]=i,s[2]=n,s[3]=r)}setUniform4fv(t,e){const i=this._getUniformLocation(t);null!=i&&S(this._nameToUniform4,t,e)&&this._context.gl.uniform4fv(i,e)}setUniformMatrix3fv(t,e,i=!1){const n=this._getUniformLocation(t);null!=n&&S(this._nameToUniformMatrix3,t,e)&&this._context.gl.uniformMatrix3fv(n,i,e)}setUniformMatrix4fv(t,e,i=!1){const n=this._getUniformLocation(t);null!=n&&S(this._nameToUniformMatrix4,t,e)&&this._context.gl.uniformMatrix4fv(n,i,e)}stop(){}}function b(t,e,i){const s=t.gl,o=s.createShader(e);return s.shaderSource(o,i),s.compileShader(o),(0,n.Xc)()&&!s.getShaderParameter(o,s.COMPILE_STATUS)&&(console.error("Compile error in ".concat(e===r.Co.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(s.getShaderInfoLog(o)),console.error(function(t){let e=2;return t.replaceAll("\n",(()=>"\n"+function(t){return t>=1e3?t.toString():("  "+t).slice(-3)}(e++)+":"))}(i))),o}function S(t,e,i){const n=t.get(e);if(!n)return t.set(e,Array.from(i)),!0;const r=i.length;if(n.length!==r)return t.set(e,Array.from(i)),!0;for(let t=0;t<r;++t){const e=i[t];if(n[t]!==e){for(n[t]=e;t<r;++t)n[t]=i[t];return!0}}return!1}const w={enabled:!1}},10904:function(t,e,i){i.d(e,{r:function(){return r}});var n=i(95904);function r(t,e,i=""){return new n.B(t,i+e.shaders.vertexShader,i+e.shaders.fragmentShader,e.attributes)}},49414:function(t,e,i){i.d(e,{l:function(){return o}});var n=i(85456),r=i(69452),s=i(15167);class o{constructor(t,e){this._context=t,this._descriptor=e,this.type=r.p.RenderBuffer,this._context.instanceCounter.increment(n.vt.Renderbuffer,this);const i=this._context.gl;this.glName=i.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:s,height:o,internalFormat:a,multisampled:l}=e;l?i.renderbufferStorageMultisample(i.RENDERBUFFER,this.samples,a,s,o):i.renderbufferStorage(i.RENDERBUFFER,a,s,o),this._context.bindRenderbuffer(null)}get descriptor(){return this._descriptor}get samples(){const t=this._descriptor.samples,e=this._context.parameters.maxSamples;return t?Math.min(t,e):e}get usedMemory(){return(0,s.e)(this._descriptor)}resize(t,e){const i=this._descriptor;if(i.width===t&&i.height===e)return;i.width=t,i.height=e;const n=this._context.gl;this._context.bindRenderbuffer(this),i.multisampled?n.renderbufferStorageMultisample(n.RENDERBUFFER,this.samples,i.internalFormat,i.width,i.height):n.renderbufferStorage(n.RENDERBUFFER,i.internalFormat,i.width,i.height),this._context.bindRenderbuffer(null)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(n.vt.Renderbuffer,this),this._context=null)}}},15167:function(t,e,i){i.d(e,{e:function(){return s},q:function(){return r}});var n=i(93380);class r{constructor(t,e,i=e){this.internalFormat=t,this.width=e,this.height=i,this.multisampled=!1,this.samples=1}}function s(t){return t.width<=0||t.height<=0||null==t.internalFormat?0:t.width*t.height*(0,n.IB)(t.internalFormat)}},65644:function(t,e,i){i.d(e,{Z:function(){return n}});class n{constructor(t){this._readFile=t}resolveIncludes(t){return this._resolve(t)}_resolve(t,e=new Map){if(e.has(t))return e.get(t);const i=this._read(t);if(!i)throw new Error(`cannot find shader file ${t}`);const n=/^[^\S\n]*#include\s+<(\S+)>[^\S\n]?/gm;let r=n.exec(i);const s=[];for(;null!=r;)s.push({path:r[1],start:r.index,length:r[0].length}),r=n.exec(i);let o=0,a="";return s.forEach((t=>{a+=i.slice(o,t.start),a+=e.has(t.path)?"":this._resolve(t.path,e),o=t.start+t.length})),a+=i.slice(o),e.set(t,a),a}_read(t){return this._readFile(t)}}},81438:function(t,e,i){i.d(e,{Z:function(){return u}});var n=i(40633),r=i(95929),s=i(24540),o=i(85456),a=i(93380);const l=()=>n.A.getLogger("esri.views.webgl.VertexArrayObject");let u=class{constructor(t,e,i,n,r=null){this._context=t,this._locations=e,this._layout=i,this._buffers=n,this._indexBuffer=r,this._glName=null,this._initialized=!1}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get byteSize(){return Array.from(this._buffers.values()).reduce(((t,e)=>t+e.usedMemory),null!=this._indexBuffer?this._indexBuffer.usedMemory:0)}get layout(){return this._layout}get locations(){return this._locations}get usedMemory(){return this.byteSize+(Object.keys(this._buffers).length+(this._indexBuffer?1:0))*s.zQ}dispose(){this._context?(this._context.getBoundVAO()===this&&this._context.bindVAO(null),this._buffers.forEach((t=>t.dispose())),this._buffers.clear(),this._indexBuffer=(0,r.WD)(this._indexBuffer),this.disposeVAOOnly()):(this._glName||Object.getOwnPropertyNames(this._buffers).length>0)&&l().warn("Leaked WebGL VAO")}disposeVAOOnly(){this._glName&&(this._context.gl.deleteVertexArray(this._glName),this._glName=null,this._context.instanceCounter.decrement(o.vt.VertexArrayObject,this)),this._context=null}initialize(){if(this._initialized)return;const{gl:t}=this._context,e=t.createVertexArray();t.bindVertexArray(e),this._bindLayout(),t.bindVertexArray(null),this._glName=e,this._context.instanceCounter.increment(o.vt.VertexArrayObject,this),this._initialized=!0}bind(){this.initialize(),this._context.gl.bindVertexArray(this.glName)}_bindLayout(){const{_buffers:t,_layout:e,_indexBuffer:i}=this;t||l().error("Vertex buffer dictionary is empty!");const n=this._context.gl;this._buffers.forEach(((t,i)=>{const n=e.get(i);n?(0,a.yu)(this._context,this._locations,t,n):l().error("Vertex element descriptor is empty!")})),null!=i&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,i.glName)}unbind(){this.initialize(),this._context.gl.bindVertexArray(null)}}}}]);
//# sourceMappingURL=layers-GraphicsLayerView2D.js.map