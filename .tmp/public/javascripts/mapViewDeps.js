"use strict";(self.webpackChunkdefra=self.webpackChunkdefra||[]).push([[6022],{9688:function(t,e,i){i.d(e,{lY:function(){return h},mT:function(){return d}});var n,r=i(50944),s=i(92955),o=i(96285);(n||(n={})).TimeZoneNotRecognized="TimeZoneNotRecognized";const a={[n.TimeZoneNotRecognized]:"Timezone identifier has not been recognized."};class l extends Error{constructor(t,e){super((0,r.HC)(a[t],e)),this.declaredRootClass="esri.arcade.arcadedate.dateerror",Error.captureStackTrace&&Error.captureStackTrace(this,l)}}function c(t,e,i){return t<e?t-e:t>i?t-i:0}function u(t,e,i){return t<e?e:t>i?i:t}class h{constructor(t){this._date=t,this.declaredRootClass="esri.arcade.arcadedate"}static fromParts(t=0,e=1,i=1,n=0,r=0,s=0,a=0,l){if(isNaN(t)||isNaN(e)||isNaN(i)||isNaN(n)||isNaN(r)||isNaN(s)||isNaN(a))return null;const f=o.c9.local(t,e).daysInMonth;let p=o.c9.fromObject({day:u(i,1,f),year:t,month:u(e,1,12),hour:u(n,0,23),minute:u(r,0,59),second:u(s,0,59),millisecond:u(a,0,999)},{zone:d(l)});return p=p.plus({months:c(e,1,12),days:c(i,1,f),hours:c(n,0,23),minutes:c(r,0,59),seconds:c(s,0,59),milliseconds:c(a,0,999)}),new h(p)}static get systemTimeZoneCanonicalName(){return Intl.DateTimeFormat().resolvedOptions().timeZone??"system"}static arcadeDateAndZoneToArcadeDate(t,e){const i=d(e);return t.isUnknownTimeZone||i===s.GB.instance?h.fromParts(t.year,t.monthJS+1,t.day,t.hour,t.minute,t.second,t.millisecond,i):new h(t._date.setZone(i))}static dateJSToArcadeDate(t){return new h(o.c9.fromJSDate(t,{zone:"system"}))}static dateJSAndZoneToArcadeDate(t,e="system"){const i=d(e);return new h(o.c9.fromJSDate(t,{zone:i}))}static unknownEpochToArcadeDate(t){return new h(o.c9.fromMillis(t,{zone:s.GB.instance}))}static unknownDateJSToArcadeDate(t){return new h(o.c9.fromMillis(t.getTime(),{zone:s.GB.instance}))}static epochToArcadeDate(t,e="system"){const i=d(e);return new h(o.c9.fromMillis(t,{zone:i}))}static dateTimeToArcadeDate(t){return new h(t)}clone(){return new h(this._date)}changeTimeZone(t){const e=d(t);return h.dateTimeToArcadeDate(this._date.setZone(e))}static dateTimeAndZoneToArcadeDate(t,e){const i=d(e);return t.zone===s.GB.instance||i===s.GB.instance?h.fromParts(t.year,t.month,t.day,t.hour,t.minute,t.second,t.millisecond,i):new h(t.setZone(i))}static nowToArcadeDate(t){const e=d(t);return new h(o.c9.fromJSDate(new Date,{zone:e}))}static nowUTCToArcadeDate(){return new h(o.c9.utc())}get isSystem(){return"system"===this.timeZone||this.timeZone===h.systemTimeZoneCanonicalName}equals(t){return this.isSystem&&t.isSystem?this.toNumber()===t.toNumber():this.isUnknownTimeZone===t.isUnknownTimeZone&&this._date.equals(t._date)}get isUnknownTimeZone(){return this._date.zone===s.GB.instance}get isValid(){return this._date.isValid}get hour(){return this._date.hour}get second(){return this._date.second}get day(){return this._date.day}get dayOfWeekISO(){return this._date.weekday}get dayOfWeekJS(){let t=this._date.weekday;return t>6&&(t=0),t}get millisecond(){return this._date.millisecond}get monthISO(){return this._date.month}get weekISO(){return this._date.weekNumber}get yearISO(){return this._date.weekYear}get monthJS(){return this._date.month-1}get year(){return this._date.year}get minute(){return this._date.minute}get zone(){return this._date.zone}get timeZoneOffset(){return this.isUnknownTimeZone?0:this._date.offset}get timeZone(){if(this.isUnknownTimeZone)return"unknown";if("system"===this._date.zone.type)return"system";const t=this.zone;return"fixed"===t.type?0===t.fixed?"UTC":t.formatOffset(0,"short"):t.name}stringify(){return JSON.stringify(this.toJSDate())}plus(t){return new h(this._date.plus(t))}diff(t,e="milliseconds"){return this._date.diff(t._date,e)[e]}toISODate(){return this._date.toISODate()}toISOString(t){return t?this._date.toISO({suppressMilliseconds:!0,includeOffset:!this.isUnknownTimeZone}):this._date.toISO({includeOffset:!this.isUnknownTimeZone})}toISOTime(t,e){return this._date.toISOTime({suppressMilliseconds:t,includeOffset:e&&!this.isUnknownTimeZone})}toFormat(t,e){return this.isUnknownTimeZone&&(t=t.replaceAll("Z","")),this._date.toFormat(t,e)}toJSDate(){return this._date.toJSDate()}toSQLValue(){return this._date.toFormat("yyyy-LL-dd HH:mm:ss")}toSQLWithKeyword(){return`timestamp '${this.toSQLValue()}'`}toDateTime(){return this._date}toNumber(){return this._date.toMillis()}getTime(){return this._date.toMillis()}toUTC(){return new h(this._date.toUTC())}toLocal(){return new h(this._date.toLocal())}toString(){return this.toISOString(!0)}static fromReaderAsTimeStampOffset(t){if(!t)return null;const e=o.c9.fromISO(t,{setZone:!0});return new h(e)}}function d(t,e=!0){if(t instanceof o.bo)return t;if("system"===t.toLowerCase())return"system";if("utc"===t.toLowerCase())return"UTC";if("unknown"===t.toLowerCase())return s.GB.instance;if(/^[+-]?[0-9]{1,2}([:][0-9]{2})?$/.test(t)){const e=o.mQ.parseSpecifier("UTC"+(t.startsWith("+")||t.startsWith("-")?"":"+")+t);if(e)return e}const i=o.oh.create(t);if(!i.isValid){if(e)throw new l(n.TimeZoneNotRecognized);return null}return i}},80749:function(t,e,i){i.d(e,{Fq:function(){return l},SQ:function(){return o},Yc:function(){return s},Yq:function(){return a},uf:function(){return r}});var n=i(91484);function r(t){if(null==t)return null;if("number"==typeof t)return t;let e=t.toLowerCase();switch(e=e.replaceAll(/\s/g,""),e=e.replaceAll("-",""),e){case"meters":case"meter":case"m":case"squaremeters":case"squaremeter":return 109404;case"miles":case"mile":case"squaremile":case"squaremiles":return 109439;case"kilometers":case"kilometer":case"squarekilometers":case"squarekilometer":case"km":return 109414;case"acres":case"acre":case"ac":return 109402;case"hectares":case"hectare":case"ha":return 109401;case"yard":case"yd":case"yards":case"squareyards":case"squareyard":return 109442;case"feet":case"ft":case"foot":case"squarefeet":case"squarefoot":return 109405;case"nmi":case"nauticalmile":case"nauticalmiles":case"squarenauticalmile":case"squarenauticalmiles":return 109409}return null}function s(t){if(null==t)return null;switch(t.type){case"polygon":case"multipoint":case"polyline":return t.extent;case"point":return new n.default({xmin:t.x,ymin:t.y,xmax:t.x,ymax:t.y,spatialReference:t.spatialReference});case"extent":return t}return null}function o(t){if(null==t)return null;if("number"==typeof t)return t;let e=t.toLowerCase();switch(e=e.replaceAll(/\s/g,""),e=e.replaceAll("-",""),e){case"meters":case"meter":case"m":case"squaremeters":case"squaremeter":return 9001;case"miles":case"mile":case"squaremile":case"squaremiles":return 9093;case"kilometers":case"kilometer":case"squarekilometers":case"squarekilometer":case"km":return 9036;case"yard":case"yd":case"yards":case"squareyards":case"squareyard":return 9096;case"feet":case"ft":case"foot":case"squarefeet":case"squarefoot":return 9002;case"nmi":case"nauticalmile":case"nauticalmiles":case"squarenauticalmile":case"squarenauticalmiles":return 9030}return null}function a(t){if(null==t)return null;const e=t.clone();return void 0!==t.cache._geVersion&&(e.cache._geVersion=t.cache._geVersion),e}function l(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t}},59122:function(t,e,i){function n(t,e,i){i=i||2;var n,s,a,l,c,u,d,f=e&&e.length,p=f?e[0]*i:t.length,_=r(t,0,p,i,!0),m=[];if(!_||_.next===_.prev)return m;if(f&&(_=h(t,e,_,i)),t.length>80*i){n=a=t[0],s=l=t[1];for(var g=i;g<p;g+=i)(c=t[g])<n&&(n=c),(u=t[g+1])<s&&(s=u),c>a&&(a=c),u>l&&(l=u);d=0!==(d=Math.max(a-n,l-s))?1/d:0}return o(_,m,i,n,s,d),m}function r(t,e,i,n,r){var s,o;if(r===R(t,e,i,n)>0)for(s=e;s<i;s+=n)o=C(s,t[s],t[s+1],o);else for(s=i-n;s>=e;s-=n)o=C(s,t[s],t[s+1],o);if(o&&S(o,o.next)){var a=o.next;I(o),o=a}return o}function s(t,e){if(!t)return t;e||(e=t);var i,n=t;do{if(i=!1,n.steiner||!S(n,n.next)&&0!==b(n.prev,n,n.next))n=n.next;else{var r=n.prev;if(I(n),(n=e=r)===n.next)break;i=!0}}while(i||n!==e);return e}function o(t,e,i,n,r,h,d){if(t){!d&&h&&m(t,n,r,h);for(var f,p,_=t;t.prev!==t.next;)if(f=t.prev,p=t.next,h?l(t,n,r,h):a(t))e.push(f.i/i),e.push(t.i/i),e.push(p.i/i),I(t),t=p.next,_=p.next;else if((t=p)===_){d?1===d?o(t=c(s(t),e,i),e,i,n,r,h,2):2===d&&u(t,e,i,n,r,h):o(s(t),e,i,n,r,h,1);break}}}function a(t){var e=t.prev,i=t,n=t.next;if(b(e,i,n)>=0)return!1;for(var r=t.next.next;r!==t.prev;){if(v(e.x,e.y,i.x,i.y,n.x,n.y,r.x,r.y)&&b(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function l(t,e,i,n){var r=t.prev,s=t,o=t.next;if(b(r,s,o)>=0)return!1;for(var a=r.x<s.x?r.x<o.x?r.x:o.x:s.x<o.x?s.x:o.x,l=r.y<s.y?r.y<o.y?r.y:o.y:s.y<o.y?s.y:o.y,c=r.x>s.x?r.x>o.x?r.x:o.x:s.x>o.x?s.x:o.x,u=r.y>s.y?r.y>o.y?r.y:o.y:s.y>o.y?s.y:o.y,h=g(a,l,e,i,n),d=g(c,u,e,i,n),f=t.prevZ,p=t.nextZ;f&&f.z>=h&&p&&p.z<=d;){if(f!==t.prev&&f!==t.next&&v(r.x,r.y,s.x,s.y,o.x,o.y,f.x,f.y)&&b(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,p!==t.prev&&p!==t.next&&v(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&b(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;f&&f.z>=h;){if(f!==t.prev&&f!==t.next&&v(r.x,r.y,s.x,s.y,o.x,o.y,f.x,f.y)&&b(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;p&&p.z<=d;){if(p!==t.prev&&p!==t.next&&v(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&b(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function c(t,e,i){var n=t;do{var r=n.prev,o=n.next.next;!S(r,o)&&w(r,n,n.next,o)&&P(r,o)&&P(o,r)&&(e.push(r.i/i),e.push(n.i/i),e.push(o.i/i),I(n),I(n.next),n=t=o),n=n.next}while(n!==t);return s(n)}function u(t,e,i,n,r,a){var l=t;do{for(var c=l.next.next;c!==l.prev;){if(l.i!==c.i&&x(l,c)){var u=A(l,c);return l=s(l,l.next),u=s(u,u.next),o(l,e,i,n,r,a),void o(u,e,i,n,r,a)}c=c.next}l=l.next}while(l!==t)}function h(t,e,i,n){var o,a,l,c=[];for(o=0,a=e.length;o<a;o++)(l=r(t,e[o]*n,o<a-1?e[o+1]*n:t.length,n,!1))===l.next&&(l.steiner=!0),c.push(y(l));for(c.sort(d),o=0;o<c.length;o++)i=s(i=p(c[o],i),i.next);return i}function d(t,e){return t.x-e.x}function f(t){if(t.next.prev===t)return t;let e=t;for(;;){const i=e.next;if(i.prev===e||i===e||i===t)break;e=i}return e}function p(t,e){var i=function(t,e){var i,n=e,r=t.x,s=t.y,o=-1/0;do{if(s<=n.y&&s>=n.next.y&&n.next.y!==n.y){var a=n.x+(s-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=r&&a>o){if(o=a,a===r){if(s===n.y)return n;if(s===n.next.y)return n.next}i=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!i)return null;if(r===o)return i;var l,c=i,u=i.x,h=i.y,d=1/0;n=i;do{r>=n.x&&n.x>=u&&r!==n.x&&v(s<h?r:o,s,u,h,s<h?o:r,s,n.x,n.y)&&(l=Math.abs(s-n.y)/(r-n.x),P(n,t)&&(l<d||l===d&&(n.x>i.x||n.x===i.x&&_(i,n)))&&(i=n,d=l)),n=n.next}while(n!==c);return i}(t,e);if(!i)return e;var n=A(i,t),r=s(i,i.next);let o=f(n);return s(o,o.next),r=f(r),f(e===i?r:e)}function _(t,e){return b(t.prev,t,e.prev)<0&&b(e.next,t,t.next)<0}function m(t,e,i,n){var r=t;do{null===r.z&&(r.z=g(r.x,r.y,e,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){var e,i,n,r,s,o,a,l,c=1;do{for(i=t,t=null,s=null,o=0;i;){for(o++,n=i,a=0,e=0;e<c&&(a++,n=n.nextZ);e++);for(l=c;a>0||l>0&&n;)0!==a&&(0===l||!n||i.z<=n.z)?(r=i,i=i.nextZ,a--):(r=n,n=n.nextZ,l--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;i=n}s.nextZ=null,c*=2}while(o>1)}(r)}function g(t,e,i,n,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function y(t){var e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function v(t,e,i,n,r,s,o,a){return(r-o)*(e-a)-(t-o)*(s-a)>=0&&(t-o)*(n-a)-(i-o)*(e-a)>=0&&(i-o)*(s-a)-(r-o)*(n-a)>=0}function x(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&w(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(P(t,e)&&P(e,t)&&function(t,e){var i=t,n=!1,r=(t.x+e.x)/2,s=(t.y+e.y)/2;do{i.y>s!=i.next.y>s&&i.next.y!==i.y&&r<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==t);return n}(t,e)&&(b(t.prev,t,e.prev)||b(t,e.prev,e))||S(t,e)&&b(t.prev,t,t.next)>0&&b(e.prev,e,e.next)>0)}function b(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function S(t,e){return t.x===e.x&&t.y===e.y}function w(t,e,i,n){var r=M(b(t,e,i)),s=M(b(t,e,n)),o=M(b(i,n,t)),a=M(b(i,n,e));return r!==s&&o!==a||!(0!==r||!T(t,i,e))||!(0!==s||!T(t,n,e))||!(0!==o||!T(i,t,n))||!(0!==a||!T(i,e,n))}function T(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function M(t){return t>0?1:t<0?-1:0}function P(t,e){return b(t.prev,t,t.next)<0?b(t,e,t.next)>=0&&b(t,t.prev,e)>=0:b(t,e,t.prev)<0||b(t,t.next,e)<0}function A(t,e){var i=new E(t.i,t.x,t.y),n=new E(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,n.next=i,i.prev=n,s.next=n,n.prev=s,n}function C(t,e,i,n){var r=new E(t,e,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function I(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function E(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function R(t,e,i,n){for(var r=0,s=e,o=i-n;s<i;s+=n)r+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return r}i.d(e,{e:function(){return n}}),n.deviation=function(t,e,i,n){var r=e&&e.length,s=r?e[0]*i:t.length,o=Math.abs(R(t,0,s,i));if(r)for(var a=0,l=e.length;a<l;a++){var c=e[a]*i,u=a<l-1?e[a+1]*i:t.length;o-=Math.abs(R(t,c,u,i))}var h=0;for(a=0;a<n.length;a+=3){var d=n[a]*i,f=n[a+1]*i,p=n[a+2]*i;h+=Math.abs((t[d]-t[p])*(t[f+1]-t[d+1])-(t[d]-t[f])*(t[p+1]-t[d+1]))}return 0===o&&0===h?0:Math.abs((h-o)/o)},n.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},n=0,r=0;r<t.length;r++){for(var s=0;s<t[r].length;s++)for(var o=0;o<e;o++)i.vertices.push(t[r][s][o]);r>0&&(n+=t[r-1].length,i.holes.push(n))}return i}},67750:function(t,e,i){i.d(e,{A:function(){return M}});const n=[["(",")"],[")","("],["<",">"],[">","<"],["[","]"],["]","["],["{","}"],["}","{"],["«","»"],["»","«"],["‹","›"],["›","‹"],["⁽","⁾"],["⁾","⁽"],["₍","₎"],["₎","₍"],["≤","≥"],["≥","≤"],["〈","〉"],["〉","〈"],["﹙","﹚"],["﹚","﹙"],["﹛","﹜"],["﹜","﹛"],["﹝","﹞"],["﹞","﹝"],["﹤","﹥"],["﹥","﹤"]],r=["آ","أ","إ","ا"],s=["ﻵ","ﻷ","ﻹ","ﻻ"],o=["ﻶ","ﻸ","ﻺ","ﻼ"],a=["ا","ب","ت","ث","ج","ح","خ","د","ذ","ر","ز","س","ش","ص","ض","ط","ظ","ع","غ","ف","ق","ك","ل","م","ن","ه","و","ي","إ","أ","آ","ة","ى","ل","م","ن","ه","و","ي","إ","أ","آ","ة","ى","ی","ئ","ؤ"],l=["ﺍ","ﺏ","ﺕ","ﺙ","ﺝ","ﺡ","ﺥ","ﺩ","ﺫ","ﺭ","ﺯ","ﺱ","ﺵ","ﺹ","ﺽ","ﻁ","ﻅ","ﻉ","ﻍ","ﻑ","ﻕ","ﻙ","ﻝ","ﻡ","ﻥ","ﻩ","ﻭ","ﻱ","ﺇ","ﺃ","ﺁ","ﺓ","ﻯ","ﯼ","ﺉ","ﺅ","ﹰ","ﹲ","ﹴ","ﹶ","ﹸ","ﹺ","ﹼ","ﹾ","ﺀ","ﺉ","ﺅ"],c=["ﺎ","ﺐ","ﺖ","ﺚ","ﺞ","ﺢ","ﺦ","ﺪ","ﺬ","ﺮ","ﺰ","ﺲ","ﺶ","ﺺ","ﺾ","ﻂ","ﻆ","ﻊ","ﻎ","ﻒ","ﻖ","ﻚ","ﻞ","ﻢ","ﻦ","ﻪ","ﻮ","ﻲ","ﺈ","ﺄ","ﺂ","ﺔ","ﻰ","ﯽ","ﺊ","ﺆ","ﹰ","ﹲ","ﹴ","ﹶ","ﹸ","ﹺ","ﹼ","ﹾ","ﺀ","ﺊ","ﺆ"],u=["ﺎ","ﺒ","ﺘ","ﺜ","ﺠ","ﺤ","ﺨ","ﺪ","ﺬ","ﺮ","ﺰ","ﺴ","ﺸ","ﺼ","ﻀ","ﻄ","ﻈ","ﻌ","ﻐ","ﻔ","ﻘ","ﻜ","ﻠ","ﻤ","ﻨ","ﻬ","ﻮ","ﻴ","ﺈ","ﺄ","ﺂ","ﺔ","ﻰ","ﯿ","ﺌ","ﺆ","ﹱ","ﹲ","ﹴ","ﹷ","ﹹ","ﹻ","ﹽ","ﹿ","ﺀ","ﺌ","ﺆ"],h=["ﺍ","ﺑ","ﺗ","ﺛ","ﺟ","ﺣ","ﺧ","ﺩ","ﺫ","ﺭ","ﺯ","ﺳ","ﺷ","ﺻ","ﺿ","ﻃ","ﻇ","ﻋ","ﻏ","ﻓ","ﻗ","ﻛ","ﻟ","ﻣ","ﻧ","ﻫ","ﻭ","ﻳ","ﺇ","ﺃ","ﺁ","ﺓ","ﻯ","ﯾ","ﺋ","ﺅ","ﹰ","ﹲ","ﹴ","ﹶ","ﹸ","ﹺ","ﹼ","ﹾ","ﺀ","ﺋ","ﺅ"],d=["ء","آ","أ","ؤ","إ","ا","ة","د","ذ","ر","ز","و","ى"],f=["ً","ً","ٌ","؟","ٍ","؟","َ","َ","ُ","ُ","ِ","ِ","ّ","ّ","ْ","ْ","ء","آ","آ","أ","أ","ؤ","ؤ","إ","إ","ئ","ئ","ئ","ئ","ا","ا","ب","ب","ب","ب","ة","ة","ت","ت","ت","ت","ث","ث","ث","ث","ج","ج","ج","ج","ح","ح","ح","ح","خ","خ","خ","خ","د","د","ذ","ذ","ر","ر","ز","ز","س","س","س","س","ش","ش","ش","ش","ص","ص","ص","ص","ض","ض","ض","ض","ط","ط","ط","ط","ظ","ظ","ظ","ظ","ع","ع","ع","ع","غ","غ","غ","غ","ف","ف","ف","ف","ق","ق","ق","ق","ك","ك","ك","ك","ل","ل","ل","ل","م","م","م","م","ن","ن","ن","ن","ه","ه","ه","ه","و","و","ى","ى","ي","ي","ي","ي","ﻵ","ﻶ","ﻷ","ﻸ","ﻹ","ﻺ","ﻻ","ﻼ","؟","؟","؟"],p=["ء","ف"],_=["غ","ي"],m=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],g=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],y=10,v=11,x=12,b=18,S=["UBAT_L","UBAT_R","UBAT_EN","UBAT_AN","UBAT_ON","UBAT_B","UBAT_S","UBAT_AL","UBAT_WS","UBAT_CS","UBAT_ES","UBAT_ET","UBAT_NSM","UBAT_LRE","UBAT_RLE","UBAT_PDF","UBAT_LRO","UBAT_RLO","UBAT_BN"],w=[100,0,0,0,0,101,102,103,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,104,4,4,4,0,4,0,4,0,4,4,4,0,0,4,4,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,4,4,0,0,4,4,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,0,105,7,7,106,107],T=[[b,b,b,b,b,b,b,b,b,6,5,6,8,5,b,b,b,b,b,b,b,b,b,b,b,b,b,b,5,5,5,6,8,4,4,v,v,v,4,4,4,4,4,y,9,y,9,9,2,2,2,2,2,2,2,2,2,2,9,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,b,b,b,b,b,b,5,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,9,4,v,v,v,v,4,4,4,4,0,4,4,b,4,4,v,v,2,2,4,0,4,4,4,2,0,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,4,4,4,4,4,4,4,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,1,x,1,x,x,1,x,x,1,x,4,4,4,4,4,4,4,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4,4,4,4,4,1,1,1,1,1,4,4,4,4,4,4,4,4,4,4,4],[3,3,3,3,4,4,4,4,7,v,v,7,9,7,4,4,x,x,x,x,x,x,x,x,x,x,x,7,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,3,3,3,3,3,3,3,3,3,3,v,3,3,7,7,7,x,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,x,x,x,x,x,x,x,3,4,x,x,x,x,x,x,7,7,x,x,4,x,x,x,x,7,7,2,2,2,2,2,2,2,2,2,2,7,7,7,7,7,7],[7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,7,7,x,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,x,x,x,x,x,x,x,x,x,x,x,7,4,4,4,4,4,4,4,4,4,4,4,4,4,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,x,x,x,x,x,x,x,x,x,1,1,4,4,4,4,1,4,4,4,4,4],[8,8,8,8,8,8,8,8,8,8,8,b,b,b,0,1,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,8,5,13,14,15,16,17,9,v,v,v,v,v,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,9,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,8,b,b,b,b,b,4,4,4,4,4,b,b,b,b,b,b,2,0,4,4,2,2,2,2,2,2,y,y,4,4,4,0,2,2,2,2,2,2,2,2,2,2,y,y,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,4,4,4,4,4,1,x,1,1,1,1,1,1,1,1,1,1,y,1,1,1,1,1,1,1,1,1,1,1,1,1,4,1,1,1,1,1,4,1,4,1,1,4,1,1,4,1,1,1,1,1,1,1,1,1,1,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],[x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,x,x,x,x,x,x,x,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,9,4,9,4,4,9,4,4,4,4,4,4,4,4,4,v,4,4,y,y,4,4,4,4,4,v,v,4,4,4,4,4,7,7,7,7,7,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,4,b],[4,4,4,v,v,v,4,4,4,4,4,y,9,y,9,9,2,2,2,2,2,2,2,2,2,2,9,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,0,0,0,0,0,0,4,4,0,0,0,0,0,0,4,4,0,0,0,0,0,0,4,4,0,0,0,4,4,4,v,v,4,4,4,v,v,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4]];class M{constructor(){this.inputFormat="ILYNN",this.outputFormat="VLNNN",this.sourceToTarget=[],this.targetToSource=[],this.levels=[]}bidiTransform(t,e,i){if(this.sourceToTarget=[],this.targetToSource=[],!t)return"";if(function(t,e,i){q=[],j=[];for(let n=0;n<i;n++)t[n]=n,e[n]=n,q[n]=n}(this.sourceToTarget,this.targetToSource,t.length),!this.checkParameters(e,i))return t;e=this.inputFormat,i=this.outputFormat;let n=t;const a=X,u=Y(e.charAt(1)),d=Y(i.charAt(1)),p=("I"===e.charAt(0)?"L":e.charAt(0))+u,_=("I"===i.charAt(0)?"L":i.charAt(0))+d,m=e.charAt(2)+i.charAt(2);a.defInFormat=p,a.defOutFormat=_,a.defSwap=m;const g=P(t,p,_,m,a);let y=!1;return"R"===i.charAt(1)?y=!0:"C"!==i.charAt(1)&&"D"!==i.charAt(1)||(y="rtl"===this.checkContextual(g)),this.sourceToTarget=q,this.targetToSource=function(t){const e=new Array(t.length);for(let i=0;i<t.length;i++)e[t[i]]=i;return e}(this.sourceToTarget),$=this.targetToSource,n=e.charAt(3)===i.charAt(3)?g:"S"===i.charAt(3)?function(t,e){if(0===e.length)return"";void 0===t&&(t=!0);const i=(e=String(e)).split("");let n=0,r=1,a=i.length;t||(n=i.length-1,r=-1,a=1);const u=function(t,e,i,n){let r=0;const a=[];let u=0;for(let d=e;d*i<n;d+=i)if(F(t[d])||G(t[d])){if("ل"===t[d]&&D(t,d+i,i,n)){t[d]=H(t[d+i],0===r?s:o),d+=i,W(t,d,i,n),a[u]=d,u++,r=0;continue}const e=t[d];1===r?t[d]=z(t,d+i,i,n)?V(t[d]):U(t[d],c):!0===z(t,d+i,i,n)?t[d]=U(t[d],h):t[d]=U(t[d],l),G(e)||(r=1),!0===B(e)&&(r=0)}else r=0;return a}(i,n,r,a);let d="";for(let e=0;e<i.length;e++)O(u,u.length,e)>-1?(Z($,e,!t,-1),q.splice(e,1)):d+=i[e];return d}(y,g):function(t,e){if(0===t.length)return"";void 0===e&&(e=!0);let i="";const n=(t=String(t)).split("");for(let s=0;s<t.length;s++){let o=!1;if(n[s]>="ﹰ"&&n[s]<"\ufeff"){const a=t.charCodeAt(s);n[s]>="ﻵ"&&n[s]<="ﻼ"?(e?(s>0&&" "===n[s-1]?i=i.slice(0,-1)+"ل":(i+="ل",o=!0),i+=r[(a-65269)/2]):(i+=r[(a-65269)/2],i+="ل",s+1<t.length&&" "===n[s+1]?s++:o=!0),o&&(Z($,s,!0,1),q.splice(s,0,q[s]))):i+=f[a-65136]}else i+=n[s]}return i}(g,y),this.sourceToTarget=q,this.targetToSource=$,this.levels=j,n}_inputFormatSetter(t){if(!et.test(t))throw new Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.inputFormat=t}_outputFormatSetter(t){if(!et.test(t))throw new Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.outputFormat=t}checkParameters(t,e){return t?this._inputFormatSetter(t):t=this.inputFormat,e?this._outputFormatSetter(e):e=this.outputFormat,t!==e}checkContextual(t){let e=A(t);if("ltr"!==e&&"rtl"!==e){try{e=document.dir.toLowerCase()}catch(t){}"ltr"!==e&&"rtl"!==e&&(e="ltr")}return e}hasBidiChar(t){return it.test(t)}}function P(t,e,i,n,r){const s=function(t,e,i){if(void 0===e.inFormat&&(e.inFormat=i.defInFormat),void 0===e.outFormat&&(e.outFormat=i.defOutFormat),void 0===e.swap&&(e.swap=i.defSwap),e.inFormat===e.outFormat)return e;const n=e.inFormat.slice(0,1),r=e.outFormat.slice(0,1);let s,o=e.inFormat.slice(1,4),a=e.outFormat.slice(1,4);return"C"===o.charAt(0)&&(s=A(t),o="ltr"===s||"rtl"===s?s.toUpperCase():"L"===e.inFormat.charAt(2)?"LTR":"RTL",e.inFormat=n+o),"C"===a.charAt(0)&&(s=A(t),"rtl"===s?a="RTL":"ltr"===s?(s=function(t){const e=t.split("");return e.reverse(),A(e.join(""))}(t),a=s.toUpperCase()):a="L"===e.outFormat.charAt(2)?"LTR":"RTL",e.outFormat=r+a),e}(t,{inFormat:e,outFormat:i,swap:n},r);if(s.inFormat===s.outFormat)return t;e=s.inFormat,i=s.outFormat,n=s.swap;const o=e.slice(0,1),a=e.slice(1,4),l=i.slice(0,1),c=i.slice(1,4);if(r.inFormat=e,r.outFormat=i,r.swap=n,"L"===o&&"VLTR"===i){if("LTR"===a)return r.dir=J,C(t,r);if("RTL"===a)return r.dir=tt,C(t,r)}if("V"===o&&"V"===l)return r.dir="RTL"===a?tt:J,R(t,r);if("L"===o&&"VRTL"===i)return"LTR"===a?(r.dir=J,t=C(t,r)):(r.dir=tt,t=C(t,r)),R(t);if("VLTR"===e&&"LLTR"===i)return r.dir=J,C(t,r);if("V"===o&&"L"===l&&a!==c)return t=R(t),"RTL"===a?P(t,"LLTR","VLTR",n,r):P(t,"LRTL","VRTL",n,r);if("VRTL"===e&&"LRTL"===i)return P(t,"LRTL","VRTL",n,r);if("L"===o&&"L"===l){const e=r.swap;return r.swap=e.slice(0,1)+"N","RTL"===a?(r.dir=tt,t=C(t,r),r.swap="N"+e.slice(1,3),r.dir=J,t=C(t,r)):(r.dir=J,t=C(t,r),r.swap="N"+e.slice(1,3),t=P(t,"VLTR","LRTL",r.swap,r)),t}return t}function A(t){const e=/[A-Za-z\u05d0-\u065f\u066a-\u06ef\u06fa-\u07ff\ufb1d-\ufdff\ufe70-\ufefc]/.exec(t);return e?e[0]<="z"?"ltr":"rtl":""}function C(t,e){const i=t.split(""),n=[];return I(i,n,e),function(t,e,i){if(0!==i.hiLevel&&i.swap[0]!==i.swap[1])for(let i=0;i<t.length;i++)1===e[i]&&(t[i]=N(t[i]))}(i,n,e),L(2,i,n,e),L(1,i,n,e),j=n,i.join("")}function I(t,e,i){const n=t.length,r=i.dir?g:m;let s=0,o=-1;const a=[],l=[];i.hiLevel=i.dir,i.lastArabic=!1,i.hasUbatAl=!1,i.hasUbatB=!1,i.hasUbatS=!1;for(let e=0;e<n;e++)a[e]=E(t[e]);for(let c=0;c<n;c++){const n=s,u=k(t,a,l,c,i);l[c]=u,s=r[n][u];const h=240&s;s&=15;const d=r[s][K];if(e[c]=d,h>0)if(16===h){for(let t=o;t<c;t++)e[t]=1;o=-1}else o=-1;if(r[s][Q])-1===o&&(o=c);else if(o>-1){for(let t=o;t<c;t++)e[t]=d;o=-1}5===a[c]&&(e[c]=0),i.hiLevel|=d}i.hasUbatS&&function(t,e,i,n){for(let r=0;r<i;r++)if(6===t[r]){e[r]=n.dir;for(let i=r-1;i>=0&&8===t[i];i--)e[i]=n.dir}}(a,e,n,i)}function E(t){const e=t.charCodeAt(0),i=w[e>>8];return i<100?i:T[i-100][255&e]}function R(t,e){const i=t.split("");if(e){const t=[];I(i,t,e),j=t}return i.reverse(),q.reverse(),i.join("")}function O(t,e,i){for(let n=0;n<e;n++)if(t[n]===i)return n;return-1}function F(t){for(let e=0;e<p.length;e++)if(t>=p[e]&&t<=_[e])return!0;return!1}function z(t,e,i,n){for(;e*i<n&&G(t[e]);)e+=i;return!!(e*i<n&&F(t[e]))}function D(t,e,i,n){for(;e*i<n&&G(t[e]);)e+=i;let s=" ";if(!(e*i<n))return!1;s=t[e];for(let t=0;t<r.length;t++)if(r[t]===s)return!0;return!1}function L(t,e,i,n){if(n.hiLevel<t)return;if(1===t&&n.dir===tt&&!n.hasUbatB)return e.reverse(),void q.reverse();const r=e.length;let s,o,a,l,c,u=0;for(;u<r;){if(i[u]>=t){for(s=u+1;s<r&&i[s]>=t;)s++;for(o=u,a=s-1;o<a;o++,a--)l=e[o],e[o]=e[a],e[a]=l,c=q[o],q[o]=q[a],q[a]=c;u=s}u++}}function k(t,e,i,n,r){const s=e[n];return{UBAT_L:()=>(r.lastArabic=!1,0),UBAT_R:()=>(r.lastArabic=!1,1),UBAT_ON:()=>4,UBAT_AN:()=>3,UBAT_EN:()=>r.lastArabic?3:2,UBAT_AL:()=>(r.lastArabic=!0,r.hasUbatAl=!0,1),UBAT_WS:()=>4,UBAT_CS:()=>{let t,s;return n<1||n+1>=e.length||2!==(t=i[n-1])&&3!==t||2!==(s=e[n+1])&&3!==s?4:(r.lastArabic&&(s=3),s===t?s:4)},UBAT_ES:()=>2===(n>0?i[n-1]:5)&&n+1<e.length&&2===e[n+1]?2:4,UBAT_ET:()=>{if(n>0&&2===i[n-1])return 2;if(r.lastArabic)return 4;let t=n+1;const s=e.length;for(;t<s&&e[t]===v;)t++;return t<s&&2===e[t]?2:4},UBAT_NSM:()=>{if("VLTR"===r.inFormat){const i=e.length;let r=n+1;for(;r<i&&e[r]===x;)r++;if(r<i){const i=t[n].charCodeAt(0),s=i>=1425&&i<=2303||64286===i,o=e[r];if(s&&(1===o||7===o))return 1}}return n<1||5===e[n-1]?4:i[n-1]},UBAT_B:()=>(r.lastArabic=!0,r.hasUbatB=!0,r.dir),UBAT_S:()=>(r.hasUbatS=!0,4),UBAT_LRE:()=>(r.lastArabic=!1,4),UBAT_RLE:()=>(r.lastArabic=!1,4),UBAT_LRO:()=>(r.lastArabic=!1,4),UBAT_RLO:()=>(r.lastArabic=!1,4),UBAT_PDF:()=>(r.lastArabic=!1,4),UBAT_BN:()=>4}[S[s]]()}function N(t){let e,i=0,r=n.length-1;for(;i<=r;)if(e=Math.floor((i+r)/2),t<n[e][0])r=e-1;else{if(!(t>n[e][0]))return n[e][1];i=e+1}return t}function B(t){for(let e=0;e<d.length;e++)if(d[e]===t)return!0;return!1}function V(t){for(let e=0;e<a.length;e++)if(t===a[e])return u[e];return t}function U(t,e){for(let i=0;i<a.length;i++)if(t===a[i])return e[i];return t}function G(t){return t>="ً"&&t<="ٕ"}function Y(t){return"L"===t?"LTR":"R"===t?"RTL":"C"===t?"CLR":"D"===t?"CRL":""}function W(t,e,i,n){for(;e*i<n&&G(t[e]);)e+=i;return e*i<n&&(t[e]=" ",!0)}function H(t,e){for(let i=0;i<r.length;i++)if(t===r[i])return e[i];return t}function Z(t,e,i,n){for(let r=0;r<t.length;r++)(t[r]>e||!i&&t[r]===e)&&(t[r]+=n)}let q=[],$=[],j=[];const X={dir:0,defInFormat:"LLTR",defoutFormat:"VLTR",defSwap:"YN",inFormat:"LLTR",outFormat:"VLTR",swap:"YN",hiLevel:0,lastArabic:!1,hasUbatAl:!1,hasBlockSep:!1,hasSegSep:!1,defOutFormat:""},K=5,Q=6,J=0,tt=1,et=/^[(I|V)][(L|R|C|D)][(Y|N)][(S|N)][N]$/,it=/[\u0591-\u06ff\ufb1d-\ufefc]/},90152:function(t,e,i){i.d(e,{y:function(){return r}});const n=new(i(67750).A);function r(t){if(null==t)return["",!1];if(!n.hasBidiChar(t))return[t,!1];let e;return e="rtl"===n.checkContextual(t)?"IDNNN":"ICNNN",[n.bidiTransform(t,e,"VLYSN"),!0]}},42827:function(t,e,i){i.d(e,{A:function(){return n}});class n{constructor(t){this.size=0,this._start=0,this.maxSize=t,this._buffer=new Array(t)}get entries(){return this._buffer}enqueue(t){if(this.size===this.maxSize){const e=this._buffer[this._start];return this._buffer[this._start]=t,this._start=(this._start+1)%this.maxSize,e}return this._buffer[(this._start+this.size++)%this.maxSize]=t,null}dequeue(){if(0===this.size)return null;const t=this._buffer[this._start];return this._buffer[this._start]=null,this.size--,this._start=(this._start+1)%this.maxSize,t}peek(){return 0===this.size?null:this._buffer[this._start]}peekLast(){return 0===this.size?null:this._buffer[(this._start+(this.size-1))%this.maxSize]}find(t){if(0===this.size)return null;for(const e of this._buffer)if(null!=e&&t(e))return e;return null}clear(t){let e=this.dequeue();for(;null!=e;)t&&t(e),e=this.dequeue()}}},7970:function(t,e,i){i.d(e,{O:function(){return n}});class n{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return 0===this._outer.size}get(t,e){return this._outer.get(t)?.get(e)}getInner(t){return this._outer.get(t)}set(t,e,i){const n=this._outer.get(t);n?n.set(e,i):this._outer.set(t,new Map([[e,i]]))}delete(t,e){const i=this._outer.get(t);i&&(i.delete(e),0===i.size&&this._outer.delete(t))}forEach(t){this._outer.forEach(((e,i)=>t(e,i)))}forAll(t){for(const e of this._outer.values())for(const i of e.values())t(i)}}},5161:function(t,e,i){i.d(e,{T:function(){return s},U:function(){return r}});var n=i(15774);function r(t,e,i=0){const r=(0,n.qE)(t,0,l);for(let t=0;t<4;t++)e[i+t]=Math.floor(256*c(r*o[t]))}function s(t,e=0){let i=0;for(let n=0;n<4;n++)i+=t[e+n]*a[n];return i}const o=[1,256,65536,16777216],a=[1/256,1/65536,1/16777216,1/4294967296],l=s(new Uint8ClampedArray([255,255,255,255]));function c(t){return t-Math.floor(t)}},80683:function(t,e,i){i.d(e,{Al:function(){return c},NZ:function(){return u},Vb:function(){return r},af:function(){return h},rK:function(){return d}});var n=i(25591);const r="arial-unicode-ms",s="woff2",o=new Map,a=new Set;class l{constructor(t,e){this.fontFace=t,this.promise=e}}async function c(t){const e=f(t),i=d(t),r=o.get(e);if(r)return r.promise;const c=new FontFace(t.family,`url('${n.default.fontsUrl}/woff2/${i}.${s}') format('${s}')`,{style:t.style,weight:t.weight}),u=document.fonts;if(u.has(c)&&"loading"===c.status)return c.loaded;const h=c.load().then((()=>(u.add(c),c)));return o.set(e,new l(c,h)),a.add(c),h}function u(t){return a.has(t)}function h(t){if(!t)return r;const e=t.toLowerCase().split(" ").join("-");switch(e){case"serif":return"noto-serif";case"sans-serif":return"arial-unicode-ms";case"monospace":return"ubuntu-mono";case"fantasy":return"cabin-sketch";case"cursive":return"redressed";default:return e}}function d(t){const e=p(t)+_(t);return h(t.family)+(e.length>0?e:"-regular")}function f(t){const e=p(t)+_(t);return(t.family||r)+(e.length>0?e:"-regular")}function p(t){if(!t.weight)return"";switch(t.weight.toLowerCase()){case"bold":case"bolder":return"-bold"}return""}function _(t){if(!t.style)return"";switch(t.style.toLowerCase()){case"italic":case"oblique":return"-italic"}return""}},43274:function(t,e,i){function n(){return new Float32Array(3)}function r(t){const e=new Float32Array(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function s(t,e,i){const n=new Float32Array(3);return n[0]=t,n[1]=e,n[2]=i,n}function o(){return n()}function a(){return s(1,1,1)}function l(){return s(1,0,0)}function c(){return s(0,1,0)}function u(){return s(0,0,1)}i.d(e,{fA:function(){return s},o8:function(){return r},vt:function(){return n}});const h=o(),d=a(),f=l(),p=c(),_=u();Object.freeze(Object.defineProperty({__proto__:null,ONES:d,UNIT_X:f,UNIT_Y:p,UNIT_Z:_,ZEROS:h,clone:r,create:n,createView:function(t,e){return new Float32Array(t,e,3)},fromValues:s,ones:a,unitX:l,unitY:c,unitZ:u,zeros:o},Symbol.toStringTag,{value:"Module"}))},43745:function(t,e,i){function n(){return new Float32Array(4)}function r(t,e,i,n){const r=new Float32Array(4);return r[0]=t,r[1]=e,r[2]=i,r[3]=n,r}function s(){return n()}function o(){return r(1,1,1,1)}function a(){return r(1,0,0,0)}function l(){return r(0,1,0,0)}function c(){return r(0,0,1,0)}function u(){return r(0,0,0,1)}i.d(e,{fA:function(){return r}});const h=s(),d=o(),f=a(),p=l(),_=c(),m=u();Object.freeze(Object.defineProperty({__proto__:null,ONES:d,UNIT_W:m,UNIT_X:f,UNIT_Y:p,UNIT_Z:_,ZEROS:h,clone:function(t){const e=new Float32Array(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},create:n,createView:function(t,e){return new Float32Array(t,e,4)},fromValues:r,ones:o,unitW:u,unitX:a,unitY:l,unitZ:c,zeros:s},Symbol.toStringTag,{value:"Module"}))},68225:function(t,e,i){i.d(e,{A:function(){return u}});var n,r,s=i(58941),o=i(56996);(r=n||(n={}))[r.varint=0]="varint",r[r.fixed64=1]="fixed64",r[r.delimited=2]="delimited",r[r.fixed32=5]="fixed32",r[r.unknown=99]="unknown";const a=4294967296,l=new TextDecoder("utf-8"),c=(0,s.A)("safari")||(0,s.A)("ios")?6:(0,s.A)("ff")?12:32;class u{constructor(t,e,i=0,r=(t?t.byteLength:0)){this._tag=0,this._dataType=n.unknown,this._init(t,e,i,r)}_init(t,e,i,n){this._data=t,this._dataView=e,this._pos=i,this._end=n}asUnsafe(){return this}clone(){return new u(this._data,this._dataView,this._pos,this._end)}pos(){return this._pos}move(t){this._pos=t}nextTag(t){for(;;){if(this._pos===this._end)return!1;const e=this._decodeVarint();if(this._tag=e>>3,this._dataType=7&e,!t||t===this._tag)break;this.skip()}return!0}next(){if(this._pos===this._end)return!1;const t=this._decodeVarint();return this._tag=t>>3,this._dataType=7&t,!0}empty(){return this._pos>=this._end}tag(){return this._tag}getInt32(){return this._decodeVarint()}getInt64(){return this._decodeVarint()}getUInt32(){let t=4294967295;if(t=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128)return t;if(t=(t|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128)return t;if(t=(t|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128)return t;if(t=(t|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128)return t;if(t=(t|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128)return t;throw new Error("Varint overflow")}getUInt64(){return this._decodeVarint()}getSInt32(){const t=this.getUInt32();return t>>>1^-(1&t)}getSInt64(){return this._decodeSVarint()}getBool(){const t=0!==this._data[this._pos];return this._skip(1),t}getEnum(){return this._decodeVarint()}getFixed64(){const t=this._dataView,e=this._pos,i=t.getUint32(e,!0)+t.getUint32(e+4,!0)*a;return this._skip(8),i}getSFixed64(){const t=this._dataView,e=this._pos,i=t.getUint32(e,!0)+t.getInt32(e+4,!0)*a;return this._skip(8),i}getDouble(){const t=this._dataView.getFloat64(this._pos,!0);return this._skip(8),t}getFixed32(){const t=this._dataView.getUint32(this._pos,!0);return this._skip(4),t}getSFixed32(){const t=this._dataView.getInt32(this._pos,!0);return this._skip(4),t}getFloat(){const t=this._dataView.getFloat32(this._pos,!0);return this._skip(4),t}getString(){const t=this._getLength(),e=this._pos,i=this._toString(this._data,e,e+t);return this._skip(t),i}getBytes(){const t=this._getLength(),e=this._pos,i=this._toBytes(this._data,e,e+t);return this._skip(t),i}getLength(){return this._getLengthUnsafe()}processMessageWithArgs(t,e,i,n){const r=this.getMessage(),s=t(r,e,i,n);return r.release(),s}processMessage(t){const e=this.getMessage(),i=t(e);return e.release(),i}getMessage(){const t=this._getLength(),e=u.pool.acquire();return e._init(this._data,this._dataView,this._pos,this._pos+t),this._skip(t),e}release(){u.pool.release(this)}dataType(){return this._dataType}skip(){switch(this._dataType){case n.varint:this._decodeVarint();break;case n.fixed64:this._skip(8);break;case n.delimited:this._skip(this._getLength());break;case n.fixed32:this._skip(4);break;default:throw new Error("Invalid data type!")}}skipLen(t){this._skip(t)}_skip(t){if(this._pos+t>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=t}_decodeVarint(){const t=this._data;let e=this._pos,i=0,n=0;if(this._end-e>=10)do{if(n=t[e++],i|=127&n,!(128&n))break;if(n=t[e++],i|=(127&n)<<7,!(128&n))break;if(n=t[e++],i|=(127&n)<<14,!(128&n))break;if(n=t[e++],i|=(127&n)<<21,!(128&n))break;if(n=t[e++],i+=268435456*(127&n),!(128&n))break;if(n=t[e++],i+=34359738368*(127&n),!(128&n))break;if(n=t[e++],i+=4398046511104*(127&n),!(128&n))break;if(n=t[e++],i+=562949953421312*(127&n),!(128&n))break;if(n=t[e++],i+=72057594037927940*(127&n),!(128&n))break;if(n=t[e++],i+=0x8000000000000000*(127&n),!(128&n))break;throw new Error("Varint too long!")}while(0);else{let r=1;for(;e!==this._end&&(n=t[e],128&n);)++e,i+=(127&n)*r,r*=128;if(e===this._end)throw new Error("Varint overrun!");++e,i+=n*r}return this._pos=e,i}_decodeSVarint(){const t=this._data;let e,i=0,n=0;const r=1&t[this._pos];if(n=t[this._pos++],i|=127&n,!(128&n))return r?-(i+1)/2:i/2;if(n=t[this._pos++],i|=(127&n)<<7,!(128&n))return r?-(i+1)/2:i/2;if(n=t[this._pos++],i|=(127&n)<<14,!(128&n))return r?-(i+1)/2:i/2;if(n=t[this._pos++],i|=(127&n)<<21,!(128&n))return r?-(i+1)/2:i/2;if(n=t[this._pos++],i+=268435456*(127&n),!(128&n))return r?-(i+1)/2:i/2;if(n=t[this._pos++],i+=34359738368*(127&n),!(128&n))return r?-(i+1)/2:i/2;if(n=t[this._pos++],i+=4398046511104*(127&n),!(128&n))return r?-(i+1)/2:i/2;if(e=BigInt(i),n=t[this._pos++],e+=0x2000000000000n*BigInt(127&n),!(128&n))return Number(r?-(e+1n)/2n:e/2n);if(n=t[this._pos++],e+=0x100000000000000n*BigInt(127&n),!(128&n))return Number(r?-(e+1n)/2n:e/2n);if(n=t[this._pos++],e+=0x8000000000000000n*BigInt(127&n),!(128&n))return Number(r?-(e+1n)/2n:e/2n);throw new Error("Varint too long!")}_getLength(){if(this._dataType!==n.delimited)throw new Error("Not a delimited data type!");return this._decodeVarint()}_getLengthUnsafe(){return this.getUInt32()}_toString(t,e,i){if((i=Math.min(this._end,i))-e>c){const n=t.subarray(e,i);return l.decode(n)}let n="",r="";for(let s=e;s<i;++s){const e=t[s];128&e?r+="%"+e.toString(16):(n+=decodeURIComponent(r)+String.fromCharCode(e),r="")}return r.length&&(n+=decodeURIComponent(r)),n}_toBytes(t,e,i){return i=Math.min(this._end,i),new Uint8Array(t.buffer,e,i-e)}}u.pool=new o.A(u,void 0,(t=>{t._data=null,t._dataView=null}))},42042:function(t,e,i){i.d(e,{n:function(){return a}});var n=i(9688),r=i(22739),s=i(96285);function o(t){t=t.replaceAll(/LTS|LT|L{1,4}|l{1,4}/g,"[$&]");let e="";const i=/(\[[^[]*\])|(\\)?([Hh]mm(ss)?|Mo|M{1,4}|Do|DDDo|D{1,4}|d{2,4}|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;for(const n of t.match(i)||[])switch(n){case"D":e+="d";break;case"DD":e+="dd";break;case"DDD":e+="o";break;case"d":e+="c";break;case"ddd":e+="ccc";break;case"dddd":e+="cccc";break;case"M":e+="L";break;case"MM":e+="LL";break;case"MMM":e+="LLL";break;case"MMMM":e+="LLLL";break;case"YY":e+="yy";break;case"Y":case"YYYY":e+="yyyy";break;case"Q":e+="q";break;case"X":case"x":e+=n;break;default:n.length>=2&&"["===n.slice(0,1)&&"]"===n.slice(-1)?e+=`'${n.slice(1,-1)}'`:e+=`'${n}'`}return e}class a{constructor(t,e,i){this._year=t,this._month=e,this._day=i,this.declaredRootClass="esri.core.sql.dateonly"}get month(){return this._month}get monthJS(){return this._month-1}get year(){return this._year}get day(){return this._day}get isValid(){return this.toDateTime("unknown").isValid}equals(t){return t instanceof a&&t.day===this.day&&t.month===this.month&&t.year===this.year}clone(){return new a(this._year,this._month,this._day)}toDateTime(t){return s.c9.fromObject({day:this.day,month:this.month,year:this.year},{zone:(0,n.mT)(t)})}toDateTimeLuxon(t){return s.c9.fromObject({day:this.day,month:this.month,year:this.year},{zone:(0,n.mT)(t)})}toString(){return`${this.year.toString().padStart(4,"0")}-${this.month.toString().padStart(2,"0")}-${this.day.toString().padStart(2,"0")}`}toFormat(t=null,e=!0){if(null===t||""===t)return this.toString();if(e&&(t=o(t)),!t)return"";const i=this.toDateTime("unknown");return n.lY.dateTimeToArcadeDate(i).toFormat(t,{locale:(0,r.JK)(),numberingSystem:"latn"})}toArcadeDate(){const t=this.toDateTime("unknown");return n.lY.dateTimeToArcadeDate(t)}toNumber(){return this.toDateTime("unknown").toMillis()}toJSDate(){return this.toDateTime("unknown").toJSDate()}toStorageFormat(){return this.toFormat("yyyy-LL-dd",!1)}toSQLValue(){return this.toFormat("yyyy-LL-dd",!1)}toSQLWithKeyword(){return"date '"+this.toFormat("yyyy-LL-dd",!1)+"'"}plus(t,e){return a.fromDateTime(this.toUTCDateTime().plus({[t]:e}))}toUTCDateTime(){return s.c9.utc(this.year,this.month,this.day,0,0,0,0)}difference(t,e){switch(e.toLowerCase()){case"days":case"day":case"d":return this.toUTCDateTime().diff(t.toUTCDateTime(),"days").days;case"months":case"month":return this.toUTCDateTime().diff(t.toUTCDateTime(),"months").months;case"minutes":case"minute":case"m":return"M"===e?this.toUTCDateTime().diff(t.toUTCDateTime(),"months").months:this.toUTCDateTime().diff(t.toUTCDateTime(),"minutes").minutes;case"seconds":case"second":case"s":return this.toUTCDateTime().diff(t.toUTCDateTime(),"seconds").seconds;case"milliseconds":case"millisecond":case"ms":default:return this.toUTCDateTime().diff(t.toUTCDateTime(),"milliseconds").milliseconds;case"hours":case"hour":case"h":return this.toUTCDateTime().diff(t.toUTCDateTime(),"hours").hours;case"years":case"year":case"y":return this.toUTCDateTime().diff(t.toUTCDateTime(),"years").years}}static fromMilliseconds(t){const e=s.c9.fromMillis(t,{zone:s.mQ.utcInstance});return e.isValid?a.fromParts(e.year,e.month,e.day):null}static fromSeconds(t){const e=s.c9.fromSeconds(t,{zone:s.mQ.utcInstance});return e.isValid?a.fromParts(e.year,e.month,e.day):null}static fromReader(t){if(!t)return null;const e=t.split("-");return 3!==e.length?null:new a(parseInt(e[0],10),parseInt(e[1],10),parseInt(e[2],10))}static fromParts(t,e,i){const n=new a(t,e,i);return!1===n.isValid?null:n}static fromDateJS(t){return a.fromParts(t.getFullYear(),t.getMonth()+1,t.getDay())}static fromDateTime(t){return a.fromParts(t.year,t.month,t.day)}static fromSqlTimeStampOffset(t){return this.fromDateTime(t.toDateTime())}static fromString(t,e=null){if(""===t)return null;if(null===t)return null;const i=[];if(e)(e=o(e))&&i.push(e);else if(null===e||""===e){const e=s.c9.fromISO(t,{setZone:!0});return e.isValid?a.fromParts(e.year,e.month,e.day):null}for(const n of i){const i=s.c9.fromFormat(t,e??n);if(i.isValid)return new a(i.year,i.month,i.day)}return null}static fromNow(t="system"){const e=s.c9.fromJSDate(new Date).setZone((0,n.mT)(t));return new a(e.year,e.month,e.day)}}},70891:function(t,e,i){i.d(e,{k:function(){return a}});var n=i(80749),r=i(22739),s=i(96285);function o(t){if(!t)return"";const e=/(a|A|hh?|HH?|mm?|ss?|SSS|S|.)/g;let i="";for(const n of t.match(e)||[])switch(n){case"SSS":case"m":case"mm":case"h":case"hh":case"H":case"HH":case"s":case"ss":i+=n;break;case"A":case"a":i+="a";break;default:i+=`'${n}'`}return i}class a{constructor(t,e,i,n){this._hour=t,this._minute=e,this._second=i,this._millisecond=n,this.declaredRootClass="esri.core.sql.timeonly"}get hour(){return this._hour}get minute(){return this._minute}get second(){return this._second}get millisecond(){return this._millisecond}equals(t){return t instanceof a&&t.hour===this.hour&&t.minute===this.minute&&t.second===this.second&&t.millisecond===this.millisecond}clone(){return new a(this.hour,this.minute,this.second,this.millisecond)}isValid(){return(0,n.Fq)(this.hour)&&(0,n.Fq)(this.minute)&&(0,n.Fq)(this.second)&&(0,n.Fq)(this.millisecond)&&this.hour>=0&&this.hour<24&&this.minute>=0&&this.minute<60&&this.second>=0&&this.second<60&&this.millisecond>=0&&this.millisecond<1e3}toString(){return`${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}`+(this.millisecond>0?"."+this.millisecond.toString().padStart(3,"0"):"")}toSQLValue(){return this.toString()}toSQLWithKeyword(){return`time '${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}${this.millisecond>0?"."+this.millisecond.toString().padStart(3,"0"):""}'`}toStorageString(){return`${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}`}toFormat(t=null){return null===t||""===t?this.toString():(t=o(t))?s.c9.local(1970,1,1,this._hour,this._minute,this._second,this._millisecond).toFormat(t,{locale:(0,r.JK)(),numberingSystem:"latn"}):""}toNumber(){return this.millisecond+1e3*this.second+1e3*this.minute*60+60*this.hour*60*1e3}static fromParts(t,e,i,n){const r=new a(t,e,i,n);return r.isValid()?r:null}static fromReader(t){if(!t)return null;const e=t.split(":");return 3!==e.length?null:new a(parseInt(e[0],10),parseInt(e[1],10),parseInt(e[2],10),0)}static fromMilliseconds(t){if(t>864e5||t<0)return null;const e=Math.floor(t/1e3%60),i=Math.floor(t/6e4%60),n=Math.floor(t/36e5%24),r=Math.floor(t%1e3);return new a(n,i,e,r)}static fromDateJS(t){return new a(t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds())}static fromDateTime(t){return new a(t.hour,t.minute,t.second,t.millisecond)}static fromSqlTimeStampOffset(t){return this.fromDateTime(t.toDateTime())}static fromString(t,e=null){if(""===t)return null;if(null===t)return null;const i=[];e?(e=o(e))&&i.push(e):null!==e&&""!==e||(i.push("HH:mm:ss"),i.push("HH:mm:ss.SSS"),i.push("hh:mm:ss a"),i.push("hh:mm:ss.SSS a"),i.push("HH:mm"),i.push("hh:mm a"),i.push("H:mm"),i.push("h:mm a"),i.push("H:mm:ss"),i.push("h:mm:ss a"),i.push("H:mm:ss.SSS"),i.push("h:mm:ss.SSS a"));for(const e of i){const i=s.c9.fromFormat(t,e);if(i.isValid)return new a(i.hour,i.minute,i.second,i.millisecond)}return null}plus(t,e){switch(t){case"days":case"years":case"months":return this.clone();case"hours":case"minutes":case"seconds":case"milliseconds":return a.fromDateTime(this.toUTCDateTime().plus({[t]:e}))}return null}toUTCDateTime(){return s.c9.utc(1970,1,1,this.hour,this.minute,this.second,this.millisecond)}difference(t,e){switch(e.toLowerCase()){case"days":case"day":case"d":return this.toUTCDateTime().diff(t.toUTCDateTime(),"days").days;case"months":case"month":return this.toUTCDateTime().diff(t.toUTCDateTime(),"months").months;case"minutes":case"minute":case"m":return"M"===e?this.toUTCDateTime().diff(t.toUTCDateTime(),"months").months:this.toUTCDateTime().diff(t.toUTCDateTime(),"minutes").minutes;case"seconds":case"second":case"s":return this.toUTCDateTime().diff(t.toUTCDateTime(),"seconds").seconds;case"milliseconds":case"millisecond":case"ms":default:return this.toUTCDateTime().diff(t.toUTCDateTime(),"milliseconds").milliseconds;case"hours":case"hour":case"h":return this.toUTCDateTime().diff(t.toUTCDateTime(),"hours").hours;case"years":case"year":case"y":return this.toUTCDateTime().diff(t.toUTCDateTime(),"years").years}}}},33134:function(t,e,i){i.d(e,{z:function(){return a}});var n=i(21609),r=i(49077),s=i(74697),o=i(76613);class a{static fromOptimized(t,e,i=!1,n=!1,r=1){return(new l).initialize(t,e,i,n,r)}static fromJSON(t,e=!1,i=!1){const[n,r]=u(t);return(new h).initialize(n,r,e,i,1)}static fromOptimizedCIM(t,e,i=!1,n=!1,r=1){return(new d).initialize(t,e,i,n,r)}static fromJSONCIM(t,e=!1,i=!1,n=1){const[r,s]=u(t);return(new f).initialize(r,s,e,i,n)}static fromFeatureSetReader(t){const e=t.readGeometryForDisplay(),i=t.geometryType;return e&&i?this.fromOptimized(e,i):null}static fromFeatureSetReaderCIM(t){const e=t.readGeometryForDisplay(),i=t.geometryType;return e&&i?this.fromOptimizedCIM(e,i):null}static createEmptyOptimized(t,e=!1,i=!1,n=1){return(new l).initialize(new o.A,t,e,i,n)}static createEmptyJSON(t,e=!1,i=!1){return(new h).initialize([],t,e,i,1)}static createEmptyOptimizedCIM(t,e=!1,i=!1,n=1){return(new d).initialize(new o.A,t,e,i,n)}static createEmptyJSONCIM(t,e=!1,i=!1,n=1){return(new f).initialize([],t,e,i,n)}asJSON(){const t=(0,r.x)(this);return"esriGeometryEnvelope"===this.geometryType?{xmin:t[0][0][0],ymin:t[0][0][1],xmax:t[0][2][0],ymax:t[0][2][1]}:"esriGeometryMultipoint"===this.geometryType?{points:t.flat()}:"esriGeometryPoint"===this.geometryType?{x:t[0][0][0],y:t[0][0][1]}:"esriGeometryPolygon"===this.geometryType?{rings:t}:{paths:t}}getCurrentRingArea(){if(this.pathSize<3)return 0;let t,e,i=0;if(this.seekPathStart(),!this.nextPoint())return 0;t=this.x,e=this.y;const n=t,r=e;for(;this.nextPoint();)i+=(t-this.x)*(e+this.y),t=this.x,e=this.y;return i+=(t-n)*(e+r),-.5*i}invertY(){this.yFactor*=-1}}class l extends a{constructor(){super(...arguments),this._end=-1}initialize(t,e,i,n,r){return this.hasZ=i,this.hasM=n,this.geometryType=e,this._stride=2+Number(i)+Number(n),this._geometry=t,this._pathIndex=-1,this._pathOffset=0,this._pointOffset=-this._stride,this._end=-1,this.yFactor=r,this}reset(){this.initialize(this._geometry,this.geometryType,this.hasZ,this.hasM,this.yFactor)}seekPath(t){if(t>=0&&t<this.totalSize){if(this._pathIndex<t)for(;this._pathIndex<t&&this.nextPath(););else if(this._pathIndex>t)for(;this._pathIndex>t&&this.prevPath(););return!0}return!1}seekPathStart(){this._pointOffset=this._pathOffset-this._stride}seekPathEnd(){this._pointOffset=this._end}seekInPath(t){const e=this._pathOffset+t*this._stride;return e>=0&&e<this._end&&(this._pointOffset=e,!0)}nextPoint(){return(this._pointOffset+=this._stride)<this._end}prevPoint(){return(this._pointOffset-=this._stride)>=this._pathOffset}nextPath(){return!(this.pathIndex>=this.totalSize-1||(this._pathIndex>=0&&(this._pathOffset+=this._stride*this.pathSize),this._pathIndex++,this._pointOffset=this._pathOffset-this._stride,this._end=this._pointOffset+this._stride+this._stride*this.pathSize,0))}prevPath(){return!(this.pathIndex<=0||(this._pathIndex--,this._end=this._pathOffset,this._pathOffset-=this._stride*this.pathSize,this._pointOffset=this._pathOffset-this._stride,0))}getCurrentPath(){const t=this._end,e=this._geometry.coords,i=this._pathOffset;return(new l).initialize(new o.A([this.pathSize],e.slice(i,t)),this.geometryType,this.hasZ,this.hasM,this.yFactor)}pathLength(){const t=this._end,e=this._stride,i=this._geometry.coords;let n=0;for(let r=this._pathOffset+e;r<t;r+=e){const t=i[r-e],s=i[r-e+1],o=i[r]-t,a=i[r+1]-s;n+=Math.sqrt(o*o+a*a)}return n}startPath(){this._geometry.lengths.push(0)}pushPath(t){this.startPath(),this.pushPoints(t)}pushPoint(t){for(let e=0;e<this._stride;++e)this._geometry.coords.push(t[e]);this._geometry.lengths[this.totalSize-1]++}pushXY(t,e){this._geometry.coords.push(t,e),this._geometry.lengths[this.totalSize-1]++}pushPoints(t){for(const e of t)for(let t=0;t<this._stride;++t)this._geometry.coords.push(e[t]);this._geometry.lengths[this.totalSize-1]+=t.length}pushCursor(t){const e=t.asOptimized();this._geometry.coords.push(...e.coords),this._geometry.lengths.push(...e.lengths)}asOptimized(){const t=this._geometry.clone();if(1!==this.yFactor)for(let e=1;e<t.coords.length;e+=this._stride)t.coords[e]*=this.yFactor;return"esriGeometryPoint"===this.geometryType&&(t.lengths.length=0),t}isClosed(){const t=this._geometry.coords,e=this._pathOffset,i=this._end-this._stride;for(let n=0;n<this._stride;n++)if(t[e+n]!==t[i+n])return!1;return!0}clone(){return(new l).initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._geometry.isPoint?1:this._geometry.lengths.reduce(((t,e)=>t+e))}get pathSize(){const{lengths:t}=this._geometry;return this._geometry.isPoint?1:this._pathIndex<0||this._pathIndex>t.length-1?0:t[this._pathIndex]}get totalSize(){return this._geometry.isPoint?1:this._geometry.lengths.length}get x(){return this._geometry.coords[this._pointOffset]}set x(t){this._geometry.coords[this._pointOffset]=t}get y(){return this.yFactor*this._geometry.coords[this._pointOffset+1]}set y(t){this._geometry.coords[this._pointOffset+1]=this.yFactor*t}get z(){return this._geometry.coords[this._pointOffset+2]}set z(t){this._geometry.coords[this._pointOffset+2]=t}get m(){const t=this.hasZ?3:2;return this._geometry.coords[this._pointOffset+t]}set m(t){this._geometry.coords[this._pointOffset+3]=t}get pathIndex(){return this._pathIndex}get _coordIndex(){return this._pointOffset/this._stride}}function c(t){const e=[t.x,t.y];return t.z&&e.push(t.z),t.m&&e.push(t.m),e}function u(t){return(0,s.Bi)(t)?[t.rings,"esriGeometryPolygon"]:(0,s.Rg)(t)?[t.paths,"esriGeometryPolyline"]:(0,s.U9)(t)?[[t.points],"esriGeometryMultipoint"]:(0,s.ZC)(t)?[[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]],"esriGeometryEnvelope"]:(0,s.fT)(t)?[[[c(t)]],"esriGeometryPoint"]:[[],"esriGeometryPolyline"]}class h extends a{initialize(t,e,i,n,r){return this._paths=t,this.geometryType=e,this.hasZ=i,this.hasM=n,this._pathIndex=this._pointIndex=-1,this.yFactor=r,this._mIndex=this.hasZ?3:2,this}reset(){this._pathIndex=this._pointIndex=-1}seekPath(t){return this._pathIndex=t,this._pointIndex=-1,t>=0&&t<this.totalSize&&(this._currentPath=this._paths[t],!0)}seekPathStart(){this._pointIndex=-1}seekPathEnd(){this._pointIndex=this._currentPath.length}seekInPath(t){return t>=0&&t<this._currentPath.length&&(this._pointIndex=t,this._currentPoint=this._currentPath[this._pointIndex],!0)}nextPoint(){return this._currentPoint=this._currentPath[++this._pointIndex],this._pointIndex<this._currentPath.length}prevPoint(){return this._currentPoint=this._currentPath[--this._pointIndex],this._pointIndex>=0}nextPath(){return this._pointIndex=-1,this._currentPath=this._paths[++this._pathIndex],this._pathIndex<this.totalSize}prevPath(){return this.pathIndex>0&&(this._pointIndex=-1,this._pathIndex--,this._currentPath=this._paths[this._pathIndex],!0)}pathLength(){const t=this._currentPath.length,e=this._currentPath;let i=0;for(let n=1;n<t;n++){const t=e[n-1],r=e[n],s=t[0],o=t[1],a=r[0]-s,l=r[1]-o;i+=Math.sqrt(a*a+l*l)}return i}startPath(){this._paths.push([])}getCurrentPath(){return(new h).initialize([this._currentPath],this.geometryType,this.hasZ,this.hasM,this.yFactor)}pushPath(t){this._paths.push(t)}pushPoint(t){this._paths[this.totalSize-1].push(t)}pushXY(t,e){this._paths[this.totalSize-1].push([t,e])}pushPoints(t){this._paths[this.totalSize-1].push(...t)}pushCursor(t){const e=(0,r.x)(t);for(const t of e)this.pushPath(t)}asOptimized(){const t=new o.A;if("esriGeometryPoint"===this.geometryType)t.coords.push(...this._paths[0][0]),t.lengths.length=0;else for(const e of this._paths){for(const i of e)t.coords.push(i[0]),t.coords.push(i[1]*this.yFactor),this.hasZ&&t.coords.push(i[2]),this.hasM&&t.coords.push(i[this._mIndex]);t.lengths.push(e.length)}return t}isClosed(){const t=this._currentPath[0],e=this._currentPath[this._currentPath.length-1];for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}clone(){return(new h).initialize((0,n.o8)(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._paths.map((t=>t.length)).reduce(((t,e)=>t+e))}get pathSize(){return this._pathIndex<0||this._pathIndex>this.totalSize-1?-1:this._paths[this._pathIndex].length}get totalSize(){return this._paths.length}get x(){return this._currentPoint[0]}set x(t){this._currentPoint[0]=t}get y(){return this.yFactor*this._currentPoint[1]}set y(t){this._currentPoint[1]=this.yFactor*t}get z(){return this._currentPoint[2]}set z(t){this._currentPoint[2]=t}get m(){return this._currentPoint[this._mIndex]}set m(t){this._currentPoint[this._mIndex]=t}get pathIndex(){return this._pathIndex}}class d extends l{initialize(t,e,i,n,r){return super.initialize(t,e,i,n,r),this._controlPoints||(this._controlPoints=this._controlPoints=new Array(this.totalSize).fill(void 0).map((t=>new Set))),this}startPath(){super.startPath(),this._controlPoints.push(new Set)}clone(){const t=(new d).initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor);return t._controlPoints=this._controlPoints,t}setControlPoint(){this._controlPoints[this.pathIndex].add(this._coordIndex)}getControlPoint(){return this._controlPoints[this.pathIndex].has(this._coordIndex)}setControlPointAt(t){this._controlPoints[this.pathIndex].add(t)}getControlPointAt(t){return this._controlPoints[this.pathIndex].has(t)}}class f extends h{initialize(t,e,i,n,r){return super.initialize(t,e,i,n,r)}clone(){return(new f).initialize((0,n.o8)(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}setControlPoint(){this._paths[this.pathIndex][this._pointIndex][4]=1}getControlPoint(){return 1===this._paths[this.pathIndex][this._pointIndex][4]}setControlPointAt(t){this._paths[this.pathIndex][t][4]=1}getControlPointAt(t){return 1===this._paths[this.pathIndex][t][4]}}},86029:function(t,e,i){i.d(e,{g:function(){return n}});const n={convertToGEGeometry:function(t,e){return null==e?null:t.convertJSONToGeometry(e)},exportPoint:function(t,e,i){const n=new r(t.getPointX(e),t.getPointY(e),i),s=t.hasZ(e),o=t.hasM(e);return s&&(n.z=t.getPointZ(e)),o&&(n.m=t.getPointM(e)),n},exportPolygon:function(t,e,i){return new s(t.exportPaths(e),i,t.hasZ(e),t.hasM(e))},exportPolyline:function(t,e,i){return new o(t.exportPaths(e),i,t.hasZ(e),t.hasM(e))},exportMultipoint:function(t,e,i){return new a(t.exportPoints(e),i,t.hasZ(e),t.hasM(e))},exportExtent:function(t,e,i){const n=t.hasZ(e),r=t.hasM(e),s=new l(t.getXMin(e),t.getYMin(e),t.getXMax(e),t.getYMax(e),i);if(n){const i=t.getZExtent(e);s.zmin=i.vmin,s.zmax=i.vmax}if(r){const i=t.getMExtent(e);s.mmin=i.vmin,s.mmax=i.vmax}return s}};class r{constructor(t,e,i){this.x=t,this.y=e,this.spatialReference=i,this.z=void 0,this.m=void 0}}class s{constructor(t,e,i,n){this.rings=t,this.spatialReference=e,this.hasZ=void 0,this.hasM=void 0,i&&(this.hasZ=i),n&&(this.hasM=n)}}class o{constructor(t,e,i,n){this.paths=t,this.spatialReference=e,this.hasZ=void 0,this.hasM=void 0,i&&(this.hasZ=i),n&&(this.hasM=n)}}class a{constructor(t,e,i,n){this.points=t,this.spatialReference=e,this.hasZ=void 0,this.hasM=void 0,i&&(this.hasZ=i),n&&(this.hasM=n)}}class l{constructor(t,e,i,n,r){this.xmin=t,this.ymin=e,this.xmax=i,this.ymax=n,this.spatialReference=r,this.zmin=void 0,this.zmax=void 0,this.mmin=void 0,this.mmax=void 0}}},81484:function(t,e,i){i.d(e,{F:function(){return l},l:function(){return c}});var n=i(53216),r=i(58941);const s=128e3;let o=null,a=null;async function l(){return o||(o=async function(){const t=(0,r.A)("esri-csp-restrictions")?await i.e(5786).then(i.bind(i,70244)).then((t=>t.l)):await i.e(3740).then(i.bind(i,9502)).then((t=>t.l));a=await t.default({locateFile:t=>(0,n.s)(`esri/core/libs/libtess/${t}`)})}()),o}function c(t,e){const i=Math.max(t.length,s);return a.triangulate(t,e,i)}},57862:function(t,e,i){i.d(e,{TT:function(){return p},Xn:function(){return b},Zj:function(){return y},_3:function(){return x},l1:function(){return m},qy:function(){return _},vN:function(){return v}}),i(50917);var n=i(39819),r=i(62938),s=i(67888),o=i(62046),a=i(57652),l=i(57165),c=i(91508),u=i(44740);function h(t){if(!t)return null;const e=t.wkid;if(e)return o.uw[e];const i=t.wkt2??t.wkt;return i?function(t){const e=o._f.exec(t);if(!e||2!==e.length)return null;const i=e[1].split(",");if(!i||i.length<3)return null;const n=parseFloat(i[1]),r=parseFloat(i[2]);return isNaN(n)||isNaN(r)?null:{a:n,f:0===r?0:1/r}}(i):null}function d(t){const e=h(t);if(function(t){return null!=t&&"b"in t&&"eSq"in t&&"radius"in t}(e))return e;const i=e.a*(1-e.f);return Object.assign(e,{b:i,eSq:1-(i/e.a)**2,radius:(2*e.a+i)/3,densificationRatio:1e4/((2*e.a+i)/3)})}function f(t,e,i){const{a:n,eSq:r}=d(i),s=Math.sqrt(r),a=Math.sin(e[1]*o.eh),l=n*e[0]*o.eh;let c;return c=r>0?n*((1-r)*(a/(1-r*(a*a))-1/(2*s)*Math.log((1-s*a)/(1+s*a))))*.5:n*a,t[0]=l,t[1]=c,t}function p(t){return(0,a.EA)(t)&&!!h(t)}function _(t,e="square-meters"){if(t.some((t=>!p(t.spatialReference))))throw new n.A("geodesic-areas:invalid-spatial-reference","the input geometries spatial reference is not supported");const i=[];for(let e=0;e<t.length;e++){const n=t[e],r=n.spatialReference,{radius:s,densificationRatio:o}=d(r),a=s*o;i.push(g(n,a))}const s=[],o=[0,0],a=[0,0];for(let t=0;t<i.length;t++){const{rings:n,spatialReference:l}=i[t];let c=0;for(let t=0;t<n.length;t++){const e=n[t];f(o,e[0],l),f(a,e[e.length-1],l);let i=a[0]*o[1]-o[0]*a[1];for(let t=0;t<e.length-1;t++)f(o,e[t+1],l),f(a,e[t],l),i+=a[0]*o[1]-o[0]*a[1];c+=i}c=(0,r.oU)(c,"square-meters",e),s.push(c/-2)}return s}function m(t,e="meters"){if(!t)throw new n.A("geodesic-lengths:invalid-geometries","the input geometries type is not supported");if(t.some((t=>!p(t.spatialReference))))throw new n.A("geodesic-lengths:invalid-spatial-reference","the input geometries spatial reference is not supported");const i=[];for(let n=0;n<t.length;n++){const s=t[n],{spatialReference:o}=s,a="polyline"===s.type?s.paths:s.rings;let l=0;for(let t=0;t<a.length;t++){const e=a[t];let i=0;for(let t=1;t<e.length;t++){const n=e[t-1][0],r=e[t][0],s=e[t-1][1],a=e[t][1];if(s!==a||n!==r){const t=new y;x(t,[n,s],[r,a],o),i+=t.distance}}l+=i}l=(0,r.oU)(l,"meters",e),i.push(l)}return i}function g(t,e){if("polyline"!==t.type&&"polygon"!==t.type)throw new n.A("geodesic-densify:invalid-geometry","the input geometry is neither polyline nor polygon");const{spatialReference:i}=t;if(!p(i))throw new n.A("geodesic-densify:invalid-spatial-reference","the input geometry spatial reference is not supported");const r="polyline"===t.type?t.paths:t.rings,o=[],a=[0,0],h=new y;for(const t of r){const n=[];o.push(n),n.push([t[0][0],t[0][1]]);let r,s,l=t[0][0],c=t[0][1];for(let o=0;o<t.length-1;o++){if(r=t[o+1][0],s=t[o+1][1],l===r&&c===s)continue;const u=[l,c];x(h,[l,c],[r,s],i);const{azimuth:d,distance:f}=h,p=f/e;if(p>1){for(let t=1;t<=p-1;t++)v(a,u,d,t*e,i),n.push(a.slice());v(a,u,d,(f+Math.floor(p-1)*e)/2,i),n.push(a.slice())}v(a,u,d,f,i),n.push(a.slice()),l=a[0],c=a[1]}}const d=(0,s.PZ)(l.A,i);return"polyline"===t.type?new c.A({paths:o,spatialReference:d}):new u.A({rings:o,spatialReference:d})}i(45532);class y{constructor(t=0,e=void 0,i=void 0){this.distance=t,this.azimuth=e,this.reverseAzimuth=i}}function v(t,e,i,n,r){const s=e[0],a=e[1],l=s*o.eh,c=a*o.eh,u=(i??0)*o.eh,{a:h,b:f,f:p}=d(r),_=Math.sin(u),m=Math.cos(u),g=(1-p)*Math.tan(c),y=1/Math.sqrt(1+g*g),v=g*y,x=Math.atan2(g,m),b=y*_,S=b*b,w=1-S,T=w*(h*h-f*f)/(f*f),M=1+T/16384*(4096+T*(T*(320-175*T)-768)),P=T/1024*(256+T*(T*(74-47*T)-128));let A,C,I,E,R=n/(f*M),O=2*Math.PI;for(;Math.abs(R-O)>1e-12;)I=Math.cos(2*x+R),A=Math.sin(R),C=Math.cos(R),E=P*A*(I+P/4*(C*(2*I*I-1)-P/6*I*(4*A*A-3)*(4*I*I-3))),O=R,R=n/(f*M)+E;const F=v*A-y*C*m,z=Math.atan2(v*C+y*A*m,(1-p)*Math.sqrt(S+F*F)),D=Math.atan2(A*_,y*C-v*A*m),L=p/16*w*(4+p*(4-3*w)),k=z/o.eh,N=(l+(D-(1-L)*p*b*(R+L*A*(I+L*C*(2*I*I-1)))))/o.eh;return t[0]=N,t[1]=k,t}function x(t,e,i,n){const r=e[0]*o.eh,s=e[1]*o.eh,a=i[0]*o.eh,l=i[1]*o.eh,{a:c,b:u,f:h,radius:f}=d(n),p=a-r,_=Math.atan((1-h)*Math.tan(s)),m=Math.atan((1-h)*Math.tan(l)),g=Math.sin(_),y=Math.cos(_),v=Math.sin(m),x=Math.cos(m);let b,S,w,T,M,P,A,C,I,E,R=1e3,O=p;do{if(A=Math.sin(O),C=Math.cos(O),w=Math.sqrt(x*A*(x*A)+(y*v-g*x*C)*(y*v-g*x*C)),0===w)return t.distance=0,t.azimuth=void 0,t.reverseAzimuth=void 0,t;M=g*v+y*x*C,P=Math.atan2(w,M),I=y*x*A/w,S=1-I*I,T=M-2*g*v/S,isNaN(T)&&(T=0),E=h/16*S*(4+h*(4-3*S)),b=O,O=p+(1-E)*h*I*(P+E*w*(T+E*M*(2*T*T-1)))}while(Math.abs(O-b)>1e-12&&--R>0);if(0===R){const e=f,i=Math.acos(Math.sin(s)*Math.sin(l)+Math.cos(s)*Math.cos(l)*Math.cos(a-r))*e,n=a-r,c=Math.sin(n)*Math.cos(l),u=Math.cos(s)*Math.sin(l)-Math.sin(s)*Math.cos(l)*Math.cos(n),h=Math.atan2(c,u);return t.azimuth=h/o.eh,t.distance=i,t.reverseAzimuth=void 0,t}const F=S*(c*c-u*u)/(u*u),z=F/1024*(256+F*(F*(74-47*F)-128)),D=u*(1+F/16384*(4096+F*(F*(320-175*F)-768)))*(P-z*w*(T+z/4*(M*(2*T*T-1)-z/6*T*(4*w*w-3)*(4*T*T-3)))),L=Math.atan2(x*Math.sin(O),y*v-g*x*Math.cos(O)),k=Math.atan2(y*Math.sin(O),y*v*Math.cos(O)-g*x);return t.azimuth=L/o.eh,t.distance=D,t.reverseAzimuth=k/o.eh,t}function b(t){return p(t)?t:(0,a.K8)(t)?l.A.WGS84:null}},30804:function(t,e,i){i.d(e,{d:function(){return c}});var n=i(87416),r=i(35068),s=i(72228),o=i(38441),a=i(96127);const l=222045e-19;function c(t){if(0===t.totalSize)return null;const e=(0,r.z8)(t);if(!e)return null;const i=4*(Math.abs(e[0])+Math.abs(e[2])+Math.abs(e[1])+Math.abs(e[3])+1)*l;let o=0,a=0;t.reset();for(let e=0;t.nextPath();e++){const i=t.getCurrentRingArea();i>a&&(a=i,o=e)}if(t.seekPath(o),0===t.pathSize)return null;t.seekPathStart();const c=(0,r.B$)(t);if(Math.abs(a)<=2*i*i)return[(c[0]+c[2])/2,(c[1]+c[3])/2];t.seekPathStart();const f=(0,s.w2)(t,(0,n.vt)());if(null===f)return null;if(t.totalPoints<4)return f;const p=[[NaN,NaN],[NaN,NaN],[NaN,NaN],[NaN,NaN]],_=[NaN,NaN,NaN,NaN],m=[NaN,NaN,NaN,NaN];let g=!1,y=h(f,t,!0);0===y.distance&&(g=!0,p[0][0]=f[0],p[0][1]=f[1],y=h(f,t,!1)),_[0]=y.distance,m[0]=0;const v=[NaN,NaN];let w=!1,T=.25,M=-1,P=NaN;do{if(P=NaN,p[1]=d(t,x(c[0],c[2],T),0,e),isNaN(p[1][0])||isNaN(p[1][1])||(y=h(p[1],t,!1),P=y.distance),!isNaN(P)&&P>i&&u(p[1],t))w=!0,_[1]=P,m[1]=b(p[1],f);else if(!isNaN(P)&&P>M&&(M=P,v[0]=p[1][0],v[1]=p[1][1]),T-=.01,T<.1){if(!(M>=0))break;w=!0,_[1]=M,p[1][0]=v[0],p[1][1]=v[1],m[1]=b(p[1],f)}}while(!w);w=!1,T=.5,M=-1;let A=.01,C=1;do{if(P=NaN,p[2]=d(t,x(c[0],c[2],T),0,e),isNaN(p[2][0])||isNaN(p[2][1])||(y=h(p[2],t,!1),P=y.distance),!isNaN(P)&&P>i&&u(p[2],t))w=!0,_[2]=P,m[2]=b(p[2],f);else if(!isNaN(P)&&P>M)M=P,v[0]=p[2][0],v[1]=p[2][1];else if(P>M&&(M=P,v[0]=p[2][0],v[1]=p[2][1]),T=.5+A*C,A+=.01,C*=-1,T<.3||T>.7){if(!(M>=0))break;w=!0,_[2]=M,p[2][0]=v[0],p[2][1]=v[1],m[2]=b(p[2],f)}}while(!w);w=!1,T=.75,M=-1;do{if(P=NaN,p[3]=d(t,x(c[0],c[2],T),0,e),isNaN(p[3][0])||isNaN(p[3][1])||(y=h(p[3],t,!1),P=y.distance),!isNaN(P)&&P>i&&u(p[3],t))w=!0,_[3]=P,m[3]=b(p[3],f);else if(P>M&&(M=P,v[0]=p[3][0],v[1]=p[3][1]),T+=.01,T>.9){if(!(M>=0))break;w=!0,_[3]=M,p[3][0]=v[0],p[3][1]=v[1],m[3]=b(p[3],f)}}while(!w);const I=[0,1,2,3],E=g?0:1;let R;for(let t=E;t<4;t++)for(let t=E;t<3;t++){const e=m[t],i=m[t+1];S(e,i)>0&&(R=I[t],I[t]=I[t+1],I[t+1]=R,m[t]=i,m[t+1]=e)}let O=E,F=0,z=0;for(let t=E;t<4;t++){switch(t){case 0:z=2*_[I[t]];break;case 1:z=1.66666666*_[I[t]];break;case 2:z=1.33333333*_[I[t]];break;case 3:z=_[I[t]]}z>F&&(F=z,O=I[t])}return p[O]}function u(t,e){let i,n,r,s,o=0;for(e.reset();e.nextPath()&&e.nextPoint();)for(i=e.x,n=e.y;e.nextPoint();i=r,n=s)r=e.x,s=e.y,n>t[1]!=s>t[1]&&((r-i)*(t[1]-n)-(s-n)*(t[0]-i)>0?o++:o--);return 0!==o}function h(t,e,i){if(i&&u(t,e))return{coord:t,distance:0};let n=1/0,r=0,s=0,a=[0,0],l=[0,0];const c=[0,0];for(e.reset();e.nextPath()&&e.nextPoint();)if(!(e.pathSize<2))for(a[0]=e.x,a[1]=e.y;e.nextPoint();a=l){l=[e.x,e.y],(0,o.gR)(c,t,a,l);const i=b(t,c);i<n&&(n=i,r=c[0],s=c[1])}return{coord:[r,s],distance:Math.sqrt(n)}}function d(t,e,i,r){const s=[e,0];let o=1/0,l=1/0,c=!1,u=!1;const h=[[e,r[1]-1],[e,r[3]+1]],d=[0,0],p=[0,0],_=[0,0],m=[[0,0],[0,0]],g=(0,n.vt)();for(t.reset();t.nextPath()&&t.nextPoint();)if(!(t.pathSize<2))for(m[0][0]=t.x,m[0][1]=t.y;t.nextPoint();m[0][0]=m[1][0],m[0][1]=m[1][1]){if(m[1][0]=t.x,m[1][1]=t.y,null===f(g,m))continue;if(p[0]=h[0][0],p[1]=h[0][1],_[0]=h[1][0],_[1]=h[1][1],0===y(g,p,_))continue;if(!(0,a.Ql)(h[0],h[1],m[0],m[1],d))continue;const e=d[1];o>l?e<o&&(o=e,c=!0):e<l&&(l=e,u=!0)}return c&&u?s[1]=(o+l)/2:s[0]=s[1]=NaN,s}function f(t,e){if(e.length<2)return null;t||(t=(0,n.vt)());const[i,r]=e[0],[s,o]=e[1];return t[0]=Math.min(i,s),t[1]=Math.min(r,o),t[2]=Math.max(i,s),t[3]=Math.max(r,o),t}const p=1,_=4,m=3,g=12;function y(t,e,i){let n=v(e,t),r=v(i,t);const s=t[0],o=t[1],a=t[2],l=t[3];if(n&r)return 0;if(!(n|r))return 4;const c=(n?1:0)|(r?2:0);do{const c=i[0]-e[0],u=i[1]-e[1];if(c>u)n&m?(n&p?(e[1]+=u*(s-e[0])/c,e[0]=s):(e[1]+=u*(a-e[0])/c,e[0]=a),n=v(e,t)):r&m?(r&p?(i[1]+=u*(s-i[0])/c,i[0]=s):(i[1]+=u*(a-i[0])/c,i[0]=a),r=v(i,t)):n?(n&_?(e[0]+=c*(o-e[1])/u,e[1]=o):(e[0]+=c*(l-e[1])/u,e[1]=l),n=v(e,t)):(r&_?(i[0]+=c*(o-i[1])/u,i[1]=o):(i[0]+=c*(l-i[1])/u,i[1]=l),r=v(i,t));else if(n&g?(n&_?(e[0]+=c*(o-e[1])/u,e[1]=o):(e[0]+=c*(l-e[1])/u,e[1]=l),n=v(e,t)):r&g?(r&_?(i[0]+=c*(o-i[1])/u,i[1]=o):(i[0]+=c*(l-i[1])/u,i[1]=l),r=v(i,t)):n?(n&p?(e[1]+=u*(s-e[0])/c,e[0]=s):(e[1]+=u*(a-e[0])/c,e[0]=a),n=v(e,t)):(r&p?(i[1]+=u*(s-i[0])/c,i[0]=s):(i[1]+=u*(a-i[0])/c,i[0]=a),r=v(i,t)),n&r)return 0}while(n|r);return c}function v(t,e){return(t[0]<e[0]?1:0)|(t[0]>e[2]?1:0)<<1|(t[1]<e[1]?1:0)<<2|(t[1]>e[3]?1:0)<<3}function x(t,e,i){return t+(e-t)*i}function b(t,e){return(t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])}function S(t,e){if(t<e)return-1;if(t>e)return 1;if(t===e)return 0;const i=isNaN(t),n=isNaN(e);return i<n?-1:i>n?1:0}},25150:function(t,e,i){i.d(e,{NH:function(){return o},ip:function(){return a},sU:function(){return c},vG:function(){return u}}),i(58941);var n=i(39819),r=i(60539),s=i(90683);function o(t){const e=l(t);return null!=e?e.toDataURL():""}async function a(t,e){const i=l(t);if(null==i)throw new n.A("imageToArrayBuffer","Unsupported image type");const o=function(t){if(!(t instanceof HTMLImageElement))return"image/png";const e=t.src;if((0,s.DB)(e)){const t=(0,s.r$)(e);return"image/jpeg"===t?.mediaType?t.mediaType:"image/png"}return/\.png$/i.test(e)?"image/png":/\.(jpg|jpeg)$/i.test(e)?"image/jpeg":"image/png"}(t),a=await new Promise((t=>i.toBlob(t,o)));if((0,r.Te)(e),!a)throw new n.A("imageToArrayBuffer","Failed to encode image");const c=await a.arrayBuffer();return(0,r.Te)(e),{data:c,type:o}}function l(t){if(t instanceof HTMLCanvasElement)return t;if(t instanceof HTMLVideoElement)return null;const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const i=e.getContext("2d");return t instanceof HTMLImageElement?i.drawImage(t,0,0,t.width,t.height):t instanceof ImageData&&i.putImageData(t,0,0),e}function c(t){const e=[],i=new Uint8Array(t);for(let t=0;t<i.length;t++)e.push(String.fromCharCode(i[t]));return"data:application/octet-stream;base64,"+btoa(e.join(""))}function u(t){if(t.byteLength<8)return!1;const e=new Uint8Array(t);return 137===e[0]&&80===e[1]&&78===e[2]&&71===e[3]&&13===e[4]&&10===e[5]&&26===e[6]&&10===e[7]}},80207:function(t,e,i){i.d(e,{b3:function(){return h},jZ:function(){return u}});var n=i(30905),r=i(87416),s=i(35068),o=i(38441),a=i(74697),l=i(65417),c=i(57652);function u(t){return d(t,!0)}function h(t){return d(t,!1)}function d(t,e){if(null==t)return null;const i=t.spatialReference,r=(0,c.Vp)(i),o=(0,n.Wj)(t)?t.toJSON():t;if(!r)return o;const u=(0,c.K8)(i)?102100:4326,h=l.j7[u].maxX,d=l.j7[u].minX;if((0,a.fT)(o))return p(o,h,d);if((0,a.U9)(o))return o.points=o.points.map((t=>p(t,h,d))),o;if((0,a.ZC)(o))return f(o,r);if((0,a.Bi)(o)||(0,a.Rg)(o)){const t=(0,s.Rg)(x,o),i={xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3]},n=(0,l.kd)(i.xmin,d)*(2*h),r=0===n?o:(0,l.kS)(o,n);return i.xmin+=n,i.xmax+=n,i.xmax>h?y(r,h,e):i.xmin<d?y(r,d,e):r}return o}function f(t,e){if(!e)return t;const i=function(t,e){const i=[],{ymin:n,ymax:r,xmin:s,xmax:o}=t,a=t.xmax-t.xmin,[l,c]=e.valid,{x:u,frameId:h}=_(t.xmin,e),{x:d,frameId:f}=_(t.xmax,e),p=u===d&&a>0;if(a>2*c){const t={xmin:s<o?u:d,ymin:n,xmax:c,ymax:r},e={xmin:l,ymin:n,xmax:s<o?d:u,ymax:r},a={xmin:0,ymin:n,xmax:c,ymax:r},p={xmin:l,ymin:n,xmax:0,ymax:r},_=[],g=[];m(t,a)&&_.push(h),m(t,p)&&g.push(h),m(e,a)&&_.push(f),m(e,p)&&g.push(f);for(let t=h+1;t<f;t++)_.push(t),g.push(t);i.push(new v(t,[h]),new v(e,[f]),new v(a,_),new v(p,g))}else u>d||p?i.push(new v({xmin:u,ymin:n,xmax:c,ymax:r},[h]),new v({xmin:l,ymin:n,xmax:d,ymax:r},[f])):i.push(new v({xmin:u,ymin:n,xmax:d,ymax:r},[h]));return i}(t,e).map((t=>t.extent));return i.length<2?i[0]||t:i.length>2?(t.xmin=e.valid[0],t.xmax=e.valid[1],t):{rings:i.map((t=>[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]))}}function p(t,e,i){if(Array.isArray(t)){const n=t[0];if(n>e){const i=(0,l.kd)(n,e);t[0]=n+i*(-2*e)}else if(n<i){const e=(0,l.kd)(n,i);t[0]=n+e*(-2*i)}}else{const n=t.x;if(n>e){const i=(0,l.kd)(n,e);t.x+=i*(-2*e)}else if(n<i){const e=(0,l.kd)(n,i);t.x+=e*(-2*i)}}return t}function _(t,e){const[i,n]=e.valid,r=2*n;let s,o=0;return t>n?(s=Math.ceil(Math.abs(t-n)/r),t-=s*r,o=s):t<i&&(s=Math.ceil(Math.abs(t-i)/r),t+=s*r,o=-s),{x:t,frameId:o}}function m(t,e){const{xmin:i,ymin:n,xmax:r,ymax:s}=e;return g(t,i,n)&&g(t,i,s)&&g(t,r,s)&&g(t,r,n)}function g(t,e,i){return e>=t.xmin&&e<=t.xmax&&i>=t.ymin&&i<=t.ymax}function y(t,e,i=!0){const n=!(0,a.Rg)(t);if(n&&(0,o.m3)(t),i)return(new b).cut(t,e);const r=n?t.rings:t.paths,s=n?4:2,l=r.length,c=-2*e;for(let t=0;t<l;t++){const e=r[t];if(e&&e.length>=s){const t=[];for(const i of e)t.push([i[0]+c,i[1]]);r.push(t)}}return n?t.rings=r:t.paths=r,t}class v{constructor(t,e){this.extent=t,this.frameIds=e}}const x=(0,r.vt)();class b{constructor(){this._linesIn=[],this._linesOut=[]}cut(t,e){let i;if(this._xCut=e,t.rings)this._closed=!0,i=t.rings,this._minPts=4;else{if(!t.paths)return null;this._closed=!1,i=t.paths,this._minPts=2}for(const t of i){if(!t||t.length<this._minPts)continue;let e=!0;for(const i of t)e?(this.moveTo(i),e=!1):this.lineTo(i);this._closed&&this.close()}this._pushLineIn(),this._pushLineOut(),i=[];for(const t of this._linesIn)t&&t.length>=this._minPts&&i.push(t);const n=-2*this._xCut;for(const t of this._linesOut)if(t&&t.length>=this._minPts){for(const e of t)e[0]+=n;i.push(t)}return this._closed?t.rings=i:t.paths=i,t}moveTo(t){this._pushLineIn(),this._pushLineOut(),this._prevSide=this._side(t[0]),this._moveTo(t[0],t[1],this._prevSide),this._prevPt=t,this._firstPt=t}lineTo(t){const e=this._side(t[0]);if(e*this._prevSide==-1){const i=this._intersect(this._prevPt,t);this._lineTo(this._xCut,i,0),this._prevSide=0,this._lineTo(t[0],t[1],e)}else this._lineTo(t[0],t[1],e);this._prevSide=e,this._prevPt=t}close(){const t=this._firstPt,e=this._prevPt;t[0]===e[0]&&t[1]===e[1]||this.lineTo(t),this._checkClosingPt(this._lineIn),this._checkClosingPt(this._lineOut)}_moveTo(t,e,i){this._closed?(this._lineIn.push([i<=0?t:this._xCut,e]),this._lineOut.push([i>=0?t:this._xCut,e])):(i<=0&&this._lineIn.push([t,e]),i>=0&&this._lineOut.push([t,e]))}_lineTo(t,e,i){this._closed?(S(this._lineIn,i<=0?t:this._xCut,e),S(this._lineOut,i>=0?t:this._xCut,e)):i<0?(0===this._prevSide&&this._pushLineOut(),this._lineIn.push([t,e])):i>0?(0===this._prevSide&&this._pushLineIn(),this._lineOut.push([t,e])):this._prevSide<0?(this._lineIn.push([t,e]),this._lineOut.push([t,e])):this._prevSide>0&&(this._lineOut.push([t,e]),this._lineIn.push([t,e]))}_checkClosingPt(t){const e=t.length;e>3&&t[0][0]===this._xCut&&t[e-2][0]===this._xCut&&t[1][0]===this._xCut&&(t[0][1]=t[e-2][1],t.pop())}_side(t){return t<this._xCut?-1:t>this._xCut?1:0}_intersect(t,e){const i=(this._xCut-t[0])/(e[0]-t[0]);return t[1]+i*(e[1]-t[1])}_pushLineIn(){this._lineIn&&this._lineIn.length>=this._minPts&&this._linesIn.push(this._lineIn),this._lineIn=[]}_pushLineOut(){this._lineOut&&this._lineOut.length>=this._minPts&&this._linesOut.push(this._lineOut),this._lineOut=[]}}function S(t,e,i){const n=t.length;n>1&&t[n-1][0]===e&&t[n-2][0]===e?t[n-1][1]=i:t.push([e,i])}},7415:function(t,e,i){i.d(e,{X_:function(){return o},i1:function(){return a},zx:function(){return l}});var n=i(15774),r=i(62938);const s=96;function o(t,e){const i=e||t.extent,n=t.width,o=(0,r.GA)(i?.spatialReference);return i&&n?i.width/n*o*r.dy*s:0}function a(t,e){return t/((0,r.GA)(e)*r.dy*s)}function l(t,e,i){return function(t,e){return 0===e||(0,n.Sp)(t,e)||t<e}(t,e)&&function(t,e){return 0===e||(0,n.Sp)(t,e)||t>e}(t,i)}},36729:function(t,e,i){i.d(e,{$B:function(){return d}});var n=i(53804),r=i(83525),s=i(58941),o=i(21609),a=i(40633),l=i(23502),c=i(65953),u=i(70994),h=i(25128);let d=class extends r.A{constructor(t){super(t),this._from=null,this._to=null,this._final=null,this._current=[],this._time=0,this.duration=(0,s.A)("mapview-transitions-duration"),this.effects=[]}set effect(t){if(this._get("effect")!==(t=t||"")){this._set("effect",t);try{this._transitionTo(f(t))}catch(e){this._transitionTo([]),a.A.getLogger(this).warn("Invalid Effect",{effect:t,error:e})}}}get final(){return this._final}get hasEffects(){return this.transitioning||!!this.effects.length}set scale(t){this._updateForScale(t)}get transitioning(){return null!==this._to}canTransitionTo(t){try{return this.scale>0&&p(this._current,f(t),this.scale)}catch{return!1}}transitionStep(t,e){this._applyTimeTransition(t),this._updateForScale(e)}endTransition(){this._applyTimeTransition(this.duration)}_transitionTo(t){this.scale>0&&p(this._current,t,this.scale)?(this._final=t,this._to=(0,o.o8)(t),function(t,e,i){const n=t.length>e.length?t:e,r=t.length>e.length?e:t,s=r[r.length-1],o=s?.scale??i,a=s?.effects??[];for(let t=r.length;t<n.length;t++)r.push({scale:o,effects:[...a]});for(let t=0;t<n.length;t++)r[t].scale=-1===r[t].scale?i:r[t].scale,n[t].scale=-1===n[t].scale?i:n[t].scale,(0,h.O9)(r[t].effects,n[t].effects)}(this._current,this._to,this.scale),this._from=(0,o.o8)(this._current),this._time=0):(this._from=this._to=this._final=null,this._current=t),this._set("effects",this._current[0]?(0,o.o8)(this._current[0].effects):[])}_applyTimeTransition(t){if(!(this._to&&this._from&&this._current&&this._final))return;this._time+=t;const e=Math.min(1,this._time/this.duration);for(let t=0;t<this._current.length;t++){const i=this._current[t],n=this._from[t],r=this._to[t];i.scale=_(n.scale,r.scale,e);for(let t=0;t<i.effects.length;t++){const s=i.effects[t],o=n.effects[t],a=r.effects[t];s.interpolate(o,a,e)}}1===e&&(this._current=this._final,this._set("effects",this._current[0]?(0,o.o8)(this._current[0].effects):[]),this._from=this._to=this._final=null)}_updateForScale(t){if(this._set("scale",t),0===this._current.length)return;const e=this._current,i=this._current.length-1;let n,r,s=1;if(1===e.length||t>=e[0].scale)r=n=e[0].effects;else if(t<=e[i].scale)r=n=e[i].effects;else for(let o=0;o<i;o++){const i=e[o],a=e[o+1];if(i.scale>=t&&a.scale<=t){s=(t-i.scale)/(a.scale-i.scale),n=i.effects,r=a.effects;break}}for(let t=0;t<this.effects.length;t++)this.effects[t].interpolate(n[t],r[t],s)}};function f(t){const e=(0,u.q)(t)||[];return function(t){const e=t[0];return!!e&&"type"in e}(e)?[{scale:-1,effects:e}]:e}function p(t,e,i){return!t[0]?.effects||!e[0]?.effects||!((-1===t[0]?.scale||-1===e[0]?.scale)&&(t.length>1||e.length>1)&&i<=0)&&(0,h.mj)(t[0].effects,e[0].effects)}function _(t,e,i){return t+(e-t)*i}(0,n._)([(0,l.MZ)()],d.prototype,"_to",void 0),(0,n._)([(0,l.MZ)()],d.prototype,"duration",void 0),(0,n._)([(0,l.MZ)({value:""})],d.prototype,"effect",null),(0,n._)([(0,l.MZ)({readOnly:!0})],d.prototype,"effects",void 0),(0,n._)([(0,l.MZ)({readOnly:!0})],d.prototype,"final",null),(0,n._)([(0,l.MZ)({readOnly:!0})],d.prototype,"hasEffects",null),(0,n._)([(0,l.MZ)({value:0})],d.prototype,"scale",null),(0,n._)([(0,l.MZ)({readOnly:!0})],d.prototype,"transitioning",null),d=(0,n._)([(0,c.$)("esri.layers.effects.EffectView")],d)},65215:function(t,e,i){i.d(e,{N3:function(){return s},Om:function(){return r}});var n=i(76613);class r{constructor(t=null,e={},i,n){this.geometry=t,this.attributes=e,this.centroid=i,this.objectId=n,this.displayId=0,this.geohashX=0,this.geohashY=0}static fromJSON(t,e){const i=t.geometry?n.A.fromJSON(t.geometry):null,s=t.centroid?n.A.fromJSON(t.centroid):null,o=t.attributes[e];return new r(i,t.attributes,s,o)}weakClone(){const t=new r(this.geometry,this.attributes,this.centroid,this.objectId);return t.displayId=this.displayId,t.geohashX=this.geohashX,t.geohashY=this.geohashY,t}clone(){const t=this.geometry?.clone(),e=new r(t,{...this.attributes},this.centroid?.clone(),this.objectId);return e.displayId=this.displayId,e.geohashX=this.geohashX,e.geohashY=this.geohashY,e}}function s(t){return!!t.geometry?.coords?.length}},72887:function(t,e,i){i.d(e,{A:function(){return n}});class n{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const t=new n;return t.objectIdFieldName=this.objectIdFieldName,t.globalIdFieldName=this.globalIdFieldName,t.geohashFieldName=this.geohashFieldName,t.geometryProperties=this.geometryProperties,t.geometryType=this.geometryType,t.spatialReference=this.spatialReference,t.hasZ=this.hasZ,t.hasM=this.hasM,t.features=this.features,t.fields=this.fields,t.transform=this.transform,t.exceededTransferLimit=this.exceededTransferLimit,t.uniqueIdField=this.uniqueIdField,t.queryGeometry=this.queryGeometry,t.queryGeometryType=this.queryGeometryType,t}}},76613:function(t,e,i){i.d(e,{A:function(){return n}});class n{constructor(t=[],e=[]){this.lengths=t??[],this.coords=e??[]}static fromJSON(t){return new n(t.lengths,t.coords)}static fromRect(t){const[e,i,r,s]=t,o=r-e,a=s-i;return new n([5],[e,i,o,0,0,a,-o,0,0,-a])}get isPoint(){return 0===this.lengths.length&&this.coords.length>=2}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce(((t,e)=>t+e))}forEachVertex(t){let e=0;this.lengths.length||t(this.coords[0],this.coords[1]);for(let i=0;i<this.lengths.length;i++){const n=this.lengths[i];for(let i=0;i<n;i++)t(this.coords[2*(i+e)],this.coords[2*(i+e)+1]);e+=n}}deltaDecode(){const t=this.clone(),{coords:e,lengths:i}=t;let n=0;for(const t of i){for(let i=1;i<t;i++)e[2*(n+i)]+=e[2*(n+i)-2],e[2*(n+i)+1]+=e[2*(n+i)-1];n+=t}return t}clone(t){if(0===this.lengths.length)return new n([],[this.coords[0],this.coords[1]]);const e=2*(0===this.lengths.length?1:this.lengths.reduce(((t,e)=>t+e))),i=this.coords.slice(0,e);return t?(t.set(i),new n(this.lengths,t)):new n(Array.from(this.lengths),Array.from(i))}}},40302:function(t,e,i){function n(t,e){return t?e?4:3:e?3:2}function r(t,e,i,r){if(!e?.lengths.length)return null;t.lengths.length&&(t.lengths.length=0),t.coords.length&&(t.coords.length=0);const a=t.coords,l=[],c=i?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:u,coords:h}=e,d=n(i,r);let f=0;for(const t of u){const e=s(c,h,f,t,i,r);e&&l.push(e),f+=t*d}if(l.sort(((t,e)=>{let n=t[2]-e[2];return 0===n&&i&&(n=t[4]-e[4]),n})),l.length){let t=6*l[0][2];a[0]=l[0][0]/t,a[1]=l[0][1]/t,i&&(t=6*l[0][4],a[2]=0!==t?l[0][3]/t:0),(a[0]<c[0]||a[0]>c[1]||a[1]<c[2]||a[1]>c[3]||i&&(a[2]<c[4]||a[2]>c[5]))&&(a.length=0)}if(!a.length){const t=e.lengths[0]?o(h,0,u[0],i,r):null;if(!t)return null;a[0]=t[0],a[1]=t[1],i&&t.length>2&&(a[2]=t[2])}return t}function s(t,e,i,r,s,o){const a=n(s,o);let l=i,c=i+a,u=0,h=0,d=0,f=0,p=0;for(let i=0,n=r-1;i<n;i++,l+=a,c+=a){const i=e[l],n=e[l+1],r=e[l+2],o=e[c],a=e[c+1],_=e[c+2];let m=i*a-o*n;f+=m,u+=(i+o)*m,h+=(n+a)*m,s&&(m=i*_-o*r,d+=(r+_)*m,p+=m),i<t[0]&&(t[0]=i),i>t[1]&&(t[1]=i),n<t[2]&&(t[2]=n),n>t[3]&&(t[3]=n),s&&(r<t[4]&&(t[4]=r),r>t[5]&&(t[5]=r))}if(f>0&&(f*=-1),p>0&&(p*=-1),!f)return null;const _=[u,h,.5*f];return s&&(_[3]=d,_[4]=.5*p),_}function o(t,e,i,r,s){const o=n(r,s);let h=e,d=e+o,f=0,p=0,_=0,m=0;for(let e=0,n=i-1;e<n;e++,h+=o,d+=o){const e=t[h],i=t[h+1],n=t[h+2],s=t[d],o=t[d+1],g=t[d+2],y=r?l(e,i,n,s,o,g):a(e,i,s,o);if(y)if(f+=y,r){const t=u(e,i,n,s,o,g);p+=y*t[0],_+=y*t[1],m+=y*t[2]}else{const t=c(e,i,s,o);p+=y*t[0],_+=y*t[1]}}return f>0?r?[p/f,_/f,m/f]:[p/f,_/f]:i>0?r?[t[e],t[e+1],t[e+2]]:[t[e],t[e+1]]:null}function a(t,e,i,n){const r=i-t,s=n-e;return Math.sqrt(r*r+s*s)}function l(t,e,i,n,r,s){const o=n-t,a=r-e,l=s-i;return Math.sqrt(o*o+a*a+l*l)}function c(t,e,i,n){return[t+.5*(i-t),e+.5*(n-e)]}function u(t,e,i,n,r,s){return[t+.5*(n-t),e+.5*(r-e),i+.5*(s-i)]}i.d(e,{Q:function(){return r}})},78956:function(t,e,i){i.d(e,{LQ:function(){return c},ag:function(){return h},pL:function(){return u}});var n=i(58081),r=i(76613);const s=new r.A,o=new r.A,a=new r.A,l={esriGeometryPoint:n.DF,esriGeometryPolyline:n.BW,esriGeometryPolygon:n.z5,esriGeometryMultipoint:n.qK};function c(t,e,i,r=t.hasZ,s=t.hasM){if(null==e)return null;const o=t.hasZ&&r,l=t.hasM&&s;if(i){const c=(0,n.Nl)(a,e,t.hasZ,t.hasM,"esriGeometryPoint",i,r,s);return(0,n.DF)(c,o,l)}return(0,n.DF)(e,o,l)}function u(t,e,i,r,c,u,h=e,d=i){const f=e&&h,p=i&&d,_=null!=r?"coords"in r?r:r.geometry:null;if(null==_)return null;if(c){let r=(0,n.kz)(o,_,e,i,t,c,h,d);return u&&(r=(0,n.Nl)(a,r,f,p,t,u)),l[t]?.(r,f,p)??null}if(u){const r=(0,n.Nl)(a,_,e,i,t,u,h,d);return l[t]?.(r,f,p)??null}return(0,n.Q4)(s,_,e,i,h,d),l[t]?.(s,f,p)??null}function h(t){return t&&d in t?JSON.parse(JSON.stringify(t,f)):t}const d="_geVersion",f=(t,e)=>t!==d?e:void 0},74841:function(t,e,i){i.d(e,{Cv:function(){return m},Nk:function(){return f},lK:function(){return y}});var n=i(50659),r=i(60539),s=i(46157),o=i(86029),a=i(57652),l=i(1644);const c=[0,0];function u(t,e){if(!e)return null;if("x"in e){const i={x:0,y:0};return[i.x,i.y]=t(e.x,e.y,c),null!=e.z&&(i.z=e.z),null!=e.m&&(i.m=e.m),i}if("xmin"in e){const i={xmin:0,ymin:0,xmax:0,ymax:0};return[i.xmin,i.ymin]=t(e.xmin,e.ymin,c),[i.xmax,i.ymax]=t(e.xmax,e.ymax,c),e.hasZ&&(i.zmin=e.zmin,i.zmax=e.zmax,i.hasZ=!0),e.hasM&&(i.mmin=e.mmin,i.mmax=e.mmax,i.hasM=!0),i}return"rings"in e?{rings:h(e.rings,t),hasM:e.hasM,hasZ:e.hasZ}:"paths"in e?{paths:h(e.paths,t),hasM:e.hasM,hasZ:e.hasZ}:"points"in e?{points:d(e.points,t),hasM:e.hasM,hasZ:e.hasZ}:null}function h(t,e){const i=[];for(const n of t)i.push(d(n,e));return i}function d(t,e){const i=[];for(const n of t){const t=e(n[0],n[1],[0,0]);i.push(t),n.length>2&&t.push(n[2]),n.length>3&&t.push(n[3])}return i}async function f(t,e){if(!t||!e)return;const i=Array.isArray(t)?t.map((t=>null!=t.geometry?t.geometry.spatialReference:null)).filter(n.Ru):[t];await(0,s.initializeProjection)(i.map((t=>({source:t,dest:e}))))}const p=u.bind(null,l.je),_=u.bind(null,l.tD);function m(t,e,i,n){if(!t)return t;if(i||(i=e,e=t.spatialReference),!(0,a.fn)(e)||!(0,a.fn)(i)||(0,a.aI)(e,i))return t;if((0,l.y7)(e,i)){const e=(0,a.K8)(i)?p(t):_(t);return e.spatialReference=i,e}return(0,s.projectMany)(o.g,[t],e,i,null,n)[0]}const g=new class{constructor(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}async push(t,e,i,n){if(!t?.length||!e||!i||(0,a.aI)(e,i))return t;const s={geometries:t,inSpatialReference:e,outSpatialReference:i,geographicTransformation:n,resolve:(0,r.Tw)()};return this._jobs.push(s),this._timer??=setTimeout(this._process,10),s.resolve.promise}_process(){this._timer=null;const t=this._jobs.shift();if(!t)return;const{geometries:e,inSpatialReference:i,outSpatialReference:n,resolve:r,geographicTransformation:c}=t;(0,l.y7)(i,n)?(0,a.K8)(n)?r(e.map(p)):r(e.map(_)):r((0,s.projectMany)(o.g,e,i,n,c,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}};function y(t,e,i,n){return g.push(t,e,i,n)}},20932:function(t,e,i){i.d(e,{GC:function(){return f},T2:function(){return p},VY:function(){return h},v8:function(){return d}});var n=i(73037),r=i(62938),s=i(46157),o=i(38503),a=i(74697),l=i(65298),c=i(57652),u=i(74841);const h=new n.J({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),d=Object.freeze({});async function f(t,e,i){const{outFields:n,orderByFields:r,groupByFieldsForStatistics:s,outStatistics:o}=t;if(n)for(let t=0;t<n.length;t++)n[t]=n[t].trim();if(r)for(let t=0;t<r.length;t++)r[t]=r[t].trim();if(s)for(let t=0;t<s.length;t++)s[t]=s[t].trim();if(o)for(let t=0;t<o.length;t++)o[t].onStatisticField&&(o[t].onStatisticField=o[t].onStatisticField.trim());return t.geometry&&!t.outSR&&(t.outSR=t.geometry.spatialReference),p(t,e,i)}async function p(t,e,n){if(!t)return null;let{where:s}=t;if(t.where=s=s?.trim(),(!s||/^1 *= *1$/.test(s)||e&&e===s)&&(t.where=null),!t.geometry)return t;let f=await async function(t){const{distance:e,units:n}=t,s=t.geometry;if(null==e||"vertexAttributes"in s)return s;const o=s.spatialReference,a=n?h.fromJSON(n):(0,r.Ij)(o),l=o&&((0,c.EA)(o)||(0,c.K8)(o))?s:await(0,u.Nk)(o,c.KK).then((()=>(0,u.Cv)(s,c.KK)));return(await async function(){return(await i.e(4696).then(i.bind(i,28356))).geodesicBuffer}())(l.spatialReference,l,e,a)}(t);if(t.distance=0,t.units=null,"esriSpatialRelEnvelopeIntersects"===t.spatialRel){const{spatialReference:e}=t.geometry;f=(0,o.HA)(f),f.spatialReference=e}if(f){await(0,u.Nk)(f.spatialReference,n),f=function(t,e){const i=t.spatialReference;return _(t,e)&&(0,a.ZC)(t)?{spatialReference:i,rings:[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]}:t}(f,n);const e=(await(0,l.el)((0,a.rS)(f)))[0];if(null==e)throw d;const i="quantizationParameters"in t&&t.quantizationParameters?.tolerance||"maxAllowableOffset"in t&&t.maxAllowableOffset||0,r=i&&_(f,n)?{densificationStep:8*i}:void 0,s=e.toJSON(),o=(0,u.Cv)(s,s.spatialReference,n,r);if(!o)throw d;o.spatialReference=n,t.geometry=o}return t}function _(t,e){if(!t)return!1;const i=t.spatialReference;return((0,a.ZC)(t)||(0,a.Bi)(t)||(0,a.Rg)(t))&&!(0,c.aI)(i,e)&&!(0,s.canProjectWithoutEngine)(i,e)}},62512:function(t,e,i){i.d(e,{tC:function(){return b},c0:function(){return x},xt:function(){return v}});var n=i(39819),r=i(61273),s=i(96127),o=i(74697),a=i(57652);function l(t,e){return t?e?4:3:e?3:2}function c(t,e,i,n,r,s){const o=l(r,s),{coords:a,lengths:c}=n;if(!c)return!1;for(let n=0,r=0;n<c.length;n++,r+=o)if(!u(t,e,i,a[r],a[r+1]))return!1;return!0}function u(t,e,i,n,r){if(!t)return!1;const s=l(e,i),{coords:o,lengths:a}=t;let c=!1,u=0;for(const t of a)c=h(c,o,s,u,t,n,r),u+=t*s;return c}function h(t,e,i,n,r,s,o){let a=t,l=n;for(let t=n,c=n+r*i;t<c;t+=i){l=t+i,l===c&&(l=n);const r=e[t],u=e[t+1],h=e[l],d=e[l+1];(u<o&&d>=o||d<o&&u>=o)&&r+(o-u)/(d-u)*(h-r)<s&&(a=!a)}return a}var d=i(58081),f=i(76613),p=i(78956),_=i(74841);const m="unsupported-query",g={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},y={spatialRelationship:{esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},queryGeometry:{esriGeometryPoint:!0,esriGeometryMultiPatch:!1,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},layerGeometry:{esriGeometryPoint:!0,esriGeometryMultiPatch:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1}};function v(t,e,n,a,l){if((0,o.Bi)(e)&&"esriGeometryPoint"===n&&("esriSpatialRelIntersects"===t||"esriSpatialRelContains"===t)){const t=(0,d.Ye)(new f.A,e,!1,!1);return Promise.resolve((e=>function(t,e,i,n){return u(t,!1,!1,n.coords[0],n.coords[1])}(t,0,0,e)))}if((0,o.Bi)(e)&&"esriGeometryMultipoint"===n){const i=(0,d.Ye)(new f.A,e,!1,!1);if("esriSpatialRelContains"===t)return Promise.resolve((t=>c(i,!1,!1,t,a,l)))}if((0,o.ZC)(e)&&"esriGeometryPoint"===n&&("esriSpatialRelIntersects"===t||"esriSpatialRelContains"===t))return Promise.resolve((t=>(0,r.qz)(e,(0,p.pL)(n,a,l,t))));if((0,o.ZC)(e)&&"esriGeometryMultipoint"===n&&"esriSpatialRelContains"===t)return Promise.resolve((t=>(0,r.rL)(e,(0,p.pL)(n,a,l,t))));if((0,o.ZC)(e)&&"esriSpatialRelIntersects"===t){const t="mesh"===(h=n)?s.xB:(0,s.xK)(h);return Promise.resolve((i=>t(e,(0,p.pL)(n,a,l,i))))}var h;return i.e(4696).then(i.bind(i,28356)).then((i=>{const r=i[g[t]].bind(null,e.spatialReference,e);return t=>r((0,p.pL)(n,a,l,t))}))}async function x(t,e,i){const{spatialRel:r,geometry:s}=t;if(s){if(!function(t){return null!=t&&!0===y.spatialRelationship[t]}(r))throw new n.A(m,"Unsupported query spatial relationship",{query:t});if((0,a.fn)(s.spatialReference)&&(0,a.fn)(i)){if(!function(t){return null!=t&&!0===y.queryGeometry[(0,o.$B)(t)]}(s))throw new n.A(m,"Unsupported query geometry type",{query:t});if(!function(t){return null!=t&&!0===y.layerGeometry[t]}(e))throw new n.A(m,"Unsupported layer geometry type",{query:t});if(t.outSR)return(0,_.Nk)(t.geometry?.spatialReference,t.outSR)}}}function b(t){if((0,o.ZC)(t))return!0;if((0,o.Bi)(t)){for(const e of t.rings){if(5!==e.length)return!1;if(e[0][0]!==e[1][0]||e[0][0]!==e[4][0]||e[2][0]!==e[3][0]||e[0][1]!==e[3][1]||e[0][1]!==e[4][1]||e[1][1]!==e[2][1])return!1}return!0}return!1}},20973:function(t,e,i){async function n(t,e){if(!t)return null;const i=e.featureAdapter,{startTimeField:n,endTimeField:r}=t;let s=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;if(n&&r)await e.forEach((t=>{const e=i.getAttribute(t,n),a=i.getAttribute(t,r);null==e||isNaN(e)||(s=Math.min(s,e)),null==a||isNaN(a)||(o=Math.max(o,a))}));else{const t=n||r;await e.forEach((e=>{const n=i.getAttribute(e,t);null==n||isNaN(n)||(s=Math.min(s,n),o=Math.max(o,n))}))}return{start:s,end:o}}function r(t,e,i){if(!e||!t)return null;const{startTimeField:n,endTimeField:r}=t;if(!n&&!r)return null;const{start:s,end:o}=e;if(null===s&&null===o)return null;if(void 0===s&&void 0===o)return()=>!1;const a=i.getAttributeAsTimestamp?.bind(i)??i.getAttribute.bind(i);return n&&r?function(t,e,i,n,r){return null!=n&&null!=r?s=>{const o=t(s,e),a=t(s,i);return(null==o||o<=r)&&(null==a||a>=n)}:null!=n?e=>{const r=t(e,i);return null==r||r>=n}:null!=r?i=>{const n=t(i,e);return null==n||n<=r}:void 0}(a,n,r,s,o):function(t,e,i,n){return null!=i&&null!=n&&i===n?n=>t(n,e)===i:null!=i&&null!=n?r=>{const s=t(r,e);return null!=s&&s>=i&&s<=n}:null!=i?n=>{const r=t(n,e);return null!=r&&r>=i}:null!=n?i=>{const r=t(i,e);return null!=r&&r<=n}:void 0}(a,n||r,s,o)}i.d(e,{I:function(){return r},W:function(){return n}})},58081:function(t,e,i){i.d(e,{B2:function(){return b},BW:function(){return L},Ch:function(){return rt},DF:function(){return w},Di:function(){return W},E2:function(){return Y},IE:function(){return x},Nl:function(){return J},Q4:function(){return st},Rk:function(){return at},Ux:function(){return Z},Ye:function(){return B},ZF:function(){return j},eU:function(){return V},eY:function(){return K},jH:function(){return Q},jQ:function(){return nt},kz:function(){return tt},oN:function(){return H},q3:function(){return X},qK:function(){return z},qN:function(){return F},z5:function(){return N},zv:function(){return q}});var n=i(39819),r=i(40633),s=i(95929),o=i(24761),a=i(87416),l=i(74697),c=i(65215),u=i(72887),h=i(76613);function d(t,e){return t?e?4:3:e?3:2}const f=()=>r.A.getLogger("esri.layers.graphics.featureConversionUtils"),p={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryMultiPatch:3,esriGeometryEnvelope:0},_=(t,e,i,n,r,s)=>{t[i]=r,t[i+1]=s},m=(t,e,i,n,r,s)=>{t[i]=r,t[i+1]=s,t[i+2]=e[n+2]},g=(t,e,i,n,r,s)=>{t[i]=r,t[i+1]=s,t[i+2]=e[n+3]},y=(t,e,i,n,r,s)=>{t[i]=r,t[i+1]=s,t[i+2]=e[n+2],t[i+3]=e[n+3]};function v(t,e,i,n){if(t){if(i)return e&&n?y:m;if(e&&n)return g}else if(e&&n)return m;return _}function x({scale:t,translate:e},i){return Math.round((i-e[0])/t[0])}function b({scale:t,translate:e},i){return Math.round((e[1]-i)/t[1])}function S({scale:t,translate:e},i,n){return i*t[n]+e[n]}function w(t,e,i){return t?e?i?E(t):P(t):i?C(t):T(t):null}function T(t){const e=t.coords;return{x:e[0],y:e[1]}}function M(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t}function P(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2]}}function A(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t}function C(t){const e=t.coords;return{x:e[0],y:e[1],m:e[2]}}function I(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.m,t}function E(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2],m:e[3]}}function R(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t.coords[3]=e.m,t}function O(t,e){return t&&e?R:t?A:e?I:M}function F(t,e,i=O(null!=e.z,null!=e.m)){return i(t,e)}function z(t,e,i){if(null==t)return null;const n=d(e,i),r=[];for(let e=0;e<t.coords.length;e+=n){const i=[];for(let r=0;r<n;r++)i.push(t.coords[e+r]);r.push(i)}return e?i?{points:r,hasZ:e,hasM:i}:{points:r,hasZ:e}:i?{points:r,hasM:i}:{points:r}}function D(t,e,i=d(e.hasZ,e.hasM)){t.lengths[0]=e.points.length;const n=t.coords;let r=0;for(const t of e.points)for(let e=0;e<i;e++)n[r++]=t[e];return t}function L(t,e,i){if(!t)return null;const n=d(e,i),{coords:r,lengths:s}=t,o=[];let a=0;for(const t of s){const e=[];for(let i=0;i<t;i++){const t=[];for(let e=0;e<n;e++)t.push(r[a++]);e.push(t)}o.push(e)}return e?i?{paths:o,hasZ:e,hasM:i}:{paths:o,hasZ:e}:i?{paths:o,hasM:i}:{paths:o}}function k(t,e,i=d(e.hasZ,e.hasM)){const{lengths:n,coords:r}=t;let s=0;for(const t of e.paths){for(const e of t)for(let t=0;t<i;t++)r[s++]=e[t];n.push(t.length)}return t}function N(t,e,i){if(!t)return null;const n=d(e,i),{coords:r,lengths:s}=t,o=[];let a=0;for(const t of s){const e=[];for(let i=0;i<t;i++){const t=[];for(let e=0;e<n;e++)t.push(r[a++]);e.push(t)}o.push(e)}return e?i?{rings:o,hasZ:e,hasM:i}:{rings:o,hasZ:e}:i?{rings:o,hasM:i}:{rings:o}}function B(t,e,i=e.hasZ,n=e.hasM){return V(t,e.rings,i,n)}function V(t,e,i,n){const r=d(i,n),{lengths:s,coords:o}=t;let a=0;lt(t);for(const t of e){for(const e of t)for(let t=0;t<r;t++)o[a++]=e[t];s.push(t.length)}return t}const U=[],G=[];function Y(t,e,i,n,r){U[0]=t;const[s]=W(G,U,e,i,n,r);return ct(U),ct(G),s}function W(t,e,i,r,s,o){if(ct(t),!i){for(const i of e){const e=o?i.attributes[o]:void 0;t.push(new c.Om(null,i.attributes,null,e))}return t}switch(i){case"esriGeometryPoint":return function(t,e,i,n,r){const s=O(i,n);for(const{geometry:i,attributes:n}of e){const e=null!=i?s(new h.A,i):null;t.push(new c.Om(e,n,null,r?n[r]:void 0))}return t}(t,e,r,s,o);case"esriGeometryMultipoint":return function(t,e,i,n,r){const s=d(i,n);for(const{geometry:i,attributes:n}of e){const e=null!=i?D(new h.A,i,s):null;t.push(new c.Om(e,n,null,r?n[r]:void 0))}return t}(t,e,r,s,o);case"esriGeometryPolyline":return function(t,e,i,n,r){const s=d(i,n);for(const{geometry:i,attributes:n,centroid:o}of e){const e=null!=i?k(new h.A,i,s):null,a=null!=o?F(new h.A,o):null;t.push(new c.Om(e,n,a,r?n[r]:void 0))}return t}(t,e,r,s,o);case"esriGeometryPolygon":case"esriGeometryMultiPatch":return function(t,e,i,n,r){for(const{geometry:s,centroid:o,attributes:a}of e){const e=null!=s?B(new h.A,s,i,n):null,l=r?a[r]:void 0;null!=o?t.push(new c.Om(e,a,M(new h.A,o),l)):t.push(new c.Om(e,a,null,l))}return t}(t,e,r,s,o);default:f().error("convertToFeatureSet:unknown-geometry",new n.A(`Unable to parse unknown geometry type '${i}'`)),ct(t)}return t}function H(t,e,i,n){G[0]=t,$(U,G,e,i,n);const r=U[0];return ct(U),ct(G),r}function Z(t,e,i){if(null==t)return null;const r=new h.A;return"hasZ"in t&&null==e&&(e=t.hasZ),"hasM"in t&&null==i&&(i=t.hasM),(0,l.fT)(t)?O(null!=e?e:null!=t.z,null!=i?i:null!=t.m)(r,t):(0,l.Bi)(t)?B(r,t,e,i):(0,l.Rg)(t)?k(r,t,d(e,i)):(0,l.U9)(t)?D(r,t,d(e,i)):void f().error("convertFromGeometry:unknown-geometry",new n.A(`Unable to parse unknown geometry type '${t}'`))}function q(t,e,i,r){const s=t&&("coords"in t?t:t.geometry);if(null==s)return null;switch(e){case"esriGeometryPoint":{let t=T;return i&&r?t=E:i?t=P:r&&(t=C),t(s)}case"esriGeometryMultipoint":return z(s,i,r);case"esriGeometryPolyline":return L(s,i,r);case"esriGeometryPolygon":return N(s,i,r);default:return f().error("convertToGeometry:unknown-geometry",new n.A(`Unable to parse unknown geometry type '${e}'`)),null}}function $(t,e,i,r,s){if(ct(t),null==i)return function(t,e){for(const i of e)t.push({attributes:i.attributes});return t}(t,e);switch(i){case"esriGeometryPoint":return function(t,e,i,n){let r=T;i&&n?r=E:i?r=P:n&&(r=C);for(const i of e){const{geometry:e,attributes:n}=i,s=null!=e?r(e):null;t.push({attributes:n,geometry:s})}return t}(t,e,r,s);case"esriGeometryMultipoint":return function(t,e,i,n){for(const{geometry:r,attributes:s}of e)t.push({attributes:s,geometry:null!=r?z(r,i,n):null});return t}(t,e,r,s);case"esriGeometryPolyline":return function(t,e,i,n){for(const{geometry:r,attributes:s}of e)t.push({attributes:s,geometry:null!=r?L(r,i,n):null});return t}(t,e,r,s);case"esriGeometryPolygon":return function(t,e,i,n){for(const{geometry:r,attributes:s,centroid:o}of e){const e=null!=r?N(r,i,n):null;if(null!=o){const i=T(o);t.push({attributes:s,centroid:i,geometry:e})}else t.push({attributes:s,geometry:e})}return t}(t,e,r,s);default:f().error("convertToFeatureSet:unknown-geometry",new n.A(`Unable to parse unknown geometry type '${i}'`))}return t}function j(t){const{objectIdFieldName:e,spatialReference:i,transform:n,fields:r,hasM:s,hasZ:o,features:a,geometryType:l,exceededTransferLimit:c,uniqueIdField:u,queryGeometry:h,queryGeometryType:d}=t,f={features:$([],a,l,o,s),fields:r,geometryType:l,objectIdFieldName:e,spatialReference:i,uniqueIdField:u,queryGeometry:q(h,d,!1,!1)};return n&&(f.transform=n),c&&(f.exceededTransferLimit=c),s&&(f.hasM=s),o&&(f.hasZ=o),f}function X(t,e){const i=new u.A,{hasM:r,hasZ:s,features:o,objectIdFieldName:a,spatialReference:l,geometryType:c,exceededTransferLimit:h,transform:d,fields:p}=t;return p&&(i.fields=p),i.geometryType=c??null,i.objectIdFieldName=a??e??null,i.spatialReference=l??null,i.objectIdFieldName?(o&&W(i.features,o,c,s,r,i.objectIdFieldName),h&&(i.exceededTransferLimit=h),r&&(i.hasM=r),s&&(i.hasZ=s),d&&(i.transform=d),i):(f().error(new n.A("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),i)}function K(t){const{transform:e,features:i,hasM:n,hasZ:r}=t;if(!e)return t;for(const t of i)null!=t.geometry&&rt(t.geometry,t.geometry,n,r,e),null!=t.centroid&&rt(t.centroid,t.centroid,n,r,e);return t.transform=null,t}function Q(t,e){const{geometryType:i,features:n,hasM:r,hasZ:s}=e;if(!t)return e;for(let e=0;e<n.length;e++){const o=n[e],a=o.weakClone();a.geometry=new h.A,J(a.geometry,o.geometry,r,s,i,t),o.centroid&&(a.centroid=new h.A,J(a.centroid,o.centroid,r,s,"esriGeometryPoint",t)),n[e]=a}return e.transform=t,e}function J(t,e,i,n,r,s,o=i,a=n){if(lt(t),!e?.coords.length)return null;const l=p[r],{coords:c,lengths:u}=e,h=d(i,n),f=d(i&&o,n&&a),_=v(i,n,o,a);if(!u.length)return _(t.coords,c,0,0,x(s,c[0]),b(s,c[1])),lt(t,h,0),t;let m,g,y,S,w=0,T=0,M=T;for(const e of u){if(e<l)continue;let i=0;T=M,y=m=x(s,c[w]),S=g=b(s,c[w+1]),_(t.coords,c,T,w,y,S),i++,w+=h,T+=f;for(let n=1;n<e;n++,w+=h)y=x(s,c[w]),S=b(s,c[w+1]),y===m&&S===g||(_(t.coords,c,T,w,y-m,S-g),T+=f,i++,m=y,g=S);i>=l&&(t.lengths.push(i),M=T)}return ct(t.coords,M),t.coords.length?t:null}function tt(t,e,i,n,r,s,o=i,a=n){if(lt(t),!e?.coords.length)return null;const l=p[r],{coords:c,lengths:u}=e,h=d(i,n),f=d(i&&o,n&&a),_=v(i,n,o,a);if(!u.length)return _(t.coords,c,0,0,c[0],c[1]),lt(t,h,0),t;let m=0;const g=s*s;for(const e of u){if(e<l){m+=e*h;continue}const i=t.coords.length/f,n=m,r=m+(e-1)*h;_(t.coords,c,t.coords.length,n,c[n],c[n+1]),it(t.coords,c,h,g,_,n,r),_(t.coords,c,t.coords.length,r,c[r],c[r+1]);const s=t.coords.length/f-i;s>=l?t.lengths.push(s):ct(t.coords,i*f),m+=e*h}return t.coords.length?t:null}function et(t,e,i,n){const r=t[e],s=t[e+1],o=t[i],a=t[i+1],l=t[n],c=t[n+1];let u=o,h=a,d=l-u,f=c-h;if(0!==d||0!==f){const t=((r-u)*d+(s-h)*f)/(d*d+f*f);t>1?(u=l,h=c):t>0&&(u+=d*t,h+=f*t)}return d=r-u,f=s-h,d*d+f*f}function it(t,e,i,n,r,s,o){let a,l=n,c=0;for(let t=s+i;t<o;t+=i)a=et(e,t,s,o),a>l&&(c=t,l=a);l>n&&(c-s>i&&it(t,e,i,n,r,s,c),r(t,e,t.length,c,e[c],e[c+1]),o-c>i&&it(t,e,i,n,r,c,o))}function nt(t,e,i,n){if(!e?.coords?.length)return null;const r=d(i,n);let s=Number.POSITIVE_INFINITY,l=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,u=Number.NEGATIVE_INFINITY;if(e&&e.coords){const t=e.coords;for(let e=0;e<t.length;e+=r){const i=t[e],n=t[e+1];s=Math.min(s,i),c=Math.max(c,i),l=Math.min(l,n),u=Math.max(u,n)}}return(0,o.is)(t)?(0,o.BI)(t,s,l,c,u):(0,a.fA)(s,l,c,u,t),t}function rt(t,e,i,n,r){const{coords:o,lengths:a}=e,l=d(i,n);if(!o.length)return t!==e&&lt(t),t;(0,s.Lw)(r);const{originPosition:c,scale:u,translate:h}=r,f=ut;f.originPosition=c;const p=f.scale;p[0]=u[0]??1,p[1]=-(u[1]??1),p[2]=u[2]??1,p[3]=u[3]??1;const _=f.translate;if(_[0]=h[0]??0,_[1]=h[1]??0,_[2]=h[2]??0,_[3]=h[3]??0,!a.length){for(let e=0;e<l;++e)t.coords[e]=S(f,o[e],e);return t!==e&&lt(t,l,0),t}let m=0;for(let e=0;e<a.length;e++){const i=a[e];t.lengths[e]=i;for(let e=0;e<l;++e)t.coords[m+e]=S(f,o[m+e],e);let n=t.coords[m],r=t.coords[m+1];m+=l;for(let e=1;e<i;e++,m+=l){n+=o[m]*p[0],r+=o[m+1]*p[1],t.coords[m]=n,t.coords[m+1]=r;for(let e=2;e<l;++e)t.coords[m+e]=S(f,o[m+e],e)}}return t!==e&&lt(t,o.length,a.length),t}function st(t,e,i,n,r,s){if(lt(t),t.lengths.push(...e.lengths),i===r&&n===s)for(let i=0;i<e.coords.length;i++)t.coords.push(e.coords[i]);else{const o=d(i,n),a=v(i,n,r,s),l=e.coords;for(let e=0;e<l.length;e+=o)a(t.coords,l,t.coords.length,e,l[e],l[e+1])}return t}function ot(t,e,i,n){let r=0,s=t[n*e],o=t[n*(e+1)];for(let a=1;a<i;a++){const i=s+t[n*(e+a)],l=o+t[n*(e+a)+1],c=(i-s)*(l+o);s=i,o=l,r+=c}return.5*r}function at(t,e){const{coords:i,lengths:n}=t;let r=0,s=0;for(let t=0;t<n.length;t++){const o=n[t];s+=ot(i,r,o,e),r+=o}return Math.abs(s)}function lt(t,e=0,i=0){ct(t.lengths,i),ct(t.coords,e)}function ct(t,e=0){t.length!==e&&(t.length=e)}const ut={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]}},9030:function(t,e,i){i.d(e,{D:function(){return r}});var n=i(93040);async function r(t,e){const{data:i}=await(0,n.A)(t,{responseType:"image",...e});return i}},23454:function(t,e,i){i.d(e,{Aq:function(){return r},pC:function(){return s},rx:function(){return o}});var n=i(29076);function r(t,e){t[4]=e}class s{constructor(t,e=!0,i=!0,r=0){this.isClosed=!1,this.geometryCursor=null,this.geometryCursor=!e&&"esriGeometryPolygon"===t.geometryType||!i&&"esriGeometryPolyline"===t.geometryType?null:t,this.geomUnitsPerPoint=r,this.iterateMultiPath=!1,this.iteratePath=!1,this.internalPlacement=new n.W}next(){if(!this.geometryCursor)return null;const t=this.processMultiPath(this.geometryCursor);return this.iterateMultiPath&&t||(this.geometryCursor=null),t}processMultiPath(t){for(;this.iteratePath||t.pathIndex<t.totalSize-1;){this.iteratePath||t.nextPath(),this.iterateMultiPath=!0;const e=this.processPath(t);if(e)return e}return this.iterateMultiPath=!1,null}}class o{constructor(t,e,i,n=0){this.isClosed=!1,this.inputGeometries=t,this.acceptPolygon=e,this.acceptPolyline=i,this.geomUnitsPerPoint=n,this.iteratePath=!1,this.multiPathCursor=null}next(){for(;;){if(!this.multiPathCursor){let t=this.inputGeometries.next();for(;t&&(this.isClosed=this.acceptPolygon&&"esriGeometryPolygon"===t.geometryType||"esriGeometryEnvelope"===t.geometryType,this.multiPathCursor=t,!this.multiPathCursor);)t=this.inputGeometries.next();if(!this.multiPathCursor)return null}for(;this.iteratePath||this.multiPathCursor.nextPath();){this.multiPathCursor.seekPathStart();const t=this.processPath(this.multiPathCursor);if(t)return t}this.multiPathCursor=null}}}},62096:function(t,e,i){i.d(e,{k:function(){return a},q:function(){return l}});var n=i(33134),r=i(72139);const s=512;let o;class a{constructor(t){this._geometry=t}next(){const t=this._geometry;return this._geometry=null,t}}function l(t,e){o||(o=new r.O3(0,0,0,1));const i="esriGeometryPolygon"===t.geometryType,a=i?r.dC.Polygon:r.dC.LineString,l=i?3:2;let c,u;for(o.reset(a),o.setPixelMargin(e+1),o.setExtent(s);t.nextPath();)if(!(t.pathSize<l)){for(t.nextPoint(),c=t.x,u=-t.y,o.moveTo(c,u);t.nextPoint();)c=t.x,u=-t.y,o.lineTo(c,u);i&&o.close()}const h=o.result(!1);if(h){const e=n.z.createEmptyOptimizedCIM(t.geometryType);for(const t of h){e.startPath();for(const i of t)e.pushXY(i.x,-i.y)}return e.reset(),e}return null}},9635:function(t,e,i){i.d(e,{A:function(){return T},c:function(){return M}});var n=i(63514),r=i(82112),s=i(20391),o=i(11672),a=i(12281),l=i(2969),c=i(7889),u=i(48645),h=i(7088),d=i(17706),f=i(10183),p=i(1646),_=i(79323),m=i(34476),g=i(31771),y=i(15987),v=i(19511),x=i(20305),b=i(58892),S=i(80585),w=i(58676);function T(t){if(!t)return null;switch(t.type){case"CIMGeometricEffectAddControlPoints":return n.N.local();case"CIMGeometricEffectArrow":return r.B.local();case"CIMGeometricEffectBuffer":return s.s.local();case"CIMGeometricEffectControlMeasureLine":return o.v.local();case"CIMGeometricEffectCut":return a.y.local();case"CIMGeometricEffectDashes":return l.I.local();case"CIMGeometricEffectDonut":return c.O.local();case"CIMGeometricEffectJog":return u.U.local();case"CIMGeometricEffectMove":return h.V.local();case"CIMGeometricEffectOffset":return d.V.local();case"CIMGeometricEffectReverse":return f.C.local();case"CIMGeometricEffectRotate":return p.v.local();case"CIMGeometricEffectScale":return _.W.local();case"CIMGeometricEffectWave":return m.l.local()}return null}function M(t){if(!t)return null;switch(t.type){case"CIMMarkerPlacementAlongLineSameSize":return g.e.local();case"CIMMarkerPlacementAtExtremities":return y.y.local();case"CIMMarkerPlacementAtRatioPositions":return v.S.local();case"CIMMarkerPlacementInsidePolygon":return x.M.local();case"CIMMarkerPlacementOnLine":return b.R.local();case"CIMMarkerPlacementOnVertices":return S.A.local();case"CIMMarkerPlacementPolygonCenter":return w.L.local()}return null}},29076:function(t,e,i){i.d(e,{W:function(){return n}});class n{constructor(){this.setIdentity()}getAngle(){return(null==this.rz||0===this.rz&&1!==this.rzCos&&0!==this.rzSin)&&(this.rz=Math.atan2(this.rzSin,this.rzCos)),this.rz}setIdentity(){this.tx=0,this.ty=0,this.tz=0,this.s=1,this.rx=0,this.ry=0,this.rz=0,this.rzCos=1,this.rzSin=0}setTranslate(t,e){this.tx=t,this.ty=e}setTranslateZ(t){this.tz=t}setRotateCS(t,e){this.rz=void 0,this.rzCos=t,this.rzSin=e}setRotate(t){this.rz=t,this.rzCos=void 0,this.rzSin=void 0}setRotateY(t){this.ry=t}setScale(t){this.s=t}setMeasure(t){this.m=t}}},66981:function(t,e,i){i.d(e,{A:function(){return s}});var n=i(80683),r=i(87847);class s{constructor(){this._resourceMap=new Map,this._inFlightResourceMap=new Map,this.geometryEngine=null,this.geometryEnginePromise=null}destroy(){this._inFlightResourceMap.clear(),this._resourceMap.clear()}getResource(t){return this._resourceMap.get(t)??null}async fetchResource(t,e){const i=this._resourceMap.get(t);if(i)return{width:i.width,height:i.height};let n=this._inFlightResourceMap.get(t);return n?n.then((t=>({width:t.width,height:t.height}))):(n=(0,r.M5)(t,e),this._inFlightResourceMap.set(t,n),n.then((e=>(this._inFlightResourceMap.delete(t),this._resourceMap.set(t,e),{width:e.width,height:e.height})),(()=>({width:0,height:0}))))}deleteResource(t){this._inFlightResourceMap.delete(t),this._resourceMap.delete(t)}loadFont(t){return(0,n.Al)(t)}}},14817:function(t,e,i){i.d(e,{Rj:function(){return L},mx:function(){return z},CK:function(){return D},IT:function(){return O},QF:function(){return V}});var n=i(80683),r=i(58941),s=i(21609),o=i(40633),a=i(56996),l=i(13520),c=i(33134),u=i(87416),h=i(35068),d=i(72228),f=i(74697),p=i(62096);class _{applyColorSubstitution(t,e){if(!e)return t;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const{width:i,height:n}=t,r=this._rasterizationCanvas,s=r.getContext("2d",{willReadFrequently:!0});t!==r&&(r.width=i,r.height=n,s.drawImage(t,0,0,i,n));const o=s.getImageData(0,0,i,n).data;if(e)for(const t of e)if(t&&t.oldColor&&4===t.oldColor.length&&t.newColor&&4===t.newColor.length){const[e,i,n,r]=t.oldColor,[s,a,l,c]=t.newColor;if(e===s&&i===a&&n===l&&r===c)continue;for(let t=0;t<o.length;t+=4)e===o[t]&&i===o[t+1]&&n===o[t+2]&&r===o[t+3]&&(o[t]=s,o[t+1]=a,o[t+2]=l,o[t+3]=c)}const a=new ImageData(o,i,n);return s.putImageData(a,0,0),r}tintImageData(t,e){if(!e||e.length<4)return t;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const{width:i,height:n}=t,r=this._rasterizationCanvas,s=r.getContext("2d",{willReadFrequently:!0});t!==r&&(r.width=i,r.height=n,s.drawImage(t,0,0,i,n));const o=s.getImageData(0,0,i,n),a=new Uint8Array(o.data),l=[e[0]/255,e[1]/255,e[2]/255,e[3]/255];for(let t=0;t<a.length;t+=4)a[t]*=l[0],a[t+1]*=l[1],a[t+2]*=l[2],a[t+3]*=l[3];const c=new ImageData(new Uint8ClampedArray(a.buffer),i,n);return s.putImageData(c,0,0),r}}var m=i(9635),g=i(29076),y=i(38821),v=i(33389);function x(t){const e=t.getFrame(0);if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement)return e;const i=document.createElement("canvas");i.width=t.width,i.height=t.height;const n=i.getContext("2d");return e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0),i}var b=i(82497),S=i(64303);function w(t){return`rgba(${t.slice(0,3).toString()},${t[3]})`}class T{constructor(t){t&&(this._textRasterizationCanvas=t)}rasterizeText(t,e){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const i=this._textRasterizationCanvas,n=i.getContext("2d",{willReadFrequently:!0});M(n,e),this._parameters=e,this._textLines=t.split(/\r?\n/),this._lineHeight=this._computeLineHeight();const{decoration:r,weight:s}=e.font;this._lineThroughWidthOffset=r&&"line-through"===r?.1*this._lineHeight:0;const o=null!=e.backgroundColor||null!=e.borderLine,a=o?S.y7:0,l=this._computeTextWidth(n,e)+2*a,c=this._lineHeight*this._textLines.length+2*a;if(i.width=l+2*this._lineThroughWidthOffset,i.height=c,0===i.width||0===i.height)return i.width=i.height=1,{size:[0,0],image:new Uint32Array(0),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0,canvas:i};this._renderedLineHeight=Math.round(this._lineHeight),this._renderedOutlineSize=(e.outline.size||0)*e.pixelRatio,this._renderedHaloSize=(e.halo.size||0)*e.pixelRatio,this._renderedWidth=l,this._renderedHeight=c,this._lineThroughWidthOffset*=e.pixelRatio;const u=(e.outline&&e.outline.color)??[0,0,0,0],h=e.color??[0,0,0,0],d=e.halo&&e.halo.color?e.halo.color:[0,0,0,0];this._fillStyle=w(h),this._outlineStyle=w(u),this._haloStyle=function(t){return`rgb(${t.slice(0,3).toString()})`}(d);const f=this._renderedLineHeight,p=this._renderedOutlineSize,_=this._renderedHaloSize;n.save(),n.clearRect(0,0,i.width,i.height),M(n,e);const m=a*e.pixelRatio,g=function(t,e,i){return"center"===t?.5*e:"right"===t?e-i:i}(n.textAlign,this._renderedWidth-2*m,this._renderedHaloSize+this._renderedOutlineSize)+m,y=_+p+m,v=_>0;let x=this._lineThroughWidthOffset,b=0;if(o){n.save();const t=e.backgroundColor??[0,0,0,0],r=e.borderLine?.color??[0,0,0,0],s=2*(e.borderLine?.size??0);n.fillStyle=w(t),n.strokeStyle=w(r),n.lineWidth=s,n.fillRect(0,0,i.width,i.height),n.strokeRect(0,0,i.width,i.height),n.restore()}v&&this._renderHalo(n,g,y,x,b,e),p>0&&this._renderOutline(n,g,y,x,b,e),b+=y,x+=g;for(const t of this._textLines)v?(n.globalCompositeOperation="destination-out",n.fillStyle="rgb(0, 0, 0)",n.fillText(t,x,b),n.globalCompositeOperation="source-over",n.fillStyle=this._fillStyle,n.fillText(t,x,b)):(n.fillStyle=this._fillStyle,n.fillText(t,x,b)),r&&"none"!==r&&this._renderDecoration(n,x,b,r,s),b+=f;n.restore();const T=this._renderedWidth+2*this._lineThroughWidthOffset,P=this._renderedHeight,A=n.getImageData(0,0,T,P),C=new Uint8Array(A.data);if(e.premultiplyColors){let t;for(let e=0;e<C.length;e+=4)t=C[e+3]/255,C[e]=C[e]*t,C[e+1]=C[e+1]*t,C[e+2]=C[e+2]*t}let I,E;switch(e.horizontalAlignment){case"left":I=-.5;break;case"right":I=.5;break;default:I=0}switch(e.verticalAlignment){case"bottom":E=-.5;break;case"top":E=.5;break;case"baseline":E=-1/6;break;default:E=0}return{size:[T,P],image:new Uint32Array(C.buffer),sdf:!1,simplePattern:!1,anchorX:I,anchorY:E,canvas:i}}_renderHalo(t,e,i,n,r,s){const o=this._renderedWidth,a=this._renderedHeight;this._outlineRasterizationCanvas||(this._outlineRasterizationCanvas=document.createElement("canvas")),this._outlineRasterizationCanvas.width=o,this._outlineRasterizationCanvas.height=a;const l=this._outlineRasterizationCanvas,c=l.getContext("2d");c.clearRect(0,0,o,a),M(c,s);const{decoration:u,weight:h}=s.font;c.fillStyle=this._haloStyle,c.strokeStyle=this._haloStyle,c.lineJoin="round",this._renderOutlineNative(c,e,i,u,h,this._renderedHaloSize+this._renderedOutlineSize),t.globalAlpha=this._parameters.halo.color[3],t.drawImage(l,0,0,o,a,n,r,o,a),t.globalAlpha=1}_renderOutline(t,e,i,n,r,s){const o=this._renderedWidth,a=this._renderedHeight;this._outlineRasterizationCanvas||(this._outlineRasterizationCanvas=document.createElement("canvas")),this._outlineRasterizationCanvas.width=o,this._outlineRasterizationCanvas.height=a;const l=this._outlineRasterizationCanvas,c=l.getContext("2d");c.clearRect(0,0,o,a),M(c,s);const{decoration:u,weight:h}=s.font;c.fillStyle=this._outlineStyle,c.strokeStyle=this._outlineStyle,c.lineJoin="round",this._renderOutlineNative(c,e,i,u,h,this._renderedOutlineSize),t.globalAlpha=this._parameters.outline.color[3],t.drawImage(l,0,0,o,a,n,r,o,a),t.globalAlpha=1}_renderOutlineNative(t,e,i,n,r,s){const o=this._renderedLineHeight;for(const a of this._textLines){const l=2*s,c=5,u=.1;for(let s=0;s<c;s++){const o=(1-(c-1)*u+s*u)*l;t.lineWidth=o,t.strokeText(a,e,i),n&&"none"!==n&&this._renderDecoration(t,e,i,n,r,o)}i+=o}}computeTextSize(t,e){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const i=this._textRasterizationCanvas,n=i.getContext("2d");M(n,e),this._parameters=e,this._textLines=t.split(/\r?\n/),this._lineHeight=this._computeLineHeight();const r=this._computeTextWidth(n,e),s=this._lineHeight*this._textLines.length;return i.width=r,i.height=s,[r*e.pixelRatio,s*e.pixelRatio]}_computeTextWidth(t,e){let i=0;for(const e of this._textLines)i=Math.max(i,t.measureText(e).width);const n=e.font;return("italic"===n.style||"oblique"===n.style||"string"==typeof n.weight&&("bold"===n.weight||"bolder"===n.weight)||"number"==typeof n.weight&&n.weight>600)&&(i+=.3*t.measureText("w").width),i+=2*(0,l.Lz)(this._parameters.halo.size),Math.round(i)}_computeLineHeightBase(){return 1.275*this._parameters.size}_computeLineHeight(){let t=this._computeLineHeightBase();const e=this._parameters.font.decoration;return e&&"underline"===e&&(t*=1.3),Math.round(t+2*(0,l.Lz)(this._parameters.halo.size))}_renderDecoration(t,e,i,n,r,s){let o=.9*this._lineHeight;const a="bold"===r?.06:"bolder"===r?.09:.04;switch(t.textAlign){case"center":e-=this._renderedWidth/2;break;case"right":e-=this._renderedWidth}const l=t.textBaseline;if("underline"===n)switch(o=.9*this._computeLineHeightBase(),l){case"top":i+=o;break;case"middle":i+=o/2}else if("line-through"===n)switch(l){case"top":i+=o/1.5;break;case"middle":i+=o/3}const c=s?1.5*s:Math.ceil(o*a);t.save(),t.beginPath(),t.strokeStyle=t.fillStyle,t.lineWidth=c,t.moveTo(e-this._lineThroughWidthOffset,i),t.lineTo(e+this._renderedWidth+2*this._lineThroughWidthOffset,i),t.stroke(),t.restore()}}function M(t,e){const i=Math.max(e.size,.5),n=e.font,r=`${n.style} ${n.weight} ${(0,l.Lz)(i).toFixed(1)}px ${n.family}, sans-serif`;let s;switch(t.font=r,t.textBaseline="top",e.horizontalAlignment){case"left":default:s="left";break;case"right":s="right";break;case"center":s="center"}t.textAlign=s}var P=i(7590),A=i(16043),C=i(39686),I=i(17469),E=i(96700);const R=Math.PI/180;class O{constructor(t){this._t=t}static createIdentity(){return new O([1,0,0,0,1,0])}clone(){const t=this._t;return new O(t.slice())}transform(t){const e=this._t;return[e[0]*t[0]+e[1]*t[1]+e[2],e[3]*t[0]+e[4]*t[1]+e[5]]}static createScale(t,e){return new O([t,0,0,0,e,0])}scale(t,e){const i=this._t;return i[0]*=t,i[1]*=t,i[2]*=t,i[3]*=e,i[4]*=e,i[5]*=e,this}scaleRatio(){return Math.sqrt(this._t[0]*this._t[0]+this._t[1]*this._t[1])}static createTranslate(t,e){return new O([0,0,t,0,0,e])}translate(t,e){const i=this._t;return i[2]+=t,i[5]+=e,this}static createRotate(t){const e=Math.cos(t),i=Math.sin(t);return new O([e,-i,0,i,e,0])}rotate(t){return O.multiply(this,O.createRotate(t),this)}angle(){const t=this._t[0],e=this._t[3],i=Math.sqrt(t*t+e*e);return[t/i,e/i]}static multiply(t,e,i){const n=t._t,r=e._t,s=n[0]*r[0]+n[3]*r[1],o=n[1]*r[0]+n[4]*r[1],a=n[2]*r[0]+n[5]*r[1]+r[2],l=n[0]*r[3]+n[3]*r[4],c=n[1]*r[3]+n[4]*r[4],u=n[2]*r[3]+n[5]*r[4]+r[5],h=i._t;return h[0]=s,h[1]=o,h[2]=a,h[3]=l,h[4]=c,h[5]=u,i}invert(){const t=this._t;let e=t[0]*t[4]-t[1]*t[3];if(0===e)return new O([0,0,0,0,0,0]);e=1/e;const i=(t[1]*t[5]-t[2]*t[4])*e,n=(t[2]*t[3]-t[0]*t[5])*e,r=t[4]*e,s=-t[1]*e,o=-t[3]*e,a=t[0]*e;return new O([r,s,i,o,a,n])}}class F{constructor(t,e){this._resourceManager=t,this._transfos=[],this._sizeTransfos=[],this._geomUnitsPerPoint=1,this._placementPool=new a.A(g.W,void 0,void 0,100),this._earlyReturn=!1,this._mapRotation=0,this._transfos.push(e||O.createIdentity()),this._sizeTransfos.push(e?e.scaleRatio():1)}setTransform(t,e){this._transfos=[t||O.createIdentity()],this._sizeTransfos=[e||(t?t.scaleRatio():1)]}setGeomUnitsPerPoint(t){this._geomUnitsPerPoint=t}transformPt(t){return this._transfos[this._transfos.length-1].transform(t)}transformSize(t){return t*this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformPt(t){return this._transfos[this._transfos.length-1].invert().transform(t)}reverseTransformSize(t){return t/this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformScalar(t){return t/this._transfos[this._transfos.length-1].scaleRatio()}getTransformAngle(){return this._transfos[this._transfos.length-1].angle()}geomUnitsPerPoint(){return this.isEmbedded()?1:this._geomUnitsPerPoint}prevGeomUnitsPerPoint(){return this._transfos.length>2?1:this._geomUnitsPerPoint}isEmbedded(){return this._transfos.length>1}back(){return this._transfos[this._transfos.length-1]}push(t,e){const i=e?t.scaleRatio():1;O.multiply(t,this.back(),t),this._transfos.push(t),this._sizeTransfos.push(this._sizeTransfos[this._sizeTransfos.length-1]*i)}pop(){this._transfos.splice(-1,1),this._sizeTransfos.splice(-1,1)}drawSymbol(t,e,i){if(t)switch(t.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":this.drawMultiLayerSymbol(t,e);break;case"CIMTextSymbol":this.drawTextSymbol(t,e,i)}}drawMultiLayerSymbol(t,e){if(!t||!e)return;const i=t.symbolLayers;if(!i)return;const n=t.effects;if(n&&n.length>0){const t=this.executeEffects(n,e);if(t){let e=t.next();for(;e;)this.drawSymbolLayers(i,e.asJSON()),e=t.next()}}else this.drawSymbolLayers(i,e)}executeEffects(t,e){const i=this._resourceManager.geometryEngine;let n=new p.k(c.z.fromJSONCIM(e));for(const e of t){const t=(0,m.A)(e);t&&(n=t.execute(n,e,this.geomUnitsPerPoint(),null,i))}return n}drawSymbolLayers(t,e){let i=t.length;for(;i--;){const n=t[i];if(!n||!1===n.enable)continue;const r=n.effects;if(r&&r.length>0){const t=this.executeEffects(r,e);if(t){let e=null;for(;(e=t.next())&&(this.drawSymbolLayer(n,e.asJSON()),!this._earlyReturn););}}else this.drawSymbolLayer(n,e);if(this._earlyReturn)return}}drawSymbolLayer(t,e){switch(t.type){case"CIMSolidFill":this.drawSolidFill(e,t.color,t.path);break;case"CIMHatchFill":this.drawHatchFill(e,t);break;case"CIMPictureFill":this.drawPictureFill(e,t);break;case"CIMGradientFill":this.drawGradientFill(e,t);break;case"CIMSolidStroke":this.drawSolidStroke(e,t.color,t.width,t.capStyle,t.joinStyle,t.miterLimit,t.path);break;case"CIMPictureStroke":this.drawPictureStroke(e,t);break;case"CIMGradientStroke":this.drawGradientStroke(e,t);break;case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":this.drawMarkerLayer(t,e)}}drawHatchFill(t,e){const i=function(t,e,i){let n=(0,P.$w)(t.separation,y.D.CIMHatchFill.separation)*i,r=(0,P.$w)(t.rotation);if(0===n)return null;n<0&&(n=-n);let s=0;const o=.5*n;for(;s>o;)s-=n;for(;s<-o;)s+=n;const a=(0,u.vt)();(0,h.Rg)(a,e),a[0]-=o,a[1]-=o,a[2]+=o,a[3]+=o;const l=[[a[0],a[1]],[a[0],a[3]],[a[2],a[3]],[a[2],a[1]]];for(;r>180;)r-=180;for(;r<0;)r+=180;const c=Math.cos(r*R),d=Math.sin(r*R),f=-n*d,p=n*c;let _,m,g,v;s=(0,P.$w)(t.offsetX)*i*d-(0,P.$w)(t.offsetY)*i*c,_=g=Number.MAX_VALUE,m=v=-Number.MAX_VALUE;for(const t of l){const e=t[0],i=t[1],n=c*e+d*i,r=-d*e+c*i;_=Math.min(_,n),g=Math.min(g,r),m=Math.max(m,n),v=Math.max(v,r)}g=Math.floor(g/n)*n;let x=c*_-d*g-f*s/n,b=d*_+c*g-p*s/n,S=c*m-d*g-f*s/n,w=d*m+c*g-p*s/n;const T=1+Math.round((v-g)/n),M=[];for(let t=0;t<T;t++)x+=f,b+=p,S+=f,w+=p,M.push([[x,b],[S,w]]);return{paths:M}}(e,t,this.geomUnitsPerPoint());i&&(this.pushClipPath(t),this.drawMultiLayerSymbol(e.lineSymbol,i),this.popClipPath())}drawPictureFill(t,e){}drawGradientFill(t,e){}drawPictureStroke(t,e){}drawGradientStroke(t,e){}drawMarkerLayer(t,e){const i=t.markerPlacement;if(i){const n=(0,m.c)(i);if(n){const r="CIMMarkerPlacementInsidePolygon"===i.type||"CIMMarkerPlacementPolygonCenter"===i.type&&i.clipAtBoundary;r&&this.pushClipPath(e);const s=n.execute(c.z.fromJSONCIM(e),i,this.geomUnitsPerPoint(),null,this._resourceManager.geometryEngine);if(s){let e=null;for(;(e=s.next())&&(this.drawMarker(t,e),!this._earlyReturn););}r&&this.popClipPath()}}else{const i=this._placementPool.acquire();if((0,f.fT)(e))i.tx=e.x,i.ty=e.y,this.drawMarker(t,i);else if((0,f.Bi)(e)){const n=(0,d.l8)(e);n&&([i.tx,i.ty]=n,this.drawMarker(t,i))}else for(const n of e.points)if(i.tx=n[0],i.ty=n[1],this.drawMarker(t,i),this._earlyReturn)break;this._placementPool.release(i)}}drawMarker(t,e){switch(t.type){case"CIMCharacterMarker":case"CIMPictureMarker":this.drawPictureMarker(t,e);break;case"CIMVectorMarker":this.drawVectorMarker(t,e)}}drawPictureMarker(t,e){if(!t)return;const i=this._resourceManager.getResource(t.url),n=(0,P.$w)(t.size,y.D.CIMPictureMarker.size);if(null==i||n<=0)return;const r=i.width,s=i.height;if(!r||!s)return;const o=r/s,a=(0,P.$w)(t.scaleX,1),l=O.createIdentity(),c=t.anchorPoint;if(c){let e=c.x,i=c.y;"Absolute"!==t.anchorPointUnits&&(e*=n*o*a,i*=n),l.translate(-e,-i)}let u=(0,P.$w)(t.rotation);t.rotateClockwise&&(u=-u),this._mapRotation&&(u+=this._mapRotation),u&&l.rotate(u*R);let h=(0,P.$w)(t.offsetX),d=(0,P.$w)(t.offsetY);if(h||d){if(this._mapRotation){const t=R*this._mapRotation,e=Math.cos(t),i=Math.sin(t),n=h*i+d*e;h=h*e-d*i,d=n}l.translate(h,d)}const f=this.geomUnitsPerPoint();1!==f&&l.scale(f,f);const p=e.getAngle();p&&l.rotate(p),l.translate(e.tx,e.ty),this.push(l,!1),this.drawImage(t,n),this.pop()}drawVectorMarker(t,e){if(!t)return;const i=t.markerGraphics;if(!i)return;const n=(0,P.$w)(t.size,y.D.CIMVectorMarker.size),r=t.frame,s=r?r.ymax-r.ymin:0,a=n&&s?n/s:1,l=O.createIdentity();r&&l.translate(.5*-(r.xmax+r.xmin),.5*-(r.ymax+r.ymin));const c=t.anchorPoint;if(c){let e=c.x,i=c.y;"Absolute"!==t.anchorPointUnits?r&&(e*=r.xmax-r.xmin,i*=r.ymax-r.ymin):(e/=a,i/=a),l.translate(-e,-i)}1!==a&&l.scale(a,a);let u=(0,P.$w)(t.rotation);t.rotateClockwise&&(u=-u),this._mapRotation&&(u+=this._mapRotation),u&&l.rotate(u*R);let h=(0,P.$w)(t.offsetX),d=(0,P.$w)(t.offsetY);if(h||d){if(this._mapRotation){const t=R*this._mapRotation,e=Math.cos(t),i=Math.sin(t),n=h*i+d*e;h=h*e-d*i,d=n}l.translate(h,d)}const f=this.geomUnitsPerPoint();1!==f&&l.scale(f,f);const p=e.getAngle();p&&l.rotate(p),l.translate(e.tx,e.ty),this.push(l,t.scaleSymbolsProportionally);for(const t of i){t?.symbol&&t.geometry||o.A.getLogger("esri.symbols.cim.CIMSymbolDrawHelper").error("Invalid marker graphic",t);let e=t.textString;if("number"==typeof e&&(e=e.toString()),this.drawSymbol(t.symbol,t.geometry,e),this._earlyReturn)break}this.pop()}drawTextSymbol(t,e,i){if(!t)return;if(!(0,f.fT)(e))return;if((0,P.$w)(t.height,y.D.CIMTextSymbol.height)<=0)return;const n=O.createIdentity();let r=(0,P.$w)(t.angle);r=-r,r&&n.rotate(r*R);const s=(0,P.$w)(t.offsetX),o=(0,P.$w)(t.offsetY);(s||o)&&n.translate(s,o);const a=this.geomUnitsPerPoint();1!==a&&n.scale(a,a),n.translate(e.x,e.y),this.push(n,!1),this.drawText(t,i),this.pop()}}class z extends F{constructor(t,e){super(t,e),this.reset()}reset(){this._xmin=this._ymin=1/0,this._xmax=this._ymax=-1/0,this._clipCount=0}envelope(){return new b.A(this._xmin,this._ymin,this._xmax-this._xmin,this._ymax-this._ymin)}bounds(){return(0,u.fA)(this._xmin,this._ymin,this._xmax,this._ymax)}drawSolidFill(t){if(t&&!(this._clipCount>0))if((0,f.Bi)(t))this._processPath(t.rings,0);else if((0,f.Rg)(t))this._processPath(t.paths,0);else if((0,f.ZC)(t)){const e=B(t);e&&this._processPath(e.rings,0)}else console.error("drawSolidFill Unexpected geometry type!")}drawSolidStroke(t,e,i){if(!t||this._clipCount>0||null==i||i<=0)return;const n=Math.max(.5*this.transformSize((0,P.$w)(i,y.D.CIMSolidStroke.width)),.25);if((0,f.Bi)(t))this._processPath(t.rings,n);else if((0,f.Rg)(t))this._processPath(t.paths,n);else if((0,f.ZC)(t)){const e=B(t);e&&this._processPath(e.rings,n)}else console.error("drawSolidStroke unexpected geometry type!")}drawMarkerLayer(t,e){(0,f.Bi)(e)&&t.markerPlacement&&("CIMMarkerPlacementInsidePolygon"===t.markerPlacement.type||"CIMMarkerPlacementPolygonCenter"===t.markerPlacement.type&&t.markerPlacement.clipAtBoundary)?this._processPath(e.rings,0):super.drawMarkerLayer(t,e)}drawHatchFill(t,e){this.drawSolidFill(t)}drawPictureFill(t,e){this.drawSolidFill(t)}drawGradientFill(t,e){this.drawSolidFill(t)}drawPictureStroke(t,e){this.drawSolidStroke(t,null,e.width)}drawGradientStroke(t,e){this.drawSolidStroke(t,null,e.width)}pushClipPath(t){this.drawSolidFill(t),this._clipCount++}popClipPath(){this._clipCount--}drawImage(t,e){const{url:i}=t,n=(0,P.$w)(t.scaleX,1);let r=n*e,s=e;const o=this._resourceManager.getResource(i);if(null!=o){const t=o.height/o.width;r=n*(e?t>1?e:e/t:o.width),s=e?t>1?e*t:e:o.height}this._merge(this.transformPt([-r/2,-s/2]),0),this._merge(this.transformPt([-r/2,s/2]),0),this._merge(this.transformPt([r/2,-s/2]),0),this._merge(this.transformPt([r/2,s/2]),0)}drawText(t,e){if(!e||0===e.length)return;this._textRasterizer||(this._textRasterizer=new T);const i=U(t);let[n,r]=this._textRasterizer.computeTextSize(e,i);n=(0,l.PN)(n),r=(0,l.PN)(r);const s=this.transformSize(1)*this.reverseTransformScalar(1);n*=s,r*=s;let o=0;switch(t.horizontalAlignment){case"Left":o=n/2;break;case"Right":o=-n/2}let a=0;switch(t.verticalAlignment){case"Bottom":a=r/2;break;case"Top":a=-r/2;break;case"Baseline":a=r/6}this._merge(this.transformPt([-n/2+o,-r/2+a]),0),this._merge(this.transformPt([-n/2+o,r/2+a]),0),this._merge(this.transformPt([n/2+o,-r/2+a]),0),this._merge(this.transformPt([n/2+o,r/2+a]),0)}_processPath(t,e){if(t)for(const i of t){const t=i?i.length:0;if(t>1){this._merge(this.transformPt(i[0]),e);for(let n=1;n<t;n++)this._merge(this.transformPt(i[n]),e)}}}_merge(t,e){t[0]-e<this._xmin&&(this._xmin=t[0]-e),t[0]+e>this._xmax&&(this._xmax=t[0]+e),t[1]-e<this._ymin&&(this._ymin=t[1]-e),t[1]+e>this._ymax&&(this._ymax=t[1]+e)}}class D extends F{constructor(){super(...arguments),this._searchPoint=[0,0],this._searchDistPoint=0,this._textInfo=null,this._svg=null,this._path=null,this._canvas=null}destroy(){this._svg=(0,A.pK)(this._svg),this._path=null,this._canvas=null}hitTest(t,e,i,n,s,o){const a=o*(0,l.Lz)(1);this.setTransform(),this.setGeomUnitsPerPoint(a),this._searchPoint=[(t[0]+t[2])/2,(t[1]+t[3])/2],this._searchDistPoint=(t[2]-t[0])/2/a,this._textInfo=n;const c=e&&("CIMPointSymbol"===e.type&&"Map"!==e.angleAlignment||"CIMTextSymbol"===e.type);if(this._mapRotation=c?s:0,!(0,r.A)("esri-mobile")){const t=(0,l.PN)(C._M*window.devicePixelRatio),i=(0,l.PN)(C.ie);("CIMLineSymbol"!==e?.type&&"CIMPolygonSymbol"!==e?.type||!e.symbolLayers?.some(P.jn))&&"CIMMeshSymbol"!==e?.type&&((0,P.YC)(e)??0)<i&&(this._searchDistPoint=t)}return this._earlyReturn=!1,this.drawSymbol(e,i),this._earlyReturn}executeEffects(t,e){return"CIMGeometricEffectDashes"===t.at(-1)?.type&&(t=t.slice(0,-1)),super.executeEffects(t,e)}drawSolidFill(t,e,i){null!=i?this._hittestSvgPath(t,i,!0):this._hitTestFill(t)}drawHatchFill(t,e){this._hitTestFill(t)}drawPictureFill(t,e){this._hitTestFill(t)}drawGradientFill(t,e){this._hitTestFill(t)}drawSolidStroke(t,e,i,n,r,s,o){null!=o?this._hittestSvgPath(t,o,!1,i):this._hitTestStroke(t,i)}drawPictureStroke(t,e){this._hitTestStroke(t,e.width)}drawGradientStroke(t,e){this._hitTestStroke(t,e.width)}drawMarkerLayer(t,e){t.markerPlacement&&("CIMMarkerPlacementInsidePolygon"===t.markerPlacement.type||"CIMMarkerPlacementPolygonCenter"===t.markerPlacement.type&&t.markerPlacement.clipAtBoundary)?this._hitTestFill(e):super.drawMarkerLayer(t,e)}pushClipPath(t){}popClipPath(){}drawImage(t,e){const{url:i}=t,n=(0,P.$w)(t.scaleX,1),r=this._resourceManager.getResource(i);if(null==r||0===r.height||0===e)return;const s=e*this.geomUnitsPerPoint(),o=s*n*(r.width/r.height),a=this.reverseTransformPt(this._searchPoint),l=this._searchDistPoint;Math.abs(a[0])<o/2+l&&Math.abs(a[1])<s/2+l&&(this._earlyReturn=!0)}drawText(t,e){const i=this._textInfo;if(!i)return;const n=i.get(t);if(!n)return;if(!n.glyphMosaicItems.glyphs.length)return;const r=(0,E.hV)((0,P.$w)(t.height,y.D.CIMTextSymbol.height)),{lineGapType:s,lineGap:o}=t,a=s?V(s,(0,P.$w)(o),r):0,l="CIMBackgroundCallout"===t.callout?.type,c=(0,I.Tl)(n.glyphMosaicItems,{scale:r/C.eG,angle:0,xOffset:0,yOffset:0,horizontalAlignment:t.horizontalAlignment,verticalAlignment:t.verticalAlignment,maxLineWidth:(0,E.Lu)(t.lineWidth),lineHeight:C.DY*Math.max(.25,Math.min(a||1,4)),decoration:t.font.decoration||"none",useCIMAngleBehavior:!0,hasBackground:l}),u=this.reverseTransformPt(this._searchPoint),h=u[0],d=u[1];for(const t of c.glyphs)if(h>t.xTopLeft&&h<t.xBottomRight&&d>-t.yBottomRight&&d<-t.yTopLeft){this._earlyReturn=!0;break}}_hitTestFill(t){let e=null;if((0,f.ZC)(t)){const i=t;e=[[[i.xmin,i.ymin],[i.xmin,i.ymax],[i.xmax,i.ymax],[i.xmax,i.ymin],[i.xmin,i.ymin]]]}else if((0,f.Bi)(t))e=t.rings;else{if(!(0,f.Rg)(t))return;e=t.paths}const i=this.reverseTransformPt(this._searchPoint);(function(t,e){let i=0;for(const n of e){const e=n.length;for(let r=1;r<e;r++){const e=n[r-1],s=n[r];e[1]>t[1]!=s[1]>t[1]&&((s[0]-e[0])*(t[1]-e[1])-(s[1]-e[1])*(t[0]-e[0])>0?i++:i--)}}return 0!==i})(i,e)&&(this._earlyReturn=!0),this._earlyReturn||k(i,e,this.reverseTransformScalar(this._searchDistPoint)*this.prevGeomUnitsPerPoint())&&(this._earlyReturn=!0)}_getSvgPath(){return null!=this._svg&&null!=this._path||(this._svg??=(0,A.p)(),this._path??=(0,A.FJ)("path"),this._svg.appendChild(this._path)),this._path}_getCanvas(){return this._canvas??=document.createElement("canvas"),this._canvas}_hittestSvgPath(t,e,i,n){const r=(0,u.vt)();(0,h.Rg)(r,t);const s=r[0],o=r[1],a=r[2]-r[0],l=r[3]-r[1],c=this._getSvgPath();c.setAttribute("d",e);const d=c.getBBox(),f=d.width/a,p=d.height/l,_=this._getCanvas();_.width=d.width,_.height=d.height;const m=_.getContext("2d",{willReadFrequently:!0});m.setTransform(1,0,0,1,d.x,-d.y);const g=new Path2D(e);i?m.fill(g):(m.lineWidth=n*f,m.stroke(g));const y=this.reverseTransformScalar(this._searchDistPoint)*this.prevGeomUnitsPerPoint(),v=this.reverseTransformPt(this._searchPoint),x=(v[0]-s-y)*f,b=(l-(v[1]-o)-y)*p,S=2*y*f,w=2*y*p,T=m.getImageData(x,b,S,w).data;for(let t=3;t<T.length;t+=4)if(T[t]>127.5)return void(this._earlyReturn=!0)}_hitTestStroke(t,e){let i=null;if((0,f.ZC)(t)){const e=t;i=[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]}else if((0,f.Bi)(t))i=t.rings;else{if(!(0,f.Rg)(t))return;i=t.paths}k(this.reverseTransformPt(this._searchPoint),i,(0,P.$w)(e,y.D.CIMSolidStroke.width)*this.geomUnitsPerPoint()/2+this.reverseTransformScalar(this._searchDistPoint)*this.prevGeomUnitsPerPoint())&&(this._earlyReturn=!0)}}class L extends F{constructor(t,e,i,n){super(e,i),this._applyAdditionalRenderProps=n,this._colorSubstitutionHelper=new _,this._ctx=t}drawSolidFill(t,e){if(!t)return;if((0,f.Bi)(t))this._buildPath(t.rings,!0);else if((0,f.Rg)(t))this._buildPath(t.paths,!0);else if((0,f.ZC)(t))this._buildPath(B(t).rings,!0);else{if(!(0,f.U9)(t))return;console.log("CanvasDrawHelper.drawSolidFill - No implementation!")}const i=this._ctx;i.fillStyle="string"==typeof e?e:"rgba("+Math.round(e[0])+","+Math.round(e[1])+","+Math.round(e[2])+","+(e[3]??255)/255+")",i.fill("evenodd")}drawSolidStroke(t,e,i,n,r,s){if(!t||!e||0===i)return;if((0,f.Bi)(t))this._buildPath(t.rings,!0);else if((0,f.Rg)(t))this._buildPath(t.paths,!1);else{if(!(0,f.ZC)(t))return void console.log("CanvasDrawHelper.drawSolidStroke isn't implemented!");this._buildPath(B(t).rings,!0)}const o=this._ctx;o.strokeStyle="string"==typeof e?e:"rgba("+Math.round(e[0])+","+Math.round(e[1])+","+Math.round(e[2])+","+(e[3]??255)/255+")",o.lineWidth=Math.max(this.transformSize(i),.5),this._setCapStyle(n),this._setJoinStyle(r),o.miterLimit=s,o.stroke()}pushClipPath(t){if(this._ctx.save(),(0,f.Bi)(t))this._buildPath(t.rings,!0);else if((0,f.Rg)(t))this._buildPath(t.paths,!0);else{if(!(0,f.ZC)(t))return;this._buildPath(B(t).rings,!0)}this._ctx.clip("evenodd")}popClipPath(){this._ctx.restore()}drawImage(t,e){const{colorSubstitutions:i,url:n,tintColor:r}=t,s=(0,P.$w)(t.scaleX,1),o=this._resourceManager.getResource(n);if(null==o)return;let a=e*(o.width/o.height),l=e;e||(a=o.width,l=o.height);const c=(0,P.UE)(n)||"src"in o&&(0,P.UE)(o.src);let u="getFrame"in o?x(o):o;i&&(u=this._colorSubstitutionHelper.applyColorSubstitution(u,i)),this._applyAdditionalRenderProps&&!c&&r&&(u=this._colorSubstitutionHelper.tintImageData(u,r));const h=this.transformPt([0,0]),[d,f]=this.getTransformAngle(),p=this.transformSize(1),_=this._ctx;_.save(),_.setTransform({m11:s*p*d,m12:s*p*f,m21:-p*f,m22:p*d,m41:h[0],m42:h[1]}),_.drawImage(u,-a/2,-l/2,a,l),_.restore()}drawText(t,e){if(!e||0===e.length)return;this._textRasterizer||(this._textRasterizer=new T);const i=U(t,this.transformSize((0,l.PN)(1))),n=this._textRasterizer.rasterizeText(e,i);if(!n)return;const{size:r,anchorX:s,anchorY:o,canvas:a}=n,c=r[0]*(s+.5),u=r[1]*(o-.5),h=this._ctx,d=this.transformPt([0,0]),[f,p]=this.getTransformAngle();h.save(),h.setTransform({m11:1*f,m12:1*p,m21:-1*p,m22:1*f,m41:d[0]-1*c,m42:d[1]+1*u}),h.drawImage(a,0,0),h.restore()}drawPictureFill(t,e){if(!t)return;let{colorSubstitutions:i,height:n,offsetX:r,offsetY:s,rotation:o,scaleX:a,tintColor:l,url:c}=e;const u=this._resourceManager.getResource(c);if(null==u)return;if((0,f.Bi)(t))this._buildPath(t.rings,!0);else if((0,f.Rg)(t))this._buildPath(t.paths,!0);else if((0,f.ZC)(t))this._buildPath(B(t).rings,!0);else{if(!(0,f.U9)(t))return;console.log("CanvasDrawHelper.drawPictureFill - No implementation!")}const h=this._ctx,d=(0,P.UE)(c)||"src"in u&&(0,P.UE)(u.src);let p,_="getFrame"in u?x(u):u;if(i&&(_=this._colorSubstitutionHelper.applyColorSubstitution(_,i)),this._applyAdditionalRenderProps){d||l&&(_=this._colorSubstitutionHelper.tintImageData(_,l)),p=h.createPattern(_,"repeat");const t=this.transformSize(1);o||(o=0),r?r*=t:r=0,s?s*=t:s=0,n&&(n*=t);const e=n?n/u.height:1,i=a&&n?a*n/u.width:1;if(0!==o||1!==e||1!==i||0!==r||0!==s){const t=new DOMMatrix;t.rotateSelf(0,0,-o).translateSelf(r,s).scaleSelf(i,e,1),p.setTransform(t)}}else p=h.createPattern(_,"repeat");h.save(),h.fillStyle=p,h.fill("evenodd"),h.restore()}drawPictureStroke(t,e){if(!t)return;let{colorSubstitutions:i,capStyle:n,joinStyle:r,miterLimit:o,tintColor:a,url:c,width:u}=e;const h=this._resourceManager.getResource(c);if(null==h)return;let d;if((0,f.Bi)(t))d=t.rings;else if((0,f.Rg)(t))d=t.paths;else{if(!(0,f.ZC)(t))return(0,f.U9)(t)?void console.log("CanvasDrawHelper.drawPictureStroke - No implementation!"):void 0;d=B(t).rings}u||(u=h.width);const p=(0,P.UE)(c)||"src"in h&&(0,P.UE)(h.src);let _="getFrame"in h?x(h):h;i&&(_=this._colorSubstitutionHelper.applyColorSubstitution(_,i)),this._applyAdditionalRenderProps&&(p||a&&(_=this._colorSubstitutionHelper.tintImageData(_,a)));const m=Math.max(this.transformSize((0,l.Lz)(u)),.5),g=m/_.width,y=this._ctx,v=y.createPattern(_,"repeat-y");let b,S;y.save(),this._setCapStyle(n),this._setJoinStyle(r),void 0!==o&&(y.miterLimit=o),y.lineWidth=m;for(let t of d)if(t=(0,s.o8)(t),Y(t),t&&!(t.length<=1)){b=this.transformPt(t[0]);for(let e=1;e<t.length;e++){S=this.transformPt(t[e]);const i=N(b,S),n=new DOMMatrix;n.translateSelf(0,b[1]-m/2).scaleSelf(g,g,1).rotateSelf(0,0,90-i),v.setTransform(n),y.strokeStyle=v,y.beginPath(),y.moveTo(b[0],b[1]),y.lineTo(S[0],S[1]),y.stroke(),b=S}}y.restore()}_buildPath(t,e){const i=this._ctx;if(i.beginPath(),t)for(const n of t){const t=n?n.length:0;if(t>1){let r=this.transformPt(n[0]);i.moveTo(r[0],r[1]);for(let e=1;e<t;e++)r=this.transformPt(n[e]),i.lineTo(r[0],r[1]);e&&i.closePath()}}}_setCapStyle(t){switch(t){case v.uT.Butt:this._ctx.lineCap="butt";break;case v.uT.Round:this._ctx.lineCap="round";break;case v.uT.Square:this._ctx.lineCap="square"}}_setJoinStyle(t){switch(t){case v.wd.Bevel:this._ctx.lineJoin="bevel";break;case v.wd.Round:this._ctx.lineJoin="round";break;case v.wd.Miter:this._ctx.lineJoin="miter"}}}function k(t,e,i){for(const n of e){const e=n.length;for(let r=1;r<e;r++){const e=n[r-1],s=n[r];let o=(s[0]-e[0])*(s[0]-e[0])+(s[1]-e[1])*(s[1]-e[1]);if(0===o)continue;o=Math.sqrt(o);const a=((s[0]-e[0])*(t[1]-e[1])-(s[1]-e[1])*(t[0]-e[0]))/o;if(Math.abs(a)<i){const n=((s[0]-e[0])*(t[0]-e[0])+(s[1]-e[1])*(t[1]-e[1]))/o;if(n>-i&&n<o+i)return!0}}}return!1}function N(t,e){const i=e[0]-t[0],n=e[1]-t[1];return 180/Math.PI*Math.atan2(n,i)}const B=t=>t?{spatialReference:t.spatialReference,rings:[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]}:null,V=(t,e,i)=>{switch(t){case"ExtraLeading":return 1+e/i;case"Multiple":return e;case"Exact":return e/i}};function U(t,e=1){const i=(0,P.DW)(t),r=(0,P._d)(t.fontStyleName),s=t.fontFamilyName??n.Vb,{weight:o,style:a}=r,l=e*(t.height||5),c=(0,P.Bu)(t.horizontalAlignment),u=(0,P.Nl)(t.verticalAlignment),h=(0,P.pM)(t),d=(0,P.pM)(t.haloSymbol),f=null!=d?e*(t.haloSize??0):0,p=(0,P._1)(t.symbol),_=e*((0,P.xo)(t.symbol)||0),m="CIMBackgroundCallout"===t.callout?.type?t.callout.backgroundSymbol:null,g=(0,P.pM)(m),y=(0,P.xo)(m),v=(0,P._1)(m);return{color:h,size:l,horizontalAlignment:c,verticalAlignment:u,font:{family:s,style:(0,P.pV)(a),weight:(0,P.Kn)(o),decoration:i},outline:{size:_||0,color:p},halo:{size:f||0,color:d,style:a},backgroundColor:g,borderLine:null!=y&&null!=v?{size:y,color:v}:null,pixelRatio:1,premultiplyColors:!0}}const G=1e-4;function Y(t){let e,i,n,r,s,o=t[0],a=1;for(;a<t.length;)e=t[a][0]-o[0],i=t[a][1]-o[1],r=0!==e?i/e:Math.PI/2,void 0!==n&&r-n<=G?(t.splice(a-1,1),o=s):(s=o,o=t[a],a++),n=r}},57176:function(t,e,i){i.d(e,{BW:function(){return Y},Sc:function(){return O},Vb:function(){return A},ll:function(){return R},wp:function(){return F}});var n=i(90152),r=i(58941),s=i(21609),o=i(40633),a=i(13798),l=i(13520),c=i(87416),u=i(35068),h=i(90046),d=i(29076),f=i(14817),p=i(38821),_=i(33389),m=i(7590),g=i(74661),y=i(7056),v=i(39686),x=i(17469),b=i(96700);const S=Math.PI,w=S/2,T=Math.PI/180,M=96/72,P=()=>o.A.getLogger("esri.symbols.cim.CIMSymbolHelper");function A(t){let e;switch(t.type){case"cim":return t.data;case"web-style":return t;case"simple-marker":{const i=F.fromSimpleMarker(t);if(!i)throw new Error("InternalError: Cannot convert symbol to CIM");e=i;break}case"picture-marker":e=F.fromPictureMarker(t);break;case"simple-line":e=F.fromSimpleLineSymbol(t);break;case"simple-fill":e=F.fromSimpleFillSymbol(t);break;case"picture-fill":e=F.fromPictureFillSymbol(t);break;case"text":e=F.fromTextSymbol(t)}return{type:"CIMSymbolReference",symbol:e}}function C(t,e,i){switch(e.type){case"CIMSymbolReference":return C(t,e.symbol,i);case"CIMPointSymbol":null==i&&(i={x:0,y:0}),t.drawSymbol(e,i);break;case"CIMLineSymbol":null==i&&(i={paths:[[[0,0],[10,0]]]}),t.drawSymbol(e,i);break;case"CIMPolygonSymbol":null==i&&(i={rings:[[[0,0],[0,10],[10,10],[10,0],[0,0]]]}),t.drawSymbol(e,i);break;case"CIMTextSymbol":{const i={x:0,y:0};t.drawSymbol(e,i);break}case"CIMVectorMarker":{const i=new d.W;t.drawMarker(e,i);break}}return t.envelope()}function I(t){if(!t)return 0;switch(t.type){case"CIMMarkerPlacementAlongLineSameSize":case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAtExtremities":case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementAtRatioPositions":case"CIMMarkerPlacementOnLine":case"CIMMarkerPlacementOnVertices":return Math.abs(t.offset);default:return 0}}function E(t){if(!t)return 0;switch(t.type){case"CIMGeometricEffectArrow":return Math.abs(.5*t.width);case"CIMGeometricEffectBuffer":return Math.abs(t.size);case"CIMGeometricEffectControlMeasureLine":return 500;case"CIMGeometricEffectExtension":case"CIMGeometricEffectRadial":return Math.abs(t.length);case"CIMGeometricEffectJog":return Math.abs(.5*t.length);case"CIMGeometricEffectMove":return Math.max(Math.abs((0,m.$w)(t.offsetX)),Math.abs((0,m.$w)(t.offsetY)));case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":return Math.abs(t.offset);case"CIMGeometricEffectRegularPolygon":return Math.abs(t.radius);case"CIMGeometricEffectRotate":case"CIMGeometricEffectScale":default:return 0;case"CIMGeometricEffectTaperedPolygon":return.5*Math.max(Math.abs(t.fromWidth),Math.abs(t.toWidth));case"CIMGeometricEffectWave":return Math.abs(t.amplitude);case"CIMGeometricEffectDonut":return Math.abs(t.width)}}function R(t){if(!t)return 0;let e=0;for(const i of t)e+=E(i);return e}class O{static getSymbolInflateSize(t,e,i,n,r){return t||(t=[0,0,0,0]),e?this._getInflateSize(t,e,i,n,r):t}static safeSize(t){const e=Math.max(Math.abs(t[0]),Math.abs(t[2])),i=Math.max(Math.abs(t[1]),Math.abs(t[3]));return Math.sqrt(e*e+i*i)}static _vectorMarkerBounds(t,e,i,n){let r=!0;const s=(0,c.vt)();if(e?.markerGraphics)for(const o of e.markerGraphics){const e=[0,0,0,0];o.geometry&&((0,u.Rg)(s,o.geometry),e[0]=0,e[1]=0,e[2]=0,e[3]=0,this.getSymbolInflateSize(e,o.symbol,i,0,n),s[0]+=e[0],s[1]+=e[1],s[2]+=e[2],s[3]+=e[3],r?(t[0]=s[0],t[1]=s[1],t[2]=s[2],t[3]=s[3],r=!1):(t[0]=Math.min(t[0],s[0]),t[1]=Math.min(t[1],s[1]),t[2]=Math.max(t[2],s[2]),t[3]=Math.max(t[3],s[3])))}return t}static _getInflateSize(t,e,i,n,r){if(function(t){return void 0!==t.symbolLayers}(e)){const s=this._getLayersInflateSize(t,e.symbolLayers,i,n,r),o=R(e.effects);return o>0&&(s[0]-=o,s[1]-=o,s[2]+=o,s[3]+=o),s}return this._getTextInflatedSize(t,e,r)}static _getLayersInflateSize(t,e,i,n,r){let s=!0;if(!e)return t;for(const o of e){if(!o)continue;let e=[0,0,0,0];switch(o.type){case"CIMSolidFill":case"CIMPictureFill":case"CIMHatchFill":case"CIMGradientFill":break;case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":{const t=o;let i=t.width;null!=i&&(t.capStyle===_.uT.Square||t.joinStyle===_.wd.Miter?i/=1.4142135623730951:i/=2,e[0]=-i,e[1]=-i,e[2]=i,e[3]=i);break}case"CIMCharacterMarker":case"CIMVectorMarker":case"CIMPictureMarker":{const t=o;if("CIMVectorMarker"===o.type){const t=o;if(e=this._vectorMarkerBounds(e,t,i,r),t.frame){const i=(t.frame.xmin+t.frame.xmax)/2,n=(t.frame.ymin+t.frame.ymax)/2;if(e[0]-=i,e[1]-=n,e[2]-=i,e[3]-=n,null!=t.size){const i=t.size/(t.frame.ymax-t.frame.ymin);e[0]*=i,e[1]*=i,e[2]*=i,e[3]*=i}}}else if("CIMPictureMarker"===o.type){const n=o,r=i.getResource(n.url);let s=1;if(null!=r&&r.height&&(s=r.width/r.height),null!=t.size){const i=t.size/2,r=t.size*s*n.scaleX/2;e=[-r,-i,r,i]}}else if(null!=t.size){const i=t.size/2;e=[-i,-i,i,i]}if(t.anchorPoint){let i,n;"Absolute"===t.anchorPointUnits?(i=t.anchorPoint.x,n=t.anchorPoint.y):(i=t.anchorPoint.x*(e[2]-e[0]),n=t.anchorPoint.y*(e[3]-e[1]));const r=1.25*Math.sqrt(i*i+n*n);e[0]-=r,e[1]-=r,e[2]+=r,e[3]+=r}let s=(0,m.$w)(t.rotation);if(t.rotateClockwise&&(s=-s),n&&(s-=n),s){const t=T*s,i=Math.cos(t),n=Math.sin(t),r=(0,c.vt)([y.MG,y.MG,-y.MG,-y.MG]);(0,c.tK)(r,[e[0]*i-e[1]*n,e[0]*n+e[1]*i]),(0,c.tK)(r,[e[0]*i-e[3]*n,e[0]*n+e[3]*i]),(0,c.tK)(r,[e[2]*i-e[1]*n,e[2]*n+e[1]*i]),(0,c.tK)(r,[e[2]*i-e[3]*n,e[2]*n+e[3]*i]),e=r}let a=(0,m.$w)(t.offsetX),l=(0,m.$w)(t.offsetY);if(n){const t=T*n,e=Math.cos(t),i=Math.sin(t),r=a*i+l*e;a=a*e-l*i,l=r}e[0]+=a,e[1]+=l,e[2]+=a,e[3]+=l;const u=I(t.markerPlacement);u>0&&(e[0]-=u,e[1]-=u,e[2]+=u,e[3]+=u);break}}const a=R(o.effects);a>0&&(e[0]-=a,e[1]-=a,e[2]+=a,e[3]+=a),s?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],s=!1):(t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[2]),t[3]=Math.max(t[3],e[3]))}return t}static _getTextInflatedSize(t,e,i){const n=(0,b.hV)(e.height??p.D.CIMTextSymbol.height);if(t[0]=-n/2,t[1]=-n/2,t[2]=n/2,t[3]=n/2,!i)return t;const r=i.get(e);if(!r)return t;if(!r.glyphMosaicItems.glyphs.length)return t;const{lineGapType:s,lineGap:o}=e,a=s?(0,f.QF)(s,o??0,n):0,l="CIMBackgroundCallout"===e.callout?.type,c=(0,x.Tl)(r.glyphMosaicItems,{scale:n/v.eG,angle:(0,m.$w)(e.angle),xOffset:(0,m.$w)(e.offsetX),yOffset:(0,m.$w)(e.offsetY),horizontalAlignment:e.horizontalAlignment,verticalAlignment:e.verticalAlignment,maxLineWidth:(0,b.Lu)(e.lineWidth),lineHeight:v.DY*Math.max(.25,Math.min(a||1,4)),decoration:e.font.decoration||"none",useCIMAngleBehavior:!0,hasBackground:l}).boundsT,u=Math.sqrt(c.width*c.width+c.height*c.height);return t[0]-=c.x+u,t[1]-=c.y-u,t[2]+=c.x+u,t[3]+=-c.y+u,t}}class F{static getEnvelope(t,e,i){if(!t)return null;const n=new f.mx(i);if(Array.isArray(t)){let i;for(const r of t)i?i.union(C(n,r,e)):i=C(n,r,e);return i}return C(n,t,e)}static getTextureAnchor(t,e){const i=this.getEnvelope(t,null,e);if(!i)return[0,0,0];const n=(i.x+.5*i.width)*M,r=(i.y+.5*i.height)*M,s=i.width*M+2,o=i.height*M+2;return[-n/s,-r/o,o]}static rasterize(t,e,i,n,r=!0,s){const o=i||this.getEnvelope(e,null,n);if(!o)return[null,0,0,0,0];const a=Math.max(o.width,o.height)*M;let l=null!=s?Math.max(s/a,1):1;l*=M;const c=(o.x+.5*o.width)*l,u=(o.y+.5*o.height)*l;t.width=o.width*l,t.height=o.height*l,i||(t.width+=2,t.height+=2);const h=t.getContext("2d",{willReadFrequently:!0}),p=f.IT.createScale(l,-l);p.translate(.5*t.width-c,.5*t.height+u);const _=new f.Rj(h,n,p);switch(e.type){case"CIMPointSymbol":{const t={type:"point",x:0,y:0};_.drawSymbol(e,t);break}case"CIMVectorMarker":{const t=new d.W;_.drawMarker(e,t);break}}const m=h.getImageData(0,0,t.width,t.height),g=new Uint8Array(m.data);if(r){let t;for(let e=0;e<g.length;e+=4)t=g[e+3]/255,g[e]=g[e]*t,g[e+1]=g[e+1]*t,g[e+2]=g[e+2]*t}return[g,t.width,t.height,-c/t.width,-u/t.height]}static fromTextSymbol(t){const{text:e}=t;return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPointUnits:"Relative",dominantSizeAxis3D:"Y",size:10,billboardMode3D:"FaceNearPlane",frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{x:0,y:0},symbol:F.createCIMTextSymbolfromTextSymbol(t),textString:e}],scaleSymbolsProportionally:!0,respectFrame:!0}],scaleX:1,angleAlignment:"Display"}}static fromPictureFillSymbol(t){const{height:e,outline:i,width:n,xoffset:r,xscale:s,yoffset:o,yscale:a}=t,l=[],c={type:"CIMPolygonSymbol",symbolLayers:l};if(i){const t=Z(i);t&&l.push(t)}let u=t.url;"esriPFS"===t.type&&t.imageData&&(u=t.imageData);const h="angle"in t?t.angle??0:0,d=(n??0)*(s||1),f=(e??0)*(a||1);return l.push({type:"CIMPictureFill",invertBackfaceTexture:!1,scaleX:1,textureFilter:_.O$.Picture,tintColor:null,url:u,height:f,width:d,offsetX:(0,m.$w)(r),offsetY:(0,m.$w)(o),rotation:(0,m.$w)(-h),colorSubstitutions:null}),c}static fromSimpleFillSymbol(t){const{color:e,style:i,outline:n}=t,r=[],o={type:"CIMPolygonSymbol",symbolLayers:r};if(n){const t=Z(n);t&&r.push(t)}if(i&&"solid"!==i&&"none"!==i&&"esriSFSSolid"!==i&&"esriSFSNull"!==i){const t={type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",color:B(e),capStyle:_.uT.Butt,joinStyle:_.wd.Miter,width:.75}]};let n=0;const o=(0,l.PN)(H(i)?8:10);switch(i){case"vertical":case"esriSFSVertical":n=90;break;case"forward-diagonal":case"esriSFSForwardDiagonal":case"diagonal-cross":case"esriSFSDiagonalCross":n=-45;break;case"backward-diagonal":case"esriSFSBackwardDiagonal":n=45;break;case"cross":case"esriSFSCross":n=0}r.push({type:"CIMHatchFill",lineSymbol:t,offsetX:0,offsetY:0,rotation:n,separation:o}),"cross"===i||"esriSFSCross"===i?r.push({type:"CIMHatchFill",lineSymbol:(0,s.o8)(t),offsetX:0,offsetY:0,rotation:90,separation:o}):"diagonal-cross"!==i&&"esriSFSDiagonalCross"!==i||r.push({type:"CIMHatchFill",lineSymbol:(0,s.o8)(t),offsetX:0,offsetY:0,rotation:45,separation:o})}else!i||"solid"!==i&&"esriSFSSolid"!==i||r.push({type:"CIMSolidFill",enable:!0,color:B(e)});return o}static fromSimpleLineSymbol(t){const{cap:e,color:i,join:n,marker:r,miterLimit:s,style:o,width:a}=t;let l=null;"solid"!==o&&"none"!==o&&"esriSLSSolid"!==o&&"esriSLSNull"!==o&&(l=[{type:"CIMGeometricEffectDashes",dashTemplate:Y(o,e),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]);const c=[];if(r){let t;switch(r.placement){case"begin-end":t=_.$2.Both;break;case"begin":t=_.$2.JustBegin;break;case"end":t=_.$2.JustEnd;break;default:t=_.$2.None}const e=F.fromSimpleMarker(r,a,i).symbolLayers[0];e.markerPlacement={type:"CIMMarkerPlacementAtExtremities",placePerPart:!1,angleToLine:!0,offset:0,extremityPlacement:t,offsetAlongLine:0},c.push(e)}return c.push({type:"CIMSolidStroke",color:"none"!==o&&"esriSLSNull"!==o?B(i):[0,0,0,0],capStyle:D(e),joinStyle:L(n),miterLimit:s,width:a,effects:l}),{type:"CIMLineSymbol",symbolLayers:c}}static fromPictureMarker(t){const{angle:e,height:i,width:n,xoffset:r,yoffset:s}=t;let o=t.url;return"esriPMS"===t.type&&t.imageData&&(o=t.imageData),{type:"CIMPointSymbol",symbolLayers:[{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:_.O$.Picture,tintColor:null,url:o,size:i,width:n,offsetX:(0,m.$w)(r),offsetY:(0,m.$w)(s),rotation:(0,m.$w)(-e)}]}}static createCIMTextSymbolfromTextSymbol(t){const{angle:e,color:i,font:r,haloColor:s,haloSize:o,horizontalAlignment:a,kerning:l,lineWidth:c,text:u,verticalAlignment:h,xoffset:d,yoffset:f,backgroundColor:p,borderLineColor:g,borderLineSize:y}=t;let v,x,b,S,w,T;r&&(v=r.family,x=r.style,b=r.weight,S=r.size,w=r.decoration);let M=!1;return u&&(M=(0,n.y)(u)[1]),(p||y)&&(T={type:"CIMBackgroundCallout",margin:null,backgroundSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",color:B(p)},{type:"CIMSolidStroke",color:B(g),width:y}]},accentBarSymbol:null,gap:null,leaderLineSymbol:null,lineStyle:null}),{type:"CIMTextSymbol",angle:e,blockProgression:_.TZ.BTT,depth3D:1,extrapolateBaselines:!0,fontEffects:_.Y.Normal,fontEncoding:_.bj.Unicode,fontFamilyName:v||"Arial",fontStyleName:V(x,b),fontType:_.g7.Unspecified,haloSize:o,height:S,hinting:_.mU.Default,horizontalAlignment:k(a??"center"),kerning:l,letterWidth:100,ligatures:!0,lineGapType:"Multiple",lineWidth:c,offsetX:(0,m.$w)(d),offsetY:(0,m.$w)(f),strikethrough:"line-through"===w,underline:"underline"===w,symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:B(i)}]},haloSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:B(s)}]},shadowColor:[0,0,0,255],shadowOffsetX:1,shadowOffsetY:1,textCase:"Normal",textDirection:M?_.f0.RTL:_.f0.LTR,verticalAlignment:N(h??"baseline"),verticalGlyphOrientation:_.vG.Right,wordSpacing:100,billboardMode3D:_.xn.FaceNearPlane,callout:T}}static createPictureMarkerRasterizationParam(t){const{angle:e,height:i,width:n,xoffset:r,yoffset:s}=t,o=t.url??t.source?.url??t.source?.imageData;return o?{type:"sprite-rasterization-param",overrides:[],resource:{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:_.O$.Picture,tintColor:null,url:o,size:i,width:n,offsetX:(0,m.$w)(r),offsetY:(0,m.$w)(s),rotation:(0,m.$w)(-e)}}:null}static createPictureFillRasterizationParam(t){const{width:e,height:i,xoffset:n,yoffset:r,url:s}=t;return s?{type:"sprite-rasterization-param",overrides:[],resource:{type:"CIMPictureFill",scaleX:1,textureFilter:_.O$.Picture,tintColor:null,url:s,width:e,height:i,offsetX:(0,m.$w)(n),offsetY:(0,m.$w)(r),rotation:0}}:null}static fromSimpleMarker(t,e,i){const{style:n}=t,r=t.color??i;if("path"===n||"esriSMSPath"===n){const e=[];if("outline"in t&&t.outline){const i=t.outline;e.push({type:"CIMSolidStroke",enable:!0,width:i.width,color:B(i.color),path:t.path})}e.push({type:"CIMSolidFill",enable:!0,color:B(r),path:t.path});const[i,n]=W("square");return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:-(0,m.$w)(t.angle),size:(0,m.$w)(t.size||6),offsetX:(0,m.$w)(t.xoffset),offsetY:(0,m.$w)(t.yoffset),scaleSymbolsProportionally:!1,frame:i,markerGraphics:[{type:"CIMMarkerGraphic",geometry:n,symbol:{type:"CIMPolygonSymbol",symbolLayers:e}}]}]}}const s=[];let o,a,l=t.size;if("outline"in t&&t.outline&&"none"!==t.outline.style&&"esriSLSNull"!==t.outline.style){const e=t.outline,i="solid"!==e.style&&"esriSLSSolid"!==e.style;[o,a]=i?W(n,t.size):W(n);const r=e.width??g.A7.width;if(i){const e=r/t.size,i=(o.xmax-o.xmin)*e/2,n=(o.ymax-o.ymin)*e/2;o.xmin-=i,o.xmax+=i,o.ymin-=n,o.ymax+=n,l&&(l+=r)}const c="cross"!==t.style&&"x"!==t.style||"dot"===t?.outline.style||"short-dot"===t?.outline.style?_.yS.HalfGap:_.yS.FullPattern,u=i?[{type:"CIMGeometricEffectAddControlPoints"},{type:"CIMGeometricEffectDashes",dashTemplate:Y(e.style,null).map((t=>e.width&&e.width>0?t*e.width:t)),lineDashEnding:c,controlPointEnding:_.yS.FullPattern}]:void 0;s.push({type:"CIMSolidStroke",capStyle:i?_.uT.Round:_.uT.Butt,enable:!0,width:r,color:B(e.color),effects:u})}else!e||"line-marker"!==t.type||"cross"!==t.style&&"x"!==t.style?[o,a]=W(n):([o,a]=W(n),s.push({type:"CIMSolidStroke",enable:!0,width:e,color:B(r)}));s.push({type:"CIMSolidFill",enable:!0,color:B(r)});const c={type:"CIMPolygonSymbol",symbolLayers:s};return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:(0,m.$w)(-t.angle),size:(0,m.$w)(l||6*e),offsetX:(0,m.$w)(t.xoffset),offsetY:(0,m.$w)(t.yoffset),scaleSymbolsProportionally:!1,frame:o,markerGraphics:[{type:"CIMMarkerGraphic",geometry:a,symbol:c}]}]}}static fromCIMHatchFill(t,e){const i=e*(t.separation??p.D.CIMHatchFill.separation),n=i/2,r=(0,s.o8)(t.lineSymbol);r.symbolLayers?.forEach((t=>{switch(t.type){case"CIMSolidStroke":null!=t.width&&(t.width*=e),t.effects?.forEach((t=>{if("CIMGeometricEffectDashes"===t.type){const i=t.dashTemplate;t.dashTemplate=i?.map((t=>t*e))}}));break;case"CIMVectorMarker":{null!=t.size&&(t.size*=e);const i=t.markerPlacement;null!=i&&"placementTemplate"in i&&(i.placementTemplate=i.placementTemplate.map((t=>t*e)));break}}}));let o=this._getLineSymbolPeriod(r)||4;for(;o<4;)o*=2;const a=o/2;return{type:"CIMVectorMarker",frame:{xmin:-a,xmax:a,ymin:-n,ymax:n},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[-a,0],[a,0]]]},symbol:r}],size:i}}static fetchResources(t,e,i,n=null){return t&&e?(z(t,(t=>{(function(t,e,i){t.effects&&null==e.geometryEngine&&(e.geometryEnginePromise?i.push(e.geometryEnginePromise):(0,m.yH)(t.effects)&&(e.geometryEnginePromise=(0,m._H)(),i.push(e.geometryEnginePromise),e.geometryEnginePromise.then((t=>e.geometryEngine=t))))})(t,e,i),"url"in t&&t.url&&i.push(e.fetchResource(t.url,{signal:n}))})),i):i}static fetchFonts(t,e,i){if(t&&e)if("symbolLayers"in t&&t.symbolLayers){for(const n of t.symbolLayers)if("CIMVectorMarker"===n.type&&n.markerGraphics)for(const t of n.markerGraphics)t?.symbol&&F.fetchFonts(t.symbol,e,i)}else if("CIMTextSymbol"===t.type){const{fontFamilyName:n,fontStyleName:r}=t;if(!n||"calcitewebcoreicons"===n.toLowerCase())return;const{style:s,weight:o}=(0,m._d)(r),a=(0,m.DW)(t),l=new h.A({family:n,style:s,weight:o,decoration:a});i.push(e.loadFont(l).catch((()=>{P().error(`Unsupported font ${n} in CIM symbol`)})))}}static _getLineSymbolPeriod(t){if(t){const e=this._getEffectsRepeat(t.effects);if(e)return e;if(t.symbolLayers)for(const e of t.symbolLayers)if(e){const t=this._getEffectsRepeat(e.effects);if(t)return t;switch(e.type){case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":{const t=this._getPlacementRepeat(e.markerPlacement);if(t)return t}}}}return 0}static _getEffectsRepeat(t){if(t)for(const e of t)if(e)switch(e.type){case"CIMGeometricEffectDashes":{const t=e.dashTemplate;if(t&&t.length){let e=0;for(const i of t)e+=i;return 1&t.length&&(e*=2),e}break}case"CIMGeometricEffectWave":return e.period;default:P().error(`unsupported geometric effect type ${e.type}`)}return 0}static _getPlacementRepeat(t){if(t)switch(t.type){case"CIMMarkerPlacementAlongLineSameSize":case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineVariableSize":{const e=t.placementTemplate;if(e&&e.length){let t=0;for(const i of e)t+=+i;return 1&e.length&&(t*=2),t}break}}return 0}static fromCIMInsidePolygon(t){const e=t.markerPlacement,i={...t};i.markerPlacement=null,i.anchorPoint=null;const n=Math.abs(e.stepX),r=Math.abs(e.stepY),s=(e.randomness??100)/100;let o,c,u,h;if("Random"===e.gridType){const t=(0,l.PN)(v.yv),i=Math.max(Math.floor(t/n),1),d=Math.max(Math.floor(t/r),1);o=i*n/2,c=d*r/2,u=2*c;const f=new a.A(e.seed),p=s*n/1.5,_=s*r/1.5;h=[];for(let t=0;t<i;t++)for(let e=0;e<d;e++){const i=t*n-o+p*(.5-f.getFloat()),s=e*r-c+_*(.5-f.getFloat());h.push({x:i,y:s}),0===t&&h.push({x:i+2*o,y:s}),0===e&&h.push({x:i,y:s+2*c})}}else!0===e.shiftOddRows?(o=n/2,c=r,u=2*r,h=[{x:-o,y:0},{x:o,y:0},{x:0,y:c},{x:0,y:-c}]):(o=n/2,c=r/2,u=r,h=[{x:-n,y:0},{x:0,y:-r},{x:-n,y:-r},{x:0,y:0},{x:n,y:0},{x:0,y:r},{x:n,y:r},{x:-n,y:r},{x:n,y:-r}]);return{type:"CIMVectorMarker",frame:{xmin:-o,xmax:o,ymin:-c,ymax:c},markerGraphics:h.map((t=>({type:"CIMMarkerGraphic",geometry:t,symbol:{type:"CIMPointSymbol",symbolLayers:[i]}}))),size:u}}}function z(t,e){if(t)switch(t.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const i=t.symbolLayers;if(!i)return;for(const t of i)if(e(t),"CIMVectorMarker"===t.type){const i=t.markerGraphics;if(!i)continue;for(const t of i)if(t){const i=t.symbol;i&&z(i,e)}}break}}}const D=t=>{if(!t)return _.uT.Butt;switch(t){case"butt":return _.uT.Butt;case"square":return _.uT.Square;case"round":return _.uT.Round}},L=t=>{if(!t)return _.wd.Miter;switch(t){case"miter":return _.wd.Miter;case"round":return _.wd.Round;case"bevel":return _.wd.Bevel}},k=t=>{if(null==t)return"Center";switch(t){case"left":return"Left";case"right":return"Right";case"center":return"Center"}},N=t=>{if(null==t)return"Center";switch(t){case"baseline":return"Baseline";case"top":return"Top";case"middle":return"Center";case"bottom":return"Bottom"}},B=t=>{if(!t)return[0,0,0,0];const{r:e,g:i,b:n,a:r}=t;return[e,i,n,255*r]},V=(t,e)=>{const i=U(e),n=G(t);return i&&n?`${i}-${n}`:`${i}${n}`},U=t=>{if(!t)return"";switch(t.toLowerCase()){case"bold":case"bolder":return"bold"}return""},G=t=>{if(!t)return"";switch(t.toLowerCase()){case"italic":case"oblique":return"italic"}return""},Y=(t,e)=>{const i=(0,r.A)("safari")?.001:0,n="butt"===e;switch(t){case"dash":case"esriSLSDash":return n?[4,3]:[3,4];case"dash-dot":case"esriSLSDashDot":return n?[4,3,1,3]:[3,4,i,4];case"dot":case"esriSLSDot":return n?[1,3]:[i,4];case"long-dash":case"esriSLSLongDash":return n?[8,3]:[7,4];case"long-dash-dot":case"esriSLSLongDashDot":return n?[8,3,1,3]:[7,4,i,4];case"long-dash-dot-dot":case"esriSLSDashDotDot":return n?[8,3,1,3,1,3]:[7,4,i,4,i,4];case"short-dash":case"esriSLSShortDash":return n?[4,1]:[3,2];case"short-dash-dot":case"esriSLSShortDashDot":return n?[4,1,1,1]:[3,2,i,2];case"short-dash-dot-dot":case"esriSLSShortDashDotDot":return n?[4,1,1,1,1,1]:[3,2,i,2,i,2];case"short-dot":case"esriSLSShortDot":return n?[1,1]:[i,2];case"solid":case"esriSLSSolid":case"none":return P().error("Unexpected: style does not require rasterization"),[0,0];default:return P().error(`Tried to rasterize SLS, but found an unexpected style: ${t}!`),[0,0]}},W=(t,e=100)=>{const i=e/2;let n,r;const s=t;if("circle"===s||"esriSMSCircle"===s){const t=.25;let e=Math.acos(1-t/i),s=Math.ceil(S/e/4);0===s&&(s=1),e=w/s,s*=4;const o=[];o.push([i,0]);for(let t=1;t<s;t++)o.push([i*Math.cos(t*e),-i*Math.sin(t*e)]);o.push([i,0]),n={rings:[o]},r={xmin:-i,ymin:-i,xmax:i,ymax:i}}else if("cross"===s||"esriSMSCross"===s){const t=0;n={paths:[[[t,i],[t,-i]],[[i,t],[-i,t]]]},r={xmin:-i,ymin:-i,xmax:i,ymax:i}}else if("diamond"===s||"esriSMSDiamond"===s)n={rings:[[[-i,0],[0,i],[i,0],[0,-i],[-i,0]]]},r={xmin:-i,ymin:-i,xmax:i,ymax:i};else if("square"===s||"esriSMSSquare"===s)n={rings:[[[-i,-i],[-i,i],[i,i],[i,-i],[-i,-i]]]},r={xmin:-i,ymin:-i,xmax:i,ymax:i};else if("x"===s||"esriSMSX"===s)n={paths:[[[i,i],[-i,-i]],[[i,-i],[-i,i]]]},r={xmin:-i,ymin:-i,xmax:i,ymax:i};else if("triangle"===s||"esriSMSTriangle"===s){const t=.5773502691896257*e,i=-t,s=2/3*e,o=s-e;n={rings:[[[i,o],[0,s],[t,o],[i,o]]]},r={xmin:i,ymin:o,xmax:t,ymax:s}}else"arrow"===s&&(n={rings:[[[-50,50],[50,0],[-50,-50],[-33,-20],[-33,20],[-50,50]]]},r={xmin:-i,ymin:-i,xmax:i,ymax:i});return[r,n]},H=t=>"vertical"===t||"horizontal"===t||"cross"===t||"esriSFSCross"===t||"esriSFSVertical"===t||"esriSFSHorizontal"===t;function Z(t){if(!t)return null;let e=null;const{cap:i,color:n,join:r,miterLimit:s,style:o,width:a}=t;return"solid"!==o&&"none"!==o&&"esriSLSSolid"!==o&&"esriSLSNull"!==o&&(e=[{type:"CIMGeometricEffectDashes",dashTemplate:Y(o,i),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]),{type:"CIMSolidStroke",color:"esriSLSNull"!==o&&"none"!==o?B(n):[0,0,0,0],capStyle:D(i),joinStyle:L(r),miterLimit:s,width:a,effects:e}}},93996:function(t,e,i){i.d(e,{I:function(){return o},U:function(){return s}});var n=i(33134),r=i(33389);const s=.03;class o{constructor(t=0,e=!1){}isEmpty(t){if(!t.nextPoint())return!0;let e,i,n,r;for(e=t.x,i=t.y;t.nextPoint();e=i,i=r)if(n=t.x,r=t.y,n!==e||r!==i)return t.seekPathStart(),!1;return t.seekPathStart(),!0}normalize(t){const e=Math.sqrt(t[0]*t[0]+t[1]*t[1]);0!==e&&(t[0]/=e,t[1]/=e)}getLength(t,e,i,n){const r=i-t,s=n-e;return Math.sqrt(r*r+s*s)}getSegLength(t){const[[e,i],[n,r]]=t;return this.getLength(e,i,n,r)}getCoord2D(t,e,i,n,r){return[t+(i-t)*r,e+(n-e)*r]}getSegCoord2D(t,e){const[[i,n],[r,s]]=t;return this.getCoord2D(i,n,r,s,e)}getAngle(t,e,i,n,r){const s=i-t,o=n-e;return Math.atan2(o,s)}getAngleCS(t,e,i,n,r){const s=i-t,o=n-e,a=Math.sqrt(s*s+o*o);return a>0?[s/a,o/a]:[1,0]}getSegAngleCS(t,e){const[[i,n],[r,s]]=t;return this.getAngleCS(i,n,r,s,e)}cut(t,e,i,n,r,s){return[r<=0?[t,e]:this.getCoord2D(t,e,i,n,r),s>=1?[i,n]:this.getCoord2D(t,e,i,n,s)]}getSubCurve(t,e,i){const r=n.z.createEmptyOptimizedCIM("esriGeometryPolyline");return this.appendSubCurve(r,t,e,i)?r:null}appendSubCurve(t,e,i,n){t.startPath(),e.seekPathStart();let r=0,s=!0;if(!e.nextPoint())return!1;let o=e.x,a=e.y;for(;e.nextPoint();){const l=this.getLength(o,a,e.x,e.y);if(0!==l){if(s){if(r+l>i){const c=(i-r)/l;let u=1,h=!1;r+l>=n&&(u=(n-r)/l,h=!0);const d=this.cut(o,a,e.x,e.y,c,u);if(d&&t.pushPoints(d),h)break;s=!1}}else{if(r+l>n){const i=this.cut(o,a,e.x,e.y,0,(n-r)/l);i&&t.pushPoint(i[1]);break}t.pushXY(e.x,e.y)}r+=l,o=e.x,a=e.y}else o=e.x,a=e.y}return!0}getCIMPointAlong(t,e){if(!t.nextPoint())return null;let i,n,r,s,o=0;for(i=t.x,n=t.y;t.nextPoint();i=r,n=s){r=t.x,s=t.y;const a=this.getLength(i,n,r,s);if(0!==a){if(o+a>e){const t=(e-o)/a;return this.getCoord2D(i,n,r,s,t)}o+=a}}return null}offset(t,e,i,n,s){if(!t||t.length<2)return null;let o=0,a=t[o++],l=o;for(;o<t.length;){const e=t[o];e[0]===a[0]&&e[1]===a[1]||(o!==l&&(t[l]=t[o]),a=t[l++]),o++}const c=t[0][0]===t[l-1][0]&&t[0][1]===t[l-1][1];if(c&&--l,l<(c?3:2))return null;const u=[];a=c?t[l-1]:null;let h=t[0];for(let s=0;s<l;s++){const o=s===l-1?c?t[0]:null:t[s+1];if(a)if(o){const t=[o[0]-h[0],o[1]-h[1]];this.normalize(t);const s=[h[0]-a[0],h[1]-a[1]];this.normalize(s);const l=s[0]*t[1]-s[1]*t[0],c=s[0]*t[0]+s[1]*t[1];if(0===l&&1===c){h=o;continue}if(l>=0==e<=0){if(c<1){const i=[t[0]-s[0],t[1]-s[1]];this.normalize(i);const r=Math.sqrt((1+c)/2);if(r>1/n){const t=-Math.abs(e)/r;u.push([h[0]-i[0]*t,h[1]-i[1]*t])}}}else switch(i){case r.xw.Mitered:{const i=Math.sqrt((1+c)/2);if(i>0&&1/i<n){const n=[t[0]-s[0],t[1]-s[1]];this.normalize(n);const r=Math.abs(e)/i;u.push([h[0]-n[0]*r,h[1]-n[1]*r]);break}}case r.xw.Bevelled:u.push([h[0]+s[1]*e,h[1]-s[0]*e]),u.push([h[0]+t[1]*e,h[1]-t[0]*e]);break;case r.xw.Rounded:if(c<1){u.push([h[0]+s[1]*e,h[1]-s[0]*e]);const i=Math.floor(2.5*(1-c));if(i>0){const n=1/i;let r=n;for(let o=1;o<i;o++,r+=n){const i=[s[1]*(1-r)+t[1]*r,-s[0]*(1-r)-t[0]*r];this.normalize(i),u.push([h[0]+i[0]*e,h[1]+i[1]*e])}}u.push([h[0]+t[1]*e,h[1]-t[0]*e])}break;case r.xw.Square:default:if(l<0)u.push([h[0]+(s[1]+s[0])*e,h[1]+(s[1]-s[0])*e]),u.push([h[0]+(t[1]-t[0])*e,h[1]-(t[0]+t[1])*e]);else{const i=Math.sqrt((1+Math.abs(c))/2),n=[t[0]-s[0],t[1]-s[1]];this.normalize(n);const r=e/i;u.push([h[0]-n[0]*r,h[1]-n[1]*r])}}}else{const t=[h[0]-a[0],h[1]-a[1]];this.normalize(t),u.push([h[0]+t[1]*e,h[1]-t[0]*e])}else{const t=[o[0]-h[0],o[1]-h[1]];this.normalize(t),u.push([h[0]+t[1]*e,h[1]-t[0]*e])}a=h,h=o}return u.length<(c?3:2)?null:(c&&u.push([u[0][0],u[0][1]]),u)}}},65661:function(t,e,i){i.d(e,{VA:function(){return a},YQ:function(){return n},Z1:function(){return u},ps:function(){return l}});var n,r,s=i(33134),o=i(93996);class a{constructor(){this._values=[],this.extPtGap=0,this.ctrlPtGap=0,this._length=0,this._currentValue=0}isEmpty(){return 0===this._values.length}size(){return this._values.length}init(t,e,i=!0){if(this._setEmpty(),!t||0===t.length)return!1;for(let e=0;e<t.length;e++){let n=Math.abs(t[e]);i&&n<1e-7&&(n=1e-7),this._values.push(n),this._length+=n}return e&&1&t.length&&(this._length*=2),0!==this._length&&(this.ctrlPtGap=this.extPtGap=0,this._currentValue=-1,!0)}scale(t){const e=this._values?this._values.length:0;for(let i=0;i<e;++i)this._values[i]*=t;this._length*=t,this.extPtGap*=t,this.ctrlPtGap*=t}addValue(t){this._length+=t,this._values.push(t)}firstValue(){return this._values[0]}lastValue(){return this._values[this._values.length-1]}nextValue(){return this._currentValue++,this._currentValue===this._values.length&&(this._currentValue=0),this._values[this._currentValue]}reset(){this._currentValue=-1}length(){return this._length}_setEmpty(){this.extPtGap=this.ctrlPtGap=this._length=0,this._currentValue=-1,this._values.length=0}}class l{constructor(){this.pt=null,this.ca=0,this.sa=0}}(r=n||(n={}))[r.FAIL=0]="FAIL",r[r.END=1]="END",r[r.CONTINUE=2]="CONTINUE";class c{constructor(){this.reset()}reset(){this.segment=null,this.segmentLength=0,this.abscissa=0,this.isPathEnd=!1,this.isPartEnd=!1}isValid(){return null!==this.segment}copyTo(t){t.segment=this.segment,t.segmentLength=this.segmentLength,t.abscissa=this.abscissa,t.isPathEnd=this.isPathEnd,t.isPartEnd=this.isPartEnd}}class u extends o.I{constructor(t=0,e=!1){super(t,e),this._tolerance=o.U,this._currentPosition=new c}updateTolerance(t){this._tolerance=o.U*t}init(t,e,i=!0){return i?(this._patternLength=e.length(),this._partExtPtGap=e.extPtGap,this._partCtrlPtGap=e.ctrlPtGap):(this._patternLength=0,this._partExtPtGap=0,this._partCtrlPtGap=0),this._currentPosition.reset(),this._partSegCount=0,this._pathCursor=t,this._seg=-1,this._setPosAtNextPart()}curPositionIsValid(){return this._currentPosition.isValid()}nextPosition(t,e=n.FAIL){const i=new c;return!!this._nextPosition(t,i,null,e)&&(i.copyTo(this._currentPosition),!0)}curPointAndAngle(t){t.pt=this._getPoint(this._currentPosition);const[e,i]=this._getAngleCS(this._currentPosition);t.ca=e,t.sa=i}nextPointAndAngle(t,e,i=n.FAIL){const r=new c;if(!this._nextPosition(t,r,null,i))return!1;r.copyTo(this._currentPosition),e.pt=this._getPoint(r);const[s,o]=this._getAngleCS(r);return e.ca=s,e.sa=o,!0}nextCurve(t){if(0===t)return null;const e=s.z.createEmptyOptimizedCIM("esriGeometryPolyline");e.startPath(),e.nextPath();const i=new c;return this._nextPosition(t,i,e,n.END)?(i.copyTo(this._currentPosition),e):null}isPathEnd(){return this._currentPosition.isPathEnd}getPathEnd(){return this._currentPosition.segment[1]}getPt(t){return this._pathCursor.seekInPath(t),[this._pathCursor.x,this._pathCursor.y]}getSeg(t){return[this.getPt(t),this.getPt(t+1)]}_nextPosition(t,e,i,r){if(this._currentPosition.isPathEnd)return!1;let s=this._currentPosition.abscissa;for(this._currentPosition.segmentLength>0&&(s/=this._currentPosition.segmentLength),this._currentPosition.copyTo(e);e.abscissa+t*this._partLengthRatio>e.segmentLength+this._tolerance;){if(i){if(0===i.pathSize)if(0===s){const t=e.segment[0];i.pushXY(t[0],t[1])}else i.pushPoint(this.getSegCoord2D(e.segment,s));const t=e.segment[1];i.pushXY(t[0],t[1])}if(s=0,t-=(e.segmentLength-e.abscissa)/this._partLengthRatio,this._partSegCount)e.segment=this._nextSegment(),e.segmentLength=this.getSegLength(e.segment),e.abscissa=0,this._partSegCount--;else{if(!this._setPosAtNextPart())return r!==n.FAIL&&(e.segmentLength=this.getSegLength(e.segment),e.isPartEnd=!0,r===n.END?(e.abscissa=e.segmentLength,e.isPathEnd=!0):e.abscissa=e.segmentLength+t,!0);this._currentPosition.copyTo(e)}}if(e.abscissa+=t*this._partLengthRatio,i){0===i.pathSize&&(0===s?i.pushPoint(e.segment[0]):i.pushPoint(this.getSegCoord2D(e.segment,s)));const t=e.abscissa/e.segmentLength;1===t?i.pushPoint(e.segment[1]):i.pushPoint(this.getSegCoord2D(e.segment,t))}return this._partSegCount||Math.abs(e.abscissa-e.segmentLength)<this._tolerance&&(e.isPathEnd=this._partIsLast,e.isPartEnd=!0),!0}_getPoint(t){const e=t.segmentLength<=0?0:t.abscissa/t.segmentLength;return this.getSegCoord2D(this._currentPosition.segment,e)}_getAngleCS(t){const e=t.segmentLength<=0?0:t.abscissa/t.segmentLength;return this.getSegAngleCS(this._currentPosition.segment,e)}_setPosAtNextPart(){for(;this._partSegCount;)this._hasNextSegment()&&this._nextSegment(),this._partSegCount--;if(!this._hasNextSegment())return!1;for(this._partLength=0,this._partIsLast=!0,this._partSegCount=0;this._hasNextSegment();)if(this._partLength+=this.getSegLength(this._nextSegment()),this._partSegCount++,this._pathCursor.getControlPointAt(this._getEndPointIndex())){this._partIsLast=!this._hasNextSegment();break}let t=this._partSegCount;for(;t;)this._previousSegment(),--t;this._currentPosition.segment=this._nextSegment(),this._currentPosition.segmentLength=this.getSegLength(this._currentPosition.segment),this._currentPosition.abscissa=0,this._currentPosition.isPathEnd=this._currentPosition.isPartEnd=!1,--this._partSegCount;const e=this._getStartPointIndex();this._ctrlPtBegin=this._pathCursor.getControlPointAt(e);let i=e+this._partSegCount+1;if(i>=this._pathCursor.pathSize&&(i=0),this._ctrlPtEnd=this._pathCursor.getControlPointAt(i),this._patternLength>0){const t=this._ctrlPtBegin?this._partCtrlPtGap:this._partExtPtGap,e=this._ctrlPtEnd?this._partCtrlPtGap:this._partExtPtGap;let i=Math.round((this._partLength-(t+e))/this._patternLength);i<=0&&(i=t+e>0?0:1),this._partLengthRatio=this._partLength/(t+e+i*this._patternLength),this._partLengthRatio<.01&&(this._partLengthRatio=1)}else this._partLengthRatio=1;return!0}_hasNextSegment(){return this._seg<this._pathCursor.pathSize-2}_previousSegment(){return this.getSeg(--this._seg)}_nextSegment(){return this.getSeg(++this._seg)}_getStartPointIndex(){return this._seg}_getEndPointIndex(){return this._seg+1}}},82497:function(t,e,i){i.d(e,{A:function(){return n}});class n{constructor(t=0,e=0,i=0,n=0){this.x=t,this.y=e,this.width=i,this.height=n}static fromExtent(t){return new n(t.xmin,-t.ymax,t.xmax-t.xmin,t.ymax-t.ymin)}get isEmpty(){return this.width<=0||this.height<=0}union(t){this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.width=Math.max(this.width,t.width),this.height=Math.max(this.height,t.height)}}},44508:function(t,e,i){i.d(e,{Fj:function(){return d},Z7:function(){return u},ce:function(){return f},eR:function(){return l},xt:function(){return h}});var n=i(5161),r=i(74697),s=i(82497),o=i(39686);const a=.45;function l(t,e=.5){switch(t.type){case"CIMPointSymbol":{const e=t.symbolLayers;if(!e||1!==e.length)return null;const i=e[0];return"CIMVectorMarker"!==i.type?null:l(i)}case"CIMVectorMarker":{const i=t.markerGraphics;if(!i||1!==i.length)return null;const n=i[0];if(!n)return null;const r=n.geometry;if(!r)return null;const s=n.symbol;return!s||"CIMPolygonSymbol"!==s.type&&"CIMLineSymbol"!==s.type||s.symbolLayers?.some((t=>!!t.effects))?null:{type:"sdf",geom:r,sdfPaddingRatio:e,asFill:"CIMPolygonSymbol"===s.type}}}}function c(t){let e=1/0,i=-1/0,n=1/0,r=-1/0;for(const s of t)for(const t of s)t[0]<e&&(e=t[0]),t[0]>i&&(i=t[0]),t[1]<n&&(n=t[1]),t[1]>r&&(r=t[1]);return[e,n,i,r]}function u(t){return t?t.rings?c(t.rings):t.paths?c(t.paths):(0,r.ZC)(t)?[t.xmin,t.ymin,t.xmax,t.ymax]:null:null}function h(t,e){const[i,n,r,s]=u(t),a=r-i,l=s-n,c=o.p,h=o.hM,d=Math.floor(.5*(c*e-h)),f=(c-2*(d+h))/Math.max(a,l),p=Math.round(a*f),_=Math.round(l*f);return{pixelDimensions:[a,l],texelDimensions:[Math.round((p+2*d)/f),Math.round((_+2*d)/f)]}}function d(t,e,i,n,r,s,l){const[c,u,h,d]=t;if(h<c||d<u)return{frameSizeRatio:0,anchorX:0,anchorY:0,widthRatio:1,sdfPaddingRatio:.5};const f=h-c,p=d-u,_=Math.max(f,p);let m=.5;if(null!=s&&null!=i){l||null==e||(s*=(e.ymax-e.ymin)/i);const t=s/(s+_),n=.1;t>a&&t<1&&(m=Math.min(t+n,.99))}const g=o.p,y=o.hM,v=Math.floor(.5*(g*m-y)),x=(g-2*(v+y))/_,b=Math.round(f*x)+2*v,S=Math.round(p*x)+2*v;let w=1;e&&(w=S*(1-m)/((e.ymax-e.ymin)*x));let T=0,M=0,P=1;n&&(r?e&&i&&e.ymax-e.ymin>0&&(P=(e.xmax-e.xmin)/(e.ymax-e.ymin),T=n.x/(i*P),M=n.y/i):(T=n.x,M=n.y)),e&&(T=.5*(e.xmax+e.xmin)+T*(e.xmax-e.xmin),M=.5*(e.ymax+e.ymin)+M*(e.ymax-e.ymin)),T-=c,M-=u,T*=x,M*=x,T+=v,M+=v;let A=T/b-.5,C=M/S-.5;return r&&i&&(A*=i*P,C*=i),{frameSizeRatio:w,anchorX:A,anchorY:C,widthRatio:P,sdfPaddingRatio:m}}function f(t){const e=function(t){return t?t.rings?t.rings:t.paths?t.paths:void 0!==t.xmin&&void 0!==t.ymin&&void 0!==t.xmax&&void 0!==t.ymax?[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]:null:null}(t.geom),i=function(t){let e=1/0,i=-1/0,n=1/0,r=-1/0;for(const s of t)for(const t of s)t[0]<e&&(e=t[0]),t[0]>i&&(i=t[0]),t[1]<n&&(n=t[1]),t[1]>r&&(r=t[1]);return new s.A(e,n,i-e,r-n)}(e),n=o.p,r=o.hM,a=Math.floor(.5*(n*t.sdfPaddingRatio-r)),l=n-2*(a+r),c=l/Math.max(i.width,i.height),u=Math.round(i.width*c)+2*a,h=Math.round(i.height*c)+2*a,d=[];for(const n of e)if(n&&n.length>1){const e=[];for(const r of n){let[n,s]=r;n-=i.x,s-=i.y,n*=c,s*=c,n+=a-.5,s+=a-.5,t.asFill?e.push([n,s]):e.push([Math.round(n),Math.round(s)])}if(t.asFill){const t=e.length-1;e[0][0]===e[t][0]&&e[0][1]===e[t][1]||e.push(e[0])}d.push(e)}const f=function(t,e,i,n){const r=e*i,s=new Array(r),o=n*n+1;for(let t=0;t<r;++t)s[t]=o;for(const r of t){const t=r.length;for(let o=1;o<t;++o){const t=r[o-1],a=r[o];let l,c,u,h;t[0]<a[0]?(l=t[0],c=a[0]):(l=a[0],c=t[0]),t[1]<a[1]?(u=t[1],h=a[1]):(u=a[1],h=t[1]);let d=Math.floor(l)-n,f=Math.floor(c)+n,p=Math.floor(u)-n,_=Math.floor(h)+n;d<0&&(d=0),f>e&&(f=e),p<0&&(p=0),_>i&&(_=i);const m=a[0]-t[0],g=a[1]-t[1],y=m*m+g*g;for(let n=d;n<f;n++)for(let r=p;r<_;r++){const o=n+.5,l=r+.5;let c,u,h=(o-t[0])*m+(l-t[1])*g;h<0?(c=t[0],u=t[1]):h>y?(c=a[0],u=a[1]):(h/=y,c=t[0]+h*m,u=t[1]+h*g);const d=(o-c)*(o-c)+(l-u)*(l-u),f=(i-r-1)*e+n;d<s[f]&&(s[f]=d)}}}for(let t=0;t<r;++t)s[t]=Math.sqrt(s[t]);return s}(d,u,h,a);return t.asFill&&function(t,e,i,n,r){for(const s of t){const t=s.length;for(let o=1;o<t;++o){const t=s[o-1],a=s[o];let l,c,u,h;t[0]<a[0]?(l=t[0],c=a[0]):(l=a[0],c=t[0]),t[1]<a[1]?(u=t[1],h=a[1]):(u=a[1],h=t[1]);let d=Math.floor(l),f=Math.floor(c)+1,p=Math.floor(u),_=Math.floor(h)+1;d<n&&(d=n),f>e-n&&(f=e-n),p<n&&(p=n),_>i-n&&(_=i-n);for(let s=p;s<_;++s){if(t[1]>s==a[1]>s)continue;const o=s+.5,l=(i-s-1)*e;for(let e=d;e<f;++e)e+.5<(a[0]-t[0])*(o-t[1])/(a[1]-t[1])+t[0]&&(r[l+e]=-r[l+e]);for(let t=n;t<d;++t)r[l+t]=-r[l+t]}}}}(d,u,h,a,f),{data:p(f,a),width:u,height:h,sdfPaddingRatio:t.sdfPaddingRatio,sdfDecodeCoeff:2*a/l}}function p(t,e){const i=2*e,r=t.length,s=new Uint8Array(4*r);for(let e=0;e<r;++e){const r=.5-t[e]/i;(0,n.U)(r,s,4*e)}return s}},3247:function(t,e,i){i.d(e,{H:function(){return r}});var n=i(58941);const r=new class{get forceStaticPath(){return"disabled"===(0,n.A)("esri-cim-animations-enable-status")}get forceAnimatedPath(){return"forced"===(0,n.A)("esri-cim-animations-enable-status")}get freezeGlobalTime(){return(0,n.A)("esri-cim-animations-freeze-time")??!1}get spotlightAnimatedSymbols(){return!!(0,n.A)("esri-cim-animations-spotlight")}get forceGlobalTimeOrigin(){return!1!==(0,n.A)("esri-cim-animations-freeze-time")}}},2014:function(t,e,i){i.d(e,{$o:function(){return n},$u:function(){return o},gR:function(){return s},zA:function(){return r}});const n=15.5,r=4,s=64,o=1024},47072:function(t,e,i){i.d(e,{V:function(){return c}});var n=i(33134),r=i(49077),s=i(62096),o=i(9635),a=i(57176);const l=96/72;class c{static executeEffects(t,e,i,n){const r=l,c=(0,a.ll)(t);let u=new s.k(e);for(const e of t){const t=(0,o.A)(e);t&&(u=t.execute(u,e,r,i,n,c))}return u}static applyEffects(t,e,i){if(!t)return e;const l=(0,a.ll)(t);let c,u=new s.k(n.z.fromJSONCIM(e));for(const e of t){const t=(0,o.A)(e);t&&(u=t.execute(u,e,1,null,i,l))}const h=[];let d=null;for(;c=u.next();)h.push(...(0,r.x)(c)),d=c.geometryType;return 0===h.length||null===d?null:"esriGeometryPolygon"===d?{rings:h}:{paths:h}}}},63514:function(t,e,i){i.d(e,{N:function(){return n}});class n{static local(){return null===n.instance&&(n.instance=new n),n.instance}execute(t,e,i,n,s){return new r(t,e,i)}}n.instance=null;class r{constructor(t,e,i){this._inputGeometries=t,this._angleTolerance=void 0!==e.angleTolerance?e.angleTolerance:120,this._maxCosAngle=Math.cos((1-Math.abs(this._angleTolerance)/180)*Math.PI)}next(){let t=this._inputGeometries.next();for(;t;){if("esriGeometryPolygon"===t.geometryType)this._isClosed=!0;else if("esriGeometryPolyline"===t.geometryType)this._isClosed=!1;else{if("esriGeometryEnvelope"!==t.geometryType){t=this._inputGeometries.next();continue}if(this._maxCosAngle)return t;this._isClosed=!0}for(;t.nextPath();)this._processPath(t);return t.reset(),t}return null}_processPath(t){if(t.nextPoint()){const e=t.x,i=t.y;let n=e,r=i,s=t.pathSize,o=0,a=0,l=0,c=0,u=0,h=0;this._isClosed&&++s;for(let d=1;t.nextPoint()||d<s;++d){let f,p;this._isClosed&&d===s-1?(f=e,p=i):(f=t.x,p=t.y);const _=f-n,m=p-r,g=Math.sqrt(_*_+m*m);d>1&&g>0&&l>0&&(o*_+a*m)/g/l<=this._maxCosAngle&&t.setControlPointAt(d-1),1===d&&(c=_,u=m,h=g),g>0&&(n=f,r=p,o=_,a=m,l=g)}this._isClosed&&l>0&&h>0&&(o*c+a*u)/h/l<=this._maxCosAngle&&t.setControlPointAt(0)}}}},82112:function(t,e,i){i.d(e,{B:function(){return u}});var n=i(33134),r=i(49077),s=i(23454),o=i(93996),a=i(33389);const l=1.7320508075688772,c=a.oF.OpenEnded;class u{static local(){return null===u.instance&&(u.instance=new u),u.instance}execute(t,e,i,n,r){return new h(t,e,i)}}u.instance=null;class h extends s.rx{constructor(t,e,i){super(t,!1,!0),this._curveHelper=new o.I,this._width=(void 0!==e.width?e.width:5)*i,this._arrowType=void 0!==e.geometricEffectArrowType?e.geometricEffectArrowType:void 0!==e.arrowType?e.arrowType:c,this._offsetFlattenError=o.U*i}processPath(t){const e=n.z.createEmptyOptimizedCIM(t.geometryType);switch(this._arrowType){case a.oF.OpenEnded:default:this._constructSimpleArrow(e,t,!0);break;case a.oF.Block:this._constructSimpleArrow(e,t,!1);break;case a.oF.Crossed:this._constructCrossedArrow(e,t)}return e}_constructSimpleArrow(t,e,i){const n=e.pathLength();let s=this._width;n<2*s&&(s=n/2);const o=this._curveHelper.getSubCurve(e,0,n-s);if(!o||!o.nextPath())return;o.seekPathStart();const a=s/2;if(this._curveHelper.isEmpty(o))return;const l=(0,r.A)(o),c=this._constructOffset(l,-a);if(!c)return;const u=this._constructOffset(l,a);if(!u)return;const h=this._constructArrowBasePoint(c,-a/2);if(!h)return;const d=this._constructArrowBasePoint(u,a/2);if(!d)return;e.seekInPath(e.pathSize-1);const f=[e.x,e.y];t.pushPath(u),t.nextPath(),t.nextPoint(),t.setControlPoint(),t.pushPoint(d),t.nextPoint(),t.setControlPoint(),t.pushPoint(f),t.nextPoint(),t.setControlPoint(),t.pushPoint(h),t.nextPoint(),t.setControlPoint(),t.pushPoints(c.reverse()),t.setControlPoint(),i||(t.setControlPointAt(0),t.setControlPointAt(t.pathSize-1),t.pushPoint(u[0])),t.reset()}_constructCrossedArrow(t,e){const i=e.pathLength();let n=this._width;i<n*(1+l+1)&&(n=i/(1+l+1)),e.seekPathStart();const s=this._curveHelper.getSubCurve(e,0,i-n*(1+l));if(!s)return;s.nextPath();const o=n/2;if(this._curveHelper.isEmpty(s))return;const a=(0,r.A)(s),c=this._constructOffset(a,o);if(!c)return;const u=this._constructOffset(a,-o);if(!u)return;const h=this._curveHelper.getSubCurve(e,0,i-n);if(!h)return;if(h.nextPath(),this._curveHelper.isEmpty(h))return;const d=(0,r.A)(h),f=this._constructOffset(d,o);if(!f)return;const p=this._constructOffset(d,-o);if(!p)return;const _=f[f.length-1],m=this._constructArrowBasePoint(f,o/2);if(!m)return;const g=p[p.length-1],y=this._constructArrowBasePoint(p,-o/2);if(!y)return;e.seekInPath(e.pathSize-1);const v=[e.x,e.y];t.pushPath(c),t.nextPath(),t.nextPoint(),t.setControlPoint(),t.pushPoint(g),t.nextPoint(),t.setControlPoint(),t.pushPoint(y),t.nextPoint(),t.setControlPoint(),t.pushPoint(v),t.nextPoint(),t.setControlPoint(),t.pushPoint(m),t.nextPoint(),t.setControlPoint(),t.pushPoint(_),t.nextPoint(),t.setControlPoint(),t.pushPoints(u.reverse()),t.nextPoint(),t.setControlPoint(),t.reset()}_constructOffset(t,e){return this._curveHelper.offset(t,e,a.xw.Rounded,4,this._offsetFlattenError)}_constructArrowBasePoint(t,e){if(!t||t.length<2)return null;const i=t[t.length-2],n=t[t.length-1],r=[n[0]-i[0],n[1]-i[1]];return this._curveHelper.normalize(r),[n[0]+r[1]*e,n[1]-r[0]*e]}}},20391:function(t,e,i){i.d(e,{s:function(){return c}}),i(50917);var n=i(33134),r=i(49077),s=i(62096),o=i(93996),a=i(33389),l=i(57165);class c{static local(){return null===c.instance&&(c.instance=new c),c.instance}execute(t,e,i,n,r,s){return new u(t,e,i,n,r,s)}}c.instance=null;class u{constructor(t,e,i,n,r,s){this._inputGeometries=t,this._tileKey=n,this._geometryEngine=r,this._curveHelper=new o.I,this._size=(void 0!==e.size?e.size:1)*i,this._maxInflateSize=s*i,this._offsetFlattenError=o.U*i}next(){let t;for(;t=this._inputGeometries.next();){if(0===this._size)return t;if("esriGeometryEnvelope"===t.geometryType)if(this._size>0){const e=n.z.createEmptyOptimizedCIM(t.geometryType),i=(0,r.x)(t)[0],s=this._curveHelper.offset(i,this._size,a.xw.Rounded,4,this._offsetFlattenError);if(s)return e.pushPath(s),e}else if(this._size<0){const e=t.asJSON();if(Math.min(e.xmax-e.xmin,e.ymax-e.ymin)+2*this._size>0)return n.z.fromJSONCIM({xmin:e.xmin-this._size,xmax:e.xmax+this._size,ymin:e.ymin-this._size,ymax:e.ymax+this._size})}const e=this._geometryEngine;if(null==e)return null;const i=this._tileKey?(0,s.q)(t,this._maxInflateSize):t;if(!i)continue;const o=e.buffer(l.A.WebMercator,i.asJSON(),this._size,1);return o?n.z.fromJSONCIM(o):null}return null}}},11672:function(t,e,i){i.d(e,{v:function(){return l}});var n=i(33134),r=i(49077),s=i(38441),o=i(23454),a=i(33389);class l{static local(){return null===l.instance&&(l.instance=new l),l.instance}execute(t,e,i,n,r){return new c(t,e,i)}}l.instance=null;class c{constructor(t,e,i){this._defaultPointSize=20,this._inputGeometries=t,this._geomUnitsPerPoint=i,this._rule=e.rule??a.uQ.FullGeometry,this._defaultSize=this._defaultPointSize*i}next(){let t;for(;t=this._inputGeometries.next();){const e=this._processGeom((0,r.x)(t));if(e?.length)return n.z.fromJSONCIM({paths:e})}return null}_clone(t){return[t[0],t[1]]}_mid(t,e){return[(t[0]+e[0])/2,(t[1]+e[1])/2]}_mix(t,e,i,n){return[t[0]*e+i[0]*n,t[1]*e+i[1]*n]}_add(t,e){return[t[0]+e[0],t[1]+e[1]]}_add2(t,e,i){return[t[0]+e,t[1]+i]}_sub(t,e){return[t[0]-e[0],t[1]-e[1]]}_dist(t,e){return Math.sqrt((t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1]))}_norm(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}_normalize(t,e=1){const i=e/this._norm(t);t[0]*=i,t[1]*=i}_leftPerpendicular(t){const e=-t[1],i=t[0];t[0]=e,t[1]=i}_leftPerp(t){return[-t[1],t[0]]}_rightPerpendicular(t){const e=t[1],i=-t[0];t[0]=e,t[1]=i}_rightPerp(t){return[t[1],-t[0]]}_dotProduct(t,e){return t[0]*e[0]+t[1]*e[1]}_crossProduct(t,e){return t[0]*e[1]-t[1]*e[0]}_rotateDirect(t,e,i){const n=t[0]*e-t[1]*i,r=t[0]*i+t[1]*e;t[0]=n,t[1]=r}_makeCtrlPt(t){const e=[t[0],t[1]];return(0,o.Aq)(e,1),e}_addAngledTicks(t,e,i,n){const r=this._sub(i,e);this._normalize(r);const s=this._crossProduct(r,this._sub(n,e));let o;o=s>0?this._rightPerp(r):this._leftPerp(r);const a=Math.abs(s)/2,l=[];l.push([e[0]+(o[0]-r[0])*a,e[1]+(o[1]-r[1])*a]),l.push(e),l.push(i),l.push([i[0]+(o[0]+r[0])*a,i[1]+(o[1]+r[1])*a]),t.push(l)}_addBezier2(t,e,i,n,r){if(0==r--)return void t.push(n);const s=this._mid(e,i),o=this._mid(i,n),a=this._mid(s,o);this._addBezier2(t,e,s,a,r),this._addBezier2(t,a,o,n,r)}_addBezier3(t,e,i,n,r,s){if(0==s--)return void t.push(r);const o=this._mid(e,i),a=this._mid(i,n),l=this._mid(n,r),c=this._mid(o,a),u=this._mid(a,l),h=this._mid(c,u);this._addBezier3(t,e,o,c,h,s),this._addBezier3(t,h,u,l,r,s)}_add90DegArc(t,e,i,n,r){const s=r??this._crossProduct(this._sub(i,e),this._sub(n,e))>0,o=this._mid(e,i),a=this._sub(o,e);s?this._leftPerpendicular(a):this._rightPerpendicular(a),o[0]+=a[0],o[1]+=a[1],this._addBezier3(t,e,this._mix(e,.33333,o,.66667),this._mix(i,.33333,o,.66667),i,4)}_addArrow(t,e,i){const n=e[0],r=e[1],s=e[e.length-1],o=this._sub(n,r),a=this._norm(o);this._normalize(o);const l=Math.abs(this._crossProduct(o,this._sub(s,r)));let c=this._dotProduct(o,this._sub(s,r));c<.05*a?c=.05*a:c>.95*a&&(c=.95*a);const u=.5*l,h=this._leftPerp(o),d=[r[0]+o[0]*c,r[1]+o[1]*c],f=e.length-1,p=[];p.push(i?[-h[0],-h[1]]:h);let _=[-o[0],-o[1]];for(let t=1;t<f-1;t++){const i=this._sub(e[t+1],e[t]);this._normalize(i);const n=this._dotProduct(i,_),r=this._crossProduct(i,_),s=Math.sqrt((1+n)/2),o=this._sub(i,_);this._normalize(o),o[0]/=s,o[1]/=s,p.push(r<0?[-o[0],-o[1]]:o),_=i}p.push(this._rightPerp(_));for(let i=p.length-1;i>0;i--)t.push([e[i][0]+p[i][0]*u,e[i][1]+p[i][1]*u]);t.push([d[0]+p[0][0]*u,d[1]+p[0][1]*u]),t.push([d[0]+p[0][0]*l,d[1]+p[0][1]*l]),t.push(n),t.push([d[0]-p[0][0]*l,d[1]-p[0][1]*l]),t.push([d[0]-p[0][0]*u,d[1]-p[0][1]*u]);for(let i=1;i<p.length;i++)t.push([e[i][0]-p[i][0]*u,e[i][1]-p[i][1]*u])}_addDash(t,e,i){const n=this._norm(i)/7;this._normalize(i);let r=[];for(let s=0;s<=7;s++)r.push([e[0]+i[0]*s*n,e[1]+i[1]*s*n]),1&s&&(t.push(r),r=[])}_cp2(t,e,i){return t.length>=2?t[1]:this._add2(t[0],e*this._defaultSize,i*this._defaultSize)}_cp3(t,e,i,n){if(t.length>=3)return t[2];const r=this._mix(t[0],1-i,e,i),s=this._sub(e,t[0]);return this._normalize(s),this._rightPerpendicular(s),[r[0]+s[0]*n*this._defaultSize,r[1]+s[1]*n*this._defaultSize]}_arrowPath(t){if(t.length>2)return t;const e=t[0],i=this._cp2(t,-4,0),n=this._sub(e,i);this._normalize(n);const r=this._rightPerp(n);return[e,i,[e[0]+(r[0]-n[0])*this._defaultSize,e[1]+(r[1]-n[1])*this._defaultSize]]}_arrowLastSeg(t){const e=t[0],i=this._cp2(t,-4,0);let n;if(t.length>=3)n=t[t.length-1];else{const t=this._sub(e,i);this._normalize(t);const r=this._rightPerp(t);n=[e[0]+(r[0]-t[0])*this._defaultSize,e[1]+(r[1]-t[1])*this._defaultSize]}return[i,n]}_processGeom(t){if(!t)return null;const e=[];for(const i of t){const t=i.length>1&&(0,s.Yl)(i)<this._defaultSize;if(!i||0===i.length||t)continue;const n=i.length;let r=i[0];switch(this._rule){case a.uQ.PerpendicularFromFirstSegment:{const t=this._cp2(i,0,-1),n=this._cp3(i,t,.5,4),s=[];s.push(n),s.push(this._mid(r,t)),e.push(s);break}case a.uQ.ReversedFirstSegment:{const t=this._cp2(i,0,-1);e.push([t,r]);break}case a.uQ.PerpendicularToSecondSegment:{if(i.length<3)return[];const t=this._cp2(i,-4,1),n=this._cp3(i,t,.882353,-1.94),s=[];s.push(this._mid(t,n)),s.push(r),e.push(s);break}case a.uQ.SecondSegmentWithTicks:{if(i.length<3)return[];const t=this._cp2(i,-4,1),n=this._cp3(i,t,.882353,-1.94),s=this._sub(n,t);let o;o=this._crossProduct(s,this._sub(r,t))>0?this._rightPerp(s):this._leftPerp(s);const a=[];a.push([t[0]+(o[0]-s[0])/3,t[1]+(o[1]-s[1])/3]),a.push(t),a.push(n),a.push([n[0]+(o[0]+s[0])/3,n[1]+(o[1]+s[1])/3]),e.push(a);break}case a.uQ.DoublePerpendicular:{const t=this._cp2(i,0,-1),n=this._cp3(i,t,.5,3),s=this._mid(r,t),o=this._sub(s,n);this._normalize(o);const a=this._crossProduct(o,this._sub(r,n));this._leftPerpendicular(o);const l=[];l.push(r),l.push([n[0]+o[0]*a,n[1]+o[1]*a]),e.push(l);const c=[];c.push([n[0]-o[0]*a,n[1]-o[1]*a]),c.push(t),e.push(c);break}case a.uQ.OppositeToFirstSegment:{const t=this._cp2(i,0,-1),n=this._cp3(i,t,.5,3),s=this._mid(r,t),o=this._sub(s,n);this._normalize(o);const a=this._crossProduct(o,this._sub(r,n));this._leftPerpendicular(o);const l=[];l.push([n[0]+o[0]*a,n[1]+o[1]*a]),l.push([n[0]-o[0]*a,n[1]-o[1]*a]),e.push(l);break}case a.uQ.TriplePerpendicular:{const t=this._cp2(i,0,-1),n=this._cp3(i,t,.5,4),s=this._mid(r,t),o=this._sub(s,n);this._normalize(o);const a=this._crossProduct(o,this._sub(r,n));this._leftPerpendicular(o);const l=[];l.push([n[0]+o[0]*a*.8,n[1]+o[1]*a*.8]),l.push([s[0]+.8*(r[0]-s[0]),s[1]+.8*(r[1]-s[1])]),e.push(l),e.push([n,s]);const c=[];c.push([n[0]-o[0]*a*.8,n[1]-o[1]*a*.8]),c.push([s[0]+.8*(t[0]-s[0]),s[1]+.8*(t[1]-s[1])]),e.push(c);break}case a.uQ.HalfCircleFirstSegment:{const t=this._cp2(i,0,-1),n=this._cp3(i,t,.5,4),s=this._mid(r,t);let o=this._sub(t,r);const a=Math.cos(Math.PI/18),l=Math.sin(Math.PI/18),c=Math.sqrt((1+a)/2),u=Math.sqrt((1-a)/2),h=[];let d;this._crossProduct(o,this._sub(n,r))>0?(h.push(r),o=this._sub(r,s),d=t):(h.push(t),o=this._sub(t,s),d=r),this._rotateDirect(o,c,u),o[0]/=c,o[1]/=c;for(let t=1;t<=18;t++)h.push(this._add(s,o)),this._rotateDirect(o,a,l);h.push(d),e.push(h);break}case a.uQ.HalfCircleSecondSegment:{const t=this._cp2(i,0,-1),n=this._cp3(i,t,1,-1);let s=this._sub(r,t);this._normalize(s);const o=this._crossProduct(s,this._sub(n,t))/2;this._leftPerpendicular(s);const a=[t[0]+s[0]*o,t[1]+s[1]*o];s=this._sub(t,a);const l=Math.cos(Math.PI/18);let c=Math.sin(Math.PI/18);o>0&&(c=-c);const u=[t];for(let t=1;t<=18;t++)this._rotateDirect(s,l,c),u.push(this._add(a,s));e.push(u);break}case a.uQ.HalfCircleExtended:{const t=this._cp2(i,0,-2),s=this._cp3(i,t,1,-1);let o;if(n>=4)o=i[3];else{const e=this._sub(r,t);o=this._add(s,e)}const a=this._dist(t,s)/2/.75,l=this._sub(t,r);this._normalize(l,a);const c=this._sub(s,o);this._normalize(c,a);const u=[o,s];e.push(u);const h=[this._clone(s)];this._addBezier3(h,s,this._add(s,c),this._add(t,l),t,4),h.push(r),e.push(h);break}case a.uQ.OpenCircle:{const t=this._cp2(i,-2,0),n=this._sub(t,r),s=Math.cos(Math.PI/18),o=-Math.sin(Math.PI/18),a=[t];for(let t=1;t<=33;t++)this._rotateDirect(n,s,o),a.push(this._add(r,n));e.push(a);break}case a.uQ.CoverageEdgesWithTicks:{const t=this._cp2(i,0,-1);let s,o;if(n>=3)s=i[2];else{const e=this._sub(t,r),i=this._leftPerp(e);s=[r[0]+i[0]-.25*e[0],r[1]+i[1]-.25*e[1]]}if(n>=4)o=i[3];else{const e=this._mid(r,t),i=this._sub(r,t);this._normalize(i),this._leftPerpendicular(i);const n=this._crossProduct(i,this._sub(s,e));this._rightPerpendicular(i),o=[s[0]+i[0]*n*2,s[1]+i[1]*n*2]}const a=this._sub(t,r);let l,c;l=this._crossProduct(a,this._sub(s,r))>0?this._rightPerp(a):this._leftPerp(a),c=[],c.push(s),c.push(r),c.push([r[0]+(l[0]-a[0])/3,r[1]+(l[1]-a[1])/3]),e.push(c),l=this._crossProduct(a,this._sub(o,t))>0?this._rightPerp(a):this._leftPerp(a),c=[],c.push([t[0]+(l[0]+a[0])/3,t[1]+(l[1]+a[1])/3]),c.push(t),c.push(o),e.push(c);break}case a.uQ.GapExtentWithDoubleTicks:{const t=this._cp2(i,0,2),s=this._cp3(i,t,0,1);let o;if(n>=4)o=i[3];else{const e=this._sub(t,r);o=this._add(s,e)}this._addAngledTicks(e,r,t,this._mid(s,o)),this._addAngledTicks(e,s,o,this._mid(r,t));break}case a.uQ.GapExtentMidline:{const t=this._cp2(i,2,0),s=this._cp3(i,t,0,1);let o;if(n>=4)o=i[3];else{const e=this._sub(t,r);o=this._add(s,e)}const a=[];a.push(this._mid(r,s)),a.push(this._mid(t,o)),e.push(a);break}case a.uQ.Chevron:{const t=this._cp2(i,-1,-1);let s;if(n>=3)s=i[2];else{const e=this._sub(t,r);this._leftPerpendicular(e),s=this._add(r,e)}e.push([t,this._makeCtrlPt(r),s]);break}case a.uQ.PerpendicularWithArc:{const t=this._cp2(i,0,-2),s=this._cp3(i,t,.5,-1),o=this._sub(t,r),a=this._norm(o);o[0]/=a,o[1]/=a;const l=this._crossProduct(o,this._sub(s,r));let c=this._dotProduct(o,this._sub(s,r));c<.05*a?c=.05*a:c>.95*a&&(c=.95*a);const u=[r[0]+o[0]*c,r[1]+o[1]*c];let h=this._leftPerp(o),d=[];if(d.push([u[0]-h[0]*l,u[1]-h[1]*l]),d.push([u[0]+h[0]*l,u[1]+h[1]*l]),e.push(d),n>=4){const t=i[3];let n=this._dotProduct(o,this._sub(t,r));n<.1*a?n=.1*a:n>.9*a&&(n=.9*a);const s=[r[0]+o[0]*n,r[1]+o[1]*n],l=this._crossProduct(o,this._sub(t,r)),c=[];c.push([s[0]-h[0]*l,s[1]-h[1]*l]),c.push([s[0]+h[0]*l,s[1]+h[1]*l]),e.push(c)}const f=[t[0]+h[0]*l,t[1]+h[1]*l];h=this._sub(t,f);const p=Math.cos(Math.PI/18);let _=Math.sin(Math.PI/18);l<0&&(_=-_),d=[r,t];for(let t=1;t<=9;t++)this._rotateDirect(h,p,_),d.push(this._add(f,h));e.push(d);break}case a.uQ.ClosedHalfCircle:{const t=this._cp2(i,2,0),n=this._mid(r,t),s=this._sub(t,n),o=Math.cos(Math.PI/18),a=Math.sin(Math.PI/18),l=[r,t];for(let t=1;t<=18;t++)this._rotateDirect(s,o,a),l.push(this._add(n,s));e.push(l);break}case a.uQ.TripleParallelExtended:{const t=this._cp2(i,0,-2),n=this._cp3(i,t,1,-2),s=this._mid(r,t),a=this._sub(n,t);this._normalize(a);const l=Math.abs(this._crossProduct(a,this._sub(s,t)))/2,c=this._dist(t,n),u=[t,r];u.push([r[0]+a[0]*c*.5,r[1]+a[1]*c*.5]),e.push(u);const h=[];h.push([s[0]-a[0]*l,s[1]-a[1]*l]),h.push([s[0]+a[0]*c*.375,s[1]+a[1]*c*.375]),(0,o.Aq)(h[h.length-1],1),h.push([s[0]+a[0]*c*.75,s[1]+a[1]*c*.75]),e.push(h);const d=[t,n];e.push(d);break}case a.uQ.ParallelWithTicks:{const t=this._cp2(i,3,0),n=this._cp3(i,t,.5,-1),s=this._sub(n,t);this._normalize(s);const o=this._crossProduct(s,this._sub(n,r));this._leftPerpendicular(s),this._addAngledTicks(e,r,t,n),this._addAngledTicks(e,this._mix(r,1,s,o),this._mix(t,1,s,o),this._mid(r,t));break}case a.uQ.Parallel:{const t=this._cp2(i,3,0),n=this._cp3(i,t,.5,-1),s=this._sub(t,r);this._normalize(s);const o=this._leftPerp(s),a=this._crossProduct(s,this._sub(n,r));let l=[r,t];e.push(l),l=[],l.push([r[0]+o[0]*a,r[1]+o[1]*a]),l.push([t[0]+o[0]*a,t[1]+o[1]*a]),e.push(l);break}case a.uQ.PerpendicularToFirstSegment:{const t=this._cp2(i,3,0),n=this._cp3(i,t,.5,-1),s=this._mid(r,t),o=this._sub(t,r);this._normalize(o);const a=this._crossProduct(o,this._sub(n,r));this._leftPerpendicular(o);const l=[];l.push([s[0]-o[0]*a*.25,s[1]-o[1]*a*.25]),l.push([s[0]+o[0]*a*1.25,s[1]+o[1]*a*1.25]),e.push(l);break}case a.uQ.ParallelOffset:{const t=this._cp2(i,3,0),n=this._cp3(i,t,.5,-1),s=this._sub(t,r);this._normalize(s);const o=this._crossProduct(s,this._sub(n,r));this._leftPerpendicular(s);const a=[];a.push([r[0]-s[0]*o,r[1]-s[1]*o]),a.push([t[0]-s[0]*o,t[1]-s[1]*o]),e.push(a);const l=[];l.push([r[0]+s[0]*o,r[1]+s[1]*o]),l.push([t[0]+s[0]*o,t[1]+s[1]*o]),e.push(l);break}case a.uQ.OffsetOpposite:{const t=this._cp2(i,3,0),n=this._cp3(i,t,.5,-1),s=this._sub(t,r);this._normalize(s);const o=this._crossProduct(s,this._sub(n,r));this._leftPerpendicular(s);const a=[];a.push([r[0]-s[0]*o,r[1]-s[1]*o]),a.push([t[0]-s[0]*o,t[1]-s[1]*o]),e.push(a);break}case a.uQ.OffsetSame:{const t=this._cp2(i,3,0),n=this._cp3(i,t,.5,-1),s=this._sub(t,r);this._normalize(s);const o=this._crossProduct(s,this._sub(n,r));this._leftPerpendicular(s);const a=[];a.push([r[0]+s[0]*o,r[1]+s[1]*o]),a.push([t[0]+s[0]*o,t[1]+s[1]*o]),e.push(a);break}case a.uQ.CircleWithArc:{let t=this._cp2(i,3,0);const s=this._cp3(i,t,.5,-1);let a,l;if(n>=4)a=i[3],l=this._crossProduct(this._sub(a,t),this._sub(s,t))>0;else{a=t,l=this._crossProduct(this._sub(a,r),this._sub(s,r))>0;const e=24*this._geomUnitsPerPoint,i=this._sub(a,r);this._normalize(i,e);const n=Math.sqrt(2)/2;this._rotateDirect(i,n,l?n:-n),t=this._add(r,i)}const c=this._sub(t,r),u=Math.cos(Math.PI/18),h=Math.sin(Math.PI/18),d=[t];for(let t=1;t<=36;t++)this._rotateDirect(c,u,h),d.push(this._add(r,c));this._add90DegArc(d,t,a,s,l),(0,o.Aq)(d[d.length-8],1),e.push(d);break}case a.uQ.DoubleJog:{let t,s=this._cp2(i,-3,1),o=this._cp3(i,s,-1,-.5);if(n>=4)t=i[3];else{const e=r;r=s,t=o;const i=this._dist(r,e),n=this._dist(t,e);let a=30*this._geomUnitsPerPoint;.5*i<a&&(a=.5*i),.5*n<a&&(a=.5*n),s=this._mix(r,a/i,e,(i-a)/i),o=this._mix(t,a/n,e,(n-a)/n)}const a=this._mid(r,s),l=this._mid(t,o),c=this._dist(r,s),u=this._dist(o,t);let h=Math.min(c,u)/8;h=Math.min(h,24*this._geomUnitsPerPoint);const d=Math.cos(Math.PI/4);let f=this._sub(r,s);this._normalize(f,h),this._crossProduct(f,this._sub(t,s))>0?this._rotateDirect(f,d,-d):this._rotateDirect(f,d,d);let p=[];p.push(s),p.push(this._add(a,f)),p.push(this._sub(a,f)),p.push(r),e.push(p),f=this._sub(t,o),this._normalize(f,h),this._crossProduct(f,this._sub(r,o))<0?this._rotateDirect(f,d,d):this._rotateDirect(f,d,-d),p=[],p.push(o),p.push(this._add(l,f)),p.push(this._sub(l,f)),p.push(t),e.push(p);break}case a.uQ.PerpendicularOffset:{const t=this._cp2(i,-4,1),n=this._cp3(i,t,.882353,-1.94),s=this._sub(n,t);this._crossProduct(s,this._sub(r,t))>0?this._rightPerpendicular(s):this._leftPerpendicular(s);const o=[s[0]/8,s[1]/8],a=this._sub(this._mid(t,n),o);e.push([a,r]);break}case a.uQ.LineExcludingLastSegment:{const t=this._arrowPath(i),n=[];let r=t.length-2;for(;r--;)n.push(t[r]);e.push(n);break}case a.uQ.MultivertexArrow:{const t=this._arrowPath(i),n=[];this._addArrow(n,t,!1),e.push(n);break}case a.uQ.CrossedArrow:{const t=this._arrowPath(i),n=[];this._addArrow(n,t,!0),e.push(n);break}case a.uQ.ChevronArrow:{const[t,n]=this._arrowLastSeg(i),s=10*this._geomUnitsPerPoint,o=this._sub(r,t),a=this._norm(o);this._normalize(o);const l=this._crossProduct(o,this._sub(n,t));let c=this._dotProduct(o,this._sub(n,t));c<.05*a?c=.05*a:c>.95*a-s&&(c=.95*a-s);const u=[t[0]+o[0]*c,t[1]+o[1]*c],h=this._leftPerp(o),d=[];d.push([u[0]+h[0]*l+o[0]*s,u[1]+h[1]*l+o[1]*s]),d.push(r),d.push([u[0]-h[0]*l+o[0]*s,u[1]-h[1]*l+o[1]*s]),e.push(d);break}case a.uQ.ChevronArrowOffset:{const[t,n]=this._arrowLastSeg(i),s=this._sub(r,t),o=this._norm(s);this._normalize(s);const a=this._crossProduct(s,this._sub(n,t));let l=this._dotProduct(s,this._sub(n,t));l<.05*o?l=.05*o:l>.95*o&&(l=.95*o);const c=[t[0]+s[0]*l,t[1]+s[1]*l];this._leftPerpendicular(s);const u=[];u.push([c[0]+s[0]*a*.5,c[1]+s[1]*a*.5]),u.push(this._mid(c,r)),u.push([c[0]-s[0]*a*.5,c[1]-s[1]*a*.5]),e.push(u);break}case a.uQ.PartialFirstSegment:{const[t,n]=this._arrowLastSeg(i),s=this._sub(r,t),o=this._norm(s);this._normalize(s);let a=this._dotProduct(s,this._sub(n,t));a<.05*o?a=.05*o:a>.95*o&&(a=.95*o);const l=[t[0]+s[0]*a,t[1]+s[1]*a];e.push([t,l]);break}case a.uQ.Arch:{const t=this._cp2(i,0,-1),n=this._cp3(i,t,.5,1),s=this._sub(r,t),o=this._mix(n,1,s,.55),a=this._mix(n,1,s,-.55),l=[r];this._addBezier2(l,r,o,n,4),this._addBezier2(l,n,a,t,4),e.push(l);break}case a.uQ.CurvedParallelTicks:{const t=this._cp2(i,-4,1),n=this._cp3(i,t,.882353,-1.94),s=this._sub(n,t);this._crossProduct(s,this._sub(r,t))>0?this._rightPerpendicular(s):this._leftPerpendicular(s);const o=[s[0]/8,s[1]/8],a=this._sub(this._mid(t,n),o),l=this._sub(this._mix(t,.75,n,.25),o),c=this._sub(this._mix(t,.25,n,.75),o),u=[t];this._addBezier2(u,t,l,a,3),this._addBezier2(u,a,c,n,3),e.push(u);for(let t=0;t<8;t++){const i=u[2*t+1],n=[this._clone(i)];n.push(this._add(i,[s[0]/4,s[1]/4])),e.push(n)}break}case a.uQ.Arc90Degrees:{const t=this._cp2(i,0,-1),n=this._cp3(i,t,.5,1),s=[t];this._add90DegArc(s,t,r,n),e.push(s);break}case a.uQ.TipWithPerpendicularAndTicks:{const[t,n]=this._arrowLastSeg(i),s=10*this._geomUnitsPerPoint,o=this._sub(r,t),a=this._norm(o);this._normalize(o);let l=this._crossProduct(o,this._sub(n,t)),c=this._dotProduct(o,this._sub(n,t));c<.05*a?c=.05*a:c>.95*a-s&&(c=.95*a-s);const u=this._leftPerp(o),h=[r[0]-o[0]*s,r[1]-o[1]*s],d=.5*Math.max(a-c-s,s);l=Math.abs(l);const f=[];f.push([h[0]+u[0]*(l+d)-o[0]*d,h[1]+u[1]*(l+d)-o[1]*d]),f.push([h[0]+u[0]*l,h[1]+u[1]*l]),f.push([h[0]-u[0]*l,h[1]-u[1]*l]),f.push([h[0]-u[0]*(l+d)-o[0]*d,h[1]-u[1]*(l+d)-o[1]*d]),e.push(f),e.push([h,r]);break}case a.uQ.ConcentricCircles:{const t=this._cp2(i,1,0),s=this._cp3(i,t,2,0),a=Math.cos(Math.PI/18),l=Math.sin(Math.PI/18);let c=this._dist(t,r),u=[c,0],h=[];for(let t=0;t<=36;t++)h.push(this._add(r,u)),this._rotateDirect(u,a,l);if(e.push(h),n>=4){h=[];const t=i[3];c=this._dist(t,r),u=[c,0];for(let t=0;t<=36;t++)h.push(this._add(r,u)),0===t&&(h.push(this._add(r,u)),(0,o.Aq)(h[1],1)),this._rotateDirect(u,a,l);e.push(h)}h=[],c=this._dist(s,r),u=[c,0];for(let t=0;t<=36;t++)h.push(this._add(r,u)),this._rotateDirect(u,a,l);e.push(h);break}case a.uQ.DoubleJogArrow:{r=this._arrowPath(i)[0];const[t,n]=this._arrowLastSeg(i),s=this._sub(r,t),o=this._norm(s);this._normalize(s);const a=Math.abs(this._crossProduct(s,this._sub(n,r)));let l=Math.abs(this._dotProduct(s,this._sub(n,r)));l<.05*o?l=.05*o:l>.95*o&&(l=.95*o);const c=Math.max(a,l),u=this._leftPerp(s);let h=[];const d=[r[0]-s[0]*l*.5+u[0]*a*.5,r[1]-s[1]*l*.5+u[1]*a*.5];h.push([d[0],d[1]]),d[0]+=s[0]*c*.5+u[0]*c*.4,d[1]+=s[1]*c*.5+u[1]*c*.4,h.push([d[0],d[1]]),d[0]-=u[0]*c*.25,d[1]-=u[1]*c*.25,h.push([d[0],d[1]]),d[0]+=s[0]*c*.5+u[0]*c*.4,d[1]+=s[1]*c*.5+u[1]*c*.4,h.push([d[0],d[1]]),e.push(h),h=[],d[0]=r[0]-s[0]*l*.5-u[0]*a*.5,d[1]=r[1]-s[1]*l*.5-u[1]*a*.5,h.push([d[0],d[1]]),d[0]+=s[0]*c*.5-u[0]*c*.4,d[1]+=s[1]*c*.5-u[1]*c*.4,h.push([d[0],d[1]]),d[0]+=u[0]*c*.25,d[1]+=u[1]*c*.25,h.push([d[0],d[1]]),d[0]+=s[0]*c*.5-u[0]*c*.4,d[1]+=s[1]*c*.5-u[1]*c*.4,h.push([d[0],d[1]]),e.push(h);break}case a.uQ.LinkedChevrons:{const t=this._cp2(i,-5,0),n=this._cp3(i,t,-.2,1),s=this._sub(r,t);this._normalize(s);const o=this._leftPerp(s),a=Math.abs(this._crossProduct(s,this._sub(n,t)));e.push([t,r]);const l=[];l.push([r[0]-s[0]*a+o[0]*a,r[1]-s[1]*a+o[1]*a]),l.push(r),l.push([r[0]-s[0]*a-o[0]*a,r[1]-s[1]*a-o[1]*a]),e.push(l),this._addDash(e,t,[-s[0]*a+o[0]*a,-s[1]*a+o[1]*a]),this._addDash(e,t,[-s[0]*a-o[0]*a,-s[1]*a-o[1]*a]);break}case a.uQ.SegmentThenHalfCircle:{const t=this._cp2(i,2,0),s=this._cp3(i,t,1.5,0);let o;o=n>=4?i[3]:this._cp3(i,t,1.25,-.5);const a=this._sub(t,r);this._normalize(a);const l=.5*this._dist(t,s),c=this._crossProduct(a,this._sub(o,r))>0,u=Math.cos(Math.PI/18);let h=Math.sin(Math.PI/18);c&&(h=-h);const d=[r,t];a[0]*=l,a[1]*=l;const f=this._add(t,a);a[0]=-a[0],a[1]=-a[1];for(let t=1;t<=18;t++)this._rotateDirect(a,u,h),d.push(this._add(f,a));e.push(d);break}case a.uQ.LineWithStraightTicks:{const t=this._cp2(i,-2,1),n=this._cp3(i,t,-1,-.5),s=this._sub(n,t);this._normalize(s);const o=this._dotProduct(s,this._sub(t,r)),a=this._dotProduct(s,this._sub(n,r));let l=[r];l.push([r[0]+s[0]*o,r[1]+s[1]*o]),l.push(t),e.push(l),l=[r],l.push([r[0]+s[0]*a,r[1]+s[1]*a]),l.push(n),e.push(l);break}case a.uQ.DoubleCurve:{const t=this._cp2(i,-5,-1),n=this._cp3(i,t,2,0),s=Math.atan2(1,5),a=Math.cos(s),l=Math.sin(s),c=this._sub(t,r),u=this._dist(r,t);this._normalize(c),this._rotateDirect(c,a,-l);const h=[r];h.push([r[0]+c[0]*u*.5,r[1]+c[1]*u*.5]),(0,o.Aq)(h[1],1),h.push([r[0]+c[0]*u*.8,r[1]+c[1]*u*.8]),this._addBezier2(h,h[2],[r[0]+c[0]*u,r[1]+c[1]*u],t,3);const d=this._sub(n,t),f=this._dist(t,n);this._normalize(d),this._rotateDirect(d,a,-l),this._addBezier2(h,t,[n[0]-d[0]*f,n[1]-d[1]*f],[n[0]-d[0]*f*.8,n[1]-d[1]*f*.8],3),h.push(n),e.push(h);break}case a.uQ.ParallelWithTicksByWidth:{const t=this._cp2(i,0,-1),n=this._cp3(i,t,.5,3),s=this._sub(t,r);this._normalize(s);const o=this._crossProduct(s,this._sub(n,r));this._leftPerpendicular(s),o>0?(this._addAngledTicks(e,r,[r[0]+s[0]*o,r[1]+s[1]*o],t),this._addAngledTicks(e,t,[t[0]+s[0]*o,t[1]+s[1]*o],r)):(this._addAngledTicks(e,[r[0]+s[0]*o,r[1]+s[1]*o],r,t),this._addAngledTicks(e,[t[0]+s[0]*o,t[1]+s[1]*o],r,t));break}case a.uQ.EnclosingRoundedRectangle:{const t=this._cp2(i,3,-2),e=[Math.min(r[0],t[0]),Math.max(r[1],t[1])],n=[Math.max(r[0],t[0]),Math.min(r[1],t[1])],s=n[0]-e[0],o=e[1]-n[1],a=Math.min(s,o)/10,l=[];l.push([e[0]+a+.75*(s-2*a),e[1]]),l.push([n[0]-a,e[1]]),this._add90DegArc(l,[n[0]-a,e[1]],[n[0],e[1]-a],[n[0],e[1]]),l.push([n[0],n[1]+a]),this._add90DegArc(l,[n[0],n[1]+a],[n[0]-a,n[1]],n),l.push([e[0]+a,n[1]]),this._add90DegArc(l,[e[0]+a,n[1]],[e[0],n[1]+a],[e[0],n[1]]),l.push([e[0],e[1]-a]),this._add90DegArc(l,[e[0],e[1]-a],[e[0]+a,e[1]],e),l.push([e[0]+a+.75*(s-2*a),e[1]]);break}case a.uQ.FullGeometry:default:e.push(i)}}return e}}},12281:function(t,e,i){i.d(e,{y:function(){return o}});var n=i(33134),r=i(23454),s=i(93996);class o{static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(t,e,i,n,r){return new a(t,e,i)}}o.instance=null;class a extends r.rx{constructor(t,e,i){super(t,!0,!0),this._curveHelper=new s.I,this._beginCut=(void 0!==e.beginCut?e.beginCut:1)*i,this._endCut=(void 0!==e.endCut?e.endCut:1)*i,this._middleCut=(void 0!==e.middleCut?e.middleCut:0)*i,this._invert=void 0!==e.invert&&e.invert,this._beginCut<0&&(this._beginCut=0),this._endCut<0&&(this._endCut=0),this._middleCut<0&&(this._middleCut=0)}processPath(t){const{_beginCut:e,_endCut:i,_middleCut:r}=this,s=t.pathLength(),o=n.z.createEmptyOptimizedCIM("esriGeometryPolyline");if(this._invert){if(0!==e||0!==i||0!==r)if(e+i+r>=s)for(o.startPath();t.nextPoint();)o.pushXY(t.x,t.y);else this._curveHelper.appendSubCurve(o,t,0,e),this._curveHelper.appendSubCurve(o,t,.5*(s-r),.5*(s+r)),this._curveHelper.appendSubCurve(o,t,s-i,i)}else if(0===e&&0===i&&0===r)for(o.startPath();t.nextPoint();)o.pushXY(t.x,t.y);else e+i+r<s&&(0===r?this._curveHelper.appendSubCurve(o,t,e,s-i):(this._curveHelper.appendSubCurve(o,t,e,.5*(s-r)),this._curveHelper.appendSubCurve(o,t,.5*(s+r),s-i)));return 0===o.totalSize?null:o}}},2969:function(t,e,i){i.d(e,{I:function(){return c}});var n=i(33134),r=i(49077),s=i(23454),o=i(33389),a=i(65661),l=i(7590);class c{static local(){return null===c.instance&&(c.instance=new c),c.instance}execute(t,e,i,n,r){return new u(t,e,i)}}c.instance=null;class u extends s.rx{constructor(t,e,i){super(t,!0,!0),this._firstCurve=null,this._walker=new a.Z1,this._walker.updateTolerance(i),this._endings=e.lineDashEnding,this._customDashPos=-(e.offsetAlongLine??0)*i,this._offsetAtEnd=(e.customEndingOffset??0)*i;let n=(0,l.FH)(e).dashTemplate;null==n&&(n=[]),n.length%2&&(n=[...n,...n]),this._pattern=new a.VA,this._pattern.init(n,!0),this._pattern.scale(i)}processPath(t){if(0===this._pattern.length()){this.iteratePath=!1;const e=(0,r.A)(t);return n.z.fromJSONCIM({paths:[e]})}if(!this.iteratePath){let e=!0;switch(this._endings){case o.yS.HalfPattern:case o.yS.HalfGap:default:this._pattern.extPtGap=0;break;case o.yS.FullPattern:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.firstValue());break;case o.yS.FullGap:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.lastValue());break;case o.yS.NoConstraint:this.isClosed||(e=!1);break;case o.yS.Custom:this.isClosed||(this._pattern.extPtGap=.5*this._offsetAtEnd)}const i=t.pathLength();if(this._pattern.isEmpty()||i<.1*this._pattern.length()){const e=(0,r.A)(t);return n.z.fromJSONCIM({paths:[e]})}if(!this._walker.init(t,this._pattern,e)){const e=(0,r.A)(t);return n.z.fromJSONCIM({paths:[e]})}}let e;if(this.iteratePath)e=this._pattern.nextValue();else{let t;switch(this._endings){case o.yS.HalfPattern:default:t=.5*this._pattern.firstValue();break;case o.yS.HalfGap:t=.5*-this._pattern.lastValue();break;case o.yS.FullGap:t=-this._pattern.lastValue();break;case o.yS.FullPattern:t=0;break;case o.yS.NoConstraint:case o.yS.Custom:t=-this._customDashPos}let i=t/this._pattern.length();i-=Math.floor(i),t=i*this._pattern.length(),this._pattern.reset(),e=this._pattern.nextValue();let n=!1;for(;t>=e;)t-=e,e=this._pattern.nextValue(),n=!n;e-=t,n?(this._walker.nextPosition(e),e=this._pattern.nextValue()):this.isClosed&&(this._firstCurve=this._walker.nextCurve(e),e=this._pattern.nextValue(),this._walker.nextPosition(e),e=this._pattern.nextValue())}let i=this._walker.nextCurve(e);if(i)if(this._walker.isPathEnd()){if(this.iteratePath=!1,this._firstCurve){for(this._firstCurve.nextPath();this._firstCurve.nextPoint();)i.pushXY(this._firstCurve.x,this._firstCurve.y);this._firstCurve=null}}else e=this._pattern.nextValue(),!this._walker.nextPosition(e)||this._walker.isPathEnd()?(this.iteratePath=!1,this._firstCurve&&(i.pushCursor(this._firstCurve),this._firstCurve=null)):this.iteratePath=!0;else this.iteratePath=!1,i=this._firstCurve,this._firstCurve=null;return i?.reset(),i}}},7889:function(t,e,i){i.d(e,{O:function(){return a}}),i(50917);var n=i(33134),r=i(62096),s=i(33389),o=i(57165);class a{static local(){return null===a.instance&&(a.instance=new a),a.instance}execute(t,e,i,n,r,s){return new l(t,e,i,n,r,s)}}a.instance=null;class l{constructor(t,e,i,n,r,o){switch(this._inputGeometries=t,this._tileKey=n,this._geometryEngine=r,this._maxInflateSize=o*i,this._width=(void 0!==e.width?e.width:2)*i,e.method){case s.M1.Mitered:case s.M1.Bevelled:case s.M1.Rounded:case s.M1.TrueBuffer:case s.M1.Square:}this._option=e.option}next(){let t;for(;t=this._inputGeometries.next();){if("esriGeometryEnvelope"===t.geometryType&&this._width>0){const e=t.asJSON();return Math.min(e.xmax-e.xmin,e.ymax-e.ymin)-2*this._width<0?t:n.z.fromJSONCIM({paths:[[[e.xmin+this._width,e.ymin+this._width],[e.xmax-this._width,e.ymin+this._width],[e.xmax-this._width,e.ymax-this._width],[e.xmin+this._width,e.ymax-this._width],[e.xmin+this._width,e.ymin+this._width]],[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]})}if("esriGeometryPolygon"===t.geometryType){if(0===this._width)return t.clone();const e=this._geometryEngine;if(null==e)return null;const i=this._tileKey?(0,r.q)(t,this._maxInflateSize):t.clone();if(!i)continue;const n=e.buffer(o.A.WebMercator,i.asJSON(),-this._width,1);if(n)for(const t of n.rings)if(t){i.startPath();for(const e of t.reverse())i.pushXY(e[0],i.yFactor*e[1])}return i}}return null}}},48645:function(t,e,i){i.d(e,{U:function(){return o}});var n=i(33134),r=i(23454),s=i(93996);class o{static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(t,e,i,n,r){return new a(t,e,i)}}o.instance=null;class a extends r.rx{constructor(t,e,i){super(t,!1,!0),this._curveHelper=new s.I,this._length=(void 0!==e.length?e.length:20)*i,this._angle=void 0!==e.angle?e.angle:225,this._position=void 0!==e.position?e.position:50,this._length<0&&(this._length=-this._length),this._position<20&&(this._position=20),this._position>80&&(this._position=80),this._mirror=!1}processPath(t){const e=n.z.createEmptyOptimizedCIM("esriGeometryPolyline");if(this._curveHelper.isEmpty(t))return null;t.seekInPath(0);const i=t.x,r=t.y;t.seekInPath(t.pathSize-1);const s=t.x,o=t.y,a=[s-i,o-r];this._curveHelper.normalize(a);const l=i+(s-i)*this._position/100,c=r+(o-r)*this._position/100,u=Math.cos((90-this._angle)/180*Math.PI);let h=Math.sin((90-this._angle)/180*Math.PI);this._mirror&&(h=-h),this._mirror=!this._mirror;const d=[l-this._length/2*u,c-this._length/2*h],f=[l+this._length/2*u,c+this._length/2*h];return e.pushPath([[i,r],d,f,[s,o]]),e}}},7088:function(t,e,i){i.d(e,{V:function(){return n}});class n{static local(){return null===n.instance&&(n.instance=new n),n.instance}execute(t,e,i,n,s){return new r(t,e,i)}}n.instance=null;class r{constructor(t,e,i){this._inputGeometries=t,this._offsetX=void 0!==e.offsetX?e.offsetX*i:0,this._offsetY=void 0!==e.offsetY?e.offsetY*i:0}next(){let t=this._inputGeometries.next();for(;t;){if(t.totalSize>0)return this._move(t.clone(),this._offsetX,this._offsetY);t=this._inputGeometries.next()}return null}_move(t,e,i){for(;t.nextPath();)for(;t.nextPoint();)t.x=t.x+e,t.y=t.y+i;return t.reset(),t}}},17706:function(t,e,i){i.d(e,{V:function(){return u}}),i(50917);var n=i(33134),r=i(49077),s=i(74697),o=i(62096),a=i(93996),l=i(33389),c=i(57165);class u{static local(){return null===u.instance&&(u.instance=new u),u.instance}execute(t,e,i,n,r,s){return new h(t,e,i,n,r,s)}}u.instance=null;class h{constructor(t,e,i,n,r,s){this._inputGeometries=t,this._tileKey=n,this._geometryEngine=r,this._curveHelper=new a.I,this._offset=(e.offset??1)*i,this._method=e.method,this._maxInflateSize=Math.max(Math.abs(s*i),10),this._option=e.option,this._offsetFlattenError=a.U*i}next(){let t;for(;t=this._inputGeometries.next();){if(0===this._offset)return t.clone();if("esriGeometryEnvelope"===t.geometryType){if(this._method===l.xw.Rounded&&this._offset>0){const e=(0,r.A)(t),i=this._curveHelper.offset(e,-this._offset,this._method,4,this._offsetFlattenError);if(i){const e=n.z.createEmptyOptimizedCIM(t.geometryType);return e.pushPath(i),e}return null}const e=t.asJSON();if((0,s.ZC)(e)&&Math.min(e.xmax-e.xmin,e.ymax-e.ymin)+2*this._offset>0)return n.z.fromJSONCIM({xmin:e.xmin-this._offset,xmax:e.xmax+this._offset,ymin:e.ymin-this._offset,ymax:e.ymax+this._offset})}const e=this._geometryEngine;if(null==e)continue;const i=this._tileKey?(0,o.q)(t,this._maxInflateSize):t.clone();if(!i)continue;const a=e.offset(c.A.WebMercator,i.asJSON(),-this._offset,1,this._method,4,this._offsetFlattenError);return a?n.z.fromJSONCIM(a):null}return null}}},10183:function(t,e,i){i.d(e,{C:function(){return n}});class n{static local(){return null===n.instance&&(n.instance=new n),n.instance}execute(t,e,i,n,s){return new r(t,e,i)}}n.instance=null;class r{constructor(t,e,i){this._inputGeometries=t,this._reverse=void 0===e.reverse||e.reverse}next(){let t=this._inputGeometries.next();for(;t;){if(!this._reverse)return t;if("esriGeometryPolyline"===t.geometryType)return s(t.clone());t=this._inputGeometries.next()}return null}}function s(t){for(;t.nextPath();)for(let e=0;e<t.pathSize/2;e++){t.seekInPath(e);const i=t.x,n=t.y;t.seekInPath(t.pathSize-e-1);const r=t.x,s=t.y;t.x=i,t.y=n,t.seekInPath(e),t.x=r,t.y=s}return t.reset(),t}},1646:function(t,e,i){i.d(e,{v:function(){return r}});var n=i(35068);class r{static local(){return null===r.instance&&(r.instance=new r),r.instance}execute(t,e,i,n,r){return new s(t,e,i)}}r.instance=null;class s{constructor(t,e,i){this._inputGeometries=t,this._rotateAngle=void 0!==e.angle?e.angle*Math.PI/180:0}next(){let t=this._inputGeometries.next();for(;t;){if(0===this._rotateAngle||"esriGeometryPoint"===t.geometryType)return t;if(t.totalSize>0){const e=(0,n.z8)(t),i=(e[2]+e[0])/2,r=(e[3]+e[1])/2;return t.reset(),this._rotate(t.clone(),i,r)}t=this._inputGeometries.next()}return null}_rotate(t,e,i){const n=Math.cos(this._rotateAngle),r=Math.sin(this._rotateAngle);for(;t.nextPath();)for(;t.nextPoint();){const s=t.x-e,o=t.y-i;t.x=e+s*n-o*r,t.y=i+s*r+o*n}return t.reset(),t}}},79323:function(t,e,i){i.d(e,{W:function(){return r}});var n=i(35068);class r{static local(){return null===r.instance&&(r.instance=new r),r.instance}execute(t,e,i,n,r){return new s(t,e,i)}}r.instance=null;class s{constructor(t,e,i){this._inputGeometries=t,this._xFactor=void 0!==e.xScaleFactor?e.xScaleFactor:1.15,this._yFactor=void 0!==e.yScaleFactor?e.yScaleFactor:1.15}next(){const t=this._inputGeometries.next();if(t){if(1===this._xFactor&&1===this._yFactor)return t;if("esriGeometryPoint"===t.geometryType)return t;if(t.totalSize>0){const e=(0,n.z8)(t),i=(e[2]+e[0])/2,r=(e[3]+e[1])/2;return t.reset(),this._scaleCursor(t.clone(),i,r)}}return null}_scaleCursor(t,e,i){for(;t.nextPath();)for(;t.nextPoint();)t.x=e+(t.x-e)*this._xFactor,t.y=i+(t.y-i)*this._yFactor;return t.reset(),t}}},34476:function(t,e,i){i.d(e,{l:function(){return o}});var n=i(33134),r=i(33389),s=i(65661);class o{static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(t,e,i,n,r){return new a(t,e,i)}}o.instance=null;class a{constructor(t,e,i){this._inputGeometries=t,this._height=(void 0!==e.amplitude?e.amplitude:2)*i,this._period=(void 0!==e.period?e.period:3)*i,this._style=e.waveform,this._height<=0&&(this._height=Math.abs(this._height)),this._period<=0&&(this._period=Math.abs(this._period)),this._pattern=new s.VA,this._pattern.addValue(this._period),this._pattern.addValue(this._period),this._walker=new s.Z1,this._walker.updateTolerance(i)}next(){let t=this._inputGeometries.next();for(;t;){if(0===this._height||0===this._period)return t;const e=this._processGeom(t);if(e)return e;t=this._inputGeometries.next()}return null}_processGeom(t){const e=n.z.createEmptyOptimizedCIM(t.geometryType);for(;t.nextPath();){e.startPath();const i=t.pathLength();if(this._walker.init(t,this._pattern))switch(this._style){case r.WE.Sinus:default:this._constructCurve(e,i,!1);break;case r.WE.Square:this._constructSquare(e,i);break;case r.WE.Triangle:this._constructTriangle(e,i);break;case r.WE.Random:this._constructCurve(e,i,!0)}else for(;t.nextPoint();)e.pushXY(t.x,t.y)}return e}_constructCurve(t,e,i){let n=Math.round(e/this._period);0===n&&(n=1);const r=16*n+1,o=e/n,a=this._period/16,l=1/r,c=2*Math.PI*e/o,u=2*Math.PI*Math.random(),h=2*Math.PI*Math.random(),d=2*Math.PI*Math.random(),f=.75-Math.random()/2,p=.75-Math.random()/2,_=new s.ps;this._walker.curPointAndAngle(_),t.pushPoint(_.pt);let m=0;for(;;){if(!this._walker.nextPointAndAngle(a,_)){t.pushPoint(this._walker.getPathEnd());break}{const e=m;let n;if(m+=l,i){const t=this._height/2*(1+.3*Math.sin(f*c*e+u));n=t*Math.sin(c*e+h),n+=t*Math.sin(p*c*e+d),n/=2}else n=.5*this._height*Math.sin(.5*c*e);t.pushXY(_.pt[0]-n*_.sa,_.pt[1]+n*_.ca)}}}_constructSquare(t,e){Math.round(e/this._period);let i=!0;for(;;){let e=!1;if(this._walker.curPositionIsValid()){const n=new s.ps;this._walker.curPointAndAngle(n);const r=new s.ps;if(this._walker.nextPointAndAngle(this._period,r)){const o=new s.ps;this._walker.nextPointAndAngle(this._period,o)&&(i?(t.pushPoint(n.pt),i=!1):t.pushPoint(n.pt),t.pushXY(n.pt[0]-this._height/2*n.sa,n.pt[1]+this._height/2*n.ca),t.pushXY(r.pt[0]-this._height/2*r.sa,r.pt[1]+this._height/2*r.ca),t.pushXY(r.pt[0]+this._height/2*r.sa,r.pt[1]-this._height/2*r.ca),t.pushXY(o.pt[0]+this._height/2*o.sa,o.pt[1]-this._height/2*o.ca),e=!0)}}if(!e){t.pushPoint(this._walker.getPathEnd());break}}}_constructTriangle(t,e){Math.round(e/this._period);let i=!0;for(;;){let e=!1;if(this._walker.curPositionIsValid()){const n=new s.ps;this._walker.curPointAndAngle(n);const r=new s.ps;if(this._walker.nextPointAndAngle(this._period/2,r)){const o=new s.ps;this._walker.nextPointAndAngle(this._period,o)&&(this._walker.nextPosition(this._period/2)&&(i?(t.pushPoint(n.pt),i=!1):t.pushPoint(n.pt),t.pushXY(r.pt[0]-this._height/2*r.sa,r.pt[1]+this._height/2*r.ca),t.pushXY(o.pt[0]+this._height/2*o.sa,o.pt[1]-this._height/2*o.ca)),e=!0)}}if(!e){t.pushPoint(this._walker.getPathEnd());break}}}}},84646:function(t,e,i){i.d(e,{l:function(){return r}});var n=i(9635);class r{static getPlacement(t,e,i,r,s,o){const a=(0,n.c)(i);return a?(-1===e&&t.invertY(),a.execute(t,i,r,s,o)):null}}},31771:function(t,e,i){i.d(e,{e:function(){return o}});var n=i(23454),r=i(33389),s=i(65661);class o{static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(t,e,i,n,r){return new a(t,e,i)}}o.instance=null;class a extends n.pC{constructor(t,e,i){super(t),this._geometryWalker=new s.Z1,this._geometryWalker.updateTolerance(i),this._angleToLine=e.angleToLine??!0,this._offset=(e.offset?e.offset:0)*i,this._originalEndings=e.endings,this._offsetAtEnd=(e.customEndingOffset?e.customEndingOffset:0)*i,this._position=-(e.offsetAlongLine?e.offsetAlongLine:0)*i,this._pattern=new s.VA,this._pattern.init(e.placementTemplate,!1),this._pattern.scale(i),this._endings=this._originalEndings}processPath(t){if(this._pattern.isEmpty())return null;let e;if(this.iteratePath)e=this._pattern.nextValue();else{this._originalEndings===r.e_.WithFullGap&&this.isClosed?this._endings=r.e_.WithMarkers:this._endings=this._originalEndings,this._pattern.extPtGap=0;let i,n=!0;switch(this._endings){case r.e_.NoConstraint:i=-this._position,i=this._adjustPosition(i),n=!1;break;case r.e_.WithHalfGap:default:i=-this._pattern.lastValue()/2;break;case r.e_.WithFullGap:i=-this._pattern.lastValue(),this._pattern.extPtGap=this._pattern.lastValue();break;case r.e_.WithMarkers:i=0;break;case r.e_.Custom:i=-this._position,i=this._adjustPosition(i),this._pattern.extPtGap=.5*this._offsetAtEnd}if(!this._geometryWalker.init(t,this._pattern,n))return null;this._pattern.reset();let s=0;for(;i>s;)i-=s,s=this._pattern.nextValue();s-=i,e=s,this.iteratePath=!0}const i=new s.ps;return this._geometryWalker.nextPointAndAngle(e,i)?this._endings===r.e_.WithFullGap&&this._geometryWalker.isPathEnd()?(this.iteratePath=!1,null):this._endings===r.e_.WithMarkers&&this._geometryWalker.isPathEnd()&&(this.iteratePath=!1,this.isClosed)?null:(this.internalPlacement.setTranslate(i.pt[0]-this._offset*i.sa,i.pt[1]+this._offset*i.ca),this._angleToLine&&this.internalPlacement.setRotateCS(i.ca,i.sa),this.internalPlacement):(this.iteratePath=!1,null)}_adjustPosition(t){let e=t/this._pattern.length();return e-=Math.floor(e),e*this._pattern.length()}}},15987:function(t,e,i){i.d(e,{y:function(){return o}});var n=i(23454),r=i(93996),s=i(33389);class o{static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(t,e,i,n,r){return new a(t,e,i)}}o.instance=null;class a extends n.pC{constructor(t,e,i){super(t,!1,!0),this._curveHelper=new r.I,this._placePerPart=e.placePerPart??!1,this._angleToLine=void 0===e.angleToLine||e.angleToLine,this._offset=void 0!==e.offset?e.offset*i:0,this._type=e.extremityPlacement,this._position=void 0!==e.offsetAlongLine?e.offsetAlongLine*i:0,this._beginProcessed=!1}processMultiPath(t){return this._placePerPart?super.processMultiPath(t):this.processPath(t)}processPath(t){let e;switch(this._type){case s.$2.Both:default:this._beginProcessed?(e=this._atExtremities(t,this._position,!1),this._beginProcessed=!1,this.iterateMultiPath=!1,this.iteratePath=!1):(e=this._atExtremities(t,this._position,!0),this._beginProcessed=!0,this.iterateMultiPath=!0,this.iteratePath=!0);break;case s.$2.JustBegin:e=this._atExtremities(t,this._position,!0);break;case s.$2.JustEnd:e=this._atExtremities(t,this._position,!1);case s.$2.None:}return e}_atExtremities(t,e,i){if(this._placePerPart||(i?t.seekPath(0):t.seekPath(t.totalSize-1)),i||t.seekPathEnd(),i?t.nextPoint():t.prevPoint()){let n=0,[r,s]=[0,0],[o,a]=[t.x,t.y];for(;i?t.nextPoint():t.prevPoint();){r=o,s=a,o=t.x,a=t.y;const i=this._curveHelper.getLength(r,s,o,a);if(n+i>e){const t=(e-n)/i,[l,c]=this._curveHelper.getAngleCS(r,s,o,a,t),u=this._curveHelper.getCoord2D(r,s,o,a,t);return this.internalPlacement.setTranslate(u[0]-this._offset*c,u[1]+this._offset*l),this._angleToLine&&this.internalPlacement.setRotateCS(-l,-c),this.internalPlacement}n+=i}}return null}}},19511:function(t,e,i){i.d(e,{S:function(){return s}});var n=i(23454),r=i(65661);class s{static local(){return null===s.instance&&(s.instance=new s),s.instance}execute(t,e,i,n,r){return new o(t,e,i)}}s.instance=null;class o extends n.pC{constructor(t,e,i){super(t),this._walker=new r.Z1,this._walker.updateTolerance(i),this._angleToLine=void 0===e.angleToLine||e.angleToLine,this._offset=void 0!==e.offset?e.offset*i:0,this._beginGap=void 0!==e.beginPosition?e.beginPosition*i:0,this._endGap=void 0!==e.endPosition?e.endPosition*i:0,this._flipFirst=void 0===e.flipFirst||e.flipFirst,this._pattern=new r.VA,this._pattern.init(e.positionArray,!1,!1),this._subPathLen=0,this._posCount=this._pattern.size(),this._isFirst=!0,this._prevPos=0}processPath(t){if(this._pattern.isEmpty())return null;let e;if(this.iteratePath){const t=this._pattern.nextValue()*this._subPathLen,i=this._beginGap+t;e=i-this._prevPos,this._prevPos=i}else{if(this._posCount=this._pattern.size(),this._isFirst=!0,this._prevPos=0,this._subPathLen=t.pathLength()-this._beginGap-this._endGap,this._subPathLen<0)return this.iteratePath=!1,null;if(!this._walker.init(t,this._pattern,!1))return null;this._pattern.reset();const i=this._pattern.nextValue()*this._subPathLen,n=this._beginGap+i;e=n-this._prevPos,this._prevPos=n,this.iteratePath=!0}const i=new r.ps;if(!this._walker.nextPointAndAngle(e,i,r.YQ.END))return this.iteratePath=!1,null;this.internalPlacement.setTranslate(i.pt[0]-this._offset*i.sa,i.pt[1]+this._offset*i.ca);const n=this._isFirst&&this._flipFirst;let s,o;return this._angleToLine?(s=i.ca,o=i.sa):(s=1,o=0),n&&(s=-s,o=-o),this.internalPlacement.setRotateCS(s,o),this._isFirst=!1,this._posCount--,0===this._posCount&&(this.iteratePath=!1),this.internalPlacement}}},20305:function(t,e,i){i.d(e,{M:function(){return c}});var n=i(13798),r=i(29076),s=i(33389);const o=512,a=24,l=1e-6;class c{static local(){return null===c.instance&&(c.instance=new c),c.instance}execute(t,e,i,n,r){return new u(t,e,i,n,r)}}c.instance=null;class u{constructor(t,e,i,a,l){if(this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,this._currentX=0,this._currentY=0,this._accelerationMap=null,this._testInsidePolygon=!1,this._verticalSubdivision=!0,this._stepX=Math.abs(e.stepX??16)*i,this._stepY=Math.abs(e.stepY??16)*i,this._stepX=Math.round(128*this._stepX)/128,this._stepY=Math.round(128*this._stepY)/128,0!==this._stepX&&0!==this._stepY){if(this._gridType=e.gridType??s.Q1.Fixed,this._gridType===s.Q1.Random){const t=e.seed??13,i=1;this._randomLCG=new n.A(t*i),this._randomness=(e.randomness??100)/100,this._gridAngle=0,this._shiftOddRows=!1,this._cosAngle=1,this._sinAngle=0,this._offsetX=0,this._offsetY=0,this._buildRandomValues()}else{if(this._randomness=0,this._gridAngle=e.gridAngle??0,this._shiftOddRows=e.shiftOddRows??!1,this._offsetX=(e.offsetX??0)*i,this._offsetY=(e.offsetY??0)*i,this._cosAngle=Math.cos(this._gridAngle/180*Math.PI),this._sinAngle=-Math.sin(this._gridAngle/180*Math.PI),this._stepX)if(this._offsetX<0)for(;this._offsetX<-.5*this._stepX;)this._offsetX+=this._stepX;else for(;this._offsetX>=.5*this._stepX;)this._offsetX-=this._stepX;if(this._stepY)if(this._offsetY<0)for(;this._offsetY<-.5*this._stepY;)this._offsetY+=this._stepY;else for(;this._offsetY>=.5*this._stepY;)this._offsetY-=this._stepY}if(this._graphicOriginX=0,this._graphicOriginY=0,null!=a){const[t,e,i,n]=a.split("/"),r=parseFloat(t),s=parseFloat(e),l=parseFloat(i),c=parseFloat(n);this._graphicOriginX=-(c*2**r+l)*o,this._graphicOriginY=s*o,this._testInsidePolygon=!0}this._internalPlacement=new r.W,this._calculateMinMax(t),this._geometryCursor=t}}next(){return this._geometryCursor?this._nextInside():null}_buildRandomValues(){if(!u._randValues){u._randValues=[];for(let t=0;t<a;t++)for(let t=0;t<a;t++)u._randValues.push(this._randomLCG.getFloat()),u._randValues.push(this._randomLCG.getFloat())}}_calculateMinMax(t){let e,i,n,r,s,a,l,c,u,h,d,f,p,_;this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,l=c=p=d=Number.MAX_VALUE,u=h=_=f=-Number.MAX_VALUE;const m=1!==this._cosAngle;for(t.reset();t.nextPath();)for(;t.nextPoint();)a=t.x,s=t.y,e=a-this._graphicOriginX-this._offsetX,i=s-this._graphicOriginY-this._offsetY,m?(n=this._cosAngle*e-this._sinAngle*i,r=this._sinAngle*e+this._cosAngle*i):(n=e,r=i),l=Math.min(l,n),u=Math.max(u,n),c=Math.min(c,r),h=Math.max(h,r),d=Math.min(d,s),f=Math.max(f,s),p=Math.min(p,a),_=Math.max(_,a);d=d!==Number.MAX_VALUE?d:-o-this._stepY,f=f!==-Number.MAX_VALUE?f:this._stepY,p=p!==Number.MAX_VALUE?p:-this._stepX,_=_!==-Number.MAX_VALUE?_:o+this._stepX;const g=f-d,y=_-p;if(this._verticalSubdivision=g>=y,this._polygonMin=this._verticalSubdivision?d:p,this._testInsidePolygon){let t=0-this._graphicOriginX-this._offsetX-this._stepX,e=o-this._graphicOriginX-this._offsetX+this._stepX,i=-o-this._graphicOriginY-this._offsetY-this._stepY,n=0-this._graphicOriginY-this._offsetY+this._stepY;if(m){const r=[[t,i],[t,n],[e,i],[e,n]];t=i=Number.MAX_VALUE,e=n=-Number.MAX_VALUE;for(const s of r){const r=this._cosAngle*s[0]-this._sinAngle*s[1],o=this._sinAngle*s[0]+this._cosAngle*s[1];t=Math.min(t,r),e=Math.max(e,r),i=Math.min(i,o),n=Math.max(n,o)}}l=l!==Number.MAX_VALUE?Math.max(l,t):t,c=c!==Number.MAX_VALUE?Math.max(c,i):i,u=u!==-Number.MAX_VALUE?Math.min(u,e):e,h=h!==-Number.MAX_VALUE?Math.min(h,n):n}this._xMin=Math.round(l/this._stepX),this._xMax=Math.round(u/this._stepX),this._yMin=Math.round(c/this._stepY),this._yMax=Math.round(h/this._stepY),this._currentX=this._xMax+1,this._currentY=this._yMin-1,this._buildAccelerationMap(t,p,_,d,f)}_buildAccelerationMap(t,e,i,n,r){t.reset();const s=new Map,a=this._verticalSubdivision,l=a?r-n:i-e;let c=Math.ceil(l/10);if(c<=1)return;const u=Math.floor(l/c);let d,f,p,_,m,g,y,v,x,b,S;for(c++,this._delta=u,a?(x=-o-2*this._stepY,b=2*this._stepY,S=n):(x=-2*this._stepX,b=o+2*this._stepX,S=e);t.nextPath();)if(!(t.pathSize<2)&&t.nextPoint())for(d=t.x,f=t.y;t.nextPoint();d=p,f=_){if(p=t.x,_=t.y,a){if(f===_||f<x&&_<x||f>b&&_>b)continue;m=Math.min(f,_),g=Math.max(f,_)}else{if(d===p||d<x&&p<x||d>b&&p>b)continue;m=Math.min(d,p),g=Math.max(d,p)}for(;m<g;)y=Math.floor((m-S)/u),h(y,d,f,p,_,s),m+=u;v=Math.floor((g-S)/u),v>y&&h(v,d,f,p,_,s)}this._accelerationMap=s}_nextInside(){for(;;){if(this._currentX>this._xMax){if(this._currentY++,this._currentY>this._yMax)return null;this._currentX=this._xMin,this._shiftOddRows&&this._currentY%2&&this._currentX--}let t=this._currentX*this._stepX+this._offsetX;this._shiftOddRows&&this._currentY%2&&(t+=.5*this._stepX);const e=this._currentY*this._stepY+this._offsetY;let i,n;if(this._currentX++,this._gridType===s.Q1.Random){const r=(this._currentX%a+a)%a,s=(this._currentY%a+a)%a;i=this._graphicOriginX+t+this._stepX*this._randomness*(.5-u._randValues[s*a+r])*2/3,n=this._graphicOriginY+e+this._stepY*this._randomness*(.5-u._randValues[s*a+r+1])*2/3}else i=this._graphicOriginX+this._cosAngle*t+this._sinAngle*e,n=this._graphicOriginY-this._sinAngle*t+this._cosAngle*e;if(!this._testInsidePolygon||this._isInsidePolygon(i,n,this._geometryCursor))return this._internalPlacement.setTranslate(i,n),this._internalPlacement}}_isInsidePolygon(t,e,i){if(null==this._accelerationMap)return function(t,e,i){let n,r,s,o,a=0;for(t+=l,e+=l,i.reset();i.nextPath();)if(i.nextPoint())for(n=i.x,r=i.y;i.nextPoint();n=s,r=o)s=i.x,o=i.y,r>e!=o>e&&((s-n)*(e-r)-(o-r)*(t-n)>0?a++:a--);return 0!==a}(t,e,i);t+=l,e+=l;const n=this._verticalSubdivision,r=n?e:t,s=Math.floor((r-this._polygonMin)/this._delta),o=this._accelerationMap.get(s);if(!o)return!1;let a,c,u,h=0;for(const i of o){if(a=i[0],c=i[1],n){if(a[1]>e==c[1]>e)continue;u=(c[0]-a[0])*(e-a[1])-(c[1]-a[1])*(t-a[0])}else{if(a[0]>t==c[0]>t)continue;u=(c[1]-a[1])*(t-a[0])-(c[0]-a[0])*(e-a[1])}u>0?h++:h--}return 0!==h}}function h(t,e,i,n,r,s){let o=s.get(t);o||(o=[],s.set(t,o)),o.push([[e,i],[n,r]])}},58892:function(t,e,i){i.d(e,{R:function(){return o}});var n=i(23454),r=i(93996),s=i(33389);class o{static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(t,e,i,n,r){return new a(t,e,i)}}o.instance=null;class a extends n.pC{constructor(t,e,i){super(t),this._curveHelper=new r.I,this._angleToLine=void 0===e.angleToLine||e.angleToLine,this._offset=void 0!==e.offset?e.offset*i:0,this._relativeTo=e.relativeTo,this._position=void 0!==e.startPointOffset?e.startPointOffset*i:0,this._epsilon=.001*i}processPath(t){const e=this._position;if(this._relativeTo===s.ip.SegmentMidpoint){if(this.iteratePath||(this.iteratePath=!0),t.nextPoint()){let[e,i]=[t.x,t.y],[n,r]=[0,0];for(;t.nextPoint();){n=t.x,r=t.y;const s=this._curveHelper.getLength(e,i,n,r);if(s<this._epsilon){e=n,i=r;continue}const o=.5+this._position/s,[a,l]=this._curveHelper.getAngleCS(e,i,n,r,o),c=this._curveHelper.getCoord2D(e,i,n,r,o);return this.internalPlacement.setTranslate(c[0]-this._offset*l,c[1]+this._offset*a),this._angleToLine&&this.internalPlacement.setRotateCS(a,l),this.internalPlacement}}return this.iteratePath=!1,null}const i=this._relativeTo===s.ip.LineEnd;return this.onLine(t,e,i)}onLine(t,e,i){let n,r=!1;switch(this._relativeTo){case s.ip.LineMiddle:default:t.seekPathStart(),n=t.pathLength()/2+e;break;case s.ip.LineBeginning:n=e;break;case s.ip.LineEnd:n=e,r=!0}i?t.seekPathEnd():t.seekPathStart();let o=0;if(i?t.prevPoint():t.nextPoint()){let[e,s]=[t.x,t.y],[a,l]=[0,0];for(;i?t.prevPoint():t.nextPoint();){a=t.x,l=t.y;const i=this._curveHelper.getLength(e,s,a,l);if(o+i>n){const t=(n-o)/i,[c,u]=this._curveHelper.getAngleCS(e,s,a,l,t),h=this._curveHelper.getCoord2D(e,s,a,l,t),d=r?-this._offset:this._offset;return this.internalPlacement.setTranslate(h[0]-d*u,h[1]+d*c),this._angleToLine&&(r?this.internalPlacement.setRotateCS(-c,-u):this.internalPlacement.setRotateCS(c,u)),this.internalPlacement}e=a,s=l,o+=i}}return null}}},80585:function(t,e,i){i.d(e,{A:function(){return s}});var n=i(23454),r=i(93996);class s{static local(){return null===s.instance&&(s.instance=new s),s.instance}execute(t,e,i,n,r){return new o(t,e,i)}}s.instance=null;class o extends n.pC{constructor(t,e,i){super(t),this._curveHelper=new r.I,this._angleToLine=void 0===e.angleToLine||e.angleToLine,this._offset=void 0!==e.offset?e.offset*i:0,this._endPoints=void 0===e.placeOnEndPoints||e.placeOnEndPoints,this._controlPoints=void 0===e.placeOnControlPoints||e.placeOnControlPoints,this._regularVertices=void 0===e.placeOnRegularVertices||e.placeOnRegularVertices,this._tags=[],this._tagIterator=0}processPath(t){if(this.iteratePath||(this._preparePath(t),this.iteratePath=!0),this._tagIterator>=this._tags.length)return this._tags.length=0,this._tagIterator=0,this.iteratePath=!1,null;const e=this._tags[this._tagIterator];this._angleToLine&&this.internalPlacement.setRotate(e[2]);let i=e[0],n=e[1];if(0!==this._offset){const t=Math.cos(e[2]),r=Math.sin(e[2]);i-=this._offset*r,n+=this._offset*t}return this.internalPlacement.setTranslate(i,n),this._tagIterator++,this.internalPlacement}_preparePath(t){this._tags.length=0,this._tagIterator=0,t.seekPathStart();const e=t.isClosed();let i=0,n=!1,r=0,s=0;if(t.seekPathStart(),t.nextPoint()){let o=t.x,l=t.y,c=t.getControlPoint(),u=!0,h=t.nextPoint();for(;h;){const d=t.x,f=t.y,p=t.getControlPoint();(this._angleToLine||0!==this._offset)&&(r=this._curveHelper.getAngle(o,l,d,f,0)),u?(u=!1,e?(i=r,n=c):(this._endPoints||this._controlPoints&&c)&&this._tags.push([o,l,r])):c?this._controlPoints&&this._tags.push([o,l,a(s,r)]):this._regularVertices&&this._tags.push([o,l,a(s,r)]),(this._angleToLine||0!==this._offset)&&(s=this._curveHelper.getAngle(o,l,d,f,1)),h=t.nextPoint(),h||(e?p||n?this._controlPoints&&this._tags.push([d,f,a(s,i)]):this._regularVertices&&this._tags.push([d,f,a(s,i)]):(this._endPoints||this._controlPoints&&p)&&this._tags.push([d,f,s])),o=d,l=f,c=p}}this._tagIterator=0}}function a(t,e){const i=Math.PI;for(;Math.abs(e-t)>i+2e-15;)e-t>i?e-=2*i:e+=2*i;return(t+e)/2}},58676:function(t,e,i){i.d(e,{L:function(){return l}});var n=i(35068),r=i(72228),s=i(30804),o=i(29076),a=i(33389);class l{static local(){return null===l.instance&&(l.instance=new l),l.instance}execute(t,e,i,n,r){return new c(t,e,i)}}l.instance=null;class c{constructor(t,e,i){this._geometryCursor=t,this._offsetX=void 0!==e.offsetX?e.offsetX*i:0,this._offsetY=void 0!==e.offsetY?e.offsetY*i:0,this._method=void 0!==e.method?e.method:a.YI.OnPolygon,this._placementPerPart=void 0!==e.placePerPart&&e.placePerPart,this._internalPlacement=new o.W}next(){const t=this._geometryCursor;if(!t)return null;if(!this._placementPerPart)return this._geometryCursor=null,this._polygonCenter(t);for(;t.nextPath();)if(!(t.getCurrentRingArea()<0))return this._polygonCenter(t.getCurrentPath());return this._geometryCursor=null,null}_polygonCenter(t){let e=!1;switch(this._method){case a.YI.CenterOfMass:{const i=(0,r.TP)(t);i&&(this._internalPlacement.setTranslate(i[0]+this._offsetX,i[1]+this._offsetY),e=!0)}break;case a.YI.BoundingBoxCenter:{const i=(0,n.z8)(t);i&&(this._internalPlacement.setTranslate((i[2]+i[0])/2+this._offsetX,(i[3]+i[1])/2+this._offsetY),e=!0)}break;case a.YI.OnPolygon:default:{const i=(0,s.d)(t);null!==i&&(this._internalPlacement.setTranslate(i[0]+this._offsetX,i[1]+this._offsetY),e=!0)}}return e?this._internalPlacement:null}}},84728:function(t,e,i){i.d(e,{c5:function(){return a},f0:function(){return l},k2:function(){return c}});var n=i(5161),r=i(15774),s=i(2014);const o=t=>"vertical"===t||"horizontal"===t||"cross"===t||"esriSFSCross"===t||"esriSFSVertical"===t||"esriSFSHorizontal"===t;function a(t,e,i){const n=e.style,s=(0,r.yR)(Math.ceil(i)),a=o(n)?8*s:16*s,l=2*s;t.width=a,t.height=a;const c=t.getContext("2d");c.strokeStyle="#ffffff",c.lineWidth=s,c.beginPath(),"vertical"!==n&&"cross"!==n&&"esriSFSCross"!==n&&"esriSFSVertical"!==n||(c.moveTo(a/2,-l),c.lineTo(a/2,a+l)),"horizontal"!==n&&"cross"!==n&&"esriSFSCross"!==n&&"esriSFSHorizontal"!==n||(c.moveTo(-l,a/2),c.lineTo(a+l,a/2)),"backward-diagonal"!==n&&"diagonal-cross"!==n&&"esriSFSDiagonalCross"!==n&&"esriSFSBackwardDiagonal"!==n||(c.moveTo(-l,-l),c.lineTo(a+l,a+l),c.moveTo(a-l,-l),c.lineTo(a+l,l),c.moveTo(-l,a-l),c.lineTo(l,a+l)),"forward-diagonal"!==n&&"diagonal-cross"!==n&&"esriSFSForwardDiagonal"!==n&&"esriSFSDiagonalCross"!==n||(c.moveTo(a+l,-l),c.lineTo(-l,a+l),c.moveTo(l,-l),c.lineTo(-l,l),c.moveTo(a+l,a-l),c.lineTo(a-l,a+l)),c.stroke();const u=c.getImageData(0,0,t.width,t.height),h=new Uint8Array(u.data);let d;for(let t=0;t<h.length;t+=4)d=h[t+3]/255,h[t]=h[t]*d,h[t+1]=h[t+1]*d,h[t+2]=h[t+2]*d;return[h,t.width,t.height,s]}function l(t){t.length%2==1&&(t=[...t,...t]);const e=t.reduce(((t,e)=>t+e),0),i=Math.round(e*s.zA),r=new Float32Array(1*i);let o=0,a=0,l=.5,c=!0;for(const e of t){for(o=a,a+=e*s.zA;l<=a;){const t=l-.5,e=Math.min(Math.abs(l-o),Math.abs(l-a));r[t]=c?-e:e,l++}c=!c}const u=r.length,h=new Uint8Array(4*u);for(let t=0;t<u;++t){const e=r[t]/s.zA;(0,n.U)(e/s.gR*.5+.5,h,4*t)}return[h,i,1]}function c(t,e){null==t&&(t=[]);const i="Butt"===e,r="Square"===e,o=!i&&!r;t.length%2==1&&(t=[...t,...t]);const a=s.$o,l=2*a;let c=0;for(const e of t)c+=e;const u=Math.round(c*a),h=new Float32Array(u*l),d=.5*a;let f=0,p=0,_=.5,m=!0;for(const e of t){for(f=p,p+=e*a;_<=p;){let t=.5;for(;t<l;){const e=(t-.5)*u+_-.5,n=o?(t-a)*(t-a):Math.abs(t-a);h[e]=m?i?Math.max(Math.max(f+d-_,n),Math.max(_-p+d,n)):n:o?Math.min((_-f)*(_-f)+n,(_-p)*(_-p)+n):r?Math.min(Math.max(_-f,n),Math.max(p-_,n)):Math.min(Math.max(_-f+d,n),Math.max(p+d-_,n)),t++}_++}m=!m}const g=h.length,y=new Uint8Array(4*g);for(let t=0;t<g;++t){const e=(o?Math.sqrt(h[t]):h[t])/a;(0,n.U)(e,y,4*t)}return[y,u,l]}},79083:function(t,e,i){i.d(e,{C:function(){return y}});var n=i(53804),r=i(83525),s=(i(39819),i(58941)),o=(i(40633),i(23502)),a=(i(13798),i(65953)),l=i(39686),c=i(28230),u=i(15774),h=i(45273);class d{constructor(t,e,i){this._width=t*i,this._height=e*i,this._pixelRatio=i;const n=Math.ceil(this._width/1),r=Math.ceil(this._height/1);this._cols=n,this._rows=r,this._cells=h.y.create(n*r)}insertMetrics(t){this._markMetrics(t)}hasCollision(t){let e=0;for(const{transformedX:i,transformedY:n,width:r,height:s}of t.bounds){const t=r*this._pixelRatio,o=s*this._pixelRatio,a=i*this._pixelRatio,l=n*this._pixelRatio;switch(this._collide(a,l,t,o)){case 2:return 2;case 1:e++}}return e===t.bounds.length?1:0}getCellId(t,e){return t+e*this._cols}has(t){return this._cells.has(t)}hasRange(t,e){return this._cells.hasRange(t,e)}set(t){this._cells.set(t)}setRange(t,e){this._cells.setRange(t,e)}_collide(t,e,i,n){const r=t-i/2,s=e-n/2,o=r+i,a=s+n;if(o<0||a<0||r>this._width||s>this._height)return 1;const l=(0,u.qE)(Math.floor(r/1),0,this._cols),c=(0,u.qE)(Math.floor(s/1),0,this._rows),h=(0,u.qE)(Math.ceil(o/1),0,this._cols),d=(0,u.qE)(Math.ceil(a/1),0,this._rows);for(let t=c;t<=d;t++)for(let e=l;e<=h;e++){const i=this.getCellId(e,t);if(this.has(i))return 2}return 0}_mark(t,e,i,n){const r=t-i/2,s=e-n/2,o=r+i,a=s+n,l=(0,u.qE)(Math.floor(r/1),0,this._cols),c=(0,u.qE)(Math.floor(s/1),0,this._rows),h=(0,u.qE)(Math.ceil(o/1),0,this._cols),d=(0,u.qE)(Math.ceil(a/1),0,this._rows);for(let t=c;t<=d;t++)for(let e=l;e<=h;e++){const i=this.getCellId(e,t);this.set(i)}return!1}_markMetrics(t){for(const{transformedX:e,transformedY:i,width:n,height:r}of t.bounds){const t=n*this._pixelRatio,s=r*this._pixelRatio,o=e*this._pixelRatio,a=i*this._pixelRatio;this._mark(o,a,t,s)}}}const f=254,p=255;function _(t,e){const i=t.children.slice();i.sort(((t,e)=>t.tileAge-e.tileAge)),i.forEach((t=>{null!=t.labelMetrics&&t.isReady&&e(t,t.labelMetrics)}))}function m(t,e){return(!t.minScale||t.minScale>=e)&&(!t.maxScale||t.maxScale<=e)}class g{run(t,e,i,n){const r=[];for(let e=t.length-1;e>=0;e--){const i=t[e];i.labelingCollisionInfos?.length&&r.push(...i.labelingCollisionInfos)}(0,s.A)("esri-2d-update-debug")&&r.length&&console.debug("CollisionEngine.run"),this._transformMetrics(r),this._runCollision(r,e,i,n);for(const t of r)t.container.requestRender()}_runCollision(t,e,i,n){const[r,s]=e.state.size,o=new d(r,s,e.pixelRatio);for(const{container:e,deconflictionEnabled:r,visible:s}of t){const t=e.attributeView;r?s?(this._prepare(e),this._collideVisible(o,e,i,n),this._collideInvisible(o,e)):_(e,((e,i)=>{for(const e of i)t.setLabelMinZoom(e.entityTexel,p)})):_(e,((e,n)=>{for(const e of n)m(e,i)?(t.setLabelMinZoom(e.entityTexel,0),s&&o.insertMetrics(e)):t.setLabelMinZoom(e.entityTexel,f)}))}}_isFiltered(t,e,i){const n=e.getFilterFlags(t),r=!i.hasFilter||!!(n&l.LY),s=null==i.featureEffect||i.featureEffect.excludedLabelsVisible||!!(n&l.g0);return!(r&&s)}_prepare(t){const e=t.attributeView,i=new Set;_(t,((n,r)=>{for(const n of r){const r=n.entityTexel;i.has(r)||(i.add(r),this._isFiltered(r,e,t.layerView)?e.setLabelMinZoom(r,f):0!==e.getLabelMinZoom(r)?e.setLabelMinZoom(r,p):e.setLabelMinZoom(r,0))}}))}_collideVisible(t,e,i,n){const r=e.attributeView,s=new Set;_(e,((e,o)=>{for(let a=0;a<o.length;a++){const l=o[a].entityTexel;if(s.has(l))continue;if(e.key.level!==n){r.setLabelMinZoom(l,f),s.add(l);continue}if(!m(o[a],i)){r.setLabelMinZoom(l,f),s.add(l);continue}if(0!==r.getLabelMinZoom(l)){s.add(l);continue}let c=!1,u=!0;const h=a;let d=a;for(;d<o.length;d++){const e=o[d];if(e.entityTexel!==l)break;if(!c)switch(t.hasCollision(e)){case 1:break;case 2:c=!0,u=!1;break;case 0:u=!1}}if(!c)for(let e=h;e<d;e++)t.insertMetrics(o[e]);a=d-1,u||(s.add(l),r.setLabelMinZoom(l,c?f:0))}}))}_collideInvisible(t,e){const i=e.attributeView,n=new Set;_(e,((e,r)=>{for(let e=0;e<r.length;e++){const s=r[e].entityTexel;if(n.has(s))continue;if(i.getLabelMinZoom(s)!==p){n.add(s);continue}let o=!1,a=!0;const l=e;let c=e;for(;c<r.length;c++){const e=r[c];if(e.entityTexel!==s)break;if(!o)switch(t.hasCollision(e)){case 1:break;case 2:o=!0,a=!1;break;case 0:a=!1}}if(!o)for(let e=l;e<c;e++)t.insertMetrics(r[e]);e=c-1,a||(n.add(s),i.setLabelMinZoom(s,o?p:0))}}))}_transformMetrics(t){for(const{container:e,geometryType:i,vvEvaluators:n}of t)_(e,((t,r)=>{const s=e.attributeView,o=t.transforms.labelMat2d;o[4]=Math.round(o[4]),o[5]=Math.round(o[5]);const a="polyline"===i;for(const t of r){const{entityTexel:e,anchorX:i,anchorY:r}=t;let u=t.referenceBounds?.size??0;const h=n[0];if(null!=h){const t=h(s.getVisualVariableData(e,c.Gn.SIZE));u=isNaN(t)||null==t||t===1/0?u:t}const d=l.C2+u/2,f=t.directionX*d,p=t.directionY*d;for(const e of t.bounds){let t=i,n=r;if(a){const s=i+e.x+f,a=r+e.y+p;t=o[0]*s+o[2]*a+o[4],n=o[1]*s+o[3]*a+o[5];const l=t,c=n;e.transformedX=Math.floor(l),e.transformedY=Math.floor(c)}else{t=o[0]*i+o[2]*r+o[4],n=o[1]*i+o[3]*r+o[5];const s=t+e.x+f,a=n+e.y+p;e.transformedX=s,e.transformedY=a}}}}))}}let y=class extends r.A{constructor(t){super(t),this._lastUpdate=0,this.collisionEngine=new g,this.lastUpdateId=-1,this.updateRequested=!1,this.view=null}get updating(){return(0,s.A)("esri-2d-log-updating")&&console.log(`Updating LabelManager ${this.updateRequested}:\n-> updateRequested: ${this.updateRequested}`),this.updateRequested}update(t){const e=performance.now();e-this._lastUpdate>=32?(this._lastUpdate=e,this.doUpdate(t)):this.requestUpdate()}viewChange(){this.requestUpdate()}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.view?.requestUpdate())}processUpdate(t){this.updateRequested&&(this.updateRequested=!1,this.update(t))}doUpdate(t){const e=this.view;if(e)try{const i=t.state.scale,n=e.featuresTilingScheme.getClosestInfoForScale(i).level;this.collisionEngine.run(e.allLayerViews.items,t,i,n)}catch(t){}}};(0,n._)([(0,o.MZ)()],y.prototype,"updateRequested",void 0),(0,n._)([(0,o.MZ)()],y.prototype,"updating",null),(0,n._)([(0,o.MZ)()],y.prototype,"view",void 0),y=(0,n._)([(0,a.$)("esri.views.2d.LabelManager")],y)},89838:function(t,e,i){i.d(e,{OP:function(){return o},V4:function(){return r},rZ:function(){return s}}),i(58941);var n=i(40633);function r(t,e,i){if(null==t)return null;const r=e.readArcadeFeature();e.contextTimeZone=i.$view?.timeZone;try{return t.evaluate({...i,$feature:r},t.services)}catch(t){return n.A.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",t),null}}function s(t){return null==t||t===1/0||t===-1/0||"number"==typeof t&&isNaN(t)}function o(t,e,i,n){if(null==t)return null!=n?n:null;const r=e.readArcadeFeature();e.contextTimeZone=i.$view?.timeZone;const o=t.evaluate({...i,$feature:r},t.services);return s(o)?null!=n?n:null:o}},53838:function(t,e,i){i.d(e,{j:function(){return m}});var n=i(39819),r=i(58941),s=i(40633),o=i(39686),a=i(7459),l=i(88413),c=i(85456),u=i(96402),h=i(12285),d=i(10956);class f{constructor(t,e,i){this._texture=null,this._lastTexture=null,this._fbos={},this.texelSize=4;const{buffer:n,pixelType:r,textureOnly:s}=t,o=(0,l.Qz)(r);this.blockIndex=i,this.pixelType=r,this.size=e,this.textureOnly=s,s||(this.data=new o(n)),this._resetRange()}destroy(){this._texture?.dispose();for(const t in this._fbos){const e=this._fbos[t];e&&("0"===t&&e.detachColorTexture(),e.dispose()),this._fbos[t]=null}this._texture=null}get _textureDesc(){const t=new d.R;return t.wrapMode=c.pF.CLAMP_TO_EDGE,t.samplingMode=c.Cj.NEAREST,t.dataType=this.pixelType,t.width=this.size,t.height=this.size,t}setData(t,e,i){const n=(0,a.Q4)(t),r=this.data,s=n*this.texelSize+e;!r||s>=r.length||(r[s]=i,this.dirtyStart=Math.min(this.dirtyStart,n),this.dirtyEnd=Math.max(this.dirtyEnd,n))}getData(t,e){if(null==this.data)return null;const i=(0,a.Q4)(t)*this.texelSize+e;return!this.data||i>=this.data.length?null:this.data[i]}getTexture(t){return this._texture??this._initTexture(t)}getFBO(t,e=0){if(!this._fbos[e]){const i=0===e?this.getTexture(t):this._textureDesc;this._fbos[e]=new u.H(t,i)}return this._fbos[e]}get hasDirty(){const t=this.dirtyStart;return this.dirtyEnd>=t}updateTexture(t,e){try{const i=this.dirtyStart,o=this.dirtyEnd;if(!this.hasDirty)return;(0,r.A)("esri-2d-update-debug")&&console.debug(`Version[${e}] AttributeStoreView.updateTexture`,{start:i,end:o,firstBytes:new Uint8Array(this.data.buffer.slice(0,16)),block:this}),this._resetRange();const a=this.data.buffer,c=this.getTexture(t),u=4,h=(i-i%this.size)/this.size,d=(o-o%this.size)/this.size,f=h,p=this.size,_=d,m=h*this.size*u,g=(p+_*this.size)*u-m,y=(0,l.Qz)(this.pixelType),v=new y(a,m*y.BYTES_PER_ELEMENT,g),x=this.size,b=_-f+1;if(b>this.size)return void s.A.getLogger("esri.views.2d.engine.webgl.AttributeStoreView").error(new n.A("mapview-webgl","Out-of-bounds index when updating AttributeData"));c.updateData(0,0,f,x,b,v)}catch(t){}}update(t){const{data:e,start:i,end:n}=t;if(null!=e&&null!=this.data){const n=this.data,r=i*this.texelSize;for(let i=0;i<e.length;i++){const s=1<<i%this.texelSize;t.layout&s&&(n[r+i]=e[i])}}this.dirtyStart=Math.min(this.dirtyStart,i),this.dirtyEnd=Math.max(this.dirtyEnd,n)}resize(t,e){const i=this.size;if(this.size=e,this.textureOnly)return void(i!==this.size&&(this._lastTexture=this._texture,this._texture=null));const n=(0,l.Qz)(this.pixelType);this.destroy(),this.data=new n(t.buffer)}_resetRange(){this.dirtyStart=2147483647,this.dirtyEnd=0}_initTexture(t){const e=new h.g(t,this._textureDesc,this.data??void 0);if(null!=this._lastTexture&&this._fbos[0]){const i=this._lastTexture.descriptor.width,n=this._lastTexture.descriptor.height,r=this._lastTexture.descriptor.dataType,s=this._lastTexture.descriptor.pixelFormat,o=this.getFBO(t),a=(0,l.AV)(r),c=new((0,l.Qz)(r))(new ArrayBuffer(i*n*a*this.texelSize)),u=t.getBoundFramebufferObject(),{x:h,y:d,width:f,height:p}=t.getViewport();t.bindFramebuffer(o),o.readPixels(0,0,i,n,s,r,c),e.updateData(0,0,0,2*i,n/2,c),t.setViewport(h,d,f,p),t.bindFramebuffer(u)}return this.destroy(),this._texture=e,this._texture}}class p{constructor(){this.size=0,this._pendingAttributeUpdates=[],this._version=0,this._epoch=0,this._locked=!1}_initialize(t){if(!t)throw new Error("InternalError: initArgs must be defined");const e=t.blockDescriptors;if(this.size=t.blockSize,(0,r.A)("esri-2d-update-debug")&&console.debug("AttributeStoreView.initialize",{message:t}),null==this._data)this._data=e.map(((t,e)=>null!=t?new f(t,this.size,e):null));else for(let t=0;t<this._data.length;t++){const i=this._data[t],n=e[t];null!=n&&(null==i?this._data[t]=new f(n,this.size,t):i.resize(n,this.size))}}destroy(){for(const t of this._data??[])t?.destroy();this._defaultTexture?.dispose(),this._defaultTexture=null,this._pendingAttributeUpdates=[]}isEmpty(){return null==this._data}getBlock(t){return null==this._data?null:this._data[t]}setLabelMinZoom(t,e){this.setData(t,o.dV.FilterFlags,1,e)}setLocalTimeOrigin(t,e){this.setData(t,o.dV.LocalTimeOrigin,0,e)}getLabelMinZoom(t){return this.getData(t,o.dV.FilterFlags,1,255)}getFilterFlags(t){return this.getData(t,o.dV.FilterFlags,0,0)}getVisualVariableData(t,e){return this.getData(t,o.dV.VV,e,0)}getData(t,e,i,n){if(!this._data)return 0;const r=this._data[e];if(null==r)return 0;const s=r.getData(t,i);return null!=s?s:n}setData(t,e,i,n){this._data[e].setData(t,i,n)}lockTextureUploads(){this._locked=!0}unlockTextureUploads(){this._locked=!1,this.update()}requestUpdate(t){this._version=t.version,this._pendingAttributeUpdates.push(t),(0,r.A)("esri-2d-update-debug")&&console.debug(`Version[${this._version}] AttributeStoreView.requestUpdate`,{message:t})}get currentEpoch(){return this._epoch}update(){if(this._locked)return;const t=this._pendingAttributeUpdates;this._pendingAttributeUpdates=[];for(const e of t){const{blockData:t,initArgs:i,sendUpdateEpoch:n,version:s}=e;(0,r.A)("esri-2d-update-debug")&&console.debug(`Version[${this._version}] Epoch[${n}] AttributeStoreView.applyUpdate`),this._version=s,this._epoch=n,null!=i&&this._initialize(i);const o=this._data;for(let e=0;e<t.length;e++){const i=t[e],n=o[e];null!=n&&null!=i&&((0,r.A)("esri-2d-update-debug")&&console.debug(`Version[${this._version}] CpuBlock[${e}] AttributeStoreView.update`,{block:i}),n.update(i))}}}getUniforms(t){return{filterFlags:{texture:this._getTexture(t,o.dV.FilterFlags),unit:o.uM},animation:{texture:this._getTexture(t,o.dV.Animation),unit:o.z2},gpgpu:{texture:this._getTexture(t,o.dV.GPGPU),unit:o.Sr},localTimeOrigin:{texture:this._getTexture(t,o.dV.LocalTimeOrigin),unit:o.zt},visualVariableData:{texture:this._getTexture(t,o.dV.VV),unit:o.nM},dataDriven0:{texture:this._getTexture(t,o.dV.DD0),unit:o.lL},dataDriven1:{texture:this._getTexture(t,o.dV.DD1),unit:o.sn},dataDriven2:{texture:this._getTexture(t,o.dV.DD2),unit:o.n9},size:this.size}}_getTexture(t,e){const i=this._data?.[e];return i?(i.updateTexture(t,this._version),i.getTexture(t)):this._getDefaultTexture(t)}_getDefaultTexture(t){if(null==this._defaultTexture){const e=new d.R;e.wrapMode=c.pF.CLAMP_TO_EDGE,e.samplingMode=c.Cj.NEAREST,e.width=1,e.height=1,this._defaultTexture=new h.g(t,e,new Uint8Array(4))}return this._defaultTexture}}var _=i(82087);class m extends _.A{constructor(t){super(t),this._statisticsByLevel=new Map,this._entityIndex=new Map,this.attributeView=new p}destroy(){this.children.forEach((t=>t.destroy())),this.removeAllChildren(),this.attributeView.destroy()}doRender(t){t.context.capabilities.enable("textureFloatLinear"),super.doRender(t)}get hasAnimations(){for(const t of this.children)if(t.hasAnimations)return!0;return!1}_reindexAndUpdateFeaturesIfNeeded(){if(this.hasAnimations&&(this._reindexFeatures(),0!==this.attributeView.size))for(const t of this._entityIndex.values())t.dirty&&(this.attributeView.setData(t.displayId,o.dV.LocalTimeOrigin,0,t.firstIndexed),t.dirty=!1)}restartAnimation(t){const e=this._entityIndex.get(t);if(!e)return;const i=performance.now()/1e3;e.firstIndexed=i,e.dirty=!0}restartAllAnimations(){const t=performance.now()/1e3;for(const[e,i]of this._entityIndex)i.firstIndexed=t,i.dirty=!0}_reindexFeatures(){const t=performance.now()/1e3;for(const e of this.children)for(const i of e.entityIds){const{objectId:e}=i;let n=this._entityIndex.get(e);n||(n={objectId:e,displayId:0,firstIndexed:t,lastIndexed:0,dirty:!0},this._entityIndex.set(e,n)),n.lastIndexed=t,n.displayId=i.displayId}for(const[e,i]of this._entityIndex)t-i.lastIndexed>60&&this._entityIndex.delete(e)}_updateAttributeView(){this.attributeView.update(),this._reindexAndUpdateFeaturesIfNeeded()}createRenderParams(t){const e=super.createRenderParams(t);return e.attributeView=this.attributeView,e.instanceStore=this._instanceStore,e.statisticsByLevel=this._statisticsByLevel,e}}},7965:function(t,e,i){i.d(e,{m:function(){return l}});var n=i(44567),r=i(87085),s=i(25090),o=i(36729),a=i(77515);class l extends a.q{constructor(){super(...arguments),this._childrenSet=new Set,this._needsSort=!1,this._children=[],this._childrenObservable=new r.I,this._effectView=null,this._highlightGradient=null}get blendMode(){return this._blendMode}set blendMode(t){this._blendMode=t,this.requestRender()}get children(){return(0,n.gc)(this._childrenObservable),this._children}get clips(){return this._clips}set clips(t){this._clips=t,this.children.forEach((e=>e.clips=t))}get computedEffects(){return this._effectView?.effects??null}get effect(){return this._effectView?.effect??""}set effect(t){(this._effectView||t)&&(this._effectView||(this._effectView=new o.$B,this.addTransitionable(this._effectView)),this._effectView.effect=t,this.requestRender())}get highlightGradient(){return this._highlightGradient}set highlightGradient(t){this._highlightGradient=t,this.requestRender()}get hasBlending(){return!!this.blendMode}get hasHighlight(){return this.children.some((t=>t.hasHighlight))}get hasLabels(){return this.children.some((t=>t.hasLabels))}get requiresDedicatedFBO(){return this.children.some((t=>"blendMode"in t&&t.blendMode&&"normal"!==t.blendMode))}get isReady(){return this.children.every((t=>t.isReady))}get sortFunction(){return this._sortFunction}set sortFunction(t){this._sortFunction=t,t&&(this._needsSort=!0)}doRender(t){const e=this.createRenderParams(t),{painter:i}=e;i.beforeRenderLayer(e,this._clips?.length?255:0,this.computedOpacity),this.renderChildren(e),i.afterRenderLayer(e,this.computedOpacity)}addChild(t){return this.addChildAt(t,this.children.length)}addChildAt(t,e=this.children.length){if(!t)return t;if(this.contains(t))return t;this._needsSort=!0;const i=t.parent;return i&&i!==this&&i.removeChild(t),e>=this.children.length?this.children.push(t):this.children.splice(e,0,t),this._childrenSet.add(t),t.parent=this,t.stage=this.stage,this!==this.stage&&(t.clips=this.clips),this.requestRender(),this._childrenObservable.notify(),t}contains(t){return(0,n.gc)(this._childrenObservable),this._childrenSet.has(t)}removeAllChildren(){this._childrenSet.clear(),this._needsSort=!0;for(const t of this.children)this!==this.stage&&(t.clips=null),t.stage=null,t.parent=null;this.children.length=0,this._childrenObservable.notify()}removeChild(t){return this.contains(t)?this.removeChildAt(this.children.indexOf(t)):t}removeChildAt(t){if(t<0||t>=this.children.length)return null;this._needsSort=!0;const e=this.children.splice(t,1)[0];return this._childrenSet.delete(e),this!==this.stage&&(e.clips=null),e.stage=null,e.parent=null,this._childrenObservable.notify(),e}beforeRender(t){super.beforeRender(t),this.sortFunction&&this._needsSort&&(this.children.sort(this.sortFunction),this._needsSort=!1,this._childrenObservable.notify());for(const e of this.children)e.beforeRender(t)}afterRender(t){super.afterRender(t);for(const e of this.children)e.afterRender(t)}_createTransforms(){return{displayViewScreenMat3:(0,s.vt)()}}onAttach(){super.onAttach();const t=this.stage;for(const e of this.children)e.stage=t}onDetach(){super.onDetach();for(const t of this.children)t.stage=null}renderChildren(t){for(const e of this.children)e.processRender(t)}createRenderParams(t){return{...t,requireFBO:this.requiresDedicatedFBO,blendMode:this.blendMode,effects:this.computedEffects,globalOpacity:t.globalOpacity*this.computedOpacity,inFadeTransition:this.inFadeTransition,highlightGradient:this._highlightGradient||t.highlightGradient}}isTransitioning(){return super.isTransitioning()||this.children.some((t=>t.transitioning))}}},77515:function(t,e,i){i.d(e,{q:function(){return o}});var n=i(50659),r=i(48996),s=i(86668);class o extends r.A{constructor(){super(...arguments),this._transitionables=null,this._clips=null,this._fadeTransition=null,this._isReady=!1,this._opacity=1,this.parent=null,this._stage=null,this._visible=!0}get computedOpacity(){return this._fadeTransition?.computedOpacity??this.opacity}get clips(){return this._clips}set clips(t){this._clips=t,this.requestRender()}get fadeTransitionEnabled(){return null!==this._fadeTransition}set fadeTransitionEnabled(t){!this._fadeTransition&&t?(this._fadeTransition=new s.A({opacity:this.opacity,visible:this.visible}),this.addTransitionable(this._fadeTransition)):this._fadeTransition&&!t&&(this.removeTransitionable(this._fadeTransition),this._fadeTransition=null)}get inFadeTransition(){return this._fadeTransition?.transitioning??!1}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(t){this._opacity!==t&&(this._opacity=Math.min(1,Math.max(t,0)),this._fadeTransition&&(this._fadeTransition.opacity=this._opacity),this.requestRender())}get stage(){return this._stage}set stage(t){if(this._stage===t)return;const e=this._stage;this._stage=t,t?this._stage?.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):e?.trashDisplayObject(this)}get transforms(){return null==this._transforms&&(this._transforms=this._createTransforms()),this._transforms}get transitioning(){return this.isTransitioning()}get visible(){return this._visible}set visible(t){this._visible!==t&&(this._visible=t,this._fadeTransition&&(this._fadeTransition.visible=this._visible),this.requestRender())}get hasLabels(){return!1}get hasHighlight(){return!1}get hasBlending(){return!1}addTransitionable(t){this._transitionables??=[],this._transitionables.push(t),this.requestRender()}removeTransitionable(t){t.endTransition(),this._transitionables&&(0,n.TF)(this._transitionables,t),this.requestRender()}fadeIn(){this.fadeTransitionEnabled=!0;const t=this._fadeTransition.fadeIn();return this.opacity=1,this.requestRender(),t}fadeOut(){this.fadeTransitionEnabled=!0;const t=this._fadeTransition.fadeOut();return this.opacity=0,this.requestRender(),t}endTransitions(){if(this._transitionables){for(const t of this._transitionables)t.endTransition();this.requestRender()}}beforeRender(t){this.transitionStep(t.deltaTime,t.state.scale),this.setTransform(t.state)}afterRender(t){this.transitioning&&this.requestRender()}remove(){this.parent?.removeChild(this)}setTransform(t){}processRender(t){this.stage&&(this._fadeTransition?.computedVisible??this.visible)&&this.doRender(t)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this.endTransitions(),this.onDetach(),this.emit("detach")}isTransitioning(){return this._transitionables?.some((t=>t.transitioning))??!1}transitionStep(t,e){if(this._transitionables)for(const i of this._transitionables)i.transitionStep(t,e)}onAttach(){}onDetach(){}doRender(t){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}}},80708:function(t,e,i){i.d(e,{d:function(){return I}});var n=i(73936),r=i(43745),s=i(88413),o=i(52937),a=i(94020),l=i(85456),c=i(10904);class u extends o.A{constructor(){super(...arguments),this._color=(0,r.fA)(0,1,0,1)}dispose(){this._program&&this._program.dispose()}prepareState({context:t}){t.setStencilTestEnabled(!0),t.setBlendingEnabled(!1),t.setFaceCullingEnabled(!1),t.setColorMask(!1,!1,!1,!1),t.setStencilOp(l.eA.KEEP,l.eA.KEEP,l.eA.REPLACE),t.setStencilWriteMask(255),t.setStencilFunction(l.MT.ALWAYS,0,255)}draw(t,e){const{context:i,state:n,requestRender:r,allowDelayedRender:o}=t,u=(0,s.ES)("clip",{geometry:[{location:0,name:"a_pos",count:2,type:l.pe.SHORT}]}),h=e.getVAO(i,n,u.attributes,u.bufferLayouts);null!=h.indexBuffer&&(this._program||(this._program=(0,c.r)(i,a.T)),!o||null==r||this._program.compiled?(i.useProgram(this._program),this._program.setUniform2fv("u_coord_range",[1,1]),this._program.setUniform4fv("u_color",this._color),this._program.setUniformMatrix3fv("u_dvsMat3",n.displayMat3),i.bindVAO(h),i.drawElements(l.WR.TRIANGLES,h.indexBuffer.size,l.pe.UNSIGNED_INT,0),i.bindVAO()):r())}}var h=i(829),d=i(55382),f=i(15774),p=i(25090),_=i(39686),m=i(86305),g=i(81438);class y extends o.A{constructor(){super(...arguments),this._color=(0,r.fA)(1,0,0,1),this._patternMatrix=(0,p.vt)(),this._programOptions={id:!1,pattern:!1}}dispose(){this._vao&&(this._vao.dispose(),this._vao=null)}drawMany(t,e){const{context:i,painter:n,requestRender:r,allowDelayedRender:s}=t;this._loadWGLResources(t);const o=t.displayLevel,a=t.styleLayer,c=a.backgroundMaterial,u=n.vectorTilesMaterialManager,h=a.getPaintValue("background-color",o),d=a.getPaintValue("background-opacity",o),p=a.getPaintValue("background-pattern",o),m=void 0!==p,g=1|window.devicePixelRatio,y=t.spriteMosaic;let v,x;const b=g>_.C_?2:1,S=this._programOptions;S.pattern=m;const w=u.getMaterialProgram(i,c,S);if(!s||null==r||w.compiled){if(i.bindVAO(this._vao),i.useProgram(w),m){const t=y.getMosaicItemPosition(p,!0);if(null!=t){const{tl:e,br:n,page:r}=t;v=n[0]-e[0],x=n[1]-e[1];const s=y.getPageSize(r);null!=s&&(y.bind(i,l.Cj.LINEAR,r,_.$U),w.setUniform4f("u_tlbr",e[0],e[1],n[0],n[1]),w.setUniform2fv("u_mosaicSize",s),w.setUniform1i("u_texture",_.$U))}w.setUniform1f("u_opacity",d)}else{const t=h[3]*d;this._color[0]=t*h[0],this._color[1]=t*h[1],this._color[2]=t*h[2],this._color[3]=t,w.setUniform4fv("u_color",this._color)}w.setUniform1f("u_depth",a.z||0);for(const t of e){if(w.setUniform1f("u_coord_range",t.rangeX),w.setUniformMatrix3fv("u_dvsMat3",t.transforms.displayViewScreenMat3),m){const e=Math.max(2**(Math.round(o)-t.key.level),1),i=b*t.width*e,n=i/(0,f.yR)(v),r=i/(0,f.yR)(x);this._patternMatrix[0]=n,this._patternMatrix[4]=r,w.setUniformMatrix3fv("u_pattern_matrix",this._patternMatrix)}i.setStencilFunction(l.MT.EQUAL,0,255),i.drawArrays(l.WR.TRIANGLE_STRIP,0,4)}}else r()}_loadWGLResources(t){if(this._vao)return;const{context:e,styleLayer:i}=t,n=i.backgroundMaterial,r=new Int8Array([0,0,1,0,0,1,1,1]),s=m.g.createVertex(e,l._U.STATIC_DRAW,r),o=new g.Z(e,n.getAttributeLocations(),n.getLayoutInfo(),new Map([["geometry",s]]));this._vao=o}}var v=i(5367);class x extends o.A{constructor(){super(...arguments),this._programOptions={id:!1}}dispose(){}drawMany(t,e){const{context:i,displayLevel:n,requiredLevel:r,state:s,painter:o,spriteMosaic:a,styleLayerUID:c,requestRender:u,allowDelayedRender:h}=t;if(!e.some((t=>t.layerData.get(c)?.circleIndexCount??!1)))return;const d=t.styleLayer,f=d.circleMaterial,p=o.vectorTilesMaterialManager,_=d.getPaintValue("circle-translate",n),m=d.getPaintValue("circle-translate-anchor",n),g=this._programOptions,y=p.getMaterialProgram(i,f,g);if(h&&null!=u&&!y.compiled)return void u();i.useProgram(y),y.setUniformMatrix3fv("u_displayMat3",m===v.Cq.VIEWPORT?s.displayMat3:s.displayViewMat3),y.setUniform2fv("u_circleTranslation",_),y.setUniform1f("u_depth",d.z),y.setUniform1f("u_antialiasingWidth",1.2);let x=-1;for(const t of e){if(!t.layerData.has(c))continue;t.key.level!==x&&(x=t.key.level,f.setDataUniforms(y,n,d,x,a));const e=t.layerData.get(c);if(!e.circleIndexCount)continue;e.prepareForRendering(i);const s=e.vao;null!=s&&(i.bindVAO(s),y.setUniformMatrix3fv("u_dvsMat3",t.transforms.displayViewScreenMat3),r!==t.key.level?i.setStencilFunction(l.MT.EQUAL,t.stencilRef,255):i.setStencilFunction(l.MT.GREATER,255,255),i.drawElements(l.WR.TRIANGLES,e.circleIndexCount,l.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*e.circleIndexStart),t.triangleCount+=e.circleIndexCount/3)}}}const b=1/65536;class S extends o.A{constructor(){super(...arguments),this._fillProgramOptions={id:!1,pattern:!1},this._outlineProgramOptions={id:!1}}dispose(){}drawMany(t,e){const{displayLevel:i,renderPass:n,spriteMosaic:r,styleLayerUID:s}=t;let o=!1;for(const t of e)if(t.layerData.has(s)){const e=t.layerData.get(s);if(e.fillIndexCount>0||e.outlineIndexCount>0){o=!0;break}}if(!o)return;const a=t.styleLayer,l=a.getPaintProperty("fill-pattern"),c=void 0!==l,u=c&&l.isDataDriven;let h;if(c&&!u){const t=l.getValue(i);h=r.getMosaicItemPosition(t,!0)}const d=!c&&a.getPaintValue("fill-antialias",i);let f=!0,p=1;if(!c){const t=a.getPaintProperty("fill-color"),e=a.getPaintProperty("fill-opacity");if(!t?.isDataDriven&&!e?.isDataDriven){const t=a.getPaintValue("fill-color",i);p=a.getPaintValue("fill-opacity",i)*t[3],p>=1&&(f=!1)}}if(f&&"opaque"===n)return;const _=a.getPaintValue("fill-translate",i),m=a.getPaintValue("fill-translate-anchor",i);(f||"translucent"!==n)&&this._drawFill(t,s,a,e,_,m,c,h,u);const g=!a.hasDataDrivenOutlineColor&&a.outlineUsesFillColor&&p<1;d&&"opaque"!==n&&!g&&this._drawOutline(t,s,a,e,_,m)}_drawFill(t,e,i,n,r,s,o,a,c){if(o&&!c&&null==a)return;const{context:u,displayLevel:h,state:d,painter:f,pixelRatio:p,spriteMosaic:m,requestRender:g,allowDelayedRender:y}=t,x=i.fillMaterial,S=f.vectorTilesMaterialManager,w=p>_.C_?2:1,T=this._fillProgramOptions;T.pattern=o;const M=S.getMaterialProgram(u,x,T);if(y&&null!=g&&!M.compiled)return void g();if(u.useProgram(M),null!=a){const{page:t}=a,e=m.getPageSize(t);null!=e&&(m.bind(u,l.Cj.LINEAR,t,_.$U),M.setUniform2fv("u_mosaicSize",e),M.setUniform1i("u_texture",_.$U))}M.setUniformMatrix3fv("u_displayMat3",s===v.Cq.VIEWPORT?d.displayMat3:d.displayViewMat3),M.setUniform2fv("u_fillTranslation",r),M.setUniform1f("u_depth",i.z+b);let P=-1;for(const t of n){if(!t.layerData.has(e))continue;t.key.level!==P&&(P=t.key.level,x.setDataUniforms(M,h,i,P,m));const n=t.layerData.get(e);if(!n.fillIndexCount)continue;n.prepareForRendering(u);const r=n.fillVAO;if(null!=r){if(u.bindVAO(r),M.setUniformMatrix3fv("u_dvsMat3",t.transforms.displayViewScreenMat3),u.setStencilFunction(l.MT.EQUAL,t.stencilRef,255),o){const e=Math.max(2**(Math.round(h)-t.key.level),1),i=t.rangeX/(w*t.width*e);M.setUniform1f("u_patternFactor",i)}if(c){const t=n.patternMap;if(!t)continue;for(const[e,i]of t){const t=m.getPageSize(e);null!=t&&(m.bind(u,l.Cj.LINEAR,e,_.$U),M.setUniform2fv("u_mosaicSize",t),M.setUniform1i("u_texture",_.$U),u.drawElements(l.WR.TRIANGLES,i[1],l.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*i[0]))}}else u.drawElements(l.WR.TRIANGLES,n.fillIndexCount,l.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*n.fillIndexStart);t.triangleCount+=n.fillIndexCount/3}}}_drawOutline(t,e,i,n,r,s){const{context:o,displayLevel:a,state:c,painter:u,pixelRatio:h,spriteMosaic:d,requestRender:f,allowDelayedRender:p}=t,_=i.outlineMaterial,m=u.vectorTilesMaterialManager,g=.75/h,y=this._outlineProgramOptions,x=m.getMaterialProgram(o,_,y);if(p&&null!=f&&!x.compiled)return void f();o.useProgram(x),x.setUniformMatrix3fv("u_displayMat3",s===v.Cq.VIEWPORT?c.displayMat3:c.displayViewMat3),x.setUniform2fv("u_fillTranslation",r),x.setUniform1f("u_depth",i.z+b),x.setUniform1f("u_outline_width",g);let S=-1;for(const t of n){if(!t.layerData.has(e))continue;t.key.level!==S&&(S=t.key.level,_.setDataUniforms(x,a,i,S,d));const n=t.layerData.get(e);if(n.prepareForRendering(o),!n.outlineIndexCount)continue;const r=n.outlineVAO;null!=r&&(o.bindVAO(r),x.setUniformMatrix3fv("u_dvsMat3",t.transforms.displayViewScreenMat3),o.setStencilFunction(l.MT.EQUAL,t.stencilRef,255),o.drawElements(l.WR.TRIANGLES,n.outlineIndexCount,l.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*n.outlineIndexStart),t.triangleCount+=n.outlineIndexCount/3)}}}class w extends o.A{constructor(){super(...arguments),this._programOptions={id:!1,pattern:!1,sdf:!1}}dispose(){}drawMany(t,e){const{context:i,displayLevel:n,state:r,painter:s,pixelRatio:o,spriteMosaic:a,styleLayerUID:c,requestRender:u,allowDelayedRender:h}=t;if(!e.some((t=>t.layerData.get(c)?.lineIndexCount??!1)))return;const d=t.styleLayer,f=d.lineMaterial,p=s.vectorTilesMaterialManager,m=d.getPaintValue("line-translate",n),g=d.getPaintValue("line-translate-anchor",n),y=d.getPaintProperty("line-pattern"),x=void 0!==y,b=x&&y.isDataDriven;let S,w;if(x&&!b){const t=y.getValue(n);S=a.getMosaicItemPosition(t)}let T=!1;if(!x){const t=d.getPaintProperty("line-dasharray");if(w=void 0!==t,T=w&&t.isDataDriven,w&&!T){const e=t.getValue(n),i=d.getDashKey(e,d.getLayoutValue("line-cap",n));S=a.getMosaicItemPosition(i)}}const M=1/o,P=this._programOptions;P.pattern=x,P.sdf=w;const A=p.getMaterialProgram(i,f,P);if(h&&null!=u&&!A.compiled)return void u();if(i.useProgram(A),A.setUniformMatrix3fv("u_displayViewMat3",r.displayViewMat3),A.setUniformMatrix3fv("u_displayMat3",g===v.Cq.VIEWPORT?r.displayMat3:r.displayViewMat3),A.setUniform2fv("u_lineTranslation",m),A.setUniform1f("u_depth",d.z),A.setUniform1f("u_antialiasing",M),S&&null!=S){const{page:t}=S,e=a.getPageSize(t);null!=e&&(a.bind(i,l.Cj.LINEAR,t,_.$U),A.setUniform2fv("u_mosaicSize",e),A.setUniform1i("u_texture",_.$U))}let C=-1;for(const t of e){if(!t.layerData.has(c))continue;t.key.level!==C&&(C=t.key.level,f.setDataUniforms(A,n,d,C,a));const e=2**(n-C)/o;A.setUniform1f("u_zoomFactor",e);const r=t.layerData.get(c);if(!r.lineIndexCount)continue;r.prepareForRendering(i);const s=r.vao;if(null!=s){if(i.bindVAO(s),A.setUniformMatrix3fv("u_dvsMat3",t.transforms.displayViewScreenMat3),i.setStencilFunction(l.MT.EQUAL,t.stencilRef,255),b||T){const t=r.patternMap;if(!t)continue;for(const[e,n]of t){const t=a.getPageSize(e);null!=t&&(a.bind(i,l.Cj.LINEAR,e,_.$U),A.setUniform2fv("u_mosaicSize",t),A.setUniform1i("u_texture",_.$U),i.drawElements(l.WR.TRIANGLES,n[1],l.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*n[0]))}}else i.drawElements(l.WR.TRIANGLES,r.lineIndexCount,l.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*r.lineIndexStart);t.triangleCount+=r.lineIndexCount/3}}}}var T=i(14583),M=i(92422),P=i(36753);const A=1/65536;class C extends o.A{constructor(){super(...arguments),this._iconProgramOptions={id:!1,sdf:!1},this._sdfProgramOptions={id:!1},this._spritesTextureSize=(0,T.vt)()}dispose(){}drawMany(t,e){const i=t.styleLayer;this._drawIcons(t,i,e),this._drawText(t,i,e)}_drawIcons(t,e,i){const{context:n,displayLevel:r,painter:s,spriteMosaic:o,state:a,styleLayerUID:l,requestRender:c,allowDelayedRender:u}=t,h=e.iconMaterial,d=s.vectorTilesMaterialManager;let f,p=!1;for(const t of i)if(t.layerData.has(l)&&(f=t.layerData.get(l),f.iconPerPageElementsMap.size>0)){p=!0;break}if(!p)return;const m=e.getPaintValue("icon-translate",r),g=e.getPaintValue("icon-translate-anchor",r);let y=e.getLayoutValue("icon-rotation-alignment",r);y===v.I5.AUTO&&(y=e.getLayoutValue("symbol-placement",r)===v.kt.POINT?v.I5.VIEWPORT:v.I5.MAP);const x=y===v.I5.MAP,b=e.getLayoutValue("icon-keep-upright",r)&&x,S=f.isIconSDF,w=this._iconProgramOptions;w.sdf=S;const T=d.getMaterialProgram(n,h,w);if(u&&null!=c&&!T.compiled)return void c();n.useProgram(T),T.setUniformMatrix3fv("u_displayViewMat3",y===v.I5.MAP?a.displayViewMat3:a.displayMat3),T.setUniformMatrix3fv("u_displayMat3",g===v.Cq.VIEWPORT?a.displayMat3:a.displayViewMat3),T.setUniform2fv("u_iconTranslation",m),T.setUniform1f("u_depth",e.z),T.setUniform1f("u_mapRotation",(0,P.wV)(a.rotation)),T.setUniform1f("u_keepUpright",b?1:0),T.setUniform1f("u_level",10*r),T.setUniform1i("u_texture",_.$U),T.setUniform1f("u_fadeDuration",M.zk/1e3);let A=-1;for(const s of i){if(!s.layerData.has(l))continue;if(s.key.level!==A&&(A=s.key.level,h.setDataUniforms(T,r,e,A,o)),f=s.layerData.get(l),0===f.iconPerPageElementsMap.size)continue;f.prepareForRendering(n),f.updateOpacityInfo();const i=f.iconVAO;if(null!=i){n.bindVAO(i),T.setUniformMatrix3fv("u_dvsMat3",s.transforms.displayViewScreenMat3),T.setUniform1f("u_time",(performance.now()-f.lastOpacityUpdate)/1e3);for(const[e,i]of f.iconPerPageElementsMap)this._renderIconRange(t,T,i,e,s)}}}_renderIconRange(t,e,i,n,r){const{context:s,spriteMosaic:o}=t;this._spritesTextureSize[0]=o.getWidth(n)/4,this._spritesTextureSize[1]=o.getHeight(n)/4,e.setUniform2fv("u_mosaicSize",this._spritesTextureSize),o.bind(s,l.Cj.LINEAR,n,_.$U),this._setStencilState(t,r),s.drawElements(l.WR.TRIANGLES,i[1],l.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*i[0]),r.triangleCount+=i[1]/3}_drawText(t,e,i){const{context:n,displayLevel:r,glyphMosaic:s,painter:o,pixelRatio:a,spriteMosaic:l,state:c,styleLayerUID:u,requestRender:h,allowDelayedRender:d}=t,f=e.textMaterial,p=o.vectorTilesMaterialManager;let m,g=!1;for(const t of i)if(t.layerData.has(u)&&(m=t.layerData.get(u),m.glyphPerPageElementsMap.size>0)){g=!0;break}if(!g)return;const y=e.getPaintProperty("text-opacity");if(y&&!y.isDataDriven&&0===y.getValue(r))return;const x=e.getPaintProperty("text-color"),b=!x||x.isDataDriven||x.getValue(r)[3]>0,S=e.getPaintProperty("text-halo-width"),w=e.getPaintProperty("text-halo-color"),C=(!S||S.isDataDriven||S.getValue(r)>0)&&(!w||w.isDataDriven||w.getValue(r)[3]>0);if(!b&&!C)return;let I=e.getLayoutValue("text-rotation-alignment",r);I===v.I5.AUTO&&(I=e.getLayoutValue("symbol-placement",r)===v.kt.POINT?v.I5.VIEWPORT:v.I5.MAP);const E=I===v.I5.MAP,R=e.getLayoutValue("text-keep-upright",r)&&E,O=.8*3/a;this._glyphTextureSize||(this._glyphTextureSize=(0,T.fA)(s.width/4,s.height/4));const F=e.getPaintValue("text-translate",r),z=e.getPaintValue("text-translate-anchor",r),D=this._sdfProgramOptions,L=p.getMaterialProgram(n,f,D);if(d&&null!=h&&!L.compiled)return void h();n.useProgram(L),L.setUniformMatrix3fv("u_displayViewMat3",I===v.I5.MAP?c.displayViewMat3:c.displayMat3),L.setUniformMatrix3fv("u_displayMat3",z===v.Cq.VIEWPORT?c.displayMat3:c.displayViewMat3),L.setUniform2fv("u_textTranslation",F),L.setUniform1f("u_depth",e.z+A),L.setUniform2fv("u_mosaicSize",this._glyphTextureSize),L.setUniform1f("u_mapRotation",(0,P.wV)(c.rotation)),L.setUniform1f("u_keepUpright",R?1:0),L.setUniform1f("u_level",10*r),L.setUniform1i("u_texture",_.mg),L.setUniform1f("u_antialiasingWidth",O),L.setUniform1f("u_fadeDuration",M.zk/1e3);let k=-1;for(const o of i){if(!o.layerData.has(u))continue;if(o.key.level!==k&&(k=o.key.level,f.setDataUniforms(L,r,e,k,l)),m=o.layerData.get(u),0===m.glyphPerPageElementsMap.size)continue;m.prepareForRendering(n),m.updateOpacityInfo();const i=m.textVAO;if(null==i)continue;n.bindVAO(i),L.setUniformMatrix3fv("u_dvsMat3",o.transforms.displayViewScreenMat3),this._setStencilState(t,o);const a=(performance.now()-m.lastOpacityUpdate)/1e3;L.setUniform1f("u_time",a),m.glyphPerPageElementsMap.forEach(((t,e)=>{this._renderGlyphRange(n,t,e,s,L,C,b,o)}))}}_renderGlyphRange(t,e,i,n,r,s,o,a){n.bind(t,l.Cj.LINEAR,i,_.mg),s&&(r.setUniform1f("u_halo",1),t.drawElements(l.WR.TRIANGLES,e[1],l.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*e[0]),a.triangleCount+=e[1]/3),o&&(r.setUniform1f("u_halo",0),t.drawElements(l.WR.TRIANGLES,e[1],l.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*e[0]),a.triangleCount+=e[1]/3)}_setStencilState(t,e){const{context:i,is3D:n,stencilSymbols:r}=t;if(i.setStencilTestEnabled(!0),r)return i.setStencilWriteMask(255),void i.setStencilFunction(l.MT.ALWAYS,e.stencilRef,255);i.setStencilWriteMask(0),n?i.setStencilFunction(l.MT.EQUAL,e.stencilRef,255):i.setStencilFunction(l.MT.GREATER,255,255)}}const I={clip:u,stencil:h.A,bitmap:n.A,tileDebugInfo:d.A,vtlBackground:y,vtlFill:S,vtlLine:w,vtlCircle:x,vtlSymbol:C}},16043:function(t,e,i){function n(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function r(){const t=n("svg");return t.setAttribute("style","position: absolute;"),t.setAttribute("width","0"),t.setAttribute("height","0"),t.setAttribute("aria-hidden","true"),t.setAttribute("role","presentation"),document.body.appendChild(t),t}function s(t){return null!=t&&document.body.removeChild(t),null}i.d(e,{FJ:function(){return n},p:function(){return r},pK:function(){return s}})},86668:function(t,e,i){i.d(e,{A:function(){return c}});var n=i(53804),r=i(83525),s=i(58941),o=i(60539),a=i(23502),l=(i(40633),i(13798),i(65953));let c=class extends r.A{constructor(t){super(t),this.computedOpacity=1,this.computedVisible=!0,this.opacity=1,this.visible=!0,this._fadeOutResolver=null,this._fadeInResolver=null}get transitioning(){return(this._fadeOutResolver||!this.visible?0:this.opacity)!==this.computedOpacity}endTransition(){this._fadeInResolver?.(),this._fadeOutResolver?.(),this._fadeInResolver=this._fadeOutResolver=null,this.computedOpacity=this.visible?this.opacity:0}fadeIn(){return this._fadeInResolver||(this.opacity=1,this.computedOpacity=0,this._fadeOutResolver?.(),this._fadeOutResolver=null,this._fadeInResolver=(0,o.Tw)()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this.opacity=0,this._fadeInResolver?.(),this._fadeInResolver=null,this._fadeOutResolver=(0,o.Tw)()),this._fadeOutResolver.promise}transitionStep(t,e){const i=(0,s.A)("mapview-transitions-duration"),n=i?1/i:0;if(0===n)this.computedOpacity=this.opacity,this.computedVisible=this.visible;else{const e=this._fadeOutResolver||!this.visible?0:this.opacity,i=this.computedOpacity;if(i===e)this.computedVisible=this.visible;else{const r=t*n;this.computedOpacity=i>e?Math.max(e,i-r):Math.min(e,i+r),this.computedVisible=this.computedOpacity>0}}this.transitioning||(this._fadeInResolver?.(),this._fadeOutResolver?.(),this._fadeOutResolver=this._fadeInResolver=null)}};(0,n._)([(0,a.MZ)()],c.prototype,"computedOpacity",void 0),(0,n._)([(0,a.MZ)()],c.prototype,"computedVisible",void 0),(0,n._)([(0,a.MZ)()],c.prototype,"opacity",void 0),(0,n._)([(0,a.MZ)()],c.prototype,"visible",void 0),(0,n._)([(0,a.MZ)()],c.prototype,"transitioning",null),(0,n._)([(0,a.MZ)()],c.prototype,"_fadeOutResolver",void 0),(0,n._)([(0,a.MZ)()],c.prototype,"_fadeInResolver",void 0),c=(0,n._)([(0,l.$)("esri.views.2d.engine.transitions.FadeTransition")],c)},92422:function(t,e,i){i.d(e,{IT:function(){return n},av:function(){return s},o2:function(){return r},zk:function(){return o}});const n=!0,r=32,s=1.5,o=200},58013:function(t,e,i){i.d(e,{u:function(){return f}});var n=i(67348),r=i(10793),s=i(44705),o=i(25090),a=i(20551),l=i(43274),c=i(39686),u=i(54631);const h=(0,o.vt)(),d=(0,l.vt)();class f extends u.Y{constructor(t,e,i,n){super(t,e,i,n,c.CQ,c.CQ)}destroy(){super.destroy()}setTransform(t){const e=this.resolution/t.resolution,i=this.transforms.tileMat3,[o,a]=t.toScreenNoRotation([0,0],[this.x,this.y]),l=this.width/this.rangeX*e,c=this.height/this.rangeY*e;(0,s.hZ)(i,l,0,0,0,c,0,o,a,1),(0,s.lw)(this.transforms.displayViewScreenMat3,t.displayViewMat3,i);const u=(0,n.hZ)((0,r.vt)(),l,0,0,c,o,a);(0,n.lw)(this.transforms.labelMat2d,t.viewMat2d,u)}_createTransforms(){return{labelMat2d:(0,r.vt)(),tileMat3:(0,o.vt)(),displayViewScreenMat3:(0,o.vt)()}}containsScreenPoint(t,e,i){const n=(0,s.lw)(h,t.viewMat3,this.transforms.tileMat3),r=(0,s.B8)(h,n);if(null==r)return!0;(0,a.i)(d,...e,1);const o=(0,a.q)(d,d,r),l=i*(this.resolution/t.resolution);return o[0]>=-l&&o[0]<this.width+l&&o[1]>=-l&&o[1]<this.height+l}}},94860:function(t,e,i){i.d(e,{Pd:function(){return s},VS:function(){return a},oI:function(){return o}});var n=i(85456),r=i(3817);const s=new Map([["geometry",[new r._("a_pos",2,n.pe.BYTE,0,2)]]]),o=new Map([["geometry",[new r._("a_pos",2,n.pe.BYTE,0,4),new r._("a_tex",2,n.pe.BYTE,2,4)]]]),a=new Map([["geometry",[new r._("a_pos",2,n.pe.UNSIGNED_SHORT,0,4)]]])},46065:function(t,e,i){i.d(e,{A:function(){return s}});var n=i(88231),r=i(24964);class s{constructor(t,e){this.id=t,this.sortKey=e,this.records=[]}serialize(t){return t.push(this.id),t.writeF32(this.sortKey),(0,r.j)(t,this.records),t}static deserialize(t){const e=t.readInt32(),i=t.readF32(),o=new s(e,i);return o.records=(0,r._)(t,n.A)??[],o}}s.byteSizeHint=2*Uint32Array.BYTES_PER_ELEMENT+n.A.byteSizeHint},7459:function(t,e,i){i.d(e,{KQ:function(){return n},Q4:function(){return s},Ss:function(){return o}});const n=8388607,r=8388608,s=t=>t&n;function o(t,e){return((e?r:0)|t)>>>0}},88231:function(t,e,i){i.d(e,{A:function(){return n}});class n{constructor(t,e,i,n,r,s,o){this.instanceId=t,this.textureKey=e,this.indexStart=i,this.indexCount=n,this.vertexStart=r,this.vertexCount=s,this.overlaps=o}updateBaseOffsets(t){this.vertexStart+=t.vertexFrom,this.indexStart+=t.indexFrom}clone(){return new n(this.instanceId,this.textureKey,this.indexStart,this.indexCount,this.vertexStart,this.vertexCount,this.overlaps)}static write(t,e,i,n,r,s,o,a){t.push(e),t.push(i),t.push(n),t.push(r),t.push(s),t.push(o),t.push(a)}serialize(t){return t.push(this.instanceId),t.push(this.textureKey),t.push(this.indexStart),t.push(this.indexCount),t.push(this.vertexStart),t.push(this.vertexCount),t.push(this.overlaps),t}static deserialize(t){const e=t.readInt32(),i=t.readInt32(),r=t.readInt32(),s=t.readInt32(),o=t.readInt32(),a=t.readInt32(),l=t.readInt32();return new n(e,i,r,s,o,a,l)}}n.byteSizeHint=7*Uint32Array.BYTES_PER_ELEMENT},27657:function(t,e,i){i.d(e,{R:function(){return R}});var n=i(58941),r=i(40633),s=i(10793),o=i(58013),a=i(39686),l=i(46065),c=i(28230),u=i(83258),h=i(86847),d=i(85456);function f(t,e){return t<<16|255&e}class p{constructor(t,e,i,n,r){this.instance=t,this.materialKey=e,this.target=i,this.start=n,this.count=r}get textureKey(){return 255&this.materialKey}get indexEnd(){return this.start+this.count}extend(t){this.count+=t}render(t){this.instance.techniqueRef.render(t,this)}getStencilReference(){return this.target.stencilRef}getAttributePrecisionPackFactors(){const t=this.instance.instanceId;return this.target.getMesh(t).getAttributePrecisionPackFactors()}draw(t,e){(0,h.Eq)(t)?this.drawCompute(t.context,e):this.drawGeometry(t.context,e)}drawCompute(t,e){const i=this.instance.instanceId,n=this.target.getMesh(i).getComputeVAO(t,e),r=this.start*Uint32Array.BYTES_PER_ELEMENT/3;t.bindVAO(n),t.drawElements(d.WR.POINTS,this.count/3,d.pe.UNSIGNED_INT,r),t.bindVAO(null)}drawGeometry(t,e){const i=this.instance.instanceId,n=this.target.getMesh(i).getGeometryVAO(t,e),r=this.start*Uint32Array.BYTES_PER_ELEMENT;t.bindVAO(n),t.drawElements(d.WR.TRIANGLES,this.count,d.pe.UNSIGNED_INT,r),t.bindVAO(null)}}class _{constructor(){this._length=0,this._minOrderedLength=0,this._materialKeys=new Set}static fromDisplayEntities(t,e,i,n){const r=new _;for(const s of t.values())for(const t of s.records){const s=i.getInstance(t.instanceId),o=f(s.instanceId,t.textureKey);r.addRecord(s,o,t.indexStart,t.indexCount,t.vertexStart,t.vertexCount,e,n)}return r}get length(){return this._length}get minOrderedLength(){return this._minOrderedLength}get minUnorderedLength(){return this._materialKeys.size}render(t,e){const{drawPhase:i}=t;for(const n of this.infos()){const r=n.instance.techniqueRef;r.drawPhase&i&&(null==e||r.type===e)&&n.render(t)}}addRecord(t,e,i,n,r,s,o,a){let l=i,h=n;if(h||(l=r,h=s),!h)return;if(null==this._head){const i=new p(t,e,o,l,h);return this._head=new u.B(i),this._tail=this._head,this._length++,void this._minOrderedLength++}if(a===c.ch.STRICT_ORDER)return this._insert(t,e,o,l,h,this._tail,null);let d=null,f=this._head;const _=t.instanceId,m=t.techniqueRef.symbologyPlane;if(a===c.ch.STRICT_MARKERS_AND_TEXT&&(m===c.uC.MARKER||m===c.uC.TEXT))return this._insert(t,e,o,l,h,this._tail,null);for(;f;){const i=f.data.instance,n=i.instanceId,r=i.techniqueRef.symbologyPlane,s=d?.data.instance.instanceId;if(m<r||_===s&&_!==n)return this._insert(t,e,o,l,h,d,f);d=f,f=f.next}this._insert(t,e,o,l,h,d,null)}*infos(){if(null!=this._head)for(const t of this._head.values())yield t}_insert(t,e,i,n,r,s,o){if(null==s&&null==o){const s=new p(t,e,i,n,r);return this._head=new u.B(s),this._tail=this._head,this._length++,void this._minOrderedLength++}return e!==this._tail.data.materialKey&&this._minOrderedLength++,this._materialKeys.add(e),null==s&&null!=o?this._insertAtHead(t,e,i,n,r,o):null!=s&&null==o?this._insertAtEnd(t,e,i,n,r,s):null!=s&&null!=o?this._insertAtMiddle(t,e,i,n,r,s,o):void 0}_insertAtHead(t,e,i,n,r,s){const o=n+r;if(e===s.data.materialKey&&i===s.data.target&&o===s.data.start)s.data.start=n,s.data.count+=r;else{const o=new p(t,e,i,n,r);this._head=new u.B(o),this._head.next=s,this._length++}}_insertAtEnd(t,e,i,n,r,s){if(s.data.materialKey===e&&s.data.indexEnd===n)s.data.count+=r;else{const o=new p(t,e,i,n,r);this._tail=new u.B(o),s.next=this._tail,this._length++}}_insertAtMiddle(t,e,i,n,r,s,o){const a=n+r;if(s.data.materialKey===e&&s.data.target===i&&s.data.indexEnd===n)s.data.count+=r,s.data.materialKey===o.data.materialKey&&s.data.target===o.data.target&&s.data.indexEnd===o.data.start&&(s.data.count+=o.data.count,s.next=o.next,this._length--);else if(e===o.data.materialKey&&i===o.data.target&&a===o.data.start)o.data.start=n,o.data.count+=r;else{const a=new p(t,e,i,n,r),l=new u.B(a);s.next=l,l.next=o,this._length++}}}class m{constructor(t){this._indexOnly=t,this.vertex={count:0,operations:[]},this.index={count:0,operations:[]}}copyRecord(t){let e=0;this._indexOnly||(e=this.vertex.count-t.vertexStart,this.vertex.operations.push({srcFrom:t.vertexStart,dstFrom:this.vertex.count,count:t.vertexCount,mutate:0}),t.vertexStart=this.vertex.count,this.vertex.count+=t.vertexCount);let i=!1;if(this._indexOnly&&this.index.operations.length>=1){const e=this.index.operations[this.index.operations.length-1];e.srcFrom+e.count===t.indexStart&&(e.count+=t.indexCount,i=!0)}i||this.index.operations.push({srcFrom:t.indexStart,dstFrom:this.index.count,count:t.indexCount,mutate:e}),t.indexStart=this.index.count,this.index.count+=t.indexCount}}var g=i(57650),y=i(95929),v=i(85475),x=i(28055),b=i(86305);class S{constructor(t,e,i,n){this._pool=n;const r=x.W.create(e*i*Uint32Array.BYTES_PER_ELEMENT,this._pool);this.size=e,this.strideInt=i,this.bufferType=t,this.dirty={start:1/0,end:0},this.memoryStats={bytesUsed:0,bytesReserved:e*i*Uint32Array.BYTES_PER_ELEMENT},this._gpu=null,this._cpu=r,this.clear()}get elementSize(){return this._cpu.length/this.strideInt}get intSize(){return this.fillPointer*this.strideInt}get byteSize(){return this.intSize*Uint32Array.BYTES_PER_ELEMENT}get invalidated(){return this.bufferSize>0&&!this._gpu}get invalidatedComputeBuffer(){return this.bufferSize>0&&!this._gpuComputeTriangles}invalidate(){this._invalidateTriangleBuffer(),this._gpu?.dispose(),this._gpu=null}_invalidateTriangleBuffer(){this._gpuComputeTriangles?.dispose(),this._gpuComputeTriangles=null}destroy(){this._gpu?.dispose(),this._gpuComputeTriangles?.dispose(),this._cpu?.destroy()}clear(){this.dirty.start=1/0,this.dirty.end=0,this.freeList=new u.P({start:0,end:this._cpu.length/this.strideInt}),this.fillPointer=0}ensure(t){if(!(this.maxAvailableSpace()>=t)&&t*this.strideInt>this._cpu.length-this.fillPointer){this.invalidate();const e=this._cpu.length/this.strideInt,i=Math.round(1.25*(e+t)),n=i*this.strideInt;this._cpu.expand(n*Uint32Array.BYTES_PER_ELEMENT),this.freeList.free(e,i-e),this.memoryStats.bytesReserved+=(i-e)*this.strideInt*Uint32Array.BYTES_PER_ELEMENT}}set(t,e){this._cpu.array[t]!==e&&(this._cpu.array[t]=e,this.dirty.start=Math.min(t,this.dirty.start),this.dirty.end=Math.max(t+1,this.dirty.end))}getGPUBuffer(t,e=!1){if(!this.bufferSize)return null;if(e){if("index"!==this.bufferType)throw new Error("Tired to get triangle buffer, but target is not an index buffer");return null==this._gpuComputeTriangles&&(this._gpuComputeTriangles=this._createComputeBuffer(t)),this._gpuComputeTriangles}return null==this._gpu&&(this._gpu=this._createBuffer(t)),this._gpu}getView(t,e){return this._cpu.getUint32View(t,e/Uint32Array.BYTES_PER_ELEMENT)}get bufferSize(){return this._cpu.length/this.strideInt}maxAvailableSpace(){return this.freeList.maxAvailableSpace()}insert(t,e,i,n){const r=i*this.strideInt;if(!r)return 0;const s=e*this.strideInt*Uint32Array.BYTES_PER_ELEMENT,o=new Uint32Array(t,s,r),a=this.freeList.firstFit(i);(0,y.Lw)(a,"First fit region must be defined");const l=a*this.strideInt,c=r;if(this._cpu.array.set(o,l),0!==n)for(let t=0;t<o.length;t++)this._cpu.array[t+l]+=n;return this.dirty.start=Math.min(this.dirty.start,l),this.dirty.end=Math.max(this.dirty.end,l+c),this.fillPointer=Math.max(this.fillPointer,l+c),this.memoryStats.bytesUsed+=i*this.strideInt*Uint32Array.BYTES_PER_ELEMENT,a}copyFrom(t,e,i,n,r){const s=i*this.strideInt;if(!s)return 0;const o=e*this.strideInt*Uint32Array.BYTES_PER_ELEMENT,a=t._cpu.getUint32View(o,s),l=this.freeList.firstFit(i);(0,y.Lw)(l,"First fit region must be defined");const c=l*this.strideInt,u=s;if(this._cpu.array.set(a,c),0!==n)for(let t=0;t<s;t++)this._cpu.array[c+t*this.strideInt+r]+=n;return this.dirty.start=Math.min(this.dirty.start,c),this.dirty.end=Math.max(this.dirty.end,c+u),this.fillPointer=Math.max(this.fillPointer,c+u),this.memoryStats.bytesUsed+=i*this.strideInt*Uint32Array.BYTES_PER_ELEMENT,l}free(t,e,i){const n=t*this.strideInt,r=(t+e)*this.strideInt;if(!0===i)for(let i=t;i!==t+e;i++)this._cpu.array[i*this.strideInt]=2147450879;this.dirty.start=Math.min(this.dirty.start,n),this.dirty.end=Math.max(this.dirty.end,r),this.freeList.free(t,e),this.memoryStats.bytesUsed-=e*this.strideInt*Uint32Array.BYTES_PER_ELEMENT}upload(){if(this.dirty.end){if(this._invalidateTriangleBuffer(),null==this._gpu)return this.dirty.start=1/0,void(this.dirty.end=0);this._gpu.setSubData(this._cpu.array,this.dirty.start,this.dirty.start,this.dirty.end),this.dirty.start=1/0,this.dirty.end=0}}reshuffle(t,e){if(0===e.length)return;const i=this.byteSize,n=t*this.strideInt*Uint32Array.BYTES_PER_ELEMENT,r=i>n,s=this._cpu,o=x.W.create(n,this._pool);r||o.array.set(this._cpu.getUint32View(0,this.intSize));for(const t of e)if(r||t.srcFrom!==t.dstFrom||0!==t.mutate){this.dirty.start=Math.min(this.dirty.start,t.dstFrom*this.strideInt),this.dirty.end=Math.max(this.dirty.end,(t.dstFrom+t.count)*this.strideInt);for(let e=0;e<t.count;e++){const i=(t.dstFrom+e)*this.strideInt,n=(t.srcFrom+e)*this.strideInt;for(let e=0;e<this.strideInt;e++)o.array[i+e]=s.array[n+e]+t.mutate}}this._cpu.destroy(),this._cpu=o,r&&this.invalidate(),this.freeList.clear(),this.memoryStats.bytesUsed=this.memoryStats.bytesReserved=n}_createBuffer(t){const e=d._U.DYNAMIC_DRAW;return"index"===this.bufferType?b.g.createIndex(t,e,this._cpu.array):b.g.createVertex(t,e,this._cpu.array)}_createComputeBuffer(t){const e=d._U.DYNAMIC_DRAW,i=new Uint32Array(this.fillPointer/3);for(let t=0;t<this.fillPointer;t+=3)i[t/3]=this._cpu.array[t];return b.g.createIndex(t,e,i)}}var w=i(5544),T=i(81438);class M{constructor(t,e){if(this._bufferPool=t,this._layout=e,this._invalidatedGeometry=!1,this._invalidatedCompute=!1,this._position=this._layout.attributes.find((t=>"pos"===t.name||"position"===t.name)),!this._position)throw new Error("InternalError: Unable to find position attribute")}destroy(){this._indexBuffer=(0,y.pR)(this._indexBuffer),this._vertexBuffer=(0,y.pR)(this._vertexBuffer),this._computeVAO?.disposeVAOOnly(),this._geometryVAO?.disposeVAOOnly()}get layout(){return this._layout}getDrawArgs(t,e,i,n){return n?{primitive:d.WR.POINTS,count:e/3,offset:i/3}:{primitive:t,count:e,offset:i}}getAttributePrecisionPackFactors(){const t={};for(const e of this.layout.attributes)e.packPrecisionFactor&&(t[e.name]=e.packPrecisionFactor);return t}getDebugVertexInfo(t=!1,e){if(!this._vertexBuffer)return null;const i=this._layout,n=i.stride,r=this._vertexBuffer.getView(0,this._vertexBuffer.byteSize),s=[];if(t)if(null==e)console.log("must provide location info to see compute attributes");else for(const t of i.attributes){const i=e.computeAttributeMap[t.name];null!=i&&2===i.length&&(s.push({...t,name:i[0],offset:t.offset+n}),s.push({...t,name:i[1],offset:t.offset+2*n}))}const o=new DataView(r.slice().buffer);let a=r.byteLength/n;t&&(a=this._indexBuffer.fillPointer/3);const l=this._indexBuffer.getView(0,this._indexBuffer.byteSize);let c=0;const u=[];for(let e=0;e<a;e++){t&&(c=l[3*e]*n);const r={};for(const t of[...i.attributes,...s]){let e=`${t.offset} ${t.name}`,i=(0,w.q)(o,t,c);if(t.packPrecisionFactor)if(e+=` (precision: ${t.packPrecisionFactor})`,"number"==typeof i)i/=t.packPrecisionFactor;else for(let e=0;e<i.length;e++)i[e]/=t.packPrecisionFactor;r[e]=i}c+=n,u.push(r)}return{vertices:u,layout:i}}_ensure(t,e){if(this._vertexBuffer&&this._indexBuffer)this._indexBuffer.ensure(Math.max(t,1e3)),this._vertexBuffer.ensure(Math.max(e,1e3));else{const i=this._layout.stride/Uint32Array.BYTES_PER_ELEMENT;this._indexBuffer=new S("index",Math.max(t,1e3),1,this._bufferPool),this._vertexBuffer=new S("vertex",Math.max(e,1e3),i,this._bufferPool)}}append(t){const e=t.layout.stride,i=t.indices.byteLength/Uint32Array.BYTES_PER_ELEMENT,n=t.vertices.byteLength/e;this._ensure(i,n);const{vertices:r,indices:s}=t,o=this._vertexBuffer.insert(r,0,r.byteLength/e,0);return{vertexFrom:o,indexFrom:this._indexBuffer.insert(s,0,s.byteLength/4,o)}}copyRecordFrom(t,e,i,n){const{indexStart:r,indexCount:s,vertexStart:o,vertexCount:a}=e;this._ensure(s,a);const l=t._position,c=i*(l.packPrecisionFactor??1),u=n*(l.packPrecisionFactor??1),h=l.offset,d=(0,v.M9)(c,u),f=this._vertexBuffer.copyFrom(t._vertexBuffer,o,a,d,h),p=this._indexBuffer.copyFrom(t._indexBuffer,r,s,f-o,0),_=e.clone();return _.vertexStart=f,_.indexStart=p,_.overlaps=0,_}remove(t,e,i,n){this._indexBuffer.free(t,e),this._vertexBuffer.free(i,n)}upload(){this._invalidatedGeometry=!0,this._invalidatedCompute=!0}getGeometryVAO(t,e){if(!this._vertexBuffer||!this._indexBuffer||!this._vertexBuffer.bufferSize)return null;if(this._invalidatedGeometry){(this._vertexBuffer.invalidated||this._indexBuffer.invalidated)&&(this._vertexBuffer.invalidate(),this._indexBuffer.invalidate(),this._geometryVAO?.disposeVAOOnly(),this._geometryVAO=null),this._vertexBuffer.upload(),this._indexBuffer.upload();const i=this._indexBuffer.getGPUBuffer(t,!1),n=this._vertexBuffer.getGPUBuffer(t);this._geometryVAO||(this._geometryVAO=new T.Z(t,e.locations,function(t,e){const i=t.attributes.filter((t=>e.locations.has(t.name))).map((e=>({name:e.name,type:e.type,count:e.count,divisor:0,normalized:e.normalized??!1,offset:e.offset,stride:t.stride})));return new Map([["geometry",i]])}(this.layout,e),new Map([["geometry",n]]),i)),this._invalidatedGeometry=!1}return this._geometryVAO}getComputeVAO(t,e){if(!this._vertexBuffer||!this._indexBuffer||!this._vertexBuffer.bufferSize)return null;if(this._invalidatedCompute){(this._vertexBuffer.invalidated||this._indexBuffer.invalidatedComputeBuffer)&&(this._vertexBuffer.invalidate(),this._indexBuffer.invalidate(),this._computeVAO?.disposeVAOOnly(),this._computeVAO=null),this._vertexBuffer.upload(),this._indexBuffer.upload();const i=this._indexBuffer.getGPUBuffer(t,!0),n=this._vertexBuffer.getGPUBuffer(t);this._computeVAO||(this._computeVAO=new T.Z(t,e.locations,function(t,e){const i=[],n=t.attributes.filter((t=>e.locations.has(t.name)));for(const r of n){i.push({name:r.name,type:r.type,count:r.count,divisor:0,normalized:r.normalized??!1,offset:r.offset,stride:t.stride});const n=e.computeAttributeMap[r.name];null!=n&&2===n.length&&(i.push({name:n[0],count:r.count,divisor:0,type:r.type,normalized:r.normalized??!1,offset:r.offset+t.stride,stride:t.stride}),i.push({name:n[1],count:r.count,divisor:0,type:r.type,normalized:r.normalized??!1,offset:r.offset+2*t.stride,stride:t.stride}))}return new Map([["geometry",i]])}(this.layout,e),new Map([["geometry",n]]),i),this._invalidatedCompute=!1)}return this._computeVAO}get memoryStats(){return{bytesUsed:this._vertexBuffer.memoryStats.bytesUsed+this._indexBuffer.memoryStats.bytesUsed,bytesReserved:this._vertexBuffer.memoryStats.bytesReserved+this._indexBuffer.memoryStats.bytesReserved,vertex:this._vertexBuffer.memoryStats,index:this._indexBuffer.memoryStats}}reshuffle(t){this._vertexBuffer&&this._vertexBuffer.reshuffle(t.vertex.count,t.vertex.operations),this._indexBuffer&&this._indexBuffer.reshuffle(t.index.count,t.index.operations)}}class P{constructor(t){this._pos=0,this._buffer=t,this._i32View=new Int32Array(this._buffer),this._f32View=new Float32Array(this._buffer)}readInt32(){return this._i32View[this._pos++]}readF32(){return this._f32View[this._pos++]}}var A=i(24964);function C(t){return t?{entities:(0,A._)(new P(t.entities),l.A),vertexData:t.data.map(I)}:null}function I(t){const e=t.layout.stride,i=new DataView(t.vertices),n=[],r=t.vertices.byteLength/e;let s=0;for(let o=0;o<r;o++){const r={};for(const e of t.layout.attributes){let t=`${e.offset} ${e.name}`,n=(0,w.q)(i,e,s);if(e.packPrecisionFactor)if(t+=` (precision: ${e.packPrecisionFactor})`,"number"==typeof n)n/=e.packPrecisionFactor;else for(let t=0;t<n.length;t++)n[t]/=e.packPrecisionFactor;r[t]=n}s+=e,n.push(r)}return{vertices:n,layout:t.layout}}let E=0;class R extends o.u{constructor(t,e,i,n,r=!1){super(t,e,i,n),this._meshes=new Map,this._entities=[],this._invalidated=!1,this._nextUploadAllowed=!1,this.tileAge=E++,this._metrics=[],this._entityIds=new Set,this._entityIdsFromBuffer=new Set,this._attributeEpoch=0,this._encounteredEnd=!1,this._objectIdMap=null,this.visible=!0,this.transforms.labelMat2d=(0,s.vt)(),this.enableDeferredUploads=r}destroy(){super.destroy(),this.clear()}clear(){for(const t of this._meshes.values())t.destroy();this._meshes.clear(),this._entities=[],this._metrics=[],this._displayList=null,this._invalidated=!0,this._entityIds.clear(),this._nextUploadAllowed=!0}beforeRender(t){super.beforeRender(t),this._needsReshuffle&&t.reshuffleManager.schedule(this)}tryReady(t){const e=this._invalidated&&!this._uploadAllowed;return!(this.isReady||e||!this._encounteredEnd||!(t>=this._attributeEpoch)||((0,n.A)("esri-2d-update-debug")&&console.debug(`Tile[${this.key.id}] FeatureTile.ready [epoch=${t}]`),this.ready(),this.requestRender(),0))}get labelMetrics(){return this._metrics}get hasData(){return!!this._meshes.size}get hasAnimations(){return!!this._objectIdMap}get needsUpload(){return this._invalidated}get _uploadAllowed(){return!this.enableDeferredUploads||this._nextUploadAllowed}upload(){this._nextUploadAllowed=!0}getDisplayList(t,e){if(this._uploadAllowed&&this._invalidated){this._entities.sort(((t,e)=>{const i=e.sortKey,n=t.sortKey;return n===i?t.id-e.id:n-i})),e===c.ch.BATCHING&&this.reshuffle(!0),this._displayList=_.fromDisplayEntities(this._entities,this,t,e);for(const t of this._meshes.values())t.upload();this.debugInfo.display.length=this._displayList.length,this.debugInfo.display.minOrderedLength=this._displayList.minOrderedLength,this.debugInfo.display.minUnorderedLength=this._displayList.minUnorderedLength,this.requestRender(),this._invalidated=!1,this._nextUploadAllowed=!1}return this._displayList}getMesh(t){if(!this._meshes.has(t))throw new Error(`InternalError: Unable to find VAO for instance: ${t}`);return this._meshes.get(t)}getSortKeys(t){const e=new Map;for(const{id:i,sortKey:n}of this._entities)if(t.has(i)&&e.set(i,n),e.size===t.size)break;return e}onMessage(t){if(t.objectIdMap)for(const e in t.objectIdMap)this._objectIdMap||(this._objectIdMap={}),this._objectIdMap[e]=t.objectIdMap[e];switch(t.type){case"append":this._onAppendMessage(t);break;case"update":this._onUpdateMessage(t)}if(this._aggregateMemoryStats(),this.requestRender(),t.end){if((0,n.A)("esri-2d-update-debug")&&console.debug(`Tile[${this.key.id}] FeatureTile.end [epoch=${t.attributeEpoch}]`),!t.attributeEpoch)throw new Error("InternalError: Attribute epoch not defined.");this._attributeEpoch=t.attributeEpoch,this._encounteredEnd=!0}}_onAppendMessage(t){if((0,n.A)("esri-2d-update-debug")&&console.debug(`Tile[${this.key.id}] FeatureTile.append`,{append:C(t?.append)}),t.clear&&this.clear(),!t.append)return;const e=(0,A._)(new P(t.append.entities),l.A);this._insert(e,t.append.data,!1)}_onUpdateMessage(t){(0,n.A)("esri-2d-update-debug")&&console.debug(`Tile[${this.key.id}] FeatureTile.update`,{isPixelBuffer:t.isPixelBuffer,modify:C(t.modify),remove:t.remove});const e=(0,A._)(new P(t.modify.entities),l.A),i=e.map((t=>t.id)),r=t.isPixelBuffer??!1,s=[...t.remove,...i];r?this._removeByIdsFromBuffer(s):this._removeByIds(s),this._insert(e,t.modify.data,r)}reshuffle(t=!1){if(this.destroyed)return;const e=new Map;for(const i of this._entities)for(const n of i.records){const i=this._meshes.get(n.instanceId);let r=e.get(i);r||(r=new m(t),e.set(i,r)),r.copyRecord(n)}for(const[t,i]of e)t.reshuffle(i);this._invalidated=!0,this._aggregateMemoryStats(),(0,n.A)("esri-2d-update-debug")&&r.A.getLogger("esri.views.2d.engine.webgl.FeatureTile").info(`Tile ${this.key.id} was reshuffled.`)}copyPixelBufferedEntitesFrom(t,e,i,n){const r=i*a.CQ,s=n*a.CQ;for(const i of t._entities){let n=null;for(const o of i.records)if(o.overlaps&e){const e=t.getMesh(o.instanceId),a=this._ensureMesh(o.instanceId,e.layout).copyRecordFrom(e,o,r,s);n||(n=new l.A(i.id,i.sortKey),this._entityIdsFromBuffer.add(i.id),this._entities.push(n)),n.records.push(a)}}this._invalidated=!0}_ensureMesh(t,e){return this._meshes.has(t)||this._meshes.set(t,new M(this._stage.bufferPool,e)),this._meshes.get(t)}_insert(t,e,i){if(!t.length)return;this._removeDuplicatedBufferedEntites(t);const n=this._insertVertexData(e);for(const e of t){for(const t of e.records)t.updateBaseOffsets(n.get(t.instanceId));i?this._tryInsertBufferedEntity(e):this._insertEntity(e)}this._invalidated=!0}_insertVertexData(t){const e=new Map;for(const i of t){const{instanceId:t,layout:n}=i,r=this._ensureMesh(t,n).append(i);if(i.metrics){const t=(0,A._)(new P(i.metrics),g.f)??[];this._metrics.push(...t)}e.set(t,r)}return e}_insertEntity(t){(0,n.A)("esri-2d-update-debug")&&this._entityIds.has(t.id)&&console.error(`Tile ${this.key.id} insertEnitty: Already have entityId ${t.id}`),this._entityIds.add(t.id),this._entities.push(t)}_tryInsertBufferedEntity(t){this._entityIds.has(t.id)?this._removeRecordsFromMesh(t.records):(this._entityIdsFromBuffer.add(t.id),this._entities.push(t))}_removeDuplicatedBufferedEntites(t){if(!this._entityIdsFromBuffer.size)return;const e=[];for(const i of t)this._entityIdsFromBuffer.has(i.id)&&e.push(i.id);this._removeByIds(e)}_removeByIdsFromBuffer(t){this._removeByIds(t.filter((t=>this._entityIdsFromBuffer.has(t))))}_removeByIds(t){if(0===t.length)return;const e=new Set(t),i=[];for(const t of this._entities)e.has(t.id)?this._remove(t):i.push(t);this._entities=i,this._invalidated=!0}_remove(t){this._removeRecordsFromMesh(t.records),this._entityIds.delete(t.id),this._entityIdsFromBuffer.delete(t.id);for(let e=this._metrics.length-1;e>=0;e--)this._metrics[e].entityTexel===t.id&&this._metrics.splice(e,1)}_removeRecordsFromMesh(t){for(const e of t){const{instanceId:t,indexStart:i,indexCount:n,vertexStart:r,vertexCount:s}=e;this._meshes.get(t)?.remove(i,n,r,s)}}_aggregateMemoryStats(){this.debugInfo.memory.bytesUsed=0,this.debugInfo.memory.bytesReserved=0;for(const t of this._meshes.values())this.debugInfo.memory.bytesUsed+=t.memoryStats.bytesUsed,this.debugInfo.memory.bytesReserved+=t.memoryStats.bytesReserved}get _needsReshuffle(){if(this.destroyed)return!1;const{bytesUsed:t,bytesReserved:e}=this.debugInfo.memory,i=t/e,{minOrderedLength:n,length:r}=this.debugInfo.display;return e>a._x&&i<a.eI||r>a.Xh&&n/r<a.Vl}get entityIds(){return this._objectIdMap?this._entities.map((({id:t})=>({objectId:this._objectIdMap[t],displayId:t}))):[]}}},36753:function(t,e,i){i.d(e,{p6:function(){return o},wV:function(){return s}}),Math.PI;const n=256/360,r=1/Math.LN2;function s(t){return function(t,e){return(t%=e)>=0?t:t+e}(t*n,256)}function o(t){return Math.log(t)*r}},28055:function(t,e,i){i.d(e,{W:function(){return a},o:function(){return c}});var n=i(58941),r=i(95929),s=i(83258);const o=(0,n.A)("esri-2d-log-allocations");class a{static create(t,e){const i=e.acquireUint32Array(t);return new a(i,e)}constructor(t,e){this._array=t,this._pool=e}get array(){return this._array}get length(){return this._array.length}getUint32View(t,e){return new Uint32Array(this._array.buffer,t+this._array.byteOffset,e)}expand(t){if(t<=this._array.byteLength)return;const e=this._pool.acquireUint32Array(t);e.set(this._array),this._pool.releaseUint32Array(this._array),this._array=e}destroy(){this._pool.releaseUint32Array(this._array)}}class l{constructor(){this._data=new ArrayBuffer(l.BYTE_LENGTH),this._freeList=new s.P({start:0,end:this._data.byteLength})}static get BYTE_LENGTH(){return 16e6}get buffer(){return this._data}acquireUint32Array(t){const e=this._freeList.firstFit(t);return null==e?null:new Uint32Array(this._data,e,t/Uint32Array.BYTES_PER_ELEMENT)}releaseUint32Array(t){this._freeList.free(t.byteOffset,t.byteLength)}}class c{constructor(){this._pages=[],this._pagesByBuffer=new Map,this._bytesAllocated=0}destroy(){this._pages=[],this._pagesByBuffer=null}get _bytesTotal(){return this._pages.length*l.BYTE_LENGTH}acquireUint32Array(t){if(this._bytesAllocated+=t,o&&console.log(`Allocating ${t}, (${this._bytesAllocated} / ${this._bytesTotal})`),t>=l.BYTE_LENGTH)return new Uint32Array(t/Uint32Array.BYTES_PER_ELEMENT);for(const e of this._pages){const i=e.acquireUint32Array(t);if(null!=i)return i}const e=this._addPage().acquireUint32Array(t);return(0,r.Lw)(e,"Expected to allocate page"),e}releaseUint32Array(t){this._bytesAllocated-=t.byteLength,o&&console.log(`Freeing ${t.byteLength}, (${this._bytesAllocated} / ${this._bytesTotal})`);const e=this._pagesByBuffer.get(t.buffer);e&&e.releaseUint32Array(t)}_addPage(){const t=new l;return this._pages.push(t),this._pagesByBuffer.set(t.buffer,t),t}}},58975:function(t,e,i){i.d(e,{U:function(){return l}});var n=i(42827),r=i(48996),s=i(58941),o=i(58250);const a=!!(0,s.A)("esri-2d-profiler");class l{constructor(t,e){if(this._events=new r.A,this._entries=new Map,this._timings=new n.A(10),this._currentContainer=null,this._currentPass=null,this._currentBrush=null,this._currentSummary=null,!a)return;this._ext=(0,o._R)(t.gl,{}),this._debugOutput=e;const i=t.gl;if(!this.enableCommandLogging)return;let s;for(s in i)if("function"==typeof i[s]){const t=i[s],e=s.includes("draw");i[s]=(...n)=>(this._events.emit("command",{container:this._currentContainer,pass:this._currentPass,brush:this._currentBrush,method:s,args:n,isDrawCommand:e}),this._currentSummary&&(this._currentSummary.commands++,e&&this._currentSummary.drawCommands++),t.apply(i,n))}}get enableCommandLogging(){return!("object"==typeof a&&a.disableCommands)}recordContainerStart(t){a&&(this._currentContainer=t)}recordContainerEnd(){a&&(this._currentContainer=null)}recordPassStart(t){a&&(this._currentPass=t,this._initSummary())}recordPassEnd(){a&&(this._currentPass=null,this._emitSummary())}recordBrushStart(t){a&&(this._currentBrush=t)}recordBrushEnd(){a&&(this._currentBrush=null)}recordStart(t){if(a&&null!=this._ext){if(this._entries.has(t)){const e=this._entries.get(t),i=this._ext.resultAvailable(e.query),n=this._ext.disjoint();if(i&&!n){const i=this._ext.getResult(e.query)/1e6;let n=0;if(null!=this._timings.enqueue(i)){const t=this._timings.entries,e=t.length;let i=0;for(const e of t)i+=e;n=i/e}const r=i.toFixed(2),s=n?n.toFixed(2):"--";this.enableCommandLogging?(console.groupCollapsed(`Frame report for ${t}, ${r} ms (${s} last 10 avg)\n${e.commandsLen} Commands (${e.drawCommands} draw)`),console.log("RenderPass breakdown: "),console.table(e.summaries),console.log("Commands: ",e.commands),console.groupEnd()):console.log(`Frame report for ${t}, ${r} ms (${s} last 10 avg)`),this._debugOutput.innerHTML=`${r} (${s})`}for(const t of e.handles)t.remove();this._ext.deleteQuery(e.query),this._entries.delete(t)}const e={name:t,query:this._ext.createQuery(),commands:[],commandsLen:0,drawCommands:0,summaries:[],handles:[]};this.enableCommandLogging&&(e.handles.push(this._events.on("command",(t=>{e.commandsLen++,e.commands.push(t),t.isDrawCommand&&e.drawCommands++}))),e.handles.push(this._events.on("summary",(t=>{e.summaries.push(t)})))),this._ext.beginTimeElapsed(e.query),this._entries.set(t,e)}}recordEnd(t){a&&null!=this._ext&&this._entries.has(t)&&this._ext.endTimeElapsed()}_initSummary(){this.enableCommandLogging&&(this._currentSummary={container:this._currentContainer,pass:this._currentPass,drawCommands:0,commands:0})}_emitSummary(){this.enableCommandLogging&&this._currentSummary&&this._events.emit("summary",this._currentSummary)}}},54904:function(t,e,i){i.d(e,{A:function(){return n}});class n{constructor(t=0,e=0,i=0,n=0){this.x=t,this.y=e,this.width=i,this.height=n}get isEmpty(){return this.width<=0||this.height<=0}union(t){this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.width=Math.max(this.width,t.width),this.height=Math.max(this.height,t.height)}}},82087:function(t,e,i){i.d(e,{A:function(){return c}});var n=i(58941),r=i(28230),s=i(57672),o=i(829),a=i(55382);const l=(t,e)=>t.key.level-e.key.level!=0?t.key.level-e.key.level:t.key.row-e.key.row!=0?t.key.row-e.key.row:t.key.col-e.key.col;class c extends s.A{constructor(t){super(),this.tileInfoView=t,this.sortFunction=l}renderChildren(t){this.setStencilReference(t),super.renderChildren(t)}createRenderParams(t){const{state:e}=t,i=super.createRenderParams(t);return i.requiredLevel=this.tileInfoView.getClosestInfoForScale(e.scale).level,i.displayLevel=this.tileInfoView.tileInfo.scaleToZoom(e.scale),i}prepareRenderPasses(t){const e=super.prepareRenderPasses(t);return e.push(t.registerRenderPass({name:"stencil",brushes:[o.A],drawPhase:r.S5.DEBUG|r.S5.MAP|r.S5.HIGHLIGHT|r.S5.LABEL,target:()=>this.getStencilTarget()})),(0,n.A)("esri-tiles-debug")&&e.push(t.registerRenderPass({name:"tileInfo",brushes:[a.A],drawPhase:r.S5.DEBUG,target:()=>this.children})),e}getStencilTarget(){return this.children}setStencilReference(t){let e=1;for(const t of this.children)t.stencilRef=e++}}},54631:function(t,e,i){i.d(e,{Y:function(){return o}});var n=i(44705),r=i(77515),s=i(36008);class o extends r.q{constructor(t,e,i,n,r,o,a=r,l=o){super(),this.tileDebugInfoTexture=null,this.debugInfo={display:{length:0,minOrderedLength:0,minUnorderedLength:0,triangleCount:0},memory:{bytesUsed:0,bytesReserved:0}},this._destroyed=!1,this.key=new s.A(t),this.resolution=e,this.x=i,this.y=n,this.width=r,this.height=o,this.rangeX=a,this.rangeY=l}destroy(){this.tileDebugInfoTexture&&(this.tileDebugInfoTexture.dispose(),this.tileDebugInfoTexture=null),this._destroyed=!0}get debugSlot(){let t=this;for(;t.parent!==this._stage;){if(!t.parent)return 0;t=t.parent}return this._stage.children.indexOf(t)}setTransform(t){const e=this.resolution/(t.resolution*t.pixelRatio),i=this.transforms.tileMat3,[r,s]=t.toScreenNoRotation([0,0],[this.x,this.y]),o=this.width/this.rangeX*e,a=this.height/this.rangeY*e;(0,n.hZ)(i,o,0,0,0,a,0,r,s,1),(0,n.lw)(this.transforms.displayViewScreenMat3,t.displayViewMat3,i)}get destroyed(){return this._destroyed}}},42542:function(t,e,i){i.d(e,{i:function(){return p}});var n=i(33389),r=i(39686);function s(t,e){return t.x===e.x&&t.y===e.y}function o(t){if(!t)return;const e=t.length;if(e<=1)return;let i=0;for(let n=1;n<e;n++)s(t[n],t[i])||++i===n||(t[i]=t[n]);t.length=i+1}function a(t,e){return t.x=e.y,t.y=-e.x,t}function l(t,e){return t.x=-e.y,t.y=e.x,t}function c(t,e){return t.x=e.x,t.y=e.y,t}function u(t,e){return t.x=-e.x,t.y=-e.y,t}function h(t){return Math.sqrt(t.x*t.x+t.y*t.y)}function d(t,e){return t.x*e.x+t.y*e.y}function f(t,e,i,n){return t.x=e.x*i+e.y*n,t.y=e.x*n-e.y*i,t}class p{constructor(t,e,i){this._writeVertex=t,this._writeTriangle=e,this._canUseThinTessellation=i,this._prevNormal={x:void 0,y:void 0},this._nextNormal={x:void 0,y:void 0},this._textureNormalLeft={x:0,y:1},this._textureNormalRight={x:0,y:-1},this._textureNormal={x:void 0,y:void 0},this._joinNormal={x:void 0,y:void 0},this._inner={x:void 0,y:void 0},this._outer={x:void 0,y:void 0},this._roundStart={x:void 0,y:void 0},this._roundEnd={x:void 0,y:void 0},this._startBreak={x:void 0,y:void 0},this._endBreak={x:void 0,y:void 0},this._innerPrev={x:void 0,y:void 0},this._innerNext={x:void 0,y:void 0},this._bevelStart={x:void 0,y:void 0},this._bevelEnd={x:void 0,y:void 0},this._bevelMiddle={x:void 0,y:void 0}}tessellate(t,e,i=this._canUseThinTessellation){o(t),i&&e.halfWidth<r.Gh&&!e.offset?this._tessellateThin(t,e):this._tessellate(t,e)}_tessellateThin(t,e){if(t.length<2)return;const i=e.wrapDistance||65535;let n=e.initialDistance||0,r=!1,s=t[0].x,o=t[0].y;const a=t.length;for(let e=1;e<a;++e){r&&(r=!1,n=0);let a=t[e].x,l=t[e].y,c=a-s,u=l-o,h=Math.sqrt(c*c+u*u);if(c/=h,u/=h,n+h>i){r=!0;const t=(i-n)/h;h=i-n,a=(1-t)*s+t*a,l=(1-t)*o+t*l,--e}const d=this._writeVertex(s,o,0,0,c,u,u,-c,0,-1,n),f=this._writeVertex(s,o,0,0,c,u,-u,c,0,1,n);n+=h;const p=this._writeVertex(a,l,0,0,c,u,u,-c,0,-1,n),_=this._writeVertex(a,l,0,0,c,u,-u,c,0,1,n);this._writeTriangle(d,f,p),this._writeTriangle(f,p,_),s=a,o=l}}_tessellate(t,e){const i=t[0],r=t[t.length-1],o=s(i,r),p=o?3:2;if(t.length<p)return;const _=e.pixelCoordRatio,m=null!=e.capType?e.capType:n.xR.BUTT,g=null!=e.joinType?e.joinType:n.JO.MITER,y=null!=e.miterLimit?Math.min(e.miterLimit,4):2,v=null!=e.roundLimit?Math.min(e.roundLimit,1.05):1.05,x=null!=e.halfWidth?e.halfWidth:2,b=!!e.textured;let S,w,T,M=null;const P=this._prevNormal,A=this._nextNormal;let C=-1,I=-1;const E=this._joinNormal;let R,O;const F=this._textureNormalLeft,z=this._textureNormalRight,D=this._textureNormal;let L=-1,k=-1;const N=e.wrapDistance||65535;let B=e.initialDistance||0;const V=this._writeVertex,U=this._writeTriangle,G=(t,e,i,n,r,s)=>{const o=V(w,T,R,O,i,n,t,e,r,s,B);return L>=0&&k>=0&&o>=0&&U(L,k,o),L=k,k=o,o};o&&(S=t[t.length-2],A.x=r.x-S.x,A.y=r.y-S.y,I=h(A),A.x/=I,A.y/=I);let Y=!1;for(let e=0;e<t.length;++e){if(Y&&(Y=!1,B=0),S&&(P.x=-A.x,P.y=-A.y,C=I,B+C>N&&(Y=!0)),Y){const i=(N-B)/C;C=N-B,S={x:(1-i)*S.x+i*t[e].x,y:(1-i)*S.y+i*t[e].y},--e}else S=t[e];w=S.x,T=S.y;const i=e<=0&&!Y,r=e===t.length-1;if(i||(B+=C),M=r?o?t[1]:null:t[e+1],M?(A.x=M.x-w,A.y=M.y-T,I=h(A),A.x/=I,A.y/=I):(A.x=void 0,A.y=void 0),!o){if(i){l(E,A),R=E.x,O=E.y,m===n.xR.SQUARE&&(G(-A.y-A.x,A.x-A.y,A.x,A.y,0,-1),G(A.y-A.x,-A.x-A.y,A.x,A.y,0,1)),m===n.xR.ROUND&&(G(-A.y-A.x,A.x-A.y,A.x,A.y,-1,-1),G(A.y-A.x,-A.x-A.y,A.x,A.y,-1,1)),m!==n.xR.ROUND&&m!==n.xR.BUTT||(G(-A.y,A.x,A.x,A.y,0,-1),G(A.y,-A.x,A.x,A.y,0,1));continue}if(r){a(E,P),R=E.x,O=E.y,m!==n.xR.ROUND&&m!==n.xR.BUTT||(G(P.y,-P.x,-P.x,-P.y,0,-1),G(-P.y,P.x,-P.x,-P.y,0,1)),m===n.xR.SQUARE&&(G(P.y-P.x,-P.x-P.y,-P.x,-P.y,0,-1),G(-P.y-P.x,P.x-P.y,-P.x,-P.y,0,1)),m===n.xR.ROUND&&(G(P.y-P.x,-P.x-P.y,-P.x,-P.y,1,-1),G(-P.y-P.x,P.x-P.y,-P.x,-P.y,1,1));continue}}let s,p,V=(H=A,-((W=P).x*H.y-W.y*H.x));if(Math.abs(V)<.01)d(P,A)>0?(E.x=P.x,E.y=P.y,V=1,s=Number.MAX_VALUE,p=!0):(l(E,A),V=1,s=1,p=!1);else{E.x=(P.x+A.x)/V,E.y=(P.y+A.y)/V,s=h(E);const t=(s-1)*x*_;p=s>4||t>C&&t>I}R=E.x,O=E.y;let U=g;switch(g){case n.JO.BEVEL:s<1.05&&(U=n.JO.MITER);break;case n.JO.ROUND:s<v&&(U=n.JO.MITER);break;case n.JO.MITER:s>y&&(U=n.JO.BEVEL)}switch(U){case n.JO.MITER:if(G(E.x,E.y,-P.x,-P.y,0,-1),G(-E.x,-E.y,-P.x,-P.y,0,1),r)break;if(b){const t=Y?0:B;L=this._writeVertex(w,T,R,O,A.x,A.y,E.x,E.y,0,-1,t),k=this._writeVertex(w,T,R,O,A.x,A.y,-E.x,-E.y,0,1,t)}break;case n.JO.BEVEL:{const t=V<0;let e,i,n,s;if(t){const t=L;L=k,k=t,e=F,i=z}else e=z,i=F;if(p)n=t?l(this._innerPrev,P):a(this._innerPrev,P),s=t?a(this._innerNext,A):l(this._innerNext,A);else{const e=t?u(this._inner,E):c(this._inner,E);n=e,s=e}const o=t?a(this._bevelStart,P):l(this._bevelStart,P);G(n.x,n.y,-P.x,-P.y,e.x,e.y);const h=G(o.x,o.y,-P.x,-P.y,i.x,i.y);if(r)break;const d=t?l(this._bevelEnd,A):a(this._bevelEnd,A);if(p){const t=this._writeVertex(w,T,R,O,-P.x,-P.y,0,0,0,0,B);L=this._writeVertex(w,T,R,O,A.x,A.y,s.x,s.y,e.x,e.y,B),k=this._writeVertex(w,T,R,O,A.x,A.y,d.x,d.y,i.x,i.y,B),this._writeTriangle(h,t,k)}else{if(b){const t=this._bevelMiddle;t.x=(o.x+d.x)/2,t.y=(o.y+d.y)/2,f(D,t,-P.x,-P.y),G(t.x,t.y,-P.x,-P.y,D.x,D.y),f(D,t,A.x,A.y),L=this._writeVertex(w,T,R,O,A.x,A.y,t.x,t.y,D.x,D.y,B),k=this._writeVertex(w,T,R,O,A.x,A.y,s.x,s.y,e.x,e.y,B)}else{const t=L;L=k,k=t}G(d.x,d.y,A.x,A.y,i.x,i.y)}if(t){const t=L;L=k,k=t}break}case n.JO.ROUND:{const t=V<0;let e,i;if(t){const t=L;L=k,k=t,e=F,i=z}else e=z,i=F;const n=t?u(this._inner,E):c(this._inner,E);let o,h;p?(o=t?l(this._innerPrev,P):a(this._innerPrev,P),h=t?a(this._innerNext,A):l(this._innerNext,A)):(o=n,h=n);const _=t?a(this._roundStart,P):l(this._roundStart,P),m=t?l(this._roundEnd,A):a(this._roundEnd,A),g=G(o.x,o.y,-P.x,-P.y,e.x,e.y),y=G(_.x,_.y,-P.x,-P.y,i.x,i.y);if(r)break;const v=this._writeVertex(w,T,R,O,-P.x,-P.y,0,0,0,0,B);p||this._writeTriangle(L,k,v);const x=u(this._outer,n),S=this._writeVertex(w,T,R,O,A.x,A.y,m.x,m.y,i.x,i.y,B);let M,C;const I=s>2;if(I){let e;s!==Number.MAX_VALUE?(x.x/=s,x.y/=s,e=d(P,x),e=(s*(e*e-1)+1)/e):e=-1,M=t?a(this._startBreak,P):l(this._startBreak,P),M.x+=P.x*e,M.y+=P.y*e,C=t?l(this._endBreak,A):a(this._endBreak,A),C.x+=A.x*e,C.y+=A.y*e}f(D,x,-P.x,-P.y);const N=this._writeVertex(w,T,R,O,-P.x,-P.y,x.x,x.y,D.x,D.y,B);f(D,x,A.x,A.y);const U=b?this._writeVertex(w,T,R,O,A.x,A.y,x.x,x.y,D.x,D.y,B):N,Y=v,W=b?this._writeVertex(w,T,R,O,A.x,A.y,0,0,0,0,B):v;let H=-1,Z=-1;if(I&&(f(D,M,-P.x,-P.y),H=this._writeVertex(w,T,R,O,-P.x,-P.y,M.x,M.y,D.x,D.y,B),f(D,C,A.x,A.y),Z=this._writeVertex(w,T,R,O,A.x,A.y,C.x,C.y,D.x,D.y,B)),b?I?(this._writeTriangle(Y,y,H),this._writeTriangle(Y,H,N),this._writeTriangle(W,U,Z),this._writeTriangle(W,Z,S)):(this._writeTriangle(Y,y,N),this._writeTriangle(W,U,S)):I?(this._writeTriangle(v,y,H),this._writeTriangle(v,H,Z),this._writeTriangle(v,Z,S)):(this._writeTriangle(v,y,N),this._writeTriangle(v,U,S)),p?(L=this._writeVertex(w,T,R,O,A.x,A.y,h.x,h.y,e.x,e.y,B),k=S):(L=b?this._writeVertex(w,T,R,O,A.x,A.y,h.x,h.y,e.x,e.y,B):g,this._writeTriangle(L,W,S),k=S),t){const t=L;L=k,k=t}break}}}var W,H}}},88413:function(t,e,i){i.d(e,{AV:function(){return h},ES:function(){return m},IF:function(){return x},Qz:function(){return d},UE:function(){return g},bX:function(){return y},sZ:function(){return v}});var n=i(39819),r=i(40633),s=(i(33389),i(13798),i(58941),i(41835),i(85456)),o=(i(96402),i(69452),i(48347)),a=i(12285),l=i(10956),c=i(3817);const u=()=>r.A.getLogger("esri.views.2d.engine.webgl.Utils");function h(t){switch(t){case s.ld.UNSIGNED_BYTE:return 1;case s.ld.UNSIGNED_SHORT_4_4_4_4:return 2;case s.ld.FLOAT:return 4;default:return void u().error(new n.A("webgl-utils",`Unable to handle type ${t}`))}}function d(t){switch(t){case s.ld.UNSIGNED_BYTE:return Uint8Array;case s.ld.UNSIGNED_SHORT_4_4_4_4:return Uint16Array;case s.ld.FLOAT:return Float32Array;default:return void u().error(new n.A("webgl-utils",`Unable to handle type ${t}`))}}const f=t=>{const e=new Map;for(const i in t)for(const n of t[i])e.set(n.name,n.location);return e},p=t=>{const e={};return t.forEach(((t,i)=>e[i]=t?.length?t[0].stride:0)),e},_=new Map,m=(t,e)=>{if(!_.has(t)){const i=function(t){const e=new Map;for(const i in t){const n=t[i];let r=0;e.set(i,n.map((t=>{const e=new c._(t.name,t.count,t.type,r,0,t.normalized||!1);return r+=t.count*(0,o._)(t.type),e}))),e.get(i).forEach((t=>t.stride=r))}return e}(e),n={strides:p(i),bufferLayouts:i,attributes:f(e)};_.set(t,n)}return _.get(t)},g=t=>t.includes("data:image/svg+xml");function y(t){const e=[];for(let i=0;i<t.length;i++)e.push(t.charCodeAt(i));return e}function v(t,e,i){const n=new l.R(e.width,e.height);return n.dataType=e.dataType,e.depth&&(n.depth=e.depth),e.flipped&&(n.flipped=e.flipped),e.hasMipmap&&(n.hasMipmap=e.hasMipmap),n.internalFormat=e.internalFormat,e.isImmutable&&(n.isImmutable=e.isImmutable),e.isOpaque&&(n.isOpaque=e.isOpaque),e.maxAnisotropy&&(n.maxAnisotropy=e.maxAnisotropy),n.pixelFormat=e.pixelFormat,e.preMultiplyAlpha&&(n.preMultiplyAlpha=e.preMultiplyAlpha),e.samplingMode&&(n.samplingMode=e.samplingMode),e.target&&(n.target=e.target),n.uniform=e.uniform,e.unpackAlignment&&(n.unpackAlignment=e.unpackAlignment),e.wrapMode&&(n.wrapMode=e.wrapMode),new a.g(t,n,i)}function x(t){return"url"in t&&"urlHash"in t?{...t,url:""}:t}},77416:function(t,e,i){i.d(e,{A:function(){return l}});var n=i(25731),r=i(86305),s=i(85456),o=i(81438),a=i(3817);class l{constructor(t,e){this._rctx=t,this._attributes=[{name:"position",offset:0,type:s.pe.SHORT,count:2}],this.layout={hash:(0,n.hU)(this._attributes),attributes:this._attributes,stride:4},this._vertexBuffer=r.g.createVertex(t,s._U.STATIC_DRAW,new Uint16Array(e)),this._vao=new o.Z(t,new Map([["a_position",0]]),new Map([["geometry",[new a._("a_position",2,s.pe.SHORT,0,4)]]]),new Map([["geometry",this._vertexBuffer]])),this._count=e.length/2}bind(){this._rctx.bindVAO(this._vao)}unbind(){this._rctx.bindVAO(null)}dispose(){this._vao.dispose()}draw(){this._rctx.bindVAO(this._vao),this._rctx.drawArrays(s.WR.TRIANGLE_STRIP,0,this._count)}}},57672:function(t,e,i){i.d(e,{A:function(){return M}}),i(58941);var n=i(80708),r=i(7965),s=i(39819),o=i(40633),a=i(28181),l=i(25090),c=i(77515),u=i(59122),h=i(13786),d=i(1932),f=i(58081),p=i(76613),_=i(85475),m=i(86305),g=i(85456);const y=(t,e,i,n)=>{let r=0;for(let n=1;n<i;n++){const i=t[2*(e+n-1)],s=t[2*(e+n-1)+1];r+=(t[2*(e+n)]-i)*(t[2*(e+n)+1]+s)}return n?r>0:r<0},v=({coords:t,lengths:e},i)=>{const n=[];for(let r=0,s=0;r<e.length;s+=e[r],r+=1){const o=s,a=[];for(;r<e.length-1&&y(t,s+e[r],e[r+1],i);r+=1,s+=e[r])a.push(s+e[r]-o);const l=t.slice(2*o,2*(s+e[r])),c=(0,u.e)(l,a,2);for(const t of c)n.push(t+o)}return n};class x{constructor(t,e,i,n=!1){this._cache={},this.vertices=t,this.indices=e,this.primitiveType=i,this.isMapSpace=n}static fromPath(t){const e=(0,f.eU)(new p.A,t.path,!1,!1),i=e.coords,n=new Uint32Array(v(e,!0)),r=new Uint32Array(i.length/2);for(let t=0;t<r.length;t++)r[t]=(0,_.M9)(Math.floor(i[2*t]),Math.floor(i[2*t+1]));return new x({geometry:r},n,g.WR.TRIANGLES)}static fromGeometry(t,e){const i=e.geometry?.type;switch(i){case"polygon":return x.fromPolygon(t,e.geometry);case"extent":return x.fromMapExtent(t,e.geometry);default:return o.A.getLogger("esri.views.2d.engine.webgl.Mesh2D").error(new s.A("mapview-bad-type",`Unable to create a mesh from type ${i}`,e)),x.fromScreenExtent({xmin:0,ymin:0,xmax:1,ymax:1})}}static fromPolygon(t,e){const i=(0,f.Ye)(new p.A,e,!1,!1),n=i.coords,r=new Uint32Array(v(i,!1)),s=new Uint32Array(n.length/2),o=(0,d.vt)(),a=(0,d.vt)();for(let e=0;e<s.length;e++)(0,h.hZ)(o,n[2*e],n[2*e+1]),t.toScreen(a,o),s[e]=(0,_.M9)(Math.floor(a[0]),Math.floor(a[1]));return new x({geometry:s},r,g.WR.TRIANGLES,!0)}static fromScreenExtent({xmin:t,xmax:e,ymin:i,ymax:n}){const r={geometry:new Uint32Array([(0,_.M9)(t,i),(0,_.M9)(e,i),(0,_.M9)(t,n),(0,_.M9)(t,n),(0,_.M9)(e,i),(0,_.M9)(e,n)])},s=new Uint32Array([0,1,2,3,4,5]);return new x(r,s,g.WR.TRIANGLES)}static fromMapExtent(t,e){const[i,n]=t.toScreen([0,0],[e.xmin,e.ymin]),[r,s]=t.toScreen([0,0],[e.xmax,e.ymax]),o={geometry:new Uint32Array([(0,_.M9)(i,n),(0,_.M9)(r,n),(0,_.M9)(i,s),(0,_.M9)(i,s),(0,_.M9)(r,n),(0,_.M9)(r,s)])},a=new Uint32Array([0,1,2,3,4,5]);return new x(o,a,g.WR.TRIANGLES)}destroy(){null!=this._cache.indexBuffer&&this._cache.indexBuffer.dispose(),this._cache.vertexBuffers?.forEach((t=>t?.dispose())),this._cache.indexBuffer=this._cache.vertexBuffers=null}get elementType(){return(()=>{switch(this.indices.BYTES_PER_ELEMENT){case 1:return g.pe.UNSIGNED_BYTE;case 2:return g.pe.UNSIGNED_SHORT;case 4:return g.pe.UNSIGNED_INT;default:throw new s.A("Cannot get DataType of array")}})()}getIndexBuffer(t,e=g._U.STATIC_DRAW){return this._cache.indexBuffer??=m.g.createIndex(t,e,this.indices),this._cache.indexBuffer}getVertexBuffers(t,e=g._U.STATIC_DRAW){return this._cache.vertexBuffers??=new Map(Object.keys(this.vertices).reduce(((i,n)=>(i.push([n,m.g.createVertex(t,e,this.vertices[n])]),i)),new Array)),this._cache.vertexBuffers}}var b=i(57008),S=i(81438);class w extends c.q{constructor(t,e){super(),this._clip=e,this._cache={},this.stage=t,this._handle=(0,a.watch)((()=>e.version),(()=>this._invalidate())),this.ready()}static fromClipArea(t,e){return new w(t,e)}_destroyGL(){null!=this._cache.mesh&&(this._cache.mesh.destroy(),this._cache.mesh=null),null!=this._cache.vao&&(this._cache.vao.dispose(),this._cache.vao=null)}destroy(){this._destroyGL(),this._handle.remove()}getVAO(t,e,i,n){const[r,s]=e.size;if("geometry"!==this._clip.type&&this._lastWidth===r&&this._lastHeight===s||(this._lastWidth=r,this._lastHeight=s,this._destroyGL()),null==this._cache.vao){const r=this._createMesh(e,this._clip),s=r.getIndexBuffer(t),o=r.getVertexBuffers(t);this._cache.mesh=r,this._cache.vao=new S.Z(t,i,n,o,s)}return this._cache.vao}_createTransforms(){return{displayViewScreenMat3:(0,l.vt)()}}_invalidate(){this._destroyGL(),this.requestRender()}_createMesh(t,e){switch(e.type){case"rect":return x.fromScreenExtent((0,b.p)(e,t.size[0],t.size[1]));case"path":return x.fromPath(e);case"geometry":return x.fromGeometry(t,e);default:return o.A.getLogger("esri.views.2d.engine.webgl.ClippingInfo").error(new s.A("mapview-bad-type","Unable to create ClippingInfo mesh from clip of type: ${clip.type}")),x.fromScreenExtent({xmin:0,ymin:0,xmax:1,ymax:1})}}}var T=i(28230);class M extends r.m{set clips(t){super.clips=t,this._updateClippingInfo(t)}renderChildren(t){t.painter.setPipelineState(null),null==this._renderPasses&&(this._renderPasses=this.prepareRenderPasses(t.painter));for(const e of this._renderPasses)try{e.render(t)}catch(t){}}prepareRenderPasses(t){return[t.registerRenderPass({name:"clip",brushes:[n.d.clip],target:()=>this._clippingInfos,drawPhase:T.S5.MAP|T.S5.LABEL|T.S5.LABEL_ALPHA|T.S5.DEBUG|T.S5.HIGHLIGHT})]}_updateClippingInfo(t){null!=this._clippingInfos&&(this._clippingInfos.forEach((t=>t.destroy())),this._clippingInfos=null),null!=t&&t.length&&(this._clippingInfos=t.items.map((t=>w.fromClipArea(this.stage,t)))),this.requestRender()}}},96564:function(t,e,i){i.d(e,{Dy:function(){return d},UD:function(){return c},fO:function(){return u},gy:function(){return o},iT:function(){return h},xy:function(){return l}});var n=i(40633);const r=()=>n.A.getLogger("esri.views.2d.engine.webgl.alignmentUtils");var s,o,a;function l(t){if(!t)return s.Center;switch(t){case"Left":case"left":return s.Left;case"Right":case"right":return s.Right;case"Justify":return r().warnOnce("Horizontal alignment 'justify' is not implemented. Falling back to 'center'."),s.Center;case"Center":case"center":return s.Center}}function c(t){if(!t)return o.Center;switch(t){case"Top":case"top":return o.Top;case"Center":case"middle":return o.Center;case"Baseline":case"baseline":return o.Baseline;case"Bottom":case"bottom":return o.Bottom}}function u(t){switch(t){case"above-left":case"esriServerPointLabelPlacementAboveLeft":return["right","bottom"];case"above-center":case"above-along":case"esriServerPointLabelPlacementAboveCenter":case"esriServerLinePlacementAboveAlong":return["center","bottom"];case"above-right":case"esriServerPointLabelPlacementAboveRight":return["left","bottom"];case"center-left":case"esriServerPointLabelPlacementCenterLeft":return["right","middle"];case"center-center":case"center-along":case"esriServerPointLabelPlacementCenterCenter":case"esriServerLinePlacementCenterAlong":case"always-horizontal":case"esriServerPolygonPlacementAlwaysHorizontal":return["center","middle"];case"center-right":case"esriServerPointLabelPlacementCenterRight":return["left","middle"];case"below-left":case"esriServerPointLabelPlacementBelowLeft":return["right","top"];case"below-center":case"below-along":case"esriServerPointLabelPlacementBelowCenter":case"esriServerLinePlacementBelowAlong":return["center","top"];case"below-right":case"esriServerPointLabelPlacementBelowRight":return["left","top"];default:return console.debug(`Found invalid placement type ${t}`),["center","middle"]}}function h(t){switch(t){case s.Right:case"right":return-1;case s.Center:case"center":return 0;case s.Left:case"left":return 1;default:return console.debug(`Found invalid horizontal alignment ${t}`),0}}function d(t){switch(t){case o.Top:case"top":return 1;case o.Center:case"middle":return 0;case o.Bottom:case o.Baseline:case"baseline":case"bottom":return-1;default:return console.debug(`Found invalid vertical alignment ${t}`),0}}(a=s||(s={}))[a.Left=-1]="Left",a[a.Center=0]="Center",a[a.Right=1]="Right",function(t){t[t.Top=1]="Top",t[t.Center=0]="Center",t[t.Bottom=-1]="Bottom",t[t.Baseline=2]="Baseline"}(o||(o={}))},93937:function(t,e,i){i.d(e,{ZH:function(){return c}});var n=i(61226),r=i(38504),s=(i(25150),i(33389)),o=i(95415);function a(t,e){const{width:i,height:n,getFrame:s}=t,o=t.frameDurations.slice(),a=o.pop();return o.push((0,r.l5)(a+e)),{frameCount:t.frameCount,duration:t.duration+e,frameDurations:o,getFrame:s,width:i,height:n}}class l{constructor(t,e,i,n){this._animation=t,this._repeatType=i,this._onFrameData=n,this._direction=1,this._currentFrame=0,this.timeToFrame=this._animation.frameDurations[this._currentFrame];let r=0;for(;e>r;)r+=this.timeToFrame,this.nextFrame();const s=this._animation.getFrame(this._currentFrame);this._onFrameData(s)}nextFrame(){if(this._currentFrame+=this._direction,this._direction>0){if(this._currentFrame===this._animation.frameDurations.length)switch(this._repeatType){case s.fu.None:this._currentFrame-=this._direction;break;case s.fu.Loop:this._currentFrame=0;break;case s.fu.Oscillate:this._currentFrame-=this._direction,this._direction=-1}}else if(-1===this._currentFrame)switch(this._repeatType){case s.fu.None:this._currentFrame-=this._direction;break;case s.fu.Loop:this._currentFrame=this._animation.frameDurations.length-1;break;case s.fu.Oscillate:this._currentFrame-=this._direction,this._direction=1}this.timeToFrame=this._animation.frameDurations[this._currentFrame];const t=this._animation.getFrame(this._currentFrame);this._onFrameData(t)}}function c(t,e,i,c){const u=null==e.playAnimation||e.playAnimation,h=function(t,e,i,n){let c,{repeatType:u}=e;if(null==u&&(u=s.fu.Loop),!0===e.reverseAnimation&&(t=function(t){const{width:e,height:i}=t,n=t.frameDurations.reverse();return{frameCount:t.frameCount,duration:t.duration,frameDurations:n,getFrame:e=>{const i=t.frameDurations.length-1-e;return t.getFrame(i)},width:e,height:i}}(t)),null!=e.duration&&(t=function(t,e){const{width:i,height:n,getFrame:s}=t,o=e/t.duration,a=t.frameDurations.map((t=>(0,r.l5)(t*o)));return{frameCount:t.frameCount,duration:t.duration,frameDurations:a,getFrame:s,width:i,height:n}}(t,(0,r.l5)(1e3*e.duration))),null!=e.repeatDelay){const i=1e3*e.repeatDelay;u===s.fu.Loop?t=a(t,(0,r.l5)(i)):u===s.fu.Oscillate&&(t=function(t,e){const{width:i,height:n,getFrame:s}=t,o=t.frameDurations.slice(),a=o.shift();return o.unshift((0,r.l5)(a+e)),{frameCount:t.frameCount,duration:t.duration+e,frameDurations:o,getFrame:s,width:i,height:n}}(a(t,(0,r.l5)(i/2)),(0,r.l5)(i/2)))}if(null!=e.startTimeOffset)c=(0,r.l5)(1e3*e.startTimeOffset);else if(null!=e.randomizeStartTime){const n=82749913,s=null!=e.randomizeStartSeed?e.randomizeStartSeed:n,a=(0,o.J)(i,s);c=(0,r.l5)(a*function(t){return(0,r.l5)(t.frameDurations.reduce(((t,e)=>t+e),0))}(t))}else c=(0,r.l5)(0);return new l(t,c,u,n)}(t,e,i,c);let d,f=h.timeToFrame;return function t(){d=u?setTimeout((()=>{h.nextFrame(),f=h.timeToFrame,t()}),f):void 0}(),(0,n.hA)((()=>u&&clearTimeout(d)))}},99121:function(t,e,i){var n;i.d(e,{DW:function(){return p},GA:function(){return h},mv:function(){return n}}),function(t){t.Local="Local",t.Global="Global"}(n||(n={}));class r{generateSource(t){const e=[];for(let i=1;i<this.length;i++)e.push(`vec4 atom${i} = texture(${t.animationTexture}, (pointer + 0.5) / size);`),e.push("pointer.x += 1.0;");for(let t=0;t<this.ins;t++)e.push("top--;"),e.push(`vec4 in${this.ins-t-1} = stack[top];`);for(let t=0;t<this.outs;t++)e.push(`vec4 out${t};`);const{microcode:i}=this;for(const t of i)e.push(t);for(let t=0;t<this.outs;t++)e.push(`stack[top] = out${t};`),e.push("top++;"),e.push(`if (top >= ${f}) { top = ${f-1}; }`);return e}}let s=128;function o(t){return[`float duration = clamp(${t.duration}, 0.05, 3600.0);`,`float startTimeOffset = ${t.startTimeOffset};`,`float repeatDelay = ${t.repeatDelay};`,`float timeOriginSelector = ${t.timeOriginSelector};`,`float repeatType = ${t.repeatType};`,`float easing = ${t.easing};`,`float playAnimation = ${t.playAnimation} * (1.0 - step(0.0, -${t.duration}));`,`float reverseAnimation = ${t.reverseAnimation};`,"float time = globalTime - (timeOriginSelector == 1.0 ? localTimeOrigin : 0.0);","time *= playAnimation;","time *= 1.0 - reverseAnimation * 2.0;","float period = duration + repeatDelay;","time += reverseAnimation == 1.0 ? (period - startTimeOffset - 0.001) : startTimeOffset + 0.001;","float omega = time / period;","float oi = floor(omega);","omega = repeatType == 1.0 || repeatType == 3.0 ? omega - oi : omega;","float of = omega * period;","of = (clamp(of, reverseAnimation * repeatDelay, period - (1.0 - reverseAnimation) * repeatDelay) - reverseAnimation * repeatDelay) / duration;","of = easing == 2.0 ? pow(of, 3.0) : of;","of = easing == 3.0 ? 1.0 - pow(1.0 - of, 3.0) : of;","of = easing == 4.0 ? of < 0.5 ? 4.0 * pow(of, 3.0) : 1.0 - pow(-2.0 * of + 2.0, 3.0) / 2.0 : of;","bool oscillate = repeatType == 3.0 && mod(oi, 2.0) == 1.0;",`${t.out} = oscillate ? 1.0 - of : of;`]}const a={Linear:1,EaseIn:2,EaseOut:3,EaseInOut:4},l={Loop:1,None:2,Oscillate:3},c={Local:1,Global:2};function u(t){const e=a[t.easing],i=l[t.repeatType],n=c[t.timeOriginSelector];return[[t.duration,t.startTimeOffset,t.repeatDelay,n],[i,e,t.playAnimation,t.reverseAnimation]]}const h={scalar:new class extends r{constructor(){super(...arguments),this.opcode=++s,this.length=1,this.ins=0,this.outs=1,this.microcode=["out0 = vec4(atom0.y, atom0.y, atom0.y, atom0.y);"]}encode(t){return[[this.opcode,t,0,0]]}},vector3:new class extends r{constructor(){super(...arguments),this.opcode=++s,this.length=1,this.ins=0,this.outs=1,this.microcode=["out0 = vec4(atom0.yzw, 0.0);"]}encode(t){return[[this.opcode,t[0]||0,t[1]||0,t[2]||0]]}},vector4:new class extends r{constructor(){super(...arguments),this.opcode=++s,this.length=2,this.ins=0,this.outs=1,this.microcode=["out0 = atom1;"]}encode(t){return[[this.opcode,0,0,0],t]}},animatedTransform:new class extends r{constructor(){super(...arguments),this.opcode=++s,this.length=10,this.ins=1,this.outs=1,this.microcode=["vec2 fromTranslation = atom1.xy;","vec2 toTranslation = atom1.zw;","float fromRotation = atom2.x;","float toRotation = atom2.y;","float fromScale = atom2.z;","float toScale = atom2.w;","bool relativeTranslation = atom9.x == 1.0;","bool absoluteScale = atom9.y == 1.0;","vec2 translationMultiplier = relativeTranslation ? pixelDimensions : vec2(1.0, 1.0);","float scaleDivisor = absoluteScale ? pixelDimensions.y : 1.0;","float fTranslation;","{",...o({duration:"atom3.x",startTimeOffset:"atom3.y",repeatDelay:"atom3.z",timeOriginSelector:"atom3.w",repeatType:"atom4.x",easing:"atom4.y",playAnimation:"atom4.z",reverseAnimation:"atom4.w",out:"fTranslation"}),"}","float fRotation;","{",...o({duration:"atom5.x",startTimeOffset:"atom5.y",repeatDelay:"atom5.z",timeOriginSelector:"atom5.w",repeatType:"atom6.x",easing:"atom6.y",playAnimation:"atom6.z",reverseAnimation:"atom6.w",out:"fRotation"}),"}","float fScale;","{",...o({duration:"atom7.x",startTimeOffset:"atom7.y",repeatDelay:"atom7.z",timeOriginSelector:"atom7.w",repeatType:"atom8.x",easing:"atom8.y",playAnimation:"atom8.z",reverseAnimation:"atom8.w",out:"fScale"}),"}","vec2 aTranslation = mix(fromTranslation, toTranslation, fTranslation);","float aRotation = mix(fromRotation, toRotation, fRotation);","float aScale = mix(fromScale, toScale, fScale);","vec2 pTranslation = in0.xy;","float pRotation = in0.z;","float pScale = in0.w;","aTranslation *= translationMultiplier;","aScale /= scaleDivisor;","float rotation = pRotation + aRotation;","float scale = pScale * aScale;","float sin1 = sin(pRotation);","float cos1 = cos(pRotation);","float s1 = pScale;","float x1 = pTranslation.x;","float y1 = pTranslation.y;","float x2 = aTranslation.x;","float y2 = aTranslation.y;","\n    vec2 translation = vec2(\n      cos1 * s1 * x2 - sin1 * s1 * y2 + x1,\n      sin1 * s1 * x2 + cos1 * s1 * y2 + y1\n    );\n    ","out0 = vec4(translation, rotation, scale);"]}encode(t){return[[this.opcode,0,0,0],[t.translation.from[0],t.translation.from[1],t.translation.to[0],t.translation.to[1]],[t.rotation.from,t.rotation.to,t.scale.from,t.scale.to],...u(t.translation.timing),...u(t.rotation.timing),...u(t.scale.timing),[t.relativeTranslation?1:0,t.absoluteScale?1:0,0,0]]}},animatedColor:new class extends r{constructor(){super(...arguments),this.opcode=++s,this.length=7,this.ins=1,this.outs=1,this.microcode=["float fromOpacity = atom0.y;","float toOpacity = atom0.z;","vec4 fromColor = atom1;","vec4 toColor = atom2;","float fColor;","{",...o({duration:"atom3.x",startTimeOffset:"atom3.y",repeatDelay:"atom3.z",timeOriginSelector:"atom3.w",repeatType:"atom4.x",easing:"atom4.y",playAnimation:"atom4.z",reverseAnimation:"atom4.w",out:"fColor"}),"}","float fOpacity;","{",...o({duration:"atom5.x",startTimeOffset:"atom5.y",repeatDelay:"atom5.z",timeOriginSelector:"atom5.w",repeatType:"atom6.x",easing:"atom6.y",playAnimation:"atom6.z",reverseAnimation:"atom6.w",out:"fOpacity"}),"}","vec4 aColor = mix(fromColor, toColor, fColor);","aColor.a *= mix(fromOpacity, toOpacity, fOpacity);","vec4 pColor = in0;","out0 = aColor * pColor;"]}encode(t){return[[this.opcode,t.opacity.from,t.opacity.to,0],[t.color.from[0],t.color.from[1],t.color.from[2],t.color.from[3]],[t.color.to[0],t.color.to[1],t.color.to[2],t.color.to[3]],...u(t.color.timing),...u(t.opacity.timing)]}},ret:new class extends r{constructor(){super(...arguments),this.opcode=++s,this.length=1,this.ins=0,this.outs=0,this.microcode=["break;"]}encode(){return[[this.opcode,0,0,0]]}}},d=40,f=4;function p(t){const e=[];e.push(`float globalTime = ${t.globalTime};`),e.push(`float localTimeOrigin = ${t.localTimeOrigin};`),e.push(`vec2 pointer = ${t.animationPointer};`),e.push(`vec2 size = ${t.animationTextureSize};`),e.push("int top = 0;"),e.push(`vec4 stack[${f}];`),e.push(`for (int counter = 0; counter < ${d}; counter++) {`),e.push(`vec4 atom0 = texture(${t.animationTexture}, (pointer + 0.5) / size);`),e.push("pointer.x += 1.0;"),e.push(`vec2 pixelDimensions = ${t.pixelDimensions};`),e.push("if (false) {");for(const i in h){const n=h[i];e.push(`} else if (int(atom0.x) == ${n.opcode}) {`);for(const i of n.generateSource(t))e.push(i)}return e.push("} // End if-else."),e.push("} // End for."),e.push(`${t.out} = top > 0 ? stack[top - 1] : vec4(0.0);`),e.join("\n")}},73936:function(t,e,i){i.d(e,{A:function(){return c}});var n=i(39686),r=i(77416),s=i(52937),o=i(85456);const a={nearest:{defines:[],samplingMode:o.Cj.NEAREST,mips:!1},bilinear:{defines:[],samplingMode:o.Cj.LINEAR,mips:!1},bicubic:{defines:["bicubic"],samplingMode:o.Cj.LINEAR,mips:!1},trilinear:{defines:[],samplingMode:o.Cj.LINEAR_MIPMAP_LINEAR,mips:!0}},l=(t,e,i)=>{if("dynamic"===i.samplingMode){const{state:i}=t,n=e.resolution/e.pixelRatio/i.resolution,r=Math.round(t.pixelRatio)!==t.pixelRatio,s=n>1.05||n<.95;return i.rotation||s||r||e.isSourceScaled||e.rotation?a.bilinear:a.nearest}return a[i.samplingMode]};class c extends s.A{constructor(){super(...arguments),this._desc={vsPath:"raster/bitmap",fsPath:"raster/bitmap",attributes:new Map([["a_pos",0]])}}dispose(){this._quad&&this._quad.dispose()}prepareState({context:t}){t.setBlendingEnabled(!0),t.setColorMask(!0,!0,!0,!0),t.setStencilWriteMask(0),t.setStencilTestEnabled(!0)}draw(t,e){const{context:i,renderingOptions:s,painter:a,requestRender:c,allowDelayedRender:u}=t;if(!e.source||!e.isReady)return;const h=l(t,e,s),d=a.materialManager.getProgram(this._desc,h.defines);if(u&&null!=c&&!d.compiled)return void c();t.timeline.begin(this.name),"additive"===e.blendFunction?i.setBlendFunctionSeparate(o.dn.ONE,o.dn.ONE,o.dn.ONE,o.dn.ONE):i.setBlendFunctionSeparate(o.dn.ONE,o.dn.ONE_MINUS_SRC_ALPHA,o.dn.ONE,o.dn.ONE_MINUS_SRC_ALPHA),i.setStencilFunction(o.MT.EQUAL,e.stencilRef,255),this._quad||(this._quad=new r.A(i,[0,0,1,0,0,1,1,1]));const{coordScale:f,computedOpacity:p,transforms:_}=e;e.setSamplingProfile(h),e.bind(t.context,n.YS),i.useProgram(d),d.setUniformMatrix3fv("u_dvsMat3",_.displayViewScreenMat3),d.setUniform1i("u_texture",n.YS),d.setUniform2fv("u_coordScale",f),d.setUniform1f("u_opacity",p),this._quad.draw(),t.timeline.end(this.name)}}},52937:function(t,e,i){i.d(e,{A:function(){return n}});class n{constructor(){this.name=this.constructor.name||"UnnamedBrush",this.brushEffect=null}prepareState(t,e){}draw(t,e,i){}drawMany(t,e,i){for(const n of e)n.visible&&this.draw(t,n,i)}}},829:function(t,e,i){i.d(e,{A:function(){return h}});var n=i(43745),r=i(94860),s=i(52937),o=i(94020),a=i(86305),l=i(85456),c=i(10904),u=i(81438);class h extends s.A{constructor(){super(...arguments),this._color=(0,n.fA)(1,0,0,1),this._initialized=!1}dispose(){this._solidProgram&&(this._solidProgram.dispose(),this._solidProgram=null),this._solidVertexArrayObject&&(this._solidVertexArrayObject.dispose(),this._solidVertexArrayObject=null)}prepareState({context:t}){t.setDepthWriteEnabled(!1),t.setDepthTestEnabled(!1),t.setStencilTestEnabled(!0),t.setBlendingEnabled(!1),t.setColorMask(!1,!1,!1,!1),t.setStencilOp(l.eA.KEEP,l.eA.KEEP,l.eA.REPLACE),t.setStencilWriteMask(255)}draw(t,e){const{context:i,requestRender:n,allowDelayedRender:r}=t;this._initialized||this._initialize(i),!r||null==n||this._solidProgram.compiled?(i.setStencilFunctionSeparate(l.Y7.FRONT_AND_BACK,l.MT.GREATER,e.stencilRef,255),i.bindVAO(this._solidVertexArrayObject),i.useProgram(this._solidProgram),this._solidProgram.setUniformMatrix3fv("u_dvsMat3",e.transforms.displayViewScreenMat3),this._solidProgram.setUniform2fv("u_coord_range",[e.rangeX,e.rangeY]),this._solidProgram.setUniform1f("u_depth",0),this._solidProgram.setUniform4fv("u_color",this._color),i.drawArrays(l.WR.TRIANGLE_STRIP,0,4),i.bindVAO()):n()}_initialize(t){if(this._initialized)return!0;const e=(0,c.r)(t,o.T);if(!e)return!1;const i=new Int8Array([0,0,1,0,0,1,1,1]),n=a.g.createVertex(t,l._U.STATIC_DRAW,i),s=new u.Z(t,o.T.attributes,r.Pd,new Map([["geometry",n]]));return this._solidProgram=e,this._solidVertexArrayObject=s,this._initialized=!0,!0}}},55382:function(t,e,i){i.d(e,{A:function(){return m}});var n=i(43745),r=i(94860),s=i(27657),o=i(52937),a=i(94020),l=i(47272),c=i(86305),u=i(85456),h=i(10904),d=i(12285),f=i(10956),p=i(81438);const _=16;class m extends o.A{constructor(){super(...arguments),this._color=(0,n.fA)(1,0,0,1)}dispose(){this._outlineProgram?.dispose(),this._outlineProgram=null,this._tileInfoProgram?.dispose(),this._tileInfoProgram=null,this._outlineVertexArrayObject?.dispose(),this._outlineVertexArrayObject=null,this._tileInfoVertexArrayObject?.dispose(),this._tileInfoVertexArrayObject=null,this._ctx=null}prepareState({context:t}){t.setBlendingEnabled(!0),t.setBlendFunctionSeparate(u.dn.ONE,u.dn.ONE_MINUS_SRC_ALPHA,u.dn.ONE,u.dn.ONE_MINUS_SRC_ALPHA),t.setColorMask(!0,!0,!0,!0),t.setStencilWriteMask(0),t.setStencilTestEnabled(!1)}draw(t,e){const{context:i,requestRender:n,allowDelayedRender:r}=t;if(!e.isReady&&e instanceof s.R&&e.hasData)return;if(this._loadWGLResources(i),r&&null!=n&&(!this._outlineProgram.compiled||!this._tileInfoProgram.compiled))return void n();i.bindVAO(this._outlineVertexArrayObject),i.useProgram(this._outlineProgram),this._outlineProgram.setUniformMatrix3fv("u_dvsMat3",e.transforms.displayViewScreenMat3),this._outlineProgram.setUniform2f("u_coord_range",e.rangeX,e.rangeY),this._outlineProgram.setUniform1f("u_depth",0),this._outlineProgram.setUniform4fv("u_color",this._color),i.drawArrays(u.WR.LINE_STRIP,0,4);const o=this._getTexture(i,e);o?(i.bindVAO(this._tileInfoVertexArrayObject),i.useProgram(this._tileInfoProgram),i.bindTexture(o,0),this._tileInfoProgram.setUniformMatrix3fv("u_dvsMat3",e.transforms.displayViewScreenMat3),this._tileInfoProgram.setUniform1f("u_depth",0),this._tileInfoProgram.setUniform2f("u_coord_ratio",e.rangeX/e.width,e.rangeY/e.height),this._tileInfoProgram.setUniform2f("u_delta",0,0),this._tileInfoProgram.setUniform2f("u_dimensions",o.descriptor.width,o.descriptor.height),i.drawArrays(u.WR.TRIANGLE_STRIP,0,4),i.bindVAO()):i.bindVAO()}_loadWGLResources(t){if(this._outlineProgram&&this._tileInfoProgram)return;const e=(0,h.r)(t,a.T),i=(0,h.r)(t,l.H),n=new Int8Array([0,0,1,0,1,1,0,1]),s=c.g.createVertex(t,u._U.STATIC_DRAW,n),o=new p.Z(t,a.T.attributes,r.Pd,new Map([["geometry",s]])),d=new Int8Array([0,0,1,0,0,1,1,1]),f=c.g.createVertex(t,u._U.STATIC_DRAW,d),_=new p.Z(t,l.H.attributes,r.Pd,new Map([["geometry",f]]));this._outlineProgram=e,this._tileInfoProgram=i,this._outlineVertexArrayObject=o,this._tileInfoVertexArrayObject=_}_getTexture(t,e){if(!this._ctx){const t=document.createElement("canvas");t.width=512,t.height=512,this._ctx=t.getContext("2d")}if(!e.tileDebugInfoTexture){const i=new f.R;i.wrapMode=u.pF.CLAMP_TO_EDGE,i.samplingMode=u.Cj.LINEAR,i.isImmutable=!0,i.width=512,i.height=512,e.tileDebugInfoTexture=new d.g(t,i)}const i=this._ctx;i.clearRect(0,0,i.canvas.width,i.canvas.height),i.textAlign="left",i.textBaseline="top",i.font="14px sans-serif",i.lineWidth=2,i.fillStyle="white",i.strokeStyle="black";const{debugSlot:n}=e;let r=8+99.2*n;const s=`${n}) ${e.key.id} (${e.constructor.name})`;i.strokeText(s,8,r),i.fillText(s,8,r),r+=_;const{debugInfo:o}=e;if(o){const{length:t,minOrderedLength:e,minUnorderedLength:n,triangleCount:s}=o.display;if(t>0){const e=`Length: ${t}`;i.strokeText(e,8,r),i.fillText(e,8,r),r+=_}if(e){const t=`Min ordered length: ${e}`;i.strokeText(t,8,r),i.fillText(t,8,r),r+=_}if(n){const t=`Min unordered length: ${n}`;i.strokeText(t,8,r),i.fillText(t,8,r),r+=_}if(s>0){s>1e5&&(i.fillStyle="red",i.strokeStyle="white");const t=`Triangle count: ${s}`;i.strokeText(t,8,r),i.fillText(t,8,r),r+=_}const{bytesUsed:a,bytesReserved:l}=o.memory;if(i.fillStyle="white",i.strokeStyle="black",a>0||l>0){const t=`Memory usage: ${a} of ${l} bytes`;i.strokeText(t,8,r),i.fillText(t,8,r),r+=_}}return e.tileDebugInfoTexture.setData(i.canvas),e.tileDebugInfoTexture}}},87573:function(t,e,i){i.d(e,{A:function(){return r}});var n=i(14583);class r{constructor(t,e,i,r){this.transformedX=0,this.transformedY=0,this.center=(0,n.fA)(t,e),this.centerT=(0,n.vt)(),this.halfWidth=i/2,this.halfHeight=r/2,this.width=i,this.height=r}get x(){return this.center[0]}get y(){return this.center[1]}get blX(){return this.center[0]+this.halfWidth}get blY(){return this.center[1]+this.halfHeight}get trX(){return this.center[0]-this.halfWidth}get trY(){return this.center[1]-this.halfHeight}get xmin(){return this.x-this.halfWidth}get xmax(){return this.x+this.halfWidth}get ymin(){return this.y-this.halfHeight}get ymax(){return this.y+this.halfHeight}set x(t){this.center[0]=t}set y(t){this.center[1]=t}clone(){return new r(this.x,this.y,this.width,this.height)}serialize(t){return t.writeF32(this.center[0]),t.writeF32(this.center[1]),t.push(this.width),t.push(this.height),t}findCollisionDelta(t,e=4){const i=Math.abs(t.centerT[0]-this.centerT[0]),n=Math.abs(t.centerT[1]-this.centerT[1]),r=(t.halfWidth+this.halfWidth+e)/i,s=(t.halfHeight+this.halfHeight+e)/n,o=Math.min(r,s);return Math.log2(o)}extend(t){const e=Math.min(this.xmin,t.xmin),i=Math.min(this.ymin,t.ymin),n=Math.max(this.xmax,t.xmax)-e,r=Math.max(this.ymax,t.ymax)-i,s=e+n/2,o=i+r/2;this.width=n,this.height=r,this.halfWidth=n/2,this.halfHeight=r/2,this.x=s,this.y=o}static deserialize(t){const e=t.readF32(),i=t.readF32(),n=t.readInt32(),s=t.readInt32();return new r(e,i,n,s)}}},57650:function(t,e,i){i.d(e,{f:function(){return s}});var n=i(87573),r=i(24964);class s{constructor(t,e,i,n,r,s,o,a,l=[]){this.entityTexel=t,this.anchorX=e,this.anchorY=i,this.directionX=n,this.directionY=r,this.maxScale=s,this.minScale=o,this.referenceBounds=a,this.bounds=l}serialize(t){t.push(this.entityTexel),t.writeF32(this.anchorX),t.writeF32(this.anchorY),t.writeF32(this.directionX),t.writeF32(this.directionY),t.writeF32(this.maxScale),t.writeF32(this.minScale),null===this.referenceBounds?(t.writeF32(0),t.writeF32(0),t.writeF32(0)):(t.writeF32(this.referenceBounds.size),t.writeF32(this.referenceBounds.offsetX),t.writeF32(this.referenceBounds.offsetY)),(0,r.j)(t,this.bounds)}static deserialize(t){const e=t.readInt32(),i=t.readF32(),o=t.readF32(),a=t.readF32(),l=t.readF32(),c=t.readF32(),u=t.readF32(),h=t.readF32(),d=t.readF32(),f=t.readF32(),p=(0,r._)(t,n.A)??[];return new s(e,i,o,a,l,c,u,{size:h,offsetX:d,offsetY:f},p)}}},83258:function(t,e,i){i.d(e,{B:function(){return n},P:function(){return r}});class n{constructor(t){if(this.next=null,!Array.isArray(t))return void(this.data=t);this.data=t[0];let e=this;for(let i=1;i<t.length;i++)e.next=new n([t[i]]),e=e.next}*values(){let t=this;for(;t;)yield t.data,t=t.next}forEach(t){let e=this;for(;e;)t(e.data),e=e.next}get last(){return this.next?this.next.last:this}}class r{constructor(t){this._head=null,null!=t&&(this._head=new n(t))}get head(){return this._head}maxAvailableSpace(){if(null==this._head)return 0;let t=0;return this._head.forEach((e=>{const i=e.end-e.start;t=Math.max(t,i)})),t}firstFit(t){if(null==this._head)return null;let e=null,i=this._head;for(;i;){const n=i.data.end-i.data.start;if(n===t)return e?e.next=i.next:this._head=i.next,i.data.start;if(n>t){const e=i.data.start;return i.data.start+=t,e}e=i,i=i.next}return null}free(t,e){const i=t+e;if(null==this._head){const e=new n({start:t,end:i});return void(this._head=e)}if(i<=this._head.data.start){if(i===this._head.data.start)return void(this._head.data.start-=e);const r=new n({start:t,end:i});return r.next=this._head,void(this._head=r)}let r=this._head,s=r.next;for(;s;){if(s.data.start>=i){if(r.data.end===t){if(r.data.end+=e,r.data.end===s.data.start){const t=s.data.end-s.data.start;return r.data.end+=t,void(r.next=s.next)}return}if(s.data.start===i)return void(s.data.start-=e);const o=new n({start:t,end:i});return o.next=r.next,void(r.next=o)}r=s,s=s.next}if(t===r.data.end)return void(r.data.end+=e);const o=new n({start:t,end:i});r.next=o}clear(){this._head=null}}},95415:function(t,e,i){i.d(e,{A:function(){return s},J:function(){return r}});var n=i(50944);function r(t,e){let i;if("string"==typeof t)i=(0,n.Wm)(t+`-seed(${e})`);else{let n=12;i=t^e;do{i=107*(i>>8^i)+n|0}while(0!=--n)}return(1+i/(1<<31))/2}function s(t){return Math.floor(r(t,o)*a)}const o=53290320,a=10},80308:function(t,e,i){i.d(e,{U:function(){return a}});var n=i(46065),r=i(88231);class s{get length(){return this._pos}constructor(t,e){this._pos=0;const i=e?this._roundToNearest(e,t.BYTES_PER_ELEMENT):40;this._array=new ArrayBuffer(i),this._buffer=new t(this._array),this._ctor=t,this._i16View=new Int16Array(this._array)}_roundToNearest(t,e){const i=Math.round(t);return 1===e?i:i+(e-i%e)}_ensureSize(t){if(this._pos+t>=this._buffer.length){const e=this._roundToNearest(1.25*(this._array.byteLength+t*this._buffer.BYTES_PER_ELEMENT),this._buffer.BYTES_PER_ELEMENT),i=new ArrayBuffer(e),n=new this._ctor(i);n.set(this._buffer,0),this._array=i,this._buffer=n,this._i16View=new Int16Array(this._array)}}ensureSize(t){this._ensureSize(t)}writeF32(t){this._ensureSize(1);const e=this._pos;return new Float32Array(this._array,4*this._pos,1)[0]=t,this._pos++,e}push(t){this._ensureSize(1);const e=this._pos;return this._buffer[this._pos++]=t,e}writeFixed(t){this._buffer[this._pos++]=t}setValue(t,e){this._buffer[t]=e}i1616Add(t,e,i){this._i16View[2*t]+=e,this._i16View[2*t+1]+=i}getValue(t){return this._buffer[t]}getValueF32(t){return new Float32Array(this._array,4*t,1)[0]}incr(t){if(this._buffer.length<t)throw new Error("Increment index overflows the target buffer");this._buffer[t]++}decr(t){this._buffer[t]--}writeRegion(t){this._ensureSize(t.length);const e=this._pos;return this._buffer.set(t,this._pos),this._pos+=t.length,e}writeManyFrom(t,e,i){this._ensureSize(i-e);for(let n=e;n!==i;n++)this.writeFixed(t._buffer[n])}buffer(){const t=this._array.slice(0,4*this._pos);return this.destroy(),t}toArray(){return[...this._buffer]}seek(t){this._pos=t}destroy(){this._array=null,this._buffer=null}}class o{constructor(t,e,i=0){const n=6*i*Uint32Array.BYTES_PER_ELEMENT,r=4*i*e.stride,o=e.stride/4,a=e.attributes.find((t=>"pos"===t.name||"position"===t.name));if(!a)throw new Error("InternalError: Unable to find position attribute");this.layout={...e,position:a},this._indices=new s(Uint32Array,n),this._vertices=new s(Uint32Array,r),this._metrics=new s(Uint32Array,0),this._metricCountOffset=this._metrics.push(0),this._strideInt=o,this._instanceId=t}serialize(t){const e=this._indices.buffer(),i=this._vertices.buffer(),n=this._metrics.length?this._metrics.buffer():null;return t.push(e,i),{instanceId:this._instanceId,layout:this.layout,indices:e,vertices:i,metrics:n}}get strideInt(){return this._strideInt}get vertexCount(){return this._vertices.length/this._strideInt}get indexCount(){return this._indices.length}get indexWriter(){return this._indices}get vertexWriter(){return this._vertices}get metricWriter(){return this._metrics}vertexEnsureSize(t){this._vertices.ensureSize(t)}indexEnsureSize(t){this._indices.ensureSize(t)}writeIndex(t){this._indices.push(t)}writeVertex(t){this._vertices.push(t)}writeVertexRegion(t){this._vertices.writeRegion(t)}writeVertexF32(t){this._vertices.writeF32(t)}writeMetric(t){this._metrics.incr(this._metricCountOffset),t.serialize(this._metrics)}}class a{constructor(t,e=0){this._id=t,this._sizeHint=e,this._entityRecordCountOffset=0,this._entityCountOffset=0,this._entityIdIndex=0,this._entitySortKeyIndex=0,this._didEntityStart=!1,this._instanceIdToVertexData=new Map,this._recordIndexStart=0,this._recordIndexCount=0,this._recordVertexStart=0,this._recordVertexCount=0,this._current={metric:null,writer:null,start:0,sortKey:0,instanceId:0,layoutHash:0,indexStart:0,vertexStart:0,textureKey:0,metricBoxLenPointer:0},this._entities=new s(Uint32Array,this._sizeHint*n.A.byteSizeHint),this._entityCountOffset=this._entities.push(0)}get id(){return this._id}serialize(){const t=new Array,e=[],i=this._entities.buffer();for(const i of this._instanceIdToVertexData.values())e.push(i.serialize(t));return{message:{data:e,entities:i},transferList:t}}vertexCount(){return this._current.writer?.vertexCount??0}indexCount(){return this._current.writer?.indexCount??0}vertexEnsureSize(t){this._current.writer.vertexEnsureSize(t)}indexEnsureSize(t){this._current.writer.indexEnsureSize(t)}vertexWrite(t){this._current.writer.writeVertex(t)}vertexWriteRegion(t){this._current.writer.writeVertexRegion(t)}vertexWriteF32(t){this._current.writer.writeVertexF32(t)}recordBounds(t,e,i,n){}indexWrite(t){this._current.writer.writeIndex(t)}metricStart(t){this._current.metric=t}metricEnd(){const t=this._current.writer;this._current.metric.bounds.length&&t.writeMetric(this._current.metric)}metricBoxWrite(t){this._current.metric.bounds.push(t)}entityStart(t,e=t){this._entityIdIndex=this._entities.push(t),this._entitySortKeyIndex=this._entities.writeF32(e),this._entityRecordCountOffset=this._entities.push(0),this._didEntityStart=!0}entityRecordCount(){return this._entities.getValue(this._entityRecordCountOffset)}entityEnd(){this._didEntityStart&&(0===this.entityRecordCount()?this._entities.seek(this._entityIdIndex):this._entities.incr(this._entityCountOffset),this._didEntityStart=!1)}recordCount(){return this._entities.getValue(this._entityRecordCountOffset)}recordStart(t,e,i=0){this._current.writer=this._getVertexWriter(t,e),this._current.indexStart=this._current.writer.indexCount,this._current.vertexStart=this._current.writer.vertexCount,this._current.instanceId=t,this._current.layoutHash=e.hash,this._current.textureKey=i}recordEnd(t=0){const e=this._current.vertexStart,i=this._current.writer.vertexCount-e;if(!i)return!1;const n=this._current.indexStart,s=this._current.writer.indexCount-n;return this._recordIndexStart=n,this._recordIndexCount=s,this._recordVertexStart=e,this._recordVertexCount=i,this._entities.incr(this._entityRecordCountOffset),r.A.write(this._entities,this._current.instanceId,this._current.textureKey,n,s,e,i,t),!0}copyLast(t,e){const i=this._recordVertexStart+this._recordVertexCount;this._entities.incr(this._entityRecordCountOffset),r.A.write(this._entities,this._current.instanceId,this._current.textureKey,this._recordIndexStart+this._recordIndexCount,this._recordIndexCount,i,this._recordVertexCount,0);const n=this._current.writer.indexWriter,s=this._current.writer.vertexWriter,o=this._recordIndexStart+this._recordIndexCount,a=this._recordVertexCount;for(let t=this._recordIndexStart;t!==o;t++){const e=n.getValue(t);n.push(e+a)}const l=this._current.writer.layout.stride/Uint32Array.BYTES_PER_ELEMENT,c=this._recordVertexStart*l,u=(this._recordVertexStart+this._recordVertexCount)*l;for(let t=c;t!==u;t++){const e=s.getValue(t);s.push(e)}const h=this._current.writer.layout.position,d=h.packPrecisionFactor??1,f=h.offset/Uint32Array.BYTES_PER_ELEMENT,p=t*d,_=e*d;for(let t=i*l;t<=s.length;t+=l)s.i1616Add(t+f,p,_)}copyLastFrom(t,e,i){const n=t._entities.getValue(t._entityIdIndex);if(n!==this._entities.getValue(this._entityIdIndex)){const e=t._entities.getValueF32(t._entitySortKeyIndex);this.entityStart(n,e)}this.recordStart(t._current.instanceId,t._current.writer.layout,t._current.textureKey);const r=this._current.writer.layout.stride/Uint32Array.BYTES_PER_ELEMENT,s=this._current.vertexStart,o=t._current.vertexStart-s,a=this._current.writer.indexWriter,l=this._current.writer.vertexWriter,c=t._current.writer.indexWriter,u=t._current.writer.vertexWriter;for(let e=t._current.indexStart;e!==c.length;e++){const t=c.getValue(e);a.push(t-o)}for(let e=t._current.vertexStart*r;e!==u.length;e++){const t=u.getValue(e);l.push(t)}const h=this._current.writer.layout.position,d=h.packPrecisionFactor??1,f=h.offset/Uint32Array.BYTES_PER_ELEMENT,p=e*d,_=i*d;for(let t=s*r;t<=l.length;t+=r)l.i1616Add(t+f,p,_);this.recordEnd()}_getVertexWriter(t,e){const i=this._instanceIdToVertexData;return i.has(t)||i.set(t,new o(t,e,this._sizeHint)),i.get(t)}}},93561:function(t,e,i){i.d(e,{J:function(){return o}});var n=i(50944),r=i(88413);class s{}class o extends s{constructor(t){super(),this._fetcher=t,this._controller=new AbortController,this._pendingIds=new Set,this._pendingRequests=[],this._resourceIdToResource=new Map}destroy(){this._controller.abort()}get _abortOptions(){return{signal:this._controller.signal}}enqueueRequest(t){const e=(0,r.IF)(t.resource),i=(0,n.Wm)(JSON.stringify(e));return this._pendingIds.has(i)||(this._pendingIds.add(i),this._pendingRequests.push({...t,resourceId:i})),i}async fetchEnqueuedResources(){const t=this._pendingRequests;this._pendingIds.clear(),this._pendingRequests=[];const e=await this._fetcher.fetch(t,this._abortOptions);for(let i=0;i<e.length;i++){const n=t[i].resourceId;this._resourceIdToResource.set(n,e[i])}}async fetchResourceImmediate(t){const e=await this._fetcher.fetch([t],this._abortOptions);if(1!==e.length)throw new Error("FeaturePipelineResourceProxy: failed to fetch resources");return e[0]}async fetchDictionaryResourceImmediate(t){const e=await this._fetcher.fetchDictionary([t],this._abortOptions);if(1!==e.length)throw new Error("FeaturePipelineResourceProxy: failed to fetch dictionary resources");return e[0]}getResource(t){return this._resourceIdToResource.get(t)}}},17469:function(t,e,i){i.d(e,{Tl:function(){return T}});var n=i(67348),r=i(10793),s=i(13786),o=i(14583),a=i(96564),l=i(54904),c=i(87573);const u=22,h=4,d=u+h,f=u-6,p=3,_=Math.PI/180;class m{constructor(t,e,i,n){this._rotationT=(0,r.vt)(),this._xBounds=0,this._yBounds=0,this.minZoom=0,this.maxZoom=255,this._bounds=null;const s=i.rect,o=new Float32Array(8);t*=n,e*=n;const a=i.code?s.width*n:i.metrics.width,l=i.code?s.height*n:i.metrics.height;this.width=a,this.height=l,o[0]=t,o[1]=e,o[2]=t+a,o[3]=e,o[4]=t,o[5]=e+l,o[6]=t+a,o[7]=e+l,this._data=o,this._setTextureCoords(s),this._scale=n,this._mosaic=i,this.x=t,this.y=e,this.maxOffset=Math.max(t+a,e+l)}get mosaic(){return this._mosaic}set angle(t){this._angle=t,(0,n.$0)(this._rotationT,-t),this._setOffsets()}get angle(){return this._angle}get xTopLeft(){return this._data[0]}get yTopLeft(){return this._data[1]}get xBottomRight(){return this._data[6]}get yBottomRight(){return this._data[7]}get texcoords(){return this._texcoords}get textureBinding(){return this._mosaic.textureBinding}get offsets(){return this._offsets||this._setOffsets(),this._offsets}get char(){return String.fromCharCode(this._mosaic.code)}get code(){return this._mosaic.code}get bounds(){if(!this._bounds){const{height:t,width:e}=this._mosaic.metrics,i=e*this._scale,s=Math.abs(t)*this._scale,o=new Float32Array(8);o[0]=this.x,o[1]=this.y,o[2]=this.x+i,o[3]=this.y,o[4]=this.x,o[5]=this.y+s,o[6]=this.x+i,o[7]=this.y+s;const a=(0,n.lw)((0,r.vt)(),this._rotationT,this._transform);(0,r.gb)(o,o,a);let l=1/0,u=1/0,h=-1/0,d=-1/0;for(let t=0;t<4;t++){const e=o[2*t],i=o[2*t+1];l=Math.min(l,e),u=Math.min(u,i),h=Math.max(h,e),d=Math.max(d,i)}const f=h-l,p=d-u,_=l+f/2,m=u+p/2;this._bounds=new c.A(_,m,f,p)}return this._bounds}setTransform(t){this._transform=t,this._offsets=null}_setOffsets(){this._offsets||(this._offsets={topLeft:[0,0],topRight:[0,0],bottomLeft:[0,0],bottomRight:[0,0]});const t=(0,n.lw)((0,r.vt)(),this._rotationT,this._transform);this._offsets.topLeft[0]=this._data[0],this._offsets.topLeft[1]=this._data[1],this._offsets.topRight[0]=this._data[2],this._offsets.topRight[1]=this._data[3],this._offsets.bottomLeft[0]=this._data[4],this._offsets.bottomLeft[1]=this._data[5],this._offsets.bottomRight[0]=this._data[6],this._offsets.bottomRight[1]=this._data[7],(0,s.l0)(this._offsets.topLeft,this._offsets.topLeft,t),(0,s.l0)(this._offsets.topRight,this._offsets.topRight,t),(0,s.l0)(this._offsets.bottomLeft,this._offsets.bottomLeft,t),(0,s.l0)(this._offsets.bottomRight,this._offsets.bottomRight,t)}_setTextureCoords({x:t,y:e,width:i,height:n}){this._texcoords={topLeft:[t,e],topRight:[t+i,e],bottomLeft:[t,e+n],bottomRight:[t+i,e+n]}}}const g=(t,e)=>({code:0,page:0,sdf:!0,rect:new l.A(0,0,11,8),textureBinding:e,metrics:{advance:0,height:4,width:t,left:0,top:0}});function y(t,e){return t.forEach((t=>(0,s.l0)(t,t,e))),{topLeft:t[0],topRight:t[1],bottomLeft:t[2],bottomRight:t[3]}}class v{constructor(t,e,i){this._rotation=0,this._decorate(t,e,i),this.glyphs=t,this.bounds=this._createBounds(t),this.isMultiline=e.length>1,this._hasRotation=0!==i.angle,this._transform=this._createGlyphTransform(this.bounds,i),this._borderLineSizePx=i.borderLineSizePx,(i.borderLineSizePx||i.hasBackground)&&([this.bounds,this.textBox]=this.shapeBackground(this._transform));for(const e of t)e.setTransform(this._transform)}setRotation(t){if(0===t&&0===this._rotation)return;this._rotation=t;const e=this._transform,i=(0,n.$0)((0,r.vt)(),t);(0,n.lw)(e,i,e);for(const t of this.glyphs)t.setTransform(this._transform)}_decorate(t,e,i){if(!i.decoration||"none"===i.decoration||!t.length)return;const n=i.scale,r="underline"===i.decoration?d:f,s=t[0].textureBinding;for(const i of e){const e=i.startX*n,o=i.startY*n,a=(i.width+i.glyphWidthEnd)*n;t.push(new m(e,o+r*n,g(a,s),1))}}shapeBackground(t){const e=(1.5+(this._borderLineSizePx||0))/2,i=this._borderLineSizePx?e:0,{xmin:n,ymin:r,xmax:s,ymax:o,x:a,y:l,width:u,height:h}=this.bounds,d=[n-8,r-8],f=[s+8,r-8],p=[n-8,o+8],_=[s+8,o+8],m=y([[d[0]-e,d[1]-e],[f[0]+e,f[1]-e],[d[0]+i,d[1]+i],[f[0]-i,f[1]+i]],t),g=y([[p[0]+i,p[1]-i],[_[0]-i,_[1]-i],[p[0]-e,p[1]+e],[_[0]+e,_[1]+e]],t),v=y([[d[0]-e,d[1]-e],[d[0]+i,d[1]+i],[p[0]-e,p[1]+e],[p[0]+i,p[1]-i]],t),x=y([[f[0]-i,f[1]+i],[f[0]+e,f[1]-e],[_[0]-i,_[1]-i],[_[0]+e,_[1]+e]],t),b={main:y([d,f,p,_],t),top:m,bot:g,left:v,right:x};return[new c.A(a,l,u+2*e,h+2*e),b]}get boundsT(){const t=this.bounds,e=(0,s.hZ)((0,o.vt)(),t.x,t.y);if((0,s.l0)(e,e,this._transform),this._hasRotation){const i=Math.max(t.width,t.height);return new c.A(e[0],e[1],i,i)}return new c.A(e[0],e[1],t.width,t.height)}_createBounds(t){let e=1/0,i=1/0,n=0,r=0;for(const s of t)e=Math.min(e,s.xTopLeft),i=Math.min(i,s.yTopLeft),n=Math.max(n,s.xBottomRight),r=Math.max(r,s.yBottomRight);const s=n-e,o=r-i;return new c.A(e+s/2,i+o/2,s,o)}_createGlyphTransform(t,e){const i=_*e.angle,a=(0,r.vt)(),l=(0,o.vt)();return(0,n.Tl)(a,a,(0,s.hZ)(l,e.xOffset,-e.yOffset)),e.useCIMAngleBehavior?(0,n.e$)(a,a,i):((0,n.Tl)(a,a,(0,s.hZ)(l,t.x,t.y)),(0,n.e$)(a,a,i),(0,n.Tl)(a,a,(0,s.hZ)(l,-t.x,-t.y))),a}}class x{constructor(t,e,i,n,r,s){this.glyphWidthEnd=0,this.startX=0,this.startY=0,this.start=Math.max(0,Math.min(e,i)),this.end=Math.max(0,Math.max(e,i)),this.end<t.length&&(this.glyphWidthEnd=t[this.end].metrics.width),this.width=n,this.yMin=r,this.yMax=s}}const b=t=>10===t,S=t=>32===t;function w(t,e){let i=0;for(let e=0;e<t.length;e++){const{width:n}=t[e];i=Math.max(n,i)}const n="underline"===e.decoration?h:0,r=t[0].yMin;return{x:0,y:r,height:t[t.length-1].yMax+e.lineHeight*(t.length-1)+n-r,width:i}}function T(t,e){const i=e.scale,n=new Array,{glyphs:r,isRightToLeft:s}=t,o=function(t,e,i){const n=new Array,r=1/i.scale,s=i.maxLineWidth*r,o=e?t.length-1:0,a=e?-1:t.length,l=e?-1:1;let c=o,u=0,h=0,d=c,f=d,p=0,_=1/0,m=0;for(;c!==a;){const{code:e,metrics:i}=t[c],r=Math.abs(i.top);if(b(e)||S(e)||(_=Math.min(_,r),m=Math.max(m,r+i.height)),b(e))c!==o&&(n.push(new x(t,d,c-l,u,_===1/0?0:_,m)),_=1/0,m=0),u=0,d=c+l,f=c+l,h=0;else if(S(e))f=c+l,h=0,p=i.advance,u+=i.advance;else if(u>s){if(f!==d){const e=f-2*l;u-=p,n.push(new x(t,d,e,u-h,_,m)),_=1/0,m=0,d=f,u=h}else n.push(new x(t,d,c-l,u,_,m)),_=1/0,m=0,d=c,f=c,u=0;u+=i.advance,h+=i.advance}else u+=i.advance,h+=i.advance;c+=l}const g=new x(t,d,c-l,u,_,m);return g.start>=0&&g.end<t.length&&n.push(g),n}(r,s,e),l=o.length?w(o,e):{x:0,y:0,height:0,width:0},c=(0,a.xy)(e.horizontalAlignment),h=(0,a.UD)(e.verticalAlignment),d=h===a.gy.Baseline?1:0,f=d?0:h-1,_=(1-d)*-l.y+f*(l.height/2)+(d?1:0)*-u;for(let s=0;s<o.length;s++){const{start:a,end:l,width:u}=o[s];let h=-1*(c+1)*(u/2)-p;const d=(t.isRightToLeft?o.length-1-s:s)*e.lineHeight+_-p;o[s].startX=h,o[s].startY=d;for(let t=a;t<=l;t++){const e=r[t];if(b(e.code))continue;const s=new m(h+e.metrics.left,d-e.metrics.top,e,i);h+=e.metrics.advance,n.push(s)}}return new v(n,o,e)}},69825:function(t,e,i){i.d(e,{uS:function(){return U},FE:function(){return V},lO:function(){return N},XZ:function(){return B}}),i(59122);var n=i(81484),r=i(72139),s=i(76613),o=i(39686);function a(t,e,i,n,r,s,o){O=0;const a=(n-i)*s,c=r&&r.length,h=c?(r[0]-i)*s:a;let d,f,p,_,g,y=l(e,i,0,0,h,s,!0);if(y&&y.next!==y.prev){if(c&&(y=m(e,i,n,r,y,s)),a>80*s){d=p=e[0+i*s],f=_=e[1+i*s];for(let t=s;t<h;t+=s){const n=e[t+i*s],r=e[t+1+i*s];d=Math.min(d,n),f=Math.min(f,r),p=Math.max(p,n),_=Math.max(_,r)}g=Math.max(p-d,_-f),g=0!==g?1/g:0}u(y,t,s,d,f,g,o,0)}}function l(t,e,i,n,r,s,o){let a;if(o===function(t,e,i,n,r,s){let o=0;for(let i=n,a=r-s;i<r;i+=s)o+=(t[a+e*s]-t[i+e*s])*(t[i+1+e*s]+t[a+1+e*s]),a=i;return o}(t,e,0,n,r,s)>0)for(let i=n;i<r;i+=s)a=f(i+e*s,t[i+e*s],t[i+1+e*s],a);else for(let i=r-s;i>=n;i-=s)a=f(i+e*s,t[i+e*s],t[i+1+e*s],a);return a&&T(a,a.next)&&(p(a),a=a.next),a}function c(t,e=t){if(!t)return t;let i,n=t;do{if(i=!1,n.steiner||!T(n,n.next)&&0!==v(n.prev,n,n.next))n=n.next;else{if(p(n),n=e=n.prev,n===n.next)break;i=!0}}while(i||n!==e);return e}function u(t,e,i,n,r,s,o,a){if(!t)return;!a&&s&&(t=y(t,n,r,s));let l=t;for(;t.prev!==t.next;){const f=t.prev,_=t.next;if(s?d(t,n,r,s):h(t))e.push(f.index/i+o),e.push(t.index/i+o),e.push(_.index/i+o),p(t),t=_.next,l=_.next;else if((t=_)===l){a?1===a?u(t=P(t,e,i,o),e,i,n,r,s,o,2):2===a&&A(t,e,i,n,r,s,o):u(c(t),e,i,n,r,s,o,1);break}}}function h(t){const e=t.prev,i=t,n=t.next;if(v(e,i,n)>=0)return!1;let r=t.next.next;const s=r;let o=0;for(;r!==t.prev&&(0===o||r!==s);){if(o++,b(e.x,e.y,i.x,i.y,n.x,n.y,r.x,r.y)&&v(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function d(t,e,i,n){const r=t.prev,s=t,o=t.next;if(v(r,s,o)>=0)return!1;const a=r.x<s.x?r.x<o.x?r.x:o.x:s.x<o.x?s.x:o.x,l=r.y<s.y?r.y<o.y?r.y:o.y:s.y<o.y?s.y:o.y,c=r.x>s.x?r.x>o.x?r.x:o.x:s.x>o.x?s.x:o.x,u=r.y>s.y?r.y>o.y?r.y:o.y:s.y>o.y?s.y:o.y,h=w(a,l,e,i,n),d=w(c,u,e,i,n);let f=t.prevZ,p=t.nextZ;for(;f&&f.z>=h&&p&&p.z<=d;){if(f!==t.prev&&f!==t.next&&b(r.x,r.y,s.x,s.y,o.x,o.y,f.x,f.y)&&v(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,p!==t.prev&&p!==t.next&&b(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&v(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;f&&f.z>=h;){if(f!==t.prev&&f!==t.next&&b(r.x,r.y,s.x,s.y,o.x,o.y,f.x,f.y)&&v(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;p&&p.z<=d;){if(p!==t.prev&&p!==t.next&&b(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&v(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function f(t,e,i,n){const r=E.create(t,e,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function p(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function _(t){let e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function m(t,e,i,n,r,s){const o=new Array;for(let r=0,a=n.length;r<a;r++){const c=l(t,e,0,n[r]*s,r<a-1?n[r+1]*s:i*s,s,!1);c===c.next&&(c.steiner=!0),o.push(_(c))}o.sort(M);for(const t of o)r=g(t,r);return r}function g(t,e){const i=function(t,e){let i=e;const n=t.x,r=t.y;let s,o=-1/0;do{if(r<=i.y&&r>=i.next.y&&i.next.y!==i.y){const t=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(t<=n&&t>o){if(o=t,t===n){if(r===i.y)return i;if(r===i.next.y)return i.next}s=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!s)return null;if(n===o)return s.prev;const a=s,l=s.x,c=s.y;let u,h=1/0;for(i=s.next;i!==a;)n>=i.x&&i.x>=l&&n!==i.x&&b(r<c?n:o,r,l,c,r<c?o:n,r,i.x,i.y)&&(u=Math.abs(r-i.y)/(n-i.x),(u<h||u===h&&i.x>s.x)&&S(i,t)&&(s=i,h=u)),i=i.next;return s}(t,e);if(!i)return e;const n=I(i,t);return c(n,n.next),c(i,i.next)}function y(t,e,i,n){let r;for(;r!==t;r=r.next){if(r=r||t,null===r.z&&(r.z=w(r.x,r.y,e,i,n)),r.prev.next!==r||r.next.prev!==r)return r.prev.next=r,r.next.prev=r,y(t,e,i,n);r.prevZ=r.prev,r.nextZ=r.next}return t.prevZ.nextZ=null,t.prevZ=null,function(t){let e,i=1;for(;;){let n,r=t;t=null,e=null;let s=0;for(;r;){s++,n=r;let o=0;for(;o<i&&n;o++)n=n.nextZ;let a=i;for(;o>0||a>0&&n;){let i;0===o?(i=n,n=n.nextZ,a--):0!==a&&n?r.z<=n.z?(i=r,r=r.nextZ,o--):(i=n,n=n.nextZ,a--):(i=r,r=r.nextZ,o--),e?e.nextZ=i:t=i,i.prevZ=e,e=i}r=n}if(e.nextZ=null,i*=2,s<2)return t}}(t)}function v(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function x(t,e,i,n){return!!(T(t,e)&&T(i,n)||T(t,n)&&T(i,e))||v(t,e,i)>0!=v(t,e,n)>0&&v(i,n,t)>0!=v(i,n,e)>0}function b(t,e,i,n,r,s,o,a){return(r-o)*(e-a)-(t-o)*(s-a)>=0&&(t-o)*(n-a)-(i-o)*(e-a)>=0&&(i-o)*(s-a)-(r-o)*(n-a)>=0}function S(t,e){return v(t.prev,t,t.next)<0?v(t,e,t.next)>=0&&v(t,t.prev,e)>=0:v(t,e,t.prev)<0||v(t,t.next,e)<0}function w(t,e,i,n,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function T(t,e){return t.x===e.x&&t.y===e.y}function M(t,e){return t.x-e.x}function P(t,e,i,n){let r=t;do{const s=r.prev,o=r.next.next;!T(s,o)&&x(s,r,r.next,o)&&S(s,o)&&S(o,s)&&(e.push(s.index/i+n),e.push(r.index/i+n),e.push(o.index/i+n),p(r),p(r.next),r=t=o),r=r.next}while(r!==t);return r}function A(t,e,i,n,r,s,o){let a=t;do{let t=a.next.next;for(;t!==a.prev;){if(a.index!==t.index&&C(a,t)){let l=I(a,t);return a=c(a,a.next),l=c(l,l.next),u(a,e,i,n,r,s,o,0),void u(l,e,i,n,r,s,o,0)}t=t.next}a=a.next}while(a!==t)}function C(t,e){return t.next.index!==e.index&&t.prev.index!==e.index&&!function(t,e){let i=t;do{if(i.index!==t.index&&i.next.index!==t.index&&i.index!==e.index&&i.next.index!==e.index&&x(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&S(t,e)&&S(e,t)&&function(t,e){let i=t,n=!1;const r=(t.x+e.x)/2,s=(t.y+e.y)/2;do{i.y>s!=i.next.y>s&&i.next.y!==i.y&&r<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==t);return n}(t,e)}function I(t,e){const i=E.create(t.index,t.x,t.y),n=E.create(e.index,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,n.next=i,i.prev=n,s.next=n,n.prev=s,n}i(58941);class E{constructor(){this.index=0,this.x=0,this.y=0,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}static create(t,e,i){const n=O<R.length?R[O++]:new E;return n.index=t,n.x=e,n.y=i,n.prev=null,n.next=null,n.z=null,n.prevZ=null,n.nextZ=null,n.steiner=!1,n}}const R=[];let O=0;for(let t=0;t<8096;t++)R.push(new E);const F=1e-5,z=new r.O3(0,0,0,1,0),D=new r.O3(0,0,0,1,0);function L(t,e,i){let n=0;for(let r=1;r<i;r++){const i=t[2*(e+r-1)],s=t[2*(e+r-1)+1];n+=(t[2*(e+r)]-i)*(t[2*(e+r)+1]+s)}return n}function k(t,e,i,n,r){let s=0;for(let o=i;o<n;o+=3){const i=2*(t[o]-r),n=2*(t[o+1]-r),a=2*(t[o+2]-r);s+=Math.abs((e[i]-e[a])*(e[n+1]-e[i+1])-(e[i]-e[n])*(e[a+1]-e[i+1]))}return s}function N(t,e){const{coords:i,lengths:n}=e,r=t;let s=0;for(let t=0;t<n.length;){let e=t,o=n[t],l=L(i,s,o);const c=[];for(;++e<n.length;){const t=n[e],r=L(i,s+o,t);if(!(r>0))break;l+=r,c.push(s+o),o+=t}const u=r.length;a(r,i,s,s+o,c,2,0);const h=k(r,i,u,r.length,0),d=Math.abs(l);if(Math.abs((h-d)/Math.max(1e-7,d))>F)return r.length=0,!1;t=e,s+=o}return!0}function B(t){const{coords:e,lengths:i}=t,{buffer:r}=(0,n.l)(e,i);return r}function V(t,e){if(null==t)return null;if(!function(t,e,i){let n=0;for(let e=0;e<t.lengths.length;e++){const r=t.lengths[e];for(let e=0;e<r;e++){const r=t.coords[2*(e+n)],s=t.coords[2*(e+n)+1];if(r<-128||r>i||s<-128||s>i)return!0}n+=r}return!1}(t,0,o.CQ+128))return t;z.setPixelMargin(e),z.reset(r.dC.Polygon);let i=0;for(let e=0;e<t.lengths.length;e++){const n=t.lengths[e];let r=t.coords[2*(0+i)],s=t.coords[2*(0+i)+1];z.moveTo(r,s);for(let e=1;e<n;e++)r=t.coords[2*(e+i)],s=t.coords[2*(e+i)+1],z.lineTo(r,s);z.close(),i+=n}const n=z.result(!1);if(!n)return null;const a=[],l=[];for(const t of n){let e=0;for(const i of t)l.push(i.x),l.push(i.y),e++;a.push(e)}return new s.A(a,l)}function U(t,e){D.setPixelMargin(e);const i=D,n=-e,s=o.CQ+e;let a=[],l=!1;if(!t.nextPath())return null;let c=!0;for(;c;){t.seekPathStart();const e=[];if(!t.pathSize)return null;i.reset(r.dC.LineString),t.nextPoint();let o=t.x,u=t.y;if(l)i.moveTo(o,u);else{if(o<n||o>s||u<n||u>s){l=!0;continue}e.push({x:o,y:u})}let h=!1;for(;t.nextPoint();)if(o=t.x,u=t.y,l)i.lineTo(o,u);else{if(o<n||o>s||u<n||u>s){h=!0;break}e.push({x:o,y:u})}if(h)l=!0;else{if(l){const t=i.resultWithStarts();if(t)for(const e of t)a.push(e)}else a.push({line:e,start:0});c=t.nextPath(),l=!1}}return a=a.filter((t=>t.line.length>1)),0===a.length?null:a}z.setExtent(o.CQ),D.setExtent(o.CQ)},10899:function(t,e,i){i.d(e,{e:function(){return l}});var n=i(84354),r=i(86305),s=i(85456),o=i(81438),a=i(3817);class l{constructor(t,e){this._boundPart=null,this.vertexBuffers=new Map;for(const[i,n]of Object.entries(e.vertex)){const e=r.g.createVertex(t,s._U.STATIC_DRAW,n);this.vertexBuffers.set(i,e)}const i=new Map;for(const[n,o]of Object.entries(e.index??{})){const e=r.g.createIndex(t,s._U.STATIC_DRAW,o);i.set(n,e)}this.groups=[];for(const n of e.groups){let r;if(null!=n.index){if(!e.index?.[n.index])throw new Error("No index data.");const{BYTES_PER_ELEMENT:t}=e.index[n.index];2===t?r=s.pe.UNSIGNED_SHORT:4===t&&(r=s.pe.UNSIGNED_INT)}const l=null!=n.index?i.get(n.index):null,c=new Map,u=new Map;for(const t of n.attributes){const{name:e,count:i,type:n,offset:r,normalized:s,divisor:o,stride:l,vertex:h,location:d}=t;let f=u.get(h);f||(f=[],u.set(h,f));const p=new a._(e,i,n,r,l,s,o);f.push(p),c.set(e,d)}const h=new o.Z(t,c,u,this.vertexBuffers,l);this.groups.push({...n,vertexArray:h,locations:c,layout:u,indexing:r})}this.parts=e.parts}bind(t,e){this._boundPart=e;const{group:i}=this.parts[this._boundPart],{vertexArray:n}=this.groups[i];t.bindVAO(n)}draw(t){if(null==this._boundPart)throw new Error("Mesh.bind() has not been called.");const{start:e,count:i}=this.parts[this._boundPart],{group:r}=this.parts[this._boundPart],{indexing:s,primitive:o}=this.groups[r];s?t.drawElements(o,i,s,e*n.I[s]):t.drawArrays(o,e,i)}unbind(t){this._boundPart=null,t.bindVAO(null)}destroy(){for(const{vertexArray:t}of this.groups)t.dispose()}}},61117:function(t,e,i){i.d(e,{g:function(){return a}});var n=i(84354),r=i(10899),s=i(85456);const o={position:{type:s.pe.SHORT,count:2}};class a extends r.e{static create(t,e,i){const r=[];let{stride:s}=e;if(null==s){s=0;for(const[t,{count:i,type:r,offset:o}]of Object.entries(e.layout)){if(null!=o)throw new Error("Stride cannot be computed automatically when attribute offsets are supplied explicitly.");s+=i*n.I[r]}}let o=0;for(const[t,{count:a,offset:l,type:c,normalized:u}]of Object.entries(e.layout)){null!=l&&(o=l);const e=i.get(t);if(null==e)throw new Error("Locations must be specified at mesh initialization.");const h={name:t,location:e,vertex:"vertexData",count:a,type:c,offset:o,stride:s,divisor:0,normalized:null!=u&&u};r.push(h),o+=a*n.I[c]}const l={attributes:r,primitive:e.primitive};null!=e.index&&(l.index="indexData");let{count:c}=e;if(null==c&&(c=e.index?e.index.length:e.vertex.byteLength/s,Math.floor(c)!==c))throw new Error(`The byte length of vertex data must be an exact multiple of the stride, which is ${s}.`);const u={start:0,count:c,group:0,primitive:e.primitive},h={vertex:{vertexData:e.vertex},parts:[u],groups:[l]};return null!=e.index&&(h.index={indexData:e.index}),new a(t,h,e.layout)}static fromVertexStream(t,e){return a.create(t,{primitive:s.WR.TRIANGLE_STRIP,vertex:new Uint16Array(e),layout:o},new Map([["position",0]]))}constructor(t,e,i){super(t,e),this._spec=i}bind(t,e=0){super.bind(t,e)}}},84354:function(t,e,i){i.d(e,{I:function(){return r}});var n=i(85456);const r={[n.pe.BYTE]:1,[n.pe.UNSIGNED_BYTE]:1,[n.pe.SHORT]:2,[n.pe.UNSIGNED_SHORT]:2,[n.pe.HALF_FLOAT]:2,[n.pe.INT]:4,[n.pe.UNSIGNED_INT]:4,[n.pe.FLOAT]:4}},85475:function(t,e,i){i.d(e,{Kl:function(){return l},M9:function(){return o},fw:function(){return a}});const n=new Float32Array(1),r=new Uint32Array(n.buffer);function s(t){return n[0]=t,r[0]}function o(t,e){return 65535&t|e<<16}function a(t){const e=s(t),i=e>>>31;let n=e>>>23&255,r=8388607&e;return n-=127,n>15?i<<15|31744:n<-25?0:(n<-14&&(r+=8388608,r/=2**(-14-n),n=-15),n+=15,r/=8192,r=function(t){const e=Math.floor(t),i=t-e;return e<1023&&(i>.5||.5===i&&e%2==1)?e+1:e}(r),i<<15|n<<10|r)}function l(t){let e=t>>>15,i=t>>10&31,n=1023&t;return e=e?-1:1,i-=15,n/=1024,i>-15?n+=1:i=-14,e*2**i*n}},98282:function(t,e,i){i.d(e,{Y7:function(){return L},HS:function(){return k},mm:function(){return N},A:function(){return V},k2:function(){return B},ZA:function(){return D},E8:function(){return F},hF:function(){return E},C5:function(){return I},uK:function(){return O},Pi:function(){return R}});var n=i(53804),r=(i(58941),i(40633)),s=i(50944),o=i(39819),a=i(54516),l=i(90553);class c{constructor(){this._includedModules=new Map}include(t,e){this._includedModules.has(t)?this._includedModules.get(t):(this._includedModules.set(t,e),t(this.builder,e))}}class u extends c{constructor(){super(...arguments),this.vertex=new f,this.fragment=new f,this.attributes=new p,this.varyings=new _,this.extensions=new m,this.constants=new g}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(t,e=!0){const i=this.extensions.generateSource(t),n=this.attributes.generateSource(t),r=this.varyings.generateSource(t),s="vertex"===t?this.vertex:this.fragment,o=s.uniforms.generateSource(),a=s.code.generateSource(),l="vertex"===t?y:"#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif\n",c=this.constants.generateSource().concat(s.constants.generateSource());return`${e?"#version 300 es":""}\n${i.join("\n")}\n${l}\n${c.join("\n")}\n${o.join("\n")}\n${n.join("\n")}\n${r.join("\n")}\n${a.join("\n")}`}generateBindPass(t){const e=new Map;this.vertex.uniforms.entries.forEach((t=>{const i=t.bind[a.c.Pass];i&&e.set(t.name,i)})),this.fragment.uniforms.entries.forEach((t=>{const i=t.bind[a.c.Pass];i&&e.set(t.name,i)}));const i=Array.from(e.values()),n=i.length;return(e,r)=>{for(let s=0;s<n;++s)i[s](t,e,r)}}generateBindDraw(t){const e=new Map;this.vertex.uniforms.entries.forEach((t=>{const i=t.bind[a.c.Draw];i&&e.set(t.name,i)})),this.fragment.uniforms.entries.forEach((t=>{const i=t.bind[a.c.Draw];i&&e.set(t.name,i)}));const i=Array.from(e.values()),n=i.length;return(e,r,s)=>{for(let o=0;o<n;++o)i[o](t,s,e,r)}}}class h{constructor(){this._entries=new Map}add(...t){for(const e of t)this._add(e)}get(t){return this._entries.get(t)}_add(t){if(null!=t){if(this._entries.has(t.name)&&!this._entries.get(t.name).equals(t))throw new o.A(`Duplicate uniform name ${t.name} for different uniform type`);this._entries.set(t.name,t)}else r.A.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder").error(`Trying to add null Uniform from ${(new Error).stack}.`)}generateSource(){return Array.from(this._entries.values()).map((t=>null!=t.arraySize?`uniform ${t.type} ${t.name}[${t.arraySize}];`:`uniform ${t.type} ${t.name};`))}get entries(){return Array.from(this._entries.values())}}class d{constructor(){this._entries=new Array}add(t){this._entries.push(t)}generateSource(){return this._entries}}class f extends c{constructor(){super(...arguments),this.uniforms=new h,this.code=new d,this.constants=new g}get builder(){return this}}class p{constructor(){this._entries=new Array}add(t,e){this._entries.push([t,e])}generateSource(t){return"fragment"===t?[]:this._entries.map((t=>`in ${t[1]} ${t[0]};`))}}class _{constructor(){this._entries=new Map}add(t,e){this._entries.has(t)&&(0,l.vA)(this._entries.get(t)===e),this._entries.set(t,e)}generateSource(t){const e=new Array;return this._entries.forEach(((i,n)=>e.push("vertex"===t?`out ${i} ${n};`:`in ${i} ${n};`))),e}}class m{constructor(){this._entries=new Set}add(t){this._entries.add(t)}generateSource(t){const e="vertex"===t?m.ALLOWLIST_VERTEX:m.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter((t=>e.includes(t))).map((t=>`#extension ${t} : enable`))}}m.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],m.ALLOWLIST_VERTEX=[];class g{constructor(){this._entries=new Set}add(t,e,i){let n="ERROR_CONSTRUCTOR_STRING";switch(e){case"float":n=g._numberToFloatStr(i);break;case"int":n=g._numberToIntStr(i);break;case"bool":n=i.toString();break;case"vec2":n=`vec2(${g._numberToFloatStr(i[0])},                            ${g._numberToFloatStr(i[1])})`;break;case"vec3":n=`vec3(${g._numberToFloatStr(i[0])},                            ${g._numberToFloatStr(i[1])},                            ${g._numberToFloatStr(i[2])})`;break;case"vec4":n=`vec4(${g._numberToFloatStr(i[0])},                            ${g._numberToFloatStr(i[1])},                            ${g._numberToFloatStr(i[2])},                            ${g._numberToFloatStr(i[3])})`;break;case"ivec2":n=`ivec2(${g._numberToIntStr(i[0])},                             ${g._numberToIntStr(i[1])})`;break;case"ivec3":n=`ivec3(${g._numberToIntStr(i[0])},                             ${g._numberToIntStr(i[1])},                             ${g._numberToIntStr(i[2])})`;break;case"ivec4":n=`ivec4(${g._numberToIntStr(i[0])},                             ${g._numberToIntStr(i[1])},                             ${g._numberToIntStr(i[2])},                             ${g._numberToIntStr(i[3])})`;break;case"mat2":case"mat3":case"mat4":n=`${e}(${Array.prototype.map.call(i,(t=>g._numberToFloatStr(t))).join(", ")})`}return this._entries.add(`const ${e} ${t} = ${n};`),this}static _numberToIntStr(t){return t.toFixed(0)}static _numberToFloatStr(t){return Number.isInteger(t)?t.toFixed(1):t.toString()}generateSource(){return Array.from(this._entries)}}const y="precision highp float;\nprecision highp sampler2D;";var v=i(70931);function x(t,e,i){const n=e.split("\n");for(const e of n)if(e.trim().length){{let e="";null!=i&&(e+=`/*id:${i??"000"}*/   `),t.body+=e.padEnd(14)}t.body+=" ".repeat(t.indent)+e+"\n"}}class b{write(t){for(const e of t.rootOutputNodes())t.shouldPruneOutputNode(e)||(e.variableName=this._write(t,e.node));return t}_createVarName(t,e){let i="";return"boolean"!=typeof e&&"number"!=typeof e&&e.debugInfo.name&&(i=`${e.debugInfo.name}_`),`${i}v${t.varCount++}`}_write(t,e,i=!1){if("number"==typeof e)return e.toString();if("boolean"==typeof e)return e.toString();let n=t.getEmit(e);if(n)return n;switch(e.shaderType){case"scope-node":n=this._writeScopeNode(t,e);break;case"primitive-node":n=this._writePrimitiveNode(t,e,i);break;case"function-node":n=this._writeFunctionNode(t,e);break;case"property-access-node":n=this._writePropertyAccessNode(t,e);break;case"text-node":n=e.text;break;case"block-node":n=this._writeBlockNode(t,e);break;case"condition-node":n=this._writeConditionNode(t,e)}return t.setEmit(e,n),n}_writeScopeNode(t,e){const i=new e.child.constructor;i.setDebugName(e.debugInfo.name);const n=this._write(t,i,!0);return x(t,`{ /*ScopeStart: ${e.uid} ${e.debugInfo.name}*/`),t.indent+=2,x(t,`${n} = ${this._write(t,e.child)};`),t.indent-=2,x(t,`} /*ScopeEnd: ${e.uid} ${e.debugInfo.name}*/`),n}_writeConditionNode(t,e){const i=new e.ifTrue.constructor,n=this._write(t,i,!0);x(t,`if (${this._write(t,e.condition)}) {`),t.indent+=2;const r=t.createSubgraphContext(),s=this._write(r,e.ifTrue);if(t.body+=r.body,s&&x(t,`${n} = ${s};`),t.indent-=2,x(t,"}"),e.ifFalse){x(t,"else {"),t.indent+=2;const i=t.createSubgraphContext(),r=this._write(i,e.ifFalse);t.body+=i.body,r&&x(t,`${n} = ${r};`),t.indent-=2,x(t,"}")}return n}_writeBlockNode(t,e){const{captureList:i,generator:n,returnType:r}=e,s={};for(const e in i){if(!i[e])continue;const n=this._write(t,i[e]);s[e]=n}const o=new r,a=this._write(t,o,!0);if(s.out=a,e.subgraph){const i=t.createSubgraphContext(),n=this._write(i,e.subgraph.child),r=i.body;s.subgraph={varName:n,body:r}}const l=n(s);return x(t,"{\n"),t.indent+=2,x(t,l),t.indent-=2,x(t,"}\n"),a}_writePropertyAccessNode(t,e){const i=this._write(t,e.target);return"string"==typeof e.property&&e.property.includes("[")?`${i}${e.property}`:"string"!=typeof e.property?`${i}[${this._write(t,e.property)}]`:`${i}.${e.property}`}_writeFunctionNode(t,e){const i=e.returnType.type;if(e.isInfix){const[n,r]=e.children.map((e=>this._write(t,e))),s=this._createVarName(t,e);return x(t,`${i.padEnd(5)} ${s} = ${n} ${e.token} ${r};`,e.uid),s}const n=e.children.map((e=>this._write(t,e))).join(", "),r=this._createVarName(t,e);return x(t,`${i.padEnd(5)} ${r} = ${e.token}(${n});`,e.uid),r}_writePrimitiveNode(t,e,i=!1){const n=t.getInput(e);if(n)return n.isUsed=!0,n.variableName;const r=1===e.children.length&&e.children[0]?.type===e.type;if(e.isImplicit||r)return this._write(t,e.children[0]);const s=this._createVarName(t,e);if(i)return x(t,`${e.type.padEnd(5)} ${s};`,e.uid),s;const o=!e.debugInfo.name&&!e.isMutable;if(o&&"float"===e.type&&"number"==typeof e.children[0])return Number.isInteger(e.children[0])?e.children[0].toFixed(1):e.children[0].toString();if(o&&"int"===e.type&&"number"==typeof e.children[0]&&Number.isInteger(e.children[0]))return e.children[0].toString();const a=e.children.map((e=>this._write(t,e))).join(", ");return"array"===e.type?(x(t,`${e.type.padEnd(5)} ${s} = [${a}];`,e.uid),s):o?`${e.type}(${a})`:(x(t,`${e.type.padEnd(5)} ${s} = ${e.type}(${a});`,e.uid),s)}}var S=i(44784);class w{constructor(t,e,i){this.variableName=t,this.variableInputType=e,this.node=i,this.type="shader-input",this.isUsed=!1}clone(){return new w(this.variableName,this.variableInputType,(0,S.vA)(this.node))}}class T{constructor(t,e,i){this.outVariableName=t,this.outVariableType=e,this.node=i,this.type="shader-output"}clone(){const t=new T(this.outVariableName,this.outVariableType,(0,S.vA)(this.node));return t.variableName=this.variableName,t}}class M{static createVertex(t,e,i,n,r,s){const o=[];for(const e in t){const n=t[e],r=i.get(e);r?o.push(new w(r,"builtin",n)):o.push(new w("a_"+e,"in",n))}for(const t of n){const e=t.uniformHydrated;o.push(new w(t.uniformName,"uniform",e))}const a=[];for(const t in e){const i=e[t];"glPosition"===t?a.push(new T("gl_Position","builtin",i)):"glPointSize"===t?a.push(new T("gl_PointSize","builtin",i)):a.push(new T("v_"+t,"out",i))}return new M(o,a,r,s)}static createFragment(t,e,i,n,r,s){const o=[],a=Array.from(r.rootOutputNodes());for(const e in t){const n=t[e],r=i.get(e);if(r){o.push(new w(r,"builtin",n));continue}const s=a.find((t=>t.node===n));s&&o.push(new w(s.outVariableName,"in",n))}for(const t of n){const e=t.uniformHydrated;o.push(new w(t.uniformName,"uniform",e))}const l=[];for(const t in e){const n=e[t],r=i.get(t);"discard"===t?l.push(new T(null,"discard",n)):r?l.push(new T(r,"builtin",n)):l.push(new T(t,"out",n))}return new M(o,l,s)}constructor(t,e,i,n){this.type="shader-graph-context",this.indent=0,this.body="",this.varCount=0,this._inputShaderTypesByNodeUid=new Map,this._nodeEmitMap=new Map;for(const e of t)this._inputShaderTypesByNodeUid.set(e.node.uid,e);this._outputShaderTypes=e,this._transformFeedbackBindings=i,this._transformFeedbackNames=new Set(i.map((t=>"v_"+t.propertyKey))),this._usedInFragmentShader=n}shouldPruneOutputNode(t){return!!this._usedInFragmentShader&&"builtin"!==t.outVariableType&&!this._transformFeedbackNames.has(t.outVariableName)&&!this._usedInFragmentShader.has(t.node.uid)}setEmit(t,e){this._nodeEmitMap.set(t.uid,e)}getEmit(t){return this._nodeEmitMap.get(t.uid)}inputs(){return this._inputShaderTypesByNodeUid.values()}getInput(t){return this._inputShaderTypesByNodeUid.get(t.uid)}*rootOutputNodes(){for(const t of this._outputShaderTypes)yield t}*nodes(){const t=[];for(const e of this._outputShaderTypes.values())t.push(e.node);for(;t.length;){const e=t.pop();"number"!=typeof e&&"boolean"!=typeof e&&t.push(...e.children.filter(Boolean)),yield e}}*nodesOfTypeOrFunction(){for(const t of this.nodes())"number"!=typeof t&&"boolean"!=typeof t&&(yield t)}createSubgraphContext(){const t=this.clone();return t.body="",t.indent=this.indent+2,t._nodeEmitMap=new Map(this._nodeEmitMap),t}clone(){const t=new M([],this._outputShaderTypes,this._transformFeedbackBindings,this._usedInFragmentShader);return t._inputShaderTypesByNodeUid=this._inputShaderTypesByNodeUid,t.indent=this.indent,t.body=this.body,t.varCount=this.varCount,t._nodeEmitMap=this._nodeEmitMap,t}insertVertexShader(t){t.vertex.code.add(""),this._insertInputs(t,"vertex"),t.vertex.code.add(""),t.vertex.code.add("// OUTPUTS: "),t.vertex.code.add("// --------------------------------------------------------- ");for(const e of this.rootOutputNodes()){const i="builtin"===e.outVariableType;this.shouldPruneOutputNode(e)||(i?t.vertex.code.add(`// ${e.outVariableType.padEnd(7)} ${e.node.type.padEnd(9)} ${e.outVariableName};`):t.vertex.code.add(`${e.outVariableType.padEnd(10)} ${e.node.type.padEnd(9)} ${e.outVariableName};`))}t.vertex.code.add(""),t.vertex.code.add("void main() {"),t.vertex.code.add("  "+this.body.split("\n").join("\n  "));for(const e of this.rootOutputNodes())this.shouldPruneOutputNode(e)||t.vertex.code.add(`  ${e.outVariableName} = ${e.variableName};`);t.vertex.code.add("}")}insertFragmentShader(t){this._insertInputs(t,"fragment"),t.fragment.code.add(""),t.fragment.code.add("// OUTPUTS: "),t.fragment.code.add("// --------------------------------------------------------- ");for(const e of this.rootOutputNodes())"builtin"===e.outVariableType?t.fragment.code.add(`// ${e.outVariableType.padEnd(7)} ${e.node.type.padEnd(9)} ${e.outVariableName};`):t.fragment.code.add(`${e.outVariableType.padEnd(10)} ${e.node.type.padEnd(9)} ${e.outVariableName};`);t.fragment.code.add(""),t.fragment.code.add("void main() {"),t.fragment.code.add("  "+this.body.split("\n").join("\n  "));for(const e of this.rootOutputNodes())"discard"===e.outVariableType?(t.fragment.code.add("  // TODO: Should ensure codegen for discard appears first in fragment shader"),t.fragment.code.add(`  if (${e.variableName}) {`),t.fragment.code.add("    discard;"),t.fragment.code.add("  }"),t.fragment.code.add("  ")):t.fragment.code.add(`  ${e.outVariableName} = ${e.variableName};`);t.fragment.code.add("}")}_insertInputs(t,e){t[e].code.add("// INPUTS: "),t[e].code.add("// --------------------------------------------------------- ");for(const i of this.inputs())i.isUsed&&"builtin"!==i.variableInputType&&("array"===i.node.type?t[e].code.add(`${i.variableInputType.padEnd(10)} ${i.node.elementType.type.padEnd(9)} ${i.variableName}[${i.node.size}];`):t[e].code.add(`${i.variableInputType.padEnd(10)} ${i.node.type.padEnd(9)} ${i.variableName};`))}}var P=i(22516);function A(t){return new t}function C(t,e,i){const n=t.constructor[e]??[];t.constructor.hasOwnProperty(e)||Object.defineProperty(t.constructor,e,{value:n.slice()}),t.constructor[e].push(i)}function I(t,e){return(i,n)=>{C(i,"locations",{typeCtor:e,propertyKey:n,parameterIndex:null,index:t})}}const E=t=>(e,i,n)=>{C(e,"inputs",{inputCtor:t,propertyKey:i,parameterIndex:n})},R=t=>(e,i)=>{C(e,"uniforms",{typeCtor:t,propertyKey:i})},O=t=>(e,i)=>{C(e,"options",{typeCtor:t,propertyKey:i})},F=(t,e)=>{C(t,"defines",{propertyKey:e})},z=(t,e)=>(i,n)=>{i.constructor.builtins.push({builtin:t,propertyKey:n,typeCtor:e})};class D{}D.builtins=[],(0,n._)([z("gl_VertexID",v.Ai)],D.prototype,"glVertexID",void 0);class L{}class k{}k.builtins=[],(0,n._)([z("gl_FragCoord",v.Zb)],k.prototype,"glFragCoord",void 0),(0,n._)([z("gl_PointCoord",v.ZY)],k.prototype,"glPointCoord",void 0);class N{}class B{constructor(){this.type="uniform-group"}get _uniforms(){return this.constructor.uniforms??[]}}class V{constructor(){this.logShader=!1,this.computeAttributes={}}get vertexInput(){const t=this._shaderModuleClass.inputs.findLast((t=>"vertex"===t.propertyKey&&0===t.parameterIndex));if(!t)throw new Error("Unable to find vertex input parameter");return t}get computeInput(){return this._shaderModuleClass.inputs.findLast((t=>"vertex"===t.propertyKey&&1===t.parameterIndex))}get fragmentInput(){const t=this._shaderModuleClass.inputs.findLast((t=>"fragment"===t.propertyKey));if(!t)throw new Error("Unable to find fragment input parameter");return t}get transformFeedbackBindings(){return this.fragmentInput.inputCtor.transformFeedbackBindings??[]}get locations(){return[...this.vertexInput.inputCtor.locations,...this.computeInput?.inputCtor.locations??[]]}get locationsMap(){const t=new Map,e=new Set;for(const i of this.locations)e.has(i.index)?r.A.getLogger("esri.views.2d.engine.webgl.shaderGraph.GraphShaderModule").warnOnce("mapview-rendering",`Unable to assigned attribute ${i.propertyKey} to ${i.index}. Index already in use`,{locationsMap:t}):(t.set(i.propertyKey,i.index),e.add(i.index));return t}get locationInfo(){if(!this._locationInfo){const t=this.locationsMap,e=Array.from(t.entries()).map((([t,e])=>`${t}.${e}`)).join("."),i=(0,s.Wm)(e),n=this.computeAttributes;this._locationInfo={hash:i,locations:t,computeAttributeMap:n}}return this._locationInfo}get renamedLocationsMap(){const t=new Map;for(const e of this.locations)t.set("a_"+e.propertyKey,e.index);return t}get optionPropertyKeys(){if(!this._optionPropertyKeys){const t=new Set;for(const e of this._options)t.add(e.propertyKey);this._optionPropertyKeys=t}return this._optionPropertyKeys}get _shaderModuleClass(){return this.constructor}get _defines(){return this._shaderModuleClass.defines??[]}get _options(){return this._shaderModuleClass.options??[]}get _uniforms(){return this._shaderModuleClass.uniforms??[]}getProgram(t,e,i,n){try{const{vertex:r,fragment:s,uniformBindings:o}=this._generateShaders(t,e,i,n);return new P.K(r,s,this.renamedLocationsMap,this.locationInfo,o,this.transformFeedbackBindings)}catch(t){return new P.K("","",this.renamedLocationsMap,this.locationInfo,[],this.transformFeedbackBindings)}}getDebugUniformClassInfo(t){const e=this._options.find((e=>e.propertyKey===t));if(e)return{type:"option",className:e.typeCtor};const i=this._uniforms.find((e=>e.propertyKey===t));if(!i)throw new Error(`Unable to find uniform class type for property: ${t}`);return{type:"required",className:i.typeCtor}}getShaderKey(t,e,i,n){const r=Object.keys(t).map((e=>`${e}.${t[e]}`)).join("."),s=Object.keys(i).map((t=>`${t}.${i[t]}`)).join("."),o=Object.keys(n).map((t=>`${t}.${n[t]}`)).join("."),a=Object.keys(e).filter((t=>this.optionPropertyKeys.has(t)&&e[t])).join(".");return`${this.constructor.name}.${r}.${s}.${o}.${a}`}_generateShaders(t,e,i,n){const r=[];this._setDefines(i),this._setOptionalUniforms(r,e),this._setRequiredUniforms(r);const s=this._hydrateVertexInput(n),o=this._injectPackPrecisionFactor(s,t),a=this._hydrateComputeInput(),l=a&&this._injectComputePackPrecisionFactor(a,t),c=this.vertex(o,l),u=this._hydrateFragmentInput(c),h=this.fragment(u),d=new Set;for(const t in h){const e=h[t];(0,S.rz)(d,e)}const f=this._getVertexInputBuiltins(),p=M.createVertex({...s,...a},c,f,r,this.transformFeedbackBindings,d);(new b).write(p);const _=this._getFragmentInputBuiltins(h);_.set("glPointCoord","gl_PointCoord");const m=M.createFragment(u,h,_,r,p,this.transformFeedbackBindings);(new b).write(m);const g=this._createShaderBuilder(p,m),y=g.generate("vertex",!0),v=g.generate("fragment",!0);return this.logShader&&(console.log(y),console.log(v)),{vertex:y,fragment:v,uniformBindings:r}}_setDefines(t){for(const e in t)this[e]=t[e]}_setOptionalUniforms(t,e){for(const i of this._options)e[i.propertyKey]?this[i.propertyKey]=this._hydrateUniformGroup(t,i):this[i.propertyKey]=null}_setRequiredUniforms(t){for(const e of this._uniforms)this[e.propertyKey]=this._hydrateUniformGroup(t,e)}_hydrateUniformGroup(t,e){const i=new(0,e.typeCtor);for(const n of i._uniforms??[]){const r=A(n.typeCtor),s=`u_${e.propertyKey}_${n.propertyKey}`,o=r.type,a=[e.propertyKey,n.propertyKey].join(".");if("type"in n.typeCtor&&"array"===n.typeCtor.type){const e=r;t.push({shaderModulePath:a,uniformName:s,uniformType:o,uniformArrayLength:e.size,uniformArrayElementType:e.elementType.type,uniformHydrated:r})}else t.push({shaderModulePath:a,uniformName:s,uniformType:o,uniformHydrated:r});i[n.propertyKey]=r}return i}_hydrateVertexInput(t){const e=this.vertexInput.inputCtor,i=e.locations.reduce(((e,i)=>!1===t[i.propertyKey]?e:{...e,[i.propertyKey]:A(i.typeCtor)}),{});for(const{propertyKey:t,typeCtor:n}of e.builtins){const e=A(n);i[t]=e}return i}_hydrateComputeInput(){return null==this.computeInput?null:this.computeInput.inputCtor.locations.reduce(((t,e)=>({...t,[e.propertyKey]:A(e.typeCtor)})),{})}_injectPackPrecisionFactor(t,e){const i={};for(const n in t){const r=t[n],s=e[n];if(s){if("float"!==r.type&&"vec2"!==r.type&&"vec3"!==r.type&&"vec4"!==r.type)throw new Error(`InternalError: packPrecisionFactor requires GenType, but found ${r.type}`);i[n]=r.divide(new v.nt(s))}else i[n]=r}return i}_injectComputePackPrecisionFactor(t,e){const i={},n=new Map;for(const t in this.computeAttributes)for(const e of this.computeAttributes[t]??[])n.set(e,t);for(const r in t){const s=t[r],o=n.get(r);if(!o)continue;const a=e[o];if(a){if("float"!==s.type&&"vec2"!==s.type&&"vec3"!==s.type&&"vec4"!==s.type)throw new Error(`InternalError: packPrecisionFactor requires GenType, but found ${s.type}`);i[r]=s.divide(new v.nt(a))}else i[r]=s}return i}_hydrateFragmentInput(t){const e={};for(const i in t)e[i]=t[i];for(const{propertyKey:t,typeCtor:i}of k.builtins){const n=A(i);e[t]=n}return e}_getVertexInputBuiltins(){const t=this.vertexInput.inputCtor,e=new Map;for(const{builtin:i,propertyKey:n}of t.builtins)e.set(n,i);return e}_getFragmentInputBuiltins(t){const e=t.constructor,i=new Map;for(const t of e.builtins??[])i.set(t.propertyKey,t.builtin);return i}_createShaderBuilder(t,e){const i=new u;return this._insertDebugInfo(i),t.insertVertexShader(i),e.insertFragmentShader(i),i}_insertDebugInfo(t){t.vertex.code.add("// DEFINES: "),t.vertex.code.add("// --------------------------------------------------------- ");for(const e of this._defines)this[e.propertyKey]?t.vertex.code.add(`//   ${e.propertyKey}: true`):t.vertex.code.add(`//   ${e.propertyKey}: false`);t.vertex.code.add(""),t.vertex.code.add("// OPTIONS: "),t.vertex.code.add("// --------------------------------------------------------- ");for(const e of this._options)this[e.propertyKey]?t.vertex.code.add(`//   ${e.propertyKey}: true`):t.vertex.code.add(`//   ${e.propertyKey}: false`)}}},44784:function(t,e,i){function n(t,e){const i=[];for(i.push(e);i.length;){const e=i.pop();if("object"==typeof e&&!t.has(e.uid)){t.add(e.uid);for(const t of e.children)i.push(t)}}}i.d(e,{XL:function(){return c},aw:function(){return h},rR:function(){return u},rz:function(){return n},vA:function(){return s},vL:function(){return o},zg:function(){return l}});class r{constructor(){this.uid=r.NodeCount++,this._debugName=null,this._isMutable=!1,this.isImplicit=!1}get isMutable(){return this._isMutable}setMutable(){return this._isMutable=!0,this}setDebugName(t){return t=t.split(" ").map(((t,e)=>e>0?t.charAt(0).toUpperCase()+t.slice(1):t)).join(""),this._debugName=t,this.isImplicit&&this.children[0]instanceof r&&this.children[0].setDebugName(t),this}get debugInfo(){return{name:this._debugName??""}}cloneInto(t){t._debugName=this._debugName,t._isMutable=this._isMutable,t.isImplicit=this.isImplicit,t.uid=this.uid}}function s(t){return"object"==typeof t?t.clone():t}r.NodeCount=0;class o extends r{constructor(){super(...arguments),this.shaderType="primitive-node"}}class a extends r{constructor(t){super(),this.child=t,this.shaderType="scope-node"}get children(){return[this.child]}clone(){const t=new a(s(this.child));return this.cloneInto(t),t}}class l extends r{constructor(t,e,i){super(),this.property=t,this.target=e,this.returnType=i,this.shaderType="property-access-node"}get children(){const t=[this.target];return"string"!=typeof this.property&&t.push(this.property),t}clone(){const t=new l(this.property,s(this.target),this.returnType);return this.cloneInto(t),t}}class c extends r{constructor(t,e,i){super(),this.condition=t,this.ifTrue=e,this.ifFalse=i,this.shaderType="condition-node"}get children(){return[this.condition,this.ifTrue,this.ifFalse]}clone(){const t=s(this.ifTrue),e=this.ifFalse?s(this.ifFalse):null,i=new c(this.condition,t,e);return this.cloneInto(i),i}}class u extends r{constructor(t,e,i,n){super(),this.captureList=t,this.returnType=e,this.generator=n,this.shaderType="block-node",i&&(this.subgraph=new a(i))}get children(){return Object.keys(this.captureList).map((t=>this.captureList[t])).concat(this.subgraph??[])}clone(){const t={};for(const e in this.captureList)t[e]=s(this.captureList[e]);const e=new u(t,this.returnType,this.subgraph?s(this.subgraph.child):this.subgraph,this.generator);return this.cloneInto(e),e}}class h extends r{constructor(t,e,i,n,r,s=!1){super(),this.token=t,this._children=e,this.isInfix=i,this.isPropertyAccess=n,this.returnType=r,this.isTernary=s,this.shaderType="function-node"}get children(){return this._children}clone(){const t=new h(this.token,this._children.map(s),this.isInfix,this.isPropertyAccess,this.returnType,this.isTernary);return this.cloneInto(t),t}}},70931:function(t,e,i){i.d(e,{$5:function(){return _t},$I:function(){return Y},AU:function(){return kt},Ai:function(){return k},Bw:function(){return Rt},F8:function(){return Vt},Gb:function(){return ut},Io:function(){return At},LC:function(){return ft},LI:function(){return Bt},MM:function(){return mt},My:function(){return S},Ny:function(){return U},Om:function(){return Ct},PM:function(){return Yt},RI:function(){return It},RZ:function(){return Gt},S8:function(){return Lt},Sj:function(){return ht},T9:function(){return Ot},TF:function(){return Ut},Tk:function(){return rt},U:function(){return G},US:function(){return Wt},Uo:function(){return vt},Wh:function(){return H},Xe:function(){return pt},ZY:function(){return M},Zb:function(){return A},Zc:function(){return q},aX:function(){return gt},eB:function(){return P},eR:function(){return $},fV:function(){return Z},gn:function(){return Pt},j1:function(){return st},jc:function(){return Et},jh:function(){return zt},jk:function(){return Ft},ln:function(){return j},lw:function(){return ot},mk:function(){return Tt},n7:function(){return Nt},nf:function(){return dt},nt:function(){return T},om:function(){return nt},or:function(){return yt},qE:function(){return Mt},rY:function(){return wt},tn:function(){return xt},w0:function(){return X},x:function(){return O},z7:function(){return w},ze:function(){return it},zi:function(){return Dt}});var n,r,s,o,a,l,c,u,h,d,f,p,_,m,g=i(53804),y=i(44784);function v(t){return new Proxy(t,{get(e,i){if("constructor"===i)return new Proxy(e.constructor,{construct:(t,e,i)=>v(new t(...e))});if(i in e)return e[i];if("string"==typeof i){const e=function(t){const e=[["float","vec2","vec3","vec4"],["int","ivec2","ivec3","ivec4"],["uint","uvec2","uvec3","uvec4"],["bool","bvec2","bvec3","bvec4"]];for(const i of e)if(i.includes(t))return i.map((t=>W[t]));throw new Error("Unable to find type family")}(t.type);return K(t,i,e[i.length-1])}}})}function x(t){return new Proxy(t,{construct:(t,e,i)=>v(new t(...e))})}class b extends Error{}let S=n=class extends y.vL{constructor(t,e){super(),this.elementType=t,this.size=e,this.children=[],this.type="array"}clone(){const t=new n(this.elementType,this.size);return super.cloneInto(t),t}get(t){if("number"==typeof t){const e=new k(t);return e.isImplicit=!0,K(this,e,this.elementType.constructor)}return K(this,t,this.elementType.constructor)}last(){return this.get(this.size-1)}first(){return this.get(0)}findIndex(t,e,i){return function(t,e,i=0,n=t.size){const r=new k(i).setMutable().setDebugName("FindIndexIterator"),s=e(t.get(r)).setDebugName("FindIndexPredicate"),o=nt({iter:r},k,s,(({out:t,iter:e,subgraph:i})=>`\n${t} = -1;\n\nfor (; ${e} < ${n}; ${e}++) {\n\n${i.body}\n\n  if (${i.varName}) {\n    ${t} = ${e};\n    break;\n  }\n\n}\n`)).setDebugName("FindIndexBlock");return o}(this,t,e,i)}glslFindIndex(t,e,i){return function(t,e,i=0,n=t.size){const r=nt({array:t},k,null,(({out:t,array:r})=>`\n${t} = -1;\nfor (int i = ${i}; i < ${n}; i++) {\n  bool condition;\n  ${e({array:r,i:"i",out:"condition"})}\n  if (condition) {\n    ${t} = i;\n    break;\n  }\n}\n`)).setDebugName("GlslFindIndexBlock");return r}(this,t,e,i)}static ofType(t,e){const i={construct:(i,r)=>new n(new t,e)};return new Proxy(n,i)}};S.type="array",S=n=(0,g._)([function(t){return new Proxy(t,{construct:(t,e,i)=>function(t){return new Proxy(t,{get(e,i){if(i in e)return e[i];if("string"==typeof i){const e=parseInt(i,10);if(!isNaN(e))return K(t,`[${e}]`,t.elementType.constructor)}}})}(new t(...e))})}],S);class w extends y.vL{constructor(){super(...arguments),this.type="sampler2D",this.children=[]}clone(){const t=new w;return t.children=this.children.map(y.vA),super.cloneInto(t),t}}w.type="sampler2D";class T extends y.vL{constructor(t){super(),this.type="float",this.children=[t]}clone(){const t=new T((0,y.vA)(this.children[0]));return super.cloneInto(t),t}multiply(t){return ot(this,"number"==typeof t?D(t,T):t)}divide(t){return at(this,"number"==typeof t?D(t,T):t)}add(t){return lt(this,"number"==typeof t?D(t,T):t)}subtract(t){return ct(this,"number"==typeof t?D(t,T):t)}}T.type="float";let M=r=class extends y.vL{constructor(t,e){super(),this.type="vec2",this.children=[t,e].filter((t=>null!=t))}clone(){const t=new r((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]));return super.cloneInto(t),t}get 0(){return K(this,"[0]",T)}get 1(){return K(this,"[1]",T)}get 2(){throw new b}get 3(){throw new b}multiply(t){return ot(this,"number"==typeof t?D(t,T):t)}divide(t){return at(this,"number"==typeof t?D(t,T):t)}add(t){return lt(this,"number"==typeof t?D(t,T):t)}subtract(t){return ct(this,"number"==typeof t?D(t,T):t)}};M.type="vec2",M=r=(0,g._)([x],M);let P=s=class extends y.vL{constructor(t,e,i){super(),this.type="vec3",this.children=[t,e,i].filter((t=>null!=t))}get 0(){return K(this,"[0]",T)}get 1(){return K(this,"[1]",T)}get 2(){return K(this,"[2]",T)}get 3(){throw new b}clone(){const t=new s((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]));return super.cloneInto(t),t}multiply(t){return ot(this,"number"==typeof t?D(t,T):t)}divide(t){return at(this,"number"==typeof t?D(t,T):t)}add(t){return lt(this,"number"==typeof t?D(t,T):t)}subtract(t){return ct(this,"number"==typeof t?D(t,T):t)}};P.type="vec3",P=s=(0,g._)([x],P);let A=o=class extends y.vL{constructor(t,e,i,n){super(),this.type="vec4",this.children=[t,e,i,n].filter((t=>null!=t))}clone(){const t=new o((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]),(0,y.vA)(this.children[3]));return super.cloneInto(t),t}get 0(){return K(this,"[0]",T)}get 1(){return K(this,"[1]",T)}get 2(){return K(this,"[2]",T)}get 3(){return K(this,"[3]",T)}multiply(t){return ot(this,"number"==typeof t?D(t,T):t)}divide(t){return at(this,"number"==typeof t?D(t,T):t)}add(t){return lt(this,"number"==typeof t?D(t,T):t)}subtract(t){return ct(this,"number"==typeof t?D(t,T):t)}};A.type="vec4",A=o=(0,g._)([x],A);let C=a=class extends y.vL{constructor(t){super(),this.type="uint",this.children=[t]}clone(){const t=new a((0,y.vA)(this.children[0]));return super.cloneInto(t),t}};C.type="uint",C=a=(0,g._)([x],C);let I=l=class extends y.vL{constructor(t,e){super(),this.type="uvec2",this.children=[t,e].filter((t=>null!=t))}clone(){const t=new l((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]));return super.cloneInto(t),t}};I.type="uvec2",I=l=(0,g._)([x],I);let E=c=class extends y.vL{constructor(t,e,i){super(),this.type="uvec3",this.children=[t,e,i].filter((t=>null!=t))}clone(){const t=new c((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]));return super.cloneInto(t),t}};E.type="uvec3",E=c=(0,g._)([x],E);let R=u=class extends y.vL{constructor(t,e,i,n){super(),this.type="uvec4",this.children=[t,e,i,n].filter((t=>null!=t))}clone(){const t=new u((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]),(0,y.vA)(this.children[3]));return super.cloneInto(t),t}};R.type="uvec4",R=u=(0,g._)([x],R);class O extends y.vL{constructor(t){super(),this.type="bool",this.children=[t]}and(t){return vt(this,t)}or(t){return yt(this,t)}clone(){const t=new O((0,y.vA)(this.children[0]));return super.cloneInto(t),t}}O.type="bool";let F=h=class extends y.vL{constructor(t,e){super(),this.type="bvec2",this.children=[t,e].filter((t=>null!=t))}all(){return bt(this)}any(){return St(this)}clone(){const t=new h((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]));return super.cloneInto(t),t}};F.type="bvec2",F=h=(0,g._)([x],F);let z=d=class extends y.vL{constructor(t,e,i){super(),this.type="bvec3",this.children=[t,e,i].filter((t=>null!=t))}all(){return bt(this)}any(){return St(this)}clone(){const t=new d((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]));return super.cloneInto(t),t}};function D(t,e){return"number"==typeof t?new e(t):t}z.type="bvec3",z=d=(0,g._)([x],z);let L=f=class extends y.vL{constructor(t,e,i,n){super(),this.type="bvec4",this.children=[t,e,i,n].filter((t=>null!=t))}all(){return bt(this)}any(){return St(this)}clone(){const t=new f((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]),(0,y.vA)(this.children[3]));return super.cloneInto(t),t}};L.type="bvec4",L=f=(0,g._)([x],L);class k extends y.vL{constructor(t){super(),this.type="int",this.children=[t]}multiply(t){return ot(this,D(t,k))}add(t){return lt(this,D(t,k))}subtract(t){return ct(this,D(t,k))}divide(t){return at(this,D(t,k))}clone(){const t=new k((0,y.vA)(this.children[0]));return super.cloneInto(t),t}}k.type="int";let N=p=class extends y.vL{constructor(t,e){super(),this.type="ivec2",this.children=[t,e].filter((t=>null!=t))}clone(){const t=new p((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]));return super.cloneInto(t),t}};N.type="ivec2",N=p=(0,g._)([x],N);let B=_=class extends y.vL{constructor(t,e,i){super(),this.type="ivec3",this.children=[t,e,i].filter((t=>null!=t))}clone(){const t=new _((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]));return super.cloneInto(t),t}};B.type="ivec3",B=_=(0,g._)([x],B);let V=m=class extends y.vL{constructor(t,e,i,n){super(),this.type="ivec4",this.children=[t,e,i,n].filter((t=>null!=t))}clone(){const t=new m((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]),(0,y.vA)(this.children[3]));return super.cloneInto(t),t}};V.type="ivec4",V=m=(0,g._)([x],V);class U extends y.vL{constructor(t,e,i,n){super(),this.type="mat2",this.children=[t,e,i,n]}clone(){const t=new U((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]),(0,y.vA)(this.children[3]));return super.cloneInto(t),t}multiply(t){return ot(this,t)}}U.type="mat2";class G extends y.vL{static identity(){return new G(1,0,0,0,1,0,0,0,1)}static fromRotation(t){const e=Vt(t),i=Pt(t);return new G(i,e,0,it(e),i,0,0,0,1)}constructor(t,e,i,n,r,s,o,a,l){super(),this.type="mat3",this.children=[t,e,i,n,r,s,o,a,l]}add(t){return lt(this,t)}multiply(t){return ot(this,t)}clone(){const t=new G((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]),(0,y.vA)(this.children[3]),(0,y.vA)(this.children[4]),(0,y.vA)(this.children[5]),(0,y.vA)(this.children[6]),(0,y.vA)(this.children[7]),(0,y.vA)(this.children[8]));return super.cloneInto(t),t}}G.type="mat3";class Y extends y.vL{static identity(){return new Y(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}constructor(t,e,i,n,r,s,o,a,l,c,u,h,d,f,p,_){super(),this.type="mat4",this.children=[t,e,i,n,r,s,o,a,l,c,u,h,d,f,p,_]}static fromColumns(t,e,i,n){return new Y(t.x,t.y,t.z,t.w,e.x,e.y,e.z,e.w,i.x,i.y,i.z,i.w,n.x,n.y,n.z,n.w)}multiply(t){return ot(this,t)}clone(){const t=new Y((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]),(0,y.vA)(this.children[3]),(0,y.vA)(this.children[4]),(0,y.vA)(this.children[5]),(0,y.vA)(this.children[6]),(0,y.vA)(this.children[7]),(0,y.vA)(this.children[8]),(0,y.vA)(this.children[9]),(0,y.vA)(this.children[10]),(0,y.vA)(this.children[11]),(0,y.vA)(this.children[12]),(0,y.vA)(this.children[13]),(0,y.vA)(this.children[14]),(0,y.vA)(this.children[15]));return super.cloneInto(t),t}}Y.type="mat4";const W={float:T,vec2:M,vec3:P,vec4:A,int:k,ivec2:N,ivec3:B,ivec4:V,uint:C,uvec2:I,uvec3:E,uvec4:R,bool:O,bvec2:F,bvec3:z,bvec4:L},H=(...t)=>new k(...t),Z=(...t)=>new T(...t),q=(...t)=>new M(...t),$=(...t)=>new P(...t),j=(...t)=>new A(...t),X=(...t)=>new G(...t);function K(t,e,i){const n=new i(new y.zg(e,t,i));return n.isImplicit=!0,n}function Q(t,e,i,n=null){if(n){const r=new n,s=new n(new y.aw(t,[e,i],!0,!1,r));return s.isImplicit=!0,s}if("float"===e.type||"int"===e.type){const n=new i.constructor(new y.aw(t,[e,i],!0,!1,i.constructor));return n.isImplicit=!0,n}if(("mat2"===e.type||"mat3"===e.type||"mat4"===e.type)&&"float"!==i.type){const n=new i.constructor(new y.aw(t,[e,i],!0,!1,i.constructor));return n.isImplicit=!0,n}const r=new e.constructor(new y.aw(t,[e,i],!0,!1,e.constructor));return r.isImplicit=!0,r}function J(t,e,i=e.constructor){const n=new i(new y.aw(t,[e],!1,!1,i));return n.isImplicit=!0,n}function tt(t,e,i,n=e.constructor){const r=new n(new y.aw(t,[e,i],!1,!1,n));return r.isImplicit=!0,r}function et(t,e,i,n,r=e.constructor){const s=new r(new y.aw(t,[e,i,n],!1,!1,r));return s.isImplicit=!0,s}function it(t){return ot(t,Z(-1))}function nt(t,e,i,n){return new e(new y.rR(t,e,i,n))}function rt(t,e,i){const n="function"==typeof e?e():e,r="function"==typeof i?i():i,s=new n.constructor(new y.XL(t,n,r));return s.isImplicit=!0,s}function st(...t){const e=t.map((([t,e])=>"function"==typeof e?[t,e()]:[t,e])),i=e[0][1].constructor,n=e.findIndex((t=>!0===t[0]));if(-1===n)throw new Error("A cond must have a fallthrough case with `true`/; ");const r=e.slice(0,n),s=e[n][1],o=new i(r.reduceRight(((t,e)=>rt(e[0],e[1],t)),s));return o.isImplicit=!0,o}function ot(t,e){return Q("*",t,e)}function at(t,e){return Q("/",t,e)}function lt(t,e){return Q("+",t,e)}function ct(t,e){return Q("-",t,e)}function ut(t,e){return Q("%",t,e)}function ht(t,e){return Q(">>",t,e)}function dt(t,e){return Q("&",t,e)}function ft(t,e){return Q("==",t,e,O)}function pt(t,e){return Q("<",t,e,O)}function _t(t,e){return Q("<=",t,e,O)}function mt(t,e){return Q(">",t,e,O)}function gt(t,e){return Q(">=",t,e,O)}function yt(...t){return t.length<=1?t[0]:t.slice(1).reduce(((t,e)=>function(t,e){return Q("||",t,e,O)}(t,e)),t[0])}function vt(...t){return t.length<=1?t[0]:t.slice(1).reduce(((t,e)=>function(t,e){return Q("&&",t,e,O)}(t,e)),t[0])}function xt(t){return J("abs",t)}function bt(t){return J("all",t,O)}function St(t){return J("any",t,O)}function wt(t,e){return null==e?J("atan",t):tt("atan",t,e,t.constructor)}function Tt(t){return J("ceil",t)}function Mt(t,e,i){return et("clamp",t,e,i,t.constructor)}function Pt(t){return J("cos",t)}function At(t,e){return tt("distance",t,e,T)}function Ct(t,e){return tt("dot",t,e,T)}function It(t){return J("floor",t)}function Et(t){return J("fract",t)}function Rt(t){return J("length",t,T)}function Ot(t,e){return tt("max",t,e)}function Ft(t,e){return tt("min",t,e)}function zt(t,e,i){return et("mix",t,e,i)}function Dt(t,e){return tt("mod",t,e)}function Lt(t){return J("normalize",t)}function kt(t){return"bool"===t.type?J("!",t):J("not",t)}function Nt(t,e){return tt("pow",t,e)}function Bt(t){return J("round",t)}function Vt(t){return J("sin",t)}function Ut(t,e,i){return et("smoothstep",t,e,i)}function Gt(t){return J("sqrt",t)}function Yt(t,e){return tt("step",t,e,e.constructor)}function Wt(t,e){return tt("texture",t,e,A)}},53400:function(t,e,i){i.d(e,{j:function(){return r}});var n=i(28230);class r{constructor(){this.drawPhase=n.S5.MAP|n.S5.HITTEST|n.S5.HIGHLIGHT|n.S5.DEBUG}startup(){}shutdown(t){}}},92543:function(t,e,i){i.d(e,{c:function(){return r}});var n=i(86329);class r{constructor(t,e,i){this._instanceId=t,this.techniqueRef=e,this._input=i}get instanceId(){return(0,n.P)(this._instanceId)}createMeshInfo(t){return{id:(0,n.P)(this._instanceId),techniqueType:this.techniqueRef.type,inputParams:t,optionalAttributes:this._input.optionalAttributes}}getInput(){return this._input}setInput(t){this._input=t}}},63812:function(t,e,i){i.d(e,{YS:function(){return le},n_:function(){return ue},Wn:function(){return ce}});var n=i(81728),r=i(53804),s=i(3247),o=i(98282),a=i(70931),l=i(99121);class c extends o.k2{}(0,r._)([(0,o.Pi)(a.nt)],c.prototype,"globalTime",void 0),(0,r._)([(0,o.Pi)(a.ZY)],c.prototype,"animationTextureSize",void 0),(0,r._)([(0,o.Pi)(a.z7)],c.prototype,"animationTexture",void 0),(0,r._)([(0,o.Pi)(a.U)],c.prototype,"toScreen",void 0),(0,r._)([(0,o.Pi)(a.U)],c.prototype,"toNdc",void 0),(0,r._)([(0,o.Pi)(a.nt)],c.prototype,"mapRotation",void 0),(0,r._)([(0,o.Pi)(a.nt)],c.prototype,"pixelRatio",void 0);var u=i(33702),h=i(40846),d=i(39979),f=i(86486),p=i(81432),_=i(12026);class m extends o.k2{getVVRotationMat4(t){return(0,a.Tk)((0,f.M8)(t),a.$I.identity(),(()=>{const e=this.getNormalizedAngle(t).multiply(h.os),i=(0,a.F8)(e),n=(0,a.gn)(e);return new a.$I(n,i,0,0,i.multiply(new a.nt(-1)),n,0,0,0,0,1,0,0,0,0,1)}))}getVVRotationMat3(t){return(0,a.Tk)((0,f.M8)(t),a.U.identity(),(()=>{const e=this.getNormalizedAngle(t).multiply(h.os),i=(0,a.F8)(e),n=(0,a.gn)(e);return new a.U(n,i,0,i.multiply(new a.nt(-1)),n,0,0,0,1)}))}getNormalizedAngle(t){const e=(0,a.LC)(this.rotationType,new a.nt(h.H_.Arithmatic));return(0,a.Tk)(e,new a.nt(90).subtract(t),t)}}(0,r._)([(0,o.Pi)(a.nt)],m.prototype,"rotationType",void 0);var g,y=i(13635),v=i(21385),x=i(21813),b=i(76347),S=i(90906);class w extends u.rz{}(0,r._)([(0,o.C5)(3,a.Zb)],w.prototype,"animationPointerAndBaseSizeAndReferenceSize",void 0),(0,r._)([(0,o.C5)(4,a.ZY)],w.prototype,"zoomRange",void 0);class T extends u.DM{}class M extends u.f_{_getScreenPosition(t){const{pos:e,translation:i,rotation:n,scale:r,offset:s,id:o,vvScale:l}=t,c=(0,S.g_)(this,o).multiply(Math.PI/180),u=i.x.multiply(4/3),h=i.y.multiply(-1).multiply(4/3),d=(0,a.F8)(n.subtract(c)),f=(0,a.gn)(n.subtract(c)),p=new a.nt(0),_=new a.nt(1),{pixelRatio:m}=this.animationInfo,g=new a.U(_,p,p,p,_,p,u.multiply(m),h.multiply(m),_),y=new a.U(f,d.multiply(-1),p,d,f,p,0,0,_),v=r.multiply(l).multiply(m).multiply(4/3),x=y.multiply(v),b=this.animationInfo.toScreen.multiply(new a.eB(e,1)),w=g.multiply(b).xy,T=x.multiply(new a.eB(s,0)).xy;return w.add(T)}_clip(t,e){let i=super.clip(t,e);const n=(0,a.$5)(this._getLocalTimeOrigin(t),new a.nt(0));return s.H.forceGlobalTimeOrigin||(i=i.add((0,a.j1)([n,()=>new a.nt(2)],[!0,()=>new a.nt(0)]))),i}_getLocalTimeOrigin(t){return this.storage.getLocalTimeOrigin(t)}_toNdc(t){return this.animationInfo.toNdc.multiply(new a.eB(t,1)).xy}_getEvalParams(t,e){const{globalTime:i,animationTextureSize:n,animationTexture:r}=this.animationInfo;return{globalTime:i,localTimeOrigin:this._getLocalTimeOrigin(t.id),animationTextureSize:n,animationTexture:r,pixelDimensions:e}}_getColor(t,e){return(0,a.Tk)((0,a.LC)(e.isSDF,new a.nt(1)),this._getSDFColor(t,e),this._getSpriteColor(t,e))}_getSpriteColor(t,e){return(0,a.US)(this.mosaicInfo.texture,t).multiply(e.color)}_getSDFColor(t,e){const i=(0,a.US)(this.mosaicInfo.texture,t),n=new a.nt(.5).subtract((0,f.Rj)(i)).multiply(e.distanceToPx).multiply(h.V5),r=(0,a.qE)(new a.nt(.5).subtract(n),new a.nt(0),new a.nt(1)),s=e.color.multiply(r),o=e.outlineSize.multiply(.5),l=(0,a.tn)(n).subtract(o),c=(0,a.qE)(new a.nt(.5).subtract(l),new a.nt(0),new a.nt(1)),u=e.outlineColor.multiply(c);return new a.nt(1).subtract(u.a).multiply(s).add(u)}}function P(t,e,i){const n=t.add(new a.ZY(e,0)),r=(0,a.US)(i.animationTexture,n.add(.5).divide(i.animationTextureSize)).xy;return t=t.add(r),(0,a.om)({animationPointer:t,...i},a.Zb,null,(t=>{const{out:e}=t;if(!e)throw new Error("out is null");return(0,l.DW)({...t,out:e})}))}(0,r._)([(0,o.Pi)(d.b)],M.prototype,"mosaicInfo",void 0),(0,r._)([(0,o.Pi)(c)],M.prototype,"animationInfo",void 0),(0,r._)([(0,o.uK)(p._)],M.prototype,"visualVariableColor",void 0),(0,r._)([(0,o.uK)(_.i)],M.prototype,"visualVariableOpacity",void 0),(0,r._)([(0,o.uK)(y.n)],M.prototype,"visualVariableSizeMinMaxValue",void 0),(0,r._)([(0,o.uK)(v.F)],M.prototype,"visualVariableSizeScaleStops",void 0),(0,r._)([(0,o.uK)(x.N)],M.prototype,"visualVariableSizeStops",void 0),(0,r._)([(0,o.uK)(b.d)],M.prototype,"visualVariableSizeUnitValue",void 0),(0,r._)([(0,o.uK)(m)],M.prototype,"visualVariableRotation",void 0),function(t){t[t.transform=0]="transform",t[t.fromColor=1]="fromColor",t[t.toColor=2]="toColor",t[t.colorMix=3]="colorMix",t[t.toOpacity=4]="toOpacity",t[t.opacityMix=5]="opacityMix"}(g||(g={}));var A=i(97473),C=i(66425);class I extends w{}(0,r._)([(0,o.C5)(5,a.ZY)],I.prototype,"offset",void 0),(0,r._)([(0,o.C5)(6,a.ZY)],I.prototype,"uv",void 0),(0,r._)([(0,o.C5)(7,a.Zb)],I.prototype,"sizing",void 0),(0,r._)([(0,o.C5)(8,a.nt)],I.prototype,"angle",void 0);class E extends o.Y7{}function R(t,e,i,n){return e.multiply(t.x).add(i.multiply(t.y)).add(n.multiply(t.z))}(0,r._)([(0,o.C5)(12,a.ZY)],E.prototype,"offsetNextVertex1",void 0),(0,r._)([(0,o.C5)(13,a.ZY)],E.prototype,"offsetNextVertex2",void 0),(0,r._)([(0,o.C5)(14,a.ZY)],E.prototype,"textureUVNextVertex1",void 0),(0,r._)([(0,o.C5)(15,a.ZY)],E.prototype,"textureUVNextVertex2",void 0);class O extends M{constructor(){super(...arguments),this.computeAttributes={offset:["offsetNextVertex1","offsetNextVertex2"],uv:["textureUVNextVertex1","textureUVNextVertex2"]}}_vertexPreamble(t){const{id:e,pos:i,offset:n,animationPointerAndBaseSizeAndReferenceSize:r,uv:s,sizing:o,angle:l}=t,c=r.xy,u=r.z,d=r.w,p=o.xy,_=o.z,m=(0,f.mh)(t.bitset,A.c.bitset.isStroke),y=o.w,v=(0,f.mh)(t.bitset,A.c.bitset.scaleSymbolsProportionally),x=this._getEvalParams(t,p),b=P(c,g.transform,x),w=(0,a.j1)([(0,a.LC)((0,f.mh)(t.bitset,A.c.bitset.isMapAligned),new a.nt(1)),this.view.rotation.divide(180).multiply(Math.PI)],[!0,new a.nt(0)]),T=new a.Ny((0,a.gn)(w),(0,a.F8)(w.multiply(-1)),(0,a.F8)(w),(0,a.gn)(w)).multiply(b.xy),M=b.z.subtract(w).subtract(l.multiply(h.rp)),C=b.w,I=(0,f.mh)(t.bitset,A.c.bitset.isSDF),E=(0,S.Mg)(this,e,new a.nt(d)).divide(new a.nt(d));return{baseSize:u,animationPointer:c,strokeWidth:_,isOutline:m,unscaledDistanceToPx:y,scaleSymbolsProportionally:v,isSDF:I,position:this._getScreenPosition({id:e,pos:i,offset:n,referenceSize:d,translation:T,rotation:M,scale:C,vvScale:E}),uv:s,evalParams:x,vvScale:E,scale:C}}vertex(t,e){const{position:i,animationPointer:n,evalParams:r,isOutline:s,unscaledDistanceToPx:o,vvScale:l,uv:c,strokeWidth:u,scaleSymbolsProportionally:h,scale:d,isSDF:p,baseSize:_}=this._vertexPreamble(t),m=this._toNdc(i);let y=P(n,g.fromColor,r);y=new a.Zb(y.rgb.multiply(y.a),y.a);let v=P(n,g.toColor,r);v=new a.Zb(v.rgb.multiply(v.a),v.a);let x=P(n,g.colorMix,r);x=new a.Zb(x.rgb.multiply(x.a),x.a);const b=P(n,g.toOpacity,r).a,w=P(n,g.opacityMix,r).a,T=(0,S.G7)(this,t.id,y,(0,a.or)((0,f.K5)(t.bitset,A.c.bitset.colorLocked),new a.x(s))),M=(0,a.jh)(T,v,x),C=(0,S.cF)(this,t.id),I=(0,a.jh)(C,b,w),E=M.multiply(I),R=this.clip(t.id,t.zoomRange),O=o.multiply(l);return{glPosition:new a.Zb(m,R,1),uv:c.divide(this.mosaicInfo.size),color:E.multiply(new a.nt(1).subtract(s)),outlineColor:E.multiply(s),distanceToPx:O,strokeWidth:u.multiply((0,a.jh)(new a.nt(1),d,h)),isOutline:s,isSDF:p,...this.maybeRunHittest(t,e,{pos:t.pos,size:_,sizeCorrection:new a.nt(1),isMapAligned:new a.nt(1),vvRotationMat3:new a.U(1,0,0,0,1,0,0,0,1),placementMat3:new a.U(1,0,0,0,1,0,0,0,1),outlineSize:new a.nt(1),distanceToPx:O,isSDF:p})}}fragment(t){let e=this._getColor(t.uv,{color:t.color,distanceToPx:t.distanceToPx,isSDF:t.isSDF,outlineColor:t.outlineColor,outlineSize:t.strokeWidth});return s.H.spotlightAnimatedSymbols&&(e=e.add(new a.Zb(0,.3,0,.3))),this.getFragmentOutput(e,t)}hittest(t,e,i){return(0,a.Tk)((0,a.Xe)(i.size,this.hittestRequest.smallSymbolSizeThreshold),this._hittestSmallMarker(t,e,i),this._hittestMarker(t,e,i))}_hittestSmallMarker(t,e,i){const{position:n,distance:r,smallSymbolDistance:s}=this.hittestRequest,o=r.subtract(s),{viewMat3:l,tileMat3:c}=this.view,u=l.multiply(c).multiply(new a.eB(i.pos,1)).xy,h=i.size.multiply(.5);return(0,a.Io)(u,n).subtract(h).add(o)}_hittestMarker(t,e,i){const n=this._vertexPreamble({...t}).position,r=this._vertexPreamble({...t,offset:e.offsetNextVertex1,uv:e.textureUVNextVertex1}).position,s=this._vertexPreamble({...t,offset:e.offsetNextVertex2,uv:e.textureUVNextVertex2}).position,o=this.hittestRequest.position,l=this.hittestRequest.distance,c=(0,C.Bo)(o,n,r,s);return(0,a.Tk)((0,a.MM)(c,l),c,this._hittestSamples(n,r,s,t,e,i))}_hittestSamples(t,e,i,n,r,s){const{outlineSize:o,isSDF:l,distanceToPx:c}=s,u=this.hittestRequest.position,h=this.hittestRequest.distance,d=(0,C.Bs)(u.add(new a.ZY((0,a.ze)(h),(0,a.ze)(h))),t,e,i),f=(0,C.Bs)(u.add(new a.ZY(0,(0,a.ze)(h))),t,e,i),p=(0,C.Bs)(u.add(new a.ZY(h,(0,a.ze)(h))),t,e,i),_=(0,C.Bs)(u.add(new a.ZY((0,a.ze)(h),0)),t,e,i),m=(0,C.Bs)(u,t,e,i),g=(0,C.Bs)(u.add(new a.ZY(h,0)),t,e,i),y=(0,C.Bs)(u.add(new a.ZY((0,a.ze)(h),h)),t,e,i),v=(0,C.Bs)(u.add(new a.ZY(0,h)),t,e,i),x=(0,C.Bs)(u.add(new a.ZY(h,h)),t,e,i),b=n.uv.divide(this.mosaicInfo.size),S=r.textureUVNextVertex1.divide(this.mosaicInfo.size),w=r.textureUVNextVertex2.divide(this.mosaicInfo.size),T={color:new a.Zb(1,1,1,1),outlineSize:o,outlineColor:new a.Zb(1,1,1,1),isSDF:l,distanceToPx:c};let M=new a.nt(0);return M=M.add((0,C.kW)(d).multiply(this._getColor(R(d,b,S,w),T).a)),M=M.add((0,C.kW)(f).multiply(this._getColor(R(f,b,S,w),T).a)),M=M.add((0,C.kW)(p).multiply(this._getColor(R(p,b,S,w),T).a)),M=M.add((0,C.kW)(_).multiply(this._getColor(R(_,b,S,w),T).a)),M=M.add((0,C.kW)(m).multiply(this._getColor(R(m,b,S,w),T).a)),M=M.add((0,C.kW)(g).multiply(this._getColor(R(g,b,S,w),T).a)),M=M.add((0,C.kW)(y).multiply(this._getColor(R(y,b,S,w),T).a)),M=M.add((0,C.kW)(v).multiply(this._getColor(R(v,b,S,w),T).a)),M=M.add((0,C.kW)(x).multiply(this._getColor(R(x,b,S,w),T).a)),(0,a.PM)(M,new a.nt(.05)).multiply((0,C.My)(this.hittestRequest))}}(0,r._)([(0,r.a)(0,(0,o.hF)(I)),(0,r.a)(1,(0,o.hF)(E))],O.prototype,"vertex",null),(0,r._)([(0,r.a)(0,(0,o.hF)(class extends T{}))],O.prototype,"fragment",null);var F=i(44705),z=i(25090),D=i(28230),L=i(53400);class k extends L.j{constructor(){super(...arguments),this.symbologyPlane=D.uC.FILL,this._input=null}}var N=i(86847);class B extends k{render(t,e){const{context:i,painter:n}=t,{target:r}=e,{freezeGlobalTime:o}=s.H,a=n.textureManager.animationStore.getTexture(i,0),l=[2/t.state.size[0],0,0,0,-2/t.state.size[1],0,-1,1,1],c=Array.from((0,F.B8)((0,z.vt)(),l)),u=Array.from((0,F.lw)((0,z.vt)(),c,r.transforms.displayViewScreenMat3)),h=e.instance.getInput();n.setShader({shader:this.shaders.geometry,uniforms:{...(0,N.r3)(t,e.target,h.uniforms),...(0,N.QA)(t,e.target),mosaicInfo:n.textureManager.getMosaicInfo(i,e.textureKey,!0),animationInfo:{globalTime:!1===o?t.time/1e3:o,animationTextureSize:[a.descriptor.width,a.descriptor.height],animationTexture:{unit:6,texture:a},toScreen:u,toNdc:l,mapRotation:t.state.rotation,pixelRatio:t.state.pixelRatio}},defines:{...(0,N.vT)(t)},optionalAttributes:{zoomRange:!0},useComputeBuffer:!0}),n.setPipelineState({...(0,N.Qu)(t)}),n.submitDraw(t,e),!1===o&&r.requestRender()}}var V=i(39686),U=i(97673),G=i(64522);class Y extends o.ZA{}(0,r._)([(0,o.C5)(0,a.ZY)],Y.prototype,"pos",void 0);class W extends u.DM{}class H extends o.k2{}(0,r._)([(0,o.Pi)(a.nt)],H.prototype,"dotSize",void 0);class Z extends o.k2{}(0,r._)([(0,o.Pi)(a.z7)],Z.prototype,"locations",void 0),(0,r._)([(0,o.Pi)(a.nt)],Z.prototype,"pixelRatio",void 0),(0,r._)([(0,o.Pi)(a.nt)],Z.prototype,"tileZoomFactor",void 0);class q extends o.A{vertex(t){const e=new a.U(1,0,0,0,-1,0,0,1,1).multiply(new a.eB(t.pos.xy.divide(V.CQ),1)),i=(0,a.US)(this.draw.locations,e.xy),n=(0,a.T9)(this.instance.dotSize.divide(2),new a.nt(1));let r=new a.nt(0);r=r.add((0,a.PM)(i.a,new a.nt(1e-6)).multiply(2));let s=n.add(this.instance.dotSize);const o=this.view.displayViewScreenMat3.multiply(new a.eB(t.pos.add(.5),1)),l=new a.Zb(o.xy,r,1),c=this.instance.dotSize.divide(s),u=new a.nt(-1).divide(n.divide(s));return s=s.multiply(this.draw.pixelRatio.multiply(this.draw.tileZoomFactor)),{glPosition:l,glPointSize:s,color:i,ratio:c,invEdgeRatio:u}}fragment(t){const e=(0,a.Bw)(t.glPointCoord.subtract(.5)).multiply(2),i=(0,a.TF)(new a.nt(0),new a.nt(1),t.invEdgeRatio.multiply(e.subtract(t.ratio)).add(1)),n=new o.mm;return n.glFragColor=t.color.multiply(i),n}}(0,r._)([(0,o.Pi)(H)],q.prototype,"instance",void 0),(0,r._)([(0,o.Pi)(Z)],q.prototype,"draw",void 0),(0,r._)([(0,o.Pi)(G.o)],q.prototype,"view",void 0),(0,r._)([(0,r.a)(0,(0,o.hF)(Y))],q.prototype,"vertex",null),(0,r._)([(0,r.a)(0,(0,o.hF)(W))],q.prototype,"fragment",null);class $ extends u.rz{}(0,r._)([(0,o.C5)(3,a.nt)],$.prototype,"inverseArea",void 0);class j extends o.k2{}(0,r._)([(0,o.Pi)(a.My.ofType(a.Zb,2))],j.prototype,"isActive",void 0),(0,r._)([(0,o.Pi)(a.My.ofType(a.Zb,8))],j.prototype,"colors",void 0),(0,r._)([(0,o.Pi)(a.nt)],j.prototype,"dotValue",void 0);class X extends o.k2{}(0,r._)([(0,o.Pi)(a.z7)],X.prototype,"dotTexture0",void 0),(0,r._)([(0,o.Pi)(a.z7)],X.prototype,"dotTexture1",void 0),(0,r._)([(0,o.Pi)(a.nt)],X.prototype,"tileZoomFactor",void 0),(0,r._)([(0,o.Pi)(a.nt)],X.prototype,"pixelRatio",void 0),(0,r._)([(0,o.Pi)(a.nt)],X.prototype,"tileDotsOverArea",void 0);class K extends u.f_{_dotThreshold(t,e,i){return t.divide(e).divide(i)}vertex(t){const e=new a.U(2/V.CQ,0,0,0,-2/V.CQ,0,-1,1,1).multiply(new a.eB(t.pos,1)),i=this.clip(t.id),n=new a.Zb(e.xy,i,1),r=this.storage.getVVData(t.id).multiply(this.instance.isActive.get(0)).multiply(t.inverseArea),s=this.storage.getDataDrivenData0(t.id).multiply(this.instance.isActive.get(1)).multiply(t.inverseArea),o=this.draw.tileZoomFactor.multiply(V.CQ).divide(this.draw.pixelRatio),l=this._dotThreshold(r,this.instance.dotValue,this.draw.tileDotsOverArea),c=this._dotThreshold(s,this.instance.dotValue,this.draw.tileDotsOverArea),u=t.pos.add(.5).divide(o);return{glPosition:n,color:new a.Zb(0,0,0,0),textureCoords:u,thresholds0:l,thresholds1:c}}fragment(t){const e=new o.mm,i=(0,a.US)(this.draw.dotTexture0,t.textureCoords),n=(0,a.US)(this.draw.dotTexture1,t.textureCoords),r=t.thresholds0.subtract(i),s=t.thresholds1.subtract(n);let l;const c=a.$I.fromColumns(this.instance.colors[0],this.instance.colors[1],this.instance.colors[2],this.instance.colors[3]),u=a.$I.fromColumns(this.instance.colors[4],this.instance.colors[5],this.instance.colors[6],this.instance.colors[7]);if(this.blending){const t=(0,a.PM)(new a.nt(0),r),e=(0,a.PM)(new a.nt(0),s),i=(0,a.Om)(t,r).add((0,a.Om)(e,s)),n=(0,a.PM)(i,new a.nt(0)),o=new a.nt(1).subtract(n),h=i.add(n),d=r.multiply(t).divide(h),f=s.multiply(e).divide(h),p=c.multiply(d).add(u.multiply(f));l=o.multiply(p)}else{const t=(0,a.T9)((0,f.xf)(r),(0,f.xf)(s)),e=(0,a.PM)(t,new a.nt(0)),i=new a.nt(1).subtract(e),n=(0,a.PM)(t,r),o=(0,a.PM)(t,s),h=c.multiply(n).add(u.multiply(o));l=i.multiply(h)}return e.glFragColor=l,e}hittest(t){return(0,C.My)(this.hittestRequest)}}(0,r._)([o.E8],K.prototype,"blending",void 0),(0,r._)([(0,o.Pi)(j)],K.prototype,"instance",void 0),(0,r._)([(0,o.Pi)(X)],K.prototype,"draw",void 0),(0,r._)([(0,r.a)(0,(0,o.hF)($))],K.prototype,"vertex",null),(0,r._)([(0,r.a)(0,(0,o.hF)(u.DM))],K.prototype,"fragment",null);var Q=i(13798),J=i(61117),tt=i(85456),et=i(96402),it=i(49414),nt=i(15167),rt=i(12285),st=i(10956);const ot={pos:{count:2,type:tt.pe.UNSIGNED_SHORT}};class at{constructor(){this._dotTextureSize=0,this._dotTextures=null,this._dotMesh=null}destroy(){this._disposeTextures(),this._dotFBO&&this._dotFBO.dispose(),this._dotMesh&&this._dotMesh.destroy()}getFBO(t){if(null==this._dotFBO){const e=V.CQ,i=V.CQ,n=new st.R(e,i);n.samplingMode=tt.Cj.NEAREST,n.wrapMode=tt.pF.CLAMP_TO_EDGE;const r=new it.l(t,new nt.q(tt.yQ.DEPTH_STENCIL,e,i));this._dotFBO=new et.H(t,n,r)}return this._dotFBO}getDotDensityMesh(t,e){if(null==this._dotMesh){const i=V.CQ,n=i*i,r=2,s=new Int16Array(n*r);for(let t=0;t<i;t++)for(let e=0;e<i;e++)s[r*(e+t*i)]=e,s[r*(e+t*i)+1]=t;this._dotMesh=J.g.create(t,{primitive:tt.WR.POINTS,vertex:s,count:n,layout:ot},e)}return this._dotMesh}getDotDensityTextures(t,e,i){if(this._dotTextureSize===e&&this._seed===i||(this._disposeTextures(),this._dotTextureSize=e,this._seed=i),null===this._dotTextures){const n=new Q.A(i);this._dotTextures=[this._allocDotDensityTexture(t,e,n),this._allocDotDensityTexture(t,e,n)]}return this._dotTextures}_disposeTextures(){if(this._dotTextures){for(let t=0;t<this._dotTextures.length;t++)this._dotTextures[t].dispose();this._dotTextures=null}}_allocDotDensityTexture(t,e,i){const n=new Float32Array(e*e*4);for(let t=0;t<n.length;t++)n[t]=i.getFloat();const r=new st.R;return r.dataType=tt.ld.FLOAT,r.samplingMode=tt.Cj.NEAREST,r.width=e,r.height=e,new rt.g(t,r,n)}}var lt=i(42203),ct=i(58991);function ut(t){const e=1/t;return{antialiasing:e,blur:0+e}}var ht=i(47461),dt=i(54537),ft=i(51741),pt=i(15087),_t=i(40633),mt=i(95929),gt=i(39819);class yt{constructor(t,e,i,n){this.dataType=t,this.samplingMode=e,this.pixelFormat=i,this.internalFormat=n}}new yt(tt.ld.HALF_FLOAT,tt.Cj.NEAREST,tt.Ab.RGBA,tt.Ab.RGBA);class vt{destroy(){this._accumulateFramebuffer=(0,mt.WD)(this._accumulateFramebuffer),this._resolveGradientTexture=(0,mt.WD)(this._resolveGradientTexture),this._prevGradientHash=null,this._qualityProfile=null}get initialized(){return null!=this._accumulateFramebuffer&&null!=this._resolveGradientTexture}get accumulateFramebuffer(){return this._accumulateFramebuffer}get resolveGradientTexture(){return this._resolveGradientTexture}loadQualityProfile(t){if(null==this._qualityProfile){const e=function(t,e){const{textureFloatLinear:i,colorBufferFloat:n}=t.capabilities,r=n?.textureFloat,s=n?.textureHalfFloat,o=n?.floatBlend,a=t.driverTest.floatBufferBlend.result;if(!r&&!s)throw new gt.A("heatmap:missing-color-buffer-float","HeatmapRenderer requires the WebGL extension EXT_color_buffer_float or EXT_color_buffer_half_float or WEBGL_color_buffer_float.");if(!(o&&a||s))throw new gt.A("heatmap:missing-float-blend","HeatmapRenderer requires the WebGL extension EXT_float_blend or EXT_color_buffer_half_float."+(a?"":" This device claims support for EXT_float_blend, but does not actually support it."));const l=r&&o&&a,c=s,u=i,h=!!n?.R32F,d=!!n?.R16F;if(l&&u)return u||e.warnOnce("Missing WebGL extension OES_texture_float_linear. Heatmap quality may be reduced."),new yt(tt.ld.FLOAT,u?tt.Cj.LINEAR:tt.Cj.NEAREST,h?tt.Ab.RED:tt.Ab.RGBA,h?tt.H0.R32F:tt.Ab.RGBA);if(c)return new yt(tt.ld.HALF_FLOAT,tt.Cj.LINEAR,d?tt.Ab.RED:tt.Ab.RGBA,d?tt.H0.R16F:tt.Ab.RGBA);throw new gt.A("heatmap:missing-hardware-support","HeatmapRenderer requires WebGL extensions that allow it to render and blend to float or half float textures.")}(t,_t.A.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.heatmap.HeatmapResources"));this._qualityProfile={...e,defines:{usesHalfFloatPrecision:e.dataType!==tt.ld.FLOAT}}}return this._qualityProfile}ensureAccumulateFBO(t,e,i){if(null==this._accumulateFramebuffer){const{dataType:n,samplingMode:r,pixelFormat:s,internalFormat:o}=this.loadQualityProfile(t),a=new st.R(e,i);a.pixelFormat=s,a.internalFormat=o,a.dataType=n,a.samplingMode=r,a.wrapMode=tt.pF.CLAMP_TO_EDGE;const l=new nt.q(tt.yQ.DEPTH_STENCIL,e,i);this._accumulateFramebuffer=new et.H(t,a,l)}else{const{width:t,height:n}=this._accumulateFramebuffer;t===e&&n===i||this._accumulateFramebuffer.resize(e,i)}return this._accumulateFramebuffer}ensureResolveGradientTexture(t,e,i){if(null==this._resolveGradientTexture){const e=new st.R;e.wrapMode=tt.pF.CLAMP_TO_EDGE,this._resolveGradientTexture=new rt.g(t,e)}else this._prevGradientHash!==e&&(this._resolveGradientTexture.resize(i.length/4,1),this._resolveGradientTexture.setData(i),this._prevGradientHash=e);return this._resolveGradientTexture}}function xt(t){return t?.25:1}class bt extends u.rz{}(0,r._)([(0,o.C5)(5,a.ZY)],bt.prototype,"offset",void 0);class St extends u.DM{}class wt extends o.k2{}(0,r._)([(0,o.Pi)(a.nt)],wt.prototype,"radius",void 0),(0,r._)([(0,o.Pi)(a.nt)],wt.prototype,"isFieldActive",void 0);class Tt extends u.f_{constructor(){super(...arguments),this.usesHalfFloatPrecision=!1}vertex(t){const{radius:e,isFieldActive:i}=this.kernelControls,n=t.offset,r=i.multiply(this.storage.getVVData(t.id).x).add(new a.nt(1).subtract(i)),s=this.view.displayViewScreenMat3.multiply(new a.eB(t.pos,1)).add(this.view.displayViewMat3.multiply(new a.eB(n,0)).multiply(e)),o=this.clip(t.id);return{glPosition:new a.Zb(s.xy,o,1),offset:n,fieldValue:r,color:new a.Zb(0),...this.maybeRunHittest(t,{},null)}}fragment(t){const{offset:e,fieldValue:i}=t,n=(0,a.Bw)(e),r=(0,a.PM)(n,new a.nt(1)),s=new a.nt(1).subtract(n.multiply(n)),o=s.multiply(s),l=r.multiply(o).multiply(i).multiply(new a.nt(xt(this.usesHalfFloatPrecision)));return this.getFragmentOutput(new a.Zb(l),t)}hittest(t){const{viewMat3:e,tileMat3:i}=this.view,n=e.multiply(i).multiply(new a.eB(t.pos,1));return(0,C.g$)(n.xy,this.kernelControls.radius,this.hittestRequest.position)}}(0,r._)([o.E8],Tt.prototype,"usesHalfFloatPrecision",void 0),(0,r._)([(0,o.Pi)(wt)],Tt.prototype,"kernelControls",void 0),(0,r._)([(0,r.a)(0,(0,o.hF)(bt))],Tt.prototype,"vertex",null),(0,r._)([(0,r.a)(0,(0,o.hF)(St))],Tt.prototype,"fragment",null);class Mt extends o.ZA{}(0,r._)([(0,o.C5)(0,a.ZY)],Mt.prototype,"position",void 0);class Pt extends o.HS{}class At extends o.k2{}(0,r._)([(0,o.Pi)(a.z7)],At.prototype,"texture",void 0),(0,r._)([(0,o.Pi)(a.ZY)],At.prototype,"minAndInvRange",void 0),(0,r._)([(0,o.Pi)(a.nt)],At.prototype,"normalization",void 0);class Ct extends o.k2{}(0,r._)([(0,o.Pi)(a.z7)],Ct.prototype,"texture",void 0);class It extends o.A{constructor(){super(...arguments),this.usesHalfFloatPrecision=!1}vertex(t){return{glPosition:new a.Zb(t.position.multiply(2).subtract(1),1,1),uv:t.position}}fragment(t){const{accumulatedDensity:e,gradient:i}=this;let n=(0,a.US)(e.texture,t.uv).r.divide(new a.nt(xt(this.usesHalfFloatPrecision)));n=n.multiply(e.normalization),n=n.subtract(e.minAndInvRange.x).multiply(e.minAndInvRange.y);const r=(0,a.US)(i.texture,new a.ZY(n,.5)),s=new o.mm;return s.glFragColor=new a.Zb(r.rgb.multiply(r.a),r.a),s}}function Et(t){return t.key.level+1}(0,r._)([o.E8],It.prototype,"usesHalfFloatPrecision",void 0),(0,r._)([(0,o.Pi)(At)],It.prototype,"accumulatedDensity",void 0),(0,r._)([(0,o.Pi)(Ct)],It.prototype,"gradient",void 0),(0,r._)([(0,r.a)(0,(0,o.hF)(Mt))],It.prototype,"vertex",null),(0,r._)([(0,r.a)(0,(0,o.hF)(Pt))],It.prototype,"fragment",null);const Rt={color:{write:[!0,!0,!0,!0],blendMode:"additive"},depth:!1,stencil:{write:!1,test:{ref:Et,compare:tt.MT.GEQUAL,mask:255,op:{fail:tt.eA.KEEP,zFail:tt.eA.KEEP,zPass:tt.eA.REPLACE}}}},Ot={...Rt,stencil:!1},Ft={color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1};function zt(t,e){const{referenceScale:i,radius:n}=t.uniforms;return n*(0!==i?i/e.scale:1)}const Dt=360/254;var Lt;!function(t){t[t.Color=0]="Color",t[t.Outline=1]="Outline",t[t.Halo=2]="Halo"}(Lt||(Lt={}));class kt extends u.rz{}(0,r._)([(0,o.C5)(3,a.Zb)],kt.prototype,"color",void 0),(0,r._)([(0,o.C5)(4,a.ZY)],kt.prototype,"offset",void 0),(0,r._)([(0,o.C5)(5,a.ZY)],kt.prototype,"textureUV",void 0),(0,r._)([(0,o.C5)(6,a.nt)],kt.prototype,"fontSize",void 0),(0,r._)([(0,o.C5)(7,a.nt)],kt.prototype,"referenceSize",void 0),(0,r._)([(0,o.C5)(8,a.Zb)],kt.prototype,"outlineColor",void 0),(0,r._)([(0,o.C5)(9,a.Zb)],kt.prototype,"haloColor",void 0),(0,r._)([(0,o.C5)(10,a.ZY)],kt.prototype,"outlineAndHaloSize",void 0),(0,r._)([(0,o.C5)(11,a.ZY)],kt.prototype,"zoomRange",void 0),(0,r._)([(0,o.C5)(12,a.nt)],kt.prototype,"clipAngle",void 0),(0,r._)([(0,o.C5)(13,a.Zb)],kt.prototype,"referenceSymbol",void 0);class Nt extends o.Y7{}(0,r._)([(0,o.C5)(14,a.ZY)],Nt.prototype,"offsetNextVertex1",void 0),(0,r._)([(0,o.C5)(15,a.ZY)],Nt.prototype,"offsetNextVertex2",void 0);class Bt extends u.DM{}class Vt extends u.f_{constructor(){super(...arguments),this.computeAttributes={offset:["offsetNextVertex1","offsetNextVertex2"]},this.textRenderPassType=Lt.Color,this.isBackgroundPass=!1,this.isLabel=!1}clipLabel(t,e,i){const n=e.multiply(Dt),r=(0,a.tn)(this.view.rotation.subtract(n)),s=(0,a.jk)(new a.nt(360).subtract(r),r);let o=new a.nt(0);const l=(0,a.RI)(this.view.currentZoom.multiply(V.fq)).divide(V.fq),c=t.x,u=t.y,h=new a.nt(1).subtract((0,a.PM)(c,l)).multiply(2),d=(0,a.PM)(new a.nt(90),s).multiply(2),f=new a.nt(2).multiply(new a.nt(1).subtract((0,a.PM)(l,u)));return o=o.add(i.multiply(h)),o=o.add(i.multiply(d)),o=o.add(f),o}vertex(t,e){const i=(0,f.mh)(t.bitset,h.bg),n=new a.nt(1).subtract(i);let r=t.fontSize,s=r.divide(h.au);const o=this.textRenderPassType===Lt.Outline?t.outlineColor:this.textRenderPassType===Lt.Halo?t.haloColor:this._getVertexColor(t),l=this.isLabel?this.storage.getLabelVisibility(t.id):new a.nt(1),c=this.isLabel?o.multiply(l):o,u=this.view.displayViewScreenMat3.multiply(new a.eB(t.pos,1));let d=t.offset,p=new a.nt(1),_=a.U.identity(),m=new a.ZY(0);if(this.isLabel){if(!t.referenceSymbol)throw new Error("InternalError: Optional attribute 'referenceSymbol' expected for labels");const e=t.referenceSymbol,i=e.xy,n=e.z,r=this._unpackDirection(e.w),s=(0,S.Mg)(this,t.id,n).divide(2),o=r.multiply(s.add(V.C2));m=i.add(o),d=d.add(m)}else p=(0,S.Mg)(this,t.id,t.referenceSize).divide(t.referenceSize),r=r.multiply(p),s=s.multiply(p),d=d.multiply(p),_=(0,S.TL)(this,t.id),d=_.multiply(new a.eB(d,0)).xy;const g=(0,f.mh)(t.bitset,h.ti),y=this._getViewRotationMatrix(g).multiply(new a.eB(d,0));let v=this.isLabel?this.clipLabel(t.zoomRange,t.clipAngle,g):this.clip(t.id,t.zoomRange);v=this.isBackgroundPass?v.add(n.multiply(2)):v.add(i.multiply(2));const x=this.isLabel?(0,a.or)((0,a.MM)(v,new a.nt(1)),(0,a.LC)(l,new a.nt(0))):new a.x(!1),b=new a.Zb(u.xy.add(y.xy),v,1),w=t.textureUV.divide(this.mosaicInfo.size);let T=new a.nt(0);if(this.textRenderPassType===Lt.Outline&&((0,a.LC)(t.outlineAndHaloSize.x,new a.nt(0))&&(v=v.add(new a.nt(2))),T=new a.nt(t.outlineAndHaloSize.x).divide(s).divide(h.$w)),this.textRenderPassType===Lt.Halo){const e=t.outlineAndHaloSize.x,i=new a.nt(t.outlineAndHaloSize.y);(0,a.LC)(i,new a.nt(0))&&(v=v.add(new a.nt(2))),T=i.add(e).divide(s).divide(h.$w)}return{glPosition:b,color:c,size:s,textureUV:w,antialiasingWidth:new a.nt(.105*h.au).divide(r).divide(this.view.pixelRatio),outlineDistanceOffset:T,...this.maybeRunHittest(t,e,{vvSizeAdjustment:p,vvRotation:_,labelOffset:m,labelClipped:x})}}_getViewRotationMatrix(t){const e=this.view.displayViewMat3,i=this.view.displayMat3,n=new a.nt(1).subtract(t);return e.multiply(t).add(i.multiply(n))}fragment(t){const e=new a.nt(2/8),i=new a.nt(1).subtract(e),n=(0,a.US)(this.mosaicInfo.texture,t.textureUV).a;let r=i.subtract(t.outlineDistanceOffset);this.highlight&&(r=r.divide(2));const s=t.antialiasingWidth,o=(0,a.TF)(r.subtract(s),r.add(s),n);return this.getFragmentOutput(t.color.multiply(o),t)}hittest(t,e,{vvSizeAdjustment:i,vvRotation:n,labelOffset:r,labelClipped:s}){let o,l,c;this.isLabel?(o=new a.eB(t.offset.add(r),0),l=new a.eB(e.offsetNextVertex1.add(r),0),c=new a.eB(e.offsetNextVertex2.add(r),0)):(o=n.multiply(new a.eB(t.offset.multiply(i),0)),l=n.multiply(new a.eB(e.offsetNextVertex1.multiply(i),0)),c=n.multiply(new a.eB(e.offsetNextVertex2.multiply(i),0)));const{viewMat3:u,tileMat3:h}=this.view,d=u.multiply(h).multiply(new a.eB(t.pos,1)),f=d.add(h.multiply(o)).xy,p=d.add(h.multiply(l)).xy,_=d.add(h.multiply(c)).xy,m=(0,C.Bo)(this.hittestRequest.position,f.xy,p.xy,_.xy);return this.isLabel?(0,a.Tk)(s,(0,C.My)(this.hittestRequest),m):m}_unpackDirection(t){const e=new a.Ai(t),i=(0,a.Sj)(e,new a.Ai(2)),n=(0,a.nf)(e,new a.Ai(3));return new a.ZY(new a.nt(i).subtract(1),new a.nt(n).subtract(1))}_getVertexColor(t){let e=t.color;if(this.visualVariableColor){const i=this.storage.getColorValue(t.id);e=this.visualVariableColor.getColor(i,t.color,new a.x(!1))}if(this.visualVariableOpacity){const i=this.storage.getOpacityValue(t.id),n=this.visualVariableOpacity.getOpacity(i);e=e.multiply(n)}return e}}(0,r._)([(0,o.uK)(p._)],Vt.prototype,"visualVariableColor",void 0),(0,r._)([(0,o.uK)(_.i)],Vt.prototype,"visualVariableOpacity",void 0),(0,r._)([(0,o.uK)(m)],Vt.prototype,"visualVariableRotation",void 0),(0,r._)([(0,o.uK)(y.n)],Vt.prototype,"visualVariableSizeMinMaxValue",void 0),(0,r._)([(0,o.uK)(v.F)],Vt.prototype,"visualVariableSizeScaleStops",void 0),(0,r._)([(0,o.uK)(x.N)],Vt.prototype,"visualVariableSizeStops",void 0),(0,r._)([(0,o.uK)(b.d)],Vt.prototype,"visualVariableSizeUnitValue",void 0),(0,r._)([(0,o.Pi)(d.b)],Vt.prototype,"mosaicInfo",void 0),(0,r._)([o.E8],Vt.prototype,"textRenderPassType",void 0),(0,r._)([o.E8],Vt.prototype,"isBackgroundPass",void 0),(0,r._)([o.E8],Vt.prototype,"isLabel",void 0),(0,r._)([(0,r.a)(0,(0,o.hF)(kt)),(0,r.a)(1,(0,o.hF)(Nt))],Vt.prototype,"vertex",null),(0,r._)([(0,r.a)(0,(0,o.hF)(Bt))],Vt.prototype,"fragment",null);var Ut=i(59224),Gt=i(13520),Yt=i(2014);class Wt extends Ut.Xc{}(0,r._)([(0,o.C5)(9,a.nt)],Wt.prototype,"accumulatedDistance",void 0),(0,r._)([(0,o.C5)(10,a.ZY)],Wt.prototype,"segmentDirection",void 0),(0,r._)([(0,o.C5)(11,a.nt)],Wt.prototype,"offsetAlongLine",void 0),(0,r._)([(0,o.C5)(12,a.nt)],Wt.prototype,"capType",void 0),(0,r._)([(0,o.C5)(13,a.Zb)],Wt.prototype,"tlbr",void 0);class Ht extends Ut.cM{_getDistanceRatio(t,e){const i=(0,f.mh)(t.bitset,h.kx);return i.multiply((0,a.T9)(e,new a.nt(.25)).multiply(new a.nt(2))).add(new a.nt(1).subtract(i).multiply((0,Gt.Lz)(1)))}_getSDFAlpha(t){const{halfWidth:e,normal:i,tlbr:n,patternSize:r,accumulatedDistance:s,offsetAlongLine:o,dashToPx:l,capType:c}=t,u=r.x.divide(Yt.zA).multiply(l),h=(0,a.jc)(s.add(o).divide(u)),d=(0,a.jh)(n.xy,n.zw,new a.ZY(h,.5)),p=(0,f.Rj)((0,a.US)(this.mosaicInfo.texture,d)).multiply(2).subtract(1).multiply(Yt.gR).multiply(l),_=i.y.multiply(e),m=(0,a.j1)([(0,a.LC)(c,new a.nt(1)),p.subtract(e)],[(0,a.LC)(c,new a.nt(2)),(0,a.RZ)((0,a.n7)((0,a.T9)(p,new a.nt(0)),new a.nt(2)).add(_.multiply(_))).subtract(e)],[!0,p]),g=(0,a.qE)(new a.nt(.25).subtract(m),new a.nt(0),new a.nt(1));return new a.Zb(g)}_getPatternColor(t){const{halfWidth:e,normal:i,color:n,accumulatedDistance:r,patternSize:s,sampleAlphaOnly:o,tlbr:l}=t,c=s.y.multiply(new a.nt(2).multiply(e).divide(s.x)),u=(0,a.jc)(r.divide(c)),h=new a.nt(.5).multiply(i.y).add(new a.nt(.5)),d=(0,a.jh)(l.xy,l.zw,new a.ZY(h,u));let f=(0,a.US)(this.mosaicInfo.texture,d);return null!=this.visualVariableColor&&(f=(0,a.Tk)((0,a.MM)(o,new a.nt(.5)),new a.Zb(n.a),n)),f}vertex(t,e){const{segmentDirection:i,tlbr:n,bitset:r}=t,s=(0,Ut.$0)(this,t),o=t.accumulatedDistance.divide(this.view.displayZoomFactor).add((0,a.Om)(i,s.scaledOffset)),l=new a.ZY(n.z.subtract(n.x),n.w.subtract(n.y)),c=n.divide(this.mosaicInfo.size.xyxy),u=(0,f.mh)(r,h.b5),d=(0,f.mh)(r,h.cn),p=(0,a.Tk)((0,a.MM)(u,new a.nt(.5)),this._getDistanceRatio(t,s.scaledHalfWidth),new a.nt(1));return{...s,tlbr:c,patternSize:l,accumulatedDistance:o,isSDF:u,sampleAlphaOnly:d,dashToPx:p,offsetAlongLine:t.offsetAlongLine,capType:t.capType,...this.maybeRunHittest(t,e,s.halfWidth)}}fragment(t){const{color:e,opacity:i,isSDF:n}=t,r=(0,Ut.xw)(t,this.antialiasingControls.blur),s=(0,a.Tk)((0,a.MM)(n,new a.nt(.5)),this._getSDFAlpha(t),this._getPatternColor(t)),o=e.multiply(i).multiply(r).multiply(s);return this.getFragmentOutput(o,t)}}(0,r._)([(0,o.Pi)(d.b)],Ht.prototype,"mosaicInfo",void 0),(0,r._)([(0,r.a)(0,(0,o.hF)(Wt)),(0,r.a)(1,(0,o.hF)(u.$Z))],Ht.prototype,"vertex",null);class Zt extends u.rz{}(0,r._)([(0,o.C5)(3,a.Zb)],Zt.prototype,"color",void 0),(0,r._)([(0,o.C5)(4,a.Zb)],Zt.prototype,"outlineColor",void 0),(0,r._)([(0,o.C5)(5,a.ZY)],Zt.prototype,"offset",void 0),(0,r._)([(0,o.C5)(6,a.ZY)],Zt.prototype,"textureUV",void 0),(0,r._)([(0,o.C5)(7,a.Zb)],Zt.prototype,"sizing",void 0),(0,r._)([(0,o.C5)(8,a.nt)],Zt.prototype,"placementAngle",void 0),(0,r._)([(0,o.C5)(9,a.nt)],Zt.prototype,"sdfDecodeCoeff",void 0),(0,r._)([(0,o.C5)(10,a.ZY)],Zt.prototype,"zoomRange",void 0);class qt extends o.Y7{}(0,r._)([(0,o.C5)(12,a.ZY)],qt.prototype,"offsetNextVertex1",void 0),(0,r._)([(0,o.C5)(13,a.ZY)],qt.prototype,"offsetNextVertex2",void 0),(0,r._)([(0,o.C5)(14,a.ZY)],qt.prototype,"textureUVNextVertex1",void 0),(0,r._)([(0,o.C5)(15,a.ZY)],qt.prototype,"textureUVNextVertex2",void 0);class $t extends u.DM{}function jt(t,e,i,n){return e.multiply(t.x).add(i.multiply(t.y)).add(n.multiply(t.z))}function Xt(t){return t.multiply(t).divide(128)}class Kt extends u.f_{constructor(){super(...arguments),this.computeAttributes={offset:["offsetNextVertex1","offsetNextVertex2"],textureUV:["textureUVNextVertex1","textureUVNextVertex2"]}}vertex(t,e){const i=Xt(t.sizing.x),n=Xt(t.sizing.y),r=Xt(t.sizing.z),s=t.placementAngle,o=(0,f.mh)(t.bitset,A.c.bitset.isSDF),l=(0,f.mh)(t.bitset,A.c.bitset.isMapAligned),c=(0,f.mh)(t.bitset,A.c.bitset.scaleSymbolsProportionally),u=(0,f.K5)(t.bitset,A.c.bitset.colorLocked),d=(0,S.cF)(this,t.id),p=(0,S.G7)(this,t.id,t.color,u).multiply(d),_=this.view.displayViewScreenMat3.multiply(new a.eB(t.pos.xy,1)),m=(0,S.Mg)(this,t.id,r).divide(r),g=i.multiply(m),y=t.offset.xy.multiply(m);let v=n.multiply(c.multiply(m.subtract(1)).add(1));v=(0,a.jk)(v,(0,a.T9)(g.subtract(.99),new a.nt(0)));const x=(0,a.T9)(v,new a.nt(1)),b=(0,a.jk)(v,new a.nt(1)),w=a.U.fromRotation(s.multiply(h.rp)),T=(0,S.TL)(this,t.id),M=this._getViewRotationMatrix(l).multiply(T).multiply(w).multiply(new a.eB(y.xy,0)),P=this.clip(t.id,t.zoomRange),C=new a.Zb(_.xy.add(M.xy),P,1),I=t.textureUV.divide(this.mosaicInfo.size),E=t.outlineColor.multiply(b),R=(0,f.mh)(t.bitset,A.c.bitset.overrideOutlineColor),O=t.sdfDecodeCoeff.multiply(g);return{glPosition:C,color:p,textureUV:I,outlineColor:E,outlineSize:x,distanceToPx:O,isSDF:o,overrideOutlineColor:R,...this.maybeRunHittest(t,e,{pos:t.pos,size:g,sizeCorrection:m,isMapAligned:l,vvRotationMat3:T,placementMat3:w,outlineSize:x,distanceToPx:O,isSDF:o})}}fragment(t){const e=this._getColor(t.textureUV,t);return this.getFragmentOutput(e,t)}hittest(t,e,i){return(0,a.Tk)((0,a.Xe)(i.size,this.hittestRequest.smallSymbolSizeThreshold),this._hittestSmallMarker(t,e,i),this._hittestMarker(t,e,i))}_getViewRotationMatrix(t){const e=this.view.displayViewMat3,i=this.view.displayMat3,n=new a.nt(1).subtract(t);return e.multiply(t).add(i.multiply(n))}_getViewScreenMatrix(t){const e=this.view.viewMat3.multiply(this.view.tileMat3),i=this.view.tileMat3,n=new a.nt(1).subtract(t);return e.multiply(t).add(i.multiply(n))}_getColor(t,e){return(0,a.Tk)((0,a.LC)(e.isSDF,new a.nt(1)),this._getSDFColor(t,e),this._getSpriteColor(t,e))}_getSpriteColor(t,e){return(0,a.US)(this.mosaicInfo.texture,t).multiply(e.color)}_getSDFColor(t,e){const i=(0,a.US)(this.mosaicInfo.texture,t),n=new a.nt(.5).subtract((0,f.Rj)(i)).multiply(e.distanceToPx).multiply(h.V5),r=(0,a.qE)(new a.nt(.5).subtract(n),new a.nt(0),new a.nt(1)),s=e.color.multiply(r);let o=e.outlineSize;this.highlight&&(o=(0,a.T9)(o,e.overrideOutlineColor.multiply(4)));const l=o.multiply(.5),c=(0,a.tn)(n).subtract(l),u=(0,a.qE)(new a.nt(.5).subtract(c),new a.nt(0),new a.nt(1)),d=(0,a.jh)(e.outlineColor,e.color,e.overrideOutlineColor).multiply(u);return new a.nt(1).subtract(d.a).multiply(s).add(d)}_hittestSmallMarker(t,e,i){const{position:n,distance:r,smallSymbolDistance:s}=this.hittestRequest,o=r.subtract(s),{viewMat3:l,tileMat3:c}=this.view,u=l.multiply(c).multiply(new a.eB(i.pos,1)).xy,h=i.size.multiply(.5);return(0,a.Io)(u,n).subtract(h).add(o)}_hittestMarker(t,e,i){const{pos:n,sizeCorrection:r,isMapAligned:s}=i,o=new a.eB(t.offset.multiply(r),0),l=new a.eB(e.offsetNextVertex1.multiply(r),0),c=new a.eB(e.offsetNextVertex2.multiply(r),0),{viewMat3:u,tileMat3:h}=this.view,d=u.multiply(h).multiply(new a.eB(n,1)),f=this._getViewScreenMatrix(s).multiply(i.vvRotationMat3).multiply(i.placementMat3),p=d.add(f.multiply(o)).xy,_=d.add(f.multiply(l)).xy,m=d.add(f.multiply(c)).xy,g=this.hittestRequest.position,y=this.hittestRequest.distance,v=(0,C.Bo)(g,p,_,m);return(0,a.Tk)((0,a.MM)(v,y),v,this._hittestSamples(p,_,m,t,e,i))}_hittestSamples(t,e,i,n,r,s){const{outlineSize:o,isSDF:l,distanceToPx:c}=s,u=this.hittestRequest.position,h=this.hittestRequest.distance,d=(0,C.Bs)(u.add(new a.ZY((0,a.ze)(h),(0,a.ze)(h))),t,e,i),f=(0,C.Bs)(u.add(new a.ZY(0,(0,a.ze)(h))),t,e,i),p=(0,C.Bs)(u.add(new a.ZY(h,(0,a.ze)(h))),t,e,i),_=(0,C.Bs)(u.add(new a.ZY((0,a.ze)(h),0)),t,e,i),m=(0,C.Bs)(u,t,e,i),g=(0,C.Bs)(u.add(new a.ZY(h,0)),t,e,i),y=(0,C.Bs)(u.add(new a.ZY((0,a.ze)(h),h)),t,e,i),v=(0,C.Bs)(u.add(new a.ZY(0,h)),t,e,i),x=(0,C.Bs)(u.add(new a.ZY(h,h)),t,e,i),b=n.textureUV.divide(this.mosaicInfo.size),S=r.textureUVNextVertex1.divide(this.mosaicInfo.size),w=r.textureUVNextVertex2.divide(this.mosaicInfo.size),T={color:new a.Zb(1),outlineColor:new a.Zb(1),overrideOutlineColor:new a.nt(1),outlineSize:o,distanceToPx:c,isSDF:l};let M=new a.nt(0);return M=M.add((0,C.kW)(d).multiply(this._getColor(jt(d,b,S,w),T).a)),M=M.add((0,C.kW)(f).multiply(this._getColor(jt(f,b,S,w),T).a)),M=M.add((0,C.kW)(p).multiply(this._getColor(jt(p,b,S,w),T).a)),M=M.add((0,C.kW)(_).multiply(this._getColor(jt(_,b,S,w),T).a)),M=M.add((0,C.kW)(m).multiply(this._getColor(jt(m,b,S,w),T).a)),M=M.add((0,C.kW)(g).multiply(this._getColor(jt(g,b,S,w),T).a)),M=M.add((0,C.kW)(y).multiply(this._getColor(jt(y,b,S,w),T).a)),M=M.add((0,C.kW)(v).multiply(this._getColor(jt(v,b,S,w),T).a)),M=M.add((0,C.kW)(x).multiply(this._getColor(jt(x,b,S,w),T).a)),(0,a.PM)(M,new a.nt(.05)).multiply((0,C.My)(this.hittestRequest))}}(0,r._)([(0,o.uK)(p._)],Kt.prototype,"visualVariableColor",void 0),(0,r._)([(0,o.uK)(_.i)],Kt.prototype,"visualVariableOpacity",void 0),(0,r._)([(0,o.uK)(m)],Kt.prototype,"visualVariableRotation",void 0),(0,r._)([(0,o.uK)(y.n)],Kt.prototype,"visualVariableSizeMinMaxValue",void 0),(0,r._)([(0,o.uK)(v.F)],Kt.prototype,"visualVariableSizeScaleStops",void 0),(0,r._)([(0,o.uK)(x.N)],Kt.prototype,"visualVariableSizeStops",void 0),(0,r._)([(0,o.uK)(b.d)],Kt.prototype,"visualVariableSizeUnitValue",void 0),(0,r._)([(0,o.Pi)(d.b)],Kt.prototype,"mosaicInfo",void 0),(0,r._)([(0,r.a)(0,(0,o.hF)(Zt)),(0,r.a)(1,(0,o.hF)(qt))],Kt.prototype,"vertex",null),(0,r._)([(0,r.a)(0,(0,o.hF)($t))],Kt.prototype,"fragment",null);var Qt=i(50944),Jt=i(22516);class te{constructor(){this.computeAttributes={}}get locationsMap(){const t=new Map;for(const e in this.locations)t.set(e,this.locations[e].index);return t}get optionPropertyKeys(){if(!this._optionPropertyKeys){const t=new Set(Object.keys(this.options));this._optionPropertyKeys=t}return this._optionPropertyKeys}get _transformFeedbackBindings(){return[]}get locationInfo(){if(!this._locationInfo){const t=this.locationsMap,e=Array.from(t.entries()).map((([t,e])=>`${t}.${e}`)).join("."),i=(0,Qt.Wm)(e);this._locationInfo={hash:i,locations:t,computeAttributeMap:this.computeAttributes}}return this._locationInfo}get renamedLocationsMap(){const t=new Map;for(const[e,i]of this.locationsMap.entries())t.set("a_"+e,i);return t}getShaderKey(t,e,i){return`${Object.keys(t).map((e=>`${e}.${t[e]}`)).join(".")}.${Object.keys(i).filter((t=>i[t])).map((t=>`${t}_${i[t].toString()}`)).join(".")}.${Object.keys(e).filter((t=>this.optionPropertyKeys.has(t))).join(".")}`}getProgram(t,e,i,n){let r="",s="";for(const t in i)if(i[t]){const e="boolean"==typeof i[t]?`#define ${t}\n`:`#define ${t} ${i[t]}\n`;r+=e,s+=e}return r+=this.vertexShader,s+=this.fragmentShader,new Jt.K(r,s,this.renamedLocationsMap,this.locationInfo,this._getUniformBindings(e),this._transformFeedbackBindings)}_getUniformBindings(t){const e=[];for(const t in this.required){const i=this.required[t];e.push({uniformHydrated:null,shaderModulePath:t,uniformName:t,uniformType:i.type,uniformArrayElementType:ee(i),uniformArrayLength:ie(i)})}for(const i in t){const n=this.options[i];if(t[i])for(const t in n){const r=n[t];e.push({uniformHydrated:null,shaderModulePath:`${i}.${t}`,uniformName:t,uniformType:r.type,uniformArrayElementType:ee(r),uniformArrayLength:ie(r)})}}return e}}const ee=t=>"array"===t.type?t.elementType?.type:void 0,ie=t=>"array"===t.type?t.size:void 0;var ne=i(44723);const re={hittestDist:a.nt,hittestPos:a.ZY},se={filterFlags:a.z7,animation:a.z7,visualVariableData:a.z7,dataDriven0:a.z7,dataDriven1:a.z7,dataDriven2:a.z7,gpgpu:a.z7,size:a.nt},oe={displayViewScreenMat3:a.U,displayViewMat3:a.U,displayMat3:a.U,viewMat3:a.U,tileMat3:a.U,displayZoomFactor:a.nt,requiredZoomFactor:a.nt,tileOffset:a.ZY,currentScale:a.nt,currentZoom:a.nt,metersPerSRUnit:a.nt};class ae extends te{constructor(){super(...arguments),this.vertexShader=(0,ne.Q)("materials/pie/pie.vert"),this.fragmentShader=(0,ne.Q)("materials/pie/pie.frag"),this.required={...se,...oe,outlineWidth:a.nt,colors:a.My,defaultColor:a.Zb,othersColor:a.Zb,outlineColor:a.Zb,donutRatio:a.nt,sectorThreshold:a.nt},this.options={hittestUniforms:re,visualVariableSizeMinMaxValue:{minMaxValueAndSize:a.Zb},visualVariableSizeScaleStops:{sizes:{...a.My.ofType(a.nt,8),type:"array",elementType:a.nt,size:8},values:{...a.My.ofType(a.nt,8),type:"array",elementType:a.nt,size:8}},visualVariableSizeStops:{sizes:{...a.My.ofType(a.nt,8),type:"array",elementType:a.nt,size:8},values:{...a.My.ofType(a.nt,8),type:"array",elementType:a.nt,size:8}},visualVariableSizeUnitValue:{unitValueToPixelsRatio:a.nt},visualVariableOpacity:{opacities:{...a.My.ofType(a.nt,8),type:"array",elementType:a.nt,size:8},opacityValues:{...a.My.ofType(a.nt,8),type:"array",elementType:a.nt,size:8}}},this.locations={pos:{index:0,type:a.ZY},id:{index:1,type:a.eB},bitset:{index:2,type:a.nt},offset:{index:3,type:a.ZY},texCoords:{index:4,type:a.ZY},size:{index:5,type:a.ZY},referenceSize:{index:6,type:a.nt},zoomRange:{index:7,type:a.ZY}},this.defines={VV_SIZE_MIN_MAX_VALUE:"boolean",VV_SIZE_SCALE_STOPS:"boolean",VV_SIZE_FIELD_STOPS:"boolean",VV_SIZE_UNIT_VALUE:"boolean",VV_OPACITY:"boolean",HITTEST:"boolean",numberOfFields:"number",highlight:"boolean",inside:"boolean",outside:"boolean"}}setNumberOfFields(t){this.required.colors={...a.My.ofType(a.Zb,t),type:"array",elementType:a.Zb,size:t}}}const le={fill:new class extends k{constructor(){super(...arguments),this.type=n.N.Fill,this.shaders={geometry:new lt.z}}render(t,e){const{painter:i}=t,n=e.instance.getInput();i.setShader({shader:this.shaders.geometry,uniforms:{...(0,N.r3)(t,e.target,n.uniforms),...(0,N.QA)(t,e.target)},defines:(0,N.vT)(t),optionalAttributes:n.optionalAttributes,useComputeBuffer:(0,N.Eq)(t)}),i.setPipelineState((0,N.Qu)(t)),i.submitDraw(t,e)}},patternFill:new class extends k{constructor(){super(...arguments),this.type=n.N.PatternFill,this.shaders={geometry:new ft.vx}}render(t,e){const{context:i,painter:n}=t,r=e.instance.getInput();n.setShader({shader:this.shaders.geometry,uniforms:{...(0,N.r3)(t,e.target,r.uniforms),...(0,N.QA)(t,e.target),mosaicInfo:n.textureManager.getMosaicInfo(i,e.textureKey),localTileOffset:(0,N.Pr)(e.target)},defines:{...(0,N.vT)(t)},optionalAttributes:r.optionalAttributes,useComputeBuffer:(0,N.Eq)(t)}),n.setPipelineState((0,N.Qu)(t)),n.submitDraw(t,e)}},complexFill:new class extends k{constructor(){super(...arguments),this.type=n.N.ComplexFill,this.shaders={geometry:new ct.Ps}}render(t,e){const{context:i,painter:n}=t,r=e.instance.getInput();n.setShader({shader:this.shaders.geometry,uniforms:{...(0,N.r3)(t,e.target,r.uniforms),...(0,N.QA)(t,e.target),mosaicInfo:n.textureManager.getMosaicInfo(i,e.textureKey),localTileOffset:(0,N.Pr)(e.target)},defines:{...(0,N.vT)(t)},optionalAttributes:r.optionalAttributes,useComputeBuffer:(0,N.Eq)(t)}),n.setPipelineState((0,N.Qu)(t)),n.submitDraw(t,e)}},outlineFill:new class extends k{constructor(){super(...arguments),this.type=n.N.OutlineFill,this.shaders={geometry:new dt.nj}}render(t,e){const{painter:i,pixelRatio:n}=t,r=e.instance.getInput();i.setShader({shader:this.shaders.geometry,uniforms:{...(0,N.r3)(t,e.target,r.uniforms),...(0,N.QA)(t,e.target),antialiasingControls:ut(n)},defines:{...(0,N.vT)(t)},optionalAttributes:r.optionalAttributes,useComputeBuffer:(0,N.Eq)(t)}),i.setPipelineState((0,N.Qu)(t)),i.submitDraw(t,e)}},patternOutlineFill:new class extends k{constructor(){super(...arguments),this.type=n.N.PatternOutlineFill,this.shaders={geometry:new pt.tA}}render(t,e){const{context:i,painter:n,pixelRatio:r}=t,s=e.instance.getInput();n.setShader({shader:this.shaders.geometry,uniforms:{...(0,N.r3)(t,e.target,s.uniforms),...(0,N.QA)(t,e.target),antialiasingControls:ut(r),mosaicInfo:n.textureManager.getMosaicInfo(i,e.textureKey),localTileOffset:(0,N.Pr)(e.target)},defines:{...(0,N.vT)(t)},optionalAttributes:s.optionalAttributes,useComputeBuffer:(0,N.Eq)(t)}),n.setPipelineState((0,N.Qu)(t)),n.submitDraw(t,e)}},complexOutlineFill:new class extends k{constructor(){super(...arguments),this.type=n.N.ComplexOutlineFill,this.shaders={geometry:new ht.RH}}render(t,e){const{context:i,painter:n,pixelRatio:r}=t,s=e.instance.getInput();n.setShader({shader:this.shaders.geometry,uniforms:{...(0,N.r3)(t,e.target,s.uniforms),...(0,N.QA)(t,e.target),antialiasingControls:ut(r),mosaicInfo:n.textureManager.getMosaicInfo(i,e.textureKey),localTileOffset:(0,N.Pr)(e.target)},defines:{...(0,N.vT)(t)},optionalAttributes:s.optionalAttributes,useComputeBuffer:(0,N.Eq)(t)}),n.setPipelineState((0,N.Qu)(t)),n.submitDraw(t,e)}},marker:new class extends k{constructor(){super(...arguments),this.type=n.N.Marker,this.shaders={geometry:new Kt},this.symbologyPlane=D.uC.MARKER}render(t,e){const{context:i,painter:n}=t,r=e.instance.getInput();n.setShader({shader:this.shaders.geometry,uniforms:{...(0,N.r3)(t,e.target,r.uniforms),...(0,N.QA)(t,e.target),mosaicInfo:n.textureManager.getMosaicInfo(i,e.textureKey,!0)},defines:{...(0,N.vT)(t)},optionalAttributes:r.optionalAttributes,useComputeBuffer:(0,N.Eq)(t)}),n.setPipelineState((0,N.Qu)(t)),n.submitDraw(t,e)}},pieChart:new class extends k{constructor(){super(...arguments),this.type=n.N.PieChart,this.shaders={geometry:new ae},this.symbologyPlane=D.uC.MARKER}render(t,e){const{painter:i}=t,{instance:n,target:r}=e,s=this.shaders.geometry,o=n.getInput(),a=o.uniforms.numberOfFields,l=(0,N.Eq)(t),c=(0,N.QA)(t,r),u=(0,N.vT)(t);s.setNumberOfFields(a),i.setShader({shader:s,uniforms:{...(0,N.r3)(t,e.target,o.uniforms.shader),...c.storage,...c.view,hittestUniforms:c.hittestRequest?{hittestDist:c.hittestRequest?.distance,hittestPos:c.hittestRequest?.position}:null},defines:{VV_SIZE_MIN_MAX_VALUE:!!o.uniforms.shader.visualVariableSizeMinMaxValue,VV_SIZE_SCALE_STOPS:!!o.uniforms.shader.visualVariableSizeScaleStops,VV_SIZE_FIELD_STOPS:!!o.uniforms.shader.visualVariableSizeStops,VV_SIZE_UNIT_VALUE:!!o.uniforms.shader.visualVariableSizeUnitValue,VV_OPACITY:!!o.uniforms.shader.visualVariableOpacity,HITTEST:l,highlight:c.highlight?1:0,...u,numberOfFields:a},optionalAttributes:{},useComputeBuffer:l}),i.setPipelineState((0,N.Qu)(t)),i.submitDraw(t,e)}},line:new class extends k{constructor(){super(...arguments),this.type=n.N.Line,this.shaders={geometry:new Ut.cM},this.symbologyPlane=D.uC.LINE}render(t,e){const{painter:i,pixelRatio:n}=t,r=e.instance.getInput();i.setShader({shader:this.shaders.geometry,uniforms:{...(0,N.r3)(t,e.target,r.uniforms),...(0,N.QA)(t,e.target),antialiasingControls:ut(n)},defines:{...(0,N.vT)(t)},optionalAttributes:r.optionalAttributes,useComputeBuffer:(0,N.Eq)(t)}),i.setPipelineState((0,N.Qu)(t)),i.submitDraw(t,e)}},texturedLine:new class extends k{constructor(){super(...arguments),this.type=n.N.TexturedLine,this.shaders={geometry:new Ht},this.symbologyPlane=D.uC.LINE}render(t,e){const{context:i,painter:n,pixelRatio:r}=t,s=e.instance.getInput();n.setShader({shader:this.shaders.geometry,uniforms:{...(0,N.r3)(t,e.target,s.uniforms),...(0,N.QA)(t,e.target),antialiasingControls:ut(r),mosaicInfo:n.textureManager.getMosaicInfo(i,e.textureKey)},defines:{...(0,N.vT)(t)},optionalAttributes:s.optionalAttributes,useComputeBuffer:(0,N.Eq)(t)}),n.setPipelineState((0,N.Qu)(t)),n.submitDraw(t,e)}},text:new class extends k{constructor(){super(...arguments),this.type=n.N.Text,this.shaders={geometry:new Vt},this.symbologyPlane=D.uC.TEXT}render(t,e){const{context:i,painter:n}=t,r=(0,N.vT)(t),s=e.instance.getInput(),o={shader:this.shaders.geometry,uniforms:{...(0,N.r3)(t,e.target,s.uniforms),...(0,N.QA)(t,e.target),mosaicInfo:n.textureManager.getMosaicInfo(i,e.textureKey)},defines:{...r,isBackgroundPass:!0,isLabel:!1,textRenderPassType:Lt.Color},optionalAttributes:s.optionalAttributes,useComputeBuffer:(0,N.Eq)(t)};n.setShader(o),n.setPipelineState((0,N.Qu)(t)),n.submitDraw(t,e),n.setShader({...o,defines:{...r,isBackgroundPass:!1,isLabel:!1,textRenderPassType:Lt.Halo}}),n.submitDraw(t,e),n.setShader({...o,defines:{...r,isBackgroundPass:!1,isLabel:!1,textRenderPassType:Lt.Outline}}),n.submitDraw(t,e),n.setShader({...o,defines:{...r,isBackgroundPass:!1,isLabel:!1,textRenderPassType:Lt.Color}}),n.submitDraw(t,e)}},label:new class extends k{constructor(){super(...arguments),this.type=n.N.Label,this.shaders={geometry:new Vt},this.drawPhase=D.S5.LABEL|D.S5.LABEL_ALPHA|D.S5.HITTEST,this.symbologyPlane=D.uC.TEXT}render(t,e){const{context:i,painter:n}=t,r=(0,N.vT)(t),s={...(0,N.Qu)(t)},o=e.instance.getInput(),a={shader:this.shaders.geometry,uniforms:{...(0,N.r3)(t,e.target,o.uniforms),...(0,N.QA)(t,e.target),mosaicInfo:n.textureManager.getMosaicInfo(i,e.textureKey)},defines:{...r,textRenderPassType:Lt.Color,isBackgroundPass:!0,isLabel:!0},optionalAttributes:o.optionalAttributes,useComputeBuffer:(0,N.Eq)(t)};n.setShader(a),n.setPipelineState(s),n.submitDraw(t,e),n.setShader({...a,defines:{...r,textRenderPassType:Lt.Halo,isBackgroundPass:!1,isLabel:!0}}),n.setPipelineState(s),n.submitDraw(t,e),n.setShader({...a,defines:{...r,textRenderPassType:Lt.Color,isBackgroundPass:!1,isLabel:!0}}),n.setPipelineState(s),n.submitDraw(t,e)}},heatmap:new class extends k{constructor(){super(...arguments),this.type=n.N.Heatmap,this.drawPhase=D.S5.MAP|D.S5.HITTEST|D.S5.DEBUG,this.shaders={accumulate:new Tt,resolve:new It},this._isBound=!1,this._resources=new Map}shutdown(t){super.shutdown(t),this._resources.get(t)?.destroy(),this._resources.delete(t),this._prevFBO=null,this._unbind()}render(t,e){const{context:i,painter:n,state:r}=t,s=e.instance.getInput(),{isFieldActive:o}=s.uniforms,a=this._getOrCreateResourcesRecord(i),l=a.loadQualityProfile(i);(0,N.Eq)(t)||this._bind(t,a,s),n.setShader({shader:this.shaders.accumulate,uniforms:{...(0,N.QA)(t,e.target),kernelControls:{radius:zt(s,r),isFieldActive:o?1:0}},defines:{...(0,N.vT)(t),...l.defines},optionalAttributes:{},useComputeBuffer:(0,N.Eq)(t)});const c=(0,N.Eq)(t)?Ot:Rt;n.setPipelineState(c),n.submitDraw(t,e)}getStencilReference(t){return Et(t)}renderResolvePass(t,e){if((0,N.Eq)(t))return;const{context:i,painter:n}=t,r=this._resources.get(i);if(null==this._prevFBO||null==this._prevViewport||!r?.initialized)return;const{defines:s}=r.loadQualityProfile(i),{minDensity:o,maxDensity:a,radius:l}=e.getInput().uniforms,c=r.accumulateFramebuffer,u=r.resolveGradientTexture,h={shader:this.shaders.resolve,uniforms:{accumulatedDensity:{texture:{unit:8,texture:c.colorTexture},minAndInvRange:[o,1/(a-o)],normalization:3/(l*l*Math.PI)},gradient:{texture:{unit:9,texture:u}}},defines:s,optionalAttributes:{},useComputeBuffer:!1};i.bindFramebuffer(this._prevFBO),i.setViewport(0,0,this._prevViewport.width,this._prevViewport.height),i.bindTexture(c.colorTexture,8),i.bindTexture(u,9),n.setPipelineState(Ft),n.submitDrawMesh(i,h,n.quadMesh),this._unbind()}_getOrCreateResourcesRecord(t){let e=this._resources.get(t);return null==e&&(e=new vt,this._resources.set(t,e)),e}_unbind(){this._prevFBO=null,this._prevViewport=null,this._isBound=!1}_bind(t,e,i){if(this._isBound)return;const{context:n,state:r,pixelRatio:s}=t,o=n.getBoundFramebufferObject(),a=n.getViewport();this._prevFBO=o,this._prevViewport=a;const{gradient:l,gradientHash:c}=i.uniforms;e.ensureResolveGradientTexture(n,c,l);const{width:u,height:h}=a,d=function(t,e){const i=e>1.5?.25:.5;return t<1/(2*i)?1:i}(zt(i,r),s),f=u*d,p=h*d,_=e.ensureAccumulateFBO(n,f,p);n.blitFramebuffer(o,_,0,0,o.width,o.height,0,0,_.width,_.height,tt.NV.STENCIL,tt.Cj.NEAREST),n.bindFramebuffer(_),n.setViewport(0,0,_.width,_.height),n.setColorMask(!0,!0,!0,!0),n.setClearColor(0,0,0,0),n.clear(tt.NV.COLOR),this._isBound=!0}},dotDensity:new class extends k{constructor(){super(...arguments),this.type=n.N.DotDensity,this.shaders={polygon:new K,point:new q,fill:new lt.z},this._resources=new Map}render(t,e){(0,N.dJ)(t)||(0,N.Eq)(t)?this._renderPolygons(t,e):this._renderDotDensity(t,e)}_renderPolygons(t,e){const{painter:i}=t;i.setShader({shader:this.shaders.fill,uniforms:{...(0,N.QA)(t,e.target),visualVariableColor:null,visualVariableOpacity:null},defines:{...(0,N.vT)(t)},optionalAttributes:{zoomRange:!1},useComputeBuffer:(0,N.Eq)(t)}),i.setPipelineState((0,N.Qu)(t)),i.submitDraw(t,e)}_renderDotDensity(t,e){const{context:i,painter:n,requiredLevel:r}=t,s=e.instance.getInput().uniforms,o=this._getOrCreateResourcesRecord(i),a=o.getDotDensityTextures(i,V.CQ,s.seed),l=1/2**(r-e.target.key.level),c=V.CQ,u=c*window.devicePixelRatio*c*window.devicePixelRatio,h=1/l*(1/l),d=s.dotScale?t.state.scale/s.dotScale:1,f=s.dotValue*d*h;n.setShader({shader:this.shaders.polygon,uniforms:{...(0,N.QA)(t,e.target),instance:{isActive:s.isActive,colors:s.colors,dotValue:Math.max(1,f)},draw:{dotTexture0:{unit:V.Cp,texture:a[0]},dotTexture1:{unit:V.vN,texture:a[1]},tileZoomFactor:l,pixelRatio:window.devicePixelRatio,tileDotsOverArea:u/(V.CQ*window.devicePixelRatio*V.CQ*window.devicePixelRatio)}},defines:{...(0,N.vT)(t),blending:s.blending},optionalAttributes:{},useComputeBuffer:!1});const p=i.getViewport();i.setViewport(0,0,V.CQ,V.CQ);const _=i.getBoundFramebufferObject(),m=o.getFBO(i);i.bindFramebuffer(m),i.setClearColor(0,0,0,0),i.clear(tt.NV.COLOR),n.setPipelineState({color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1}),n.updatePipelineState(i),n.submitDraw(t,e),i.bindFramebuffer(_),i.setViewport(p.x,p.y,p.width,p.height);const g=o.getFBO(i).colorTexture,y={shader:this.shaders.point,uniforms:{view:(0,N.L4)(t,e.target),instance:{dotSize:s.dotSize},draw:{locations:{unit:V.Cp,texture:g},tileZoomFactor:1,pixelRatio:window.devicePixelRatio}},defines:{...(0,N.vT)(t)},optionalAttributes:{},useComputeBuffer:!1};n.setPipelineState((0,N.Qu)(t)),n.submitDrawMesh(i,y,o.getDotDensityMesh(i,(0,U.V)(this.shaders.point)))}shutdown(t){super.shutdown(t),this._resources.get(t)?.destroy(),this._resources.delete(t)}_getOrCreateResourcesRecord(t){let e=this._resources.get(t);return null==e&&(e=new at,this._resources.set(t,e)),e}},animatedMarker:new class extends B{constructor(){super(...arguments),this.type=n.N.AnimatedMarker,this.shaders={geometry:new O}}}};function ce(){for(const t in le)le[t].startup()}function ue(t){for(const e in le)le[e].shutdown(t)}},81728:function(t,e,i){var n;i.d(e,{N:function(){return n}}),function(t){t[t.AnimatedMarker=0]="AnimatedMarker",t[t.Blend=1]="Blend",t[t.ComplexFill=2]="ComplexFill",t[t.ComplexOutlineFill=3]="ComplexOutlineFill",t[t.DotDensity=4]="DotDensity",t[t.Fill=5]="Fill",t[t.Grid=6]="Grid",t[t.Heatmap=7]="Heatmap",t[t.Label=8]="Label",t[t.Line=9]="Line",t[t.Magnifier=10]="Magnifier",t[t.Marker=11]="Marker",t[t.OutlineFill=12]="OutlineFill",t[t.Overlay=13]="Overlay",t[t.PatternFill=14]="PatternFill",t[t.PatternOutlineFill=15]="PatternOutlineFill",t[t.PieChart=16]="PieChart",t[t.Test=17]="Test",t[t.Text=18]="Text",t[t.TexturedLine=19]="TexturedLine"}(n||(n={}))},56791:function(t,e,i){i.d(e,{k:function(){return o}});var n=i(31654),r=i(85456);const s={createComputedParams:t=>t,optionalAttributes:{},attributes:{id:{type:r.pe.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:r.pe.UNSIGNED_BYTE,count:1},pos:{type:r.pe.SHORT,count:2,pack:"position",packPrecisionFactor:10},inverseArea:{type:r.pe.FLOAT,count:1,packTessellation:({inverseArea:t})=>t}}};class o extends n.N{constructor(){super(...arguments),this.vertexSpec=s}createTesselationParams(t){return{inverseArea:1/t.readGeometryArea()}}}},31654:function(t,e,i){i.d(e,{N:function(){return l}});var n=i(58941),r=i(81484),s=i(69825),o=i(54601);const a=(0,n.A)("featurelayer-fast-triangulation-enabled");class l extends o.r{async loadDependencies(){await Promise.all([super.loadDependencies(),(0,r.F)()])}_write(t,e,i){const n=i?.asOptimized()??e.readGeometryForDisplay(),r=this._clip(n);r&&(t.recordStart(this.instanceId,this.attributeLayout),this._writeGeometry(t,e,r),t.recordEnd())}_clip(t){if(!t)return null;const e=this.hasEffects;return(0,s.FE)(t,e?256:8)}_writeGeometry(t,e,i){const n=i.maxLength>100,r=[],o=this.createTesselationParams(e);if(!n&&a&&(0,s.lO)(r,i))return void(r.length&&this._writeVertices(t,e,i.coords,o,r));const l=(0,s.XZ)(i);this._writeVertices(t,e,l,o)}_writeVertices(t,e,i,n,r){const s=e.getDisplayId(),o=t.vertexCount(),a=this.hasEffects;let l=0;if(r)for(const e of r){const r=i[2*e],o=i[2*e+1];a&&t.recordBounds(r,o,0,0),this._writeVertex(t,s,r,o,n),l++}else for(let e=0;e<i.length;e+=2){const r=Math.round(i[e]),o=Math.round(i[e+1]);a&&t.recordBounds(r,o,0,0),this._writeVertex(t,s,r,o,n),l++}t.indexEnsureSize(l);for(let e=0;e<l;e++)t.indexWrite(e+o)}}},46869:function(t,e,i){i.d(e,{KE:function(){return d},KI:function(){return u},lB:function(){return h},oI:function(){return c}});var n=i(13520),r=i(7056),s=i(54417),o=i(83919),a=i(40846),l=i(85456);function c(t){const{sprite:e,aspectRatio:i,scaleProportionally:r}=t,s=(0,n.Lz)(t.height),o=s>0?s:e.height;let a=s*i;return a<=0?a=e.width:r&&(a*=e.width/e.height),{width:a,height:o}}function u(t){const{applyRandomOffset:e,sampleAlphaOnly:i}=t;return(0,s.xo)([[a.Fz,e],[a.cn,i]])}const h={createComputedParams:t=>t,optionalAttributes:o.l.optionalAttributes,attributes:{...o.l.attributes,bitset:{count:1,type:l.pe.UNSIGNED_BYTE,pack:u},width:{count:1,type:l.pe.HALF_FLOAT,pack:t=>c(t).width},height:{count:1,type:l.pe.HALF_FLOAT,pack:t=>c(t).height},offset:{count:2,type:l.pe.HALF_FLOAT,pack:({offsetX:t,offsetY:e})=>[(0,n.Lz)(t),-(0,n.Lz)(e)]},scale:{count:2,type:l.pe.UNSIGNED_BYTE,packPrecisionFactor:16,pack:({scaleX:t,scaleY:e})=>[t,e]},angle:{count:1,type:l.pe.UNSIGNED_BYTE,pack:({angle:t})=>(0,r.wV)(t)}}};class d extends o.m{constructor(){super(...arguments),this.vertexSpec=h}}},57413:function(t,e,i){i.d(e,{O:function(){return m}});var n=i(13520),r=i(33134),s=i(46869),o=i(54417),a=i(31859),l=i(47461),c=i(40846),u=i(85456);const h=s.lB,d=a.e4,f={createComputedParams:t=>t,optionalAttributes:h.optionalAttributes,attributes:{...h.attributes,bitset:{type:u.pe.UNSIGNED_BYTE,count:1,pack:t=>(0,s.KI)(t)},aux1:{count:1,type:u.pe.HALF_FLOAT,pack:t=>(0,s.oI)(t).width},aux2:{count:1,type:u.pe.HALF_FLOAT,pack:t=>(0,s.oI)(t).height},aux3:{count:2,type:u.pe.HALF_FLOAT,pack:({offsetX:t,offsetY:e})=>[(0,n.Lz)(t),(0,n.Lz)(e)]},aux4:{count:2,type:u.pe.UNSIGNED_BYTE,pack:({scaleX:t,scaleY:e})=>[t*l.cZ,e*l.cZ]}}},p={createComputedParams:t=>t,optionalAttributes:h.optionalAttributes,attributes:{...h.attributes,color:d.attributes.color,bitset:{type:u.pe.UNSIGNED_BYTE,count:1,pack:t=>(0,o.xo)([[c.Xx,!0]])},aux1:{count:1,type:u.pe.HALF_FLOAT,pack:t=>(0,n.Lz)(.5*t.width)},aux2:{count:1,type:u.pe.HALF_FLOAT,pack:t=>(0,n.Lz)(.5*t.referenceWidth)},aux3:{count:2,type:u.pe.HALF_FLOAT,packTessellation:({extrusionOffsetX:t,extrusionOffsetY:e})=>[t,e]},aux4:{count:2,type:u.pe.UNSIGNED_BYTE,packTessellation:({normalX:t,normalY:e})=>[t*l.cZ+l.v9,e*l.cZ+l.v9]}}};class _ extends a.eY{constructor(){super(...arguments),this.vertexSpec=p}}class m extends a.w0{constructor(){super(...arguments),this.vertexSpec=f}_createOutlineWriter(t,e,i,n){return new _(t,e,i,n)}_write(t,e,i){const n=i?.asOptimized()??e.readGeometryForDisplay(),s=this._clip(n);if(!s)return;const o=this.evaluatedMeshParams.sprite?.textureBinding;t.recordStart(this.instanceId,this.attributeLayout,o),this._writeGeometry(t,e,s),this._lineMeshWriter.writeLineVertices(t,r.z.fromOptimizedCIM(s,"esriGeometryPolyline"),e),t.recordEnd()}ensurePacked(t,e,i){super.ensurePacked(t,e,i),this._lineMeshWriter.ensurePacked(t,e,i)}enqueueRequest(t,e,i){super.enqueueRequest(t,e,i),this._lineMeshWriter.enqueueRequest(t,e,i)}async loadDependencies(){await Promise.all([super.loadDependencies(),this._lineMeshWriter.loadDependencies()])}}},28615:function(t,e,i){i.d(e,{Y:function(){return l},v:function(){return a}});var n=i(39686),r=i(31654),s=i(54417),o=i(85456);const a={createComputedParams:t=>t,optionalAttributes:{zoomRange:{type:o.pe.SHORT,count:2,packPrecisionFactor:n.fq,pack:({scaleInfo:t},{tileInfo:e})=>(0,s.My)(t,e)}},attributes:{id:{type:o.pe.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:o.pe.UNSIGNED_BYTE,count:1},pos:{type:o.pe.SHORT,count:2,pack:"position",packPrecisionFactor:10},color:{type:o.pe.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:t})=>(0,s.Jb)(t)}}};class l extends r.N{constructor(){super(...arguments),this.vertexSpec=a}createTesselationParams(t){return null}}},31859:function(t,e,i){i.d(e,{Lm:function(){return h},e4:function(){return d},eY:function(){return f},w0:function(){return p}});var n=i(33134),r=i(69825),s=i(28615),o=i(54417),a=i(67293),l=i(25731),c=i(40846),u=i(85456);const h={createComputedParams:t=>t,optionalAttributes:a.Eq.optionalAttributes,attributes:{...a.Eq.attributes,bitset:{type:u.pe.UNSIGNED_BYTE,count:1,pack:t=>0},color:{type:u.pe.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:t})=>(0,o.Jb)(t)}}},d={createComputedParams:t=>t,optionalAttributes:a.Eq.optionalAttributes,attributes:{...a.Eq.attributes,bitset:{type:u.pe.UNSIGNED_BYTE,count:1,pack:t=>(0,o.xo)([[c.Xx,!0]])},color:{type:u.pe.UNSIGNED_BYTE,count:4,normalized:!0,pack:({outlineColor:t})=>(0,o.Jb)(t)}}};class f extends a.Bw{constructor(){super(...arguments),this.vertexSpec=d}}class p extends s.Y{constructor(t,e,i,n){super(t,e,i,n),this.vertexSpec=h,this._lineMeshWriter=this._createOutlineWriter(t,e,i,n)}_createOutlineWriter(t,e,i,n){return new f(t,e,i,n)}_write(t,e,i){const r=i?.asOptimized()??e.readGeometryForDisplay(),s=this._clip(r);s&&(t.recordStart(this.instanceId,this.attributeLayout),this._writeGeometry(t,e,s),this._lineMeshWriter.writeLineVertices(t,n.z.fromOptimizedCIM(s,"esriGeometryPolyline"),e),t.recordEnd())}_clip(t){return t?(0,r.FE)(t,(0,l.Z0)(this.evaluatedMeshParams)):null}ensurePacked(t,e,i){super.ensurePacked(t,e,i),this._lineMeshWriter.ensurePacked(t,e,i)}enqueueRequest(t,e,i){super.enqueueRequest(t,e,i),this._lineMeshWriter.enqueueRequest(t,e,i)}async loadDependencies(){await Promise.all([super.loadDependencies(),this._lineMeshWriter.loadDependencies()])}}},83919:function(t,e,i){i.d(e,{l:function(){return o},m:function(){return a}});var n=i(39686),r=i(28615),s=i(85456);const o={createComputedParams:t=>t,optionalAttributes:r.v.optionalAttributes,attributes:{...r.v.attributes,tlbr:{count:4,type:s.pe.UNSIGNED_SHORT,pack:({sprite:t})=>{const{rect:e,width:i,height:r}=t,s=e.x+n.hM,o=e.y+n.hM;return[s,o,s+i,o+r]}},inverseRasterizationScale:{count:1,type:s.pe.BYTE,packPrecisionFactor:16,pack:({sprite:t})=>1/t.rasterizationScale}}};class a extends r.Y{constructor(){super(...arguments),this.vertexSpec=o}_write(t,e,i){const n=i?.asOptimized()??e.readGeometryForDisplay(),r=this._clip(n);if(!r)return;const s=this.evaluatedMeshParams.sprite?.textureBinding;t.recordStart(this.instanceId,this.attributeLayout,s),this._writeGeometry(t,e,r),t.recordEnd()}}},21099:function(t,e,i){i.d(e,{Q:function(){return c}});var n=i(33134),r=i(31859),s=i(83919);const o={optionalAttributes:s.l.optionalAttributes,createComputedParams:t=>t,attributes:{...s.l.attributes,...r.Lm.attributes}},a={optionalAttributes:s.l.optionalAttributes,createComputedParams:t=>t,attributes:{...s.l.attributes,...r.e4.attributes}};class l extends r.eY{constructor(){super(...arguments),this.vertexSpec=a}}class c extends r.w0{constructor(){super(...arguments),this.vertexSpec=o}_createOutlineWriter(t,e,i,n){return new l(t,e,i,n)}_write(t,e,i){const r=i?.asOptimized()??e.readGeometryForDisplay(),s=this._clip(r);if(!s)return;const o=this.evaluatedMeshParams.sprite?.textureBinding;t.recordStart(this.instanceId,this.attributeLayout,o),this._writeGeometry(t,e,s),this._lineMeshWriter.writeLineVertices(t,n.z.fromOptimizedCIM(s,"esriGeometryPolyline"),e),t.recordEnd()}ensurePacked(t,e,i){super.ensurePacked(t,e,i),this._lineMeshWriter.ensurePacked(t,e,i)}enqueueRequest(t,e,i){super.enqueueRequest(t,e,i),this._lineMeshWriter.enqueueRequest(t,e,i)}async loadDependencies(){await Promise.all([super.loadDependencies(),this._lineMeshWriter.loadDependencies()])}}},54417:function(t,e,i){i.d(e,{By:function(){return g},Jb:function(){return f},My:function(){return u},i8:function(){return m},mR:function(){return h},qE:function(){return _},ue:function(){return p},xo:function(){return d}});var n=i(52874),r=i(39819),s=i(40633),o=i(33389);const a=()=>s.A.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.meshWriterUtils"),l=0,c=100;function u(t,e){return[!!t?.minScale&&e.scaleToZoom(t.minScale)||l,!!t?.maxScale&&e.scaleToZoom(t.maxScale)||c]}function h(t){return 1<<t}function d(t){let e=0;for(const[i,n]of t)n&&(e|=1<<i);return e}function f(t){let e;if(!t)return[0,0,0,0];if("string"==typeof t){const i=n.A.fromString(t);if(!i)return a().errorOnce(new r.A("mapview:mesh-processing","Unable to parse string into color",{color:t})),[0,0,0,0];e=i.toArray()}else e=t;const[i,s,o,l]=e;return[i*(l/255),s*(l/255),o*(l/255),l]}function p(t){switch(t){case"butt":case o.uT.Butt:return o.xR.BUTT;case"round":case o.uT.Round:return o.xR.ROUND;case"square":case o.uT.Square:return o.xR.SQUARE}}function _(t){switch(t){case"bevel":case o.wd.Bevel:return o.JO.BEVEL;case"miter":case o.wd.Miter:return o.JO.MITER;case"round":case o.wd.Round:return o.JO.ROUND}}function m(t,e){return Math.round(Math.min(Math.sqrt(t*e),255))}function g(t,e){return Math.round(t*e)/e}},37463:function(t,e,i){i.d(e,{h:function(){return o}});var n=i(54601),r=i(85456);const s={createComputedParams:t=>t,optionalAttributes:{},attributes:{pos:{type:r.pe.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:r.pe.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:r.pe.UNSIGNED_BYTE,count:1},offset:{type:r.pe.BYTE,count:2,packAlternating:{count:4,pack:()=>[[-1,-1],[1,-1],[-1,1],[1,1]]}}}};class o extends n.r{constructor(){super(...arguments),this.vertexSpec=s}_write(t,e){t.recordStart(this.instanceId,this.attributeLayout);const i=e.getDisplayId();if("esriGeometryPoint"===e.geometryType){const n=e.readXForDisplay(),r=e.readYForDisplay();this._writeQuad(t,i,n,r)}else if("esriGeometryMultipoint"===e.geometryType){const n=e.readGeometryForDisplay();n?.forEachVertex(((e,n)=>{e>=0&&e<=512&&n>=0&&n<=512&&this._writeQuad(t,i,e,n)}))}t.recordEnd()}_writeQuad(t,e,i,n){const r=t.vertexCount();this._writeVertex(t,e,i,n),t.indexWrite(r+0),t.indexWrite(r+1),t.indexWrite(r+2),t.indexWrite(r+1),t.indexWrite(r+3),t.indexWrite(r+2)}}},67293:function(t,e,i){i.d(e,{Bw:function(){return _},Eq:function(){return f}});var n=i(13520),r=i(33134),s=i(39686),o=i(42542),a=i(69825),l=i(54417),c=i(54601),u=i(25731),h=i(85456);class d{constructor(){this.extrusionOffsetX=0,this.extrusionOffsetY=0,this.normalX=0,this.normalY=0,this.directionX=0,this.directionY=0,this.distance=0}}const f={createComputedParams:t=>t,optionalAttributes:{zoomRange:{type:h.pe.SHORT,count:2,packPrecisionFactor:s.fq,pack:({scaleInfo:t},{tileInfo:e})=>(0,l.My)(t,e)}},attributes:{id:{type:h.pe.UNSIGNED_BYTE,count:3,pack:"id"},pos:{type:h.pe.SHORT,count:2,pack:"position",packPrecisionFactor:10},bitset:{type:h.pe.UNSIGNED_BYTE,count:1},color:{type:h.pe.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:t})=>(0,l.Jb)(t)},offset:{type:h.pe.BYTE,count:2,packPrecisionFactor:16,packTessellation:({extrusionOffsetX:t,extrusionOffsetY:e})=>[(0,l.By)(t,16),(0,l.By)(e,16)]},normal:{type:h.pe.BYTE,count:2,packPrecisionFactor:16,packTessellation:({normalX:t,normalY:e})=>[(0,l.By)(t,16),(0,l.By)(e,16)]},halfWidth:{type:h.pe.HALF_FLOAT,count:1,pack:({width:t})=>(0,n.Lz)(.5*t)},referenceHalfWidth:{type:h.pe.HALF_FLOAT,count:1,pack:({referenceWidth:t})=>(0,n.Lz)(.5*t)}}};class p{constructor(){this.id=0,this.bitset=0,this.indexCount=0,this.vertexCount=0,this.vertexFrom=0,this.vertexBounds=0}}class _ extends c.r{constructor(t,e,i,n){super(t,e,i,n),this.vertexSpec=f,this._currentWrite=new p,this._tessellationOptions={halfWidth:0,pixelCoordRatio:1,offset:0,wrapDistance:65535,textured:!1},this._tessParams=new d,this._initializeTessellator()}writeLineVertices(t,e,i){const n=this._getLines(e);null!=n&&this._writeVertices(t,i,n)}_initializeTessellator(){this._lineTessellator=new o.i(this._writeTesselatedVertex.bind(this),this._writeTriangle.bind(this),!0)}_write(t,e,i){const n=i??r.z.fromFeatureSetReaderCIM(e);n&&this._writeGeometry(t,e,n)}_writeGeometry(t,e,i,n){t.recordStart(this.instanceId,this.attributeLayout,n),this.writeLineVertices(t,i,e),t.recordEnd()}_getLines(t){return(0,a.uS)(t,(0,u.Z0)(this.evaluatedMeshParams))}_writeVertices(t,e,i){const{_currentWrite:r,_tessellationOptions:o,evaluatedMeshParams:a}=this,{width:c,capType:u,joinType:h,miterLimit:d,hasSizeVV:f}=a,p=(0,n.Lz)(.5*c);o.halfWidth=p,o.capType=(0,l.ue)(u),o.joinType=(0,l.qE)(h),o.miterLimit=d;const _=!f;r.out=t,r.id=e.getDisplayId(),r.vertexCount=0,r.indexCount=0,r.vertexFrom=t.vertexCount(),r.vertexBounds=_&&p<s.Gh?0:1;for(const{line:t,start:e}of i)o.initialDistance=e%65535,this._lineTessellator.tessellate(t,o,_)}_writeTesselatedVertex(t,e,i,n,r,s,o,a,l,c,u){const{out:h,id:d,vertexBounds:f}=this._currentWrite;return this.hasEffects&&h.recordBounds(t,e,f,f),this._tessParams.extrusionOffsetX=o,this._tessParams.extrusionOffsetY=a,this._tessParams.normalX=l,this._tessParams.normalY=c,this._tessParams.directionX=r,this._tessParams.directionY=s,this._tessParams.distance=u,this._writeVertex(h,d,t,e,this._tessParams),this._currentWrite.vertexFrom+this._currentWrite.vertexCount++}_writeTriangle(t,e,i){const{out:n}=this._currentWrite;n.indexEnsureSize(3),n.indexWrite(t),n.indexWrite(e),n.indexWrite(i),this._currentWrite.indexCount+=3}}},63124:function(t,e,i){i.d(e,{K:function(){return d}});var n=i(13520),r=i(33134),s=i(33389),o=i(39686),a=i(54417),l=i(67293),c=i(40846),u=i(85456);const h={createComputedParams:t=>t,optionalAttributes:l.Eq.optionalAttributes,attributes:{...l.Eq.attributes,bitset:{type:u.pe.UNSIGNED_BYTE,count:1,pack:({shouldSampleAlphaOnly:t,shouldScaleDash:e,isSDF:i})=>(0,a.xo)([[c.cn,t],[c.kx,e],[c.b5,i]])},tlbr:{type:u.pe.UNSIGNED_SHORT,count:4,pack:({sprite:t})=>{const{rect:e,width:i,height:n}=t,r=e.x+o.hM,s=e.y+o.hM;return[r,s,r+i,s+n]}},accumulatedDistance:{type:u.pe.UNSIGNED_SHORT,count:1,packTessellation:({distance:t})=>t},segmentDirection:{type:u.pe.BYTE,count:2,packPrecisionFactor:16,packTessellation:({directionX:t,directionY:e})=>[t,e]},offsetAlongLine:{type:u.pe.HALF_FLOAT,count:1,pack:({offsetAlongLine:t})=>(0,n.Lz)(t)},capType:{type:u.pe.UNSIGNED_BYTE,count:1,pack:({capType:t})=>{switch(t){case s.uT.Butt:case"butt":return 0;case s.uT.Square:case"square":return 1;case s.uT.Round:case"round":return 2;default:return 0}}}}};class d extends l.Bw{constructor(t,e,i,n){super(t,e,i,n),this.vertexSpec=h,this._tessellationOptions.textured=!0}_write(t,e,i){const n=i??r.z.fromFeatureSetReaderCIM(e);if(!n)return;const{sprite:s}=this.evaluatedMeshParams;this._writeGeometry(t,e,n,s?.textureBinding)}}},82806:function(t,e,i){i.d(e,{H:function(){return b}});var n=i(13520),r=i(67348),s=i(10793),o=i(13786),a=i(33134),l=i(2014),c=i(33389),u=i(84646),h=i(39686),d=i(54417),f=i(7590);class p{static from(t){return"width"in t?this.fromSimpleMeshParams(t):this.fromComplexMeshParams(t)}static fromSimpleMeshParams(t){const e=new p(t.sprite,t.color,t.outlineColor,t.minPixelBuffer,t.placement,t.scaleInfo,t.effects),{type:i,width:r,height:s,angle:o,alignment:a,outlineSize:l,referenceSize:c,sprite:u,overrideOutlineColor:h}=t;return e.rawWidth=(0,n.Lz)(r),e.rawHeight=(0,n.Lz)(s),e.angle=o,e.alignment=a,e.outlineSize=(0,n.Lz)(l),e.referenceSize=(0,n.Lz)(c),e.overrideOutlineColor=h,e.offsetX=(0,n.Lz)(t.offsetX),e.offsetY=(0,n.Lz)(t.offsetY),"simple"!==i||u.sdf||(e.rawWidth=u.width,e.rawHeight=u.height),e._computeSize(t,!1),e}static fromComplexMeshParams(t){const e=new p(t.sprite,t.color,t.outlineColor,t.minPixelBuffer,t.placement,t.scaleInfo,t.effects);let{alignment:i,transforms:r,size:s,scaleX:o,anchorX:a,anchorY:l,angle:c,colorLocked:u,frameHeight:h,widthRatio:d,offsetX:_,offsetY:m,outlineSize:g,referenceSize:y,scaleFactor:v,sizeRatio:x,isAbsoluteAnchorPoint:b,rotateClockwise:S,scaleSymbolsProportionally:w,sprite:T}=t;if(r&&r.infos.length>0){const t=(0,f.zb)(s,c,S,_,m,r);s=t.size,c=t.rotation,_=t.offsetX,m=t.offsetY,S=!1}v&&(s*=v,_*=v,m*=v);const M=o*(T.width/T.height);e.alignment=i,e.rawHeight=(0,n.Lz)(s),e.rawWidth=e.rawHeight*M,e.referenceSize=(0,n.Lz)(y),e.sizeRatio=x,e.sdfDecodeCoeff=(T.sdfDecodeCoeff??1)*x,e.angle=c,e.rotateClockwise=S,e.anchorX=a,e.anchorY=l,e.offsetX=(0,n.Lz)(_),e.offsetY=(0,n.Lz)(m),b&&s&&(T.sdf?e.anchorX=a/(s*d):e.anchorX=a/(s*M),e.anchorY=l/s);const P=w&&h?s/h:1;return e.outlineSize=0===g||isNaN(g)?0:(0,n.Lz)(g)*P,e.scaleSymbolsProportionally=w,e.colorLocked=u,e._computeSize(t,!0),e}constructor(t,e,i,n,r,s,o){this.sprite=t,this.color=e,this.outlineColor=i,this.minPixelBuffer=n,this.placement=r,this.scaleInfo=s,this.effects=o,this.rawWidth=0,this.rawHeight=0,this.angle=0,this.outlineSize=0,this.referenceSize=0,this.sizeRatio=1,this.sdfDecodeCoeff=1,this.alignment=c.C1.SCREEN,this.scaleSymbolsProportionally=!1,this.overrideOutlineColor=!1,this.colorLocked=!1,this.anchorX=0,this.anchorY=0,this.computedWidth=0,this.computedHeight=0,this.texXmin=0,this.texYmin=0,this.texXmax=0,this.texYmax=0,this.offsetX=0,this.offsetY=0,this.rotateClockwise=!0}get boundsInfo(){return{size:Math.max(this.computedHeight,this.computedWidth),offsetX:this.offsetX,offsetY:this.offsetY}}_computeSize(t,e){const{sprite:i,hasSizeVV:n}=t,r=!!i.sdf,s=i.sdfPaddingRatio??.5,{rawWidth:o,rawHeight:a,sizeRatio:l,outlineSize:c}=this,u=l*(r?1/(1-s):1),d=o*u,f=a*u;if(r&&!n){const t=e&&o>a?d:o,i=a,n=c+2;this.computedWidth=Math.min(t+n,d),this.computedHeight=Math.min(i+n,f)}else this.computedWidth=d,this.computedHeight=f;const p=r?Math.max(i.width,i.height)/Math.max(d,f):1,_=.5*(d-this.computedWidth)*p,m=.5*(f-this.computedHeight)*p,g=i.rect.x+h.hM+_,y=i.rect.y+h.hM+m,v=g+i.width-2*_,x=y+i.height-2*m;this.texXmin=Math.floor(g),this.texYmin=Math.floor(y),this.texXmax=Math.ceil(v),this.texYmax=Math.ceil(x),this.computedWidth*=(this.texXmax-this.texXmin)/(v-g),this.computedHeight*=(this.texYmax-this.texYmin)/(x-y),this.anchorX*=d/this.computedWidth,this.anchorY*=f/this.computedHeight}}var _=i(97473),m=i(68758),g=i(54601),y=i(85456);const v=128/Math.PI;const x={createComputedParams:t=>p.from(t),optionalAttributes:{zoomRange:{type:y.pe.SHORT,count:2,packPrecisionFactor:h.fq,pack:({scaleInfo:t},{tileInfo:e})=>(0,d.My)(t,e)}},attributes:{pos:{type:y.pe.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:y.pe.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:y.pe.UNSIGNED_BYTE,count:1,pack:({sprite:t,alignment:e,scaleSymbolsProportionally:i,overrideOutlineColor:n,colorLocked:r})=>{let s=0;return t.sdf&&(s|=(0,d.mR)(_.c.bitset.isSDF)),e===c.C1.MAP&&(s|=(0,d.mR)(_.c.bitset.isMapAligned)),i&&(s|=(0,d.mR)(_.c.bitset.scaleSymbolsProportionally)),n&&(s|=(0,d.mR)(_.c.bitset.overrideOutlineColor)),r&&(s|=(0,d.mR)(_.c.bitset.colorLocked)),s}},offset:{type:y.pe.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:({angle:t,computedWidth:e,computedHeight:i,anchorX:n,anchorY:a,offsetX:l,offsetY:c,rotateClockwise:u})=>{const h=function(t,e,i,n,o=!1){const a=(0,s.vt)(),l=o?1:-1;return(0,r.D_)(a),(e||i)&&(0,r.Tl)(a,a,[e,-i]),n&&(0,r.e$)(a,a,.017453292519944444*l*-n),a}(0,l,c,-t,u),d=-(.5+n)*e,f=-(.5-a)*i,p=[d,f],_=[d+e,f],m=[d,f+i],g=[d+e,f+i];return(0,o.l0)(p,p,h),(0,o.l0)(_,_,h),(0,o.l0)(m,m,h),(0,o.l0)(g,g,h),[p,_,m,g]}}},textureUV:{type:y.pe.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:({texXmax:t,texXmin:e,texYmax:i,texYmin:n})=>[[e,n],[t,n],[e,i],[t,i]]}},color:{type:y.pe.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:t})=>(0,d.Jb)(t)},outlineColor:{type:y.pe.UNSIGNED_BYTE,count:4,normalized:!0,pack:({outlineColor:t})=>(0,d.Jb)(t)},sizing:{type:y.pe.UNSIGNED_BYTE,count:4,pack:({rawWidth:t,rawHeight:e,outlineSize:i,referenceSize:n})=>{const r=Math.max(t,e);return[(0,d.i8)(r,128),(0,d.i8)(i,128),(0,d.i8)(n,128),0]}},placementAngle:{type:y.pe.UNSIGNED_BYTE,count:1,packTessellation:({placementAngle:t})=>function(t){return function(t){return t%=256,Math.abs(t>=0?t:t+256)}(t*v)}(t)},sdfDecodeCoeff:{type:y.pe.UNSIGNED_SHORT,count:1,packPrecisionFactor:64,pack:({sdfDecodeCoeff:t})=>t}}};class b extends g.r{constructor(){super(...arguments),this.vertexSpec=x}getBoundsInfo(){return this.evaluatedMeshParams.boundsInfo}_write(t,e,i){const n=this.evaluatedMeshParams.sprite?.textureBinding,r=e.getDisplayId();t.recordStart(this.instanceId,this.attributeLayout,n);const s=this.evaluatedMeshParams.minPixelBuffer,o=Math.max(this.evaluatedMeshParams.computedWidth,s),a=Math.max(this.evaluatedMeshParams.computedHeight,s),c=-this.evaluatedMeshParams.anchorX*this.evaluatedMeshParams.computedWidth,u=this.evaluatedMeshParams.anchorY*this.evaluatedMeshParams.computedHeight,h=this.evaluatedMeshParams.offsetX+c,d=-this.evaluatedMeshParams.offsetY+u;if(null!=this.evaluatedMeshParams.placement)this._writePlacedMarkers(t,e,i,o,a);else if(i?.nextPath()){i.nextPoint();const e=i.x,n=i.y;t.recordBounds(e+h,n+d,o,a),this._writeQuad(t,r,e,n)}else if("esriGeometryPolygon"===e.geometryType){const i=e.readCentroidForDisplay();if(!i)return;const[n,s]=i.coords;t.recordBounds(n+h,s+d,o,a),this._writeQuad(t,r,n,s)}else if("esriGeometryPoint"===e.geometryType){const i=e.readXForDisplay(),n=e.readYForDisplay();t.recordBounds(i+h,n+d,o,a),this._writeQuad(t,r,i,n)}else{const i=e.readGeometryForDisplay();i?.forEachVertex(((e,i)=>{t.recordBounds(e+h,i+d,o,a),Math.abs(e)>l.$u||Math.abs(i)>l.$u||this._writeQuad(t,r,e,i)}))}t.recordEnd()}_writePlacedMarkers(t,e,i,r,s){const o=i??a.z.fromFeatureSetReaderCIM(e)?.clone();if(!o)return;const c=u.l.getPlacement(o,-1,this.evaluatedMeshParams.placement,(0,n.Lz)(1),t.id,(0,m.z)());if(!c)return;const h=e.getDisplayId();let d=c.next();const f=this.evaluatedMeshParams.offsetX,p=-this.evaluatedMeshParams.offsetY;for(;null!=d;){const e=d.tx,i=-d.ty;if(Math.abs(e)>l.$u||Math.abs(i)>l.$u){d=c.next();continue}const n=-d.getAngle();t.recordBounds(e+f,i+p,r,s),this._writeQuad(t,h,e,i,n),d=c.next()}}_writeQuad(t,e,i,n,r){const s=t.vertexCount(),o=null==r?null:{placementAngle:r};this._writeVertex(t,e,i,n,o),t.indexWrite(s+0),t.indexWrite(s+1),t.indexWrite(s+2),t.indexWrite(s+1),t.indexWrite(s+3),t.indexWrite(s+2)}}},97473:function(t,e,i){i.d(e,{c:function(){return n}});const n={bitset:{isSDF:0,isMapAligned:1,scaleSymbolsProportionally:2,overrideOutlineColor:3,colorLocked:4,isStroke:5}}},54601:function(t,e,i){i.d(e,{r:function(){return f}});var n=i(33134),r=i(47072),s=i(68758),o=i(85475),a=(i(58941),i(25731)),l=i(85456);function c(t){switch(t){case l.pe.BYTE:case l.pe.UNSIGNED_BYTE:return 1;case l.pe.SHORT:case l.pe.UNSIGNED_SHORT:case l.pe.HALF_FLOAT:return 2;case l.pe.FLOAT:case l.pe.INT:case l.pe.UNSIGNED_INT:return 4}}class u{static fromVertexSpec(t,e){const{attributes:i,optionalAttributes:n}=t;let r,s,o;const a=[];for(const t in i){const e=i[t];"position"===e.pack?r={...e,name:t,offset:0}:"id"===e.pack?s={...e,name:t,offset:4}:"bitset"===t?o={...e,name:t,offset:7}:a.push({...e,name:t})}for(const t in n)if(!0===e[t]){const e=n[t];a.push({...e,name:t})}const l=function(t){const e=[],i=[],n=[];for(const r of t){const t=c(r.type)*r.count;switch(t%2||t%4||4){case 4:e.push(r);continue;case 2:i.push(r);continue;case 1:n.push(r);continue;default:throw new Error("Found unexpected dataType byte count")}}return e.push(...i),e.push(...n),e}(a),h=[];let d=8,f=1;for(const t of l)h.push({...t,offset:d}),d+=c(t.type)*t.count,t.packAlternating&&(f=Math.max(t.packAlternating.count,f));const p=Uint32Array.BYTES_PER_ELEMENT,_=d%p;return new u(r,s,o,h,d+(_?p-_:0),f)}constructor(t,e,i,n,r,s){this.position=t,this.id=e,this.bitset=i,this.standardAttributes=n,this.stride=r,this.packVertexCount=s,n.push(i),this._attributes=[t,e,i,...n]}get attributeLayout(){if(!this._attributeLayout){const t=(0,a.hU)(this._attributes),e=this._attributes.map((t=>({name:t.name,count:t.count,offset:t.offset,type:t.type,packPrecisionFactor:t.packPrecisionFactor,normalized:t.normalized??!1})));this._attributeLayout={attributes:e,hash:t,stride:this.stride}}return this._attributeLayout}}var h=i(5544);class d{static fromVertexSpec(t,e){const i=u.fromVertexSpec(t,e);return new d(i)}constructor(t){this._spec=t,this._packed=new Uint8Array(this._spec.stride*this._spec.packVertexCount),this._packedU32View=new Uint32Array(this._packed.buffer),this._dataView=new DataView(this._packed.buffer)}get attributeLayout(){return this._spec.attributeLayout}get stride(){return this._spec.stride}writeVertex(t,e,i,n,r,s){for(let t=0;t<this._spec.packVertexCount;t++){const o=t*this._spec.stride;this._packPosition(i,n,o),this._packId(e,o);const a=this._spec.bitset;if(s){if(a.packTessellation){const t=a.packTessellation(s,r);this._pack(t,a,o)}for(const t of this._spec.standardAttributes)if(null!=t.packTessellation){const e=t.packTessellation(s,r);this._pack(e,t,o)}else if(t.packAlternating?.packTessellation){const e=t.packAlternating.packTessellation(s,r);for(let i=0;i<this._spec.packVertexCount;i++){const n=e[i];this._pack(n,t,i*this._spec.stride)}}}}t.vertexWriteRegion(this._packedU32View)}pack(t,e){for(const i of this._spec.standardAttributes)if(i.pack&&"string"!=typeof i.pack){const n=i.pack(t,e);for(let t=0;t<this._spec.packVertexCount;t++)this._pack(n,i,t*this._spec.stride)}else if(i.packAlternating?.pack){const n=i.packAlternating.pack(t,e);for(let t=0;t<this._spec.packVertexCount;t++){const e=n[t];this._pack(e,i,t*this._spec.stride)}}}_packPosition(t,e,i){const{offset:n}=this._spec.position,r=this._spec.position.packPrecisionFactor??1,s=(0,o.M9)(t*r,e*r);this._dataView.setUint32(i+n,s,!0)}_packId(t,e){const i=t*(this._spec.id.packPrecisionFactor??1),n=4278190080&this._dataView.getUint32(e+this._spec.id.offset,!0);this._dataView.setUint32(e+this._spec.id.offset,i|n,!0)}_pack(t,e,i){(0,h.F)(this._dataView,t,e,i)}}class f{constructor(t,e,i,n){this._instanceId=t,this._evaluator=e,this._enabledOptionalAttributes=i,this._viewParams=n,this._evaluator.evaluator=t=>this.vertexSpec.createComputedParams(t)}get _vertexPack(){if(!this._cachedVertexPack){const t=d.fromVertexSpec(this.vertexSpec,this._enabledOptionalAttributes);this._evaluator.hasDynamicProperties||t.pack(this._evaluator.evaluatedMeshParams,this._viewParams),this._cachedVertexPack=t}return this._cachedVertexPack}get evaluatedMeshParams(){return this._evaluator.evaluatedMeshParams}get hasEffects(){return!!this.evaluatedMeshParams.effects}get instanceId(){return this._instanceId}get attributeLayout(){return this._vertexPack.attributeLayout}setReferences(t){this._references=t}getBoundsInfo(){return null}getTileInfo(){return this._viewParams.tileInfo}async loadDependencies(){(function(t){if(!t)return!1;for(const e of t)switch(e.effect.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":case"CIMGeometricEffectDonut":return!0}return!1})(this._evaluator.inputMeshParams.effects?.effectInfos)&&await(0,s.R)()}enqueueRequest(t,e,i){this._evaluator.hasDynamicProperties&&this._evaluator.enqueueRequest(t,e,i)}write(t,e,i,o,a){this.ensurePacked(e,i,o);const l=this.evaluatedMeshParams.effects;if(!l||0===l.length)return void this._write(t,i,void 0,a);const c=i.readGeometryForDisplay()?.clone();if(!c)return;const u=n.z.fromOptimizedCIM(c,i.geometryType),h=(0,s.z)();u.invertY();const d=t.id||"",f=r.V.executeEffects(l,u,d,h);let p;for(;p=f.next();)p.invertY(),this._write(t,i,p,a)}ensurePacked(t,e,i){if(!this._evaluator.hasDynamicProperties)return;const n=this._evaluator.evaluateMeshParams(t,e,i);this._vertexPack.pack(n,this._viewParams)}_writeVertex(t,e,i,n,r){const s=this.evaluatedMeshParams;this._vertexPack.writeVertex(t,e,i,n,s,r)}}},99483:function(t,e,i){i.d(e,{o:function(){return Mt}});var n=i(81728),r=i(13520),s=i(39686),o=i(54417),a=i(97473),l=i(54601);class c extends l.r{}function u(t){const{sprite:e,isMapAligned:i,colorLocked:n,scaleSymbolsProportionally:r,isStroke:s}=t;let l=0;return i&&(l|=(0,o.mR)(a.c.bitset.isMapAligned)),n&&(l|=(0,o.mR)(a.c.bitset.colorLocked)),e.sdf&&(l|=(0,o.mR)(a.c.bitset.isSDF)),r&&(l|=(0,o.mR)(a.c.bitset.scaleSymbolsProportionally)),s&&(l|=(0,o.mR)(a.c.bitset.isStroke)),l}var h=i(40846),d=i(85456);class f extends c{get vertexSpec(){return{createComputedParams:t=>{let{pixelDimensions:e,texelDimensions:i,baseSize:n,referenceSize:s,strokeWidth:o,sizeRatio:a}=t;e||(e=t.sprite.sdf?[0,0]:[t.sprite.width,t.sprite.height]),i||(i=t.sprite.sdf?[0,0]:e),n=(0,r.Lz)(n),s=(0,r.Lz)(s),o=(0,r.Lz)(o);const l=(t.sprite.sdfDecodeCoeff??1)*a;return{...t,pixelDimensions:e,texelDimensions:i,baseSize:n,referenceSize:s,strokeWidth:o,sdfDecodeCoeff:l}},optionalAttributes:{zoomRange:{type:d.pe.SHORT,count:2,packPrecisionFactor:s.fq,pack:({scaleInfo:t},{tileInfo:e})=>(0,o.My)(t,e)}},attributes:{id:{type:d.pe.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:d.pe.UNSIGNED_BYTE,count:1,pack:u},pos:{type:d.pe.SHORT,count:2,pack:"position",packPrecisionFactor:1},offset:{type:d.pe.FLOAT,count:2,packAlternating:{count:4,pack:t=>{const e=t.texelDimensions;return[[-.5*e[0],-.5*e[1]],[.5*e[0],-.5*e[1]],[-.5*e[0],.5*e[1]],[.5*e[0],.5*e[1]]]}}},uv:{type:d.pe.SHORT,count:2,packPrecisionFactor:1,packAlternating:{count:4,packTessellation:({texXmax:t,texXmin:e,texYmax:i,texYmin:n})=>[[e,n],[t,n],[e,i],[t,i]]}},animationPointerAndBaseSizeAndReferenceSize:{type:d.pe.UNSIGNED_SHORT,count:4,packPrecisionFactor:1,pack:({animations:t,baseSize:e,referenceSize:i})=>[t.dataColumn,t.dataRow,e,i]},sizing:{type:d.pe.UNSIGNED_SHORT,count:4,packPrecisionFactor:8,pack:({strokeWidth:t,pixelDimensions:e,baseSize:i,sprite:n,sizeRatio:r})=>{const s=Math.max(i*n.width/n.height,i),o=n.sdfDecodeCoeff*s*r;return[e[0],e[1],t,o]}},angle:{type:d.pe.BYTE,count:1,packTessellation:({angle:t})=>t}}}}_write(t,e){const i=this.evaluatedMeshParams.sprite,{textureBinding:n}=i;t.recordStart(this.instanceId,this.attributeLayout,n);const r=e.getDisplayId();if("esriGeometryPolygon"===e.geometryType){const i=e.readCentroidForDisplay();if(!i)return;const[n,s]=i.coords;this._writeQuad(t,r,n,s)}else if("esriGeometryPoint"===e.geometryType){const i=e.readXForDisplay(),n=e.readYForDisplay();this._writeQuad(t,r,i,n)}else{const i=e.readGeometryForDisplay();if(i){const{angleToLine:e}=this.evaluatedMeshParams;if(e){let e=!0,n=null,s=null;i.forEachVertex(((i,o)=>{if(null!=n&&null!=s){const a=Math.atan2(o-s,i-n)/h.rp;e&&(this._writeQuad(t,r,n,s,a),e=!1),this._writeQuad(t,r,i,o,a)}n=i,s=o}))}else i.forEachVertex(((e,i)=>{this._writeQuad(t,r,e,i)}))}}t.recordEnd()}_writeQuad(t,e,i,n,r=0){const s=this.evaluatedMeshParams.sprite,{rect:o}=s,a=o.x+2,l=o.y+2,c=o.x+o.width-2,u=o.y+o.height-2,h=t.vertexCount();t.recordBounds(i,n,64,64);const d={texXmin:a,texYmin:l,texXmax:c,texYmax:u,angle:r};for(let r=0;r<4;r++)this._writeVertex(t,e,i,n,d);t.indexEnsureSize(6),t.indexWrite(h),t.indexWrite(h+1),t.indexWrite(h+2),t.indexWrite(h+1),t.indexWrite(h+3),t.indexWrite(h+2)}}var p=i(56791),_=i(46869),m=i(57413),g=i(28615),y=i(31859),v=i(83919),x=i(21099),b=i(37463),S=i(25738),w=i(67348),T=i(10793),M=i(13786),P=i(14583),A=i(1932),C=i(58081),I=i(76613),E=i(96564),R=i(7459),O=i(57650),F=i(2014);function z(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}function D(t,e){return Math.sqrt(t*t+e*e)}function L(t){const e=D(t[0],t[1]);t[0]/=e,t[1]/=e}function k(t,e){return D(t[0]-e[0],t[1]-e[1])}function N(t){return t.length-1}function B(t){let e=0;for(let i=0;i<N(t);i++)e+=V(t,i);return e}function V(t,e,i=1){let[n,r]=function(t,e){return t[e+1]}(t,e);return[n,r]=[Math.round(n),Math.round(r)],Math.sqrt(n*n+r*r)*i}class U{constructor(t,e,i,n,r){this._segments=t,this._index=e,this._distance=i,this._xStart=n,this._yStart=r,this._done=!1}static create(t){return new U(t,0,0,t[0][0],t[0][1])}clone(){return new U(this._segments,this._index,this._distance,this.xStart,this.yStart)}equals(t){return this._index===t._index||t._index===this._index-1&&(0===this._distance||1===t._distance)||t._index===this._index+1&&(1===this._distance||0===t._distance)}leq(t){return this._index<t._index||this._index===t._index&&this._distance<=t._distance}geq(t){return this._index>t._index||this._index===t._index&&this._distance>=t._distance}get _segment(){return this._segments[this._index+1]}get angle(){const t=this.dy,e=(0*t+-1*-this.dx)/(1*this.length);let i=Math.acos(e);return t>0&&(i=2*Math.PI-i),i}get xStart(){return this._xStart}get yStart(){return this._yStart}get x(){return this.xStart+this.distance*this.dx}get y(){return this.yStart+this.distance*this.dy}get dx(){return this._segment[0]}get dy(){return this._segment[1]}get xMidpoint(){return this.xStart+.5*this.dx}get yMidpoint(){return this.yStart+.5*this.dy}get xEnd(){return this.xStart+this.dx}get yEnd(){return this.yStart+this.dy}get length(){const{dx:t,dy:e}=this;return Math.sqrt(t*t+e*e)}get remainingLength(){return this.length*(1-this._distance)}get backwardLength(){return this.length*this._distance}get distance(){return this._distance}get done(){return this._done}hasPrev(){return this._index-1>=0}hasNext(){return this._index+1<N(this._segments)}next(){return this.hasNext()?(this._xStart+=this.dx,this._yStart+=this.dy,this._distance=0,this._index+=1,this):null}prev(){return this.hasPrev()?(this._index-=1,this._xStart-=this.dx,this._yStart-=this.dy,this._distance=1,this):(this._done=!0,null)}_seekBackwards(t,e){const i=this.backwardLength;if(t<=i)return this._distance=(i-t)/this.length,this;let n=this.backwardLength;for(;this.prev();){if(n+this.length>t)return this._seekBackwards(t-n);n+=this.length}return this._distance=0,e?this:null}seek(t,e=!1){if(t<0)return this._seekBackwards(Math.abs(t),e);if(t<=this.remainingLength)return this._distance=(this.backwardLength+t)/this.length,this;let i=this.remainingLength;for(;this.next();){if(i+this.length>t)return this.seek(t-i,e);i+=this.length}return this._distance=1,e?this:null}}function G(t,e,i,n=!0){const r=B(t),s=U.create(t),o=r/2;if(!n)return s.seek(o),void(Math.abs(s.x)<F.$u&&Math.abs(s.y)<F.$u&&i(s.clone(),0,o+0*e,r));const a=Math.max((r-e)/2,0),l=Math.floor(a/e),c=o-l*e;s.seek(c);for(let t=-l;t<=l;t++)Math.abs(s.x)<F.$u&&Math.abs(s.y)<F.$u&&i(s.clone(),t,o+t*e,r),s.seek(e)}function Y(t,e){const i=e;for(let e=0;e<t.length;e++){let n=t[e];W(n,i);const r=[];r.push(n[0]);for(let t=1;t<n.length;t++){const[e,i]=n[t-1],[s,o]=n[t],a=s-e,l=o-i;r.push([a,l])}t[e]=r,n=r}return t}function W(t,e){const i=1e-6;if(e<=0)return;const n=t.length;if(n<3)return;const r=[];let s=0;r.push(0);for(let e=1;e<n;e++)s+=k(t[e],t[e-1]),r.push(s);e=Math.min(e,.2*s);const o=[];o.push(t[0][0]),o.push(t[0][1]);const a=t[n-1][0],l=t[n-1][1],c=z([0,0],t[0],t[1]);L(c),t[0][0]+=e*c[0],t[0][1]+=e*c[1],z(c,t[n-1],t[n-2]),L(c),t[n-1][0]+=e*c[0],t[n-1][1]+=e*c[1];for(let t=1;t<n;t++)r[t]+=e;r[n-1]+=e;const u=.5*e;for(let s=1;s<n-1;s++){let a=0,l=0,c=0;for(let n=s-1;n>=0&&!(r[n+1]<r[s]-u);n--){const o=u+r[n+1]-r[s],h=r[n+1]-r[n],d=r[s]-r[n]<u?1:o/h;if(Math.abs(d)<i)break;const f=d*d,p=d*o-.5*f*h,_=d*h/e,m=t[n+1],g=t[n][0]-m[0],y=t[n][1]-m[1];a+=_/p*(m[0]*d*o+.5*f*(o*g-h*m[0])-f*d*h*g/3),l+=_/p*(m[1]*d*o+.5*f*(o*y-h*m[1])-f*d*h*y/3),c+=_}for(let o=s+1;o<n&&!(r[o-1]>r[s]+u);o++){const n=u-r[o-1]+r[s],h=r[o]-r[o-1],d=r[o]-r[s]<u?1:n/h;if(Math.abs(d)<i)break;const f=d*d,p=d*n-.5*f*h,_=d*h/e,m=t[o-1],g=t[o][0]-m[0],y=t[o][1]-m[1];a+=_/p*(m[0]*d*n+.5*f*(n*g-h*m[0])-f*d*h*g/3),l+=_/p*(m[1]*d*n+.5*f*(n*y-h*m[1])-f*d*h*y/3),c+=_}o.push(a/c),o.push(l/c)}o.push(a),o.push(l);for(let e=0,i=0;e<n;e++)t[e][0]=o[i++],t[e][1]=o[i++]}var H=i(53972);const Z=(0,S.Bj)((t=>{let e=0;if(0===t)return 1/0;for(;!(t%2);)e++,t/=2;return e}));class q extends H.G8{constructor(){super(...arguments),this._zoomLevel=0}_write(t,e,i,n){if(this._zoomLevel=n||0,null!=i)throw new Error("InternalError: EffectGeometry not support for LabelMeshWriter");switch(e.geometryType){case"esriGeometryPoint":{const i=e.readXForDisplay(),n=e.readYForDisplay();this._writePoint(t,i,n,e);break}case"esriGeometryEnvelope":case"esriGeometryPolygon":case"esriGeometryMultipoint":{const i=e.readCentroidForDisplay();if(!i)return;const[n,r]=i.coords;this._writePoint(t,n,r,e);break}case"esriGeometryPolyline":this._writeLines(t,e)}}_createLineLabelMetric(t,e,i,n){const r=(0,R.Q4)(t),s="right"===this.evaluatedMeshParams.horizontalAlignment?-1:1,o="bottom"===this.evaluatedMeshParams.verticalAlignment?-1:1,a=this.evaluatedMeshParams.scaleInfo?.maxScale??0,l=this.evaluatedMeshParams.scaleInfo?.minScale??0;return new O.f(r,e,i,s,o,a,l,n??null)}_writePoint(t,e,i,n){const r=this._getShaping();if(!r)return;const s=n.getDisplayId(),o=(0,E.xy)(this.evaluatedMeshParams.horizontalAlignment),a=(0,E.UD)(this.evaluatedMeshParams.verticalAlignment),l=this.evaluatedMeshParams.scaleInfo?.maxScale??0,c=this.evaluatedMeshParams.scaleInfo?.minScale??0,u=(0,R.Q4)(n.getDisplayId()),h=this._getPointReferenceBounds()||{offsetX:0,offsetY:0,size:0};t.metricStart(new O.f(u,e,i,o,a,l,c,h)),this._writeGlyphs(t,s,e,i,r,0,h),t.metricBoxWrite(r.boundsT),t.metricEnd()}_getPointReferenceBounds(){if(!this._references)return null;for(const t of this._references){const e=t.getBoundsInfo();if(e)return e}return null}_writeLines(t,e){const{scaleInfo:i,verticalAlignment:n}=this.evaluatedMeshParams,r=this.evaluatedMeshParams.repeatLabelDistance||128,s=this._getShaping("middle");if(!s)return;const a=(t,e,i,n)=>this._placeSubdivGlyphs(t,e,i,n),l=(s.bounds.width+r)/2;this._current={out:t,id:e.getDisplayId(),shaping:s,zoomRange:(0,o.My)(i,this.getTileInfo()),referenceBounds:this._getPointReferenceBounds()||{offsetX:0,offsetY:0,size:0},offsetDirection:null},this._verticalPlacement="bottom"===n?"above":"top"===n?"below":null,this._verticalPlacement?this._writeAboveAndBelowAlong(e,a,l):this._writeCenterAlong(e,a,l)}_writeAboveAndBelowAlong(t,e,i){const{repeatLabel:n}=this.evaluatedMeshParams,{shaping:r}=this._current,s=r.bounds.halfHeight,o=t.readGeometryForDisplay();if(!o)return;const a=new I.A;(0,C.kz)(a,o,!1,!1,"esriGeometryPolyline",1);const l=$(new I.A,a,s),c=$(new I.A,a,-s),u=(0,C.zv)(c,"esriGeometryPolyline",!1,!1),h=Y((0,C.zv)(l,"esriGeometryPolyline",!1,!1).paths,r.bounds.width),d=Y(u.paths,r.bounds.width);this._current.offsetDirection="above";for(const t of h)G(t,i,e,!!n);this._current.offsetDirection="below";for(const t of d)G(t,i,e,!!n)}_writeCenterAlong(t,e,i){const{repeatLabel:n}=this.evaluatedMeshParams,{shaping:r}=this._current,s=Y(t.readLegacyGeometryForDisplay().paths,r.bounds.width);for(const t of s)G(t,i,e,!!n)}_placeSubdivGlyphs(t,e,i,n){const{allowOverrun:r,labelPosition:s,repeatLabelDistance:o}=this.evaluatedMeshParams,a=this._current.zoomRange[0],l=Z(e),c=this._current.shaping.bounds.width/2,u=Math.sqrt(o||128)/2,h=Math.min(i,n-i),d=this._current.shaping.isMultiline?H.GJ:Math.log2(h/(u+c/2)),f=0===e?d:Math.min(l,d),p=Math.max(a,this._zoomLevel+1-f),_=this._zoomLevel-p,m=this._current.shaping.bounds.width/2*2**_;this._current.shaping.isMultiline?0===e&&this._placeStraight(t,p):r&&_<0?this._placeStraightAlong(t,a):"parallel"===s?this._placeStraightAlong(t,p):"curved"===s&&this._placeCurved(t,p,m)}_placeStraight(t,e){const{out:i,id:n,shaping:r,referenceBounds:s}=this._current,{x:o,y:a}=t;i.metricStart(this._createLineLabelMetric(n,o,a)),i.metricBoxWrite(r.boundsT);const l=t.angle*(180/Math.PI)%360,c=(t.angle*(180/Math.PI)+180)%360;this._writeGlyphs(i,n,o,a,r,0,s,{clipAngle:l,mapAligned:!0,isLineLabel:!0,minZoom:e}),this._writeGlyphs(i,n,o,a,r,0,s,{clipAngle:c,mapAligned:!0,isLineLabel:!0,minZoom:e}),i.metricEnd()}_placeCurved(t,e,i){const{out:n,id:r}=this._current;n.metricStart(this._createLineLabelMetric(r,t.x,t.y));const s=t.clone(),o=t.angle*(180/Math.PI)%360,a=(t.angle*(180/Math.PI)+180)%360;this._verticalPlacement&&this._verticalPlacement!==this._current.offsetDirection||(this._placeFirst(s,e,1,o),this._placeBack(t,s,e,i,1,o),this._placeForward(t,s,e,i,1,o)),this._verticalPlacement&&this._verticalPlacement===this._current.offsetDirection||(this._placeFirst(s,e,0,a),this._placeBack(t,s,e,i,0,a),this._placeForward(t,s,e,i,0,a)),n.metricEnd()}_placeStraightAlong(t,e){const{out:i,id:n,shaping:s,zoomRange:o,referenceBounds:a}=this._current,{boxBorderLineColor:l,boxBackgroundColor:c}=this.evaluatedMeshParams,u=t.clone(),h=t.angle*(180/Math.PI)%360,d=(t.angle*(180/Math.PI)+180)%360,f=s.glyphs.length>0&&!(!l&&!c);if(i.metricStart(this._createLineLabelMetric(n,t.x,t.y)),f){const l=Math.max(e,o[0],0),c=Math.min(H.GJ,o[1]),u=(0,w.$0)((0,T.vt)(),-t.angle),f={minZoom:l,maxZoom:c,clipAngle:h,mapAligned:!0,isLineLabel:!0},p=(0,r.Lz)(this.evaluatedMeshParams.offsetX),_=(0,r.Lz)(this.evaluatedMeshParams.offsetY);if(!this._verticalPlacement||this._verticalPlacement===this._current.offsetDirection){const e=(0,P.fA)(p,-1*_),[r,o]=s.shapeBackground((0,w.Tl)((0,T.vt)(),u,e));i.recordStart(this.instanceId,this.attributeLayout,s.glyphs[0].textureBinding);const l=2*Math.max(r.width,r.height);i.recordBounds(t.x+r.x,t.y+r.y,l,l),this._writeTextBox(i,n,t.x,t.y,o,a,f),i.recordEnd()}if(!this._verticalPlacement||this._verticalPlacement!==this._current.offsetDirection){const e=(0,P.fA)(p,_),[r,o]=s.shapeBackground((0,w.Tl)((0,T.vt)(),u,e));f.clipAngle=d,i.recordStart(this.instanceId,this.attributeLayout,s.glyphs[0].textureBinding);const l=2*Math.max(r.width,r.height);i.recordBounds(t.x+r.x,t.y+r.y,l,l),this._writeTextBox(i,n,t.x,t.y,o,a,f),i.recordEnd()}}this._verticalPlacement&&this._verticalPlacement!==this._current.offsetDirection||this._placeFirst(u,e,1,h,!0),this._verticalPlacement&&this._verticalPlacement===this._current.offsetDirection||this._placeFirst(u,e,0,d,!0),i.metricEnd()}_placeBack(t,e,i,n,r,s){const o=t.clone();let a=t.backwardLength+0;for(;o.prev()&&!(a>=n);)this._placeOnSegment(o,e,a,i,-1,r,s),a+=o.length+0}_placeForward(t,e,i,n,r,s){const o=t.clone();let a=t.remainingLength+0;for(;o.next()&&!(a>=n);)this._placeOnSegment(o,e,a,i,1,r,s),a+=o.length+0}_placeFirst(t,e,i,n,r=!1){const{out:s,id:o,shaping:a,zoomRange:l,referenceBounds:c}=this._current,u=a.glyphs;for(const h of u){const u=h.x>a.bounds.x?i:1-i,d=u*t.remainingLength+(1-u)*t.backwardLength,f=Math.abs(h.x+h.width/2-a.bounds.x),p=Math.max(0,this._zoomLevel+Math.log2(f/(d+0))),_=Math.max(e,r?0:p);h.maxZoom=Math.min(l[1],H.GJ),h.angle=t.angle+(1-i)*Math.PI,h.minZoom=Math.max(l[0],_),this._writeLineGlyph(s,o,t.x,t.y,a.bounds,h,n,c,!0),(i||this._current.offsetDirection)&&this._isVisible(h.minZoom,h.maxZoom)&&s.metricBoxWrite(h.bounds)}}_placeOnSegment(t,e,i,n,r,s,o){const{out:a,id:l,shaping:c,referenceBounds:u}=this._current,h=c.glyphs,d=t.dx/t.length,f=t.dy/t.length,p={x:t.x+i*-r*d,y:t.y+i*-r*f};for(const e of h){const h=e.x>c.bounds.x?s:1-s;if(!(h&&1===r||!h&&-1===r))continue;const d=Math.abs(e.x+e.width/2-c.bounds.x),f=Math.max(0,this._zoomLevel+Math.log2(d/i)-.1),_=Math.max(n,this._zoomLevel+Math.log2(d/(i+t.length+0)));0!==f&&(e.angle=t.angle+(1-s)*Math.PI,e.minZoom=_,e.maxZoom=f,this._writeLineGlyph(a,l,p.x,p.y,c.bounds,e,o,u,!0),(s||this._current.offsetDirection)&&this._isVisible(e.minZoom,e.maxZoom)&&a.metricBoxWrite(e.bounds))}}_writeLineGlyph(t,e,i,n,r,s,a,l,c){const u=i+r.x,h=n+r.y,d=2*(this.evaluatedMeshParams.minPixelBuffer?this.evaluatedMeshParams.minPixelBuffer/this._textMeshTransformProps.fontSize:1),f=Math.max(r.width,r.height)*d;t.recordStart(this.instanceId,this.attributeLayout,s.textureBinding),t.recordBounds(u,h,f,f);const{texcoords:p,offsets:_}=s,{fontSize:m,haloSize:g,outlineSize:y}=this._textMeshTransformProps;this._writeQuad(t,e,i,n,{texcoords:p,offsets:_,fontSize:m,haloSize:g,outlineSize:y,color:(0,o.Jb)(this.evaluatedMeshParams.color),isBackground:!1,referenceBounds:l,minZoom:Math.max(this._current.zoomRange[0],s.minZoom),maxZoom:Math.min(this._current.zoomRange[1],s.maxZoom),clipAngle:a,mapAligned:c,isLineLabel:!0}),t.recordEnd()}_isVisible(t,e){const i=Math.floor(this._zoomLevel*s.fq)/s.fq;return t<=i&&i<=e}}function $(t,e,i){const{coords:n,lengths:r}=e,s=(0,A.vt)(),o=(0,A.vt)(),a=(0,A.vt)(),l=(0,A.vt)(),c=(0,A.vt)(),u=(0,A.vt)();let h=0;for(let e=0;e<r.length;e++){const d=r[e];for(let e=0;e<d;e++){const r=2*(e+h-1),f=2*(e+h),p=2*(e+h+1);e>0?(0,M.hZ)(s,n[r],n[r+1]):(0,M.hZ)(s,0,0),(0,M.hZ)(o,n[f],n[f+1]),e<d-1?(0,M.hZ)(a,n[p],n[p+1]):(0,M.hZ)(a,0,0),0===e?(0,M.hZ)(l,0,0):((0,M.jb)(l,o,s),(0,M.S8)(l,l),(0,M.hZ)(l,l[1],-l[0])),e===d-1?(0,M.hZ)(c,0,0):((0,M.jb)(c,a,o),(0,M.S8)(c,c),(0,M.hZ)(c,c[1],-c[0])),(0,M.WQ)(u,l,c),(0,M.S8)(u,u);const _=u[0]*c[0]+u[1]*c[1];0!==_&&(0,M.hs)(u,u,_),(0,M.hs)(u,u,i),t.coords.push(o[0]+u[0],o[1]+u[1])}t.lengths.push(d),h+=d}return t}var j=i(67293),X=i(63124),K=i(82806),Q=i(50659),J=i(39819),tt=i(21609),et=i(40633),it=i(95415),nt=i(99121);function rt(t){return t instanceof st?t:"object"==typeof t&&"type"in t?ct[t.type].hydrate(t):new ot(t)}class st{constructor(t){this.inputs=t}encode(){const t=[];for(const e of this.inputs)t.push(...e.encode());return t.push(...this.instructions),t}}class ot extends st{constructor(t){super([]),this.value=t}simplify(){return this}get instructions(){if(Array.isArray(this.value)){const[t,e,i,n]=this.value;return null!=n?nt.GA.vector4.encode([t,e||0,i||0,n]):nt.GA.vector3.encode([t,e||0,i||0])}return nt.GA.scalar.encode(this.value)}}class at extends st{constructor(t,e){super([e]),this._config=t,this._parent=e}static hydrate(t){return new at(t,rt(t.parent))}simplify(){if(this._config.relativeTranslation||this._config.absoluteScale)return this;const t=this._parent.simplify();if(!(t instanceof ot))return this;const[e,i,n,r]=t.value,s=this._config.translation.from[0],o=this._config.translation.from[1],a=this._config.rotation.from,l=this._config.scale.from;if(s===this._config.translation.to[0]&&o===this._config.translation.to[1]&&a===this._config.rotation.to&&l===this._config.scale.to){const t=n+a,c=r*l,u=Math.sin(n),h=Math.cos(n);return new ot([h*r*s-u*r*o+e,u*r*s+h*r*o+i,t,c])}return new at(this._config,t)}get instructions(){return nt.GA.animatedTransform.encode(this._config)}}class lt extends st{constructor(t,e){super([e]),this._config=t,this._parent=e}static hydrate(t){return new lt(t,rt(t.parent))}simplify(){const t=this._parent.simplify();if(!(t instanceof ot))return this;const[e,i,n,r]=t.value,s=this._config.color.from[0],o=this._config.color.from[1],a=this._config.color.from[2];let l=this._config.color.from[3];const c=this._config.opacity.from;return s===this._config.color.to[0]&&o===this._config.color.to[1]&&a===this._config.color.to[2]&&l===this._config.color.to[3]&&c===this._config.opacity.to?(l*=c,new ot([e*s,i*o,n*a,r*l])):new lt(this._config,t)}get instructions(){return nt.GA.animatedColor.encode(this._config)}}const ct={AnimatedTransform:at,AnimatedColor:lt};var ut=i(52874);function ht(t){return ft(t.map((t=>_t(t))).map((t=>rt(t).simplify())))}function dt(t){const e=[];return e.push(t.transform),e.push(t.fromColor),e.push(t.toColor),e.push(t.colorMix),e.push(t.toOpacity),e.push(t.opacityMix),e}function ft(t){const e=[],i=[];let n=0;for(const r of t){const s=[...r.encode(),...nt.GA.ret.encode()];e.push([n+t.length,0,0,0]),i.push(...s),n+=s.length}return[...e,...i]}async function pt(t,e){const i=t;let n;if("number"==typeof i||"string"==typeof i||"boolean"==typeof i)n=i;else if(Array.isArray(i))n=await Promise.all(i.map((t=>pt(t,e))));else if("object"==typeof i)if("valueExpressionInfo"in i){const{valueExpressionInfo:t}=i,{expression:r}=t;n={...i,computed:await e.createComputedField({expression:r})}}else{n={};for(const t in i)n[t]=await pt(i[t],e)}return n}function _t(t,e,i){const n=t;let r;if("number"==typeof n||"string"==typeof n||"boolean"==typeof n)r=n;else if(Array.isArray(n))r=n.map((t=>_t(t,e,i)));else if("object"==typeof n)if("type"in n&&null!=n.type&&"Process"===n.type)switch(n.op){case"ArcadeColor":{const t=_t(n.value,e,i);mt(Array.isArray(t)&&4===t.length),r=[t[0]/255,t[1]/255,t[2]/255,t[3]]}break;case"Transparency":{const t=_t(n.value,e,i);mt("number"==typeof t),r=1-t/100}break;case"Divide":{const t=_t(n.left,e,i);mt("number"==typeof t);const s=_t(n.right,e,i);mt("number"==typeof s),r=t/s}break;case"Random":{const t=_t(n.seed,e,i),s=_t(n.min,e,i),o=_t(n.max,e,i),a=e.getObjectId(),l=(0,it.A)(a||0);r=s+(0,it.J)(l,t)*(o-s)}}else if("computed"in n)r=function(t){if(!("computed"in t))return t;let n=t.computed.readWithDefault(e,i,[255*t.defaultValue[0],255*t.defaultValue[1],255*t.defaultValue[2],t.defaultValue[3]]);if("string"==typeof n){const t=ut.A.fromString(n);t&&(n=[t.r,t.g,t.b,t.a])}return n}(n);else{r={};for(const t in n)r[t]=_t(n[t],e,i)}return r}function mt(t){if(!t)throw new Error("Assertion failed.")}var gt=i(25731),yt=i(37069);async function vt(t,e,i=!1){const{defaultValue:n,valueExpressionInfo:r,value:s}=e;if(r){const{expression:s}=r,o=await t.createComputedField({expression:s},i);return o?{...e,computed:o,defaultValue:n}:null}return{...e,computed:new yt.G(s),defaultValue:n}}async function xt(t,e){const{valueExpressionInfo:i}=e,{expression:n}=i,r=await t.createComputedField({expression:n});return r?{...e,computed:r}:null}function bt(t){return"object"==typeof t&&null!=t&&(!(!("valueExpressionInfo"in t)||!t.valueExpressionInfo)||"type"in t&&"Process"===t.type&&"op"in t&&"Random"===t.op)}function St(t){if(Array.isArray(t))for(const e of t)if(St(e))return!0;if("object"==typeof t){if(bt(t))return!0;for(const e in t)if(St(t[e]))return!0}return!1}class wt{static async create(t,e,i){const n={},r=new Map,s=new Map,o=new Map,a=new Map,l=new Map,c=new Map;for(const u in i){const h=i[u];if(null!=h&&"object"==typeof h)if(Array.isArray(h)){if("object"==typeof h[0])throw new Error(`InternalError: Cannot handle ${u}. Nested array params are not supported`);n[u]=h}else if("valueExpressionInfo"in h){if(h.value){n[u]=h.value;continue}const e=await xt(t,h);if(!e){n[u]=h.defaultValue;continue}r.set(u,e),n[u]=null}else switch(h.type){case"cim-effect-infos":if(h.effectInfos.some((t=>t.overrides.length))){s.set(u,{effects:await Promise.all(h.effectInfos.map((async e=>{const i=e.overrides.map((e=>vt(t,e)));return{effect:e.effect,compiledOverrides:(await Promise.all(i)).filter(Q.Ru)}})))});break}n[u]=h.effectInfos.map((t=>t.effect));break;case"cim-marker-placement-param":h.overrides.length&&o.set(u,{placementInfo:h,compiledOverrides:(await Promise.all(h.overrides.map((e=>vt(t,e))))).filter(Q.Ru)}),n[u]=h.placement;break;case"text-rasterization-param":{if(h.overrides.length){const e=h.overrides.map((e=>vt(t,e,h.useLegacyLabelEvaluationRules)));a.set(u,{compiledOverrides:(await Promise.all(e)).filter(Q.Ru),rasterizationParam:h,objectIdToResourceId:new Map});continue}const i={type:"cim-rasterization-info",resource:h.resource};n[u]=await e.fetchResourceImmediate(i)??null;break}case"sprite-rasterization-param":{if(h.overrides.length){const e=h.overrides.map((e=>vt(t,e)));a.set(u,{compiledOverrides:(await Promise.all(e)).filter(Q.Ru),rasterizationParam:h,objectIdToResourceId:new Map});continue}if("animated"===h.resource.type){a.set(u,{compiledOverrides:[],rasterizationParam:h,objectIdToResourceId:new Map});continue}const i={type:"cim-rasterization-info",resource:h.resource};n[u]=await e.fetchResourceImmediate(i)??null;break}case"cim-marker-transform-param":{const{params:e}=h;if(St(e)){const i={compiledMarkerInfos:[]};await Promise.all(e.map((async e=>{const n={props:{}};for(const i in e)if(bt(e[i])){const r=await xt(t,e[i]);n.compiledExpressionMap||(n.compiledExpressionMap=new Map);const s=n.compiledExpressionMap;r&&s.set(i,r)}else n.props[i]=e[i];i.compiledMarkerInfos.push(n)}))),l.set(u,i)}else n[u]={type:"cim-marker-transform-info",infos:e};break}case"animation-params":{const{params:i}=h,r=dt(i);if(St(r)){const e=await Promise.all(r.map((e=>pt(e,t))));c.set(u,{params:e,propertyIdToResourceId:new Map,key:u})}else{const t=ht(r),i=await e.fetchResourceImmediate({type:"animation-info",resource:t});null!=i&&"sprite"===i.type&&(n[u]={dataRow:i.rect.y,dataColumn:i.rect.x})}break}default:n[u]=h}else n[u]=h}return new wt(i,n,r,s,o,a,l,c)}constructor(t,e,i,n,r,s,o,a){this.inputMeshParams=t,this._resolvedMeshParams=e,this._dynamicProperties=i,this._dynamicEffectProperties=n,this._dynamicPlacementProperties=r,this._dynamicAsyncProperties=s,this._dynamicTransformProperties=o,this._dynamicAsyncAnimations=a,this.evaluator=t=>t}get hasDynamicProperties(){return!!(this._dynamicProperties.size||this._dynamicAsyncProperties.size||this._dynamicEffectProperties.size||this._dynamicTransformProperties.size||this._dynamicPlacementProperties.size||this._dynamicAsyncAnimations.size)}get evaluatedMeshParams(){return this._evaluatedMeshParams||(this._evaluatedMeshParams=this.evaluator(this._resolvedMeshParams)),this._evaluatedMeshParams}enqueueRequest(t,e,i){for(const n of this._dynamicAsyncProperties.values()){const r=(0,tt.o8)(n.rasterizationParam.resource);"animated"===n.rasterizationParam.resource.type&&n.rasterizationParam.resource.randomizeStartTime&&(r.primitiveName="__RESERVED__PRIMITIVE__NAME__",r.startGroup=(0,it.A)(e.getObjectId()||0));for(const{primitiveName:t,propertyName:s,computed:o,defaultValue:a,valueExpressionInfo:l}of n.compiledOverrides)try{const l="animated"===n.rasterizationParam.resource.type?r.primitiveName:t;(0,gt.Ph)(r,l,s,o,e,i,a)}catch(e){et.A.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.mesh.MeshWriterInputEvaluator").errorOnce(new J.A("invalid-arcade-expression",`Encountered an error when evaluating the arcade expression '${l?.expression}' (primitive: '${t}', property: '${s}')`,e))}const s=t.enqueueRequest({type:"cim-rasterization-info",resource:r});n.objectIdToResourceId.set(e.getObjectId(),s)}for(const n of this._dynamicAsyncAnimations.values()){const r=n.params.map((t=>_t(t,e,i))).map(rt).map((t=>t.simplify())),s=ft(r),o=t.enqueueRequest({type:"animation-info",resource:s});n.propertyIdToResourceId.set(e.getObjectId()+"."+n.key,o)}}evaluateMeshParams(t,e,i){for(const[t,n]of this._dynamicProperties.entries())this._resolvedMeshParams[t]=n.computed.readWithDefault(e,i,n.defaultValue);for(const[t,n]of this._dynamicPlacementProperties.entries())for(const{computed:r,defaultValue:s,propertyName:o}of n.compiledOverrides){const a=r.readWithDefault(e,i,s);n.placementInfo.placement[o]=a,this._resolvedMeshParams[t]=n.placementInfo.placement}for(const[t,n]of this._dynamicEffectProperties.entries())for(const r of n.effects){for(const{computed:t,defaultValue:n,propertyName:s}of r.compiledOverrides){const o=t.readWithDefault(e,i,n);r.effect[s]=o}this._resolvedMeshParams[t]=n.effects.map((t=>t.effect))}for(const[t,n]of this._dynamicTransformProperties.entries()){const r={type:"cim-marker-transform-info",infos:[]};for(const t of n.compiledMarkerInfos){const n={...t.props};if(t.compiledExpressionMap)for(const[r,s]of t.compiledExpressionMap){const t=s.computed.readWithDefault(e,i,s.defaultValue);n[r]="number"==typeof t||"boolean"==typeof t?t:s.defaultValue}r.infos.push(n)}this._resolvedMeshParams[t]=r}for(const[i,n]of this._dynamicAsyncProperties.entries()){const r=n.objectIdToResourceId.get(e.getObjectId());if(null==r)continue;const s=t.getResource(r);this._resolvedMeshParams[i]=s}for(const[i,n]of this._dynamicAsyncAnimations.entries()){const r=n.propertyIdToResourceId.get(e.getObjectId()+"."+i);if(null==r)continue;const s=t.getResource(r);this._resolvedMeshParams[i]={dataRow:s.rect.y,dataColumn:s.rect.x}}return this._evaluatedMeshParams=this.evaluator(this._resolvedMeshParams),this.evaluatedMeshParams}}var Tt=i(77981);class Mt{async createMeshWriter(t,e,i,n){const r=this._getMeshWriter(n.techniqueType),s=await wt.create(t,e,n.inputParams),o=new r(n.id,s,n.optionalAttributes,i);return await o.loadDependencies(),o}_getMeshWriter(t){switch(t){case n.N.Fill:return g.Y;case n.N.DotDensity:return p.k;case n.N.ComplexFill:return _.KE;case n.N.PatternFill:return v.m;case n.N.OutlineFill:return y.w0;case n.N.PatternOutlineFill:return x.Q;case n.N.ComplexOutlineFill:return m.O;case n.N.Marker:return K.H;case n.N.PieChart:return Tt.v;case n.N.Text:return H.G8;case n.N.Line:return j.Bw;case n.N.TexturedLine:return X.K;case n.N.Heatmap:return b.h;case n.N.Label:return q;case n.N.AnimatedMarker:return f;default:throw new Error("Internal Error: Mesh writer not in the registry")}}}},5544:function(t,e,i){i.d(e,{F:function(){return s},q:function(){return o}});var n=i(85475),r=i(85456);function s(t,e,i,s){const o=i.packPrecisionFactor??1;switch(i.type){case r.pe.BYTE:if(1===i.count)t.setInt8(s+i.offset,e*o);else for(let n=0;n<i.count;n++){const r=n*Int8Array.BYTES_PER_ELEMENT;t.setInt8(s+i.offset+r,e[n]*o)}break;case r.pe.UNSIGNED_BYTE:if(1===i.count)t.setUint8(s+i.offset,e*o);else for(let n=0;n<i.count;n++){const r=n*Uint8Array.BYTES_PER_ELEMENT;t.setUint8(s+i.offset+r,e[n]*o)}break;case r.pe.SHORT:if(1===i.count)t.setInt16(s+i.offset,e*o,!0);else for(let n=0;n<i.count;n++){const r=n*Int16Array.BYTES_PER_ELEMENT;t.setInt16(s+i.offset+r,e[n]*o,!0)}break;case r.pe.UNSIGNED_SHORT:if(1===i.count)t.setUint16(s+i.offset,e*o,!0);else for(let n=0;n<i.count;n++){const r=n*Uint16Array.BYTES_PER_ELEMENT;t.setUint16(s+i.offset+r,e[n]*o,!0)}break;case r.pe.INT:if(1===i.count)t.setInt32(s+i.offset,e*o,!0);else for(let n=0;n<i.count;n++){const r=n*Int32Array.BYTES_PER_ELEMENT;t.setInt32(s+i.offset+r,e[n]*o,!0)}break;case r.pe.UNSIGNED_INT:if(1===i.count)t.setUint32(s+i.offset,e*o,!0);else for(let n=0;n<i.count;n++){const r=n*Uint32Array.BYTES_PER_ELEMENT;t.setUint32(s+i.offset+r,e[n]*o,!0)}break;case r.pe.FLOAT:if(1===i.count)t.setFloat32(s+i.offset,e*o,!0);else for(let n=0;n<i.count;n++){const r=n*Float32Array.BYTES_PER_ELEMENT;t.setFloat32(s+i.offset+r,e[n]*o,!0)}break;case r.pe.HALF_FLOAT:if(1===i.count)t.setUint16(s+i.offset,(0,n.fw)(e*o),!0);else for(let r=0;r<i.count;r++){const a=r*Uint16Array.BYTES_PER_ELEMENT;t.setUint16(s+i.offset+a,(0,n.fw)(e[r]*o),!0)}}}function o(t,e,i){switch(e.type){case r.pe.BYTE:{if(1===e.count)return t.getInt8(i+e.offset);const n=[];for(let r=0;r<e.count;r++){const s=r*Int8Array.BYTES_PER_ELEMENT;n.push(t.getInt8(i+e.offset+s))}return n}case r.pe.UNSIGNED_BYTE:{if(1===e.count)return t.getUint8(i+e.offset);const n=[];for(let r=0;r<e.count;r++){const s=r*Uint8Array.BYTES_PER_ELEMENT;n.push(t.getUint8(i+e.offset+s))}return n}case r.pe.SHORT:{if(1===e.count)return t.getInt16(i+e.offset,!0);const n=[];for(let r=0;r<e.count;r++){const s=r*Int16Array.BYTES_PER_ELEMENT;n.push(t.getInt16(i+e.offset+s,!0))}return n}case r.pe.UNSIGNED_SHORT:{if(1===e.count)return t.getUint16(i+e.offset,!0);const n=[];for(let r=0;r<e.count;r++){const s=r*Uint16Array.BYTES_PER_ELEMENT;n.push(t.getUint16(i+e.offset+s,!0))}return n}case r.pe.INT:{if(1===e.count)return t.getInt32(i+e.offset,!0);const n=[];for(let r=0;r<e.count;r++){const s=r*Int32Array.BYTES_PER_ELEMENT;n.push(t.getInt32(i+e.offset+s,!0))}return n}case r.pe.UNSIGNED_INT:{if(1===e.count)return t.getUint32(i+e.offset,!0);const n=[];for(let r=0;r<e.count;r++){const s=r*Uint32Array.BYTES_PER_ELEMENT;n.push(t.getUint32(i+e.offset+s,!0))}return n}case r.pe.FLOAT:{if(1===e.count)return t.getFloat32(i+e.offset,!0);const n=[];for(let r=0;r<e.count;r++){const s=r*Float32Array.BYTES_PER_ELEMENT;n.push(t.getFloat32(i+e.offset+s,!0))}return n}case r.pe.HALF_FLOAT:{if(1===e.count)return(0,n.Kl)(t.getUint16(i+e.offset,!0));const r=[];for(let s=0;s<e.count;s++){const o=s*Uint16Array.BYTES_PER_ELEMENT;r.push((0,n.Kl)(t.getUint16(i+e.offset+o,!0)))}return r}}}},86329:function(t,e,i){function n(t){return t}function r(t){return t}i.d(e,{P:function(){return n},U:function(){return r}})},68758:function(t,e,i){i.d(e,{R:function(){return s},z:function(){return r}});let n=null;function r(){return n}async function s(){n=await i.e(4696).then(i.bind(i,28356))}},25731:function(t,e,i){i.d(e,{Ph:function(){return s},Z0:function(){return a},hU:function(){return r}});var n=i(50944);function r(t){const e=t.map((({name:t,count:e,type:i})=>`${t}.${e}.${i}`)).join(",");return(0,n.Wm)(e)}function s(t,e,i,n,r,o,a){if(t.primitiveName===e){let e=n?.readWithDefault(r,o,t[i]&&a);return"text"===t.type&&(e=e.toString()),void(t[i]=e)}if("type"in t&&null!=t.type){if(t.effects)for(const l of t.effects)s(l,e,i,n,r,o,a);switch(t.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(t.symbolLayers)for(const l of t.symbolLayers)s(l,e,i,n,r,o,a);break;case"CIMTextSymbol":t.symbol&&s(t.symbol,e,i,n,r,o,a);break;case"CIMHatchFill":t.lineSymbol&&s(t.lineSymbol,e,i,n,r,o,a);break;case"CIMPictureMarker":case"CIMCharacterMarker":case"CIMVectorMarker":if(t.markerPlacement&&s(t.markerPlacement,e,i,n,r,o,a),"CIMVectorMarker"===t.type&&t.markerGraphics)for(const l of t.markerGraphics)s(l,e,i,n,r,o,a),s(l.symbol,e,i,n,r,o,a)}}}const o=400;function a(t){const e=t.width;return null!=t.effects?o:Math.max(1.25*e,8)}},77981:function(t,e,i){i.d(e,{v:function(){return l}});var n=i(13520),r=i(54417),s=i(54601),o=i(85456);const a={createComputedParams:t=>t,optionalAttributes:{},attributes:{pos:{type:o.pe.SHORT,count:2,packPrecisionFactor:10,pack:"position"},id:{type:o.pe.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:o.pe.UNSIGNED_BYTE,count:1,pack:t=>0},offset:{type:o.pe.SHORT,count:2,packPrecisionFactor:16,packAlternating:{count:4,pack:({size:t})=>{const e=(0,n.Lz)(t),i=-e/2,r=-e/2;return[[i,r],[i+e,r],[i,r+e],[i+e,r+e]]}}},texCoords:{type:o.pe.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:()=>[[0,1],[1,1],[0,0],[1,0]]}},size:{type:o.pe.UNSIGNED_BYTE,count:2,pack:({size:t})=>[t,t]},referenceSize:{type:o.pe.UNSIGNED_BYTE,count:1,pack:({size:t})=>(0,n.Lz)(t)},zoomRange:{type:o.pe.UNSIGNED_BYTE,count:2,pack:({scaleInfo:t},{tileInfo:e})=>(0,r.My)(t,e)}}};class l extends s.r{constructor(){super(...arguments),this.vertexSpec=a}_write(t,e){const i=e.getDisplayId(),r=this.evaluatedMeshParams.minPixelBuffer,s=Math.max((0,n.Lz)(this.evaluatedMeshParams.size),r);let o,a;if("esriGeometryPoint"===e.geometryType)o=e.readXForDisplay(),a=e.readYForDisplay();else{const t=e.readCentroidForDisplay();if(!t)return;o=t?.coords[0],a=t?.coords[1]}t.recordStart(this.instanceId,this.attributeLayout),t.recordBounds(o,a,s,s);const l=t.vertexCount();this._writeVertex(t,i,o,a),t.indexWrite(l+0),t.indexWrite(l+1),t.indexWrite(l+2),t.indexWrite(l+1),t.indexWrite(l+3),t.indexWrite(l+2),t.recordEnd()}}},33702:function(t,e,i){i.d(e,{f_:function(){return m},$Z:function(){return p},DM:function(){return _},rz:function(){return f}});var n=i(53804),r=i(39686),s=i(98282),o=i(70931),a=i(58941),l=i(86486);class c extends s.k2{getVisualVariableData(t){if(!this._vvData){const e=this.getAttributeDataCoords(t);this._vvData=(0,o.US)(this.visualVariableData,e).setDebugName("storage2")}return this._vvData}getAttributeDataCoords(t){if(!this._uv){const e=(0,l.Kt)(t),i=this.size,n=(0,o.Wh)(e.x),r=(0,o.Wh)(e.y).multiply((0,o.Wh)(256)),s=(0,o.Wh)(e.z).multiply((0,o.Wh)(256)).multiply((0,o.Wh)(256)),a=(0,o.fV)(n.add(r).add(s)),c=(0,o.zi)(a,i),u=a.subtract(c).divide(i);this._uv=new o.ZY(c,u).add(.5).divide(i)}return this._uv}getFilterData(t){const e=this.getAttributeDataCoords(t);return(0,o.US)(this.filterFlags,e).setDebugName("storage0")}getAnimationData(t){const e=this.getAttributeDataCoords(t);return(0,o.US)(this.animation,e).setDebugName("storage1")}getVVData(t){return this.getVisualVariableData(t)}getDataDrivenData0(t){const e=this.getAttributeDataCoords(t);return(0,o.US)(this.dataDriven0,e).setDebugName("storage30")}getDataDrivenData1(t){const e=this.getAttributeDataCoords(t);return(0,o.US)(this.dataDriven1,e).setDebugName("storage31")}getDataDrivenData2(t){const e=this.getAttributeDataCoords(t);return(0,o.US)(this.dataDriven2,e).setDebugName("storage32")}getGPGPUData(t){const e=this.getAttributeDataCoords(t);return(0,o.US)(this.gpgpu,e).setDebugName("storage4")}getLocalTimeOrigin(t){const e=this.getAttributeDataCoords(t);return(0,o.US)(this.localTimeOrigin,e).x.setDebugName("storage5")}getFilterFlags(t){return(0,a.A)("webgl-ignores-sampler-precision")?(0,o.mk)(this.getFilterData(t).x.multiply((0,o.fV)(255))):this.getFilterData(t).x.multiply((0,o.fV)(255))}getLabelVisibility(t){const e=this.getFilterData(t).y.multiply(255);return new o.nt(1).subtract(e)}getAnimationValue(t){return this.getAnimationData(t).x}getSizeValue(t){return this.getVisualVariableData(t).x}getColorValue(t){return this.getVisualVariableData(t).y}getOpacityValue(t){return this.getVisualVariableData(t).z}getRotationValue(t){return this.getVisualVariableData(t).w}}(0,n._)([(0,s.Pi)(o.z7)],c.prototype,"filterFlags",void 0),(0,n._)([(0,s.Pi)(o.z7)],c.prototype,"animation",void 0),(0,n._)([(0,s.Pi)(o.z7)],c.prototype,"gpgpu",void 0),(0,n._)([(0,s.Pi)(o.z7)],c.prototype,"localTimeOrigin",void 0),(0,n._)([(0,s.Pi)(o.z7)],c.prototype,"visualVariableData",void 0),(0,n._)([(0,s.Pi)(o.z7)],c.prototype,"dataDriven0",void 0),(0,n._)([(0,s.Pi)(o.z7)],c.prototype,"dataDriven1",void 0),(0,n._)([(0,s.Pi)(o.z7)],c.prototype,"dataDriven2",void 0),(0,n._)([(0,s.Pi)(o.nt)],c.prototype,"size",void 0);class u extends s.k2{}(0,n._)([(0,s.Pi)(o.nt)],u.prototype,"activeReasons",void 0),(0,n._)([(0,s.Pi)(o.nt)],u.prototype,"highlightAll",void 0);class h extends s.k2{}(0,n._)([(0,s.Pi)(o.ZY)],h.prototype,"position",void 0),(0,n._)([(0,s.Pi)(o.nt)],h.prototype,"distance",void 0),(0,n._)([(0,s.Pi)(o.nt)],h.prototype,"smallSymbolDistance",void 0),(0,n._)([(0,s.Pi)(o.nt)],h.prototype,"smallSymbolSizeThreshold",void 0);var d=i(64522);class f extends s.ZA{}(0,n._)([(0,s.C5)(0,o.eB)],f.prototype,"id",void 0),(0,n._)([(0,s.C5)(1,o.nt)],f.prototype,"bitset",void 0),(0,n._)([(0,s.C5)(2,o.ZY)],f.prototype,"pos",void 0);class p extends s.Y7{}(0,n._)([(0,s.C5)(14,o.ZY)],p.prototype,"nextPos1",void 0),(0,n._)([(0,s.C5)(15,o.ZY)],p.prototype,"nextPos2",void 0);class _ extends s.HS{}class m extends s.A{clip(t,e){let i=new o.nt(0);const n=this.storage.getFilterFlags(t);if(i=i.add((0,o.fV)(2).multiply((0,o.fV)(1).subtract((0,l.i6)(n,0)))),this.inside?i=i.add((0,o.fV)(2).multiply((0,o.fV)(1).subtract((0,l.i6)(n,1)))):this.outside?i=i.add((0,o.fV)(2).multiply((0,l.i6)(n,1))):this.highlight&&(i=i.add((0,o.fV)(2).multiply((0,o.fV)(1).subtract(this._checkHighlight(n))))),null!=e){const t=new o.nt(1).subtract((0,o.PM)(e.x,this.view.currentZoom)),n=(0,o.PM)(e.y,this.view.currentZoom);i=i.add(new o.nt(2).multiply(t.add(n)))}return i}getFragmentOutput(t,e,i=new o.nt(1/255)){const n=new s.mm;return n.glFragColor=this._maybeWriteHittest(e)??this._maybeHighlight(t,i)??t,n}_maybeHighlight(t,e){return this.highlight?new o.Zb(t.rgb,(0,o.PM)(e,t.a)):null}_checkHighlight(t){let e=this._checkHighlightBit(t,0);for(let i=1;i<r.U5;i++)e=e.add(this._checkHighlightBit(t,i));return(0,o.PM)(new o.nt(.1),e.add(this.highlight.highlightAll))}_checkHighlightBit(t,e){return(0,l.yS)(t,e).multiply((0,l.mh)(this.highlight.activeReasons,e))}maybeRunHittest(t,e,i){if(null==this.hittestRequest)return null;const n=this.hittest(t,e,i);let r=(0,o.Tk)((0,o.MM)(n,this.hittestRequest.distance),new o.nt(2),new o.nt(0));const s=this.storage.getAttributeDataCoords(t.id),a=(0,l.nb)(s);r=r.add(this.clip(t.id,t.zoomRange));const c=new o.Zb(new o.nt(1/255),0,0,0);return{glPointSize:new o.nt(1),glPosition:new o.Zb(a,r,1),color:c}}_maybeWriteHittest(t){return null!=this.hittestRequest?t.color:null}}(0,n._)([s.E8],m.prototype,"inside",void 0),(0,n._)([s.E8],m.prototype,"outside",void 0),(0,n._)([(0,s.uK)(u)],m.prototype,"highlight",void 0),(0,n._)([(0,s.Pi)(c)],m.prototype,"storage",void 0),(0,n._)([(0,s.Pi)(d.o)],m.prototype,"view",void 0),(0,n._)([(0,s.uK)(h)],m.prototype,"hittestRequest",void 0)},74065:function(t,e,i){i.d(e,{L:function(){return u}});var n=i(53804),r=i(98282),s=i(70931),o=i(86486);class a extends r.ZA{}(0,n._)([(0,r.C5)(0,s.ZY)],a.prototype,"position",void 0);class l extends r.HS{}class c extends r.k2{}(0,n._)([(0,r.Pi)(s.z7)],c.prototype,"layerTexture",void 0),(0,n._)([(0,r.Pi)(s.z7)],c.prototype,"backbufferTexture",void 0),(0,n._)([(0,r.Pi)(s.nt)],c.prototype,"opacity",void 0),(0,n._)([(0,r.Pi)(s.nt)],c.prototype,"inFadeOpacity",void 0);class u extends r.A{vertex(t){return{uv:t.position,glPosition:new s.Zb((0,o.nb)(t.position),0,1)}}fragment(t){const e=new r.mm,i=(0,s.US)(this.config.layerTexture,t.uv),n=(0,s.US)(this.config.backbufferTexture,t.uv),a=(0,s.Tk)((0,s.LC)(i.a,new s.nt(0)),i.rgb,i.rgb.divide(i.a)),l=(0,s.Tk)((0,s.LC)(n.a,new s.nt(0)),n.rgb,n.rgb.divide(n.a)),c=this.config.opacity.multiply(i.a),u=n.a;switch(this.blendMode){case"destination-over":e.glFragColor=new s.Zb(a.multiply(c).multiply((0,o.zb)(u)).add(l.multiply(u)),c.add(u).subtract(c.multiply(u)));break;case"source-in":{const t=new s.Zb(a.multiply(c).multiply(u),c.multiply(u)),i=new s.Zb(l.multiply(u),u).multiply((0,o.zb)(this.config.opacity)).multiply(this.config.inFadeOpacity);e.glFragColor=t.add(i)}break;case"destination-in":{const t=new s.Zb(l.multiply(u).multiply(c),u.multiply(c)),i=new s.Zb(l.multiply(u),u).multiply(new s.Zb((0,o.zb)(this.config.opacity).multiply(this.config.inFadeOpacity)));e.glFragColor=t.add(i)}break;case"source-out":e.glFragColor=new s.Zb(a.multiply(c).multiply((0,o.zb)(u)),c.multiply((0,o.zb)(u)));break;case"destination-out":e.glFragColor=new s.Zb(l.multiply(u).multiply((0,o.zb)(c)),u.multiply((0,o.zb)(c)));break;case"source-atop":e.glFragColor=new s.Zb(a.multiply(c).multiply(u).add(l.multiply(u.multiply((0,o.zb)(c)))),u);break;case"destination-atop":e.glFragColor=new s.Zb(a.multiply(c.multiply((0,o.zb)(u))).add(l.multiply(u).multiply(c)),c);break;case"xor":e.glFragColor=new s.Zb(a.multiply(c.multiply((0,o.zb)(u))).add(l.multiply(u.multiply((0,o.zb)(c)))),c.multiply((0,o.zb)(u)).add(u.multiply((0,o.zb)(c))));break;case"multiply":e.glFragColor=new s.Zb(a.multiply(c).multiply(l.multiply(u)).add(a.multiply(c).multiply((0,o.zb)(u))).add(l.multiply(u).multiply((0,o.zb)(c))),c.add(u.multiply((0,o.zb)(c))));break;case"screen":e.glFragColor=new s.Zb(a.add(l).subtract(a.multiply(l)).multiply(c.multiply(u)).add(a.multiply(c).multiply((0,o.zb)(u))).add(l.multiply(u).multiply((0,o.zb)(c))),c.add(u.multiply((0,o.zb)(c))));break;case"overlay":{const t=new s.eB(d(l.r,a.r),d(l.g,a.g),d(l.b,a.b));e.glFragColor=h(t,a,l,c,u)}break;case"darken":{const t=(0,s.jk)(a,l);e.glFragColor=h(t,a,l,c,u)}break;case"lighter":e.glFragColor=new s.Zb(a.multiply(c).add(l.multiply(u)),c.add(u));break;case"lighten":{const t=(0,s.T9)(a,l);e.glFragColor=h(t,a,l,c,u)}break;case"color-dodge":{const t=(0,s.qE)(new s.eB(f(l.r,a.r),f(l.g,a.g),f(l.b,a.b)),new s.eB(0),new s.eB(1));e.glFragColor=h(t,a,l,c,u)}break;case"color-burn":{const t=new s.eB(p(l.r,a.r),p(l.g,a.g),p(l.b,a.b));e.glFragColor=h(t,a,l,c,u)}break;case"hard-light":{const t=new s.eB(_(l.r,a.r),_(l.g,a.g),_(l.b,a.b));e.glFragColor=h(t,a,l,c,u)}break;case"soft-light":{const t=new s.eB(m(l.r,a.r),m(l.g,a.g),m(l.b,a.b));e.glFragColor=h(t,a,l,c,u)}break;case"difference":{const t=(0,s.tn)(l.subtract(a));e.glFragColor=h(t,a,l,c,u)}break;case"exclusion":{const t=a.add(l).subtract(new s.nt(2).multiply(a).multiply(l));e.glFragColor=h(t,a,l,c,u)}break;case"invert":e.glFragColor=new s.Zb(new s.eB(1).subtract(l).multiply(c).multiply(u).add(l.multiply(u).multiply((0,o.zb)(c))),u);break;case"vivid-light":{const t=new s.eB((0,s.qE)(g(l.r,a.r),new s.nt(0),new s.nt(1)),(0,s.qE)(g(l.g,a.g),new s.nt(0),new s.nt(1)),(0,s.qE)(g(l.b,a.b),new s.nt(0),new s.nt(1)));e.glFragColor=h(t,a,l,c,u)}break;case"hue":{const t=w(a,l,l);e.glFragColor=h(t,a,l,c,u)}break;case"saturation":{const t=w(l,a,l);e.glFragColor=h(t,a,l,c,u)}break;case"color":{const t=S(a,l);e.glFragColor=h(t,a,l,c,u)}break;case"luminosity":{const t=S(l,a);e.glFragColor=h(t,a,l,c,u)}break;case"plus":e.glFragColor=(0,s.qE)(new s.Zb(i.r.add(l.r),i.g.add(l.g),i.b.add(l.b),c.add(u)),new s.Zb(0),new s.Zb(1));break;case"minus":e.glFragColor=new s.Zb((0,s.qE)(new s.eB(l.r.subtract(i.r),l.g.subtract(i.g),l.b.subtract(i.b)),new s.eB(0),new s.eB(1)),u.multiply(c));break;case"average":{const t=l.add(a).divide(2);e.glFragColor=h(t,a,l,c,u)}break;case"reflect":{const t=(0,s.qE)(new s.eB(T(l.r,a.r),T(l.g,a.g),T(l.b,a.b)),new s.eB(0),new s.eB(1));e.glFragColor=h(t,a,l,c,u)}break;default:e.glFragColor=i.multiply(this.config.opacity)}return e}}function h(t,e,i,n,r){return new s.Zb(t.multiply(n).multiply(r).add(e.multiply(n).multiply((0,o.zb)(r))).add(i.multiply(r).multiply((0,o.zb)(n))),n.add(r.multiply((0,o.zb)(n))))}function d(t,e){return new s.nt(1).subtract((0,s.PM)(new s.nt(.5),e)).multiply((0,o.zb)(new s.nt(2).multiply((0,o.zb)(e).multiply((0,o.zb)(t))))).add((0,s.PM)(new s.nt(.5),e).multiply(new s.nt(2).multiply(e).multiply(t)))}function f(t,e){return(0,s.Tk)((0,s.LC)(t,new s.nt(0)),new s.nt(0),(0,s.Tk)((0,s.LC)(e,new s.nt(1)),new s.nt(1),(0,s.jk)(new s.nt(1),t.divide(new s.nt(1).subtract(e)))))}function p(t,e){return(0,s.Tk)((0,s.LC)(t,new s.nt(1)),new s.nt(1),(0,s.Tk)((0,s.LC)(e,new s.nt(0)),new s.nt(0),(0,o.zb)((0,s.jk)(new s.nt(1),(0,o.zb)(t).divide(e)))))}function _(t,e){return new s.nt(1).subtract((0,s.PM)(new s.nt(.5),e)).multiply(new s.nt(2).multiply(e).multiply(t)).add((0,s.PM)(new s.nt(.5),e).multiply((0,o.zb)(new s.nt(2).multiply((0,o.zb)(e).multiply((0,o.zb)(t))))))}function m(t,e){return(0,s.j1)([(0,s.$5)(e,new s.nt(.5)),()=>{const i=new s.nt(2).multiply(e),n=(0,o.zb)(i),r=(0,o.zb)(t);return t.subtract(n.multiply(t).multiply(r))}],[(0,s.$5)(t,new s.nt(.25)),()=>{const i=new s.nt(2).multiply(e),n=(0,o.p8)(i).multiply(t),r=new s.nt(16).multiply(t).subtract(new s.nt(12)).multiply(t).add(new s.nt(3));return t.add(n.multiply(r))}],[!0,()=>{const i=new s.nt(2).multiply(e),n=(0,o.p8)(i),r=(0,s.RZ)(t).subtract(t);return t.add(n.multiply(r))}])}function g(t,e){const i=(0,o.zb)((0,s.PM)(new s.nt(.5),e)).multiply(p(t,new s.nt(2).multiply(e))),n=(0,s.PM)(new s.nt(.5),e).multiply(f(t,new s.nt(2).multiply((0,o.zy)(e,.5))));return i.add(n)}function y(t){return(0,s.jk)((0,s.jk)(t.r,t.g),t.b)}function v(t){return(0,s.T9)((0,s.T9)(t.r,t.g),t.b)}function x(t){return(0,s.Om)(t,new s.eB(.3,.59,.11))}function b(t){return v(t).subtract(y(t))}function S(t,e){const i=x(t),n=x(e).subtract(i);return function(t){const e=x(t),i=y(t),n=v(t);return(0,s.j1)([(0,s.Xe)(i,new s.nt(0)),()=>{const n=t.subtract(e).multiply(e),r=e.subtract(i);return e.add(n.divide(r))}],[(0,s.MM)(n,new s.nt(1)),()=>{const i=t.subtract(e),r=(0,o.zb)(e),s=i.multiply(r),a=n.subtract(e);return e.add(s.divide(a))}],[!0,t])}(t.add(new s.eB(n)))}function w(t,e,i){const n=y(t),r=b(t),o=b(e);return S((0,s.Tk)((0,s.MM)(r,new s.nt(0)),(()=>t.subtract(n).multiply(o).divide(r)),new s.eB(0)),i)}function T(t,e){return(0,s.Tk)((0,s.LC)(e,new s.nt(1)),e,(()=>{const i=(0,o.zb)(e),n=t.multiply(t).divide(i);return(0,s.jk)(n,new s.nt(1))}))}(0,n._)([r.E8],u.prototype,"blendMode",void 0),(0,n._)([(0,r.Pi)(c)],u.prototype,"config",void 0),(0,n._)([(0,n.a)(0,(0,r.hF)(a))],u.prototype,"vertex",null),(0,n._)([(0,n.a)(0,(0,r.hF)(l))],u.prototype,"fragment",null)},58991:function(t,e,i){i.d(e,{Bh:function(){return _},KP:function(){return p},Ps:function(){return m}});var n=i(53804),r=i(98282),s=i(70931),o=i(33702),a=i(40846),l=i(42203),c=i(31299),u=i(39979),h=i(86486);class d extends l._{}(0,n._)([(0,r.C5)(5,s.Zb)],d.prototype,"tlbr",void 0),(0,n._)([(0,r.C5)(6,s.nt)],d.prototype,"width",void 0),(0,n._)([(0,r.C5)(7,s.nt)],d.prototype,"height",void 0),(0,n._)([(0,r.C5)(8,s.ZY)],d.prototype,"offset",void 0),(0,n._)([(0,r.C5)(9,s.ZY)],d.prototype,"scale",void 0),(0,n._)([(0,r.C5)(10,s.nt)],d.prototype,"angle",void 0);class f extends o.DM{}function p(t,e){const i=t.view.requiredZoomFactor,n=new s.ZY(e.width,e.height),r=n.multiply(e.scale).multiply(i),o=e.angle.multiply(a.rp),l=(0,s.F8)(o),c=(0,s.gn)(o),u=function(t,e,i,n,r){const o=(0,s.LC)((0,h.mh)(r,a.Fz),(0,s.fV)(1)),l=(0,h.Rj)(new s.Zb(t,0));return(0,s.Tk)(o,(0,s.w0)(n.divide(e.x),i.divide(e.y),0,(0,s.ze)(i.divide(e.x)),n.divide(e.y),0,(0,h._9)((0,s.Zc)(l,0)),(0,h._9)((0,s.Zc)(0,l)),1),(0,s.w0)(n.divide(e.x),i.divide(e.y),0,(0,s.ze)(i.divide(e.x)),n.divide(e.y),0,0,0,1))}(e.id,r,l,c,e.bitset),d=t.localTileOffset.getPatternOffsetAtTileOrigin(n,l,c),f=i.multiply(e.scale).multiply(e.offset.subtract(d)).divide(r),p=new s.eB(e.pos,1),_=u.multiply(p).xy.subtract(f),m=e.tlbr.divide(t.mosaicInfo.size.xyxy);let g=(0,h.mh)(e.bitset,a.cn);return null!=t.visualVariableColor&&(g=(0,s.Tk)((0,h.M8)(t.storage.getColorValue(e.id)),new s.nt(0),g)),{tileTextureCoord:_,tlbr:m,sampleAlphaOnly:g}}function _(t,e){const i=(0,s.zi)(e.tileTextureCoord,new s.nt(1)),n=(0,s.jh)(e.tlbr.xy,e.tlbr.zw,i);let r=(0,s.US)(t.mosaicInfo.texture,n);return r=(0,s.Tk)((0,s.MM)(e.sampleAlphaOnly,new s.nt(.5)),r.aaaa,r),e.color.multiply(r)}class m extends l.z{vertex(t,e){return{...super.vertex(t,e),...p(this,t)}}fragment(t){const e=_(this,t);return this.getFragmentOutput(e,t,new s.nt(0))}}(0,n._)([(0,r.Pi)(u.b)],m.prototype,"mosaicInfo",void 0),(0,n._)([(0,r.Pi)(c.P)],m.prototype,"localTileOffset",void 0),(0,n._)([(0,n.a)(0,(0,r.hF)(d)),(0,n.a)(1,(0,r.hF)(o.$Z))],m.prototype,"vertex",null),(0,n._)([(0,n.a)(0,(0,r.hF)(f))],m.prototype,"fragment",null)},47461:function(t,e,i){i.d(e,{RH:function(){return v},cZ:function(){return p},v9:function(){return m}});var n=i(53804),r=i(98282),s=i(70931),o=i(33702),a=i(58991),l=i(66425),c=i(59224),u=i(31299),h=i(39979),d=i(54537),f=i(15087);const p=16,_=1/p,m=128;class g extends o.rz{}(0,n._)([(0,r.C5)(3,s.Zb)],g.prototype,"color",void 0),(0,n._)([(0,r.C5)(4,s.Zb)],g.prototype,"tlbr",void 0),(0,n._)([(0,r.C5)(5,s.nt)],g.prototype,"angle",void 0),(0,n._)([(0,r.C5)(6,s.nt)],g.prototype,"aux1",void 0),(0,n._)([(0,r.C5)(7,s.nt)],g.prototype,"aux2",void 0),(0,n._)([(0,r.C5)(8,s.ZY)],g.prototype,"aux3",void 0),(0,n._)([(0,r.C5)(9,s.ZY)],g.prototype,"aux4",void 0),(0,n._)([(0,r.C5)(10,s.ZY)],g.prototype,"zoomRange",void 0);class y extends f.A1{}class v extends d.My{vertex(t,e){const{aux1:i,aux2:n,aux3:r,aux4:o}=t,l={...t,width:i,height:n,offset:r,scale:o.multiply(_)},c={...t,halfWidth:i,referenceHalfWidth:n,offset:r,normal:o.subtract(m).multiply(_)},u=(0,d.Yb)(this,c),h=(0,a.KP)(this,l),f=(0,s.MM)(u.isOutline,new s.nt(.5));return{...u,...h,...this.maybeRunHittest(t,e,f)}}fragment(t){const{isOutline:e}=t,i=(0,s.MM)(e,new s.nt(.5)),n=(0,c.o7)(t,this.antialiasingControls.blur),r=(0,a.Bh)(this,t),o=(0,s.Tk)(i,n,r),l=(0,s.Tk)(i,new s.nt(1/255),new s.nt(0));return this.getFragmentOutput(o,t,l)}hittest(t,e,i){return(0,s.Tk)(i,(0,l.My)(this.hittestRequest),(0,l.Lq)(this,t,e))}}(0,n._)([(0,r.Pi)(h.b)],v.prototype,"mosaicInfo",void 0),(0,n._)([(0,r.Pi)(u.P)],v.prototype,"localTileOffset",void 0),(0,n._)([(0,n.a)(0,(0,r.hF)(g)),(0,n.a)(1,(0,r.hF)(o.$Z))],v.prototype,"vertex",null),(0,n._)([(0,n.a)(0,(0,r.hF)(y))],v.prototype,"fragment",null)},42203:function(t,e,i){i.d(e,{_:function(){return h},z:function(){return d}});var n=i(53804),r=i(98282),s=i(70931),o=i(33702),a=i(66425),l=i(81432),c=i(12026),u=i(90906);class h extends o.rz{}(0,n._)([(0,r.C5)(3,s.Zb)],h.prototype,"color",void 0),(0,n._)([(0,r.C5)(4,s.ZY)],h.prototype,"zoomRange",void 0);class d extends o.f_{constructor(){super(...arguments),this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(t,e){const i=(0,u.cF)(this,t.id),n=(0,u.G7)(this,t.id,t.color).multiply(i),r=this.view.displayViewScreenMat3.multiply(new s.eB(t.pos.xy,1)),o=this.clip(t.id,t.zoomRange);return{glPosition:new s.Zb(r.xy,o,1),color:n,...this.maybeRunHittest(t,e,null)}}fragment(t){return this.getFragmentOutput(t.color,t,new s.nt(0))}hittest(t,e){return(0,a.Lq)(this,t,e)}}(0,n._)([(0,r.uK)(l._)],d.prototype,"visualVariableColor",void 0),(0,n._)([(0,r.uK)(c.i)],d.prototype,"visualVariableOpacity",void 0),(0,n._)([(0,n.a)(0,(0,r.hF)(h)),(0,n.a)(1,(0,r.hF)(o.$Z))],d.prototype,"vertex",null),(0,n._)([(0,n.a)(0,(0,r.hF)(o.DM))],d.prototype,"fragment",null)},98578:function(t,e,i){i.d(e,{K:function(){return u}});var n=i(53804),r=i(98282),s=i(70931);class o extends r.ZA{}(0,n._)([(0,r.C5)(0,s.ZY)],o.prototype,"position",void 0);class a extends r.HS{}class l extends r.k2{}(0,n._)([(0,r.Pi)(s.U)],l.prototype,"dvs",void 0);class c extends r.k2{}(0,n._)([(0,r.Pi)(s.nt)],c.prototype,"halfWidth",void 0),(0,n._)([(0,r.Pi)(s.nt)],c.prototype,"aaWidth",void 0),(0,n._)([(0,r.Pi)(s.nt)],c.prototype,"pxPerCell",void 0),(0,n._)([(0,r.Pi)(s.Zb)],c.prototype,"minorLineColor",void 0),(0,n._)([(0,r.Pi)(s.Zb)],c.prototype,"majorLineColor",void 0),(0,n._)([(0,r.Pi)(s.Ai)],c.prototype,"majorLineInterval",void 0);class u extends r.A{vertex(t){const e=t.position.multiply(2).subtract(1);return{gridPos:this.transform.dvs.multiply(new s.eB(e,1)).xy,glPosition:new s.Zb(e,0,1)}}fragment(t){const e=(0,s.tn)(t.gridPos),i=(0,s.jc)(e),n=(0,s.jk)(i.x,new s.nt(1).subtract(i.x)),o=(0,s.jk)(i.y,new s.nt(1).subtract(i.y)),a=new s.ZY(n,o).multiply(this.config.pxPerCell).subtract(this.config.halfWidth),l=(0,s.jk)(a.x,a.y),c=new s.nt(1).subtract((0,s.TF)(new s.nt(0),this.config.aaWidth,l)),u=new s.Ai((0,s.LI)(e.x)),h=new s.Ai((0,s.LI)(e.y)),d=new s.nt((0,s.Gb)(u,this.config.majorLineInterval)),f=new s.nt((0,s.Gb)(h,this.config.majorLineInterval)),p=(0,s.Tk)((0,s.Xe)(a.x,a.y),d,f),_=(0,s.MM)((0,s.lw)((0,s.PM)(a.x,this.config.aaWidth),(0,s.PM)(a.y,this.config.aaWidth)),new s.nt(.5)),m=(0,s.jk)(d,f),g=(0,s.Tk)(_,m,p),y=(0,s.jh)(this.config.majorLineColor,this.config.minorLineColor,(0,s.jk)(g,new s.nt(1))),v=new r.mm;return v.glFragColor=y.multiply(c),v}}(0,n._)([(0,r.Pi)(l)],u.prototype,"transform",void 0),(0,n._)([(0,r.Pi)(c)],u.prototype,"config",void 0),(0,n._)([(0,n.a)(0,(0,r.hF)(o))],u.prototype,"vertex",null),(0,n._)([(0,n.a)(0,(0,r.hF)(a))],u.prototype,"fragment",null)},59224:function(t,e,i){i.d(e,{$0:function(){return b},Xc:function(){return m},cM:function(){return w},fF:function(){return g},fg:function(){return y},o7:function(){return S},xw:function(){return x}});var n=i(53804),r=i(98282),s=i(70931),o=i(33702),a=i(40846),l=i(66425),c=i(81432),u=i(12026),h=i(13635),d=i(21385),f=i(21813),p=i(76347),_=i(90906);class m extends o.rz{}(0,n._)([(0,r.C5)(3,s.Zb)],m.prototype,"color",void 0),(0,n._)([(0,r.C5)(4,s.ZY)],m.prototype,"offset",void 0),(0,n._)([(0,r.C5)(5,s.ZY)],m.prototype,"normal",void 0),(0,n._)([(0,r.C5)(6,s.nt)],m.prototype,"halfWidth",void 0),(0,n._)([(0,r.C5)(7,s.nt)],m.prototype,"referenceHalfWidth",void 0),(0,n._)([(0,r.C5)(8,s.ZY)],m.prototype,"zoomRange",void 0);class g extends o.DM{}class y extends r.k2{}function v(t){return(0,s.T9)(new s.nt(a.Fb).multiply((0,s.PM)(t,new s.nt(a.J5))),new s.nt(1))}function x(t,e){const{halfWidth:i,normal:n}=t,r=v(i),o=(0,s.Bw)(n).multiply(i);return(0,s.qE)(r.multiply(i.subtract(o)).divide(e.add(r).subtract(new s.nt(1))),new s.nt(0),new s.nt(1))}function b(t,e){const{id:i,offset:n,pos:r,normal:o,zoomRange:l}=e,{displayViewScreenMat3:c,displayViewMat3:u}=t.view,h=(0,_.G7)(t,i,e.color),d=(0,_.cF)(t,i),f=function(t,e){const{id:i,halfWidth:n,referenceHalfWidth:r}=e;if((0,_.G5)(t)){const e=new s.nt(2).multiply(r),o=(0,_.Mg)(t,i,e);return new s.nt(.5).multiply(n.divide((0,s.T9)(r,new s.nt(a.Ni)))).multiply(o)}return n}(t,e),p=new s.nt(.5).multiply(t.antialiasingControls.antialiasing),m=(0,s.T9)(f.add(p),new s.nt(.45)).add(new s.nt(.1).multiply(p)),g=v(m).multiply(m).multiply(n),y=u.multiply(new s.eB(g,new s.nt(0))),x=c.multiply(new s.eB(r,new s.nt(1))).add(y),b=new s.nt(2).multiply((0,s.PM)(f,new s.nt(0))).add(t.clip(i,l)),S=new s.Zb(x.xy,b,1);return{color:h,opacity:d,halfWidth:m,normal:o,scaledOffset:g,scaledHalfWidth:f,glPosition:new s.Zb(S.xy,b,1)}}function S(t,e){const{opacity:i,color:n}=t,r=x(t,e);return i.multiply(n).multiply(r)}(0,n._)([(0,r.Pi)(s.nt)],y.prototype,"antialiasing",void 0),(0,n._)([(0,r.Pi)(s.nt)],y.prototype,"blur",void 0);class w extends o.f_{constructor(){super(...arguments),this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(t,e){const i=b(this,t);return{...i,...this.maybeRunHittest(t,e,i.halfWidth)}}fragment(t){const e=S(t,this.antialiasingControls.blur);return this.getFragmentOutput(e,t)}hittest(t,e,i){const{viewMat3:n,tileMat3:r}=this.view,o=n.multiply(r),a=o.multiply(new s.eB(t.pos,1)),c=o.multiply(new s.eB(e.nextPos1,1)),u=o.multiply(new s.eB(e.nextPos2,1)),{distance:h,smallSymbolDistance:d,smallSymbolSizeThreshold:f}=this.hittestRequest,p=(0,s.PM)(i,f.multiply(.5)).multiply(h.subtract(d)),_=this.hittestRequest.position;return(0,s.jk)((0,l.E2)(_,a.xy,c.xy),(0,l.E2)(_,a.xy,u.xy)).subtract(i).add(p)}}(0,n._)([(0,r.Pi)(y)],w.prototype,"antialiasingControls",void 0),(0,n._)([(0,r.uK)(c._)],w.prototype,"visualVariableColor",void 0),(0,n._)([(0,r.uK)(u.i)],w.prototype,"visualVariableOpacity",void 0),(0,n._)([(0,r.uK)(h.n)],w.prototype,"visualVariableSizeMinMaxValue",void 0),(0,n._)([(0,r.uK)(d.F)],w.prototype,"visualVariableSizeScaleStops",void 0),(0,n._)([(0,r.uK)(f.N)],w.prototype,"visualVariableSizeStops",void 0),(0,n._)([(0,r.uK)(p.d)],w.prototype,"visualVariableSizeUnitValue",void 0),(0,n._)([(0,n.a)(0,(0,r.hF)(m)),(0,n.a)(1,(0,r.hF)(o.$Z))],w.prototype,"vertex",null),(0,n._)([(0,n.a)(0,(0,r.hF)(g))],w.prototype,"fragment",null)},31299:function(t,e,i){i.d(e,{P:function(){return a}});var n=i(53804),r=i(98282),s=i(70931),o=i(40846);class a extends r.k2{getPatternOffsetAtTileOrigin(t,e=new s.nt(0),i=new s.nt(1)){const n=new s.ZY(o.YV).divide(t);let r=t.multiply((0,s.jc)(this.maxIntsToLocalOrigin.multiply(n))).add(this.tileOffsetFromLocalOrigin).subtract(new s.nt(.5).multiply(t));return r=new s.ZY(r.x.multiply(i).subtract(r.y.multiply(e)),r.x.multiply(e).add(r.y.multiply(i))),(0,s.zi)(r,t)}}(0,n._)([(0,r.Pi)(s.ZY)],a.prototype,"tileOffsetFromLocalOrigin",void 0),(0,n._)([(0,r.Pi)(s.ZY)],a.prototype,"maxIntsToLocalOrigin",void 0)},8626:function(t,e,i){i.d(e,{u:function(){return u}});var n=i(53804),r=i(98282),s=i(70931),o=i(40846);class a extends r.ZA{}(0,n._)([(0,r.C5)(0,s.ZY)],a.prototype,"position",void 0);class l extends r.HS{}class c extends r.k2{}(0,n._)([(0,r.Pi)(s.z7)],c.prototype,"readbackTexture",void 0),(0,n._)([(0,r.Pi)(s.z7)],c.prototype,"maskTexture",void 0),(0,n._)([(0,r.Pi)(s.z7)],c.prototype,"overlayTexture",void 0),(0,n._)([(0,r.Pi)(s.Zb)],c.prototype,"background",void 0),(0,n._)([(0,r.Pi)(s.Zb)],c.prototype,"drawPos",void 0),(0,n._)([(0,r.Pi)(s.nt)],c.prototype,"maskEnabled",void 0),(0,n._)([(0,r.Pi)(s.nt)],c.prototype,"overlayEnabled",void 0);class u extends r.A{vertex(t){const e=t.position,i=t.position.subtract(new s.ZY(.5)).multiply(this.config.drawPos.zw),n=this.config.drawPos.xy.add(i);return{glPosition:new s.Zb(n,0,1),texCoord:e}}fragment(t){let e=(0,s.US)(this.config.readbackTexture,function(t){const e=t.multiply(new s.ZY(2)).subtract(1);return(0,s.Tk)((0,s.LC)(e.x,new s.nt(0)).and((0,s.LC)(e.y,new s.nt(0))),new s.ZY(.5),(()=>{const t=(0,s.rY)(e.y,e.x),i=(0,s.n7)((0,s.Bw)(e),new s.nt(o.eo)),n=new s.ZY((0,s.gn)(t),(0,s.F8)(t));return i.multiply(n).multiply(new s.ZY(.5)).add(new s.nt(.5))}))}(t.texCoord));e=e.add(new s.nt(1).subtract(e.a)).multiply(this.config.background);const i=(0,s.Tk)((0,s.LC)(this.config.maskEnabled,new s.nt(1)),(0,s.US)(this.config.maskTexture,t.texCoord).a,new s.nt(1));e=e.multiply(i);const n=(0,s.Tk)((0,s.LC)(this.config.overlayEnabled,new s.nt(1)),(0,s.US)(this.config.overlayTexture,t.texCoord),new s.Zb(0)),a=new r.mm;return a.glFragColor=n.add(new s.nt(1).subtract(n.a).multiply(e)),a}}(0,n._)([(0,r.Pi)(c)],u.prototype,"config",void 0),(0,n._)([(0,n.a)(0,(0,r.hF)(a))],u.prototype,"vertex",null),(0,n._)([(0,n.a)(0,(0,r.hF)(l))],u.prototype,"fragment",null)},39979:function(t,e,i){i.d(e,{b:function(){return o}});var n=i(53804),r=i(98282),s=i(70931);class o extends r.k2{}(0,n._)([(0,r.Pi)(s.ZY)],o.prototype,"size",void 0),(0,n._)([(0,r.Pi)(s.z7)],o.prototype,"texture",void 0)},4935:function(t,e,i){i.d(e,{x:function(){return c}});var n=i(53804),r=i(98282),s=i(70931);class o extends r.ZA{}(0,n._)([(0,r.C5)(0,s.ZY)],o.prototype,"position",void 0);class a extends r.HS{}class l extends r.k2{}(0,n._)([(0,r.Pi)(s.z7)],l.prototype,"layerTexture",void 0),(0,n._)([(0,r.Pi)(s.nt)],l.prototype,"opacity",void 0);class c extends r.A{vertex(t){return{uv:t.position,glPosition:new s.Zb(t.position.subtract(new s.ZY(.5)).multiply(2),0,1)}}fragment(t){const e=new r.mm;return e.glFragColor=(0,s.US)(this.config.layerTexture,t.uv).multiply(this.config.opacity),e}}(0,n._)([(0,r.Pi)(l)],c.prototype,"config",void 0),(0,n._)([(0,n.a)(0,(0,r.hF)(o))],c.prototype,"vertex",null),(0,n._)([(0,n.a)(0,(0,r.hF)(a))],c.prototype,"fragment",null)},54537:function(t,e,i){i.d(e,{A7:function(){return v},My:function(){return b},Yb:function(){return x},nj:function(){return S},wG:function(){return y}});var n=i(53804),r=i(98282),s=i(70931),o=i(33702),a=i(40846),l=i(66425),c=i(59224),u=i(86486),h=i(81432),d=i(12026),f=i(13635),p=i(21385),_=i(21813),m=i(76347),g=i(90906);class y extends o.rz{}(0,n._)([(0,r.C5)(3,s.ZY)],y.prototype,"offset",void 0),(0,n._)([(0,r.C5)(4,s.Zb)],y.prototype,"color",void 0),(0,n._)([(0,r.C5)(5,s.ZY)],y.prototype,"normal",void 0),(0,n._)([(0,r.C5)(6,s.nt)],y.prototype,"halfWidth",void 0),(0,n._)([(0,r.C5)(7,s.nt)],y.prototype,"referenceHalfWidth",void 0),(0,n._)([(0,r.C5)(8,s.ZY)],y.prototype,"zoomRange",void 0);class v extends c.fF{}function x(t,e,i){const{id:n,bitset:r}=e,o=(0,u.mh)(r,a.Xx),l=(0,s.MM)(o,new s.nt(.5)),h=(0,c.$0)(t,e),d=(0,s.Tk)(l,h.halfWidth,new s.nt(0)),f=(0,g.cF)(t,n),p=(0,g.G7)(t,n,e.color),_=(0,s.Tk)(l,e.color,p.multiply(f)),m=t.view.displayViewScreenMat3.multiply(new s.eB(e.pos.xy,1)),y=t.clip(e.id),v=new s.Zb(m.xy,y,1),x=(0,s.Tk)(l,h.glPosition,v),b=i&&t.maybeRunHittest(e,i,l);return{isOutline:o,color:_,opacity:new s.nt(1),halfWidth:d,normal:h.normal,glPosition:x,...b}}class b extends o.f_{constructor(){super(...arguments),this.computeAttributes={pos:["nextPos1","nextPos2"]}}}(0,n._)([(0,r.Pi)(c.fg)],b.prototype,"antialiasingControls",void 0),(0,n._)([(0,r.uK)(h._)],b.prototype,"visualVariableColor",void 0),(0,n._)([(0,r.uK)(d.i)],b.prototype,"visualVariableOpacity",void 0),(0,n._)([(0,r.uK)(f.n)],b.prototype,"visualVariableSizeMinMaxValue",void 0),(0,n._)([(0,r.uK)(p.F)],b.prototype,"visualVariableSizeScaleStops",void 0),(0,n._)([(0,r.uK)(_.N)],b.prototype,"visualVariableSizeStops",void 0),(0,n._)([(0,r.uK)(m.d)],b.prototype,"visualVariableSizeUnitValue",void 0);class S extends b{vertex(t,e){return x(this,t,e)}fragment(t){const{color:e,isOutline:i}=t,n=(0,s.MM)(i,new s.nt(.5)),r=(0,c.o7)(t,this.antialiasingControls.blur),o=(0,s.Tk)(n,r,e),a=(0,s.Tk)(n,new s.nt(1/255),new s.nt(0));return this.getFragmentOutput(o,t,a)}hittest(t,e,i){return(0,s.Tk)(i,(0,l.My)(this.hittestRequest),(0,l.Lq)(this,t,e))}}(0,n._)([(0,n.a)(0,(0,r.hF)(y)),(0,n.a)(1,(0,r.hF)(o.$Z))],S.prototype,"vertex",null),(0,n._)([(0,n.a)(0,(0,r.hF)(v))],S.prototype,"fragment",null)},51741:function(t,e,i){i.d(e,{_u:function(){return d},dW:function(){return f},vx:function(){return p}});var n=i(53804),r=i(98282),s=i(70931),o=i(33702),a=i(42203),l=i(31299),c=i(39979);class u extends a._{}(0,n._)([(0,r.C5)(5,s.Zb)],u.prototype,"tlbr",void 0),(0,n._)([(0,r.C5)(6,s.nt)],u.prototype,"inverseRasterizationScale",void 0);class h extends o.DM{}function d(t,e){const i=e.tlbr.xy,n=e.tlbr.zw,r=n.x.subtract(i.x),o=i.y.subtract(n.y),a=new s.ZY(r,o).multiply(e.inverseRasterizationScale),l=a.multiply(t.view.requiredZoomFactor),c=function(t){const e=new s.nt(1),i=new s.nt(0);return new s.U(e.divide(t.x),i.divide(t.y),0,(0,s.ze)(i.divide(t.x)),e.divide(t.y),0,0,0,1)}(l),u=t.localTileOffset.getPatternOffsetAtTileOrigin(a).divide(l),h=new s.eB(e.pos,1);return{tileTextureCoord:c.multiply(h).xy.subtract(u),tlbr:e.tlbr.divide(t.mosaicInfo.size.xyxy)}}function f(t,e){const i=(0,s.zi)(t.tileTextureCoord,new s.nt(1)),n=(0,s.jh)(t.tlbr.xy,t.tlbr.zw,i),r=(0,s.US)(e.texture,n);return t.color.multiply(r)}class p extends a.z{vertex(t,e){return{...super.vertex(t,e),...d(this,t)}}fragment(t){const e=f(t,this.mosaicInfo);return this.getFragmentOutput(e,t,new s.nt(0))}}(0,n._)([(0,r.Pi)(c.b)],p.prototype,"mosaicInfo",void 0),(0,n._)([(0,r.Pi)(l.P)],p.prototype,"localTileOffset",void 0),(0,n._)([(0,n.a)(0,(0,r.hF)(u)),(0,n.a)(1,(0,r.hF)(o.$Z))],p.prototype,"vertex",null),(0,n._)([(0,n.a)(0,(0,r.hF)(h))],p.prototype,"fragment",null)},15087:function(t,e,i){i.d(e,{A1:function(){return f},tA:function(){return p}});var n=i(53804),r=i(98282),s=i(70931),o=i(33702),a=i(59224),l=i(31299),c=i(39979),u=i(54537),h=i(51741);class d extends u.wG{}(0,n._)([(0,r.C5)(9,s.Zb)],d.prototype,"tlbr",void 0),(0,n._)([(0,r.C5)(10,s.nt)],d.prototype,"inverseRasterizationScale",void 0);class f extends u.A7{}class p extends u.nj{vertex(t,e){return{...(0,u.Yb)(this,t,e),...(0,h._u)(this,t)}}fragment(t){const{isOutline:e}=t,i=(0,s.MM)(e,new s.nt(.5)),n=(0,a.o7)(t,this.antialiasingControls.blur),r=(0,h.dW)(t,this.mosaicInfo),o=(0,s.Tk)(i,n,r),l=(0,s.Tk)(i,new s.nt(1/255),new s.nt(0));return this.getFragmentOutput(o,t,l)}}(0,n._)([(0,r.Pi)(c.b)],p.prototype,"mosaicInfo",void 0),(0,n._)([(0,r.Pi)(l.P)],p.prototype,"localTileOffset",void 0),(0,n._)([(0,n.a)(0,(0,r.hF)(d)),(0,n.a)(1,(0,r.hF)(o.$Z))],p.prototype,"vertex",null),(0,n._)([(0,n.a)(0,(0,r.hF)(f))],p.prototype,"fragment",null)},64522:function(t,e,i){i.d(e,{o:function(){return o}});var n=i(53804),r=i(98282),s=i(70931);class o extends r.k2{}(0,n._)([(0,r.Pi)(s.U)],o.prototype,"displayViewScreenMat3",void 0),(0,n._)([(0,r.Pi)(s.U)],o.prototype,"displayViewMat3",void 0),(0,n._)([(0,r.Pi)(s.U)],o.prototype,"displayMat3",void 0),(0,n._)([(0,r.Pi)(s.U)],o.prototype,"viewMat3",void 0),(0,n._)([(0,r.Pi)(s.U)],o.prototype,"tileMat3",void 0),(0,n._)([(0,r.Pi)(s.nt)],o.prototype,"displayZoomFactor",void 0),(0,n._)([(0,r.Pi)(s.nt)],o.prototype,"requiredZoomFactor",void 0),(0,n._)([(0,r.Pi)(s.ZY)],o.prototype,"tileOffset",void 0),(0,n._)([(0,r.Pi)(s.nt)],o.prototype,"currentScale",void 0),(0,n._)([(0,r.Pi)(s.nt)],o.prototype,"currentZoom",void 0),(0,n._)([(0,r.Pi)(s.nt)],o.prototype,"metersPerSRUnit",void 0),(0,n._)([(0,r.Pi)(s.nt)],o.prototype,"rotation",void 0),(0,n._)([(0,r.Pi)(s.nt)],o.prototype,"pixelRatio",void 0)},81432:function(t,e,i){i.d(e,{_:function(){return a}});var n=i(53804),r=i(98282),s=i(70931),o=i(86486);class a extends r.k2{getColor(t,e,i){return(0,s.j1)([(0,s.or)((0,o.M8)(t),i),e],[(0,s.$5)(t,this.values.first()),this.colors.first()],[(0,s.aX)(t,this.values.last()),this.colors.last()],[!0,()=>{const e=this.values.findIndex((e=>(0,s.MM)(e,t))),i=this.values.get(e),n=e.subtract(1),r=this.values.get(n),o=t.subtract(r).divide(i.subtract(r));return(0,s.jh)(this.colors.get(n),this.colors.get(e),o)}])}}(0,n._)([(0,r.Pi)(s.My.ofType(s.Zb,8))],a.prototype,"colors",void 0),(0,n._)([(0,r.Pi)(s.My.ofType(s.nt,8))],a.prototype,"values",void 0)},12026:function(t,e,i){i.d(e,{i:function(){return a}});var n=i(53804),r=i(98282),s=i(70931),o=i(86486);class a extends r.k2{getOpacity(t){return(0,s.j1)([(0,o.M8)(t),new s.nt(1)],[(0,s.$5)(t,this.opacityValues.first()),this.opacities.first()],[(0,s.aX)(t,this.opacityValues.last()),this.opacities.last()],[!0,()=>{const e=this.opacityValues.findIndex((e=>(0,s.MM)(e,t))),i=this.opacityValues.get(e),n=e.subtract(1),r=this.opacityValues.get(n),o=t.subtract(r).divide(i.subtract(r));return(0,s.jh)(this.opacities.get(n),this.opacities.get(e),o)}])}}(0,n._)([(0,r.Pi)(s.My.ofType(s.nt,8))],a.prototype,"opacities",void 0),(0,n._)([(0,r.Pi)(s.My.ofType(s.nt,8))],a.prototype,"opacityValues",void 0)},13635:function(t,e,i){i.d(e,{n:function(){return a}});var n=i(53804),r=i(98282),s=i(70931),o=i(86486);class a extends r.k2{getSize(t,e){const i=this.minMaxValueAndSize.xy,n=this.minMaxValueAndSize.zw;return(0,s.Tk)((0,o.M8)(t),e,(()=>{const e=t.subtract(i.x).divide(i.y.subtract(i.x)),r=(0,s.qE)(e,new s.nt(0),new s.nt(1));return n.x.add(r.multiply(n.y.subtract(n.x)))}))}}(0,n._)([(0,r.Pi)(s.Zb)],a.prototype,"minMaxValueAndSize",void 0)},21385:function(t,e,i){i.d(e,{F:function(){return o}});var n=i(53804),r=i(98282),s=i(70931);class o extends r.k2{getSizeForViewScale(t){return(0,s.j1)([(0,s.$5)(t,this.values.first()),this.sizes.first()],[(0,s.aX)(t,this.values.last()),this.sizes.last()],[!0,()=>{const e=this.values.findIndex((e=>(0,s.MM)(e,t))),i=this.values.get(e),n=e.subtract(1),r=this.values.get(n),o=t.subtract(r).divide(i.subtract(r));return(0,s.jh)(this.sizes.get(n),this.sizes.get(e),o)}])}}(0,n._)([(0,r.Pi)(s.My.ofType(s.nt,8))],o.prototype,"sizes",void 0),(0,n._)([(0,r.Pi)(s.My.ofType(s.nt,8))],o.prototype,"values",void 0)},21813:function(t,e,i){i.d(e,{N:function(){return a}});var n=i(53804),r=i(98282),s=i(70931),o=i(86486);class a extends r.k2{getSize(t,e){const i=(0,s.j1)([(0,o.M8)(t),e],[(0,s.$5)(t,this.values.first()),this.sizes.first()],[(0,s.aX)(t,this.values.last()),this.sizes.last()],[!0,()=>{const e=this.values.findIndex((e=>(0,s.MM)(e,t))),i=this.values.get(e),n=e.subtract(1),r=this.values.get(n),o=t.subtract(r).divide(i.subtract(r));return(0,s.jh)(this.sizes.get(n),this.sizes.get(e),o)}]);return(0,s.Tk)((0,o.M8)(i),e,i)}}(0,n._)([(0,r.Pi)(s.My.ofType(s.nt,8))],a.prototype,"sizes",void 0),(0,n._)([(0,r.Pi)(s.My.ofType(s.nt,8))],a.prototype,"values",void 0)},76347:function(t,e,i){i.d(e,{d:function(){return a}});var n=i(53804),r=i(98282),s=i(70931),o=i(86486);class a extends r.k2{getSize(t,e){return(0,s.Tk)((0,o.M8)(t),e,t.multiply(this.unitValueToPixelsRatio))}}(0,n._)([(0,r.Pi)(s.nt)],a.prototype,"unitValueToPixelsRatio",void 0)},40846:function(t,e,i){var n;i.d(e,{$w:function(){return u},Fb:function(){return a},Fz:function(){return m},H_:function(){return n},J5:function(){return l},M:function(){return d},Ni:function(){return h},V5:function(){return o},Xx:function(){return _},YV:function(){return b},au:function(){return c},b5:function(){return y},bg:function(){return v},cn:function(){return p},eo:function(){return S},kx:function(){return g},os:function(){return r},qM:function(){return f},rp:function(){return s},ti:function(){return x}}),function(t){t[t.Geographic=0]="Geographic",t[t.Arithmatic=1]="Arithmatic"}(n||(n={}));const r=3.14159265359/180,s=3.14159265359/128,o=1,a=1.1,l=1,c=24,u=8,h=1e-5,d=.05,f=1e-30,p=4,_=0,m=2,g=2,y=3,v=0,x=3,b=16777216,S=1.1},66425:function(t,e,i){i.d(e,{Bo:function(){return u},Bs:function(){return l},E2:function(){return o},Lq:function(){return d},My:function(){return h},g$:function(){return f},kW:function(){return a}});var n=i(70931),r=i(40846),s=i(86486);function o(t,e,i){const r=i.subtract(e),s=(a=t.subtract(e),l=r,(0,n.Om)(a,(0,n.S8)(l))),o=(0,n.qE)(s.divide((0,n.Bw)(r)),new n.nt(0),new n.nt(1));var a,l;return(0,n.Io)(t,e.add(o.multiply(i.subtract(e))))}function a(t){const e=(0,n.tn)(t);return(0,n.PM)(e.x.add(e.y).add(e.z),new n.nt(1.05))}function l(t,e,i,r){const s=new n.U(i.x.multiply(r.y).subtract(r.x.multiply(i.y)),r.x.multiply(e.y).subtract(e.x.multiply(r.y)),e.x.multiply(i.y).subtract(i.x.multiply(e.y)),i.y.subtract(r.y),r.y.subtract(e.y),e.y.subtract(i.y),r.x.subtract(i.x),e.x.subtract(r.x),i.x.subtract(e.x)),o=e.x.multiply(i.y.subtract(r.y)),a=i.x.multiply(r.y.subtract(e.y)),l=r.x.multiply(e.y.subtract(i.y)),c=o.add(a).add(l);return new n.nt(1).divide(c).multiply(s.multiply(new n.eB(1,t)))}function c(t,e,i,r){return(0,n.LC)(a(l(t,e,i,r)),new n.nt(1))}function u(t,e,i,a){const l=i.subtract(e),u=a.subtract(e),h=(0,s.tL)(l,u),d=(0,n.Uo)((0,n.Xe)(h,new n.nt(r.M)),(0,n.MM)(h,new n.nt(-r.M)));return(0,n.j1)([(0,n.Uo)((0,n.AU)(d),c(t.xy,e,i,a)),new n.nt(-1)],[!0,()=>{const r=o(t,e,i),s=o(t,i,a),l=o(t,a,e);return(0,n.jk)((0,n.jk)(r,s),l)}])}function h(t){return t.distance.add(1)}function d(t,e,i){const{viewMat3:r,tileMat3:s}=t.view,o=r.multiply(s),a=o.multiply(new n.eB(e.pos,1)),l=o.multiply(new n.eB(i.nextPos1,1)),c=o.multiply(new n.eB(i.nextPos2,1));return u(t.hittestRequest.position,a.xy,l.xy,c.xy)}function f(t,e,i){return(0,n.Io)(t,i).subtract(e)}},86486:function(t,e,i){i.d(e,{K5:function(){return h},Kt:function(){return p},M8:function(){return a},Rj:function(){return _},_9:function(){return o},i6:function(){return d},mh:function(){return u},nb:function(){return c},p8:function(){return y},tL:function(){return l},xf:function(){return m},yS:function(){return f},zb:function(){return g},zy:function(){return v}});var n=i(39686),r=i(70931),s=i(40846);function o(t){const e=(0,r.fV)(12.9898),i=(0,r.fV)(78.233),n=(0,r.fV)(43758.5453),s=(0,r.Om)(t,(0,r.Zc)(e,i)),o=(0,r.zi)(s,(0,r.fV)(3.14));return(0,r.jc)((0,r.F8)(o).multiply(n))}function a(t){return(0,r.LC)(t,(0,r.fV)(s.qM))}function l(t,e){return t.x.multiply(e.y).subtract(e.x.multiply(t.y))}function c(t){return t.multiply(2).subtract(1)}function u(t,e){const i=(0,r.fV)(2**e);return(0,r.zi)((0,r.RI)(t.divide(i)),(0,r.fV)(2))}function h(t,e){return(0,r.MM)(u(t,e),(0,r.fV)(.5))}function d(t,e){return u(t,e+n.U5)}function f(t,e){return u(t,e)}function p(t){const e=u(t.z,7),i=(0,r.fV)(1).subtract(e),n=t.xyz.subtract((0,r.eR)(0,0,(0,r.fV)(128)));return i.multiply(t).add(e.multiply(n))}function _(t){const e=(0,r.ln)(255/256,255/65536,255/16777216,255/4294967296);return(0,r.Om)(t,e)}function m(t){return(0,r.T9)((0,r.T9)((0,r.T9)(t.x,t.y),t.z),t.w)}function g(t){return new r.nt(1).subtract(t)}function y(t){return t.subtract(new r.nt(1))}function v(t,e){return t.subtract(new r.nt(e))}},90906:function(t,e,i){i.d(e,{G5:function(){return r},G7:function(){return o},Mg:function(){return s},TL:function(){return l},cF:function(){return a},g_:function(){return c}});var n=i(70931);function r(t){return null!=t.visualVariableSizeMinMaxValue||null!=t.visualVariableSizeScaleStops||null!=t.visualVariableSizeStops||null!=t.visualVariableSizeUnitValue}function s(t,e,i){if(r(t)){const n=t.storage.getSizeValue(e);return t.visualVariableSizeMinMaxValue?.getSize(n,i)??t.visualVariableSizeScaleStops?.getSizeForViewScale(t.view.currentScale)??t.visualVariableSizeStops?.getSize(n,i)??t.visualVariableSizeUnitValue?.getSize(n,i)}return i}function o(t,e,i,r=new n.x(!1)){if(null==t.visualVariableColor)return i;const s=t.storage.getColorValue(e);return t.visualVariableColor.getColor(s,i,r)}function a(t,e){if(null==t.visualVariableOpacity)return new n.nt(1);const i=t.storage.getOpacityValue(e);return t.visualVariableOpacity.getOpacity(i)}function l(t,e){if(null==t.visualVariableRotation)return n.U.identity();const i=t.storage.getRotationValue(e);return t.visualVariableRotation.getVVRotationMat3(i)}function c(t,e){if(null==t.visualVariableRotation)return new n.nt(0);const i=t.storage.getRotationValue(e);return t.visualVariableRotation.getNormalizedAngle(i)}},53972:function(t,e,i){i.d(e,{G8:function(){return E},GJ:function(){return g}});var n=i(15774),r=i(13520),s=i(33134),o=i(84646),a=i(96564),l=i(39686),c=i(17469),u=i(54417),h=i(68758),d=i(54601),f=i(40846),p=i(7590);class _{constructor(t){const{offsetX:e,offsetY:i,postAngle:n,fontSize:r,haloSize:s,outlineSize:o,scaleFactor:a,transforms:l}=t;if(this.offsetX=e,this.offsetY=i,this.postAngle=n,this.fontSize=Math.min(r,96),this.haloSize=s??0,this.outlineSize=o??0,this.transforms=l,l&&l.infos.length>1){const t=(0,p.zb)(r,n,!1,e,i,l,!1);this.fontSize=Math.min(t.size,96);const s=t.size/r;this.haloSize*=s,this.outlineSize*=s,this.postAngle=t.rotation,this.offsetX=t.offsetX,this.offsetY=t.offsetY}a&&(this.fontSize*=a,this.offsetX*=a,this.offsetY*=a)}}var m=i(85456);const g=28,y=[4,4],v=[16,4],x={topLeft:v,topRight:v,bottomLeft:v,bottomRight:v},b=[4,2],S=[4,6],w={topLeft:b,topRight:b,bottomLeft:S,bottomRight:S},T={topLeft:b,topRight:S,bottomLeft:b,bottomRight:S},M={topLeft:S,topRight:S,bottomLeft:y,bottomRight:y},P={topLeft:y,topRight:y,bottomLeft:S,bottomRight:S},A={topLeft:S,topRight:y,bottomLeft:S,bottomRight:y},C={topLeft:y,topRight:S,bottomLeft:y,bottomRight:S},I={createComputedParams:t=>t,optionalAttributes:{zoomRange:{type:m.pe.UNSIGNED_SHORT,count:2,packPrecisionFactor:l.fq,packTessellation:({minZoom:t,maxZoom:e})=>[t||0,e||g]},clipAngle:{type:m.pe.UNSIGNED_BYTE,count:1,packTessellation:({clipAngle:t})=>R(t||0)},referenceSymbol:{type:m.pe.BYTE,count:4,packPrecisionFactor:1,packTessellation:(t,e)=>{const i=t.isLineLabel||!t.referenceBounds,n=(0,a.iT)(i?"center":e.horizontalAlignment),s=(0,a.Dy)(i?"middle":e.verticalAlignment),{offsetX:o,offsetY:l,size:c}=i?{offsetX:0,offsetY:0,size:0}:t.referenceBounds;return[(0,r.Lz)(o),-(0,r.Lz)(l),Math.round((0,r.Lz)(c)),n+1<<2|s+1]}}},attributes:{pos:{type:m.pe.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:m.pe.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:m.pe.UNSIGNED_BYTE,count:1,packTessellation:({isBackground:t,mapAligned:e})=>(0,u.xo)([[f.bg,t],[f.ti,!!e]])},offset:{type:m.pe.SHORT,count:2,packPrecisionFactor:8,packAlternating:{count:4,packTessellation:({offsets:t})=>{const{bottomLeft:e,bottomRight:i,topLeft:n,topRight:r}=t;return[n,r,e,i]}}},textureUV:{type:m.pe.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,packTessellation:({texcoords:t})=>{const{bottomLeft:e,bottomRight:i,topLeft:n,topRight:r}=t;return[n,r,e,i]}}},color:{type:m.pe.UNSIGNED_BYTE,count:4,normalized:!0,packTessellation:({color:t})=>t},fontSize:{type:m.pe.UNSIGNED_SHORT,count:1,packPrecisionFactor:4,packTessellation:({fontSize:t})=>Math.round((0,r.Lz)(t))},referenceSize:{type:m.pe.UNSIGNED_BYTE,count:1,packPrecisionFactor:4,packTessellation:({fontSize:t},{referenceSize:e})=>Math.round((0,r.Lz)(e??t))},outlineColor:{type:m.pe.UNSIGNED_BYTE,count:4,normalized:!0,pack:({outlineColor:t})=>(0,u.Jb)(t)},haloColor:{type:m.pe.UNSIGNED_BYTE,count:4,normalized:!0,pack:({haloColor:t})=>(0,u.Jb)(t)},outlineAndHaloSize:{type:m.pe.UNSIGNED_SHORT,count:2,packPrecisionFactor:4,packTessellation:({outlineSize:t,haloSize:e})=>[Math.round((0,r.Lz)(t)),Math.round((0,r.Lz)(e))]}}};class E extends d.r{constructor(){super(...arguments),this.vertexSpec=I,this._textMeshParamsPropsInitialized=!1}ensurePacked(t,e,i){super.ensurePacked(t,e,i),this._textMeshParamsPropsInitialized&&!this._evaluator.hasDynamicProperties||(this._textMeshTransformProps=new _(this.evaluatedMeshParams),this._textMeshParamsPropsInitialized=!0)}_write(t,e,i){const n=this._getShaping();if(!n)return;const r=e.getDisplayId();if(null!=this.evaluatedMeshParams.placement)return this._writePlacedTextMarkers(t,e,n,i);if(i?.nextPath())return i.nextPoint(),this._writeGlyphs(t,r,i.x,i.y,n,0);if("esriGeometryPolygon"===e.geometryType){const i=e.readCentroidForDisplay();if(!i)return;const[s,o]=i.coords;return this._writeGlyphs(t,r,s,o,n,0)}if("esriGeometryMultipoint"===e.geometryType){const i=e.readGeometryForDisplay();return void i?.forEachVertex(((e,i)=>this._writeGlyphs(t,r,e,i,n,0)))}const s=e.readXForDisplay(),o=e.readYForDisplay();return this._writeGlyphs(t,r,s,o,n,0)}_writePlacedTextMarkers(t,e,i,n){const a=n??s.z.fromFeatureSetReaderCIM(e);if(!a)return;const l=o.l.getPlacement(a,-1,this.evaluatedMeshParams.placement,(0,r.Lz)(1),t.id,(0,h.z)());if(!l)return;const c=e.getDisplayId();let u=l.next();for(;null!=u;){const e=u.tx,n=-u.ty,r=-u.getAngle();this._writeGlyphs(t,c,e,n,i,r),u=l.next()}}_getShaping(t){const e=this._textMeshTransformProps,i=this.evaluatedMeshParams;if(!i.glyphs?.glyphs.length)return null;const s=(0,r.Lz)(e.fontSize),o=(0,r.Lz)(e.offsetX),a=(0,r.Lz)(e.offsetY),u=(0,n.qE)((0,r.Lz)(i.lineWidth),l.GR,l.cp),h=l.DY*(0,n.qE)(i.lineHeightRatio,.25,4);return(0,c.Tl)(i.glyphs,{scale:s/l.eG,angle:e.postAngle,xOffset:o,yOffset:a,horizontalAlignment:i.horizontalAlignment,verticalAlignment:t||i.verticalAlignment,maxLineWidth:u,lineHeight:h,decoration:i.decoration,borderLineSizePx:(0,r.Lz)(i.boxBorderLineSize),hasBackground:!!i.boxBackgroundColor,useCIMAngleBehavior:i.useCIMAngleBehavior})}_writeGlyphs(t,e,i,n,s,o,a,l){const c=this.evaluatedMeshParams,h=this._textMeshTransformProps,d=(0,r.Lz)(h.fontSize),f=h.haloSize,p=h.outlineSize,_=(0,r.Lz)(h.offsetX),m=(0,r.Lz)(h.offsetY),[g,y]=(0,u.My)(c.scaleInfo,this.getTileInfo());0!==o&&s.setRotation(o);const v=s.bounds,x=i+v.x+_,b=n+v.y-m,S=2*(c.minPixelBuffer?c.minPixelBuffer/d:1),w=Math.max(v.width,v.height)*S;s.textBox&&(t.recordStart(this.instanceId,this.attributeLayout,s.glyphs[0].textureBinding),t.recordBounds(x,b,w,w),this._writeTextBox(t,e,i,n,s.textBox,a,l),t.recordEnd());for(const r of s.glyphs){t.recordStart(this.instanceId,this.attributeLayout,r.textureBinding),t.recordBounds(x,b,w,w);const{texcoords:s,offsets:o}=r;this._writeQuad(t,e,i,n,{texcoords:s,offsets:o,fontSize:d,haloSize:f,outlineSize:p,color:(0,u.Jb)(c.color),isBackground:!1,referenceBounds:a,minZoom:g,maxZoom:y,...l}),t.recordEnd()}0!==o&&s.setRotation(-o)}_writeTextBox(t,e,i,n,r,s,o){const a=this.evaluatedMeshParams,{fontSize:l,haloSize:c,outlineSize:h}=this._textMeshTransformProps,{boxBackgroundColor:d,boxBorderLineColor:f}=a,p={isBackground:!0,fontSize:l,haloSize:c,outlineSize:h,referenceBounds:s,...o};d&&(this._writeQuad(t,e,i,n,{texcoords:x,offsets:r.main,color:(0,u.Jb)(d),...p}),f||(this._writeQuad(t,e,i,n,{texcoords:M,offsets:r.top,color:(0,u.Jb)(d),...p}),this._writeQuad(t,e,i,n,{texcoords:P,offsets:r.bot,color:(0,u.Jb)(d),...p}),this._writeQuad(t,e,i,n,{texcoords:A,offsets:r.left,color:(0,u.Jb)(d),...p}),this._writeQuad(t,e,i,n,{texcoords:C,offsets:r.right,color:(0,u.Jb)(d),...p}))),f&&(this._writeQuad(t,e,i,n,{texcoords:w,offsets:r.top,color:(0,u.Jb)(f),...p}),this._writeQuad(t,e,i,n,{texcoords:w,offsets:r.bot,color:(0,u.Jb)(f),...p}),this._writeQuad(t,e,i,n,{texcoords:T,offsets:r.left,color:(0,u.Jb)(f),...p}),this._writeQuad(t,e,i,n,{texcoords:T,offsets:r.right,color:(0,u.Jb)(f),...p}))}_writeQuad(t,e,i,n,r){const s=t.vertexCount();this._writeVertex(t,e,i,n,r),t.indexWrite(s+0),t.indexWrite(s+1),t.indexWrite(s+2),t.indexWrite(s+1),t.indexWrite(s+3),t.indexWrite(s+2)}}const R=t=>Math.round(t*(254/360))},22516:function(t,e,i){i.d(e,{K:function(){return c}});var n=i(39819),r=i(40633),s=i(34194),o=(i(13798),i(58941),i(41835),i(85456),i(96402),i(95904)),a=(i(69452),i(12285),i(88413));function l(t,e,i){const s=e.length;if(s!==i){const o=new n.A("Invalid Uniform",`Invalid length, expected ${i} but got ${s}`,{uniformName:t,values:e});r.A.getLogger("esri.views.2d.engine.webgl.shaderGraph.typed.TypedShaderProgram").errorOnce(o)}}class c{constructor(t,e,i,n,r,s){this._program=null,this._vao=null,this._temporaryTextures=[],this.vertexShader=t,this.fragmentShader=e,this._locations=i,this._locationInfo=n,this._uniformBindings=r,this._transformFeedbackBindings=s}destroy(){this._program&&this._program.dispose(),this.cleanupTemporaryTextures()}get locations(){return this._locations}get locationInfo(){return this._locationInfo}setUniforms(t){this._uniforms=t}cleanupTemporaryTextures(){for(const t of this._temporaryTextures)t.dispose();this._temporaryTextures=[]}bind(t){const e=this._uniforms;if(!this._program){const e=new Map;for(const[t,i]of this._locations)e.set(t,i);const i=[];for(const t of this._transformFeedbackBindings??[]){const{index:e,propertyKey:n}=t;i[e]=`v_${n}`}this._program=new o.B(t,this.vertexShader,this.fragmentShader,e,new Map,i)}const i=this._program;t.useProgram(i);for(const n of this._uniformBindings){const{shaderModulePath:r,uniformName:o,uniformType:c,uniformArrayLength:u}=n,h=(0,s.wc)(r,e);if(null==h){if("sampler2D"===c)continue;throw new Error(`Failed to find uniform value for ${r}`)}switch("array"===c?n.uniformArrayElementType:c){case"sampler2D":{const{unit:e,texture:n}=h;if(i.setUniform1i(o,e),"type"in n)t.bindTexture(n,e);else{const i=(0,a.sZ)(t,n.descriptor,n.data);t.bindTexture(i,e)}break}case"int":if(!u){i.setUniform1i(o,h);break}l(n.uniformName,h,u),i.setUniform1iv(o,h);break;case"float":if(!u){i.setUniform1f(o,h);break}l(n.uniformName,h,u),i.setUniform1fv(o,h);break;case"vec2":if(!u){i.setUniform2f(o,h[0],h[1]);break}l(n.uniformName,h,u),i.setUniform2fv(o,h.flat());break;case"vec3":if(!u){i.setUniform3f(o,h[0],h[1],h[2]);break}l(n.uniformName,h,u),i.setUniform3fv(o,h.flat());break;case"vec4":if(!u){i.setUniform4f(o,h[0],h[1],h[2],h[3]);break}l(n.uniformName,h,u),i.setUniform4fv(o,h.flat());break;case"mat3":i.setUniformMatrix3fv(o,h);break;case"mat4":i.setUniformMatrix4fv(o,h);break;default:throw new Error(`Unable to set uniform for type ${c}`)}}}}},97673:function(t,e,i){function n(t){return t.locationsMap}i.d(e,{V:function(){return n},i:function(){return r}});const r={color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1}},94020:function(t,e,i){i.d(e,{T:function(){return r}});var n=i(44723);const r={shaders:{vertexShader:(0,n.Q)("background/background.vert"),fragmentShader:(0,n.Q)("background/background.frag")},attributes:new Map([["a_pos",0]])}},52432:function(t,e,i){i.d(e,{J:function(){return r}});var n=i(44723);const r={shaders:{vertexShader:(0,n.Q)("bitBlit/bitBlit.vert"),fragmentShader:(0,n.Q)("bitBlit/bitBlit.frag")},attributes:new Map([["a_pos",0],["a_tex",1]])}},17040:function(t,e,i){i.d(e,{G:function(){return s},Z:function(){return r}});var n=i(44723);const r={shaders:{vertexShader:(0,n.Q)("highlight/textured.vert"),fragmentShader:(0,n.Q)("highlight/highlight.frag")},attributes:new Map([["a_position",0],["a_texcoord",1]])},s={shaders:{vertexShader:(0,n.Q)("highlight/textured.vert"),fragmentShader:(0,n.Q)("highlight/blur.frag")},attributes:new Map([["a_position",0],["a_texcoord",1]])}},50437:function(t,e,i){i.d(e,{p:function(){return a}});var n=i(44723),r=i(72785);const s=t=>{let e="";e+=t[0].toUpperCase();for(let i=1;i<t.length;i++){const n=t[i];n===n.toUpperCase()?(e+="_",e+=n):e+=n.toUpperCase()}return e},o=t=>{const e={};for(const i in t)e[s(i)]=t[i];return(0,r.I)(e)},a=(t,e,i,r)=>{const s=t+t.slice(Math.max(0,t.lastIndexOf("/"))),a=e+e.slice(Math.max(0,e.lastIndexOf("/"))),l=o(r);return{attributes:i,shaders:{vertexShader:l+(0,n.Q)(`${s}.vert`),fragmentShader:l+(0,n.Q)(`${a}.frag`)}}}},21024:function(t,e,i){i.d(e,{P:function(){return r}});var n=i(44723);const r={shaders:{vertexShader:(0,n.Q)("stencil/stencil.vert"),fragmentShader:(0,n.Q)("stencil/stencil.frag")},attributes:new Map([["a_pos",0]])}},47272:function(t,e,i){i.d(e,{H:function(){return r}});var n=i(44723);const r={shaders:{vertexShader:(0,n.Q)("tileInfo/tileInfo.vert"),fragmentShader:(0,n.Q)("tileInfo/tileInfo.frag")},attributes:new Map([["a_pos",0]])}},44723:function(t,e,i){i.d(e,{Q:function(){return s}});const n=new(i(65644).Z)((r={background:{"background.frag":"uniform lowp vec4 u_color;\nvoid main() {\ngl_FragColor = u_color;\n}","background.vert":"attribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform mediump vec2 u_coord_range;\nuniform mediump float u_depth;\nvoid main() {\nvec3 v_pos = u_dvsMat3 * vec3(u_coord_range * a_pos, 1.0);\ngl_Position = vec4(v_pos.xy, 0.0, 1.0);\n}"},bitBlit:{"bitBlit.frag":"uniform lowp sampler2D u_tex;\nuniform lowp float u_opacity;\nvarying mediump vec2 v_uv;\nvoid main() {\nlowp vec4 color = texture2D(u_tex, v_uv);\ngl_FragColor = color * u_opacity;\n}","bitBlit.vert":"attribute vec2 a_pos;\nattribute vec2 a_tex;\nvarying mediump vec2 v_uv;\nvoid main(void) {\ngl_Position = vec4(a_pos , 0.0, 1.0);\nv_uv = a_tex;\n}"},debug:{overlay:{"overlay.frag":"precision mediump float;\nvarying vec4 v_color;\nvoid main(void) {\ngl_FragColor = v_color;\n}","overlay.vert":"attribute vec3 a_PositionAndFlags;\nuniform mat3 u_dvsMat3;\nuniform vec4 u_colors[4];\nuniform float u_opacities[4];\nvarying vec4 v_color;\nvoid main(void) {\nvec2 position = a_PositionAndFlags.xy;\nfloat flags = a_PositionAndFlags.z;\nint colorIndex = int(mod(flags, 4.0));\nvec4 color;\nfor (int i = 0; i < 4; i++) {\ncolor = u_colors[i];\nif (i == colorIndex) {\nbreak;\n}\n}\nint opacityIndex = int(mod(floor(flags / 4.0), 4.0));\nfloat opacity;\nfor (int i = 0; i < 4; i++) {\nopacity = u_opacities[i];\nif (i == opacityIndex) {\nbreak;\n}\n}\nv_color = color * opacity;\ngl_Position = vec4((u_dvsMat3 * vec3(position, 1.0)).xy, 0.0, 1.0);\n}"}},dot:{dot:{"dot.frag":"precision mediump float;\nvarying vec4 v_color;\nvarying float v_dotRatio;\nvarying float v_invEdgeRatio;\nuniform highp float u_tileZoomFactor;\nvoid main()\n{\nfloat dist = length(gl_PointCoord - vec2(.5, .5)) * 2.;\nfloat alpha = smoothstep(0., 1., v_invEdgeRatio * (dist - v_dotRatio) + 1.);\ngl_FragColor = v_color * alpha;\n}","dot.vert":"precision highp float;\nattribute vec2 a_pos;\nuniform sampler2D u_texture;\nuniform highp mat3 u_dvsMat3;\nuniform highp float u_tileZoomFactor;\nuniform highp float u_dotSize;\nuniform highp float u_pixelRatio;\nvarying vec2 v_pos;\nvarying vec4 v_color;\nvarying float v_dotRatio;\nvarying float v_invEdgeRatio;\nconst float EPSILON = 0.000001;\nvoid main()\n{\nmat3 tileToTileTexture = mat3(  1., 0., 0.,\n0., -1., 0.,\n0., 1., 1.  );\nvec3 texCoords = tileToTileTexture * vec3(a_pos.xy / 512., 1.);\nv_color = texture2D(u_texture, texCoords.xy);\nfloat smoothEdgeWidth = max(u_dotSize / 2., 1.) ;\nfloat z = 0.;\nz += 2.0 * step(v_color.a, EPSILON);\ngl_PointSize = (smoothEdgeWidth + u_dotSize);\ngl_Position = vec4((u_dvsMat3 * vec3(a_pos + .5, 1.)).xy, z, 1.);\nv_dotRatio = u_dotSize / gl_PointSize;\nv_invEdgeRatio = -1. / ( smoothEdgeWidth / gl_PointSize );\ngl_PointSize  *= (u_pixelRatio * u_tileZoomFactor);\n}"}},filtering:{"bicubic.glsl":"vec4 computeWeights(float v) {\nfloat b = 1.0 / 6.0;\nfloat v2 = v * v;\nfloat v3 = v2 * v;\nfloat w0 = b * (-v3 + 3.0 * v2 - 3.0 * v + 1.0);\nfloat w1 = b * (3.0 * v3  - 6.0 * v2 + 4.0);\nfloat w2 = b * (-3.0 * v3 + 3.0 * v2 + 3.0 * v + 1.0);\nfloat w3 = b * v3;\nreturn vec4(w0, w1, w2, w3);\n}\nvec4 bicubicOffsetsAndWeights(float v) {\nvec4 w = computeWeights(v);\nfloat g0 = w.x + w.y;\nfloat g1 = w.z + w.w;\nfloat h0 = 1.0 - (w.y / g0) + v;\nfloat h1 = 1.0 + (w.w / g1) - v;\nreturn vec4(h0, h1, g0, g1);\n}\nvec4 sampleBicubicBSpline(sampler2D sampler, vec2 coords, vec2 texSize) {\nvec2 eX = vec2(1.0 / texSize.x, 0.0);\nvec2 eY = vec2(0.0, 1.0 / texSize.y);\nvec2 texel = coords * texSize - 0.5;\nvec3 hgX = bicubicOffsetsAndWeights(fract(texel).x).xyz;\nvec3 hgY = bicubicOffsetsAndWeights(fract(texel).y).xyz;\nvec2 coords10 = coords + hgX.x * eX;\nvec2 coords00 = coords - hgX.y * eX;\nvec2 coords11 = coords10 + hgY.x * eY;\nvec2 coords01 = coords00 + hgY.x * eY;\ncoords10 = coords10 - hgY.y * eY;\ncoords00 = coords00 - hgY.y * eY;\nvec4 color00 = texture2D(sampler, coords00);\nvec4 color10 = texture2D(sampler, coords10);\nvec4 color01 = texture2D(sampler, coords01);\nvec4 color11 = texture2D(sampler, coords11);\ncolor00 = mix(color00, color01, hgY.z);\ncolor10 = mix(color10, color11, hgY.z);\ncolor00 = mix(color00, color10, hgX.z);\nreturn color00;\n}","bilinear.glsl":"vec4 sampleBilinear(sampler2D sampler, vec2 coords, vec2 texSize) {\nvec2 texelStart = floor(coords * texSize);\nvec2 coord0 = texelStart / texSize;\nvec2 coord1 = (texelStart +  vec2(1.0, 0.0)) / texSize;\nvec2 coord2 = (texelStart +  vec2(0.0, 1.0)) / texSize;\nvec2 coord3 = (texelStart +  vec2(1.0, 1.0)) / texSize;\nvec4 color0 = texture2D(sampler, coord0);\nvec4 color1 = texture2D(sampler, coord1);\nvec4 color2 = texture2D(sampler, coord2);\nvec4 color3 = texture2D(sampler, coord3);\nvec2 blend = fract(coords * texSize);\nvec4 color01 = mix(color0, color1, blend.x);\nvec4 color23 = mix(color2, color3, blend.x);\nvec4 color = mix(color01, color23, blend.y);\n#ifdef NNEDGE\nfloat alpha = floor(color0.a * color1.a * color2.a * color3.a + 0.5);\ncolor = color * alpha + (1.0 - alpha) * texture2D(sampler, coords);\n#endif\nreturn color;\n}","epx.glsl":"vec4 sampleEPX(sampler2D sampler, float size, vec2 coords, vec2 texSize) {\nvec2 invSize = 1.0 / texSize;\nvec2 texel = coords * texSize;\nvec2 texel_i = floor(texel);\nvec2 texel_frac = fract(texel);\nvec4 colorP = texture2D(sampler, texel_i * invSize);\nvec4 colorP1 = vec4(colorP);\nvec4 colorP2 = vec4(colorP);\nvec4 colorP3 = vec4(colorP);\nvec4 colorP4 = vec4(colorP);\nvec4 colorA = texture2D(sampler, (texel_i - vec2(0.0, 1.0)) * invSize);\nvec4 colorB = texture2D(sampler, (texel_i + vec2(1.0, 0.0)) * invSize);\nvec4 colorC = texture2D(sampler, (texel_i - vec2(1.0, 0.0)) * invSize);\nvec4 colorD = texture2D(sampler, (texel_i + vec2(0.0, 1.0)) * invSize);\nif (colorC == colorA && colorC != colorD && colorA != colorB) {\ncolorP1 = colorA;\n}\nif (colorA == colorB && colorA != colorC && colorB != colorD) {\ncolorP2 = colorB;\n}\nif (colorD == colorC && colorD != colorB && colorC != colorA) {\ncolorP3 = colorC;\n}\nif (colorB == colorD && colorB != colorA && colorD != colorC) {\ncolorP4 = colorD;\n}\nvec4 colorP12 = mix(colorP1, colorP2, texel_frac.x);\nvec4 colorP34 = mix(colorP1, colorP2, texel_frac.x);\nreturn mix(colorP12, colorP34, texel_frac.y);\n}"},heatmap:{heatmapResolve:{"heatmapResolve.frag":"precision highp float;\n#ifdef HEATMAP_PRECISION_HALF_FLOAT\n#define COMPRESSION_FACTOR 4.0\n#else\n#define COMPRESSION_FACTOR 1.0\n#endif\nuniform sampler2D u_texture;\nuniform sampler2D u_gradient;\nuniform vec2 u_densityMinAndInvRange;\nuniform float u_densityNormalization;\nvarying vec2 v_uv;\nvoid main() {\nvec4 data = texture2D(u_texture, v_uv);\nfloat density = data.r * COMPRESSION_FACTOR;\ndensity *= u_densityNormalization;\ndensity = (density - u_densityMinAndInvRange.x) * u_densityMinAndInvRange.y;\nvec4 color = texture2D(u_gradient, vec2(density, 0.5));\ngl_FragColor = vec4(color.rgb * color.a, color.a);\n}","heatmapResolve.vert":"precision highp float;\nattribute vec2 a_pos;\nvarying vec2 v_uv;\nvoid main() {\nv_uv = a_pos;\ngl_Position = vec4(a_pos * 2.0 - 1.0, 1., 1.);\n}"}},highlight:{"blur.frag":"varying mediump vec2 v_texcoord;\nuniform mediump vec4 u_direction;\nuniform mediump mat4 u_channelSelector;\nuniform mediump float u_sigma;\nuniform sampler2D u_texture;\nmediump float gauss1(mediump vec2 dir) {\nreturn exp(-dot(dir, dir) / (2.0 * u_sigma * u_sigma));\n}\nmediump vec4 selectChannel(mediump vec4 sample) {\nreturn u_channelSelector * sample;\n}\nvoid accumGauss1(mediump float i, inout mediump float tot, inout mediump float weight) {\nmediump float w = gauss1(i * u_direction.xy);\ntot += selectChannel(texture2D(u_texture, v_texcoord + i * u_direction.zw))[3] * w;\nweight += w;\n}\nvoid main(void) {\nmediump float tot = 0.0;\nmediump float weight = 0.0;\naccumGauss1(-5.0, tot, weight);\naccumGauss1(-4.0, tot, weight);\naccumGauss1(-3.0, tot, weight);\naccumGauss1(-2.0, tot, weight);\naccumGauss1(-1.0, tot, weight);\naccumGauss1(0.0, tot, weight);\naccumGauss1(1.0, tot, weight);\naccumGauss1(2.0, tot, weight);\naccumGauss1(3.0, tot, weight);\naccumGauss1(4.0, tot, weight);\naccumGauss1(5.0, tot, weight);\ngl_FragColor = vec4(0.0, 0.0, 0.0, tot / weight);\n}","highlight.frag":"varying mediump vec2 v_texcoord;\nuniform sampler2D u_texture;\nuniform mediump float u_sigma;\nuniform sampler2D u_shade;\nuniform mediump vec2 u_minMaxDistance;\nmediump float estimateDistance() {\nmediump float y = texture2D(u_texture, v_texcoord)[3];\nconst mediump float y0 = 0.5;\nmediump float m0 = 1.0 / (sqrt(2.0 * 3.1415) * u_sigma);\nmediump float d = (y - y0) / m0;\nreturn d;\n}\nmediump vec4 shade(mediump float d) {\nmediump float mappedDistance = (d - u_minMaxDistance.x) / (u_minMaxDistance.y - u_minMaxDistance.x);\nmappedDistance = clamp(mappedDistance, 0.0, 1.0);\nreturn texture2D(u_shade, vec2(mappedDistance, 0.5));\n}\nvoid main(void) {\nmediump float d = estimateDistance();\ngl_FragColor = shade(d);\n}","textured.vert":"attribute mediump vec2 a_position;\nattribute mediump vec2 a_texcoord;\nvarying mediump vec2 v_texcoord;\nvoid main(void) {\ngl_Position = vec4(a_position, 0.0, 1.0);\nv_texcoord = a_texcoord;\n}"},materials:{"attributeData.glsl":"uniform highp sampler2D filterFlags;\nuniform highp sampler2D animation;\nuniform highp sampler2D gpgpu;\nuniform highp sampler2D visualVariableData;\nuniform highp sampler2D dataDriven0;\nuniform highp sampler2D dataDriven1;\nuniform highp sampler2D dataDriven2;\nuniform float size;\nhighp vec2 getAttributeDataCoords(in highp vec3 id) {\nhighp vec3  texel = unpackDisplayIdTexel(id);\nhighp float u32 = float(int(texel.r) + int(texel.g) * 256 + int(texel.b) * 256 * 256);\nhighp float col = mod(u32, size);\nhighp float row = (u32 - col) / size;\nhighp float u = col / size;\nhighp float v = row / size;\nreturn vec2(u, v);\n}\nhighp vec2 getAttributeDataTextureCoords(in highp vec3 id) {\nreturn (getAttributeDataCoords(id) * 2.0) - 1.0 + (.5 / vec2(size));\n}\nhighp vec4 getFilterData(in highp vec3 id) {\nvec2 coords = getAttributeDataCoords(id);\nreturn texture2D(filterFlags, coords);\n}\nhighp vec4 getAnimation(in highp vec3 id) {\nhighp vec2 coords = getAttributeDataCoords(id);\nreturn texture2D(animation, coords);\n}\nhighp vec4 getVisualVariableData(in highp vec3 id) {\nhighp vec2 coords = getAttributeDataCoords(id);\nreturn texture2D(visualVariableData, coords);\n}\nhighp vec4 getDataDriven0(in highp vec3 id) {\nhighp vec2 coords = getAttributeDataCoords(id);\nreturn texture2D(dataDriven0, coords);\n}\nhighp vec4 getDataDriven1(in highp vec3 id) {\nhighp vec2 coords = getAttributeDataCoords(id);\nreturn texture2D(dataDriven1, coords);\n}\nhighp vec4 getGPGPU(in highp vec3 id) {\nhighp vec2 coords = getAttributeDataCoords(id);\nreturn texture2D(gpgpu, coords);\n}\nhighp vec4 getDataDriven2(in highp vec3 id) {\nhighp vec2 coords = getAttributeDataCoords(id);\nreturn texture2D(dataDriven2, coords);\n}\nfloat u88VVToFloat(in vec2 v) {\nbool isMagic = v.x == 255.0 && v.y == 255.0;\nif (isMagic) {\nreturn NAN_MAGIC_NUMBER;\n}\nreturn (v.x + v.y * float(0x100)) - 32768.0;\n}","barycentric.glsl":"float inTriangle(vec3 bary) {\nvec3 absBary = abs(bary);\nreturn step((absBary.x + absBary.y + absBary.z), 1.05);\n}\nvec3 xyToBarycentric(in vec2 pos, in vec2 v0,  in vec2 v1, in vec2 v2) {\nmat3 xyToBarycentricMat3 = mat3(\nv1.x * v2.y - v2.x * v1.y, v2.x * v0.y - v0.x * v2.y, v0.x * v1.y - v1.x * v0.y,\nv1.y - v2.y, v2.y - v0.y, v0.y - v1.y,\nv2.x - v1.x, v0.x - v2.x, v1.x - v0.x\n);\nfloat A2 = v0.x * (v1.y - v2.y) + v1.x * (v2.y - v0.y) + v2.x * (v0.y - v1.y);\nreturn (1. / A2) * xyToBarycentricMat3 * vec3(1., pos);\n}","constants.glsl":"const float C_DEG_TO_RAD = 3.14159265359 / 180.0;\nconst float C_256_TO_RAD = 3.14159265359 / 128.0;\nconst float C_RAD_TO_DEG = 180.0 / 3.141592654;\nconst float POSITION_PRECISION = 1.0 / 8.0;\nconst float FILL_POSITION_PRECISION = 1.0 / 1.0;\nconst float SOFT_EDGE_RATIO = 1.0;\nconst float THIN_LINE_WIDTH_FACTOR = 1.1;\nconst float THIN_LINE_HALF_WIDTH = 1.0;\nconst float EXTRUDE_SCALE_PLACEMENT_PADDING = 1.0 / 4.0;\nconst float OFFSET_PRECISION = 1.0 / 8.0;\nconst float OUTLINE_SCALE = 1.0 / 5.0;\nconst float SDF_FONT_SIZE = 24.0;\nconst float MAX_SDF_DISTANCE = 8.0;\nconst float PLACEMENT_PADDING = 8.0;\nconst float EPSILON = 0.00001;\nconst float EPSILON_HITTEST = 0.05;\nconst int MAX_FILTER_COUNT = 2;\nconst int ATTR_VV_SIZE = 0;\nconst int ATTR_VV_COLOR = 1;\nconst int ATTR_VV_OPACITY = 2;\nconst int ATTR_VV_ROTATION = 3;\nconst highp float NAN_MAGIC_NUMBER = 1e-30;\nconst int BITSET_GENERIC_LOCK_COLOR = 1;\nconst int BITSET_GENERIC_CONSIDER_ALPHA_ONLY = 4;\nconst int BITSET_MARKER_ALIGNMENT_MAP = 0;\nconst int BITSET_MARKER_OUTLINE_ALLOW_COLOR_OVERRIDE = 2;\nconst int BITSET_MARKER_SCALE_SYMBOLS_PROPORTIONALLY = 3;\nconst int BITSET_TYPE_FILL_OUTLINE = 0;\nconst int BITSET_FILL_RANDOM_PATTERN_OFFSET = 2;\nconst int BITSET_FILL_HAS_UNRESOLVED_REPLACEMENT_COLOR = 3;\nconst int BITSET_FILL_HAS_PATTERN_HEIGHT_PRECISION_FACTOR = 5;\nconst int BITSET_FILL_HAS_PATTERN_WIDTH_PRECISION_FACTOR = 6;\nconst int BITSET_LINE_SCALE_DASH = 2;",fill:{"common.glsl":"#include <materials/symbologyTypeUtils.glsl>\n#ifdef PATTERN\nuniform mediump vec2 u_mosaicSize;\nvarying mediump float v_sampleAlphaOnly;\n#endif\n#if SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_DOT_DENSITY\nuniform lowp vec4 u_isActive[ 2 ];\nuniform highp float u_dotValue;\nuniform highp float u_tileDotsOverArea;\nuniform highp float u_dotTextureDotCount;\nuniform mediump float u_tileZoomFactor;\n#endif\nvarying highp vec3 v_id;\nvarying lowp vec4 v_color;\nvarying lowp float v_opacity;\nvarying mediump vec4 v_aux1;\n#ifdef PATTERN\nvarying mediump vec2 v_tileTextureCoord;\n#endif\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\nvarying lowp float v_isOutline;\n#endif\n#if SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_DOT_DENSITY\nvarying highp vec2 v_dotTextureCoords;\nvarying highp vec4 v_dotThresholds[ 2 ];\n#endif","fill.frag":"precision highp float;\n#include <materials/constants.glsl>\n#include <materials/utils.glsl>\n#include <materials/fill/common.glsl>\n#ifdef PATTERN\nuniform lowp sampler2D u_texture;\n#endif\n#if SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_DOT_DENSITY\nuniform mediump mat4 u_dotColors[ 2 ];\nuniform sampler2D u_dotTextures[ 2 ];\nuniform vec4 u_dotBackgroundColor;\n#endif\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#include <materials/shared/line/common.glsl>\n#include <materials/shared/line/line.frag>\nlowp vec4 drawLine() {\nfloat v_lineWidth = v_aux1.x;\nvec2  v_normal    = v_aux1.yz;\nLineData inputs = LineData(\nv_color,\nv_normal,\nv_lineWidth,\nv_opacity,\nv_id\n);\nreturn shadeLine(inputs);\n}\n#endif\nlowp vec4 drawFill() {\nlowp vec4 out_color = vec4(0.);\n#ifdef HITTEST\nout_color = v_color;\n#elif defined(PATTERN)\nmediump vec4 v_tlbr = v_aux1;\nmediump vec2 normalizedTextureCoord = mod(v_tileTextureCoord, 1.0);\nmediump vec2 samplePos = mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color = texture2D(u_texture, samplePos);\nif (v_sampleAlphaOnly > 0.5) {\ncolor.rgb = vec3(color.a);\n}\nout_color = v_opacity * v_color * color;\n#elif SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_DOT_DENSITY && !defined(HIGHLIGHT)\nvec4 textureThresholds0 = texture2D(u_dotTextures[0], v_dotTextureCoords);\nvec4 textureThresholds1 = texture2D(u_dotTextures[1], v_dotTextureCoords);\nvec4 difference0 = v_dotThresholds[0] - textureThresholds0;\nvec4 difference1 = v_dotThresholds[1] - textureThresholds1;\n#ifdef DD_DOT_BLENDING\nvec4 isPositive0 = step(0.0, difference0);\nvec4 isPositive1 = step(0.0, difference1);\nfloat weightSum = dot(isPositive0, difference0) + dot(isPositive1, difference1);\nfloat lessThanEqZero = step(weightSum, 0.0);\nfloat greaterThanZero = 1.0 - lessThanEqZero ;\nfloat divisor = (weightSum + lessThanEqZero);\nvec4 weights0 = difference0 * isPositive0 / divisor;\nvec4 weights1 = difference1 * isPositive1 / divisor;\nvec4 dotColor = u_dotColors[0] * weights0 + u_dotColors[1] * weights1;\nvec4 preEffectColor = greaterThanZero * dotColor + lessThanEqZero * u_dotBackgroundColor;\n#else\nfloat diffMax = max(max4(difference0), max4(difference1));\nfloat lessThanZero = step(diffMax, 0.0);\nfloat greaterOrEqZero = 1.0 - lessThanZero;\nvec4 isMax0 = step(diffMax, difference0);\nvec4 isMax1 = step(diffMax, difference1);\nvec4 dotColor = u_dotColors[0] * isMax0 + u_dotColors[1] * isMax1;\nvec4 preEffectColor = greaterOrEqZero * dotColor + lessThanZero * u_dotBackgroundColor;\n#endif\nout_color = preEffectColor;\n#else\nout_color = v_opacity * v_color;\n#endif\n#ifdef HIGHLIGHT\nout_color.a = 1.0;\n#endif\nreturn out_color;\n}\nvoid main() {\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\nif (v_isOutline > 0.5) {\ngl_FragColor = drawLine();\n} else {\ngl_FragColor = drawFill();\n}\n#else\ngl_FragColor = drawFill();\n#endif\n}","fill.vert":"#include <materials/symbologyTypeUtils.glsl>\n#define PACKED_LINE\nprecision highp float;\nattribute float a_bitset;\n#if SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_DOT_DENSITY\nattribute float a_inverseArea;\nvec4 a_color = vec4(0.0, 0.0, 0.0, 1.0);\nvec2 a_zoomRange = vec2(0.0, 10000.0);\n#else\nattribute vec4 a_color;\nattribute vec4 a_aux2;\nattribute vec4 a_aux3;\n#ifndef SYMBOLOGY_TYPE_IS_SIMPLE_LIKE\nattribute vec4 a_aux1;\nattribute vec2 a_zoomRange;\n#else\nvec2 a_zoomRange = vec2(0.0, 10000.0);\n#endif\n#endif\nuniform vec2 u_tileOffset;\nuniform vec2 u_maxIntNumOfCrossing;\n#include <util/encoding.glsl>\n#include <materials/vcommon.glsl>\n#include <materials/fill/common.glsl>\n#include <materials/fill/hittest.glsl>\nconst float INV_SCALE_COMPRESSION_FACTOR = 1.0 / 128.0;\nconst float MAX_REPRESENTABLE_INT = 16777216.0;\n#if SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_DOT_DENSITY\nvec4 dotThreshold(vec4 featureAttrOverFeatureArea, float dotValue, float tileDotsOverArea) {\nreturn featureAttrOverFeatureArea * (1.0 / dotValue)  * (1.0 / tileDotsOverArea);\n}\n#endif\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#include <materials/shared/line/common.glsl>\n#include <materials/shared/line/line.vert>\nvoid drawLine(out lowp vec4 out_color, out highp vec3 out_pos) {\nLineData outputs = buildLine(\nout_pos,\na_id,\na_pos,\na_color,\n(a_aux3.xy - 128.) / 16.,\n(a_aux3.zw - 128.) / 16.,\n0.,\na_aux2.z / 16.,\na_bitset,\nvec4(0.),\nvec2(0.),\na_aux2.w / 16.\n);\nv_id      = outputs.id;\nv_opacity = outputs.opacity;\nv_aux1    = vec4(outputs.lineHalfWidth, outputs.normal, 0.);\nout_color = outputs.color;\n}\n#endif\nvoid drawFill(out lowp vec4 out_color, out highp vec3 out_pos) {\nfloat a_bitSet = a_bitset;\nout_color = getColor(a_color, a_bitSet, BITSET_GENERIC_LOCK_COLOR);\nv_opacity = getOpacity();\nv_id      = norm(a_id);\n#if SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_DOT_DENSITY\nmat3 tileToTileNormalized = mat3(  2. / 512.,  0.,  0.,\n0., -2. / 512.,  0.,\n-1.,  1.,  1.  );\nout_pos   = tileToTileNormalized * vec3((a_pos * FILL_POSITION_PRECISION), 1.);\n#else\nout_pos   = u_dvsMat3 * vec3(a_pos * FILL_POSITION_PRECISION, 1.);\n#endif\n#ifdef PATTERN\nvec4  a_tlbr   = a_aux1;\nfloat a_width  = a_aux2.x;\nfloat a_height = a_aux2.y;\nvec2  a_offset = a_aux2.zw;\nvec2  a_scale  = a_aux3.xy;\nfloat a_angle  = a_aux3.z;\nif (getBit(a_bitset, BITSET_FILL_HAS_PATTERN_WIDTH_PRECISION_FACTOR) > 0.5) {\na_width *= INV_SCALE_COMPRESSION_FACTOR;\n}\nif (getBit(a_bitset, BITSET_FILL_HAS_PATTERN_HEIGHT_PRECISION_FACTOR) > 0.5) {\na_height *= INV_SCALE_COMPRESSION_FACTOR;\n}\nvec2 scale = INV_SCALE_COMPRESSION_FACTOR * a_scale;\nfloat width = u_zoomFactor * a_width * scale.x;\nfloat height = u_zoomFactor * a_height * scale.y;\nfloat angle = C_256_TO_RAD * a_angle;\nfloat sinA = sin(angle);\nfloat cosA = cos(angle);\nfloat dx = 0.0;\nfloat dy = 0.0;\nif (getBit(a_bitset, BITSET_FILL_RANDOM_PATTERN_OFFSET) > 0.5) {\nfloat id = rgba2float(vec4(a_id, 0.0));\ndx = rand(vec2(id, 0.0));\ndy = rand(vec2(0.0, id));\n}\nmat3 patternMatrix = mat3(cosA / width, sinA / height, 0,\n-sinA / width, cosA / height, 0,\ndx,            dy,           1);\nvec2 patternSize = vec2(a_width, a_height);\nvec2 numPatternsPerMaxInt = vec2(MAX_REPRESENTABLE_INT) / patternSize;\nvec2 maxIntCrossingOffsetCorrection = patternSize * fract(u_maxIntNumOfCrossing * numPatternsPerMaxInt);\nvec2 tileOffset = u_tileOffset + maxIntCrossingOffsetCorrection - 0.5 * patternSize;\ntileOffset = vec2(tileOffset.x * cosA - tileOffset.y * sinA, tileOffset.x * sinA + tileOffset.y * cosA);\ntileOffset = mod(tileOffset, patternSize);\nvec2 symbolOffset = u_zoomFactor * scale * vec2(a_offset - tileOffset) / vec2(width, height);\nv_tileTextureCoord = (patternMatrix * vec3(a_pos * FILL_POSITION_PRECISION, 1.0)).xy - symbolOffset;\nv_aux1 = a_tlbr / u_mosaicSize.xyxy;\nv_sampleAlphaOnly = getBit(a_bitset, BITSET_GENERIC_CONSIDER_ALPHA_ONLY);\nif (getBit(a_bitSet, BITSET_FILL_HAS_UNRESOLVED_REPLACEMENT_COLOR) > 0.5) {\n#ifdef VV_COLOR\nv_sampleAlphaOnly *= (1.0 - float(isNan(VV_ADATA[ATTR_VV_COLOR]))) * (1.0 - getBit(a_bitSet, BITSET_GENERIC_LOCK_COLOR));\n#else\nv_sampleAlphaOnly = 0.0;\n#endif\n}\n#elif SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_DOT_DENSITY\nvec4 ddAttributeData0 = getAttributeData2(a_id) * u_isActive[0] * a_inverseArea;\nvec4 ddAttributeData1 = getAttributeData3(a_id) * u_isActive[1] * a_inverseArea;\nfloat size = u_tileZoomFactor * 512.0 * 1.0 / u_pixelRatio;\nv_dotThresholds[0] = dotThreshold(ddAttributeData0, u_dotValue, u_tileDotsOverArea);\nv_dotThresholds[1] = dotThreshold(ddAttributeData1, u_dotValue, u_tileDotsOverArea);\nv_dotTextureCoords = (a_pos * FILL_POSITION_PRECISION + 0.5) / size;\n#endif\n}\n#ifdef HITTEST\nvoid draw(out lowp vec4 out_color, out highp vec3 out_pos) {\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\nif (getBit(a_bitset, BITSET_TYPE_FILL_OUTLINE) > 0.5) {\nout_pos = vec3(0., 0., 2.);\nreturn;\n}\n#endif\nhittestFill(out_color, out_pos);\ngl_PointSize = 1.0;\n}\n#elif defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE)\nvoid draw(out lowp vec4 out_color, out highp vec3 out_pos) {\nv_isOutline = getBit(a_bitset, BITSET_TYPE_FILL_OUTLINE);\nif (v_isOutline > 0.5) {\ndrawLine(out_color, out_pos);\n} else {\ndrawFill(out_color, out_pos);\n}\n}\n#else\n#define draw drawFill\n#endif\nvoid main()\n{\nINIT;\nhighp vec3 pos  = vec3(0.);\nhighp vec4 color  = vec4(0.);\ndraw(color, pos);\nv_color = color;\ngl_Position = vec4(clip(v_color, pos, getFilterFlags(), a_zoomRange), 1.0);\n}","hittest.glsl":"#ifdef HITTEST\n#include <materials/hittest/common.glsl>\nattribute vec2 a_pos1;\nattribute vec2 a_pos2;\nvoid hittestFill(\nout lowp vec4 out_color,\nout highp vec3 out_pos\n) {\nvec3 pos        = u_viewMat3 * u_tileMat3 * vec3(a_pos  * FILL_POSITION_PRECISION, 1.);\nvec3 pos1       = u_viewMat3 * u_tileMat3 * vec3(a_pos1 * FILL_POSITION_PRECISION, 1.);\nvec3 pos2       = u_viewMat3 * u_tileMat3 * vec3(a_pos2 * FILL_POSITION_PRECISION, 1.);\nfloat hittestDist = u_hittestDist;\nfloat dist = distPointTriangle(u_hittestPos, pos.xy, pos1.xy, pos2.xy);\nout_pos = vec3(getAttributeDataTextureCoords(a_id), 0.0);\nif (dist < 0. || dist >= hittestDist) {\nout_pos.z += 2.0;\n}\nout_color = vec4(1. / 255., 0, 0, dist == 0. ? (1. / 255.) : 0.);\n}\n#endif"},hittest:{"common.glsl":"#ifdef HITTEST\nuniform float hittestDist;\nuniform highp vec2 hittestPos;\nfloat projectScalar(vec2 a, vec2 b) {\nreturn dot(a, normalize(b));\n}\nfloat distPointSegment(vec2 p0, vec2 p1, vec2 p2) {\nvec2 L = p2 - p1;\nvec2 A = p0 - p1;\nfloat projAL = projectScalar(A, L);\nfloat t = clamp(projAL / length(L), 0., 1.);\nreturn distance(p0, p1 + t * (p2 - p1));\n}\nvoid hittestMarker(out lowp vec4 out_color, out highp vec3 out_pos, in highp vec3 pos, float size) {\nfloat dist = distance(pos, vec3(hittestPos, 1.));\nout_pos = vec3(getAttributeDataTextureCoords(a_id), 0.0);\nif ((dist - size) > hittestDist) {\nout_pos.z += 2.0;\n}\nout_color = vec4(1. / 255., 0, 0, (dist - size) < 0. ? (1. / 255.) : 0.);\n}\nfloat intersectPointTriangleBary(vec2 p, vec2 a, vec2 b, vec2 c) {\nreturn inTriangle(xyToBarycentric(p, a, b, c));\n}\nfloat distPointTriangle(vec2 p, vec2 a, vec2 b, vec2 c) {\nvec2 ba = b - a;\nvec2 ca = c - a;\nfloat crossProduct = ba.x * ca.y - ca.x * ba.y;\nbool isParallel = crossProduct < EPSILON_HITTEST && crossProduct > -EPSILON_HITTEST;\nif (isParallel) {\nreturn -1.;\n}\nif (intersectPointTriangleBary(p.xy, a, b, c) == 1.) {\nreturn 0.;\n}\nfloat distAB = distPointSegment(p, a, b);\nfloat distBC = distPointSegment(p, b, c);\nfloat distCA = distPointSegment(p, c, a);\nreturn min(min(distAB, distBC), distCA);\n}\n#endif"},icon:{"common.glsl":"#include <util/encoding.glsl>\nuniform lowp vec2 u_mosaicSize;\nvarying lowp vec4 v_color;\nvarying highp vec3 v_id;\nvarying highp vec4 v_sizeTex;\nvarying mediump vec3 v_pos;\nvarying lowp float v_opacity;\nuniform lowp sampler2D u_texture;\n#ifdef SDF\nvarying lowp vec4 v_outlineColor;\nvarying mediump float v_outlineWidth;\nvarying mediump float v_distRatio;\nvarying mediump float v_overridingOutlineColor;\nvarying mediump float v_isThin;\n#endif\n#ifdef SDF\nvec4 getColor(vec2 v_size, vec2 v_tex) {\n#ifdef HITTEST\nlowp vec4 fillPixelColor = vec4(1.0);\n#else\nlowp vec4 fillPixelColor = v_color;\n#endif\nfloat d = 0.5 - rgba2float(texture2D(u_texture, v_tex));\nfloat size = max(v_size.x, v_size.y);\nfloat dist = d * size * SOFT_EDGE_RATIO * v_distRatio;\nfillPixelColor *= clamp(0.5 - dist, 0.0, 1.0);\nfloat outlineWidth = v_outlineWidth;\n#ifdef HIGHLIGHT\noutlineWidth = max(outlineWidth, 4.0 * v_isThin);\n#endif\nif (outlineWidth > 0.25) {\nlowp vec4 outlinePixelColor = v_overridingOutlineColor * v_color + (1.0 - v_overridingOutlineColor) * v_outlineColor;\nfloat clampedOutlineSize = min(outlineWidth, size);\noutlinePixelColor *= clamp(0.5 - abs(dist) + clampedOutlineSize * 0.5, 0.0, 1.0);\nreturn v_opacity * ((1.0 - outlinePixelColor.a) * fillPixelColor + outlinePixelColor);\n}\nreturn v_opacity * fillPixelColor;\n}\n#else\nvec4 getColor(vec2 _v_size, vec2 v_tex) {\nlowp vec4 texColor = texture2D(u_texture, v_tex);\nreturn v_opacity * texColor * v_color;\n}\n#endif",heatmapAccumulate:{"common.glsl":"varying lowp vec4 v_hittestResult;\nvarying mediump vec2 v_offsetFromCenter;\nvarying highp float v_fieldValue;","heatmapAccumulate.frag":"precision mediump float;\n#include <materials/icon/heatmapAccumulate/common.glsl>\n#ifdef HEATMAP_PRECISION_HALF_FLOAT\n#define COMPRESSION_FACTOR 0.25\n#else\n#define COMPRESSION_FACTOR 1.0\n#endif\nuniform lowp sampler2D u_texture;\nvoid main() {\n#ifdef HITTEST\ngl_FragColor = v_hittestResult;\n#else\nfloat radius = length(v_offsetFromCenter);\nfloat shapeWeight = step(radius, 1.0);\nfloat oneMinusRadiusSquared = 1.0 - radius * radius;\nfloat kernelWeight = oneMinusRadiusSquared * oneMinusRadiusSquared;\ngl_FragColor = vec4(shapeWeight * kernelWeight * v_fieldValue * COMPRESSION_FACTOR);\n#endif\n}","heatmapAccumulate.vert":"precision highp float;\nattribute vec2 a_vertexOffset;\nvec4 a_color = vec4(0.0);\nvec2 a_zoomRange = vec2(0.0, 10000.0);\nuniform float u_radius;\nuniform float u_isFieldActive;\n#include <materials/vcommon.glsl>\n#include <materials/hittest/common.glsl>\n#include <materials/icon/heatmapAccumulate/common.glsl>\nvoid main() {\nfloat filterFlags = getFilterFlags();\n#ifdef HITTEST\nhighp vec4 out_hittestResult = vec4(0.);\nhighp vec3 out_pos = vec3(0.);\nvec3 pos = u_viewMat3 * u_tileMat3 * vec3(a_pos * POSITION_PRECISION, 1.0);\nhittestMarker(out_hittestResult, out_pos, pos, u_radius);\nv_hittestResult = out_hittestResult;\ngl_PointSize = 1.;\ngl_Position = vec4(clip(a_color, out_pos, filterFlags, a_zoomRange), 1.0);\n#else\nv_offsetFromCenter = sign(a_vertexOffset);\nv_fieldValue = getAttributeData2(a_id).x * u_isFieldActive + 1.0 - u_isFieldActive;\nvec3 centerPos = u_dvsMat3 * vec3(a_pos * POSITION_PRECISION, 1.0);\nvec3 vertexPos = centerPos + u_displayViewMat3 * vec3(v_offsetFromCenter, 0.0) * u_radius;\ngl_Position = vec4(clip(a_color, vertexPos, filterFlags, a_zoomRange), 1.0);\n#endif\n}"},"hittest.glsl":"#ifdef HITTEST\n#include <materials/hittest/common.glsl>\nattribute vec2 a_vertexOffset1;\nattribute vec2 a_vertexOffset2;\nattribute vec2 a_texCoords1;\nattribute vec2 a_texCoords2;\nvec2 getTextureCoords(in vec3 bary, in vec2 texCoords0, in vec2 texCoords1, in vec2 texCoords2) {\nreturn texCoords0 * bary.x + texCoords1 * bary.y + texCoords2 * bary.z;\n}\nvoid hittestIcon(\ninout lowp vec4 out_color,\nout highp vec3 out_pos,\nin vec3 pos,\nin vec3 offset,\nin vec2 size,\nin float scaleFactor,\nin float isMapAligned\n) {\nout_pos = vec3(getAttributeDataTextureCoords(a_id), 0.0);\nvec3 posBase = u_viewMat3 * u_tileMat3  * pos;\nvec3 offset1 = scaleFactor * vec3(a_vertexOffset1 / 16.0, 0.);\nvec3 offset2 = scaleFactor * vec3(a_vertexOffset2 / 16.0, 0.);\nvec2 pos0    = (posBase + getMatrixNoDisplay(isMapAligned) * offset).xy;\nvec2 pos1    = (posBase + getMatrixNoDisplay(isMapAligned) * offset1).xy;\nvec2 pos2    = (posBase + getMatrixNoDisplay(isMapAligned) * offset2).xy;\nvec3 bary0 = xyToBarycentric(u_hittestPos + vec2(-u_hittestDist, -u_hittestDist), pos0, pos1, pos2);\nvec3 bary1 = xyToBarycentric(u_hittestPos + vec2(0., -u_hittestDist), pos0, pos1, pos2);\nvec3 bary2 = xyToBarycentric(u_hittestPos + vec2(u_hittestDist, -u_hittestDist), pos0, pos1, pos2);\nvec3 bary3 = xyToBarycentric(u_hittestPos + vec2(-u_hittestDist, 0.), pos0, pos1, pos2);\nvec3 bary4 = xyToBarycentric(u_hittestPos, pos0, pos1, pos2);\nvec3 bary5 = xyToBarycentric(u_hittestPos + vec2(u_hittestDist, 0.), pos0, pos1, pos2);\nvec3 bary6 = xyToBarycentric(u_hittestPos + vec2(-u_hittestDist, u_hittestDist), pos0, pos1, pos2);\nvec3 bary7 = xyToBarycentric(u_hittestPos + vec2(0., u_hittestDist), pos0, pos1, pos2);\nvec3 bary8 = xyToBarycentric(u_hittestPos + vec2(u_hittestDist, u_hittestDist), pos0, pos1, pos2);\nvec2 tex0 = a_texCoords  / u_mosaicSize;\nvec2 tex1 = a_texCoords1 / u_mosaicSize;\nvec2 tex2 = a_texCoords2 / u_mosaicSize;\nfloat alphaSum = 0.;\nalphaSum += inTriangle(bary0) * getColor(size, getTextureCoords(bary0, tex0, tex1, tex2)).a;\nalphaSum += inTriangle(bary1) * getColor(size, getTextureCoords(bary1, tex0, tex1, tex2)).a;\nalphaSum += inTriangle(bary2) * getColor(size, getTextureCoords(bary2, tex0, tex1, tex2)).a;\nalphaSum += inTriangle(bary3) * getColor(size, getTextureCoords(bary3, tex0, tex1, tex2)).a;\nalphaSum += inTriangle(bary4) * getColor(size, getTextureCoords(bary4, tex0, tex1, tex2)).a;\nalphaSum += inTriangle(bary5) * getColor(size, getTextureCoords(bary5, tex0, tex1, tex2)).a;\nalphaSum += inTriangle(bary6) * getColor(size, getTextureCoords(bary6, tex0, tex1, tex2)).a;\nalphaSum += inTriangle(bary7) * getColor(size, getTextureCoords(bary7, tex0, tex1, tex2)).a;\nout_pos.z += step(alphaSum, .05) * 2.0;\nout_color = vec4(1. / 255., 0., 0., alphaSum / 255.);\n}\n#endif","icon.frag":"precision mediump float;\n#include <materials/constants.glsl>\n#include <materials/utils.glsl>\n#include <materials/icon/common.glsl>\nvoid main()\n{\n#ifdef HITTEST\nvec4 color = v_color;\n#else\nvec4 color = getColor(v_sizeTex.xy, v_sizeTex.zw);\n#endif\n#ifdef HIGHLIGHT\ncolor.a = step(1.0 / 255.0, color.a);\n#endif\ngl_FragColor = color;\n}","icon.vert":"precision highp float;\nattribute vec4 a_color;\nattribute vec4 a_outlineColor;\nattribute vec4 a_sizeAndOutlineWidth;\nattribute vec2 a_vertexOffset;\nattribute vec2 a_texCoords;\nattribute vec2 a_bitSetAndDistRatio;\nattribute vec2 a_zoomRange;\n#include <materials/vcommon.glsl>\n#include <materials/icon/common.glsl>\n#include <materials/icon/hittest.glsl>\nfloat getMarkerScaleFactor(inout vec2 size, in float referenceSize) {\n#ifdef VV_SIZE\nfloat f = getSize(size.y) / size.y;\nfloat sizeFactor = size.y / referenceSize;\nreturn getSize(referenceSize) / referenceSize;\n#else\nreturn 1.;\n#endif\n}\nvoid main()\n{\nINIT;\nfloat a_bitSet = a_bitSetAndDistRatio.x;\nvec3  pos           = vec3(a_pos * POSITION_PRECISION, 1.0);\nvec2  size          = a_sizeAndOutlineWidth.xy * a_sizeAndOutlineWidth.xy / 128.0;\nvec3  offset        = vec3(a_vertexOffset / 16.0, 0.);\nfloat outlineSize   = a_sizeAndOutlineWidth.z * a_sizeAndOutlineWidth.z / 128.0;\nfloat isMapAligned  = getBit(a_bitSet, BITSET_MARKER_ALIGNMENT_MAP);\nfloat referenceSize = a_sizeAndOutlineWidth.w * a_sizeAndOutlineWidth.w / 128.0;\nfloat scaleSymbolProportionally = getBit(a_bitSet, BITSET_MARKER_SCALE_SYMBOLS_PROPORTIONALLY);\nfloat scaleFactor               = getMarkerScaleFactor(size, referenceSize);\nsize.xy     *= scaleFactor;\noffset.xy   *= scaleFactor;\noutlineSize *= scaleSymbolProportionally * (scaleFactor - 1.0) + 1.0;\nvec2 v_tex   = a_texCoords / u_mosaicSize;\nfloat filterFlags = getFilterFlags();\nv_color    = getColor(a_color, a_bitSet, BITSET_GENERIC_LOCK_COLOR);\nv_opacity  = getOpacity();\nv_id       = norm(a_id);\nv_pos      = u_dvsMat3 * pos + getMatrix(isMapAligned) * getRotation()  * offset;\nv_sizeTex  = vec4(size.xy, v_tex.xy);\n#ifdef SDF\nv_isThin   = getBit(a_bitSet, BITSET_MARKER_OUTLINE_ALLOW_COLOR_OVERRIDE);\n#ifdef VV_COLOR\nv_overridingOutlineColor = v_isThin;\n#else\nv_overridingOutlineColor = 0.0;\n#endif\nv_outlineWidth = min(outlineSize, max(max(size.x, size.y) - 0.99, 0.0));\nv_outlineColor = a_outlineColor;\nv_distRatio = a_bitSetAndDistRatio.y / 128.0;\n#endif\n#ifdef HITTEST\nhighp vec4 out_color = vec4(0.);\nhighp vec3 out_pos   = vec3(0.);\nhittestIcon(out_color, out_pos, pos, offset, size, scaleFactor, isMapAligned);\nv_color = out_color;\ngl_PointSize = 1.;\ngl_Position = vec4(clip(v_color, out_pos, filterFlags, a_zoomRange), 1.0);\n#else\ngl_Position = vec4(clip(v_color, v_pos, filterFlags, a_zoomRange), 1.0);\n#endif\n}"},label:{"common.glsl":"uniform mediump float u_zoomLevel;\nuniform mediump float u_mapRotation;\nuniform mediump float u_mapAligned;\nuniform mediump vec2 u_mosaicSize;\nvarying mediump float v_antialiasingWidth;\nvarying mediump float v_edgeDistanceOffset;\nvarying mediump vec2 v_tex;\nvarying mediump vec4 v_color;\nvarying lowp vec4 v_animation;","label.frag":"#include <materials/text/text.frag>","label.vert":"precision highp float;\n#include <materials/vcommon.glsl>\n#include <materials/text/common.glsl>\nattribute vec4 a_color;\nattribute vec4 a_haloColor;\nattribute vec4 a_texAndSize;\nattribute vec4 a_refSymbolAndPlacementOffset;\nattribute vec4 a_glyphData;\nattribute vec2 a_vertexOffset;\nattribute vec2 a_texCoords;\nuniform float u_isHaloPass;\nuniform float u_isBackgroundPass;\nuniform float u_mapRotation;\nuniform float u_mapAligned;\nfloat getZ(in float minZoom, in float maxZoom, in float angle) {\nfloat glyphAngle = angle * 360.0 / 254.0;\nfloat mapAngle = u_mapRotation * 360.0 / 254.0;\nfloat diffAngle = min(360.0 - abs(mapAngle - glyphAngle), abs(mapAngle - glyphAngle));\nfloat z = 0.0;\nz += u_mapAligned * (2.0 * (1.0 - step(minZoom, u_currentZoom)));\nz += u_mapAligned * 2.0 * step(90.0, diffAngle);\nz += 2.0 * (1.0 - step(u_currentZoom, maxZoom));\nreturn z;\n}\nvoid main()\n{\nINIT;\nfloat groupMinZoom    = getMinZoom();\nfloat glyphMinZoom    = a_glyphData.x;\nfloat glyphMaxZoom    = a_glyphData.y;\nfloat glyphAngle      = a_glyphData.z;\nfloat a_isBackground  = a_glyphData.w;\nfloat a_minZoom          = max(groupMinZoom, glyphMinZoom);\nfloat a_placementPadding = a_refSymbolAndPlacementOffset.x * EXTRUDE_SCALE_PLACEMENT_PADDING;\nvec2  a_placementDir     = unpack_u8_nf32(a_refSymbolAndPlacementOffset.zw);\nfloat a_refSymbolSize    = a_refSymbolAndPlacementOffset.y;\nfloat fontSize           = a_texAndSize.z;\nfloat haloSize           = a_texAndSize.w * OUTLINE_SCALE;\nvec2  vertexOffset = a_vertexOffset * OFFSET_PRECISION;\nvec3  pos          = vec3(a_pos * POSITION_PRECISION, 1.0);\nfloat z            = getZ(a_minZoom, glyphMaxZoom, glyphAngle);\nfloat fontScale    = fontSize / SDF_FONT_SIZE;\nfloat halfSize     = getSize(a_refSymbolSize) / 2.0;\nfloat animation    = pow(getAnimationState(), vec4(2.0)).r;\nfloat isText = 1.0 - a_isBackground;\nfloat isBackground = u_isBackgroundPass * a_isBackground;\nvec4  nonHaloColor = (isBackground + isText) * a_color;\nv_color     = animation * ((1.0 - u_isHaloPass) * nonHaloColor + (u_isHaloPass * a_haloColor));\nv_opacity   = 1.0;\nv_tex       = a_texCoords / u_mosaicSize;\nv_edgeDistanceOffset = u_isHaloPass * haloSize / fontScale / MAX_SDF_DISTANCE;\nv_antialiasingWidth  = 0.105 * SDF_FONT_SIZE / fontSize / u_pixelRatio;\nvec2 placementOffset = a_placementDir * (halfSize + a_placementPadding);\nvec3 glyphOffset     = u_displayMat3 * vec3(vertexOffset + placementOffset, 0.0);\nvec3 v_pos           = vec3((u_dvsMat3 * pos + glyphOffset).xy, z);\nfloat isHidden = u_isBackgroundPass * isText + (1.0 - u_isBackgroundPass) * a_isBackground;\nv_pos.z += 2.0 * isHidden;\ngl_Position = vec4(v_pos, 1.0);\n#ifdef DEBUG\nv_color = vec4(a_color.rgb, z == 0.0 ? 1.0 : 0.645);\n#endif\n}"},line:{"common.glsl":"varying lowp vec4 v_color;\nvarying highp vec3 v_id;\nvarying mediump vec2 v_normal;\nvarying mediump float v_lineHalfWidth;\nvarying lowp float v_opacity;\n#ifdef PATTERN\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\n#endif\n#if defined(PATTERN) || defined(SDF)\nvarying highp float v_accumulatedDistance;\n#endif\n#ifdef SDF\nvarying mediump float v_lineWidthRatio;\n#endif","hittest.glsl":"#include <materials/hittest/common.glsl>\n#ifdef HITTEST\nattribute vec2 a_pos1;\nattribute vec2 a_pos2;\nvoid hittestLine(out lowp vec4 out_color, out highp vec3 out_pos, float halfWidth) {\nvec3 pos        = u_viewMat3 * u_tileMat3 * vec3(a_pos  * POSITION_PRECISION, 1.);\nvec3 pos1       = u_viewMat3 * u_tileMat3 * vec3(a_pos1 * POSITION_PRECISION, 1.);\nvec3 pos2       = u_viewMat3 * u_tileMat3 * vec3(a_pos2 * POSITION_PRECISION, 1.);\nvec3 outTextureCoords = vec3(getAttributeDataTextureCoords(a_id), 0.0);\nfloat dist = min(distPointSegment(u_hittestPos, pos.xy, pos1.xy),\ndistPointSegment(u_hittestPos, pos.xy, pos2.xy)) - halfWidth;\nout_pos = vec3(getAttributeDataTextureCoords(a_id), 0.0);\nif (dist >= u_hittestDist) {\nout_pos.z += 2.0;\n}\nout_color = vec4(1. / 255., 0, 0, dist <= 0. ? (1. / 255.) : 0.);\n}\n#endif","line.frag":"precision lowp float;\n#include <util/encoding.glsl>\n#include <materials/constants.glsl>\n#include <materials/symbologyTypeUtils.glsl>\n#include <materials/line/common.glsl>\n#include <materials/shared/line/common.glsl>\n#include <materials/shared/line/line.frag>\n#ifdef HITTEST\nvoid main() {\ngl_FragColor = v_color;\n}\n#else\nvoid main() {\nLineData inputs = LineData(\nv_color,\nv_normal,\nv_lineHalfWidth,\nv_opacity,\n#ifndef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#ifdef PATTERN\nv_tlbr,\nv_patternSize,\n#endif\n#ifdef SDF\nv_lineWidthRatio,\n#endif\n#if defined(PATTERN) || defined(SDF)\nv_accumulatedDistance,\n#endif\n#endif\nv_id\n);\ngl_FragColor = shadeLine(inputs);\n}\n#endif","line.vert":"precision highp float;\nattribute vec4 a_color;\nattribute vec4 a_offsetAndNormal;\nattribute vec2 a_accumulatedDistanceAndHalfWidth;\nattribute vec4 a_tlbr;\nattribute vec4 a_segmentDirection;\nattribute vec2 a_aux;\nattribute vec2 a_zoomRange;\n#include <materials/vcommon.glsl>\n#include <materials/symbologyTypeUtils.glsl>\n#include <materials/line/common.glsl>\n#include <materials/line/hittest.glsl>\n#include <materials/shared/line/common.glsl>\n#include <materials/shared/line/line.vert>\n#ifdef HITTEST\nvoid draw() {\nfloat aa        = 0.5 * u_antialiasing;\nfloat a_halfWidth = a_accumulatedDistanceAndHalfWidth.y / 16.;\nfloat a_cimHalfWidth = a_aux.x / 16. ;\nvec2  a_offset = a_offsetAndNormal.xy / 16.;\nfloat baseWidth = getBaseLineHalfWidth(a_halfWidth, a_cimHalfWidth);\nfloat halfWidth = getLineHalfWidth(baseWidth, aa);\nhighp vec3 pos  = vec3(0.);\nv_color = vec4(0.);\nhittestLine(v_color, pos, halfWidth);\ngl_PointSize = 1.;\ngl_Position = vec4(clip(v_color, pos, getFilterFlags(), a_zoomRange), 1.0);\n}\n#else\nvoid draw()\n{\nhighp vec3 pos = vec3(0.);\nLineData outputs = buildLine(\npos,\na_id,\na_pos,\na_color,\na_offsetAndNormal.xy / 16.,\na_offsetAndNormal.zw / 16.,\na_accumulatedDistanceAndHalfWidth.x,\na_accumulatedDistanceAndHalfWidth.y / 16.,\na_segmentDirection.w,\na_tlbr,\na_segmentDirection.xy / 16.,\na_aux.x / 16.\n);\nv_id              = outputs.id;\nv_color           = outputs.color;\nv_normal          = outputs.normal;\nv_lineHalfWidth   = outputs.lineHalfWidth;\nv_opacity         = outputs.opacity;\n#ifndef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#ifdef PATTERN\nv_tlbr          = outputs.tlbr;\nv_patternSize   = outputs.patternSize;\n#endif\n#ifdef SDF\nv_lineWidthRatio = outputs.lineWidthRatio;\n#endif\n#if defined(PATTERN) || defined(SDF)\nv_accumulatedDistance = outputs.accumulatedDistance;\n#endif\n#endif\ngl_Position = vec4(clip(outputs.color, pos, getFilterFlags(), a_zoomRange), 1.0);\n}\n#endif\nvoid main() {\nINIT;\ndraw();\n}"},pie:{"pie.common.glsl":"uniform float outlineWidth;\nuniform mediump float sectorThreshold;\nvarying vec3  v_id;\nvarying vec3  v_pos;\nvarying vec2  v_offset;\nvarying vec4  v_color;\nvarying float v_size;\nvarying float v_numOfEntries;\nvarying float v_maxSectorAngle;\nvarying vec2  v_filteredSectorToColorId[numberOfFields];\nvarying vec2  v_texCoords;\nvarying float v_outlineWidth;\nvarying float v_opacity;\nstruct FilteredChartInfo {\nfloat endSectorAngle;\nint colorId;\n};","pie.frag":"precision highp float;\n#include <util/atan2.glsl>\n#include <materials/constants.glsl>\n#include <materials/utils.glsl>\n#include <materials/pie/pie.common.glsl>\nuniform lowp vec4 colors[numberOfFields];\nuniform lowp vec4 defaultColor;\nuniform lowp vec4 othersColor;\nuniform lowp vec4 outlineColor;\nuniform float donutRatio;\nlowp vec4 getSectorColor(in int index, in vec2 filteredSectorToColorId[numberOfFields]) {\nmediump int colorIndex = int(filteredSectorToColorId[index].y);\nreturn colors[colorIndex];\n}\nconst int OTHER_SECTOR_ID = 255;\n#ifdef HITTEST\nvec4 getColor() {\nfloat distanceSize = length(v_offset) * v_size;\nfloat donutSize = donutRatio * v_size;\nfloat alpha = step(donutSize, distanceSize) * (1.0 - step(v_size, distanceSize));\nreturn v_color;\n}\n#else\nvec4 getColor() {\nfloat angle = 90.0 - C_RAD_TO_DEG * atan2(v_offset.y, v_offset.x);\nif (angle < 0.0) {\nangle += 360.0;\n} else if (angle > 360.0) {\nangle = mod(angle, 360.0);\n}\nint numOfEntries = int(v_numOfEntries);\nfloat maxSectorAngle = v_maxSectorAngle;\nlowp vec4 fillColor = (maxSectorAngle > 0.0 || sectorThreshold > 0.0) ? othersColor : defaultColor;\nlowp vec4 prevColor = vec4(0.0);\nlowp vec4 nextColor = vec4(0.0);\nfloat startSectorAngle = 0.0;\nfloat endSectorAngle = 0.0;\nif (angle < maxSectorAngle) {\nfor (int index = 0; index < numberOfFields; ++index) {\nstartSectorAngle = endSectorAngle;\nendSectorAngle = v_filteredSectorToColorId[index].x;\nif (endSectorAngle > angle) {\nfillColor = getSectorColor(index, v_filteredSectorToColorId);\nprevColor = sectorThreshold != 0.0 && index == 0 && abs(360.0 - maxSectorAngle) < EPSILON ? othersColor :\ngetSectorColor(index > 0 ? index - 1 : numOfEntries - 1, v_filteredSectorToColorId);\nnextColor = sectorThreshold != 0.0 && abs(endSectorAngle - maxSectorAngle) < EPSILON ? othersColor :\ngetSectorColor(index < numOfEntries - 1 ? index + 1 : 0, v_filteredSectorToColorId);\nbreak;\n}\nif (index == numOfEntries - 1) {\nbreak;\n}\n}\n} else {\nprevColor = getSectorColor(numOfEntries - 1, v_filteredSectorToColorId);\nnextColor = getSectorColor(0, v_filteredSectorToColorId);\nstartSectorAngle = maxSectorAngle;\nendSectorAngle = 360.0;\n}\nlowp vec4 outlineColor = outlineColor;\nfloat offset = length(v_offset);\nfloat distanceSize = offset * v_size;\nif (startSectorAngle != 0.0 || endSectorAngle != 360.0) {\nfloat distanceToStartSector = (angle - startSectorAngle);\nfloat distanceToEndSector = (endSectorAngle - angle);\nfloat sectorThreshold = 0.6;\nfloat beginSectorAlpha = smoothstep(0.0, sectorThreshold, distanceToStartSector * offset);\nfloat endSectorAlpha = smoothstep(0.0, sectorThreshold, distanceToEndSector * offset);\nif (endSectorAlpha > 0.0) {\nfillColor = mix(nextColor, fillColor, endSectorAlpha);\n} else if (beginSectorAlpha > 0.0) {\nfillColor = mix(prevColor, fillColor, beginSectorAlpha);\n}\n}\nfloat donutSize = donutRatio * (v_size - v_outlineWidth);\nfloat endOfDonut = donutSize - v_outlineWidth;\nfloat aaThreshold = 0.75;\nfloat innerCircleAlpha = endOfDonut - aaThreshold > 0.0 ? smoothstep(endOfDonut - aaThreshold, endOfDonut + aaThreshold, distanceSize) : 1.0;\nfloat outerCircleAlpha = 1.0 - smoothstep(v_size - aaThreshold, v_size + aaThreshold , distanceSize);\nfloat circleAlpha = innerCircleAlpha * outerCircleAlpha;\nfloat startOfOutline = v_size - v_outlineWidth;\nif (startOfOutline > 0.0 && v_outlineWidth > 0.25) {\nfloat outlineFactor = smoothstep(startOfOutline - aaThreshold, startOfOutline + aaThreshold, distanceSize);\nfloat innerLineFactor = donutSize - aaThreshold > 0.0 ? 1.0 - smoothstep(donutSize - aaThreshold, donutSize + aaThreshold , distanceSize) : 0.0;\nfillColor = mix(fillColor, outlineColor, innerLineFactor + outlineFactor);\n}\nreturn v_opacity * circleAlpha * fillColor;\n}\n#endif\nvoid main()\n{\nvec4 color = getColor();\n#ifdef highlight\ncolor.a = step(1.0 / 255.0, color.a);\n#endif\ngl_FragColor = color;\n}","pie.vert":"#include <materials/constants.glsl>\n#include <materials/utils.glsl>\n#include <materials/barycentric.glsl>\n#include <materials/vcommon.glsl>\n#include <materials/vv.glsl>\n#include <materials/attributeData.glsl>\n#include <materials/pie/pie.common.glsl>\n#include <materials/hittest/common.glsl>\nattribute float a_bitSet;\nattribute vec2  a_offset;\nattribute vec2  a_texCoords;\nattribute vec2  a_size;\nattribute float a_referenceSize;\nattribute vec2  a_zoomRange;\nint filterValue(in float sectorAngle,\nin int currentIndex,\ninout FilteredChartInfo filteredInfo,\ninout vec2 filteredSectorToColorId[numberOfFields]) {\nif (sectorAngle > sectorThreshold * 360.0) {\nfilteredInfo.endSectorAngle += sectorAngle;\nfilteredSectorToColorId[filteredInfo.colorId] = vec2(filteredInfo.endSectorAngle, currentIndex);\n++filteredInfo.colorId;\n}\nreturn 0;\n}\nint filterValues(inout vec2 filteredSectorToColorId[numberOfFields],\ninout FilteredChartInfo filteredInfo,\nin float sectorAngles[numberOfFields]) {\nfor (int index = 0; index < numberOfFields; ++index) {\nfloat sectorValue = sectorAngles[index];\nfilterValue(sectorValue, index, filteredInfo, filteredSectorToColorId);\n}\nreturn filteredInfo.colorId;\n}\nvec2 getMarkerSize(inout vec2 offset, inout vec2 baseSize, inout float outlineSize, in float a_referenceSize, in float bitSet) {\nvec2 outSize = baseSize;\n#ifdef VV_SIZE\nfloat r = getSize(a_referenceSize, currentScale) / a_referenceSize;\noutSize.xy *= r;\noffset.xy *= r;\nfloat scaleSymbolProportionally = getBit(bitSet, BITSET_MARKER_SCALE_SYMBOLS_PROPORTIONALLY);\noutlineSize *= scaleSymbolProportionally * (r - 1.0) + 1.0;\n#endif\nreturn outSize;\n}\nvec3 getOffset(in vec2 in_offset, float a_bitSet) {\nfloat isMapAligned = getBit(a_bitSet, BITSET_MARKER_ALIGNMENT_MAP);\nvec3  offset       = vec3(in_offset, 0.0);\nreturn getMatrix(isMapAligned) * offset;\n}\nfloat filterNaNValues(in float value) {\nreturn value != NAN_MAGIC_NUMBER && value > 0.0 ? value : 0.0;\n}\nvoid main()\n{\nINIT;\nvec2  a_size   = a_size;\nvec2  a_offset = a_offset / 16.0;\nfloat outlineSize = outlineWidth;\nfloat a_bitSet = a_bitSet;\nfloat a_referenceSize = a_referenceSize;\nvec2 a_texCoords = a_texCoords / 4.0;\nvec2 markerSize = getMarkerSize(a_offset, a_size, outlineSize, a_referenceSize, a_bitSet);\nfloat filterFlags = getFilterFlags();\nvec3  pos         = vec3(a_pos / 10.0, 1.0);\nv_opacity      = getOpacity();\nv_id           = norm(a_id);\nv_pos          = displayViewScreenMat3 * pos + getOffset(a_offset, a_bitSet);\nv_offset       = sign(a_texCoords - 0.5);\nv_size         = max(markerSize.x, markerSize.y);\nv_outlineWidth = outlineSize;\nfloat attributeData[10];\nvec4 attributeData3 = getDataDriven0(a_id);\nattributeData[0] = filterNaNValues(attributeData3.x);\nattributeData[1] = filterNaNValues(attributeData3.y);\nattributeData[2] = filterNaNValues(attributeData3.z);\nattributeData[3] = filterNaNValues(attributeData3.w);\n#if (numberOfFields > 4)\nvec4 attributeData4 = getDataDriven1(a_id);\nattributeData[4] = filterNaNValues(attributeData4.x);\nattributeData[5] = filterNaNValues(attributeData4.y);\nattributeData[6] = filterNaNValues(attributeData4.z);\nattributeData[7] = filterNaNValues(attributeData4.w);\n#endif\n#if (numberOfFields > 8)\nvec4 attributeData5 = getDataDriven2(a_id);\nattributeData[8] = filterNaNValues(attributeData5.x);\nattributeData[9] = filterNaNValues(attributeData5.y);\n#endif\nfloat sum = 0.0;\nfor (int i = 0; i < numberOfFields; ++i) {\nsum += attributeData[i];\n}\nfloat sectorAngles[numberOfFields];\nfor (int i = 0; i < numberOfFields; ++i) {\nsectorAngles[i] = 360.0 * attributeData[i] / sum;\n}\nvec2 filteredSectorToColorId[numberOfFields];\nFilteredChartInfo filteredInfo = FilteredChartInfo(0.0, 0);\nint numOfEntries = filterValues(filteredSectorToColorId, filteredInfo, sectorAngles);\nv_numOfEntries = float(numOfEntries);\nv_maxSectorAngle = filteredInfo.endSectorAngle;\nv_filteredSectorToColorId = filteredSectorToColorId;\n#ifdef HITTEST\nhighp vec3 out_pos = vec3(0.0);\nv_color            = vec4(0.0);\nhittestMarker(v_color, out_pos, viewMat3 * tileMat3 *  pos, v_size);\ngl_PointSize = 1.0;\ngl_Position = vec4(clip(v_color, out_pos, filterFlags, a_zoomRange), 1.0);\n#else\ngl_Position = vec4(clip(v_color, v_pos, filterFlags, a_zoomRange), 1.0);\n#endif\n}"},shared:{line:{"common.glsl":"#if !defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE) && defined(PATTERN)\nuniform mediump vec2 u_mosaicSize;\nvarying mediump float v_sampleAlphaOnly;\n#endif\nstruct LineData {\nlowp vec4 color;\nmediump vec2 normal;\nmediump float lineHalfWidth;\nlowp float opacity;\n#ifndef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#ifdef PATTERN\nmediump vec4 tlbr;\nmediump vec2 patternSize;\n#endif\n#ifdef SDF\nmediump float lineWidthRatio;\n#endif\n#if defined(PATTERN) || defined(SDF)\nhighp float accumulatedDistance;\n#endif\n#endif\nhighp vec3 id;\n};","line.frag":"uniform lowp float u_blur;\n#if !defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE) && !defined(HIGHLIGHT)\n#if defined(PATTERN) || defined(SDF)\nuniform sampler2D u_texture;\nuniform highp float u_pixelRatio;\n#endif\n#endif\n#if defined(SDF) && !defined(HIGHLIGHT) && !defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE)\nlowp vec4 getLineColor(LineData line) {\nmediump float adjustedPatternWidth = line.patternSize.x * 2.0 * line.lineWidthRatio;\nmediump float relativeTexX = fract(line.accumulatedDistance / adjustedPatternWidth);\nmediump float relativeTexY = 0.5 + 0.25 * line.normal.y;\nmediump vec2 texCoord = mix(line.tlbr.xy, line.tlbr.zw, vec2(relativeTexX, relativeTexY));\nmediump float d = rgba2float(texture2D(u_texture, texCoord)) - 0.5;\nfloat dist = d * line.lineHalfWidth;\nreturn line.opacity * clamp(0.5 - dist, 0.0, 1.0) * line.color;\n}\n#elif defined(PATTERN) && !defined(HIGHLIGHT) && !defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE)\nlowp vec4 getLineColor(LineData line) {\nmediump float lineHalfWidth = line.lineHalfWidth;\nmediump float adjustedPatternHeight = line.patternSize.y * 2.0 * lineHalfWidth / line.patternSize.x;\nmediump float relativeTexY = fract(line.accumulatedDistance / adjustedPatternHeight);\nmediump float relativeTexX = 0.5 + 0.5 * line.normal.y;\nmediump vec2 texCoord = mix(line.tlbr.xy, line.tlbr.zw, vec2(relativeTexX, relativeTexY));\nlowp vec4 color = texture2D(u_texture, texCoord);\n#ifdef VV_COLOR\nif (v_sampleAlphaOnly > 0.5) {\ncolor.rgb = vec3(color.a);\n}\n#endif\nreturn line.opacity * line.color * color;\n}\n#else\nlowp vec4 getLineColor(LineData line) {\nreturn line.opacity * line.color;\n}\n#endif\nvec4 shadeLine(LineData line)\n{\nmediump float thinLineFactor = max(THIN_LINE_WIDTH_FACTOR * step(line.lineHalfWidth, THIN_LINE_HALF_WIDTH), 1.0);\nmediump float fragDist = length(line.normal) * line.lineHalfWidth;\nlowp float alpha = clamp(thinLineFactor * (line.lineHalfWidth - fragDist) / (u_blur + thinLineFactor - 1.0), 0.0, 1.0);\nlowp vec4 out_color = getLineColor(line) * alpha;\n#ifdef HIGHLIGHT\nout_color.a = step(1.0 / 255.0, out_color.a);\n#endif\n#ifdef ID\nif (out_color.a < 1.0 / 255.0) {\ndiscard;\n}\nout_color = vec4(line.id, 0.0);\n#endif\nreturn out_color;\n}","line.vert":"float getBaseLineHalfWidth(in float lineHalfWidth, in float referenceHalfWidth) {\n#ifdef VV_SIZE\nfloat refLineWidth = 2.0 * referenceHalfWidth;\nreturn 0.5 * (lineHalfWidth / max(referenceHalfWidth, EPSILON)) * getSize(refLineWidth);\n#else\nreturn lineHalfWidth;\n#endif\n}\nfloat getLineHalfWidth(in float baseWidth, in float aa) {\nfloat halfWidth = max(baseWidth + aa, 0.45) + 0.1 * aa;\n#ifdef HIGHLIGHT\nhalfWidth = max(halfWidth, 2.0);\n#endif\nreturn halfWidth;\n}\nvec2 getDist(in vec2 offset, in float halfWidth) {\nfloat thinLineFactor = max(THIN_LINE_WIDTH_FACTOR * step(halfWidth, THIN_LINE_HALF_WIDTH), 1.0);\nreturn thinLineFactor * halfWidth * offset;\n}\nLineData buildLine(\nout vec3 out_pos,\nin vec3 in_id,\nin vec2 in_pos,\nin vec4 in_color,\nin vec2 in_offset,\nin vec2 in_normal,\nin float in_accumulatedDist,\nin float in_lineHalfWidth,\nin float in_bitSet,\nin vec4 in_tlbr,\nin vec2 in_segmentDirection,\nin float in_referenceHalfWidth\n)\n{\nfloat aa        = 0.5 * u_antialiasing;\nfloat baseWidth = getBaseLineHalfWidth(in_lineHalfWidth, in_referenceHalfWidth);\nfloat halfWidth = getLineHalfWidth(baseWidth, aa);\nfloat z         = 2.0 * step(baseWidth, 0.0);\nvec2  dist      = getDist(in_offset, halfWidth);\nvec3  offset    = u_displayViewMat3 * vec3(dist, 0.0);\nvec3  pos       = u_dvsMat3 * vec3(in_pos * POSITION_PRECISION, 1.0) + offset;\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\nvec4  color     = in_color;\nfloat opacity   = 1.0;\n#else\nvec4  color     = getColor(in_color, in_bitSet, BITSET_GENERIC_LOCK_COLOR);\nfloat opacity   = getOpacity();\n#ifdef SDF\nconst float SDF_PATTERN_HALF_WIDTH = 15.5;\nfloat scaleDash = getBit(in_bitSet, BITSET_LINE_SCALE_DASH);\nfloat lineWidthRatio = (scaleDash * max(halfWidth - 0.55 * u_antialiasing, 0.25) + (1.0 - scaleDash)) / SDF_PATTERN_HALF_WIDTH;\n#endif\n#endif\n#if !defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE) && defined(PATTERN)\nv_sampleAlphaOnly = getBit(in_bitSet, BITSET_GENERIC_CONSIDER_ALPHA_ONLY);\n#endif\nout_pos = vec3(pos.xy, z);\nreturn LineData(\ncolor,\nin_normal,\nhalfWidth,\nopacity,\n#ifndef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#ifdef PATTERN\nin_tlbr / u_mosaicSize.xyxy,\nvec2(in_tlbr.z - in_tlbr.x, in_tlbr.w - in_tlbr.y),\n#endif\n#ifdef SDF\nlineWidthRatio,\n#endif\n#if defined(PATTERN) || defined(SDF)\nin_accumulatedDist * u_zoomFactor + dot(in_segmentDirection, dist),\n#endif\n#endif\nnorm(in_id)\n);\n}"}},"symbologyTypeUtils.glsl":"#if SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_OUTLINE_FILL || SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_OUTLINE_FILL_SIMPLE\n#define SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#endif\n#if SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_SIMPLE || SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_OUTLINE_FILL_SIMPLE\n#define SYMBOLOGY_TYPE_IS_SIMPLE_LIKE\n#endif",text:{"common.glsl":"uniform highp vec2 u_mosaicSize;\nvarying highp vec3 v_id;\nvarying mediump vec3 v_pos;\nvarying lowp float v_opacity;\nvarying lowp vec4 v_color;\nvarying highp vec2 v_tex;\nvarying mediump float v_antialiasingWidth;\nvarying mediump float v_edgeDistanceOffset;\nvarying lowp float v_transparency;","hittest.glsl":"#include <materials/hittest/common.glsl>","text.frag":"precision mediump float;\n#include <materials/text/common.glsl>\nuniform lowp sampler2D u_texture;\n#ifdef HITTEST\nvec4 getColor() {\nreturn v_color;\n}\n#else\nvec4 getColor()\n{\nfloat SDF_CUTOFF = (2.0 / 8.0);\nfloat SDF_BASE_EDGE_DIST = 1.0 - SDF_CUTOFF;\nlowp float dist = texture2D(u_texture, v_tex).a;\nmediump float edge = SDF_BASE_EDGE_DIST - v_edgeDistanceOffset;\n#ifdef HIGHLIGHT\nedge /= 2.0;\n#endif\nlowp float aa = v_antialiasingWidth;\nlowp float alpha = smoothstep(edge - aa, edge + aa, dist);\nreturn alpha * v_color * v_opacity;\n}\n#endif\nvoid main()\n{\ngl_FragColor = getColor();\n}","text.vert":"precision highp float;\n#include <materials/utils.glsl>\n#include <materials/vcommon.glsl>\n#include <materials/text/common.glsl>\n#include <materials/text/hittest.glsl>\nattribute vec4 a_color;\nattribute vec4 a_haloColor;\nattribute vec4 a_texFontSize;\nattribute vec4 a_aux;\nattribute vec2 a_zoomRange;\nattribute vec2 a_vertexOffset;\nattribute vec2 a_texCoords;\nuniform float u_isHaloPass;\nuniform float u_isBackgroundPass;\nfloat getTextSize(inout vec2 offset, inout float baseSize, in float referenceSize) {\n#ifdef VV_SIZE\nfloat r = getSize(referenceSize) / referenceSize;\nbaseSize *= r;\noffset.xy *= r;\nreturn baseSize;\n#endif\nreturn baseSize;\n}\nvoid main()\n{\nINIT;\nfloat a_isBackground  = a_aux.y;\nfloat a_referenceSize = a_aux.z * a_aux.z / 256.0;\nfloat a_bitSet        = a_aux.w;\nfloat a_fontSize      = a_texFontSize.z;\nvec2  a_offset        = a_vertexOffset * OFFSET_PRECISION;\nvec3  in_pos        = vec3(a_pos * POSITION_PRECISION, 1.0);\nfloat fontSize      = getTextSize(a_offset, a_fontSize, a_referenceSize);\nfloat fontScale     = fontSize / SDF_FONT_SIZE;\nvec3  offset        = getRotation() * vec3(a_offset, 0.0);\nmat3  extrudeMatrix = getBit(a_bitSet, 0) == 1.0 ? u_displayViewMat3 : u_displayMat3;\nfloat isText = 1.0 - a_isBackground;\nfloat isBackground = u_isBackgroundPass * a_isBackground;\nvec4  nonHaloColor  = (isBackground * a_color) + (isText * getColor(a_color, a_bitSet, 1));\nv_color   = u_isHaloPass * a_haloColor + (1.0 - u_isHaloPass) * nonHaloColor;\nv_opacity = getOpacity();\nv_id      = norm(a_id);\nv_tex     = a_texCoords / u_mosaicSize;\nv_pos     = u_dvsMat3 * in_pos + extrudeMatrix * offset;\nfloat isHidden = u_isBackgroundPass * isText + (1.0 - u_isBackgroundPass) * a_isBackground;\nv_pos.z += 2.0 * isHidden;\nv_edgeDistanceOffset = u_isHaloPass * OUTLINE_SCALE * a_texFontSize.w / fontScale / MAX_SDF_DISTANCE;\nv_antialiasingWidth  = 0.105 * SDF_FONT_SIZE / fontSize / u_pixelRatio;\n#ifdef HITTEST\nhighp vec3 out_pos  = vec3(0.);\nv_color = vec4(0.);\nhittestMarker(v_color, out_pos, u_viewMat3 * u_tileMat3 *  vec3(a_pos * POSITION_PRECISION, 1.0)\n+ u_tileMat3 * offset, fontSize / 2.);\ngl_PointSize = 1.;\ngl_Position = vec4(clip(v_color, out_pos, getFilterFlags(), a_zoomRange), 1.0);\n#else\ngl_Position =  vec4(clip(v_color, v_pos, getFilterFlags(), a_zoomRange), 1.0);\n#endif\n}"},"utils.glsl":"float rshift(in float u32, in int amount) {\nreturn floor(u32 / pow(2.0, float(amount)));\n}\nfloat getBit(in float bitset, in int bitIndex) {\nfloat offset = pow(2.0, float(bitIndex));\nreturn mod(floor(bitset / offset), 2.0);\n}\nconst int maxHighlightReasons = 6;\nfloat getFilterBit(in float bitset, in int bitIndex) {\nreturn getBit(bitset, bitIndex + maxHighlightReasons);\n}\nfloat getHighlightBit(in float bitset, in int bitIndex) {\nreturn getBit(bitset, bitIndex);\n}\nhighp vec3 unpackDisplayIdTexel(in highp vec3 bitset) {\nfloat isAggregate = getBit(bitset.b, 7);\nreturn (1.0 - isAggregate) * bitset + isAggregate * (vec3(bitset.rgb) - vec3(0.0, 0.0, float(0x80)));\n}\nvec4 unpack(in float u32) {\nfloat r = mod(rshift(u32, 0), 255.0);\nfloat g = mod(rshift(u32, 8), 255.0);\nfloat b = mod(rshift(u32, 16), 255.0);\nfloat a = mod(rshift(u32, 24), 255.0);\nreturn vec4(r, g, b, a);\n}\nvec3 norm(in vec3 v) {\nreturn v /= 255.0;\n}\nvec4 norm(in vec4 v) {\nreturn v /= 255.0;\n}\nfloat max4(vec4 target) {\nreturn max(max(max(target.x, target.y), target.z), target.w);\n}\nvec2 unpack_u8_nf32(vec2 bytes) {\nreturn (bytes - 127.0) / 127.0;\n}\nhighp float rand(in vec2 co) {\nhighp float a = 12.9898;\nhighp float b = 78.233;\nhighp float c = 43758.5453;\nhighp float dt = dot(co, vec2(a,b));\nhighp float sn = mod(dt, 3.14);\nreturn fract(sin(sn) * c);\n}","vcommon.glsl":"#include <materials/constants.glsl>\n#include <materials/utils.glsl>\n#include <materials/attributeData.glsl>\n#include <materials/vv.glsl>\n#include <materials/barycentric.glsl>\nattribute vec2 a_pos;\nattribute highp vec3 a_id;\nuniform highp mat3 displayViewScreenMat3;\nuniform highp mat3 displayViewMat3;\nuniform highp mat3 displayMat3;\nuniform highp mat3 tileMat3;\nuniform highp mat3 viewMat3;\nuniform highp float pixelRatio;\nuniform mediump float zoomFactor;\nuniform mediump float antialiasing;\nuniform mediump float currentScale;\nuniform mediump float currentZoom;\nuniform mediump float metersPerSRUnit;\nvec4 VV_ADATA = vec4(0.0);\nvoid loadVisualVariableData(inout vec4 target) {\ntarget.rgba = getVisualVariableData(a_id);\n}\n#ifdef VV\n#define INIT loadVisualVariableData(VV_ADATA)\n#else\n#define INIT\n#endif\nvec4 getColor(in vec4 a_color, in float a_bitSet, int index) {\n#ifdef VV_COLOR\nfloat isColorLocked   = getBit(a_bitSet, index);\nreturn getVVColor(VV_ADATA[ATTR_VV_COLOR], a_color, isColorLocked);\n#else\nreturn a_color;\n#endif\n}\nfloat getOpacity() {\n#ifdef VV_OPACITY\nreturn getVVOpacity(VV_ADATA[ATTR_VV_OPACITY]);\n#else\nreturn 1.0;\n#endif\n}\nfloat getSize(in float in_size, in float currentScale) {\n#ifdef VV_SIZE\nreturn getVVSize(in_size, VV_ADATA[ATTR_VV_SIZE], currentScale);\n#else\nreturn in_size;\n#endif\n}\nmat3 getRotation() {\n#ifdef VV_ROTATION\nreturn getVVRotationMat3(mod(VV_ADATA[ATTR_VV_ROTATION], 360.0));\n#else\nreturn mat3(1.0);\n#endif\n}\nfloat getFilterFlags() {\n#ifdef IGNORES_SAMPLER_PRECISION\nreturn ceil(getFilterData(a_id).x * 255.0);\n#else\nreturn getFilterData(a_id).x * 255.0;\n#endif\n}\nvec4 getAnimationState() {\nreturn getAnimation(a_id);\n}\nfloat getMinZoom() {\nvec4 data0 = getFilterData(a_id) * 255.0;\nreturn data0.g;\n}\nmat3 getMatrixNoDisplay(float isMapAligned) {\nreturn isMapAligned * viewMat3 * tileMat3 + (1.0 - isMapAligned) * tileMat3;\n}\nmat3 getMatrix(float isMapAligned) {\nreturn isMapAligned * displayViewMat3 + (1.0 - isMapAligned) * displayMat3;\n}\nfloat checkHighlightBit(float filterFlags, int index) {\nreturn getHighlightBit(filterFlags, index);\n}\nfloat checkHighlight(float filterFlags) {\nfloat result = checkHighlightBit(filterFlags, 0);\nfor (int i = 1; i < maxHighlightReasons; i++) {\nresult = result + checkHighlightBit(filterFlags, i);\n}\nreturn step(0.1, result);\n}\nvec3 clip(inout vec4 color, inout vec3 pos, in float filterFlags, in vec2 minMaxZoom) {\npos.z += 2.0 * (1.0 - getFilterBit(filterFlags, 0));\n#ifdef inside\npos.z += 2.0 * (1.0 - getFilterBit(filterFlags, 1));\n#elif defined(outside)\npos.z += 2.0 * getFilterBit(filterFlags, 1);\n#elif defined(highlight)\n#if !defined(highlight_all)\npos.z += 2.0 * (1.0 - checkHighlight(filterFlags));\n#endif\n#endif\npos.z += 2.0 * (step(minMaxZoom.y, currentZoom) + (1.0 - step(minMaxZoom.x, currentZoom)));\nreturn pos;\n}","vv.glsl":"#if defined(VV_SIZE_MIN_MAX_VALUE) || defined(VV_SIZE_SCALE_STOPS) || defined(VV_SIZE_FIELD_STOPS) || defined(VV_SIZE_UNIT_VALUE)\n#define VV_SIZE\n#endif\n#if defined(VV_COLOR) || defined(VV_SIZE) || defined(VV_OPACITY) || defined(VV_ROTATION)\n#define VV\n#endif\n#ifdef VV_COLOR\nuniform highp float colorValues[8];\nuniform vec4 colors[8];\n#endif\n#ifdef VV_SIZE_MIN_MAX_VALUE\nuniform highp vec4 minMaxValueAndSize;\n#endif\n#ifdef VV_SIZE_SCALE_STOPS\nuniform highp float values[8];\nuniform float sizes[8];\n#endif\n#ifdef VV_SIZE_FIELD_STOPS\nuniform highp float values[8];\nuniform float sizes[8];\n#endif\n#ifdef VV_SIZE_UNIT_VALUE\nuniform highp float unitMeterRatio;\n#endif\n#ifdef VV_OPACITY\nuniform highp float opacityValues[8];\nuniform float opacities[8];\n#endif\n#ifdef VV_ROTATION\nuniform lowp float rotationType;\n#endif\nbool isNan(float val) {\nreturn (val == NAN_MAGIC_NUMBER);\n}\n#ifdef VV_SIZE_MIN_MAX_VALUE\nfloat getVVMinMaxSize(float sizeValue, float fallback) {\nif (isNan(sizeValue)) {\nreturn fallback;\n}\nfloat interpolationRatio = (sizeValue  - minMaxValueAndSize.x) / (minMaxValueAndSize.y - minMaxValueAndSize.x);\ninterpolationRatio = clamp(interpolationRatio, 0.0, 1.0);\nreturn minMaxValueAndSize.z + interpolationRatio * (minMaxValueAndSize.w - minMaxValueAndSize.z);\n}\n#endif\n#ifdef VV_SIZE_SCALE_STOPS\nfloat getVVScaleStopsSize(float currentScale) {\nfloat outSize;\nif (currentScale <= values[0]) {\noutSize = sizes[0];\n} else {\nif (currentScale >= values[7]) {\noutSize = sizes[7];\n} else {\nint index;\nindex = -1;\nfor (int i = 0; i < 8; i++) {\nif (values[i] > currentScale) {\nindex = i;\nbreak;\n}\n}\nint prevIndex = index - 1;\nfloat a = currentScale - values[prevIndex];\nfloat b = values[index] - values[prevIndex];\noutSize = mix(sizes[prevIndex], sizes[index], a / b);\n}\n}\nreturn outSize;\n}\n#endif\n#ifdef VV_SIZE_FIELD_STOPS\nconst int VV_SIZE_N = 8;\nfloat getVVStopsSize(float sizeValue, float fallback) {\nif (isNan(sizeValue)) {\nreturn fallback;\n}\nif (sizeValue <= values[0]) {\nreturn sizes[0];\n}\nif (sizeValue >= values[VV_SIZE_N - 1]) {\nreturn sizes[VV_SIZE_N - 1];\n}\nfor (int i = 1; i < VV_SIZE_N; ++i) {\nif (values[i] >= sizeValue) {\nfloat f = (sizeValue - values[i-1]) / (values[i] - values[i-1]);\nreturn mix(sizes[i-1], sizes[i], f);\n}\n}\nreturn sizes[VV_SIZE_N - 1];\n}\n#endif\n#ifdef VV_SIZE_UNIT_VALUE\nfloat getVVUnitValue(float sizeValue, float fallback) {\nif (isNan(sizeValue)) {\nreturn fallback;\n}\nreturn sizeValue * (metersPerSRUnit / unitMeterRatio);\n}\n#endif\n#ifdef VV_OPACITY\nconst int VV_OPACITY_N = 8;\nfloat getVVOpacity(float opacityValue) {\nif (isNan(opacityValue)) {\nreturn 1.0;\n}\nif (opacityValue <= opacityValues[0]) {\nreturn opacities[0];\n}\nfor (int i = 1; i < VV_OPACITY_N; ++i) {\nif (opacityValues[i] >= opacityValue) {\nfloat f = (opacityValue - opacityValues[i-1]) / (opacityValues[i] - opacityValues[i-1]);\nreturn mix(opacities[i-1], opacities[i], f);\n}\n}\nreturn opacities[VV_OPACITY_N - 1];\n}\n#endif\n#ifdef VV_ROTATION\nmat4 getVVRotation(float rotationValue) {\nif (isNan(rotationValue)) {\nreturn mat4(1, 0, 0, 0,\n0, 1, 0, 0,\n0, 0, 1, 0,\n0, 0, 0, 1);\n}\nfloat rotation = rotationValue;\nif (rotationType == 1.0) {\nrotation = 90.0 - rotation;\n}\nfloat angle = C_DEG_TO_RAD * rotation;\nfloat sinA = sin(angle);\nfloat cosA = cos(angle);\nreturn mat4(cosA, sinA, 0, 0,\n-sinA,  cosA, 0, 0,\n0,     0, 1, 0,\n0,     0, 0, 1);\n}\nmat3 getVVRotationMat3(float rotationValue) {\nif (isNan(rotationValue)) {\nreturn mat3(1, 0, 0,\n0, 1, 0,\n0, 0, 1);\n}\nfloat rotation = rotationValue;\nif (rotationType == 1.0) {\nrotation = 90.0 - rotation;\n}\nfloat angle = C_DEG_TO_RAD * -rotation;\nfloat sinA = sin(angle);\nfloat cosA = cos(angle);\nreturn mat3(cosA, -sinA, 0,\nsinA, cosA, 0,\n0,    0,    1);\n}\n#endif\n#ifdef VV_COLOR\nconst int VV_COLOR_N = 8;\nvec4 getVVColor(float colorValue, vec4 fallback, float isColorLocked) {\nif (isNan(colorValue) || isColorLocked == 1.0) {\nreturn fallback;\n}\nif (colorValue <= colorValues[0]) {\nreturn colors[0];\n}\nfor (int i = 1; i < VV_COLOR_N; ++i) {\nif (colorValues[i] >= colorValue) {\nfloat f = (colorValue - colorValues[i-1]) / (colorValues[i] - colorValues[i-1]);\nreturn mix(colors[i-1], colors[i], f);\n}\n}\nreturn colors[VV_COLOR_N - 1];\n}\n#endif\nfloat getVVSize(in float size, in float vvSize, in float currentScale)  {\n#ifdef VV_SIZE_MIN_MAX_VALUE\nreturn getVVMinMaxSize(vvSize, size);\n#elif defined(VV_SIZE_SCALE_STOPS)\nfloat outSize = getVVScaleStopsSize(currentScale);\nreturn isNan(outSize) ? size : outSize;\n#elif defined(VV_SIZE_FIELD_STOPS)\nfloat outSize = getVVStopsSize(vvSize, size);\nreturn isNan(outSize) ? size : outSize;\n#elif defined(VV_SIZE_UNIT_VALUE)\nreturn getVVUnitValue(vvSize, size);\n#else\nreturn size;\n#endif\n}"},"post-processing":{blit:{"blit.frag":"precision mediump float;\nuniform sampler2D u_texture;\nvarying vec2 v_uv;\nvoid main() {\ngl_FragColor = texture2D(u_texture, v_uv);\n}"},bloom:{composite:{"composite.frag":"precision mediump float;\nvarying vec2 v_uv;\nuniform sampler2D u_blurTexture1;\nuniform sampler2D u_blurTexture2;\nuniform sampler2D u_blurTexture3;\nuniform sampler2D u_blurTexture4;\nuniform sampler2D u_blurTexture5;\nuniform float u_bloomStrength;\nuniform float u_bloomRadius;\nuniform float u_bloomFactors[NUMMIPS];\nuniform vec3 u_bloomTintColors[NUMMIPS];\nfloat lerpBloomFactor(const in float factor) {\nfloat mirrorFactor = 1.2 - factor;\nreturn mix(factor, mirrorFactor, u_bloomRadius);\n}\nvoid main() {\nvec4 color = u_bloomStrength * (\nlerpBloomFactor(u_bloomFactors[0]) * vec4(u_bloomTintColors[0], 1.0) * texture2D(u_blurTexture1, v_uv) +\nlerpBloomFactor(u_bloomFactors[1]) * vec4(u_bloomTintColors[1], 1.0) * texture2D(u_blurTexture2, v_uv) +\nlerpBloomFactor(u_bloomFactors[2]) * vec4(u_bloomTintColors[2], 1.0) * texture2D(u_blurTexture3, v_uv) +\nlerpBloomFactor(u_bloomFactors[3]) * vec4(u_bloomTintColors[3], 1.0) * texture2D(u_blurTexture4, v_uv) +\nlerpBloomFactor(u_bloomFactors[4]) * vec4(u_bloomTintColors[4], 1.0) * texture2D(u_blurTexture5, v_uv)\n);\ngl_FragColor = clamp(color, 0.0, 1.0);\n}"},gaussianBlur:{"gaussianBlur.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nuniform vec2 u_texSize;\nuniform vec2 u_direction;\nvarying vec2 v_uv;\n#define KERNEL_RADIUS RADIUS\n#define SIGMA RADIUS\nfloat gaussianPdf(in float x, in float sigma) {\nreturn 0.39894 * exp(-0.5 * x * x / ( sigma * sigma)) / sigma;\n}\nvoid main() {\nvec2 invSize = 1.0 / u_texSize;\nfloat fSigma = float(SIGMA);\nfloat weightSum = gaussianPdf(0.0, fSigma);\nvec4 pixelColorSum = texture2D(u_colorTexture, v_uv) * weightSum;\nfor (int i = 1; i < KERNEL_RADIUS; i ++) {\nfloat x = float(i);\nfloat w = gaussianPdf(x, fSigma);\nvec2 uvOffset = u_direction * invSize * x;\nvec4 sample1 = texture2D(u_colorTexture, v_uv + uvOffset);\nvec4 sample2 = texture2D(u_colorTexture, v_uv - uvOffset);\npixelColorSum += (sample1 + sample2) * w;\nweightSum += 2.0 * w;\n}\ngl_FragColor = pixelColorSum /weightSum;\n}"},luminosityHighPass:{"luminosityHighPass.frag":"precision mediump float;\nuniform sampler2D u_texture;\nuniform vec3 u_defaultColor;\nuniform float u_defaultOpacity;\nuniform float u_luminosityThreshold;\nuniform float u_smoothWidth;\nvarying vec2 v_uv;\nvoid main() {\nvec4 texel = texture2D(u_texture, v_uv);\nvec3 luma = vec3(0.299, 0.587, 0.114);\nfloat v = dot(texel.xyz, luma);\nvec4 outputColor = vec4(u_defaultColor.rgb, u_defaultOpacity);\nfloat alpha = smoothstep(u_luminosityThreshold, u_luminosityThreshold + u_smoothWidth, v);\ngl_FragColor = mix(outputColor, texel, alpha);\n}"}},blur:{gaussianBlur:{"gaussianBlur.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nuniform vec2 u_texSize;\nuniform vec2 u_direction;\nuniform float u_sigma;\nvarying vec2 v_uv;\n#define KERNEL_RADIUS RADIUS\nfloat gaussianPdf(in float x, in float sigma) {\nreturn 0.39894 * exp(-0.5 * x * x / ( sigma * sigma)) / sigma;\n}\nvoid main() {\nvec2 invSize = 1.0 / u_texSize;\nfloat fSigma = u_sigma;\nfloat weightSum = gaussianPdf(0.0, fSigma);\nvec4 pixelColorSum = texture2D(u_colorTexture, v_uv) * weightSum;\nfor (int i = 1; i < KERNEL_RADIUS; i ++) {\nfloat x = float(i);\nfloat w = gaussianPdf(x, fSigma);\nvec2 uvOffset = u_direction * invSize * x;\nvec4 sample1 = texture2D(u_colorTexture, v_uv + uvOffset);\nvec4 sample2 = texture2D(u_colorTexture, v_uv - uvOffset);\npixelColorSum += (sample1 + sample2) * w;\nweightSum += 2.0 * w;\n}\ngl_FragColor = pixelColorSum /weightSum;\n}"},"radial-blur":{"radial-blur.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nvarying vec2 v_uv;\nconst float sampleDist = 1.0;\nconst float sampleStrength = 2.2;\nvoid main(void) {\nfloat samples[10];\nsamples[0] = -0.08;\nsamples[1] = -0.05;\nsamples[2] = -0.03;\nsamples[3] = -0.02;\nsamples[4] = -0.01;\nsamples[5] =  0.01;\nsamples[6] =  0.02;\nsamples[7] =  0.03;\nsamples[8] =  0.05;\nsamples[9] =  0.08;\nvec2 dir = 0.5 - v_uv;\nfloat dist = sqrt(dir.x * dir.x + dir.y * dir.y);\ndir = dir / dist;\nvec4 color = texture2D(u_colorTexture,v_uv);\nvec4 sum = color;\nfor (int i = 0; i < 10; i++) {\nsum += texture2D(u_colorTexture, v_uv + dir * samples[i] * sampleDist);\n}\nsum *= 1.0 / 11.0;\nfloat t = dist * sampleStrength;\nt = clamp(t, 0.0, 1.0);\ngl_FragColor = mix(color, sum, t);\n}"}},dra:{"dra.frag":"precision mediump float;\nuniform sampler2D u_minColor;\nuniform sampler2D u_maxColor;\nuniform sampler2D u_texture;\nvarying vec2 v_uv;\nvoid main() {\nvec4 minColor = texture2D(u_minColor, vec2(0.5));\nvec4 maxColor = texture2D(u_maxColor, vec2(0.5));\nvec4 color = texture2D(u_texture, v_uv);\nvec3 minColorUnpremultiply = minColor.rgb / minColor.a;\nvec3 maxColorUnpremultiply = maxColor.rgb / maxColor.a;\nvec3 colorUnpremultiply = color.rgb / color.a;\nvec3 range = maxColorUnpremultiply - minColorUnpremultiply;\ngl_FragColor = vec4(color.a * (colorUnpremultiply - minColorUnpremultiply) / range, color.a);\n}","min-max":{"min-max.frag":"#extension GL_EXT_draw_buffers : require\nprecision mediump float;\n#define CELL_SIZE 2\nuniform sampler2D u_minTexture;\nuniform sampler2D u_maxTexture;\nuniform vec2 u_srcResolution;\nuniform vec2 u_dstResolution;\nvarying vec2 v_uv;\nvoid main() {\nvec2 srcPixel = floor(gl_FragCoord.xy) * float(CELL_SIZE);\nvec2 onePixel = vec2(1.0) / u_srcResolution;\nvec2 uv = (srcPixel + 0.5) / u_srcResolution;\nvec4 minColor = vec4(1.0);\nvec4 maxColor = vec4(0.0);\nfor (int y = 0; y < CELL_SIZE; ++y) {\nfor (int x = 0; x < CELL_SIZE; ++x) {\nvec2 offset = uv + vec2(x, y) * onePixel;\nminColor = min(minColor, texture2D(u_minTexture, offset));\nmaxColor = max(maxColor, texture2D(u_maxTexture, offset));\n}\n}\ngl_FragData[0] = minColor;\ngl_FragData[1] = maxColor;\n}"}},"drop-shadow":{composite:{"composite.frag":"precision mediump float;\nuniform sampler2D u_layerFBOTexture;\nuniform sampler2D u_blurTexture;\nuniform vec4 u_shadowColor;\nuniform vec2 u_shadowOffset;\nuniform highp mat3 u_displayViewMat3;\nvarying vec2 v_uv;\nvoid main() {\nvec3 offset = u_displayViewMat3 * vec3(u_shadowOffset, 0.0);\nvec4 layerColor = texture2D(u_layerFBOTexture, v_uv);\nvec4 blurColor = texture2D(u_blurTexture, v_uv - offset.xy / 2.0);\ngl_FragColor = ((1.0 - layerColor.a) * blurColor.a * u_shadowColor + layerColor);\n}"}},"edge-detect":{"frei-chen":{"frei-chen.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nuniform vec2 u_texSize;\nvarying vec2 v_uv;\nvec2 texel = vec2(1.0 / u_texSize.x, 1.0 / u_texSize.y);\nmat3 G[9];\nconst mat3 g0 = mat3( 0.3535533845424652, 0, -0.3535533845424652, 0.5, 0, -0.5, 0.3535533845424652, 0, -0.3535533845424652 );\nconst mat3 g1 = mat3( 0.3535533845424652, 0.5, 0.3535533845424652, 0, 0, 0, -0.3535533845424652, -0.5, -0.3535533845424652 );\nconst mat3 g2 = mat3( 0, 0.3535533845424652, -0.5, -0.3535533845424652, 0, 0.3535533845424652, 0.5, -0.3535533845424652, 0 );\nconst mat3 g3 = mat3( 0.5, -0.3535533845424652, 0, -0.3535533845424652, 0, 0.3535533845424652, 0, 0.3535533845424652, -0.5 );\nconst mat3 g4 = mat3( 0, -0.5, 0, 0.5, 0, 0.5, 0, -0.5, 0 );\nconst mat3 g5 = mat3( -0.5, 0, 0.5, 0, 0, 0, 0.5, 0, -0.5 );\nconst mat3 g6 = mat3( 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.6666666865348816, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204 );\nconst mat3 g7 = mat3( -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, 0.6666666865348816, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408 );\nconst mat3 g8 = mat3( 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408 );\nvoid main() {\nG[0] = g0,\nG[1] = g1,\nG[2] = g2,\nG[3] = g3,\nG[4] = g4,\nG[5] = g5,\nG[6] = g6,\nG[7] = g7,\nG[8] = g8;\nmat3 I;\nfloat cnv[9];\nvec3 sample;\nfor (float i = 0.0; i < 3.0; i++) {\nfor (float j = 0.0; j < 3.0; j++) {\nsample = texture2D(u_colorTexture, v_uv + texel * vec2(i - 1.0,j - 1.0)).rgb;\nI[int(i)][int(j)] = length(sample);\n}\n}\nfor (int i = 0; i < 9; i++) {\nfloat dp3 = dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);\ncnv[i] = dp3 * dp3;\n}\nfloat M = (cnv[0] + cnv[1]) + (cnv[2] + cnv[3]);\nfloat S = (cnv[4] + cnv[5]) + (cnv[6] + cnv[7]) + (cnv[8] + M);\ngl_FragColor = vec4(vec3(sqrt(M / S)), texture2D(u_colorTexture, v_uv).a);\n}"},sobel:{"sobel.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nvarying vec2 v_uv;\nuniform vec2 u_texSize;\nvec2 texel = vec2(1.0 / u_texSize.x, 1.0 / u_texSize.y);\nmat3 G[2];\nconst mat3 g0 = mat3( 1.0, 2.0, 1.0, 0.0, 0.0, 0.0, -1.0, -2.0, -1.0 );\nconst mat3 g1 = mat3( 1.0, 0.0, -1.0, 2.0, 0.0, -2.0, 1.0, 0.0, -1.0 );\nvoid main() {\nmat3 I;\nfloat cnv[2];\nvec3 sample;\nG[0] = g0;\nG[1] = g1;\nfor (float i = 0.0; i < 3.0; i++) {\nfor (float j = 0.0; j < 3.0; j++) {\nsample = texture2D( u_colorTexture, v_uv + texel * vec2(i-1.0,j-1.0) ).rgb;\nI[int(i)][int(j)] = length(sample);\n}\n}\nfor (int i = 0; i < 2; i++) {\nfloat dp3 = dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);\ncnv[i] = dp3 * dp3;\n}\ngl_FragColor = vec4(vec3(0.5 * sqrt(cnv[0] * cnv[0] + cnv[1] * cnv[1])), texture2D(u_colorTexture, v_uv).a);\n}"}},"edge-enhance":{"edge-enhance.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nvarying vec2 v_uv;\nuniform vec2 u_texSize;\nvec2 texel = vec2(1.0 / u_texSize.x, 1.0 / u_texSize.y);\nmat3 G[2];\nconst mat3 g0 = mat3( 1.0, 0.0, -1.0, 1.0, 0.0, -1.0, 1.0, 0.0, -1.0 );\nconst mat3 g1 = mat3( 1.0, 1.0, 1.0, 0.0, 0.0, 0.0, -1.0, -1.0, -1.0 );\nvoid main() {\nmat3 I;\nfloat cnv[2];\nvec3 sample;\nG[0] = g0;\nG[1] = g1;\nfor (float i = 0.0; i < 3.0; i++) {\nfor (float j = 0.0; j < 3.0; j++) {\nsample = texture2D( u_colorTexture, v_uv + texel * vec2(i-1.0,j-1.0) ).rgb;\nI[int(i)][int(j)] = length(sample);\n}\n}\nfor (int i = 0; i < 2; i++) {\nfloat dp3 = dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);\ncnv[i] = dp3 * dp3;\n}\nvec4 color = texture2D(u_colorTexture, v_uv);\ngl_FragColor = vec4(0.5 * sqrt(cnv[0] * cnv[0] + cnv[1] * cnv[1]) * color);\n}"},filterEffect:{"filterEffect.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nuniform mat4 u_coefficients;\nvarying vec2 v_uv;\nvoid main() {\nvec4 color = texture2D(u_colorTexture, v_uv);\nvec4 rgbw = u_coefficients * vec4(color.a > 0.0 ? color.rgb / color.a : vec3(0.0), 1.0);\nfloat a = color.a;\ngl_FragColor = vec4(a * rgbw.rgb, a);\n}"},pp:{"pp.vert":"precision mediump float;\nattribute vec2 a_position;\nvarying vec2 v_uv;\nvoid main() {\ngl_Position = vec4(a_position, 0.0, 1.0);\nv_uv = (a_position + 1.0) / 2.0;\n}"}},raster:{bitmap:{"bitmap.frag":"precision mediump float;\nvarying highp vec2 v_texcoord;\nuniform sampler2D u_texture;\nuniform highp vec2 u_coordScale;\nuniform lowp float u_opacity;\n#include <filtering/bicubic.glsl>\nvoid main() {\n#ifdef BICUBIC\nvec4 color = sampleBicubicBSpline(u_texture, v_texcoord, u_coordScale);\n#else\nvec4 color = texture2D(u_texture, v_texcoord);\n#endif\ngl_FragColor = vec4(color.rgb * u_opacity, color.a * u_opacity);\n}","bitmap.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\nv_texcoord = a_pos;\ngl_Position = vec4(u_dvsMat3 * vec3(a_pos * u_coordScale, 1.0), 1.0);\n}"},common:{"common.glsl":"uniform sampler2D u_image;\nuniform int u_bandCount;\nuniform bool u_flipY;\nuniform float u_opacity;\nuniform int u_resampling;\nuniform vec2 u_srcImageSize;\n#ifdef APPLY_PROJECTION\n#include <raster/common/projection.glsl>\n#endif\n#ifdef BICUBIC\n#include <filtering/bicubic.glsl>\n#endif\n#ifdef BILINEAR\n#include <filtering/bilinear.glsl>\n#endif\nvec2 getPixelLocation(vec2 coords) {\nvec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;\n#ifdef APPLY_PROJECTION\ntargetLocation = projectPixelLocation(targetLocation);\n#endif\nreturn targetLocation;\n}\nbool isOutside(vec2 coords){\nif (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {\nreturn true;\n} else {\nreturn false;\n}\n}\nvec4 getPixel(vec2 pixelLocation) {\n#ifdef BICUBIC\nvec4 color = sampleBicubicBSpline(u_image, pixelLocation, u_srcImageSize);\n#elif defined(BILINEAR)\nvec4 color = sampleBilinear(u_image, pixelLocation, u_srcImageSize);\n#else\nvec4 color = texture2D(u_image, pixelLocation);\n#endif\nreturn color;\n}","common.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nuniform highp float u_scale;\nuniform highp vec2 u_offset;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\nv_texcoord = a_pos * u_scale + u_offset;\ngl_Position = vec4(u_dvsMat3 * vec3(a_pos * u_coordScale, 1.0), 1.0);\n}","contrastBrightness.glsl":"uniform float u_contrastOffset;\nuniform float u_brightnessOffset;\nvec4 adjustContrastBrightness(vec4 currentPixel, bool isFloat) {\nvec4 pixelValue = isFloat ? currentPixel * 255.0 : currentPixel;\nfloat maxI = 255.0;\nfloat mid = 128.0;\nfloat c = u_contrastOffset;\nfloat b = u_brightnessOffset;\nvec4 v;\nif (c > 0.0 && c < 100.0) {\nv = (200.0 * pixelValue - 100.0 * maxI + 2.0 * maxI * b) / (2.0 * (100.0 - c)) + mid;\n} else if (c <= 0.0 && c > -100.0) {\nv = (200.0 * pixelValue - 100.0 * maxI + 2.0 * maxI * b) * (100.0 + c) / 20000.0 + mid;\n} else if (c == 100.0) {\nv = (200.0 * pixelValue - 100.0 * maxI + (maxI + 1.0) * (100.0 - c) + 2.0 * maxI * b);\nv = (sign(v) + 1.0) / 2.0;\n} else if (c == -100.0) {\nv = vec4(mid, mid, mid, currentPixel.a);\n}\nvec3 rgb = clamp(v.rgb / 255.0, 0.0, 1.0);\nreturn vec4(rgb, currentPixel.a);\n}","getSurfaceValues.glsl":"#include <raster/common/mirror.glsl>\nvoid getSurfaceValues(sampler2D imageTexture, vec2 texCoord, vec2 srcImageSize, inout float values[10]) {\nvec2 onePixel = 1.0 / srcImageSize;\nvec4 va = texture2D(imageTexture, mirror(texCoord + onePixel * vec2(-1.0, -1.0)));\nvec4 vb = texture2D(imageTexture, mirror(texCoord + onePixel * vec2(0.0, -1.0)));\nvec4 vc = texture2D(imageTexture, mirror(texCoord + onePixel * vec2(1.0, -1.0)));\nvec4 vd = texture2D(imageTexture, mirror(texCoord + onePixel * vec2(-1.0, 0.0)));\nvec4 ve = texture2D(imageTexture, mirror(texCoord));\nvec4 vf = texture2D(imageTexture, mirror(texCoord + onePixel * vec2(1.0, 0.0)));\nvec4 vg = texture2D(imageTexture, mirror(texCoord + onePixel * vec2(-1.0, 1.0)));\nvec4 vh = texture2D(imageTexture, mirror(texCoord + onePixel * vec2(0.0, 1.0)));\nvec4 vi = texture2D(imageTexture, mirror(texCoord + onePixel * vec2(1.0, 1.0)));\nfloat alpha = va.a * vb.a * vc.a * vd.a * ve.a * vf.a * vg.a * vh.a * vi.a;\nvalues[0] = va.r;\nvalues[1] = vb.r;\nvalues[2] = vc.r;\nvalues[3] = vd.r;\nvalues[4] = ve.r;\nvalues[5] = vf.r;\nvalues[6] = vg.r;\nvalues[7] = vh.r;\nvalues[8] = vi.r;\nvalues[9] = alpha;\n}","inverse.glsl":"float invertValue(float value) {\nfloat s = sign(value);\nreturn (s * s) / (value + abs(s) - 1.0);\n}","mirror.glsl":"vec2 mirror(vec2 pos) {\nvec2 pos1 = abs(pos);\nreturn step(pos1, vec2(1.0, 1.0)) * pos1 + step(1.0, pos1) * (2.0 - pos1);\n}","projection.glsl":"uniform sampler2D u_transformGrid;\nuniform vec2 u_transformSpacing;\nuniform vec2 u_transformGridSize;\nuniform vec2 u_targetImageSize;\nvec2 projectPixelLocation(vec2 coords) {\n#ifdef LOOKUP_PROJECTION\nvec4 pv = texture2D(u_transformGrid, coords);\nreturn vec2(pv.r, pv.g);\n#endif\nvec2 index_image = floor(coords * u_targetImageSize);\nvec2 oneTransformPixel = vec2(0.25 / u_transformGridSize.s, 1.0 / u_transformGridSize.t);\nvec2 index_transform = floor(index_image / u_transformSpacing) / u_transformGridSize;\nvec2 pos = fract((index_image + vec2(0.5, 0.5)) / u_transformSpacing);\nvec2 srcLocation;\nvec2 transform_location = index_transform + oneTransformPixel * 0.5;\nif (pos.s <= pos.t) {\nvec4 ll_abc = texture2D(u_transformGrid, vec2(transform_location.s, transform_location.t));\nvec4 ll_def = texture2D(u_transformGrid, vec2(transform_location.s + oneTransformPixel.s, transform_location.t));\nsrcLocation.s = dot(ll_abc.rgb, vec3(pos, 1.0));\nsrcLocation.t = dot(ll_def.rgb, vec3(pos, 1.0));\n} else {\nvec4 ur_abc = texture2D(u_transformGrid, vec2(transform_location.s + 2.0 * oneTransformPixel.s, transform_location.t));\nvec4 ur_def = texture2D(u_transformGrid, vec2(transform_location.s + 3.0 * oneTransformPixel.s, transform_location.t));\nsrcLocation.s = dot(ur_abc.rgb, vec3(pos, 1.0));\nsrcLocation.t = dot(ur_def.rgb, vec3(pos, 1.0));\n}\nreturn srcLocation;\n}"},flow:{"getFadeOpacity.glsl":"uniform float u_decayRate;\nuniform float u_fadeToZero;\nfloat getFadeOpacity(float x) {\nfloat cutOff = mix(0.0, exp(-u_decayRate), u_fadeToZero);\nreturn (exp(-u_decayRate * x) - cutOff) / (1.0 - cutOff);\n}","getFragmentColor.glsl":"vec4 getFragmentColor(vec4 color, float dist, float size, float featheringSize) {\nfloat featheringStart = clamp(0.5 - featheringSize / size, 0.0, 0.5);\nif (dist > featheringStart) {\ncolor *= 1.0 - (dist - featheringStart) / (0.5 - featheringStart);\n}\nreturn color;\n}",imagery:{"imagery.frag":"precision highp float;\nvarying vec2 v_texcoord;\nuniform sampler2D u_texture;\nuniform float u_Min;\nuniform float u_Max;\nuniform float u_featheringSize;\n#include <raster/flow/vv.glsl>\nfloat getIntensity(float v) {\nreturn u_Min + v * (u_Max - u_Min);\n}\nvoid main(void) {\nvec4 sampled = texture2D(u_texture, v_texcoord);\nfloat intensity = getIntensity(sampled.r);\ngl_FragColor = getColor(intensity);\ngl_FragColor.a *= getOpacity(sampled.r);\ngl_FragColor.a *= sampled.a;\ngl_FragColor.rgb *= gl_FragColor.a;\n}","imagery.vert":"attribute vec2 a_position;\nattribute vec2 a_texcoord;\nuniform mat3 u_dvsMat3;\nvarying vec2 v_texcoord;\nvoid main(void) {\nvec2 xy = (u_dvsMat3 * vec3(a_position, 1.0)).xy;\ngl_Position = vec4(xy, 0.0, 1.0);\nv_texcoord = a_texcoord;\n}"},particles:{"particles.frag":"precision highp float;\nvarying vec4 v_color;\nvarying vec2 v_texcoord;\nvarying float v_size;\nuniform float u_featheringSize;\n#include <raster/flow/getFragmentColor.glsl>\nvoid main(void) {\ngl_FragColor = getFragmentColor(v_color, length(v_texcoord - 0.5), v_size, u_featheringSize);\n}","particles.vert":"attribute vec4 a_xyts0;\nattribute vec4 a_xyts1;\nattribute vec4 a_typeIdDurationSeed;\nattribute vec4 a_extrudeInfo;\nuniform mat3 u_dvsMat3;\nuniform mat3 u_displayViewMat3;\nuniform float u_time;\nuniform float u_trailLength;\nuniform float u_flowSpeed;\nvarying vec4 v_color;\nvarying vec2 v_texcoord;\nvarying float v_size;\nuniform float u_featheringSize;\nuniform float u_introFade;\n#include <raster/flow/vv.glsl>\n#include <raster/flow/getFadeOpacity.glsl>\nvoid main(void) {\nvec2 position0 = a_xyts0.xy;\nfloat t0 = a_xyts0.z;\nfloat speed0 = a_xyts0.w;\nvec2 position1 = a_xyts1.xy;\nfloat t1 = a_xyts1.z;\nfloat speed1 = a_xyts1.w;\nfloat type = a_typeIdDurationSeed.x;\nfloat id = a_typeIdDurationSeed.y;\nfloat duration = a_typeIdDurationSeed.z;\nfloat seed = a_typeIdDurationSeed.w;\nvec2 e0 = a_extrudeInfo.xy;\nvec2 e1 = a_extrudeInfo.zw;\nfloat animationPeriod = duration + u_trailLength;\nfloat scaledTime = u_time * u_flowSpeed;\nfloat randomizedTime = scaledTime + seed * animationPeriod;\nfloat t = mod(randomizedTime, animationPeriod);\nfloat fUnclamped = (t - t0) / (t1 - t0);\nfloat f = clamp(fUnclamped, 0.0, 1.0);\nfloat clampedTime = mix(t0, t1, f);\nfloat speed = mix(speed0, speed1, f);\nvec2 extrude;\nvec2 position;\nfloat fadeOpacity;\nfloat introOpacity;\nif (type == 2.0) {\nif (fUnclamped < 0.0 || (fUnclamped > 1.0 && t1 != duration)) {\ngl_Position = vec4(0.0, 0.0, -2.0, 1.0);\nreturn;\n}\nvec2 ortho = mix(e0, e1, f);\nvec2 parallel;\nparallel = normalize(position1 - position0) * 0.5;\nif (id == 1.0) {\nextrude = ortho;\nv_texcoord = vec2(0.5, 0.0);\n} else if (id == 2.0) {\nextrude = -ortho;\nv_texcoord = vec2(0.5, 1.0);\n} else if (id == 3.0) {\nextrude = ortho + parallel;\nv_texcoord = vec2(1.0, 0.0);\n} else if (id == 4.0) {\nextrude = -ortho + parallel;\nv_texcoord = vec2(1.0, 1.0);\n}\nfadeOpacity = getFadeOpacity((t - clampedTime) / u_trailLength);\nintroOpacity = 1.0 - exp(-clampedTime);\nv_size = getSize(speed);\nv_color = getColor(speed);\nv_color.a *= getOpacity(speed);\nposition = mix(position0, position1, f);\n} else {\nif (fUnclamped < 0.0) {\ngl_Position = vec4(0.0, 0.0, -2.0, 1.0);\nreturn;\n}\nif (id == 1.0) {\nextrude = e0;\nv_texcoord = vec2(0.5, 0.0);\nfadeOpacity = getFadeOpacity((t - t0) / u_trailLength);\nintroOpacity = 1.0 - exp(-t0);\nv_size = getSize(speed0);\nv_color = getColor(speed0);\nv_color.a *= getOpacity(speed0);\nposition = position0;\n} else if (id == 2.0) {\nextrude = -e0;\nv_texcoord = vec2(0.5, 1.0);\nfadeOpacity = getFadeOpacity((t - t0) / u_trailLength);\nintroOpacity = 1.0 - exp(-t0);\nv_size = getSize(speed0);\nv_color = getColor(speed0);\nv_color.a *= getOpacity(speed0);\nposition = position0;\n} else if (id == 3.0) {\nextrude = mix(e0, e1, f);\nv_texcoord = vec2(0.5, 0.0);\nfadeOpacity = getFadeOpacity((t - clampedTime) / u_trailLength);\nintroOpacity = 1.0 - exp(-clampedTime);\nv_size = getSize(speed);\nv_color = getColor(speed);\nv_color.a *= getOpacity(speed);\nposition = mix(position0, position1, f);\n} else if (id == 4.0) {\nextrude = -mix(e0, e1, f);\nv_texcoord = vec2(0.5, 1.0);\nfadeOpacity = getFadeOpacity((t - clampedTime) / u_trailLength);\nintroOpacity = 1.0 - exp(-clampedTime);\nv_size = getSize(speed);\nv_color = getColor(speed);\nv_color.a *= getOpacity(speed);\nposition = mix(position0, position1, f);\n}\n}\nvec2 xy = (u_dvsMat3 * vec3(position, 1.0) + u_displayViewMat3 * vec3(extrude * v_size, 0.0)).xy;\ngl_Position = vec4(xy, 0.0, 1.0);\nv_color.a *= fadeOpacity;\nv_color.a *= mix(1.0, introOpacity, u_introFade);\nv_color.rgb *= v_color.a;\n}"},streamlines:{"streamlines.frag":"precision highp float;\nvarying float v_side;\nvarying float v_time;\nvarying float v_totalTime;\nvarying float v_timeSeed;\nvarying vec4 v_color;\nvarying float v_size;\nuniform float u_time;\nuniform float u_trailLength;\nuniform float u_flowSpeed;\nuniform float u_featheringSize;\nuniform float u_introFade;\n#include <raster/flow/getFragmentColor.glsl>\n#include <raster/flow/getFadeOpacity.glsl>\nvoid main(void) {\nfloat t = mod(v_timeSeed * (v_totalTime + u_trailLength) + u_time * u_flowSpeed, v_totalTime + u_trailLength) - v_time;\nvec4 color = v_color * step(0.0, t) * getFadeOpacity(t / u_trailLength);\ncolor *= mix(1.0, 1.0 - exp(-v_time), u_introFade);\ngl_FragColor = getFragmentColor(color, length((v_side + 1.0) / 2.0 - 0.5), v_size, u_featheringSize);\n}","streamlines.vert":"attribute vec3 a_positionAndSide;\nattribute vec3 a_timeInfo;\nattribute vec2 a_extrude;\nattribute float a_speed;\nuniform mat3 u_dvsMat3;\nuniform mat3 u_displayViewMat3;\nvarying float v_time;\nvarying float v_totalTime;\nvarying float v_timeSeed;\nvarying vec4 v_color;\nvarying float v_side;\nvarying float v_size;\nuniform float u_featheringSize;\n#include <raster/flow/vv.glsl>\nvoid main(void) {\nvec4 lineColor = getColor(a_speed);\nfloat lineOpacity = getOpacity(a_speed);\nfloat lineSize = getSize(a_speed);\nvec2 position = a_positionAndSide.xy;\nv_side = a_positionAndSide.z;\nvec2 xy = (u_dvsMat3 * vec3(position, 1.0) + u_displayViewMat3 * vec3(a_extrude * lineSize, 0.0)).xy;\ngl_Position = vec4(xy, 0.0, 1.0);\nv_time = a_timeInfo.x;\nv_totalTime = a_timeInfo.y;\nv_timeSeed = a_timeInfo.z;\nv_color = lineColor;\nv_color.a *= lineOpacity;\nv_color.rgb *= v_color.a;\nv_size = lineSize;\n}"},"vv.glsl":"#define MAX_STOPS 8\n#ifdef VV_COLOR\nuniform float u_color_stops[MAX_STOPS];\nuniform vec4 u_color_values[MAX_STOPS];\nuniform int u_color_count;\n#else\nuniform vec4 u_color;\n#endif\n#ifdef VV_OPACITY\nuniform float u_opacity_stops[MAX_STOPS];\nuniform float u_opacity_values[MAX_STOPS];\nuniform int u_opacity_count;\n#else\nuniform float u_opacity;\n#endif\n#ifdef VV_SIZE\nuniform float u_size_stops[MAX_STOPS];\nuniform float u_size_values[MAX_STOPS];\nuniform int u_size_count;\n#else\nuniform float u_size;\n#endif\nuniform float u_featheringOffset;\nvec4 getColor(float x) {\n#ifdef VV_COLOR\nvec4 color = u_color_values[0];\n{\nfor (int i = 1; i < MAX_STOPS; i++) {\nif (i >= u_color_count) {\nbreak;\n}\nfloat x1 = u_color_stops[i - 1];\nif (x < x1) {\nbreak;\n}\nfloat x2 = u_color_stops[i];\nvec4 y2 = u_color_values[i];\nif (x < x2) {\nvec4 y1 = u_color_values[i - 1];\ncolor = y1 + (y2 - y1) * (x - x1) / (x2 - x1);\n} else {\ncolor = y2;\n}\n}\n}\n#else\nvec4 color = u_color;\n#endif\nreturn color;\n}\nfloat getOpacity(float x) {\n#ifdef VV_OPACITY\nfloat opacity = u_opacity_values[0];\n{\nfor (int i = 1; i < MAX_STOPS; i++) {\nif (i >= u_opacity_count) {\nbreak;\n}\nfloat x1 = u_opacity_stops[i - 1];\nif (x < x1) {\nbreak;\n}\nfloat x2 = u_opacity_stops[i];\nfloat y2 = u_opacity_values[i];\nif (x < x2) {\nfloat y1 = u_opacity_values[i - 1];\nopacity = y1 + (y2 - y1) * (x - x1) / (x2 - x1);\n} else {\nopacity = y2;\n}\n}\n}\n#else\nfloat opacity = u_opacity;\n#endif\nreturn opacity;\n}\nfloat getSize(float x) {\n#ifdef VV_SIZE\nfloat size = u_size_values[0];\n{\nfor (int i = 1; i < MAX_STOPS; i++) {\nif (i >= u_size_count) {\nbreak;\n}\nfloat x1 = u_size_stops[i - 1];\nif (x < x1) {\nbreak;\n}\nfloat x2 = u_size_stops[i];\nfloat y2 = u_size_values[i];\nif (x < x2) {\nfloat y1 = u_size_values[i - 1];\nsize = y1 + (y2 - y1) * (x - x1) / (x2 - x1);\n} else {\nsize = y2;\n}\n}\n}\n#else\nfloat size = u_size;\n#endif\nreturn size + 2.0 * u_featheringSize * u_featheringOffset;\n}"},hillshade:{"hillshade.frag":"precision mediump float;\nvarying highp vec2 v_texcoord;\n#include <raster/common/common.glsl>\nuniform int u_hillshadeType;\nuniform float u_sinZcosAs[6];\nuniform float u_sinZsinAs[6];\nuniform float u_cosZs[6];\nuniform float u_weights[6];\nuniform vec2 u_factor;\nuniform float u_minValue;\nuniform float u_maxValue;\nuniform float u_scaling;\n#include <raster/lut/colorize.glsl>\n#include <raster/common/getSurfaceValues.glsl>\nvec3 rgb2hsv(vec3 c) {\nvec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\nvec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\nvec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\nfloat d = q.x - min(q.w, q.y);\nfloat e = 1.0e-10;\nreturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);\n}\nvec3 hsv2rgb(vec3 c) {\nvec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\nvec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\nreturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\nvec4 overlay(float val, float minValue, float maxValue, float hillshade) {\nval = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);\nvec4 rgb = colorize(vec4(val, val, val, 1.0), 255.0);\nvec3 hsv = rgb2hsv(rgb.xyz);\nhsv.z = hillshade;\nreturn vec4(hsv2rgb(hsv) * u_scaling, 1.0) * rgb.a;\n}\nvoid main() {\nvec2 pixelLocation = getPixelLocation(v_texcoord);\nif (isOutside(pixelLocation)) {\ngl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\nvec4 currentPixel = getPixel(pixelLocation);\nif (currentPixel.a == 0.0) {\ngl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\nfloat pv[10];\ngetSurfaceValues(u_image, pixelLocation, u_srcImageSize, pv);\nfloat alpha = pv[9];\nfloat dzx = (pv[2] + 2.0 * pv[5] + pv[8] - pv[0] - 2.0 * pv[3] - pv[6]) * u_factor.s;\nfloat dzy = (pv[6] + 2.0 * pv[7] + pv[8] - pv[0] - 2.0 * pv[1] - pv[2]) * u_factor.t;\nfloat dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);\nfloat hillshade = 0.0;\nif (u_hillshadeType == 0){\nfloat cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;\nfloat z = (u_cosZs[0] + cosDelta) / dzd;\nif (z < 0.0)  z = 0.0;\nhillshade = z;\n} else {\nfor (int k = 0; k < 6; k++) {\nfloat cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;\nfloat z = (u_cosZs[k] + cosDelta) / dzd;\nif (z < 0.0) z = 0.0;\nhillshade = hillshade + z * u_weights[k];\nif (k == 5) break;\n}\n}\n#ifdef APPLY_COLORMAP\nvec4 result = overlay(pv[4], u_minValue, u_maxValue, hillshade) * alpha * u_opacity;\n#else\nhillshade *= u_scaling;\nvec4 result = vec4(hillshade, hillshade, hillshade, 1.0) * alpha * u_opacity;\n#endif\n#ifdef ROUND_OUTPUT\nresult = vec4(floor(result.xyz + 0.5), result.a);\n#endif\ngl_FragColor = result;\n}"},lut:{"colorize.glsl":"uniform sampler2D u_colormap;\nuniform float u_colormapOffset;\nuniform float u_colormapMaxIndex;\nvec4 colorize(vec4 currentPixel, float scaleFactor) {\nfloat clrIndex = clamp(currentPixel.r * scaleFactor - u_colormapOffset, 0.0, u_colormapMaxIndex);\nvec2 clrPosition = vec2((clrIndex + 0.5) / (u_colormapMaxIndex + 1.0), 0.0);\nvec4 color = texture2D(u_colormap, clrPosition);\nvec4 result = vec4(color.rgb, color.a * currentPixel.a);\nreturn result;\n}\nvec4 colorizeNoClamp(vec4 currentPixel, float scaleFactor) {\nfloat value = currentPixel.r * scaleFactor - u_colormapOffset;\nvec4 result = colorize(currentPixel, scaleFactor);\nreturn result * step(0.0, value) * step(value, u_colormapMaxIndex);\n}","lut.frag":"precision mediump float;\nvarying highp vec2 v_texcoord;\n#include <raster/common/common.glsl>\n#include <raster/lut/colorize.glsl>\nvoid main() {\nvec2 pixelLocation = getPixelLocation(v_texcoord);\nif (isOutside(pixelLocation)) {\ngl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\nvec4 currentPixel = getPixel(pixelLocation);\nvec4 result = colorizeNoClamp(currentPixel, 1.0);\ngl_FragColor = vec4(result.xyz, 1.0) * result.a * u_opacity;\n}"},magdir:{"magdir.frag":"precision mediump float;\nvarying vec4 v_color;\nuniform lowp float u_opacity;\nvoid main() {\ngl_FragColor = v_color * u_opacity;\n}","magdir.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_vv;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nuniform vec2 u_symbolSize;\nuniform vec2 u_symbolPercentRange;\nuniform vec2 u_dataRange;\nuniform float u_rotation;\nuniform vec4 u_colors[12];\nvarying vec4 v_color;\nvoid main()\n{\nfloat angle = a_offset.y + u_rotation;\n#ifndef ROTATION_GEOGRAPHIC\nangle = 3.14159265359 * 2.0 - angle - 3.14159265359 / 2.0;\n#endif\nvec2 offset = vec2(cos(angle), sin(angle)) * a_offset.x;\n#ifdef DATA_RANGE\nfloat valuePercentage = clamp((a_vv.y - u_dataRange.x) / (u_dataRange.y - u_dataRange.x), 0.0, 1.0);\nfloat sizeRatio = u_symbolPercentRange.x + valuePercentage * (u_symbolPercentRange.y - u_symbolPercentRange.x);\nfloat sizePercentage = clamp(sizeRatio, u_symbolPercentRange.x, u_symbolPercentRange.y);\n#else\nfloat sizePercentage = (u_symbolPercentRange.x + u_symbolPercentRange.y) / 2.0;\n#endif\nvec2 pos = a_pos + offset * sizePercentage * u_symbolSize;\nv_color = u_colors[int(a_vv.x)];\ngl_Position = vec4(u_dvsMat3 * vec3(pos * u_coordScale, 1.0), 1.0);\n}"},reproject:{"reproject.frag":"precision mediump float;\nvarying vec2 v_texcoord;\n#include <raster/common/common.glsl>\nvoid main() {\nvec2 pixelLocation = getPixelLocation(v_texcoord);\nif (isOutside(pixelLocation)) {\ngl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\nreturn;\n}\nvec4 currentPixel = getPixel(pixelLocation);\ngl_FragColor = vec4(currentPixel.rgb, 1.0) * currentPixel.a * u_opacity;\n}","reproject.vert":"precision mediump float;\nattribute vec2 a_position;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\nv_texcoord = a_position;\ngl_Position = vec4(2.0 * (a_position - 0.5), 0.0, 1.0);\n}"},rfx:{aspect:{"aspect.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform vec2 u_cellSize;\nuniform vec2 u_srcImageSize;\n#include <raster/common/getSurfaceValues.glsl>\nconst float pi = 3.14159265359;\nvoid main() {\nfloat pv[10];\ngetSurfaceValues(u_image, v_texcoord, u_srcImageSize, pv);\nfloat alpha = pv[9];\nfloat dzx = (pv[2] + 2.0 * pv[5] + pv[8] - pv[0] - 2.0 * pv[3] - pv[6]) / (8.0 * u_cellSize[0]);\nfloat dzy = -(pv[6] + 2.0 * pv[7] + pv[8] - pv[0] - 2.0 * pv[1] - pv[2]) / (8.0 * u_cellSize[1]);\nalpha *= sign(abs(dzx) + abs(dzy));\nfloat aspect_rad = (dzx == 0.0) ? (step(0.0, dzy) * 0.5 * pi + step(dzy, 0.0) * 1.5 * pi) : mod((2.5 * pi + atan(dzy, -dzx)), 2.0 * pi);\nfloat aspect = aspect_rad * 180.0 / pi;\ngl_FragColor = vec4(aspect, aspect, aspect, 1.0) * alpha;\n}"},bandarithmetic:{"bandarithmetic.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform mediump mat3 u_bandIndexMat3;\nuniform float u_adjustments[3];\n#include <raster/common/inverse.glsl>\nvoid main() {\nvec4 pv = texture2D(u_image, v_texcoord);\nvec3 pv2 = u_bandIndexMat3 * pv.rgb;\nfloat nir = pv2.r;\nfloat red = pv2.g;\nfloat index;\n#ifdef NDXI\nindex = (nir - red) * invertValue(nir + red);\n#elif defined(SR)\nindex = nir * invertValue(red);\n#elif defined(CI)\nindex = nir * invertValue(red) - 1.0;\n#elif defined(SAVI)\nindex = (nir - red) * invertValue(nir + red + u_adjustments[0]) * (1.0 + u_adjustments[0]);\n#elif defined(TSAVI)\nfloat s = u_adjustments[0];\nfloat a = u_adjustments[1];\nfloat x = u_adjustments[2];\nfloat y = -a * s + x * (1.0 + s * s);\nindex = (s * (nir - s * red - a)) * invertValue(a * nir + red + y);\n#elif defined(MSAVI)\nfloat nir2 = 2.0 * nir + 1.0;\nindex = 0.5 * (nir2 - sqrt(nir2 * nir2 - 8.0 * (nir - red)));\n#elif defined(GEMI)\nfloat eta = (2.0 * (nir * nir - red * red) + 1.5 * nir + 0.5 * red) * invertValue(nir + red + 0.5);\nindex = eta * (1.0 - 0.25 * eta) - (red - 0.125) * invertValue(1.0 - red);\n#elif defined(PVI)\nfloat a = u_adjustments[0];\nfloat b = u_adjustments[1];\nfloat y = sqrt(1.0 + a * a);\nindex = (nir - a * red - b) * invertValue(y);\n#elif defined(VARI)\nindex = (pv2.g - pv2.r) * invertValue(pv2.g + pv2.r - pv2.b);\n#elif defined(MTVI)\nfloat green = pv2.b;\nfloat v = sqrt(pow((2.0 * nir + 1.0), 2.0) - (6.0 * nir - 5.0 * sqrt(red)) - 0.5);\nindex = 1.5 * (1.2 * (nir - green) - 2.5 * (red - green)) * invertValue(v);\n#elif defined(RTVICORE)\nfloat green = pv2.b;\nindex = 100.0 * (nir - red) - 10.0 * (nir - green);\n#elif defined(EVI)\nfloat blue = pv2.b;\nfloat denom = nir + 6.0 * red - 7.5 * blue + 1.0;\nindex =  (2.5 * (nir - red)) * invertValue(denom);\n#elif defined(WNDWI)\nfloat g = pv2.r;\nfloat n = pv2.g;\nfloat s = pv2.b;\nfloat a = u_adjustments[0];\nfloat denom = g + a * n + (1.0 - a) * s;\nindex = (g - a * n - (1.0 - a) * s) * invertValue(denom);\n#elif defined(BAI)\nindex = invertValue(pow((0.1 - red), 2.0) + pow((0.06 - nir), 2.0));\n#else\ngl_FragColor = pv;\nreturn;\n#endif\n#ifdef ROUND_OUTPUT\nindex = floor(index + 0.5);\n#endif\ngl_FragColor = vec4(index, index, index, pv.a);\n}"},colormap2rgb:{"colormap2rgb.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\n#include <raster/lut/colorize.glsl>\nvoid main() {\nvec4 pv = texture2D(u_image, v_texcoord);\nvec4 result = colorizeNoClamp(vec4(pv.r, pv.r, pv.r, 1.0), 1.0);\ngl_FragColor = vec4(result.xyz * 255.0, 1.0) * result.a * pv.a;\n}"},compositeband:{"compositeband.frag":"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nuniform sampler2D u_image2;\n#ifdef ONE_CONSTANT\nuniform float u_image1Const;\n#ifdef TWO_CONSTANT\nuniform float u_image2Const;\n#endif\nuniform mat3 u_imageSwap;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\nvec4 pv0 = texture2D(u_image, v_texcoord);\nfloat a = pv0.r;\nfloat alpha = pv0.a;\n#ifdef TWO_CONSTANT\nfloat b = u_image1Const;\nfloat c = u_image2Const;\nvec3 abc = u_imageSwap * vec3(a, b, c);\na = abc.s;\nb = abc.t;\nc = abc.p;\n#elif defined(ONE_CONSTANT)\nvec4 pv1 = texture2D(u_image1, v_texcoord);\nfloat b = pv1.r;\nfloat c = u_image1Const;\nvec3 abc = u_imageSwap * vec3(a, b, c);\na = abc.s;\nb = abc.t;\nc = abc.p;\nalpha *= pv1.a;\n#else\nvec4 pv1 = texture2D(u_image1, v_texcoord);\nvec4 pv2 = texture2D(u_image2, v_texcoord);\nfloat b = pv1.r;\nfloat c = pv2.r;\nalpha = alpha * pv1.a * pv2.a;\n#endif\ngl_FragColor = vec4(a, b, c, alpha);\n}"},computechange:{"computechange.frag":"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\n#ifdef ONE_CONSTANT\nuniform float u_image1Const;\nuniform mat3 u_imageSwap;\n#endif\nvarying vec2 v_texcoord;\nuniform vec2 u_domainRange;\n#include <raster/common/inverse.glsl>\nvoid main() {\nvec4 pv0 = texture2D(u_image, v_texcoord);\nfloat a = pv0.r;\n#ifdef ONE_CONSTANT\nfloat b = u_image1Const;\nvec3 abc = u_imageSwap * vec3(a, b, 0);\na = abc.s;\nb = abc.t;\n#else\nvec4 pv1 = texture2D(u_image1, v_texcoord);\nfloat b = pv1.r;\n#endif\nfloat result = a;\nfloat alpha = pv0.a;\n#ifdef DIFFERENCE\nresult = a - b;\n#elif defined(RELATIVE)\nresult = (a - b) * invertValue(max(abs(a), abs(b)));\n#endif\nbool isInvalid = result < u_domainRange.s || result > u_domainRange.t;\nresult = isInvalid ? 0.0 : result;\nalpha *= float(!isInvalid);\n#ifdef ROUND_OUTPUT\nresult = floor(result + 0.5);\n#endif\ngl_FragColor = vec4(result, result, result, alpha);\n}"},contrast:{"contrast.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\n#include <raster/common/contrastBrightness.glsl>\nvoid main() {\nvec4 pv = texture2D(u_image, v_texcoord);\nvec4 result = adjustContrastBrightness(pv, false);\ngl_FragColor = vec4(floor(result.rgb * 255.0 + 0.5), result.a);\n}"},convolution:{"convolution.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform vec2 u_srcImageSize;\n#define KERNEL_SIZE_ROWS ROWS\n#define KERNEL_SIZE_COLS COLS\nuniform vec2 u_clampRange;\nuniform float u_kernel[25];\n#include <raster/common/mirror.glsl>\nvoid main() {\nvec3 rgb = vec3(0.0, 0.0, 0.0);\nvec2 resolution = 1.0 / u_srcImageSize;\nfloat rowOffset = -float(floor(float(KERNEL_SIZE_ROWS) / 2.0));\nfloat colOffset = -float(floor(float(KERNEL_SIZE_COLS) / 2.0));\nfloat alpha = 1.0;\nfor (int row = 0; row < KERNEL_SIZE_ROWS; row++) {\nfloat pos_row = rowOffset + float(row);\nfor (int col = 0; col < KERNEL_SIZE_COLS; col++) {\nvec2 pos = v_texcoord + vec2(colOffset + float(col), pos_row) * resolution;\nvec4 pv = texture2D(u_image, mirror(pos));\nrgb += pv.rgb * u_kernel[row * KERNEL_SIZE_COLS + col];\nalpha *= pv.a;\n}\n}\nrgb = clamp(rgb, u_clampRange.s, u_clampRange.t);\ngl_FragColor = vec4(rgb * alpha, alpha);\n}"},curvature:{"curvature.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform float u_zlFactor;\nuniform vec2 u_srcImageSize;\n#include <raster/common/getSurfaceValues.glsl>\nvoid main() {\nfloat pv[10];\ngetSurfaceValues(u_image, v_texcoord, u_srcImageSize, pv);\nfloat alpha = pv[9];\nfloat d = ((pv[3] + pv[5]) * 0.5 - pv[4]);\nfloat e = ((pv[1] + pv[7]) * 0.5 - pv[4]);\nfloat curvature = 0.0;\n#ifdef STANDARD\ncurvature = -u_zlFactor * (d + e);\ngl_FragColor = vec4(curvature, curvature, curvature, alpha);\n#else\nfloat f = (-pv[0] + pv[2] + pv[6] - pv[8]) / 4.0;\nfloat g = (-pv[3] + pv[5]) / 2.0;\nfloat h = (pv[1] - pv[7]) / 2.0;\nfloat g2 = g * g;\nfloat h2 = h * h;\n#ifdef PROFILE\ncurvature = (u_zlFactor * (d * g2 + e * h2 + f * g * h)) / (g2 + h2);\n#else\ncurvature = (-u_zlFactor * (d * h2 + e * g2 - f * g * h)) / (g2 + h2);\n#endif\n#endif\ngl_FragColor = vec4(curvature, curvature, curvature, alpha);\n}"},extractband:{"extractband.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform mediump mat3 u_bandIndexMat3;\nvoid main() {\nvec4 pv = texture2D(u_image, v_texcoord);\nvec3 pv2 = u_bandIndexMat3 * pv.rgb;\ngl_FragColor = vec4(pv2, pv.a);\n}"},focalstatistics:{"focalstatistics.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform vec2 u_srcImageSize;\n#define KERNEL_SIZE_ROWS ROWS\n#define KERNEL_SIZE_COLS COLS\nuniform vec2 u_clampRange;\n#include <raster/common/mirror.glsl>\n#include <raster/common/inverse.glsl>\nvoid main() {\nvec2 resolution = 1.0 / u_srcImageSize;\nfloat rowOffset = -float(floor(float(KERNEL_SIZE_ROWS) / 2.0));\nfloat colOffset = -float(floor(float(KERNEL_SIZE_COLS) / 2.0));\nfloat count = 0.0;\n#ifdef STDDEV\nvec3 sum = vec3(0.0, 0.0, 0.0);\nvec3 sum2 = vec3(0.0, 0.0, 0.0);\n#endif\nvec4 currentPixel = texture2D(u_image, v_texcoord);\nvec3 rgb = currentPixel.rgb;\nfor (int row = 0; row < KERNEL_SIZE_ROWS; row++) {\nfloat pos_row = rowOffset + float(row);\nfor (int col = 0; col < KERNEL_SIZE_COLS; col++) {\nvec2 pos = v_texcoord + vec2(colOffset + float(col), pos_row) * resolution;\nvec4 pv = texture2D(u_image, mirror(pos));\ncount += pv.a;\n#ifdef MIN\nrgb = min(rgb, pv.rgb);\n#elif defined(MAX)\nrgb = max(rgb, pv.rgb);\n#elif defined(MEAN)\nrgb += pv.rgb;\n#elif defined(STDDEV)\nsum += pv.rgb;\nsum2 += (pv.rgb * pv.rgb);\n#endif\n}\n}\n#ifdef MEAN\nrgb *= invertValue(count);\n#elif defined(STDDEV)\nrgb = sqrt((sum2 - sum * sum * invertValue(count)) * invertValue(count));\n#endif\nfloat alpha = step(0.9999, count);\nrgb = clamp(rgb, u_clampRange.s, u_clampRange.t);\n#ifdef FILL\nrgb = (1.0 - currentPixel.a) * rgb + currentPixel.a * currentPixel.rgb;\n#endif\ngl_FragColor = vec4(rgb * alpha, alpha);\n}"},grayscale:{"grayscale.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform vec3 u_weights;\nvoid main() {\nvec4 pv = texture2D(u_image, v_texcoord);\nfloat value = dot(u_weights, pv.rgb);\ngl_FragColor = vec4(value, value, value, pv.a);\n}"},local:{"local.frag":"precision highp float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\n#ifdef ONE_CONSTANT\nuniform float u_image1Const;\n#ifdef TWO_CONSTANT\nuniform float u_image2Const;\n#endif\nuniform mat3 u_imageSwap;\n#endif\nvarying vec2 v_texcoord;\nuniform vec2 u_domainRange;\n#include <raster/common/inverse.glsl>\nvoid main() {\nvec4 pv0 = texture2D(u_image, v_texcoord);\nfloat a = pv0.r;\n#ifdef TWO_IMAGES\n#ifdef ONE_CONSTANT\nfloat b = u_image1Const;\nvec3 abc = u_imageSwap * vec3(a, b, 0);\na = abc.s;\nb = abc.t;\n#else\nvec4 pv1 = texture2D(u_image1, v_texcoord);\nfloat b = pv1.r;\n#endif\n#elif defined(CONDITIONAL)\n#ifdef TWO_CONSTANT\nfloat b = u_image1Const;\nfloat c = u_image2Const;\nvec3 abc = u_imageSwap * vec3(a, b, c);\na = abc.s;\nb = abc.t;\nc = abc.p;\n#elif defined(ONE_CONSTANT)\nvec4 pv1 = texture2D(u_image1, v_texcoord);\nfloat b = pv1.r;\nfloat c = u_image1Const;\nvec3 abc = u_imageSwap * vec3(a, b, c);\na = abc.s;\nb = abc.t;\nc = abc.p;\n#else\nvec4 pv1 = texture2D(u_image1, v_texcoord);\nvec4 pv2 = texture2D(u_image2, v_texcoord);\nfloat b = pv1.r;\nfloat c = pv2.r;\n#endif\n#endif\nfloat result = a;\nfloat alpha = pv0.a;\n#ifdef PLUS\nresult = a + b;\n#elif defined(MINUS)\nresult = a - b;\n#elif defined(TIMES)\nresult = a * b;\n#elif defined(DIVIDE)\nresult = a * invertValue(b);\nalpha *= float(abs(sign(b)));\n#elif defined(FLOATDIVIDE)\nresult = a * invertValue(b);\nalpha *= float(abs(sign(b)));\n#elif defined(FLOORDIVIDE)\nresult = floor(a * invertValue(b));\nalpha *= float(abs(sign(b)));\n#elif defined(SQUARE)\nresult = a * a;\n#elif defined(SQRT)\nresult = sqrt(a);\n#elif defined(POWER)\nresult = pow(a, b);\n#elif defined(LN)\nresult = a <= 0.0 ? 0.0: log(a);\nalpha *= float(a > 0.0);\n#elif defined(LOG_1_0)\nresult = a <= 0.0 ? 0.0: log2(a) * invertValue(log2(10.0));\nalpha *= float(a > 0.0);\n#elif defined(LOG_2)\nresult = a <= 0.0 ? 0.0: log2(a);\nalpha *= float(a > 0.0);\n#elif defined(EXP)\nresult = exp(a);\n#elif defined(EXP_1_0)\nresult = pow(10.0, a);\n#elif defined(EXP_2)\nresult = pow(2.0, a);\n#elif defined(ROUNDDOWN)\nresult = floor(a);\n#elif defined(ROUNDUP)\nresult = ceil(a);\n#elif defined(INT)\nresult = float(sign(a)) * floor(abs(a));\n#elif defined(MOD)\nresult = mod(a, b);\n#elif defined(NEGATE)\nresult = -a;\n#elif defined(ABS)\nresult = abs(a);\n#elif defined(ACOS)\nresult = abs(a) > 1.0 ? 0.0: acos(a);\nalpha *= step(abs(a), 1.00001);\n#elif defined(ACOSH)\nresult = acosh(a);\n#elif defined(ASIN)\nresult = abs(a) > 1.0 ? 0.0: asin(a);\nalpha *= step(abs(a), 1.00001);\n#elif defined(ASINH)\nresult = asinh(a);\n#elif defined(ATAN)\nresult = atan(a);\n#elif defined(ATANH)\nresult = abs(a) > 1.0 ? 0.0: atanh(a);\nalpha *= step(abs(a), 1.0);\n#elif defined(ATAN_2)\nresult = atan(a, b);\n#elif defined(COS)\nresult = cos(a);\n#elif defined(COSH)\nresult = cosh(a);\n#elif defined(SIN)\nresult = sin(a);\n#elif defined(SINH)\nresult = sinh(a);\n#elif defined(TAN)\nresult = tan(a);\n#elif defined(TANH)\nresult = tanh(a);\n#elif defined(BITWISEAND)\nresult = float(int(a) & int(b));\n#elif defined(BITWISEOR)\nresult = float(int(a) | int(b));\n#elif defined(BITWISELEFTSHIFT)\nresult = float(int(a) << int(b));\n#elif defined(BITWISERIGHTSHIFT)\nresult = float(int(a) >> int(b));\n#elif defined(BITWISENOT)\nresult = float(~(int(a)));\n#elif defined(BITWISEXOR)\nresult = float(int(a) ^ int(b));\n#elif defined(BOOLEANAND)\nresult = float((a != 0.0) && (b != 0.0));\n#elif defined(BOOLEANNOT)\nresult = float(a == 0.0);\n#elif defined(BOOLEANOR)\nresult = float((a != 0.0) || (b != 0.0));\n#elif defined(BOOLEANXOR)\nresult = float((a != 0.0) ^^ (b != 0.0));\n#elif defined(GREATERTHAN)\nresult = float(a > b);\n#elif defined(GREATERTHANEQUAL)\nresult = float(a >= b);\n#elif defined(LESSTHAN)\nresult = float(a < b);\n#elif defined(LESSTHANEQUAL)\nresult = float(a <= b);\n#elif defined(EQUALTO)\nresult = float(a == b);\n#elif defined(NOTEQUAL)\nresult = float(a != b);\n#elif defined(ISNULL)\nresult = float(alpha == 0.0);\nalpha = 1.0;\n#elif defined(SETNULL)\nfloat maskValue = float(a == 0.0);\nresult = maskValue * b;\nalpha *= maskValue;\n#elif defined(CONDITIONAL)\nfloat weight = float(abs(sign(a)));\nresult = weight * b + (1.0 - weight) * c;\n#endif\nfloat rangeFactor = step(u_domainRange.s, result) * step(result, u_domainRange.t);\nresult *= rangeFactor;\nalpha *= rangeFactor;\n#ifdef ROUND_OUTPUT\nresult = floor(result + 0.5);\n#endif\ngl_FragColor = vec4(result, result, result, alpha);\n}"},mask:{"mask.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\n#define LEN_INCLUDED_RANGES 6\n#define LEN_NODATA_VALUES 6\nuniform highp float u_includedRanges[6];\nuniform highp float u_noDataValues[6];\nfloat maskFactor(float bandValue, float fromValue, float to) {\nfloat factor = 1.0;\nfor (int i = 0; i < LEN_NODATA_VALUES; i++) {\nfactor *= float(u_noDataValues[i] != bandValue);\n}\nfactor *= step(fromValue, bandValue) * step(bandValue, to);\nreturn factor;\n}\nvoid main() {\nvec4 pv = texture2D(u_image, v_texcoord);\nfloat redFactor = maskFactor(pv.r, u_includedRanges[0], u_includedRanges[1]);\n#ifdef MULTI_BAND\nfloat greenFactor = maskFactor(pv.g, u_includedRanges[2], u_includedRanges[3]);\nfloat blueFactor = maskFactor(pv.b, u_includedRanges[4], u_includedRanges[5]);\nfloat maskFactor = redFactor * greenFactor * blueFactor;\ngl_FragColor = pv * maskFactor;\n#else\ngl_FragColor = pv * redFactor;\n#endif\n}"},ndvi:{"ndvi.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform mediump mat3 u_bandIndexMat3;\n#include <raster/common/inverse.glsl>\nvoid main() {\nvec4 pv = texture2D(u_image, v_texcoord);\nvec3 pv2 = u_bandIndexMat3 * pv.rgb;\nfloat nir = pv2.r;\nfloat red = pv2.g;\nfloat index = (nir - red) * invertValue(nir + red);\n#ifdef SCALED\nindex = floor((index + 1.0) * 100.0 + 0.5);\n#endif\ngl_FragColor = vec4(index, index, index, pv.a);\n}"},remap:{"remap.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\n#define LEN_REMAP_RANGES 18\n#define LEN_NODATA_RANGES 12\nuniform highp float u_rangeMaps[18];\nuniform highp float u_noDataRanges[12];\nuniform highp float u_unmatchMask;\nuniform vec2 u_clampRange;\nvoid main() {\nvec4 pv = texture2D(u_image, v_texcoord);\nfloat factor = 1.0;\nfloat bandValue = pv.r;\nfor (int i = 0; i < LEN_NODATA_RANGES; i+=2) {\nfloat inside = 1.0 - step(u_noDataRanges[i], bandValue) * step(bandValue, u_noDataRanges[i+1]);\nfactor *= inside;\n}\nfloat mapValue = 0.0;\nfloat includeMask = 0.0;\nfor (int i = 0; i < LEN_REMAP_RANGES; i+=3) {\nfloat stepMask = step(u_rangeMaps[i], bandValue) * step(bandValue, u_rangeMaps[i+1]);\nincludeMask = (1.0 - stepMask) * includeMask + stepMask;\nmapValue = (1.0 - stepMask) * mapValue + stepMask * u_rangeMaps[i+2];\n}\nbandValue = factor * (mapValue + (1.0 - includeMask) * u_unmatchMask * pv.r);\nfloat bandMask = factor * max(u_unmatchMask, includeMask);\nbandValue = clamp(bandValue, u_clampRange.s, u_clampRange.t);\ngl_FragColor = vec4(bandValue, bandValue, bandValue, bandMask * pv.a);\n}"},slope:{"slope.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform vec2 u_cellSize;\nuniform float u_zFactor;\nuniform vec2 u_srcImageSize;\nuniform float u_pixelSizePower;\nuniform float u_pixelSizeFactor;\n#include <raster/common/getSurfaceValues.glsl>\nvoid main() {\nfloat pv[10];\ngetSurfaceValues(u_image, v_texcoord, u_srcImageSize, pv);\nfloat alpha = pv[9];\nfloat xf = (u_zFactor + pow(u_cellSize[0], u_pixelSizePower) * u_pixelSizeFactor) / (8.0 * u_cellSize[0]);\nfloat yf = (u_zFactor + pow(u_cellSize[1], u_pixelSizePower) * u_pixelSizeFactor) / (8.0 * u_cellSize[1]);\nfloat dzx = (pv[2] + 2.0 * pv[5] + pv[8] - pv[0] - 2.0 * pv[3] - pv[6]) * xf;\nfloat dzy = -(pv[6] + 2.0 * pv[7] + pv[8] - pv[0] - 2.0 * pv[1] - pv[2]) * yf;\nfloat rise2run = sqrt(dzx * dzx + dzy * dzy);\n#ifdef PERCENT_RISE\nfloat result = rise2run * 100.0;\n#else\nfloat result = atan(rise2run) * 57.2957795;\n#endif\n#ifdef ROUND_OUTPUT\nresult = floor(result + 0.5);\n#endif\ngl_FragColor = vec4(result, result, result, alpha);\n}"},stretch:{"stretch.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying highp vec2 v_texcoord;\nuniform float u_minCutOff[3];\nuniform float u_maxCutOff[3];\nuniform float u_minOutput;\nuniform float u_maxOutput;\nuniform float u_factor[3];\nuniform float u_gamma[3];\nuniform float u_gammaCorrection[3];\nfloat stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, float gamma, float gammaCorrection) {\nval = clamp(val, minCutOff, maxCutOff);\nfloat stretchedVal;\n#ifdef USE_GAMMA\nfloat tempf = 1.0;\nfloat outRange = maxOutput - minOutput;\nfloat relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);\ntempf -= step(1.0, gamma) * sign(gamma - 1.0) * pow(1.0 / outRange, relativeVal * gammaCorrection);\nstretchedVal = tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput;\nstretchedVal = clamp(stretchedVal, minOutput, maxOutput);\n#else\nstretchedVal = minOutput + (val - minCutOff) * factor;\n#endif\n#ifdef ROUND_OUTPUT\nstretchedVal = floor(stretchedVal + 0.5);\n#endif\nreturn stretchedVal;\n}\nvoid main() {\nvec4 currentPixel = texture2D(u_image, v_texcoord);\nfloat redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_gamma[0], u_gammaCorrection[0]);\n#ifdef MULTI_BAND\nfloat greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_gamma[1], u_gammaCorrection[1]);\nfloat blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_gamma[2], u_gammaCorrection[2]);\ngl_FragColor = vec4(redVal, greenVal, blueVal, currentPixel.a);\n#else\ngl_FragColor = vec4(redVal, redVal, redVal, currentPixel.a);\n#endif\n}"},vs:{"vs.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\nv_texcoord = a_pos;\ngl_Position = vec4(u_dvsMat3 * vec3(a_pos * u_coordScale, 1.0), 1.0);\n}"}},scalar:{"scalar.frag":"precision mediump float;\nuniform lowp float u_opacity;\nvarying vec2 v_pos;\nconst vec4 outlineColor = vec4(0.2, 0.2, 0.2, 1.0);\nconst float outlineSize = 0.02;\nconst float innerRadius = 0.25;\nconst float outerRadius = 0.42;\nconst float innerSquareLength = 0.15;\nvoid main() {\nmediump float dist = length(v_pos);\nmediump float fillalpha1 = smoothstep(outerRadius, outerRadius + outlineSize, dist);\nfillalpha1 *= (1.0-smoothstep(outerRadius + outlineSize, outerRadius + 0.1 + outlineSize, dist));\n#ifdef INNER_CIRCLE\nmediump float fillalpha2 = smoothstep(innerRadius, innerRadius + outlineSize, dist);\nfillalpha2 *= (1.0-smoothstep(innerRadius + outlineSize, innerRadius + 0.1 + outlineSize, dist));\n#else\nmediump float fillalpha2 = (abs(v_pos.x) < innerSquareLength ? 1.0 : 0.0) * (abs(v_pos.y) < innerSquareLength ? 1.0 : 0.0);\n#endif\ngl_FragColor = (fillalpha2 + fillalpha1) * outlineColor * u_opacity;\n}","scalar.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_vv;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nuniform vec2 u_symbolSize;\nuniform vec2 u_symbolPercentRange;\nuniform vec2 u_dataRange;\nvarying vec2 v_pos;\nvoid main()\n{\n#ifdef DATA_RANGE\nfloat valuePercentage = clamp((a_vv.y - u_dataRange.x) / (u_dataRange.y - u_dataRange.x), 0.0, 1.0);\nfloat sizeRatio = u_symbolPercentRange.x + valuePercentage * (u_symbolPercentRange.y - u_symbolPercentRange.x);\nfloat sizePercentage = clamp(sizeRatio, u_symbolPercentRange.x, u_symbolPercentRange.y);\n#else\nfloat sizePercentage = (u_symbolPercentRange.x + u_symbolPercentRange.y) / 2.0;\n#endif\nvec2 size = u_symbolSize * sizePercentage;\nvec2 pos = a_pos + a_offset * size;\nv_pos = a_offset;\ngl_Position = vec4(u_dvsMat3 * vec3(pos * u_coordScale, 1.0), 1.0);\n}"},stretch:{"stretch.frag":"precision mediump float;\nvarying highp vec2 v_texcoord;\n#include <raster/common/common.glsl>\nuniform float u_minCutOff[3];\nuniform float u_maxCutOff[3];\nuniform float u_minOutput;\nuniform float u_maxOutput;\nuniform float u_factor[3];\nuniform bool u_useGamma;\nuniform float u_gamma[3];\nuniform float u_gammaCorrection[3];\n#include <raster/lut/colorize.glsl>\nfloat stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {\nif (val >= maxCutOff) {\nreturn maxOutput;\n} else if (val <= minCutOff) {\nreturn minOutput;\n}\nfloat stretchedVal;\nif (useGamma) {\nfloat tempf = 1.0;\nfloat outRange = maxOutput - minOutput;\nfloat relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);\nif (gamma > 1.0) {\ntempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);\n}\nstretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;\n} else {\nstretchedVal = minOutput + (val - minCutOff) * factor;\n}\n#ifdef ROUND_OUTPUT\nstretchedVal = floor(stretchedVal + 0.5);\n#endif\nreturn stretchedVal;\n}\nvoid main() {\nvec2 pixelLocation = getPixelLocation(v_texcoord);\nif (isOutside(pixelLocation)) {\ngl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\nvec4 currentPixel = getPixel(pixelLocation);\n#ifdef NOOP\ngl_FragColor = vec4(currentPixel.rgb, 1.0) * currentPixel.a * u_opacity;\nreturn;\n#endif\nif (u_bandCount == 1) {\nfloat grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);\n#ifdef APPLY_COLORMAP\nvec4 result = colorize(vec4(grayVal, grayVal, grayVal, 1.0), u_useGamma ? 255.0 : 1.0);\ngl_FragColor = vec4(result.xyz, 1.0) * result.a * currentPixel.a * u_opacity;\n#else\ngl_FragColor = vec4(grayVal, grayVal, grayVal, 1.0) * currentPixel.a * u_opacity;\n#endif\n} else {\nfloat redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);\nfloat greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);\nfloat blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);\ngl_FragColor = vec4(redVal, greenVal, blueVal, 1.0) * currentPixel.a * u_opacity;\n}\n}"}},stencil:{"stencil.frag":"void main() {\ngl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);\n}","stencil.vert":"attribute vec2 a_pos;\nuniform mat3 u_worldExtent;\nvoid main() {\ngl_Position = vec4(u_worldExtent * vec3(a_pos, 1.0), 1.0);\n}"},test:{"TestShader.common.glsl":"#ifndef RETURN_RED\nvarying    vec4      v_color;\n#endif\nvarying    vec2      v_offset;","TestShader.frag":"precision highp float;\n#include <test/TestShader.common.glsl>\nvoid main() {\nif (v_offset.x > -.5 && v_offset.y > -.5 && v_offset.x < .5 && v_offset.y < .5) {\ndiscard;\n}\n#ifdef RETURN_RED\ngl_FragColor = vec4(1., 0., 0., 1.);\n#else\ngl_FragColor = v_color;\n#endif\n}","TestShader.vert":"const float POS_PRECISION_FACTOR = 10.;\nconst float OFFSET_PRECISION_FACTOR = 10.;\nconst float SIZE_PRECISION_FACTOR = 10.;\nattribute  vec2      a_pos_packed;\nattribute  vec2      a_offset_packed;\nattribute  float     a_size_packed;\n#ifdef DATA_DRIVEN_COLOR\nconst float u_dataDrivenColor_validValues[4] = float[4](0., 0., 1., 0.);\nuniform    vec4      u_dataDrivenColor_colorFallback;\nuniform    vec4      u_dataDrivenColor_color;\n#endif\nuniform    float     u_view_zoomLevel;\n#include <test/TestShader.common.glsl>\n#ifdef DATA_DRIVEN_COLOR\nvec4 getColor(float value) {\nint index = -1;\nfor (int i = 0; i < 4; i++) {\nif (u_dataDrivenColor_validValues[i] == value) {\nindex = i;\nbreak;\n}\n}\nif (index == -1) {\nreturn u_dataDrivenColor_colorFallback;\n}\nreturn u_dataDrivenColor_color;\n}\n#endif\nvoid main() {\nvec2  a_pos = a_pos_packed / POS_PRECISION_FACTOR;\nvec2  a_offset = a_offset_packed / OFFSET_PRECISION_FACTOR;\nfloat a_size = a_size_packed / SIZE_PRECISION_FACTOR;\nvec4 color = vec4(1., 0., 0., 1.);\n#ifdef DATA_DRIVEN_COLOR\ncolor = getColor(1.);\n#endif\nvec2 offsetScaled = a_offset * a_size;\nvec4 pos = vec4(a_pos.xy + offsetScaled, 0., 1.);\ngl_Position = pos;\n#ifndef RETURN_RED\nv_color = color;\n#endif\nv_offset = a_offset;\n}"},tileInfo:{"tileInfo.frag":"uniform mediump sampler2D u_texture;\nvarying mediump vec2 v_tex;\nvoid main(void) {\nlowp vec4 color = texture2D(u_texture, v_tex);\ncolor.rgb *= color.a;\ngl_FragColor = color;\n}","tileInfo.vert":"attribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform mediump float u_depth;\nuniform mediump vec2 u_coord_ratio;\nuniform mediump vec2 u_delta;\nuniform mediump vec2 u_dimensions;\nvarying mediump vec2 v_tex;\nvoid main() {\nmediump vec2 offset = u_coord_ratio * vec2(u_delta + a_pos * u_dimensions);\nvec3 v_pos = u_dvsMat3 * vec3(offset, 1.0);\ngl_Position = vec4(v_pos.xy, 0.0, 1.0);\nv_tex = a_pos;\n}"},util:{"atan2.glsl":"float atan2(in float y, in float x) {\nfloat t0, t1, t2, t3, t4;\nt3 = abs(x);\nt1 = abs(y);\nt0 = max(t3, t1);\nt1 = min(t3, t1);\nt3 = 1.0 / t0;\nt3 = t1 * t3;\nt4 = t3 * t3;\nt0 =         - 0.013480470;\nt0 = t0 * t4 + 0.057477314;\nt0 = t0 * t4 - 0.121239071;\nt0 = t0 * t4 + 0.195635925;\nt0 = t0 * t4 - 0.332994597;\nt0 = t0 * t4 + 0.999995630;\nt3 = t0 * t3;\nt3 = (abs(y) > abs(x)) ? 1.570796327 - t3 : t3;\nt3 = x < 0.0 ?  3.141592654 - t3 : t3;\nt3 = y < 0.0 ? -t3 : t3;\nreturn t3;\n}","encoding.glsl":"const vec4 rgba2float_factors = vec4(\n255.0 / (256.0),\n255.0 / (256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n);\nfloat rgba2float(vec4 rgba) {\nreturn dot(rgba, rgba2float_factors);\n}"}},function(t){let e=r;return t.split("/").forEach((t=>{e&&(e=e[t])})),e}));var r;function s(t){return n.resolveIncludes(t)}},24964:function(t,e,i){function n(t,e){if(null!==e){t.push(e.length);for(const i of e)i.serialize(t);return t}t.push(0)}function r(t,e,i){const n=t.readInt32(),r=new Array(n);for(let n=0;n<r.length;n++)r[n]=e.deserialize(t,i);return r}i.d(e,{_:function(){return r},j:function(){return n}})},3101:function(t,e,i){i.d(e,{X:function(){return n},b:function(){return r}});const n=50,r=5},11765:function(t,e,i){i.d(e,{Ge:function(){return d},WT:function(){return f}}),i(50917);var n=i(62938),r=i(57862),s=i(65298),o=i(57652),a=i(1644),l=i(3101),c=i(57165),u=i(45532),h=i(91508);function d(t,e,i){const n=1===t?10:t;return n**(i?Math.round(function(t,e){return Math.log(t)/Math.log(e)}(l.X/e,n)):0)}function f(t,e,i){const l="number"==typeof t?null:t,d=i??l?.spatialReference;if(null==d||!(0,o.fn)(d)||function(t){const{isGeographic:e,isWebMercator:i}=t;return!e&&!i}(d))return(0,n.GA)(d);let f=l?.x??t,p=l?.y??e;const _=1/Math.sqrt(2);let m=f+_,g=p+_;const{isWebMercator:y,isGeographic:v}=d;let x=v&&!(0,r.TT)(d)?c.A.WGS84:d;if(y){let t=new u.default({x:f,y:p,spatialReference:d});(0,a.ci)(t,!0,t),f=t.x,p=t.y,t=new u.default({x:m,y:g,spatialReference:d}),(0,a.ci)(t,!0,t),m=t.x,g=t.y,x=c.A.WGS84}const b=new h.A({paths:[[[f,p],[m,g]]],spatialReference:x}),S=(0,s.XX)(b,10);let w;try{[w]=(0,r.l1)([S],"meters")}catch{return(0,n.GA)(d)}return w}},6578:function(t,e,i){i.d(e,{Z:function(){return n}});class n{getObjectId(t){return t.getObjectId()}getAttributes(t){return t.readAttributes()}getAttribute(t,e){return t.readAttribute(e)}getAttributeAsTimestamp(t,e){return t.readAttributeAsTimestamp(e)}cloneWithGeometry(t,e){return t}getGeometry(t){return t.readGeometryWorldSpace()}getCentroid(t,e){return t.readCentroidForDisplay()}}n.Shared=new n},29739:function(t,e,i){i.d(e,{Jz:function(){return u},T9:function(){return a}});var n=i(50659),r=i(28230),s=i(51008),o=i(2746);function a(t,e){return{type:"simple",filters:e,capabilities:{maxTextureSize:(0,o.C)().maxTextureSize},bindings:c(t)}}function l(t){switch(t){case"opacity":return r.Gn.OPACITY;case"color":return r.Gn.COLOR;case"rotation":return r.Gn.ROTATION;case"size":return r.Gn.SIZE;default:return null}}function c(t){if(!t)return[];switch(t.type){case"simple":case"class-breaks":case"unique-value":case"dictionary":return u(t);case"dot-density":return function(t){const e=[];for(const i of t.attributes)e.push({binding:e.length,expression:i.valueExpression,field:i.field});return e}(t);case"pie-chart":return function(t){const e=u(t);let i=4;for(const n of t.attributes)e.push({binding:i++,expression:n.valueExpression,field:n.field});return e}(t);case"heatmap":return function({valueExpression:t,field:e}){return t||e?[{binding:0,expression:t,field:e}]:[]}(t)}}function u(t){return"visualVariables"in t&&t.visualVariables?.length?(0,s.R)(t.visualVariables).map((t=>function(t){switch(t.type){case"size":return function(t){return"$view.scale"===t.valueExpression?null:{binding:l(t.type),field:t.field,normalizationField:t.normalizationField,expression:t.valueExpression,valueRepresentation:t.valueRepresentation}}(t);case"color":case"opacity":return function(t){return{binding:l(t.type),field:t.field,normalizationField:t.normalizationField,expression:t.valueExpression}}(t);case"rotation":return function(t){return{binding:l(t.type),expression:t.valueExpression,field:t.field}}(t)}}(t))).filter(n.Ru):[]}},44327:function(t,e,i){i.d(e,{Dk:function(){return x},K4:function(){return S},j0:function(){return b}}),i(58941);var n=i(13520),r=i(62938),s=i(85031),o=i(39686),a=i(40846),l=i(29397),c=i(51008);const u=1.25,h=128,d=128;function f(t){if(!t.stops?.length)return null;const e=t.stops.sort(((t,e)=>t.value-e.value)),i=(0,l.r)(e,8),n=i.map((({value:t})=>t)),r=i.map((({color:t})=>(0,l.p)(t)));return{values:n,colors:r}}function p(t){if(!t.stops?.length)return null;const e=t.stops.sort(((t,e)=>t.value-e.value)),i=(0,l.r)(e,8);return{opacityValues:i.map((({value:t})=>t)),opacities:i.map((({opacity:t})=>t))}}function _(t){return{rotationType:"geographic"===t.rotationType?a.H_.Geographic:a.H_.Arithmatic}}function m(t){if(!t.stops?.length)return null;if(t.stops.some((t=>t.useMaxValue||t.useMinValue)))return(e,i)=>{const r=e.statisticsByLevel.get(i.key.level),s=t.stops.map((e=>({value:e.useMaxValue?r?.get(t.field)?.maxValue??0:e.useMinValue?r?.get(t.field)?.minValue??0:e.value,size:e.size?(0,n.Lz)(e.size):o.qM}))).sort(((t,e)=>t.value-e.value)),a=(0,l.r)(s,8);return{values:a.map((({value:t})=>t)),sizes:a.map((({size:t})=>t))}};const e=t.stops.sort(((t,e)=>t.value-e.value)),i=(0,l.r)(e,8);return{values:i.map((({value:t})=>t)),sizes:i.map((({size:t})=>(0,n.Lz)(t)))}}function g(t){return e=>{const{state:i}=e;return{unitValueToPixelsRatio:(0,r.GA)(i.spatialReference)/s.j[t.valueUnit??"meters"]/i.resolution}}}function y(t,e){const i=e.length;if(t<e[0].value||1===i)return e[0].size;for(let n=1;n<i;n++)if(t<e[n].value){const i=(t-e[n-1].value)/(e[n].value-e[n-1].value);return e[n-1].size+i*(e[n].size-e[n-1].size)}return e[i-1].size}function v(t){const{minDataValue:e,maxDataValue:i,minSize:r,maxSize:s}=t;if("object"==typeof r&&"object"==typeof s)return(t,o)=>{const a=t.state.scale,l=(0,n.Lz)(y(a,r.stops)),c=(0,n.Lz)(y(a,s.stops));return{minMaxValueAndSize:[e,i,l,c]}};if("object"==typeof r||"object"==typeof s)throw new Error("InternalError: Found a partial VisualVariableSizeMinMaxValue");return{minMaxValueAndSize:[e,i,(0,n.Lz)(r),(0,n.Lz)(s)]}}const x={visualVariableColor:null,visualVariableOpacity:null,visualVariableRotation:null,visualVariableSizeStops:null,visualVariableSizeScaleStops:null,visualVariableSizeOutlineScaleStops:null,visualVariableSizeUnitValue:null,visualVariableSizeMinMaxValue:null};function b(t,e=d,i=u){if(t.visualVariableSizeMinMaxValue)return t.visualVariableSizeMinMaxValue instanceof Function?h:Math.max(t.visualVariableSizeMinMaxValue.minMaxValueAndSize[3]*i,e);if(t.visualVariableSizeScaleStops){if(t.visualVariableSizeScaleStops instanceof Function)return h;const n=t.visualVariableSizeScaleStops.sizes;return Math.max(n[n.length-1]*i,e)}if(t.visualVariableSizeStops){if(t.visualVariableSizeStops instanceof Function)return h;const n=t.visualVariableSizeStops.sizes;return Math.max(n[n.length-1]*i,e)}return t.visualVariableSizeUnitValue?2*h:0}function S(t){const e={...x};if(!t||!("visualVariables"in t)||!t.visualVariables)return e;for(const i of(0,c.R)(t.visualVariables))switch(i.type){case"color":e.visualVariableColor=f(i);break;case"opacity":e.visualVariableOpacity=p(i);break;case"rotation":e.visualVariableRotation=_(i);break;case"size":switch(w(i)){case"field-stops":e.visualVariableSizeStops=m(i);break;case"scale-stops":"outline"===i.target?e.visualVariableSizeOutlineScaleStops=m(i):e.visualVariableSizeScaleStops=m(i);break;case"min-max":e.visualVariableSizeMinMaxValue=v(i);break;case"unit-value":e.visualVariableSizeUnitValue=g(i)}}return e}function w(t){return"number"==typeof t.minDataValue&&"number"==typeof t.maxDataValue&&null!=t.minSize&&null!=t.maxSize?"min-max":"$view.scale"===t?.valueExpression&&Array.isArray(t.stops)?"scale-stops":null==t.field&&"$view.scale"===t?.valueExpression||!(Array.isArray(t.stops)||"levels"in t&&t.levels)?null!=t.field||"$view.scale"!==t?.valueExpression?"unit-value":null:"field-stops"}},29397:function(t,e,i){function n(t,e){const i=t.slice(0,e),n=e-i.length;for(let t=0;t<n;t++){const t=i[i.length-1];i.push(t)}return i}function r(t){if(!t)return[0,0,0,0];const{r:e,g:i,b:n,a:r}=t;return[e*(r/255),i*(r/255),n*(r/255),r]}i.d(e,{p:function(){return r},r:function(){return n}})},81672:function(t,e,i){i.d(e,{EM:function(){return b},Gn:function(){return _},IQ:function(){return w},Jk:function(){return h},NZ:function(){return x},TY:function(){return c},Zi:function(){return p},gF:function(){return f},oF:function(){return g}});var n=i(57176),r=i(38821),s=i(33389),o=i(63812),a=i(44327),l=i(80958);function c(t){return t.minScale||t.maxScale?{minScale:t.minScale??0,maxScale:t.maxScale??0}:null}function u(t){if(null==t)return null;if(Array.isArray(t)){const[e,i,n,r]=t;return[e,i,n,255*r]}return"string"==typeof t?t:{...t,defaultValue:u(t?.defaultValue)}}async function h(t,e){const{cimResourceManager:i,cimAnalyzer:r,scaleExpression:s}=e.schemaOptions;await Promise.all(n.wp.fetchResources(t.symbol,i,[]));const o=r.analyzeSymbolReference(t,!1),a={scaleInfo:c(t),scaleExpression:s},l=[];for(const t of o)switch(t.type){case"marker":l.push(...d(t,e,a));break;case"fill":l.push(...m(t,e,a));break;case"line":l.push(...y(t,e,a));break;case"text":l.push(...S(t,e,a))}return l}function d(t,e,i){const{uniforms:n,schemaOptions:r}=e,{store:s}=r,l=t.isOutline?{...a.Dk,visualVariableSizeScaleStops:n.visualVariableSizeOutlineScaleStops}:{visualVariableColor:n.visualVariableColor,visualVariableOpacity:n.visualVariableOpacity,visualVariableSizeMinMaxValue:n.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:n.visualVariableSizeScaleStops,visualVariableSizeStops:n.visualVariableSizeStops,visualVariableSizeUnitValue:n.visualVariableSizeUnitValue,visualVariableRotation:n.visualVariableRotation};return t.animationParams?f(s.ensureInstance(o.YS.animatedMarker,{uniforms:l,optionalAttributes:{zoomRange:!0}}),t,a.Dk,i):p(s.ensureInstance(o.YS.marker,{uniforms:l,optionalAttributes:{zoomRange:!!i.scaleInfo}}),t,n,i)}function f(t,e,i,n){return e.animationParams?[t.createMeshInfo({pixelDimensions:e.pixelDimensions,texelDimensions:e.texelDimensions,effects:e.effects?{type:"cim-effect-infos",effectInfos:e.effects}:null,sprite:e.spriteRasterizationParam,animations:e.animationParams,scaleInfo:n.scaleInfo,scaleSymbolsProportionally:e.scaleSymbolsProportionally,strokeWidth:e.outlineWidth,isMapAligned:e.alignment===s.C1.MAP,colorLocked:e.colorLocked,isStroke:e.isStroke,baseSize:e.baseSize,referenceSize:e.referenceSize,angleToLine:!!e.markerPlacement&&e.markerPlacement.placement&&"angleToLine"in e.markerPlacement.placement&&e.markerPlacement.placement.angleToLine,sizeRatio:e.sizeRatio})]:[]}function p(t,e,i,{scaleInfo:n,scaleExpression:s}){const o=(0,l.I)(i);return[t.createMeshInfo({size:e.size,scaleX:e.scaleX,anchorX:e.anchorPoint.x,anchorY:e.anchorPoint.y,angle:e.rotation,color:u(e.color)??[0,0,0,0],colorLocked:e.colorLocked,frameHeight:e.frameHeight,widthRatio:e.widthRatio,scaleInfo:n,offsetX:e.offsetX,offsetY:e.offsetY,outlineColor:u(e.outlineColor)??[0,0,0,0],outlineSize:e.outlineWidth,referenceSize:e.referenceSize||r.D.CIMVectorMarker.size,rotateClockwise:e.rotateClockwise,scaleFactor:s??1,sizeRatio:e.sizeRatio,alignment:e.alignment,isAbsoluteAnchorPoint:e.isAbsoluteAnchorPoint,scaleSymbolsProportionally:e.scaleSymbolsProportionally,sprite:e.spriteRasterizationParam,hasSizeVV:o,placement:e.markerPlacement,effects:e.effects?{type:"cim-effect-infos",effectInfos:e.effects}:null,transforms:e.transform,minPixelBuffer:(0,a.j0)(i)})]}function _(t,e,{scaleInfo:i}){return[t.createMeshInfo({color:u(e.color)??[0,0,0,0],scaleInfo:i,effects:e.effects?{type:"cim-effect-infos",effectInfos:e.effects}:null})]}function m(t,e,i){if(!t.spriteRasterizationParam)return function(t,e,i){const{uniforms:n,schemaOptions:r}=e,{store:s}=r;return _(s.ensureInstance(o.YS.fill,{uniforms:{visualVariableColor:t.colorLocked?null:n.visualVariableColor,visualVariableOpacity:n.visualVariableOpacity},optionalAttributes:{zoomRange:!!i.scaleInfo}}),t,i)}(t,e,i);const{uniforms:n,schemaOptions:r}=e,{store:s}=r;return g(s.ensureInstance(o.YS.complexFill,{uniforms:{visualVariableColor:t.colorLocked?null:n.visualVariableColor,visualVariableOpacity:n.visualVariableOpacity},optionalAttributes:{zoomRange:!!i.scaleInfo}}),t,null!=n.visualVariableColor,i)}function g(t,e,i,{scaleInfo:n}){if(!e.spriteRasterizationParam)throw new Error("InternalError: Sprite should always be defined");const r=!!e.hasUnresolvedReplacementColor&&(!i||e.colorLocked),s=e.sampleAlphaOnly&&!r,o=e.spriteRasterizationParam;return[t.createMeshInfo({color:u(e.color)??[0,0,0,0],height:e.height,aspectRatio:e.scaleX,offsetX:e.offsetX,offsetY:e.offsetY,scaleX:1,scaleY:1,angle:e.angle,applyRandomOffset:e.applyRandomOffset,sampleAlphaOnly:s,scaleProportionally:"CIMHatchFill"===o.resource.type,sprite:o,scaleInfo:n,effects:e.effects?{type:"cim-effect-infos",effectInfos:e.effects}:null})]}function y(t,e,i){const{uniforms:n,schemaOptions:r}=e,{store:s}=r,l=t.isOutline?{...a.Dk,visualVariableSizeScaleStops:n.visualVariableSizeOutlineScaleStops}:{visualVariableColor:t.colorLocked?null:n.visualVariableColor,visualVariableOpacity:n.visualVariableOpacity,visualVariableSizeMinMaxValue:n.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:n.visualVariableSizeScaleStops,visualVariableSizeStops:n.visualVariableSizeStops,visualVariableSizeUnitValue:n.visualVariableSizeUnitValue},c={uniforms:l,optionalAttributes:{zoomRange:!!i.scaleInfo}},u=!!(l.visualVariableSizeMinMaxValue||l.visualVariableSizeScaleStops||l.visualVariableSizeStops||l.visualVariableSizeUnitValue);return t.spriteRasterizationParam?b(s.ensureInstance(o.YS.texturedLine,c),t,u,i):x(s.ensureInstance(o.YS.line,c),t,u,i)}function v(t,e,{scaleInfo:i}){return{color:u(t.color)??[0,0,0,0],width:t.width,referenceWidth:t.referenceWidth,capType:t.cap,joinType:t.join,miterLimit:t.miterLimit,scaleInfo:i,hasSizeVV:e,effects:t.effects?{type:"cim-effect-infos",effectInfos:t.effects}:null}}function x(t,e,i,n){if(e.spriteRasterizationParam)throw new Error("InternalError: Sprite should not be defined");const r=v(e,i,n);return[t.createMeshInfo(r)]}function b(t,e,i,n){const{spriteRasterizationParam:r,scaleDash:s,sampleAlphaOnly:o}=e;if(!r)throw new Error("InternalError: Sprite should be defined");return[t.createMeshInfo({...v(e,i,n),offsetAlongLine:e.offsetAlongLine??0,shouldScaleDash:s??!1,shouldSampleAlphaOnly:o,isSDF:"CIMPictureStroke"!==r.resource.type,sprite:r})]}function S(t,e,i){const{uniforms:n,schemaOptions:r}=e,{store:s}=r;return w(s.ensureInstance(o.YS.text,{uniforms:{visualVariableColor:t.colorLocked?null:n.visualVariableColor,visualVariableOpacity:n.visualVariableOpacity,visualVariableRotation:n.visualVariableRotation,visualVariableSizeMinMaxValue:n.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:n.visualVariableSizeScaleStops,visualVariableSizeStops:n.visualVariableSizeStops,visualVariableSizeUnitValue:n.visualVariableSizeUnitValue},optionalAttributes:{zoomRange:!!i.scaleInfo,referenceSymbol:!1,clipAngle:!1}}),t,n,i)}function w(t,e,i,{scaleInfo:n,scaleExpression:r}){return[t.createMeshInfo({boxBackgroundColor:u(e.backgroundColor),boxBorderLineColor:u(e.borderLineColor),boxBorderLineSize:e.borderLineWidth??0,color:u(e.color)??[0,0,0,0],offsetX:e.offsetX,offsetY:e.offsetY,postAngle:e.angle,fontSize:e.size,referenceSize:e.referenceSize,decoration:e.decoration,haloColor:u(e.haloColor)??[0,0,0,0],haloSize:e.haloSize??0,outlineColor:u(e.outlineColor)??[0,0,0,0],outlineSize:e.outlineSize,lineWidth:e.lineWidth||512,lineHeightRatio:1,horizontalAlignment:e.horizontalAlignment??"center",verticalAlignment:e.verticalAlignment??"baseline",useCIMAngleBehavior:!1,glyphs:e.textRasterizationParam,scaleInfo:n,effects:e.effects?{type:"cim-effect-infos",effectInfos:e.effects}:null,placement:e.markerPlacement,transforms:e.transform,scaleFactor:r??1,minPixelBuffer:(0,a.j0)(i),repeatLabel:null,repeatLabelDistance:null,allowOverrun:null,labelPosition:null})]}},80958:function(t,e,i){function n(t){return!!(t.visualVariableSizeMinMaxValue||t.visualVariableSizeScaleStops||t.visualVariableSizeStops||t.visualVariableSizeUnitValue||t.visualVariableSizeOutlineScaleStops)}function r(t){return!!t.visualVariableRotation}i.d(e,{I:function(){return n},N:function(){return r}})},7910:function(t,e,i){i.d(e,{L:function(){return n}});class n{destroy(){}}},12564:function(t,e,i){i.d(e,{K:function(){return v}});var n=i(39819),r=i(58941),s=i(40633),o=i(72952),a=i(39686),l=i(7459),c=i(88413),u=i(40846);class h{constructor(t){this.data=t,this._referenceCount=0}increment(){this._referenceCount+=1}decrement(){this._referenceCount-=1}empty(){return 0===this._referenceCount}}class d{constructor(){this._freeIdsGenerationA=[],this._freeIdsGenerationB=[],this._idCounter=1,this._freeIds=this._freeIdsGenerationA,this._objectIdToDisplayId=new Map}createIdForObjectId(t){let e=this._objectIdToDisplayId.get(t);return e?e.increment():(e=new h((0,l.Ss)(this._getFreeId(),!1)),e.increment(),this._objectIdToDisplayId.set(t,e)),e.data}releaseIdForObjectId(t){const e=this._objectIdToDisplayId.get(t);e&&(e.decrement(),e.empty()&&(this._objectIdToDisplayId.delete(t),this._freeIds.push(e.data)))}getDisplayIdForObjectId(t){const e=this._objectIdToDisplayId.get(t);return null!=e?e.data:null}releaseAll(){for(const t of this._objectIdToDisplayId.values())this._freeIds.push(t.data);this._objectIdToDisplayId.clear()}incrementGeneration(){this._freeIds=this._freeIds===this._freeIdsGenerationA?this._freeIdsGenerationB:this._freeIdsGenerationA}_getFreeId(){return this._freeIds.length?this._freeIds.pop():this._idCounter++}}var f=i(70132),p=i(85456);const _=()=>s.A.getLogger("esri.views.layers.2d.features.support.AttributeStore"),m=(_(),()=>null),g=(0,r.A)("esri-shared-array-buffer");(0,r.A)("esri-atomics");class y{constructor(t,e,i){this.size=0,this.texelSize=4,this.dirtyStart=0,this.dirtyEnd=0;const{pixelType:n,layout:r,textureOnly:s}=e;this.textureOnly=s||!1,this.pixelType=n,this.layout=r,this._resetRange(),this.size=t,this.isLocal=i,s||(this.data=this._initData(n,t))}get buffer(){return this.data?.buffer}unsetComponentAllTexels(t,e){const i=this.data;for(let n=0;n<this.size*this.size;n++)i[n*this.texelSize+t]&=~e;this.dirtyStart=0,this.dirtyEnd=this.size*this.size-1}setComponentAllTexels(t,e){const i=this.data;for(let n=0;n<this.size*this.size;n++)i[n*this.texelSize+t]|=255&e;this.dirtyStart=0,this.dirtyEnd=this.size*this.size-1}setComponent(t,e,i){const n=this.data;for(const r of i)n[r*this.texelSize+t]|=e,this.dirtyStart=Math.min(this.dirtyStart,r),this.dirtyEnd=Math.max(this.dirtyEnd,r)}setComponentTexel(t,e,i){this.data[i*this.texelSize+t]|=e,this.dirtyStart=Math.min(this.dirtyStart,i),this.dirtyEnd=Math.max(this.dirtyEnd,i)}unsetComponentTexel(t,e,i){this.data[i*this.texelSize+t]&=~e,this.dirtyStart=Math.min(this.dirtyStart,i),this.dirtyEnd=Math.max(this.dirtyEnd,i)}getData(t,e){const i=(0,l.Q4)(t);return this.data[i*this.texelSize+e]}setData(t,e,i){const n=(0,l.Q4)(t),r=1<<e;this.layout&r?null!=this.data&&(this.data[n*this.texelSize+e]=i,this.dirtyStart=Math.min(this.dirtyStart,n),this.dirtyEnd=Math.max(this.dirtyEnd,n)):_().error("mapview-attributes-store","Tried to set a value for a texel's readonly component")}expand(t){if(this.size=t,!this.textureOnly){const e=this._initData(this.pixelType,t),i=this.data;e.set(i),this.data=e}}toMessage(){const t=this.dirtyStart,e=this.dirtyEnd,i=this.texelSize;if(t>e)return null;this._resetRange();const n=!this.isLocal,r=this.pixelType,s=this.layout,o=this.data;return{start:t,end:e,data:n&&o.slice(t*i,(e+1)*i)||null,pixelType:r,layout:s}}_initData(t,e){const i=ArrayBuffer,n=(0,c.Qz)(t),r=new n(new i(e*e*4*n.BYTES_PER_ELEMENT));for(let t=0;t<r.length;t+=4)r[t+1]=255;return r}_resetRange(){this.dirtyStart=2147483647,this.dirtyEnd=0}}class v{constructor(t){this._client=t,this._filters=[],this._blocks=new Array,this._attributeComputeInfo=null,this._abortController=new AbortController,this._size=a.TB,this._idsToHighlight=new Map,this._referencesScale=!1,this._referencesGeometry=!1,this._initialized=!1,this.version=0,this._idGenerator=new d,this._epoch=1}destroy(){this._abortController.abort()}_initialize(){if(null!=this._blockDescriptors)return;const t=p.ld.FLOAT;m(`Creating AttributeStore ${g?"with":"without"} shared memory`),this._blockDescriptors=[{pixelType:p.ld.UNSIGNED_BYTE,layout:1},{pixelType:p.ld.UNSIGNED_BYTE,layout:15,textureOnly:!0},{pixelType:p.ld.UNSIGNED_BYTE,layout:15,textureOnly:!0},{pixelType:t,layout:15},{pixelType:t,layout:15},{pixelType:t,layout:15},{pixelType:t,layout:15},{pixelType:p.ld.FLOAT,layout:15}],this._blocks=this._blockDescriptors.map((()=>null))}get referencesScale(){return this._referencesScale}get referencesGeometry(){return this._referencesGeometry}get hasHighlight(){return this._idsToHighlight.size>0}createDisplayIdForObjectId(t){return this._idGenerator.createIdForObjectId(t)}releaseDisplayIdForObjectId(t){return this._idGenerator.releaseIdForObjectId(t)}getDisplayIdForObjectId(t){return this._idGenerator.getDisplayIdForObjectId(t)}incrementDisplayIdGeneration(){this._idGenerator.incrementGeneration()}releaseAllIds(){this._idGenerator.releaseAll()}async update(t,e,i,n,s=0){const a=(0,o.Ui)(this._schema,t);if(this.version=s,a&&((0,r.A)("esri-2d-update-debug")&&console.debug(`Version[${s}] AttributeStore.update`,{changed:a}),this._schema=t,this._attributeComputeInfo=null,this._initialize(),null!=t))if(i&&(this._filters=await Promise.all(t.filters.map((t=>t?f.A.create({geometryType:i.geometryType,hasM:!1,hasZ:!1,timeInfo:i.timeInfo,fieldsIndex:i.fieldsIndex,spatialReference:n??i.spatialReference,filterJSON:t}):null)))),"subtype"!==t.type)this._attributeComputeInfo={isSubtype:!1,map:new Map},await Promise.all(t.bindings.map((async t=>{const i=await this._bind(e,t);this._referencesGeometry=this._referencesGeometry||(i?.referencesGeometry()??!1),this._referencesScale=this._referencesScale||(i?.referencesScale()??!1)})));else{this._attributeComputeInfo={isSubtype:!0,subtypeField:t.subtypeField,map:new Map},this._referencesScale=!1,this._referencesGeometry=!1;for(const i in t.bindings){const n=t.bindings[i];await Promise.all(n.map((async t=>{const n=await this._bind(e,t,parseInt(i,10));this._referencesGeometry=this._referencesGeometry||(n?.referencesGeometry()??!1),this._referencesScale=this._referencesScale||(n?.referencesScale()??!1)})))}}}setHighlight(t,e){const i=this._getBlock(0);i.unsetComponentAllTexels(0,(1<<a.U5)-1);for(const{displayId:e,highlightFlags:n}of t){if(null==e)continue;const t=(0,l.Q4)(e);i.setComponent(0,n,[t])}this._idsToHighlight.clear();for(const{objectId:e,highlightFlags:i}of t)this._idsToHighlight.set(e,i);for(const{objectId:t,highlightFlags:i}of e)this._idsToHighlight.set(t,i)}setData(t,e,i,n){const r=(0,l.Q4)(t);this._ensureSizeForTexel(r),this._getBlock(e).setData(t,i,n)}getData(t,e,i){return this._getBlock(e).getData(t,i)}getHighlightFlags(t){return this._idsToHighlight.get(t)||0}unsetAttributeData(t){const e=(0,l.Q4)(t);this._getBlock(0).setData(e,0,0)}setAttributeData(t,e,i){const n=(0,l.Q4)(t);this._ensureSizeForTexel(n),this._getBlock(0).setData(n,0,this.getFilterFlags(e));const r=this._attributeComputeInfo;let s=null;r&&(s=r.isSubtype?r.map.get(e.readAttribute(r.subtypeField)):r.map,s?.size&&s.forEach(((t,r)=>{const s=1*r%4,o=Math.floor(1*r/4),l=this._getBlock(o+a.dV.VV);let c=t.field?.read(e,i);t.valueRepresentation&&(c=function(t,e){if(!t||!e)return t;switch(e){case"radius":case"distance":return 2*t;case"diameter":case"width":return t;case"area":return Math.sqrt(t)}return t}(c,t.valueRepresentation)),(null===c||isNaN(c)||c===1/0||c===-1/0)&&(c=u.qM),l.setData(n,s,c)})))}get epoch(){return this._epoch}sendUpdates(){const t=this._blocks.map((t=>null!=t?t.toMessage():null)),e=this._getInitArgs();(0,r.A)("esri-2d-log-updating")&&console.log("AttributeStore: _doSendUpdate.start"),this._client.update({initArgs:e,blockData:t,version:this.version,sendUpdateEpoch:this._epoch}),this._epoch+=1,(0,r.A)("esri-2d-log-updating")&&console.log("AttributeStore: _doSendUpdate.end")}_ensureSizeForTexel(t){for(;t>=this._size*this._size;)if(this._expand())return}async _bind(t,e,i){const n=await t.createComputedField(e),{valueRepresentation:r}=e,s=this._attributeComputeInfo;if(s.isSubtype){const t=s.map.get(i)??new Map;t.set(e.binding,{field:n,valueRepresentation:r}),s.map.set(i,t)}else s.map.set(e.binding,{field:n,valueRepresentation:r});return n}_getInitArgs(){return this._initialized?null:(this._initialized=!0,this._getBlock(a.dV.Animation),this._getBlock(a.dV.GPGPU),this._getBlock(a.dV.LocalTimeOrigin),{blockSize:this._size,blockDescriptors:this._blocks.map((t=>null!=t?{textureOnly:t.textureOnly,buffer:t.buffer,pixelType:t.pixelType}:null))})}_getBlock(t){const e=this._blocks[t];if(null!=e)return e;m(`Initializing AttributeBlock at index ${t}`);const i=new y(this._size,this._blockDescriptors[t],this._client.isLocal);return this._blocks[t]=i,this._initialized=!1,i}_expand(){if(this._size<this._schema.capabilities.maxTextureSize){const t=this._size<<=1;m("Expanding block size to",t,this._blocks);for(const e of this._blocks)e?.expand(t);return this._initialized=!1,this._size=t,0}return _().error(new n.A("mapview-limitations","Maximum number of onscreen features exceeded.")),-1}isVisible(t){return!!(this._getBlock(0).getData(t,0)&1<<a.U5)}getFilterFlags(t){let e=0;for(let i=0;i<this._filters.length;i++){const n=!!(1<<i),r=this._filters[i];e|=(!n||null==r||r.check(t)?1:0)<<i}let i=0;if(this._idsToHighlight.size){const e=t.getObjectId();i=this.getHighlightFlags(e)}return e<<a.U5|i}}},67057:function(t,e,i){i.d(e,{l:function(){return M}});var n=i(39819),r=i(40633),s=i(24761),o=i(7459),a=i(7910);class l extends a.L{constructor(t){super(),this._field=t}resize(t){throw new Error("Method not implemented.")}read(t,e){return t.readAttribute(this._field)}readWithDefault(t,e){return t.readAttribute(this._field)}referencesScale(){return!1}referencesGeometry(){return!1}}var c=i(50944),u=i(54547),h=i(89838);class d extends a.L{static async create(t,e){const i=await(0,u.Ad)(t,e.spatialReference,e.fields),n=(0,c.Wm)(t);return new d(i,n)}constructor(t,e){super(),this._compiled=t,this._cacheKey=e}resize(t){}read(t,e){return this.referencesScale()||"system"!==e.$view.timeZone?(0,h.V4)(this._compiled,t,e):this._readCached(t,e)}readWithDefault(t,e,i){return this.referencesScale()||"system"!==e.$view.timeZone?(0,h.OP)(this._compiled,t,e,i):this._readWithDefaultCached(t,e,i)}referencesScale(){return this._compiled?.referencesScale()??!1}referencesGeometry(){return this._compiled?.referencesGeometry()??!1}_readCached(t,e){if(t.setCache(this._cacheKey),t.hasCachedValue())return t.getCachedValue();const i=(0,h.V4)(this._compiled,t,e);return t.setCachedValue(i),i}_readWithDefaultCached(t,e,i){if(t.setCache(this._cacheKey),t.hasCachedValue())return t.getCachedValue();const n=(0,h.OP)(this._compiled,t,e,i);return t.setCachedValue(n),n}}var f=i(8289),p=i(2900),_=i(16645),m=i(53743),g=i(6361);class y extends a.L{static async create(t,e){const i=(0,g.lc)(t);return new y((t=>i.replaceAll(/{[^}]*}/g,(e=>{const i=e.slice(1,-1),n=t.metadata.fieldsIndex.get(i);if(null==n)return e;const r=t.readAttribute(i);return null==r?"":function(t,e){if(null==t)return"";const i=e.domain;if(i)if("codedValue"===i.type||"coded-value"===i.type){const e=t;for(const t of i.codedValues)if(t.code===e)return t.name}else if("range"===i.type){const{max:n,min:r}=(0,_.A5)(e),s=+t;if(null!=r&&null!=n&&r<=s&&s<=n)return i.name}let n=t;return(0,m.vE)(e)?n=(0,f.Yq)(n,(0,f.J2)("short-date")):(0,m.WA)(e)&&(n=(0,p.ZV)(+n)),n||""}(r,n)}))))}constructor(t){super(),this._evaluator=t}resize(t){}read(t,e){return this._evaluator(t)}readWithDefault(t,e,i){const n=this._evaluator(t);return(0,h.rZ)(n)?i:n}referencesScale(){return!1}referencesGeometry(){return!1}}class v extends a.L{constructor(t,e){super(),this._field=t,this._normalizationInfo=e}resize(t){throw new Error("Method not implemented.")}read(t,e){return this._readNormalized(t)}readWithDefault(t,e){return this._readNormalized(t)}referencesScale(){return!1}referencesGeometry(){return!1}_readNormalized(t){const e=t.readAttribute(this._field);if(null==e)return null;const{normalizationField:i,normalizationTotal:n,normalizationType:r}=this._normalizationInfo,s=t.readAttribute(i);switch(r??"esriNormalizeByField"){case"esriNormalizeByField":return s?s?e/s:void 0:null;case"esriNormalizeByLog":return Math.log(e)*Math.LOG10E;case"esriNormalizeByPercentOfTotal":return n?e/n*100:null}}}var x=i(45273),b=i(19886);const S=()=>r.A.getLogger("esri.views.2d.layers.features.support.ComputedAttributeStorage"),w=4294967295;function T(t,e,i){if(!(t.length>e))for(;t.length<=e;)t.push(i)}class M{constructor(t){this._numerics=[],this._strings=[],this._allocatedSize=256,this._bitsets=[],this._instanceIds=[],this._bounds=[],this._dirtyBitset=this.getBitset(this.createBitset()),this.compilationOptions=t}createBitset(){const t=this._bitsets.length;return this._bitsets.push(x.y.create(this._allocatedSize,o.KQ)),t+1}async createComputedField(t,e=!1){if(t.expression)try{if(!this.compilationOptions)throw new Error("InternalError: Compilation options not defined");return e?await y.create(t.expression,this.compilationOptions):await d.create(t.expression,this.compilationOptions)}catch(e){const i=new n.A("featurelayer","Failed to compile arcade expression",{error:e,expression:t.expression});return S().error(i),null}if(t.normalizationType||t.normalizationField)return new v(t.field,t);if(t.field)return new l(t.field);const i=new n.A("featurelayer","Unable to create computed field. No expression or field found",{info:t});return S().error(i),null}async createWhereClause(t){return t?(0,b.$)(t,this.compilationOptions.fields):null}getBitset(t){return this._bitsets[t-1]}getComputedNumeric(t,e){return this.getComputedNumericAtIndex(t&o.KQ,0)}setComputedNumeric(t,e,i){return this.setComputedNumericAtIndex(t&o.KQ,i,0)}getComputedString(t,e){return this.getComputedStringAtIndex(t&o.KQ,0)}setComputedString(t,e,i){return this.setComputedStringAtIndex(t&o.KQ,0,i)}getComputedNumericAtIndex(t,e){const i=t&o.KQ;return this._ensureNumeric(e,i),this._numerics[e][i]}setComputedNumericAtIndex(t,e,i){const n=t&o.KQ;this._ensureNumeric(e,n),this._numerics[e][n]=i}getPackedChunkId(t){const e=t&o.KQ;return this._ensureInstanceId(e),this._instanceIds[e]}setPackedChunkId(t,e){const i=t&o.KQ;this._ensureInstanceId(i),this._instanceIds[i]=e}getComputedStringAtIndex(t,e){const i=t&o.KQ;return this._ensureString(e,i),this._strings[e][i]}setComputedStringAtIndex(t,e,i){const n=t&o.KQ;this._ensureString(e,n),this._strings[e][n]=i}getXMin(t){return this._bounds[4*(t&o.KQ)]}getYMin(t){return this._bounds[4*(t&o.KQ)+1]}getXMax(t){return this._bounds[4*(t&o.KQ)+2]}getYMax(t){return this._bounds[4*(t&o.KQ)+3]}setBounds(t,e,i=!1){const n=t&o.KQ;if(!i&&!this._dirtyBitset.has(t))return this._bounds[4*n]!==w;this._dirtyBitset.unset(t);const r=e.readGeometryWorldSpace();if(T(this._bounds,4*n+4,0),!r||!r.coords.length)return this._bounds[4*n]=w,this._bounds[4*n+1]=w,this._bounds[4*n+2]=w,this._bounds[4*n+3]=w,!1;let s=1/0,a=1/0,l=-1/0,c=-1/0;return r.forEachVertex(((t,e)=>{s=Math.min(s,t),a=Math.min(a,e),l=Math.max(l,t),c=Math.max(c,e)})),this._bounds[4*n]=s,this._bounds[4*n+1]=a,this._bounds[4*n+2]=l,this._bounds[4*n+3]=c,!0}getBounds(t,e){const i=this.getXMin(e),n=this.getYMin(e),r=this.getXMax(e),o=this.getYMax(e);return(0,s.BI)(t,i,n,r,o),i!==w}_ensureNumeric(t,e){this._numerics[t]||(this._numerics[t]=[]),T(this._numerics[t],e,0)}_ensureInstanceId(t){T(this._instanceIds,t,0)}_ensureString(t,e){this._strings[t]||(this._strings[t]=[]),T(this._strings[t],e,null)}}},37069:function(t,e,i){i.d(e,{G:function(){return r}});var n=i(7910);class r extends n.L{constructor(t){super(),this._value=t}resize(t){}read(t,e){return this._value}readWithDefault(t,e,i){return this._value}referencesScale(){return!1}referencesGeometry(){return!1}}},70132:function(t,e,i){i.d(e,{A:function(){return f}});var n=i(39819),r=i(40633),s=i(87416),o=i(35068),a=i(20932),l=i(62512),c=i(20973),u=i(7926),h=i(6578),d=i(19886);class f{constructor(t){this._geometryBounds=(0,s.vt)(),this._idToVisibility=new Map,this._serviceInfo=t}static async create(t){const e=new f(t);return await e.update(t.filterJSON,t.spatialReference),e}get hash(){return this._hash}check(t){return this._applyFilter(t)}clear(){const t=this._resetAllHiddenIds();return this.update(),{show:t,hide:[]}}invalidate(){this._idToVisibility.forEach(((t,e)=>{this._idToVisibility.set(e,0)}))}setKnownIds(t){for(const e of t)this._idToVisibility.set(e,1)}setTrue(t){const e=[],i=[],n=new Set(t);return this._idToVisibility.forEach(((t,r)=>{const s=!!(1&this._idToVisibility.get(r)),o=n.has(r);!s&&o?e.push(r):s&&!o&&i.push(r),this._idToVisibility.set(r,o?3:0)})),{show:e,hide:i}}createQuery(){const{geometry:t,spatialRel:e,where:i,timeExtent:n,objectIds:r}=this;return u.A.fromJSON({geometry:t,spatialRel:e,where:i,timeExtent:n,objectIds:r})}async update(t,e){this._hash=JSON.stringify(t);const i=await(0,a.T2)(t,null,e);await Promise.all([this._setGeometryFilter(i),this._setIdFilter(i),this._setAttributeFilter(i),this._setTimeFilter(i)])}async _setAttributeFilter(t){if(!t?.where)return this._clause=null,void(this.where=null);this._clause=await(0,d.$)(t.where,this._serviceInfo.fieldsIndex),this.where=t.where}_setIdFilter(t){this._idsToShow=t?.objectIds&&new Set(t.objectIds),this._idsToHide=t?.hiddenIds&&new Set(t.hiddenIds),this.objectIds=t?.objectIds}async _setGeometryFilter(t){if(!t?.geometry)return this._spatialQueryOperator=null,this.geometry=null,void(this.spatialRel=null);const e=t.geometry,i=t.spatialRel||"esriSpatialRelIntersects",n=await(0,l.xt)(i,e,this._serviceInfo.geometryType,this._serviceInfo.hasZ,this._serviceInfo.hasM);(0,o.Rg)(this._geometryBounds,e),this._spatialQueryOperator=n,this.geometry=e,this.spatialRel=i}_setTimeFilter(t){if(this.timeExtent=this._timeOperator=null,t?.timeExtent)if(this._serviceInfo.timeInfo)this.timeExtent=t.timeExtent,this._timeOperator=(0,c.I)(this._serviceInfo.timeInfo,t.timeExtent,h.Z.Shared);else{const e=new n.A("feature-layer-view:time-filter-not-available","Unable to apply time filter, as layer doesn't have time metadata.",t.timeExtent);r.A.getLogger("esri.views.2d.layers.features.controllers.FeatureFilter").error(e)}}_applyFilter(t){return this._filterByGeometry(t)&&this._filterById(t)&&this._filterByTime(t)&&this._filterByExpression(t)}_filterByExpression(t){return!this.where||this._clause(t)}_filterById(t){return(!this._idsToHide?.size||!this._idsToHide.has(t.getObjectId()))&&(!this._idsToShow?.size||this._idsToShow.has(t.getObjectId()))}_filterByGeometry(t){if(!this.geometry)return!0;const e=t.readGeometryWorldSpace();return!!e&&this._spatialQueryOperator(e)}_filterByTime(t){return null==this._timeOperator||this._timeOperator(t)}_resetAllHiddenIds(){const t=[];return this._idToVisibility.forEach(((e,i)=>{1&e||(this._idToVisibility.set(i,1),t.push(i))})),t}}},24231:function(t,e,i){i.d(e,{h:function(){return o},i:function(){return s}});var n=i(57165),r=i(7103);class s{static minimal(t,e,i=[]){return new s({geometryType:t,fieldsIndex:new r.A(i).toJSON(),objectIdField:e,subtypes:null,subtypeField:null,types:null,globalIdField:null,spatialReference:null,timeInfo:null,timeReferenceUnknownClient:null,typeIdField:null})}static createFeature(t){return new s(t)}constructor(t){this._options=t,this._fieldsIndex=r.A.fromJSON(t.fieldsIndex),t.spatialReference&&(this._spatialReference=n.A.fromJSON(t.spatialReference)),this._arcadeSchema={fields:this.fieldsIndex.fields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,objectIdField:this.objectIdField,globalIdField:this._options.globalIdField,spatialReference:this._spatialReference,timeInfo:this._options.timeInfo,typeIdField:this._options.typeIdField??void 0,types:this._options.types??void 0,subtypeField:this._options.subtypeField,subtypes:this._options.subtypes??void 0}}get fieldsIndex(){return this._fieldsIndex}get geometryType(){return"esriGeometryMultiPatch"===this._options.geometryType?"esriGeometryPolygon":this._options.geometryType}get serviceGeometryType(){return this._options.geometryType}get subtypeField(){return this._options.subtypeField}get timeInfo(){return this._options.timeInfo}get objectIdField(){return this._options.objectIdField}get globalIdField(){return this._options.globalIdField}get arcadeSchema(){return this._arcadeSchema}get spatialReference(){return this._spatialReference}get timeReferenceUnknownClient(){return this._options.timeReferenceUnknownClient}}class o extends s{static createGraphics(t){return new o({fieldsIndex:(new r.A).toJSON(),objectIdField:"uid",geometryType:null,spatialReference:t,globalIdField:null,subtypeField:null,subtypes:null,timeInfo:null,typeIdField:null,types:null,timeReferenceUnknownClient:null})}}},87036:function(t,e,i){i.d(e,{P:function(){return r}});var n=i(45273);class r{constructor(t){this._valid=n.y.create(t),this._data=new Array(t)}has(t){return this._valid.has(t)}set(t,e){this._valid.set(t),this._data[t]=e}get(t){return this._data[t]}}},63139:function(t,e,i){i.d(e,{Y:function(){return R}}),i(50917);var n=i(9688),r=i(58941),s=i(95929),o=i(42042),a=i(70891),l=i(33134),c=i(24761),u=i(30804),h=i(40302),d=i(58081),f=i(65215),p=i(76613),_=i(21168),m=i(87036),g=i(45273),y=i(74697);const v=(0,r.A)("featurelayer-simplify-thresholds")??[.5,.5,.5,.5],x=v[0],b=v[1],S=v[2],w=v[3],T=(0,r.A)("featurelayer-simplify-payload-size-factors")??[1,2,4],M=T[0],P=T[1],A=T[2],C=(0,r.A)("featurelayer-simplify-mobile-factor")??2,I=(0,r.A)("esri-mobile"),E=4294967295;class R{constructor(t){this.metadata=t,this.type="FeatureSetReader",this._deleted=null,this._joined=[],this._objectIdToIndex=null,this._boundsBuffer=[],this._caches=new Map,this.arcadeDeclaredClass="esri.arcade.Feature",this._contextTimeZone=null}destroy(){}[Symbol.dispose](){this.destroy()}get isEmpty(){return null!=this._deleted&&this._deleted.countSet()===this.getSize()}getAreaSimplificationThreshold(t,e){let i=1;const n=I?C:1;e>4e6?i=A*n:e>1e6?i=P*n:e>5e5?i=M*n:e>1e5&&(i=n);let r=0;return t>4e3?r=w*i:t>2e3?r=S*i:t>100?r=b:t>15&&(r=x),r}getBounds(t){if(function(t,e){if(!(t.length>e))for(;t.length<=e;)t.push(0)}(this._boundsBuffer,4*this.getIndex()+4),this.getBoundsXMin()===E)return!1;if(0===this.getBoundsXMin()){const e=this.readGeometryWorldSpace();if(!e)return this.setBoundsXMin(E),!1;let i=1/0,n=1/0,r=-1/0,s=-1/0;return e.forEachVertex(((t,e)=>{i=Math.min(i,t),n=Math.min(n,e),r=Math.max(r,t),s=Math.max(s,e)})),this.setBoundsXMin(i),this.setBoundsYMin(n),this.setBoundsXMax(r),this.setBoundsYMax(s),(0,c.BI)(t,i,n,r,s),!0}const e=this.getBoundsXMin(),i=this.getBoundsYMin(),n=this.getBoundsXMax(),r=this.getBoundsYMax();return(0,c.BI)(t,e,i,n,r),!0}getBoundsXMin(){return this._boundsBuffer[4*this.getIndex()]}setBoundsXMin(t){this._boundsBuffer[4*this.getIndex()]=t}getBoundsYMin(){return this._boundsBuffer[4*this.getIndex()+1]}setBoundsYMin(t){this._boundsBuffer[4*this.getIndex()+1]=t}getBoundsXMax(){return this._boundsBuffer[4*this.getIndex()+2]}setBoundsXMax(t){this._boundsBuffer[4*this.getIndex()+2]=t}getBoundsYMax(){return this._boundsBuffer[4*this.getIndex()+3]}setBoundsYMax(t){this._boundsBuffer[4*this.getIndex()+3]=t}readAttributeAsTimestamp(t){const e=this.readAttribute(t);return"string"==typeof e?new Date(e).getTime():"number"==typeof e||null==e?e:null}readAttribute(t,e=!1){const i=this._readAttribute(t,e);if(void 0!==i)return i;for(const i of this._joined){i.setIndex(this.getIndex());const n=i._readAttribute(t,e);if(void 0!==n)return n}}readAttributes(){const t=this._readAttributes();for(const e of this._joined){e.setIndex(this.getIndex());const i=e._readAttributes();for(const e of Object.keys(i))t[e]=i[e]}return t}joinAttributes(t){this._joined.push(t)}removeIds(t){if(null==this._objectIdToIndex){const t=new Map,e=this.getCursor();for(;e.next();){const i=e.getObjectId();(0,s.Lw)(i),t.set(i,e.getIndex())}this._objectIdToIndex=t}const e=this._objectIdToIndex;for(const i of t.values())e.has(i)&&this._removeAtIndex(e.get(i))}readOptimizedFeatureWorldSpace(){const t=this.readGeometryWorldSpace(),e=this.readAttributes(),i=this.readCentroidWorldSpace(),n=new f.Om(t,e,i);return n.objectId=this.getObjectId(),n.displayId=this.getDisplayId(),n}readLegacyFeatureForDisplay(){const t=this.readCentroidForDisplay();return{attributes:this.readAttributes(),geometry:this.readLegacyGeometryForDisplay(),centroid:(t&&{x:t.coords[0],y:t.coords[1]})??null}}readLegacyFeatureWorldSpace(){const t=this.readCentroidWorldSpace();return{attributes:this.readAttributes(),geometry:this._readLegacyGeometryWorldSpace(),centroid:(t&&{x:t.coords[0],y:t.coords[1]})??null}}readLegacyGeometryForDisplay(){const t=this.readGeometryForDisplay();return(0,d.zv)(t,this.geometryType,!1,!1)}readXForDisplay(){return this._readX()}readYForDisplay(){return this._readY()}readXWorldSpace(){const t=this._readX(),e=this.getInTransform();return null==e?t:t*e.scale[0]+e.translate[0]}readYWorldSpace(){const t=this._readY(),e=this.getInTransform();return null==e?t:e.translate[1]-t*e.scale[1]}readGeometryForDisplay(){const t=this._readGeometryDeltaDecoded(!0);if(!t){const t=this._createGeometryFromServerCentroid();return t?t.deltaDecode():null}return t}readGeometryWorldSpace(){let t=this._readGeometry();if(t||(t=this._createGeometryFromServerCentroid()),!t)return null;const e=t.clone(),i=this.getInTransform();return null!=i&&(0,d.Ch)(e,e,this.hasZ,this.hasM,i),e}readCentroidForDisplay(){const t=this.readGeometryForDisplay();return t?this._computeDisplayCentroid(t):this._readServerCentroid()}readCentroidWorldSpace(){const t=this.readGeometryForDisplay(),e=t?this._computeDisplayCentroid(t):this._readServerCentroid();if(!e)return null;const i=e.clone(),n=this.getInTransform();return null!=n&&(0,d.Ch)(i,i,this.hasZ,this.hasM,n),i}setCache(t){let e=this._caches.get(t);null==e&&(e=new m.P(this.getSize()),this._caches.set(t,e)),this._activeCache=e}setCachedValue(t){this._activeCache.set(this.getIndex(),t)}hasCachedValue(){return this._activeCache.has(this.getIndex())}getCachedValue(){return this._activeCache.get(this.getIndex())}_readGeometryDeltaDecoded(t){const e=this._readGeometry(t);return"esriGeometryPoint"!==this.geometryType&&e&&this.getInTransform()?e.deltaDecode():e}get contextTimeZone(){return this._contextTimeZone}set contextTimeZone(t){this._contextTimeZone=t}readArcadeFeature(){return this}hasField(t){return this.fields.has(t)||this._joined.some((e=>e.hasField(t)))}geometry(){const t=this.readGeometryWorldSpace(),e=(0,d.zv)(t,this.geometryType,this.hasZ,this.hasM),i=(0,y.rS)(e);if(i){if(!this.metadata.spatialReference)throw new Error("InternalError: Expected spatial reference to be defined");i.spatialReference=this.metadata.spatialReference}return i}autocastArcadeDate(t,e){return e&&e instanceof Date?this.isUnknownDateTimeField(t)?n.lY.unknownDateJSToArcadeDate(e):n.lY.dateJSAndZoneToArcadeDate(e,this.contextTimeZone??_.qU):e}isUnknownDateTimeField(t){return this.metadata.fieldsIndex.getTimeZone(t)===_.L5}field(t){let e=this.fields.get(t);if(e)switch(e.type){case"date-only":case"esriFieldTypeDateOnly":return o.n.fromReader(this.readAttribute(t,!1));case"time-only":case"esriFieldTypeTimeOnly":return a.k.fromReader(this.readAttribute(t,!1));case"esriFieldTypeTimestampOffset":case"timestamp-offset":return n.lY.fromReaderAsTimeStampOffset(this.readAttribute(t,!1));case"date":case"esriFieldTypeDate":return this.autocastArcadeDate(t,this.readAttribute(t,!0));default:return this.readAttribute(t,!1)}for(const i of this._joined)if(i.setIndex(this.getIndex()),e=i.fields.get(t),e)switch(e.type){case"date-only":case"esriFieldTypeDateOnly":return o.n.fromReader(i._readAttribute(t,!1));case"time-only":case"esriFieldTypeTimeOnly":return a.k.fromReader(i._readAttribute(t,!1));case"esriFieldTypeTimestampOffset":case"timestamp-offset":return n.lY.fromReaderAsTimeStampOffset(i._readAttribute(t,!1));case"date":case"esriFieldTypeDate":return this.autocastArcadeDate(t,i._readAttribute(t,!0));default:return this.readAttribute(t,!1)}throw new Error(`Field ${t} does not exist`)}setField(t,e){throw new Error("Unable to update feature attribute values, feature is readonly")}keys(){return this.fields.fields.map((t=>t.name))}castToText(t=!1){if(!t)return JSON.stringify(this.readLegacyFeatureForDisplay());const e=this.readLegacyFeatureForDisplay();if(!e)return JSON.stringify(null);const i={geometry:e.geometry,attributes:{...e.attributes??{}}};for(const t in i.attributes){const e=i.attributes[t];e instanceof Date&&(i.attributes[t]=e.getTime())}return JSON.stringify(i)}gdbVersion(){return null}fullSchema(){return this.metadata.arcadeSchema}castAsJson(t=null){return{attributes:this._readAttributes(),geometry:!0===t?.keepGeometryType?this.geometry():this.geometry()?.toJSON()??null}}castAsJsonAsync(t=null,e=null){return Promise.resolve(this.castAsJson(e))}_getExists(){return null==this._deleted||!this._deleted.has(this.getIndex())}_computeDisplayCentroid(t){if(null==this.getInTransform())return(0,h.Q)(new p.A,t,this.hasM,this.hasZ);const e=l.z.fromOptimized(t,this.geometryType);e.yFactor*=-1;const i=(0,u.d)(e);return i?(i[1]*=-1,new p.A([],i)):null}copyInto(t){t._joined=this._joined,t._deleted=this._deleted,t._objectIdToIndex=this._objectIdToIndex,t._boundsBuffer=this._boundsBuffer,t._activeCache=this._activeCache,t._caches=this._caches,t._contextTimeZone=this._contextTimeZone}_readLegacyGeometryWorldSpace(){const t=this.readGeometryWorldSpace();return(0,d.zv)(t,this.geometryType,!1,!1)}_createGeometryFromServerCentroid(){const t=this._readServerCentroid();if(!t)return null;const[e,i]=t.coords;return this._createQuantizedExtrudedGeometry(e,i)}_createQuantizedExtrudedGeometry(t,e){return"esriGeometryPolyline"===this.geometryType?this._createQuantizedExtrudedLine(t,e):this._createQuantizedExtrudedQuad(t,e)}_createQuantizedExtrudedQuad(t,e){return new p.A([5],[t-1,e,1,-1,1,1,-1,1,-1,-1])}_createQuantizedExtrudedLine(t,e){return new p.A([2],[t-1,e+1,1,-1])}_removeAtIndex(t){null==this._deleted&&(this._deleted=g.y.create(this.getSize())),this._deleted.set(t)}}},45273:function(t,e,i){i.d(e,{y:function(){return n}});class n{static fromBuffer(t,e){return new n(t,e)}static create(t,e=4294967295){const i=new Uint32Array(Math.ceil(t/32));return new n(i,e)}constructor(t,e){this._mask=0,this._buf=t,this._mask=e}_getIndex(t){return Math.floor(t/32)}has(t){const e=this._mask&t;return!!(this._buf[this._getIndex(e)]&1<<e%32)}hasRange(t,e){let i=t,n=e;for(;i%32&&i!==n;){if(this.has(i))return!0;i++}for(;n%32&&i!==n;){if(this.has(i))return!0;n--}if(i===n)return!1;for(let t=i/32;t!==n/32;t++)if(this._buf[t])return!0;return!1}set(t){const e=this._mask&t,i=this._getIndex(e),n=1<<e%32;this._buf[i]|=n}setRange(t,e){let i=t,n=e;for(;i%32&&i!==n;)this.set(i++);for(;n%32&&i!==n;)this.set(n--);if(i!==n)for(let t=i/32;t!==n/32;t++)this._buf[t]=4294967295}unset(t){const e=this._mask&t,i=this._getIndex(e),n=1<<e%32;this._buf[i]&=4294967295^n}resize(t){const e=this._buf,i=new Uint32Array(Math.ceil(t/32));i.set(e),this._buf=i}or(t){for(let e=0;e<this._buf.length;e++)this._buf[e]|=t._buf[e];return this}and(t){for(let e=0;e<this._buf.length;e++)this._buf[e]&=t._buf[e];return this}xor(t){for(let e=0;e<this._buf.length;e++)this._buf[e]^=t._buf[e];return this}ior(t){for(let e=0;e<this._buf.length;e++)this._buf[e]|=~t._buf[e];return this}iand(t){for(let e=0;e<this._buf.length;e++)this._buf[e]&=~t._buf[e];return this}ixor(t){for(let e=0;e<this._buf.length;e++)this._buf[e]^=~t._buf[e];return this}any(){for(let t=0;t<this._buf.length;t++)if(this._buf[t])return!0;return!1}copy(t){for(let e=0;e<this._buf.length;e++)this._buf[e]=t._buf[e];return this}clone(){return new n(this._buf.slice(),this._mask)}clear(){for(let t=0;t<this._buf.length;t++)this._buf[t]=0;return this}forEachSet(t){for(let e=0;e<this._buf.length;e++){let i=this._buf[e],n=32*e;if(i)for(;i;)1&i&&t(n),i>>>=1,n++}}countSet(){let t=0;return this.forEachSet((e=>{t++})),t}}},51008:function(t,e,i){i.d(e,{R:function(){return u},e:function(){return d}});var n=i(39819),r=i(40633),s=i(13520),o=i(2746);const a=8,l=a-2,c=()=>r.A.getLogger("esri.views.2d.layers.features.support.rendererUtils");function u(t){return t.map((t=>function(t){return("size"===t.type||"color"===t.type||"opacity"===t.type)&&null!=t.stops}(t)?function(t){return t.stops=function(t,e){return e.length<=a?e:(c().warn(`Found ${e.length} Visual Variable stops, but MapView only supports ${a}. Displayed stops will be simplified.`),e.length>2*a?function(t,e){const[i,...n]=e,r=n.pop(),o=n[0].value,a=n[n.length-1].value,c=(a-o)/l,u=[];for(let i=o;i<a;i+=c){let r=0;for(;i>=n[r].value;)r++;const o=n[r],a=e[r-1],l=i-a.value,c=o.value===a.value?1:l/(o.value-a.value);if("color"===t){const t=n[r],s=e[r-1],o=t.color.clone();o.r=h(s.color.r,o.r,c),o.g=h(s.color.g,o.g,c),o.b=h(s.color.b,o.b,c),o.a=h(s.color.a,o.a,c),u.push({value:i,color:o,label:t.label})}else if("size"===t){const t=n[r],o=e[r-1],a=(0,s.cr)(t.size),l=h((0,s.cr)(o.size),a,c);u.push({value:i,size:l,label:t.label})}else{const t=n[r],s=h(e[r-1].opacity,t.opacity,c);u.push({value:i,opacity:s,label:t.label})}}return[i,...u,r]}(t,e):function(t){const[e,...i]=t,n=i.pop();for(;i.length>l;){let t=0,e=0;for(let n=1;n<i.length;n++){const r=i[n-1],s=i[n],o=Math.abs(s.value-r.value);o>e&&(e=o,t=n)}i.splice(t,1)}return[e,...i,n]}(e))}(t.type,t.stops??[]),t}(t.clone()):t))}function h(t,e,i){return(1-i)*t+i*e}function d(t){if(!t)return!0;switch(t.type){case"dot-density":break;case"heatmap":if(!function(){const{supportsColorBufferFloat:t,supportsColorBufferFloatBlend:e,supportsColorBufferHalfFloat:i}=(0,o.C)();return t&&e||i}()){const t=(0,o.C)(),e=["supportsColorBufferFloat","supportsColorBufferFloatBlend","supportsColorBufferHalfFloat"].filter((e=>!t[e])).join(", ");return c().errorOnce(new n.A("webgl-missing-extension",`Missing WebGL2 requirements for Heatmap: ${e}`)),!1}}return!0}},19886:function(t,e,i){i.d(e,{$:function(){return l}});var n=i(39819),r=i(40633),s=i(98737);const o=()=>r.A.getLogger("esri.views.2d.layers.features.support.whereUtils"),a={getAttribute:(t,e)=>t.readAttribute(e)};async function l(t,e){try{const i=await(0,s.G)(t,e);if(!i.isStandardized){const t=new n.A("mapview - bad input","Unable to apply filter's definition expression, as expression is not standardized.",i);o().error(t)}return e=>{const n=e.readArcadeFeature();try{return i.testFeature(n,a)}catch(e){return o().warn("mapview-bad-where-clause","Encountered an error when evaluating where clause",t),!0}}}catch(e){return o().warn("mapview-bad-where-clause","Encountered an error when evaluating where clause",t),t=>!0}}},64853:function(t,e,i){i.d(e,{f:function(){return P}});var n=i(95929),r=i(53838),s=i(28230),o=i(92543),a=i(63812),l=i(86329);let c=0;function u(t,e){return new o.c((0,l.U)(c++),t,e)}const h={visualVariableColor:null,visualVariableOpacity:null,visualVariableSizeMinMaxValue:null,visualVariableSizeScaleStops:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null,visualVariableRotation:null,visualVariableSizeOutlineScaleStops:null};class d{constructor(){this.instances={fill:u(a.YS.fill,{uniforms:h,optionalAttributes:{zoomRange:!0}}),marker:u(a.YS.marker,{uniforms:h,optionalAttributes:{zoomRange:!0}}),line:u(a.YS.line,{uniforms:h,optionalAttributes:{zoomRange:!0}}),text:u(a.YS.text,{uniforms:h,optionalAttributes:{zoomRange:!0,referenceSymbol:!1,clipAngle:!1}}),complexFill:u(a.YS.complexFill,{uniforms:h,optionalAttributes:{zoomRange:!0}}),texturedLine:u(a.YS.texturedLine,{uniforms:h,optionalAttributes:{zoomRange:!0}}),animatedMarker:u(a.YS.animatedMarker,{uniforms:h,optionalAttributes:{zoomRange:!0}})},this._instancesById=Object.values(this.instances).reduce(((t,e)=>(t.set(e.instanceId,e),t)),new Map)}getInstance(t){return this._instancesById.get(t)}}var f=i(44705),p=i(25090),_=i(14583),m=i(43274),g=i(65298),y=i(77515),v=i(88413),x=i(86305),b=i(85456),S=i(81438);const w=Math.PI/180;class T extends y.q{constructor(t){super(),this._program=null,this._vao=null,this._vertexBuffer=null,this._indexBuffer=null,this._dvsMat3=(0,p.vt)(),this._localOrigin={x:0,y:0},this._getBounds=t}destroy(){this._vao&&(this._vao.dispose(),this._vao=null,this._vertexBuffer=null,this._indexBuffer=null),this._program=(0,n.WD)(this._program)}doRender(t){const{context:e}=t,i=this._getBounds();if(i.length<1)return;this._createShaderProgram(e),this._updateMatricesAndLocalOrigin(t),this._updateBufferData(e,i),e.setBlendingEnabled(!0),e.setDepthTestEnabled(!1),e.setStencilWriteMask(0),e.setStencilTestEnabled(!1),e.setBlendFunction(b.dn.ONE,b.dn.ONE_MINUS_SRC_ALPHA),e.setColorMask(!0,!0,!0,!0);const n=this._program;e.bindVAO(this._vao),e.useProgram(n),n.setUniformMatrix3fv("u_dvsMat3",this._dvsMat3),e.gl.lineWidth(1),e.drawElements(b.WR.LINES,8*i.length,b.pe.UNSIGNED_INT,0),e.bindVAO()}_createTransforms(){return{displayViewScreenMat3:(0,p.vt)()}}_createShaderProgram(t){this._program||(this._program=t.programCache.acquire("precision highp float;\n        uniform mat3 u_dvsMat3;\n\n        attribute vec2 a_position;\n\n        void main() {\n          mediump vec3 pos = u_dvsMat3 * vec3(a_position, 1.0);\n          gl_Position = vec4(pos.xy, 0.0, 1.0);\n        }","precision mediump float;\n      void main() {\n        gl_FragColor = vec4(0.75, 0.0, 0.0, 0.75);\n      }",M().attributes))}_updateMatricesAndLocalOrigin(t){const{state:e}=t,{displayMat3:i,size:n,resolution:r,pixelRatio:s,rotation:o,viewpoint:a}=e,l=w*o,{x:c,y:u}=a.targetGeometry,h=(0,g.mT)(c,e.spatialReference);this._localOrigin.x=h,this._localOrigin.y=u;const d=s*n[0],p=s*n[1],y=r*d,v=r*p,x=(0,f.D_)(this._dvsMat3);(0,f.lw)(x,x,i),(0,f.Tl)(x,x,(0,_.fA)(d/2,p/2)),(0,f.hs)(x,x,(0,m.fA)(n[0]/y,-p/v,1)),(0,f.e$)(x,x,-l)}_updateBufferData(t,e){const{x:i,y:n}=this._localOrigin,r=8*e.length,s=new Float32Array(r),o=new Uint32Array(8*e.length);let a=0,l=0;for(const t of e)t&&(s[2*a]=t[0]-i,s[2*a+1]=t[1]-n,s[2*a+2]=t[0]-i,s[2*a+3]=t[3]-n,s[2*a+4]=t[2]-i,s[2*a+5]=t[3]-n,s[2*a+6]=t[2]-i,s[2*a+7]=t[1]-n,o[l]=a+0,o[l+1]=a+3,o[l+2]=a+3,o[l+3]=a+2,o[l+4]=a+2,o[l+5]=a+1,o[l+6]=a+1,o[l+7]=a+0,a+=4,l+=8);if(this._vertexBuffer?this._vertexBuffer.setData(s.buffer):this._vertexBuffer=x.g.createVertex(t,b._U.DYNAMIC_DRAW,s.buffer),this._indexBuffer?this._indexBuffer.setData(o):this._indexBuffer=x.g.createIndex(t,b._U.DYNAMIC_DRAW,o),!this._vao){const e=M();this._vao=new S.Z(t,e.attributes,e.bufferLayouts,new Map([["geometry",this._vertexBuffer]]),this._indexBuffer)}}}const M=()=>(0,v.ES)("bounds",{geometry:[{location:0,name:"a_position",count:2,type:b.pe.FLOAT}]});class P extends r.j{constructor(t){super(t),this._instanceStore=new d,this.checkHighlight=()=>!0}destroy(){super.destroy(),this._boundsRenderer=(0,n.pR)(this._boundsRenderer)}get instanceStore(){return this._instanceStore}enableRenderingBounds(t){this._boundsRenderer=new T(t),this.requestRender()}get hasHighlight(){return this.checkHighlight()}onTileData(t,e){t.onMessage(e),this.contains(t)||this.addChild(t),this.requestRender()}_renderChildren(t,e){t.selection=e;for(const e of this.children){if(!e.visible)continue;const i=e.getDisplayList(this._instanceStore,s.ch.STRICT_ORDER);i?.render(t)}}}},17215:function(t,e,i){i.d(e,{A:function(){return o}});var n=i(28230),r=i(64853),s=i(30488);class o extends r.f{renderChildren(t){for(const e of this.children)e.setTransform(t.state);if(super.renderChildren(t),this._updateAttributeView(),this.children.some((t=>t.hasData))){switch(t.drawPhase){case n.S5.MAP:this._renderChildren(t,n.RI.All);break;case n.S5.HIGHLIGHT:this.hasHighlight&&this._renderHighlight(t)}this._boundsRenderer&&this._boundsRenderer.doRender(t)}}_renderHighlight(t){(0,s.lB)(t,!1,(t=>{this._renderChildren(t,n.RI.Highlight)}))}}},56625:function(t,e,i){i.d(e,{A:function(){return J}});var n=i(53804),r=i(83525),s=i(50659),o=i(58941),a=i(88781),l=i(95929),c=i(60539),u=i(28181),h=i(23502),d=(i(40633),i(65953)),f=i(87416),p=i(74697),_=i(7103),m=i(57176),g=i(67895),y=i(74661),v=i(39686),x=i(27657),b=i(80308),S=i(93561),w=i(44327),T=i(81672),M=i(29739),P=i(12564),A=i(67057),C=i(24231),I=i(72228),E=i(58081),R=i(76613),O=i(63139);class F extends O.Y{static from(t,e,i){return new F(t,e,i)}constructor(t,e,i){super(i),this._items=t,this._tile=e,this._index=-1,this._cachedGeometry=null;const n=e.lod;n.wrap&&(this._wrappingInfo={worldSizeX:n.worldSize[0]})}get _current(){return this._items[this._index]}getItem(){return this._current}getZOrder(){return this._current.zOrder}getMeshWriters(){return this._current.symbolResource?.symbolInfo.meshWriters??[]}hasField(t){return null!=this._current.attributes[t]}field(t){return this.readAttribute(t)}get geometryType(){const t=(0,p.$B)(this._current.geometry);return"esriGeometryPoint"===t?"esriGeometryMultipoint":t}getCursor(){return this.copy()}copy(){const t=new F(this._items,this._tile,this.metadata);return this.copyInto(t),t}copyInto(t){super.copyInto(t),t._cachedGeometry=this._cachedGeometry,t._index=this._index}get fields(){throw new Error("Fields reading not supported to graphics.")}get hasFeatures(){return!!this._items.length}get hasNext(){return this._index+1<this._items.length}get exceededTransferLimit(){throw new Error("InternalError: exceededTransferLimit not implemented for graphics.")}get hasZ(){return!1}get hasM(){return!1}getInTransform(){return this._tile.transform}getSize(){return this._items.length}getAttributeHash(){let t="";for(const e in this._current.attributes)t+=this._current.attributes[e];return t}getObjectId(){return this._items[this._index].objectId}getDisplayId(){return this._current.displayId}setDisplayId(t){throw new Error("InternalError: Setting displayId not supported for graphics.")}setIndex(t){this._index=t}getIndex(){return this._index}next(){for(this._cachedGeometry=null;++this._index<this._items.length&&!this._getExists(););return this._index<this._items.length}readGeometryArea(){throw new Error("InternalError: readGeometryArea not supported for graphics.")}_readGeometry(){if(!this._cachedGeometry){let t=(0,E.Ux)(this._current.projectedGeometry,this.hasZ,this.hasM);if("esriGeometryPolyline"===this.geometryType&&(t=(0,E.kz)(new R.A,t,this.hasZ,this.hasM,this.geometryType,this._tile.transform.scale[0])),this._cachedGeometry=(0,E.Nl)(new R.A,t,this.hasZ,this.hasM,this.geometryType,this._tile.transform),!this._cachedGeometry)return null;this._wrapGeometry(this._cachedGeometry)}return this._cachedGeometry}_wrapGeometry(t){if(!this._wrappingInfo)return;const{worldSizeX:e}=this._wrappingInfo;if(t.isPoint)return 1===e?(t.coords.push(v.CQ,0),t.coords.push(2*-v.CQ,0),void t.lengths.push(3)):2===e?(t.coords.push(2*v.CQ,0),t.coords.push(4*-v.CQ,0),void t.lengths.push(3)):void this._wrapVertex(t.coords,0,2,e);if("esriGeometryMultipoint"!==this.geometryType);else{if(1===e){const e=t.coords.slice();e[0]-=512;const i=t.coords.slice();i[0]+=512,t.coords.push(...e,...i);const n=t.lengths[0];return void t.lengths.push(n,n)}this._wrapVertex(t.coords,0,2,e)}}_wrapVertex(t,e,i,n){const r=e*i,s=t[r];s<-v.CQ*(n-2)?t[r]=s+v.CQ*n:s>v.CQ*(n-1)&&(t[r]=s-v.CQ*n)}_readX(){const t=this._readGeometry();return null!=t?t.coords[0]:0}_readY(){const t=this._readGeometry();return null!=t?t.coords[1]:0}_readServerCentroid(){switch(this.geometryType){case"esriGeometryPolygon":{const t=(0,I.l8)(this._current.projectedGeometry),e=new R.A([],t);return(0,E.Nl)(new R.A,e,this.hasZ,this.hasM,this.geometryType,this._tile.transform)}case"esriGeometryPolyline":{const t=this._current.projectedGeometry,e=(0,I.S8)(t.paths,this.hasZ),i=new R.A([],e);return(0,E.Nl)(new R.A,i,this.hasZ,this.hasM,this.geometryType,this._tile.transform)}}return null}_readAttribute(t,e){const i=this._current.attributes[t];if(void 0!==i)return i;const n=t.toLowerCase();for(const t in this._current.attributes)if(t.toLowerCase()===n)return this._current.attributes[t]}_readAttributes(){return this._current.attributes}}var z=i(13520),D=i(78952),L=i(35068),k=i(65298),N=i(57652),B=i(14817),V=i(38441),U=i(80207),G=i(74841),Y=i(96700);class W{static fromGraphic(t,e,i,n){return new W(t.geometry,e,t.attributes,t.visible,t.uid,t.version,i,n)}constructor(t,e,i,n,r,s,o,a){this.geometry=t,this.symbol=e,this.attributes=i,this.visible=n,this.objectId=r,this._version=s,this.zOrder=o,this.displayId=a,this.bounds=(0,f.vt)(),this.prevBounds=(0,f.vt)(),this.size=[0,0,0,0]}get linearCIM(){return this.symbolResource?.symbolInfo.linearCIM}get hasAnimations(){const{linearCIM:t}=this;return!!t&&t.some((t=>"animationParams"in t&&!!t.animationParams))}update(t,e,i){return(this._version!==t.version||this.zOrder!==i||this.symbol!==e)&&(this.prevBounds=this.bounds,this.bounds=(0,f.vt)(),this.zOrder=i,this.geometry=t.geometry,this.attributes=t.attributes,this.symbol=e,this.visible=t.visible,this._version=t.version,this.symbolResource=null,this.projectedGeometry=null,!0)}async projectAndNormalize(t){let e=this.geometry;if(!e||!e.spatialReference||"mesh"===e.type)return;"extent"===e.type&&(e=(0,Y.DF)(e)),await(0,G.Nk)(e.spatialReference,t);const i=(0,U.b3)(e);if(!i)return;const n=(0,G.Cv)(i,e.spatialReference,t);n&&(0,V.uC)(n),this.projectedGeometry=(0,p.ZC)(n)?(0,Y.DF)(n):n}}class H{constructor(t,e,i){this.added=t,this.updated=e,this.removed=i}hasAnyUpdate(){return!!(this.added.length||this.updated.length||this.removed.length)}}const Z=1e-5;function q(t,e){return e.zOrder-t.zOrder}class ${constructor(t,e,i,n,r){this._items=new Map,this._boundsDirty=!1,this._outSpatialReference=t,this._cimResourceManager=e,this._hittestDrawHelper=new B.CK(e),this._tileInfoView=i,this._store=r;const s=i.getClosestInfoForScale(n);this._resolution=this._tileInfoView.getTileResolution(s.level)}destroy(){this._hittestDrawHelper.destroy()}items(){return this._items.values()}getItem(t){return this._items.get(t)}async update(t,e,i){const n=[],r=[],s=[],o=new Set,a=[];let l=0;for(const s of t.items){l++;const t=s.uid,c=this._items.get(t),u=e(s);if(o.add(t),c){c.update(s,u,l)&&(r.push(c),a.push(this._updateItem(c,i)));continue}const h=this._store.createDisplayIdForObjectId(t),d=W.fromGraphic(s,u,l,h);a.push(this._updateItem(d,i)),this._items.set(d.objectId,d),n.push(d)}for(const[t,e]of this._items.entries())o.has(t)||(this._store.releaseDisplayIdForObjectId(t),this._items.delete(t),s.push(e));return await Promise.all(a),this._index=null,new H(n,r,s)}updateLevel(t){this._resolution!==t&&(this._index=null,this._boundsDirty=!0,this._resolution=t)}hitTest(t,e,i,n,r){const s=(0,o.A)("esri-mobile"),a=s?v.fy:v.V3,l=a+(s?0:v._M);t=(0,k.mT)(t,this._tileInfoView.spatialReference);const c=n*window.devicePixelRatio*l,u=(0,f.vt)();u[0]=t-c,u[1]=e-c,u[2]=t+c,u[3]=e+c;const h=n*window.devicePixelRatio*a,d=(0,f.vt)();d[0]=t-h,d[1]=e-h,d[2]=t+h,d[3]=e+h;const p=.5*n*(l+Y.RA),_=this._searchIndex(t-p,e-p,t+p,e+p);if(!_||0===_.length)return[];const m=[],g=(0,f.vt)(),y=(0,f.vt)();for(const t of _){if(!t.visible)continue;const{projectedGeometry:e,symbolResource:i}=t;this._getSymbolBounds(g,i,e,y,r),y[3]=y[2]=y[1]=y[0]=0,(0,f.HY)(g,u)&&m.push(t)}if(0===m.length)return[];const x=this._hittestDrawHelper,b=[];for(const t of m){const{projectedGeometry:e,symbolResource:i}=t;if(!i)continue;const{textInfo:s,symbolInfo:o}=i,a=o.cimSymbol;x.hitTest(d,a.symbol,e,s,r,n)&&b.push(t)}return b.sort(q),b.map((t=>t.objectId))}queryItems(t){return 0===this._items.size?[]:this._searchForItems(t)}clear(){this._items.clear(),this._index=null}async _updateItem(t,e){await t.projectAndNormalize(this._outSpatialReference),await e(t);const{size:i}=t;i[0]=i[1]=i[2]=i[3]=0,this._getSymbolBounds(t.bounds,t.symbolResource,t.projectedGeometry,t.size,0)}_searchIndex(t,e,i,n){return this._boundsDirty&&(this._items.forEach((t=>this._getSymbolBounds(t.bounds,t.symbolResource,t.projectedGeometry,t.size,0))),this._boundsDirty=!1),this._index||(this._index=(0,D.r)(9,(t=>({minX:t.bounds[0],minY:t.bounds[1],maxX:t.bounds[2],maxY:t.bounds[3]}))),this._index.load(Array.from(this._items.values()))),this._index.search({minX:t,minY:e,maxX:i,maxY:n})}_searchForItems(t){const e=this._tileInfoView.spatialReference,i=t.bounds,n=(0,N.Vp)(e);if(n&&e.isWrappable){const[e,r]=n.valid,s=Math.abs(i[2]-r)<Z,o=Math.abs(i[0]-e)<Z;if((!s||!o)&&(s||o)){const n=t.resolution;let o;o=(0,f.vt)(s?[e,i[1],e+n*Y.RA,i[3]]:[r-n*Y.RA,i[1],r,i[3]]);const a=this._searchIndex(i[0],i[1],i[2],i[3]),l=this._searchIndex(o[0],o[1],o[2],o[3]);return[...new Set([...a,...l])]}}return this._searchIndex(i[0],i[1],i[2],i[3])}_getSymbolBounds(t,e,i,n,r){if(!e||!e.symbolInfo.linearCIM||!i)return null;if(t||(t=(0,f.vt)()),(0,L.Rg)(t,i),!n||0===n[0]&&0===n[1]&&0===n[2]&&0===n[3]){const{textInfo:t,symbolInfo:i}=e,s=i.cimSymbol;n||(n=[0,0,0,0]);const o=m.Sc.getSymbolInflateSize(n,s.symbol,this._cimResourceManager,r,t);n[0]=(0,z.Lz)(o[0]),n[1]=(0,z.Lz)(o[1]),n[2]=(0,z.Lz)(o[2]),n[3]=(0,z.Lz)(o[3])}const s=this._resolution,o=m.Sc.safeSize(n);return t[0]-=o*s,t[1]-=o*s,t[2]+=o*s,t[3]+=o*s,t}}var j=i(21884),X=i(60478);class K{static getOrCreate(t,e,i){let n=e.get(t.id);return n||(n=new K(t,i),e.set(t.id,n)),n}static fromItems(t,e,i){const n=new K(t,i);for(const t of e)n.append(t);return n}constructor(t,e){this.tile=t,this.metadata=e,this.addedOrModified=[],this.removed=[],this.objectIdMap=null}get reader(){return this._reader||(this._reader=F.from(this.addedOrModified,this.tile,this.metadata)),this._reader}append(t){this.addedOrModified.push(t),t.hasAnimations&&(this.objectIdMap=this.objectIdMap||{},this.objectIdMap[t.displayId]=t.objectId)}}let Q=class extends((0,a.sA)(r.A)){constructor(t){super(t),this._attached=!1,this._tiles=new Map,this._controller=new AbortController,this._hashToSymbolInfo=new Map,this._lastCleanup=performance.now(),this._cleanupRequired=!0,this.lastUpdateId=-1,this.renderer=null,this._updateTracking=new X.F({debugName:"GraphicsView2D"}),this.updateRequested=!1,this.defaultPointSymbolEnabled=!0,this._commandQueue=new j.A({process:t=>{if("update"===t.type)return this._update();throw new Error("InternalError: Unsupported command")}}),this.graphicUpdateHandler=this.graphicUpdateHandler.bind(this)}destroy(){this.container.destroy(),this.view=null,this.renderer=null,this._set("graphics",null),this._controller.abort(),this._graphicStore.clear(),this._graphicStore.destroy(),this._attributeStore=null,this._hashToSymbolInfo.clear(),this._updateTracking.destroy(),this._commandQueue.destroy()}_initAttributeStore(){this._storage=new A.l({spatialReference:this.view.spatialReference,fields:new _.A}),this._attributeStore=new P.K({isLocal:!0,update:t=>{(0,o.A)("esri-2d-update-debug")&&console.debug(`[Id: ${this.layerId}] GraphicsView2D.AttributeStoreView.updateStart`,{message:t}),this.container.attributeView.requestUpdate(t),this.container.requestRender(),(0,o.A)("esri-2d-update-debug")&&console.debug(`[Id: ${this.layerId}] GraphicsView2D.AttributeStoreView.updateEnd`,{message:t})}});const t=(0,M.T9)(null,[]);this._attributeStore.update(t,this._storage,null),this.container.checkHighlight=()=>this._attributeStore.hasHighlight}initialize(){this._initAttributeStore(),this._metadata=C.h.createGraphics(this.view.spatialReference),this._resourceProxy=new S.J({fetch:t=>Promise.all(t.map((t=>this.view.stage.textureManager.rasterizeItem(t)))),fetchDictionary:t=>{throw new Error("InternalError: Graphics do not support Dictionary requests")}}),this.addHandles([(0,u.watch)((()=>this._effectiveRenderer),(()=>this._pushUpdate())),this.view.graphicsTileStore.on("update",this._onTileUpdate.bind(this)),this.container.on("attach",(()=>{this.addHandles([this.graphics.on("change",(()=>this._pushUpdate()))]),this._graphicStore?.destroy(),this._graphicStore=new $(this.view.spatialReference,this._cimResourceManager,this.view.featuresTilingScheme,this.view.state.scale,this._attributeStore),this._attached=!0,this.requestUpdate(),this._pushUpdate()}))]),this._updateTracking.addUpdateTracking("CommandQueue",this._commandQueue.updateTracking);const t=this.view.graphicsTileStore.tiles;this._onTileUpdate({added:t,removed:[]})}get _effectiveRenderer(){return"function"==typeof this.renderer?this.renderer():this.renderer}get _cimResourceManager(){return this.view.stage.textureManager.resourceManager}get updating(){const t=!this._attached||this._updateTracking.updating;return(0,o.A)("esri-2d-log-updating")&&console.log(`Updating GraphicsView2D: ${t}\n  -> attaching ${!this._attached}\n  -> updateTracking ${this._updateTracking.updating}`),t}hitTest(t){if(!this.view||this.view.suspended)return[];const{resolution:e,rotation:i}=this.view.state,n=this._graphicStore.hitTest(t.x,t.y,2,e,i),r=new Set(n),o=this.graphics.items.reduce(((t,e)=>(r.has(e.uid)&&t.set(e.uid,e),t)),new Map);return n.map((t=>o.get(t))).filter(s.Ru)}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.requestUpdateCallback()),this.notifyChange("updating")}processUpdate(t){this.updateRequested&&(this.updateRequested=!1,this.update(t))}viewChange(){this.requestUpdate()}setHighlight(t){const e=[];for(const{objectId:i,highlightFlags:n}of t){const t=this._graphicStore.getItem(i)?.displayId;e.push({objectId:i,highlightFlags:n,displayId:t})}this._attributeStore.setHighlight(e,t),this._pushUpdate()}graphicUpdateHandler(t){this._pushUpdate()}update(t){this.updateRequested=!1,this._attached&&this._graphicStore.updateLevel(t.state.resolution)}pushUpdate(){this._pushUpdate()}_pushUpdate(){(0,c.QZ)(this._commandQueue.push({type:"update"}))}async _update(){try{(0,o.A)("esri-2d-update-debug")&&console.debug(`[Id: ${this.layerId}] GraphicsView._update start`);const t=await this._graphicStore.update(this.graphics,(t=>this._getSymbolForGraphic(t)),(t=>this._ensureSymbolResource(t)));for(const e of t.updated)this.container.restartAnimation(e.objectId);if(!t.hasAnyUpdate())return void this._attributeStore.sendUpdates();t.removed.length&&(this._cleanupRequired=!0),(0,o.A)("esri-2d-update-debug")&&console.debug(`[Id: ${this.layerId}] GraphicsView updateMessage`,t);const e=this._createTileMessages(t);await this._fetchResources(e),this._write(e);for(const e of t.added)this._setFilterState(e);for(const e of t.updated)this._setFilterState(e);(0,o.A)("esri-2d-update-debug")&&console.debug(`[Id: ${this.layerId}] GraphicsView sendUpdate`,t),this._attributeStore.sendUpdates(),(0,o.A)("esri-2d-update-debug")&&console.debug(`[Id: ${this.layerId}] GraphicsView sendUpdate.await`,t)}catch(t){}this._cleanupSharedResources()}_createTileMessages(t){const e=new Map;for(const i of t.added){const t=this.view.graphicsTileStore.getIntersectingTiles(i.bounds);for(const n of t)K.getOrCreate(n,e,this._metadata).append(i)}for(const i of t.updated){const t=this.view.graphicsTileStore.getIntersectingTiles(i.prevBounds),n=this.view.graphicsTileStore.getIntersectingTiles(i.bounds);for(const n of t)K.getOrCreate(n,e,this._metadata).removed.push(i.displayId);for(const t of n)K.getOrCreate(t,e,this._metadata).append(i)}for(const i of t.removed){const t=this.view.graphicsTileStore.getIntersectingTiles(i.bounds);for(const n of t)K.getOrCreate(n,e,this._metadata).removed.push(i.displayId)}return Array.from(e.values())}async _fetchResources(t){for(const{tile:e,reader:i}of t){(0,o.A)("esri-2d-update-debug")&&console.debug(`Id[${this.layerId}] Tile[${e.id}] GraphicsView fetchResources`,t);const n=i.getCursor();for(;n.next();)for(const t of n.getMeshWriters())t.enqueueRequest(this._resourceProxy,n,e.createArcadeEvaluationOptions(this.view.timeZone))}await this._resourceProxy.fetchEnqueuedResources()}_write(t){for(const e of t){(0,o.A)("esri-2d-update-debug")&&console.debug(`Id[${this.layerId}] Tile[${e.tile.id}] GraphicsView write`,e);const t=this._writeMeshes(e);let i=this._tiles.get(e.tile.key);i||(i=this._createFeatureTile(e.tile.key)),(0,o.A)("esri-2d-update-debug")&&console.debug(`Id[${this.layerId}] Tile[${e.tile.id}] GraphicsView onTileData`,e),this.container.onTileData(i,{type:"update",modify:t,remove:e.removed,end:!1,attributeEpoch:this._attributeStore.epoch,objectIdMap:e.objectIdMap}),this.container.requestRender()}}_writeMeshes(t){const e=new b.U(t.tile.id),i=t.reader.getCursor();for(;i.next();){e.entityStart(i.getDisplayId(),i.getZOrder());for(const n of i.getMeshWriters())n.write(e,this._resourceProxy,i,t.tile.createArcadeEvaluationOptions(this.view.timeZone),t.tile.level);e.entityEnd()}return{...e.serialize().message,tileId:t.tile.id}}_setFilterState(t){const e=t.displayId,i=this._attributeStore.getHighlightFlags(t.objectId);this._attributeStore.setData(e,0,0,i|(t.visible?v.LY:0))}_getSymbolForGraphic(t){return null!=t.symbol?t.symbol:null!=this._effectiveRenderer?this._effectiveRenderer.getSymbol(t):this._getNullSymbol(t)}async _ensureSymbolResource(t){if(!t.symbol)return;const e=await this._getSymbolInfo(t.symbol);if(!e)return;const i=e.linearCIM.filter((t=>"text"===t.type));if(i.length>0){const n=await this._getTextResources(t,i);t.symbolResource={symbolInfo:e,textInfo:n}}else t.symbolResource={symbolInfo:e}}_getSymbolInfo(t){const e=t.hash();return this._hashToSymbolInfo.has(e)||this._hashToSymbolInfo.set(e,this._createSymbolInfo(e,t).catch((t=>null))),this._hashToSymbolInfo.get(e)}async _createSymbolInfo(t,e){const i=await this._convertToCIMSymbol(e),n=await this._createLinearCIM(i);return{hash:t,cimSymbol:i,linearCIM:n,meshWriters:await this._createMeshWriters(i,n)}}async _convertToCIMSymbol(t){const e=(0,m.Vb)(t);return"web-style"===e.type?(await e.fetchCIMSymbol()).data:e}async _createLinearCIM(t){return await Promise.all(m.wp.fetchResources(t.symbol,this._cimResourceManager,[])),this.view.stage.cimAnalyzer.analyzeSymbolReference(t,!1)}async _createMeshWriters(t,e){(0,c.Te)(this._controller.signal);const i=this.container.instanceStore,n=this.view.stage.meshWriterRegistry,r=await async function(t,e,i){const n=[],r={scaleInfo:(0,T.TY)(t),scaleExpression:null};for(const t of e)switch(t.type){case"marker":if(t.animationParams){n.push(...(0,T.gF)(i.instances.animatedMarker,t,w.Dk,r));break}n.push(...(0,T.Zi)(i.instances.marker,t,w.Dk,r));break;case"fill":null==t.spriteRasterizationParam?n.push(...(0,T.Gn)(i.instances.fill,t,r)):n.push(...(0,T.oF)(i.instances.complexFill,t,!1,r));break;case"line":t.spriteRasterizationParam?n.push(...(0,T.EM)(i.instances.texturedLine,t,!1,r)):n.push(...(0,T.NZ)(i.instances.line,t,!1,r));break;case"text":n.push(...(0,T.IQ)(i.instances.text,t,w.Dk,r))}return n}(t,e,i);return Promise.all(r.map((t=>n.createMeshWriter(this._storage,this._resourceProxy,{tileInfo:this.view.featuresTilingScheme.tileInfo},t))))}_onTileUpdate(t){if(t.added&&t.added.length>0)for(const e of t.added)this._updateTracking.addPromise(this._addTile(e));if(t.removed&&t.removed.length>0)for(const e of t.removed)this._removeTile(e.key)}_createFeatureTile(t){const e=this.view.featuresTilingScheme.getTileBounds((0,f.vt)(),t),i=this.view.featuresTilingScheme.getTileResolution(t.level),n=new x.R(t,i,e[0],e[3]);return this._tiles.set(t,n),this.container.addChild(n),n}async _addTile(t){if(!this._attached)return;const e=this._graphicStore.queryItems(t);if(!e.length)return;const i=this._createFeatureTile(t.key),n=K.fromItems(t,e,this._metadata);await this._fetchResources([n]);const r=this._writeMeshes(n);i.onMessage({type:"append",append:r,clear:!1,end:!0,attributeEpoch:this._attributeStore.epoch,objectIdMap:n.objectIdMap})}_removeTile(t){if(!this._tiles.has(t))return;const e=this._tiles.get(t);this.container.removeChild(e),e.destroy(),this._tiles.delete(t)}_getNullSymbol(t){const e=t.geometry;return(0,p.Rg)(e)?y.x3:(0,p.Bi)(e)||(0,p.ZC)(e)?y.JJ:this.defaultPointSymbolEnabled?y.jM:null}async _getTextResources(t,e){const i=new Array,n=new Array;for(let r=0;r<e.length;r++){const s=e[r],{resource:o,overrides:a}=s.textRasterizationParam;if(a?.length>0){const e=g.$.resolveSymbolOverrides({type:"CIMSymbolReference",primitiveOverrides:a,symbol:{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,size:o.symbol.height,anchorPointUnits:"Relative",frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{x:0,y:0},symbol:o.symbol,textString:o.textString}],scaleSymbolsProportionally:!0,respectFrame:!0}]}},t,this.view.spatialReference,null,(0,p.$B)(t.projectedGeometry),null,null);e.then((t=>{const e=t.symbolLayers[0],{textString:i}=e.markerGraphics[0];n.push({type:"cim-rasterization-info",resource:{type:"text",textString:i||"",font:o.font}}),s.text=o.textString=i||""})),i.push(e)}else n.push({type:"cim-rasterization-info",resource:o})}i.length>0&&await Promise.all(i);const r=n.map((t=>this.view.stage.textureManager.rasterizeItem(t))),s=await Promise.all(r);(0,l.Lw)(s);const o=new Map;for(let t=0;t<e.length;t++){const i=e[t];o.set(i.textRasterizationParam.resource.symbol,{text:i.text,glyphMosaicItems:s[t]})}return o}_cleanupSharedResources(){if(!this._cleanupRequired)return;const t=performance.now();if(t-this._lastCleanup<5e3)return;this._cleanupRequired=!1,this._lastCleanup=t;const e=new Set;for(const t of this._graphicStore.items()){const i=t.symbolResource?.symbolInfo.hash;e.add(i)}const i=new Set(this._hashToSymbolInfo.keys());for(const t of i.values())e.has(t)||this._hashToSymbolInfo.delete(t)}};(0,n._)([(0,h.MZ)()],Q.prototype,"_effectiveRenderer",null),(0,n._)([(0,h.MZ)({constructOnly:!0})],Q.prototype,"layerId",void 0),(0,n._)([(0,h.MZ)({constructOnly:!0})],Q.prototype,"requestUpdateCallback",void 0),(0,n._)([(0,h.MZ)()],Q.prototype,"container",void 0),(0,n._)([(0,h.MZ)({constructOnly:!0})],Q.prototype,"graphics",void 0),(0,n._)([(0,h.MZ)()],Q.prototype,"renderer",void 0),(0,n._)([(0,h.MZ)()],Q.prototype,"_updateTracking",void 0),(0,n._)([(0,h.MZ)()],Q.prototype,"updating",null),(0,n._)([(0,h.MZ)()],Q.prototype,"view",void 0),(0,n._)([(0,h.MZ)()],Q.prototype,"updateRequested",void 0),(0,n._)([(0,h.MZ)()],Q.prototype,"defaultPointSymbolEnabled",void 0),Q=(0,n._)([(0,d.$)("esri.views.2d.layers.graphics.GraphicsView2D")],Q);const J=Q},96700:function(t,e,i){i.d(e,{DF:function(){return a},Lu:function(){return c},RA:function(){return o},hV:function(){return l}});var n=i(13520),r=i(44740),s=(i(87416),i(57652),i(39686));const o=50;function a(t){if(!t)return null;const{xmin:e,ymin:i,xmax:n,ymax:s,spatialReference:o}=t;return new r.A({rings:[[[e,i],[e,s],[n,s],[n,i],[e,i]]],spatialReference:o})}function l(t){return(0,n.PN)(Math.round((0,n.Lz)(t)))}function c(t){const e=(0,n.PN)(s.GR),i=(0,n.PN)(s.cp);return Math.max(e,Math.min(t||i,i))}},21884:function(t,e,i){i.d(e,{A:function(){return o}});var n=i(60539),r=i(60478),s=i(46863);class o{constructor(t){this.updateTracking=new r.F({debugName:"FeatureCommandQueue"}),this._queueProcessor=new s.e({concurrency:1,process:t.process})}destroy(){this.updateTracking.destroy(),this._queueProcessor.destroy(),this.clear()}clear(){this._queueProcessor.clear()}async push(t){return(0,n.QZ)(this.updateTracking.addPromise(this._doPush(t)))}async _doPush(t){const e=this._queueProcessor,i=e.last();switch(t.type){case"update":case"highlight":if(i?.type===t.type)return;return e.push(t);case"edit-by-id":case"edit-by-feature":return e.push(t)}}}},60478:function(t,e,i){i.d(e,{F:function(){return h}});var n=i(53804),r=i(83525),s=i(58941),o=i(62790),a=i(28181),l=i(23502),c=(i(40633),i(13798),i(65953)),u=i(20248);let h=class extends r.A{constructor(t){super(t),this.debugName="",this._updatingHandles=new u.U,this._idToUpdatingState=new o.A}get updating(){const t=this._updatingHandles.updating||Array.from(this._idToUpdatingState.values()).some((t=>t));if((0,s.A)("esri-2d-log-updating")){const e=Array.from(this._idToUpdatingState.entries()).map((([t,e])=>`-> ${t}: ${e}`)).join("\n");console.log(`${this.debugName}: Updating: ${t}\n-> Handles: ${this._updatingHandles.updating}\n${e}`)}return t}addUpdateTracking(t,e){const i=(0,a.watch)((()=>e.updating),(e=>this._idToUpdatingState.set(t,e)),{sync:!0});this.addHandles(i)}addPromise(t){return this._updatingHandles.addPromise(t)}};(0,n._)([(0,l.MZ)({constructOnly:!0})],h.prototype,"debugName",void 0),(0,n._)([(0,l.MZ)({readOnly:!0})],h.prototype,"updating",null),h=(0,n._)([(0,c.$)("esri.views.2d.layers.support.UpdateTracking2D")],h)},56988:function(t,e,i){i.r(e),i.d(e,{GraphicContainer:function(){return zi.A},GraphicsView2D:function(){return Fi.A},GridView2D:function(){return sn},LabelManager:function(){return Oi.C},MagnifierView2D:function(){return Hi},MapViewNavigation:function(){return Di.A},Stage:function(){return Ri}});var n=i(39819),r=i(58941),s=i(95929),o=i(74087),a=i(85445),l=i(25090),c=i(75505),u=i(80683),h=i(21609),d=i(40633),f=i(13520),p=i(50944),_=i(3247),m=i(38821),g=i(33389),y=i(44508),v=i(7590),x=i(99121);function b(t,e,i){return{transform:I(t,e,i.transform),fromColor:E(t,e,i.fromColor),toColor:R(t,e,i.toColor),colorMix:O(t,e,i.colorMix),toOpacity:F(t,e,i.toOpacity),opacityMix:z(t,e,i.opacityMix),hasAnimations:i.hasAnimations||!!e.animations&&e.animations.length>0}}function S(t){return!_.H.forceStaticPath&&(_.H.forceAnimatedPath||t.hasAnimations)}function w(t,e){let i=0,n=0;const r="Absolute"!==t.anchorPointUnits;return t.anchorPoint&&(i=-t.anchorPoint.x,n=-t.anchorPoint.y),{...e,transform:{type:"AnimatedTransform",relativeTranslation:r,absoluteScale:!1,translation:B([i,n]),rotation:B(0),scale:B(1),parent:e.transform}}}function T(t,e){return"Absolute"===t.anchorPointUnits?e:w(t,e)}function M(t,e){return"Absolute"!==t.anchorPointUnits?e:w(t,e)}function P(t,e,i){return{...t,transform:{type:"AnimatedTransform",relativeTranslation:!1,absoluteScale:!1,translation:B([e,i]),rotation:B(0),scale:B(1),parent:t.transform}}}function A(t,e){const i=e?.5*-(e.xmin+e.xmax):0,n=e?.5*-(e.ymin+e.ymax):0;let r=0,s=0;if("x"in t&&"y"in t)r=t.x+i,s=t.y+n;else{const e=(0,y.Z7)(t);e&&(r=(e[0]+e[2])/2+i,s=(e[1]+e[3])/2+n)}return[r,s]}function C(t,e){switch(e.type){case"CIMPointSymbol":case"CIMVectorMarker":return[1,1,1,1];case"CIMSolidStroke":case"CIMSolidFill":return(0,v.dI)(t,e,"Color");case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":return(0,v.dI)(t,e,"TintColor")}return[1,1,1,1]}function I(t,e,i){return{type:"AnimatedTransform",relativeTranslation:!1,absoluteScale:!1,translation:k(t,e),rotation:N(t,e),scale:L(t,e),parent:i}}function E(t,e,i){return{type:"AnimatedColor",color:B(C(t,e)),opacity:B(1),parent:i}}function R(t,e,i){const{animations:n}=e;let r=C(t,e);const s=n?.filter((t=>"CIMSymbolAnimationColor"===t.type))[0];return s&&(r=(0,v.dI)(t,s,"ToColor")),{type:"AnimatedColor",color:B(r),opacity:B(1),parent:i}}function O(t,e,i){const{animations:n}=e,r=n?.filter((t=>"CIMSymbolAnimationColor"===t.type))[0];return r?{type:"AnimatedColor",color:B([1,1,1,1]),opacity:{from:0,to:1,timing:D(t,r?.animatedSymbolProperties)},parent:[1,1,1,1]}:i}function F(t,e,i){const{animations:n}=e;let r=B(1);const s=n?.filter((t=>"CIMSymbolAnimationTransparency"===t.type))[0];return s&&(r=B({type:"Process",op:"Transparency",value:(0,v.dI)(t,s,"ToTransparency")})),{type:"AnimatedColor",color:B([1,1,1,1]),opacity:r,parent:i}}function z(t,e,i){const{animations:n}=e,r=n?.filter((t=>"CIMSymbolAnimationTransparency"===t.type))[0];return r?{type:"AnimatedColor",color:B([1,1,1,1]),opacity:{from:0,to:1,timing:D(t,r?.animatedSymbolProperties)},parent:[1,1,1,1]}:i}function D(t,e){if(!e)return{duration:1,startTimeOffset:0,repeatDelay:0,timeOriginSelector:x.mv.Local,repeatType:g.fu.Loop,easing:g.Hz.Linear,playAnimation:1,reverseAnimation:0};const i=(0,v.dI)(t,e,"Duration");let n;n=(0,v.dI)(t,e,"RandomizeStartTime")?{type:"Process",op:"Random",min:0,max:i,seed:(0,v.dI)(t,e,"RandomizeStartSeed")}:(0,v.dI)(t,e,"StartTimeOffset");const r=(0,v.dI)(t,e,"RepeatDelay"),s=(0,v.dI)(t,e,"PlayAnimation"),o=(0,v.dI)(t,e,"ReverseAnimation"),a=(0,v._W)(e.repeatType,m.D.CIMAnimatedSymbolProperties.repeattype);return{duration:i,startTimeOffset:n,repeatDelay:r,timeOriginSelector:a===g.fu.None?x.mv.Local:x.mv.Global,repeatType:a,easing:(0,v._W)(e.easing,m.D.CIMAnimatedSymbolProperties.easing),playAnimation:s,reverseAnimation:o}}function L(t,e){const{animations:i}=e;if("CIMPictureMarker"!==e.type&&"CIMVectorMarker"!==e.type&&"CIMPointSymbol"!==e.type)return B(1);let n;n="CIMPictureMarker"===e.type||"CIMVectorMarker"===e.type?(0,v.dI)(t,e,"Size"):(0,v.YC)(e)||10;const r=i?.filter((t=>"CIMSymbolAnimationScale"===t.type))[0];if(!r){const e=i?.filter((t=>"CIMSymbolAnimationSize"===t.type))[0];return e?{from:1,to:{type:"Process",op:"Divide",left:(0,v.dI)(t,e,"ToSize"),right:n},timing:D(t,e.animatedSymbolProperties)}:B(1)}return{from:1,to:(0,v.dI)(t,r,"ScaleFactor"),timing:D(t,r.animatedSymbolProperties)}}function k(t,e){const{animations:i}=e,n=i?.filter((t=>"CIMSymbolAnimationOffset"===t.type))[0];return n?{from:[0,0],to:[(0,v.dI)(t,n,"OffsetX"),(0,v.dI)(t,n,"OffsetY")],timing:D(t,n.animatedSymbolProperties)}:B([0,0])}function N(t,e){const{animations:i}=e,n=function(t,e){switch(e.type){case"CIMPictureMarker":case"CIMVectorMarker":return(0,v.dI)(t,e,"Rotation")}return 0}(t,e),r=i?.filter((t=>"CIMSymbolAnimationRotation"===t.type))[0];return r?{from:n,to:(0,v.dI)(t,r,"ToRotation"),timing:D(t,r.animatedSymbolProperties)}:B(n)}function B(t){return{from:t,to:t,timing:{duration:1,startTimeOffset:0,repeatDelay:0,timeOriginSelector:x.mv.Local,repeatType:g.fu.Loop,easing:g.Hz.Linear,playAnimation:1,reverseAnimation:0}}}function V(t){if(null==t)return!1;if("object"!=typeof t)return!1;if(t.animations&&Array.isArray(t.animations)&&t.animations.length>0)return!0;for(const e in t)if(V(t[e]))return!0;return!1}var U=i(57176),G=i(67895),Y=i(47072),W=i(39686);function H(t){const e=t.markerPlacement;return e&&e.angleToLine?g.C1.MAP:g.C1.SCREEN}class Z{constructor(t){this._cimLayers=[],this._poMap={},this._primitiveOverrides=[],t&&(this._resourceManager=t)}analyzeSymbolReference(t,e,i){if(this._cimLayers=i??[],!t)return this._cimLayers;if(this._reset(),t.primitiveOverrides){this._primitiveOverrides=t.primitiveOverrides;for(const t of this._primitiveOverrides){const e=t.valueExpressionInfo;if(e)this._setPoMap(t.primitiveName,t.propertyName,e);else if(null!=t.value){let e=t.value;t.propertyName.includes("Color")&&((0,c.IB)(e)&&(e=(0,v.G9)(e)),e=(0,v.e6)(e)),this._setPoMap(t.primitiveName,t.propertyName,e)}}}return this._analyzeSymbol(t.symbol,e),this._cimLayers}_reset(){this._cimLayers=[],this._poMap={},this._primitiveOverrides=[]}_analyzeSymbol(t,e){switch(t?.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":this._analyzeMultiLayerSymbol(t,e)}}_analyzeMultiLayerSymbol(t,e){const i=t?.symbolLayers;if(!i)return;const n=t.effects;let r=g.C1.SCREEN;const s=(0,v.YC)(t)??0;"CIMPointSymbol"===t.type&&"Map"===t.angleAlignment&&(r=g.C1.MAP);let o={transform:[0,0,0,1],fromColor:[1,1,1,1],toColor:[1,1,1,1],colorMix:[0,0,0,0],toOpacity:[1,1,1,1],opacityMix:[0,0,0,0],hasAnimations:V(t)};o=b(this._poMap,t,o);const a="CIMPolygonSymbol"===t.type;let l=i.length;for(;l--;){const c=i[l];if(!c||!1===c.enable)continue;let u;n?.length&&(u=[...n]);const h=c.effects;h?.length&&(n?u.push(...h):u=[...h]);let f=null;if(u){f=[];for(const t of u){const e=G.$.findEffectOverrides(t,this._primitiveOverrides);e&&f.push(e)}}const p=[];switch(G.$.findApplicableOverrides(c,this._primitiveOverrides,p),c.type){case"CIMSolidFill":this._analyzeSolidFill(c,f);break;case"CIMPictureFill":this._analyzePictureFill(c,f);break;case"CIMHatchFill":this._analyzeHatchFill(c,f);break;case"CIMGradientFill":this._analyzeGradientFill(c,f);break;case"CIMSolidStroke":this._analyzeSolidStroke(c,f,a,s);break;case"CIMPictureStroke":this._analyzePictureStroke(c,f,a,s);break;case"CIMGradientStroke":this._analyzeGradientStroke(c,f,a,s);break;case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":{"CIMLineSymbol"!==t.type&&"CIMPolygonSymbol"!==t.type||(r=H(c));const i=[],n=c.primitiveName;n&&i.push(n);const l=a&&(0,v.zr)(c.markerPlacement);this._analyzeMarker(c,f,null,i,r,s,e,[],o,!1,l);break}default:d.A.getLogger("esri.symbols.cim.cimAnalyzer").error("Cannot analyze CIM layer",c.type)}}}_analyzeSolidFill(t,e){const{primitiveName:i,type:n}=t,r=(0,v.e6)(t.color);this._cimLayers.push({type:"fill",spriteRasterizationParam:null,colorLocked:!!t.colorLocked,color:this._getValueOrOverrideExpression(n,i,"Color",r),height:0,angle:0,offsetX:0,offsetY:0,scaleX:1,effects:e,applyRandomOffset:!1,sampleAlphaOnly:!0,hasUnresolvedReplacementColor:!1})}_analyzePictureFill(t,e){const{primitiveName:i,type:n}=t,r=(0,v.Ny)(t),s=(0,v.$w)(t.height,m.D.CIMPictureFill.height);let o=(0,v.$w)(t.scaleX,1);if("width"in t&&"number"==typeof t.width){const e=t.width;let i=1;const n=this._resourceManager.getResource(t.url);null!=n&&(i=n.width/n.height),o/=i*(s/e)}const a={type:"sprite-rasterization-param",resource:t,overrides:this._getPrimitiveMaterialOverrides(i,n)};this._cimLayers.push({type:"fill",spriteRasterizationParam:a,colorLocked:!!t.colorLocked,effects:e,color:this._getValueOrOverrideExpression(n,i,"TintColor",r),height:this._getValueOrOverrideExpression(n,i,"Height",s),scaleX:this._getValueOrOverrideExpression(n,i,"ScaleX",o),angle:this._getValueOrOverrideExpression(n,i,"Rotation",(0,v.$w)(t.rotation)),offsetX:this._getValueOrOverrideExpression(n,i,"OffsetX",(0,v.$w)(t.offsetX)),offsetY:this._getValueOrOverrideExpression(n,i,"OffsetY",(0,v.$w)(t.offsetY)),applyRandomOffset:!1,sampleAlphaOnly:!1,hasUnresolvedReplacementColor:!1})}_analyzeHatchFill(t,e){const{primitiveName:i,type:n}=t,r=this._analyzeMaterialOverrides(i,["Rotation","OffsetX","OffsetY"]),s=(0,v.pk)(r);let o=[255,255,255,1],a=!1;if(t.lineSymbol?.symbolLayers)for(const e of t.lineSymbol.symbolLayers){if("CIMSolidStroke"!==e.type)continue;const t=e.primitiveName??i;a||!t||e.colorLocked||null==this._poMap[t]?.Color&&null==this._poMap[t]?.StrokeColor||(o=(0,v.e6)(e.color),o=this._maybeGetValueOrOverrideExpression(t,"StrokeColor")??this._getValueOrOverrideExpression(n,t,"Color",o),a=!0);const r=this._maybeGetValueOrOverrideExpression(t,"StrokeWidth");if(r){let e=null,i=null;"number"==typeof r?e=r:i=r.valueExpressionInfo;let o=s.find((t=>"strokeWidth"===t.propertyName));o?o.propertyName="width":(o={type:"CIMPrimitiveOverride",primitiveName:t,propertyName:"width",valueExpressionInfo:i,value:e,defaultValue:(0,v.iA)(n,"width")},s.push(o))}}const l={type:"sprite-rasterization-param",resource:t,overrides:s};this._cimLayers.push({type:"fill",spriteRasterizationParam:l,colorLocked:!!t.colorLocked,effects:e,color:o,height:this._getValueOrOverrideExpression(n,i,"Separation",(0,v.$w)(t.separation,m.D.CIMHatchFill.separation)),scaleX:1,angle:this._getValueOrOverrideExpression(n,i,"Rotation",(0,v.$w)(t.rotation)),offsetX:this._getValueOrOverrideExpression(n,i,"OffsetX",(0,v.$w)(t.offsetX)),offsetY:this._getValueOrOverrideExpression(n,i,"OffsetY",(0,v.$w)(t.offsetY)),applyRandomOffset:!1,sampleAlphaOnly:!0,hasUnresolvedReplacementColor:!a})}_analyzeGradientFill(t,e){this._cimLayers.push({type:"fill",spriteRasterizationParam:null,colorLocked:!!t.colorLocked,effects:e,color:[128,128,128,1],height:0,angle:0,offsetX:0,offsetY:0,scaleX:1,applyRandomOffset:!1,sampleAlphaOnly:!1,hasUnresolvedReplacementColor:!1})}_analyzeSolidStroke(t,e,i,n){const{primitiveName:r,type:s}=t,o=(0,v.e6)(t.color),a=(0,v.$w)(t.width,m.D.CIMSolidStroke.width),l=(0,v.GV)(t.capStyle,m.D.CIMSolidStroke.capstyle),c=(0,v.GV)(t.joinStyle,m.D.CIMSolidStroke.joinstyle),u=t.miterLimit;let h,d,f,p,_=[];if(this._analyzePrimitiveOverrides(r,e,null,null)&&(_=this._getPrimitiveMaterialOverrides(r,s)),e&&Array.isArray(e)&&e.length>0){const t=e[e.length-1].effect;t&&"CIMGeometricEffectDashes"===t.type&&"NoConstraint"===t.lineDashEnding&&(h=t.dashTemplate,d=t.scaleDash,f=t.offsetAlongLine,p=t.primitiveName,(e=[...e]).pop())}null!=p&&_.push(...this._getPrimitiveMaterialOverrides(p,s).filter((t=>"dashTemplate"===t.propertyName)));const g=void 0!==h?{type:"sprite-rasterization-param",resource:{type:"dash",dashTemplate:h,primitiveName:p},overrides:_}:null;this._cimLayers.push({type:"line",spriteRasterizationParam:g,isOutline:i,colorLocked:!!t.colorLocked,effects:e,color:this._getValueOrOverrideExpression(s,r,"Color",o),width:this._getValueOrOverrideExpression(s,r,"Width",a),cap:this._getValueOrOverrideExpression(s,r,"CapStyle",l),join:this._getValueOrOverrideExpression(s,r,"JoinStyle",c),miterLimit:u&&this._getValueOrOverrideExpression(s,r,"MiterLimit",u),referenceWidth:n,zOrder:q(t.name),dashTemplate:this._maybeGetValueOrOverrideExpression(p,"DashTemplate")??h,offsetAlongLine:this._getValueOrOverrideExpression(s,p,"OffsetAlongLine",f??0),scaleDash:d,sampleAlphaOnly:!0})}_analyzePictureStroke(t,e,i,n){const{primitiveName:r,type:s}=t,o=(0,v.Ny)(t),a=(0,v.$w)(t.width,m.D.CIMPictureStroke.width),l=(0,v.GV)(t.capStyle,m.D.CIMPictureStroke.capstyle),c=(0,v.GV)(t.joinStyle,m.D.CIMPictureStroke.joinstyle),u=t.miterLimit,h={type:"sprite-rasterization-param",resource:t,overrides:this._getPrimitiveMaterialOverrides(r,s)};this._cimLayers.push({type:"line",spriteRasterizationParam:h,isOutline:i,colorLocked:!!t.colorLocked,effects:e,color:this._getValueOrOverrideExpression(s,r,"TintColor",o),width:this._getValueOrOverrideExpression(s,r,"Width",a),cap:this._getValueOrOverrideExpression(s,r,"CapStyle",l),join:this._getValueOrOverrideExpression(s,r,"JoinStyle",c),miterLimit:u&&this._getValueOrOverrideExpression(s,r,"MiterLimit",u),referenceWidth:n,zOrder:q(t.name),dashTemplate:null,scaleDash:!1,sampleAlphaOnly:!1})}_analyzeGradientStroke(t,e,i,n){const{primitiveName:r,type:s}=t,o=(0,v.$w)(t.width,m.D.CIMSolidStroke.width),a=(0,v.GV)(t.capStyle,m.D.CIMGradientStroke.capstyle),l=(0,v.GV)(t.joinStyle,m.D.CIMGradientStroke.joinstyle),c=t.miterLimit;this._cimLayers.push({type:"line",spriteRasterizationParam:null,isOutline:i,colorLocked:!!t.colorLocked,effects:e,color:[128,128,128,1],width:this._getValueOrOverrideExpression(s,r,"Width",o),cap:this._getValueOrOverrideExpression(s,r,"CapStyle",a),join:this._getValueOrOverrideExpression(s,r,"JoinStyle",l),miterLimit:c&&this._getValueOrOverrideExpression(s,r,"MiterLimit",c),referenceWidth:n,zOrder:q(t.name),dashTemplate:null,scaleDash:!1,sampleAlphaOnly:!1})}_analyzeMarker(t,e,i,n,r,s,o,a,l,c=!1,u=!1){if(c||=!!t.colorLocked,this._analyzeMarkerInsidePolygon(t,e,c))return;const h=(0,v.$w)(t.size,m.D.CIMVectorMarker.size),f=(0,v.$w)(t.rotation),p=(0,v.$w)(t.offsetX),_=(0,v.$w)(t.offsetY),{primitiveName:g,type:y}=t,x=this._getValueOrOverrideExpression(y,g,"Size",h),S=this._getValueOrOverrideExpression(y,g,"Rotation",f),w=this._getValueOrOverrideExpression(y,g,"OffsetX",p),P=this._getValueOrOverrideExpression(y,g,"OffsetY",_);let A=l;switch(A=M(t,A),A=function(t,e,i){if("CIMCharacterMarker"===e.type)return d.A.getLogger("animationUtils").error("#handleMarker()","CIM character markers do not support animations"),i;const n=(0,v.dI)(t,e,"OffsetX"),r=(0,v.dI)(t,e,"OffsetY");if("CIMPictureMarker"===e.type)return{...i,transform:{type:"AnimatedTransform",relativeTranslation:!1,absoluteScale:!0,translation:B([n,r]),rotation:B(0),scale:B((0,v.dI)(t,e,"Size")),parent:i.transform}};const s=e.frame,o=s.ymax-s.ymin;return{...i,transform:{type:"AnimatedTransform",relativeTranslation:!1,absoluteScale:!1,translation:B([n,r]),rotation:B(0),scale:B({type:"Process",op:"Divide",left:(0,v.dI)(t,e,"Size"),right:o}),parent:i.transform}}}(this._poMap,t,A),A=T(t,A),A=b(this._poMap,t,A),t.type){case"CIMPictureMarker":this._analyzePictureMarker(t,e,i,n,r,s,x,S,w,P,a,A,c,u);break;case"CIMVectorMarker":this._analyzeVectorMarker(t,e,i,n,r,s,x,S,w,P,a,A,o,c,u)}}_analyzeMarkerInsidePolygon(t,e,i){const{markerPlacement:n,type:r}=t;if(!n||"CIMMarkerPlacementInsidePolygon"!==n.type)return!1;if("CIMVectorMarker"===r||"CIMPictureMarker"===r){const i=t.primitiveName;if(i&&this._analyzePrimitiveOverrides([i],e,null,null))return!1;const s=n.primitiveName;if(s&&this._analyzePrimitiveOverrides([s],e,null,null))return!1;if("CIMVectorMarker"===r){const{markerGraphics:e}=t;if(e)for(const t of e){const{symbol:e}=t;if("CIMPolygonSymbol"===e?.type&&e.symbolLayers){const{symbolLayers:t}=e;for(const e of t)if("CIMSolidStroke"===e.type)return!1}}}else{const{animatedSymbolProperties:e}=t;if(e)return!1}}const s=Math.abs(n.stepX),o=Math.abs(n.stepY);if(0===s||0===o)return!0;let a,l;if("Random"===n.gridType){const t=(0,f.PN)(W.yv),e=Math.max(Math.floor(t/s),1);a=o*Math.max(Math.floor(t/o),1),l=e*s/a}else n.shiftOddRows?(a=2*o,l=s/o*.5):(a=o,l=s/o);const c=(0,v.Ny)(t),u="CIMCharacterMarker"===t.type?null:{type:"sprite-rasterization-param",resource:t,overrides:[]};return this._cimLayers.push({type:"fill",spriteRasterizationParam:u,colorLocked:i,effects:e,color:c,height:a,scaleX:l,angle:n.gridAngle,offsetX:(0,v.$w)(n.offsetX),offsetY:(0,v.$w)(n.offsetY),applyRandomOffset:"Random"===n.gridType,sampleAlphaOnly:"CIMPictureMarker"!==t.type,hasUnresolvedReplacementColor:!0}),!0}_analyzePictureMarker(t,e,i,n,r,s,o,a,l,c,u,d,f,_){const{animatedSymbolProperties:m,primitiveName:g,type:y}=t;let x=(0,v.$w)(t.scaleX,1);const b=(0,v.Ny)(t);i||(i=this._createMarkerPlacementOverrideExpression(t.markerPlacement));const S=this._createGIFAnimatedSymbolPropertiesOverrideExpression(m),w=t.anchorPoint??{x:0,y:0};if("width"in t&&"number"==typeof t.width){const e=t.width;let i=1;const n=this._resourceManager.getResource(t.url);null!=n&&(i=n.width/n.height),x/=i*((0,v.$w)(t.size)/e)}const T=[...n];let M;t.primitiveName&&T.push(t.primitiveName),m||S?M={type:"animated",url:t.url,urlHash:"H"+(0,p.Wm)(t.url),playAnimation:t.animatedSymbolProperties?.playAnimation,reverseAnimation:t.animatedSymbolProperties?.reverseAnimation,randomizeStartTime:t.animatedSymbolProperties?.randomizeStartTime,randomizeStartSeed:t.animatedSymbolProperties?.randomizeStartSeed,startTimeOffset:t.animatedSymbolProperties?.startTimeOffset,duration:t.animatedSymbolProperties?.duration,repeatType:t.animatedSymbolProperties?.repeatType,repeatDelay:t.animatedSymbolProperties?.repeatDelay}:(M=(0,h.o8)(t),M.markerPlacement=null);const P={type:"sprite-rasterization-param",resource:M,overrides:this._getMaterialOverrides(T,y)};S&&P.overrides.push(...S.overrides);const A=o;this._cimLayers.push({type:"marker",spriteRasterizationParam:P,colorLocked:f,effects:e,scaleSymbolsProportionally:!1,alignment:r,size:o,scaleX:this._getValueOrOverrideExpression(y,g,"ScaleX",x),rotation:a,offsetX:l,offsetY:c,transform:{type:"cim-marker-transform-param",params:u},color:this._getValueOrOverrideExpression(y,g,"TintColor",b),anchorPoint:{x:w.x,y:w.y},isAbsoluteAnchorPoint:"Relative"!==t.anchorPointUnits,outlineColor:[0,0,0,0],outlineWidth:0,frameHeight:0,widthRatio:1,rotateClockwise:!!t.rotateClockwise,referenceSize:s,sizeRatio:1,isOutline:_,markerPlacement:i,animationParams:K(d),baseSize:A})}_analyzeVectorMarker(t,e,i,n,r,s,o,a,l,c,u,h,d,f,p){const _=t.markerGraphics;if(!_)return;const m=t.frame;let g=0;g=m?m.ymax-m.ymin:s;const y=!!t.scaleSymbolsProportionally;if(g){const e={offsetX:l,offsetY:c,rotation:a,size:o,frameHeight:g,rotateClockWise:!!t.rotateClockwise,absoluteAnchorPoint:!1,scaleSymbolsProportionally:y};u=[...u,e]}i||(i=this._createMarkerPlacementOverrideExpression(t.markerPlacement));for(const o of _)if(o){const a=o.symbol;if(!a)continue;const l=o.primitiveName;l&&n.push(l);let c,_=h;if(("CIMPointSymbol"===a.type||"CIMTextSymbol"===a.type)&&m){let e=0,i=0;const n=o.geometry;"x"in n&&"y"in n&&(e+=n.x-.5*(m.xmin+m.xmax),i+=n.y-.5*(m.ymin+m.ymax));const r=t.anchorPoint;let s=!1;r&&("Absolute"===t.anchorPointUnits?(e-=r.x,i-=r.y,s=!0):m&&(e-=(m.xmax-m.xmin)*r.x,i-=(m.ymax-m.ymin)*r.y));const a={offsetX:e,offsetY:i,rotation:0,size:0,frameHeight:0,rotateClockWise:!1,absoluteAnchorPoint:s,scaleSymbolsProportionally:y};c=[...u,a]}const v=o.geometry,[x,S]=A(v,m);switch(0===x&&0===S||(_=P(_,x,S)),"CIMPointSymbol"===a.type&&(_=b(this._poMap,a,_)),a.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":d||j(a)?(_={..._,transform:{type:"AnimatedTransform",relativeTranslation:!1,absoluteScale:!0,translation:B([0,0]),rotation:B(0),scale:B(g),parent:h.transform}},this._analyzeMultiLayerGraphicNonSDF(t,e,i,o,n,r,s,c??u,_,g,f,p)):this._analyzeMultiLayerGraphic(t,e,i,o,n,r,s,c??u,_,g,f,p);break;case"CIMTextSymbol":this._analyzeTextGraphic(e,i,o,n,r,s,c??u,f)}l&&n.pop()}}_analyzeMultiLayerGraphic(t,e,i,n,r,s,o,a,l,c,u,h){const d=n.symbol,f=d.symbolLayers;if(!f)return;let p=f.length;if($(f)&&!S(l))return void this._analyzeCompositeMarkerGraphic(t,e,i,n,f,s,o,a,c,u,h);const _=this._resourceManager.geometryEngine,g=Y.V.applyEffects(d.effects,n.geometry,_);if(g)for(;p--;){const d=f[p];if(!d||!1===d.enable)continue;const x=d.primitiveName;switch(x&&r.push(x),d.type){case"CIMSolidFill":case"CIMSolidStroke":{const r=Y.V.applyEffects(d.effects,g,_),f=(0,y.Z7)(r);if(!f)continue;const p="Relative"!==t.anchorPointUnits,S=(0,v.xo)(d)??0,{frameSizeRatio:w,anchorX:T,anchorY:M,widthRatio:P,sdfPaddingRatio:A}=(0,y.Fj)(f,t.frame,t.size,t.anchorPoint,p,S,t.scaleSymbolsProportionally),C="CIMSolidFill"===d.type,I={type:"sdf",geom:r,sdfPaddingRatio:A,asFill:C},{path:E}=d,R=C?(0,v.e6)((0,v.pM)(d)):null==E?(0,v.e6)((0,v._1)(d)):[0,0,0,0],O=C?[0,0,0,0]:(0,v.e6)((0,v._1)(d));if(!C&&!S)break;const F=n.primitiveName;let z=null;C&&!d.colorLocked&&(z=this._maybeGetValueOrOverrideExpression(F,"FillColor"));let D=null;C||d.colorLocked||(D=this._maybeGetValueOrOverrideExpression(F,"StrokeColor"));const L=z??this._getValueOrOverrideExpression(d.type,x,"Color",R),k=D??this._getValueOrOverrideExpression(d.type,x,"Color",O),N=this._maybeGetValueOrOverrideExpression(F,"StrokeWidth")??this._getValueOrOverrideExpression(d.type,x,"Width",S),B=E?{type:"sprite-rasterization-param",resource:{type:"path",path:E,asFill:C},overrides:[]}:{type:"sprite-rasterization-param",resource:I,overrides:[]},V=b(this._poMap,d,l),U=(0,v.$w)(t.size,m.D.CIMVectorMarker.size),G=this._getValueOrOverrideExpression(t.type,t.primitiveName,"Size",U);this._cimLayers.push({type:"marker",spriteRasterizationParam:B,colorLocked:!!d.colorLocked||!!u,effects:e,scaleSymbolsProportionally:!!t.scaleSymbolsProportionally,alignment:s,anchorPoint:{x:T,y:M},isAbsoluteAnchorPoint:p,size:c,rotation:0,offsetX:0,offsetY:0,scaleX:1,transform:{type:"cim-marker-transform-param",params:a},frameHeight:c,widthRatio:P,rotateClockwise:!1,referenceSize:o,sizeRatio:w,color:L,outlineColor:k,outlineWidth:N,isOutline:h,markerPlacement:i,animationParams:K(V),isStroke:"CIMSolidFill"!==d.type,baseSize:G,...(0,y.xt)(r,A)});break}case"CIMPictureMarker":case"CIMVectorMarker":d.markerPlacement?this._analyzeMultiLayerGraphicNonSDF(t,e,i,n,r,s,o,a,l,c,!!d.colorLocked||!!u,h):this._analyzeMarker(d,e,i,r,s,o,!1,a,l,u,h);break;default:this._analyzeMultiLayerGraphicNonSDF(t,e,i,n,r,s,o,a,l,c,!!d.colorLocked||!!u,h)}x&&r.pop()}}_analyzeTextGraphic(t,e,i,n,r,s,o,a){G.$.findApplicableOverrides(i,this._primitiveOverrides,[]);const l=i.geometry;if(!("x"in l)||!("y"in l))return;const c=i.symbol,h=(0,v.DW)(c),d=(0,v._d)(c.fontStyleName),f=(0,u.af)(c.fontFamilyName);c.font={family:f,decoration:h,...d};const p=(0,v.$w)(c.height,m.D.CIMTextSymbol.height),_=(0,v.$w)(c.angle),g=(0,v.$w)(c.offsetX),y=(0,v.$w)(c.offsetY),{haloSymbol:x}=c,b=(0,v.$w)(c.haloSize,0);let S=[0,0,0,0];if(x?.symbolLayers?.length){const t=x.symbolLayers;for(const e of t)if(e.color){S=this._getValueOrOverrideExpression(c?.haloSymbol?.type??"CIMPolygonSymbol",e.primitiveName,"Color",(0,v.e6)(e.color));break}}const w=i.primitiveName;let T=[0,0,0,1],M=[0,0,0,0],P=0,A=!1;if(c.symbol?.symbolLayers)for(const t of c.symbol.symbolLayers){const e=t.primitiveName;if("CIMSolidStroke"===t.type)M=this._getValueOrOverrideExpression("CIMSolidStroke",e,"Color",(0,v.e6)(t.color)),P=this._getValueOrOverrideExpression("CIMSolidStroke",e,"Width",(0,v.xo)(t)??0);else if("CIMSolidFill"===t.type){const i=(0,v.e6)(t.color);A=A??!!t.colorLocked,T=this._getValueOrOverrideExpression("CIMSolidFill",e??w,"Color",i)}}let C=null,I=null,E=null,R=null,O=null;w&&(C=this._maybeGetValueOrOverrideExpression(w,"TextSize"),I=this._maybeGetValueOrOverrideExpression(w,"TextAngle"),E=this._maybeGetValueOrOverrideExpression(w,"TextOffsetX"),R=this._maybeGetValueOrOverrideExpression(w,"TextOffsetY"),A||(O=this._maybeGetValueOrOverrideExpression(w,"FillColor")));const F=O??T;let z=null,D=null,L=0;if(c.callout&&"CIMBackgroundCallout"===c.callout.type){const t=c.callout;if(t.backgroundSymbol){const e=t.backgroundSymbol.symbolLayers;if(e)for(const t of e)"CIMSolidFill"===t.type?z=(0,v.e6)(t.color):"CIMSolidStroke"===t.type&&(D=(0,v.e6)(t.color),L=(0,v.$w)(t.width,m.D.CIMSolidStroke.width))}}const k=this._getValueOrOverrideExpression(c.type,i.primitiveName,"TextString",i.textString??"");if(null==k)return;const{fontStyleName:N}=c,B=f+(N?"-"+N.toLowerCase():"-regular"),V=this._getMaterialOverrides(n,c.type);V.push(...this._getPrimitiveMaterialOverrides(i.primitiveName,c.type));const U={type:"text-rasterization-param",resource:{type:"text",textString:i.textString??"",font:c.font,symbol:c,primitiveName:i.primitiveName},overrides:V};this._cimLayers.push({type:"text",lineWidth:c.lineWidth,textRasterizationParam:U,colorLocked:!!a||!!A,effects:t,alignment:r,anchorPoint:{x:0,y:0},isAbsoluteAnchorPoint:!1,fontName:B,decoration:h,haloSize:b,haloColor:S,weight:d.weight,style:d.style,size:C??p,angle:I??_,offsetX:E??g,offsetY:R??y,transform:{type:"cim-marker-transform-param",params:o},horizontalAlignment:(0,v.Bu)(c.horizontalAlignment),verticalAlignment:(0,v.Nl)(c.verticalAlignment),text:k,color:F,outlineColor:M,outlineSize:P,backgroundColor:z,borderLineColor:D,borderLineWidth:L,referenceSize:s,sizeRatio:1,markerPlacement:e})}_analyzeMultiLayerGraphicNonSDF(t,e,i,n,r,s,o,a,l,c,u,h){const d=function(t,e){return{type:t.type,enable:!0,name:t.name,colorLocked:t.colorLocked,primitiveName:t.primitiveName,anchorPoint:t.anchorPoint,anchorPointUnits:t.anchorPointUnits,offsetX:0,offsetY:0,rotateClockwise:t.rotateClockwise,rotation:0,size:t.size,billboardMode3D:t.billboardMode3D,depth3D:t.depth3D,frame:t.frame,markerGraphics:[e],scaleSymbolsProportionally:t.scaleSymbolsProportionally,respectFrame:t.respectFrame,clippingPath:t.clippingPath}}(t,n),p=t.primitiveName,_=this._analyzeMaterialOverrides(p,["Rotation","OffsetX","OffsetY"]),g=(0,v.pk)(_),[y,x,b]=U.wp.getTextureAnchor(d,this._resourceManager),S=this._getMaterialOverrides(r,t.type);S.push(...g);const w={type:"sprite-rasterization-param",resource:{...d,avoidSDFRasterization:!0},overrides:S},T=(0,v.$w)(t.size,m.D.CIMVectorMarker.size),M=this._getValueOrOverrideExpression(t.type,p,"Size",T);this._cimLayers.push({type:"marker",spriteRasterizationParam:w,colorLocked:u,effects:e,scaleSymbolsProportionally:!!t.scaleSymbolsProportionally,alignment:s,anchorPoint:{x:y,y:x},isAbsoluteAnchorPoint:!1,size:c,rotation:0,offsetX:0,offsetY:0,transform:{type:"cim-marker-transform-param",params:a},color:[255,255,255,1],outlineColor:[0,0,0,0],outlineWidth:0,scaleX:1,frameHeight:c,widthRatio:1,rotateClockwise:!!t.rotateClockwise,referenceSize:o,sizeRatio:b/(0,f.Lz)(t.size),isOutline:h,markerPlacement:i,animationParams:K(l),baseSize:M})}_createMarkerPlacementOverrideExpression(t){if(!t)return null;const e=[];return G.$.findApplicableOverrides(t,this._primitiveOverrides,e),{type:"cim-marker-placement-param",placement:t,overrides:X(e)}}_createGIFAnimatedSymbolPropertiesOverrideExpression(t){if(!t)return null;const e=[];return G.$.findApplicableOverrides(t,this._primitiveOverrides,e),{type:"cim-gif-animation-params",animation:t,overrides:X(e)}}_analyzeCompositeMarkerGraphic(t,e,i,n,r,s,o,a,l,c,u){const h=n.geometry,d=r[0],f=r[1],p=(0,y.Z7)(h);if(!p)return;const _="Relative"!==t.anchorPointUnits,g=(0,v.$w)(d.width,m.D.CIMSolidStroke.width),{frameSizeRatio:x,anchorX:b,anchorY:S,widthRatio:w,sdfPaddingRatio:T}=(0,y.Fj)(p,t.frame,t.size,t.anchorPoint,_,g,t.scaleSymbolsProportionally),{path:M}=f,P=f.primitiveName,A=d.primitiveName,C=n.primitiveName;let I=null;f.colorLocked||c||(I=this._maybeGetValueOrOverrideExpression(C,"FillColor"));const E=I??this._getValueOrOverrideExpression(f.type,P,"Color",(0,v.e6)(f.color));let R=null;d.colorLocked||c||(R=this._maybeGetValueOrOverrideExpression(C,"StrokeColor"));const O=R??this._getValueOrOverrideExpression(d.type,A,"Color",(0,v.e6)(d.color)),F=this._maybeGetValueOrOverrideExpression(C,"StrokeWidth")??this._getValueOrOverrideExpression(d.type,A,"Width",g),z={type:"sprite-rasterization-param",resource:M?{type:"path",path:M,asFill:!0}:{type:"sdf",geom:h,sdfPaddingRatio:T,asFill:!0},overrides:[]};this._cimLayers.push({type:"marker",spriteRasterizationParam:z,colorLocked:c,effects:e,scaleSymbolsProportionally:!!t.scaleSymbolsProportionally,alignment:s,anchorPoint:{x:b,y:S},isAbsoluteAnchorPoint:_,size:l,rotation:0,offsetX:0,offsetY:0,scaleX:1,transform:{type:"cim-marker-transform-param",params:a},frameHeight:l,widthRatio:w,rotateClockwise:!1,referenceSize:o,sizeRatio:x,color:E,outlineColor:O,outlineWidth:F,isOutline:u,markerPlacement:i})}_setPoMap(t,e,i){let n;this._poMap[t]?n=this._poMap[t]:(n={},this._poMap[t]=n),n[e]=i}_maybeGetValueOrOverrideExpression(t,e,i){return this._getValueOrOverrideExpression("",t,e,i,!1)}_getValueOrOverrideExpression(t,e,i,n,r=!0){if(r&&!(0,v.ZO)(n)&&(n=(0,v.iA)(t,i.toLowerCase())),null==e)return n;const s=this._poMap[e];if(null==s)return n;const o=s[i];return"string"==typeof o||"number"==typeof o||Array.isArray(o)?o:o?{valueExpressionInfo:o,defaultValue:n}:n}_analyzePrimitiveOverrides(t,e,i,n){if(null==t)return!1;"string"==typeof t&&(t=[t]);for(const e of this._primitiveOverrides)if(t.includes(e.primitiveName)&&e.valueExpressionInfo)return!0;if(null!=e)for(const t of e)if(t?.overrides.length>0)return!0;if(null!=i)for(const t of i)if(t?.overrides.length>0)return!0;if(null!=n)for(const t of n)if(t?.overrides.length>0)return!0;return!1}_getMaterialOverrides(t,e){if(!t)return[];const i=[];for(const n of t)i.push(...this._getPrimitiveMaterialOverrides(n,e));return i}_getPrimitiveMaterialOverrides(t,e){if(!t)return[];const i=(0,v.pk)(this._primitiveOverrides.filter((e=>e.primitiveName===t)));return i.forEach((t=>t.defaultValue=(0,v.iA)(e,t.propertyName.toLowerCase()))),i}_analyzeMaterialOverrides(t,e){return this._primitiveOverrides.filter((i=>i.primitiveName!==t||!e.includes(i.propertyName)))}}function q(t){if(t&&0===t.indexOf("Level_")){const e=parseInt(t.slice(6),10);if(!isNaN(e))return e}return 0}const $=t=>t&&2===t.length&&t[0].enable&&t[1].enable&&"CIMSolidStroke"===t[0].type&&"CIMSolidFill"===t[1].type&&null==t[0].path&&null==t[1].path&&!t[0].effects&&!t[1].effects&&!t[0].animations&&!t[1].animations;function j(t){const e=t.symbolLayers;if(!e)return!1;const i=e.find((t=>t.effects?.find((t=>"CIMGeometricEffectDashes"===t.type&&null!=t.dashTemplate)))),n=e.find((t=>t.effects?.find((t=>"CIMGeometricEffectAddControlPoints"===t.type))));return!!i||!!n}function X(t){return(0,h.o8)(t).map((t=>({...t,propertyName:(0,v.YF)(t.propertyName)})))}function K(t){return S(t)?{type:"animation-params",params:t}:null}var Q=i(7965),J=i(48996),tt=i(40212),et=i(61226),it=i(15774),nt=i(67348),rt=i(12978);class st{constructor(t){this.events=new J.A,this._hasMajorPerformanceCaveat=!1,this._lastRenderFrameCounter=0,this._canvas=document.createElement("canvas"),this._canvas.setAttribute("style","width: 100%; height:100%; display:block; willChange:transform");const e={failIfMajorPerformanceCaveat:!0,alpha:!0,antialias:!1,depth:!0,stencil:!0,powerPreference:"high-performance"};t.appendChild(this._canvas);let i=this._canvas.getContext("webgl2",e);i||(i=this._canvas.getContext("webgl2",{...e,failIfMajorPerformanceCaveat:!1}),this._hasMajorPerformanceCaveat=!0),this._gl=i,this._handles=(0,et.vE)([(0,tt.on)(this._canvas,"webglcontextlost",(t=>this.events.emit("webgl-context-lost",t)))])}destroy(){this._canvas.parentNode?.removeChild(this._canvas),this._canvas=null,this._handles.remove(),this._gl=null}get gl(){return this._gl}render(t,e){if(this._hasMajorPerformanceCaveat||(0,r.A)("esri-force-performance-mode")){if(++this._lastRenderFrameCounter>=(0,r.A)("esri-performance-mode-frames-between-render")&&(e(),this._lastRenderViewState=t.state.clone(),this._lastRenderFrameCounter=0),this._lastRenderViewState){const[e,i,n,r,s,o]=this._computeViewTransform(this._lastRenderViewState,t.state);this._canvas.style.transform=`matrix(${e}, ${i}, ${n}, ${r}, ${s}, ${o})`}}else e()}resize(t){const e=this._canvas,i=e.style,{state:{size:n},pixelRatio:r}=t,s=n[0],o=n[1],a=Math.round(s*r),l=Math.round(o*r);e.width===a&&e.height===l||(e.width=a,e.height=l),i.width=s+"px",i.height=o+"px"}_computeViewTransform(t,e){const[i,n]=t.center,[r,s]=e.center,[o,a]=t.toScreen([0,0],r,s),[l,c]=t.toScreen([0,0],i,n),u=l-o,h=c-a,d=t.scale/e.scale,f=e.rotation-t.rotation,p=(0,rt.vt)();return(0,nt.D_)(p),(0,nt.hs)(p,p,[d,d]),(0,nt.e$)(p,p,(0,it.kU)(f)),(0,nt.Tl)(p,p,[u,h]),p}}var ot=i(28230),at=i(80708),lt=i(42111);const ct={background:{"background.frag":"#ifdef PATTERN\nuniform lowp float u_opacity;\nuniform lowp sampler2D u_texture;\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_tileTextureCoord;\n#else\nuniform lowp vec4 u_color;\n#endif\nvoid main() {\n#ifdef PATTERN\nmediump vec2 normalizedTextureCoord = mod(v_tileTextureCoord, 1.0);\nmediump vec2 samplePos = mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color = texture2D(u_texture, samplePos);\ngl_FragColor = u_opacity * color;\n#else\ngl_FragColor = u_color;\n#endif\n}","background.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform mediump float u_coord_range;\nuniform mediump float u_depth;\n#ifdef PATTERN\nuniform mediump mat3 u_pattern_matrix;\nvarying mediump vec2 v_tileTextureCoord;\nuniform mediump vec4 u_tlbr;\nuniform mediump vec2 u_mosaicSize;\nvarying mediump vec4 v_tlbr;\n#endif\nvoid main() {\ngl_Position = vec4((u_dvsMat3 * vec3(u_coord_range * a_pos, 1.0)).xy, u_depth, 1.0);\n#ifdef PATTERN\nv_tileTextureCoord = (u_pattern_matrix * vec3(a_pos, 1.0)).xy;\nv_tlbr             = u_tlbr / u_mosaicSize.xyxy;\n#endif\n}"},circle:{"circle.frag":"precision lowp float;\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\nvoid main()\n{\nmediump float dist = length(v_offset);\nmediump float alpha = smoothstep(0.0, -v_blur, dist - 1.0);\nlowp float color_mix_ratio = v_stroke_width < 0.01 ? 0.0 : smoothstep(-v_blur, 0.0, dist - v_radius / (v_radius + v_stroke_width));\ngl_FragColor = alpha * mix(v_color, v_stroke_color, color_mix_ratio);\n}","circle.vert":"precision mediump float;\nattribute vec2 a_pos;\n#pragma header\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump vec2 u_circleTranslation;\nuniform mediump float u_depth;\nuniform mediump float u_antialiasingWidth;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\nv_stroke_color = stroke_color * stroke_opacity;\nv_stroke_width = stroke_width;\nv_radius = radius;\nv_blur = max(blur, u_antialiasingWidth / (radius + stroke_width));\nmediump vec2 offset = vec2(mod(a_pos, 2.0) * 2.0 - 1.0);\nv_offset = offset;\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos * 0.5, 1.0) + u_displayMat3 * vec3((v_radius + v_stroke_width) * offset + u_circleTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n}"},fill:{"fill.frag":"precision lowp float;\n#ifdef PATTERN\nuniform lowp sampler2D u_texture;\nvarying mediump vec2 v_tileTextureCoord;\nvarying mediump vec4 v_tlbr;\n#endif\nvarying lowp vec4 v_color;\nvec4 mixColors(vec4 color1, vec4 color2) {\nfloat compositeAlpha = color2.a + color1.a * (1.0 - color2.a);\nvec3 compositeColor = color2.rgb + color1.rgb * (1.0 - color2.a);\nreturn vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef PATTERN\nmediump vec2 normalizedTextureCoord = fract(v_tileTextureCoord);\nmediump vec2 samplePos = mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color = texture2D(u_texture, samplePos);\ngl_FragColor = v_color[3] * color;\n#else\ngl_FragColor = v_color;\n#endif\n}","fill.vert":"precision mediump float;\nattribute vec2 a_pos;\n#pragma header\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump float u_depth;\nuniform mediump vec2 u_fillTranslation;\n#ifdef PATTERN\n#include <util/util.glsl>\nuniform mediump vec2 u_mosaicSize;\nuniform mediump float u_patternFactor;\nvarying mediump vec2 v_tileTextureCoord;\nvarying mediump vec4 v_tlbr;\n#endif\nvarying lowp vec4 v_color;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\n#ifdef PATTERN\nfloat patternWidth = nextPOT(tlbr.z - tlbr.x);\nfloat patternHeight = nextPOT(tlbr.w - tlbr.y);\nfloat scaleX = 1.0 / (patternWidth * u_patternFactor);\nfloat scaleY = 1.0 / (patternHeight * u_patternFactor);\nmat3 patterMat = mat3(scaleX, 0.0,    0.0,\n0.0,    -scaleY, 0.0,\n0.0,    0.0,    1.0);\nv_tileTextureCoord = (patterMat * vec3(a_pos, 1.0)).xy;\nv_tlbr             = tlbr / u_mosaicSize.xyxy;\n#endif\nvec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + u_displayMat3 * vec3(u_fillTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n}"},icon:{"icon.frag":"precision mediump float;\nuniform lowp sampler2D u_texture;\n#ifdef SDF\nuniform lowp vec4 u_color;\nuniform lowp vec4 u_outlineColor;\n#endif\nvarying mediump vec2 v_tex;\nvarying lowp float v_opacity;\nvarying mediump vec2 v_size;\nvarying lowp vec4 v_color;\n#ifdef SDF\nvarying mediump flaot v_halo_width;\n#endif\n#include <util/encoding.glsl>\nvec4 mixColors(vec4 color1, vec4 color2) {\nfloat compositeAlpha = color2.a + color1.a * (1.0 - color2.a);\nvec3 compositeColor = color2.rgb + color1.rgb * (1.0 - color2.a);\nreturn vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef SDF\nlowp vec4 fillPixelColor = v_color;\nfloat d = rgba2float(texture2D(u_texture, v_tex)) - 0.5;\nconst float softEdgeRatio = 0.248062016;\nfloat size = max(v_size.x, v_size.y);\nfloat dist = d * softEdgeRatio * size;\nfillPixelColor *= clamp(0.5 - dist, 0.0, 1.0);\nif (v_halo_width > 0.25) {\nlowp vec4 outlinePixelColor = u_outlineColor;\nconst float outlineLimitRatio = (16.0 / 86.0);\nfloat clampedOutlineSize = softEdgeRatio * min(v_halo_width, outlineLimitRatio * max(v_size.x, v_size.y));\noutlinePixelColor *= clamp(0.5 - (abs(dist) - clampedOutlineSize), 0.0, 1.0);\ngl_FragColor = v_opacity * mixColors(fillPixelColor, outlinePixelColor);\n}\nelse {\ngl_FragColor = v_opacity * fillPixelColor;\n}\n#else\nlowp vec4 texColor = texture2D(u_texture, v_tex);\ngl_FragColor = v_opacity * texColor;\n#endif\n}","icon.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texAngleRange;\nattribute vec4 a_levelInfo;\nattribute float a_opacityInfo;\n#pragma header\nvarying lowp vec4 v_color;\n#ifdef SDF\nvarying mediump float v_halo_width;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_iconTranslation;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeDuration;\nvarying mediump vec2 v_tex;\nvarying lowp float v_opacity;\nvarying mediump vec2 v_size;\nconst float C_OFFSET_PRECISION = 1.0 / 8.0;\nconst float C_256_TO_RAD = 3.14159265359 / 128.0;\nconst float C_DEG_TO_RAD = 3.14159265359 / 180.0;\nconst float tileCoordRatio = 1.0 / 8.0;\nuniform highp float u_time;\nvoid main()\n{\n#pragma main\nv_color = color;\nv_opacity = opacity;\n#ifdef SDF\nv_halo_width = halo_width;\n#endif\nfloat modded = mod(a_opacityInfo, 128.0);\nfloat targetOpacity = (a_opacityInfo - modded) / 128.0;\nfloat startOpacity = modded / 127.0;\nfloat interpolatedOpacity = clamp(startOpacity + 2.0 * (targetOpacity - 0.5) * u_time / u_fadeDuration, 0.0, 1.0);\nv_opacity *= interpolatedOpacity;\nmediump float a_angle         = a_levelInfo[1];\nmediump float a_minLevel      = a_levelInfo[2];\nmediump float a_maxLevel      = a_levelInfo[3];\nmediump vec2 a_tex            = a_texAngleRange.xy;\nmediump float delta_z = 0.0;\nmediump float rotated = mod(a_angle + u_mapRotation, 256.0);\ndelta_z += (1.0 - step(u_keepUpright, 0.0)) * step(64.0, rotated) * (1.0 - step(192.0, rotated));\ndelta_z += 1.0 - step(a_minLevel, u_level);\ndelta_z += step(a_maxLevel, u_level);\ndelta_z += step(v_opacity, 0.0);\nvec2 offset = C_OFFSET_PRECISION * a_vertexOffset;\nv_size = abs(offset);\n#ifdef SDF\noffset = (120.0 / 86.0) * offset;\n#endif\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + u_displayViewMat3 * vec3(size * offset, 0.0) + u_displayMat3 * vec3(u_iconTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth + delta_z, 1.0);\nv_tex = a_tex.xy / u_mosaicSize;\n}"},line:{"line.frag":"precision lowp float;\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nvarying mediump float v_lineHalfWidth;\nvarying lowp vec4 v_color;\nvarying mediump float v_blur;\n#if defined (PATTERN) || defined(SDF)\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\nvarying mediump float v_widthRatio;\nuniform sampler2D u_texture;\nuniform mediump float u_antialiasing;\n#endif\n#ifdef SDF\n#include <util/encoding.glsl>\n#endif\nvoid main()\n{\nmediump float fragDist = length(v_normal) * v_lineHalfWidth;\nlowp float alpha = clamp((v_lineHalfWidth - fragDist) / v_blur, 0.0, 1.0);\n#ifdef PATTERN\nmediump float relativeTexX = fract(v_accumulatedDistance / (v_patternSize.x * v_widthRatio));\nmediump float relativeTexY = 0.5 + v_normal.y * v_lineHalfWidth / (v_patternSize.y * v_widthRatio);\nmediump vec2 texCoord = mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\nlowp vec4 color = texture2D(u_texture, texCoord);\ngl_FragColor = alpha * v_color[3] * color;\n#elif defined(SDF)\nmediump float relativeTexX = fract((v_accumulatedDistance * 0.5) / (v_patternSize.x * v_widthRatio));\nmediump float relativeTexY =  0.5 + 0.25 * v_normal.y;\nmediump vec2 texCoord = mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\nmediump float d = rgba2float(texture2D(u_texture, texCoord)) - 0.5;\nfloat dist = d * (v_lineHalfWidth + u_antialiasing / 2.0);\ngl_FragColor = alpha * clamp(0.5 - dist, 0.0, 1.0) * v_color;\n#else\ngl_FragColor = alpha * v_color;\n#endif\n}","line.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec4 a_extrude_offset;\nattribute vec4 a_dir_normal;\nattribute vec2 a_accumulatedDistance;\n#pragma header\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump float u_zoomFactor;\nuniform mediump vec2 u_lineTranslation;\nuniform mediump float u_antialiasing;\nuniform mediump float u_depth;\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nconst float scale = 1.0 / 31.0;\nconst mediump float tileCoordRatio = 8.0;\n#if defined (SDF)\nconst mediump float sdfPatternHalfWidth = 15.5;\n#endif\n#if defined (PATTERN) || defined(SDF)\nuniform mediump vec2 u_mosaicSize;\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\nvarying mediump float v_widthRatio;\n#endif\nvarying lowp vec4 v_color;\nvarying mediump float v_lineHalfWidth;\nvarying mediump float v_blur;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\nv_blur = blur + u_antialiasing;\nv_normal = a_dir_normal.zw * scale;\n#if defined (PATTERN) || defined(SDF)\nv_tlbr          = tlbr / u_mosaicSize.xyxy;\nv_patternSize   = vec2(tlbr.z - tlbr.x, tlbr.y - tlbr.w);\n#if defined (PATTERN)\nv_widthRatio = width / v_patternSize.y;\n#else\nv_widthRatio = width / sdfPatternHalfWidth / 2.0;\n#endif\n#endif\nv_lineHalfWidth = (width + u_antialiasing) * 0.5;\nmediump vec2 dir = a_dir_normal.xy * scale;\nmediump vec2 offset_ = a_extrude_offset.zw * scale * offset;\nmediump vec2 dist = v_lineHalfWidth * scale * a_extrude_offset.xy;\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos + offset_ * tileCoordRatio / u_zoomFactor, 1.0) + u_displayViewMat3 * vec3(dist, 0.0) + u_displayMat3 * vec3(u_lineTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n#if defined (PATTERN) || defined(SDF)\nv_accumulatedDistance = a_accumulatedDistance.x * u_zoomFactor / tileCoordRatio + dot(dir, dist + offset_);\n#endif\n}"},outline:{"outline.frag":"varying lowp vec4 v_color;\nvarying mediump vec2 v_normal;\nvoid main()\n{\nlowp float dist = abs(v_normal.y);\nlowp float alpha = smoothstep(1.0, 0.0, dist);\ngl_FragColor = alpha * v_color;\n}","outline.vert":"attribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_xnormal;\n#pragma header\nvarying lowp vec4 v_color;\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump vec2 u_fillTranslation;\nuniform mediump float u_depth;\nuniform mediump float u_outline_width;\nvarying lowp vec2 v_normal;\nconst float scale = 1.0 / 15.0;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\nv_normal = a_xnormal;\nmediump vec2 dist = u_outline_width * scale * a_offset;\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + u_displayMat3 * vec3(dist + u_fillTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n}"},text:{"text.frag":"uniform lowp sampler2D u_texture;\nvarying lowp vec2 v_tex;\nvarying lowp vec4 v_color;\nvarying mediump float v_edgeWidth;\nvarying mediump float v_edgeDistance;\nvoid main()\n{\nlowp float dist = texture2D(u_texture, v_tex).a;\nmediump float alpha = smoothstep(v_edgeDistance - v_edgeWidth, v_edgeDistance + v_edgeWidth, dist);\ngl_FragColor = alpha * v_color;\n}","text.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texAngleRange;\nattribute vec4 a_levelInfo;\nattribute float a_opacityInfo;\n#pragma header\nvarying lowp vec4 v_color;\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_textTranslation;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeDuration;\nvarying lowp vec2 v_tex;\nconst float offsetPrecision = 1.0 / 8.0;\nconst mediump float edgePos = 0.75;\nuniform mediump float u_antialiasingWidth;\nvarying mediump float v_edgeDistance;\nvarying mediump float v_edgeWidth;\nuniform lowp float u_halo;\nconst float sdfFontScale = 1.0 / 24.0;\nconst float sdfPixel = 3.0;\nuniform highp float u_time;\nvoid main()\n{\n#pragma main\nif (u_halo > 0.5)\n{\nv_color = halo_color * opacity;\nhalo_width *= sdfPixel;\nhalo_blur *= sdfPixel;\n}\nelse\n{\nv_color = color * opacity;\nhalo_width = 0.0;\nhalo_blur = 0.0;\n}\nfloat modded = mod(a_opacityInfo, 128.0);\nfloat targetOpacity = (a_opacityInfo - modded) / 128.0;\nfloat startOpacity = modded / 127.0;\nfloat interpolatedOpacity = clamp(startOpacity + 2.0 * (targetOpacity - 0.5) * u_time / u_fadeDuration, 0.0, 1.0);\nv_color *= interpolatedOpacity;\nmediump float a_angle       = a_levelInfo[1];\nmediump float a_minLevel    = a_levelInfo[2];\nmediump float a_maxLevel    = a_levelInfo[3];\nmediump vec2 a_tex          = a_texAngleRange.xy;\nmediump float a_visMinAngle    = a_texAngleRange.z;\nmediump float a_visMaxAngle    = a_texAngleRange.w;\nmediump float delta_z = 0.0;\nmediump float angle = mod(a_angle + u_mapRotation, 256.0);\nif (a_visMinAngle < a_visMaxAngle)\n{\ndelta_z += (1.0 - step(u_keepUpright, 0.0)) * (step(a_visMaxAngle, angle) + (1.0 - step(a_visMinAngle, angle)));\n}\nelse\n{\ndelta_z += (1.0 - step(u_keepUpright, 0.0)) * (step(a_visMaxAngle, angle) * (1.0 - step(a_visMinAngle, angle)));\n}\ndelta_z += 1.0 - step(a_minLevel, u_level);\ndelta_z += step(a_maxLevel, u_level);\ndelta_z += step(v_color[3], 0.0);\nv_tex = a_tex.xy / u_mosaicSize;\nv_edgeDistance = edgePos - halo_width / size;\nv_edgeWidth = (u_antialiasingWidth + halo_blur) / size;\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + sdfFontScale * u_displayViewMat3 * vec3(offsetPrecision * size * a_vertexOffset, 0.0) + u_displayMat3 * vec3(u_textTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth + delta_z, 1.0);\n}"},util:{"encoding.glsl":"const vec4 rgba2float_factors = vec4(\n255.0 / (256.0),\n255.0 / (256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n);\nfloat rgba2float(vec4 rgba) {\nreturn dot(rgba, rgba2float_factors);\n}","util.glsl":"float nextPOT(in float x) {\nreturn pow(2.0, ceil(log2(abs(x))));\n}"}},ut=new(i(65644).Z)((function(t){let e=ct;return t.split("/").forEach((t=>{e&&(e=e[t])})),e}));function ht(t){return ut.resolveIncludes(t)}var dt=i(72785);const ft=t=>(0,dt.I)({PATTERN:t.pattern}),pt={shaders:t=>({vertexShader:ft(t)+ht("background/background.vert"),fragmentShader:ft(t)+ht("background/background.frag")})},_t={shaders:t=>({vertexShader:ht("circle/circle.vert"),fragmentShader:ht("circle/circle.frag")})},mt=t=>(0,dt.I)({PATTERN:t.pattern}),gt={shaders:t=>({vertexShader:mt(t)+ht("fill/fill.vert"),fragmentShader:mt(t)+ht("fill/fill.frag")})},yt={shaders:t=>({vertexShader:ht("outline/outline.vert"),fragmentShader:ht("outline/outline.frag")})},vt=t=>(0,dt.I)({SDF:t.sdf}),xt={shaders:t=>({vertexShader:vt(t)+ht("icon/icon.vert"),fragmentShader:vt(t)+ht("icon/icon.frag")})},bt=t=>(0,dt.I)({PATTERN:t.pattern,SDF:t.sdf}),St={shaders:t=>({vertexShader:bt(t)+ht("line/line.vert"),fragmentShader:bt(t)+ht("line/line.frag")})},wt={shaders:t=>({vertexShader:ht("text/text.vert"),fragmentShader:ht("text/text.frag")})};class Tt{constructor(){this._programByKey=new Map}dispose(){this._programByKey.forEach((t=>t.dispose())),this._programByKey.clear()}getMaterialProgram(t,e,i){const n=e.key<<3|this._getMaterialOptionsValue(e.type,i);if(this._programByKey.has(n))return this._programByKey.get(n);const r=this._getProgramTemplate(e.type),{shaders:s}=r,{vertexShader:o,fragmentShader:a}=s(i),l=e.getShaderHeader(),c=e.getShaderMain(),u=o.replace("#pragma header",l).replace("#pragma main",c),h=t.programCache.acquire(u,a,e.getAttributeLocations());return this._programByKey.set(n,h),h}_getMaterialOptionsValue(t,e){switch(t){case lt.kh.BACKGROUND:case lt.kh.FILL:return(e.pattern?1:0)<<1;case lt.kh.OUTLINE:return 0;case lt.kh.LINE:{const t=e;return(t.sdf?1:0)<<2|(t.pattern?1:0)<<1}case lt.kh.ICON:return(e.sdf?1:0)<<1;case lt.kh.CIRCLE:case lt.kh.TEXT:default:return 0}}_getProgramTemplate(t){switch(t){case lt.kh.BACKGROUND:return pt;case lt.kh.CIRCLE:return _t;case lt.kh.FILL:return gt;case lt.kh.ICON:return xt;case lt.kh.LINE:return St;case lt.kh.OUTLINE:return yt;case lt.kh.TEXT:return wt;default:return null}}}var Mt=i(94860),Pt=i(52432),At=i(86305),Ct=i(85456),It=i(10904),Et=i(81438);class Rt{constructor(){this._initialized=!1}dispose(){this._program=(0,s.WD)(this._program),this._vertexArrayObject=(0,s.WD)(this._vertexArrayObject)}render(t,e,i,n){t&&(this._initialized||this._initialize(t),t.setBlendFunctionSeparate(Ct.dn.ONE,Ct.dn.ONE_MINUS_SRC_ALPHA,Ct.dn.ONE,Ct.dn.ONE_MINUS_SRC_ALPHA),t.bindVAO(this._vertexArrayObject),t.useProgram(this._program),e.setSamplingMode(i),t.bindTexture(e,0),this._program.setUniform1i("u_tex",0),this._program.setUniform1f("u_opacity",n),t.drawArrays(Ct.WR.TRIANGLE_STRIP,0,4),t.bindTexture(null,0),t.bindVAO())}_initialize(t){if(this._initialized)return!0;const e=(0,It.r)(t,Pt.J);if(!e)return!1;const i=new Int8Array(16);i[0]=-1,i[1]=-1,i[2]=0,i[3]=0,i[4]=1,i[5]=-1,i[6]=1,i[7]=0,i[8]=-1,i[9]=1,i[10]=0,i[11]=1,i[12]=1,i[13]=1,i[14]=1,i[15]=1;const n=Pt.J.attributes,r=new Et.Z(t,n,Mt.oI,new Map([["geometry",At.g.createVertex(t,Ct._U.STATIC_DRAW,i)]]));return this._program=e,this._vertexArrayObject=r,this._initialized=!0,!0}}var Ot=i(50437);class Ft{constructor(t){this._rctx=t,this._programByKey=new Map}dispose(){this._programByKey.forEach((t=>t.dispose())),this._programByKey.clear()}getProgram(t,e=[]){const i=t.vsPath+"."+t.fsPath+JSON.stringify(e);if(this._programByKey.has(i))return this._programByKey.get(i);const n={...e.map((t=>"string"==typeof t?{name:t,value:!0}:t)).reduce(((t,e)=>({...t,[e.name]:e.value})),{})},{vsPath:r,fsPath:s,attributes:o}=t,a=(0,Ot.p)(r,s,o,n),l=this._rctx.programCache.acquire(a.shaders.vertexShader,a.shaders.fragmentShader,a.attributes);if(!l)throw new Error("Unable to get program for key: ${key}");return this._programByKey.set(i,l),l}}var zt=i(25591),Dt=i(93040),Lt=i(90152),kt=i(60539),Nt=i(66981),Bt=i(84728),Vt=i(82497);class Ut{constructor(t){this._resourceManager=t,this._cachedRasterizationCanvas=null}dispose(){this._cachedRasterizationCanvas=null}get _canvas(){return this._cachedRasterizationCanvas||(this._cachedRasterizationCanvas=document.createElement("canvas")),this._cachedRasterizationCanvas}rasterizeJSONResource(t){switch(t.type){case"dash":{const e=(0,v.K3)(t.dashTemplate),[i,n,r]=(0,Bt.f0)(e);return{size:[n,r],image:new Uint32Array(i.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}}case"fill-style":{const[e,i,n,r]=(0,Bt.c5)(this._canvas,t,W.nW);return{size:[i,n],image:new Uint32Array(e.buffer),sdf:!1,simplePattern:!0,anchorX:0,anchorY:0,rasterizationScale:r}}case"sdf":return Gt(t);case"CIMHatchFill":case"CIMVectorMarker":case"CIMPictureMarker":return this._rasterizeCIMJSONResource(t)}}_rasterizeCIMJSONResource(t){switch(t.type){case"CIMHatchFill":{const e=U.wp.fromCIMHatchFill(t,W.nW);return this._rasterizeCIMVectorMarker(e)}case"CIMPictureMarker":{const e=U.wp.fromCIMInsidePolygon(t);return this._rasterizeCIMVectorMarker(e)}case"CIMVectorMarker":{if("CIMMarkerPlacementInsidePolygon"===t.markerPlacement?.type){const e=U.wp.fromCIMInsidePolygon(t);return this._rasterizeCIMVectorMarker(e)}const e=(0,y.eR)(t);return e&&!t.avoidSDFRasterization?Gt(e):this._rasterizeCIMVectorMarker(t,!1,W.oj)}}}_rasterizeCIMVectorMarker(t,e=!0,i){const n=e?Vt.A.fromExtent(t.frame):null,[r,s,o,a,l]=U.wp.rasterize(this._canvas,t,n,this._resourceManager,!0,i);return r?{size:[s,o],image:new Uint32Array(r.buffer),sdf:!1,simplePattern:!1,anchorX:a,anchorY:l}:null}rasterizeImageResource(t,e,i,n){this._canvas.width=t,this._canvas.height=e;const r=this._canvas.getContext("2d",{willReadFrequently:!0});i instanceof ImageData?r.putImageData(i,0,0):(i.setAttribute("width",`${t}px`),i.setAttribute("height",`${e}px`),r.drawImage(i,0,0,t,e));const s=r.getImageData(0,0,t,e),o=new Uint8Array(s.data);if(n)for(const t of n)if(t&&t.oldColor&&4===t.oldColor.length&&t.newColor&&4===t.newColor.length){const[e,i,n,r]=t.oldColor,[s,a,l,c]=t.newColor;if(e===s&&i===a&&n===l&&r===c)continue;for(let t=0;t<o.length;t+=4)e===o[t]&&i===o[t+1]&&n===o[t+2]&&r===o[t+3]&&(o[t]=s,o[t+1]=a,o[t+2]=l,o[t+3]=c)}let a;for(let t=0;t<o.length;t+=4)a=o[t+3]/255,o[t]=o[t]*a,o[t+1]=o[t+1]*a,o[t+2]=o[t+2]*a;let l=o,c=t,u=e;const h=512;if(c>=h||u>=h){const i=c/u;i>1?(c=h,u=Math.round(h/i)):(u=h,c=Math.round(h*i)),l=new Uint8Array(4*c*u);const n=new Uint8ClampedArray(l.buffer);(0,v.Go)(o,t,e,n,c,u,!1)}return{size:[c,u],image:new Uint32Array(l.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}}}function Gt(t){if(!t)return null;const{data:e,width:i,height:n,sdfPaddingRatio:r,sdfDecodeCoeff:s}=(0,y.ce)(t);return e?{size:[i,n],image:new Uint32Array(e.buffer),sdf:!0,simplePattern:!0,sdfPaddingRatio:r,sdfDecodeCoeff:s,anchorX:0,anchorY:0}:null}var Yt=i(54904);class Wt{constructor(t,e){this._width=0,this._height=0,this._free=[],this._width=t,this._height=e,this._free.push(new Yt.A(0,0,t,e))}get width(){return this._width}get height(){return this._height}allocate(t,e){if(t>this._width||e>this._height)return new Yt.A;let i=null,n=-1;for(let r=0;r<this._free.length;++r){const s=this._free[r];t<=s.width&&e<=s.height&&(null===i||s.y<=i.y&&s.x<=i.x)&&(i=s,n=r)}return null===i?new Yt.A:(this._free.splice(n,1),i.width<i.height?(i.width>t&&this._free.push(new Yt.A(i.x+t,i.y,i.width-t,e)),i.height>e&&this._free.push(new Yt.A(i.x,i.y+e,i.width,i.height-e))):(i.width>t&&this._free.push(new Yt.A(i.x+t,i.y,i.width-t,i.height)),i.height>e&&this._free.push(new Yt.A(i.x,i.y+e,t,i.height-e))),new Yt.A(i.x,i.y,t,e))}release(t){for(let e=0;e<this._free.length;++e){const i=this._free[e];if(i.y===t.y&&i.height===t.height&&i.x+i.width===t.x)i.width+=t.width;else if(i.x===t.x&&i.width===t.width&&i.y+i.height===t.y)i.height+=t.height;else if(t.y===i.y&&t.height===i.height&&t.x+t.width===i.x)i.x=t.x,i.width+=t.width;else{if(t.x!==i.x||t.width!==i.width||t.y+t.height!==i.y)continue;i.y=t.y,i.height+=t.height}this._free.splice(e,1),this.release(t)}this._free.push(t)}}var Ht=i(12285),Zt=i(10956);const qt=t=>Math.floor(t/256);class $t{constructor(t,e,i){this.width=0,this.height=0,this._dirties=[],this._glyphData=[],this._currentPage=0,this._glyphCache={},this._textures=[],this._rangePromises=new Map,this._preloadCache={},this.width=t,this.height=e,this._glyphSource=i,this._binPack=new Wt(t-4,e-4),this._glyphData.push(new Uint8Array(t*e)),this._dirties.push(!0),this._textures.push(null),this._initDecorationGlyphs()}dispose(){this._binPack=null;for(const t of this._textures)t&&t.dispose();this._textures.length=0,this._glyphData.length=0}_initDecorationGlyphs(){const t=[117,149,181,207,207,181,149,117],e=[],i=[];for(let n=0;n<t.length;n++){const r=t[n];for(let t=0;t<11;t++){const s=n>=3&&n<5&&t>=3&&t<8?255:0;e.push(r),i.push(s)}}const n={metrics:{width:5,height:2,left:0,top:0,advance:0},bitmap:new Uint8Array(e)},r={metrics:{width:5,height:2,left:0,top:0,advance:0},bitmap:new Uint8Array(i)};this._recordGlyph(n),this._recordGlyph(r)}getTexture(t,e){if(!this._textures[e]){const i=new Zt.R;i.pixelFormat=Ct.Ab.ALPHA,i.wrapMode=Ct.pF.CLAMP_TO_EDGE,i.width=this.width,i.height=this.height,this._textures[e]=new Ht.g(t,i,new Uint8Array(this.width*this.height))}return this._dirties[e]&&(this._textures[e].setData(this._glyphData[e]),this._dirties[e]=!1),this._textures[e]}async getGlyphItems(t,e,i){const n=this._getGlyphCache(t);return await this._fetchRanges(t,e,i),e.map((e=>this._getMosaicItem(n,t,e)))}bind(t,e,i,n){const r=this.getTexture(t,i);r.setSamplingMode(e),t.bindTexture(r,n)}preloadASCIIGlyphCache(t){const e=this._preloadCache[t];if(null!=e)return e;const i=this._glyphSource.preloadASCIIRange(t).then((()=>{const e=this._getGlyphCache(t);for(let i=0;i<256;i++)this._getMosaicItem(e,t,i)}));return this._preloadCache[t]=i,i}_getGlyphCache(t){return this._glyphCache[t]||(this._glyphCache[t]={}),this._glyphCache[t]}_invalidate(){this._dirties[this._currentPage]=!0}async _fetchRanges(t,e,i){const n=function(t){const e=new Set;for(const i of t)e.add(qt(i));return e}(e),r=[];n.forEach((e=>{r.push(this._fetchRange(t,e,i))})),await Promise.all(r)}async _fetchRange(t,e,i){if(e>256)return;const n=t+e;return function(t,e,i){return t.has(e)||t.set(e,i().then((()=>{t.delete(e)})).catch((i=>{t.delete(e),(0,kt.jH)(i)}))),t.get(e)}(this._rangePromises,n,(()=>this._glyphSource.getRange(t,e,i)))}_getMosaicItem(t,e,i){if(!t[i]){const n=this._glyphSource.getGlyph(e,i);if(!n?.metrics)return(t=>({rect:new Yt.A(0,0,0,0),page:0,metrics:{left:0,width:0,height:0,advance:0,top:0},code:t,sdf:!0}))(i);const r=this._recordGlyph(n),s=this._currentPage,o=n.metrics;t[i]={rect:r,page:s,metrics:o,code:i,sdf:!0},this._invalidate()}return t[i]}_recordGlyph(t){const e=t.metrics;let i;if(0===e.width)i=new Yt.A(0,0,0,0);else{const n=3,s=e.width+2*n,o=e.height+2*n;i=this._binPack.allocate(s,o),i.isEmpty&&(this._dirties[this._currentPage]||(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(null),this._initDecorationGlyphs(),this._binPack=new Wt(this.width-4,this.height-4),i=this._binPack.allocate(s,o));const a=this._glyphData[this._currentPage],l=t.bitmap;let c,u;if(l)for(let t=0;t<o;t++){c=s*t,u=this.width*(i.y+t)+i.x;for(let t=0;t<s;t++)a[u+t]=l[c+t]}(0,r.A)("esri-glyph-debug")&&this._showDebugPage(a)}return i}_showDebugPage(t){const e=document.createElement("canvas"),i=e.getContext("2d"),n=new ImageData(this.width,this.height),r=n.data;e.width=this.width,e.height=this.height,e.style.border="1px solid black";for(let e=0;e<t.length;++e)r[4*e]=t[e],r[4*e+1]=0,r[4*e+2]=0,r[4*e+3]=255;i.putImageData(n,0,0),document.body.appendChild(e)}}var jt=i(68225);class Xt{constructor(t){for(this._metrics=[],this._bitmaps=[];t.next();)switch(t.tag()){case 1:{const e=t.getMessage();for(;e.next();)switch(e.tag()){case 3:{const t=e.getMessage();let i,n,r,s,o,a,l;for(;t.next();)switch(t.tag()){case 1:i=t.getUInt32();break;case 2:n=t.getBytes();break;case 3:r=t.getUInt32();break;case 4:s=t.getUInt32();break;case 5:o=t.getSInt32();break;case 6:a=t.getSInt32();break;case 7:l=t.getUInt32();break;default:t.skip()}t.release(),i&&(this._metrics[i]={width:r,height:s,left:o,top:a,advance:l},this._bitmaps[i]=n);break}default:e.skip()}e.release();break}default:t.skip()}}getMetrics(t){return this._metrics[t]}getBitmap(t){return this._bitmaps[t]}}class Kt{constructor(){this._ranges=[]}getRange(t){return this._ranges[t]}addRange(t,e){this._ranges[t]=e}}class Qt{constructor(t){this._glyphInfo={},this._baseURL=t}getRange(t,e,i){const n=this._getFontStack(t);if(n.getRange(e))return Promise.resolve();const r=256*e,s=r+255,o=this._baseURL.replace("{fontstack}",t).replace("{range}",r+"-"+s);return(0,Dt.A)(o,{responseType:"array-buffer",...i}).then((t=>{n.addRange(e,new Xt(new jt.A(new Uint8Array(t.data),new DataView(t.data))))}))}async preloadASCIIRange(t){const e=this._getFontStack(t),i=this._baseURL.replace("{fontstack}",t).replace("{range}","0-255"),n=await(0,Dt.A)(i,{responseType:"array-buffer"}),r=new Xt(new jt.A(new Uint8Array(n.data),new DataView(n.data)));for(let t=0;t<=255;t++)e.getRange(t)||e.addRange(t,r)}getGlyph(t,e){const i=this._getFontStack(t);if(!i)return;const n=Math.floor(e/256),r=i.getRange(n);return r?{metrics:r.getMetrics(e),bitmap:r.getBitmap(e)}:void 0}_getFontStack(t){let e=this._glyphInfo[t];return e||(e=this._glyphInfo[t]=new Kt),e}}var Jt=i(5161),te=i(16043);const ee=1e20;class ie{constructor(t,e=2){this._textureSize=t,this._rasterizationScale=e,this._canvasSize=this._textureSize*this._rasterizationScale,this._svg=null;const{_canvasSize:i}=this,n=document.createElement("canvas");n.width=n.height=i,this._context=n.getContext("2d",{willReadFrequently:!1}),this._gridOuter=new Float64Array(i*i),this._gridInner=new Float64Array(i*i),this._f=new Float64Array(i),this._d=new Float64Array(i),this._z=new Float64Array(i+1),this._v=new Int16Array(i)}dispose(){this._context=this._gridOuter=this._gridInner=this._f=this._d=this._z=this._v=null,this._svg=(0,te.pK)(this._svg)}draw(t,e,i){const{_canvasSize:n,_textureSize:r,_rasterizationScale:s}=this,o=r/4;this._initSVG();const a=this.createSVGString(t,e);return new Promise(((t,e)=>{const l=new Image;l.src="data:image/svg+xml; charset=utf8, "+encodeURIComponent(a),l.onload=()=>{l.onload=null,this._context.clearRect(0,0,n,n),this._context.drawImage(l,0,0,n,n);const e=this._context.getImageData(0,0,n,n),i=new Uint8Array(r*r*4);for(let t=0;t<n*n;t++){const i=e.data[4*t+3]/255;this._gridOuter[t]=1===i?0:0===i?ee:Math.max(0,.5-i)**2,this._gridInner[t]=1===i?ee:0===i?0:Math.max(0,i-.5)**2}this._edt(this._gridOuter,n,n),this._edt(this._gridInner,n,n);for(let t=0;t<r*r;t++){let e=0;for(let i=0;i<s;i++){const o=Math.floor(t/r)*s+i;for(let i=0;i<s;i++){const a=o*n+(t%r*s+i);e+=this._gridOuter[a]-this._gridInner[a]}}e/=s*s,e/=s,(0,Jt.U)(.5-e/(2*o),i,4*t)}t(i)};const c=i?.signal;c&&(0,kt.u7)(c,(()=>e((0,kt.NK)())))}))}_initSVG(){return this._svg||(this._svg=(0,te.p)()),this._svg}createSVGString(t,e){const i=this._initSVG(),n=(0,te.FJ)("path");n.setAttribute("d",t),i.appendChild(n);const r=n.getBBox(),s=r.width/r.height,o=this._canvasSize/2;let a,l,c;if(s>1){a=o/r.width;const t=o*(1/s);l=this._canvasSize/4,c=o-t/2}else a=o/r.height,l=o-o*s/2,c=this._canvasSize/4;const u=-r.x*a+l,h=-r.y*a+c;n.setAttribute("style",`transform: matrix(${a}, 0, 0, ${a}, ${u}, ${h})`),n.setAttribute("stroke-width",""+.5/a);const d=`<svg style="fill:${e?"red":"none"}; stroke:${e?"none":"red"}" height="${this._canvasSize}" width="${this._canvasSize}" xmlns="http://www.w3.org/2000/svg">${i.innerHTML}</svg>`;return i.removeChild(n),d}_edt(t,e,i){const n=this._f,r=this._d,s=this._v,o=this._z;for(let a=0;a<e;a++){for(let r=0;r<i;r++)n[r]=t[r*e+a];this._edt1d(n,r,s,o,i);for(let n=0;n<i;n++)t[n*e+a]=r[n]}for(let a=0;a<i;a++){for(let i=0;i<e;i++)n[i]=t[a*e+i];this._edt1d(n,r,s,o,e);for(let i=0;i<e;i++)t[a*e+i]=Math.sqrt(r[i])}}_edt1d(t,e,i,n,r){i[0]=0,n[0]=-ee,n[1]=+ee;for(let e=1,s=0;e<r;e++){let r=(t[e]+e*e-(t[i[s]]+i[s]*i[s]))/(2*e-2*i[s]);for(;r<=n[s];)s--,r=(t[e]+e*e-(t[i[s]]+i[s]*i[s]))/(2*e-2*i[s]);s++,i[s]=e,n[s]=r,n[s+1]=+ee}for(let s=0,o=0;s<r;s++){for(;n[o+1]<s;)o++;e[s]=(s-i[o])*(s-i[o])+t[i[o]]}}}var ne=i(36753);function re(t){return t&&"static"===t.type}class se{constructor(t,e,i=0){this._mosaicPages=[],this._maxItemSize=0,this._currentPage=0,this._pageWidth=0,this._pageHeight=0,this._mosaicRects=new Map,this._spriteCopyQueue=[],this.pixelRatio=1,this._pageWidth=t,this._pageHeight=e,i>0&&(this._maxItemSize=i),this.pixelRatio=window.devicePixelRatio||1,this._binPack=new Wt(this._pageWidth,this._pageHeight);const n=Math.floor(this._pageWidth),r=Math.floor(this._pageHeight);this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(n*r)},size:[this._pageWidth,this._pageHeight],dirty:!0,texture:void 0})}getWidth(t){return t>=this._mosaicPages.length?-1:this._mosaicPages[t].size[0]}getHeight(t){return t>=this._mosaicPages.length?-1:this._mosaicPages[t].size[1]}getPageTexture(t){return t<this._mosaicPages.length?this._mosaicPages[t].texture:null}has(t){return this._mosaicRects.has(t)}get itemCount(){return this._mosaicRects.size}getSpriteItem(t){return this._mosaicRects.get(t)}addSpriteItem(t,e,i,n,s,o,a=1,l=.5,c=1){if(this._mosaicRects.has(t))return this._mosaicRects.get(t);let u,h,d;if(re(i))[u,h,d]=this._allocateImage(e[0],e[1]);else{u=new Yt.A(0,0,e[0],e[1]),h=this._mosaicPages.length;const t=void 0;this._mosaicPages.push({mosaicsData:i,size:[e[0]+2*W.hM,e[1]+2*W.hM],dirty:!0,texture:t})}if(u.width<=0||u.height<=0)return null;const f={type:"sprite",rect:u,width:e[0],height:e[1],sdf:s,simplePattern:o,rasterizationScale:a,sdfPaddingRatio:l,sdfDecodeCoeff:c,page:h};return this._mosaicRects.set(t,f),re(i)&&((0,r.A)("esri-mosaic-debug")&&this._showDebugSprite(e,i.data),this._copy({rect:u,spriteSize:e,spriteData:i.data,page:h,pageSize:d,repeat:n,sdf:s})),f}hasItemsToProcess(){return 0!==this._spriteCopyQueue.length}processNextItem(){const t=this._spriteCopyQueue.pop();t&&this._copy(t)}getMosaicItemPosition(t){const e=this.getSpriteItem(t),i=e?.rect;if(!i)return null;i.width=e.width,i.height=e.height;const n=e.width,r=e.height,s=W.hM,o=this._mosaicPages[e.page].size;return{size:[e.width,e.height],tl:[(i.x+s)/o[0],(i.y+s)/o[1]],br:[(i.x+s+n)/o[0],(i.y+s+r)/o[1]],page:e.page}}bind(t,e,i=0,n=0){const s=this._mosaicPages[i],o=s.mosaicsData;let a=s.texture;a||(a=ae(t,s.size),s.texture=a),a.setSamplingMode(e),re(o)?(t.bindTexture(a,n),s.dirty&&(a.setData(new Uint8Array(o.data.buffer)),a.generateMipmap(),(0,r.A)("esri-mosaic-debug")&&this._showDebugPage(i))):(o.data.loadFrame(a),t.bindTexture(a,n),a.generateMipmap()),s.dirty=!1}getTexture(t,e=0){const i=this._mosaicPages[e],n=i.mosaicsData;let s=i.texture;return s||(s=ae(t,i.size),i.texture=s),re(n)?i.dirty&&(s.setData(new Uint8Array(n.data.buffer)),s.generateMipmap(),(0,r.A)("esri-mosaic-debug")&&this._showDebugPage(e)):(n.data.loadFrame(s),s.generateMipmap()),i.dirty=!1,s}dispose(){this._binPack=null;for(const t of this._mosaicPages){const e=t.texture;e&&e.dispose();const i=t.mosaicsData;re(i)||i.data.destroy()}this._mosaicPages=null,this._mosaicRects.clear()}static _copyBits(t,e,i,n,r,s,o,a,l,c,u){let h=n*e+i,d=a*s+o;if(u){d-=s;for(let o=-1;o<=c;o++,h=((o+c)%c+n)*e+i,d+=s)for(let e=-1;e<=l;e++)r[d+e]=t[h+(e+l)%l]}else for(let i=0;i<c;i++){for(let e=0;e<l;e++)r[d+e]=t[h+e];h+=e,d+=s}}_copy(t){if(t.page>=this._mosaicPages.length)return;const e=this._mosaicPages[t.page],i=e.mosaicsData;if(!re(e.mosaicsData))throw new n.A("mapview-invalid-resource","unsuitable data type!");const r=t.spriteData,s=i.data;se._copyBits(r,t.spriteSize[0],0,0,s,t.pageSize[0],t.rect.x+W.hM,t.rect.y+W.hM,t.spriteSize[0],t.spriteSize[1],t.repeat),e.dirty=!0}_allocateImage(t,e){t+=2*W.hM,e+=2*W.hM;const i=Math.max(t,e);if(this._maxItemSize&&this._maxItemSize<i){const i=2**Math.ceil((0,ne.p6)(t)),n=2**Math.ceil((0,ne.p6)(e)),r=new Yt.A(0,0,t,e);return this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(i*n)},size:[i,n],dirty:!0,texture:void 0}),[r,this._mosaicPages.length-1,[i,n]]}const n=this._binPack.allocate(t,e);if(n.width<=0){const i=this._mosaicPages[this._currentPage];return!i.dirty&&re(i.mosaicsData)&&(i.mosaicsData.data=null),this._currentPage=this._mosaicPages.length,this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(this._pageWidth*this._pageHeight)},size:[this._pageWidth,this._pageHeight],dirty:!0,texture:void 0}),this._binPack=new Wt(this._pageWidth,this._pageHeight),this._allocateImage(t,e)}return[n,this._currentPage,[this._pageWidth,this._pageHeight]]}_showDebugSprite([t,e],i){const n=document.createElement("canvas");n.width=t,n.height=e,n.setAttribute("style",`position: absolute; top: ${4+204*oe++}px; right: 208px; width: 200px; height: 200px; border: 1px solid black;`);const r=n.getContext("2d"),s=new ImageData(t,e);s.data.set(new Uint8Array(i.buffer)),r.putImageData(s,0,0),document.body.appendChild(n)}_showDebugPage(t){const e=this._mosaicPages[t],{size:[i,n],mosaicsData:r}=e;if(!re(r))return;const s=`mosaicDebugPage${t}`,o=document.getElementById(s)??document.createElement("canvas");o.id=s,o.width=i,o.height=n,o.setAttribute("style",`position: absolute; top: ${4+204*t}px; right: 4px; width: 200px; height: 200px; border: 1px solid black;`);const a=o.getContext("2d"),l=new ImageData(i,n);l.data.set(new Uint8Array(r.data.buffer)),a.putImageData(l,0,0),document.body.appendChild(o)}}let oe=0;function ae(t,e){const i=new Zt.R;return i.width=e[0],i.height=e[1],i.wrapMode=Ct.pF.CLAMP_TO_EDGE,new Ht.g(t,i,null)}var le=i(88413),ce=i(93937);class ue{constructor(t,e,i,n){this._animation=t,this._frameData=null,this.frameCount=this._animation.frameDurations.length,this.width=this._animation.width,this.height=this._animation.height,this._playHandle=(0,ce.ZH)(this._animation,i,n,(t=>{this._frameData=t,e.requestRender()}))}destroy(){this._playHandle.remove()}loadFrame(t){const e=this._frameData;if(null==e)return;const i="width"in e?e.width:e.codedWidth,n="height"in e?e.height:e.codedHeight;t.updateData(0,W.hM,W.hM,i,n,e),this._frameData=null}}var he=i(31516);class de{constructor(){this._entries=new pe,this._nodes=new Map,this._book=new _e}add(t){let e=this._entries.get(t);if(!e){const i=this._book.add(t),n=new Object;e={location:i,references:0,handle:n};const r=this._entries.set(t,e);this._nodes.set(n,r)}return e.references++,e}remove(t){const e=this._nodes.get(t.handle);e&&e.payload&&(e.payload.references--,0===e.payload.references&&(this._book.remove(e.payload.location),this._entries.delete(e),this._nodes.delete(t.handle)))}getTexture(t,e){return this._book.getTexture(t,e)}destroy(){this._book.destroy()}}class fe{constructor(t,e){this.parent=t,this.key=e,this.payload=null,this._children=new Map}get(t){return this._children.get(t)}ensure(t){let e=this._children.get(t);return e||(e=new fe(this,t),this._children.set(t,e)),e}delete(t){this._children.delete(t)}}class pe{constructor(){this._root=new fe(null,NaN)}set(t,e){let i=this._root;for(const e of t)for(const t of e)i=i.ensure(t);return i.payload=e,i}delete(t){t.parent?.delete(t.key)}get(t){let e=this._root;for(const i of t)for(const t of i){const i=e.get(t);if(!i)return;e=i}return e.payload||void 0}}class _e{constructor(){this._pages=[]}add(t){0===this._pages.length&&this._pages.push(new me);let e=this._pages.length-1,i=this._pages[e].add(t);if(i||(this._pages.push(new me),e=this._pages.length-1,i=this._pages[e].add(t)),!i)throw new Error("Data allocation failed.");return{...i,page:e}}remove(t){this._pages[t.page].remove(t)}getTexture(t,e){return this._pages[e].getTexture(t)}destroy(){}}class me{constructor(){this._cursor={row:0,column:0},this._columns=1024,this._rows=1024,this._data=new Float32Array(this._columns*this._rows*4),this._texture=null,this._textureCursor={row:0,column:0}}add(t){if(t.length>this._columns)throw new Error(`The maximum allocation size is ${this._columns} texels.`);const e={...this._cursor};if(e.column+=t.length,e.column>=this._columns&&(e.column=t.length,e.row++),e.row>=this._rows)return null;this._cursor=e;const i={...this._cursor};i.column-=t.length;let n=4*(i.row*this._columns+i.column);for(let e=0;e<t.length;e++)this._data[n++]=t[e][0],this._data[n++]=t[e][1],this._data[n++]=t[e][2],this._data[n++]=t[e][3];return i}remove(t){}getTexture(t){if(!this._texture){const e=new Zt.R(this._columns,this._rows);e.pixelFormat=Ct.Ab.RGBA,e.dataType=Ct.ld.FLOAT,e.wrapMode=Ct.pF.CLAMP_TO_EDGE,e.samplingMode=Ct.Cj.NEAREST,e.hasMipmap=!1;const i=new he.z(t,e);this._texture=new Ht.g(t,i)}if(this._cursor.row===this._textureCursor.row&&this._cursor.column===this._textureCursor.column)return this._texture;const e=this._textureCursor.row,i=this._cursor.row-e+1;return this._texture.updateData(0,0,e,this._columns,i,this._data,e),this._textureCursor.row=this._cursor.row,this._textureCursor.column=this._cursor.column,this._texture}destroy(){this._texture?.dispose()}}var ge=i(46863);const ye="arial-unicode-ms-regular",ve=(t,e,i)=>d.A.getLogger("esri.views.2d.engine.webgl.TextureManager").error(new n.A(t,e,i));class xe{static fromMosaic(t,e){return new xe(t,e.page,e.sdf)}constructor(t,e,i){this.mosaicType=t,this.page=e,this.sdf=i}}class be{constructor(t){this._requestRender=t,this._resourceManager=new Nt.A,this._invalidFontsMap=new Map,this._sdfConverter=new ie(W.yA),this._bindingInfos=new Array,this._hashToBindingIndex=new Map,this._ongoingRasterizations=new Map,this._imageRequestQueue=new ge.e({concurrency:10,process:async(t,e)=>{(0,kt.Te)(e);try{return await(0,Dt.A)(t,{responseType:"image",signal:e})}catch(e){if(!(0,kt.zf)(e))throw new n.A("mapview-invalid-resource",`Could not fetch requested resource at ${t}`,e);throw e}}}),this.animationStore=new de,this._spriteMosaic=new se(2048,2048,500),this._glyphSource=new Qt(`${zt.default.fontsUrl}/{fontstack}/{range}.pbf`),this._glyphMosaic=new $t(1024,1024,this._glyphSource),this._rasterizer=new Ut(this.resourceManager)}dispose(){this._spriteMosaic.dispose(),this._glyphMosaic.dispose(),this._rasterizer.dispose(),this._sdfConverter.dispose(),this._spriteMosaic=null,this._glyphMosaic=null,this._sdfConverter=null,this._hashToBindingIndex.clear(),this._hashToBindingIndex=null,this._bindingInfos=null,this._ongoingRasterizations.clear(),this._ongoingRasterizations=null,this._imageRequestQueue.clear(),this._imageRequestQueue=null,this._resourceManager.destroy(),this.animationStore.destroy()}get sprites(){return this._spriteMosaic}get glyphs(){return this._glyphMosaic}get resourceManager(){return this._resourceManager}async rasterizeItem(t,e){if(null==t)return ve("mapview-null-resource","Unable to rasterize null resource"),null;if("animation-info"===t.type){const{resource:e}=t,i=this.animationStore.add(e),{location:n}=i;return{rect:new Yt.A(n.column,n.row,e.length,1),page:n.page,type:"sprite",width:e.length,height:1,rasterizationScale:1,sdfPaddingRatio:.5,sdfDecodeCoeff:1,simplePattern:!1}}if("cim-rasterization-info"!==t.type)return ve("mapview-unexpected-resource","Unable to rasterize resource"),null;const{resource:i}=t;if("text"===i.type){const t=await this._rasterizeText(i,e);for(const e of t.glyphs)this._setTextureBinding(ot.Be.GLYPH,e);return t}const n=await this._rasterizeSprite(i,e);return n&&this._setTextureBinding(ot.Be.SPRITE,n),n}getMosaicInfo(t,e,i=!1){const n=this._getTextureBindingInfo(t,e,i);return n?{size:n.size,texture:{texture:n.texture,unit:"sprite"===n.type?W.Pq:W.ue}}:(ve("mapview-invalid-resource",`Unable to find resource for ${e}`),{size:[0,0],texture:{texture:null,unit:0}})}_getTextureBindingInfo(t,e,i){const n=this._bindingInfos[e-1],r=n.page,s=i?Ct.Cj.LINEAR_MIPMAP_LINEAR:Ct.Cj.LINEAR;switch(n.mosaicType){case ot.Be.SPRITE:{const e=[this.sprites.getWidth(r),this.sprites.getHeight(r)],i=this._spriteMosaic.getTexture(t,r);return i.setSamplingMode(s),{type:"sprite",texture:i,size:e}}case ot.Be.GLYPH:{const e=[this.glyphs.width,this.glyphs.height],i=this._glyphMosaic.getTexture(t,r);return this._glyphMosaic.bind(t,s,r,W.ue),i.setSamplingMode(s),{type:"glyph",texture:i,size:e}}default:return ve("mapview-texture-manager",`Cannot handle unknown type ${n.mosaicType}`),null}}_hashMosaic(t,e){return 1|t<<1|(e.sdf?1:0)<<2|e.page<<3}_setTextureBinding(t,e){const i=this._hashMosaic(t,e);if(!this._hashToBindingIndex.has(i)){const n=xe.fromMosaic(t,e),r=this._bindingInfos.length+1;this._hashToBindingIndex.set(i,r),this._bindingInfos.push(n)}e.textureBinding=this._hashToBindingIndex.get(i)}async _rasterizeText(t,e){const{font:i,textString:n}=t,s=(0,u.rK)(i),o=this._invalidFontsMap.has(s),[a,l]=(0,Lt.y)(n),c=(0,le.bX)(a);try{const t=o?ye:s;return(0,r.A)("esri-2d-stabilize-glyphs")&&await this._glyphMosaic.preloadASCIIGlyphCache(t),{type:"glyphs",glyphs:await this._glyphMosaic.getGlyphItems(t,c,e),isRightToLeft:l}}catch(t){return ve("mapview-invalid-resource",`Couldn't find font ${s}. Falling back to Arial Unicode MS Regular`),this._invalidFontsMap.set(s,!0),{type:"glyphs",glyphs:await this._glyphMosaic.getGlyphItems(ye,c,e),isRightToLeft:l}}}_hashSpriteResource(t){switch(t.type){case"path":return`path:${t.path}.${t.asFill?1:0}`;case"CIMPictureMarker":return`${t.type}:${t.url}:${t.size}`;case"CIMPictureFill":return`${t.type}:${t.url}:${t.height}`;case"CIMPictureStroke":return`${t.type}:${t.url}:${t.width}`;case"dash":return`dash:${t.capStyle}.${(0,v.K3)(t.dashTemplate).join("")}`;case"sdf":return`sdf:${JSON.stringify(t.geom)}.${t.asFill?1:0}`;case"fill-style":return`fill_style:${t.style}`;case"animated":return JSON.stringify((0,le.IF)(t));case"CIMHatchFill":case"CIMVectorMarker":return JSON.stringify(t)}}async _rasterizeSprite(t,e){if(!t)return null;const i=(0,p.Wm)(this._hashSpriteResource(t));if(this._spriteMosaic.has(i))return this._spriteMosaic.getSpriteItem(i);if("url"in t&&t.url||"CIMPictureFill"===t.type||"CIMPictureStroke"===t.type||"CIMPictureMarker"===t.type||"CIMVectorMarker"===t.type){const e=[];U.wp.fetchResources({type:"CIMPointSymbol",symbolLayers:[t]},this._resourceManager,e),e.length>0&&await Promise.all(e)}switch(t.type){case"CIMPictureMarker":return"CIMMarkerPlacementInsidePolygon"===t.markerPlacement?.type?this._rasterizeJSONResource(i,t):this._handleAsyncResource(i,t,e);case"animated":case"CIMPictureFill":case"CIMPictureStroke":case"path":return this._handleAsyncResource(i,t,e);case"sdf":case"dash":case"fill-style":case"CIMVectorMarker":case"CIMHatchFill":return this._rasterizeJSONResource(i,t)}}_rasterizeJSONResource(t,e){const i=this._rasterizer.rasterizeJSONResource(e);if(i){const{size:n,image:r,sdf:s,simplePattern:o,rasterizationScale:a,sdfPaddingRatio:l,sdfDecodeCoeff:c}=i;return this._addItemToMosaic(t,n,{type:"static",data:r},Se(e),s,o,a,l,c)}return null}async _handleAsyncResource(t,e,i){if(this._ongoingRasterizations.has(t))return this._ongoingRasterizations.get(t);let n;return n="path"===e.type?this._handleSVG(e,t,i):this._handleImage(e,t,i),this._ongoingRasterizations.set(t,n),n.finally((()=>this._ongoingRasterizations.delete(t))),n}async _handleSVG(t,e,i){const n=[W.yA,W.yA],{asFill:r}=t,s=await this._sdfConverter.draw(t.path,r,i);return this._addItemToMosaic(e,n,{type:"static",data:new Uint32Array(s.buffer)},!1,!0,!0)}async _handleGIFOrPNG(t,e,i){const n=t.url,r=this.resourceManager.getResource(n);if(null==r)return null;const{width:s,height:o}=r;if(r instanceof HTMLImageElement){if("animated"===t.type)return ve("mapview-unexpected-resource","Attempt to configure animations for a non-animated image."),null;const i="colorSubstitutions"in t?t.colorSubstitutions:void 0,{size:n,sdf:a,image:l}=this._rasterizer.rasterizeImageResource(s,o,r,i);return this._addItemToMosaic(e,n,{type:"static",data:l},Se(t),a,!1)}let a,l,c;"animated"===t.type?(a=!1,l={type:"CIMAnimatedSymbolProperties",playAnimation:t.playAnimation,reverseAnimation:t.reverseAnimation,randomizeStartTime:t.randomizeStartTime,randomizeStartSeed:t.randomizeStartSeed,startTimeOffset:t.startTimeOffset,duration:t.duration,repeatType:t.repeatType,repeatDelay:t.repeatDelay},c=t.startGroup||0):(a=Se(t),l={type:"CIMAnimatedSymbolProperties"},c=0);const u=new ue(r,this._requestRender,l,c);return this._addItemToMosaic(e,[u.width,u.height],{type:"animated",data:u},a,!1,!1)}async _handleImage(t,e,i){const r=t.url;if(we(r)||Te(r))return this._handleGIFOrPNG(t,e,i);if("animated"===t.type)return ve("mapview-unexpected-resource","Attempt to configure animations for a non-animated image."),null;try{let n;const s=this.resourceManager.getResource(r);if(null!=s&&s instanceof HTMLImageElement)n=s;else{const{data:t}=await this._imageRequestQueue.push(r,{...i});n=t}if((0,le.UE)(r))if("width"in t&&"height"in t)n.width=(0,f.Lz)(t.width),n.height=(0,f.Lz)(t.height);else if("cim"in t){const e=t;n.width=(0,f.Lz)(e.width??e.scaleX*e.size),n.height=(0,f.Lz)(e.size)}if(!n.width||!n.height)return null;const o=n.width,a=n.height,l="colorSubstitutions"in t?t.colorSubstitutions:void 0,{size:c,sdf:u,image:h}=this._rasterizer.rasterizeImageResource(o,a,n,l);return this._addItemToMosaic(e,c,{type:"static",data:h},Se(t),u,!1)}catch(t){if(!(0,kt.zf)(t))throw new n.A("mapview-invalid-resource",`Could not fetch requested resource at ${r}. ${t.message}`);throw t}}_addItemToMosaic(t,e,i,n,r,s,o,a,l){return this._spriteMosaic.addSpriteItem(t,e,i,n,r,s,o,a,l)}}function Se(t){switch(t.type){case"CIMVectorMarker":case"CIMPictureMarker":return Me(t);default:return!0}}const we=t=>t&&(t.includes(".gif")||(t=>null!=t&&t.startsWith("data:image/gif"))(t)),Te=t=>t&&(t.includes(".png")||(t=>null!=t&&t.startsWith("data:image/png"))(t)),Me=t=>t&&"markerPlacement"in t&&t.markerPlacement&&"CIMMarkerPlacementInsidePolygon"===t.markerPlacement.type;class Pe{constructor(t){this._queue=[],this._refreshable=t}destroy(){this._queue=[]}enqueueTextureUpdate(t,e){const i=(0,kt.Tw)(),n=t,r=W.Qb,s=Math.ceil(n.height/r);(0,kt.Te)(e);for(let o=0;o<s;o++){const a=o*r,l=o===s-1,c=l?n.height-r*o:r;this._queue.push({type:"chunk",request:t,resolver:i,chunk:o,chunkOffset:a,destHeight:c,chunkIsLast:l,options:e})}return(0,kt.NY)(e,(t=>i.reject(t))),i.promise}upload(){let t=0;for(;this._queue.length;){const e=performance.now(),i=this._queue.shift();if(i){if(null!=i.options.signal&&i.options.signal.aborted)continue;switch(i.type){case"chunk":this._uploadChunk(i);break;case"no-chunk":this._uploadNoChunk(i)}const n=performance.now()-e;if(t+=n,t+n>=W.r1)break}}this._queue.length&&this._refreshable.requestRender()}_uploadChunk(t){const{request:e,resolver:i,chunkOffset:n,chunkIsLast:r,destHeight:s}=t,{data:o,texture:a,width:l}=e;null!=o&&(a.updateData(0,0,n,l,s,o,n),r&&i.resolve())}_uploadNoChunk(t){const{request:e,resolver:i}=t,{data:n,texture:r}=e;r.setData(n),i.resolve()}}var Ae=i(8527),Ce=i(44705),Ie=i(1932),Ee=i(20551),Re=i(32501),Oe=i(77416),Fe=i(21024);const ze=(0,Ie.fA)(-.5,-.5);class De{constructor(){this._centerNdc=(0,Re.vt)(),this._pxToNdc=(0,Re.vt)(),this._worldDimensionsPx=(0,Re.vt)(),this._mat3=(0,l.vt)(),this._initialized=!1}dispose(){this._program=(0,s.WD)(this._program),this._quad=(0,s.WD)(this._quad)}render(t,e,i){const{context:n}=t,r=this._updateGeometry(t,i);if(null!=e){const{r:t,g:i,b:r,a:s}=e;n.setClearColor(s*t/255,s*i/255,s*r/255,s)}else n.setClearColor(0,0,0,0);if(n.setStencilFunction(Ct.MT.ALWAYS,0,255),n.setStencilWriteMask(255),!r)return n.setClearStencil(W.Qs),void n.clear(n.gl.STENCIL_BUFFER_BIT|n.gl.COLOR_BUFFER_BIT);n.setClearStencil(W.tP),n.clear(n.gl.STENCIL_BUFFER_BIT|n.gl.COLOR_BUFFER_BIT),this._initialized||this._initialize(n),n.setDepthWriteEnabled(!1),n.setDepthTestEnabled(!1),n.setColorMask(!1,!1,!1,!1),n.setBlendingEnabled(!1),n.setStencilOp(Ct.eA.KEEP,Ct.eA.KEEP,Ct.eA.REPLACE),n.setStencilFunction(Ct.MT.ALWAYS,W.Qs,255),n.setStencilTestEnabled(!0),n.useProgram(this._program),this._program.setUniformMatrix3fv("u_worldExtent",this._mat3),this._quad.bind(),this._quad.draw(),this._quad.unbind()}_initialize(t){if(this._initialized)return;const e=(0,It.r)(t,Fe.P);e&&(this._program=e,this._quad=new Oe.A(t,[0,0,1,0,0,1,1,1]),this._initialized=!0)}_updateGeometry(t,e){const{state:i,pixelRatio:n}=t,{size:r,rotation:s}=i,o=Math.round(r[0]*n),a=Math.round(r[1]*n);if(!i.spatialReference.isWrappable)return!1;const l=(0,Ae.DF)(s),c=Math.abs(Math.cos(l)),u=Math.abs(Math.sin(l)),h=Math.round(o*c+a*u),d=Math.round(n*i.worldScreenWidth);if(h<=d)return!1;const f=o*u+a*c,p=(e.left-e.right)*n/o,_=(e.bottom-e.top)*n/a;(0,Ee.i)(this._worldDimensionsPx,d,f,1),(0,Ee.i)(this._pxToNdc,2/o,-2/a,1),(0,Ee.i)(this._centerNdc,p,_,1);const m=this._mat3;return(0,Ce.kN)(m,this._centerNdc),(0,Ce.hs)(m,m,this._pxToNdc),0!==s&&(0,Ce.e$)(m,m,l),(0,Ce.hs)(m,m,this._worldDimensionsPx),(0,Ce.Tl)(m,m,ze),!0}}var Le=i(97673),ke=i(53400),Ne=i(81728),Be=i(74065),Ve=i(4935);class Ue extends ke.j{constructor(){super(...arguments),this.type=Ne.N.Blend,this._backBufferTexture=null,this.shaders={blend:new Be.L,opacity:new Ve.x}}shutdown(){super.shutdown(),null!==this._backBufferTexture&&(this._backBufferTexture.dispose(),this._backBufferTexture=null)}render(t,e){const{context:i,state:n,pixelRatio:r,inFadeTransition:s,painter:o}=t,{size:a}=n,l=i.getBoundFramebufferObject();let c,u;null!=l?(c=l.width,u=l.height):(c=Math.round(r*a[0]),u=Math.round(r*a[1]));const{blendMode:h}=e;if("normal"===h){const t={shader:this.shaders.opacity,uniforms:{config:{layerTexture:{texture:e.colorTexture,unit:0},opacity:e.config.opacity}},defines:null,optionalAttributes:null,useComputeBuffer:!1};return o.setPipelineState(Le.i),void o.submitDrawMesh(i,t,o.quadMesh)}const d=this._createOrResizeTexture(t,c,u);l.copyToTexture(0,0,c,u,0,0,d);const f={color:{write:[!0,!0,!0,!0],blendMode:"custom",blendParameters:{srcRGB:Ct.dn.ONE,dstRGB:Ct.dn.ZERO,srcAlpha:Ct.dn.ONE,dstAlpha:Ct.dn.ZERO}},depth:!1,stencil:!1};o.setPipelineState(f);const p={backbufferTexture:{texture:d,unit:0},layerTexture:{texture:e.colorTexture,unit:1},inFadeOpacity:s?1:0,...e.config},_={shader:this.shaders.blend,uniforms:{config:p},defines:{blendMode:h},optionalAttributes:null,useComputeBuffer:!1};o.submitDrawMesh(i,_,o.quadMesh)}_createOrResizeTexture(t,e,i){const{context:n}=t;if(null!==this._backBufferTexture&&this._backBufferTexture.descriptor?.width===e&&this._backBufferTexture.descriptor?.height===i)return this._backBufferTexture;if(null===this._backBufferTexture){const t=new Zt.R;t.internalFormat=Ct.Ab.RGBA,t.wrapMode=Ct.pF.CLAMP_TO_EDGE,t.width=e,t.height=i,this._backBufferTexture=new Ht.g(n,t)}else this._backBufferTexture.resize(e,i);return this._backBufferTexture}}class Ge{constructor(){this._blendTechnique=new Ue}dispose(t){this._blendTechnique?.shutdown()}draw(t,e,i,n,r){this._blendTechnique.render(t,{colorTexture:e,config:{opacity:r,samplingMode:i},blendMode:n})}}class Ye{constructor(){this.name=this.constructor.name}createOptions(t,e){return null}}class We extends Ye{constructor(t){super(),this.name=this.constructor.name,this.defines=[t]}dispose(){}bind({context:t,painter:e}){this._prev=t.getBoundFramebufferObject();const i=e.getFbos().effect0;t.bindFramebuffer(i),t.setColorMask(!0,!0,!0,!0),t.setClearColor(0,0,0,0),t.clear(t.gl.COLOR_BUFFER_BIT)}unbind(){}draw(t,e){const{context:i,painter:n}=t,r=n.getPostProcessingEffects(e),s=i.getBoundFramebufferObject();for(const{postProcessingEffect:e,effect:i}of r)e.draw(t,s,i);i.bindFramebuffer(this._prev),i.setStencilTestEnabled(!1),n.blitTexture(i,s.colorTexture,Ct.Cj.NEAREST),i.setStencilTestEnabled(!0)}}var He=i(39232),Ze=i(17040),qe=i(3817);class $e{constructor(){this._width=void 0,this._height=void 0,this._resources=null}dispose(){this._resources&&(this._resources.quadGeometry.dispose(),this._resources.quadVAO.dispose(),this._resources.highlightProgram.dispose(),this._resources.blurProgram.dispose(),this._resources=null)}preBlur(t,e){t.bindTexture(e,W.vd),t.useProgram(this._resources.blurProgram),this._resources.blurProgram.setUniform4fv("u_direction",[1,0,1/this._width,0]),this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",He.HQ),t.bindVAO(this._resources.quadVAO),t.drawArrays(Ct.WR.TRIANGLE_STRIP,0,4),t.bindVAO()}finalBlur(t,e){t.bindTexture(e,W.vd),t.useProgram(this._resources.blurProgram),this._resources.blurProgram.setUniform4fv("u_direction",[0,1,0,1/this._height]),this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",He.XK),t.bindVAO(this._resources.quadVAO),t.drawArrays(Ct.WR.TRIANGLE_STRIP,0,4),t.bindVAO()}renderHighlight(t,e,i){t.bindTexture(e,W.vd),t.useProgram(this._resources.highlightProgram),i.applyHighlightOptions(t,this._resources.highlightProgram),t.bindVAO(this._resources.quadVAO),t.setBlendingEnabled(!0),t.setBlendFunction(Ct.dn.ONE,Ct.dn.ONE_MINUS_SRC_ALPHA),t.drawArrays(Ct.WR.TRIANGLE_STRIP,0,4),t.bindVAO()}_initialize(t,e,i){this._width=e,this._height=i;const n=At.g.createVertex(t,Ct._U.STATIC_DRAW,new Int8Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]).buffer),r=new Et.Z(t,new Map([["a_position",0],["a_texcoord",1]]),new Map([["geometry",[new qe._("a_position",2,Ct.pe.BYTE,0,4),new qe._("a_texcoord",2,Ct.pe.UNSIGNED_BYTE,2,4)]]]),new Map([["geometry",n]])),s=(0,It.r)(t,Ze.Z),o=(0,It.r)(t,Ze.G);t.useProgram(s),s.setUniform1i("u_texture",W.vd),s.setUniform1i("u_shade",W.CR),s.setUniform1f("u_sigma",He.aY),t.useProgram(o),o.setUniform1i("u_texture",W.vd),o.setUniform1f("u_sigma",He.aY),this._resources={quadGeometry:n,quadVAO:r,highlightProgram:s,blurProgram:o}}setup(t,e,i){this._resources?(this._width=e,this._height=i):this._initialize(t,e,i)}}var je=i(96402),Xe=i(15167);function Ke(t,e,i){const n=new Zt.R(e,i);return n.wrapMode=Ct.pF.CLAMP_TO_EDGE,new je.H(t,n,new Xe.q(Ct.yQ.STENCIL_INDEX8,e,i))}class Qe{constructor(){this._width=void 0,this._height=void 0,this._resources=null}dispose(){this._resources&&(this._resources.sharedBlur1Fbo.dispose(),this._resources.sharedBlur2Fbo.dispose(),this._resources=null)}_initialize(t,e,i){this._width=e,this._height=i;const n=Ke(t,e,i),r=Ke(t,e,i);this._resources={sharedBlur1Fbo:n,sharedBlur2Fbo:r}}setup(t,e,i){!this._resources||this._width===e&&this._height===i||this.dispose(),this._resources||this._initialize(t,e,i)}get sharedBlur1Tex(){return this._resources.sharedBlur1Fbo.colorTexture}get sharedBlur1Fbo(){return this._resources.sharedBlur1Fbo}get sharedBlur2Tex(){return this._resources.sharedBlur2Fbo.colorTexture}get sharedBlur2Fbo(){return this._resources.sharedBlur2Fbo}}class Je extends Ye{constructor(){super(...arguments),this.defines=["highlight"],this._hlRenderer=new $e,this._width=void 0,this._height=void 0,this._boundFBO=null,this._hlSurfaces=new Qe,this._adjustedWidth=void 0,this._adjustedHeight=void 0,this._blitRenderer=new Rt}dispose(){this._hlSurfaces?.dispose(),this._hlRenderer?.dispose(),this._boundFBO=null}bind(t){const{context:e,painter:i}=t,{width:n,height:r}=e.getViewport(),s=i.getFbos().effect0;this.setup(t,n,r),e.bindFramebuffer(s),e.setColorMask(!0,!0,!0,!0),e.setClearColor(0,0,0,0),e.clear(e.gl.COLOR_BUFFER_BIT)}unbind(){}setup({context:t},e,i){this._width=e,this._height=i;const n=e%4,r=i%4;e+=n<2?-n:4-n,i+=r<2?-r:4-r,this._adjustedWidth=e,this._adjustedHeight=i,this._boundFBO=t.getBoundFramebufferObject();const s=Math.round(1*e),o=Math.round(1*i);this._hlRenderer.setup(t,s,o),this._hlSurfaces.setup(t,s,o)}draw(t){const{context:e,passOptions:i}=t,n=i.activeGradient,r=e.getBoundFramebufferObject();e.setViewport(0,0,1*this._adjustedWidth,1*this._adjustedHeight),e.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo),e.setStencilTestEnabled(!1),e.setClearColor(0,0,0,0),e.clear(e.gl.COLOR_BUFFER_BIT),this._blitRenderer.render(e,r.colorTexture,Ct.Cj.NEAREST,1),e.setStencilTestEnabled(!1),e.setBlendingEnabled(!1),e.setColorMask(!1,!1,!1,!0),e.bindFramebuffer(this._hlSurfaces.sharedBlur2Fbo),e.setClearColor(0,0,0,0),e.clear(e.gl.COLOR_BUFFER_BIT),this._hlRenderer.preBlur(e,this._hlSurfaces.sharedBlur1Tex),e.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo),e.setClearColor(0,0,0,0),e.clear(e.gl.COLOR_BUFFER_BIT),this._hlRenderer.finalBlur(e,this._hlSurfaces.sharedBlur2Tex),e.bindFramebuffer(this._boundFBO),e.setBlendingEnabled(!0),e.setColorMask(!0,!0,!0,!0),e.setViewport(0,0,this._width,this._height),this._hlRenderer.renderHighlight(e,this._hlSurfaces.sharedBlur1Tex,n),this._boundFBO=null}}class ti extends Ye{constructor(){super(...arguments),this.name=this.constructor.name,this.defines=["hittest"]}dispose(){null!=this._fbo&&this._fbo.dispose()}createOptions({pixelRatio:t},e){if(!e.length)return null;const i=e.shift(),n=i.x,s=i.y;this._outstanding=i;const o=(0,r.A)("esri-mobile");return{type:"hittest",distance:(o?W.fy:W.V3)*t,smallSymbolDistance:(o?W.fy:W._M)*t,smallSymbolSizeThreshold:W.ie,position:[n,s]}}bind(t){const{context:e,attributeView:i}=t;if(!i.size)return;const n=i.getBlock(W.dV.GPGPU);if(null==n)return;const r=n.getFBO(e);e.setViewport(0,0,i.size,i.size),e.bindFramebuffer(r),e.setColorMask(!0,!0,!0,!0),e.setClearColor(0,0,0,0),e.clear(e.gl.COLOR_BUFFER_BIT|e.gl.DEPTH_BUFFER_BIT)}unbind(){}draw(t){if(null==this._outstanding)return;const e=this._outstanding;this._outstanding=null,this._resolve(t,e.resolvers)}async _resolve(t,e){const{context:i,attributeView:n}=t,r=n.getBlock(W.dV.GPGPU);if(null==r)return void e.forEach((t=>t.resolve([])));const s=r.getFBO(i),o=new Uint8Array(s.width*s.height*4);try{await s.readPixelsAsync(0,0,s.width,s.height,Ct.Ab.RGBA,Ct.ld.UNSIGNED_BYTE,o)}catch(t){return void e.forEach((t=>t.resolve([])))}const a=[];for(let t=0;t<o.length;t+=4){const e=t/4;o[t]&&a.push(e)}e.forEach((t=>t.resolve(a)))}}const ei=[1,0],ii=[0,1],ni=[1,.8,.6,.4,.2],ri=[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1];class si{constructor(){this._intensityFBO=null,this._compositeFBO=null,this._mipsFBOs=new Array(5),this._nMips=5,this._kernelSizeArray=[3,5,7,9,11],this._size=[0,0],this._programDesc={luminosityHighPass:{vsPath:"post-processing/pp",fsPath:"post-processing/bloom/luminosityHighPass",attributes:new Map([["a_position",0]])},gaussianBlur:{vsPath:"post-processing/pp",fsPath:"post-processing/bloom/gaussianBlur",attributes:new Map([["a_position",0]])},composite:{vsPath:"post-processing/pp",fsPath:"post-processing/bloom/composite",attributes:new Map([["a_position",0]])},blit:{vsPath:"post-processing/pp",fsPath:"post-processing/blit",attributes:new Map([["a_position",0]])}}}dispose(){if(this._quad=(0,s.WD)(this._quad),this._intensityFBO=(0,s.WD)(this._intensityFBO),this._compositeFBO=(0,s.WD)(this._compositeFBO),this._mipsFBOs){for(let t=0;t<this._nMips;t++)this._mipsFBOs[t]&&(this._mipsFBOs[t].horizontal.dispose(),this._mipsFBOs[t].vertical.dispose());this._mipsFBOs=null}}draw(t,e,i){const{width:n,height:r}=e,{context:s,painter:o}=t,{materialManager:a}=o,l=s.gl,c=this._programDesc,{strength:u,radius:h,threshold:d}=i;this._quad||(this._quad=new Oe.A(s,[-1,-1,1,-1,-1,1,1,1])),this._createOrResizeResources(t,n,r),s.setStencilTestEnabled(!1),s.setBlendingEnabled(!0),s.setBlendFunction(Ct.dn.ONE,Ct.dn.ONE_MINUS_SRC_ALPHA),s.setStencilWriteMask(0);const f=this._quad;f.bind(),s.bindFramebuffer(this._intensityFBO);const p=a.getProgram(c.luminosityHighPass);s.useProgram(p),s.bindTexture(e.colorTexture,0),p.setUniform1i("u_texture",0),p.setUniform3fv("u_defaultColor",[0,0,0]),p.setUniform1f("u_defaultOpacity",0),p.setUniform1f("u_luminosityThreshold",d),p.setUniform1f("u_smoothWidth",.01);const _=[Math.round(n/2),Math.round(r/2)];s.setViewport(0,0,_[0],_[1]),s.setClearColor(0,0,0,0),s.clear(l.COLOR_BUFFER_BIT),f.draw(),s.setBlendingEnabled(!1);let m=this._intensityFBO.colorTexture;for(let t=0;t<this._nMips;t++){const e=a.getProgram(c.gaussianBlur,[{name:"radius",value:this._kernelSizeArray[t]}]);s.useProgram(e),s.bindTexture(m,t+1),e.setUniform1i("u_colorTexture",t+1),e.setUniform2fv("u_texSize",_),e.setUniform2fv("u_direction",ei),s.setViewport(0,0,_[0],_[1]);const i=this._mipsFBOs[t];s.bindFramebuffer(i.horizontal),f.draw(),m=i.horizontal.colorTexture,s.bindFramebuffer(i.vertical),s.bindTexture(m,t+1),e.setUniform2fv("u_direction",ii),f.draw(),m=i.vertical.colorTexture,_[0]=Math.round(_[0]/2),_[1]=Math.round(_[1]/2)}s.setViewport(0,0,n,r);const g=a.getProgram(c.composite,[{name:"nummips",value:5}]);s.bindFramebuffer(this._compositeFBO),s.useProgram(g),g.setUniform1f("u_bloomStrength",u),g.setUniform1f("u_bloomRadius",h),g.setUniform1fv("u_bloomFactors",ni),g.setUniform3fv("u_bloomTintColors",ri),s.bindTexture(this._mipsFBOs[0].vertical.colorTexture,1),g.setUniform1i("u_blurTexture1",1),s.bindTexture(this._mipsFBOs[1].vertical.colorTexture,2),g.setUniform1i("u_blurTexture2",2),s.bindTexture(this._mipsFBOs[2].vertical.colorTexture,3),g.setUniform1i("u_blurTexture3",3),s.bindTexture(this._mipsFBOs[3].vertical.colorTexture,4),g.setUniform1i("u_blurTexture4",4),s.bindTexture(this._mipsFBOs[4].vertical.colorTexture,5),g.setUniform1i("u_blurTexture5",5),f.draw(),s.bindFramebuffer(e),s.setBlendingEnabled(!0);const y=a.getProgram(c.blit);s.useProgram(y),s.bindTexture(this._compositeFBO.colorTexture,6),y.setUniform1i("u_texture",6),s.setBlendFunction(Ct.dn.ONE,Ct.dn.ONE),f.draw(),f.unbind(),s.setBlendFunction(Ct.dn.ONE,Ct.dn.ONE_MINUS_SRC_ALPHA),s.setStencilTestEnabled(!0)}_createOrResizeResources(t,e,i){const{context:n}=t;if(this._compositeFBO&&this._size[0]===e&&this._size[1]===i)return;this._size[0]=e,this._size[1]=i;const r=[Math.round(e/2),Math.round(i/2)];if(this._compositeFBO)this._compositeFBO.resize(e,i);else{const t=new Zt.R(e,i);t.internalFormat=Ct.Ab.RGBA,t.wrapMode=Ct.pF.CLAMP_TO_EDGE,this._compositeFBO=new je.H(n,t)}if(this._intensityFBO)this._intensityFBO.resize(r[0],r[1]);else{const t=new Zt.R(r[0],r[1]);t.internalFormat=Ct.Ab.RGBA,t.wrapMode=Ct.pF.CLAMP_TO_EDGE,this._intensityFBO=new je.H(n,t)}for(let t=0;t<this._nMips;t++){if(this._mipsFBOs[t])this._mipsFBOs[t].horizontal.resize(r[0],r[1]),this._mipsFBOs[t].vertical.resize(r[0],r[1]);else{const e=new Zt.R(r[0],r[1]);e.internalFormat=Ct.Ab.RGBA,e.wrapMode=Ct.pF.CLAMP_TO_EDGE,this._mipsFBOs[t]={horizontal:new je.H(n,e),vertical:new je.H(n,e)}}r[0]=Math.round(r[0]/2),r[1]=Math.round(r[1]/2)}}}const oi=[1,0],ai=[0,1];class li{constructor(){this._blurFBO=null,this._size=[0,0],this._programDesc={gaussianBlur:{vsPath:"post-processing/pp",fsPath:"post-processing/blur/gaussianBlur",attributes:new Map([["a_position",0]])},radialBlur:{vsPath:"post-processing/pp",fsPath:"post-processing/blur/radial-blur",attributes:new Map([["a_position",0]])},blit:{vsPath:"post-processing/pp",fsPath:"post-processing/blit",attributes:new Map([["a_position",0]])}}}dispose(){this._blurFBO&&(this._blurFBO.dispose(),this._blurFBO=null)}draw(t,e,i){const{context:n}=t,{type:r,radius:s}=i;if(0===s)return;this._createOrResizeResources(t),this._quad||(this._quad=new Oe.A(n,[-1,-1,1,-1,-1,1,1,1]));const o=this._quad;o.bind(),"blur"===r?this._gaussianBlur(t,e,s):this._radialBlur(t,e),o.unbind()}_gaussianBlur(t,e,i){const{context:n,state:r,painter:s,pixelRatio:o}=t,{size:a}=r,{materialManager:l}=s,c=this._programDesc,u=this._quad,h=[Math.round(o*a[0]),Math.round(o*a[1])],d=this._blurFBO,f=l.getProgram(c.gaussianBlur,[{name:"radius",value:Math.ceil(i)}]);n.useProgram(f),n.setBlendingEnabled(!1),n.bindFramebuffer(d),n.bindTexture(e.colorTexture,4),f.setUniform1i("u_colorTexture",4),f.setUniform2fv("u_texSize",h),f.setUniform2fv("u_direction",oi),f.setUniform1f("u_sigma",i),u.draw(),n.bindFramebuffer(e),n.setStencilWriteMask(0),n.setStencilTestEnabled(!1),n.setDepthWriteEnabled(!1),n.setDepthTestEnabled(!1),n.bindTexture(d?.colorTexture,5),f.setUniform1i("u_colorTexture",5),f.setUniform2fv("u_direction",ai),u.draw(),n.setBlendingEnabled(!0),n.setBlendFunction(Ct.dn.ONE,Ct.dn.ONE_MINUS_SRC_ALPHA),n.setStencilTestEnabled(!0)}_radialBlur(t,e){const{context:i,painter:n}=t,{materialManager:r}=n,s=this._programDesc,o=this._quad,a=this._blurFBO;i.bindFramebuffer(a);const l=r.getProgram(s.radialBlur);i.useProgram(l),i.setBlendingEnabled(!1),i.bindTexture(e.colorTexture,4),l.setUniform1i("u_colorTexture",4),o.draw(),i.bindFramebuffer(e),i.setStencilWriteMask(0),i.setStencilTestEnabled(!1),i.setDepthWriteEnabled(!1),i.setDepthTestEnabled(!1),i.setBlendingEnabled(!0);const c=r.getProgram(s.blit);i.useProgram(c),i.bindTexture(a?.colorTexture,5),c.setUniform1i("u_texture",5),i.setBlendFunction(Ct.dn.ONE,Ct.dn.ONE_MINUS_SRC_ALPHA),o.draw()}_createOrResizeResources(t){const{context:e,state:i,pixelRatio:n}=t,{size:r}=i,s=Math.round(n*r[0]),o=Math.round(n*r[1]);if(!this._blurFBO||this._size[0]!==s||this._size[1]!==o)if(this._size[0]=s,this._size[1]=o,this._blurFBO)this._blurFBO.resize(s,o);else{const t=new Zt.R(s,o);t.internalFormat=Ct.Ab.RGBA,t.wrapMode=Ct.pF.CLAMP_TO_EDGE,this._blurFBO=new je.H(e,t)}}}class ci{constructor(){this._layerFBOTexture=null,this._size=[0,0],this._programDesc={vsPath:"post-processing/pp",fsPath:"post-processing/filterEffect",attributes:new Map([["a_position",0]])}}dispose(){this._layerFBOTexture=(0,s.WD)(this._layerFBOTexture)}draw(t,e,i){const{width:n,height:r}=e;this._createOrResizeResources(t,n,r);const{context:s,painter:o}=t,{materialManager:a}=o,l=this._programDesc,c=this._quad,u=i.colorMatrix;c.bind();const h=this._layerFBOTexture;s.bindFramebuffer(e),e.copyToTexture(0,0,n,r,0,0,h),s.setBlendingEnabled(!1),s.setStencilTestEnabled(!1);const d=a.getProgram(l);s.useProgram(d),s.bindTexture(h,2),d.setUniformMatrix4fv("u_coefficients",u),d.setUniform1i("u_colorTexture",2),c.draw(),s.setBlendingEnabled(!0),s.setBlendFunction(Ct.dn.ONE,Ct.dn.ONE_MINUS_SRC_ALPHA),s.setStencilTestEnabled(!0),c.unbind()}_createOrResizeResources(t,e,i){const{context:n}=t;if(!this._layerFBOTexture||this._size[0]!==e||this._size[1]!==i){if(this._size[0]=e,this._size[1]=i,this._layerFBOTexture)this._layerFBOTexture.resize(e,i);else{const t=new Zt.R;t.internalFormat=Ct.Ab.RGBA,t.wrapMode=Ct.pF.CLAMP_TO_EDGE,t.width=e,t.height=i,this._layerFBOTexture=new Ht.g(n,t)}this._quad||(this._quad=new Oe.A(n,[-1,-1,1,-1,-1,1,1,1]))}}}const ui=[1,0],hi=[0,1];class di{constructor(){this._layerFBOTexture=null,this._horizontalBlurFBO=null,this._verticalBlurFBO=null,this._size=[0,0],this._quad=null,this._programDesc={blur:{vsPath:"post-processing/pp",fsPath:"post-processing/blur/gaussianBlur",attributes:new Map([["a_position",0]])},composite:{vsPath:"post-processing/pp",fsPath:"post-processing/drop-shadow/composite",attributes:new Map([["a_position",0]])},blit:{vsPath:"post-processing/pp",fsPath:"post-processing/blit",attributes:new Map([["a_position",0]])}}}dispose(){this._layerFBOTexture=(0,s.WD)(this._layerFBOTexture),this._horizontalBlurFBO=(0,s.WD)(this._horizontalBlurFBO),this._verticalBlurFBO=(0,s.WD)(this._verticalBlurFBO)}draw(t,e,i){const{context:n,state:r,painter:s}=t,{materialManager:o}=s,a=this._programDesc,l=e.width,c=e.height,u=[Math.round(l),Math.round(c)],{blurRadius:h,offsetX:d,offsetY:p,color:_}=i,m=[(0,f.Lz)(d),(0,f.Lz)(p)];this._createOrResizeResources(t,l,c,u);const g=this._horizontalBlurFBO,y=this._verticalBlurFBO;n.setStencilWriteMask(0),n.setStencilTestEnabled(!1),n.setDepthWriteEnabled(!1),n.setDepthTestEnabled(!1);const v=this._layerFBOTexture;e.copyToTexture(0,0,l,c,0,0,v),this._quad||(this._quad=new Oe.A(n,[-1,-1,1,-1,-1,1,1,1])),n.setViewport(0,0,u[0],u[1]);const x=this._quad;x.bind(),n.setBlendingEnabled(!1);const b=o.getProgram(a.blur,[{name:"radius",value:Math.ceil(h)}]);n.useProgram(b),n.bindFramebuffer(g),n.bindTexture(e.colorTexture,4),b.setUniform1i("u_colorTexture",4),b.setUniform2fv("u_texSize",u),b.setUniform2fv("u_direction",ui),b.setUniform1f("u_sigma",h),x.draw(),n.bindFramebuffer(y),n.bindTexture(g?.colorTexture,5),b.setUniform1i("u_colorTexture",5),b.setUniform2fv("u_direction",hi),x.draw(),n.bindFramebuffer(e),n.setViewport(0,0,l,c);const S=o.getProgram(a.composite);n.useProgram(S),n.bindTexture(y?.colorTexture,2),S.setUniform1i("u_blurTexture",2),n.bindTexture(v,3),S.setUniform1i("u_layerFBOTexture",3),S.setUniform4fv("u_shadowColor",[_[3]*(_[0]/255),_[3]*(_[1]/255),_[3]*(_[2]/255),_[3]]),S.setUniformMatrix3fv("u_displayViewMat3",r.displayMat3),S.setUniform2fv("u_shadowOffset",m),x.draw(),n.setBlendingEnabled(!0),n.setStencilTestEnabled(!0),n.setBlendFunction(Ct.dn.ONE,Ct.dn.ONE_MINUS_SRC_ALPHA),x.unbind()}_createOrResizeResources(t,e,i,n){const{context:r}=t;if(!this._horizontalBlurFBO||this._size[0]!==e||this._size[1]!==i){if(this._size[0]=e,this._size[1]=i,this._horizontalBlurFBO)this._horizontalBlurFBO.resize(n[0],n[1]);else{const t=new Zt.R(n[0],n[1]);t.internalFormat=Ct.Ab.RGBA,t.wrapMode=Ct.pF.CLAMP_TO_EDGE,this._horizontalBlurFBO=new je.H(r,t)}if(this._verticalBlurFBO)this._verticalBlurFBO.resize(n[0],n[1]);else{const t=new Zt.R(n[0],n[1]);t.internalFormat=Ct.Ab.RGBA,t.wrapMode=Ct.pF.CLAMP_TO_EDGE,this._verticalBlurFBO=new je.H(r,t)}if(this._layerFBOTexture)this._layerFBOTexture.resize(e,i);else{const t=new Zt.R;t.internalFormat=Ct.Ab.RGBA,t.wrapMode=Ct.pF.CLAMP_TO_EDGE,t.width=e,t.height=i,this._layerFBOTexture=new Ht.g(r,t)}}}}class fi{constructor(){this._size=[0,0],this._layerFBOTexture=null}dispose(){this._layerFBOTexture=(0,s.WD)(this._layerFBOTexture)}draw(t,e,i){const{width:n,height:r}=e;this._createOrResizeResources(t,n,r);const{context:s,painter:o}=t,{amount:a}=i,l=s.gl,c=this._layerFBOTexture;s.bindFramebuffer(e),e.copyToTexture(0,0,n,r,0,0,c),s.setBlendingEnabled(!0),s.setStencilTestEnabled(!1),s.setDepthTestEnabled(!1),s.setClearColor(0,0,0,0),s.clear(l.COLOR_BUFFER_BIT),o.blitTexture(s,c,Ct.Cj.NEAREST,a)}_createOrResizeResources(t,e,i){const{context:n}=t;if(!this._layerFBOTexture||this._size[0]!==e||this._size[1]!==i)if(this._size[0]=e,this._size[1]=i,this._layerFBOTexture)this._layerFBOTexture.resize(e,i);else{const t=new Zt.R;t.internalFormat=Ct.Ab.RGBA,t.wrapMode=Ct.pF.CLAMP_TO_EDGE,t.samplingMode=Ct.Cj.NEAREST,t.width=e,t.height=i,this._layerFBOTexture=new Ht.g(n,t)}}}function pi(t){switch(t){case"bloom":case"blur":case"opacity":case"drop-shadow":return t;default:return"colorize"}}const _i={colorize:()=>new ci,blur:()=>new li,bloom:()=>new si,opacity:()=>new fi,"drop-shadow":()=>new di};class mi{constructor(){this._effectMap=new Map}dispose(){this._effectMap.forEach((t=>t.dispose())),this._effectMap.clear()}getPostProcessingEffects(t){if(!t||0===t.length)return[];const e=[];for(const i of t){const t=pi(i.type);let n=this._effectMap.get(t);n||(n=_i[t](),this._effectMap.set(t,n)),e.push({postProcessingEffect:n,effect:i})}return e}}var gi=i(61117),yi=i(50659);class vi{constructor(t,e){this.brushes=t,this.name=e.name,this.drawPhase=e.drawPhase||ot.S5.MAP,this._targetFn=e.target,this.effects=e.effects||[],this.enableDefaultDraw=e.enableDefaultDraw??(()=>!0),this.forceDrawByDisplayOrder=!!e.forceDrawByDisplayOrder}render(t){const{context:e,profiler:i}=t,n=this._targetFn(),r=this.drawPhase&t.drawPhase;if(i.recordPassStart(this.name),r){this.enableDefaultDraw()&&this._doRender(t,n),i.recordPassEnd();for(const i of this.effects){if(!i.enable())continue;const r=i.apply,s=i.args?.(),o=e.getViewport(),a=e.getBoundFramebufferObject(),l=t.passOptions;this._bindEffect(t,r,s),this._doRender(t,n,r.defines),this._drawAndUnbindEffect(t,r,o,a,l,s)}}}_doRender(t,e,i){if(null==e)return;const{profiler:n,context:r}=t;for(const s of this.brushes){if(n.recordBrushStart(s.name),null!=s.brushEffect){const n=r.getViewport(),o=r.getBoundFramebufferObject(),a=t.passOptions;this._bindEffect(t,s.brushEffect),this._drawWithBrush(s,t,e,i),this._drawAndUnbindEffect(t,s.brushEffect,n,o,a)}else this._drawWithBrush(s,t,e,i);n.recordBrushEnd()}}_drawWithBrush(t,e,i,n){(0,yi.Xj)(i)?(t.prepareState(e,n),t.drawMany(e,i,n)):i.visible&&(t.prepareState(e,n),t.draw(e,i,n))}_bindEffect(t,e,i){const{profiler:n}=t;n.recordPassStart(this.name+"."+e.name),e.bind(t,i);const r=e.createOptions(t,i);t.passOptions=r}_drawAndUnbindEffect(t,e,i,n,r,s){const{profiler:o,context:a}=t;t.passOptions=r,o.recordBrushStart(e.name),e.draw(t,s),e.unbind(t,s),a.bindFramebuffer(n);const{x:l,y:c,width:u,height:h}=i;a.setViewport(l,c,u,h),o.recordBrushEnd(),o.recordPassEnd()}}class xi{constructor(){this._programCache=new Map}destroy(){for(const t of this._programCache.values())t.destroy();this._programCache.clear()}getProgram(t,e,i,n,r){const s=t.getShaderKey(e,i,n,r);let o=this._programCache.get(s);return o||(o=t.getProgram(e,i,n,r),this._programCache.set(s,o)),o}}var bi=i(49414);class Si{constructor(t,e){this.context=t,this._currentPipelineStateNeedsUpdate=!1,this._blitRenderer=new Rt,this._worldExtentRenderer=new De,this._brushCache=new Map,this._lastWidth=null,this._lastHeight=null,this._vtlMaterialManager=new Tt,this._blendEffect=new Ge,this._stencilBuf=null,this._prevBeforeLayerFBOStack=[],this._fboPool=[],this.effects={highlight:new Je,hittest:new ti,insideEffect:new We("inside"),outsideEffect:new We("outside")},this._programCache=new xi,this._shaderState={shader:null,uniforms:null,defines:null,optionalAttributes:null,useComputeBuffer:!1},this.materialManager=new Ft(t),this.textureManager=new be(e),this.textureUploadManager=new Pe(e),this._effectsManager=new mi,this._quadMesh=gi.g.fromVertexStream(t,[0,0,1,0,0,1,1,1])}dispose(){if(this._programCache.destroy(),this.materialManager.dispose(),this.textureManager.dispose(),this.textureUploadManager.destroy(),this._blitRenderer=(0,s.WD)(this._blitRenderer),this._worldExtentRenderer=(0,s.WD)(this._worldExtentRenderer),this._quadMesh=(0,s.pR)(this._quadMesh),this._brushCache&&(this._brushCache.forEach((t=>t.dispose())),this._brushCache.clear(),this._brushCache=null),this._fbos){let t;for(t in this._fbos)this._fbos[t]&&this._fbos[t].dispose()}for(const t of this._fboPool)t.dispose();if(this._fboPool.length=0,this.effects){let t;for(t in this.effects)this.effects[t]&&this.effects[t].dispose()}this._effectsManager.dispose(),this._blendEffect.dispose(this.context),this._vtlMaterialManager=(0,s.WD)(this._vtlMaterialManager)}clearShaderCache(){this._programCache.destroy(),this._programCache=new xi}get blitRenderer(){return this._blitRenderer}get vectorTilesMaterialManager(){return this._vtlMaterialManager}get quadMesh(){return this._quadMesh}getFbos(){if(!this._fbos)throw new Error("InternalError: Painter FBOs not initialized");return this._fbos}acquireFbo(t,e){let i;if(this._fboPool.length>0)i=this._fboPool.pop();else{const n=new Zt.R(t,e);n.samplingMode=Ct.Cj.NEAREST,n.wrapMode=Ct.pF.CLAMP_TO_EDGE,i=new je.H(this.context,n,this._stencilBuf)}return i.width===t&&i.height===e||i.resize(t,e),i}releaseFbo(t){this._fboPool.push(t)}getSharedStencilBuffer(){return this._stencilBuf}beforeRenderPhases(t,e,i){const{context:n}=t;this._worldExtentRenderer.render(t,e,i);const{width:r,height:s}=n.getViewport();if(this.updateFBOs(r,s),this._prevFBO=n.getBoundFramebufferObject(),n.bindFramebuffer(this.getFbos().output),n.setColorMask(!0,!0,!0,!0),null!=e){const{r:t,g:i,b:r,a:s}=e;n.setClearColor(s*t/255,s*i/255,s*r/255,s)}else n.setClearColor(0,0,0,0);n.setDepthWriteEnabled(!0),n.setClearDepth(1),n.clear(n.gl.COLOR_BUFFER_BIT|n.gl.DEPTH_BUFFER_BIT),n.setDepthWriteEnabled(!1)}afterRenderPhases(t){const{context:e}=t;e.bindFramebuffer(this._prevFBO),e.setStencilFunction(Ct.MT.EQUAL,W.Qs,255),e.setStencilTestEnabled(!0),e.setDepthTestEnabled(!1),this.blitTexture(e,this.getFbos().output.colorTexture,Ct.Cj.NEAREST)}beforeRenderLayer(t,e,i){const{context:n,blendMode:r,effects:s,drawPhase:o,requireFBO:a}=t;if(a||wi(o,r,s,i)){const t=n.getBoundFramebufferObject();this._prevBeforeLayerFBOStack.push(t);const{width:e,height:i}=n.getViewport(),r=this.acquireFbo(e,i);n.bindFramebuffer(r),n.setColorMask(!0,!0,!0,!0),n.setClearColor(0,0,0,0),n.setDepthWriteEnabled(!0),n.setClearDepth(1),n.clear(n.gl.COLOR_BUFFER_BIT|n.gl.DEPTH_BUFFER_BIT),n.setDepthWriteEnabled(!1)}n.setDepthWriteEnabled(!1),n.setDepthTestEnabled(!1),n.setStencilTestEnabled(!0),n.setClearStencil(e),n.setStencilWriteMask(255),n.clear(n.gl.STENCIL_BUFFER_BIT)}afterRenderLayer(t,e){const{context:i,blendMode:n,effects:r,requireFBO:s,drawPhase:o}=t;if(s||wi(o,n,r,e)){const s=i.getBoundFramebufferObject();null!=r&&r.length>0&&o===ot.S5.MAP&&(i.setColorMask(!0,!0,!0,!0),this._applyEffects(t,r,s)),i.bindFramebuffer(this._prevBeforeLayerFBOStack.pop()),i.setStencilTestEnabled(!1),i.setStencilWriteMask(0),i.setBlendingEnabled(!0),i.setBlendFunctionSeparate(Ct.dn.ONE,Ct.dn.ONE_MINUS_SRC_ALPHA,Ct.dn.ONE,Ct.dn.ONE_MINUS_SRC_ALPHA),i.setColorMask(!0,!0,!0,!0);const a=null==n||o===ot.S5.HIGHLIGHT||o===ot.S5.LABEL?"normal":n;this._blendEffect.draw(t,s.colorTexture,Ct.Cj.NEAREST,a,e),this.releaseFbo(s)}}renderObject(t,e,i,n){const r=at.d[i];if(!r)return;let s=this._brushCache.get(r);void 0===s&&(s=new r,this._brushCache.set(r,s)),s.prepareState(t),s.draw(t,e,n)}renderObjects(t,e,i,n){const r=at.d[i];if(!r)return;let s=this._brushCache.get(r);void 0===s&&(s=new r,this._brushCache.set(r,s)),s.drawMany(t,e,n)}registerRenderPass(t){const e=t.brushes.map((t=>(this._brushCache.has(t)||this._brushCache.set(t,new t),this._brushCache.get(t))));return new vi(e,t)}blitTexture(t,e,i,n=1){t.setBlendingEnabled(!0),t.setBlendFunctionSeparate(Ct.dn.ONE,Ct.dn.ONE_MINUS_SRC_ALPHA,Ct.dn.ONE,Ct.dn.ONE_MINUS_SRC_ALPHA),t.setColorMask(!0,!0,!0,!0),this._blitRenderer.render(t,e,i,n),this._currentPipelineStateNeedsUpdate=!0}getPostProcessingEffects(t){return this._effectsManager.getPostProcessingEffects(t)}updateFBOs(t,e){if(t!==this._lastWidth||e!==this._lastHeight){if(this._lastWidth=t,this._lastHeight=e,this._fbos){let i;for(i in this._fbos)this._fbos[i].resize(t,e);return}const i=new Zt.R(t,e);i.samplingMode=Ct.Cj.NEAREST,i.wrapMode=Ct.pF.CLAMP_TO_EDGE;const n=new Xe.q(Ct.yQ.DEPTH_STENCIL,t,e);this._stencilBuf=new bi.l(this.context,n),this._fbos={output:new je.H(this.context,i,this._stencilBuf),effect0:new je.H(this.context,i,this._stencilBuf)}}}_applyEffects(t,e,i){const{context:n}=t,r=this._effectsManager.getPostProcessingEffects(e);for(const{postProcessingEffect:e,effect:s}of r)n.bindFramebuffer(i),e.draw(t,i,s);this._currentPipelineStateNeedsUpdate=!0}setShader(t){this._shaderState.shader=t.shader,this._shaderState.uniforms=t.uniforms,this._shaderState.defines=t.defines,this._shaderState.optionalAttributes=t.optionalAttributes,this._shaderState.useComputeBuffer=t.useComputeBuffer??!1}setPipelineState(t){t!==this._currentPipelineState&&(this._currentPipelineState=t,this._currentPipelineStateNeedsUpdate=!0)}submitDraw(t,e){const{shader:i,uniforms:n,defines:r,optionalAttributes:s}=this._shaderState,o=t.context,a=e.getAttributePrecisionPackFactors(),l=this._programCache.getProgram(i,a,n,r??{},s??{});return l.setUniforms(n),l.bind(o),this.updatePipelineState(o),this.setStencilRef(o,e),e.draw(t,i.locationInfo),l.cleanupTemporaryTextures(),{vertexShader:l.vertexShader,fragmentShader:l.fragmentShader}}submitDrawMesh(t,e,i,n){this.submitDrawMeshUntyped(t,e,i,n)}submitDrawMeshUntyped(t,e,i,n){this.setShader(e);const{shader:r,uniforms:s,defines:o,optionalAttributes:a}=this._shaderState,l=this._programCache.getProgram(r,{},s,o??{},a??{});if(l.setUniforms(s),l.bind(t),this.updatePipelineState(t),n)for(const e of n)i.bind(t,e),i.draw(t);else for(let e=0;e<i.parts.length;e++)i.bind(t,e),i.draw(t);i.unbind(t),l.cleanupTemporaryTextures()}updatePipelineState(t){this._currentPipelineStateNeedsUpdate&&(this._currentPipelineStateNeedsUpdate=!1,this._updatePipelineState(t))}_updatePipelineState(t){if(null==this._currentPipelineState)throw new Error("Pipeline state not defined. Call setPipelineState before calling submitDraw ");const{color:e,depth:i,stencil:n}=this._currentPipelineState;if(e){const{blendMode:i,write:n}=e;switch(t.setColorMask(...n),t.setBlendingEnabled(!0),t.setBlendEquation(Ct.Tb.ADD),i){case"composite":t.setBlendFunctionSeparate(Ct.dn.ONE,Ct.dn.ONE_MINUS_SRC_ALPHA,Ct.dn.ONE,Ct.dn.ONE_MINUS_SRC_ALPHA);break;case"additive":t.setBlendFunctionSeparate(Ct.dn.ONE,Ct.dn.ONE,Ct.dn.ONE,Ct.dn.ONE);break;case"custom":{const{blendParameters:i}=e,{dstAlpha:n,dstRGB:r,srcAlpha:s,srcRGB:o}=i;t.setBlendFunctionSeparate(o,r,s,n);break}case"delete":t.setBlendEquation(Ct.Tb.REVERSE_SUBTRACT),t.setBlendFunctionSeparate(Ct.dn.ONE,Ct.dn.ONE_MINUS_SRC_ALPHA,Ct.dn.ONE,Ct.dn.ONE_MINUS_SRC_ALPHA)}}if(i){const{test:e,write:n}=i;n?(t.setDepthWriteEnabled(!0),t.setDepthRange(n.zNear,n.zFar)):t.setDepthWriteEnabled(!1),e?(t.setDepthTestEnabled(!0),t.setDepthFunction(e)):t.setDepthTestEnabled(!1)}else t.setDepthTestEnabled(!1),t.setDepthWriteEnabled(!1);if(n){const{test:e,write:i}=n;if(e){const{compare:i,mask:n,op:r,ref:s}=e;t.setStencilTestEnabled(!0),"function"!=typeof s&&t.setStencilFunctionSeparate(Ct.Y7.FRONT_AND_BACK,i,s,n),t.setStencilOpSeparate(Ct.Y7.FRONT_AND_BACK,r.fail,r.zFail,r.zPass)}else t.setStencilTestEnabled(!1);if(i){const{mask:e}=i;t.setStencilWriteMask(e)}else t.setStencilWriteMask(0)}else t.setStencilTestEnabled(!1),t.setStencilWriteMask(0)}setStencilRef(t,e){if(null==this._currentPipelineState)throw new Error("Pipeline state not defined. Call setPipelineState before calling submitDraw ");const{stencil:i}=this._currentPipelineState;if(i){const{test:n}=i;if(n){const{compare:i,mask:r,ref:s}=n;if("function"==typeof s){const n=e.getStencilReference();if(null===n)throw new Error("InternalError: Stencil reference expected for target but not defined");t.setStencilFunctionSeparate(Ct.Y7.FRONT_AND_BACK,i,n,r)}}}}}function wi(t,e,i,n){return t!==ot.S5.LABEL_ALPHA&&t!==ot.S5.LABEL&&t!==ot.S5.HIGHLIGHT&&(1!==n||null!=e&&"normal"!==e||null!=i&&i.length>0)}var Ti=i(28055),Mi=i(58975);class Pi{constructor(){this._candidateTiles=[]}schedule(t){this._candidateTiles.includes(t)||this._candidateTiles.push(t)}reshuffle(t){const e=[];for(const i of this._candidateTiles)t>0?(i.reshuffle(),t--):e.push(i);this._candidateTiles=e}}var Ai=i(63812),Ci=i(99483),Ii=i(25568),Ei=i(74427);class Ri extends Q.m{constructor(t,e){super(),this.meshWriterRegistry=new Ci.o,this._trash=new Set,this._renderRemainingTime=0,this._lastFrameRenderTime=0,this._renderRequested=(0,a.v)(!1),this.stage=this,this._stationary=!0,this._reshuffleManager=new Pi,this._canvas=new st(t),this.context=new Ei.e(this._canvas.gl,e.contextOptions??{}),this.painter=new Si(this.context,this),this._cimAnalyzer=new Z(this.painter.textureManager.resourceManager),(0,r.A)("esri-2d-profiler")&&(this._debugOutput=document.createElement("div"),this._debugOutput.setAttribute("style","margin: 24px 64px; position: absolute; color: red;"),t.appendChild(this._debugOutput));const i=()=>this.highlightGradient;this._renderParameters={drawPhase:0,state:this.state,pixelRatio:window.devicePixelRatio,stationary:!1,globalOpacity:1,blendMode:null,deltaTime:-1,time:0,inFadeTransition:!1,effects:null,context:this.context,painter:this.painter,timeline:e.timeline||new Ii.K,renderingOptions:e.renderingOptions,requestRender:()=>this.requestRender(),allowDelayedRender:!1,requireFBO:!1,profiler:new Mi.U(this.context,this._debugOutput),dataUploadCounter:0,get highlightGradient(){return i()},reshuffleManager:this._reshuffleManager,backgroundColor:e.backgroundColor},this._taskHandle=(0,o.mg)({render:t=>this.renderFrame(t)}),this._taskHandle.pause(),this._lostWebGLContextHandle=this._canvas.events.on("webgl-context-lost",(t=>this.emit("webgl-error",{error:new n.A("webgl-context-lost",t.statusMessage)}))),this._bufferPool=new Ti.o,(0,Ai.Wn)()}destroy(){(0,Ai.n_)(this.context),this.removeAllChildren(),this._emptyTrash(),this._taskHandle=(0,s.xt)(this._taskHandle),this._lostWebGLContextHandle=(0,s.xt)(this._lostWebGLContextHandle),this._canvas.destroy(),this._debugOutput?.parentNode?.removeChild(this._debugOutput),this._bufferPool.destroy(),this.painter.dispose(),this.context.dispose(),this._canvas=null}get textureManager(){return this.painter.textureManager}get backgroundColor(){return this._renderParameters.backgroundColor}set backgroundColor(t){this._renderParameters.backgroundColor=t,this.requestRender()}get bufferPool(){return this._bufferPool}get cimAnalyzer(){return this._cimAnalyzer}get renderingOptions(){return this._renderingOptions}set renderingOptions(t){this._renderingOptions=t,this.requestRender()}get renderRequested(){return this._renderRequested.value}get state(){return this._state}set state(t){this._state=t,this.requestRender()}get stationary(){return this._stationary}set stationary(t){this._stationary!==t&&(this._stationary=t,this.requestRender())}trashDisplayObject(t){this._trash.add(t),this.requestRender()}untrashDisplayObject(t){return this._trash.delete(t)}requestRender(){this._renderRemainingTime=2e3,this.renderRequested||(this._renderRequested.value=!0,this._taskHandle.resume())}renderFrame(t){const e=this._lastFrameRenderTime?t.time-this._lastFrameRenderTime:0;this._renderRemainingTime-=e,this._renderRemainingTime<=0&&this._taskHandle.pause(),this._lastFrameRenderTime=t.time,this._renderRequested.value=!1,this._renderParameters.state=this._state,this._renderParameters.stationary=this.stationary,this._renderParameters.pixelRatio=window.devicePixelRatio,this._renderParameters.globalOpacity=1,this._renderParameters.time=t.time,this._renderParameters.deltaTime=t.deltaTime,this._renderParameters.effects=null,this.processRender(this._renderParameters),this._emptyTrash()}_createTransforms(){return{displayViewScreenMat3:(0,l.vt)()}}renderChildren(t){for(const e of this.children)e.beforeRender(t);this._reshuffleManager.reshuffle(W.O5),this._canvas.render(t,(()=>this._renderChildren(this.children,t)));for(const e of this.children)e.afterRender(t)}_renderChildren(t,e){const i=this.context;this.painter.textureUploadManager.upload(),i.resetInfo(),e.profiler.recordStart("drawLayers"),e.dataUploadCounter=0,this.painter.beforeRenderPhases(e,e.backgroundColor,this.state.padding),e.drawPhase=ot.S5.MAP;for(const i of t)i.processRender(e);if(this.children.some((t=>t.hasHighlight))){e.drawPhase=ot.S5.HIGHLIGHT;for(const i of t)i.processRender(e)}if(this.children.some((t=>t.hasLabels))){e.drawPhase=ot.S5.LABEL;for(const i of t)i.processRender(e)}if((0,r.A)("esri-tiles-debug")){e.drawPhase=ot.S5.DEBUG;for(const i of t)i.processRender(e)}this.painter.afterRenderPhases(e),e.profiler.recordEnd("drawLayers"),i.logInfo()}doRender(t){const e=this.context,{state:i,pixelRatio:n}=t;this._canvas.resize(t),e.setViewport(0,0,n*i.size[0],n*i.size[1]),e.setDepthWriteEnabled(!0),e.setStencilWriteMask(255),this.renderChildren(t)}async takeScreenshot(t,e,n,r){const s=Math.round(this.state.size[0]*t.resolutionScale),o=Math.round(this.state.size[1]*t.resolutionScale),a=t.resolutionScale,l=this.context,c=this._state.clone();if(null!=r){const t=c.viewpoint;c.viewpoint.rotation=r,c.viewpoint=t}const u={...this._renderParameters,drawPhase:null,globalOpacity:1,stationary:!0,state:c,pixelRatio:a,time:performance.now(),deltaTime:0,blendMode:null,effects:null,inFadeTransition:!1,backgroundColor:n},h=new Zt.R(s,o);h.wrapMode=Ct.pF.CLAMP_TO_EDGE,h.internalFormat=Ct.H0.RGBA8,h.isImmutable=!0;const d=new je.H(l,h,new Xe.q(Ct.yQ.DEPTH_STENCIL,s,o)),f=l.getBoundFramebufferObject(),p=l.getViewport();l.bindFramebuffer(d),l.setViewport(0,0,s,o),this._renderChildren(e??this.children,u);const _=this._readbackScreenshot(d,{...t.cropArea,y:o-(t.cropArea.y+t.cropArea.height)});l.bindFramebuffer(f),l.setViewport(p.x,p.y,p.width,p.height),this.requestRender();const m=await _;let g;return 1===t.outputScale?g=m:(g=new ImageData(Math.round(m.width*t.outputScale),Math.round(m.height*t.outputScale)),(await Promise.resolve().then(i.bind(i,94385))).resampleHermite(m,g,!0)),d.dispose(),g}async _readbackScreenshot(t,e){const n=(await Promise.resolve().then(i.bind(i,94385))).createEmptyImageData(e.width,e.height,document.createElement("canvas"));return await t.readPixelsAsync(e.x,e.y,e.width,e.height,Ct.Ab.RGBA,Ct.ld.UNSIGNED_BYTE,new Uint8Array(n.data.buffer)),n}_emptyTrash(){for(;this._trash.size>0;){const t=Array.from(this._trash);this._trash.clear();for(const e of t)e.processDetach()}}}var Oi=i(79083),Fi=i(56625),zi=i(17215),Di=i(13237),Li=i(77472),ki=i(14606),Ni=i(28181),Bi=i(20248),Vi=i(77515),Ui=i(90683),Gi=i(8626);class Yi extends ke.j{constructor(){super(...arguments),this.type=Ne.N.Magnifier,this._resourcePixelRatio=1,this._position=[0,0,0,0],this.shaders={magnifier:new Gi.u}}updateResources(t,e,i,n){t.pixelRatio!==this._resourcePixelRatio&&this._destroyResources(),this._readbackTexture||this._initializeResources(t,e,i,n);const{context:r,pixelRatio:s}=t,{factor:o,offset:a,position:l}=n,{size:c}=t.state,u=n.size*s,h=1/o,d=Math.ceil(h*u);this._readbackTexture.resize(d,d);const f=s*c[0],p=s*c[1],_=.5*d,m=.5*d,g=(0,it.qE)(s*l.x,_,f-_-1),y=(0,it.qE)(p-s*l.y,m,p-m-1),v=g-_,x=y-m,b=this._readbackTexture;r.bindTexture(b,0),r.gl.copyTexImage2D(b.descriptor.target,0,b.descriptor.pixelFormat,v,x,d,d,0);const S=(g+a.x*s)/f*2-1,w=(y-a.y*s)/p*2-1,T=u/f*2,M=u/p*2;this._position[0]=S,this._position[1]=w,this._position[2]=T,this._position[3]=M}render(t,e){const{context:i,painter:n}=t;n.setPipelineState(Le.i);const r={readbackTexture:{texture:this._readbackTexture,unit:0},maskTexture:{texture:this._maskTexture,unit:7},overlayTexture:{texture:this._overlayTexture,unit:6},drawPos:this._position,...e};n.submitDrawMesh(i,{shader:this.shaders.magnifier,uniforms:{config:r},defines:null,optionalAttributes:null,useComputeBuffer:!1},n.quadMesh)}shutdown(){this._destroyResources()}_initializeResources(t,e,i,n){const r=t.context;this._resourcePixelRatio=t.pixelRatio;const s=Math.ceil(n.size*t.pixelRatio);i.width=s,i.height=s;const o=new Zt.R;o.internalFormat=Ct.Ab.RGBA,o.wrapMode=Ct.pF.CLAMP_TO_EDGE,o.samplingMode=Ct.Cj.NEAREST,o.flipped=!0,o.preMultiplyAlpha=!(0,Ui.XJ)(i.src)||!t.context.driverTest.svgPremultipliesAlpha.result,this._overlayTexture=new Ht.g(r,o,i),e.width=s,e.height=s,o.pixelFormat=o.internalFormat=Ct.Ab.ALPHA,this._maskTexture=new Ht.g(r,o,e);const a=1/n.factor;o.pixelFormat=o.internalFormat=Ct.Ab.RGBA,o.width=o.height=Math.ceil(a*s),o.samplingMode=Ct.Cj.LINEAR,o.flipped=!1,this._readbackTexture=new Ht.g(r,o)}_destroyResources(){(0,s.WD)(this._maskTexture),(0,s.WD)(this._overlayTexture),(0,s.WD)(this._readbackTexture)}}var Wi=i(9030);class Hi extends Vi.q{constructor(){super(),this._handles=new ki.A,this._magnifierTechnique=new Yi,this.updatingHandles=new Bi.U,this.visible=!1}destroy(){this._handles=(0,s.pR)(this._handles),this._magnifierTechnique.shutdown(),this._resourcesTask=(0,s.DC)(this._resourcesTask)}get backgroundColor(){return this._backgroundColor}set backgroundColor(t){this._backgroundColor=t,this.requestRender()}get magnifier(){return this._magnifier}set magnifier(t){this._magnifier=t,this._handles.removeAll(),this._handles.add([(0,Ni.watch)((()=>t.version),(()=>{this.visible=t.visible&&null!=t.position&&t.size>0,this.requestRender()}),Ni.Vh),(0,Ni.watch)((()=>[t.maskUrl,t.overlayUrl]),(()=>this._reloadResources())),(0,Ni.watch)((()=>t.size),(()=>{this._magnifierTechnique.shutdown(),this.requestRender()}))])}_createTransforms(){return{displayViewScreenMat3:(0,l.vt)()}}doRender(t){if(!this._resourcesTask)return void this._reloadResources();if(t.drawPhase!==ot.S5.MAP||!this._canRender())return;const e=this._magnifier;if(null==e.position)return;this._magnifierTechnique.updateResources(t,this._mask,this._overlay,e);const i=this.backgroundColor,n=i?[i.a*i.r/255,i.a*i.g/255,i.a*i.b/255,i.a]:[1,1,1,1];this._magnifierTechnique.render(t,{background:n,maskEnabled:e.maskEnabled?1:0,overlayEnabled:e.overlayEnabled?1:0})}_canRender(){return this._mask&&this._overlay&&null!=this._magnifier}_reloadResources(){this._resourcesTask&&this._resourcesTask.abort();const t=null!=this._magnifier?this._magnifier.maskUrl:null,e=null!=this._magnifier?this._magnifier.overlayUrl:null;this._resourcesTask=(0,Li.UT)((async n=>{const r=null==t||null==e?async function(t){const e=i.e(4550).then(i.bind(i,31972)),n=i.e(9552).then(i.bind(i,33836)),r=(0,Wi.D)((await e).default,{signal:t}),s=(0,Wi.D)((await n).default,{signal:t}),o={mask:await r,overlay:await s};return(0,kt.Te)(t),o}(n):null,s=null!=t?(0,Dt.A)(t,{responseType:"image",signal:n}).then((t=>t.data)):r.then((t=>t.mask)),o=null!=e?(0,Dt.A)(e,{responseType:"image",signal:n}).then((t=>t.data)):r.then((t=>t.overlay)),[a,l]=await Promise.all([s,o]);this._mask=a,this._overlay=l,this._magnifierTechnique.shutdown(),this.requestRender()})),this.updatingHandles.addPromise(this._resourcesTask.promise)}}var Zi=i(62938),qi=i(13786),$i=i(14583),ji=i(46157),Xi=i(65298),Ki=i(7415),Qi=i(57652),Ji=i(98578);class tn extends ke.j{constructor(){super(...arguments),this.type=Ne.N.Grid,this.shaders={grid:new Ji.K}}render(t,e){const{context:i,painter:n}=t;n.setPipelineState(Le.i),n.submitDrawMesh(i,{shader:this.shaders.grid,uniforms:e,defines:null,optionalAttributes:null,useComputeBuffer:!1},n.quadMesh)}}var en=i(3101),nn=i(11765);const rn=(0,Ie.vt)();class sn extends Vi.q{constructor(){super(),this._handles=new ki.A,this._projectedCenter=null,this._metersPerSRUnit=null,this._technique=new tn,this._grid=null,this.visible=!0}destroy(){this._handles=(0,s.pR)(this._handles),this._technique.shutdown()}get grid(){return this._grid}set grid(t){this._grid=t,this._handles.removeAll(),this._handles.add([(0,Ni.watch)((()=>t?.center),(()=>{this._projectedCenter=null}),Ni.Vh),(0,Ni.watch)((()=>[t?.center,t?.dynamicScaling,t?.majorLineColor,t?.majorLineInterval,t?.minorLineColor,t?.rotateWithMap,t?.rotation,t?.spacing,t?.units]),(()=>this.requestRender()),Ni.Vh)])}_createTransforms(){return{displayViewScreenMat3:(0,l.vt)()}}doRender(t){if(t.drawPhase!==ot.S5.MAP||null==this.grid||!this.visible)return;const{spacing:e,units:i,majorLineInterval:n,dynamicScaling:r,majorLineColor:s,minorLineColor:o}=this.grid;if(0===e)return;if(this._updateDerivedValues(t),null==this._projectedCenter||null==this._metersPerSRUnit)return;const{scale:a,spatialReference:l}=t.state,c=(0,Zi.oU)(e,i,"meters"),u=this._metersPerSRUnit*(0,Ki.i1)(a,l),h=c/u;if(!r&&h<en.b)return;const d=c*(0,nn.Ge)(n,h,r);this._updateTransform(t,u,d),this._technique.render(t,{transform:{dvs:this.transforms.displayViewScreenMat3},config:{pxPerCell:d/u,minorLineColor:on(o),majorLineColor:on(s),majorLineInterval:n,halfWidth:.25,aaWidth:.5}})}_updateDerivedValues(t){if(!this.grid)return;const{center:e}=this.grid,{spatialReference:i}=t.state;this._projectedCenter&&(0,Qi.aI)(this._projectedCenter.spatialReference,i)||(this._metersPerSRUnit=null,(0,Qi.aI)(e.spatialReference,i)?this._projectedCenter=e:(0,ji.isLoadedOrLoadFor)(e.spatialReference,i)?this._projectedCenter=(0,ji.project)(e,i):this.requestRender()),null==this._metersPerSRUnit&&null!=this._projectedCenter&&(this._metersPerSRUnit=(0,nn.WT)(this._projectedCenter))}_updateTransform(t,e,i){const{grid:n}=this,{center:r,rotation:s,size:o,spatialReference:a}=t.state;if(null==n||null==this._projectedCenter||null==this._metersPerSRUnit)return;const l=e*(o[0]/2),c=e*(o[1]/2),u=this._metersPerSRUnit/i,h=this._projectedCenter,d=(0,it.kU)(n.rotation),f=(0,it.kU)(s),p=this.transforms.displayViewScreenMat3;(0,Ce.$0)(p,-d);const _=a.isWrappable?(0,Xi.O7)(h.x,r[0],a):h.x,m=(0,qi.hZ)(rn,_,h.y),g=(0,qi.jb)(rn,r,m);(0,qi.hs)(g,g,u),n.rotateWithMap||(0,qi.e$)(g,g,$i.uY,-f),(0,qi.e$)(g,g,$i.uY,-d),(0,qi.hs)(g,g,1/n.majorLineInterval),function(t,e){t[0]=e[0]-Math.trunc(e[0]),t[1]=e[1]-Math.trunc(e[1])}(g,g),(0,qi.hs)(g,g,n.majorLineInterval),(0,qi.e$)(g,g,$i.uY,d),(0,Ce.Tl)(p,p,g),n.rotateWithMap&&(0,Ce.e$)(p,p,f);const y=(0,qi.hZ)(rn,l/i,c/i);(0,Ce.Oe)(p,p,y)}}function on(t){const[e,i,n,r]=t.toArray().map((t=>t/255));return[e*r,i*r,n*r,r]}},13237:function(t,e,i){i.d(e,{A:function(){return W}});var n=i(53804),r=i(20510),s=i(83525),o=i(95929),a=i(23502),l=(i(58941),i(40633),i(13798),i(65953)),c=i(45532),u=i(97849),h=i(11664),d=i(13520),f=i(87922);const p="esri-zoom-box",_={container:`${p}__container`,overlay:`${p}__overlay`,background:`${p}__overlay-background`,box:`${p}__outline`},m="Shift";let g=class extends s.A{constructor(t){super(t),this._container=null,this._overlay=null,this._backgroundShape=null,this._boxShape=null,this._box={x:0,y:0,width:0,height:0},this._rafId=null,this._redraw=this._redraw.bind(this)}destroy(){this.view=null}set view(t){this.removeAllHandles(),this._destroyOverlay(),this._set("view",t),t&&this.addHandles([t.on("drag",[m],(t=>this._handleDrag(t,1)),f.o.INTERNAL),t.on("drag",[m,"Control"],(t=>this._handleDrag(t,-1)),f.o.INTERNAL)])}_start(){this._createContainer(),this._createOverlay(),this.navigation.begin()}_update(t,e,i,n){this._box.x=t,this._box.y=e,this._box.width=i,this._box.height=n,this._rafId||(this._rafId=requestAnimationFrame(this._redraw))}_end(t,e,i,n,r){const s=this.view,o=s.toMap((0,d.tc)(t+.5*i,e+.5*n));let a=Math.max(i/s.width,n/s.height);-1===r&&(a=1/a),this._destroyOverlay(),this.navigation.end(),s.goTo({center:o,scale:s.scale*a},{animationMode:"always",duration:(0,h.s)()})}_updateBox(t,e,i,n){const r=this._boxShape;r.setAttributeNS(null,"x",""+t),r.setAttributeNS(null,"y",""+e),r.setAttributeNS(null,"width",""+i),r.setAttributeNS(null,"height",""+n),r.setAttributeNS(null,"class",_.box)}_updateBackground(t,e,i,n){this._backgroundShape.setAttributeNS(null,"d",this._toSVGPath(t,e,i,n,this.view.width,this.view.height))}_createContainer(){const t=document.createElement("div");t.className=_.container,this.view.root.appendChild(t),this._container=t}_createOverlay(){const t=this.view.width,e=this.view.height,i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttributeNS(null,"d","M 0 0 L "+t+" 0 L "+t+" "+e+" L 0 "+e+" Z"),i.setAttributeNS(null,"class",_.background);const n=document.createElementNS("http://www.w3.org/2000/svg","rect"),r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),r.setAttributeNS(null,"class",_.overlay),r.appendChild(i),r.appendChild(n),this._container.appendChild(r),this._backgroundShape=i,this._boxShape=n,this._overlay=r}_destroyOverlay(){this._container&&this._container.parentNode&&this._container.parentNode.removeChild(this._container),this._container=this._backgroundShape=this._boxShape=this._overlay=null}_toSVGPath(t,e,i,n,r,s){const o=t+i,a=e+n;return"M 0 0 L "+r+" 0 L "+r+" "+s+" L 0 "+s+" ZM "+t+" "+e+" L "+t+" "+a+" L "+o+" "+a+" L "+o+" "+e+" Z"}_handleDrag(t,e){const i=t.x,n=t.y,r=t.origin.x,s=t.origin.y;let o,a,l,c;switch(i>r?(o=r,l=i-r):(o=i,l=r-i),n>s?(a=s,c=n-s):(a=n,c=s-n),t.action){case"start":this._start();break;case"update":this._update(o,a,l,c);break;case"end":this._end(o,a,l,c,e)}t.stopPropagation()}_redraw(){if(!this._rafId)return;if(this._rafId=null,!this._overlay)return;const{x:t,y:e,width:i,height:n}=this._box;this._updateBox(t,e,i,n),this._updateBackground(t,e,i,n),this._rafId=requestAnimationFrame(this._redraw)}};(0,n._)([(0,a.MZ)()],g.prototype,"navigation",void 0),(0,n._)([(0,a.MZ)()],g.prototype,"view",null),g=(0,n._)([(0,l.$)("esri.views.2d.navigation.ZoomBox")],g);const y=g;i(50917);var v=i(28181),x=i(20551),b=i(32501);class S{constructor(t){this._gain=t,this.lastValue=void 0,this.filteredDelta=void 0}update(t){if(this.hasLastValue()){const e=this.computeDelta(t);this._updateDelta(e)}this.lastValue=t}reset(){this.lastValue=void 0,this.filteredDelta=void 0}hasLastValue(){return void 0!==this.lastValue}hasFilteredDelta(){return void 0!==this.filteredDelta}computeDelta(t){return void 0===this.lastValue?NaN:t-this.lastValue}_updateDelta(t){void 0!==this.filteredDelta?this.filteredDelta=(1-this._gain)*this.filteredDelta+this._gain*t:this.filteredDelta=t}}class w{constructor(t,e,i){this._initialVelocity=t,this._stopVelocity=e,this._friction=i,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(t){return t>this.duration}get friction(){return this._friction}value(t){return this.valueFromInitialVelocity(this._initialVelocity,t)}valueDelta(t,e){const i=this.value(t);return this.value(t+e)-i}valueFromInitialVelocity(t,e){e=Math.min(e,this.duration);const i=1-this.friction;return t*(i**e-1)/Math.log(i)}}class T extends w{constructor(t,e,i,n,r){super(t,e,i),this._sceneVelocity=n,this.direction=r}value(t){return super.valueFromInitialVelocity(this._sceneVelocity,t)}}class M{constructor(t=300,e=12,i=.84){this._minimumInitialVelocity=t,this._stopVelocity=e,this._friction=i,this.enabled=!0,this._time=new S(.6),this._screen=[new S(.4),new S(.4)],this._scene=[new S(.6),new S(.6),new S(.6)],this._tmpDirection=(0,b.vt)()}add(t,e,i){if(this.enabled){if(this._time.hasLastValue()&&this._time.computeDelta(i)<.015)return;this._screen[0].update(t[0]),this._screen[1].update(t[1]),this._scene[0].update(e[0]),this._scene[1].update(e[1]),this._scene[2].update(e[2]),this._time.update(i)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._scene[0].reset(),this._scene[1].reset(),this._scene[2].reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;const t=this._screen[0].filteredDelta,e=this._screen[1].filteredDelta,i=null==t||null==e?0:Math.sqrt(t*t+e*e),n=this._time.filteredDelta,r=null==n||null==i?0:i/n;return Math.abs(r)<this._minimumInitialVelocity?null:this.createMomentum(r,this._stopVelocity,this._friction)}createMomentum(t,e,i){(0,x.i)(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const n=(0,x.l)(this._tmpDirection);n>0&&(0,x.h)(this._tmpDirection,this._tmpDirection,1/n);const r=this._time.filteredDelta;return new T(t,e,i,null==r?0:n/r,this._tmpDirection)}}let P=class extends s.A{constructor(t){super(t),this.animationTime=0,this.momentumEstimator=new M(500,6,.92),this.momentum=null,this.tmpMomentum=(0,b.vt)(),this.momentumFinished=!1,this.viewpoint=new r.A({targetGeometry:new c.default,scale:0,rotation:0}),this._previousDrag=null,(0,v.when)((()=>this.momentumFinished),(()=>this.navigation.stop()))}begin(t,e){this.navigation.begin(),this.momentumEstimator.reset(),this.addToEstimator(e),this._previousDrag=e}update(t,e){this.addToEstimator(e);let i=e.center.x,n=e.center.y;const r=this._previousDrag;i=r?r.center.x-i:-i,n=r?n-r.center.y:n,t.viewpoint=(0,u.aA)(this.viewpoint,t.viewpoint,[i||0,n||0]),this._previousDrag=e}end(t,e){this.addToEstimator(e);const i=t.navigation.effectiveMomentumEnabled;this.momentum=i?this.momentumEstimator.evaluateMomentum():null,this.animationTime=0,this.momentum&&this.onAnimationUpdate(t),this._previousDrag=null,this.navigation.end()}addToEstimator(t){const e=t.center.x,i=t.center.y,n=(0,d.gs)(-e,i),r=(0,b.fA)(-e,i,0);this.momentumEstimator.add(n,r,.001*t.timestamp)}onAnimationUpdate(t){this.navigation.animationManager?.animateContinuous(t.viewpoint,((e,i)=>{const{momentum:n,animationTime:r,tmpMomentum:s}=this,o=.001*i;if(!(this.momentumFinished=!n||n.isFinished(r))){const i=n.valueDelta(r,o);(0,x.h)(s,n.direction,i),(0,u.aA)(e,e,s),t.constraints.constrainByGeometry(e)}this.animationTime+=o}))}stopMomentumNavigation(){this.momentum&&(this.momentumEstimator.reset(),this.momentum=null,this.navigation.stop())}};(0,n._)([(0,a.MZ)()],P.prototype,"momentumFinished",void 0),(0,n._)([(0,a.MZ)()],P.prototype,"viewpoint",void 0),(0,n._)([(0,a.MZ)()],P.prototype,"navigation",void 0),P=(0,n._)([(0,l.$)("esri.views.2d.navigation.actions.Pan")],P);const A=P;var C=i(13786),I=i(1932),E=i(15774);class R{constructor(t=2.5,e=.01,i=.95,n=12){this._minimumInitialVelocity=t,this._stopVelocity=e,this._friction=i,this._maxVelocity=n,this.enabled=!0,this.value=new S(.8),this.time=new S(.3)}add(t,e){if(this.enabled&&null!=e){if(this.time.hasLastValue()){if(this.time.computeDelta(e)<.01)return;if(this.value.hasFilteredDelta()){const e=this.value.computeDelta(t);this.value.filteredDelta*e<0&&this.value.reset()}}this.time.update(e),this.value.update(t)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let t=this.value.filteredDelta/this.time.filteredDelta;return t=(0,E.qE)(t,-this._maxVelocity,this._maxVelocity),Math.abs(t)<this._minimumInitialVelocity?null:this.createMomentum(t,this._stopVelocity,this._friction)}createMomentum(t,e,i){return new w(t,e,i)}}class O extends R{constructor(t=3,e=.01,i=.95,n=12){super(t,e,i,n)}add(t,e){const i=this.value.lastValue;if(null!=i){let e=t-i;for(;e>Math.PI;)e-=2*Math.PI;for(;e<-Math.PI;)e+=2*Math.PI;t=i+e}super.add(t,e)}}class F extends w{constructor(t,e,i){super(t,e,i)}value(t){const e=super.value(t);return Math.exp(e)}valueDelta(t,e){const i=super.value(t),n=super.value(t+e)-i;return Math.exp(n)}}class z extends R{constructor(t=2.5,e=.01,i=.95,n=12){super(t,e,i,n)}add(t,e){super.add(Math.log(t),e)}createMomentum(t,e,i){return new F(t,e,i)}}let D=class extends s.A{constructor(t){super(t),this._animationTime=0,this._momentumFinished=!1,this._previousAngle=0,this._previousRadius=0,this._previousCenter=null,this._rotationMomentumEstimator=new O(.6,.15,.95),this._rotationDirection=1,this._startAngle=0,this._startRadius=0,this._updateTimestamp=null,this._zoomDirection=1,this._zoomMomentumEstimator=new z,this._zoomOnly=null,this.viewpoint=new r.A({targetGeometry:new c.default,scale:0,rotation:0}),this.zoomMomentum=null,this.rotateMomentum=null,this.addHandles((0,v.when)((()=>this._momentumFinished),(()=>this.navigation.stop())))}begin(t,e){this.navigation.begin(),this._rotationMomentumEstimator.reset(),this._zoomMomentumEstimator.reset(),this._zoomOnly=null,this._previousAngle=this._startAngle=e.angle,this._previousRadius=this._startRadius=e.radius,this._previousCenter=e.center,this._updateTimestamp=null,t.constraints.rotationEnabled&&this.addToRotateEstimator(0,e.timestamp),this.addToZoomEstimator(e,1)}update(t,e){null===this._updateTimestamp&&(this._updateTimestamp=e.timestamp);const i=e.angle,n=e.radius,r=e.center,s=Math.abs(180*(i-this._startAngle)/Math.PI),o=Math.abs(n-this._startRadius),a=this._startRadius/n;if(this._previousRadius&&this._previousCenter){const l=n/this._previousRadius;let c=180*(i-this._previousAngle)/Math.PI;this._rotationDirection=c>=0?1:-1,this._zoomDirection=l>=1?1:-1,t.constraints.rotationEnabled?(null===this._zoomOnly&&e.timestamp-this._updateTimestamp>200&&(this._zoomOnly=o-s>0),null===this._zoomOnly||this._zoomOnly?c=0:this.addToRotateEstimator(i-this._startAngle,e.timestamp)):c=0,this.addToZoomEstimator(e,a),this.navigation.setViewpoint([r.x,r.y],1/l,c,[this._previousCenter.x-r.x,r.y-this._previousCenter.y])}this._previousAngle=i,this._previousRadius=n,this._previousCenter=r}end(t){this.rotateMomentum=this._rotationMomentumEstimator.evaluateMomentum(),this.zoomMomentum=this._zoomMomentumEstimator.evaluateMomentum(),this._animationTime=0,(this.rotateMomentum||this.zoomMomentum)&&this.onAnimationUpdate(t),this.navigation.end()}addToRotateEstimator(t,e){this._rotationMomentumEstimator.add(t,.001*e)}addToZoomEstimator(t,e){this._zoomMomentumEstimator.add(e,.001*t.timestamp)}canZoomIn(t){const e=t.scale,i=t.constraints.effectiveMaxScale;return 0===i||e>i}canZoomOut(t){const e=t.scale,i=t.constraints.effectiveMinScale;return 0===i||e<i}onAnimationUpdate(t){this.navigation.animationManager?.animateContinuous(t.viewpoint,((e,i)=>{const n=!this.canZoomIn(t)&&this._zoomDirection>1||!this.canZoomOut(t)&&this._zoomDirection<1,r=!this.rotateMomentum||this.rotateMomentum.isFinished(this._animationTime),s=n||!this.zoomMomentum||this.zoomMomentum.isFinished(this._animationTime),o=.001*i;if(this._momentumFinished=r&&s,!this._momentumFinished){const i=this.rotateMomentum?Math.abs(this.rotateMomentum.valueDelta(this._animationTime,o))*this._rotationDirection*180/Math.PI:0;let n=this.zoomMomentum?Math.abs(this.zoomMomentum.valueDelta(this._animationTime,o)):1;const r=(0,I.vt)(),s=(0,I.vt)();if(this._previousCenter){(0,C.hZ)(r,this._previousCenter.x,this._previousCenter.y),(0,u.b8)(s,t.size,t.padding),(0,C.WQ)(r,r,s);const{constraints:o,scale:a}=t,l=a*n;n<1&&!o.canZoomInTo(l)?(n=a/o.effectiveMaxScale,this.zoomMomentum=null,this.rotateMomentum=null):n>1&&!o.canZoomOutTo(l)&&(n=a/o.effectiveMinScale,this.zoomMomentum=null,this.rotateMomentum=null),(0,u.WK)(e,t.viewpoint,n,i,r,t.size),t.constraints.constrainByGeometry(e)}}this._animationTime+=o}))}stopMomentumNavigation(){(this.rotateMomentum||this.zoomMomentum)&&(this.rotateMomentum&&(this._rotationMomentumEstimator.reset(),this.rotateMomentum=null),this.zoomMomentum&&(this._zoomMomentumEstimator.reset(),this.zoomMomentum=null),this.navigation.stop())}};(0,n._)([(0,a.MZ)()],D.prototype,"_momentumFinished",void 0),(0,n._)([(0,a.MZ)()],D.prototype,"viewpoint",void 0),(0,n._)([(0,a.MZ)()],D.prototype,"navigation",void 0),D=(0,n._)([(0,l.$)("esri.views.2d.navigation.actions.Pinch")],D);const L=D,k=(0,I.vt)(),N=(0,I.vt)();let B=class extends s.A{constructor(t){super(t),this._previousCenter=(0,I.vt)(),this.viewpoint=new r.A({targetGeometry:new c.default,scale:0,rotation:0})}begin(t,e){this.navigation.begin(),(0,C.hZ)(this._previousCenter,e.center.x,e.center.y)}update(t,e){const{state:{size:i,padding:n}}=t;(0,C.hZ)(k,e.center.x,e.center.y),(0,u.iB)(N,i,n),t.viewpoint=(0,u.tj)(this.viewpoint,t.state.paddedViewState.viewpoint,(0,u.s5)(N,this._previousCenter,k)),(0,C.C)(this._previousCenter,k)}end(){this.navigation.end()}};(0,n._)([(0,a.MZ)()],B.prototype,"viewpoint",void 0),(0,n._)([(0,a.MZ)()],B.prototype,"navigation",void 0),B=(0,n._)([(0,l.$)("esri.views.2d.navigation.actions.Rotate")],B);const V=B,U=new r.A({targetGeometry:new c.default}),G=[0,0];let Y=class extends s.A{constructor(t){super(t),this._endTimer=null,this._lastEventTimestamp=null,this.animationManager=null,this.interacting=!1}initialize(){this.pan=new A({navigation:this}),this.rotate=new V({navigation:this}),this.pinch=new L({navigation:this}),this.zoomBox=new y({view:this.view,navigation:this})}destroy(){this.pan=(0,o.pR)(this.pan),this.rotate=(0,o.pR)(this.rotate),this.pinch=(0,o.pR)(this.pinch),this.zoomBox=(0,o.pR)(this.zoomBox),this.animationManager=null}begin(){this.stop(),this._set("interacting",!0)}end(){this._lastEventTimestamp=performance.now(),this._startTimer(250)}async zoom(t,e=this._getDefaultAnchor()){if(this.begin(),this.view.constraints.snapToZoom&&this.view.constraints.effectiveLODs)return t<1?this.zoomIn(e):this.zoomOut(e);this.setViewpoint(e,t,0,[0,0])}async zoomIn(t){const e=this.view,i=e.constraints.snapToNextScale(e.scale);return this._zoomToScale(i,t)}async zoomOut(t){const e=this.view,i=e.constraints.snapToPreviousScale(e.scale);return this._zoomToScale(i,t)}setViewpoint(t,e,i,n){this.begin(),this.view.stateManager.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,t,e,i,n),this.end()}setViewpointImmediate(t,e=0,i=[0,0],n=this._getDefaultAnchor()){this.view.stateManager.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,n,t,e,i)}continuousRotateClockwise(){const t=this.view.viewpoint;this.animationManager?.animateContinuous(t,(t=>{(0,u.tj)(t,t,-1)}))}continuousRotateCounterclockwise(){const t=this.view.viewpoint;this.animationManager?.animateContinuous(t,(t=>{(0,u.tj)(t,t,1)}))}resetRotation(){this.view.constraints.rotationEnabled&&(this.view.rotation=0)}continuousPanLeft(){this._continuousPan([-10,0])}continuousPanRight(){this._continuousPan([10,0])}continuousPanUp(){this._continuousPan([0,10])}continuousPanDown(){this._continuousPan([0,-10])}continuousPanVector({x:t,y:e}){this._continuousPan([10*t,10*e])}stop(){this.pan.stopMomentumNavigation(),this.animationManager?.stop(),this.end(),null!==this._endTimer&&(clearTimeout(this._endTimer),this._endTimer=null,this._set("interacting",!1))}_continuousPan(t){const e=this.view.viewpoint;this.animationManager?.animateContinuous(e,(e=>{(0,u.aA)(e,e,t),this.view.constraints.constrainByGeometry(e)}))}_startTimer(t){return null!==this._endTimer||(this._endTimer=setTimeout((()=>{this._endTimer=null;const t=performance.now()-(this._lastEventTimestamp??0);t<250?this._endTimer=this._startTimer(t):this._set("interacting",!1)}),t)),this._endTimer}_getDefaultAnchor(){const{size:t,padding:{left:e,right:i,top:n,bottom:r}}=this.view;return G[0]=.5*(t[0]-i+e),G[1]=.5*(t[1]-r+n),G}async _zoomToScale(t,e=this._getDefaultAnchor()){const{view:i}=this,{constraints:n,scale:r,viewpoint:s,size:o,padding:a}=i,l=n.canZoomInTo(t),c=n.canZoomOutTo(t);if(!(t<r&&!l||t>r&&!c))return(0,u.qV)(U,s,t/r,0,e,o,a),n.constrainByGeometry(U),i.goTo(U,{animate:!0,animationMode:"always",duration:(0,h.s)(),pickClosestTarget:!1})}_scaleRotateTranslateViewpoint(t,e,i,n,r){const{view:s}=this,{size:o,padding:a,constraints:l,scale:c,viewpoint:h}=s,d=c*i,f=l.canZoomInTo(d),p=l.canZoomOutTo(d);return(i<1&&!f||i>1&&!p)&&(i=1),(0,u.aA)(h,h,r),(0,u.qV)(t,h,i,n,e,o,a),l.constrainByGeometry(t)}};(0,n._)([(0,a.MZ)()],Y.prototype,"animationManager",void 0),(0,n._)([(0,a.MZ)({type:Boolean,readOnly:!0})],Y.prototype,"interacting",void 0),(0,n._)([(0,a.MZ)()],Y.prototype,"pan",void 0),(0,n._)([(0,a.MZ)()],Y.prototype,"pinch",void 0),(0,n._)([(0,a.MZ)()],Y.prototype,"rotate",void 0),(0,n._)([(0,a.MZ)()],Y.prototype,"view",void 0),(0,n._)([(0,a.MZ)()],Y.prototype,"zoomBox",void 0),Y=(0,n._)([(0,l.$)("esri.views.2d.navigation.MapViewNavigation")],Y);const W=Y},39506:function(t,e,i){i.d(e,{H:function(){return r},If:function(){return s},Y:function(){return n}});const n=class{};function r(t,...e){let i="";for(let n=0;n<e.length;n++)i+=t[n]+e[n];return i+=t[t.length-1],i}function s(t,e,i=""){return t?e:i}var o;(o=r||(r={})).int=function(t){return Math.round(t).toString()},o.float=function(t){return t.toPrecision(8)}},54516:function(t,e,i){var n;i.d(e,{c:function(){return n}}),function(t){t[t.Pass=0]="Pass",t[t.Draw=1]="Draw"}(n||(n={}))},90553:function(t,e,i){i.d(e,{L:function(){return l},MX:function(){return o},O_:function(){return a},kL:function(){return c},vA:function(){return s},zH:function(){return u}});var n=i(1932);i(33400),(0,i(41546).vt)();class r{constructor(t){this.message=t}toString(){return`AssertException: ${this.message}`}}function s(t,e="Assertion"){if(!t){const t=new Error(e).stack;throw new r(`${e} at ${t}`)}}function o(t,e){t||(e=e||"",console.warn("Verify failed: "+e+"\n"+new Error("verify").stack))}function a(t,e,i,n){let r,s=(i[0]-t[0])/e[0],o=(n[0]-t[0])/e[0];s>o&&(r=s,s=o,o=r);let a=(i[1]-t[1])/e[1],l=(n[1]-t[1])/e[1];if(a>l&&(r=a,a=l,l=r),s>l||a>o)return!1;a>s&&(s=a),l<o&&(o=l);let c=(i[2]-t[2])/e[2],u=(n[2]-t[2])/e[2];return c>u&&(r=c,c=u,u=r),!(s>u||c>o||(u<o&&(o=u),o<0))}function l(t,e,i,r,s,o=(0,n.vt)()){const a=(r[s]-i[s])*(e[0]-t[0])-(r[0]-i[0])*(e[s]-t[s]),l=(r[0]-i[0])*(t[s]-i[s])-(r[s]-i[s])*(t[0]-i[0]);if(0===a)return!1;const c=l/a;return o[0]=t[0]+c*(e[0]-t[0]),o[1]=t[s]+c*(e[s]-t[s]),!0}function c(t,e){return Math.log(t)/Math.log(e)}function u(t){return 1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&0===t[4]&&1===t[5]&&0===t[6]&&0===t[7]&&0===t[8]&&0===t[9]&&1===t[10]&&0===t[11]&&1===t[15]}},54407:function(t,e,i){var n,r,s,o,a,l,c,u;i.d(e,{Am:function(){return o},C7:function(){return s},JS:function(){return u},Mg:function(){return l},dd:function(){return a},it:function(){return r},s2:function(){return n},sf:function(){return c}}),function(t){t[t.None=0]="None",t[t.Front=1]="Front",t[t.Back=2]="Back",t[t.COUNT=3]="COUNT"}(n||(n={})),function(t){t[t.Less=0]="Less",t[t.Lequal=1]="Lequal",t[t.COUNT=2]="COUNT"}(r||(r={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.UPDATE=1]="UPDATE"}(s||(s={})),function(t){t[t.NOT_LOADED=0]="NOT_LOADED",t[t.LOADING=1]="LOADING",t[t.LOADED=2]="LOADED"}(o||(o={})),function(t){t[t.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",t[t.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(a||(a={})),function(t){t[t.Highlight=0]="Highlight",t[t.MaskOccludee=1]="MaskOccludee"}(l||(l={})),function(t){t[t.Blend=0]="Blend",t[t.Opaque=1]="Opaque",t[t.Mask=2]="Mask",t[t.MaskBlend=3]="MaskBlend",t[t.COUNT=4]="COUNT"}(c||(c={})),function(t){t.DDS_ENCODING="image/vnd-ms.dds",t.KTX2_ENCODING="image/ktx2",t.BASIS_ENCODING="image/x.basis"}(u||(u={}))},86305:function(t,e,i){i.d(e,{g:function(){return c}});var n=i(50659),r=(i(58941),i(40633)),s=i(24540),o=i(41835),a=i(85456);const l=()=>r.A.getLogger("esri.views.webgl.BufferObject");class c{static createIndex(t,e,i){return new c(t,a.NZ.ELEMENT_ARRAY_BUFFER,e,i)}static createVertex(t,e,i){return new c(t,a.NZ.ARRAY_BUFFER,e,i)}static createUniform(t,e,i){return new c(t,a.NZ.UNIFORM_BUFFER,e,i)}static createPixelPack(t,e=a._U.STREAM_READ,i){const n=new c(t,a.NZ.PIXEL_PACK_BUFFER,e);return i&&n.setSize(i),n}static createPixelUnpack(t,e=a._U.STREAM_DRAW,i){return new c(t,a.NZ.PIXEL_UNPACK_BUFFER,e,i)}static createTransformFeedback(t,e=a._U.STATIC_DRAW,i){const n=new c(t,a.NZ.TRANSFORM_FEEDBACK_BUFFER,e);return n.setSize(i),n}constructor(t,e,i,n){this._context=t,this.bufferType=e,this.usage=i,this._glName=null,this._size=-1,this._indexType=void 0,t.instanceCounter.increment(a.vt.BufferObject,this),this._glName=this._context.gl.createBuffer(),(0,o.Y2)(this._context.gl),n&&this.setData(n)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get usedMemory(){if(this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER){if(this._indexType===a.pe.UNSIGNED_INT)return 4*this._size;if(this._indexType===a.pe.UNSIGNED_SHORT)return 2*this._size}return this._size}get _isVAOAware(){return this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER||this.bufferType===a.NZ.ARRAY_BUFFER}dispose(){this._context?.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(a.vt.BufferObject,this),this._context=null):this._glName&&l().warn("Leaked WebGL buffer object")}setSize(t,e=null){if(this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER&&null!=e)switch(this._indexType=e,e){case a.pe.UNSIGNED_SHORT:t*=2;break;case a.pe.UNSIGNED_INT:t*=4}this._setBufferData(t)}setData(t){if(!t)return;let e=t.byteLength;this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER&&((0,s.mg)(t)?this._indexType=a.pe.UNSIGNED_BYTE:(0,s.jq)(t)?(e/=2,this._indexType=a.pe.UNSIGNED_SHORT):(0,s.XJ)(t)&&(e/=4,this._indexType=a.pe.UNSIGNED_INT)),this._setBufferData(e,t)}_setBufferData(t,e=null){this._size=t;const i=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const n=this._context.gl;null!=e?n.bufferData(this.bufferType,e,this.usage):n.bufferData(this.bufferType,t,this.usage),(0,o.Y2)(n),this._isVAOAware&&this._context.bindVAO(i)}setSubData(t,e,i,n){if(!t)return;const r=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const{gl:s}=this._context;s.bufferSubData(this.bufferType,e*t.BYTES_PER_ELEMENT,t,i,n-i),(0,o.Y2)(s),this._isVAOAware&&this._context.bindVAO(r)}getSubData(t,e=0,i,r){if(i<0||r<0)return;const s=function(t){return(0,n.Xj)(t)}(t)?t.BYTES_PER_ELEMENT:1;if(s*((i??0)+(r??0))>t.byteLength)return;e+s*(r??0)>this.usedMemory&&l().warn("Potential problem getting subdata: requested data exceeds buffer size!");const o=this._context.gl;this.bufferType===a.NZ.TRANSFORM_FEEDBACK_BUFFER?(this._context.bindBuffer(this,a.NZ.TRANSFORM_FEEDBACK_BUFFER),o.getBufferSubData(a.NZ.TRANSFORM_FEEDBACK_BUFFER,e,t,i,r),this._context.unbindBuffer(a.NZ.TRANSFORM_FEEDBACK_BUFFER)):(this._context.bindBuffer(this,a.NZ.COPY_READ_BUFFER),o.getBufferSubData(a.NZ.COPY_READ_BUFFER,e,t,i,r),this._context.unbindBuffer(a.NZ.COPY_READ_BUFFER))}async getSubDataAsync(t,e=0,i,n){await this._context.clientWaitAsync(),this.getSubData(t,e,i,n)}}},96402:function(t,e,i){i.d(e,{H:function(){return h}}),i(58941);var n=i(40633),r=i(95929),s=i(86305),o=i(41835),a=i(85456),l=i(69452),c=i(49414),u=i(12285);class h{constructor(t,e,i=null){this._context=t,this._glName=null,this._colorAttachments=new Map,this._depthStencilBuffer=null,this._depthStencilTexture=null,this._initialized=!1,t.instanceCounter.increment(a.vt.FramebufferObject,this);const n=d(e)?e:new u.g(this._context,e);if(this._colorAttachments.set(a.Nm.COLOR_ATTACHMENT0,n),this._validateTextureDescriptor(n.descriptor),this._validateColorAttachmentPoint(a.Nm.COLOR_ATTACHMENT0),null!=i)if(function(t){return d(t)||null!=t&&"pixelFormat"in t}(i))this._depthStencilTexture=d(i)?i:new u.g(this._context,i),this._validateTextureDescriptor(this._depthStencilTexture.descriptor);else{const t=function(t){return null!=t&&"type"in t&&t.type===l.p.RenderBuffer}(i)?i:new c.l(this._context,i);this._depthStencilBuffer=t,this._validateRenderBufferDescriptor(t.descriptor)}}dispose(){if(0===this._colorAttachments.size&&!this._glName)return;const t=this._context.getBoundFramebufferObject();this._colorAttachments.forEach(((t,e)=>this.detachColorTexture(e)?.dispose())),this.detachDepthStencilBuffer()?.dispose(),this.detachDepthStencilTexture()?.dispose(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(t),this._context.instanceCounter.decrement(a.vt.FramebufferObject,this)}get glName(){return this._glName}get colorTexture(){return this._colorAttachments.get(a.Nm.COLOR_ATTACHMENT0)}get depthStencil(){return this._depthStencilTexture||this._depthStencilBuffer}get depthStencilTexture(){return this._depthStencilTexture}get width(){const t=this._colorAttachments.get(a.Nm.COLOR_ATTACHMENT0);return t?.descriptor?.width??0}get height(){const t=this._colorAttachments.get(a.Nm.COLOR_ATTACHMENT0);return t?.descriptor?.height??0}get usedMemory(){return[...this._colorAttachments].reduce(((t,[e,i])=>t+i.usedMemory),this.depthStencil?.usedMemory??0)}getColorTexture(t){const e=this._colorAttachments.get(t);return e&&d(e)?e:null}get colorAttachments(){return[...this._colorAttachments.keys()]}attachColorTexture(t,e=a.Nm.COLOR_ATTACHMENT0){if(!t)return;this._validateColorAttachmentPoint(e);const i=t.descriptor;this._validateTextureDescriptor(i),this.detachColorTexture(e)?.dispose(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(t.glName,e)),this._colorAttachments.set(e,t)}detachColorTexture(t=a.Nm.COLOR_ATTACHMENT0){const e=this._colorAttachments.get(t);if(e){if(this._initialized){const e=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this),this._framebufferTexture2D(null,t),this._context.bindFramebuffer(e)}return this._colorAttachments.delete(t),e}}setColorTextureTarget(t,e=a.Nm.COLOR_ATTACHMENT0){const i=this._colorAttachments.get(e);i&&this._framebufferTexture2D(i.glName,e,t)}attachDepthStencil(t){if(t)switch(t.type){case l.p.Texture:return this._attachDepthStencilTexture(t);case l.p.RenderBuffer:return this._attachDepthStencilBuffer(t)}}_attachDepthStencilTexture(t){if(null==t)return;const e=t.descriptor;e.pixelFormat!==a.Ab.DEPTH_STENCIL&&e.pixelFormat!==a.Ab.DEPTH24_STENCIL8&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),e.dataType!==a.ld.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._validateTextureDescriptor(e),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(t.glName,a.nI)),this._depthStencilTexture?.dispose(),this._depthStencilTexture=t}detachDepthStencilTexture(){const t=this._depthStencilTexture;if(t&&this._initialized){const t=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this),this._framebufferTexture2D(null,a.nI),this._context.bindFramebuffer(t)}return this._depthStencilTexture=null,t}_attachDepthStencilBuffer(t){if(null==t)return;const e=t.descriptor;if(this._validateRenderBufferDescriptor(e),this._disposeDepthStencilAttachments(),this._initialized){this._context.bindFramebuffer(this);const i=this._context.gl,n=this._getGLAttachmentPoint(e);i.framebufferRenderbuffer(a.R.FRAMEBUFFER,n,i.RENDERBUFFER,t.glName)}this._depthStencilBuffer=t}detachDepthStencilBuffer(){const t=this._depthStencilBuffer;if(t&&this._initialized){const e=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this);const i=this._context.gl,n=this._getGLAttachmentPoint(t.descriptor);i.framebufferRenderbuffer(a.R.FRAMEBUFFER,n,i.RENDERBUFFER,null),this._context.bindFramebuffer(e)}return this._depthStencilBuffer=null,t}copyToTexture(t,e,i,n,r,s,o){(t<0||e<0||r<0||s<0)&&console.error("Offsets cannot be negative!"),(i<=0||n<=0)&&console.error("Copy width and height must be greater than zero!");const l=o.descriptor;o.descriptor.target!==a.Ap.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),(null==l?.width||null==l?.height||t+i>this.width||e+n>this.height||r+i>l.width||s+n>l.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const c=this._context,h=c.bindTexture(o,u.g.TEXTURE_UNIT_FOR_UPDATES);c.setActiveTexture(u.g.TEXTURE_UNIT_FOR_UPDATES),c.bindFramebuffer(this),c.gl.copyTexSubImage2D(a.Ap.TEXTURE_2D,0,r,s,t,e,i,n),c.bindTexture(h,u.g.TEXTURE_UNIT_FOR_UPDATES)}readPixels(t,e,i,n,r,s,o){(i<=0||n<=0)&&console.error("Copy width and height must be greater than zero!"),o||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(t,e,i,n,r,s,o)}async readPixelsAsync(t,e,i,n,r,o,l){const{gl:c}=this._context,u=s.g.createPixelPack(this._context,a._U.STREAM_READ,l.byteLength);this._context.bindBuffer(u);const h=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this),c.readPixels(t,e,i,n,r,o,0),this._context.unbindBuffer(a.NZ.PIXEL_PACK_BUFFER),this._context.bindFramebuffer(h),await u.getSubDataAsync(l),u.dispose()}resize(t,e){if(this.width===t&&this.height===e)return;const i={width:t,height:e};f(i,this._context.parameters.maxTextureSize),this._colorAttachments.forEach((t=>t.resize(i.width,i.height))),this._depthStencilTexture?.resize(i.width,i.height),this._initialized&&(f(i,this._context.parameters.maxRenderbufferSize),this._depthStencilBuffer?.resize(i.width,i.height),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1)}initializeAndBind(t=a.R.FRAMEBUFFER){const e=this._context.gl;if(this._initialized)return void e.bindFramebuffer(t,this.glName);this._glName&&e.deleteFramebuffer(this._glName);const i=e.createFramebuffer();if(e.bindFramebuffer(t,i),this._colorAttachments.forEach(((e,i)=>this._framebufferTexture2D(e.glName,i,p(e),t))),this._depthStencilBuffer){const i=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);e.framebufferRenderbuffer(t,i,e.RENDERBUFFER,this._depthStencilBuffer.glName)}else this._depthStencilTexture&&this._framebufferTexture2D(this._depthStencilTexture.glName,e.DEPTH_STENCIL_ATTACHMENT,p(this._depthStencilTexture),t);(0,o.en)()&&e.checkFramebufferStatus(t)!==e.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=i,this._initialized=!0}_framebufferTexture2D(t,e=a.Nm.COLOR_ATTACHMENT0,i=a.Ap.TEXTURE_2D,n=a.R.FRAMEBUFFER,r=0){this._context.gl.framebufferTexture2D(n,e,i,t,r)}_disposeDepthStencilAttachments(){const t=this._context.gl;if(this._depthStencilBuffer){if(this._initialized){this._context.bindFramebuffer(this);const e=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);t.framebufferRenderbuffer(a.R.FRAMEBUFFER,e,t.RENDERBUFFER,null)}this._depthStencilBuffer=(0,r.WD)(this._depthStencilBuffer)}this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,t.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture=(0,r.WD)(this._depthStencilTexture))}_validateTextureDescriptor(t){t.target!==a.Ap.TEXTURE_2D&&t.target!==a.Ap.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),f(t,this._context.parameters.maxTextureSize),this._validateBufferDimensions(t)}_validateRenderBufferDescriptor(t){f(t,this._context.parameters.maxRenderbufferSize),this._validateBufferDimensions(t)}_validateBufferDimensions(t){t.width<=0&&(t.width=this.width),t.height<=0&&(t.height=this.height),this.width>0&&this.height>0&&(this.width===t.width&&this.height===t.height||console.error("Attachment size must match framebuffer size!"))}_getGLAttachmentPoint(t){switch(t.internalFormat){case a.yQ.DEPTH_COMPONENT16:case a.yQ.DEPTH_COMPONENT24:case a.yQ.DEPTH_COMPONENT32F:return this._context.gl.DEPTH_ATTACHMENT;case a.yQ.DEPTH24_STENCIL8:case a.yQ.DEPTH32F_STENCIL8:case a.yQ.DEPTH_STENCIL:return this._context.gl.DEPTH_STENCIL_ATTACHMENT;case a.yQ.STENCIL_INDEX8:return this._context.gl.STENCIL_ATTACHMENT}}_validateColorAttachmentPoint(t){if(-1===h._MAX_COLOR_ATTACHMENTS){const{gl:t}=this._context;h._MAX_COLOR_ATTACHMENTS=t.getParameter(t.MAX_COLOR_ATTACHMENTS)}const e=t-a.Nm.COLOR_ATTACHMENT0;e+1>h._MAX_COLOR_ATTACHMENTS&&n.A.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${e+1}. Implementation supports up to ${h._MAX_COLOR_ATTACHMENTS} color attachments`)}}function d(t){return null!=t&&"type"in t&&t.type===l.p.Texture}function f(t,e){const i=Math.max(t.width,t.height);if(i>e){n.A.getLogger("esri.views.webgl.FramebufferObject").warn(`Resizing FBO attachment size ${t.width}x${t.height} to device limit ${e}`);const r=e/i;return t.width=Math.round(t.width*r),t.height=Math.round(t.height*r),!1}return!0}function p(t){return t.descriptor.target===a.Ap.TEXTURE_CUBE_MAP?a.Ap.TEXTURE_CUBE_MAP_POSITIVE_X:a.Ap.TEXTURE_2D}h._MAX_COLOR_ATTACHMENTS=-1},95904:function(t,e,i){i.d(e,{B:function(){return x}}),i(58941);var n=i(41835),r=i(85456);const s=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"],o=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"],a=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"],l=["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT","textureSize","texelFetch"];var c=999,u=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function h(t){return function(t){var e=function(){var t,e,i,n=0,r=0,s=c,h=[],d=[],f=1,p=0,_=0,m=!1,g=!1,y="";return function(t){return d=[],null!==t?x(t.replace?t.replace(/\r\n/g,"\n"):t):(h.length&&v(h.join("")),s=10,v("(eof)"),d)};function v(t){t.length&&d.push({type:u[s],data:t,position:_,line:f,column:p})}function x(e){var o;for(n=0,i=(y+=e).length;t=y[n],n<i;){switch(o=n,s){case 0:n=T();break;case 1:case 2:n=w();break;case 3:n=M();break;case 4:n=C();break;case 11:n=A();break;case 5:n=I();break;case 9999:n=E();break;case 9:n=S();break;case c:n=b()}o!==n&&("\n"===y[o]?(p=0,++f):++p)}return r+=n,y=y.slice(n),d}function b(){return h=h.length?[]:h,"/"===e&&"*"===t?(_=r+n-1,s=0,e=t,n+1):"/"===e&&"/"===t?(_=r+n-1,s=1,e=t,n+1):"#"===t?(s=2,_=r+n,n):/\s/.test(t)?(s=9,_=r+n,n):(m=/\d/.test(t),g=/[^\w_]/.test(t),_=r+n,s=m?4:g?3:9999,n)}function S(){return/[^\s]/g.test(t)?(v(h.join("")),s=c,n):(h.push(t),e=t,n+1)}function w(){return"\r"!==t&&"\n"!==t||"\\"===e?(h.push(t),e=t,n+1):(v(h.join("")),s=c,n)}function T(){return"/"===t&&"*"===e?(h.push(t),v(h.join("")),s=c,n+1):(h.push(t),e=t,n+1)}function M(){if("."===e&&/\d/.test(t))return s=5,n;if("/"===e&&"*"===t)return s=0,n;if("/"===e&&"/"===t)return s=1,n;if("."===t&&h.length){for(;P(h););return s=5,n}if(";"===t||")"===t||"("===t){if(h.length)for(;P(h););return v(t),s=c,n+1}var i=2===h.length&&"="!==t;if(/[\w_\d\s]/.test(t)||i){for(;P(h););return s=c,n}return h.push(t),e=t,n+1}function P(t){for(var e,i,n=0;;){if(e=a.indexOf(t.slice(0,t.length+n).join("")),i=a[e],-1===e){if(n--+t.length>0)continue;i=t.slice(0,1).join("")}return v(i),_+=i.length,(h=h.slice(i.length)).length}}function A(){return/[^a-fA-F0-9]/.test(t)?(v(h.join("")),s=c,n):(h.push(t),e=t,n+1)}function C(){return"."===t||/[eE]/.test(t)?(h.push(t),s=5,e=t,n+1):"x"===t&&1===h.length&&"0"===h[0]?(s=11,h.push(t),e=t,n+1):/[^\d]/.test(t)?(v(h.join("")),s=c,n):(h.push(t),e=t,n+1)}function I(){return"f"===t&&(h.push(t),e=t,n+=1),/[eE]/.test(t)||"-"===t&&/[eE]/.test(e)?(h.push(t),e=t,n+1):/[^\d]/.test(t)?(v(h.join("")),s=c,n):(h.push(t),e=t,n+1)}function E(){if(/[^\d\w_]/.test(t)){var i=h.join("");return s=o.indexOf(i)>-1?8:l.indexOf(i)>-1?7:6,v(h.join("")),s=c,n}return h.push(t),e=t,n+1}}(),i=[];return(i=i.concat(e(t))).concat(e(null))}(t)}const d=new Set(["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"]);function f(t,e){for(let i=e-1;i>=0;i--){const e=t[i];if("whitespace"!==e.type&&"block-comment"!==e.type){if("keyword"!==e.type)break;if("attribute"===e.data||"in"===e.data)return!0}}return!1}function p(t,e,i,n){n=n||i;for(const r of t)if("ident"===r.type&&r.data===i)return n in e?e[n]++:e[n]=0,p(t,e,n+"_"+e[n],n);return i}function _(t,e,i="afterVersion"){function n(t,e){for(let i=e;i<t.length;i++){const e=t[i];if("operator"===e.type&&";"===e.data)return i}return null}const r={data:"\n",type:"whitespace"},s=e=>e<t.length&&/[^\r\n]$/.test(t[e].data);let o=function(t){let e=-1,r=0,s=-1;for(let o=0;o<t.length;o++){const a=t[o];if("preprocessor"===a.type&&(/#(if|ifdef|ifndef)\s+.+/.test(a.data)?++r:/#endif\s*.*/.test(a.data)&&--r),"afterVersion"!==i&&"afterPrecision"!==i||"preprocessor"===a.type&&a.data.startsWith("#version")&&(s=Math.max(s,o)),"afterPrecision"===i&&"keyword"===a.type&&"precision"===a.data){const e=n(t,o);if(null===e)throw new Error("precision statement not followed by any semicolons!");s=Math.max(s,e)}e<s&&0===r&&(e=o)}return e+1}(t);s(o-1)&&t.splice(o++,0,r);for(const i of e)t.splice(o++,0,i);s(o-1)&&s(o)&&t.splice(o,0,r)}function m(t,e,i,n="lowp"){_(t,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:n},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function g(t,e,i,n,r="lowp"){_(t,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:n.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function y(t,e){let i,n,r=-1;for(let s=e;s<t.length;s++){const e=t[s];if("operator"===e.type&&("["===e.data&&(i=s),"]"===e.data)){n=s;break}"integer"===e.type&&(r=parseInt(e.data,10))}return i&&n&&t.splice(i,n-i+1),r}function v(t,e){if(t.startsWith("#version 300"))return t;const i=h(t);if("300 es"===function(t,e="100",i="300 es"){const n=/^\s*#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const r of t)if("preprocessor"===r.type){const t=n.exec(r.data);if(t){const n=t[1].replaceAll(/\s{2,}/g," ");if(n===i)return n;if(n===e)return r.data="#version "+i,e;throw new Error("unknown glsl version: "+n)}}return t.splice(0,0,{type:"preprocessor",data:"#version "+i},{type:"whitespace",data:"\n"}),null}(i,"100","300 es"))return t;let n=null,o=null;const a={},l={};for(let t=0;t<i.length;++t){const c=i[t];switch(c.type){case"keyword":e===r.Co.VERTEX_SHADER&&"attribute"===c.data?c.data="in":"varying"===c.data&&(c.data=e===r.Co.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(c.data.trim())&&(c.data=c.data.replaceAll(/(2D|Cube|EXT)/g,"")),e===r.Co.FRAGMENT_SHADER&&"gl_FragColor"===c.data&&(n||(n=p(i,a,"fragColor"),m(i,n,"vec4")),c.data=n),e===r.Co.FRAGMENT_SHADER&&"gl_FragData"===c.data){const e=y(i,t+1),n=p(i,a,"fragData");g(i,n,"vec4",e,"mediump"),c.data=n}else e===r.Co.FRAGMENT_SHADER&&"gl_FragDepthEXT"===c.data&&(o||(o=p(i,a,"gl_FragDepth")),c.data=o);break;case"ident":if(s.includes(c.data)){if(e===r.Co.VERTEX_SHADER&&f(i,t))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");c.data in l||(l[c.data]=p(i,a,c.data)),c.data=l[c.data]}}}for(let t=i.length-1;t>=0;--t){const e=i[t];if("preprocessor"===e.type){const n=e.data.match(/#extension\s+(.*):/);if(n?.[1]&&d.has(n[1].trim())){const e=i[t+1];i.splice(t,e&&"whitespace"===e.type?2:1)}const r=e.data.match(/#ifdef\s+(.*)/);r?.[1]&&d.has(r[1].trim())&&(e.data="#if 1");const s=e.data.match(/#ifndef\s+(.*)/);s?.[1]&&d.has(s[1].trim())&&(e.data="#if 0")}}return c=function(t){return t.map((t=>"eof"!==t.type?t.data:"")).join("")}(i),c;var c}new Map;class x{constructor(t,e,i,s,o=new Map,a=[]){this._context=t,this._locations=s,this._uniformBlockBindings=o,this._transformFeedbackVaryings=a,this._refCount=1,this._compiled=!1,this._linesOfCode=0,this._nameToUniformLocation=new Map,this._nameToUniform1=new Map,this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,t||console.error("RenderingContext isn't initialized!"),0===e.length&&console.error("Shaders source should not be empty!"),e=v(e,r.Co.VERTEX_SHADER),i=v(i,r.Co.FRAGMENT_SHADER),this._vShader=b(this._context,r.Co.VERTEX_SHADER,e),this._fShader=b(this._context,r.Co.FRAGMENT_SHADER,i),w.enabled&&(this._linesOfCode=e.match(/\n/g).length+i.match(/\n/g).length+2,this._context.instanceCounter.increment(r.vt.LinesOfCode,this._vShader,this._linesOfCode)),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(r.vt.Shader,this),(0,n.Xc)()&&(this.vertexShader=e,this.fragmentShader=i),this.usedMemory=e.length+i.length;const l=this._context.gl,c=l.createProgram();l.attachShader(c,this._vShader),l.attachShader(c,this._fShader),this._locations.forEach(((t,e)=>l.bindAttribLocation(c,t,e))),this._transformFeedbackVaryings?.length&&l.transformFeedbackVaryings(c,this._transformFeedbackVaryings,l.SEPARATE_ATTRIBS),l.linkProgram(c),(0,n.Xc)()&&!l.getProgramParameter(c,l.LINK_STATUS)&&console.error(`Could not link shader\nvalidated: ${l.getProgramParameter(c,l.VALIDATE_STATUS)}, gl error ${l.getError()}, vertex: ${l.getShaderParameter(this._vShader,l.COMPILE_STATUS)}, fragment: ${l.getShaderParameter(this._fShader,l.COMPILE_STATUS)}, info log: ${l.getProgramInfoLog(c)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`);for(const[t,e]of this._uniformBlockBindings){const i=l.getUniformBlockIndex(c,t);i<4294967295&&l.uniformBlockBinding(c,i,e)}this._glName=c,this._context.instanceCounter.increment(r.vt.Program,this)}get glName(){return this._glName}get hasGLName(){return null!=this._glName}get hasTransformFeedbackVaryings(){return!!this._transformFeedbackVaryings?.length}get compiled(){if(this._compiled)return!0;const t=this._context.gl.getExtension("KHR_parallel_shader_compile");return null==t||null==this.glName?(this._compiled=!0,!0):(this._compiled=!!this._context.gl.getProgramParameter(this.glName,t.COMPLETION_STATUS_KHR),this._compiled)}dispose(){if(--this._refCount>0)return;const t=this._context.gl,e=this._context.instanceCounter;this._nameToUniformLocation.forEach((t=>t&&e.decrement(r.vt.Uniform,t))),this._nameToUniformLocation.clear(),this._vShader&&(this._linesOfCode>0&&(e.decrement(r.vt.LinesOfCode,this._vShader,this._linesOfCode),this._linesOfCode=0),t.deleteShader(this._vShader),this._vShader=null,e.decrement(r.vt.Shader,this)),this._fShader&&(t.deleteShader(this._fShader),this._fShader=null),this._glName&&(t.deleteProgram(this._glName),this._glName=null,e.decrement(r.vt.Program,this))}ref(){++this._refCount}_getUniformLocation(t){const e=this._nameToUniformLocation.get(t);if(void 0!==e)return e;if(this.glName){const e=this._context.gl.getUniformLocation(this.glName,t);return this._nameToUniformLocation.set(t,e),e&&this._context.instanceCounter.increment(r.vt.Uniform,e),e}return null}hasUniform(t){return null!=this._getUniformLocation(t)}setUniform1i(t,e){const i=this._nameToUniform1.get(t);void 0!==i&&e===i||(this._context.gl.uniform1i(this._getUniformLocation(t),e),this._nameToUniform1.set(t,e))}setUniform1iv(t,e){S(this._nameToUniform1v,t,e)&&this._context.gl.uniform1iv(this._getUniformLocation(t),e)}setUniform2iv(t,e){S(this._nameToUniform2,t,e)&&this._context.gl.uniform2iv(this._getUniformLocation(t),e)}setUniform3iv(t,e){S(this._nameToUniform3,t,e)&&this._context.gl.uniform3iv(this._getUniformLocation(t),e)}setUniform4iv(t,e){S(this._nameToUniform4,t,e)&&this._context.gl.uniform4iv(this._getUniformLocation(t),e)}setUniform1f(t,e){const i=this._nameToUniform1.get(t);void 0!==i&&e===i||(this._context.gl.uniform1f(this._getUniformLocation(t),e),this._nameToUniform1.set(t,e))}setUniform1fv(t,e){S(this._nameToUniform1v,t,e)&&this._context.gl.uniform1fv(this._getUniformLocation(t),e)}setUniform2f(t,e,i){const n=this._nameToUniform2.get(t);void 0===n?(this._context.gl.uniform2f(this._getUniformLocation(t),e,i),this._nameToUniform2.set(t,[e,i])):e===n[0]&&i===n[1]||(this._context.gl.uniform2f(this._getUniformLocation(t),e,i),n[0]=e,n[1]=i)}setUniform2fv(t,e){S(this._nameToUniform2,t,e)&&this._context.gl.uniform2fv(this._getUniformLocation(t),e)}setUniform3f(t,e,i,n){const r=this._nameToUniform3.get(t);void 0===r?(this._context.gl.uniform3f(this._getUniformLocation(t),e,i,n),this._nameToUniform3.set(t,[e,i,n])):e===r[0]&&i===r[1]&&n===r[2]||(this._context.gl.uniform3f(this._getUniformLocation(t),e,i,n),r[0]=e,r[1]=i,r[2]=n)}setUniform3fv(t,e){const i=this._getUniformLocation(t);null!=i&&S(this._nameToUniform3,t,e)&&this._context.gl.uniform3fv(i,e)}setUniform4f(t,e,i,n,r){const s=this._nameToUniform4.get(t);void 0===s?(this._context.gl.uniform4f(this._getUniformLocation(t),e,i,n,r),this._nameToUniform4.set(t,[e,i,n,r])):void 0!==s&&e===s[0]&&i===s[1]&&n===s[2]&&r===s[3]||(this._context.gl.uniform4f(this._getUniformLocation(t),e,i,n,r),s[0]=e,s[1]=i,s[2]=n,s[3]=r)}setUniform4fv(t,e){const i=this._getUniformLocation(t);null!=i&&S(this._nameToUniform4,t,e)&&this._context.gl.uniform4fv(i,e)}setUniformMatrix3fv(t,e,i=!1){const n=this._getUniformLocation(t);null!=n&&S(this._nameToUniformMatrix3,t,e)&&this._context.gl.uniformMatrix3fv(n,i,e)}setUniformMatrix4fv(t,e,i=!1){const n=this._getUniformLocation(t);null!=n&&S(this._nameToUniformMatrix4,t,e)&&this._context.gl.uniformMatrix4fv(n,i,e)}stop(){}}function b(t,e,i){const s=t.gl,o=s.createShader(e);return s.shaderSource(o,i),s.compileShader(o),(0,n.Xc)()&&!s.getShaderParameter(o,s.COMPILE_STATUS)&&(console.error("Compile error in ".concat(e===r.Co.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(s.getShaderInfoLog(o)),console.error(function(t){let e=2;return t.replaceAll("\n",(()=>"\n"+function(t){return t>=1e3?t.toString():("  "+t).slice(-3)}(e++)+":"))}(i))),o}function S(t,e,i){const n=t.get(e);if(!n)return t.set(e,Array.from(i)),!0;const r=i.length;if(n.length!==r)return t.set(e,Array.from(i)),!0;for(let t=0;t<r;++t){const e=i[t];if(n[t]!==e){for(n[t]=e;t<r;++t)n[t]=i[t];return!0}}return!1}const w={enabled:!1}},3934:function(t,e,i){i.d(e,{J:function(){return s}}),i(58941);var n=i(7970),r=i(95904);class s{constructor(t){this._rctx=t,this._store=new n.O}dispose(){this._store.forAll((t=>t.dispose())),this._store.clear()}acquire(t,e,i,n){const s=this._store.get(t,e);if(null!=s)return s.ref(),s;const o=new r.B(this._rctx,t,e,i,n);return o.ref(),this._store.set(t,e,o),o}get test(){}}},10904:function(t,e,i){i.d(e,{r:function(){return r}});var n=i(95904);function r(t,e,i=""){return new n.B(t,i+e.shaders.vertexShader,i+e.shaders.fragmentShader,e.attributes)}},49414:function(t,e,i){i.d(e,{l:function(){return o}});var n=i(85456),r=i(69452),s=i(15167);class o{constructor(t,e){this._context=t,this._descriptor=e,this.type=r.p.RenderBuffer,this._context.instanceCounter.increment(n.vt.Renderbuffer,this);const i=this._context.gl;this.glName=i.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:s,height:o,internalFormat:a,multisampled:l}=e;l?i.renderbufferStorageMultisample(i.RENDERBUFFER,this.samples,a,s,o):i.renderbufferStorage(i.RENDERBUFFER,a,s,o),this._context.bindRenderbuffer(null)}get descriptor(){return this._descriptor}get samples(){const t=this._descriptor.samples,e=this._context.parameters.maxSamples;return t?Math.min(t,e):e}get usedMemory(){return(0,s.e)(this._descriptor)}resize(t,e){const i=this._descriptor;if(i.width===t&&i.height===e)return;i.width=t,i.height=e;const n=this._context.gl;this._context.bindRenderbuffer(this),i.multisampled?n.renderbufferStorageMultisample(n.RENDERBUFFER,this.samples,i.internalFormat,i.width,i.height):n.renderbufferStorage(n.RENDERBUFFER,i.internalFormat,i.width,i.height),this._context.bindRenderbuffer(null)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(n.vt.Renderbuffer,this),this._context=null)}}},15167:function(t,e,i){i.d(e,{e:function(){return s},q:function(){return r}});var n=i(93380);class r{constructor(t,e,i=e){this.internalFormat=t,this.width=e,this.height=i,this.multisampled=!1,this.samples=1}}function s(t){return t.width<=0||t.height<=0||null==t.internalFormat?0:t.width*t.height*(0,n.IB)(t.internalFormat)}},74427:function(t,e,i){i.d(e,{e:function(){return D}});var n=i(58941),r=i(95929),s=i(60539),o=i(38504),a=i(41835),l=i(85456);class c{constructor(){this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:l.dn.ONE,dstRGB:l.dn.ZERO,srcAlpha:l.dn.ONE,dstAlpha:l.dn.ZERO},this.blendEquation={mode:l.Tb.ADD,modeAlpha:l.Tb.ADD},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=l.Y7.BACK,this.frontFace=l.Ac.CCW,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=l.MT.LESS,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:l.Y7.FRONT_AND_BACK,func:l.MT.ALWAYS,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:l.Y7.FRONT_AND_BACK,fail:l.eA.KEEP,zFail:l.eA.KEEP,zPass:l.eA.KEEP},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.transformFeedbackBuffer=null,this.uniformBufferBindingPoints=new Array,this.transformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.drawBuffers={defaultFramebuffer:[l.Hr.BACK],fbos:new WeakMap},this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array,this.vertexArrayObject=null}}class u{constructor(){for(this._current=new Array,this._allocations=null;this._current.length<l.vt.COUNT;)this._current.push(0)}increment(t,e,i=1){this._current[t]+=i,this._allocations?.add(e)}decrement(t,e,i=1){this._current[t]-=i,this._allocations?.remove(e)}get current(){return this._current}get total(){return this.current.reduce(((t,e,i)=>t+(i<l.vt.UNCOUNTED?e:0)),0)}get resourceInformation(){let t="";if(this.total>0){t+="Live objects:\n";for(let e=0;e<l.vt.COUNT;++e){const i=this._current[e];i>0&&(t+=`${l.vt[e]}: ${i}\n`)}}return t+=this._allocations?.resetLog(),t}}class h{constructor(t,e,i){const n=e.textureFilterAnisotropic,r=i.maxAnisotropy??1/0;this.versionString=t.getParameter(t.VERSION),this.maxVertexTextureImageUnits=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.maxVertexAttributes=t.getParameter(t.MAX_VERTEX_ATTRIBS),this.maxMaxAnisotropy=n?Math.min(t.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY),r):1,this.maxTextureImageUnits=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxRenderbufferSize=t.getParameter(t.MAX_RENDERBUFFER_SIZE),this.maxViewportDims=t.getParameter(t.MAX_VIEWPORT_DIMS),this.maxUniformBufferBindings=t.getParameter(t.MAX_UNIFORM_BUFFER_BINDINGS),this.maxVertexUniformBlocks=t.getParameter(t.MAX_VERTEX_UNIFORM_BLOCKS),this.maxFragmentUniformBlocks=t.getParameter(t.MAX_FRAGMENT_UNIFORM_BLOCKS),this.maxUniformBlockSize=t.getParameter(t.MAX_UNIFORM_BLOCK_SIZE),this.uniformBufferOffsetAlignment=t.getParameter(t.UNIFORM_BUFFER_OFFSET_ALIGNMENT),this.maxArrayTextureLayers=t.getParameter(t.MAX_ARRAY_TEXTURE_LAYERS),this.maxSamples=t.getParameter(t.MAX_SAMPLES),this.maxDrawBuffers=t.getParameter(t.MAX_DRAW_BUFFERS)}}var d=i(3934),f=i(57087),p=i(12285),_=i(93380),m=i(39506),g=i(86305);class y{constructor(t){this._rctx=t,this._indexBuffer=this._createIndexbuffer(),this._program=this._createHelperProgram()}static getShaderSources(){return{vertex:"#version 300 es\n    precision highp float;\n\n    void main(void) {\n      gl_Position = vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);\n    }",fragment:"#version 300 es\n    precision highp float;\n\n    out vec4 fragColor;\n\n    void main(void) {\n      fragColor = vec4(0.0, 0.0, 0.0, 1.0);\n    }"}}_createHelperProgram(){const t=y.getShaderSources();return this._rctx.programCache.acquire(t.vertex,t.fragment,new Map([]))}_createIndexbuffer(){return g.g.createIndex(this._rctx,l._U.STATIC_DRAW,new Uint32Array([0]))}run(){this._program.compiled&&this._indexBuffer&&(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,l.NZ.ELEMENT_ARRAY_BUFFER),this._rctx.drawElements(l.WR.POINTS,1,l.pe.UNSIGNED_INT,0))}dispose(){this._program.dispose(),this._indexBuffer.dispose()}get test(){}}var v=i(96402),x=i(10956),b=i(10106);class S extends b._{constructor(t){super(),this._rctx=t,this._helperProgram=null,(0,n.A)("mac")&&(0,n.A)("chrome")&&(this._program=this._prepareProgram(),this._helperProgram=this._prepareHelperProgram())}dispose(){super.dispose(),this._helperProgram?.dispose(),this._helperProgram=null}_test(t){const e=this._rctx,i=e.getBoundFramebufferObject(),{x:n,y:r,width:s,height:o}=e.getViewport();e.resetState();const a=new x.R(1);a.wrapMode=l.pF.CLAMP_TO_EDGE,a.samplingMode=l.Cj.NEAREST;const c=new v.H(e,a),u=g.g.createIndex(this._rctx,l._U.STATIC_DRAW,new Uint8Array([0]));e.bindFramebuffer(c),e.setViewport(0,0,1,1),e.useProgram(this._helperProgram),e.bindBuffer(u,l.NZ.ELEMENT_ARRAY_BUFFER),e.drawElements(l.WR.POINTS,1,l.pe.UNSIGNED_BYTE,0),e.useProgram(t),e.bindVAO(null),e.drawArrays(l.WR.TRIANGLES,0,258);const h=new Uint8Array(4);return c.readPixels(0,0,1,1,l.Ab.RGBA,l.ld.UNSIGNED_BYTE,h),e.setViewport(n,r,s,o),e.bindFramebuffer(i),c.dispose(),u.dispose(),255===h[0]}_prepareProgram(){const t=`#version 300 es\n    precision highp float;\n\n    out float triangleId;\n\n    const vec3 triangleVertices[3] = vec3[3](vec3(-0.5, -0.5, 0.0), vec3(0.5, -0.5, 0.0), vec3(0.0, 0.5, 0.0));\n\n    void main(void) {\n      triangleId = floor(float(gl_VertexID)/3.0);\n\n      vec3 position = triangleVertices[gl_VertexID % 3];\n      float offset = triangleId / ${m.H.float(85)};\n      position.z = 0.5 - offset;\n\n      gl_Position = vec4(position, 1.0);\n    }\n    `,e=`#version 300 es\n    precision highp float;\n\n    in float triangleId;\n\n    out vec4 fragColor;\n\n    void main(void) {\n      fragColor = triangleId == ${m.H.float(85)} ? vec4(0.0, 1.0, 0.0, 1.0) : vec4(1.0, 0.0, 0.0, 1.0);\n    }\n    `;return this._rctx.programCache.acquire(t,e,new Map([]))}_prepareHelperProgram(){const t=y.getShaderSources();return this._rctx.programCache.acquire(t.vertex,t.fragment,new Map([]))}}var w=i(5161),T=i(32501),M=i(44476),P=i(81438),A=i(3817);class C extends b._{constructor(t){super(),this._rctx=t,this._program=I(this._rctx,!1),this._obfuscated=I(this._rctx,!0)}dispose(){super.dispose(),this._obfuscated=(0,r.WD)(this._obfuscated)}_test(t){if((0,n.A)("force-double-precision-obfuscation"))return!0;if(null==this._obfuscated)return!1;const e=this._rctx,i=e.getBoundFramebufferObject(),{x:r,y:s,width:o,height:a}=e.getViewport(),l=this._runProgram(t),c=this._runProgram(this._obfuscated);return e.setViewport(r,s,o,a),e.bindFramebuffer(i),0!==l&&(0===c||l/c>5)}_runProgram(t){const e=this._rctx;e.resetState();const i=new x.R(1);i.wrapMode=l.pF.CLAMP_TO_EDGE,i.samplingMode=l.Cj.NEAREST;const n=new v.H(e,i),r=g.g.createVertex(e,l._U.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),s=new P.Z(e,new Map([["position",0]]),new Map([["geometry",[new A._("position",2,l.pe.UNSIGNED_SHORT,0,4)]]]),new Map([["geometry",r]])),o=(0,T.fA)(5633261.287538229,2626832.878767164,1434988.0495278358),a=(0,T.fA)(5633271.46742708,2626873.6381334523,1434963.231608387),c=new Float32Array(6);(0,M.jS)(o,c,3);const u=new Float32Array(6);(0,M.jS)(a,u,3),e.useProgram(t),t.setUniform3f("u_highA",c[0],c[2],c[4]),t.setUniform3f("u_lowA",c[1],c[3],c[5]),t.setUniform3f("u_highB",u[0],u[2],u[4]),t.setUniform3f("u_lowB",u[1],u[3],u[5]),e.bindFramebuffer(n),e.setViewport(0,0,1,1),e.bindVAO(s),e.drawArrays(l.WR.TRIANGLE_STRIP,0,4);const h=new Uint8Array(4);n.readPixels(0,0,1,1,l.Ab.RGBA,l.ld.UNSIGNED_BYTE,h),s.dispose(),n.dispose();const d=(o[2]-a[2])/25,f=(0,w.T)(h);return Math.abs(d-f)}}function I(t,e){const i=`\n\n  precision highp float;\n\n  attribute vec2 position;\n\n  uniform vec3 u_highA;\n  uniform vec3 u_lowA;\n  uniform vec3 u_highB;\n  uniform vec3 u_lowB;\n\n  varying vec4 v_color;\n\n  ${e?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}\n\n  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION\n\n  vec3 dpPlusFrc(vec3 a, vec3 b) {\n    return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n  }\n\n  vec3 dpMinusFrc(vec3 a, vec3 b) {\n    return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n  }\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = dpPlusFrc(hiA, hiB);\n    vec3 e = dpMinusFrc(t1, hiA);\n    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n    return t1 + t2;\n  }\n\n  #else\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = hiA + hiB;\n    vec3 e = t1 - hiA;\n    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n    return t1 + t2;\n  }\n\n  #endif\n\n  const float MAX_RGBA_FLOAT =\n    255.0 / 256.0 +\n    255.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n  vec4 float2rgba(const float value) {\n    // Make sure value is in the domain we can represent\n    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n    // Decompose value in 32bit fixed point parts represented as\n    // uint8 rgba components. Decomposition uses the fractional part after multiplying\n    // by a power of 256 (this removes the bits that are represented in the previous\n    // component) and then converts the fractional part to 8bits.\n    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n    // Convert uint8 values (from 0 to 255) to floating point representation for\n    // the shader\n    const float toU8AsFloat = 1.0 / 255.0;\n\n    return fixedPointU8 * toU8AsFloat;\n  }\n\n  void main() {\n    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);\n\n    v_color = float2rgba(val.z / 25.0);\n\n    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);\n  }\n  `;return t.programCache.acquire(i,"\n  precision highp float;\n\n  varying vec4 v_color;\n\n  void main() {\n    gl_FragColor = v_color;\n  }\n  ",new Map([["position",0]]))}class E extends b._{constructor(t){super(),this._rctx=t,t.gl&&t.capabilities.colorBufferFloat?.textureFloat&&t.capabilities.colorBufferFloat?.floatBlend&&(this._program=t.programCache.acquire("\n    precision highp float;\n    attribute vec2 a_pos;\n\n    void main() {\n      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n    }\n    ","\n     precision highp float;\n\n     void main() {\n      gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);\n     }\n    ",new Map([["a_pos",0]])))}_test(t){const e=this._rctx,i=new x.R(1);i.wrapMode=l.pF.CLAMP_TO_EDGE,i.dataType=l.ld.FLOAT,i.internalFormat=l.H0.RGBA32F,i.samplingMode=l.Cj.NEAREST;const n=new v.H(e,i),r=g.g.createVertex(e,l._U.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),s=new P.Z(e,new Map([["a_pos",0]]),new Map([["geometry",[new A._("a_pos",2,l.pe.UNSIGNED_SHORT,0,4)]]]),new Map([["geometry",r]]));e.gl.getError(),e.useProgram(t);const o=e.getBoundFramebufferObject(),{x:a,y:c,width:u,height:h}=e.getViewport();e.bindFramebuffer(n),e.setViewport(0,0,1,1),e.bindVAO(s),e.drawArrays(l.WR.TRIANGLE_STRIP,0,4);const d=(0,f.Ey)({blending:f.gh});e.setPipelineState(d),e.drawArrays(l.WR.TRIANGLE_STRIP,0,4);const p=e.gl.getError();return e.setViewport(a,c,u,h),e.bindFramebuffer(o),s.dispose(),n.dispose(),p!==e.gl.INVALID_OPERATION||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}}var R=i(38680);class O{constructor(t){this.rctx=t,this.floatBufferBlend=new E(t),this.svgPremultipliesAlpha=new R.H(t),this.doublePrecisionRequiresObfuscation=new C(t),this.drawArraysRequiresIndicesTypeReset=new S(t)}dispose(){this.doublePrecisionRequiresObfuscation.dispose(),this.svgPremultipliesAlpha.dispose(),this.floatBufferBlend.dispose(),this.drawArraysRequiresIndicesTypeReset.dispose()}}var F=i(58250);class z{constructor(t,e){this._gl=t,this._compressedTextureETC=null,this._compressedTextureS3TC=null,this._textureFilterAnisotropic=null,this._colorBufferFloat=null,this._loseContext=null,this._textureNorm16=null,this._textureFloatLinear=null,this._disabledExtensions=e.disabledExtensions||{},this._debugWebGLExtensions=e.debugWebGLExtensions||{}}get compressedTextureETC(){return this._compressedTextureETC??=function(t,e){if(e.compressedTextureETC)return null;const i=t.getExtension("WEBGL_compressed_texture_etc");return i?{COMPRESSED_R11_EAC:i.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:i.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:i.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:i.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:i.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:i.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}(this._gl,this._disabledExtensions),this._compressedTextureETC}get compressedTextureS3TC(){return this._compressedTextureS3TC??=function(t,e){if(e.compressedTextureS3TC)return null;const i=t.getExtension("WEBGL_compressed_texture_s3tc");return i?{COMPRESSED_RGB_S3TC_DXT1:i.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:i.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:i.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:i.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}(this._gl,this._disabledExtensions),this._compressedTextureS3TC}get textureFilterAnisotropic(){return this._textureFilterAnisotropic??=function(t,e){if(e.textureFilterAnisotropic)return null;const i=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return i?{MAX_TEXTURE_MAX_ANISOTROPY:i.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:i.TEXTURE_MAX_ANISOTROPY_EXT}:null}(this._gl,this._disabledExtensions),this._textureFilterAnisotropic}get disjointTimerQuery(){return this._disjointTimerQuery??=(0,F._R)(this._gl,this._disabledExtensions),this._disjointTimerQuery}get colorBufferFloat(){return this._colorBufferFloat??=function(t,e){const i=!e.colorBufferHalfFloat&&t.getExtension("EXT_color_buffer_half_float")||!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),n=!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),r=!e.floatBlend&&!e.colorBufferFloat&&t.getExtension("EXT_float_blend");return i||n||r?{textureFloat:!!n,textureHalfFloat:!!i,floatBlend:!!r,R16F:t.R16F,RG16F:t.RG16F,RGBA16F:t.RGBA16F,R32F:t.R32F,RG32F:t.RG32F,RGBA32F:t.RGBA32F,R11F_G11F_B10F:t.R11F_G11F_B10F,RGB16F:t.RGB16F}:null}(this._gl,this._disabledExtensions),this._colorBufferFloat}get loseContext(){return this._loseContext??=function(t,e){const i=e.loseContext&&t.getExtension("WEBGL_lose_context");return i?{loseRenderingContext:()=>i.loseContext()}:null}(this._gl,this._debugWebGLExtensions),this._loseContext}get textureNorm16(){return this._textureNorm16??=function(t,e){if(e.textureNorm16)return null;const i=t.getExtension("EXT_texture_norm16");return i?{R16:i.R16_EXT,RG16:i.RG16_EXT,RGB16:i.RGB16_EXT,RGBA16:i.RGBA16_EXT,R16_SNORM:i.R16_SNORM_EXT,RG16_SNORM:i.RG16_SNORM_EXT,RGB16_SNORM:i.RGB16_SNORM_EXT,RGBA16_SNORM:i.RGBA16_SNORM_EXT}:null}(this._gl,this._disabledExtensions),this._textureNorm16}get textureFloatLinear(){return this._textureFloatLinear??=function(t,e){if(e.textureFloatLinear)return!1;for(const e of["OES_texture_float_linear"])if(t.getExtension(e))return!0;return!1}(this._gl,this._disabledExtensions),this._textureFloatLinear}enable(t){return this[t]}}let D=class{constructor(t,e){this.gl=t,this.instanceCounter=new u,this.programCache=new d.J(this),this._transformFeedbackRequestInfo=null,this._state=new c,this._numOfDrawCalls=0,this._numOfTriangles=0,this._loadExtensions(),this.configure(e)}configure(t){this._capabilities=new z(this.gl,t),this._parameters=new h(this.gl,this._capabilities,t),p.g.TEXTURE_UNIT_FOR_UPDATES=this._parameters.maxTextureImageUnits-1;const e=this.gl.getParameter(this.gl.VIEWPORT);this._state=new c,this._state.viewport={x:e[0],y:e[1],width:e[2],height:e[3]},this._stateTracker=new f.Ms({setBlending:t=>{if(t){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(t.opRgb,t.opAlpha),this.setBlendFunctionSeparate(t.srcRgb,t.dstRgb,t.srcAlpha,t.dstAlpha);const e=t.color;this.setBlendColor(e.r,e.g,e.b,e.a)}else this.setBlendingEnabled(!1)},setCulling:t=>{t?(this.setFaceCullingEnabled(!0),this.setCullFace(t.face),this.setFrontFace(t.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:t=>{t?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(t.factor,t.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:t=>{t?(this.setDepthTestEnabled(!0),this.setDepthFunction(t.func)):this.setDepthTestEnabled(!1)},setStencilTest:t=>{if(t){this.setStencilTestEnabled(!0);const e=t.function;this.setStencilFunction(e.func,e.ref,e.mask);const i=t.operation;this.setStencilOp(i.fail,i.zFail,i.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:t=>{t?(this.setDepthWriteEnabled(!0),this.setDepthRange(t.zNear,t.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:t=>{t?this.setColorMask(t.r,t.g,t.b,t.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:t=>{t?this.setStencilWriteMask(t.mask):this.setStencilWriteMask(0)},setDrawBuffers:t=>{if(t)this.setDrawBuffers(t.buffers);else{const{drawFramebuffer:t}=this._state;null===t?this.setDrawBuffers([l.Hr.BACK]):0===t.colorAttachments.length?this.setDrawBuffers([l.Hr.NONE]):this.setDrawBuffers([l.Nm.COLOR_ATTACHMENT0])}}}),this.enforceState(),(0,r.WD)(this._driverTest),this._driverTest=new O(this)}dispose(){(0,r.WD)(this._driverTest),this.programCache.dispose(),this.bindVAO(null),this.unbindBuffer(l.NZ.ARRAY_BUFFER),this.unbindBuffer(l.NZ.ELEMENT_ARRAY_BUFFER),this.unbindBuffer(l.NZ.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(l.NZ.PIXEL_PACK_BUFFER),this.unbindBuffer(l.NZ.PIXEL_UNPACK_BUFFER),this.unbindBuffer(l.NZ.COPY_READ_BUFFER),this.unbindBuffer(l.NZ.COPY_WRITE_BUFFER),this._state.textureUnitMap.length=0,(0,a.en)()&&console.log(this.instanceCounter.resourceInformation)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}setPipelineState(t){this._stateTracker.setPipeline(t)}setBlendingEnabled(t){this._state.blend!==t&&(!0===t?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=t,this._stateTracker.invalidateBlending())}externalProgramUpdate(){this._state.program?.stop(),this._state.program=null}externalTextureUnitUpdate(t,e){for(let e=0;e<t.length;++e)this._state.textureUnitMap[t[e]]=null;e>=0&&(this._state.activeTexture=e)}externalVertexArrayObjectUpdate(){this.gl.bindVertexArray(null),this._state.vertexArrayObject=null,this._state.vertexBuffer=null,this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(t,e,i,n){t===this._state.blendColor.r&&e===this._state.blendColor.g&&i===this._state.blendColor.b&&n===this._state.blendColor.a||(this.gl.blendColor(t,e,i,n),this._state.blendColor.r=t,this._state.blendColor.g=e,this._state.blendColor.b=i,this._state.blendColor.a=n,this._stateTracker.invalidateBlending())}setBlendFunction(t,e){t===this._state.blendFunction.srcRGB&&e===this._state.blendFunction.dstRGB||(this.gl.blendFunc(t,e),this._state.blendFunction.srcRGB=t,this._state.blendFunction.srcAlpha=t,this._state.blendFunction.dstRGB=e,this._state.blendFunction.dstAlpha=e,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(t,e,i,n){this._state.blendFunction.srcRGB===t&&this._state.blendFunction.srcAlpha===i&&this._state.blendFunction.dstRGB===e&&this._state.blendFunction.dstAlpha===n||(this.gl.blendFuncSeparate(t,e,i,n),this._state.blendFunction.srcRGB=t,this._state.blendFunction.srcAlpha=i,this._state.blendFunction.dstRGB=e,this._state.blendFunction.dstAlpha=n,this._stateTracker.invalidateBlending())}setBlendEquation(t){this._state.blendEquation.mode!==t&&(this.gl.blendEquation(t),this._state.blendEquation.mode=t,this._state.blendEquation.modeAlpha=t,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(t,e){this._state.blendEquation.mode===t&&this._state.blendEquation.modeAlpha===e||(this.gl.blendEquationSeparate(t,e),this._state.blendEquation.mode=t,this._state.blendEquation.modeAlpha=e,this._stateTracker.invalidateBlending())}setColorMask(t,e,i,n){this._state.colorMask.r===t&&this._state.colorMask.g===e&&this._state.colorMask.b===i&&this._state.colorMask.a===n||(this.gl.colorMask(t,e,i,n),this._state.colorMask.r=t,this._state.colorMask.g=e,this._state.colorMask.b=i,this._state.colorMask.a=n,this._stateTracker.invalidateColorWrite())}setClearColor(t,e,i,n){this._state.clearColor.r===t&&this._state.clearColor.g===e&&this._state.clearColor.b===i&&this._state.clearColor.a===n||(this.gl.clearColor(t,e,i,n),this._state.clearColor.r=t,this._state.clearColor.g=e,this._state.clearColor.b=i,this._state.clearColor.a=n)}setFaceCullingEnabled(t){this._state.faceCulling!==t&&(!0===t?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=t,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(t){this._state.polygonOffsetFill!==t&&(!0===t?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=t,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(t,e){this._state.polygonOffset[0]===t&&this._state.polygonOffset[1]===e||(this._state.polygonOffset[0]=t,this._state.polygonOffset[1]=e,this.gl.polygonOffset(t,e),this._stateTracker.invalidatePolygonOffset())}setCullFace(t){this._state.cullFace!==t&&(this.gl.cullFace(t),this._state.cullFace=t,this._stateTracker.invalidateCulling())}setFrontFace(t){this._state.frontFace!==t&&(this.gl.frontFace(t),this._state.frontFace=t,this._stateTracker.invalidateCulling())}setScissorTestEnabled(t){this._state.scissorTest!==t&&(!0===t?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=t)}setScissorRect(t,e,i,n){this._state.scissorRect.x===t&&this._state.scissorRect.y===e&&this._state.scissorRect.width===i&&this._state.scissorRect.height===n||(this.gl.scissor(t,e,i,n),this._state.scissorRect.x=t,this._state.scissorRect.y=e,this._state.scissorRect.width=i,this._state.scissorRect.height=n)}setDepthTestEnabled(t){this._state.depthTest!==t&&(!0===t?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=t,this._stateTracker.invalidateDepthTest())}setClearDepth(t){this._state.clearDepth!==t&&(this.gl.clearDepth(t),this._state.clearDepth=t)}setDepthFunction(t){this._state.depthFunction!==t&&(this.gl.depthFunc(t),this._state.depthFunction=t,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(t){this._state.depthWrite!==t&&(this.gl.depthMask(t),this._state.depthWrite=t,this._stateTracker.invalidateDepthWrite())}setDepthRange(t,e){this._state.depthRange.zNear===t&&this._state.depthRange.zFar===e||(this.gl.depthRange(t,e),this._state.depthRange.zNear=t,this._state.depthRange.zFar=e,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(t){this._state.stencilTest!==t&&(!0===t?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=t,this._stateTracker.invalidateStencilTest())}setClearStencil(t){t!==this._state.clearStencil&&(this.gl.clearStencil(t),this._state.clearStencil=t)}setStencilFunction(t,e,i){this._state.stencilFunction.func===t&&this._state.stencilFunction.ref===e&&this._state.stencilFunction.mask===i||(this.gl.stencilFunc(t,e,i),this._state.stencilFunction.face=l.Y7.FRONT_AND_BACK,this._state.stencilFunction.func=t,this._state.stencilFunction.ref=e,this._state.stencilFunction.mask=i,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(t,e,i,n){this._state.stencilFunction.face===t&&this._state.stencilFunction.func===e&&this._state.stencilFunction.ref===i&&this._state.stencilFunction.mask===n||(this.gl.stencilFuncSeparate(t,e,i,n),this._state.stencilFunction.face=t,this._state.stencilFunction.func=e,this._state.stencilFunction.ref=i,this._state.stencilFunction.mask=n,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(t){this._state.stencilWriteMask!==t&&(this.gl.stencilMask(t),this._state.stencilWriteMask=t,this._stateTracker.invalidateStencilWrite())}setStencilOp(t,e,i){this._state.stencilOperation.face===l.Y7.FRONT_AND_BACK&&this._state.stencilOperation.fail===t&&this._state.stencilOperation.zFail===e&&this._state.stencilOperation.zPass===i||(this.gl.stencilOp(t,e,i),this._state.stencilOperation.face=l.Y7.FRONT_AND_BACK,this._state.stencilOperation.fail=t,this._state.stencilOperation.zFail=e,this._state.stencilOperation.zPass=i,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(t,e,i,n){this._state.stencilOperation.face===t&&this._state.stencilOperation.fail===e&&this._state.stencilOperation.zFail===i&&this._state.stencilOperation.zPass===n||(this.gl.stencilOpSeparate(t,e,i,n),this._state.stencilOperation.face=t,this._state.stencilOperation.fail=e,this._state.stencilOperation.zFail=i,this._state.stencilOperation.zPass=n,this._stateTracker.invalidateStencilTest())}setActiveTexture(t,e=!1){const i=this._state.activeTexture;return t>=0&&(e||t!==this._state.activeTexture)&&(this.gl.activeTexture(l.xM+t),this._state.activeTexture=t),i}setDrawBuffers(t){const{drawFramebuffer:e}=this._state,i=null===e,n=i?this._state.drawBuffers.defaultFramebuffer:this._state.drawBuffers.fbos.get(e);if(n?.length!==t.length||!n.every(((e,i)=>e===t[i])))if(t.length>this.parameters.maxDrawBuffers)console.error("Setting more active draw buffers than GL.MAX_DRAW_BUFFERS allows.");else{if(i){if(t.length>1)return void console.error("The default framebuffer can only have one active draw buffer.");if(t[0]!==l.Hr.BACK&&t[0]!==l.Hr.NONE)return void console.error("The default framebuffer can only use the constants GL.BACK or GL.NONE as draw buffers.")}i||!t.includes(l.Hr.BACK)?(this.gl.drawBuffers(t),i?this._state.drawBuffers.defaultFramebuffer=t:this._state.drawBuffers.fbos.set(e,t),this._stateTracker.invalidateDrawBuffers()):console.error("A framebuffer object can only use the constants GL.COLOR_ATTACHMENTi or GL.NONE as draw buffers.")}}clear(t,e=255){if(t){if(t&l.NV.COLOR){const t=this._state.drawFramebuffer?.colorAttachments;t&&this.setDrawBuffers(t),this.setColorMask(!0,!0,!0,!0)}t&l.NV.DEPTH&&this.setDepthWriteEnabled(!0),t&l.NV.STENCIL&&this.setStencilWriteMask(e),this.gl.clear(t)}}clearFramebuffer(t,e=!1,i=!1){let n=0;if(t){const e=1e-13,i=Math.max(e,t[3]);this.setClearColor(t[0],t[1],t[2],i),n|=l.NV.COLOR}e&&(n|=l.NV.DEPTH),!1===i?i=0:(!0===i&&(i=255),n|=l.NV.STENCIL),n&&this.clear(n,i)}drawArrays(t,e,i){if(this._transformFeedbackRequestInfo){if(t!==this._transformFeedbackRequestInfo.primitiveType)throw new Error("DrawArrays called during transform feedback, but primitiveType does not match that of the current transform feedback request");if(null==this._state.program?.hasTransformFeedbackVaryings)throw new Error("DrawArrays called during transform feedback, but the shader program was not linked with a transform feedback varying")}if((0,a.en)()){this._numOfDrawCalls++,this._numOfTriangles+=k(t,i);const e=this._state.textureUnitMap;for(let t=0;t<e.length;t++){const i=e[t];if(null!=i&&i===this._state.drawFramebuffer?.colorTexture)throw new Error(`Detected readWrite. Texture already bound at index ${t}`)}}this.gl.drawArrays(t,e,i),(0,a.Y2)(this.gl)}drawArraysInstanced(t,e,i,n){this.gl.drawArraysInstanced(t,e,i,n),(0,a.Y2)(this.gl)}drawElements(t,e,i,n){if(this._transformFeedbackRequestInfo)throw new Error("Cannot called drawElements during a transform feedback request");if((0,a.en)()&&(this._numOfDrawCalls++,this._numOfTriangles+=k(t,e)),this.gl.drawElements(t,e,i,n),(0,a.en)()){const r=(0,_.WH)(this);if(r){const s=this.getBoundVAO(),o=s?.indexBuffer,a=s?.vertexBuffers,l={indexBuffer:o,vertexBuffers:a},c={mode:t,count:e,type:i,offset:n},u=o?.size??0,h=n+e,d=u<h?`. Buffer is too small. Attempted to draw index ${h} of ${u}`:"";console.error(`drawElements: ${r}${d}`,{args:c,vao:l})}}}drawElementsInstanced(t,e,i,n,r){this.gl.drawElementsInstanced(t,e,i,n,r),(0,a.Y2)(this.gl)}logInfo(){(0,a.en)()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){(0,a.en)()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}get capabilities(){return this._capabilities}setViewport(t,e,i,n){i=Math.max(Math.round(i),1),n=Math.max(Math.round(n),1);const r=this._state.viewport;r.x===t&&r.y===e&&r.width===i&&r.height===n||(r.x=t,r.y=e,r.width=i,r.height=n,this.gl.viewport(t,e,i,n))}setViewport4fv(t){this.setViewport(t[0],t[1],t[2],t[3])}restoreViewport({x:t,y:e,width:i,height:n}){this.setViewport(t,e,i,n)}getViewport(){const t=this._state.viewport;return{x:t.x,y:t.y,width:t.width,height:t.height}}useProgram(t){this._state.program!==t&&(this._state.program?.stop(),this._state.program=t,this.gl.useProgram(t?.glName??null))}bindTexture(t,e,i=!1){(e>=this.parameters.maxTextureImageUnits||e<0)&&console.error("Input texture unit is out of range of available units!");const n=this._state.textureUnitMap[e];return null==t?.glName?(null!=n&&(this.setActiveTexture(e,i),this.gl.bindTexture(n.descriptor.target,null)),this._state.textureUnitMap[e]=null,n):i||n!==t?(this.setActiveTexture(e,i),this.gl.bindTexture(t.descriptor.target,t.glName),t.applyChanges(),this._state.textureUnitMap[e]=t,n):(t.isDirty&&(this.setActiveTexture(e,i),t.applyChanges()),n)}unbindTexture(t){if(null!=t)for(let e=0;e<this.parameters.maxTextureImageUnits;e++)this._state.textureUnitMap[e]===t&&(this.bindTexture(null,e),this._state.textureUnitMap[e]=null)}bindFramebuffer(t,e=!1){if(e||this._state.readFramebuffer!==t||this._state.drawFramebuffer!==t){if(this._stateTracker.invalidateDrawBuffers(),null==t)return this.gl.bindFramebuffer(l.R.FRAMEBUFFER,null),void(this._state.readFramebuffer=this._state.drawFramebuffer=null);t.initializeAndBind(l.R.FRAMEBUFFER),this._state.readFramebuffer=t,this._state.drawFramebuffer=t}}bindFramebufferSeparate(t,e,i=!1){const n=e===l.R.READ_FRAMEBUFFER,r=n?this._state.readFramebuffer:this._state.drawFramebuffer;(i||r!==t)&&(null==t?this.gl.bindFramebuffer(e,null):t.initializeAndBind(e),n?this._state.readFramebuffer=t??null:(this._stateTracker.invalidateDrawBuffers(),this._state.drawFramebuffer=t??null))}blitFramebuffer(t,e,i=0,n=0,r=t.width,s=t.height,o=0,a=0,c=e.width,u=e.height,h=l.NV.COLOR,d=l.Cj.NEAREST){this.bindFramebufferSeparate(t,l.R.READ_FRAMEBUFFER),this.bindFramebufferSeparate(e,l.R.DRAW_FRAMEBUFFER),this.gl.blitFramebuffer(i,n,r,s,o,a,c,u,h,d)}bindBuffer(t,e){if(t)switch(e??=t.bufferType,e){case l.NZ.ARRAY_BUFFER:this._state.vertexBuffer=L(this.gl,t,e,this._state.vertexBuffer);break;case l.NZ.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=L(this.gl,t,e,this._state.indexBuffer);break;case l.NZ.UNIFORM_BUFFER:this._state.uniformBuffer=L(this.gl,t,e,this._state.uniformBuffer);break;case l.NZ.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=L(this.gl,t,e,this._state.pixelPackBuffer);break;case l.NZ.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=L(this.gl,t,e,this._state.pixelUnpackBuffer);break;case l.NZ.COPY_READ_BUFFER:this._state.copyReadBuffer=L(this.gl,t,e,this._state.copyReadBuffer);break;case l.NZ.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=L(this.gl,t,e,this._state.copyWriteBuffer);break;case l.NZ.TRANSFORM_FEEDBACK_BUFFER:this._state.transformFeedbackBuffer=L(this.gl,t,e,this._state.transformFeedbackBuffer)}}bindRenderbuffer(t){const e=this.gl;t||(e.bindRenderbuffer(e.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==t&&(e.bindRenderbuffer(e.RENDERBUFFER,t.glName),this._state.renderbuffer=t)}_getBufferBinding(t,e){if(e>=this.parameters.maxUniformBufferBindings||e<0)return console.error("Uniform buffer binding point is out of range!"),null;const i=t===l.NZ.UNIFORM_BUFFER?this._state.uniformBufferBindingPoints:this._state.transformBufferBindingPoints;let n=i[e];return null==n&&(n={buffer:null,offset:0,size:0},i[e]=n),n}bindBufferBase(t,e,i){const n=this._getBufferBinding(t,e);null!=n&&(n.buffer===i&&0===n.offset&&0===n.size||(this.gl.bindBufferBase(t,e,i?i.glName:null),n.buffer=i,n.offset=0,n.size=0))}bindBufferRange(t,e,i,n,r){const s=this._getBufferBinding(t,e);null!=s&&(s.buffer===i&&s.offset===n&&s.size===r||(n%this._parameters.uniformBufferOffsetAlignment==0?(this.gl.bindBufferRange(t,e,i.glName,n,r),s.buffer=i,s.offset=n,s.size=r):console.error("Uniform buffer binding offset is not a multiple of the context offset alignment")))}bindUBO(t,e,i,n){null!=e?((0,a.en)()&&(n??e.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),e.initialize(),void 0!==i&&void 0!==n?this.bindBufferRange(l.NZ.UNIFORM_BUFFER,t,e.buffer,i,n):this.bindBufferBase(l.NZ.UNIFORM_BUFFER,t,e.buffer)):this.bindBufferBase(l.NZ.UNIFORM_BUFFER,t,null)}unbindUBO(t){for(let e=0,i=this._state.uniformBufferBindingPoints.length;e<i;e++){const i=this._state.uniformBufferBindingPoints[e];null!=i&&i.buffer===t.buffer&&this.bindBufferBase(l.NZ.UNIFORM_BUFFER,e,null)}}unbindBuffer(t){switch(t){case l.NZ.ARRAY_BUFFER:this._state.vertexBuffer=L(this.gl,null,t,this._state.vertexBuffer);break;case l.NZ.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=L(this.gl,null,t,this._state.indexBuffer);break;case l.NZ.UNIFORM_BUFFER:this._state.uniformBuffer=L(this.gl,null,t,this._state.uniformBuffer);break;case l.NZ.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=L(this.gl,null,t,this._state.pixelPackBuffer);break;case l.NZ.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=L(this.gl,null,t,this._state.pixelUnpackBuffer);break;case l.NZ.COPY_READ_BUFFER:this._state.copyReadBuffer=L(this.gl,null,t,this._state.copyReadBuffer);break;case l.NZ.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=L(this.gl,null,t,this._state.copyWriteBuffer)}}bindVAO(t=null){null!=t?this._state.vertexArrayObject!==t&&(t.bind(),this._state.vertexArrayObject=t):this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null)}bindTransformFeedback(t){const{gl:e}=this;e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,t.glName)}beginTransformFeedback(t,e){if(this._transformFeedbackRequestInfo)throw new Error("Already in a transform feedback request");const{gl:i}=this;i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,t.glName),i.beginTransformFeedback(e),this._transformFeedbackRequestInfo={primitiveType:e}}endTransformFeedback(){if(!this._transformFeedbackRequestInfo)throw new Error("Not in a transform feedback request");const{gl:t}=this;t.endTransformFeedback(),t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null),this._transformFeedbackRequestInfo=null}async clientWaitAsync(t=(0,o.l5)(10)){const{gl:e}=this,i=e.fenceSync(l.tx.SYNC_GPU_COMMANDS_COMPLETE,0);if(!i)throw new Error("Client wait failed, could not create sync object");let n;this.instanceCounter.increment(l.vt.Sync,i),e.flush();do{await(0,s.Pl)(t),n=e.clientWaitSync(i,0,0)}while(n===l.sS.TIMEOUT_EXPIRED);if(this.instanceCounter.decrement(l.vt.Sync,i),e.deleteSync(i),n===l.sS.WAIT_FAILED)throw new Error("Client wait failed")}getBoundFramebufferObject(t=l.R.FRAMEBUFFER){return t===l.R.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer(l.NZ.ARRAY_BUFFER),this.unbindBuffer(l.NZ.ELEMENT_ARRAY_BUFFER),this.unbindBuffer(l.NZ.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(l.NZ.PIXEL_PACK_BUFFER),this.unbindBuffer(l.NZ.PIXEL_UNPACK_BUFFER),this.unbindBuffer(l.NZ.COPY_READ_BUFFER),this.unbindBuffer(l.NZ.COPY_WRITE_BUFFER);for(let t=0;t<this.parameters.maxTextureImageUnits;++t)this.bindTexture(null,t);this.setBlendingEnabled(!1),this.setBlendFunction(l.dn.ONE,l.dn.ZERO),this.setBlendEquation(l.Tb.ADD),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(l.Y7.BACK),this.setFrontFace(l.Ac.CCW),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(l.MT.LESS),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(l.MT.ALWAYS,0,0),this.setStencilOp(l.eA.KEEP,l.eA.KEEP,l.eA.KEEP),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setDrawBuffers([l.Hr.BACK]),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){const{gl:t}=this;t.bindVertexArray(null);for(let e=0;e<this.parameters.maxVertexAttributes;e++)t.disableVertexAttribArray(e);this._state.vertexBuffer?t.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):t.bindBuffer(l.NZ.ARRAY_BUFFER,null),this._state.indexBuffer?t.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):t.bindBuffer(l.NZ.ELEMENT_ARRAY_BUFFER,null),this._state.uniformBuffer?t.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):t.bindBuffer(l.NZ.UNIFORM_BUFFER,null);for(let e=0;e<this._parameters.maxUniformBufferBindings;e++){const i=this._state.uniformBufferBindingPoints[e];if(null!=i){const{buffer:n,offset:r,size:s}=i;null!==n?0===r&&0===s?t.bindBufferBase(l.NZ.UNIFORM_BUFFER,e,n.glName):t.bindBufferRange(l.NZ.UNIFORM_BUFFER,e,n.glName,r,s):t.bindBufferBase(l.NZ.UNIFORM_BUFFER,e,null)}}if(this._state.pixelPackBuffer?t.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):t.bindBuffer(l.NZ.PIXEL_PACK_BUFFER,null),this._state.pixelUnpackBuffer?t.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):t.bindBuffer(l.NZ.PIXEL_UNPACK_BUFFER,null),this._state.copyReadBuffer?t.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):t.bindBuffer(l.NZ.COPY_READ_BUFFER,null),this._state.copyWriteBuffer?t.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):t.bindBuffer(l.NZ.COPY_WRITE_BUFFER,null),t.bindFramebuffer(l.R.READ_FRAMEBUFFER,null),t.readBuffer(t.BACK),this._state.readFramebuffer&&(t.bindFramebuffer(l.R.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),t.readBuffer(l.Nm.COLOR_ATTACHMENT0)),t.bindFramebuffer(l.R.DRAW_FRAMEBUFFER,this._state.drawFramebuffer?.glName??null),null===this._state.drawFramebuffer){const e=this._state.drawBuffers.defaultFramebuffer;t.drawBuffers(e??[l.Hr.BACK])}else{const e=this._state.drawBuffers.fbos.get(this._state.drawFramebuffer);t.drawBuffers(e??[l.Nm.COLOR_ATTACHMENT0])}if(this._state.vertexArrayObject){const t=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(t)}t.useProgram(this._state.program?.glName??null),t.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),t.bindRenderbuffer(t.RENDERBUFFER,this._state.renderbuffer?.glName??null),!0===this._state.blend?t.enable(this.gl.BLEND):t.disable(this.gl.BLEND),t.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),t.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),t.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),t.clearDepth(this._state.clearDepth),t.clearStencil(this._state.clearStencil),t.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),t.cullFace(this._state.cullFace),t.depthFunc(this._state.depthFunction),t.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),!0===this._state.depthTest?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),t.depthMask(this._state.depthWrite),t.frontFace(this._state.frontFace),t.lineWidth(1),!0===this._state.faceCulling?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),t.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),!0===this._state.polygonOffsetFill?t.enable(t.POLYGON_OFFSET_FILL):t.disable(t.POLYGON_OFFSET_FILL),t.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),!0===this._state.scissorTest?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST),t.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),t.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),!0===this._state.stencilTest?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),t.stencilMask(this._state.stencilWriteMask);for(let e=0;e<this.parameters.maxTextureImageUnits;e++){t.activeTexture(l.xM+e),t.bindTexture(l.Ap.TEXTURE_2D,null),t.bindTexture(l.Ap.TEXTURE_CUBE_MAP,null),t.bindTexture(l.Ap.TEXTURE_3D,null),t.bindTexture(l.Ap.TEXTURE_2D_ARRAY,null);const i=this._state.textureUnitMap[e];null!=i&&t.bindTexture(i.descriptor.target,i.glName)}t.activeTexture(l.xM+this._state.activeTexture);const e=this._state.viewport;t.viewport(e.x,e.y,e.width,e.height),this.resetInfo()}_loadExtensions(){this.gl.getExtension("KHR_parallel_shader_compile")}};function L(t,e,i,n){return e?n!==e&&t.bindBuffer(i,e.glName):t.bindBuffer(i,null),e}function k(t,e){switch(t){case l.WR.POINTS:return 2*e;case l.WR.TRIANGLES:return e/3;case l.WR.TRIANGLE_STRIP:case l.WR.TRIANGLE_FAN:return e-2;default:return 0}}},65644:function(t,e,i){i.d(e,{Z:function(){return n}});class n{constructor(t){this._readFile=t}resolveIncludes(t){return this._resolve(t)}_resolve(t,e=new Map){if(e.has(t))return e.get(t);const i=this._read(t);if(!i)throw new Error(`cannot find shader file ${t}`);const n=/^[^\S\n]*#include\s+<(\S+)>[^\S\n]?/gm;let r=n.exec(i);const s=[];for(;null!=r;)s.push({path:r[1],start:r.index,length:r[0].length}),r=n.exec(i);let o=0,a="";return s.forEach((t=>{a+=i.slice(o,t.start),a+=e.has(t.path)?"":this._resolve(t.path,e),o=t.start+t.length})),a+=i.slice(o),e.set(t,a),a}_read(t){return this._readFile(t)}}},81438:function(t,e,i){i.d(e,{Z:function(){return c}});var n=i(40633),r=i(95929),s=i(24540),o=i(85456),a=i(93380);const l=()=>n.A.getLogger("esri.views.webgl.VertexArrayObject");let c=class{constructor(t,e,i,n,r=null){this._context=t,this._locations=e,this._layout=i,this._buffers=n,this._indexBuffer=r,this._glName=null,this._initialized=!1}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get byteSize(){return Array.from(this._buffers.values()).reduce(((t,e)=>t+e.usedMemory),null!=this._indexBuffer?this._indexBuffer.usedMemory:0)}get layout(){return this._layout}get locations(){return this._locations}get usedMemory(){return this.byteSize+(Object.keys(this._buffers).length+(this._indexBuffer?1:0))*s.zQ}dispose(){this._context?(this._context.getBoundVAO()===this&&this._context.bindVAO(null),this._buffers.forEach((t=>t.dispose())),this._buffers.clear(),this._indexBuffer=(0,r.WD)(this._indexBuffer),this.disposeVAOOnly()):(this._glName||Object.getOwnPropertyNames(this._buffers).length>0)&&l().warn("Leaked WebGL VAO")}disposeVAOOnly(){this._glName&&(this._context.gl.deleteVertexArray(this._glName),this._glName=null,this._context.instanceCounter.decrement(o.vt.VertexArrayObject,this)),this._context=null}initialize(){if(this._initialized)return;const{gl:t}=this._context,e=t.createVertexArray();t.bindVertexArray(e),this._bindLayout(),t.bindVertexArray(null),this._glName=e,this._context.instanceCounter.increment(o.vt.VertexArrayObject,this),this._initialized=!0}bind(){this.initialize(),this._context.gl.bindVertexArray(this.glName)}_bindLayout(){const{_buffers:t,_layout:e,_indexBuffer:i}=this;t||l().error("Vertex buffer dictionary is empty!");const n=this._context.gl;this._buffers.forEach(((t,i)=>{const n=e.get(i);n?(0,a.yu)(this._context,this._locations,t,n):l().error("Vertex element descriptor is empty!")})),null!=i&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,i.glName)}unbind(){this.initialize(),this._context.gl.bindVertexArray(null)}}},10106:function(t,e,i){i.d(e,{_:function(){return r}});var n=i(95929);class r{constructor(){this._result=!1}dispose(){this._program=(0,n.WD)(this._program)}get result(){return null!=this._program&&(this._result=this._test(this._program),this.dispose()),this._result}}},58250:function(t,e,i){i.d(e,{_R:function(){return s}});class n{constructor(t,e,i,n,r,s,o,a,l){this.createQuery=t,this.deleteQuery=e,this.resultAvailable=i,this.getResult=n,this.disjoint=r,this.beginTimeElapsed=s,this.endTimeElapsed=o,this.createTimestamp=a,this.timestampBits=l}}let r=!1;function s(t,e){if(e.disjointTimerQuery)return null;let i=t.getExtension("EXT_disjoint_timer_query_webgl2");return i?new n((()=>t.createQuery()),(e=>{t.deleteQuery(e),r=!1}),(e=>t.getQueryParameter(e,t.QUERY_RESULT_AVAILABLE)),(e=>t.getQueryParameter(e,t.QUERY_RESULT)),(()=>t.getParameter(i.GPU_DISJOINT_EXT)),(e=>{r||(r=!0,t.beginQuery(i.TIME_ELAPSED_EXT,e))}),(()=>{t.endQuery(i.TIME_ELAPSED_EXT),r=!1}),(t=>i.queryCounterEXT(t,i.TIMESTAMP_EXT)),(()=>t.getQuery(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT))):(i=t.getExtension("EXT_disjoint_timer_query"),i?new n((()=>i.createQueryEXT()),(t=>{i.deleteQueryEXT(t),r=!1}),(t=>i.getQueryObjectEXT(t,i.QUERY_RESULT_AVAILABLE_EXT)),(t=>i.getQueryObjectEXT(t,i.QUERY_RESULT_EXT)),(()=>t.getParameter(i.GPU_DISJOINT_EXT)),(t=>{r||(r=!0,i.beginQueryEXT(i.TIME_ELAPSED_EXT,t))}),(()=>{i.endQueryEXT(i.TIME_ELAPSED_EXT),r=!1}),(t=>i.queryCounterEXT(t,i.TIMESTAMP_EXT)),(()=>i.getQueryEXT(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT))):null)}},44476:function(t,e,i){function n(t,e,i){for(let n=0;n<i;++n)e[2*n]=t[n],e[2*n+1]=t[n]-e[2*n]}function r(t,e){const i=t.length;for(let n=0;n<i;++n)o[0]=t[n],e[n]=o[0];return e}function s(t,e){const i=t.length;for(let n=0;n<i;++n)o[0]=t[n],o[1]=t[n]-o[0],e[n]=o[1];return e}i.d(e,{Zo:function(){return r},jA:function(){return s},jS:function(){return n}});const o=new Float32Array(2)},72785:function(t,e,i){function n(t){const{options:e,value:i}=t;return"number"==typeof e[i]}function r(t){let e="";for(const i in t){const r=t[i];if("boolean"==typeof r)r&&(e+=`#define ${i}\n`);else if("number"==typeof r)e+=`#define ${i} ${r.toFixed()}\n`;else if("object"==typeof r)if(n(r)){const{value:t,options:n,namespace:s}=r,o=s?`${s}_`:"";for(const t in n)e+=`#define ${o}${t} ${n[t].toFixed()}\n`;e+=`#define ${i} ${o}${t}\n`}else{const t=r.options;let n=0;for(const i in t)e+=`#define ${t[i]} ${(n++).toFixed()}\n`;e+=`#define ${i} ${t[r.value]}\n`}}return e}i.d(e,{I:function(){return r}})},57087:function(t,e,i){i.d(e,{Ey:function(){return T},Ky:function(){return c},Ms:function(){return Z},Os:function(){return l},Uy:function(){return f},Xt:function(){return d},gh:function(){return a},hG:function(){return h},kn:function(){return p},p3:function(){return o}});var n=i(54407),r=i(85456);function s(t,e,i=r.Tb.ADD,n=[0,0,0,0]){return{srcRgb:t,srcAlpha:t,dstRgb:e,dstAlpha:e,opRgb:i,opAlpha:i,color:{r:n[0],g:n[1],b:n[2],a:n[3]}}}function o(t,e,i,n,s=r.Tb.ADD,o=r.Tb.ADD,a=[0,0,0,0]){return{srcRgb:t,srcAlpha:e,dstRgb:i,dstAlpha:n,opRgb:s,opAlpha:o,color:{r:a[0],g:a[1],b:a[2],a:a[3]}}}const a=s(r.dn.ZERO,r.dn.ONE_MINUS_SRC_ALPHA),l=(s(r.dn.ONE,r.dn.ZERO),s(r.dn.ONE,r.dn.ONE),s(r.dn.ONE,r.dn.ONE_MINUS_SRC_ALPHA)),c=o(r.dn.SRC_ALPHA,r.dn.ONE,r.dn.ONE_MINUS_SRC_ALPHA,r.dn.ONE_MINUS_SRC_ALPHA),u={face:r.Y7.BACK,mode:r.Ac.CCW},h={face:r.Y7.FRONT,mode:r.Ac.CCW},d=t=>t===n.s2.Back?u:t===n.s2.Front?h:null,f={zNear:0,zFar:1},p={r:!0,g:!0,b:!0,a:!0};function _(t){return A.intern(t)}function m(t){return I.intern(t)}function g(t){return R.intern(t)}function y(t){return F.intern(t)}function v(t){return D.intern(t)}function x(t){return k.intern(t)}function b(t){return B.intern(t)}function S(t){return U.intern(t)}function w(t){return Y.intern(t)}function T(t){return H.intern(t)}class M{constructor(t,e){this._makeKey=t,this._makeRef=e,this._interns=new Map}intern(t){if(!t)return null;const e=this._makeKey(t),i=this._interns;return i.has(e)||i.set(e,this._makeRef(t)),i.get(e)??null}}function P(t){return"["+t.join(",")+"]"}const A=new M(C,(t=>({__tag:"Blending",...t})));function C(t){return t?P([t.srcRgb,t.srcAlpha,t.dstRgb,t.dstAlpha,t.opRgb,t.opAlpha,t.color.r,t.color.g,t.color.b,t.color.a]):null}const I=new M(E,(t=>({__tag:"Culling",...t})));function E(t){return t?P([t.face,t.mode]):null}const R=new M(O,(t=>({__tag:"PolygonOffset",...t})));function O(t){return t?P([t.factor,t.units]):null}const F=new M(z,(t=>({__tag:"DepthTest",...t})));function z(t){return t?P([t.func]):null}const D=new M(L,(t=>({__tag:"StencilTest",...t})));function L(t){return t?P([t.function.func,t.function.ref,t.function.mask,t.operation.fail,t.operation.zFail,t.operation.zPass]):null}const k=new M(N,(t=>({__tag:"DepthWrite",...t})));function N(t){return t?P([t.zNear,t.zFar]):null}const B=new M(V,(t=>({__tag:"ColorWrite",...t})));function V(t){return t?P([t.r,t.g,t.b,t.a]):null}const U=new M(G,(t=>({__tag:"StencilWrite",...t})));function G(t){return t?P([t.mask]):null}const Y=new M(W,(t=>({__tag:"DrawBuffers",...t})));function W(t){return t?P(t.buffers):null}const H=new M((function(t){return t?P([C(t.blending),E(t.culling),O(t.polygonOffset),z(t.depthTest),L(t.stencilTest),N(t.depthWrite),V(t.colorWrite),G(t.stencilWrite),W(t.drawBuffers)]):null}),(t=>({blending:_(t.blending),culling:m(t.culling),polygonOffset:g(t.polygonOffset),depthTest:y(t.depthTest),stencilTest:v(t.stencilTest),depthWrite:x(t.depthWrite),colorWrite:b(t.colorWrite),stencilWrite:S(t.stencilWrite),drawBuffers:w(t.drawBuffers)})));class Z{constructor(t){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._drawBuffersInvalid=!0,this._stateSetters=t}setPipeline(t){(this._pipelineInvalid||t!==this._pipeline)&&(this._setBlending(t.blending),this._setCulling(t.culling),this._setPolygonOffset(t.polygonOffset),this._setDepthTest(t.depthTest),this._setStencilTest(t.stencilTest),this._setDepthWrite(t.depthWrite),this._setColorWrite(t.colorWrite),this._setStencilWrite(t.stencilWrite),this._setDrawBuffers(t.drawBuffers),this._pipeline=t),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDrawBuffers(){this._drawBuffersInvalid=!0,this._pipelineInvalid=!0}_setBlending(t){this._blending=this._setSubState(t,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(t){this._culling=this._setSubState(t,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(t){this._polygonOffset=this._setSubState(t,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(t){this._depthTest=this._setSubState(t,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(t){this._stencilTest=this._setSubState(t,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(t){this._depthWrite=this._setSubState(t,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(t){this._colorWrite=this._setSubState(t,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(t){this._stencilWrite=this._setSubState(t,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setDrawBuffers(t){this._drawBuffers=this._setSubState(t,this._drawBuffers,this._drawBuffersInvalid,this._stateSetters.setDrawBuffers),this._drawBuffersInvalid=!1}_setSubState(t,e,i,n){return(i||t!==e)&&(n(t),this._pipelineInvalid=!0),t}}},38680:function(t,e,i){i.d(e,{H:function(){return h}});var n=i(94860),r=i(86305),s=i(85456),o=i(96402),a=i(12285),l=i(10956),c=i(81438),u=i(10106);class h extends u._{constructor(t){super(),this._rctx=t,this._program=t.programCache.acquire("\n    precision highp float;\n\n    attribute vec2 a_pos;\n    varying vec2 v_uv;\n\n    void main() {\n      v_uv = a_pos;\n      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n    }\n    ","\n    precision highp float;\n\n    varying vec2 v_uv;\n\n    uniform sampler2D u_texture;\n\n    void main() {\n      gl_FragColor = texture2D(u_texture, v_uv);\n    }\n    ",new Map([["a_pos",0]]))}dispose(){super.dispose()}_test(t){const e=this._rctx;if(!e.gl)return t.dispose(),!0;const i=new l.R(1);i.wrapMode=s.pF.CLAMP_TO_EDGE,i.samplingMode=s.Cj.NEAREST;const u=new o.H(e,i),h=r.g.createVertex(e,s._U.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),f=new c.Z(e,new Map([["a_pos",0]]),n.VS,new Map([["geometry",h]])),p=new l.R;p.samplingMode=s.Cj.LINEAR,p.wrapMode=s.pF.CLAMP_TO_EDGE;const _=new a.g(e,p,d);e.useProgram(t),e.bindTexture(_,0),t.setUniform1i("u_texture",0);const m=e.getBoundFramebufferObject(),{x:g,y:y,width:v,height:x}=e.getViewport();e.bindFramebuffer(u),e.setViewport(0,0,1,1),e.setClearColor(0,0,0,0),e.setBlendingEnabled(!1),e.clear(s.NV.COLOR),e.bindVAO(f),e.drawArrays(s.WR.TRIANGLE_STRIP,0,4);const b=new Uint8Array(4);return u.readPixels(0,0,1,1,s.Ab.RGBA,s.ld.UNSIGNED_BYTE,b),f.dispose(),u.dispose(),_.dispose(),e.setViewport(g,y,v,x),e.bindFramebuffer(m),255!==b[0]}}const d=new Image;d.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",d.width=5,d.height=5,d.decode()}}]);
//# sourceMappingURL=mapViewDeps.js.map