"use strict";(self.webpackChunkdefra=self.webpackChunkdefra||[]).push([[2377,4292,4957],{13283:function(e,t,r){r.r(t),r.d(t,{constructAssociationMetaDataFeatureSetFromUrl:function(){return te},constructFeatureSet:function(){return X},constructFeatureSetFromPortalItem:function(){return le},constructFeatureSetFromRelationship:function(){return re},constructFeatureSetFromUrl:function(){return Y},convertToFeatureSet:function(){return ae},createFeatureSetCollectionFromMap:function(){return se},createFeatureSetCollectionFromService:function(){return oe},initialiseMetaDataCache:function(){return Q}});var n=r(93040);class i{constructor(){this.declaredRootClass="esri.arcade.featureSetCollection",this._layerById={},this._layerByName={}}add(e,t,r){this._layerById[t]=r,this._layerByName[e]=r}async featureSetByName(e,t=!0,r=["*"]){return void 0===this._layerByName[e]?null:this._layerByName[e]}async featureSetById(e,t=!0,r=["*"]){return void 0===this._layerById[e]?null:this._layerById[e]}castToText(e=!1){return"object, FeatureSetCollection"}}var s=r(69243),o=r(93595),a=r(59469),l=r(25256),u=r(76),c=r(3724),p=r(65636),d=r(63394),h=r(54797),f=r(62032),y=r(88396),m=r(93393),g=r(16177);class w{constructor(){this.field="",this.tofieldname="",this.typeofstat="MIN",this.workingexpr=null}clone(){const e=new w;return e.field=this.field,e.tofieldname=this.tofieldname,e.typeofstat=this.typeofstat,e.workingexpr=this.workingexpr,e}static parseStatField(e,t,r,n){const i=new w;i.field=e;const s=g.WhereClause.create(t,{fieldsIndex:r,timeZone:n}),o=function(e){if("function"===e.parseTree.type){if(0===e.parseTree.args.value.length)return{name:e.parseTree.name,expr:null};if(e.parseTree.args.value.length>1)throw new m.L8(m.Z7.MissingStatisticParameters);const t=g.WhereClause.create((0,y.Mi)(e.parseTree.args.value[0],f.zl.Standardised,e.parameters),{fieldsIndex:e.fieldsIndex,timeZone:e.timeZone,currentUser:e.currentUser});return{name:e.parseTree.name,expr:t}}return null}(s);if(null===o)throw new m.L8(m.Z7.UnsupportedSqlFunction,{function:""});const a=o.name.toUpperCase().trim();if("MIN"===a){if(i.typeofstat="MIN",i.workingexpr=o.expr,null===s)throw new m.L8(m.Z7.InvalidFunctionParameters,{function:"min"})}else if("MAX"===a){if(i.typeofstat="MAX",i.workingexpr=o.expr,null===s)throw new m.L8(m.Z7.InvalidFunctionParameters,{function:"max"})}else if("COUNT"===a)i.typeofstat="COUNT",i.workingexpr=o.expr;else if("STDEV"===a){if(i.typeofstat="STDDEV",i.workingexpr=o.expr,null===s)throw new m.L8(m.Z7.InvalidFunctionParameters,{function:"stdev"})}else if("SUM"===a){if(i.typeofstat="SUM",i.workingexpr=o.expr,null===s)throw new m.L8(m.Z7.InvalidFunctionParameters,{function:"sum"})}else if("MEAN"===a){if(i.typeofstat="AVG",i.workingexpr=o.expr,null===s)throw new m.L8(m.Z7.InvalidFunctionParameters,{function:a})}else if("AVG"===a){if(i.typeofstat="AVG",i.workingexpr=o.expr,null===s)throw new m.L8(m.Z7.InvalidFunctionParameters,{function:"avg"})}else{if("VAR"!==a)throw new m.L8(m.Z7.UnsupportedSqlFunction,{function:a});if(i.typeofstat="VAR",i.workingexpr=o.expr,null===s)throw new m.L8(m.Z7.InvalidFunctionParameters,{function:"var"})}return i}toStatisticsName(){switch(this.typeofstat.toUpperCase()){case"MIN":return"min";case"MAX":return"max";case"SUM":return"sum";case"COUNT":default:return"count";case"VAR":return"var";case"STDDEV":return"stddev";case"AVG":return"avg"}}}var _=r(92709),v=r(83324),b=r(42042),S=r(359),I=r(70891),M=r(57165),x=r(56740),F=r(7103);function A(e){if(!e)return"COUNT";switch(e.toLowerCase()){case"max":return"MAX";case"var":case"variance":return"VAR";case"avg":case"average":case"mean":return"AVG";case"min":return"MIN";case"sum":return"SUM";case"stdev":case"stddev":return"STDDEV";case"count":return"COUNT"}return"COUNT"}class T extends p.A{constructor(e){super(e),this._decodedStatsfield=[],this._decodedGroupbyfield=[],this._candosimplegroupby=!0,this.phsyicalgroupbyfields=[],this.objectIdField="ROW__ID",this._internalObjectIdField="ROW__ID",this._adaptedFields=[],this.declaredClass="esri.arcade.featureset.actions.Aggregate",this._uniqueIds=1,this._maxQuery=10,this._maxProcessing=10,this._parent=e.parentfeatureset,this._config=e}isTable(){return!0}async _getSet(e){if(null===this._wset){const t=await this._getFilteredSet("",null,null,null,e);return this._wset=t,this._wset}return this._wset}_isInFeatureSet(){return f.J6.InFeatureSet}_nextUniqueName(e){for(;1===e["T"+this._uniqueIds.toString()];)this._uniqueIds++;const t="T"+this._uniqueIds.toString();return e[t]=1,t}_convertToEsriFieldType(e){return e}_initialiseFeatureSet(){const e={};let t=!1,r=1;const n=this._parent?this._parent.getFieldsIndex():new F.A([]);for(this.objectIdField="ROW__ID",this.globalIdField="";!1===t;){let e=!1;for(let t=0;t<this._config.groupbyfields.length;t++)if(this._config.groupbyfields[t].name.toLowerCase()===this.objectIdField.toLowerCase()){e=!0;break}if(!1===e)for(let t=0;t<this._config.statsfields.length;t++)if(this._config.statsfields[t].name.toLowerCase()===this.objectIdField.toLowerCase()){e=!0;break}!1===e?t=!0:(this.objectIdField="ROW__ID"+r.toString(),r++)}for(const e of this._config.statsfields){const t=new w;t.field=e.name,t.tofieldname=e.name,t.workingexpr=e.expression instanceof g.WhereClause?e.expression:g.WhereClause.create(e.expression,{fieldsIndex:n,timeZone:this.dateFieldsTimeZoneDefaultUTC}),t.typeofstat=A(e.statistic),this._decodedStatsfield.push(t)}this._decodedGroupbyfield=[];for(const e of this._config.groupbyfields){const t={name:e.name,singlefield:null,tofieldname:e.name,expression:e.expression instanceof g.WhereClause?e.expression:g.WhereClause.create(e.expression,{fieldsIndex:n,timeZone:this.dateFieldsTimeZoneDefaultUTC}),sqlType:null};this._decodedGroupbyfield.push(t)}if(null!==this._parent){this.geometryType=this._parent.geometryType,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField="";for(const t of this._parent.fields)e[t.name.toUpperCase()]=1;this.types=null,this.subtypes=null,this.subtypeField=""}else this.geometryType=f.ik.point,this.typeIdField="",this.types=null,this.subtypes=null,this.subtypeField="",this.spatialReference=new M.A({wkid:4326});this.fields=[];const i=new w;i.field=this._nextUniqueName(e),i.tofieldname=this.objectIdField,i.workingexpr=g.WhereClause.create(this._parent.objectIdField,{fieldsIndex:this._parent.getFieldsIndex(),timeZone:this.dateFieldsTimeZoneDefaultUTC}),i.typeofstat="MIN",this._decodedStatsfield.push(i);for(const t of this._decodedGroupbyfield){const r=new x.A;if(t.name=this._nextUniqueName(e),r.name=t.tofieldname,r.alias=r.name,(0,y.DA)(t.expression)){const e=this._parent.getField((0,y.YY)(t.expression,f.zl.Standardised));if(!e)throw new c.dr(c.D_.AggregationFieldNotFound);t.name=e.name,t.singlefield=e.name,this.phsyicalgroupbyfields.push(e.name),r.type=e.type,t.sqlType=e.type}else{r.type=this._convertToEsriFieldType((0,y.IY)(t.expression,this._parent.fields));const e=new x.A;e.name=t.name,e.alias=e.name,this.phsyicalgroupbyfields.push(t.name),this._adaptedFields.push(new l.Gr(e,t.expression)),this._candosimplegroupby=!1,t.sqlType=r.type}this.fields.push(r)}if(this._adaptedFields.length>0)for(const e of this._parent.fields)this._adaptedFields.push(new l.IO(e));for(let t=0;t<this._decodedStatsfield.length;t++){const r=new x.A;let n=null;const i=this._decodedStatsfield[t];i.field=this._nextUniqueName(e),i.tofieldname===this.objectIdField&&(this._internalObjectIdField=i.field),r.name=i.tofieldname,r.alias=r.name;const s=null!==i.workingexpr&&(0,y.DA)(i.workingexpr)?(0,y.YY)(i.workingexpr,f.zl.Standardised):"";switch(this._decodedStatsfield[t].typeofstat){case"SUM":if(""!==s){if(n=this._parent.getField(s),!n)throw new c.dr(c.D_.AggregationFieldNotFound);r.type=n.type}else r.type="double";break;case"MIN":case"MAX":if(""!==s){if(n=this._parent.getField(s),!n)throw new c.dr(c.D_.AggregationFieldNotFound);r.type=n.type}else r.type="double";break;case"COUNT":r.type="integer";break;case"STDDEV":case"VAR":case"AVG":if(""!==s&&(n=this._parent.getField(s),!n))throw new c.dr(c.D_.AggregationFieldNotFound);r.type="double"}this.fields.push(r)}}async _canDoAggregates(){return!1}async _getFeatures(e,t,r,n){-1!==t&&this._featureCache[t];const i=this._maxQuery;return!0===this._checkIfNeedToExpandKnownPage(e,i)?(await this._expandPagedSet(e,i,0,0,n),this._getFeatures(e,t,r,n)):"success"}async _getFilteredSet(e,t,r,n,i){if(""!==e)return new d.A([],[],!0,null);let s=null;const a={ordered:!1,nowhereclause:!1};if(await this._ensureLoaded(),null!==r)for(let e=0;e<this._decodedStatsfield.length;e++)if(!0===(0,y.Ju)(r,this._decodedStatsfield[e].tofieldname)){a.nowhereclause=!0,r=null;break}if(null!==n){a.ordered=!0;for(let e=0;e<this._decodedStatsfield.length;e++)if(!0===n.scanForField(this._decodedStatsfield[e].tofieldname)){n=null,a.ordered=!1;break}if(null!==n)for(const e of this._decodedGroupbyfield)if(null===e.singlefield&&!0===n.scanForField(e.tofieldname)){n=null,a.ordered=!1;break}}if(!1!==this._candosimplegroupby&&await this._parent._canDoAggregates(this.phsyicalgroupbyfields,this._decodedStatsfield,"",null,null)){let e=null;r&&(e=this._reformulateWhereClauseWithoutGroupByFields(r));let t=null;n&&(t=this._reformulateOrderClauseWithoutGroupByFields(n));const o=await this._parent._getAggregatePagesDataSourceDefinition(this.phsyicalgroupbyfields,this._decodedStatsfield,"",null,e,t,this._internalObjectIdField);return this._checkCancelled(i),s=!0===a.nowhereclause?new d.A(o._candidates.slice().concat(o._known.slice()),[],!0===a.ordered&&o._ordered,this._clonePageDefinition(o.pagesDefinition)):new d.A(o._candidates.slice(),o._known.slice(),!0===a.ordered&&o._ordered,this._clonePageDefinition(o.pagesDefinition)),s}let c=this._parent;if(this._adaptedFields.length>0&&(c=new l.a({parentfeatureset:this._parent,adaptedFields:this._adaptedFields,extraFilter:null})),!0===a.nowhereclause)s=new d.A(["GETPAGES"],[],!1,{aggregatefeaturesetpagedefinition:!0,resultOffset:0,resultRecordCount:this._maxQuery,internal:{fullyResolved:!1,workingItem:null,type:"manual",iterator:null,set:[],subfeatureset:new u.A({parentfeatureset:c,orderbyclause:new h.A(this.phsyicalgroupbyfields.join(",")+","+this._parent.objectIdField+" ASC")})}});else{let e=c;if(null!==r){let t=null;r&&(t=this._reformulateWhereClauseWithoutGroupByFields(r)),e=new o.A({parentfeatureset:e,whereclause:t})}s=new d.A(["GETPAGES"],[],!1,{aggregatefeaturesetpagedefinition:!0,resultOffset:0,resultRecordCount:this._maxQuery,internal:{fullyResolved:!1,workingItem:null,type:"manual",iterator:null,set:[],subfeatureset:new u.A({parentfeatureset:e,orderbyclause:new h.A(this.phsyicalgroupbyfields.join(",")+","+this._parent.objectIdField+" ASC")})}})}return s}_reformulateWhereClauseWithoutStatsFields(e){for(const t of this._decodedStatsfield)e=(0,y.bD)(e,t.tofieldname,(0,y.YY)(t.workingexpr,f.zl.Standardised),this._parent.getFieldsIndex());return e}_reformulateWhereClauseWithoutGroupByFields(e){for(const t of this._decodedGroupbyfield)t.tofieldname!==t.name&&(e=(0,y.bD)(e,t.tofieldname,(0,y.YY)(t.expression,f.zl.Standardised),this._parent.getFieldsIndex()));return e}_reformulateOrderClauseWithoutGroupByFields(e){const t=[];for(const e of this._decodedGroupbyfield)e.tofieldname!==e.name&&t.push({field:e.tofieldname,newfield:e.name});return t.length>0?e.replaceFields(t):e}_clonePageDefinition(e){return null===e?null:!0===e.aggregatefeaturesetpagedefinition?{aggregatefeaturesetpagedefinition:!0,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,internal:e.internal}:this._parent._clonePageDefinition(e)}async _refineSetBlock(e,t,r){return!0===this._checkIfNeedToExpandCandidatePage(e,this._maxQuery)?(await this._expandPagedSet(e,this._maxQuery,0,0,r),this._refineSetBlock(e,t,r)):(this._checkCancelled(r),e._candidates.length,this._refineKnowns(e,t),e._candidates.length,e._candidates.length,e)}_expandPagedSet(e,t,r,n,i){return this._expandPagedSetFeatureSet(e,t,r,n,i)}async _getPhysicalPage(e,t,r){if(!0===e.pagesDefinition.aggregatefeaturesetpagedefinition)return this._sequentialGetPhysicalItem(e,e.pagesDefinition.resultRecordCount,r,[]);const n=await this._getAgregagtePhysicalPage(e,t,r);for(const e of n){const t={geometry:e.geometry,attributes:{}},r={};for(const t in e.attributes)r[t.toLowerCase()]=e.attributes[t];for(const e of this._decodedGroupbyfield)t.attributes[e.tofieldname]=r[e.name.toLowerCase()];for(const e of this._decodedStatsfield)t.attributes[e.tofieldname]=r[e.field.toLowerCase()];this._featureCache[t.attributes[this.objectIdField]]=new a.default(t)}return n.length}_sequentialGetPhysicalItem(e,t,r,n){return new Promise(((i,s)=>{null===e.pagesDefinition.internal.iterator&&(e.pagesDefinition.internal.iterator=e.pagesDefinition.internal.subfeatureset.iterator(r)),!0===e.pagesDefinition.internal.fullyResolved||0===t?i(n.length):this._nextAggregateItem(e,t,r,n,(s=>{null===s?i(n.length):(t-=1,i(this._sequentialGetPhysicalItem(e,t,r,n)))}),s)}))}_nextAggregateItem(e,t,r,n,i,o){try{(0,s.a1)(e.pagesDefinition.internal.iterator.next()).then((s=>{if(null===s)if(null!==e.pagesDefinition.internal.workingItem){const t=this._calculateAndAppendAggregateItem(e.pagesDefinition.internal.workingItem);n.push(t),e.pagesDefinition.internal.workingItem=null,e.pagesDefinition.internal.set.push(t.attributes[this.objectIdField]),e.pagesDefinition.internal.fullyResolved=!0,i(null)}else e.pagesDefinition.internal.fullyResolved=!0,i(null);else{const a=this._generateAggregateHash(s);if(null===e.pagesDefinition.internal.workingItem)e.pagesDefinition.internal.workingItem={features:[s],id:a};else{if(a!==e.pagesDefinition.internal.workingItem.id){const r=this._calculateAndAppendAggregateItem(e.pagesDefinition.internal.workingItem);return n.push(r),e.pagesDefinition.internal.workingItem=null,e.pagesDefinition.internal.set.push(r.attributes[this.objectIdField]),t-=1,e.pagesDefinition.internal.workingItem={features:[s],id:a},void i(r)}e.pagesDefinition.internal.workingItem.features.push(s)}this._nextAggregateItem(e,t,r,n,i,o)}}),o)}catch(e){o(e)}}_calculateFieldStat(e,t,r){const n=[];for(const r of e.features)if(null!==t.workingexpr){const e=t.workingexpr.calculateValue(r);null!==e&&(e instanceof b.n||e instanceof I.k?n.push(e.toNumber()):e instanceof S.g?n.push(e.toMilliseconds()):n.push(e))}else n.push(null);r.attributes[t.tofieldname]=(0,v.s)(t.typeofstat,[n])}_calculateAndAppendAggregateItem(e){const t={attributes:{},geometry:null};for(const r of this._decodedGroupbyfield){const n=r.singlefield?e.features[0].attributes[r.singlefield]:g.WhereClause.convertValueToStorageFormat(r.expression.calculateValue(e.features[0]),r.sqlType);t.attributes[r.tofieldname]=n}for(const r of this._decodedStatsfield)this._calculateFieldStat(e,r,t);const r=[];for(let n=0;n<this._decodedStatsfield.length;n++)r.push(this._calculateFieldStat(e,this._decodedStatsfield[n],t));return this._featureCache[t.attributes[this.objectIdField]]=new a.default({attributes:t.attributes,geometry:t.geometry}),t}_generateAggregateHash(e){let t="";for(const r of this._decodedGroupbyfield){const n=r.singlefield?e.attributes[r.singlefield]:r.expression.calculateValue(e);t+=null==n?":":":"+n.toString()}return(0,_.d)(t,_.T.String)}async _stat(){return{calculated:!1}}async getFeatureByObjectId(){return null}static registerAction(){p.A._featuresetFunctions.groupby=function(e,t){return new T({parentfeatureset:this,groupbyfields:e,statsfields:t})}}}var C=r(58175),E=r(46538),L=r(7156),O=r(27385),R=r(45824),k=r(72630),N=r(98737),D=r(74697),P=r(57652),Z=r(57534),j=r(42783),V=r(7926),U=r(75379);class z extends p.A{constructor(e){super(e),this.declaredClass="esri.arcade.featureset.sources.FeatureLayerDynamic",this._removeGeometry=!1,this._overrideFields=null,this.formulaCredential=null,this._pageJustIds=!1,this._requestStandardised=!1,this._useDefinitionExpression=!0,e.spatialReference&&(this.spatialReference=e.spatialReference),this._transparent=!0,this._maxProcessing=1e3,this._layer=e.layer,this._wset=null,void 0!==e.outFields&&(this._overrideFields=e.outFields),void 0!==e.includeGeometry&&(this._removeGeometry=!1===e.includeGeometry)}_maxQueryRate(){return f.gO}end(){return this._layer}optimisePagingFeatureQueries(e){this._pageJustIds=e}get urlQueryPath(){return this._layer.parsedUrl.path||""}convertQueryToLruCacheKey(e){const t=this.urlQueryPath+","+(0,f.JB)(e.toJSON());return(0,_.d)(t,_.T.String)}async loadImpl(){return!0===this._layer.loaded?(this._initialiseFeatureSet(),this):(await this._layer.load(),this._initialiseFeatureSet(),this)}_initialiseFeatureSet(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._layer.geometryType??"",this.fields=this._layer.fields.slice(),this.hasZ=!0===this._layer?.capabilities?.data?.supportsZ,this.hasM=!0===this._layer?.capabilities?.data?.supportsM,null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{const e=[],t=[];for(const r of this.fields)if("oid"===r.type)e.push(r),t.push(r.name);else for(const n of this._overrideFields)if(n.toLowerCase()===r.name.toLowerCase()){e.push(r),t.push(r.name);break}this.fields=e,this._overrideFields=t}if(this._layer.source&&this._layer.source.sourceJSON){const e=this._layer.source.sourceJSON.currentVersion;!0===this._layer.source.sourceJSON.useStandardizedQueries?(this._databaseType=f.zl.StandardisedNoInterval,null!=e&&e>=10.61&&(this._databaseType=f.zl.Standardised)):null!=e&&(e>=10.5&&(this._databaseType=f.zl.StandardisedNoInterval,this._requestStandardised=!0),e>=10.61&&(this._databaseType=f.zl.Standardised))}this.objectIdField=this._layer.objectIdField;for(const e of this.fields)"global-id"===e.type&&(this.globalIdField=e.name);this.subtypeField=this._layer.subtypeField??"",this.subtypes=this._layer.subtypes,this.typeIdField=("typeIdField"in this._layer?this._layer.typeIdField:null)??"",this.types="types"in this._layer?this._layer.types:null}_isInFeatureSet(){return f.J6.InFeatureSet}async _refineSetBlock(e){return e}_candidateIdTransform(e){return e}async _getSet(e){if(null===this._wset){await this._ensureLoaded();const t=await this._getFilteredSet("",null,null,null,e);return this._wset=t,t}return this._wset}async _runDatabaseProbe(e){await this._ensureLoaded();const t=new V.A;this.datesInUnknownTimezone&&(t.timeReferenceUnknownClient=!0),t.where=e.replace("OBJECTID",this._layer.objectIdField);try{return await this._layer.queryObjectIds(t),!0}catch(e){return!1}}_canUsePagination(){return!(!this._layer.capabilities||!this._layer.capabilities.query||!0!==this._layer.capabilities.query.supportsPagination)}_cacheableFeatureSetSourceKey(){return this._layer.url}get gdbVersion(){return this._layer&&this._layer.capabilities&&this._layer.capabilities.data&&this._layer.capabilities.data.isVersioned?this._layer.gdbVersion||"SDE.DEFAULT":""}nativeCapabilities(){return{title:this._layer.title??"",source:this,canQueryRelated:!0,capabilities:this._layer.capabilities,databaseType:this._databaseType,requestStandardised:this._requestStandardised}}_createQuery(){const e=this._layer.createQuery();return e.returnZ=this.hasZ,e.returnM=this.hasM,this.datesInUnknownTimezone&&(e.timeReferenceUnknownClient=!0),this._requestStandardised&&(e.sqlFormat="standard"),this._useDefinitionExpression?"subtype-group"===this._layer.type&&(e.where=this._layer.definitionExpression):e.where=null,e}executeQuery(e,t){const r="execute"===t?this._layer.queryFeatures.bind(this._layer):"executeForCount"===t?this._layer.queryFeatureCount.bind(this._layer):this._layer.queryObjectIds.bind(this._layer);let n=null;if(this.recentlyUsedQueries){const t=this.convertQueryToLruCacheKey(e);n=this.recentlyUsedQueries.getFromCache(t),null===n&&(n=r(e),this.recentlyUsedQueries.addToCache(t,n),n=n.catch((e=>{throw this.recentlyUsedQueries?.removeFromCache(t),e})))}return this.featureSetQueryInterceptor&&this.featureSetQueryInterceptor.preLayerQueryCallback({layer:this._layer,query:e,method:t}),null===n&&(n=r(e)),n}async _getFilteredSet(e,t,r,n,i){const s=await this.databaseType();if(this.isTable()&&t&&null!==e&&""!==e)return new d.A([],[],!0,null);if(this._canUsePagination())return this._getFilteredSetUsingPaging(e,t,r,n,i);let o="",a=!1;null!==n&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsOrderBy&&(o=n.constructClause(),a=!0);const l=this._createQuery();l.where=(0,N.m)(l.where,null===r?null===t?"1=1":"":(0,y.YY)(r,s)),l.spatialRelationship=this._makeRelationshipEnum(e),l.outSpatialReference=this.spatialReference,l.orderByFields=""!==o?o.split(","):null,l.geometry=null===t?null:t,l.relationParameter=this._makeRelationshipParam(e);let u=await this.executeQuery(l,"executeForIds");return null===u&&(u=[]),this._checkCancelled(i),new d.A([],u,a,null)}_expandPagedSet(e,t,r,n,i){return this._expandPagedSetFeatureSet(e,t,r,n,i)}async _getFilteredSetUsingPaging(e,t,r,n,i){let s="",o=!1;null!==n&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsOrderBy&&(s=n.constructClause(),o=!0);const a=await this.databaseType(),l=null===r?null===t?"1=1":"":(0,y.YY)(r,a);let u=this._maxQueryRate();const c=this._layer.capabilities?.query.maxRecordCount;null!=c&&c<u&&(u=c);let p=null;if(!0===this._pageJustIds)p=new d.A([],["GETPAGES"],o,{spatialRel:this._makeRelationshipEnum(e),relationParam:this._makeRelationshipParam(e),outFields:this._layer.objectIdField,resultRecordCount:u,resultOffset:0,geometry:null===t?null:t,where:l,orderByFields:s,returnGeometry:!1,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}});else{let r=!0;!0===this._removeGeometry&&(r=!1);const n=this._overrideFields??this._fieldsIncludingObjectId(["*"]);p=new d.A([],["GETPAGES"],o,{spatialRel:this._makeRelationshipEnum(e),relationParam:this._makeRelationshipParam(e),outFields:n.join(","),resultRecordCount:u,resultOffset:0,geometry:null===t?null:t,where:l,orderByFields:s,returnGeometry:r,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}})}return await this._expandPagedSet(p,u,0,1,i),p}_clonePageDefinition(e){return null===e?null:!0!==e.groupbypage?{groupbypage:!1,spatialRel:e.spatialRel,relationParam:e.relationParam,outFields:e.outFields,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,geometry:e.geometry,where:e.where,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}:{groupbypage:!0,spatialRel:e.spatialRel,relationParam:e.relationParam,outFields:e.outFields,resultRecordCount:e.resultRecordCount,useOIDpagination:e.useOIDpagination,generatedOid:e.generatedOid,groupByFieldsForStatistics:e.groupByFieldsForStatistics,resultOffset:e.resultOffset,outStatistics:e.outStatistics,geometry:e.geometry,where:e.where,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}}async _getPhysicalPage(e,t,r){const n=e.pagesDefinition.internal.lastRetrieved,i=n,s=e.pagesDefinition.internal.lastPage,o=this._createQuery();o.spatialRelationship=e.pagesDefinition.spatialRel,o.relationParameter=e.pagesDefinition.relationParam,o.outFields=e.pagesDefinition.outFields.split(","),o.num=e.pagesDefinition.resultRecordCount,o.start=e.pagesDefinition.internal.lastPage,o.geometry=e.pagesDefinition.geometry,o.where=(0,N.m)(o.where,e.pagesDefinition.where),o.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,o.returnGeometry=e.pagesDefinition.returnGeometry,o.outSpatialReference=this.spatialReference;const a=await this.executeQuery(o,"execute");if(this._checkCancelled(r),e.pagesDefinition.internal.lastPage!==s)return"done";const l=this._layer.objectIdField;for(let t=0;t<a.features.length;t++)e.pagesDefinition.internal.set[i+t]=a.features[t].attributes[l];if(!1===this._pageJustIds)for(let e=0;e<a.features.length;e++)this._featureCache[a.features[e].attributes[l]]=a.features[e];return(void 0===a.exceededTransferLimit&&a.features.length!==e.pagesDefinition.resultRecordCount||!1===a.exceededTransferLimit)&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=n+a.features.length,e.pagesDefinition.internal.lastPage+=e.pagesDefinition.resultRecordCount,"done"}_fieldsIncludingObjectId(e){if(null===e)return[this.objectIdField];const t=e.slice();if(t.includes("*"))return t;let r=!1;for(const e of t)if(e.toUpperCase()===this.objectIdField.toUpperCase()){r=!0;break}return!1===r&&t.push(this.objectIdField),t}async _getFeatures(e,t,r,n){const i=[];if(-1!==t&&void 0===this._featureCache[t]&&i.push(t),!0===this._checkIfNeedToExpandKnownPage(e,this._maxProcessingRate()))return await this._expandPagedSet(e,this._maxProcessingRate(),0,0,n),this._getFeatures(e,t,r,n);let s=0;for(let n=e._lastFetchedIndex;n<e._known.length;n++){if(e._lastFetchedIndex+=1,s++,void 0===this._featureCache[e._known[n]]){let r=!1;if(null!==this._layer._mode&&void 0!==this._layer._mode){const t=this._layer._mode;if(void 0!==t._featureMap[e._known[n]]){const i=t._featureMap[e._known[n]];null!==i&&(r=!0,this._featureCache[e._known[n]]=i)}}if(!1===r&&(e._known[n]!==t&&i.push(e._known[n]),i.length>=this._maxProcessingRate()-1))break}if(s>=r&&0===i.length)break}if(0===i.length)return"success";const o=this._createQuery();o.objectIds=i,o.outFields=this._overrideFields??this._fieldsIncludingObjectId(["*"]),o.returnGeometry=!0,!0===this._removeGeometry&&(o.returnGeometry=!1),o.outSpatialReference=this.spatialReference;const a=await this.executeQuery(o,"execute");if(this._checkCancelled(n),void 0!==a.error)throw new c.dr(c.D_.RequestFailed,{reason:a.error});const l=this._layer.objectIdField;for(let e=0;e<a.features.length;e++)this._featureCache[a.features[e].attributes[l]]=a.features[e];return"success"}async _getDistinctPages(e,t,r,n,i,s,o,a,l){await this._ensureLoaded();const u=await this.databaseType();let p=r.parseTree.column;const d=this._layer.fields??[];for(let e=0;e<d.length;e++)if(d[e].name.toLowerCase()===p.toLowerCase()){p=d[e].name;break}const h=this._createQuery();h.where=(0,N.m)(h.where,null===s?null===i?"1=1":"":(0,y.YY)(s,u)),h.spatialRelationship=this._makeRelationshipEnum(n),h.relationParameter=this._makeRelationshipParam(n),h.geometry=null===i?null:i,h.returnDistinctValues=!0,h.returnGeometry=!1,h.outFields=[p];const f=await this.executeQuery(h,"execute");if(this._checkCancelled(l),!f.hasOwnProperty("features"))throw new c.dr(c.D_.InvalidStatResponse);let m=!1;for(let e=0;e<d.length;e++)if(d[e].name===p){"date"===d[e].type&&(m=!0);break}for(let e=0;e<f.features.length;e++){if(m){const t=f.features[e].attributes[p];null!==t?a.push(new Date(t)):a.push(t)}else a.push(f.features[e].attributes[p]);if(a.length>=o)break}return 0===f.features.length?a:f.features.length===this._layer.capabilities?.query.maxRecordCount&&a.length<o?{calculated:!0,result:await this._getDistinctPages(e+f.features.length,t,r,n,i,s,o,a,l)}:a}async _distinctStat(e,t,r,n,i,s,o){return{calculated:!0,result:await this._getDistinctPages(0,e,t,r,n,i,s,[],o)}}isTable(){return this._layer.isTable||null===this._layer.geometryType||"table"===this._layer.type||""===this._layer.geometryType||"esriGeometryNull"===this._layer.geometryType}async _countstat(e,t,r,n){const i=await this.databaseType();if(this.isTable()&&r&&null!==t&&""!==t)return{calculated:!0,result:0};const s=this._createQuery();return s.where=(0,N.m)(s.where,null===n?null===r?"1=1":"":(0,y.YY)(n,i)),s.spatialRelationship=this._makeRelationshipEnum(t),s.relationParameter=this._makeRelationshipParam(t),s.geometry=null===r?null:r,s.returnGeometry=!1,{calculated:!0,result:await this.executeQuery(s,"executeForCount")}}async _stats(e,t,r,n,i,s,o){await this._ensureLoaded();const a=this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsSqlExpression,l=this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsStatistics,u=this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsDistinct;if("count"===e)return u?this._countstat(e,r,n,i):{calculated:!1};if(!1===l||!1===(0,y.DA)(t)&&!1===a||!1===t.isStandardized)return""!==r||null!==i?{calculated:!1}:this._manualStat(e,t,s,o);if("distinct"===e)return!1===u?""!==r||null!==i?{calculated:!1}:this._manualStat(e,t,s,o):this._distinctStat(e,t,r,n,i,s,o);const p=await this.databaseType();if(this.isTable()&&n&&null!==r&&""!==r)return{calculated:!0,result:null};const d=this._createQuery();d.where=(0,N.m)(d.where,null===i?null===n?"1=1":"":(0,y.YY)(i,p)),d.spatialRelationship=this._makeRelationshipEnum(r),d.relationParameter=this._makeRelationshipParam(r),d.geometry=null===n?null:n;const h=new U.A;h.statisticType=(0,k.Dp)(e),h.onStatisticField=(0,y.YY)(t,p),h.outStatisticFieldName="ARCADE_STAT_RESULT",d.returnGeometry=!1;let f="ARCADE_STAT_RESULT";d.outStatistics=[h];const m=await this.executeQuery(d,"execute");if(!m.hasOwnProperty("features")||0===m.features.length)throw new c.dr(c.D_.InvalidStatResponse);let g=!1;const w=m.fields??[];for(let e=0;e<w.length;e++)if("ARCADE_STAT_RESULT"===w[e].name.toUpperCase()){f=w[e].name,"date"===w[e].type&&(g=!0);break}if(g){let e=m.features[0].attributes[f];return null!==e&&(e=new Date(m.features[0].attributes[f])),{calculated:!0,result:e}}return{calculated:!0,result:m.features[0].attributes[f]}}_stat(e,t,r,n,i,s,o){return this._stats(e,t,r,n,i,s,o)}async _canDoAggregates(e,t){await this._ensureLoaded();let r=!1;const n=this._layer.capabilities?.query,i=!0===n?.supportsSqlExpression;if(null!=n&&!0===n.supportsStatistics&&!0===n.supportsOrderBy&&(r=!0),r)for(let e=0;e<t.length-1;e++)(!1===t[e].workingexpr?.isStandardized||!1===(0,y.DA)(t[e].workingexpr)&&!1===i)&&(r=!1);return!1!==r}_makeRelationshipEnum(e){if(e.includes("esriSpatialRelRelation"))return"relation";switch(e){case"esriSpatialRelRelation":return"relation";case"esriSpatialRelIntersects":return"intersects";case"esriSpatialRelContains":return"contains";case"esriSpatialRelOverlaps":return"overlaps";case"esriSpatialRelWithin":return"within";case"esriSpatialRelTouches":return"touches";case"esriSpatialRelCrosses":return"crosses";case"esriSpatialRelEnvelopeIntersects":return"envelope-intersects"}return e}_makeRelationshipParam(e){return e.includes("esriSpatialRelRelation")?e.split(":")[1]:""}async _getAggregatePagesDataSourceDefinition(e,t,r,n,i,s,o){await this._ensureLoaded();const a=await this.databaseType();let l="",u=!1,c=!1;null!==s&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsOrderBy&&(l=s.constructClause(),c=!0),this._layer.capabilities&&this._layer.capabilities.query&&!1===this._layer.capabilities.query.supportsPagination&&(c=!1,u=!0,l=this._layer.objectIdField);const p=[];for(let e=0;e<t.length;e++){const r=new U.A;r.onStatisticField=null!==t[e].workingexpr?(0,y.YY)(t[e].workingexpr,a):"",r.outStatisticFieldName=t[e].field,r.statisticType=t[e].toStatisticsName(),p.push(r)}""===l&&(l=e.join(","));let h=this._maxQueryRate();const f=this._layer.capabilities?.query.maxRecordCount;null!=f&&f<h&&(h=f);const m=null===i?null===n?"1=1":"":(0,y.YY)(i,a);return new d.A([],["GETPAGES"],c,{groupbypage:!0,spatialRel:this._makeRelationshipEnum(r),relationParam:this._makeRelationshipParam(r),outFields:["*"],useOIDpagination:u,generatedOid:o,resultRecordCount:h,resultOffset:0,groupByFieldsForStatistics:e,outStatistics:p,geometry:null===n?null:n,where:m,orderByFields:l,returnGeometry:!1,returnIdsOnly:!1,internal:{lastMaxId:-1,set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}})}async _getAgregagtePhysicalPage(e,t,r){let n=e.pagesDefinition.where;!0===e.pagesDefinition.useOIDpagination&&(n=(0,N.m)(n,e.pagesDefinition.generatedOid+">"+e.pagesDefinition.internal.lastMaxId.toString()));const i=e.pagesDefinition.internal.lastRetrieved,s=i,o=e.pagesDefinition.internal.lastPage,l=this._createQuery();if(l.where=(0,N.m)(l.where,n),l.spatialRelationship=e.pagesDefinition.spatialRel,l.relationParameter=e.pagesDefinition.relationParam,l.outFields=e.pagesDefinition.outFields,l.outStatistics=e.pagesDefinition.outStatistics,l.geometry=e.pagesDefinition.geometry,l.groupByFieldsForStatistics=e.pagesDefinition.groupByFieldsForStatistics,l.num=e.pagesDefinition.resultRecordCount,l.start=e.pagesDefinition.internal.lastPage,l.returnGeometry=e.pagesDefinition.returnGeometry,l.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,this.isTable()&&l.geometry&&l.spatialRelationship)return[];const u=await this.executeQuery(l,"execute");if(this._checkCancelled(r),!u.hasOwnProperty("features"))throw new c.dr(c.D_.InvalidStatResponse);const p=[];if(e.pagesDefinition.internal.lastPage!==o)return[];u.features.length>0&&void 0===u.features[0].attributes[e.pagesDefinition.generatedOid]&&(e.pagesDefinition.generatedOid=e.pagesDefinition.generatedOid.toLowerCase());for(let t=0;t<u.features.length;t++)e.pagesDefinition.internal.set[s+t]=u.features[t].attributes[e.pagesDefinition.generatedOid];for(let e=0;e<u.features.length;e++)p.push(new a.default({attributes:u.features[e].attributes,geometry:null}));return!0===e.pagesDefinition.useOIDpagination?0===u.features.length?e.pagesDefinition.internal.fullyResolved=!0:e.pagesDefinition.internal.lastMaxId=u.features[u.features.length-1].attributes[e.pagesDefinition.generatedOid]:(void 0===u.exceededTransferLimit&&u.features.length!==e.pagesDefinition.resultRecordCount||!1===u.exceededTransferLimit)&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=i+u.features.length,e.pagesDefinition.internal.lastPage+=e.pagesDefinition.resultRecordCount,p}static create(e,t,r,n,i){const s=new Z.default({url:e,outFields:null===t?["*"]:t});return new z({layer:s,spatialReference:r,lrucache:n,interceptor:i})}relationshipMetaData(){return this._layer&&this._layer.source&&this._layer.source.sourceJSON?.relationships?this._layer.source.sourceJSON.relationships:[]}serviceUrl(){return(0,f.Qi)(this._layer.parsedUrl.path)}async queryAttachments(e,t,r,n,i){const s=this._layer;if(function(e){const t=e.capabilities;return t?.data.supportsAttachment&&t?.operations.supportsQueryAttachments}(s)){const o={objectIds:[e],returnMetadata:i};(t&&t>0||r&&r>0)&&(o.size=[t&&t>0?t:0,r&&r>0?r:t+1]),n&&n.length>0&&(o.attachmentTypes=n),this.featureSetQueryInterceptor&&this.featureSetQueryInterceptor.preLayerQueryCallback({layer:s,query:o,method:"attachments"});const a=await s.queryAttachments(new j.A(o)),l=[];return a&&a[e]&&a[e].forEach((t=>{const r=this._layer.parsedUrl.path+"/"+e.toString()+"/attachments/"+t.id.toString();let n=null;i&&t.exifInfo&&(n=R.A.convertJsonToArcade(t.exifInfo,"system",!0)),l.push(new O.A(t.id,t.name,t.contentType,t.size,r,n,t.keywords??null))})),l}return[]}async queryRelatedFeatures(e){const t={f:"json",relationshipId:e.relationshipId.toString(),definitionExpression:e.where,outFields:e.outFields?.join(","),returnGeometry:e.returnGeometry.toString()};void 0!==e.resultOffset&&null!==e.resultOffset&&(t.resultOffset=e.resultOffset.toString()),void 0!==e.resultRecordCount&&null!==e.resultRecordCount&&(t.resultRecordCount=e.resultRecordCount.toString()),e.orderByFields&&(t.orderByFields=e.orderByFields.join(",")),e.objectIds&&e.objectIds.length>0&&(t.objectIds=e.objectIds.join(",")),e.outSpatialReference&&(t.outSR=(0,P.YX)(e.outSpatialReference)),this.featureSetQueryInterceptor&&this.featureSetQueryInterceptor.preRequestCallback({layer:this._layer,queryPayload:t,method:"relatedrecords",url:this._layer.parsedUrl.path+"/queryRelatedRecords"});const r=await(0,n.A)(this._layer.parsedUrl.path+"/queryRelatedRecords",{responseType:"json",query:t});if(r.data){const e={},t=r.data;if(t?.relatedRecordGroups){const r=t.spatialReference;for(const n of t.relatedRecordGroups){const i=n.objectId,s=[];for(const e of n.relatedRecords){e.geometry&&(e.geometry.spatialReference=r);const t=new a.default({geometry:e.geometry?(0,D.rS)(e.geometry):null,attributes:e.attributes});s.push(t)}e[i]={features:s,exceededTransferLimit:!0===t.exceededTransferLimit}}}return e}throw new c.dr(c.D_.InvalidRequest)}async getFeatureByObjectId(e,t){const r=this._createQuery();r.outFields=t,r.returnGeometry=!1,r.outSpatialReference=this.spatialReference,r.where=(0,N.m)(r.where,this.objectIdField+"="+e.toString()),this.featureSetQueryInterceptor&&this.featureSetQueryInterceptor.preLayerQueryCallback({layer:this._layer,query:r,method:"execute"});const n=await this._layer.queryFeatures(r);return 1===n.features.length?n.features[0]:null}async getIdentityUser(){await this.load();const e=L.id?.findCredential(this._layer.url);return e?e.userId:null}async getOwningSystemUrl(){await this.load();const e=L.id?.findServerInfo(this._layer.url);if(e)return e.owningSystemUrl;let t=this._layer.url;const r=t.toLowerCase().indexOf("/rest/services");if(t=r>-1?t.slice(0,r):t,t){t+="/rest/info";try{const e=await(0,n.A)(t,{query:{f:"json"}});let r="";return e.data?.owningSystemUrl&&(r=e.data.owningSystemUrl),r}catch(e){return""}}return""}getDataSourceFeatureSet(){const e=new z({layer:this._layer,spatialReference:this.spatialReference??void 0,outFields:this._overrideFields??void 0,includeGeometry:!this._removeGeometry,lrucache:this.recentlyUsedQueries??void 0,interceptor:this.featureSetQueryInterceptor??void 0});return e._useDefinitionExpression=!1,e}get preferredTimeZone(){return this._layer.preferredTimeZone??null}get dateFieldsTimeZone(){return this._layer.dateFieldsTimeZone??null}get datesInUnknownTimezone(){return this._layer.datesInUnknownTimezone??!1}get editFieldsInfo(){return this._layer.editFieldsInfo??null}get timeInfo(){return this._layer.timeInfo??null}async getFeatureSetInfo(){if(this.fsetInfo)return this.fsetInfo;let e=null,t="serviceItemId"in this._layer?this._layer.serviceItemId:null;const r=this._layer.parsedUrl.path;if(r){const i=await(0,n.A)(r,{responseType:"json",query:{f:"json"}});e=i?.data?.name??null,t=i?.data?.serviceItemId??null}const i=this._layer.title&&null!==(this._layer.parent??null);return this.featureSetInfo={layerId:this._layer.layerId,layerName:""===e?null:e,itemId:""===t?null:t,serviceLayerUrl:""===r?null:r,webMapLayerId:i?this._layer.id??null:null,webMapLayerTitle:i?this._layer.title??null:null,className:null,objectClassId:null},this.fsetInfo}}var G=r(90914),q=r(95470);class B extends p.A{constructor(e){super(e),this.declaredClass="esri.arcade.featureset.sources.FeatureLayerRelated",this._findObjectId=-1,this._requestStandardised=!1,this._removeGeometry=!1,this._overrideFields=null,this.featureObjectId=null,e.spatialReference&&(this.spatialReference=e.spatialReference),this._transparent=!0,this._maxProcessing=1e3,this._layer=e.layer,this._wset=null,this._findObjectId=e.objectId,this.featureObjectId=e.objectId,this.relationship=e.relationship,this._relatedLayer=e.relatedLayer,void 0!==e.outFields&&(this._overrideFields=e.outFields),void 0!==e.includeGeometry&&(this._removeGeometry=!1===e.includeGeometry)}_maxQueryRate(){return f.gO}end(){return this._layer}optimisePagingFeatureQueries(){}async loadImpl(){return await Promise.all([this._layer.load(),this._relatedLayer?.load()]),this._initialiseFeatureSet(),this}nativeCapabilities(){return this._relatedLayer.nativeCapabilities()}_initialiseFeatureSet(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._relatedLayer.geometryType,this.fields=this._relatedLayer.fields.slice(),this.hasZ=this._relatedLayer.hasZ,this.hasM=this._relatedLayer.hasM,null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{const e=[],t=[];for(const r of this.fields)if("oid"===r.type)e.push(r),t.push(r.name);else for(const n of this._overrideFields)if(n.toLowerCase()===r.name.toLowerCase()){e.push(r),t.push(r.name);break}this.fields=e,this._overrideFields=t}const e=this._layer.nativeCapabilities();e&&(this._databaseType=e.databaseType,this._requestStandardised=e.requestStandardised),this.objectIdField=this._relatedLayer.objectIdField,this.globalIdField=this._relatedLayer.globalIdField,this.hasM=this._relatedLayer.supportsM,this.hasZ=this._relatedLayer.supportsZ,this.typeIdField=this._relatedLayer.typeIdField,this.types=this._relatedLayer.types,this.subtypeField=this._relatedLayer.subtypeField,this.subtypes=this._relatedLayer.subtypes}async databaseType(){return await this._relatedLayer.databaseType(),this._databaseType=this._relatedLayer._databaseType,this._databaseType}isTable(){return this._relatedLayer.isTable()}_isInFeatureSet(){return f.J6.InFeatureSet}_candidateIdTransform(e){return e}async _getSet(e){if(null===this._wset){await this._ensureLoaded();const t=await this._getFilteredSet("",null,null,null,e);return this._wset=t,t}return this._wset}_changeFeature(e){const t={};for(const r of this.fields)t[r.name]=e.attributes[r.name];return new a.default({geometry:!0===this._removeGeometry?null:e.geometry,attributes:t})}async _getFilteredSet(e,t,r,n,i){if(await this.databaseType(),this.isTable()&&t&&null!==e&&""!==e)return new d.A([],[],!0,null);const s=this._layer.nativeCapabilities();if(!1===s.canQueryRelated)return new d.A([],[],!0,null);if(s.capabilities?.queryRelated.supportsPagination)return this._getFilteredSetUsingPaging(e,t,r,n,i);let o="",a=!1;null!==n&&!0===s.capabilities?.queryRelated.supportsOrderBy&&(o=n.constructClause(),a=!0);const l=new q.default;l.objectIds=[this._findObjectId];const u=null!==this._overrideFields?this._overrideFields:this._fieldsIncludingObjectId(this._relatedLayer.fields?this._relatedLayer.fields.map((e=>e.name)):["*"]);l.outFields=u,l.relationshipId=this.relationship.id,l.where="1=1";let c=!0;!0===this._removeGeometry&&(c=!1),l.returnGeometry=c,this._requestStandardised&&(l.sqlFormat="standard"),l.outSpatialReference=this.spatialReference,l.orderByFields=""!==o?o.split(","):null;const p=await s.source.queryRelatedFeatures(l);this._checkCancelled(i);const h=p[this._findObjectId]?p[this._findObjectId].features:[],f=[];for(let e=0;e<h.length;e++)this._featureCache[h[e].attributes[this._relatedLayer.objectIdField]]=h[e],f.push(h[e].attributes[this._relatedLayer.objectIdField]);const y=t&&null!==e&&""!==e,m=null!=r;return new d.A(y||m?f:[],y||m?[]:f,a,null)}_fieldsIncludingObjectId(e){if(null===e)return[this.objectIdField];const t=e.slice();if(t.includes("*"))return t;let r=!1;for(const e of t)if(e.toUpperCase()===this.objectIdField.toUpperCase()){r=!0;break}return!1===r&&t.push(this.objectIdField),t}async _getFilteredSetUsingPaging(e,t,r,n,i){let s="",o=!1;const a=this._layer.nativeCapabilities();null!==n&&!0===a.capabilities?.queryRelated.supportsOrderBy&&(s=n.constructClause(),o=!0),await this.databaseType();let l=this._maxQueryRate();const u=a.capabilities?.query.maxRecordCount;null!=u&&u<l&&(l=u);const c=t&&null!==e&&""!==e,p=null!=r;let h=null,f=!0;!0===this._removeGeometry&&(f=!1);const y=null!==this._overrideFields?this._overrideFields:this._fieldsIncludingObjectId(this._relatedLayer.fields?this._relatedLayer.fields.map((e=>e.name)):["*"]);return h=new d.A(c||p?["GETPAGES"]:[],c||p?[]:["GETPAGES"],o,{outFields:y.join(","),resultRecordCount:l,resultOffset:0,objectIds:[this._findObjectId],where:"1=1",orderByFields:s,returnGeometry:f,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}}),await this._expandPagedSet(h,l,0,0,i),h}_expandPagedSet(e,t,r,n,i){return this._expandPagedSetFeatureSet(e,t,r,n,i)}_clonePageDefinition(e){return null===e?null:!0!==e.groupbypage?{groupbypage:!1,outFields:e.outFields,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,where:e.where,objectIds:e.objectIds,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}:{groupbypage:!0,outFields:e.outFields,resultRecordCount:e.resultRecordCount,useOIDpagination:e.useOIDpagination,generatedOid:e.generatedOid,groupByFieldsForStatistics:e.groupByFieldsForStatistics,resultOffset:e.resultOffset,outStatistics:e.outStatistics,geometry:e.geometry,where:e.where,objectIds:e.objectIds,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}}async _getPhysicalPage(e,t,r){const n=e.pagesDefinition.internal.lastRetrieved,i=n,s=e.pagesDefinition.internal.lastPage,o=this._layer.nativeCapabilities(),a=new q.default;!0===this._requestStandardised&&(a.sqlFormat="standard"),a.relationshipId=this.relationship.id,a.objectIds=e.pagesDefinition.objectIds,a.resultOffset=e.pagesDefinition.internal.lastPage,a.resultRecordCount=e.pagesDefinition.resultRecordCount,a.outFields=e.pagesDefinition.outFields.split(","),a.where=e.pagesDefinition.where,a.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,a.returnGeometry=e.pagesDefinition.returnGeometry,a.outSpatialReference=this.spatialReference;const l=await o.source.queryRelatedFeatures(a);if(this._checkCancelled(r),e.pagesDefinition.internal.lastPage!==s)return 0;const u=l[this._findObjectId]?l[this._findObjectId].features:[];for(let t=0;t<u.length;t++)e.pagesDefinition.internal.set[i+t]=u[t].attributes[this._relatedLayer.objectIdField];for(let e=0;e<u.length;e++)this._featureCache[u[e].attributes[this._relatedLayer.objectIdField]]=u[e];const c=!l[this._findObjectId]||!1===l[this._findObjectId].exceededTransferLimit;return u.length!==e.pagesDefinition.resultRecordCount&&c&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=n+u.length,e.pagesDefinition.internal.lastPage+=e.pagesDefinition.resultRecordCount,u.length}async _getFeatures(e,t,r,n){const i=[];-1!==t&&void 0===this._featureCache[t]&&i.push(t);const s=this._maxQueryRate();if(!0===this._checkIfNeedToExpandKnownPage(e,s))return await this._expandPagedSet(e,s,0,0,n),this._getFeatures(e,t,r,n);let o=0;for(let n=e._lastFetchedIndex;n<e._known.length&&(o++,o<=r&&(e._lastFetchedIndex+=1),!("GETPAGES"!==e._known[n]&&void 0===this._featureCache[e._known[n]]&&(e._known[n]!==t&&i.push(e._known[n]),i.length>r)))&&!(o>=r&&0===i.length);n++);if(0===i.length)return"success";throw new c.dr(c.D_.MissingFeatures)}async _refineSetBlock(e,t,r){return e}async _stat(e,t,r,n,i,s,o){return{calculated:!1}}get gdbVersion(){return this._relatedLayer.gdbVersion}async _canDoAggregates(e,t,r,n,i){return!1}relationshipMetaData(){return this._relatedLayer.relationshipMetaData()}serviceUrl(){return this._relatedLayer.serviceUrl()}queryAttachments(e,t,r,n,i){return this._relatedLayer.queryAttachments(e,t,r,n,i)}getFeatureByObjectId(e,t){return this._relatedLayer.getFeatureByObjectId(e,t)}getOwningSystemUrl(){return this._relatedLayer.getOwningSystemUrl()}getIdentityUser(){return this._relatedLayer.getIdentityUser()}getDataSourceFeatureSet(){return this._relatedLayer}get preferredTimeZone(){return this._relatedLayer?.preferredTimeZone??null}get dateFieldsTimeZone(){return this._relatedLayer?.dateFieldsTimeZone??null}get datesInUnknownTimezone(){return this._relatedLayer?.datesInUnknownTimezone}get editFieldsInfo(){return this._relatedLayer?.editFieldsInfo??null}get timeInfo(){return this._relatedLayer?.timeInfo??null}async getFeatureSetInfo(){return this.fsetInfo??this._layer.featureSetInfo}}var $=r(65883),J=r(31609),W=r(20833),H=r(43173);function Q(){null===$.A.applicationCache&&($.A.applicationCache=new $.A)}async function K(e,t,r){if($.A.applicationCache){const r=$.A.applicationCache.getLayerInfo(e);if(r){const n=await r;return new Z.default({url:e,outFields:t,sourceJSON:n})}const n=new Z.default({url:e,outFields:t}),i=(async()=>(await n.load(),n.sourceJSON))();if($.A.applicationCache){$.A.applicationCache.setLayerInfo(e,i);try{return await i,n}catch(t){throw $.A.applicationCache.clearLayerInfo(e),t}}return await i,n}if(null!=r){const n=r.getCachedLayerMetadata(e);if(n){const r=await n;return new Z.default({url:e,outFields:t,sourceJSON:r})}const i=new Z.default({url:e,outFields:t}),s=(async()=>(await i.load(),i.sourceJSON))();r.setCachedLayerMetadata(e,s);try{return await s,i}catch(t){throw r.removeCachedLayerMetadata(e,s),t}}return new Z.default({url:e,outFields:t})}async function Y(e,t,r,n,i,s=null){return X(await K(e,["*"],i),t,r,n,i,s)}function X(e,t=null,r=null,n=!0,i=null,s=null){switch(e.type){case"catalog-footprint":return X(e.parent,t,r,n,i,s);case"subtype-sublayer":{const o=X(e.parent,t,r,n,i,s);return o.filter(g.WhereClause.create(e.parent.subtypeField+"="+e.subtypeCode.toString(),{fieldsIndex:e.parent.fieldsIndex,timeZone:o.dateFieldsTimeZoneDefaultUTC}))}case"csv":case"geojson":case"wfs":return new G.A({layer:e,spatialReference:t,outFields:r,includeGeometry:n,lrucache:i,interceptor:s});case"catalog":case"feature":case"oriented-imagery":case"subtype-group":{const o={layer:e,spatialReference:t,outFields:r,includeGeometry:n,lrucache:i,interceptor:s};return!e.url&&e.source?new G.A(o):new z(o)}default:throw new Error(`Unsupported layer type: ${e.type}`)}}async function ee(e,t){if(null!==$.A.applicationCache){const t=$.A.applicationCache.getLayerInfo(e);if(null!==t)return t}if(null!=t){const r=t.getCachedServiceMetadata(e);if(null!=r)return r}const r=(async()=>{const t=await(0,n.A)(e,{responseType:"json",query:{f:"json"}});if(t.data){const e=t.data;return e.layers||(e.layers=[]),e.tables||(e.tables=[]),e}return{layers:[],tables:[]}})();if(null!==$.A.applicationCache){$.A.applicationCache.setLayerInfo(e,r);try{return await r}catch(t){throw $.A.applicationCache.clearLayerInfo(e),t}}if(null!=t){t.setCachedServiceMetadata(e,r);try{return await r}catch(n){throw t.removeCachedServiceMetadata(e,r),n}}return r}async function te(e,t){const r={metadata:null,networkId:-1,unVersion:3,terminals:[],queryelem:null,layerNameLkp:{},lkp:null},i=await ee(e,null);if(r.metadata=i,void 0!==i.controllerDatasetLayers?.utilityNetworkLayerId&&null!==i.controllerDatasetLayers.utilityNetworkLayerId){if(i.layers)for(const e of i.layers)r.layerNameLkp[e.id]=e.name;if(i.tables)for(const e of i.tables)r.layerNameLkp[e.id]=e.name;const s=i.controllerDatasetLayers.utilityNetworkLayerId;r.networkId=s;const o=await async function(e,t){const r="QUERYDATAELEMTS:"+t.toString()+":"+e;if(null!==$.A.applicationCache){const e=$.A.applicationCache.getLayerInfo(r);if(null!==e)return e}const i=(async()=>{const r=await(0,n.A)(e+"/queryDataElements",{method:"post",responseType:"json",query:{layers:JSON.stringify([t.toString()]),f:"json"}});if(r.data){const e=r.data;if(e.layerDataElements?.[0])return e.layerDataElements[0]}throw new c.dr(c.D_.DataElementsNotFound)})();if(null!==$.A.applicationCache){$.A.applicationCache.setLayerInfo(r,i);try{return await i}catch(e){throw $.A.applicationCache.clearLayerInfo(r),e}}return i}(e,s);if(o){r.queryelem=o,r.queryelem?.dataElement&&void 0!==r.queryelem.dataElement.schemaGeneration&&(r.unVersion=r.queryelem.dataElement.schemaGeneration),r.lkp={},r.queryelem.dataElement.domainNetworks||(r.queryelem.dataElement.domainNetworks=[]);for(const e of r.queryelem.dataElement.domainNetworks){for(const t of e.edgeSources??[]){const e={layerId:t.layerId,sourceId:t.sourceId,className:r.layerNameLkp[t.layerId]??null};e.className&&(r.lkp[e.className]=e)}for(const t of e.junctionSources??[]){const e={layerId:t.layerId,sourceId:t.sourceId,className:r.layerNameLkp[t.layerId]??null};e.className&&(r.lkp[e.className]=e)}}if(r.queryelem.dataElement.terminalConfigurations)for(const e of r.queryelem.dataElement.terminalConfigurations)for(const t of e.terminals)r.terminals.push({terminalId:t.terminalId,terminalName:t.terminalName});const i=await async function(e){if(null!==$.A.applicationCache){const t=$.A.applicationCache.getLayerInfo(e);if(null!==t)return t}const t=(async()=>{const t=await(0,n.A)(e,{responseType:"json",query:{f:"json"}});return t.data?t.data:null})();if(null!==$.A.applicationCache){$.A.applicationCache.setLayerInfo(e,t);try{return await t}catch(t){throw $.A.applicationCache.clearLayerInfo(e),t}}return t}(e+"/"+s);if(void 0!==i.systemLayers?.associationsTableId&&null!==i.systemLayers.associationsTableId){const n=[];r.unVersion>=4&&(n.push("STATUS"),n.push("PERCENTALONG"));let s=await Y(e+"/"+i.systemLayers.associationsTableId.toString(),t,["OBJECTID","FROMNETWORKSOURCEID","TONETWORKSOURCEID","FROMGLOBALID","TOGLOBALID","TOTERMINALID","FROMTERMINALID","ASSOCIATIONTYPE","ISCONTENTVISIBLE","GLOBALID",...n],!1,null,null);return await s.load(),r.unVersion>=4&&(s=s.filter(g.WhereClause.create("STATUS NOT IN (1, 2, 3, 4, 5, 6, 7, 9, 10, 11, 12, 13, 14, 15, 17, 18, 19, 20, 21, 22, 23, 25, 26, 27, 28, 29, 30, 31, 33, 34, 35, 36, 37, 38, 39, 41, 42, 43, 44, 45, 46, 47, 49, 50, 51, 52, 53, 54, 55, 57, 58, 59, 60, 61, 62, 63)",{fieldsIndex:s.getFieldsIndex(),timeZone:s.dateFieldsTimeZoneDefaultUTC})),await s.load()),{lkp:r.lkp,associations:s,unVersion:r.unVersion,terminals:r.terminals}}return{associations:null,unVersion:r.unVersion,lkp:null,terminals:[]}}return{associations:null,unVersion:r.unVersion,lkp:null,terminals:[]}}return{associations:null,unVersion:r.unVersion,lkp:null,terminals:[]}}async function re(e,t,r,n=null,i=null,s=!0,o=null,a=null){let l=e.serviceUrl();if(!l)return null;l="/"===l.charAt(l.length-1)?l+t.relatedTableId.toString():l+"/"+t.relatedTableId.toString();const u=await Y(l,n,i,s,o,a);return new B({layer:e,relatedLayer:u,relationship:t,objectId:r,spatialReference:n,outFields:i,includeGeometry:s,lrucache:o,interceptor:a})}o.A.registerAction(),T.registerAction(),u.A.registerAction(),C.A.registerAction(),E.A.registerAction();class ne extends i{constructor(e,t=null,r=null,n=null){super(),this._map=e,this._overrideSpatialReference=t,this._lrucache=r,this._interceptor=n,this._instantLayers=[]}_makeAndAddFeatureSet(e,t=!0,r=null){const n=X(e,this._overrideSpatialReference,null===r?["*"]:r,t,this._lrucache,this._interceptor);return this._instantLayers.push({featureset:n,opitem:e,includeGeometry:t,outFields:JSON.stringify(r)}),n}async featureSetByName(e,t=!0,r=null){if(J.A.isLoadable(this._map)&&!this._map.loaded)return await this._map.load(),this.featureSetByName(e,t,r);null===r&&(r=["*"]),r=(r=r.slice()).sort();const n=JSON.stringify(r);for(let r=0;r<this._instantLayers.length;r++){const i=this._instantLayers[r];if(i.opitem.title===e&&i.includeGeometry===t&&i.outFields===n)return this._instantLayers[r].featureset}const i=this._map.allLayers.find((t=>(0,f.eB)(t)&&t.title===e));if(null!=i)return this._makeAndAddFeatureSet(i,t,r);if(this._map.tables){const n=this._map.tables.find((t=>t.title===e));if(null!=n){if(n instanceof Z.default)return this._makeAndAddFeatureSet(n,t,r);if(null==n._materializedTable){const e=n.outFields?n:{...n,outFields:["*"]};n._materializedTable=new Z.default(e)}return await n._materializedTable.load(),this._makeAndAddFeatureSet(n._materializedTable,t,r)}}return null}async featureSetById(e,t=!0,r=["*"]){if(J.A.isLoadable(this._map)&&!this._map.loaded)return await this._map.load(),this.featureSetById(e,t,r);null===r&&(r=["*"]),r=(r=r.slice()).sort();const n=JSON.stringify(r);for(let r=0;r<this._instantLayers.length;r++){const i=this._instantLayers[r];if(i.opitem.id===e&&i.includeGeometry===t&&i.outFields===n)return this._instantLayers[r].featureset}const i=this._map.allLayers.find((t=>(0,f.eB)(t)&&t.id===e));if(i)return this._makeAndAddFeatureSet(i,t,r);if(this._map.tables){const n=this._map.tables.find((t=>t.id===e));if(null!=n){if(n instanceof Z.default)return this._makeAndAddFeatureSet(n,t,r);if(null==n._materializedTable){const e={...n,outFields:["*"]};n._materializedTable=new Z.default(e)}return await n._materializedTable.load(),this._makeAndAddFeatureSet(n._materializedTable,t,r)}}return null}}class ie extends i{constructor(e,t=null,r=null,n=null){super(),this._url=e,this._overrideSpatialReference=t,this._lrucache=r,this._interceptor=n,this.metadata=null,this._instantLayers=[]}get url(){return this._url}_makeAndAddFeatureSet(e,t=!0,r=null){const n=X(e,this._overrideSpatialReference,null===r?["*"]:r,t,this._lrucache);return this._instantLayers.push({featureset:n,opitem:e,includeGeometry:t,outFields:JSON.stringify(r)}),n}async _loadMetaData(){const e=await ee(this._url,this._lrucache);return this.metadata=e,e}load(){return this._loadMetaData()}clone(){return new ie(this._url,this._overrideSpatialReference,this._lrucache,this._interceptor)}async featureSetByName(e,t=!0,r=null){null===r&&(r=["*"]),r=(r=r.slice()).sort();const n=JSON.stringify(r);for(let r=0;r<this._instantLayers.length;r++){const i=this._instantLayers[r];if(i.opitem.title===e&&i.includeGeometry===t&&i.outFields===n)return this._instantLayers[r].featureset}const i=await this._loadMetaData();let s=null;for(const t of i.layers??[])t.name===e&&(s=t);if(!s)for(const t of i.tables??[])t.name===e&&(s=t);if(s){const e=await K(this._url+"/"+s.id,["*"],this._lrucache);return this._makeAndAddFeatureSet(e,t,r)}return null}async featureSetById(e,t=!0,r=["*"]){null===r&&(r=["*"]),r=(r=r.slice()).sort();const n=JSON.stringify(r);e=null!=e?e.toString():"";for(let r=0;r<this._instantLayers.length;r++){const i=this._instantLayers[r];if(i.opitem.id===e&&i.includeGeometry===t&&i.outFields===n)return this._instantLayers[r].featureset}const i=await this._loadMetaData();let s=null;for(const t of i.layers??[])null!==t.id&&void 0!==t.id&&t.id.toString()===e&&(s=t);if(!s)for(const t of i.tables??[])null!==t.id&&void 0!==t.id&&t.id.toString()===e&&(s=t);if(s){const e=await K(this._url+"/"+s.id,["*"],this._lrucache);return this._makeAndAddFeatureSet(e,t,r)}return null}}function se(e,t,r=null,n=null){return new ne(e,t,r,n)}function oe(e,t,r=null,n=null){return new ie(e,t,r,n)}function ae(e,t,r,n,i){if(null===e)return null;if((0,s.u)(e)){switch(t){case"datasource":return e.getDataSourceFeatureSet();case"parent":return e;case"root":return e.getRootFeatureSet()}return null}if(e instanceof W.A&&(0,f.NI)(e)){const s=e;switch(t){case"datasource":return X(s,i,s.outFields,!0,r,n).getDataSourceFeatureSet();case"parent":case"root":return X(s,i,s.outFields,!0,r,n)}return null}if((0,s.a0)(e)){switch(t){case"datasource":return X(e.parent,i,e.parent.outFields,!0,r,n).getDataSourceFeatureSet();case"parent":case"root":return X(e,i,e.parent.outFields,!0,r,n)}return null}return null}async function le(e,t,r,n,i,s,o,a=null){if($.A.applicationCache){const l=$.A.applicationCache.getLayerInfo(e+":"+s.url);if(l)return ue(await l,t,r,n,i,o,a)}if(null!=o){const l=o.getCachedPortalItem(s.url,e);if(null!=l)return await ue(await l,t,r,n,i,o,a)}const l=new H.default({id:e,portal:s}).load();$.A.applicationCache?$.A.applicationCache.setLayerInfo(e+":"+s.url,l):null!=o&&o.setCachedPortalItem(s.url,e,l);try{return await ue(await l,t,r,n,i,o,a)}catch(t){throw $.A.applicationCache&&$.A.applicationCache.clearLayerInfo(e+":"+s.url),null!=o&&o.removeCachedPortalItem(s.url,e,l),t}}async function ue(e,t,r,n,i,s,o){let a;if("Feature Service"===e.type||"Map Service"===e.type)a=await K((0,f.Qi)(e.url??"")+"/"+t,["*"],s);else{if(t)throw new Error(`layerId=${t} provided for ${e.type} item`);if(null!=s){const t=s.getCachedPortalItemLayer(e.portal.url,e.id);if(null!=t)a=await t;else{const t=W.A.fromPortalItem(e);s.setCachedPortalItemLayer(e.portal.url,e.id,t);try{a=await t}catch(r){throw s.removeCachedPortalItemLayer(e.portal.url,e.id,t),r}}}else a=await W.A.fromPortalItem(e)}return X(a,r,n,i,s,o)}},25256:function(e,t,r){r.d(t,{Gr:function(){return w},IO:function(){return y},a:function(){return _},bV:function(){return g},p8:function(){return m}});var n=r(59469),i=r(80749),s=r(3724),o=r(65636),a=r(63394),l=r(62032),u=r(88396),c=r(95929),p=r(93393),d=r(16177),h=r(57165);class f{constructor(e){this.field=e,this.sqlRewritable=!1}postInitialization(e,t){}}class y extends f{constructor(e){super(e),this.sqlRewritable=!0}extractValue(e){return e.attributes[this.field.name]}rewriteSql(e){return{rewritten:this.sqlRewritable,where:e}}}class m extends f{constructor(e,t,r){super((0,l.ke)(e)),this.originalField=e,this.sqlRewritable=!0,this.field.name=t,this.field.alias=r}rewriteSql(e,t){return{rewritten:this.sqlRewritable,where:(0,u.bD)(e,this.field.name,this.originalField.name,t.getFieldsIndex())}}extractValue(e){return e.attributes[this.originalField.name]}}class g extends f{constructor(e,t,r){super(e),this.codefield=t,this.lkp=r,this.reverseLkp={};for(const e in r)this.reverseLkp[r[e]]=e;this.sqlRewritable=!0}rewriteSql(e,t){const r=this.evaluateNodeToWhereClause(e.parseTree,l.zl.Standardised,this.field.name,this.codefield instanceof d.WhereClause?(0,u.YY)(this.codefield,l.zl.Standardised):this.codefield,e.parameters);return r.includes(g.BADNESS)?{rewritten:!1,where:e}:{rewritten:this.sqlRewritable,where:d.WhereClause.create(r,{fieldsIndex:t._parent.getFieldsIndex(),timeZone:t.dateFieldsTimeZoneDefaultUTC})}}evaluateNodeToWhereClause(e,t,r=null,n=null,i){let s,o,a,c;switch(e.type){case"interval":return(0,u.oj)(this.evaluateNodeToWhereClause(e.value,t,r,n,i),e.qualifier,e.op);case"case-expression":{let n=" CASE ";"simple"===e.format&&(n+=this.evaluateNodeToWhereClause(e.operand,t,r,g.BADNESS,i));for(let s=0;s<e.clauses.length;s++)n+=" WHEN "+this.evaluateNodeToWhereClause(e.clauses[s].operand,t,r,g.BADNESS,i)+" THEN "+this.evaluateNodeToWhereClause(e.clauses[s].value,t,r,g.BADNESS,i);return null!==e.else&&(n+=" ELSE "+this.evaluateNodeToWhereClause(e.else,t,r,g.BADNESS,i)),n+=" END ",n}case"parameter":{const r=i[e.value.toLowerCase()];if("string"==typeof r)return"'"+r.toString().replaceAll("'","''")+"'";if((0,l.$P)(r))return(0,u.bm)(r,t);if((0,l.Lk)(r))return(0,u.bm)(r,t);if((0,l.eg)(r))return(0,u.F1)(r,t);if((0,l.rX)(r))return(0,u.R8)(r,t);if((0,l.f0)(r))return(0,u.Nf)(r,t);if(Array.isArray(r)){const e=[];for(let n=0;n<r.length;n++)"string"==typeof r[n]?e.push("'"+r[n].toString().replaceAll("'","''")+"'"):(0,l.$P)(r[n])||(0,l.Lk)(r[n])?e.push((0,u.bm)(r[n],t)):(0,l.eg)(r[n])?e.push((0,u.F1)(r[n],t)):(0,l.rX)(r[n])?e.push((0,u.R8)(r[n],t)):(0,l.f0)(r[n])?e.push((0,u.Nf)(r[n],t)):e.push(r[n].toString());return e}return r.toString()}case"expression-list":o=[];for(const s of e.value)o.push(this.evaluateNodeToWhereClause(s,t,r,n,i));return o;case"unary-expression":return" ( NOT "+this.evaluateNodeToWhereClause(e.expr,t,r,g.BADNESS,i)+" ) ";case"binary-expression":switch(e.operator){case"AND":return" ("+this.evaluateNodeToWhereClause(e.left,t,r,n,i)+" AND "+this.evaluateNodeToWhereClause(e.right,t,r,n,i)+") ";case"OR":return" ("+this.evaluateNodeToWhereClause(e.left,t,r,n,i)+" OR "+this.evaluateNodeToWhereClause(e.right,t,r,n,i)+") ";case"IS":if("null"!==e.right.type)throw new p.L8(p.Z7.UnsupportedIsRhs);return" ("+this.evaluateNodeToWhereClause(e.left,t,r,n,i)+" IS NULL )";case"ISNOT":if("null"!==e.right.type)throw new p.L8(p.Z7.UnsupportedIsRhs);return" ("+this.evaluateNodeToWhereClause(e.left,t,r,n,i)+" IS NOT NULL )";case"IN":if(s=[],"expression-list"===e.right.type){if("column-reference"===e.left.type&&e.left.column.toUpperCase()===this.field.name.toUpperCase()){const s=[];let o=!0;for(const t of e.right.value){if("string"!==t.type){o=!1;break}if(void 0===this.lkp[t.value]){o=!1;break}s.push(this.lkp[t.value].toString())}if(o)return" ("+this.evaluateNodeToWhereClause(e.left,t,r,n,i)+" IN ("+s.join(",")+")) "}return s=this.evaluateNodeToWhereClause(e.right,t,r,n,i)," ("+this.evaluateNodeToWhereClause(e.left,t,r,n,i)+" IN ("+s.join(",")+")) "}return c=this.evaluateNodeToWhereClause(e.right,t,r,n,i),Array.isArray(c)?" ("+this.evaluateNodeToWhereClause(e.left,t,r,n,i)+" IN ("+c.join(",")+")) ":" ("+this.evaluateNodeToWhereClause(e.left,t,r,n,i)+" IN ("+c+")) ";case"NOT IN":if(s=[],"expression-list"===e.right.type){if("column-reference"===e.left.type&&e.left.column.toUpperCase()===this.field.name.toUpperCase()){const s=[];let o=!0;for(const t of e.right.value){if("string"!==t.type){o=!1;break}if(void 0===this.lkp[t.value]){o=!1;break}s.push(this.lkp[t.value].toString())}if(o)return" ("+this.evaluateNodeToWhereClause(e.left,t,r,n,i)+" NOT IN ("+s.join(",")+")) "}return s=this.evaluateNodeToWhereClause(e.right,t,r,n,i)," ("+this.evaluateNodeToWhereClause(e.left,t,r,n,i)+" NOT IN ("+s.join(",")+")) "}return c=this.evaluateNodeToWhereClause(e.right,t,r,n,i),Array.isArray(c)?" ("+this.evaluateNodeToWhereClause(e.left,t,r,n,i)+" NOT IN ("+c.join(",")+")) ":" ("+this.evaluateNodeToWhereClause(e.left,t,r,n,i)+" NOT IN ("+c+")) ";case"BETWEEN":return a=this.evaluateNodeToWhereClause(e.right,t,r,g.BADNESS,i)," ("+this.evaluateNodeToWhereClause(e.left,t,r,g.BADNESS,i)+" BETWEEN "+a[0]+" AND "+a[1]+" ) ";case"NOTBETWEEN":return a=this.evaluateNodeToWhereClause(e.right,t,r,g.BADNESS,i)," ("+this.evaluateNodeToWhereClause(e.left,t,r,g.BADNESS,i)+" NOT BETWEEN "+a[0]+" AND "+a[1]+" ) ";case"LIKE":return""!==e.escape?" ("+this.evaluateNodeToWhereClause(e.left,t,r,g.BADNESS,i)+" LIKE "+this.evaluateNodeToWhereClause(e.right,t,r,g.BADNESS,i)+" ESCAPE '"+e.escape+"') ":" ("+this.evaluateNodeToWhereClause(e.left,t,r,g.BADNESS,i)+" LIKE "+this.evaluateNodeToWhereClause(e.right,t,r,g.BADNESS,i)+") ";case"NOT LIKE":return""!==e.escape?" ("+this.evaluateNodeToWhereClause(e.left,t,r,g.BADNESS,i)+" NOT LIKE "+this.evaluateNodeToWhereClause(e.right,t,r,g.BADNESS,i)+" ESCAPE '"+e.escape+"') ":" ("+this.evaluateNodeToWhereClause(e.left,t,r,g.BADNESS,i)+" NOT LIKE "+this.evaluateNodeToWhereClause(e.right,t,r,g.BADNESS,i)+") ";case"<>":case"=":if("column-reference"===e.left.type&&"string"===e.right.type){if(e.left.column.toUpperCase()===this.field.name.toUpperCase()&&void 0!==this.lkp[e.right.value.toString()])return" ("+n+" "+e.operator+" "+this.lkp[e.right.value.toString()].toString()+") "}else if("column-reference"===e.right.type&&"string"===e.left.type&&e.right.column.toUpperCase()===this.field.name.toUpperCase())return" ("+this.lkp[e.right.value.toString()].toString()+" "+e.operator+" "+n+") ";return" ("+this.evaluateNodeToWhereClause(e.left,t,r,g.BADNESS,i)+" "+e.operator+" "+this.evaluateNodeToWhereClause(e.right,t,r,g.BADNESS,i)+") ";case"<":case">":case">=":case"<=":case"*":case"-":case"+":case"/":case"||":return" ("+this.evaluateNodeToWhereClause(e.left,t,r,g.BADNESS,i)+" "+e.operator+" "+this.evaluateNodeToWhereClause(e.right,t,r,g.BADNESS,i)+") "}case"null":return"null";case"boolean":return!0===e.value?"1":"0";case"string":return"'"+e.value.toString().replaceAll("'","''")+"'";case"timestamp":return`timestamp '${e.value}'`;case"date":return`date '${e.value}'`;case"time":return`time '${e.value}'`;case"number":return e.value.toString();case"current-time":return(0,u.C6)(e.mode,t);case"current-user":return"CURRENT_USER";case"column-reference":return r&&r.toLowerCase()===e.column.toLowerCase()?"("+n+")":(0,u.Kb)(e.column);case"data-type":return e.value;case"function":{const n=this.evaluateNodeToWhereClause(e.args,t,r,g.BADNESS,i);return(0,u.F6)(e.name,n,t)}}throw new p.L8(p.Z7.UnsupportedSyntax,{node:e.type})}extractValue(e){return this.codefield instanceof d.WhereClause?this.reverseLkp[d.WhereClause.convertValueToStorageFormat(this.codefield.calculateValueCompiled(e))]:this.reverseLkp[e.attributes[this.codefield]]}}g.BADNESS="_!!!_BAD_LKP_!!!!";class w extends f{constructor(e,t){super(e),this._sql=t}rewriteSql(e,t){return{rewritten:!0,where:(0,u.bD)(e,this.field.name,(0,u.YY)(this._sql,l.zl.Standardised),t.getFieldsIndex())}}extractValue(e){return d.WhereClause.convertValueToStorageFormat(this._sql.calculateValueCompiled(e),this.field.type)}}class _ extends o.A{static findField(e,t){for(const r of e)if(r.name.toLowerCase()===t.toString().toLowerCase())return r;return null}constructor(e){super(e),this._calcFunc=null,this.declaredClass="esri.arcade.featureset.actions.Adapted",this.adaptedFields=[],this._extraFilter=null,this._extraFilter=e.extraFilter,this._parent=e.parentfeatureset,this._maxProcessing=30,this.adaptedFields=e.adaptedFields}_initialiseFeatureSet(){null!==this._parent?(this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.globalIdField=this._parent.globalIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types):(this.spatialReference=new h.A({wkid:4326}),this.objectIdField="",this.globalIdField="",this.geometryType=l.ik.point,this.typeIdField="",this.types=null,this.subtypeField=null,this.subtypes=null),this.fields=[];for(const e of this.adaptedFields)e.postInitialization(this,this._parent),this.fields.push(e.field)}async _getSet(e){if(null===this._wset){await this._ensureLoaded();let t=null;return t=this._extraFilter?await this._getFilteredSet("",null,null,null,e):await(this._parent?._getSet(e)),this._checkCancelled(e),(0,c.Lw)(t),this._wset=new a.A(t._candidates.slice(),t._known.slice(),t._ordered,this._clonePageDefinition(t.pagesDefinition)),this._wset}return this._wset}_isInFeatureSet(e){return this._parent._isInFeatureSet(e)}async _getFeatures(e,t,r,s){const o=[];-1!==t&&void 0===this._featureCache[t]&&o.push(t);const l=this._maxQueryRate();if(!0===this._checkIfNeedToExpandKnownPage(e,l))return await this._expandPagedSet(e,l,0,0,s),this._getFeatures(e,t,r,s);let u=0;for(let n=e._lastFetchedIndex;n<e._known.length&&(u++,u<=r&&(e._lastFetchedIndex+=1),!(void 0===this._featureCache[e._known[n]]&&(e._known[n]!==t&&o.push(e._known[n]),o.length>=l)));n++);if(0===o.length)return"success";e=new a.A([],o,e._ordered,null);const c=Math.min(o.length,r);await(this._parent?._getFeatures(e,-1,c,s)),this._checkCancelled(s);const p=[];for(let e=0;e<c;e++){const t=this._parent?._featureFromCache(o[e]);void 0!==t&&p.push({geometry:t.geometry,attributes:t.attributes,id:o[e]})}for(const e of p){const t=[];for(const r of this.adaptedFields)t[r.field.name]=r.extractValue(e);this._featureCache[e.id]=new n.default({attributes:t,geometry:(0,i.Yq)(e.geometry)})}return"success"}async _fetchAndRefineFeatures(){throw new s.dr(s.D_.NeverReach)}async _getFilteredSet(e,t,r,n,i){let s=!1;const o=this._reformulateWithoutAdaptions(r);s=o.cannot,r=o.where;let l=!1;if(null!==n){l=!0;const e=[];for(const t of this.adaptedFields)if(!(t instanceof y)&&!0===n.scanForField(t.field.name)){if(!(t instanceof m)){n=null,l=!1;break}e.push({field:t.field.name,newfield:t.originalField.name})}n&&e.length>0&&(n=n.replaceFields(e))}null!==r?null!==this._extraFilter&&(r=(0,u.kg)(this._extraFilter,r)):r=this._extraFilter,await this._ensureLoaded();const c=await this._parent._getFilteredSet(e,t,r,n,i);let p;return this._checkCancelled(i),p=!0===s?new a.A(c._candidates.slice().concat(c._known.slice()),[],!0===l&&c._ordered,this._clonePageDefinition(c.pagesDefinition)):new a.A(c._candidates.slice(),c._known.slice(),!0===l&&c._ordered,this._clonePageDefinition(c.pagesDefinition)),p}_reformulateWithoutAdaptions(e){const t={cannot:!1,where:e};if(null!==e)for(const r of this.adaptedFields)if(!0===(0,u.Ju)(e,r.field.name)){const n=r.rewriteSql(e,this);if(!0!==n.rewritten){t.cannot=!0,t.where=null;break}t.where=n.where}return t}async _stat(e,t,r,n,i,s,o){let a=!1,l=this._reformulateWithoutAdaptions(t);if(a=l.cannot,t=l.where,l=this._reformulateWithoutAdaptions(i),a=a||l.cannot,null!==(i=l.where)?null!==this._extraFilter&&(i=(0,u.kg)(this._extraFilter,i)):i=this._extraFilter,!0===a)return null===i&&""===r&&null===n?this._manualStat(e,t,s,o):{calculated:!1};const c=await this._parent._stat(e,t,r,n,i,s,o);return!1===c.calculated?null===i&&""===r&&null===n?this._manualStat(e,t,s,o):{calculated:!1}:c}async _canDoAggregates(e,t,r,n,i){if(null===this._parent)return!1;for(let t=0;t<e.length;t++)for(const r of this.adaptedFields)if(e[t].toLowerCase()===r.field.name.toLowerCase()&&!(r instanceof y))return!1;const s=[];for(let e=0;e<t.length;e++){const r=t[e];if(null!==r.workingexpr){const e=this._reformulateWithoutAdaptions(r.workingexpr);if(e.cannot)return!1;const t=r.clone();t.workingexpr=e.where,s.push(t)}else s.push(r)}const o=this._reformulateWithoutAdaptions(i);return!o.cannot&&(null!==(i=o.where)?null!==this._extraFilter&&(i=(0,u.kg)(this._extraFilter,i)):i=this._extraFilter,this._parent._canDoAggregates(e,s,r,n,i))}async _getAggregatePagesDataSourceDefinition(e,t,r,n,i,o,a){if(null===this._parent)throw new s.dr(s.D_.NeverReach);const l=[];for(let e=0;e<t.length;e++){const r=t[e];if(null!==r.workingexpr){const e=this._reformulateWithoutAdaptions(r.workingexpr);if(e.cannot)throw new s.dr(s.D_.NeverReach);const t=r.clone();t.workingexpr=e.where,l.push(t)}else l.push(r)}const c=this._reformulateWithoutAdaptions(i);if(c.cannot)throw new s.dr(s.D_.NeverReach);return null!==(i=c.where)?null!==this._extraFilter&&(i=(0,u.kg)(this._extraFilter,i)):i=this._extraFilter,this._parent._getAggregatePagesDataSourceDefinition(e,l,r,n,i,o,a)}}},93595:function(e,t,r){r.d(t,{A:function(){return p}});var n=r(3724),i=r(65636),s=r(63394),o=r(62032),a=r(88396),l=r(60539),u=r(16177),c=r(57165);class p extends i.A{constructor(e){super(e),this.declaredClass="esri.arcade.featureset.actions.AttributeFilter",this._maxProcessing=1e3,this._parent=e.parentfeatureset,e.whereclause instanceof u.WhereClause?(this._whereclause=e.whereclause,this._whereClauseFunction=null):(this._whereClauseFunction=e.whereclause,this._whereclause=null)}_initialiseFeatureSet(){null!==this._parent?(this.fields=this._parent.fields.slice(),this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.globalIdField=this._parent.globalIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types,this.subtypeField=this._parent.subtypeField,this.subtypes=this._parent.subtypes):(this.fields=[],this.typeIdField="",this.subtypeField="",this.objectIdField="",this.globalIdField="",this.spatialReference=new c.A({wkid:4326}),this.geometryType=o.ik.point)}async _getSet(e){if(null===this._wset){await this._ensureLoaded();const t=await this._parent._getFilteredSet("",null,this._whereclause,null,e);return this._checkCancelled(e),null!==this._whereClauseFunction?this._wset=new s.A(t._candidates.slice().concat(t._known.slice()),[],t._ordered,this._clonePageDefinition(t.pagesDefinition)):this._wset=new s.A(t._candidates.slice(),t._known.slice(),t._ordered,this._clonePageDefinition(t.pagesDefinition)),this._wset}return this._wset}_isInFeatureSet(e){let t=this._parent?._isInFeatureSet(e);return t===o.J6.NotInFeatureSet?t:(t=this._idstates[e],void 0===t?o.J6.Unknown:t)}_getFeature(e,t,r){return this._parent._getFeature(e,t,r)}_getFeatures(e,t,r,n){return this._parent._getFeatures(e,t,r,n)}_featureFromCache(e){return this._parent._featureFromCache(e)}executeWhereClause(e){return this._whereclause?.testFeature(e)??!1}async executeWhereClauseDeferred(e){if(null!==this._whereClauseFunction){const t=this._whereClauseFunction(e);return(0,l.$X)(t),t}return this.executeWhereClause(e)}async _fetchAndRefineFeatures(e,t,r){const n=new s.A([],e,!1,null),i=Math.min(t,e.length);if(await(this._parent?._getFeatures(n,-1,i,r)),this._checkCancelled(r),null==this._whereClauseFunction){for(let t=0;t<i;t++){const r=this._parent?._featureFromCache(e[t]);!0===this.executeWhereClause(r)?this._idstates[e[t]]=o.J6.InFeatureSet:this._idstates[e[t]]=o.J6.NotInFeatureSet}return"success"}const a=[];for(let t=0;t<i;t++){const r=this._parent?._featureFromCache(e[t]);a.push(await this.executeWhereClauseDeferred(r))}for(let r=0;r<t;r++)!0===a[r]?this._idstates[e[r]]=o.J6.InFeatureSet:this._idstates[e[r]]=o.J6.NotInFeatureSet;return"success"}async _getFilteredSet(e,t,r,n,i){null!==this._whereClauseFunction||(null!==r?null!==this._whereclause&&(r=(0,a.kg)(this._whereclause,r)):r=this._whereclause),await this._ensureLoaded();const o=await this._parent._getFilteredSet(e,t,r,n,i);let l;return this._checkCancelled(i),l=null!==this._whereClauseFunction?new s.A(o._candidates.slice().concat(o._known.slice()),[],o._ordered,this._clonePageDefinition(o.pagesDefinition)):new s.A(o._candidates.slice(),o._known.slice(),o._ordered,this._clonePageDefinition(o.pagesDefinition)),l}async _stat(e,t,r,n,i,s,o){if(null!==this._whereClauseFunction)return null===i&&""===r&&null===n?this._manualStat(e,t,s,o):{calculated:!1};let l=this._whereclause;null!==i&&null!==this._whereclause&&(l=(0,a.kg)(this._whereclause,i));const u=await this._parent._stat(e,t,r,n,l,s,o);return!1===u.calculated?null===i&&""===r&&null===n?this._manualStat(e,t,s,o):{calculated:!1}:u}async _canDoAggregates(e,t,r,n,i){return null===this._whereClauseFunction&&(null!==i?null!==this._whereclause&&(i=(0,a.kg)(this._whereclause,i)):i=this._whereclause,null!==this._parent&&this._parent._canDoAggregates(e,t,r,n,i))}async _getAggregatePagesDataSourceDefinition(e,t,r,i,s,o,l){if(null===this._parent)throw new n.dr(n.D_.NeverReach);return null!==s?null!==this._whereclause&&(s=(0,a.kg)(this._whereclause,s)):s=this._whereclause,this._parent._getAggregatePagesDataSourceDefinition(e,t,r,i,s,o,l)}static registerAction(){i.A._featuresetFunctions.filter=function(e){if("function"==typeof e)return new p({parentfeatureset:this,whereclause:e});let t=null;return e instanceof u.WhereClause&&(t=e),new p({parentfeatureset:this,whereclause:t})}}getFieldsIndex(){return this._parent.getFieldsIndex()}}},76:function(e,t,r){r.d(t,{A:function(){return l}});var n=r(69243),i=r(3724),s=r(65636),o=r(63394),a=r(54797);class l extends s.A{constructor(e){super(e),this._orderbyclause=null,this.declaredClass="esri.arcade.featureset.actions.OrderBy",this._maxProcessing=100,this._orderbyclause=e.orderbyclause,this._parent=e.parentfeatureset}async _getSet(e){if(null===this._wset){await this._ensureLoaded();const t=await this._getFilteredSet("",null,null,this._orderbyclause,e);return this._checkCancelled(e),this._wset=t,this._wset}return this._wset}async manualOrderSet(e,t){const r=await this.getIdColumnDictionary(e,[],-1,t);this._orderbyclause?.order(r);const n=new o.A([],[],!0,null);for(let e=0;e<r.length;e++)n._known.push(r[e].id);return n}async getIdColumnDictionary(e,t,r,i){if(r<e._known.length-1){const s=this._maxQueryRate();if("GETPAGES"===e._known[r+1])return await(0,n.a1)(this._parent._expandPagedSet(e,s,0,0,i)),this.getIdColumnDictionary(e,t,r,i);let o=r+1;const a=[];for(;o<e._known.length&&"GETPAGES"!==e._known[o];)a.push(e._known[o]),o++;r+=a.length;const l=await(0,n.a1)(this._parent._getFeatureBatch(a,i));this._checkCancelled(i);for(const e of l)t.push({id:e.attributes[this.objectIdField],feature:e});return this.getIdColumnDictionary(e,t,r,i)}return e._candidates.length>0?(await(0,n.a1)(this._refineSetBlock(e,this._maxProcessingRate(),i)),this._checkCancelled(i),this.getIdColumnDictionary(e,t,r,i)):t}_isInFeatureSet(e){return this._parent._isInFeatureSet(e)}_getFeatures(e,t,r,n){return this._parent._getFeatures(e,t,r,n)}_featureFromCache(e){if(void 0===this._featureCache[e]){const t=this._parent._featureFromCache(e);if(void 0===t)return;return null===t?null:(this._featureCache[e]=t,t)}return this._featureCache[e]}async _fetchAndRefineFeatures(){throw new i.dr(i.D_.NeverReach)}async _getFilteredSet(e,t,r,n,i){await this._ensureLoaded();const s=await this._parent._getFilteredSet(e,t,r,null===n?this._orderbyclause:n,i);this._checkCancelled(i);const a=new o.A(s._candidates.slice(),s._known.slice(),s._ordered,this._clonePageDefinition(s.pagesDefinition));let l=!0;if(s._candidates.length>0&&(l=!1),!1===a._ordered){let e=await this.manualOrderSet(a,i);return!1===l&&(null===t&&null===r||(e=new o.A(e._candidates.slice().concat(e._known.slice()),[],e._ordered,this._clonePageDefinition(e.pagesDefinition)))),e}return a}static registerAction(){s.A._featuresetFunctions.orderBy=function(e){return""===e?this:new l({parentfeatureset:this,orderbyclause:new a.A(e)})}}getFieldsIndex(){return this._parent.getFieldsIndex()}}},58175:function(e,t,r){r.d(t,{A:function(){return u}});var n=r(25073),i=r(3724),s=r(65636),o=r(63394),a=r(62032),l=r(75160);class u extends s.A{constructor(e){super(e),this._relation="",this._relationGeom=null,this._relationString="",this.declaredClass="esri.arcade.featureset.actions.SpatialFilter",this._relationString=e.relationString,this._parent=e.parentfeatureset,this._maxProcessing=40,this._relation=e.relation,this._relationGeom=e.relationGeom}async _getSet(e){if(null===this._wset){await this._ensureLoaded();const t=await this._parent._getFilteredSet("esriSpatialRelRelation"!==this._relation?this._relation:this._relation+":"+this._relationString,this._relationGeom,null,null,e);return this._checkCancelled(e),this._wset=new o.A(t._candidates.slice(),t._known.slice(),t._ordered,this._clonePageDefinition(t.pagesDefinition)),this._wset}return this._wset}_isInFeatureSet(e){let t=this._parent._isInFeatureSet(e);return t===a.J6.NotInFeatureSet?t:(t=this._idstates[e],void 0===t?a.J6.Unknown:t)}_getFeature(e,t,r){return this._parent._getFeature(e,t,r)}_getFeatures(e,t,r,n){return this._parent._getFeatures(e,t,r,n)}_featureFromCache(e){return this._parent._featureFromCache(e)}async executeSpatialRelationTest(e){if(null===e.geometry)return!1;switch(this._relation){case"esriSpatialRelEnvelopeIntersects":return(0,l.intersects)((0,a.Yc)(this._relationGeom),(0,a.Yc)(e.geometry));case"esriSpatialRelIntersects":return(0,l.intersects)(this._relationGeom,e.geometry);case"esriSpatialRelContains":return(0,l.contains)(this._relationGeom,e.geometry);case"esriSpatialRelOverlaps":return(0,l.overlaps)(this._relationGeom,e.geometry);case"esriSpatialRelWithin":return(0,l.within)(this._relationGeom,e.geometry);case"esriSpatialRelTouches":return(0,l.touches)(this._relationGeom,e.geometry);case"esriSpatialRelCrosses":return(0,l.crosses)(this._relationGeom,e.geometry);case"esriSpatialRelRelation":return(0,l.relate)(this._relationGeom,e.geometry,this._relationString??"")}}async _fetchAndRefineFeatures(e,t,r){const n=new o.A([],e,!1,null),i=Math.min(t,e.length);await(this._parent?._getFeatures(n,-1,i,r)),this._checkCancelled(r);const s=[];for(let t=0;t<i;t++){const r=this._parent._featureFromCache(e[t]);s.push(await this.executeSpatialRelationTest(r))}for(let r=0;r<t;r++)!0===s[r]?this._idstates[e[r]]=a.J6.InFeatureSet:this._idstates[e[r]]=a.J6.NotInFeatureSet;return"success"}async _getFilteredSet(e,t,r,n,i){await this._ensureLoaded();const s=await this._parent._getFilteredSet("esriSpatialRelRelation"!==this._relation?this._relation:this._relation+":"+this._relationString,this._relationGeom,r,n,i);let a;return this._checkCancelled(i),a=null!==t?new o.A(s._candidates.slice().concat(s._known.slice()),[],s._ordered,this._clonePageDefinition(s.pagesDefinition)):new o.A(s._candidates.slice(),s._known.slice(),s._ordered,this._clonePageDefinition(s.pagesDefinition)),a}async _stat(e,t,r,n,i,s,o){if(""!==r)return{calculated:!1};const a=await this._parent._stat(e,t,"esriSpatialRelRelation"!==this._relation?this._relation:this._relation+":"+this._relationString,this._relationGeom,i,s,o);return!1===a.calculated?null===i&&""===r&&null===n?this._manualStat(e,t,s,o):{calculated:!1}:a}async _canDoAggregates(e,t,r,n,i){return""===r&&null===n&&null!==this._parent&&this._parent._canDoAggregates(e,t,"esriSpatialRelRelation"!==this._relation?this._relation:this._relation+":"+this._relationString,this._relationGeom,i)}async _getAggregatePagesDataSourceDefinition(e,t,r,n,s,o,a){if(null===this._parent)throw new i.dr(i.D_.NeverReach);return this._parent._getAggregatePagesDataSourceDefinition(e,t,"esriSpatialRelRelation"!==this._relation?this._relation:this._relation+":"+this._relationString,this._relationGeom,s,o,a)}static registerAction(){s.A._featuresetFunctions.intersects=function(e){return null==e?new n.A({parentfeatureset:this}):new u({parentfeatureset:this,relation:"esriSpatialRelIntersects",relationGeom:e})},s.A._featuresetFunctions.envelopeIntersects=function(e){return null==e?new n.A({parentfeatureset:this}):new u({parentfeatureset:this,relation:"esriSpatialRelEnvelopeIntersects",relationGeom:e})},s.A._featuresetFunctions.contains=function(e){return null==e?new n.A({parentfeatureset:this}):new u({parentfeatureset:this,relation:"esriSpatialRelContains",relationGeom:e})},s.A._featuresetFunctions.overlaps=function(e){return null==e?new n.A({parentfeatureset:this}):new u({parentfeatureset:this,relation:"esriSpatialRelOverlaps",relationGeom:e})},s.A._featuresetFunctions.within=function(e){return null==e?new n.A({parentfeatureset:this}):new u({parentfeatureset:this,relation:"esriSpatialRelWithin",relationGeom:e})},s.A._featuresetFunctions.touches=function(e){return null==e?new n.A({parentfeatureset:this}):new u({parentfeatureset:this,relation:"esriSpatialRelTouches",relationGeom:e})},s.A._featuresetFunctions.crosses=function(e){return null==e?new n.A({parentfeatureset:this}):new u({parentfeatureset:this,relation:"esriSpatialRelCrosses",relationGeom:e})},s.A._featuresetFunctions.relate=function(e,t){return null==e?new n.A({parentfeatureset:this}):new u({parentfeatureset:this,relation:"esriSpatialRelRelation",relationGeom:e,relationString:t})}}getFieldsIndex(){return this._parent.getFieldsIndex()}}},46538:function(e,t,r){r.d(t,{A:function(){return a}});var n=r(3724),i=r(65636),s=r(63394),o=r(62032);class a extends i.A{constructor(e){super(e),this._topnum=0,this.declaredClass="esri.arcade.featureset.actions.Top",this._countedin=0,this._maxProcessing=100,this._topnum=e.topnum,this._parent=e.parentfeatureset}async _getSet(e){if(null===this._wset){await this._ensureLoaded();const t=await this._parent._getSet(e);return this._wset=new s.A(t._candidates.slice(),t._known.slice(),!1,this._clonePageDefinition(t.pagesDefinition)),this._setKnownLength(this._wset)>this._topnum&&(this._wset._known=this._wset._known.slice(0,this._topnum)),this._setKnownLength(this._wset)>=this._topnum&&(this._wset._candidates=[]),this._wset}return this._wset}_setKnownLength(e){return e._known.length>0&&"GETPAGES"===e._known[e._known.length-1]?e._known.length-1:e._known.length}_isInFeatureSet(e){const t=this._parent._isInFeatureSet(e);if(t===o.J6.NotInFeatureSet)return t;const r=this._idstates[e];return r===o.J6.InFeatureSet||r===o.J6.NotInFeatureSet?r:t===o.J6.InFeatureSet&&void 0===r?this._countedin<this._topnum?(this._idstates[e]=o.J6.InFeatureSet,this._countedin++,o.J6.InFeatureSet):(this._idstates[e]=o.J6.NotInFeatureSet,o.J6.NotInFeatureSet):o.J6.Unknown}async _expandPagedSet(e,t,r,i,s){if(null===this._parent)throw new n.dr(n.D_.NotImplemented);if(t>this._topnum&&(t=this._topnum),this._countedin>=this._topnum&&e.pagesDefinition.internal.set.length<=e.pagesDefinition.resultOffset){let t=e._known.length;return t>0&&"GETPAGES"===e._known[t-1]&&(e._known.length=t-1),t=e._candidates.length,t>0&&"GETPAGES"===e._candidates[t-1]&&(e._candidates.length=t-1),"success"}const o=await this._parent._expandPagedSet(e,t,r,i,s);return this._setKnownLength(e)>this._topnum&&(e._known.length=this._topnum),this._setKnownLength(e)>=this._topnum&&(e._candidates.length=0),o}async _getFeatures(e,t,r,n){const i=[],o=this._maxQueryRate();if(!0===this._checkIfNeedToExpandKnownPage(e,o))return await this._expandPagedSet(e,o,0,0,n),this._getFeatures(e,t,r,n);-1!==t&&void 0===this._featureCache[t]&&i.push(t);let a=0;for(let n=e._lastFetchedIndex;n<e._known.length&&(a++,a<=r&&(e._lastFetchedIndex+=1),!(void 0===this._featureCache[e._known[n]]&&(e._known[n]!==t&&i.push(e._known[n]),i.length>o)));n++);if(0===i.length)return"success";const l=new s.A([],i,!1,null),u=Math.min(i.length,r);await this._parent._getFeatures(l,-1,u,n);for(let e=0;e<u;e++){const t=this._parent._featureFromCache(i[e]);void 0!==t&&(this._featureCache[i[e]]=t)}return"success"}async _getFilteredSet(e,t,r,n,i){await this._ensureLoaded();const o=await this._getSet(i);return new s.A(o._candidates.slice().concat(o._known.slice()),[],!1,this._clonePageDefinition(o.pagesDefinition))}_refineKnowns(e,t){let r=0,n=null;const i=[];for(let s=0;s<e._candidates.length;s++){const a=this._isInFeatureSet(e._candidates[s]);if(a===o.J6.InFeatureSet){if(e._known.push(e._candidates[s]),r+=1,null===n?n={start:s,end:s}:n.end===s-1?n.end=s:(i.push(n),n={start:s,end:s}),e._known.length>=this._topnum)break}else if(a===o.J6.NotInFeatureSet)null===n?n={start:s,end:s}:n.end===s-1?n.end=s:(i.push(n),n={start:s,end:s}),r+=1;else if(a===o.J6.Unknown)break;if(r>=t)break}null!==n&&i.push(n);for(let t=i.length-1;t>=0;t--)e._candidates.splice(i[t].start,i[t].end-i[t].start+1);this._setKnownLength(e)>this._topnum&&(e._known=e._known.slice(0,this._topnum)),this._setKnownLength(e)>=this._topnum&&(e._candidates=[])}async _stat(){return{calculated:!1}}async _canDoAggregates(){return!1}static registerAction(){i.A._featuresetFunctions.top=function(e){return new a({parentfeatureset:this,topnum:e})}}getFieldsIndex(){return this._parent.getFieldsIndex()}}},25073:function(e,t,r){r.d(t,{A:function(){return a}});var n=r(3724),i=r(65636),s=r(63394),o=r(62032);class a extends i.A{constructor(e){super(e),this.declaredClass="esri.layers.featureset.sources.Empty",this._maxProcessing=1e3,this._wset=new s.A([],[],!1,null),this._parent=e.parentfeatureset,this._databaseType=o.zl.Standardised}async _getSet(){return this._wset}optimisePagingFeatureQueries(){}_isInFeatureSet(){return o.J6.NotInFeatureSet}async _getFeature(){throw new n.dr(n.D_.NeverReach)}async queryAttachments(){return[]}async _getFeatures(){return"success"}_featureFromCache(){return null}async _fetchAndRefineFeatures(){throw new n.dr(n.D_.NeverReach)}async _getFilteredSet(){return new s.A([],[],!1,null)}_stat(e,t,r,n,i,s,o){return this._manualStat(e,t,s,o)}async _canDoAggregates(){return!1}}},90914:function(e,t,r){r.d(t,{A:function(){return y}});var n=r(59469),i=r(3724),s=r(65636),o=r(63394),a=r(62032),l=r(88396),u=r(98737),c=r(46556),p=r(57534),d=r(49342),h=r(56740),f=r(7926);class y extends s.A{constructor(e){super(e),this.declaredClass="esri.arcade.featureset.sources.FeatureLayerMemory",this._removeGeometry=!1,this._overrideFields=null,this._forceIsTable=!1,e.spatialReference&&(this.spatialReference=e.spatialReference),this._transparent=!0,this._maxProcessing=1e3,this._layer=e.layer,this._wset=null,!0===e.isTable&&(this._forceIsTable=!0),void 0!==e.outFields&&(this._overrideFields=e.outFields),void 0!==e.includeGeometry&&(this._removeGeometry=!1===e.includeGeometry)}_maxQueryRate(){return a.gO}end(){return this._layer}optimisePagingFeatureQueries(){}async loadImpl(){return!0===this._layer.loaded?(this._initialiseFeatureSet(),this):(await this._layer.load(),this._initialiseFeatureSet(),this)}get gdbVersion(){return""}_initialiseFeatureSet(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._layer.geometryType??"",this.fields=this._layer.fields.slice(),null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{const e=[],t=[];for(const r of this.fields)if("oid"===r.type)e.push(r),t.push(r.name);else for(const n of this._overrideFields)if(n.toLowerCase()===r.name.toLowerCase()){e.push(r),t.push(r.name);break}this.fields=e,this._overrideFields=t}this.objectIdField=this._layer.objectIdField;for(const e of this.fields)"global-id"===e.type&&(this.globalIdField=e.name);this._databaseType=a.zl.Standardised,this.hasZ=!0===this._layer?.capabilities?.data?.supportsZ,this.hasM=!0===this._layer?.capabilities?.data?.supportsM,this.subtypeField=("subtypeField"in this._layer?this._layer.subtypeField:null)??"",this.subtypes="subtypes"in this._layer?this._layer.subtypes:null,this.typeIdField=("typeIdField"in this._layer?this._layer.typeIdField:null)??"",this.types="types"in this._layer?this._layer.types:null}isTable(){return this._forceIsTable||"isTable"in this._layer&&this._layer.isTable||"table"===this._layer.type||!this._layer.geometryType}_isInFeatureSet(){return a.J6.InFeatureSet}_candidateIdTransform(e){return e}async _getSet(e){if(null===this._wset){await this._ensureLoaded();const t=await this._getFilteredSet("",null,null,null,e);return this._wset=t,t}return this._wset}_changeFeature(e){const t={};for(const r of this.fields)t[r.name]=e.attributes[r.name];return new n.default({geometry:!0===this._removeGeometry?null:e.geometry,attributes:t})}async _getFilteredSet(e,t,r,n,i){let s="",c=!1;if(null!==n&&(s=n.constructClause(),c=!0),this.isTable()&&t&&null!==e&&""!==e)return new o.A([],[],!0,null);const p=this._layer.createQuery();p.returnZ=this.hasZ,p.returnM=this.hasM,p.where=(0,u.m)(p.where,null===r?null===t?"1=1":"":(0,l.YY)(r,a.zl.Standardised)),p.spatialRelationship=this._makeRelationshipEnum(e),p.outSpatialReference=this.spatialReference,p.orderByFields=""!==s?s.split(","):null,p.geometry=null===t?null:t,p.returnGeometry=!0,p.relationParameter=this._makeRelationshipParam(e);const d=await this._layer.queryFeatures(p);if(null===d)return new o.A([],[],c,null);this._checkCancelled(i);const h=[];return d.features.forEach((e=>{const t=e.attributes[this._layer.objectIdField];h.push(t),this._featureCache[t]=this._changeFeature(e)})),new o.A([],h,c,null)}_makeRelationshipEnum(e){if(e.includes("esriSpatialRelRelation"))return"relation";switch(e){case"esriSpatialRelRelation":return"relation";case"esriSpatialRelIntersects":return"intersects";case"esriSpatialRelContains":return"contains";case"esriSpatialRelOverlaps":return"overlaps";case"esriSpatialRelWithin":return"within";case"esriSpatialRelTouches":return"touches";case"esriSpatialRelCrosses":return"crosses";case"esriSpatialRelEnvelopeIntersects":return"envelope-intersects"}return e}_makeRelationshipParam(e){return e.includes("esriSpatialRelRelation")?e.split(":")[1]:""}async _queryAllFeatures(){if(this._wset)return this._wset;const e=new f.A;if(e.where="1=1",await this._ensureLoaded(),this._layer.source&&this._layer.source.items){const e=[];return this._layer.source.items.forEach((t=>{const r=t.attributes[this._layer.objectIdField];e.push(r),this._featureCache[r]=this._changeFeature(t)})),this._wset=new o.A([],e,!1,null),this._wset}e.returnZ=this.hasZ,e.returnM=this.hasM;const t=await this._layer.queryFeatures(e),r=[];return t.features.forEach((e=>{const t=e.attributes[this._layer.objectIdField];r.push(t),this._featureCache[t]=this._changeFeature(e)})),this._wset=new o.A([],r,!1,null),this._wset}async _getFeatures(e,t,r){const n=[];-1!==t&&void 0===this._featureCache[t]&&n.push(t);for(let i=e._lastFetchedIndex;i<e._known.length&&(e._lastFetchedIndex+=1,!(void 0===this._featureCache[e._known[i]]&&(e._known[i]!==t&&n.push(e._known[i]),n.length>r)));i++);if(0===n.length)return"success";throw new i.dr(i.D_.MissingFeatures)}async _refineSetBlock(e){return e}async _stat(){return{calculated:!1}}async _canDoAggregates(){return!1}relationshipMetaData(){return[]}static _cloneAttr(e){const t={};for(const r in e)t[r]=e[r];return t}nativeCapabilities(){return{title:this._layer.title??"",canQueryRelated:!1,source:this,capabilities:this._layer.capabilities,databaseType:this._databaseType,requestStandardised:!0}}static create(e,t){let r=e.layerDefinition.objectIdField;const n=e.layerDefinition.typeIdField??"",i=[];if(e.layerDefinition.types)for(const t of e.layerDefinition.types)i.push(d.A.fromJSON(t));let s=e.layerDefinition.geometryType;void 0===s&&(s=e.featureSet.geometryType||"");let o=e.featureSet.features;const a=t.toJSON();if(!r){let t=!1;for(const n of e.layerDefinition.fields)if("oid"===n.type||"esriFieldTypeOID"===n.type){r=n.name,t=!0;break}if(!1===t){let t="FID",n=!0,i=0;for(;n;){let r=!0;for(const n of e.layerDefinition.fields)if(n.name===t){r=!1;break}!0===r?n=!1:(i++,t="FID"+i.toString())}e.layerDefinition.fields.push({type:"esriFieldTypeOID",name:t,alias:t});const s=[];for(let r=0;r<o.length;r++)s.push({geometry:e.featureSet.features[r].geometry,attributes:e.featureSet.features[r].attributes?this._cloneAttr(e.featureSet.features[r].attributes):{}}),s[r].attributes[t]=r;o=s,r=t}}const l=[];for(const t of e.layerDefinition.fields)t instanceof h.A?l.push(t):l.push(h.A.fromJSON(t));let u=s;switch(u||(u=""),u){case"esriGeometryPoint":u="point";break;case"esriGeometryPolyline":u="polyline";break;case"esriGeometryPolygon":u="polygon";break;case"esriGeometryEnvelope":u="extent";break;case"esriGeometryMultipoint":u="multipoint";break;case"":case"esriGeometryNull":u="esriGeometryNull"}if("esriGeometryNull"!==u)for(const e of o)e.geometry&&e.geometry instanceof c.A==0&&(e.geometry.type=u,void 0===e.geometry.spatialReference&&(e.geometry.spatialReference=a));else for(const e of o)e.geometry&&(e.geometry=null);const f={outFields:["*"],source:o,fields:l,hasZ:!0===e?.layerDefinition?.hasZ||!0===e?.featureSet?.hasZ,hasM:!0===e?.layerDefinition?.hasM||!0===e?.featureSet?.hasM,types:i,typeIdField:n,objectIdField:r,spatialReference:t},m="esriGeometryNull"===u||null===u;m||(f.geometryType=u);const g=new p.default(f);return e?.layerDefinition?.subtypeField&&e?.layerDefinition?.subtypes&&g.read({subtypes:e.layerDefinition.subtypes,subtypeField:e.layerDefinition.subtypeField}),new y({layer:g,spatialReference:t,isTable:m})}async queryAttachments(){return[]}async getFeatureByObjectId(e){const t=new f.A;t.where=this.objectIdField+"="+e.toString(),t.returnZ=this.hasZ,t.returnM=this.hasM;const r=await this._layer.queryFeatures(t);return 1===r.features.length?r.features[0]:null}async getOwningSystemUrl(){return""}async getIdentityUser(){return""}get preferredTimeZone(){return"preferredTimeZone"in this._layer?this._layer.preferredTimeZone:null}get dateFieldsTimeZone(){return"dateFieldsTimeZone"in this._layer?this._layer.dateFieldsTimeZone:null}get datesInUnknownTimezone(){return"datesInUnknownTimezone"in this._layer&&this._layer.datesInUnknownTimezone}get editFieldsInfo(){return"editFieldsInfo"in this._layer?this._layer.editFieldsInfo:null}get timeInfo(){return this._layer?.timeInfo}async getFeatureSetInfo(){const e=this._layer.title&&this._layer.parent;return this.fsetInfo??{layerId:null,layerName:null,itemId:null,serviceLayerUrl:null,webMapLayerId:e?this._layer.id??null:null,webMapLayerTitle:e?this._layer.title??null:null,className:null,objectClassId:null}}}},65636:function(e,t,r){r.d(t,{A:function(){return y}});var n=r(65883),i=r(3724),s=r(70868);class o{constructor(e,t){this._lastId=-1,this._progress=t,this._parent=e}reset(){this._lastId=-1}async nextBatchAsArcadeFeatures(e,t){const r=await this.nextBatch(e);return null===r?r:r.map((e=>s.A.createFromGraphicLikeObject(e.geometry,e.attributes,this._parent,t)))}nextBatch(e){if(null!==this._parent._mainSetInUse)return this._parent._mainSetInUse.then((t=>this.nextBatch(e)),(t=>this.nextBatch(e)));const t={returnpromise:null,hasset:!1},r=[];return t.returnpromise=new Promise(((n,i)=>{this._parent._getSet(this._progress).then((s=>{const o=s._known;let a=o.length-1;if("GETPAGES"===o[o.length-1]&&(a-=1),this._lastId+e>a&&o.length>0&&"GETPAGES"===o[o.length-1])return void this._parent._expandPagedSet(s,this._parent._maxQueryRate(),0,0,this._progress).then((r=>{t.hasset=!0,this._parent._mainSetInUse=null,this.nextBatch(e).then(n,i)}),(e=>{t.hasset=!0,this._parent._mainSetInUse=null,i(e)}));const l=s._candidates;if(a>=this._lastId+e||0===l.length){for(let t=0;t<e;t++){const e=t+this._lastId+1;if(e>=o.length)break;r[t]=o[e]}return this._lastId+=r.length,0===r.length&&(t.hasset=!0,this._parent._mainSetInUse=null,n([])),void this._parent._getFeatureBatch(r,this._progress).then((e=>{t.hasset=!0,this._parent._mainSetInUse=null,n(e)}),(e=>{t.hasset=!0,this._parent._mainSetInUse=null,i(e)}))}this._parent._refineSetBlock(s,this._parent._maxProcessingRate(),this._progress).then((()=>{t.hasset=!0,this._parent._mainSetInUse=null,this.nextBatch(e).then(n,i)}),(e=>{t.hasset=!0,this._parent._mainSetInUse=null,i(e)}))}),(e=>{t.hasset=!0,this._parent._mainSetInUse=null,i(e)}))})),!1===t.hasset&&(this._parent._mainSetInUse=t.returnpromise,t.hasset=!0),t.returnpromise}next(){if(null!==this._parent._mainSetInUse)return this._parent._mainSetInUse.then((e=>this.next()),(e=>this.next()));const e={returnpromise:null,hasset:!1};return e.returnpromise=new Promise(((t,r)=>{this._parent._getSet(this._progress).then((n=>{const i=n._known;this._lastId<i.length-1?"GETPAGES"===i[this._lastId+1]?this._parent._expandPagedSet(n,this._parent._maxQueryRate(),0,0,this._progress).then((t=>(e.hasset=!0,this._parent._mainSetInUse=null,this.next()))).then(t,r):(this._lastId+=1,this._parent._getFeature(n,i[this._lastId],this._progress).then((r=>{e.hasset=!0,this._parent._mainSetInUse=null,t(r)}),(t=>{e.hasset=!0,this._parent._mainSetInUse=null,r(t)}))):n._candidates.length>0?this._parent._refineSetBlock(n,this._parent._maxProcessingRate(),this._progress).then((()=>{e.hasset=!0,this._parent._mainSetInUse=null,this.next().then(t,r)}),(t=>{e.hasset=!0,this._parent._mainSetInUse=null,r(t)})):(e.hasset=!0,this._parent._mainSetInUse=null,t(null))}),(t=>{e.hasset=!0,this._parent._mainSetInUse=null,r(t)}))})),!1===e.hasset&&(this._parent._mainSetInUse=e.returnpromise,e.hasset=!0),e.returnpromise}async count(){if(-1!==this._parent._totalCount)return this._parent._totalCount;const e=await this._parent._getSet(this._progress),t=await this._refineAllSets(e);return this._parent._totalCount=t._known.length,this._parent._totalCount}async _refineAllSets(e){if(e._known.length>0&&"GETPAGES"===e._known[e._known.length-1])return await this._parent._expandPagedSet(e,this._parent._maxQueryRate(),0,1,this._progress),this._refineAllSets(e);if(e._candidates.length>0){if("GETPAGES"===e._known[e._candidates.length-1])return await this._parent._expandPagedSet(e,this._parent._maxQueryRate(),0,2,this._progress),this._refineAllSets(e);const t=await this._parent._refineSetBlock(e,this._parent._maxProcessingRate(),this._progress);return t._candidates.length>0?this._refineAllSets(t):t}return e}}var a=r(63394),l=r(62032),u=r(72630),c=r(60539),p=r(16177),d=r(75160),h=r(57165),f=r(7103);class y{constructor(e){this.recentlyUsedQueries=null,this.featureSetQueryInterceptor=null,this._idstates=[],this._parent=null,this._wset=null,this._mainSetInUse=null,this._maxProcessing=200,this._maxQuery=500,this._totalCount=-1,this._databaseType=l.zl.NotEvaluated,this._databaseTypeProbed=null,this.declaredRootClass="esri.arcade.featureset.support.FeatureSet",this._featureCache=Object.create(null),this.typeIdField=null,this.types=null,this.subtypeField=null,this.subtypes=null,this.fields=null,this.geometryType="",this.objectIdField="",this.globalIdField="",this.spatialReference=null,this.hasM=!1,this.hasZ=!1,this._transparent=!1,this.loaded=!1,this._loadPromise=null,this._fieldsIndex=null,this.fsetInfo=null,e?.lrucache&&(this.recentlyUsedQueries=e.lrucache),e?.interceptor&&(this.featureSetQueryInterceptor=e.interceptor)}optimisePagingFeatureQueries(e){this._parent&&this._parent.optimisePagingFeatureQueries(e)}_hasMemorySource(){return!0}prop(e,t){return void 0===t?this[e]:(void 0!==this[e]&&(this[e]=t),this)}end(){return null!==this._parent&&!0===this._parent._transparent?this._parent.end():this._parent}_ensureLoaded(){return this.load()}load(){return null===this._loadPromise&&(this._loadPromise=this.loadImpl()),this._loadPromise}async loadImpl(){return!0===this._parent?.loaded?(this._initialiseFeatureSet(),this):(await(this._parent?.load()),this._initialiseFeatureSet(),this)}_initialiseFeatureSet(){null!==this._parent?(this.fields=this._parent.fields.slice(),this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.globalIdField=this._parent.globalIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types,this.subtypeField=this._parent.subtypeField,this.subtypes=this._parent.subtypes):(this.fields=[],this.typeIdField="",this.subtypeField="",this.objectIdField="",this.globalIdField="",this.spatialReference=new h.A({wkid:4326}),this.geometryType=l.ik.point)}getField(e,t){let r;return(t=t||this.fields)&&(e=e.toLowerCase(),t.some((t=>(t&&t.name.toLowerCase()===e&&(r=t),!!r)))),r}getFieldsIndex(){return null===this._fieldsIndex&&(this._fieldsIndex=f.A.fromLayer({timeInfo:this.timeInfo,editFieldsInfo:this.editFieldsInfo,dateFieldsTimeZone:this.dateFieldsTimeZone,datesInUnknownTimezone:this.datesInUnknownTimezone,fields:this.fields})),this._fieldsIndex}_maxProcessingRate(){return null!==this._parent?Math.min(this._maxProcessing,this._parent._maxProcessingRate()):Math.min(this._maxProcessing,this._maxQueryRate())}_maxQueryRate(){return null!==this._parent?Math.max(this._maxQuery,this._parent._maxQueryRate()):this._maxQuery}_checkCancelled(e){if(null!=e&&e.aborted)throw new i.dr(i.D_.Cancelled)}nativeCapabilities(){return this._parent.nativeCapabilities()}async _canDoAggregates(e,t,r,n,i){return null!==this._parent&&this._parent._canDoAggregates(e,t,r,n,i)}async _getAggregatePagesDataSourceDefinition(e,t,r,n,s,o,a){if(null===this._parent)throw new i.dr(i.D_.NeverReach);return this._parent._getAggregatePagesDataSourceDefinition(e,t,r,n,s,o,a)}async _getAgregagtePhysicalPage(e,t,r){if(null===this._parent)throw new i.dr(i.D_.NeverReach);return this._parent._getAgregagtePhysicalPage(e,t,r)}async databaseType(){if(this._databaseType===l.zl.NotEvaluated){if(null!==n.A.applicationCache){const e=n.A.applicationCache.getDatabaseType(this._cacheableFeatureSetSourceKey());if(null!==e)return e}if(null!==this._databaseTypeProbed)return this._databaseTypeProbed;try{this._databaseTypeProbed=this._getDatabaseTypeImpl(),null!==n.A.applicationCache&&n.A.applicationCache.setDatabaseType(this._cacheableFeatureSetSourceKey(),this._databaseTypeProbed)}catch(e){throw null!==n.A.applicationCache&&n.A.applicationCache.clearDatabaseType(this._cacheableFeatureSetSourceKey()),e}return this._databaseTypeProbed}return this._databaseType}async _getDatabaseTypeImpl(){const e=[{thetype:l.zl.SqlServer,testwhere:"(CAST( '2015-01-01' as DATETIME) = CAST( '2015-01-01' as DATETIME)) AND OBJECTID<0"},{thetype:l.zl.Oracle,testwhere:"(TO_DATE('2003-11-18','YYYY-MM-DD') = TO_DATE('2003-11-18','YYYY-MM-DD')) AND OBJECTID<0"},{thetype:l.zl.StandardisedNoInterval,testwhere:"(date '2015-01-01 10:10:10' = date '2015-01-01 10:10:10') AND OBJECTID<0"}];for(const t of e)if(!0===await this._runDatabaseProbe(t.testwhere))return t.thetype;return l.zl.StandardisedNoInterval}_cacheableFeatureSetSourceKey(){return"MUSTBESET"}async _runDatabaseProbe(e){if(null!==this._parent)return this._parent._runDatabaseProbe(e);throw new i.dr(i.D_.NotImplemented)}isTable(){return this._parent?.isTable()??!1}_featureFromCache(e){if(void 0!==this._featureCache[e])return this._featureCache[e]}_isInFeatureSet(e){return l.J6.Unknown}_getSet(e){throw new i.dr(i.D_.NotImplemented)}async _getFeature(e,t,r){if(this._checkCancelled(r),void 0!==this._featureFromCache(t))return this._featureFromCache(t);if(await this._getFeatures(e,t,this._maxProcessingRate(),r),this._checkCancelled(r),void 0!==this._featureFromCache(t))return this._featureFromCache(t);throw new i.dr(i.D_.MissingFeatures)}async _getFeatureBatch(e,t){this._checkCancelled(t);const r=new a.A([],e,!1,null),n=[];await this._getFeatures(r,-1,e.length,t),this._checkCancelled(t);for(const t of e)void 0!==this._featureFromCache(t)&&n.push(this._featureFromCache(t));return n}async _getFeatures(e,t,r,n){return"success"}_getFilteredSet(e,t,r,n,s){throw new i.dr(i.D_.NotImplemented)}async _refineSetBlock(e,t,r){if(!0===this._checkIfNeedToExpandCandidatePage(e,this._maxQueryRate()))return await this._expandPagedSet(e,this._maxQueryRate(),0,0,r),this._refineSetBlock(e,t,r);this._checkCancelled(r);const n=e._candidates.length;this._refineKnowns(e,t);let i=n-e._candidates.length;if(0===e._candidates.length)return e;if(i>=t)return e;if(await this._refineIfParentKnown(e,t-i,r),this._checkCancelled(r),this._refineKnowns(e,t-i),i=n-e._candidates.length,i<t&&e._candidates.length>0){const n=t-i,s=this._prepareFetchAndRefineSet(e._candidates);return await this._fetchAndRefineFeatures(s,s.length>n?n:e._candidates.length,r),this._checkCancelled(r),this._refineKnowns(e,t-i),e}return e}_fetchAndRefineFeatures(e,t,r){return null}_prepareFetchAndRefineSet(e){const t=[];for(let r=0;r<e.length;r++)this._isPhysicalFeature(e[r])&&t.push(e[r]);return t}_isPhysicalFeature(e){return null===this._parent||this._parent._isPhysicalFeature(e)}_refineKnowns(e,t){let r=0,n=null;const i=[];t=this._maxQueryRate();for(let s=0;s<e._candidates.length&&"GETPAGES"!==e._candidates[s];s++){let o=!1;const a=this._candidateIdTransform(e._candidates[s]);a!==e._candidates[s]&&(o=!0);const u=this._isInFeatureSet(a);if(u===l.J6.InFeatureSet)!0===o?e._known.includes(a)||(e._known.push(a),r+=1):(e._known.push(e._candidates[s]),r+=1),null===n?n={start:s,end:s}:n.end===s-1?n.end=s:(i.push(n),n={start:s,end:s});else if(u===l.J6.NotInFeatureSet)null===n?n={start:s,end:s}:n.end===s-1?n.end=s:(i.push(n),n={start:s,end:s}),r+=1;else if(u===l.J6.Unknown&&(r+=1,!0===e._ordered))break;if(r>=t)break}null!==n&&i.push(n);for(let t=i.length-1;t>=0;t--)e._candidates.splice(i[t].start,i[t].end-i[t].start+1)}_refineIfParentKnown(e,t,r){const n=new a.A([],[],e._ordered,null);return n._candidates=e._candidates.slice(),this._parent._refineSetBlock(n,t,r)}_candidateIdTransform(e){return this._parent._candidateIdTransform(e)}_checkIfNeedToExpandKnownPage(e,t){if(null===e.pagesDefinition)return!1;let r=0;for(let n=e._lastFetchedIndex;n<e._known.length;n++){if("GETPAGES"===e._known[n])return!0;if(void 0===this._featureCache[e._known[n]]&&(r+=1,r>=t))break}return!1}_checkIfNeedToExpandCandidatePage(e,t){if(null===e.pagesDefinition)return!1;let r=0;for(let n=0;n<e._candidates.length;n++){if("GETPAGES"===e._candidates[n])return!0;if(r+=1,r>=t)break}return!1}async _expandPagedSet(e,t,r,n,s){if(null===this._parent)throw new i.dr(i.D_.NotImplemented);return this._parent._expandPagedSet(e,t,r,n,s)}async _expandPagedSetFeatureSet(e,t,r,n,i){if(e._known.length>0&&"GETPAGES"===e._known[e._known.length-1]&&(n=1),0===n&&e._candidates.length>0&&"GETPAGES"===e._candidates[e._candidates.length-1]&&(n=2),0===n)return"finished";const s=await this._getPage(e,n,i);return r+s<t?this._expandPagedSet(e,t,r+s,0,i):"success"}async _getPage(e,t,r){const n=1===t?e._known:e._candidates;if(e.pagesDefinition.internal.set.length>e.pagesDefinition.resultOffset||!0===e.pagesDefinition.internal.fullyResolved){n.length=n.length-1;let t=0;for(let r=0;r<e.pagesDefinition.resultRecordCount&&!(e.pagesDefinition.resultOffset+r>=e.pagesDefinition.internal.set.length);r++)n[n.length]=e.pagesDefinition.internal.set[e.pagesDefinition.resultOffset+r],t++;e.pagesDefinition.resultOffset+=t;let r=!1;return!0===e.pagesDefinition.internal.fullyResolved&&e.pagesDefinition.internal.set.length<=e.pagesDefinition.resultOffset&&(r=!0),!1===r&&n.push("GETPAGES"),t}return await this._getPhysicalPage(e,t,r),this._getPage(e,t,r)}_getPhysicalPage(e,t,r){return null}_clonePageDefinition(e){return null===this._parent?null:this._parent._clonePageDefinition(e)}_first(e){return this.iterator(e).next()}first(e){return this._first(e)}async calculateStatistic(e,t,r,n){await this._ensureLoaded();let i=await this._stat(e,t,"",null,null,r,n);return!1===i.calculated&&(i=await this._manualStat(e,t,r,n)),i.result}async _manualStat(e,t,r,n){let i=null;switch(e.toLowerCase()){case"count":return i=await(0,u.U9)(this,n),{calculated:!0,result:i};case"distinct":return i=await(0,u.dM)(this,t,r,n),{calculated:!0,result:i};case"avg":case"mean":return i=await(0,u.i2)(this,t,n),{calculated:!0,result:i};case"stdev":return i=await(0,u.b$)(this,t,n),{calculated:!0,result:i};case"variance":return i=await(0,u.GV)(this,t,n),{calculated:!0,result:i};case"sum":return i=await(0,u.cz)(this,t,n),{calculated:!0,result:i};case"min":return i=await(0,u.jk)(this,t,n),{calculated:!0,result:i};case"max":return i=await(0,u.T9)(this,t,n),{calculated:!0,result:i};default:return{calculated:!0,result:0}}}async _stat(e,t,r,n,i,s,o){const a=await this._parent._stat(e,t,r,n,i,s,o);return!1===a.calculated?null===i&&""===r&&null===n?this._manualStat(e,t,s,o):{calculated:!1}:a}_unionAllGeomSelf(e){const t=this.iterator(this._defaultTracker(e)),r=[];return new Promise(((e,n)=>{this._unionShapeInBatches(r,t,e,n)}))}_unionAllGeom(e){return new Promise(((t,r)=>{const n=this.iterator(this._defaultTracker(e));this._unionShapeInBatches([],n,t,r)}))}_unionShapeInBatches(e,t,r,n){t.next().then((i=>{try{null!==i&&null!==i.geometry&&e.push(i.geometry),e.length>30||null===i&&e.length>1?(0,d.union)(e).then((s=>{try{null===i?r(s):(e=[s],this._unionShapeInBatches(e,t,r,n))}catch(e){n(e)}}),n):null===i?1===e.length?r(e[0]):r(null):this._unionShapeInBatches(e,t,r,n)}catch(e){n(e)}}),n)}iterator(e){return new o(this,e)}intersection(e,t=!1){return y._featuresetFunctions.intersection.bind(this)(e,t)}difference(e,t=!1,r=!0){return y._featuresetFunctions.difference.bind(this)(e,t,r)}symmetricDifference(e,t=!1,r=!0){return y._featuresetFunctions.symmetricDifference.bind(this)(e,t,r)}morphShape(e,t,r="unknown",n=null){return y._featuresetFunctions.morphShape.bind(this)(e,t,r,n)}morphShapeAndAttributes(e,t,r="unknown"){return y._featuresetFunctions.morphShapeAndAttributes.bind(this)(e,t,r)}union(e,t=!1){return y._featuresetFunctions.union.bind(this)(e,t)}intersects(e){return y._featuresetFunctions.intersects.bind(this)(e)}envelopeIntersects(e){return y._featuresetFunctions.envelopeIntersects.bind(this)(e)}contains(e){return y._featuresetFunctions.contains.bind(this)(e)}overlaps(e){return y._featuresetFunctions.overlaps.bind(this)(e)}relate(e,t){return y._featuresetFunctions.relate.bind(this)(e,t)}within(e){return y._featuresetFunctions.within.bind(this)(e)}touches(e){return y._featuresetFunctions.touches.bind(this)(e)}top(e){return y._featuresetFunctions.top.bind(this)(e)}crosses(e){return y._featuresetFunctions.crosses.bind(this)(e)}buffer(e,t,r,n=!0){return y._featuresetFunctions.buffer.bind(this)(e,t,r,n)}filter(e,t=null){return y._featuresetFunctions.filter.bind(this)(e,t)}orderBy(e){return y._featuresetFunctions.orderBy.bind(this)(e)}dissolve(e,t){return y._featuresetFunctions.dissolve.bind(this)(e,t)}groupby(e,t){return y._featuresetFunctions.groupby.bind(this)(e,t)}reduce(e,t=null,r){return new Promise(((n,i)=>{this._reduceImpl(this.iterator(this._defaultTracker(r)),e,t,0,n,i,0)}))}_reduceImpl(e,t,r,n,i,s,o){try{if(++o>1e3)return void setTimeout((()=>{o=0,this._reduceImpl(e,t,r,n,i,s,o)}));e.next().then((a=>{try{if(null===a)i(r);else{const l=t(r,a,n,this);(0,c.$X)(l)?l.then((r=>{this._reduceImpl(e,t,r,n+1,i,s,o)}),s):this._reduceImpl(e,t,l,n+1,i,s,o)}}catch(e){s(e)}}),s)}catch(e){s(e)}}removeField(e){return y._featuresetFunctions.removeField.bind(this)(e)}addField(e,t,r=null){return y._featuresetFunctions.addField.bind(this)(e,t,r)}sumArea(e,t=!1,r){const n=(0,l.uf)(e);return this.reduce(((e,r)=>null===r.geometry?0:t?(0,d.geodesicArea)(r.geometry,n).then((t=>e+t)):(0,d.planarArea)(r.geometry,n).then((t=>e+t))),0,r)}sumLength(e,t=!1,r){const n=(0,l.SQ)(e);return this.reduce(((e,r)=>null===r.geometry?0:t?(0,d.geodesicLength)(r.geometry,n).then((t=>e+t)):(0,d.planarLength)(r.geometry,n).then((t=>e+t))),0,r)}async distinct(e,t=1e3,r=null,n){await this.load();const i=p.WhereClause.create(e,{fieldsIndex:this.getFieldsIndex(),timeZone:this.dateFieldsTimeZoneDefaultUTC});return m(i,r),this.calculateStatistic("distinct",i,t,this._defaultTracker(n))}async min(e,t=null,r){await this.load();const n=p.WhereClause.create(e,{fieldsIndex:this.getFieldsIndex(),timeZone:this.dateFieldsTimeZoneDefaultUTC});return m(n,t),this.calculateStatistic("min",n,-1,this._defaultTracker(r))}async max(e,t=null,r){await this.load();const n=p.WhereClause.create(e,{fieldsIndex:this.getFieldsIndex(),timeZone:this.dateFieldsTimeZoneDefaultUTC});return m(n,t),this.calculateStatistic("max",n,-1,this._defaultTracker(r))}async avg(e,t=null,r){await this.load();const n=p.WhereClause.create(e,{fieldsIndex:this.getFieldsIndex(),timeZone:this.dateFieldsTimeZoneDefaultUTC});return m(n,t),this.calculateStatistic("avg",n,-1,this._defaultTracker(r))}async sum(e,t=null,r){await this.load();const n=p.WhereClause.create(e,{fieldsIndex:this.getFieldsIndex(),timeZone:this.dateFieldsTimeZoneDefaultUTC});return m(n,t),this.calculateStatistic("sum",n,-1,this._defaultTracker(r))}async stdev(e,t=null,r){await this.load();const n=p.WhereClause.create(e,{fieldsIndex:this.getFieldsIndex(),timeZone:this.dateFieldsTimeZoneDefaultUTC});return m(n,t),this.calculateStatistic("stdev",n,-1,this._defaultTracker(r))}async variance(e,t=null,r){await this.load();const n=p.WhereClause.create(e,{fieldsIndex:this.getFieldsIndex(),timeZone:this.dateFieldsTimeZoneDefaultUTC});return m(n,t),this.calculateStatistic("variance",n,-1,this._defaultTracker(r))}async count(e){return await this.load(),this.calculateStatistic("count",p.WhereClause.create("1",{fieldsIndex:this.getFieldsIndex(),timeZone:this.dateFieldsTimeZoneDefaultUTC}),-1,this._defaultTracker(e))}_defaultTracker(e){return e??{aborted:!1}}forEach(e,t){return new Promise(((r,n)=>{this._forEachImpl(this.iterator(this._defaultTracker(t)),e,this,r,n,0)}))}_forEachImpl(e,t,r,n,i,s){try{if(++s>1e3)return void setTimeout((()=>{s=0,this._forEachImpl(e,t,r,n,i,s)}),0);e.next().then((o=>{try{if(null===o)n(r);else{const a=t(o);null==a?this._forEachImpl(e,t,r,n,i,s):(0,c.$X)(a)?a.then((()=>{try{this._forEachImpl(e,t,r,n,i,s)}catch(e){i(e)}}),i):this._forEachImpl(e,t,r,n,i,s)}}catch(e){i(e)}}),i)}catch(e){i(e)}}convertToJSON(e){const t={layerDefinition:{geometryType:this.geometryType,fields:[]},featureSet:{features:[],geometryType:this.geometryType}};for(let e=0;e<this.fields.length;e++)t.layerDefinition.fields.push((0,l.nE)(this.fields[e]));return this.reduce(((e,r)=>{const n={geometry:r.geometry?.toJSON(),attributes:{}};for(const e in r.attributes)n.attributes[e]=r.attributes[e];return t.featureSet.features.push(n),1}),0,e).then((()=>t))}castToText(e=!1){return"object, FeatureSet"}queryAttachments(e,t,r,n,i){return this._parent.queryAttachments(e,t,r,n,i)}serviceUrl(){return this._parent.serviceUrl()}subtypeMetaData(){return this.subtypeField&&this.subtypes?{subtypeField:this.subtypeField,subtypes:this.subtypes?this.subtypes.map((e=>({name:e.name,code:e.code}))):[]}:this.typeIdField?{subtypeField:this.typeIdField,subtypes:this.types?this.types.map((e=>({name:e.name,code:e.id}))):[]}:null}relationshipMetaData(){return this._parent.relationshipMetaData()}get gdbVersion(){return this._parent?this._parent.gdbVersion:""}schema(){const e=[];for(const t of this.fields)e.push((0,l.nE)(t));return{objectIdField:this.objectIdField,globalIdField:this.globalIdField,geometryType:void 0===l.yT[this.geometryType]?"esriGeometryNull":l.yT[this.geometryType],fields:e}}async convertToText(e,t){if("schema"===e)return await this._ensureLoaded(),JSON.stringify(this.schema());if("featureset"===e){await this._ensureLoaded();const e=[];await this.reduce(((t,r)=>{const n={geometry:r.geometry?r.geometry.toJSON():null,attributes:r.attributes};return null!==n.geometry&&n.geometry.spatialReference&&delete n.geometry.spatialReference,e.push(n),1}),0,t);const r=this.schema();return r.features=e,r.spatialReference=this.spatialReference.toJSON(),JSON.stringify(r)}return this.castToText()}getFeatureByObjectId(e,t){return this._parent.getFeatureByObjectId(e,t)}getOwningSystemUrl(){return this._parent.getOwningSystemUrl()}getIdentityUser(){return this._parent.getIdentityUser()}getRootFeatureSet(){return null!==this._parent?this._parent.getRootFeatureSet():this}getDataSourceFeatureSet(){return null!==this._parent?this._parent.getDataSourceFeatureSet():this}castAsJson(e=null){return"keeptype"===e?.featureset?this:"none"===e?.featureset?null:{type:"FeatureSet"}}async castAsJsonAsync(e=null,t=null){if("keeptype"===t?.featureset)return this;if("schema"===t?.featureset)return await this._ensureLoaded(),JSON.parse(JSON.stringify(this.schema()));if("none"===t?.featureset)return null;await this._ensureLoaded();const r=[];await this.reduce(((e,n)=>{const i={geometry:n.geometry?!0===t?.keepGeometryType?n.geometry:n.geometry.toJSON():null,attributes:n.attributes};return null!==i.geometry&&i.geometry.spatialReference&&!0!==t?.keepGeometryType&&delete i.geometry.spatialReference,r.push(i),1}),0,e);const n=this.schema();return n.features=r,n.spatialReference=!0===t?.keepGeometryType?this.spatialReference:this.spatialReference?.toJSON(),n}fieldTimeZone(e){return this.getFieldsIndex().getTimeZone(e)}get preferredTimeZone(){return this._parent?.preferredTimeZone??null}get dateFieldsTimeZone(){return this._parent?.dateFieldsTimeZone??null}get dateFieldsTimeZoneDefaultUTC(){if(this.datesInUnknownTimezone)return"unknown";const e=this.dateFieldsTimeZone??"UTC";return""===e?"UTC":e}get datesInUnknownTimezone(){return this._parent.datesInUnknownTimezone}get editFieldsInfo(){return this._parent?.editFieldsInfo??null}get timeInfo(){return this._parent?.timeInfo??null}set featureSetInfo(e){this.fsetInfo=e}async getFeatureSetInfo(){return this.fsetInfo??await(this._parent?.getFeatureSetInfo())??null}}function m(e,t){if(null!==t){const r={};for(const e in t)r[e.toLowerCase()]=t[e];e.parameters=r}}y._featuresetFunctions={}},63394:function(e,t,r){r.d(t,{A:function(){return n}});class n{constructor(e,t,r,n){this._lastFetchedIndex=0,this._ordered=!1,this.pagesDefinition=null,this._candidates=e,this._known=t,this._ordered=r,this.pagesDefinition=n}}},54797:function(e,t,r){function n(e,t){return e===t?0:null===e?-1:null===t?1:e<t?-1:1}r.d(t,{A:function(){return i}});class i{constructor(e){const t=e.split(",");this._fields=[],this._directions=[];for(let e=0;e<t.length;e++){const r=t[e].match(/\S+/g);this._fields.push(r[0]),2===r.length?"asc"===r[1].toLowerCase()?this._directions.push(1):this._directions.push(0):this._directions.push(1)}}constructClause(){let e="";for(let t=0;t<this._fields.length;t++)0!==t&&(e+=","),e+=this._fields[t],1===this._directions[t]?e+=" ASC":e+=" DESC";return e}order(e){e.sort(((e,t)=>{for(let r=0;r<this._fields.length;r++){const i=this.featureValue(e.feature,this._fields[r],r),s=this.featureValue(t.feature,this._fields[r],r);let o=0;if(o=1===this._directions[r]?n(i,s):-1*n(i,s),0!==o)return o}return 0}))}scanForField(e){for(let t=0;t<this._fields.length;t++)if(this._fields[t].toLowerCase().trim()===e.toLowerCase().trim())return!0;return!1}replaceFields(e){let t="";for(let r=0;r<this._fields.length;r++){0!==r&&(t+=",");let n=this._fields[r];for(const t of e)if(n.toLowerCase()===t.field.toLowerCase()){n=t.newfield;break}t+=n,1===this._directions[r]?t+=" ASC":t+=" DESC"}return new i(t)}featureValue(e,t,r){const n=e.attributes[t];if(void 0!==n)return n;for(const n in e.attributes)if(t.toLowerCase()===n.toLowerCase())return this._fields[r]=n,e.attributes[n];return null}}},65883:function(e,t,r){r.d(t,{A:function(){return n}});class n{constructor(){this._databaseTypeMetaData={},this._layerInfo={}}clearDatabaseType(e){void 0===this._databaseTypeMetaData[e]&&delete this._databaseTypeMetaData[e]}getDatabaseType(e){return"MUSTBESET"===e||void 0===this._databaseTypeMetaData[e]?null:this._databaseTypeMetaData[e]}setDatabaseType(e,t){this._databaseTypeMetaData[e]=t}getLayerInfo(e){return void 0===this._layerInfo[e]?null:this._layerInfo[e]}setLayerInfo(e,t){this._layerInfo[e]=t}clearLayerInfo(e){void 0!==this._layerInfo[e]&&delete this._layerInfo[e]}}n.applicationCache=null},3724:function(e,t,r){r.d(t,{D_:function(){return n},dr:function(){return a}});var n,i,s=r(50944);(i=n||(n={})).NeverReach="NeverReach",i.NotImplemented="NotImplemented",i.Cancelled="Cancelled",i.InvalidStatResponse="InvalidStatResponse",i.InvalidRequest="InvalidRequest",i.RequestFailed="RequestFailed",i.MissingFeatures="MissingFeatures",i.AggregationFieldNotFound="AggregationFieldNotFound",i.DataElementsNotFound="DataElementsNotFound";const o={[n.Cancelled]:"Cancelled",[n.InvalidStatResponse]:"Invalid statistics response from service",[n.InvalidRequest]:"Invalid request",[n.RequestFailed]:"Request failed - {reason}",[n.MissingFeatures]:"Missing features",[n.AggregationFieldNotFound]:"Aggregation field not found",[n.DataElementsNotFound]:"Data elements not found on service",[n.NeverReach]:"Encountered unreachable logic",[n.NotImplemented]:"Not implemented"};class a extends Error{constructor(e,t){super((0,s.HC)(o[e],t)),this.declaredRootClass="esri.arcade.featureset.support.featureseterror",Error.captureStackTrace&&Error.captureStackTrace(this,a)}}},88396:function(e,t,r){r.d(t,{C6:function(){return v},DA:function(){return F},F1:function(){return w},F6:function(){return y},IY:function(){return b},Ju:function(){return x},Kb:function(){return h},Mi:function(){return c},Nf:function(){return g},R8:function(){return m},YY:function(){return u},bD:function(){return p},bm:function(){return _},kg:function(){return d},oj:function(){return C}});var n=r(9688),i=r(62032),s=r(93393),o=r(70891),a=r(16177),l=r(96285);function u(e,t){return f(e?.parseTree,t,e?.parameters)}function c(e,t,r){return f(e,t,r)}function p(e,t,r,n){const s=f(e.parseTree,i.zl.Standardised,e.parameters,t,r);return a.WhereClause.create(s,{fieldsIndex:n,timeZone:e.timeZone,currentUser:e.currentUser})}function d(e,t,r="AND"){return a.WhereClause.create("(("+u(e,i.zl.Standardised)+")"+r+"("+u(t,i.zl.Standardised)+"))",{fieldsIndex:e.fieldsIndex,timeZone:e.timeZone,currentUser:e.currentUser})}function h(e){return!0===e.delimited?`"${e.column.split('"').join('""')}"`:e.column}function f(e,t,r,n=null,o=null){let a,l,u,c;switch(e.type){case"interval":return C(f(e.value,t,r,n,o),e.qualifier,e.op);case"case-expression":{let i=" CASE ";"simple"===e.format&&(i+=f(e.operand,t,r,n,o));for(let s=0;s<e.clauses.length;s++)i+=" WHEN "+f(e.clauses[s].operand,t,r,n,o)+" THEN "+f(e.clauses[s].value,t,r,n,o);return null!==e.else&&(i+=" ELSE "+f(e.else,t,r,n,o)),i+=" END ",i}case"parameter":{const n=r[e.value.toLowerCase()];if("string"==typeof n)return"'"+r[e.value.toLowerCase()].toString().replaceAll("'","''")+"'";if((0,i.$P)(n))return _(n,t);if((0,i.Lk)(n))return _(n,t);if((0,i.eg)(n))return w(n,t);if((0,i.rX)(n))return m(n,t);if((0,i.f0)(n))return g(n,t);if(Array.isArray(n)){const e=[];for(let r=0;r<n.length;r++)"string"==typeof n[r]?e.push("'"+n[r].toString().replaceAll("'","''")+"'"):(0,i.$P)(n[r])||(0,i.Lk)(n[r])?e.push(_(n[r],t)):(0,i.eg)(n[r])?e.push(w(n[r],t)):(0,i.rX)(n[r])?e.push(m(n[r],t)):(0,i.f0)(n[r])?e.push(g(n[r],t)):e.push(n[r].toString());return e}return n.toString()}case"expression-list":l=[];for(const i of e.value)l.push(f(i,t,r,n,o));return l;case"unary-expression":return" ( NOT "+f(e.expr,t,r,n,o)+" ) ";case"binary-expression":switch(e.operator){case"AND":return" ("+f(e.left,t,r,n,o)+" AND "+f(e.right,t,r,n,o)+") ";case"OR":return" ("+f(e.left,t,r,n,o)+" OR "+f(e.right,t,r,n,o)+") ";case"IS":if("null"!==e.right.type)throw new s.L8(s.Z7.UnsupportedIsRhs);return" ("+f(e.left,t,r,n,o)+" IS NULL )";case"ISNOT":if("null"!==e.right.type)throw new s.L8(s.Z7.UnsupportedIsRhs);return" ("+f(e.left,t,r,n,o)+" IS NOT NULL )";case"IN":return a=[],"expression-list"===e.right.type?(a=f(e.right,t,r,n,o)," ("+f(e.left,t,r,n,o)+" IN ("+a.join(",")+")) "):(c=f(e.right,t,r,n,o),Array.isArray(c)?" ("+f(e.left,t,r,n,o)+" IN ("+c.join(",")+")) ":" ("+f(e.left,t,r,n,o)+" IN ("+c+")) ");case"NOT IN":return a=[],"expression-list"===e.right.type?(a=f(e.right,t,r,n,o)," ("+f(e.left,t,r,n,o)+" NOT IN ("+a.join(",")+")) "):(c=f(e.right,t,r,n,o),Array.isArray(c)?" ("+f(e.left,t,r,n,o)+" NOT IN ("+c.join(",")+")) ":" ("+f(e.left,t,r,n,o)+" NOT IN ("+c+")) ");case"BETWEEN":return u=f(e.right,t,r,n,o)," ("+f(e.left,t,r,n,o)+" BETWEEN "+u[0]+" AND "+u[1]+" ) ";case"NOTBETWEEN":return u=f(e.right,t,r,n,o)," ("+f(e.left,t,r,n,o)+" NOT BETWEEN "+u[0]+" AND "+u[1]+" ) ";case"LIKE":return""!==e.escape?" ("+f(e.left,t,r,n,o)+" LIKE "+f(e.right,t,r,n,o)+" ESCAPE '"+e.escape+"') ":" ("+f(e.left,t,r,n,o)+" LIKE "+f(e.right,t,r,n,o)+") ";case"NOT LIKE":return""!==e.escape?" ("+f(e.left,t,r,n,o)+" NOT LIKE "+f(e.right,t,r,n,o)+" ESCAPE '"+e.escape+"') ":" ("+f(e.left,t,r,n,o)+" NOT LIKE "+f(e.right,t,r,n,o)+") ";case"<>":case"<":case">":case">=":case"<=":case"=":case"*":case"-":case"+":case"/":return" ("+f(e.left,t,r,n,o)+" "+e.operator+" "+f(e.right,t,r,n,o)+") ";case"||":return" ("+f(e.left,t,r,n,o)+" "+(t===i.zl.SqlServer?"+":e.operator)+" "+f(e.right,t,r,n,o)+") "}throw new s.L8(s.Z7.UnsupportedOperator,{operator:e.operator});case"null":return"null";case"boolean":return!0===e.value?"1":"0";case"string":return"'"+e.value.toString().replaceAll("'","''")+"'";case"timestamp":return`timestamp '${e.value}'`;case"date":return`date '${e.value}'`;case"time":return`time '${e.value}'`;case"number":return e.value.toString();case"current-time":return v(e.mode,t);case"current-user":return"CURRENT_USER";case"column-reference":return n&&n.toLowerCase()===e.column.toLowerCase()?"("+o+")":h(e);case"data-type":return e.value;case"function":{const i=f(e.args,t,r,n,o);return y(e.name,i,t)}}throw new s.L8(s.Z7.UnsupportedSyntax,{node:e.type})}function y(e,t,r){switch(e.toLowerCase().trim()){case"cos":case"sin":case"tan":case"cosh":case"tanh":case"sinh":case"acos":case"asin":case"atan":case"floor":case"log10":case"log":case"abs":if(1!==t.length)throw new s.L8(s.Z7.InvalidFunctionParameters,{function:e.toLowerCase().trim()});return`${e.toUpperCase().trim()}(${t[0]})`;case"ceiling":case"ceil":if(1!==t.length)throw new s.L8(s.Z7.InvalidFunctionParameters,{function:"ceiling"});switch(r){case i.zl.Standardised:case i.zl.StandardisedNoInterval:}return"CEILING("+t[0]+")";case"mod":case"power":case"nullif":if(2!==t.length)throw new s.L8(s.Z7.InvalidFunctionParameters,{function:e.toLowerCase().trim()});return`${e.toUpperCase().trim()}(${t[0]},${t[1]})`;case"round":if(2===t.length)return"ROUND("+t[0]+","+t[1]+")";if(1===t.length)return"ROUND("+t[0]+")";throw new s.L8(s.Z7.InvalidFunctionParameters,{function:"round"});case"truncate":if(t.length<1||t.length>2)throw new s.L8(s.Z7.InvalidFunctionParameters,{function:"truncate"});return r===i.zl.SqlServer?"ROUND("+t[0]+(1===t.length?"0":","+t[1])+",1)":"TRUNCATE("+t[0]+(1===t.length?")":","+t[1]+")");case"char_length":case"len":if(1!==t.length)throw new s.L8(s.Z7.InvalidFunctionParameters,{function:"char_length"});switch(r){case i.zl.SqlServer:return"LEN("+t[0]+")";case i.zl.Oracle:return"LENGTH("+t[0]+")";default:return"CHAR_LENGTH("+t[0]+")"}case"coalesce":case"concat":{if(t.length<1)throw new s.L8(s.Z7.InvalidFunctionParameters,{function:e.toLowerCase()});let r=e.toUpperCase().trim()+"(";for(let e=0;e<t.length;e++)0!==e&&(r+=","),r+=t[e];return r+=")",r}case"lower":case"lcase":if(1!==t.length)throw new s.L8(s.Z7.InvalidFunctionParameters,{function:"lower"});return"LOWER("+t[0]+")";case"upper":case"ucase":if(1!==t.length)throw new s.L8(s.Z7.InvalidFunctionParameters,{function:"upper"});return"UPPER("+t[0]+")";case"substring":{let e="";switch(r){case i.zl.Oracle:return e="SUBSTR("+t[0]+","+t[1],3===t.length&&(e+=","+t[2]),e+=")",e;case i.zl.SqlServer:return e=3===t.length?"SUBSTRING("+t[0]+","+t[1]+","+t[2]+")":"SUBSTRING("+t[0]+",  "+t[1]+", LEN("+t[0]+") - "+t[1]+")",e;default:return e="SUBSTRING("+t[0]+" FROM "+t[1],3===t.length&&(e+=" FOR "+t[2]),e+=")",e}}case"extract":return"EXTRACT("+t[0].replaceAll("'","")+" FROM "+t[1]+")";case"cast":{let e="";switch(r){case i.zl.Oracle:switch(t[1].type){case"date":e="DATE";break;case"float":e="DOUBLE";break;case"integer":e="INTEGER";break;case"real":e="REAL";break;case"smallint":e="SMALLINT";break;case"timestamp":e="TIMESTAMP";break;case"varchar":e="VARCHAR("+t[1].size.toString()+")"}return`CAST(${t[0]} AS ${e})`;case i.zl.Postgres:switch(t[1].type){case"date":e="DATE";break;case"float":e="DOUBLE PRECISION";break;case"integer":e="INT";break;case"real":e="REAL";break;case"smallint":e="SMALLINT";break;case"timestamp":e="TIMESTAMP";break;case"varchar":e="VARCHAR("+t[1].size.toString()+")"}return`CAST(${t[0]} AS ${e})`;case i.zl.SqlServer:switch(t[1].type){case"date":e="DATE";break;case"float":e="FLOAT";break;case"integer":e="INT";break;case"real":e="REAL";break;case"smallint":e="SMALLINT";break;case"timestamp":e="DATETIME";break;case"varchar":e="VARCHAR("+t[1].size.toString()+")"}return`CAST(${t[0]} AS ${e})`;default:switch(t[1].type){case"date":e="DATE";break;case"float":e="FLOAT";break;case"integer":e="INTEGER";break;case"real":e="REAL";break;case"smallint":e="SMALLINT";break;case"timestamp":e="TIMESTAMP";break;case"varchar":e="VARCHAR("+t[1].size.toString()+")"}return`CAST(${t[0]} AS ${e})`}}}throw new s.L8(s.Z7.InvalidFunctionParameters,{function:e})}function m(e,t){const r=e.toDateTime(),n=0===r.hour&&0===r.minute&&0===r.second&&0===r.millisecond;switch(t){case i.zl.FILEGDB:case i.zl.Standardised:case i.zl.StandardisedNoInterval:return n?`date '${r.toFormat("yyyy-LL-dd")}'`:`timestamp '${r.toFormat("yyyy-LL-dd HH:mm:ss")}'`;case i.zl.Oracle:return n?`TO_DATE('${r.toFormat("yyyy-LL-dd")}','YYYY-MM-DD')`:`TO_DATE('${r.toFormat("yyyy-LL-dd HH:mm:ss")}','YYYY-MM-DD HH24:MI:SS')`;case i.zl.SqlServer:return`'${r.toFormat(n?"yyyy-LL-dd":"yyyy-LL-dd HH:mm:ss")}'`;case i.zl.PGDB:return`#${r.toFormat(n?"LL-dd-yyyy":"LL-dd-yyyy HH:mm:ss")}#`;case i.zl.Postgres:return`TIMESTAMP '${r.toFormat(n?"yyyy-LL-dd":"yyyy-LL-dd HH:mm:ss")}'`;default:return`timestamp '${r.toFormat("yyyy-LL-dd HH:mm:ss")}'`}}function g(e,t){switch(t){case i.zl.FILEGDB:case i.zl.Standardised:case i.zl.StandardisedNoInterval:return e.toSQLWithKeyword();case i.zl.Oracle:return`TO_DATE('${e.toFormat("Y-MM-DD")}'`;case i.zl.SqlServer:return`'${e.toFormat("Y-MM-DD")}'`;case i.zl.PGDB:return`#${e.toFormat("Y-MM-DD")}#`;case i.zl.Postgres:return`TIMESTAMP '${e.toFormat("Y-MM-DD")}'`;default:return e.toSQLWithKeyword()}}function w(e,t){switch(e instanceof o.k&&(e=e.toStorageString()),t){case i.zl.Oracle:return`TO_DATE('${e}', 'HH24:MI:SS')`;case i.zl.SqlServer:return`'${e}'`;case i.zl.FILEGDB:case i.zl.Standardised:case i.zl.StandardisedNoInterval:case i.zl.Postgres:default:return`time '${e}'`}}function _(e,t){return m(n.lY.dateTimeToArcadeDate((0,i.Lk)(e)?e:l.c9.fromJSDate(e)),t)}function v(e,t){switch(t){case i.zl.FILEGDB:case i.zl.Standardised:case i.zl.StandardisedNoInterval:case i.zl.Oracle:case i.zl.PGDB:default:return"date"===e?"CURRENT_DATE":"time"===e?"CURRENT_TIME":"CURRENT_TIMESTAMP";case i.zl.SqlServer:return"date"===e?"CAST(GETDATE() AS DATE)":"time"===e?"CAST(GETDATE() AS TIME)":"GETDATE()";case i.zl.Postgres:return"date"===e?"CURRENT_DATE":"time"===e?"LOCALTIME":"CURRENT_TIMESTAMP"}}function b(e,t,r={}){const n={},i={},s={esriFieldTypeSmallInteger:"integer",esriFieldTypeInteger:"integer",esriFieldTypeBigInteger:"integer",esriFieldTypeSingle:"double",esriFieldTypeDouble:"double",esriFieldTypeString:"string",esriFieldTypeTimeOnly:"time-only",esriFieldTypeDateOnly:"date-only",esriFieldTypeTimestampOffset:"timestamp-offset",esriFieldTypeDate:"date",esriFieldTypeOID:"integer",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"guid",oid:"integer",long:"integer","small-integer":"integer",integer:"integer","big-integer":"integer",single:"double","time-only":"time-only","date-only":"date-only","timestamp-offset":"timestemp-offset",double:"double",date:"date",guid:"guid","global-id":"guid",string:"string"};for(const e of t){const t=e.type?s[e.type]:void 0;n[e.name.toLowerCase()]=void 0===t?"":t}for(const e in r){const t=s[r[e]];i[e.toLowerCase()]=void 0===t?"":t}switch(S(n,e.parseTree,e.parameters,i)){case"double":return"double";case"integer":return"integer";case"date":return"date";case"date-only":return"date-only";case"time-only":return"time-only";case"timestamp-offset":return"timestamp-offset";case"string":return"string";case"global-id":case"guid":return"guid"}return""}function S(e,t,r,n){let o;switch(t.type){case"interval":return"integer";case"case-expression":{const i=[];if("simple"===t.format){for(let s=0;s<t.clauses.length;s++)i.push(S(e,t.clauses[s].value,r,n));null!==t.else&&i.push(S(e,t.else,r,n))}else{for(let s=0;s<t.clauses.length;s++)i.push(S(e,t.clauses[s].value,r,n));null!==t.else&&i.push(S(e,t.else,r,n))}return M(i)}case"parameter":{const e=n[t.value.toLowerCase()];if(void 0===e&&r){const e=r[t.value.toLowerCase()];if(void 0===e)return"";if(null===e)return"";if("string"==typeof e||e instanceof String)return"string";if("boolean"==typeof e)return"boolean";if((0,i.$P)(e))return"date";if((0,i.rX)(e))return"date";if((0,i.f0)(e))return"date-only";if((0,i.eg)(e))return"time-only";if("number"==typeof e)return e%1==0?"integer":"double"}return void 0===e?"":e}case"expression-list":{const i=[];for(const s of t.value)i.push(S(e,s,r,n));return i}case"unary-expression":return"boolean";case"binary-expression":switch(t.operator){case"AND":case"OR":case"IN":case"NOT IN":case"BETWEEN":case"NOTBETWEEN":case"LIKE":case"NOT LIKE":case"<>":case"<":case">":case">=":case"<=":case"=":return"boolean";case"IS":case"ISNOT":if("null"!==t.right.type)throw new s.L8(s.Z7.UnsupportedIsRhs);return"boolean";case"*":case"-":case"+":case"/":return M([S(e,t.left,r,n),S(e,t.right,r,n)]);case"||":return"string";default:throw new s.L8(s.Z7.UnsupportedOperator,{operator:t.operator})}case"null":return"";case"boolean":return"boolean";case"string":return"string";case"number":return null===t.value?"":t.value%1==0?"integer":"double";case"date":return"date";case"timestamp":return t.withtimezone?"timestamp-offset":"date";case"time":return"time-only";case"current-time":return"time"===t.mode?"time-only":"date";case"current-user":return"string";case"column-reference":{const r=e[t.column.toLowerCase()];return void 0===r?"":r}case"function":switch(t.name.toLowerCase()){case"cast":switch(t.args?.value[1]?.value.type??""){case"integer":case"smallint":return"integer";case"real":case"float":return"double";case"date":case"timestamp":return!0===t.args?.value[1]?.value?.withtimezone?"timestamp-offset":"date";case"time":return"time-only";case"varchar":return"string";default:return""}case"position":case"extract":case"char_length":case"mod":return"integer";case"round":if(o=S(e,t.args,r,n),Array.isArray(o)){if(o.length<=0)return"double";o=o[0]}return o;case"sign":return"integer";case"ceiling":case"floor":case"abs":return o=S(e,t.args,r,n),Array.isArray(o)&&(o=M(o)),"integer"===o||"double"===o?o:"double";case"area":case"length":case"log":case"log10":case"sin":case"cos":case"tan":case"asin":case"acos":case"atan":case"cosh":case"sinh":case"tanh":case"power":return"double";case"substring":case"trim":case"concat":case"lower":case"upper":return"string";case"truncate":return"double";case"nullif":case"coalesce":return o=S(e,t.args,r,n),Array.isArray(o)?o.length>0?o[0]:"":o}return""}throw new s.L8(s.Z7.UnsupportedSyntax,{node:t.type})}const I={boolean:1,string:2,integer:3,double:4,date:5};function M(e){if(e){let t="";for(const r of e)""!==r&&(t=""===t||I[t]<I[r]?r:t);return t}return""}function x(e,t){return A(e.parseTree,t)}function F(e){return"column-reference"===e?.parseTree.type}function A(e,t){if(null==e)return!1;switch(e.type){case"when-clause":return A(e.operand,t)||A(e.value,t);case"case-expression":for(const r of e.clauses)if(A(r,t))return!0;return!("simple"!==e.format||!A(e.operand,t))||!(null===e.else||!A(e.else,t));case"parameter":case"null":case"boolean":case"date":case"timestamp":case"time":case"string":case"number":return!1;case"expression-list":for(const r of e.value)if(A(r,t))return!0;return!1;case"unary-expression":return A(e.expr,t);case"binary-expression":return A(e.left,t)||A(e.right,t);case"column-reference":return t.toLowerCase()===e.column.toLowerCase();case"function":return A(e.args,t)}return!1}function T(e){let t="";return t+=e.period.toUpperCase(),t}function C(e,t,r){let n="";return n="interval-period"===t.type?T(t):T(t.start)+" TO "+T(t.end),"INTERVAL "+r+" "+e+" "+n}},72630:function(e,t,r){r.d(t,{Dp:function(){return c},GV:function(){return f},T9:function(){return d},U9:function(){return g},b$:function(){return y},cz:function(){return m},dM:function(){return _},i2:function(){return h},jk:function(){return p}});var n=r(3724),i=(r(62032),r(88396)),s=r(42042),o=r(359),a=r(70891);function l(e){let t=0;for(let r=0;r<e.length;r++)t+=e[r];return t/e.length}function u(e){const t=l(e);let r=0;for(let n=0;n<e.length;n++)r+=(t-e[n])**2;return r/(e.length-1)}function c(e){switch(e.toLowerCase()){case"distinct":return"distinct";case"avg":case"mean":return"avg";case"min":return"min";case"sum":return"sum";case"max":return"max";case"stdev":case"stddev":return"stddev";case"var":case"variance":return"var";case"count":return"count"}return""}async function p(e,t,r){const n=await w(e,t,r,!0);return 0===n.length?null:Math.min.apply(Math,n)}async function d(e,t,r){const n=await w(e,t,r,!0);return 0===n.length?null:Math.max.apply(Math,n)}async function h(e,t,r){let n="";t&&!(0,i.DA)(t)&&(n=(0,i.IY)(t,e.fields));const s=await w(e,t,r,!0);if(0===s.length)return null;const o=l(s);return null===o?o:"integer"===n?function(e){return e=+e,isFinite(e)?e-e%1||(e<0?-0:0===e?e:0):e}(o):o}async function f(e,t,r){const n=await w(e,t,r,!0);return 0===n.length?null:u(n)}async function y(e,t,r){const n=await w(e,t,r,!0);return 0===n.length?null:Math.sqrt(u(n))}async function m(e,t,r){const n=await w(e,t,r,!0);return 0===n.length?null:function(e){let t=0;for(let r=0;r<e.length;r++)t+=e[r];return t}(n)}async function g(e,t){return e.iterator(t).count()}async function w(e,t,r,i=!1){const l=e.iterator(r),u=[],c={ticker:0};let p=await l.next();for(;null!==p;){if(c.ticker++,r.aborted)throw new n.dr(n.D_.Cancelled);c.ticker%100==0&&(c.ticker=0,await new Promise((e=>{setTimeout(e,0)})));const e=t?.calculateValue(p);null===e?!1===i&&(u[u.length]=e):u[u.length]=e instanceof s.n||e instanceof a.k?e.toNumber():e instanceof o.g?e.toMilliseconds():e,p=await l.next()}return u}async function _(e,t,r=1e3,i=null){const l=e.iterator(i),u=[],c={},p={ticker:0};let d=await l.next();for(;null!==d;){if(p.ticker++,i?.aborted)throw new n.dr(n.D_.Cancelled);p.ticker%100==0&&(p.ticker=0,await new Promise((e=>{setTimeout(e,0)})));const e=t?.calculateValue(d);let h=e;if(e instanceof s.n?h="!!DATEONLY!!-"+e.toString():e instanceof o.g?h="!!TSOFFSETONLY!!-"+e.toString():e instanceof a.k?h="!!TIMEONLY!!-"+e.toString():e instanceof Date&&(h="!!DATE!!-"+e.toString()),null!=e&&void 0===c[h]&&(u.push(e),c[h]=1),u.length>=r&&-1!==r)return u;d=await l.next()}return u}},99680:function(e,t,r){r.d(t,{q:function(){return i}});var n=r(85408);class i{constructor(e,t){this._storage=new n.F,this.id="",this.name="",this.size=0,this._storage.maxSize=e,this._storage.register(this),t&&this._storage.registerRemoveFunc("",t)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(e,t,r=1){this._storage.put(this,e,t,r,1)}pop(e){return this._storage.pop(this,e)}get(e){return this._storage.get(this,e)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}resetHitRate(){}}},92709:function(e,t,r){r.d(t,{T:function(){return n},d:function(){return y}});const n={Base64:0,Hex:1,String:2,Raw:3},i=8,s=(1<<i)-1;function o(e,t){const r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function a(e){const t=[];for(let r=0,n=e.length*i;r<n;r+=i)t[r>>5]|=(e.charCodeAt(r/i)&s)<<r%32;return t}function l(e){const t=[];for(let r=0,n=32*e.length;r<n;r+=i)t.push(String.fromCharCode(e[r>>5]>>>r%32&s));return t.join("")}function u(e,t,r,n,i,s){return o(function(e,t){return e<<t|e>>>32-t}(o(o(t,e),o(n,s)),i),r)}function c(e,t,r,n,i,s,o){return u(t&r|~t&n,e,t,i,s,o)}function p(e,t,r,n,i,s,o){return u(t&n|r&~n,e,t,i,s,o)}function d(e,t,r,n,i,s,o){return u(t^r^n,e,t,i,s,o)}function h(e,t,r,n,i,s,o){return u(r^(t|~n),e,t,i,s,o)}function f(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;let r=1732584193,n=-271733879,i=-1732584194,s=271733878;for(let t=0;t<e.length;t+=16){const a=r,l=n,u=i,f=s;r=c(r,n,i,s,e[t],7,-680876936),s=c(s,r,n,i,e[t+1],12,-389564586),i=c(i,s,r,n,e[t+2],17,606105819),n=c(n,i,s,r,e[t+3],22,-1044525330),r=c(r,n,i,s,e[t+4],7,-176418897),s=c(s,r,n,i,e[t+5],12,1200080426),i=c(i,s,r,n,e[t+6],17,-1473231341),n=c(n,i,s,r,e[t+7],22,-45705983),r=c(r,n,i,s,e[t+8],7,1770035416),s=c(s,r,n,i,e[t+9],12,-1958414417),i=c(i,s,r,n,e[t+10],17,-42063),n=c(n,i,s,r,e[t+11],22,-1990404162),r=c(r,n,i,s,e[t+12],7,1804603682),s=c(s,r,n,i,e[t+13],12,-40341101),i=c(i,s,r,n,e[t+14],17,-1502002290),n=c(n,i,s,r,e[t+15],22,1236535329),r=p(r,n,i,s,e[t+1],5,-165796510),s=p(s,r,n,i,e[t+6],9,-1069501632),i=p(i,s,r,n,e[t+11],14,643717713),n=p(n,i,s,r,e[t],20,-373897302),r=p(r,n,i,s,e[t+5],5,-701558691),s=p(s,r,n,i,e[t+10],9,38016083),i=p(i,s,r,n,e[t+15],14,-660478335),n=p(n,i,s,r,e[t+4],20,-405537848),r=p(r,n,i,s,e[t+9],5,568446438),s=p(s,r,n,i,e[t+14],9,-1019803690),i=p(i,s,r,n,e[t+3],14,-187363961),n=p(n,i,s,r,e[t+8],20,1163531501),r=p(r,n,i,s,e[t+13],5,-1444681467),s=p(s,r,n,i,e[t+2],9,-51403784),i=p(i,s,r,n,e[t+7],14,1735328473),n=p(n,i,s,r,e[t+12],20,-1926607734),r=d(r,n,i,s,e[t+5],4,-378558),s=d(s,r,n,i,e[t+8],11,-2022574463),i=d(i,s,r,n,e[t+11],16,1839030562),n=d(n,i,s,r,e[t+14],23,-35309556),r=d(r,n,i,s,e[t+1],4,-1530992060),s=d(s,r,n,i,e[t+4],11,1272893353),i=d(i,s,r,n,e[t+7],16,-155497632),n=d(n,i,s,r,e[t+10],23,-1094730640),r=d(r,n,i,s,e[t+13],4,681279174),s=d(s,r,n,i,e[t],11,-358537222),i=d(i,s,r,n,e[t+3],16,-722521979),n=d(n,i,s,r,e[t+6],23,76029189),r=d(r,n,i,s,e[t+9],4,-640364487),s=d(s,r,n,i,e[t+12],11,-421815835),i=d(i,s,r,n,e[t+15],16,530742520),n=d(n,i,s,r,e[t+2],23,-995338651),r=h(r,n,i,s,e[t],6,-198630844),s=h(s,r,n,i,e[t+7],10,1126891415),i=h(i,s,r,n,e[t+14],15,-1416354905),n=h(n,i,s,r,e[t+5],21,-57434055),r=h(r,n,i,s,e[t+12],6,1700485571),s=h(s,r,n,i,e[t+3],10,-1894986606),i=h(i,s,r,n,e[t+10],15,-1051523),n=h(n,i,s,r,e[t+1],21,-2054922799),r=h(r,n,i,s,e[t+8],6,1873313359),s=h(s,r,n,i,e[t+15],10,-30611744),i=h(i,s,r,n,e[t+6],15,-1560198380),n=h(n,i,s,r,e[t+13],21,1309151649),r=h(r,n,i,s,e[t+4],6,-145523070),s=h(s,r,n,i,e[t+11],10,-1120210379),i=h(i,s,r,n,e[t+2],15,718787259),n=h(n,i,s,r,e[t+9],21,-343485551),r=o(r,a),n=o(n,l),i=o(i,u),s=o(s,f)}return[r,n,i,s]}function y(e,t=n.Hex){const r=t||n.Base64,s=f(a(e),e.length*i);switch(r){case n.Raw:return s;case n.Hex:return function(e){const t="0123456789abcdef",r=[];for(let n=0,i=4*e.length;n<i;n++)r.push(t.charAt(e[n>>2]>>n%4*8+4&15)+t.charAt(e[n>>2]>>n%4*8&15));return r.join("")}(s);case n.String:return l(s);case n.Base64:return function(e){const t=[];for(let r=0,n=4*e.length;r<n;r+=3){const n=(e[r>>2]>>r%4*8&255)<<16|(e[r+1>>2]>>(r+1)%4*8&255)<<8|e[r+2>>2]>>(r+2)%4*8&255;for(let i=0;i<4;i++)8*r+6*i>32*e.length?t.push("="):t.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(n>>6*(3-i)&63))}return t.join("")}(s)}}},85408:function(e,t,r){r.d(t,{F:function(){return l},Ti:function(){return i}});var n=r(7187);const i=-3,s=i-1;var o,a;(a=o||(o={}))[a.ALL=0]="ALL",a[a.SOME=1]="SOME";class l{get size(){return this._size}constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new n.A,this._users=new n.A}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(e){this._users.push(e)}deregister(e){this._users.removeUnordered(e)}registerRemoveFunc(e,t){this._removeFuncs.push([e,t])}deregisterRemoveFunc(e){this._removeFuncs.filterInPlace((t=>t[0]!==e))}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,-1),this._checkSize()}getSize(e,t){const r=this._db.get(e.id+t);return r?.size??0}put(e,t,r,n,a){t=e.id+t;const l=this._db.get(t);if(l&&(this._size-=l.size,e.size-=l.size,this._db.delete(t),l.entry!==r&&this._notifyRemove(t,l.entry,l.size,o.ALL)),n>this._maxSize)return void this._notifyRemove(t,r,n,o.ALL);if(void 0===r)return void console.warn("Refusing to cache undefined entry ");if(!n||n<0)return console.warn(`Refusing to cache entry with size ${n} for key ${t}`),void this._notifyRemove(t,r,0,o.ALL);const c=1+Math.max(a,s)-i;this._db.set(t,new u(r,n,c)),this._size+=n,e.size+=n,this._checkSize()}updateSize(e,t,r,n){t=e.id+t;const i=this._db.get(t);if(i&&i.entry===r){for(this._size-=i.size,e.size-=i.size;n>this._maxSize;){const e=this._notifyRemove(t,r,n,o.SOME);if(!(null!=e&&e>0))return void this._db.delete(t);n=e}i.size=n,this._size+=n,e.size+=n,this._checkSize()}}pop(e,t){t=e.id+t;const r=this._db.get(t);if(r)return this._size-=r.size,e.size-=r.size,this._db.delete(t),++this._hit,r.entry;++this._miss}get(e,t){t=e.id+t;const r=this._db.get(t);if(void 0!==r)return this._db.delete(t),r.lives=r.lifetime,this._db.set(t,r),++this._hit,r.entry;++this._miss}peek(e,t){const r=this._db.get(e.id+t);return r?++this._hit:++this._miss,r?.entry}get performanceInfo(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},t={},r=new Array;this._db.forEach(((e,n)=>{const i=e.lifetime;r[i]=(r[i]||0)+e.size,this._users.forAll((r=>{const{id:i,name:s}=r;if(n.startsWith(i)){const r=t[s]||0;t[s]=r+e.size}}))}));const n={};this._users.forAll((e=>{const r=e.name;if("hitRate"in e&&"number"==typeof e.hitRate&&!isNaN(e.hitRate)&&e.hitRate>0){const i=t[r]||0;t[r]=i,n[r]=Math.round(100*e.hitRate)+"%"}else n[r]="0%"}));const s=Object.keys(t);s.sort(((e,r)=>t[r]-t[e])),s.forEach((r=>e[r]=Math.round(t[r]/2**20)+"MB / "+n[r]));for(let t=r.length-1;t>=0;--t){const n=r[t];n&&(e["Priority "+(t+i-1)]=Math.round(n/this._size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forAll((e=>e.resetHitRate()))}clear(e){const t=e.id;this._db.forEach(((e,r)=>{r.startsWith(t)&&(this._size-=e.size,this._db.delete(r),this._notifyRemove(r,e.entry,e.size,o.ALL))})),e.size=0}clearAll(){this._db.forEach(((e,t)=>this._notifyRemove(t,e.entry,e.size,o.ALL))),this._users.forAll((e=>e.size=0)),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,t,r,n){let i;return this._removeFuncs.some((s=>{if(e.startsWith(s[0])){const e=s[1](t,n,r);return"number"==typeof e&&(i=e),!0}return!1})),i}_checkSize(){this._users.forAll((e=>this._checkSizeLimits(e))),this._checkSizeLimits()}_checkSizeLimits(e){const t=e??this;if(t.maxSize<0||t.size<=t.maxSize)return;const r=e?.id;let n=!0;for(;n;){n=!1;for(const[i,s]of this._db)if(0===s.lifetime&&(!r||i.startsWith(r))){if(this._purgeItem(i,s,e),t.size<=.9*t.maxSize)return;n||=this._db.has(i)}}for(const[n,i]of this._db)if((!r||n.startsWith(r))&&(this._purgeItem(n,i,e),t.size<=.9*t.maxSize))return}_purgeItem(e,t,r=this._users.find((t=>e.startsWith(t.id)))){if(this._db.delete(e),t.lives<=1){this._size-=t.size,r&&(r.size-=t.size);const n=this._notifyRemove(e,t.entry,t.size,o.SOME);null!=n&&n>0&&(this._size+=n,r&&(r.size+=n),t.lives=t.lifetime,t.size=n,this._db.set(e,t))}else--t.lives,this._db.set(e,t)}}class u{constructor(e,t,r){this.entry=e,this.size=t,this.lifetime=r,this.lives=r}}},77793:function(e,t,r){r.d(t,{P:function(){return _},L:function(){return v}});var n=r(53804),i=r(83525),s=r(90194),o=r(21609),a=r(72977);class l{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(a.AU),this._values=new Map,this.multipleOriginsSupported=!0}clone(e){const t=new l,r=this._originStores[a.Gr.DEFAULTS];r&&r.forEach(((e,r)=>{t.set(r,(0,o.o8)(e),a.Gr.DEFAULTS)}));for(let r=a.Gr.SERVICE;r<a.AU;r++){const n=this._originStores[r];n&&n.forEach(((n,i)=>{e&&e.has(i)||t.set(i,(0,o.o8)(n),r)}))}return t}get(e,t){const r=void 0===t?this._values:this._originStores[t];return r?r.get(e):void 0}keys(e){const t=null==e?this._values:this._originStores[e];return t?[...t.keys()]:[]}set(e,t,r=a.Gr.USER){let n=this._originStores[r];if(n||(n=new Map,this._originStores[r]=n),n.set(e,t),!this._values.has(e)||this._propertyOriginMap.get(e)<=r){const n=this._values.get(e);return this._values.set(e,t),this._propertyOriginMap.set(e,r),n!==t}return!1}delete(e,t=a.Gr.USER){const r=this._originStores[t];if(!r)return;const n=r.get(e);if(r.delete(e),this._values.has(e)&&this._propertyOriginMap.get(e)===t){this._values.delete(e);for(let r=t-1;r>=0;r--){const t=this._originStores[r];if(t&&t.has(e)){this._values.set(e,t.get(e)),this._propertyOriginMap.set(e,r);break}}}return n}has(e,t){const r=void 0===t?this._values:this._originStores[t];return!!r&&r.has(e)}revert(e,t){for(;t>0&&!this.has(e,t);)--t;const r=this._originStores[t],n=r?.get(e),i=this._values.get(e);return this._values.set(e,n),this._propertyOriginMap.set(e,t),i!==n}originOf(e){return this._propertyOriginMap.get(e)||a.Gr.DEFAULTS}forEach(e){this._values.forEach(e)}}var u=r(97354),c=r(63693),p=r(65953);const d=e=>{let t=class extends e{constructor(...e){super(...e);const t=(0,c.oY)(this),r=t.store,n=new l;t.store=n,(0,s.k)(t,r,n)}read(e,t){(0,u.L)(this,e,t)}getAtOrigin(e,t){const r=h(this),n=(0,a.aB)(t);if("string"==typeof e)return r.get(e,n);const i={};return e.forEach((e=>{i[e]=r.get(e,n)})),i}originOf(e){return(0,a.OL)(this.originIdOf(e))}originIdOf(e){return h(this).originOf(e)}revert(e,t){const r=h(this),n=(0,a.aB)(t),i=(0,c.oY)(this);let s;s="string"==typeof e?"*"===e?r.keys(n):[e]:e,s.forEach((e=>{i.invalidate(e),r.revert(e,n),i.commit(e)}))}};return t=(0,n._)([(0,p.$)("esri.core.ReadOnlyMultiOriginJSONSupport")],t),t};function h(e){return(0,c.oY)(e).store}let f=class extends(d(i.A)){};f=(0,n._)([(0,p.$)("esri.core.ReadOnlyMultiOriginJSONSupport")],f);var y=r(62664),m=r(99495);const g=e=>{let t=class extends e{constructor(...e){super(...e)}clear(e,t="user"){return w(this).delete(e,(0,a.aB)(t))}write(e,t){return(0,m.M)(this,e=e||{},t),e}setAtOrigin(e,t,r){(0,c.oY)(this).setAtOrigin(e,t,(0,a.aB)(r))}removeOrigin(e){const t=w(this),r=(0,a.aB)(e),n=t.keys(r);for(const e of n)t.originOf(e)===r&&t.set(e,t.get(e,r),a.Gr.USER)}updateOrigin(e,t){const r=w(this),n=(0,a.aB)(t),i=(0,y.Jt)(this,e);for(let t=n+1;t<a.AU;++t)r.delete(e,t);r.set(e,i,n)}toJSON(e){return this.write({},e)}};return t=(0,n._)([(0,p.$)("esri.core.MultiOriginJSONSupport.WriteableMultiOriginJSONSupport")],t),t.prototype.toJSON.isDefaultToJSON=!0,t};function w(e){return(0,c.oY)(e).store}const _=e=>{let t=class extends(g(d(e))){constructor(...e){super(...e)}};return t=(0,n._)([(0,p.$)("esri.core.MultiOriginJSONSupport")],t),t};let v=class extends(_(i.A)){};v=(0,n._)([(0,p.$)("esri.core.MultiOriginJSONSupport")],v)},72952:function(e,t,r){r.d(t,{EB:function(){return h},Im:function(){return m},Mj:function(){return d},Ui:function(){return y},w2:function(){return f}});var n=r(83525),i=r(78879),s=r(63693);const o=new Set(["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"]);function a(e){return e instanceof n.A}function l(e){return e instanceof i.A?Object.keys(e.items):a(e)?(0,s.oY)(e).keys():e?Object.keys(e):[]}function u(e,t){return e instanceof i.A?e.items[t]:e[t]}function c(e){return e?e.declaredClass:null}function p(e,t){const r=e.diff;if(r&&"function"==typeof r)return r(e,t);const n=l(e),i=l(t);if(0===n.length&&0===i.length)return;if(!n.length||!i.length||function(e,t){return!(!Array.isArray(e)||!Array.isArray(t))&&e.length!==t.length}(e,t))return{type:"complete",oldValue:e,newValue:t};const s=i.filter((e=>!n.includes(e))),d=n.filter((e=>!i.includes(e))),h=n.filter((r=>i.includes(r)&&u(e,r)!==u(t,r))).concat(s,d).sort(),f=c(e);if(f&&o.has(f)&&h.length)return{type:"complete",oldValue:e,newValue:t};let y;const m=a(e)&&a(t);for(const n of h){const i=u(e,n),s=u(t,n);let o;if((m||"function"!=typeof i&&"function"!=typeof s)&&i!==s&&(null!=i||null!=s)){if(r&&r[n]&&"function"==typeof r[n])o=r[n]?.(i,s);else if(i instanceof Date&&s instanceof Date){if(i.getTime()===s.getTime())continue;o={type:"complete",oldValue:i,newValue:s}}else o="object"==typeof i&&"object"==typeof s&&c(i)===c(s)?p(i,s):{type:"complete",oldValue:i,newValue:s};null!=o&&(null!=y?y.diff[n]=o:y={type:"partial",diff:{[n]:o}})}}return y}function d(e,t){return h(e,t)}function h(e,t){if(null==e)return!1;const r=t.split(".");let n=e;for(const e of r){if("complete"===n.type)return!0;if("partial"!==n.type)return!1;{const t=n.diff[e];if(!t)return!1;n=t}}return!0}function f(e,t){if(!e)return!1;if("partial"===e.type){const r=Object.keys(e.diff);return 1===r.length&&r[0]===t}return!1}function y(e,t){if("function"!=typeof e&&"function"!=typeof t&&(null!=e||null!=t))return null==e||null==t||"object"==typeof e&&"object"==typeof t&&c(e)!==c(t)?{type:"complete",oldValue:e,newValue:t}:p(e,t)}function m(e){if(null==e)return!0;switch(e.type){case"complete":return!1;case"collection":{const t=e;for(const e of t.added)if(!m(e))return!1;for(const e of t.removed)if(!m(e))return!1;for(const e of t.changed)if(!m(e))return!1;return!0}case"partial":for(const t in e.diff)if(!m(e.diff[t]))return!1;return!0}}},64786:function(e,t,r){r.d(t,{K:function(){return n}});const n=["operational-layers","basemap","ground"]},75505:function(e,t,r){r.d(t,{$:function(){return w},IB:function(){return a},Iy:function(){return O},N2:function(){return _},QP:function(){return C},RH:function(){return b},Vl:function(){return T},Ws:function(){return S},ZD:function(){return v},_L:function(){return A},bJ:function(){return x},e$:function(){return F},f6:function(){return L},pW:function(){return I},pf:function(){return E}});var n=r(52874),i=r(50659),s=r(21609),o=(r(33400),r(41546));function a(e){return"r"in e&&"g"in e&&"b"in e}function l(e){return"h"in e&&"s"in e&&"v"in e}function u(e){return"l"in e&&"a"in e&&"b"in e}function c(e){return"l"in e&&"c"in e&&"h"in e}const p=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],d=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function h(e,t){const r=[];let n,i;if(e[0].length!==t.length)throw new Error("dimensions do not match");const s=e.length,o=e[0].length;let a=0;for(n=0;n<s;n++){for(a=0,i=0;i<o;i++)a+=e[n][i]*t[i];r.push(a)}return r}function f(e){const t=[e.r/255,e.g/255,e.b/255].map((e=>e<=.04045?e/12.92:((e+.055)/1.055)**2.4)),r=h(p,t);return{x:100*r[0],y:100*r[1],z:100*r[2]}}function y(e){const t=h(d,[e.x/100,e.y/100,e.z/100]).map((e=>{const t=e<=.0031308?12.92*e:1.055*e**(1/2.4)-.055;return Math.min(1,Math.max(t,0))}));return{r:Math.round(255*t[0]),g:Math.round(255*t[1]),b:Math.round(255*t[2])}}function m(e){const t=[e.x/95.047,e.y/100,e.z/108.883].map((e=>e>(6/29)**3?e**(1/3):1/3*(29/6)**2*e+4/29));return{l:116*t[1]-16,a:500*(t[0]-t[1]),b:200*(t[1]-t[2])}}function g(e){const t=e.l,r=[(t+16)/116+e.a/500,(t+16)/116,(t+16)/116-e.b/200].map((e=>e>6/29?e**3:3*(6/29)**2*(e-4/29)));return{x:95.047*r[0],y:100*r[1],z:108.883*r[2]}}function w(e){return a(e)?e:c(e)?function(e){return y(g(function(e){const t=e.l,r=e.c,n=e.h;return{l:t,a:r*Math.cos(n),b:r*Math.sin(n)}}(e)))}(e):u(e)?function(e){return y(g(e))}(e):function(e){return"x"in e&&"y"in e&&"z"in e}(e)?y(e):l(e)?function(e){const t=(e.h+360)%360/60,r=e.s/100,n=e.v/100*255,i=n*r,s=i*(1-Math.abs(t%2-1));let o;switch(Math.floor(t)){case 0:o={r:i,g:s,b:0};break;case 1:o={r:s,g:i,b:0};break;case 2:o={r:0,g:i,b:s};break;case 3:o={r:0,g:s,b:i};break;case 4:o={r:s,g:0,b:i};break;case 5:case 6:o={r:i,g:0,b:s};break;default:o={r:0,g:0,b:0}}return o.r=Math.round(o.r+n-i),o.g=Math.round(o.g+n-i),o.b=Math.round(o.b+n-i),o}(e):e}function _(e){return l(e)?e:function(e){const t=e.r,r=e.g,n=e.b,i=Math.max(t,r,n),s=i-Math.min(t,r,n);let o=i,a=0===s?0:i===t?(r-n)/s%6:i===r?(n-t)/s+2:(t-r)/s+4,l=0===s?0:s/o;return a<0&&(a+=6),a*=60,l*=100,o*=100/255,{h:a,s:l,v:o}}(w(e))}function v(e){return u(e)?e:function(e){return m(f(e))}(w(e))}function b(e){return c(e)?e:function(e){return function(e){const t=e.l,r=e.a,n=e.b,i=Math.sqrt(r*r+n*n);let s=Math.atan2(n,r);return s=s>0?s:s+2*Math.PI,{l:t,c:i,h:s}}(m(f(e)))}(w(e))}function S(e,t){const{r:r,g:i,b:s}=t?.ignoreAlpha?e:function(e){let{r:t,g:r,b:i,a:s}=e;return s<1&&(t=Math.round(s*t+255*(1-s)),r=Math.round(s*r+255*(1-s)),i=Math.round(s*i+255*(1-s))),new n.A({r:t,g:r,b:i})}(e);return.2126*r+.7152*i+.0722*s}var I,M;function x(e,t=I.High){return S(e,{ignoreAlpha:!0})>t?new n.A([0,0,0,e.a]):new n.A([255,255,255,e.a])}function F(e,t){const r=v(e);r.l*=1-t;const n=w(r),i=e.clone();return i.setColor(n),i.a=e.a,i}function A(e,t){const r=e.clone();return r.a*=t,r}function T(e,t){const r=_(e);r.s*=t;const n=w(r),i=e.clone();return i.setColor(n),i.a=e.a,i}function C(e){return n.A.toUnitRGBA(e)}function E(e){return(0,o.fA)(e[0],e[1],e[2],e.length>3?e[3]:1)}function L(e,t){const r=n.A.toUnitRGBA(e);return r[3]*=t,r}function O(e,t,r={}){if(0===e.length||t<=0)return[];if(1===(e=e.map((e=>"string"==typeof e?new n.A(e):e))).length||1===t){const r=[],n=e[0];for(let e=0;e<t;e++)r.push(n.clone());return r}if(r.shuffle&&(e=(0,i.k4)((0,s.o8)(e),r.seed)),e.length>=t){const r=[],n=(e.length-1)/(t-1);for(let i=0;i<t;i++){const t=Math.round(i*n);r.push(e[t].clone())}return r}return function(e,t,r={}){const n=[],s=e.length-1,o=Math.ceil((t-e.length)/s);e:for(let i=0;i<s;i++){const s=e[i],a=e[i+1];for(let i=1;i<=o;i++){const l=i/(o+1);if(n.push(k(s,a,l,r)),n.length+e.length===t)break e}}return[...e.map((e=>e.clone())),...(0,i.k4)(n,r.seed??1)]}(e,t,r)}(M=I||(I={}))[M.Low=160]="Low",M[M.High=225]="High";const R=(e,t)=>{const r=Math.floor(10*t())-5;return Math.min(255,Math.max(0,e+r))};function k(e,t,r,s={}){const o=e.r,a=e.g,l=e.b,u=t.r,c=t.g,p=t.b,d=Math.round(o+(u-o)*r),h=Math.round(a+(c-a)*r),f=Math.round(l+(p-l)*r);if(!s.offset)return new n.A([d,h,f]);const y=(0,i.Mo)(s.seed);return new n.A([R(d,y),R(h,y),R(f,y)])}},83324:function(e,t,r){r.d(t,{M:function(){return u},s:function(){return l}});var n=r(42042),i=r(93393),s=r(359),o=r(70891),a=r(96285);function l(e,t){const r=c[e.toLowerCase()];if(null==r)throw new i.L8(i.Z7.FunctionNotRecognized);if(t.length<r.minParams||t.length>r.maxParams)throw new i.L8(i.Z7.InvalidParameterCount,{name:e.toUpperCase()});return r.evaluate(t)}function u(e,t){const r=c[e.toLowerCase()];return null!=r&&t>=r.minParams&&t<=r.maxParams}const c={min:{minParams:1,maxParams:1,evaluate:e=>h(e[0],"min")},max:{minParams:1,maxParams:1,evaluate:e=>h(e[0],"max")},avg:{minParams:1,maxParams:1,evaluate:e=>p(e[0])},sum:{minParams:1,maxParams:1,evaluate:e=>function(e){if(null===e)return null;let t=0;for(let r=0;r<e.length;r++){const n=e[r];if(null!==n){if(!d(n))throw new i.L8(i.Z7.InvalidValueForAggregateFunction);t+=n}}return t}(e[0])},stddev:{minParams:1,maxParams:1,evaluate:e=>function(e){if(null===e)return null;const t=f(e);return null===t?null:Math.sqrt(t)}(e[0])},count:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:e[0].length},var:{minParams:1,maxParams:1,evaluate:e=>f(e[0])}};function p(e){if(null===e)return null;let t=0,r=0;for(let n=0;n<e.length;n++){const s=e[n];if(null!==s){if(!d(s))throw new i.L8(i.Z7.InvalidValueForAggregateFunction);r++,t+=s}}return 0===r?null:t/e.length}function d(e){return"number"==typeof e}function h(e,t){if(null===e)return null;let r=null,i=null;for(const l of e){let e=l;e=l instanceof n.n||l instanceof o.k?l.toNumber():l instanceof a.c9?l.toMillis():l instanceof s.g?l.toMilliseconds():l,(null===r||"max"===t&&null!==i&&null!==e&&i<=e||"min"===t&&null!==i&&null!==e&&i>=e)&&(r=l,i=e)}return r}function f(e){if(null===e)return null;if(0===(e=e.filter((e=>null!==e))).length)return null;const t=p(e);if(null===t)return null;let r=0;for(const n of e){if(!d(n))throw new i.L8(i.Z7.InvalidValueForAggregateFunction);r+=(t-n)**2}return r/(e.length-1)}},359:function(e,t,r){r.d(t,{g:function(){return s}});var n=r(96285);function i(e){return Number.isNaN(e)||0===e?e:Math.trunc(e)}class s{constructor(e){this._timeStampOffset=e,this._date=null}toDateTime(){return this._date??=n.c9.fromISO(this._timeStampOffset,{setZone:!0}),this._date}get isValid(){return this.toDateTime().isValid}get timezoneOffsetHour(){return i(this.toDateTime().offset/60)}get timezoneOffsetMinutes(){return i(this.toDateTime().offset%60)}toMilliseconds(){return this.toDateTime().toMillis()}get hour(){return this.toDateTime().hour}get minute(){return this.toDateTime().minute}get second(){return this.toDateTime().second}get day(){return this.toDateTime().day}get month(){return this.toDateTime().month}get year(){return this.toDateTime().year}startOfDay(){return s.fromDateTime(this.toDateTime().startOf("day"))}static fromJSDate(e){return new s(n.c9.fromJSDate(e).toISO({includeOffset:!0}))}static fromDateTime(e){return new s(e.toISO({includeOffset:!0}))}static fromParts(e,t,r=0,n=0,i=0,o=0,a=0,l=!1,u=0,c=0){const p=`${e.toString().padStart(4,"0")}-${t.toString().padStart(2,"0")}-${r.toString().padStart(2,"0")}`;let d="";o<10&&(d="0");let h=`${n.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}:${d+o.toString()}`;0!==a&&(h+="."+a.toString().padStart(3,"0"));const f=`${l?"-":"+"}${u.toString().padStart(2,"0")}:${c.toString().padStart(2,"0")}`;return new s(p+"T"+h+f)}toStorageFormat(){return this._timeStampOffset}toString(){return this._timeStampOffset}toSQLValue(){let e=this.toDateTime().toSQL({includeOffset:!0,includeOffsetSpace:!0});return e&&(e=e.replace(".000","")),e}toSQLWithKeyword(){return`timestamp '${this.toSQLValue()}'`}addMilliseconds(e){const t=this.toDateTime().plus(e);return s.fromDateTime(t)}}},16177:function(e,t,r){r.r(t),r.d(t,{WhereClause:function(){return te},defaultAttributeAdapter:function(){return de}});var n=r(9688),i=r(58941),s=r(83324),o=r(42042),a=r(93393);class l{constructor(){this.op="+",this.day=0,this.second=0,this.hour=0,this.month=0,this.year=0,this.minute=0,this.millis=0}static _fixDefaults(e){if(null!==e.precision||null!==e.secondary)throw new a.L8(a.Z7.PrimarySecondaryQualifiers)}static _parseSecondsComponent(e,t){if(t.includes(".")){const r=t.split(".");e.second=parseFloat(r[0]),e.millis=parseInt(r[1],10)}else e.second=parseFloat(t)}static createFromMilliseconds(e){const t=new l;return t.second=e/1e3,t}static createFromValueAndQualifier(e,t,r){let n=null;const i=new l;if(i.op="-"===r?"-":"+","interval-period"===t.type){l._fixDefaults(t);const r=new RegExp("^[0-9]{1,}$");if("year"===t.period||"month"===t.period)throw new a.L8(a.Z7.YearMonthIntervals);if("second"===t.period){if(!/^[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/.test(e))throw new a.L8(a.Z7.IllegalInterval);l._parseSecondsComponent(i,e)}else{if(!r.test(e))throw new a.L8(a.Z7.IllegalInterval);i[t.period]=parseFloat(e)}}else{if(l._fixDefaults(t.start),l._fixDefaults(t.end),"year"===t.start.period||"month"===t.start.period||"year"===t.end.period||"month"===t.end.period)throw new a.L8(a.Z7.YearMonthIntervals);switch(t.start.period){case"day":switch(t.end.period){case"hour":if(n=new RegExp("^[0-9]{1,} [0-9]{1,}$"),!n.test(e))throw new a.L8(a.Z7.IllegalInterval);i[t.start.period]=parseFloat(e.split(" ")[0]),i[t.end.period]=parseFloat(e.split(" ")[1]);break;case"minute":if(n=new RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,}$"),!n.test(e))throw new a.L8(a.Z7.IllegalInterval);{i[t.start.period]=parseFloat(e.split(" ")[0]);const r=e.split(" ")[1].split(":");i.hour=parseFloat(r[0]),i.minute=parseFloat(r[1])}break;case"second":if(n=new RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$"),!n.test(e))throw new a.L8(a.Z7.IllegalInterval);{i[t.start.period]=parseFloat(e.split(" ")[0]);const r=e.split(" ")[1].split(":");i.hour=parseFloat(r[0]),i.minute=parseFloat(r[1]),l._parseSecondsComponent(i,r[2])}break;default:throw new a.L8(a.Z7.IllegalInterval)}break;case"hour":switch(t.end.period){case"minute":if(n=new RegExp("^[0-9]{1,}:[0-9]{1,}$"),!n.test(e))throw new a.L8(a.Z7.IllegalInterval);i.hour=parseFloat(e.split(":")[0]),i.minute=parseFloat(e.split(":")[1]);break;case"second":if(n=new RegExp("^[0-9]{1,}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$"),!n.test(e))throw new a.L8(a.Z7.IllegalInterval);{const t=e.split(":");i.hour=parseFloat(t[0]),i.minute=parseFloat(t[1]),l._parseSecondsComponent(i,t[2])}break;default:throw new a.L8(a.Z7.IllegalInterval)}break;case"minute":if("second"!==t.end.period)throw new a.L8(a.Z7.IllegalInterval);if(n=new RegExp("^[0-9]{1,}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$"),!n.test(e))throw new a.L8(a.Z7.IllegalInterval);{const t=e.split(":");i.minute=parseFloat(t[0]),l._parseSecondsComponent(i,t[1])}break;default:throw new a.L8(a.Z7.IllegalInterval)}}return i}valueInMilliseconds(){return("-"===this.op?-1:1)*(this.millis+1e3*this.second+60*this.minute*1e3+60*this.hour*60*1e3+24*this.day*60*60*1e3+this.month*(365/12)*24*60*60*1e3+365*this.year*24*60*60*1e3)}}var u=r(359),c=r(70891),p=r(92955),d=r(96285);const h=/^(\d{1,2}):(\d{1,2}):(\d{1,2})$/,f=/^(\d{1,2}):(\d{1,2})$/,y=/^(\d{1,2}):(\d{1,2}):(\d{1,2}).([0-9]+)$/,m=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,g=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?$/,w=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?[ ]{0,1}(\+|-)(\d{1,2}):(\d{1,2})$/,_=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})?[ ]{0,1}(\+|-)(\d{1,2}):(\d{1,2})$/,v=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/;function b(e,t){if(t instanceof d.bo)return t===p.GB.instance?d.c9.fromMillis(e.getTime(),{zone:p.GB.instance}):d.c9.fromJSDate(e,{zone:t});switch(t){case"system":case"local":case null:return d.c9.fromJSDate(e);default:return"unknown"===t?.toLowerCase()?d.c9.fromMillis(e.getTime(),{zone:p.GB.instance}):d.c9.fromJSDate(e,{zone:t})}}function S(e){return"number"==typeof e}function I(e){return"string"==typeof e||e instanceof String}function M(e){return e instanceof l}function x(e){return e instanceof Date}function F(e){return e instanceof d.c9}function A(e){return e instanceof o.n}function T(e){return e instanceof c.k}function C(e){return e instanceof u.g}function E(e){let t=h.exec(e);if(null!==t){const[,e,r,n]=t,i=c.k.fromParts(parseInt(e,10),parseInt(r,10),parseInt(n,10),0);if(null!==i)return i;throw new a.L8(a.Z7.InvalidTime)}if(t=f.exec(e),null!==t){const[,e,r]=t,n=c.k.fromParts(parseInt(e,10),parseInt(r,10),0,0);if(null!==n)return n;throw new a.L8(a.Z7.InvalidTime)}if(t=y.exec(e),null!==t){const[,e,r,n,i]=t,s=c.k.fromParts(parseInt(e,10),parseInt(r,10),parseInt(n,10),parseInt(i,10));if(null!==s)return s;throw new a.L8(a.Z7.InvalidTime)}throw new a.L8(a.Z7.InvalidTime)}function L(e,t,r=!1){let n=g.exec(e);if(null!==n){const[,e,r,i,s,o,l,u]=n,c=d.c9.fromObject({year:parseInt(e,10),month:parseInt(r,10),day:parseInt(i,10),hour:parseInt(s,10),minute:parseInt(o,10),second:parseInt(l,10),millisecond:u?parseInt(u.replace(".",""),10):0},{zone:(0,p.Qo)(t)});if(!1===c.isValid)throw new a.L8(a.Z7.InvalidTimeStamp);return c}if(n=w.exec(e),null!==n){const[,e,t,r,i,s,o,l,c,p,d]=n,h=u.g.fromParts(parseInt(e,10),parseInt(t,10),parseInt(r,10),parseInt(i,10),parseInt(s,10),parseInt(o,10),l?parseInt(l.replace(".",""),10):0,"-"===c,parseInt(p,10),parseInt(d,10));if(!1===h.isValid)throw new a.L8(a.Z7.InvalidTimeStamp);return h}if(n=_.exec(e),null!==n){const[,e,t,r,i,s,o,l,c]=n,p=u.g.fromParts(parseInt(e,10),parseInt(t,10),parseInt(r,10),parseInt(i,10),parseInt(s,10),0,0,"-"===o,parseInt(l,10),parseInt(c,10));if(!1===p.isValid)throw new a.L8(a.Z7.InvalidTimeStamp);return p}if(n=v.exec(e),null!==n){const[,e,r,i,s,o]=n,l=d.c9.fromObject({year:parseInt(e,10),month:parseInt(r,10),day:parseInt(i,10),hour:parseInt(s,10),minute:parseInt(o,10),second:0},{zone:(0,p.Qo)(t)});if(!1===l.isValid)throw new a.L8(a.Z7.InvalidTimeStamp);return l}if(n=m.exec(e),null!==n){const[,e,r,i]=n,s=d.c9.fromObject({year:parseInt(e,10),month:parseInt(r,10),day:parseInt(i,10),hour:0,minute:0,second:0},{zone:(0,p.Qo)(t)});if(!1===s.isValid)throw new a.L8(a.Z7.InvalidTimeStamp);return s}throw new a.L8(a.Z7.InvalidTimeStamp)}function O(e,t){const r=m.exec(e);if(null===r)try{return L(e,t)}catch{throw new a.L8(a.Z7.InvalidDate)}const[,n,i,s]=r,l=o.n.fromParts(parseInt(n,10),parseInt(i,10),parseInt(s,10));if(null===l)throw new a.L8(a.Z7.InvalidDate);return l}var R=r(15774),k=r(50944);function N(e){return!!F(e)||!!C(e)}function D(e){return!!(F(e)||A(e)||C(e)||T(e))}function P(e){if(F(e))return e.toMillis();if(A(e))return e.toNumber();if(C(e))return e.toMilliseconds();throw new a.L8(a.Z7.InvalidDataType)}function Z(e,t,r,n){if(null==e||null==t)return null;if(S(e)){if(S(t))return j(e,t,r);if(I(t))return function(e,t,r){const n=parseFloat(t);if(!isNaN(n))return j(e,n,r);const i=e.toString();switch(r){case"<>":return i!==t;case"=":return i===t;case">":return i>t;case"<":return i<t;case">=":return i>=t;case"<=":return i<=t}}(e,t,r);if(D(t))throw new a.L8(a.Z7.InvalidOperator);if(A(t))throw new a.L8(a.Z7.InvalidOperator)}else if(I(e)){if(S(t))return function(e,t,r){const n=parseFloat(e);if(!isNaN(n))return j(n,t,r);const i=t.toString();switch(r){case"<>":return e!==i;case"=":return e===i;case">":return e>i;case"<":return e<i;case">=":return e>=i;case"<=":return e<=i}}(e,t,r);if(I(t))return function(e,t,r){switch(r){case"<>":return e!==t;case"=":return e===t;case">":return e>t;case"<":return e<t;case">=":return e>=t;case"<=":return e<=t}}(e,t,r);if(F(t))throw new a.L8(a.Z7.InvalidOperator);if(A(t))throw new a.L8(a.Z7.InvalidOperator);if(T(t))throw new a.L8(a.Z7.InvalidOperator);if(C(t))throw new a.L8(a.Z7.InvalidOperator)}else if(F(e)){if(N(t)){if(e instanceof d.c9&&(0,p.Y4)(e.zone)){if(t instanceof d.c9&&!1===(0,p.Y4)(t.zone))return V(e,t,r);if(t instanceof u.g)return V(e,t,r)}else if(t instanceof d.c9&&(0,p.Y4)(t.zone)){if(e instanceof d.c9&&!1===(0,p.Y4)(e.zone))return V(e,t,r);if(e instanceof u.g)return V(e,t,r)}return j(P(e),P(t),r)}if(I(t))throw new a.L8(a.Z7.InvalidOperator);if(A(t))return function(e,t,r){const n=t.toDateTimeLuxon(e.zone);return j((e=e.startOf("day")).toMillis(),n.toMillis(),r)}(e,t,r);if(T(t))throw new a.L8(a.Z7.InvalidOperator);if(S(t))throw new a.L8(a.Z7.InvalidOperator)}else if(A(e)){if(C(t))return function(e,t,r){const n=e.toDateTimeLuxon(t.toDateTime().zone);return t=t.startOfDay(),j(n.toMillis(),t.toMilliseconds(),r)}(e,t,r);if(F(t))return function(e,t,r){const n=e.toDateTimeLuxon(t.zone);return t=t.startOf("day"),j(n.toMillis(),t.toMillis(),r)}(e,t,r);if(I(t))throw new a.L8(a.Z7.InvalidOperator);if(A(t))return j(e.toNumber(),t.toNumber(),r);if(T(t))throw new a.L8(a.Z7.InvalidOperator);if(S(t))throw new a.L8(a.Z7.InvalidOperator)}else if(T(e)){if(T(t))return j(e.toNumber(),t.toNumber(),r);if(I(t))throw new a.L8(a.Z7.InvalidOperator);if(S(t))throw new a.L8(a.Z7.InvalidOperator);if(A(t))throw new a.L8(a.Z7.InvalidOperator);if(N(t))throw new a.L8(a.Z7.InvalidOperator)}else if(C(e)){if(N(t))return t instanceof d.c9&&(0,p.Y4)(t.zone)?V(e,t,r):j(P(e),P(t),r);if(I(t))throw new a.L8(a.Z7.InvalidOperator);if(A(t))return function(e,t,r){const n=t.toDateTimeLuxon(e.toDateTime().zone);return j((e=e.startOfDay()).toMilliseconds(),n.toMillis(),r)}(e,t,r);if(T(t))throw new a.L8(a.Z7.InvalidOperator);if(S(t))throw new a.L8(a.Z7.InvalidOperator)}switch(r){case"<>":return e!==t;case"=":return e===t;case">":return e>t;case"<":return e<t;case">=":return e>=t;case"<=":return e<=t}}function j(e,t,r){switch(r){case"<>":return e!==t;case"=":return e===t;case">":return e>t;case"<":return e<t;case">=":return e>=t;case"<=":return e<=t}}function V(e,t,r){e instanceof u.g&&(e=e.toDateTime()),t instanceof u.g&&(t=t.toDateTime());const n=U(e),i=U(t);switch(r){case"<>":return n!==i;case"=":return n===i;case">":return n>i;case"<":return n<i;case">=":return n>=i;case"<=":return n<=i}}function U(e){return 321408e5*e.year+26784e5*e.month+864e5*e.day+36e5*e.hour+6e4*e.minute+1e3*e.second+e.millisecond}function z(e,t,r){const n=$[e.toLowerCase()];if(null==n)throw new a.L8(a.Z7.FunctionNotRecognized);if(t.length<n.minParams||t.length>n.maxParams)throw new a.L8(a.Z7.InvalidParameterCount,{name:e.toUpperCase()});return n.evaluate(t,r)}function G(e){return"string"==typeof e||e instanceof String}function q(e){return!(x(e)||A(e)||F(e)||T(e)||C(e))}function B(e){return A(e)||T(e)?e.toString():C(e)?e.toSQLValue():F(e)?0===e.millisecond?e.toFormat("yyyy-LL-dd HH:mm:ss"):e.toSQL({includeOffset:!1}):x(e)?B(d.c9.fromJSDate(e)):e.toString()}const $={extract:{minParams:2,maxParams:2,evaluate:([e,t])=>{if(null==t)return null;if(x(t))switch(e.toUpperCase()){case"SECOND":return t.getSeconds();case"MINUTE":return t.getMinutes();case"HOUR":return t.getHours();case"DAY":return t.getDate();case"MONTH":return t.getMonth()+1;case"YEAR":return t.getFullYear();case"TIMEZONE_HOUR":case"TIMEZONE_MINUTE":return 0}else if(F(t))switch(e.toUpperCase()){case"SECOND":return t.second;case"MINUTE":return t.minute;case"HOUR":return t.hour;case"DAY":return t.day;case"MONTH":return t.month;case"YEAR":return t.year;case"TIMEZONE_HOUR":case"TIMEZONE_MINUTE":throw new a.L8(a.Z7.InvalidFunctionParameters,{function:"EXTRACT"})}else if(A(t))switch(e.toUpperCase()){case"DAY":return t.day;case"MONTH":return t.month;case"YEAR":return t.year;case"TIMEZONE_HOUR":case"TIMEZONE_MINUTE":throw new a.L8(a.Z7.InvalidFunctionParameters,{function:"EXTRACT"})}else if(T(t))switch(e.toUpperCase()){case"SECOND":return t.second;case"MINUTE":return t.minute;case"HOUR":return t.hour}else if(C(t))switch(e.toUpperCase()){case"SECOND":return t.second;case"MINUTE":return t.minute;case"HOUR":return t.hour;case"DAY":return t.day;case"MONTH":return t.month;case"YEAR":return t.year;case"TIMEZONE_HOUR":return t.timezoneOffsetHour;case"TIMEZONE_MINUTE":return t.timezoneOffsetMinutes}throw new a.L8(a.Z7.InvalidFunctionParameters,{function:"EXTRACT"})}},substring:{minParams:2,maxParams:3,evaluate:e=>{if(2===e.length){const[t,r]=e;return null==t||null==r?null:t.toString().substring(r-1)}if(3===e.length){const[t,r,n]=e;return null==t||null==r||null==n?null:n<=0?"":t.toString().substring(r-1,r+n-1)}}},position:{minParams:2,maxParams:2,evaluate:([e,t])=>null==e||null==t?null:t.indexOf(e)+1},trim:{minParams:2,maxParams:3,evaluate:e=>{const t=3===e.length,r=t?e[1]:" ",n=t?e[2]:e[1];if(null==r||null==n)return null;const i=`(${(0,k.Cj)(r)})`;switch(e[0]){case"BOTH":return n.replaceAll(new RegExp(`^${i}*|${i}*$`,"g"),"");case"LEADING":return n.replaceAll(new RegExp(`^${i}*`,"g"),"");case"TRAILING":return n.replaceAll(new RegExp(`${i}*$`,"g"),"")}throw new a.L8(a.Z7.InvalidFunctionParameters,{function:"TRIM"})}},abs:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.abs(e[0])},ceiling:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.ceil(e[0])},floor:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.floor(e[0])},log:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.log(e[0])},log10:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.log(e[0])*Math.LOG10E},sin:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.sin(e[0])},cos:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.cos(e[0])},tan:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.tan(e[0])},asin:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.asin(e[0])},acos:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.acos(e[0])},atan:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.atan(e[0])},sign:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:e[0]>0?1:e[0]<0?-1:0},power:{minParams:2,maxParams:2,evaluate:e=>null==e[0]||null==e[1]?null:e[0]**e[1]},mod:{minParams:2,maxParams:2,evaluate:e=>null==e[0]||null==e[1]?null:e[0]%e[1]},round:{minParams:1,maxParams:2,evaluate:e=>{const t=e[0],r=2===e.length?10**e[1]:1;return null==t?null:Math.round(t*r)/r}},truncate:{minParams:1,maxParams:2,evaluate:e=>null==e[0]?null:1===e.length||0===e[1]?Math.trunc(e[0]):(0,R.pF)("trunc",e[0],-Number(e[1]))},char_length:{minParams:1,maxParams:1,evaluate:e=>G(e[0])?e[0].length:0},concat:{minParams:1,maxParams:1/0,evaluate:e=>{let t="";for(let r=0;r<e.length;r++){if(null==e[r])return null;t+=e[r].toString()}return t}},lower:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:e[0].toString().toLowerCase()},upper:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:e[0].toString().toUpperCase()},coalesce:{minParams:1,maxParams:1/0,evaluate:e=>{for(const t of e)if(null!==t)return t;return null}},cosh:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.cosh(e[0])},sinh:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.sinh(e[0])},tanh:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.tanh(e[0])},nullif:{minParams:2,maxParams:2,evaluate:(e,t)=>Z(e[0],e[1],"=")?null:e[0]},cast:{minParams:2,maxParams:2,evaluate:(e,t)=>{const r=e[0],n=e[1];if(null===r)return null;switch(n.type){case"integer":{if(!q(r))throw new a.L8(a.Z7.CannotCastValue);const e=parseInt(r,10);if(isNaN(e))throw new a.L8(a.Z7.CannotCastValue);return e}case"smallint":{if(!q(r))throw new a.L8(a.Z7.CannotCastValue);const e=parseInt(r,10);if(isNaN(e))throw new a.L8(a.Z7.CannotCastValue);if(e>32767||e<-32767)throw new a.L8(a.Z7.CannotCastValue);return e}case"float":case"real":{if(!q(r))throw new a.L8(a.Z7.CannotCastValue);const e=parseFloat(r);if(isNaN(e))throw new a.L8(a.Z7.CannotCastValue);return e}case"time":return function(e){if(x(e))return c.k.fromDateJS(e);if(F(e))return c.k.fromDateTime(e);if(A(e))throw new a.L8(a.Z7.CannotCastValue);if(T(e))return e;if(C(e))return c.k.fromSqlTimeStampOffset(e);if(G(e))return E(e);throw new a.L8(a.Z7.CannotCastValue)}(r);case"date":return function(e){if(x(e))return o.n.fromDateJS(e);if(F(e))return o.n.fromParts(e.year,e.month,e.day);if(A(e))return e;if(T(e))throw new a.L8(a.Z7.CannotCastValue);if(C(e)&&null===o.n.fromParts(e.year,e.month,e.day))throw new a.L8(a.Z7.CannotCastValue);if(G(e)){const t=o.n.fromReader(e);if(null!==t&&t.isValid)return t}throw new a.L8(a.Z7.CannotCastValue)}(r);case"timestamp":return function(e,t,r){if(x(e))return b(e,t);if(F(e))return e;if(A(e))return e.toDateTimeLuxon("unknown");if(T(e))throw new a.L8(a.Z7.CannotCastValue);if(C(e))return e;if(G(e))return L(e,"unknown",r);throw new a.L8(a.Z7.CannotCastValue)}(r,t,!0===n.withtimezone);case"varchar":{const e=B(r);if(e.length>n.size)throw new a.L8(a.Z7.CannotCastValue);return e}default:throw new a.L8(a.Z7.InvalidDataType)}}}};function J(e,t,r,n){if("||"===e)return z("concat",[t,r],n);if(null===t||null===r)return null;if(S(t)){if(S(r))return W(t,r,e);if(M(r))return function(e,t,r){switch(r){case"+":return l.createFromMilliseconds(e+t.valueInMilliseconds());case"-":return l.createFromMilliseconds(e-t.valueInMilliseconds());case"*":return l.createFromMilliseconds(e*t.valueInMilliseconds());case"/":return l.createFromMilliseconds(e/t.valueInMilliseconds())}throw new a.L8(a.Z7.InvalidOperator)}(t,r,e);if(T(r))return function(){throw new a.L8(a.Z7.InvalidOperator)}();if(A(r))return function(){throw new a.L8(a.Z7.InvalidOperator)}();if(C(r))return function(){throw new a.L8(a.Z7.InvalidOperator)}();if(F(r))return function(){throw new a.L8(a.Z7.InvalidOperator)}();if(I(r))return function(e,t,r){const n=parseFloat(t);if(isNaN(n))throw new a.L8(a.Z7.InvalidOperator);return W(e,n,r)}(t,r,e);throw new a.L8(a.Z7.InvalidOperator)}if(A(t)){if(S(r))return function(e,t,r){const n=1e3*t*24*60*60;switch(r){case"+":return e.plus("milliseconds",n);case"-":return e.plus("milliseconds",-1*n)}throw new a.L8(a.Z7.InvalidOperator)}(t,r,e);if(M(r))return function(e,t,r){switch(r){case"+":return e.plus("milliseconds",t.valueInMilliseconds());case"-":return e.plus("milliseconds",-1*t.valueInMilliseconds())}throw new a.L8(a.Z7.InvalidOperator)}(t,r,e);if(T(r))return function(){throw new a.L8(a.Z7.InvalidOperator)}();if(A(r))return function(e,t,r){if("-"===r)return e.toDateTimeLuxon("UTC").diff(t.toDateTimeLuxon("UTC")).as("days");throw new a.L8(a.Z7.InvalidOperator)}(t,r,e);if(C(r))return function(e,t,r){if("-"===r)return e.toDateTimeLuxon(t.toDateTime().zone).diff(t.toDateTime()).as("days");throw new a.L8(a.Z7.InvalidOperator)}(t,r,e);if(F(r))return function(e,t,r){if("-"===r)return e.toDateTimeLuxon(t.zone).diff(t).as("days");throw new a.L8(a.Z7.InvalidOperator)}(t,r,e);if(I(r))return function(){throw new a.L8(a.Z7.InvalidOperator)}();throw new a.L8(a.Z7.InvalidOperator)}if(T(t)){if(S(r))return function(e,t,r){const n=1e3*t*24*60*60;switch(r){case"+":return e.plus("milliseconds",n);case"-":return e.plus("milliseconds",-1*n)}throw new a.L8(a.Z7.InvalidOperator)}(t,r,e);if(M(r))return function(e,t,r){switch(r){case"+":return e.plus("milliseconds",t.valueInMilliseconds());case"-":return e.plus("milliseconds",-1*t.valueInMilliseconds())}throw new a.L8(a.Z7.InvalidOperator)}(t,r,e);if(T(r))return function(){throw new a.L8(a.Z7.InvalidOperator)}();if(A(r))return function(){throw new a.L8(a.Z7.InvalidOperator)}();if(C(r))return function(){throw new a.L8(a.Z7.InvalidOperator)}();if(F(r))return function(){throw new a.L8(a.Z7.InvalidOperator)}();if(I(r))return function(){throw new a.L8(a.Z7.InvalidOperator)}();throw new a.L8(a.Z7.InvalidOperator)}if(M(t)){if(S(r))return function(e,t,r){switch(r){case"+":return l.createFromMilliseconds(e.valueInMilliseconds()+t);case"-":return l.createFromMilliseconds(e.valueInMilliseconds()-t);case"*":return l.createFromMilliseconds(e.valueInMilliseconds()*t);case"/":return l.createFromMilliseconds(e.valueInMilliseconds()/t)}throw new a.L8(a.Z7.InvalidOperator)}(t,r,e);if(M(r))return function(e,t,r){switch(r){case"+":return l.createFromMilliseconds(e.valueInMilliseconds()+t.valueInMilliseconds());case"-":return l.createFromMilliseconds(e.valueInMilliseconds()-t.valueInMilliseconds());case"*":return l.createFromMilliseconds(e.valueInMilliseconds()*t.valueInMilliseconds());case"/":return l.createFromMilliseconds(e.valueInMilliseconds()/t.valueInMilliseconds())}throw new a.L8(a.Z7.InvalidOperator)}(t,r,e);if(T(r))return function(e,t,r){if("+"===r)return t.plus("milliseconds",e.valueInMilliseconds());throw new a.L8(a.Z7.InvalidOperator)}(t,r,e);if(A(r))return function(e,t,r){if("+"===r)return t.plus("milliseconds",e.valueInMilliseconds());throw new a.L8(a.Z7.InvalidOperator)}(t,r,e);if(C(r))return function(e,t,r){if("+"===r)return t.addMilliseconds(e.valueInMilliseconds());throw new a.L8(a.Z7.InvalidOperator)}(t,r,e);if(F(r))return function(e,t,r){switch(r){case"+":return t.plus({milliseconds:e.valueInMilliseconds()});case"-":return e.valueInMilliseconds()-t.toMillis()}throw new a.L8(a.Z7.InvalidOperator)}(t,r,e);if(I(r))return function(){throw new a.L8(a.Z7.InvalidOperator)}();throw new a.L8(a.Z7.InvalidOperator)}if(F(t)){if(S(r))return function(e,t,r){const n=1e3*t*24*60*60;switch(r){case"+":return e.plus({milliseconds:n});case"-":return e.minus({milliseconds:n})}throw new a.L8(a.Z7.InvalidOperator)}(t,r,e);if(M(r))return function(e,t,r){switch(r){case"+":return e.plus({milliseconds:t.valueInMilliseconds()});case"-":return e.minus({milliseconds:t.valueInMilliseconds()})}throw new a.L8(a.Z7.InvalidOperator)}(t,r,e);if(T(r))return function(){throw new a.L8(a.Z7.InvalidOperator)}();if(A(r))return function(e,t,r){if("-"===r)return e.diff(t.toDateTimeLuxon(e.zone)).as("days");throw new a.L8(a.Z7.InvalidOperator)}(t,r,e);if(C(r))return function(e,t,r){if("-"===r)return e.diff(t.toDateTime()).as("days");throw new a.L8(a.Z7.InvalidOperator)}(t,r,e);if(F(r))return function(e,t,r){if("-"===r)return e.diff(t).as("days");throw new a.L8(a.Z7.InvalidOperator)}(t,r,e);if(I(r))return function(){throw new a.L8(a.Z7.InvalidOperator)}();throw new a.L8(a.Z7.InvalidOperator)}if(C(t)){if(S(r))return function(e,t,r){const n=1e3*t*24*60*60;switch(r){case"+":return e.addMilliseconds(n);case"-":return e.addMilliseconds(-1*n)}throw new a.L8(a.Z7.InvalidOperator)}(t,r,e);if(M(r))return function(e,t,r){switch(r){case"+":return e.addMilliseconds(t.valueInMilliseconds());case"-":return e.addMilliseconds(-1*t.valueInMilliseconds())}throw new a.L8(a.Z7.InvalidOperator)}(t,r,e);if(T(r))return function(){throw new a.L8(a.Z7.InvalidOperator)}();if(A(r))return function(e,t,r){if("-"===r)return e.toDateTime().diff(t.toDateTimeLuxon(e.toDateTime().zone)).as("days");throw new a.L8(a.Z7.InvalidOperator)}(t,r,e);if(C(r))return function(e,t,r){if("-"===r)return e.toDateTime().diff(t.toDateTime()).as("days");throw new a.L8(a.Z7.InvalidOperator)}(t,r,e);if(F(r))return function(e,t,r){if("-"===r)return e.toDateTime().diff(t).as("days");throw new a.L8(a.Z7.InvalidOperator)}(t,r,e);if(I(r))return function(){throw new a.L8(a.Z7.InvalidOperator)}();throw new a.L8(a.Z7.InvalidOperator)}if(I(t)){if(S(r))return function(e,t,r){const n=parseFloat(e);if(isNaN(n))throw new a.L8(a.Z7.InvalidOperator);return W(n,t,r)}(t,r,e);if(M(r))return function(){throw new a.L8(a.Z7.InvalidOperator)}();if(T(r))return function(){throw new a.L8(a.Z7.InvalidOperator)}();if(A(r))return function(){throw new a.L8(a.Z7.InvalidOperator)}();if(C(r))return function(){throw new a.L8(a.Z7.InvalidOperator)}();if(F(r))return function(){throw new a.L8(a.Z7.InvalidOperator)}();if(I(r))return function(e,t,r){if("+"===r)return e+t;throw new a.L8(a.Z7.InvalidOperator)}(t,r,e);throw new a.L8(a.Z7.InvalidOperator)}throw new a.L8(a.Z7.InvalidOperator)}function W(e,t,r){switch(r){case"+":return e+t;case"-":return e-t;case"*":return e*t;case"/":return e/t}throw new a.L8(a.Z7.InvalidOperator)}function H(e,t,r,n){var i=Error.call(this,e);return Object.setPrototypeOf&&Object.setPrototypeOf(i,H.prototype),i.expected=t,i.found=r,i.location=n,i.name="SyntaxError",i}function Q(e,t,r){return r=r||" ",e.length>t?e:(t-=e.length,e+(r+=r.repeat(t)).slice(0,t))}(function(e,t){function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r})(H,Error),H.prototype.format=function(e){var t="Error: "+this.message;if(this.location){var r,n=null;for(r=0;r<e.length;r++)if(e[r].source===this.location.source){n=e[r].text.split(/\r\n|\n|\r/g);break}var i=this.location.start,s=this.location.source&&"function"==typeof this.location.source.offset?this.location.source.offset(i):i,o=this.location.source+":"+s.line+":"+s.column;if(n){var a=this.location.end,l=Q("",s.line.toString().length," "),u=n[i.line-1],c=(i.line===a.line?a.column:u.length+1)-i.column||1;t+="\n --\x3e "+o+"\n"+l+" |\n"+s.line+" | "+u+"\n"+l+" | "+Q("",i.column-1," ")+Q("",c,"^")}else t+="\n at "+o}return t},H.buildMessage=function(e,t){var r={literal:function(e){return'"'+i(e.text)+'"'},class:function(e){var t=e.parts.map((function(e){return Array.isArray(e)?s(e[0])+"-"+s(e[1]):s(e)}));return"["+(e.inverted?"^":"")+t.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(e){return e.description}};function n(e){return e.charCodeAt(0).toString(16).toUpperCase()}function i(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+n(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+n(e)}))}function s(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+n(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+n(e)}))}function o(e){return r[e.type](e)}return"Expected "+function(e){var t,r,n=e.map(o);if(n.sort(),n.length>0){for(t=1,r=1;t<n.length;t++)n[t-1]!==n[t]&&(n[r]=n[t],r++);n.length=r}switch(n.length){case 1:return n[0];case 2:return n[0]+" or "+n[1];default:return n.slice(0,-1).join(", ")+", or "+n[n.length-1]}}(e)+" but "+function(e){return e?'"'+i(e)+'"':"end of input"}(t)+" found."};class K{static parse(e){return function(e,t){var r,n={},i=(t=void 0!==t?t:{}).grammarSource,s={start:rs},o=rs,a="!",l="=",u=">=",c=">",p="<=",d="<>",h="!=",f="||",y="@",m="'",g="N'",w="''",_=".",v="null",b="true",S="false",I="in",M="is",x="like",F="escape",A="not",T="and",C="or",E="between",L="from",O="for",R="substring",k="extract",N="trim",D="position",P="timestamp",Z="date",j="time",V="leading",U="trailing",z="both",G="cast",q="as",B="integer",$="int",J="smallint",W="float",Q="real",K="varchar",Y="to",X="interval",ee="year",te="timezone_hour",re="timezone_minute",ne="month",ie="day",se="hour",oe="minute",ae="second",le="case",ue="end",ce="when",pe="then",de="else",he=",",fe="(",ye=")",me="`",ge=/^[<-=]/,we=/^[+\-]/,_e=/^[*\/]/,ve=/^[A-Za-z_\x80-\uFFFF]/,be=/^[A-Za-z0-9_]/,Se=/^[A-Za-z0-9_.\x80-\uFFFF]/,Ie=/^["]/,Me=/^[^']/,xe=/^[0-9]/,Fe=/^[eE]/,Ae=/^[ \t\n\r]/,Te=/^[^`]/,Ce=Qi("!",!1),Ee=Qi("=",!1),Le=Qi(">=",!1),Oe=Qi(">",!1),Re=Qi("<=",!1),ke=Qi("<>",!1),Ne=Ki([["<","="]],!1,!1),De=Qi("!=",!1),Pe=Ki(["+","-"],!1,!1),Ze=Qi("||",!1),je=Ki(["*","/"],!1,!1),Ve=Ki([["A","Z"],["a","z"],"_",["","￿"]],!1,!1),Ue=Ki([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),ze=Ki([["A","Z"],["a","z"],["0","9"],"_",".",["","￿"]],!1,!1),Ge=Ki(['"'],!1,!1),qe=Qi("@",!1),Be=Qi("'",!1),$e=Qi("N'",!1),Je=Qi("''",!1),We=Ki(["'"],!0,!1),He=Qi(".",!1),Qe=Ki([["0","9"]],!1,!1),Ke=Ki(["e","E"],!1,!1),Ye=Qi("NULL",!0),Xe=Qi("TRUE",!0),et=Qi("FALSE",!0),tt=Qi("IN",!0),rt=Qi("IS",!0),nt=Qi("LIKE",!0),it=Qi("ESCAPE",!0),st=Qi("NOT",!0),ot=Qi("AND",!0),at=Qi("OR",!0),lt=Qi("BETWEEN",!0),ut=Qi("FROM",!0),ct=Qi("FOR",!0),pt=Qi("SUBSTRING",!0),dt=Qi("EXTRACT",!0),ht=Qi("TRIM",!0),ft=Qi("POSITION",!0),yt=Qi("TIMESTAMP",!0),mt=Qi("DATE",!0),gt=Qi("TIME",!0),wt=Qi("LEADING",!0),_t=Qi("TRAILING",!0),vt=Qi("BOTH",!0),bt=Qi("CAST",!0),St=Qi("AS",!0),It=Qi("INTEGER",!0),Mt=Qi("INT",!0),xt=Qi("SMALLINT",!0),Ft=Qi("FLOAT",!0),At=Qi("REAL",!0),Tt=Qi("VARCHAR",!0),Ct=Qi("TO",!0),Et=Qi("INTERVAL",!0),Lt=Qi("YEAR",!0),Ot=Qi("TIMEZONE_HOUR",!0),Rt=Qi("TIMEZONE_MINUTE",!0),kt=Qi("MONTH",!0),Nt=Qi("DAY",!0),Dt=Qi("HOUR",!0),Pt=Qi("MINUTE",!0),Zt=Qi("SECOND",!0),jt=Qi("CASE",!0),Vt=Qi("END",!0),Ut=Qi("WHEN",!0),zt=Qi("THEN",!0),Gt=Qi("ELSE",!0),qt=Qi(",",!1),Bt=Qi("(",!1),$t=Qi(")",!1),Jt=Ki([" ","\t","\n","\r"],!1,!1),Wt=Qi("`",!1),Ht=Ki(["`"],!0,!1),Qt=function(e){return e},Kt=function(e){return zo(Wi(),...e)},Yt=function(e,t,r){return{op:t,expr:r,location:Wi()}},Xt=function(e,t){return Go(e,t)},er=function(e,t,r){return{op:t,expr:r,location:Wi()}},tr=function(e,t){return Go(e,t)},rr=function(e){return function(e,t,r){return{type:"unary-expression",location:r,operator:"NOT",expr:t}}(0,e,Wi())},nr=function(e,t){return""==t||null==t||null==t?e:"arithmetic"==t.type?Go(e,t.tail):Uo(t.op,e,t.right,t.escape,Wi())},ir=function(e,t){return{op:e,expr:t,location:Wi()}},sr=function(e){return{type:"arithmetic",tail:e}},or=function(e,t){return{op:e+"NOT",right:t}},ar=function(e,t){return{op:e,right:t}},lr=function(e,t,r){return zo(Wi(),t,r)},ur=function(e,t){return{op:"NOT"+e,right:t}},cr=function(e,t,r){return zo(Wi(),t,r)},pr=function(e,t){return{op:e,right:t}},dr=function(e){return e[0]+" "+e[2]},hr=function(e){return e[0]+" "+e[2]},fr=function(e,t,r){return{op:e,right:t,escape:r.value}},yr=function(e,t){return{op:e,right:t,escape:""}},mr=function(e,t){return{op:e,right:t}},gr=function(e,t){return{op:e,right:t}},wr=function(e,t,r){return{op:t,expr:r,location:Wi()}},_r=function(e,t){return Go(e,t)},vr=function(e,t,r){return{op:t,expr:r,location:Wi()}},br=function(e,t){return Go(e,t)},Sr=function(e){return e.paren=!0,e},Ir=function(e){return/^CURRENT_DATE$/i.test(e)?{type:"current-time",location:Wi(),mode:"date"}:/^CURRENT_TIMESTAMP$/i.test(e)?{type:"current-time",location:Wi(),mode:"timestamp"}:/^CURRENT_TIME$/i.test(e)?{type:"current-time",location:Wi(),mode:"time"}:/^CURRENT_USER$/i.test(e)?{type:"current-user",location:Wi()}:{type:"column-reference",location:Wi(),table:"",column:e}},Mr=function(e){return{type:"column-reference",location:Wi(),table:"",column:e,delimited:!0}},xr=function(e){return e},Fr=function(e,t){return e+t.join("")},Ar=function(e,t){return e+t.join("")},Tr=function(e){return e},Cr=function(e){return e.join("")},Er=function(){return'"'},Lr=function(e){return{type:"parameter",location:Wi(),value:e[1]}},Or=function(e,t){return zo(Wi(),e,t)},Rr=function(e,t){return zo(Wi(),e,t)},kr=function(e){return{type:"function",location:Wi(),name:"extract",args:e}},Nr=function(e,t,r){return zo(Wi(),e,t,...r?[r]:[])},Dr=function(e,t,r){return zo(Wi(),e,t,r)},Pr=function(e){return{type:"function",location:Wi(),name:"substring",args:e}},Zr=function(e,t){return zo(Wi(),e,t)},jr=function(e,t){return zo(Wi(),e,t)},Vr=function(e){return{type:"function",location:Wi(),name:"cast",args:e}},Ur=function(){return{type:"data-type",location:Wi(),value:{type:"integer"}}},zr=function(){return{type:"data-type",location:Wi(),value:{type:"smallint"}}},Gr=function(){return{type:"data-type",location:Wi(),value:{type:"float"}}},qr=function(){return{type:"data-type",location:Wi(),value:{type:"real"}}},Br=function(){return{type:"data-type",location:Wi(),value:{type:"date"}}},$r=function(){return{type:"data-type",location:Wi(),value:{type:"timestamp"}}},Jr=function(){return{type:"data-type",location:Wi(),value:{type:"time"}}},Wr=function(e){return{type:"data-type",location:Wi(),value:{type:"varchar",size:parseInt(e)}}},Hr=function(e,t,r){return zo(Wi(),e,t,r)},Qr=function(e,t){return zo(Wi(),e,t)},Kr=function(e){return{type:"function",location:Wi(),name:"trim",args:e}},Yr=function(e){return{type:"string",location:Wi(),value:e??"BOTH"}},Xr=function(e,t){return zo(Wi(),e,t)},en=function(e,t){return zo(Wi(),e,t)},tn=function(e){return{type:"function",location:Wi(),name:"position",args:e}},rn=function(e,t){return{type:"function",location:Wi(),name:e,args:t}},nn=function(e){return{type:"string",location:Wi(),value:e}},sn=function(e){return"string"===e.type&&function(e){!0!==/^(\d{4})-(\d{1,2})-(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/.test(e)&&Hi("Timestamp literal is invalid")}(e.value),{type:"timestamp",location:Wi(),value:e.value}},on=function(e){return"string"===e.type&&function(e){!0!==/^(\d{1,2}):(\d{1,2}):(\d{1,2})$|^(\d{1,2}):(\d{1,2})$|^(\d{1,2}):(\d{1,2}):(\d{1,2}).([0-9]+)$/.test(e)&&Hi("Time literal is invalid")}(e.value),{type:"time",location:Wi(),value:e.value}},an=function(e,t,r){return{type:"interval",location:Wi(),value:t,qualifier:r,op:e}},ln=function(e,t){return{type:"interval",location:Wi(),value:e,qualifier:t,op:""}},un=function(e,t){return{type:"interval-qualifier",location:Wi(),start:e,end:t}},cn=function(e,t){return{type:"interval-period",location:Wi(),period:e.value,precision:t,secondary:null}},pn=function(e){return{type:"interval-period",location:Wi(),period:e.value,precision:null,secondary:null}},dn=function(e){return{type:"interval-period",location:Wi(),period:e.value,precision:null,secondary:null}},hn=function(e,t){return{type:"interval-period",location:Wi(),period:"second",precision:e,secondary:t}},fn=function(e){return{type:"interval-period",location:Wi(),period:"second",precision:e,secondary:null}},yn=function(){return{type:"interval-period",location:Wi(),period:"second",precision:null,secondary:null}},mn=function(e,t){return{type:"interval-period",location:Wi(),period:e.value,precision:t,secondary:null}},gn=function(e){return{type:"interval-period",location:Wi(),period:e.value,precision:null,secondary:null}},wn=function(e,t){return{type:"interval-period",location:Wi(),period:"second",precision:e,secondary:t}},_n=function(e){return{type:"interval-period",location:Wi(),period:"second",precision:e,secondary:null}},vn=function(){return{type:"interval-period",location:Wi(),period:"second",precision:null,secondary:null}},bn=function(){return{type:"string",location:Wi(),value:"day"}},Sn=function(){return{type:"string",location:Wi(),value:"hour"}},In=function(){return{type:"string",location:Wi(),value:"minute"}},Mn=function(){return{type:"string",location:Wi(),value:"month"}},xn=function(){return{type:"string",location:Wi(),value:"year"}},Fn=function(e){return parseFloat(e)},An=function(e){return parseFloat(e)},Tn=function(e){return"string"===e.type&&function(e){!0!==/^(\d{4})-(\d{1,2})-(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/.test(e)&&Hi("Date literal is invalid")}(e.value),{type:"date",location:Wi(),value:e.value}},Cn=function(){return{type:"null",location:Wi(),value:null}},En=function(){return{type:"boolean",location:Wi(),value:!0}},Ln=function(){return{type:"boolean",location:Wi(),value:!1}},On=function(){return"'"},Rn=function(e){return{type:"string",location:Wi(),value:e.join("")}},kn=function(e,t){return{type:"case-expression",location:Wi(),format:"simple",operand:e,clauses:t,else:null,elseLocation:null}},Nn=function(e,t,r){return{type:"case-expression",location:Wi(),format:"simple",operand:e,clauses:t,else:r.value,elseLocation:r.location}},Dn=function(e){return{type:"case-expression",location:Wi(),format:"searched",clauses:e,else:null,elseLocation:null}},Pn=function(e,t){return{type:"case-expression",location:Wi(),format:"searched",clauses:e,else:t.value,elseLocation:t.location}},Zn=function(e,t){return{type:"when-clause",location:Wi(),operand:e,value:t}},jn=function(e,t){return{type:"when-clause",location:Wi(),operand:e,value:t}},Vn=function(e){return{type:"else-clause",location:Wi(),value:e}},Un=function(e){return{type:"number",location:Wi(),value:e}},zn=function(e,t,r){return parseFloat(e+t+r)},Gn=function(e,t){return parseFloat(e+t)},qn=function(e,t){return parseFloat(e+t)},Bn=function(e){return parseFloat(e)},$n=function(e,t){return e[0]+t},Jn=function(e){return"."+(null!=e?e:"")},Wn=function(e,t){return e+t},Hn=function(e){return e.join("")},Qn=function(e,t){return"e"+(null===t?"":t)},Kn=function(){return"IN"},Yn=function(){return"IS"},Xn=function(){return"LIKE"},ei=function(){return"ESCAPE"},ti=function(){return"NOT"},ri=function(){return"AND"},ni=function(){return"OR"},ii=function(){return"BETWEEN"},si=function(){return"FROM"},oi=function(){return"FOR"},ai=function(){return"SUBSTRING"},li=function(){return"EXTRACT"},ui=function(){return"TRIM"},ci=function(){return"POSITION"},pi=function(){return"TIMESTAMP"},di=function(){return"DATE"},hi=function(){return"TIME"},fi=function(){return"LEADING"},yi=function(){return"TRAILING"},mi=function(){return"BOTH"},gi=function(){return"CAST"},wi=function(){return"AS"},_i=function(){return"INTEGER"},vi=function(){return"INT"},bi=function(){return"SMALLINT"},Si=function(){return"FLOAT"},Ii=function(){return"REAL"},Mi=function(){return"VARCHAR"},xi=function(){return"TO"},Fi=function(){return"INTERVAL"},Ai=function(){return"YEAR"},Ti=function(){return"TIMEZONE_HOUR"},Ci=function(){return"TIMEZONE_MINUTE"},Ei=function(){return"MONTH"},Li=function(){return"DAY"},Oi=function(){return"HOUR"},Ri=function(){return"MINUTE"},ki=function(){return"SECOND"},Ni=function(){return"CASE"},Di=function(){return"END"},Pi=function(){return"WHEN"},Zi=function(){return"THEN"},ji=function(){return"ELSE"},Vi=function(e){return e},Ui=function(e){return e.join("")},zi=0|t.peg$currPos,Gi=zi,qi=[{line:1,column:1}],Bi=zi,$i=t.peg$maxFailExpected||[],Ji=0|t.peg$silentFails;if(t.startRule){if(!(t.startRule in s))throw new Error("Can't start parsing from rule \""+t.startRule+'".');o=s[t.startRule]}function Wi(){return Xi(Gi,zi)}function Hi(e,t){throw ts(e,t=void 0!==t?t:Xi(Gi,zi))}function Qi(e,t){return{type:"literal",text:e,ignoreCase:t}}function Ki(e,t,r){return{type:"class",parts:e,inverted:t,ignoreCase:r}}function Yi(t){var r,n=qi[t];if(n)return n;if(t>=qi.length)r=qi.length-1;else for(r=t;!qi[--r];);for(n={line:(n=qi[r]).line,column:n.column};r<t;)10===e.charCodeAt(r)?(n.line++,n.column=1):n.column++,r++;return qi[t]=n,n}function Xi(e,t,r){var n=Yi(e),s=Yi(t);return{source:i,start:{offset:e,line:n.line,column:n.column},end:{offset:t,line:s.line,column:s.column}}}function es(e){zi<Bi||(zi>Bi&&(Bi=zi,$i=[]),$i.push(e))}function ts(e,t){return new H(e,null,null,t)}function rs(){var e,t;return e=zi,Zo(),(t=is())!==n?(Zo(),Gi=e,e=Qt(t)):(zi=e,e=n),e}function ns(){var e,t,r,i,s,o;if(e=zi,Do()!==n){for(Zo(),t=[],r=is();r!==n;)t.push(r),r=zi,i=zi,s=Zo(),(o=No())!==n?i=s=[s,o,Zo()]:(zi=i,i=n),i!==n&&(i=is())===n?(zi=r,r=n):r=i;r=Zo(),(i=Po())!==n?(Gi=e,e=Kt(t)):(zi=e,e=n)}else zi=e,e=n;return e}function is(){var e,t,r,i,s,o;if(e=zi,(t=ss())!==n){for(r=[],i=zi,Zo(),(s=Ks())!==n?(Zo(),(o=ss())!==n?(Gi=i,i=Yt(t,s,o)):(zi=i,i=n)):(zi=i,i=n);i!==n;)r.push(i),i=zi,Zo(),(s=Ks())!==n?(Zo(),(o=ss())!==n?(Gi=i,i=Yt(t,s,o)):(zi=i,i=n)):(zi=i,i=n);Gi=e,e=Xt(t,r)}else zi=e,e=n;return e}function ss(){var e,t,r,i,s,o;if(e=zi,(t=os())!==n){for(r=[],i=zi,Zo(),(s=Qs())!==n?(Zo(),(o=os())!==n?(Gi=i,i=er(t,s,o)):(zi=i,i=n)):(zi=i,i=n);i!==n;)r.push(i),i=zi,Zo(),(s=Qs())!==n?(Zo(),(o=os())!==n?(Gi=i,i=er(t,s,o)):(zi=i,i=n)):(zi=i,i=n);Gi=e,e=tr(t,r)}else zi=e,e=n;return e}function os(){var t,r,i,s,o;return t=zi,(r=Hs())===n&&(r=zi,33===e.charCodeAt(zi)?(i=a,zi++):(i=n,0===Ji&&es(Ce)),i!==n?(s=zi,Ji++,61===e.charCodeAt(zi)?(o=l,zi++):(o=n,0===Ji&&es(Ee)),Ji--,o===n?s=void 0:(zi=s,s=n),s!==n?r=i=[i,s]:(zi=r,r=n)):(zi=r,r=n)),r!==n?(i=Zo(),(s=os())!==n?(Gi=t,t=rr(s)):(zi=t,t=n)):(zi=t,t=n),t===n&&(t=function(){var e,t,r,i;return e=zi,(t=cs())!==n?(r=zi,Zo(),(i=function(){var e;return(e=function(){var e,t,r,i,s;if(e=zi,t=[],r=zi,Zo(),(i=as())!==n?(Zo(),(s=cs())!==n?(Gi=r,r=ir(i,s)):(zi=r,r=n)):(zi=r,r=n),r!==n)for(;r!==n;)t.push(r),r=zi,Zo(),(i=as())!==n?(Zo(),(s=cs())!==n?(Gi=r,r=ir(i,s)):(zi=r,r=n)):(zi=r,r=n);else t=n;return t!==n&&(Gi=e,t=sr(t)),t}())===n&&(e=function(){var e,t,r;return e=zi,(t=us())!==n?(Zo(),(r=ns())!==n?(Gi=e,e=mr(t,r)):(zi=e,e=n)):(zi=e,e=n),e===n&&(e=zi,(t=us())!==n?(Zo(),(r=Ss())!==n?(Gi=e,e=gr(t,r)):(zi=e,e=n)):(zi=e,e=n)),e}())===n&&(e=function(){var e,t,r,i,s,o,a,l;return e=zi,(t=Hs())!==n?(Zo(),(r=Ys())!==n?(i=Zo(),s=zi,(o=cs())!==n?(Zo(),(a=Qs())!==n?(Zo(),(l=cs())!==n?(Gi=s,s=lr(r,o,l)):(zi=s,s=n)):(zi=s,s=n)):(zi=s,s=n),s!==n?(Gi=e,e=ur(r,s)):(zi=e,e=n)):(zi=e,e=n)):(zi=e,e=n),e===n&&(e=zi,(t=Ys())!==n?(Zo(),r=zi,(i=cs())!==n?(s=Zo(),(o=Qs())!==n?(Zo(),(a=cs())!==n?(Gi=r,r=cr(t,i,a)):(zi=r,r=n)):(zi=r,r=n)):(zi=r,r=n),r!==n?(Gi=e,e=pr(t,r)):(zi=e,e=n)):(zi=e,e=n)),e}())===n&&(e=function(){var e,t,r,i;return e=zi,(t=$s())!==n?(Zo(),(r=Hs())!==n?(Zo(),(i=cs())!==n?(Gi=e,e=or(t,i)):(zi=e,e=n)):(zi=e,e=n)):(zi=e,e=n),e===n&&(e=zi,(t=$s())!==n?(Zo(),(r=cs())!==n?(Gi=e,e=ar(t,r)):(zi=e,e=n)):(zi=e,e=n)),e}())===n&&(e=function(){var e,t,r,i;return e=zi,(t=ls())!==n?(Zo(),(r=Ls())!==n?(Zo(),Ws()!==n?(Zo(),(i=Os())!==n?(Gi=e,e=fr(t,r,i)):(zi=e,e=n)):(zi=e,e=n)):(zi=e,e=n)):(zi=e,e=n),e===n&&(e=zi,(t=ls())!==n?(Zo(),(r=Ls())!==n?(Gi=e,e=yr(t,r)):(zi=e,e=n)):(zi=e,e=n)),e}()),e}())!==n?r=i:(zi=r,r=n),r===n&&(r=null),Gi=e,e=nr(t,r)):(zi=e,e=n),e}()),t}function as(){var t;return e.substr(zi,2)===u?(t=u,zi+=2):(t=n,0===Ji&&es(Le)),t===n&&(62===e.charCodeAt(zi)?(t=c,zi++):(t=n,0===Ji&&es(Oe)),t===n&&(e.substr(zi,2)===p?(t=p,zi+=2):(t=n,0===Ji&&es(Re)),t===n&&(e.substr(zi,2)===d?(t=d,zi+=2):(t=n,0===Ji&&es(ke)),t===n&&(t=e.charAt(zi),ge.test(t)?zi++:(t=n,0===Ji&&es(Ne)),t===n&&(e.substr(zi,2)===h?(t=h,zi+=2):(t=n,0===Ji&&es(De))))))),t}function ls(){var e,t,r,i,s;return e=zi,t=zi,(r=Hs())!==n?(i=Zo(),(s=Js())!==n?t=r=[r,i,s]:(zi=t,t=n)):(zi=t,t=n),t!==n&&(Gi=e,t=dr(t)),(e=t)===n&&(e=Js()),e}function us(){var e,t,r,i,s;return e=zi,t=zi,(r=Hs())!==n?(i=Zo(),(s=Bs())!==n?t=r=[r,i,s]:(zi=t,t=n)):(zi=t,t=n),t!==n&&(Gi=e,t=hr(t)),(e=t)===n&&(e=Bs()),e}function cs(){var e,t,r,i,s,o;if(e=zi,(t=ds())!==n){for(r=[],i=zi,Zo(),(s=ps())!==n?(Zo(),(o=ds())!==n?(Gi=i,i=wr(t,s,o)):(zi=i,i=n)):(zi=i,i=n);i!==n;)r.push(i),i=zi,Zo(),(s=ps())!==n?(Zo(),(o=ds())!==n?(Gi=i,i=wr(t,s,o)):(zi=i,i=n)):(zi=i,i=n);Gi=e,e=_r(t,r)}else zi=e,e=n;return e}function ps(){var t;return t=e.charAt(zi),we.test(t)?zi++:(t=n,0===Ji&&es(Pe)),t===n&&(e.substr(zi,2)===f?(t=f,zi+=2):(t=n,0===Ji&&es(Ze))),t}function ds(){var e,t,r,i,s,o;if(e=zi,(t=fs())!==n){for(r=[],i=zi,Zo(),(s=hs())!==n?(Zo(),(o=fs())!==n?(Gi=i,i=vr(t,s,o)):(zi=i,i=n)):(zi=i,i=n);i!==n;)r.push(i),i=zi,Zo(),(s=hs())!==n?(Zo(),(o=fs())!==n?(Gi=i,i=vr(t,s,o)):(zi=i,i=n)):(zi=i,i=n);Gi=e,e=br(t,r)}else zi=e,e=n;return e}function hs(){var t;return t=e.charAt(zi),_e.test(t)?zi++:(t=n,0===Ji&&es(je)),t}function fs(){var e,t;return(e=function(){var e;return(e=Os())===n&&(e=function(){var e,t,r,i;return e=zi,(t=function(){var e,t,r,i;return e=zi,(t=Ds())!==n&&(r=Ps())!==n&&(i=Zs())!==n?(Gi=e,e=zn(t,r,i)):(zi=e,e=n),e===n&&(e=zi,(t=Ds())!==n&&(r=Ps())!==n?(Gi=e,e=Gn(t,r)):(zi=e,e=n),e===n&&(e=zi,(t=Ds())!==n&&(r=Zs())!==n?(Gi=e,e=qn(t,r)):(zi=e,e=n),e===n&&(e=zi,(t=Ds())!==n&&(Gi=e,t=Bn(t)),e=t))),e}())!==n?(r=zi,Ji++,i=ms(),Ji--,i===n?r=void 0:(zi=r,r=n),r!==n?(Gi=e,e=Un(t)):(zi=e,e=n)):(zi=e,e=n),e}())===n&&(e=function(){var e,t;return e=zi,(t=Gs())!==n&&(Gi=e,t=En()),(e=t)===n&&(e=zi,(t=qs())!==n&&(Gi=e,t=Ln()),e=t),e}())===n&&(e=function(){var e,t;return e=zi,(t=zs())!==n&&(Gi=e,t=Cn()),t}())===n&&(e=function(){var e,t;return e=zi,oo()!==n?(Zo(),(t=Ls())!==n?(Gi=e,e=Tn(t)):(zi=e,e=n)):(zi=e,e=n),e}())===n&&(e=function(){var e,t;return e=zi,so()!==n?(Zo(),(t=Ls())!==n?(Gi=e,e=sn(t)):(zi=e,e=n)):(zi=e,e=n),e}())===n&&(e=Fs())===n&&(e=function(){var e,t;return e=zi,ao()!==n?(Zo(),(t=Ls())!==n?(Gi=e,e=on(t)):(zi=e,e=n)):(zi=e,e=n),e}()),e}())===n&&(e=function(){var e,t,r,i;return e=zi,ro()!==n?(Zo(),t=zi,Do()!==n?(Zo(),(r=xs())!==n?(Zo(),Xs()!==n?(Zo(),(i=is())!==n?(Zo(),Po()!==n?(Gi=t,t=Or(r,i)):(zi=t,t=n)):(zi=t,t=n)):(zi=t,t=n)):(zi=t,t=n)):(zi=t,t=n),t===n&&(t=zi,Do()!==n?(Zo(),(r=xs())!==n?(Zo(),No()!==n?(Zo(),(i=is())!==n?(Zo(),Po()!==n?(Gi=t,t=Rr(r,i)):(zi=t,t=n)):(zi=t,t=n)):(zi=t,t=n)):(zi=t,t=n)):(zi=t,t=n)),t!==n?(Gi=e,e=kr(t)):(zi=e,e=n)):(zi=e,e=n),e}())===n&&(e=function(){var e,t,r,i,s,o,a;return e=zi,to()!==n?(Zo(),t=zi,Do()!==n?(Zo(),(r=is())!==n?(Zo(),Xs()!==n?(Zo(),(i=is())!==n?(Zo(),s=zi,eo()!==n?(o=Zo(),(a=is())!==n?(Zo(),s=a):(zi=s,s=n)):(zi=s,s=n),s===n&&(s=null),Po()!==n?(Gi=t,t=Nr(r,i,s)):(zi=t,t=n)):(zi=t,t=n)):(zi=t,t=n)):(zi=t,t=n)):(zi=t,t=n),t===n&&(t=zi,Do()!==n?(Zo(),(r=is())!==n?(Zo(),No()!==n?(Zo(),(i=is())!==n?(Zo(),(s=No())!==n?(Zo(),(o=is())!==n&&(a=Po())!==n?(Gi=t,t=Dr(r,i,o)):(zi=t,t=n)):(zi=t,t=n)):(zi=t,t=n)):(zi=t,t=n)):(zi=t,t=n)):(zi=t,t=n)),t!==n?(Gi=e,e=Pr(t)):(zi=e,e=n)):(zi=e,e=n),e}())===n&&(e=function(){var e,t,r,i,s;return e=zi,no()!==n?(Zo(),t=zi,Do()!==n?(Zo(),r=Ms(),Zo(),(i=is())!==n?(Zo(),Xs()!==n?(Zo(),(s=is())!==n?(Zo(),Po()!==n?(Gi=t,t=Hr(r,i,s)):(zi=t,t=n)):(zi=t,t=n)):(zi=t,t=n)):(zi=t,t=n)):(zi=t,t=n),t===n&&(t=zi,Do()!==n?(Zo(),r=Ms(),Zo(),(i=is())!==n?(Zo(),Po()!==n?(Gi=t,t=Qr(r,i)):(zi=t,t=n)):(zi=t,t=n)):(zi=t,t=n)),t!==n?(Gi=e,e=Kr(t)):(zi=e,e=n)):(zi=e,e=n),e}())===n&&(e=function(){var e,t,r,i;return e=zi,io()!==n?(Zo(),t=zi,Do()!==n?(Zo(),(r=is())!==n?(Zo(),Bs()!==n?(Zo(),(i=is())!==n?(Zo(),Po()!==n?(Gi=t,t=Xr(r,i)):(zi=t,t=n)):(zi=t,t=n)):(zi=t,t=n)):(zi=t,t=n)):(zi=t,t=n),t===n&&(t=zi,Do()!==n?(Zo(),(r=is())!==n?(Zo(),No()!==n?(Zo(),(i=is())!==n?(Zo(),Po()!==n?(Gi=t,t=en(r,i)):(zi=t,t=n)):(zi=t,t=n)):(zi=t,t=n)):(zi=t,t=n)):(zi=t,t=n)),t!==n?(Gi=e,e=tn(t)):(zi=e,e=n)):(zi=e,e=n),e}())===n&&(e=function(){var e,t,r,i;return e=zi,po()!==n?(Zo(),t=zi,Do()!==n?(Zo(),(r=is())!==n?(Zo(),ho()!==n?(Zo(),(i=Is())!==n?(Zo(),Po()!==n?(Gi=t,t=Zr(r,i)):(zi=t,t=n)):(zi=t,t=n)):(zi=t,t=n)):(zi=t,t=n)):(zi=t,t=n),t===n&&(t=zi,Do()!==n?(Zo(),(r=is())!==n?(Zo(),No()!==n?(Zo(),(i=Is())!==n?(Zo(),Po()!==n?(Gi=t,t=jr(r,i)):(zi=t,t=n)):(zi=t,t=n)):(zi=t,t=n)):(zi=t,t=n)):(zi=t,t=n)),t!==n?(Gi=e,e=Vr(t)):(zi=e,e=n)):(zi=e,e=n),e}())===n&&(e=function(){var e,t,r,i;return e=zi,t=zi,Ji++,r=ro(),Ji--,r===n?t=void 0:(zi=t,t=n),t!==n&&(r=Vo())!==n?(Zo(),(i=ns())!==n?(Gi=e,e=rn(r,i)):(zi=e,e=n)):(zi=e,e=n),e}())===n&&(e=function(){var e;return(e=function(){var e,t,r,i,s;if(e=zi,Eo()!==n)if(Zo(),(t=is())!==n){for(Zo(),r=[],i=zi,(s=ks())!==n?(Zo(),i=s):(zi=i,i=n);i!==n;)r.push(i),i=zi,(s=ks())!==n?(Zo(),i=s):(zi=i,i=n);(i=Lo())!==n?(Gi=e,e=kn(t,r)):(zi=e,e=n)}else zi=e,e=n;else zi=e,e=n;if(e===n)if(e=zi,Eo()!==n)if(Zo(),(t=is())!==n){for(Zo(),r=[],i=zi,(s=ks())!==n?(Zo(),i=s):(zi=i,i=n);i!==n;)r.push(i),i=zi,(s=ks())!==n?(Zo(),i=s):(zi=i,i=n);(i=Ns())!==n?(s=Zo(),Lo()!==n?(Gi=e,e=Nn(t,r,i)):(zi=e,e=n)):(zi=e,e=n)}else zi=e,e=n;else zi=e,e=n;return e}())===n&&(e=function(){var e,t,r,i;if(e=zi,Eo()!==n){for(Zo(),t=[],r=zi,(i=Rs())!==n?(Zo(),r=i):(zi=r,r=n);r!==n;)t.push(r),r=zi,(i=Rs())!==n?(Zo(),r=i):(zi=r,r=n);(r=Lo())!==n?(Gi=e,e=Dn(t)):(zi=e,e=n)}else zi=e,e=n;if(e===n)if(e=zi,Eo()!==n){for(Zo(),t=[],r=zi,(i=Rs())!==n?(Zo(),r=i):(zi=r,r=n);r!==n;)t.push(r),r=zi,(i=Rs())!==n?(Zo(),r=i):(zi=r,r=n);(r=Ns())!==n?(i=Zo(),Lo()!==n?(Gi=e,e=Pn(t,r)):(zi=e,e=n)):(zi=e,e=n)}else zi=e,e=n;return e}()),e}())===n&&(e=function(){var e,t;return e=zi,(t=function(){var e,t;return e=zi,(t=function(){var e,t,r,i;if(e=zi,(t=ms())!==n){for(r=[],i=ws();i!==n;)r.push(i),i=ws();Gi=e,e=Fr(t,r)}else zi=e,e=n;return e}())!==n&&(Gi=e,t=xr(t)),t}())!==n&&(Gi=e,t=Ir(t)),(e=t)===n&&(e=zi,(t=function(){var e,t;return e=zi,bs()!==n?(t=function(){var e,t,r;for(e=zi,t=[],r=_s();r!==n;)t.push(r),r=_s();return Gi=e,Cr(t)}(),bs()!==n?(Gi=e,e=Tr(t)):(zi=e,e=n)):(zi=e,e=n),e}())!==n&&(Gi=e,t=Mr(t)),e=t),e}())===n&&(e=Ss())===n&&(e=zi,Do()!==n?(Zo(),(t=is())!==n?(Zo(),Po()!==n?(Gi=e,e=Sr(t)):(zi=e,e=n)):(zi=e,e=n)):(zi=e,e=n)),e}function ys(){var e,t,r,i;if(e=zi,(t=ms())!==n){for(r=[],i=gs();i!==n;)r.push(i),i=gs();Gi=e,e=Ar(t,r)}else zi=e,e=n;return e}function ms(){var t;return t=e.charAt(zi),ve.test(t)?zi++:(t=n,0===Ji&&es(Ve)),t}function gs(){var t;return t=e.charAt(zi),be.test(t)?zi++:(t=n,0===Ji&&es(Ue)),t}function ws(){var t;return t=e.charAt(zi),Se.test(t)?zi++:(t=n,0===Ji&&es(ze)),t}function _s(){var e;return(e=vs())===n&&(e=function(){var e;return e=zi,bs()!==n&&bs()!==n?(Gi=e,e=Er()):(zi=e,e=n),e}()),e}function vs(){var t;return t=e.charAt(zi),Se.test(t)?zi++:(t=n,0===Ji&&es(ze)),t}function bs(){var t;return t=e.charAt(zi),Ie.test(t)?zi++:(t=n,0===Ji&&es(Ge)),t}function Ss(){var t,r,i,s;return t=zi,r=zi,64===e.charCodeAt(zi)?(i=y,zi++):(i=n,0===Ji&&es(qe)),i!==n&&(s=ys())!==n?r=i=[i,s]:(zi=r,r=n),r!==n&&(Gi=t,r=Lr(r)),r}function Is(){var e,t,r;return e=zi,(t=fo())===n&&(t=yo()),t!==n&&(Gi=e,t=Ur()),(e=t)===n&&(e=zi,(t=mo())!==n&&(Gi=e,t=zr()),(e=t)===n&&(e=zi,(t=go())!==n&&(Gi=e,t=Gr()),(e=t)===n&&(e=zi,(t=wo())!==n&&(Gi=e,t=qr()),(e=t)===n&&(e=zi,(t=oo())!==n&&(Gi=e,t=Br()),(e=t)===n&&(e=zi,(t=so())!==n&&(Gi=e,t=$r()),(e=t)===n&&(e=zi,(t=ao())!==n&&(Gi=e,t=Jr()),(e=t)===n&&(e=zi,(t=_o())!==n?(Zo(),Do()!==n?(Zo(),(r=js())!==n?(Zo(),Po()!==n?(Gi=e,e=Wr(r)):(zi=e,e=n)):(zi=e,e=n)):(zi=e,e=n)):(zi=e,e=n)))))))),e}function Ms(){var e,t;return e=zi,(t=lo())===n&&(t=uo())===n&&(t=co()),t===n&&(t=null),Gi=e,Yr(t)}function xs(){var e,t;return e=zi,(t=So())===n&&(t=xo())===n&&(t=Fo())===n&&(t=Ao())===n&&(t=To())===n&&(t=Co())===n&&(t=Io())===n&&(t=Mo()),t!==n&&(Gi=e,t=nn(t)),t}function Fs(){var t,r,i,s;return t=zi,bo()!==n?(Zo(),r=e.charAt(zi),we.test(r)?zi++:(r=n,0===Ji&&es(Pe)),r!==n?(Zo(),(i=Ls())!==n?(Zo(),(s=As())!==n?(Gi=t,t=an(r,i,s)):(zi=t,t=n)):(zi=t,t=n)):(zi=t,t=n)):(zi=t,t=n),t===n&&(t=zi,bo()!==n?(Zo(),(r=Ls())!==n?(Zo(),(i=As())!==n?(Gi=t,t=ln(r,i)):(zi=t,t=n)):(zi=t,t=n)):(zi=t,t=n)),t}function As(){var e,t,r;return e=zi,(t=function(){var e,t,r;return e=zi,(t=Ts())!==n?(Zo(),Do()!==n?(Zo(),(r=Es())!==n?(Zo(),Po()!==n?(Gi=e,e=cn(t,r)):(zi=e,e=n)):(zi=e,e=n)):(zi=e,e=n)):(zi=e,e=n),e===n&&(e=zi,(t=Ts())!==n&&(Gi=e,t=pn(t)),e=t),e}())!==n?(Zo(),vo()!==n?(Zo(),(r=function(){var e,t,r,i;return e=zi,(t=Ts())!==n&&(Gi=e,t=dn(t)),(e=t)===n&&(e=zi,(t=Co())!==n?(Zo(),Do()!==n?(Zo(),(r=Es())!==n?(Zo(),No()!==n?(Zo(),(i=Cs())!==n?(Zo(),Po()!==n?(Gi=e,e=hn(r,i)):(zi=e,e=n)):(zi=e,e=n)):(zi=e,e=n)):(zi=e,e=n)):(zi=e,e=n)):(zi=e,e=n),e===n&&(e=zi,(t=Co())!==n?(Zo(),Do()!==n?(Zo(),(r=Es())!==n?(Zo(),Po()!==n?(Gi=e,e=fn(r)):(zi=e,e=n)):(zi=e,e=n)):(zi=e,e=n)):(zi=e,e=n),e===n&&(e=zi,(t=Co())!==n&&(Gi=e,t=yn()),e=t))),e}())!==n?(Gi=e,e=un(t,r)):(zi=e,e=n)):(zi=e,e=n)):(zi=e,e=n),e===n&&(e=function(){var e,t,r,i;return e=zi,(t=Ts())!==n?(Zo(),Do()!==n?(Zo(),(r=Cs())!==n?(Zo(),Po()!==n?(Gi=e,e=mn(t,r)):(zi=e,e=n)):(zi=e,e=n)):(zi=e,e=n)):(zi=e,e=n),e===n&&(e=zi,(t=Ts())!==n&&(Gi=e,t=gn(t)),(e=t)===n&&(e=zi,(t=Co())!==n?(Zo(),Do()!==n?(Zo(),(r=Es())!==n?(Zo(),No()!==n?(Zo(),(i=Cs())!==n?(Zo(),Po()!==n?(Gi=e,e=wn(r,i)):(zi=e,e=n)):(zi=e,e=n)):(zi=e,e=n)):(zi=e,e=n)):(zi=e,e=n)):(zi=e,e=n),e===n&&(e=zi,(t=Co())!==n?(Zo(),Do()!==n?(Zo(),(r=Cs())!==n?(Zo(),Po()!==n?(Gi=e,e=_n(r)):(zi=e,e=n)):(zi=e,e=n)):(zi=e,e=n)):(zi=e,e=n),e===n&&(e=zi,(t=Co())!==n&&(Gi=e,t=vn()),e=t)))),e}()),e}function Ts(){var e,t;return e=zi,(t=Fo())!==n&&(Gi=e,t=bn()),(e=t)===n&&(e=zi,(t=Ao())!==n&&(Gi=e,t=Sn()),(e=t)===n&&(e=zi,(t=To())!==n&&(Gi=e,t=In()),(e=t)===n&&(e=zi,(t=xo())!==n&&(Gi=e,t=Mn()),(e=t)===n&&(e=zi,(t=So())!==n&&(Gi=e,t=xn()),e=t)))),e}function Cs(){var e,t;return e=zi,(t=js())!==n&&(Gi=e,t=Fn(t)),t}function Es(){var e,t;return e=zi,(t=js())!==n&&(Gi=e,t=An(t)),t}function Ls(){var e;return(e=Os())===n&&(e=Ss()),e}function Os(){var t,r,i,s,o;if(t=zi,39===e.charCodeAt(zi)?(r=m,zi++):(r=n,0===Ji&&es(Be)),r===n&&(e.substr(zi,2)===g?(r=g,zi+=2):(r=n,0===Ji&&es($e))),r!==n){for(i=[],s=zi,e.substr(zi,2)===w?(o=w,zi+=2):(o=n,0===Ji&&es(Je)),o!==n&&(Gi=s,o=On()),(s=o)===n&&(s=e.charAt(zi),Me.test(s)?zi++:(s=n,0===Ji&&es(We)));s!==n;)i.push(s),s=zi,e.substr(zi,2)===w?(o=w,zi+=2):(o=n,0===Ji&&es(Je)),o!==n&&(Gi=s,o=On()),(s=o)===n&&(s=e.charAt(zi),Me.test(s)?zi++:(s=n,0===Ji&&es(We)));39===e.charCodeAt(zi)?(s=m,zi++):(s=n,0===Ji&&es(Be)),s!==n?(Gi=t,t=Rn(i)):(zi=t,t=n)}else zi=t,t=n;return t}function Rs(){var e,t,r;return e=zi,Oo()!==n?(Zo(),(t=is())!==n?(Zo(),Ro()!==n?(Zo(),(r=is())!==n?(Gi=e,e=Zn(t,r)):(zi=e,e=n)):(zi=e,e=n)):(zi=e,e=n)):(zi=e,e=n),e}function ks(){var e,t,r;return e=zi,Oo()!==n?(Zo(),(t=is())!==n?(Zo(),Ro()!==n?(Zo(),(r=is())!==n?(Gi=e,e=jn(t,r)):(zi=e,e=n)):(zi=e,e=n)):(zi=e,e=n)):(zi=e,e=n),e}function Ns(){var e,t;return e=zi,ko()!==n?(Zo(),(t=is())!==n?(Gi=e,e=Vn(t)):(zi=e,e=n)):(zi=e,e=n),e}function Ds(){var t,r,i;return(t=js())===n&&(t=zi,r=e.charAt(zi),we.test(r)?zi++:(r=n,0===Ji&&es(Pe)),r!==n&&(i=js())!==n?(Gi=t,t=$n(r,i)):(zi=t,t=n)),t}function Ps(){var t,r,i;return t=zi,46===e.charCodeAt(zi)?(r=_,zi++):(r=n,0===Ji&&es(He)),r!==n?((i=js())===n&&(i=null),Gi=t,t=Jn(i)):(zi=t,t=n),t}function Zs(){var e,t,r;return e=zi,(t=Us())!==n&&(r=js())!==n?(Gi=e,e=Wn(t,r)):(zi=e,e=n),e}function js(){var e,t,r;if(e=zi,t=[],(r=Vs())!==n)for(;r!==n;)t.push(r),r=Vs();else t=n;return t!==n&&(Gi=e,t=Hn(t)),t}function Vs(){var t;return t=e.charAt(zi),xe.test(t)?zi++:(t=n,0===Ji&&es(Qe)),t}function Us(){var t,r,i;return t=zi,r=e.charAt(zi),Fe.test(r)?zi++:(r=n,0===Ji&&es(Ke)),r!==n?(i=e.charAt(zi),we.test(i)?zi++:(i=n,0===Ji&&es(Pe)),i===n&&(i=null),Gi=t,t=Qn(r,i)):(zi=t,t=n),t}function zs(){var t,r,i,s;return t=zi,(r=e.substr(zi,4)).toLowerCase()===v?zi+=4:(r=n,0===Ji&&es(Ye)),r!==n?(i=zi,Ji++,s=gs(),Ji--,s===n?i=void 0:(zi=i,i=n),i!==n?t=r=[r,i]:(zi=t,t=n)):(zi=t,t=n),t}function Gs(){var t,r,i,s;return t=zi,(r=e.substr(zi,4)).toLowerCase()===b?zi+=4:(r=n,0===Ji&&es(Xe)),r!==n?(i=zi,Ji++,s=gs(),Ji--,s===n?i=void 0:(zi=i,i=n),i!==n?t=r=[r,i]:(zi=t,t=n)):(zi=t,t=n),t}function qs(){var t,r,i,s;return t=zi,(r=e.substr(zi,5)).toLowerCase()===S?zi+=5:(r=n,0===Ji&&es(et)),r!==n?(i=zi,Ji++,s=gs(),Ji--,s===n?i=void 0:(zi=i,i=n),i!==n?t=r=[r,i]:(zi=t,t=n)):(zi=t,t=n),t}function Bs(){var t,r,i,s;return t=zi,(r=e.substr(zi,2)).toLowerCase()===I?zi+=2:(r=n,0===Ji&&es(tt)),r!==n?(i=zi,Ji++,s=gs(),Ji--,s===n?i=void 0:(zi=i,i=n),i!==n?(Gi=t,t=Kn()):(zi=t,t=n)):(zi=t,t=n),t}function $s(){var t,r,i,s;return t=zi,(r=e.substr(zi,2)).toLowerCase()===M?zi+=2:(r=n,0===Ji&&es(rt)),r!==n?(i=zi,Ji++,s=gs(),Ji--,s===n?i=void 0:(zi=i,i=n),i!==n?(Gi=t,t=Yn()):(zi=t,t=n)):(zi=t,t=n),t}function Js(){var t,r,i,s;return t=zi,(r=e.substr(zi,4)).toLowerCase()===x?zi+=4:(r=n,0===Ji&&es(nt)),r!==n?(i=zi,Ji++,s=gs(),Ji--,s===n?i=void 0:(zi=i,i=n),i!==n?(Gi=t,t=Xn()):(zi=t,t=n)):(zi=t,t=n),t}function Ws(){var t,r,i,s;return t=zi,(r=e.substr(zi,6)).toLowerCase()===F?zi+=6:(r=n,0===Ji&&es(it)),r!==n?(i=zi,Ji++,s=gs(),Ji--,s===n?i=void 0:(zi=i,i=n),i!==n?(Gi=t,t=ei()):(zi=t,t=n)):(zi=t,t=n),t}function Hs(){var t,r,i,s;return t=zi,(r=e.substr(zi,3)).toLowerCase()===A?zi+=3:(r=n,0===Ji&&es(st)),r!==n?(i=zi,Ji++,s=gs(),Ji--,s===n?i=void 0:(zi=i,i=n),i!==n?(Gi=t,t=ti()):(zi=t,t=n)):(zi=t,t=n),t}function Qs(){var t,r,i,s;return t=zi,(r=e.substr(zi,3)).toLowerCase()===T?zi+=3:(r=n,0===Ji&&es(ot)),r!==n?(i=zi,Ji++,s=gs(),Ji--,s===n?i=void 0:(zi=i,i=n),i!==n?(Gi=t,t=ri()):(zi=t,t=n)):(zi=t,t=n),t}function Ks(){var t,r,i,s;return t=zi,(r=e.substr(zi,2)).toLowerCase()===C?zi+=2:(r=n,0===Ji&&es(at)),r!==n?(i=zi,Ji++,s=gs(),Ji--,s===n?i=void 0:(zi=i,i=n),i!==n?(Gi=t,t=ni()):(zi=t,t=n)):(zi=t,t=n),t}function Ys(){var t,r,i,s;return t=zi,(r=e.substr(zi,7)).toLowerCase()===E?zi+=7:(r=n,0===Ji&&es(lt)),r!==n?(i=zi,Ji++,s=gs(),Ji--,s===n?i=void 0:(zi=i,i=n),i!==n?(Gi=t,t=ii()):(zi=t,t=n)):(zi=t,t=n),t}function Xs(){var t,r,i,s;return t=zi,(r=e.substr(zi,4)).toLowerCase()===L?zi+=4:(r=n,0===Ji&&es(ut)),r!==n?(i=zi,Ji++,s=gs(),Ji--,s===n?i=void 0:(zi=i,i=n),i!==n?(Gi=t,t=si()):(zi=t,t=n)):(zi=t,t=n),t}function eo(){var t,r,i,s;return t=zi,(r=e.substr(zi,3)).toLowerCase()===O?zi+=3:(r=n,0===Ji&&es(ct)),r!==n?(i=zi,Ji++,s=gs(),Ji--,s===n?i=void 0:(zi=i,i=n),i!==n?(Gi=t,t=oi()):(zi=t,t=n)):(zi=t,t=n),t}function to(){var t,r,i,s;return t=zi,(r=e.substr(zi,9)).toLowerCase()===R?zi+=9:(r=n,0===Ji&&es(pt)),r!==n?(i=zi,Ji++,s=gs(),Ji--,s===n?i=void 0:(zi=i,i=n),i!==n?(Gi=t,t=ai()):(zi=t,t=n)):(zi=t,t=n),t}function ro(){var t,r,i,s;return t=zi,(r=e.substr(zi,7)).toLowerCase()===k?zi+=7:(r=n,0===Ji&&es(dt)),r!==n?(i=zi,Ji++,s=gs(),Ji--,s===n?i=void 0:(zi=i,i=n),i!==n?(Gi=t,t=li()):(zi=t,t=n)):(zi=t,t=n),t}function no(){var t,r,i,s;return t=zi,(r=e.substr(zi,4)).toLowerCase()===N?zi+=4:(r=n,0===Ji&&es(ht)),r!==n?(i=zi,Ji++,s=gs(),Ji--,s===n?i=void 0:(zi=i,i=n),i!==n?(Gi=t,t=ui()):(zi=t,t=n)):(zi=t,t=n),t}function io(){var t,r,i,s;return t=zi,(r=e.substr(zi,8)).toLowerCase()===D?zi+=8:(r=n,0===Ji&&es(ft)),r!==n?(i=zi,Ji++,s=gs(),Ji--,s===n?i=void 0:(zi=i,i=n),i!==n?(Gi=t,t=ci()):(zi=t,t=n)):(zi=t,t=n),t}function so(){var t,r,i,s;return t=zi,(r=e.substr(zi,9)).toLowerCase()===P?zi+=9:(r=n,0===Ji&&es(yt)),r!==n?(i=zi,Ji++,s=gs(),Ji--,s===n?i=void 0:(zi=i,i=n),i!==n?(Gi=t,t=pi()):(zi=t,t=n)):(zi=t,t=n),t}function oo(){var t,r,i,s;return t=zi,(r=e.substr(zi,4)).toLowerCase()===Z?zi+=4:(r=n,0===Ji&&es(mt)),r!==n?(i=zi,Ji++,s=gs(),Ji--,s===n?i=void 0:(zi=i,i=n),i!==n?(Gi=t,t=di()):(zi=t,t=n)):(zi=t,t=n),t}function ao(){var t,r,i,s;return t=zi,(r=e.substr(zi,4)).toLowerCase()===j?zi+=4:(r=n,0===Ji&&es(gt)),r!==n?(i=zi,Ji++,s=gs(),Ji--,s===n?i=void 0:(zi=i,i=n),i!==n?(Gi=t,t=hi()):(zi=t,t=n)):(zi=t,t=n),t}function lo(){var t,r,i,s;return t=zi,(r=e.substr(zi,7)).toLowerCase()===V?zi+=7:(r=n,0===Ji&&es(wt)),r!==n?(i=zi,Ji++,s=gs(),Ji--,s===n?i=void 0:(zi=i,i=n),i!==n?(Gi=t,t=fi()):(zi=t,t=n)):(zi=t,t=n),t}function uo(){var t,r,i,s;return t=zi,(r=e.substr(zi,8)).toLowerCase()===U?zi+=8:(r=n,0===Ji&&es(_t)),r!==n?(i=zi,Ji++,s=gs(),Ji--,s===n?i=void 0:(zi=i,i=n),i!==n?(Gi=t,t=yi()):(zi=t,t=n)):(zi=t,t=n),t}function co(){var t,r,i,s;return t=zi,(r=e.substr(zi,4)).toLowerCase()===z?zi+=4:(r=n,0===Ji&&es(vt)),r!==n?(i=zi,Ji++,s=gs(),Ji--,s===n?i=void 0:(zi=i,i=n),i!==n?(Gi=t,t=mi()):(zi=t,t=n)):(zi=t,t=n),t}function po(){var t,r,i,s;return t=zi,(r=e.substr(zi,4)).toLowerCase()===G?zi+=4:(r=n,0===Ji&&es(bt)),r!==n?(i=zi,Ji++,s=gs(),Ji--,s===n?i=void 0:(zi=i,i=n),i!==n?(Gi=t,t=gi()):(zi=t,t=n)):(zi=t,t=n),t}function ho(){var t,r,i,s;return t=zi,(r=e.substr(zi,2)).toLowerCase()===q?zi+=2:(r=n,0===Ji&&es(St)),r!==n?(i=zi,Ji++,s=gs(),Ji--,s===n?i=void 0:(zi=i,i=n),i!==n?(Gi=t,t=wi()):(zi=t,t=n)):(zi=t,t=n),t}function fo(){var t,r,i,s;return t=zi,(r=e.substr(zi,7)).toLowerCase()===B?zi+=7:(r=n,0===Ji&&es(It)),r!==n?(i=zi,Ji++,s=gs(),Ji--,s===n?i=void 0:(zi=i,i=n),i!==n?(Gi=t,t=_i()):(zi=t,t=n)):(zi=t,t=n),t}function yo(){var t,r,i,s;return t=zi,(r=e.substr(zi,3)).toLowerCase()===$?zi+=3:(r=n,0===Ji&&es(Mt)),r!==n?(i=zi,Ji++,s=gs(),Ji--,s===n?i=void 0:(zi=i,i=n),i!==n?(Gi=t,t=vi()):(zi=t,t=n)):(zi=t,t=n),t}function mo(){var t,r,i,s;return t=zi,(r=e.substr(zi,8)).toLowerCase()===J?zi+=8:(r=n,0===Ji&&es(xt)),r!==n?(i=zi,Ji++,s=gs(),Ji--,s===n?i=void 0:(zi=i,i=n),i!==n?(Gi=t,t=bi()):(zi=t,t=n)):(zi=t,t=n),t}function go(){var t,r,i,s;return t=zi,(r=e.substr(zi,5)).toLowerCase()===W?zi+=5:(r=n,0===Ji&&es(Ft)),r!==n?(i=zi,Ji++,s=gs(),Ji--,s===n?i=void 0:(zi=i,i=n),i!==n?(Gi=t,t=Si()):(zi=t,t=n)):(zi=t,t=n),t}function wo(){var t,r,i,s;return t=zi,(r=e.substr(zi,4)).toLowerCase()===Q?zi+=4:(r=n,0===Ji&&es(At)),r!==n?(i=zi,Ji++,s=gs(),Ji--,s===n?i=void 0:(zi=i,i=n),i!==n?(Gi=t,t=Ii()):(zi=t,t=n)):(zi=t,t=n),t}function _o(){var t,r,i,s;return t=zi,(r=e.substr(zi,7)).toLowerCase()===K?zi+=7:(r=n,0===Ji&&es(Tt)),r!==n?(i=zi,Ji++,s=gs(),Ji--,s===n?i=void 0:(zi=i,i=n),i!==n?(Gi=t,t=Mi()):(zi=t,t=n)):(zi=t,t=n),t}function vo(){var t,r,i,s;return t=zi,(r=e.substr(zi,2)).toLowerCase()===Y?zi+=2:(r=n,0===Ji&&es(Ct)),r!==n?(i=zi,Ji++,s=gs(),Ji--,s===n?i=void 0:(zi=i,i=n),i!==n?(Gi=t,t=xi()):(zi=t,t=n)):(zi=t,t=n),t}function bo(){var t,r,i,s;return t=zi,(r=e.substr(zi,8)).toLowerCase()===X?zi+=8:(r=n,0===Ji&&es(Et)),r!==n?(i=zi,Ji++,s=gs(),Ji--,s===n?i=void 0:(zi=i,i=n),i!==n?(Gi=t,t=Fi()):(zi=t,t=n)):(zi=t,t=n),t}function So(){var t,r,i,s;return t=zi,(r=e.substr(zi,4)).toLowerCase()===ee?zi+=4:(r=n,0===Ji&&es(Lt)),r!==n?(i=zi,Ji++,s=gs(),Ji--,s===n?i=void 0:(zi=i,i=n),i!==n?(Gi=t,t=Ai()):(zi=t,t=n)):(zi=t,t=n),t}function Io(){var t,r,i,s;return t=zi,(r=e.substr(zi,13)).toLowerCase()===te?zi+=13:(r=n,0===Ji&&es(Ot)),r!==n?(i=zi,Ji++,s=gs(),Ji--,s===n?i=void 0:(zi=i,i=n),i!==n?(Gi=t,t=Ti()):(zi=t,t=n)):(zi=t,t=n),t}function Mo(){var t,r,i,s;return t=zi,(r=e.substr(zi,15)).toLowerCase()===re?zi+=15:(r=n,0===Ji&&es(Rt)),r!==n?(i=zi,Ji++,s=gs(),Ji--,s===n?i=void 0:(zi=i,i=n),i!==n?(Gi=t,t=Ci()):(zi=t,t=n)):(zi=t,t=n),t}function xo(){var t,r,i,s;return t=zi,(r=e.substr(zi,5)).toLowerCase()===ne?zi+=5:(r=n,0===Ji&&es(kt)),r!==n?(i=zi,Ji++,s=gs(),Ji--,s===n?i=void 0:(zi=i,i=n),i!==n?(Gi=t,t=Ei()):(zi=t,t=n)):(zi=t,t=n),t}function Fo(){var t,r,i,s;return t=zi,(r=e.substr(zi,3)).toLowerCase()===ie?zi+=3:(r=n,0===Ji&&es(Nt)),r!==n?(i=zi,Ji++,s=gs(),Ji--,s===n?i=void 0:(zi=i,i=n),i!==n?(Gi=t,t=Li()):(zi=t,t=n)):(zi=t,t=n),t}function Ao(){var t,r,i,s;return t=zi,(r=e.substr(zi,4)).toLowerCase()===se?zi+=4:(r=n,0===Ji&&es(Dt)),r!==n?(i=zi,Ji++,s=gs(),Ji--,s===n?i=void 0:(zi=i,i=n),i!==n?(Gi=t,t=Oi()):(zi=t,t=n)):(zi=t,t=n),t}function To(){var t,r,i,s;return t=zi,(r=e.substr(zi,6)).toLowerCase()===oe?zi+=6:(r=n,0===Ji&&es(Pt)),r!==n?(i=zi,Ji++,s=gs(),Ji--,s===n?i=void 0:(zi=i,i=n),i!==n?(Gi=t,t=Ri()):(zi=t,t=n)):(zi=t,t=n),t}function Co(){var t,r,i,s;return t=zi,(r=e.substr(zi,6)).toLowerCase()===ae?zi+=6:(r=n,0===Ji&&es(Zt)),r!==n?(i=zi,Ji++,s=gs(),Ji--,s===n?i=void 0:(zi=i,i=n),i!==n?(Gi=t,t=ki()):(zi=t,t=n)):(zi=t,t=n),t}function Eo(){var t,r,i,s;return t=zi,(r=e.substr(zi,4)).toLowerCase()===le?zi+=4:(r=n,0===Ji&&es(jt)),r!==n?(i=zi,Ji++,s=gs(),Ji--,s===n?i=void 0:(zi=i,i=n),i!==n?(Gi=t,t=Ni()):(zi=t,t=n)):(zi=t,t=n),t}function Lo(){var t,r,i,s;return t=zi,(r=e.substr(zi,3)).toLowerCase()===ue?zi+=3:(r=n,0===Ji&&es(Vt)),r!==n?(i=zi,Ji++,s=gs(),Ji--,s===n?i=void 0:(zi=i,i=n),i!==n?(Gi=t,t=Di()):(zi=t,t=n)):(zi=t,t=n),t}function Oo(){var t,r,i,s;return t=zi,(r=e.substr(zi,4)).toLowerCase()===ce?zi+=4:(r=n,0===Ji&&es(Ut)),r!==n?(i=zi,Ji++,s=gs(),Ji--,s===n?i=void 0:(zi=i,i=n),i!==n?(Gi=t,t=Pi()):(zi=t,t=n)):(zi=t,t=n),t}function Ro(){var t,r,i,s;return t=zi,(r=e.substr(zi,4)).toLowerCase()===pe?zi+=4:(r=n,0===Ji&&es(zt)),r!==n?(i=zi,Ji++,s=gs(),Ji--,s===n?i=void 0:(zi=i,i=n),i!==n?(Gi=t,t=Zi()):(zi=t,t=n)):(zi=t,t=n),t}function ko(){var t,r,i,s;return t=zi,(r=e.substr(zi,4)).toLowerCase()===de?zi+=4:(r=n,0===Ji&&es(Gt)),r!==n?(i=zi,Ji++,s=gs(),Ji--,s===n?i=void 0:(zi=i,i=n),i!==n?(Gi=t,t=ji()):(zi=t,t=n)):(zi=t,t=n),t}function No(){var t;return 44===e.charCodeAt(zi)?(t=he,zi++):(t=n,0===Ji&&es(qt)),t}function Do(){var t;return 40===e.charCodeAt(zi)?(t=fe,zi++):(t=n,0===Ji&&es(Bt)),t}function Po(){var t;return 41===e.charCodeAt(zi)?(t=ye,zi++):(t=n,0===Ji&&es($t)),t}function Zo(){var e,t;for(e=[],t=jo();t!==n;)e.push(t),t=jo();return e}function jo(){var t;return t=e.charAt(zi),Ae.test(t)?zi++:(t=n,0===Ji&&es(Jt)),t}function Vo(){var t,r,i,s;if(t=zi,(r=ys())!==n&&(Gi=t,r=Vi(r)),(t=r)===n)if(t=zi,96===e.charCodeAt(zi)?(r=me,zi++):(r=n,0===Ji&&es(Wt)),r!==n){if(i=[],s=e.charAt(zi),Te.test(s)?zi++:(s=n,0===Ji&&es(Ht)),s!==n)for(;s!==n;)i.push(s),s=e.charAt(zi),Te.test(s)?zi++:(s=n,0===Ji&&es(Ht));else i=n;i!==n?(96===e.charCodeAt(zi)?(s=me,zi++):(s=n,0===Ji&&es(Wt)),s!==n?(Gi=t,t=Ui(i)):(zi=t,t=n)):(zi=t,t=n)}else zi=t,t=n;return t}function Uo(e,t,r,n,i){const s={type:"binary-expression",location:i,operator:e,left:t,right:r};return void 0!==n&&(s.escape=n),s}function zo(e,...t){return{type:"expression-list",location:e,value:t}}function Go(e,t){let r=e;for(const{op:e,expr:n,location:{end:i}}of t)r=Uo(e,r,n,void 0,{...r.location,end:i});return r}if(r=o(),t.peg$library)return{peg$result:r,peg$currPos:zi,peg$FAILED:n,peg$maxFailExpected:$i,peg$maxFailPos:Bi};if(r!==n&&zi===e.length)return r;throw r!==n&&zi<e.length&&es({type:"end"}),function(e,t,r){return new H(H.buildMessage(e,t),e,t,r)}($i,Bi<e.length?e.charAt(Bi):null,Bi<e.length?Xi(Bi,Bi+1):Xi(Bi,Bi))}(e)}}function Y(e,t){if(null!=e)switch(t(e),e.type){case"when-clause":Y(e.operand,t),Y(e.value,t);break;case"case-expression":for(const r of e.clauses)Y(r,t);"simple"===e.format&&Y(e.operand,t),null!==e.else&&Y(e.else,t);break;case"expression-list":for(const r of e.value)Y(r,t);break;case"unary-expression":Y(e.expr,t);break;case"binary-expression":Y(e.left,t),Y(e.right,t);break;case"function":Y(e.args,t);break;case"interval":Y(e.value,t),Y(e.qualifier,t);break;case"interval-qualifier":Y(e.start,t),Y(e.end,t)}}const X=new Set(["current_timestamp","current_date","current_time"]);class ee{static makeBool(e){return re(e)}static featureValue(e,t,r,n){return pe(e,t,r,n)}static equalsNull(e){return null===e}static applyLike(e,t,r){return ce(e,t,r)}static ensureArray(e){return ne(e)}static applyIn(e,t,r){return ae(e,t)}static currentTimestamp(e){return b(new Date,e)}static currentDate(e){return o.n.fromNow(e)}static currentTime(e){const t=b(new Date,e);return c.k.fromDateTime(t)}static makeSqlInterval(e,t,r){return l.createFromValueAndQualifier(e,t,r)}static convertInterval(e){return e instanceof l?e.valueInMilliseconds():e}static compare(e,t,r,n){return Z(t,r,e)}static calculate(e,t,r,n){return J(e,t,r,n)}static evaluateTime(e){return E(e)}static evaluateTimestamp(e,t,r){return L(e,t,r)}static evaluateDate(e,t){return O(e,t)}static evaluateFunction(e,t,r){return z(e,t,r)}static lookup(e,t){const r=t[e];return void 0===r?null:r}static between(e,t,r){return null==e||null==t[0]||null==t[1]?null:Z(e,t[0],">=")&&Z(e,t[1],"<=")}static notbetween(e,t,r){return null==e||null==t[0]||null==t[1]?null:Z(e,t[0],"<")||Z(e,t[1],">")}static ternaryNot(e){return ie(e)}static ternaryAnd(e,t){return se(e,t)}static ternaryOr(e,t){return oe(e,t)}}class te{constructor(e,t,r="UTC",n=null){this.fieldsIndex=t,this.timeZone=r,this.currentUser=n,this.parameters={},this._hasDateFunctions=void 0,this.parseTree=K.parse(e);const{isStandardized:i,isAggregate:s,currentUserRequired:o,referencedFieldNames:a}=this._extractExpressionInfo(t);this._referencedFieldNames=a,this.isStandardized=i,this.isAggregate=s,this.currentUserRequired=o}static convertValueToStorageFormat(e,t=null){if(null===t)return x(e)?e.getTime():F(e)?e.toMillis():C(e)?e.toStorageFormat():T(e)?e.toStorageString():A(e)?e.toStorageFormat():e;switch(t){case"date":return x(e)?e.getTime():F(e)?e.toMillis():C(e)?e.toMilliseconds():A(e)?e.toNumber():e;case"date-only":return x(e)?o.n.fromDateJS(e).toString():C(e)?o.n.fromSqlTimeStampOffset(e).toString():F(e)?o.n.fromDateTime(e).toString():e;case"time-only":return x(e)?c.k.fromDateJS(e).toStorageString():F(e)?c.k.fromDateTime(e).toStorageString():C(e)?c.k.fromSqlTimeStampOffset(e).toStorageString():T(e)?e.toStorageString():e;case"timestamp-offset":if(x(e))return u.g.fromJSDate(e).toStorageFormat();if(F(e))return u.g.fromDateTime(e).toStorageFormat();if(C(e))return e.toStorageFormat()}return e}static create(e,t={}){return new te(e,t.fieldsIndex,t.timeZone??void 0,t.currentUser)}get fieldNames(){return this._referencedFieldNames}testSet(e,t=de,r=this.currentUser){return!!this._evaluateNode(this.parseTree,null,t,e,r)}calculateValue(e,t=de,r=this.currentUser){const n=this._evaluateNode(this.parseTree,e,t,null,r);return n instanceof l?n.valueInMilliseconds()/864e5:n}calculateValueCompiled(e,t=de,r=this.currentUser){return null!=this.parseTree._compiledVersion?this.parseTree._compiledVersion(e,this.parameters,t,this.fieldsIndex,this.timeZone,r??null):(0,i.A)("esri-csp-restrictions")?this.calculateValue(e,t):(this._compileMe(),this.parseTree._compiledVersion(e,this.parameters,t,this.fieldsIndex,this.timeZone,r??null))}testFeature(e,t=de,r=this.currentUser){return!!this._evaluateNode(this.parseTree,e,t,null,r)}testFeatureCompiled(e,t=de,r=this.currentUser){return null!=this.parseTree._compiledVersion?!!this.parseTree._compiledVersion(e,this.parameters,t,this.fieldsIndex,this.timeZone,r??null):(0,i.A)("esri-csp-restrictions")?this.testFeature(e,t):(this._compileMe(),!!this.parseTree._compiledVersion(e,this.parameters,t,this.fieldsIndex,this.timeZone,r??null))}get hasDateFunctions(){return null!=this._hasDateFunctions||(this._hasDateFunctions=!1,Y(this.parseTree,(e=>{"current-time"===e.type?this._hasDateFunctions=!0:"function"===e.type&&(this._hasDateFunctions=this._hasDateFunctions||X.has(e.name.toLowerCase()))}))),this._hasDateFunctions}getFunctions(){const e=new Set;return Y(this.parseTree,(t=>{"function"===t.type&&e.add(t.name.toLowerCase())})),Array.from(e)}getExpressions(){const e=new Map;return Y(this.parseTree,(t=>{if("function"===t.type){const r=t.name.toLowerCase(),n=t.args.value[0];if("column-reference"===n.type){const t=n.column,i=`${r}-${t}`;e.has(i)||e.set(i,{aggregateType:r,field:t})}}})),[...e.values()]}getVariables(){const e=new Set;return Y(this.parseTree,(t=>{"parameter"===t.type&&e.add(t.value.toLowerCase())})),Array.from(e)}_compileMe(){const e="return this.convertInterval("+this.evaluateNodeToJavaScript(this.parseTree)+")";this.parseTree._compiledVersion=new Function("feature","lookups","attributeAdapter","fieldsIndex","timeZone","currentUser",e).bind(ee)}_extractExpressionInfo(e){const t=[],r=new Set;let n=!0,i=!1,o=!1;return Y(this.parseTree,(a=>{switch(a.type){case"column-reference":{const n=e?.get(a.column);let i,s;n?i=s=n.name??"":(s=a.column,i=s.toLowerCase()),r.has(i)||(r.add(i),t.push(s)),a.column=s;break}case"current-user":o=!0;break;case"function":{const{name:e,args:t}=a,r=t.value.length;n&&(n=function(e,t){const r=$[e.toLowerCase()];return null!=r&&t>=r.minParams&&t<=r.maxParams}(e,r)),!1===i&&(i=(0,s.M)(e,r));break}}})),{referencedFieldNames:Array.from(t),isStandardized:n,isAggregate:i,currentUserRequired:o}}evaluateNodeToJavaScript(e){switch(e.type){case"interval":return"this.makeSqlInterval("+this.evaluateNodeToJavaScript(e.value)+", "+JSON.stringify(e.qualifier)+","+JSON.stringify(e.op)+")";case"case-expression":{let t="";if("simple"===e.format){const r=this.evaluateNodeToJavaScript(e.operand);t="( ";for(let n=0;n<e.clauses.length;n++)t+=" (this.compare('=',"+r+","+this.evaluateNodeToJavaScript(e.clauses[n].operand)+") ? ("+this.evaluateNodeToJavaScript(e.clauses[n].value)+") : ";null!==e.else?t+=this.evaluateNodeToJavaScript(e.else):t+="null",t+=" )"}else{t="( ";for(let r=0;r<e.clauses.length;r++)t+=" this.makeBool("+this.evaluateNodeToJavaScript(e.clauses[r].operand)+")===true ? ("+this.evaluateNodeToJavaScript(e.clauses[r].value)+") : ";null!==e.else?t+=this.evaluateNodeToJavaScript(e.else):t+="null",t+=" )"}return t}case"parameter":return"this.lookup("+JSON.stringify(e.value.toLowerCase())+",lookups)";case"expression-list":{let t="[";for(const r of e.value)"["!==t&&(t+=","),t+=this.evaluateNodeToJavaScript(r);return t+="]",t}case"unary-expression":return"this.ternaryNot("+this.evaluateNodeToJavaScript(e.expr)+")";case"binary-expression":switch(e.operator){case"AND":return"this.ternaryAnd("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+" )";case"OR":return"this.ternaryOr("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+" )";case"IS":if("null"!==e.right.type)throw new a.L8(a.Z7.UnsupportedIsRhs);return"this.equalsNull("+this.evaluateNodeToJavaScript(e.left)+")";case"ISNOT":if("null"!==e.right.type)throw new a.L8(a.Z7.UnsupportedIsRhs);return"(!(this.equalsNull("+this.evaluateNodeToJavaScript(e.left)+")))";case"IN":return"this.applyIn("+this.evaluateNodeToJavaScript(e.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(e.right)+"), timeZone)";case"NOT IN":return"this.ternaryNot(this.applyIn("+this.evaluateNodeToJavaScript(e.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(e.right)+"), timeZone))";case"BETWEEN":return"this.between("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+", timeZone)";case"NOTBETWEEN":return"this.notbetween("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+", timeZone)";case"LIKE":return"this.applyLike("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+","+JSON.stringify(e.escape)+")";case"NOT LIKE":return"this.ternaryNot(this.applyLike("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+","+JSON.stringify(e.escape)+"))";case"<>":case"<":case">":case">=":case"<=":case"=":return"this.compare("+JSON.stringify(e.operator)+","+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+", timeZone)";case"*":case"-":case"+":case"/":case"||":return"this.calculate("+JSON.stringify(e.operator)+","+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+", timeZone)";default:throw new a.L8(a.Z7.UnsupportedOperator,{operator:e.operator})}case"null":case"boolean":case"string":case"number":return JSON.stringify(e.value);case"time":return"this.evaluateTime("+JSON.stringify(e.value)+")";case"date":return"this.evaluateDate("+JSON.stringify(e.value)+", 'unknown')";case"timestamp":return"this.evaluateTimestamp("+JSON.stringify(e.value)+", 'unknown')";case"current-time":return"date"===e.mode?"this.currentDate(timeZone)":"time"===e.mode?"this.currentTime(timeZone)":"this.currentTimestamp(timeZone)";case"current-user":return"currentUser";case"column-reference":return"this.featureValue(feature,"+JSON.stringify(e.column)+",fieldsIndex,attributeAdapter)";case"function":return"this.evaluateFunction("+JSON.stringify(e.name)+","+this.evaluateNodeToJavaScript(e.args)+", timeZone)"}throw new a.L8(a.Z7.UnsupportedSyntax,{node:e.type})}_evaluateNode(e,t,r,i,o){let u;switch(e.type){case"interval":{const n=this._evaluateNode(e.value,t,r,i,o);return l.createFromValueAndQualifier(n,e.qualifier,e.op)}case"case-expression":if("simple"===e.format){const n=this._evaluateNode(e.operand,t,r,i,o);for(let s=0;s<e.clauses.length;s++)if(Z(n,this._evaluateNode(e.clauses[s].operand,t,r,i,o),"=",this.timeZone))return this._evaluateNode(e.clauses[s].value,t,r,i,o);if(null!==e.else)return this._evaluateNode(e.else,t,r,i,o)}else{for(let n=0;n<e.clauses.length;n++)if(re(this._evaluateNode(e.clauses[n].operand,t,r,i,o)))return this._evaluateNode(e.clauses[n].value,t,r,i,o);if(null!==e.else)return this._evaluateNode(e.else,t,r,i,o)}return null;case"parameter":return u=this.parameters[e.value.toLowerCase()],x(u)?d.c9.fromJSDate(u):u instanceof n.lY?u.toDateTime():u;case"expression-list":{const n=[];for(const s of e.value)n.push(this._evaluateNode(s,t,r,i,o));return n}case"unary-expression":return ie(this._evaluateNode(e.expr,t,r,i,o));case"binary-expression":switch(e.operator){case"AND":return se(this._evaluateNode(e.left,t,r,i,o),this._evaluateNode(e.right,t,r,i,o));case"OR":return oe(this._evaluateNode(e.left,t,r,i,o),this._evaluateNode(e.right,t,r,i,o));case"IS":if("null"!==e.right.type)throw new a.L8(a.Z7.UnsupportedIsRhs);return null===this._evaluateNode(e.left,t,r,i,o);case"ISNOT":if("null"!==e.right.type)throw new a.L8(a.Z7.UnsupportedIsRhs);return null!==this._evaluateNode(e.left,t,r,i,o);case"IN":{const n=ne(this._evaluateNode(e.right,t,r,i,o));return ae(this._evaluateNode(e.left,t,r,i,o),n,this.timeZone)}case"NOT IN":{const n=ne(this._evaluateNode(e.right,t,r,i,o));return ie(ae(this._evaluateNode(e.left,t,r,i,o),n,this.timeZone))}case"BETWEEN":{const n=this._evaluateNode(e.left,t,r,i,o),s=this._evaluateNode(e.right,t,r,i,o);return null==n||null==s[0]||null==s[1]?null:Z(n,s[0],">=",this.timeZone)&&Z(n,s[1],"<=",this.timeZone)}case"NOTBETWEEN":{const n=this._evaluateNode(e.left,t,r,i,o),s=this._evaluateNode(e.right,t,r,i,o);return null==n||null==s[0]||null==s[1]?null:Z(n,s[0],"<",this.timeZone)||Z(n,s[1],">",this.timeZone)}case"LIKE":return ce(this._evaluateNode(e.left,t,r,i,o),this._evaluateNode(e.right,t,r,i,o),e.escape);case"NOT LIKE":return ie(ce(this._evaluateNode(e.left,t,r,i,o),this._evaluateNode(e.right,t,r,i,o),e.escape));case"<>":case"<":case">":case">=":case"<=":case"=":return Z(this._evaluateNode(e.left,t,r,i,o),this._evaluateNode(e.right,t,r,i,o),e.operator,this.timeZone);case"-":case"+":case"*":case"/":case"||":return J(e.operator,this._evaluateNode(e.left,t,r,i,o),this._evaluateNode(e.right,t,r,i,o),this.timeZone)}case"null":case"boolean":case"string":case"number":return e.value;case"date":return e.parsedValue??=O(e.value,"unknown"),e.parsedValue;case"timestamp":return e.parsedValue??=L(e.value,"unknown"),e.parsedValue;case"time":return E(e.value);case"current-time":return"date"===e.mode?ee.currentDate(this.timeZone):"time"===e.mode?ee.currentTime(this.timeZone):ee.currentTimestamp(this.timeZone);case"current-user":return o??null;case"column-reference":return pe(t,e.column,this.fieldsIndex,r);case"data-type":return e.value;case"function":{if(this.isAggregate&&(0,s.M)(e.name,e.args.value.length)){const t=[];for(const n of e.args?.value||[]){const e=[];for(const t of i||[])e.push(this._evaluateNode(n,t,r,null,o));t.push(e)}return(0,s.s)(e.name,t)}const n=this._evaluateNode(e.args,t,r,i,o);return z(e.name,n,this.timeZone)}}throw new a.L8(a.Z7.UnsupportedSyntax,{node:e.type})}}function re(e){return!0===e}function ne(e){return Array.isArray(e)?e:[e]}function ie(e){return null!==e?!0!==e:null}function se(e,t){return null!=e&&null!=t?!0===e&&!0===t:!1!==e&&!1!==t&&null}function oe(e,t){return null!=e&&null!=t?!0===e||!0===t:!0===e||!0===t||null}function ae(e,t,r){if(null==e)return null;let n=!1;for(const r of t)if(null==r)n=null;else{if(e===r){n=!0;break}if(D(e)&&D(r)&&(n=Z(e,r,"="),n))break}return n}const le="-[]/{}()*+?.\\^$|";var ue;function ce(e,t,r){return null==e?null:function(e,t){const r=t;let n="",i=ue.Normal;for(let t=0;t<e.length;t++){const s=e.charAt(t);switch(i){case ue.Normal:s===r?i=ue.Escaped:le.includes(s)?n+="\\"+s:n+="%"===s?".*":"_"===s?".":s;break;case ue.Escaped:le.includes(s)?n+="\\"+s:n+=s,i=ue.Normal}}return new RegExp("^"+n+"$","m")}(t,r).test(e)}function pe(e,t,r,n){const i=n.getAttribute(e,t),s=r?.get(t);return null==i||"esriFieldTypeDate"!==s?.type&&"date"!==s?.type?null==i||"esriFieldTypeDateOnly"!==s?.type&&"date-only"!==s?.type?null==i||"esriFieldTypeTimeOnly"!==s?.type&&"time-only"!==s?.type?null==i||"esriFieldTypeTimestampOffset"!==s?.type&&"timestamp-offset"!==s?.type?i:new u.g(i):c.k.fromReader(i):o.n.fromReader(i):b(new Date(i),r?.getLuxonTimeZone(s.name)??d.mQ.utcInstance)}!function(e){e[e.Normal=0]="Normal",e[e.Escaped=1]="Escaped"}(ue||(ue={}));const de={getAttribute:(e,t)=>(function(e){return e&&"object"==typeof e.attributes}(e)?e.attributes:e)[t]}},93393:function(e,t,r){r.d(t,{L8:function(){return a},Z7:function(){return n}});var n,i,s=r(50944);(i=n||(n={})).InvalidFunctionParameters="InvalidFunctionParameters",i.InvalidValueForAggregateFunction="InvalidValueForAggregateFunction",i.UnsupportedSqlFunction="UnsupportedSqlFunction",i.UnsupportedOperator="UnsupportedOperator",i.UnsupportedSyntax="UnsupportedSyntax",i.UnsupportedIsRhs="UnsupportedIsRhs",i.UnsupportedIsLhs="UnsupportedIsLhs",i.InvalidDataType="InvalidDataType",i.CannotCastValue="CannotCastValue",i.FunctionNotRecognized="FunctionNotRecognized",i.InvalidTime="InvalidTime",i.InvalidParameterCount="InvalidParameterCount",i.InvalidTimeStamp="InvalidTimeStamp",i.InvalidDate="InvalidDate",i.InvalidOperator="InvalidOperator",i.IllegalInterval="IllegalInterval",i.YearMonthIntervals="YearMonthIntervals",i.PrimarySecondaryQualifiers="PrimarySecondaryQualifiers",i.MissingStatisticParameters="MissingStatisticParameters";const o={[n.InvalidValueForAggregateFunction]:"Invalid value used in aggregate function",[n.MissingStatisticParameters]:"Statistic does not have 1 or 0 Parameters",[n.InvalidFunctionParameters]:"Invalid parameters for call to {function}",[n.UnsupportedIsLhs]:"Unsupported left hand expression in is statement",[n.UnsupportedIsRhs]:"Unsupported right hand expression in is statement",[n.UnsupportedOperator]:"Unsupported operator - {operator}",[n.UnsupportedSyntax]:"Unsupported syntax - {node}",[n.UnsupportedSqlFunction]:"Sql function not found = {function}",[n.InvalidDataType]:"Invalid sql data type",[n.InvalidDate]:"Invalid date encountered",[n.InvalidOperator]:"Invalid operator encountered",[n.InvalidTime]:"Invalid time encountered",[n.IllegalInterval]:"Illegal interval",[n.FunctionNotRecognized]:"Function not recognized",[n.InvalidTimeStamp]:"Invalid timestamp encountered",[n.InvalidParameterCount]:"Invalid parameter count for call to {name}",[n.PrimarySecondaryQualifiers]:"Primary and Secondary SqlInterval qualifiers not supported",[n.YearMonthIntervals]:"Year-Month Intervals not supported",[n.CannotCastValue]:"Cannot cast value to the required data type"};class a extends Error{constructor(e,t){super((0,s.HC)(o[e],t)),this.declaredRootClass="esri.arcade.featureset.support.sqlerror",Error.captureStackTrace&&Error.captureStackTrace(this,a)}}},37797:function(e,t,r){r.d(t,{A:function(){return u}});var n=r(61226),i=(r(58941),r(60539)),s=r(51846),o=r(13370),a=r(90465),l=r(50193);class u{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new s.A}destroy(){this.close()}get closed(){return!this._clients?.length}open(e,t){return new Promise(((r,n)=>{let s=!0;const o=e=>{(0,i.Te)(t.signal),s&&(s=!1,e())};this._clients.length=e.length,this._clientPromises.length=e.length,this._inUseClients.length=e.length;for(let s=0;s<e.length;++s){const a=e[s];(0,i.$X)(a)?this._clientPromises[s]=a.then((e=>(this._clients[s]=new l.A(e,t,this._ongoingJobsQueue),o(r),this._clients[s])),(()=>(o(n),null))):(this._clients[s]=new l.A(a,t,this._ongoingJobsQueue),this._clientPromises[s]=Promise.resolve(this._clients[s]),o(r))}}))}broadcast(e,t,r){const n=new Array(this._clientPromises.length);for(let i=0;i<this._clientPromises.length;++i){const s=this._clientPromises[i];n[i]=s.then((n=>n?.invoke(e,t,r)))}return n}close(){let e;for(;e=this._ongoingJobsQueue.pop();)e.resolver.reject((0,i.NK)(`Worker closing, aborting job calling '${e.methodName}'`));for(const e of this._clientPromises)e.then((e=>e?.close()));this._clients.length=0,this._clientPromises.length=0,this._inUseClients.length=0,(0,o.h)(this)}invoke(e,t,r){return this.apply(e,[t],r)}apply(e,t,r){const n=(0,i.Tw)();this._ongoingJobsQueue.push({methodName:e,data:t,invokeOptions:r,resolver:n});for(let e=0;e<this._clientPromises.length;e++){const t=this._clients[e];t?t.jobAdded():this._clientPromises[e].then((e=>e?.jobAdded()))}return n.promise}createInvokeProxy(e){return(0,a.L)(this,e)}on(e,t){return Promise.all(this._clientPromises).then((()=>(0,n.vE)(this._clients.map((r=>r.on(e,t))))))}openPorts(){return new Promise((e=>{const t=new Array(this._clientPromises.length);let r=t.length;for(let n=0;n<this._clientPromises.length;++n)this._clientPromises[n].then((i=>{i&&(t[n]=i.openPort()),0==--r&&e(t)}))}))}get test(){}}},90465:function(e,t,r){function n(e,t){return new Proxy({},{get:(r,n,i)=>(...r)=>{let i,s;const o=r[r.length-1];return function(e){return"object"==typeof e&&!Array.isArray(e)&&null!=e&&("signal"in e||"transferList"in e||0===Object.keys(e).length)}(o)&&(i=o.signal,s=o.transferList,r.pop()),e.apply(t?`${t}.${n.toString()}`:n.toString(),r,{transferList:s,signal:i})}})}r.d(t,{L:function(){return n}})},50193:function(e,t,r){r.d(t,{A:function(){return v}});var n=r(7156),i=r(39819),s=r(40212),o=r(61226),a=r(95929),l=r(60539),u=r(90465);const c={statsWorker:()=>r.e(1838).then(r.bind(r,27966)),geometryEngineWorker:()=>r.e(2384).then(r.bind(r,9568)),CSVSourceWorker:()=>r.e(2600).then(r.bind(r,80172)),EdgeProcessingWorker:()=>r.e(2933).then(r.bind(r,92273)),ElevationSamplerWorker:()=>r.e(5120).then(r.bind(r,55412)),FeatureServiceSnappingSourceWorker:()=>r.e(8246).then(r.bind(r,66038)),GeoJSONSourceWorker:()=>r.e(7253).then(r.bind(r,4389)),LercWorker:()=>r.e(6594).then(r.bind(r,67024)),MemorySourceWorker:()=>r.e(807).then(r.bind(r,8489)),PBFDecoderWorker:()=>r.e(8950).then(r.bind(r,19939)),FeaturePipelineWorker:()=>r.e(3806).then(r.bind(r,25423)),PointCloudWorker:()=>r.e(9722).then(r.bind(r,33764)),RasterWorker:()=>r.e(6221).then(r.bind(r,85563)),SceneLayerSnappingSourceWorker:()=>r.e(5974).then(r.bind(r,28820)),SceneLayerWorker:()=>r.e(5404).then(r.bind(r,90525)),WFSSourceWorker:()=>r.e(4900).then(r.bind(r,6412)),WorkerTileHandler:()=>r.e(3295).then(r.bind(r,27787)),Lyr3DWorker:()=>r.e(3213).then(r.bind(r,6883)),Feature3DPipelineWorker:()=>r.e(3929).then(r.bind(r,38518))};var p=r(64272),d=r(23532);const{CLOSE:h,ABORT:f,INVOKE:y,RESPONSE:m,OPEN_PORT:g,ON:w}=p.Go;class _{constructor(e){this._invoke=e,this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._timer=null,this._process=this._process.bind(this)}push(e){e.type===p.Go.ABORT?this._cancelledJobIds.add(e.jobId):(this._invokeMessages.push(e),null===this._timer&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const e of this._invokeMessages)this._cancelledJobIds.has(e.jobId)||this._invoke(e);this._cancelledJobIds.clear(),this._invokeMessages.length=0}}class v{static connect(e,t){const r=new MessageChannel;let n;n="function"==typeof e?new e:"default"in e&&"function"==typeof e.default?new e.default:e;const i=new v(r.port1,{channel:r,client:n,schedule:t});return"object"==typeof n&&"remoteClient"in n&&(n.remoteClient=i),v.clients.set(i,n),r.port2}static loadWorker(e){const t=c[e];return t?t():Promise.resolve(null)}constructor(e,t,r){this._port=e,this._jobQueue=r,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new _((e=>this._onInvokeMessage(e))),this._client=t.client,this._onMessage=this._onMessage.bind(this),this._channel=t.channel,this._schedule=t.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}close(){this._post({type:h}),this._close()}isBusy(){return this._outJobs.size>0}invoke(e,t,r){return this.apply(e,[t],r)}apply(e,t,r){const n=r?.signal,s=r?.transferList;if(!this._port)return Promise.reject(new i.A(p.T,`Cannot call invoke('${e}'), port is closed`,{methodName:e,data:t}));const o=(0,p.Jc)();return new Promise(((r,i)=>{if((0,l.G4)(n))return this._processWork(),void i((0,l.NK)());const u=(0,l.u7)(n,(()=>{const e=this._outJobs.get(o);e&&(this._outJobs.delete(o),this._processWork(),(0,a.xt)(e.abortHandle),this._post({type:f,jobId:o}),i((0,l.NK)()))})),c={resolve:r,reject:i,abortHandle:u,debugInfo:e};this._outJobs.set(o,c),this._post({type:y,jobId:o,methodName:e,abortable:null!=n},t,s)}))}createInvokeProxy(e){return(0,u.L)(this,e)}on(e,t){const r=new MessageChannel;function n(e){t(e.data)}return this._port.postMessage({type:p.Go.ON,eventType:e,port:r.port2},[r.port2]),r.port1.addEventListener("message",n),r.port1.start(),(0,o.hA)((()=>{r.port1.postMessage({type:p.Go.CLOSE}),r.port1.close(),r.port1.removeEventListener("message",n)}))}jobAdded(){this._processWork()}openPort(){const e=new MessageChannel;return this._post({type:g,port:e.port2}),e.port1}_processWork(){if(this._outJobs.size>=2)return;const e=this._jobQueue?.pop();if(!e)return;const{methodName:t,data:r,invokeOptions:n,resolver:i}=e;this.apply(t,r,n).then((e=>i.resolve(e))).catch((e=>i.reject(e)))}_close(){this._channel&&(this._channel=void 0),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach((e=>{(0,a.xt)(e.abortHandle),e.reject((0,l.NK)(`Worker closing, aborting job calling '${e.debugInfo}'`))})),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=null,this._client=null,this._schedule=null}_onMessage(e){null!=this._schedule?this._schedule((()=>this._processMessage(e,!0))):this._processMessage(e,!1)}_processMessage(e,t){const r=(0,p.VI)(e);if(r)switch(r.type){case m:this._onResponseMessage(r);break;case y:t?this._onInvokeMessage(r):this._invokeQueue.push(r);break;case f:this._onAbortMessage(r);break;case h:this._onCloseMessage();break;case g:this._onOpenPortMessage(r);break;case w:this._onOnMessage(r)}}_onAbortMessage(e){const t=this._inJobs,r=e.jobId,n=t.get(r);this._invokeQueue.push(e),n&&(n.controller&&n.controller.abort(),t.delete(r))}_onCloseMessage(){const e=this._client;this._close(),e&&"destroy"in e&&v.clients.get(this)===e&&e.destroy(),v.clients.delete(this),e?.remoteClient&&(e.remoteClient=null)}_onInvokeMessage(e){const{methodName:t,jobId:r,data:n=[],abortable:i}=e,s=i?new AbortController:null,o=this._inJobs;let a,u=this._client,c=u[t];try{if(!c&&t&&t.includes(".")){const e=t.split(".");for(let t=0;t<e.length-1;t++)u=u[e[t]],c=u[e[t+1]]}if("function"!=typeof c)throw new TypeError(`${t} is not a function`);n.push({client:this,signal:s?s.signal:null}),a=c.apply(u,n)}catch(e){return void this._post({type:m,jobId:r,error:(0,p.mF)(e)})}(0,l.$X)(a)?(o.set(r,{controller:s,promise:a}),a.then((e=>{o.has(r)&&(o.delete(r),this._post({type:m,jobId:r},e))}),(e=>{o.has(r)&&(o.delete(r),(0,l.zf)(e)||this._post({type:m,jobId:r,error:(0,p.mF)(e||{message:`Error encountered at method ${t}`})}))}))):this._post({type:m,jobId:r},a)}_onOpenPortMessage(e){new v(e.port,{client:this._client})}_onOnMessage(e){const{port:t}=e,r=this._client.on(e.eventType,(e=>{t.postMessage(e)})),n=(0,s.on)(e.port,"message",(e=>{const i=(0,p.VI)(e);i?.type===p.Go.CLOSE&&(n.remove(),r.remove(),t.close())}))}_onResponseMessage(e){const{jobId:t,error:r,data:n}=e,s=this._outJobs;if(!s.has(t))return;const o=s.get(t);s.delete(t),this._processWork(),(0,a.xt)(o.abortHandle),r?o.reject(i.A.fromJSON(JSON.parse(r))):o.resolve(n)}_post(e,t,r){return(0,p.u1)(this._port,e,t,r)}}v.kernelInfo={buildDate:d.$,fullVersion:n.ol,revision:d.u},v.clients=new Map},13370:function(e,t,r){r.d(t,{h:function(){return s},k:function(){return i}});const n=new FinalizationRegistry((e=>{e.close()}));function i(e,t){n.register(e,t,t)}function s(e){n.unregister(e)}},64272:function(e,t,r){r.d(t,{Go:function(){return o},Jc:function(){return u},T:function(){return s},VI:function(){return d},mF:function(){return c},oV:function(){return f},u1:function(){return p}});var n=r(58941),i=r(60539);const s="worker:port-closed";var o,a;(a=o||(o={}))[a.HANDSHAKE=0]="HANDSHAKE",a[a.OPEN=1]="OPEN",a[a.OPENED=2]="OPENED",a[a.RESPONSE=3]="RESPONSE",a[a.INVOKE=4]="INVOKE",a[a.ABORT=5]="ABORT",a[a.CLOSE=6]="CLOSE",a[a.OPEN_PORT=7]="OPEN_PORT",a[a.ON=8]="ON";let l=0;function u(){return l++}function c(e){return e?"string"==typeof e?JSON.stringify({name:"message",message:e}):e.toJSON?JSON.stringify(e):JSON.stringify({name:e.name,message:e.message,details:e.details||{stack:e.stack}}):null}function p(e,t,r,i){if(t.type===o.OPEN_PORT)return void e.postMessage(t,[t.port]);if(t.type!==o.INVOKE&&t.type!==o.RESPONSE)return void e.postMessage(t);let s;if(function(e){return e&&"object"==typeof e&&("result"in e||"transferList"in e)}(r)?(s=h(r.transferList),t.data=r.result):(s=h(i),t.data=r),s){if((0,n.A)("ff"))for(const r of s)if("byteLength"in r&&r.byteLength>267386880){const r="Worker call with large ArrayBuffer would crash Firefox";switch(t.type){case o.INVOKE:throw r;case o.RESPONSE:return void p(e,{type:o.RESPONSE,jobId:t.jobId,error:c(r)})}}e.postMessage(t,s)}else e.postMessage(t)}function d(e){if(!e)return null;const t=e.data;return t?"string"==typeof t?JSON.parse(t):t:null}function h(e){if(!e?.length)return null;if((0,n.A)("esri-workers-arraybuffer-transfer"))return e;const t=e.filter((e=>!function(e){return e instanceof ArrayBuffer||"ArrayBuffer"===e?.constructor?.name}(e)));return t.length?t:null}async function f(e){try{return await e}catch(e){const t=e?.name===s;if(!(0,i.zf)(e)&&!t)throw e;return}}},86027:function(e,t,r){r.d(t,{n_:function(){return U},ho:function(){return G}});var n=r(39819),i=r(58941),s=r(60539),o=r(37797),a=r(13370),l=r(50193),u=r(40633),c=r(95929),p=r(93040),d=r(90683);const h={async request(e,t){const r=e.options,n=r.responseType;r.signal=t?.signal,r.responseType="native"===n||"native-request-init"===n?"native-request-init":n&&["blob","json","text"].includes(n)&&(0,d.sC)(e.url)?.after?n:"array-buffer";const i=await(0,p.A)(e.url,r),s={data:i.data,httpStatus:i.httpStatus,ssl:i.ssl};switch(i.requestOptions?.responseType){case"native-request-init":return delete s.data.signal,s;case"blob":s.data=await s.data.arrayBuffer();break;case"json":s.data=(new TextEncoder).encode(JSON.stringify(s.data)).buffer;break;case"text":s.data=(new TextEncoder).encode(s.data).buffer}return{result:s,transferList:[s.data]}}};var f=r(64272),y=r(53216),m=r(25591),g=(r(64122),r(7156));const w={};var _=r(29601);class v{constructor(){const e=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach((t=>{this[t]=(...r)=>e[t](...r)}))}}class b{constructor(){this._dispatcher=new v,this._workerPostMessage({type:f.Go.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=e,e&&this.addEventListener("message",e)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(e){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=e,e&&this.addEventListener("messageerror",e)}get onerror(){return this._onerrorHandler}set onerror(e){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=e,e&&this.addEventListener("error",e)}postMessage(e){(0,_.d)((()=>{this._workerMessageHandler(new MessageEvent("message",{data:e}))}))}dispatchEvent(e){return this._dispatcher.dispatchEvent(e)}addEventListener(e,t,r){this._dispatcher.addEventListener(e,t,r)}removeEventListener(e,t,r){this._dispatcher.removeEventListener(e,t,r)}_workerPostMessage(e){(0,_.d)((()=>{this.dispatchEvent(new MessageEvent("message",{data:e}))}))}async _workerMessageHandler(e){const t=(0,f.VI)(e);if(t&&t.type===f.Go.OPEN){const{modulePath:e,jobId:r}=t;let n=await l.A.loadWorker(e);n||(n=await import(e));const i=l.A.connect(n);this._workerPostMessage({type:f.Go.OPENED,jobId:r,data:i})}}}var S=r(22739),I=r(23532);const M=()=>u.A.getLogger("esri.core.workers.workerFactory"),{HANDSHAKE:x}=f.Go;let F,A;const T="Failed to create Worker. Fallback to execute module in main thread";async function C(e){return new Promise((t=>{function r(i){const s=(0,f.VI)(i);s&&s.type===x&&(e.removeEventListener("message",r),e.removeEventListener("error",n),t(e))}function n(t){t.preventDefault(),e.removeEventListener("message",r),e.removeEventListener("error",n),M().warn("Failed to create Worker. Fallback to execute module in main thread",t),(e=new b).addEventListener("message",r),e.addEventListener("error",n)}e.addEventListener("message",r),e.addEventListener("error",n)}))}let E=0;const{ABORT:L,INVOKE:O,OPEN:R,OPENED:k,RESPONSE:N}=f.Go;class D{static async create(e){const t=await async function(){if(!(0,i.A)("esri-workers"))return C(new b);if(!F&&!A)try{const e='let globalId=0;const outgoing=new Map,configuration={CONFIGURATION};self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;let s=null;return new Promise(((r,i)=>{if(t){if(t.aborted)return i(createAbortError());s=()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:5,jobId:n}),i(createAbortError()))},t.addEventListener("abort",s)}outgoing.set(n,{resolve:r,reject:i}),self.postMessage({type:4,jobId:n,methodName:e,abortable:null!=t,data:o})})).finally((()=>{t&&t.removeEventListener("abort",s)}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,fullVersion:r}=configuration.kernelInfo,{revision:t,fullVersion:n,version:s}=e.kernelInfo;esriConfig.assetsPath!==esriConfig.defaultAssetsPath&&o!==t&&console.warn(`Version mismatch detected between ArcGIS Maps SDK for JavaScript modules and assets. For more information visit https://bit.ly/3QnsuSo.\nModules version: ${r}\nAssets version: ${n??s}\nAssets path: ${esriConfig.assetsPath}`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case 1:let n;function t(e){const o=n.connect(e);self.postMessage({type:2,jobId:r,data:o},[o])}"function"==typeof define&&define.amd?require([workerPath],(e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((e=>(n=e.default,checkWorkerRevision(n),n.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),n=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(n),n.loadWorker(o.modulePath).then(t));break;case 3:if(outgoing.has(r)){const s=outgoing.get(r);outgoing.delete(r),o.error?s.reject(JSON.parse(o.error)):s.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});'.split("{CONFIGURATION}").join(function(){let e;if(null!=m.default.default){const t={...m.default};delete t.default,e=JSON.parse(JSON.stringify(t))}else e=JSON.parse(JSON.stringify(m.default));e.assetsPath=(0,d.s2)(e.assetsPath),e.defaultAssetsPath=e.defaultAssetsPath?(0,d.s2)(e.defaultAssetsPath):void 0,e.request.interceptors=[],e.log.interceptors=[],e.locale=(0,S.JK)(),e.has={"esri-csp-restrictions":(0,i.A)("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":(0,i.A)("esri-2d-update-debug"),"esri-2d-log-updating":(0,i.A)("esri-2d-log-updating"),"featurelayer-pbf":(0,i.A)("featurelayer-pbf"),"featurelayer-fast-triangulation-enabled":(0,i.A)("featurelayer-fast-triangulation-enabled"),"featurelayer-simplify-thresholds":(0,i.A)("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":(0,i.A)("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":(0,i.A)("featurelayer-simplify-mobile-factor"),"featurelayer-query-max-depth":(0,i.A)("featurelayer-query-max-depth"),"featurelayer-query-pausing-enabled":(0,i.A)("featurelayer-query-pausing-enabled"),"featurelayer-snapshot-enabled":(0,i.A)("featurelayer-snapshot-enabled"),"esri-atomics":(0,i.A)("esri-atomics"),"esri-shared-array-buffer":(0,i.A)("esri-shared-array-buffer"),"esri-tiles-debug":(0,i.A)("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":(0,i.A)("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":(0,i.A)("feature-polyline-generalization-factor"),"host-webworker":1},e.workers.loaderUrl&&(e.workers.loaderUrl=(0,d.s2)(e.workers.loaderUrl)),e.workers.workerPath?e.workers.workerPath=(0,d.s2)(e.workers.workerPath):e.workers.workerPath=(0,d.s2)((0,y.s)("esri/core/workers/RemoteClient.js")),e.workers.useDynamicImport=!1;const t=m.default.workers.loaderConfig,r=function(e){const t={async:e.async,isDebug:e.isDebug,locale:e.locale,baseUrl:e.baseUrl,has:{...e.has},map:{...e.map},packages:e.packages?.slice()||[],paths:{...w.paths,...e.paths}};return e.hasOwnProperty("async")||(t.async=!0),e.hasOwnProperty("isDebug")||(t.isDebug=!1),e.baseUrl||(t.baseUrl=w.baseUrl),t}({baseUrl:t?.baseUrl,locale:(0,S.JK)(),has:{"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1,...t?.has},map:{...t?.map},paths:{...t?.paths},packages:t?.packages||[]}),n={buildDate:I.$,fullVersion:g.ol,revision:I.u};return JSON.stringify({esriConfig:e,loaderConfig:r,kernelInfo:n})}());F=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))}catch(e){A=e||{}}let e;if(F)try{e=new Worker(F,{name:"esri-worker-"+E++})}catch(t){M().warn(T,A),e=new b}else M().warn(T,A),e=new b;return C(e)}();return new D(t,e)}constructor(e,t){this._outJobs=new Map,this._inJobs=new Map,this.worker=e,this.id=t,e.addEventListener("message",this._onMessage.bind(this)),e.addEventListener("error",(e=>{e.preventDefault(),u.A.getLogger("esri.core.workers.WorkerOwner").error(e)}))}terminate(){this.worker.terminate()}async open(e,t={}){const{signal:r}=t,n=(0,f.Jc)();return new Promise(((t,i)=>{const o={resolve:t,reject:i,abortHandle:(0,s.NY)(r,(()=>{this._outJobs.delete(n),this._post({type:L,jobId:n})}))};this._outJobs.set(n,o),this._post({type:R,jobId:n,modulePath:e})}))}_onMessage(e){const t=(0,f.VI)(e);if(t)switch(t.type){case k:this._onOpenedMessage(t);break;case N:this._onResponseMessage(t);break;case L:this._onAbortMessage(t);break;case O:this._onInvokeMessage(t)}}_onAbortMessage(e){const t=this._inJobs,r=e.jobId,n=t.get(r);n&&(n.controller&&n.controller.abort(),t.delete(r))}_onInvokeMessage(e){const{methodName:t,jobId:r,data:n,abortable:i}=e,o=i?new AbortController:null,a=this._inJobs,l=h[t];let u;try{if("function"!=typeof l)throw new TypeError(`${t} is not a function`);u=l.call(null,n,{signal:o?o.signal:null})}catch(e){return void this._post({type:N,jobId:r,error:(0,f.mF)(e)})}(0,s.$X)(u)?(a.set(r,{controller:o,promise:u}),u.then((e=>{a.has(r)&&(a.delete(r),this._post({type:N,jobId:r},e))}),(e=>{a.has(r)&&(a.delete(r),e||(e={message:"Error encountered at method"+t}),(0,s.zf)(e)||this._post({type:N,jobId:r,error:(0,f.mF)(e||{message:`Error encountered at method ${t}`})}))}))):this._post({type:N,jobId:r},u)}_onOpenedMessage(e){const{jobId:t,data:r}=e,n=this._outJobs.get(t);n&&(this._outJobs.delete(t),(0,c.xt)(n.abortHandle),n.resolve(r))}_onResponseMessage(e){const{jobId:t,error:r,data:i}=e,s=this._outJobs.get(t);s&&(this._outJobs.delete(t),(0,c.xt)(s.abortHandle),r?s.reject(n.A.fromJSON(JSON.parse(r))):s.resolve(i))}_post(e,t,r){return(0,f.u1)(this.worker,e,t,r)}}const P=(0,i.A)("host-browser")?Math.min(navigator.hardwareConcurrency-1,(0,i.A)("workers-pool-size")??8):0;let Z=(0,i.A)("esri-mobile")?Math.min(P,3):P;Z||(Z=(0,i.A)("safari")&&(0,i.A)("mac")?7:2);let j=0;const V=[];function U(){$()}async function z(e,t){const r=new o.A,{registryTarget:n,...i}=t;return await r.open(e,i),n&&(0,a.k)(n,r),r}async function G(e,t={}){if("string"!=typeof e)throw new n.A("workers:undefined-module","modulePath is missing");let r=t.strategy||"distributed";if((0,i.A)("host-webworker")&&!(0,i.A)("esri-workers")&&(r="local"),"local"===r){let r=await l.A.loadWorker(e);r||(r=await import(e)),(0,s.Te)(t.signal);const n=t.client||r;return z([l.A.connect(r,t.schedule)],{...t,client:n})}if(await $(),(0,s.Te)(t.signal),"dedicated"===r){const r=j++%Z;return z([await V[r].open(e,t)],t)}if(t.maxNumWorkers&&t.maxNumWorkers>0){const r=Math.min(t.maxNumWorkers,Z);if(r<Z){const n=new Array(r);for(let i=0;i<r;++i){const r=j++%Z;n[i]=V[r].open(e,t)}return z(n,t)}}return z(V.map((r=>r.open(e,t))),t)}let q,B=null;async function $(){if(B)return B;q=new AbortController;const e=[];for(let t=0;t<Z;t++){const r=D.create(t).then((e=>(V[t]=e,e)));e.push(r)}return B=Promise.all(e),B}},79554:function(e,t,r){r.d(t,{A:function(){return rt}});var n,i=r(53804),s=r(30905),o=r(21609),a=r(17660),l=r(23502),u=r(77560),c=r(47332),p=r(65953),d=r(81392);r(58941),r(40633),r(13798);let h=n=class extends s.oY{constructor(e){super(e),this.expression=null,this.name=null,this.returnType="boolean",this.title=null}clone(){return new n({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};(0,i._)([(0,l.MZ)({type:String,json:{write:!0}})],h.prototype,"expression",void 0),(0,i._)([(0,l.MZ)({type:String,json:{write:!0}})],h.prototype,"name",void 0),(0,i._)([(0,l.MZ)({type:["boolean","date","number","string"],json:{write:!0}})],h.prototype,"returnType",void 0),(0,i._)([(0,l.MZ)({type:String,json:{write:!0}})],h.prototype,"title",void 0),h=n=(0,i._)([(0,p.$)("esri.form.ExpressionInfo")],h);const f=h;let y=class extends s.oY{constructor(e){super(e),this.description=null,this.label=null,this.type=null,this.visibilityExpression=null}};(0,i._)([(0,l.MZ)({type:String,json:{write:!0}})],y.prototype,"description",void 0),(0,i._)([(0,l.MZ)({type:String,json:{write:!0}})],y.prototype,"label",void 0),(0,i._)([(0,l.MZ)()],y.prototype,"type",void 0),(0,i._)([(0,l.MZ)({type:String,json:{write:!0}})],y.prototype,"visibilityExpression",void 0),y=(0,i._)([(0,p.$)("esri.form.elements.Element")],y);const m=y;var g=r(67888),w=r(75743);let _=class extends((0,w.O)(s.oY)){constructor(e){super(e),this.type=null}};(0,i._)([(0,l.MZ)()],_.prototype,"type",void 0),_=(0,i._)([(0,p.$)("esri.form.elements.inputs.attachments.Input")],_);const v=_,b=["any","capture","upload"];let S=class extends v{constructor(e){super(e),this.type="audio",this.inputMethod="any",this.maxDuration=null}};(0,i._)([(0,l.MZ)({type:["audio"],readOnly:!0,json:{write:!0}})],S.prototype,"type",void 0),(0,i._)([(0,l.MZ)({type:b,json:{write:!0}})],S.prototype,"inputMethod",void 0),(0,i._)([(0,l.MZ)({type:Number,json:{write:!0}})],S.prototype,"maxDuration",void 0),S=(0,i._)([(0,p.$)("esri.form.elements.inputs.attachments.AudioInput")],S);const I=S;let M=class extends v{constructor(e){super(e),this.type="document",this.maxFileSize=null}};(0,i._)([(0,l.MZ)({type:["document"],readOnly:!0,json:{write:!0}})],M.prototype,"type",void 0),(0,i._)([(0,l.MZ)({type:Number,json:{write:!0}})],M.prototype,"maxFileSize",void 0),M=(0,i._)([(0,p.$)("esri.form.elements.inputs.attachments.DocumentInput")],M);const x=M;let F=class extends v{constructor(e){super(e),this.type="image",this.inputMethod="any",this.maxImageSize=null}};(0,i._)([(0,l.MZ)({type:["image"],readOnly:!0,json:{write:!0}})],F.prototype,"type",void 0),(0,i._)([(0,l.MZ)({type:b,json:{write:!0}})],F.prototype,"inputMethod",void 0),(0,i._)([(0,l.MZ)({type:Number,json:{write:!0}})],F.prototype,"maxImageSize",void 0),F=(0,i._)([(0,p.$)("esri.form.elements.inputs.attachments.ImageInput")],F);const A=F;let T=class extends v{constructor(e){super(e),this.type="signature",this.inputMethod="any"}};(0,i._)([(0,l.MZ)({type:["signature"],readOnly:!0,json:{write:!0}})],T.prototype,"type",void 0),(0,i._)([(0,l.MZ)({type:b,json:{write:!0}})],T.prototype,"inputMethod",void 0),T=(0,i._)([(0,p.$)("esri.form.elements.inputs.attachments.SignatureInput")],T);const C=T;let E=class extends v{constructor(e){super(e),this.type="video",this.inputMethod="any",this.maxDuration=null}};(0,i._)([(0,l.MZ)({type:["video"],readOnly:!0,json:{write:!0}})],E.prototype,"type",void 0),(0,i._)([(0,l.MZ)({type:b,json:{write:!0}})],E.prototype,"inputMethod",void 0),(0,i._)([(0,l.MZ)({type:Number,json:{write:!0}})],E.prototype,"maxDuration",void 0),E=(0,i._)([(0,p.$)("esri.form.elements.inputs.attachments.VideoInput")],E);const L=E;function O(e){return{nestableTypes:{base:v,key:"type",typeMap:{audio:I,document:x,image:A,signature:C,video:L}},allTypes:{base:v,key:"type",typeMap:{attachment:e,audio:I,document:x,image:A,signature:C,video:L}}}}let R=class extends v{constructor(e){super(e),this.type="attachment",this.attachmentAssociationType="exact",this.inputTypes=null}castInputs(e){return function(e,t){return e?e.map((e=>(0,g.aq)(t.nestableTypes,e))):null}(e,k)}readInputs(e,t){return function(e,t){if(!e)return null;const r=t.nestableTypes.typeMap;return e.filter((e=>r[e.type])).map((e=>r[e.type].fromJSON(e)))}(t.inputTypes,k)}writeInputs(e,t){t.inputTypes=function(e,t){if(!e)return null;const r=t.nestableTypes.typeMap;return e.filter((e=>r[e.type])).map((e=>e.toJSON()))}(e,k)}};(0,i._)([(0,l.MZ)({type:["attachment"],readOnly:!0,json:{write:!0}})],R.prototype,"type",void 0),(0,i._)([(0,l.MZ)({type:["any","exact","exactOrNone"],json:{write:!0}})],R.prototype,"attachmentAssociationType",void 0),(0,i._)([(0,l.MZ)({json:{write:{isRequired:!0}}})],R.prototype,"inputTypes",void 0),(0,i._)([(0,u.w)("inputTypes")],R.prototype,"castInputs",null),(0,i._)([(0,c.w)("inputTypes")],R.prototype,"readInputs",null),(0,i._)([(0,d.K)("inputTypes")],R.prototype,"writeInputs",null),R=(0,i._)([(0,p.$)("esri.form.elements.inputs.attachments.AttachmentInput")],R);const k=O(R);var N;const D=O(R);let P=N=class extends m{constructor(e){super(e),this.allowUserRename=!0,this.attachmentKeyword=null,this.displayFilename=!1,this.editableExpression=null,this.filenameExpression="{attachmentKeyword}_{now}",this.input=null,this.maxAttachmentCount=null,this.minAttachmentCount=null,this.type="attachment",this.useOriginalFilename=!0}clone(){return new N({allowUserRename:this.allowUserRename,attachmentKeyword:this.attachmentKeyword,description:this.description,displayFilename:this.displayFilename,editableExpression:this.editableExpression,filenameExpression:this.filenameExpression,input:this.input?.clone(),label:this.label,maxAttachmentCount:this.maxAttachmentCount,minAttachmentCount:this.minAttachmentCount,useOriginalFilename:this.useOriginalFilename,visibilityExpression:this.visibilityExpression})}};(0,i._)([(0,l.MZ)({type:Boolean,json:{write:!0}})],P.prototype,"allowUserRename",void 0),(0,i._)([(0,l.MZ)({type:String,json:{write:{isRequired:!0}}})],P.prototype,"attachmentKeyword",void 0),(0,i._)([(0,l.MZ)({type:Boolean,json:{write:!0}})],P.prototype,"displayFilename",void 0),(0,i._)([(0,l.MZ)({type:String,json:{write:!0}})],P.prototype,"editableExpression",void 0),(0,i._)([(0,l.MZ)({type:String,json:{write:!0}})],P.prototype,"filenameExpression",void 0),(0,i._)([(0,l.MZ)({types:D.allTypes,json:{read:{source:"inputType"},write:{target:"inputType",isRequired:!0}}})],P.prototype,"input",void 0),(0,i._)([(0,l.MZ)({type:Number,json:{write:!0}})],P.prototype,"maxAttachmentCount",void 0),(0,i._)([(0,l.MZ)({type:Number,json:{write:!0}})],P.prototype,"minAttachmentCount",void 0),(0,i._)([(0,l.MZ)({type:["attachment"],readOnly:!0,json:{read:!1,write:!0}})],P.prototype,"type",void 0),(0,i._)([(0,l.MZ)({type:Boolean,json:{write:!0}})],P.prototype,"useOriginalFilename",void 0),P=N=(0,i._)([(0,p.$)("esri.form.elements.AttachmentElement")],P);const Z=P;let j=class extends s.oY{constructor(e){super(e),this.type=null}};(0,i._)([(0,l.MZ)()],j.prototype,"type",void 0),j=(0,i._)([(0,p.$)("esri.form.elements.inputs.Input")],j);const V=j;let U=class extends V{constructor(e){super(e),this.maxLength=null,this.minLength=0}};(0,i._)([(0,l.MZ)({type:Number,json:{write:!0}})],U.prototype,"maxLength",void 0),(0,i._)([(0,l.MZ)({type:Number,json:{write:!0}})],U.prototype,"minLength",void 0),U=(0,i._)([(0,p.$)("esri.form.elements.inputs.TextInput")],U);const z=U;var G;let q=G=class extends z{constructor(e){super(e),this.type="barcode-scanner"}clone(){return new G({maxLength:this.maxLength,minLength:this.minLength})}};(0,i._)([(0,l.MZ)({type:["barcode-scanner"],json:{read:!1,write:!0}})],q.prototype,"type",void 0),q=G=(0,i._)([(0,p.$)("esri.form.elements.inputs.BarcodeScannerInput")],q);const B=q;var $;let J=$=class extends V{constructor(e){super(e),this.noValueOptionLabel=null,this.showNoValueOption=!0,this.type="combo-box"}clone(){return new $({showNoValueOption:this.showNoValueOption,noValueOptionLabel:this.noValueOptionLabel})}};(0,i._)([(0,l.MZ)({type:String,json:{write:!0}})],J.prototype,"noValueOptionLabel",void 0),(0,i._)([(0,l.MZ)({type:Boolean,json:{write:!0}})],J.prototype,"showNoValueOption",void 0),(0,i._)([(0,l.MZ)({type:["combo-box"],json:{read:!1,write:!0}})],J.prototype,"type",void 0),J=$=(0,i._)([(0,p.$)("esri.form.elements.inputs.ComboBoxInput")],J);const W=J;var H;function Q(e){return null!=e?e:null}function K(e){return null!=e?e:null}let Y=H=class extends V{constructor(e){super(e),this.max=null,this.min=null,this.type="date-picker"}readMax(e,t){return Q(t.max)}writeMax(e,t){t.max=K(e)}readMin(e,t){return Q(t.min)}writeMin(e,t){t.min=K(e)}clone(){return new H({max:this.max,min:this.min})}};(0,i._)([(0,l.MZ)({type:String,json:{type:String,write:!0}})],Y.prototype,"max",void 0),(0,i._)([(0,c.w)("max")],Y.prototype,"readMax",null),(0,i._)([(0,d.K)("max")],Y.prototype,"writeMax",null),(0,i._)([(0,l.MZ)({type:String,json:{type:String,write:!0}})],Y.prototype,"min",void 0),(0,i._)([(0,c.w)("min")],Y.prototype,"readMin",null),(0,i._)([(0,d.K)("min")],Y.prototype,"writeMin",null),(0,i._)([(0,l.MZ)({type:["date-picker"],json:{read:!1,write:!0}})],Y.prototype,"type",void 0),Y=H=(0,i._)([(0,p.$)("esri.form.elements.inputs.DatePickerInput")],Y);const X=Y;var ee;function te(e){return null!=e?e:null}function re(e){return null!=e?e:null}let ne=ee=class extends V{constructor(e){super(e),this.includeTimeOffset=!0,this.max=null,this.min=null,this.timeResolution="minutes",this.type="datetimeoffset-picker"}readMax(e,t){return te(t.max)}writeMax(e,t){t.max=re(e)}readMin(e,t){return te(t.min)}writeMin(e,t){t.min=re(e)}readTimeResolution(e,t){return te(t.timeResolution)}writeTimeResolution(e,t){t.timeResolution=re(e)}clone(){return new ee({includeTimeOffset:this.includeTimeOffset,max:this.max,min:this.min,timeResolution:this.timeResolution})}};(0,i._)([(0,l.MZ)({type:Boolean,json:{write:!0}})],ne.prototype,"includeTimeOffset",void 0),(0,i._)([(0,l.MZ)({type:String,json:{type:String,write:!0}})],ne.prototype,"max",void 0),(0,i._)([(0,c.w)("max")],ne.prototype,"readMax",null),(0,i._)([(0,d.K)("max")],ne.prototype,"writeMax",null),(0,i._)([(0,l.MZ)({type:String,json:{type:String,write:!0}})],ne.prototype,"min",void 0),(0,i._)([(0,c.w)("min")],ne.prototype,"readMin",null),(0,i._)([(0,d.K)("min")],ne.prototype,"writeMin",null),(0,i._)([(0,l.MZ)({type:String,json:{type:String,write:!0}})],ne.prototype,"timeResolution",void 0),(0,i._)([(0,c.w)("timeResolution")],ne.prototype,"readTimeResolution",null),(0,i._)([(0,d.K)("timeResolution")],ne.prototype,"writeTimeResolution",null),(0,i._)([(0,l.MZ)({type:["datetimeoffset-picker"],json:{read:!1,write:!0}})],ne.prototype,"type",void 0),ne=ee=(0,i._)([(0,p.$)("esri.form.elements.inputs.DateTimeOffsetPickerInput")],ne);const ie=ne;var se;function oe(e){return null!=e?new Date(e):null}function ae(e){return e?e.getTime():null}let le=se=class extends V{constructor(e){super(e),this.includeTime=!1,this.max=null,this.min=null,this.type="datetime-picker"}readMax(e,t){return oe(t.max)}writeMax(e,t){t.max=ae(e)}readMin(e,t){return oe(t.min)}writeMin(e,t){t.min=ae(e)}clone(){return new se({includeTime:this.includeTime,max:this.max,min:this.min})}};(0,i._)([(0,l.MZ)({type:Boolean,json:{write:!0}})],le.prototype,"includeTime",void 0),(0,i._)([(0,l.MZ)({type:Date,json:{type:Number,write:!0}})],le.prototype,"max",void 0),(0,i._)([(0,c.w)("max")],le.prototype,"readMax",null),(0,i._)([(0,d.K)("max")],le.prototype,"writeMax",null),(0,i._)([(0,l.MZ)({type:Date,json:{type:Number,write:!0}})],le.prototype,"min",void 0),(0,i._)([(0,c.w)("min")],le.prototype,"readMin",null),(0,i._)([(0,d.K)("min")],le.prototype,"writeMin",null),(0,i._)([(0,l.MZ)({type:["datetime-picker"],json:{read:!1,write:!0}})],le.prototype,"type",void 0),le=se=(0,i._)([(0,p.$)("esri.form.elements.inputs.DateTimePickerInput")],le);const ue=le;var ce;let pe=ce=class extends V{constructor(e){super(e),this.noValueOptionLabel=null,this.showNoValueOption=!0,this.type="radio-buttons"}clone(){return new ce({noValueOptionLabel:this.noValueOptionLabel,showNoValueOption:this.showNoValueOption})}};(0,i._)([(0,l.MZ)({type:String,json:{write:!0}})],pe.prototype,"noValueOptionLabel",void 0),(0,i._)([(0,l.MZ)({type:Boolean,json:{write:!0}})],pe.prototype,"showNoValueOption",void 0),(0,i._)([(0,l.MZ)({type:["radio-buttons"],json:{read:!1,write:!0}})],pe.prototype,"type",void 0),pe=ce=(0,i._)([(0,p.$)("esri.form.elements.inputs.RadioButtonsInput")],pe);const de=pe;var he;let fe=he=class extends V{constructor(e){super(e),this.offValue=null,this.onValue=null,this.type="switch"}clone(){return new he({offValue:this.offValue,onValue:this.onValue})}};(0,i._)([(0,l.MZ)({type:[String,Number],json:{write:!0}})],fe.prototype,"offValue",void 0),(0,i._)([(0,l.MZ)({type:[String,Number],json:{write:!0}})],fe.prototype,"onValue",void 0),(0,i._)([(0,l.MZ)({type:["switch"],json:{read:!1,write:!0}})],fe.prototype,"type",void 0),fe=he=(0,i._)([(0,p.$)("esri.form.elements.inputs.SwitchInput")],fe);const ye=fe;var me;let ge=me=class extends z{constructor(e){super(e),this.type="text-area"}clone(){return new me({maxLength:this.maxLength,minLength:this.minLength})}};(0,i._)([(0,l.MZ)({type:["text-area"],json:{read:!1,write:!0}})],ge.prototype,"type",void 0),ge=me=(0,i._)([(0,p.$)("esri.form.elements.inputs.TextAreaInput")],ge);const we=ge;var _e;let ve=_e=class extends z{constructor(e){super(e),this.type="text-box"}clone(){return new _e({maxLength:this.maxLength,minLength:this.minLength})}};(0,i._)([(0,l.MZ)({type:["text-box"],json:{read:!1,write:!0}})],ve.prototype,"type",void 0),ve=_e=(0,i._)([(0,p.$)("esri.form.elements.inputs.TextBoxInput")],ve);const be=ve;var Se;function Ie(e){return null!=e?e:null}function Me(e){return null!=e?e:null}let xe=Se=class extends V{constructor(e){super(e),this.max=null,this.min=null,this.timeResolution="minutes",this.type="time-picker"}readMax(e,t){return Ie(t.max)}writeMax(e,t){t.max=Me(e)}readMin(e,t){return Ie(t.min)}writeMin(e,t){t.min=Me(e)}readTimeResolution(e,t){return Ie(t.timeResolution)}writeTimeResolution(e,t){t.timeResolution=Me(e)}clone(){return new Se({max:this.max,min:this.min,timeResolution:this.timeResolution})}};(0,i._)([(0,l.MZ)({type:String,json:{type:String,write:!0}})],xe.prototype,"max",void 0),(0,i._)([(0,c.w)("max")],xe.prototype,"readMax",null),(0,i._)([(0,d.K)("max")],xe.prototype,"writeMax",null),(0,i._)([(0,l.MZ)({type:String,json:{type:String,write:!0}})],xe.prototype,"min",void 0),(0,i._)([(0,c.w)("min")],xe.prototype,"readMin",null),(0,i._)([(0,d.K)("min")],xe.prototype,"writeMin",null),(0,i._)([(0,l.MZ)({type:String,json:{type:String,write:!0}})],xe.prototype,"timeResolution",void 0),(0,i._)([(0,c.w)("timeResolution")],xe.prototype,"readTimeResolution",null),(0,i._)([(0,d.K)("timeResolution")],xe.prototype,"writeTimeResolution",null),(0,i._)([(0,l.MZ)({type:["time-picker"],json:{read:!1,write:!0}})],xe.prototype,"type",void 0),xe=Se=(0,i._)([(0,p.$)("esri.form.elements.inputs.TimePickerInput")],xe);const Fe={base:V,key:"type",typeMap:{"barcode-scanner":B,"combo-box":W,"date-picker":X,"datetime-picker":ue,"datetimeoffset-picker":ie,"radio-buttons":de,switch:ye,"text-area":we,"text-box":be,"time-picker":xe}};var Ae,Te=r(97424);let Ce=Ae=class extends m{constructor(e){super(e),this.domain=null,this.editable=null,this.editableExpression=null,this.fieldName=null,this.hint=null,this.input=null,this.requiredExpression=null,this.type="field",this.valueExpression=null}clone(){return new Ae({description:this.description,domain:this.domain,editable:this.editable,editableExpression:this.editableExpression,fieldName:this.fieldName,hint:this.hint,input:this.input,label:this.label,requiredExpression:this.requiredExpression,valueExpression:this.valueExpression,visibilityExpression:this.visibilityExpression})}};(0,i._)([(0,l.MZ)({types:Te.gK,json:{read:{reader:Te.rS},write:!0}})],Ce.prototype,"domain",void 0),(0,i._)([(0,l.MZ)({type:Boolean,json:{write:!0}})],Ce.prototype,"editable",void 0),(0,i._)([(0,l.MZ)({type:String,json:{write:!0}})],Ce.prototype,"editableExpression",void 0),(0,i._)([(0,l.MZ)({type:String,json:{write:!0}})],Ce.prototype,"fieldName",void 0),(0,i._)([(0,l.MZ)({type:String,json:{write:!0}})],Ce.prototype,"hint",void 0),(0,i._)([(0,l.MZ)({types:Fe,json:{read:{source:"inputType"},write:{target:"inputType"}}})],Ce.prototype,"input",void 0),(0,i._)([(0,l.MZ)({type:String,json:{write:!0}})],Ce.prototype,"requiredExpression",void 0),(0,i._)([(0,l.MZ)({type:String,json:{read:!1,write:!0}})],Ce.prototype,"type",void 0),(0,i._)([(0,l.MZ)({type:String,json:{write:!0}})],Ce.prototype,"valueExpression",void 0),Ce=Ae=(0,i._)([(0,p.$)("esri.form.elements.FieldElement")],Ce);const Ee=Ce;var Le,Oe=r(23105);let Re=Le=class extends m{constructor(e){super(e),this.displayCount=null,this.displayType="list",this.editableExpression=null,this.orderByFields=null,this.relationshipId=null,this.type="relationship"}clone(){return new Le({description:this.description,displayCount:this.displayCount,displayType:this.displayType,editableExpression:this.editableExpression,label:this.label,orderByFields:(0,o.o8)(this.orderByFields),relationshipId:this.relationshipId,visibilityExpression:this.visibilityExpression})}};(0,i._)([(0,l.MZ)({type:Number,json:{write:!0}})],Re.prototype,"displayCount",void 0),(0,i._)([(0,l.MZ)({type:["list"],json:{write:!0}})],Re.prototype,"displayType",void 0),(0,i._)([(0,l.MZ)({type:String,json:{write:!0}})],Re.prototype,"editableExpression",void 0),(0,i._)([(0,l.MZ)({type:[Oe.A],json:{write:!0}})],Re.prototype,"orderByFields",void 0),(0,i._)([(0,l.MZ)({type:Number,json:{write:!0}})],Re.prototype,"relationshipId",void 0),(0,i._)([(0,l.MZ)({type:["relationship"],json:{read:!1,write:!0}})],Re.prototype,"type",void 0),Re=Le=(0,i._)([(0,p.$)("esri.form.elements.RelationshipElement")],Re);const ke=Re;var Ne;let De=Ne=class extends m{constructor(e){super(e),this.text=null,this.textFormat="plain-text",this.type="text"}clone(){return new Ne({text:this.text,textFormat:this.textFormat,visibilityExpression:this.visibilityExpression})}};(0,i._)([(0,l.MZ)({type:String,json:{write:!0}})],De.prototype,"text",void 0),(0,i._)([(0,l.MZ)({type:String,json:{write:!0}})],De.prototype,"textFormat",void 0),(0,i._)([(0,l.MZ)({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],De.prototype,"type",void 0),De=Ne=(0,i._)([(0,p.$)("esri.form.elements.TextElement")],De);const Pe=De;function Ze(e){return{typesWithGroup:{base:m,key:"type",typeMap:{attachment:Z,field:Ee,group:e,relationship:ke,text:Pe}},typesWithoutGroup:{base:m,key:"type",typeMap:{attachment:Z,field:Ee,relationship:ke,text:Pe}}}}function je(e,t,r=!0){if(!e)return null;const n=r?t.typesWithGroup.typeMap:t.typesWithoutGroup.typeMap;return e.filter((e=>n[e.type])).map((e=>n[e.type].fromJSON(e)))}function Ve(e,t,r=!0){if(!e)return null;const n=r?t.typesWithGroup.typeMap:t.typesWithoutGroup.typeMap;return e.filter((e=>n[e.type])).map((e=>e.toJSON()))}function Ue(e,t,r=!0){return e?e.map((e=>(0,g.aq)(r?t.typesWithGroup:t.typesWithoutGroup,e))):null}var ze;let Ge=ze=class extends m{constructor(e){super(e),this.elements=null,this.initialState="expanded",this.type="group"}castElements(e){return Ue(e,qe,!1)}readElements(e,t){return je(t.formElements,qe,!1)}writeElements(e,t){t.formElements=Ve(e,qe,!1)}clone(){return new ze({description:this.description,elements:(0,o.o8)(this.elements),initialState:this.initialState,label:this.label,visibilityExpression:this.visibilityExpression})}};(0,i._)([(0,l.MZ)({json:{write:!0}})],Ge.prototype,"elements",void 0),(0,i._)([(0,u.w)("elements")],Ge.prototype,"castElements",null),(0,i._)([(0,c.w)("elements",["formElements"])],Ge.prototype,"readElements",null),(0,i._)([(0,d.K)("elements")],Ge.prototype,"writeElements",null),(0,i._)([(0,l.MZ)({type:["collapsed","expanded"],json:{write:!0}})],Ge.prototype,"initialState",void 0),(0,i._)([(0,l.MZ)({type:String,json:{read:!1,write:!0}})],Ge.prototype,"type",void 0),Ge=ze=(0,i._)([(0,p.$)("esri.form.elements.GroupElement")],Ge);const qe=Ze(Ge),Be=Ge,$e=e=>"field"===e.type,Je=e=>"group"===e.type,We=e=>"text"===e.type;var He,Qe=r(53743);const Ke=Ze(Be);let Ye=He=class extends s.oY{constructor(e){super(e),this.description=null,this.elements=null,this.expressionInfos=null,this.preserveFieldValuesWhenHidden=!1,this.title=null}castElements(e){return Ue(e,Ke)}readElements(e,t){return je(t.formElements,Ke)}writeElements(e,t){t.formElements=Ve(e,Ke)}clone(){return new He({description:this.description,expressionInfos:(0,o.o8)(this.expressionInfos),elements:(0,o.o8)(this.elements),title:this.title,preserveFieldValuesWhenHidden:this.preserveFieldValuesWhenHidden})}async getFieldsUsed(e,t){const r=new Set,{description:n,elements:i,expressionInfos:s,title:o}=this;if(tt(r,e,n),tt(r,e,o),!i)return[];const a=function(e,t){if(!t||0===t.length)return[];const r=et(e),n=[];for(const e of t)r.has(e.name)&&n.push(e.expression);return n}(i,s).map((t=>(0,Qe.Dx)(r,e,t)));await Promise.all(a);for(const n of i)Xe(r,{fieldsIndex:e,relationships:t},n);return Array.from(r).sort()}};function Xe(e,t,r){const{fieldsIndex:n}=t;if(!n||n.fields.length!==e.size)switch(tt(e,n,r.label),tt(e,n,r.description),r.type){case"field":(0,Qe.rq)(e,n,r.fieldName);break;case"group":r.elements.forEach((r=>Xe(e,t,r)));break;case"relationship":if(t.relationships){const i=t.relationships.find((e=>e.id===r.relationshipId));i&&(0,Qe.rq)(e,n,i.keyField)}(0,Qe._w)(e,n,r.orderByFields?.map((e=>e.field)));break;case"text":tt(e,n,r.text)}}function et(e){const t=new Set;for(const r of e)if((0,a.kb)(t,r.visibilityExpression),!We(r))if(Je(r))(0,a.FB)(t,et(r.elements));else if((0,a.kb)(t,r.editableExpression),$e(r)){const{requiredExpression:e,valueExpression:n}=r;(0,a.FB)(t,[e,n])}return t}function tt(e,t,r){(0,Qe._w)(e,t,(0,Qe.nw)(r))}(0,i._)([(0,l.MZ)({type:String,json:{write:!0}})],Ye.prototype,"description",void 0),(0,i._)([(0,l.MZ)({json:{write:!0}})],Ye.prototype,"elements",void 0),(0,i._)([(0,u.w)("elements")],Ye.prototype,"castElements",null),(0,i._)([(0,c.w)("elements",["formElements"])],Ye.prototype,"readElements",null),(0,i._)([(0,d.K)("elements")],Ye.prototype,"writeElements",null),(0,i._)([(0,l.MZ)({type:[f],json:{write:!0}})],Ye.prototype,"expressionInfos",void 0),(0,i._)([(0,l.MZ)({type:Boolean,json:{default:!1,write:!0}})],Ye.prototype,"preserveFieldValuesWhenHidden",void 0),(0,i._)([(0,l.MZ)({type:String,json:{write:!0}})],Ye.prototype,"title",void 0),Ye=He=(0,i._)([(0,p.$)("esri.form.FormTemplate")],Ye);const rt=Ye},22902:function(e,t,r){r.d(t,{A:function(){return _}});var n,i=r(53804),s=r(50659),o=r(73037),a=r(30905),l=r(62938),u=r(89001),c=r(23502),p=(r(58941),r(40633),r(47332)),d=r(65953),h=r(81392);const f=(0,o.O)()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),y=f.jsonValues.slice();(0,s.Xy)(y,"orthometric");const m=(0,o.O)()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let g=n=class extends a.oY{constructor(e){super(e),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(e,t,r){return f.write(e,t,r)}readHeightModel(e,t,r){return f.read(e)||(r?.messages&&r.messages.push(function(e,t){return new u.A("height-model:unsupported",`Height model of value '${e}' is not supported`,t)}(e,{context:r})),null)}readHeightUnit(e,t,r){return m.read(e)||(r?.messages&&r.messages.push(w(e,{context:r})),null)}readHeightUnitService(e,t,r){return(0,l.LA)(e)||m.read(e)||(r?.messages&&r.messages.push(w(e,{context:r})),null)}readVertCRS(e,t){return t.vertCRS||t.ellipsoid||t.geoid}clone(){return new n({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(e){return!!e&&(this===e||this.heightModel===e.heightModel&&this.heightUnit===e.heightUnit&&this.vertCRS===e.vertCRS)}static deriveUnitFromSR(e,t){const r=(0,l.k1)(t);return new n({heightModel:e.heightModel,heightUnit:r??void 0,vertCRS:e.vertCRS})}write(e,t){return t={origin:"web-scene",...t},super.write(e,t)}static fromJSON(e){if(!e)return null;const t=new n;return t.read(e,{origin:"web-scene"}),t}};function w(e,t){return new u.A("height-unit:unsupported",`Height unit of value '${e}' is not supported`,t)}(0,i._)([(0,c.MZ)({type:f.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:y,default:"ellipsoidal"}}}})],g.prototype,"heightModel",void 0),(0,i._)([(0,h.K)("web-scene","heightModel")],g.prototype,"writeHeightModel",null),(0,i._)([(0,p.w)(["web-scene","service"],"heightModel")],g.prototype,"readHeightModel",null),(0,i._)([(0,c.MZ)({type:m.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:m.jsonValues,write:m.write}}}})],g.prototype,"heightUnit",void 0),(0,i._)([(0,p.w)("web-scene","heightUnit")],g.prototype,"readHeightUnit",null),(0,i._)([(0,p.w)("service","heightUnit")],g.prototype,"readHeightUnitService",null),(0,i._)([(0,c.MZ)({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],g.prototype,"vertCRS",void 0),(0,i._)([(0,p.w)("service","vertCRS",["vertCRS","ellipsoid","geoid"])],g.prototype,"readVertCRS",null),g=n=(0,i._)([(0,d.$)("esri.geometry.HeightModelInfo")],g);const _=g},75160:function(e,t,r){r.r(t),r.d(t,{buffer:function(){return k},changeDefaultSpatialReferenceTolerance:function(){return K},clearDefaultSpatialReferenceTolerance:function(){return Y},clip:function(){return f},contains:function(){return m},convexHull:function(){return T},crosses:function(){return g},cut:function(){return y},densify:function(){return q},difference:function(){return C},disjoint:function(){return I},distance:function(){return w},equals:function(){return _},extendedSpatialReferenceInfo:function(){return h},flipHorizontal:function(){return U},flipVertical:function(){return z},generalize:function(){return G},geodesicArea:function(){return W},geodesicBuffer:function(){return N},geodesicDensify:function(){return B},geodesicLength:function(){return H},intersect:function(){return L},intersectLinesToPoints:function(){return Q},intersects:function(){return v},isSimple:function(){return F},nearestCoordinate:function(){return D},nearestVertex:function(){return P},nearestVertices:function(){return Z},offset:function(){return R},overlaps:function(){return M},planarArea:function(){return $},planarLength:function(){return J},relate:function(){return x},rotate:function(){return V},simplify:function(){return A},symmetricDifference:function(){return E},touches:function(){return b},union:function(){return O},within:function(){return S}}),r(50917);var n=r(86027),i=r(45532),s=r(74697);function o(e){return Array.isArray(e)?e[0]?.spatialReference:e?.spatialReference}function a(e){return e?Array.isArray(e)?e.map(a):e.toJSON?e.toJSON():e:e}function l(e){return Array.isArray(e)?e.map((e=>(0,s.rS)(e))):(0,s.rS)(e)}let u;async function c(){return u||(u=(0,n.ho)("geometryEngineWorker",{strategy:"distributed"})),u}async function p(e,t){return(await c()).invoke("executeGEOperation",{operation:e,parameters:a(t)})}async function d(e,t){const r=await c();return Promise.all(r.broadcast("executeGEOperation",{operation:e,parameters:a(t)}))}function h(e){return p("extendedSpatialReferenceInfo",[e])}async function f(e,t){return l(await p("clip",[o(e),e,t]))}async function y(e,t){return l(await p("cut",[o(e),e,t]))}function m(e,t){return p("contains",[o(e),e,t])}function g(e,t){return p("crosses",[o(e),e,t])}function w(e,t,r){return p("distance",[o(e),e,t,r])}function _(e,t){return p("equals",[o(e),e,t])}function v(e,t){return p("intersects",[o(e),e,t])}function b(e,t){return p("touches",[o(e),e,t])}function S(e,t){return p("within",[o(e),e,t])}function I(e,t){return p("disjoint",[o(e),e,t])}function M(e,t){return p("overlaps",[o(e),e,t])}function x(e,t,r){return p("relate",[o(e),e,t,r])}function F(e){return p("isSimple",[o(e),e])}async function A(e){return l(await p("simplify",[o(e),e]))}async function T(e,t=!1){return l(await p("convexHull",[o(e),e,t]))}async function C(e,t){return l(await p("difference",[o(e),e,t]))}async function E(e,t){return l(await p("symmetricDifference",[o(e),e,t]))}async function L(e,t){return l(await p("intersect",[o(e),e,t]))}async function O(e,t=null){const r=function(e,t){let r;return Array.isArray(e)?r=e:(r=[],r.push(e),null!=t&&r.push(t)),r}(e,t);return l(await p("union",[o(r),r]))}async function R(e,t,r,n,i,s){return l(await p("offset",[o(e),e,t,r,n,i,s]))}async function k(e,t,r,n=!1){const i=[o(e),e,t,r,n];return l(await p("buffer",i))}async function N(e,t,r,n,i,s){const a=[o(e),e,t,r,n,i,s];return l(await p("geodesicBuffer",a))}async function D(e,t,r=!0){const n=await p("nearestCoordinate",[o(e),e,t,r]);return{...n,coordinate:i.default.fromJSON(n.coordinate)}}async function P(e,t){const r=await p("nearestVertex",[o(e),e,t]);return{...r,coordinate:i.default.fromJSON(r.coordinate)}}async function Z(e,t,r,n){return(await p("nearestVertices",[o(e),e,t,r,n])).map((e=>({...e,coordinate:i.default.fromJSON(e.coordinate)})))}function j(e){return"xmin"in e?e.center:"x"in e?e:e.extent?.center}async function V(e,t,r){if(null==e)throw new X;const n=e.spatialReference;if(null==(r=r??j(e)))throw new X;const i=e.constructor.fromJSON(await p("rotate",[n,e,t,r]));return i.spatialReference=n,i}async function U(e,t){if(null==e)throw new X;const r=e.spatialReference;if(null==(t=t??j(e)))throw new X;const n=e.constructor.fromJSON(await p("flipHorizontal",[r,e,t]));return n.spatialReference=r,n}async function z(e,t){if(null==e)throw new X;const r=e.spatialReference;if(null==(t=t??j(e)))throw new X;const n=e.constructor.fromJSON(await p("flipVertical",[r,e,t]));return n.spatialReference=r,n}async function G(e,t,r,n){return l(await p("generalize",[o(e),e,t,r,n]))}async function q(e,t,r){return l(await p("densify",[o(e),e,t,r]))}async function B(e,t,r,n=0){return l(await p("geodesicDensify",[o(e),e,t,r,n]))}function $(e,t){return p("planarArea",[o(e),e,t])}function J(e,t){return p("planarLength",[o(e),e,t])}function W(e,t,r){return p("geodesicArea",[o(e),e,t,r])}function H(e,t,r){return p("geodesicLength",[o(e),e,t,r])}async function Q(e,t){return l(await p("intersectLinesToPoints",[o(e),e,t]))}async function K(e,t){await d("changeDefaultSpatialReferenceTolerance",[e,t])}async function Y(e){await d("clearDefaultSpatialReferenceTolerance",[e])}class X extends Error{constructor(){super("Illegal Argument Exception")}}},87280:function(e,t,r){function n(e){return e?{originPosition:"upper-left"===e.originPosition?"upperLeft":"lower-left"===e.originPosition?"lowerLeft":e.originPosition,scale:e.tolerance?[e.tolerance,e.tolerance,1,1]:[1,1,1,1],translate:null!=e.extent?[e.extent.xmin,e.extent.ymax,e.extent.zmin??0,e.extent.mmin??0]:[0,0,0,0]}:null}function i(e){if(function(e){return"lowerLeft"===e.originPosition&&4===e.scale.length&&4===e.translate.length}(e))return e;const{originPosition:t,scale:r,translate:n}=e,i=r[0]??1,s=r[1]??1;return{originPosition:"lowerLeft",scale:[i,"lowerLeft"===t?s:-s,r[2]??1,r[3]??1],translate:[n[0]??0,n[1]??0,n[2]??0,n[3]??0]}}function s({scale:e,translate:t},r){return r*e[0]+t[0]}function o({scale:e,translate:t},r){return r*e[1]+t[1]}function a({scale:e,translate:t},r){return(r??0)*e[2]+t[2]}function l({scale:e,translate:t},r){return r?r*e[3]+t[3]:0}function u(e,t){return e&&t?h:e&&!t?p:!e&&t?d:c}r.d(t,{$X:function(){return w},Gy:function(){return y},P5:function(){return _},Q1:function(){return i},SW:function(){return m},Tr:function(){return g},VV:function(){return n}}),r(74697);const c=(e,t)=>{const r=new Array(t.length);if(!t.length)return r;const n=t[0];let i=s(e,n[0]),a=o(e,n[1]);r[0]=[i,a];const{scale:l,originPosition:u}=e,c=l[0],p="lowerLeft"===u?l[1]:-l[1];for(let e=1;e<t.length;e++){const[n,s]=t[e];i+=c*n,a+=p*s,r[e]=[i,a]}return r},p=(e,t)=>{const r=new Array(t.length);if(!t.length)return r;const n=t[0];let i=s(e,n[0]),l=o(e,n[1]);r[0]=[i,l,a(e,n[2])];const{scale:u,originPosition:c}=e,p=u[0],d="lowerLeft"===c?u[1]:-u[1];for(let n=1;n<t.length;n++){const[s,o,u]=t[n];i+=p*s,l+=d*o,r[n]=[i,l,a(e,u)]}return r},d=(e,t)=>{const r=new Array(t.length);if(!t.length)return r;const n=t[0];let i=s(e,n[0]),a=o(e,n[1]);r[0]=[i,a,l(e,n[2])];const{scale:u,originPosition:c}=e,p=u[0],d="lowerLeft"===c?u[1]:-u[1];for(let n=1;n<t.length;n++){const[s,o,u]=t[n];i+=p*s,a+=d*o,r[n]=[i,a,l(e,u)]}return r},h=(e,t)=>{const r=new Array(t.length);if(!t.length)return r;const n=t[0];let i=s(e,n[0]),u=o(e,n[1]);r[0]=[i,u,a(e,n[2]),l(e,n[3])];const{scale:c,originPosition:p}=e,d=c[0],h="lowerLeft"===p?c[1]:-c[1];for(let n=1;n<t.length;n++){const[s,o,c,p]=t[n];i+=d*s,u+=h*o,r[n]=[i,u,a(e,c),l(e,p)]}return r};function f(e,t,r){const n=new Array(r.length);for(let i=0;i<r.length;i++)n[i]=t(e,r[i]);return n}function y(e,t,r){const n=i(e);return t.x=function({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}(n,r.x),t.y=function({scale:e,translate:t},r){return Math.round((r-t[1])/e[1])}(n,r.y),null!=r.z&&(t.z=function({scale:e,translate:t},r){return Math.round(((r??0)-t[2])/e[2])}(n,r.z)),null!=r.m&&(t.m=function({scale:e,translate:t},r){return r?Math.round((r-t[3])/e[3]):0}(n,r.m)),t}function m(e,t,r,n=r?.hasZ??!1,s=r?.hasM??!1){if(null!=r){const o=i(e);t.points=u(n,s)(o,r.points),t.hasZ=n,t.hasM=s}return t}function g(e,t,r,n=null!=r?.z,u=null!=r?.m){if(null==r)return t;const c=i(e);return t.x=s(c,r.x),t.y=o(c,r.y),n&&(t.z=a(c,r.z)),u&&(t.m=l(c,r.m)),t}function w(e,t,r,n=r?.hasZ??!1,s=r?.hasM??!1){if(null!=r){const o=i(e);t.rings=f(o,u(n,s),r.rings),t.hasZ=n,t.hasM=s}return t}function _(e,t,r,n=r?.hasZ??!1,s=r?.hasM??!1){if(null!=r){const o=i(e);t.paths=f(o,u(n,s),r.paths),t.hasZ=n,t.hasM=s}return t}},57534:function(e,t,r){r.r(t),r.d(t,{default:function(){return ke}});var n=r(53804),i=r(90473),s=(r(74865),r(1526),r(96173),r(52308),r(78002),r(30047),r(27777),r(61065),r(6537)),o=r(31315),a=r(93040),l=r(10748),u=r(75743),c=r(78879),p=r(39819),d=r(21609),h=r(40633),f=r(77793),y=r(34194),m=r(60539),g=r(98737),w=r(90683),_=r(89001),v=r(23502),b=r(77560),S=r(47332),I=r(65953),M=r(81392),x=r(64786),F=r(79554),A=r(57165),T=r(20833),C=(r(50917),r(59469)),E=r(58941),L=r(31609),O=r(62560),R=r(86027),k=r(67888),N=(r(13798),r(55178)),D=r(87295),P=r(45406),Z=r(51084),j=r(91484),V=r(44740),U=r(63319);let z=0,G=class extends(L.A.LoadableMixin((0,O.g)(c.A))){constructor(e){super(e),this._idToClientGraphic=null,this.type="memory"}load(e){const t=null!=e?e.signal:null;return this.addResolvingPromise(this._startWorker(t)),Promise.resolve(this)}destroy(){this._connection?.close(),this._connection=null}get _workerGeometryType(){const e=this.layer?.geometryType;return e?this._geometryTypeRequiresClientGraphicMapping(e)?"polygon":e:null}applyEdits(e){return this.load().then((()=>this._applyEdits(e)))}openPorts(){return this.load().then((()=>this._connection.openPorts()))}async queryFeatures(e,t={}){await this.load(t);const r=await this._connection.invoke("queryFeatures",e?e.toJSON():null,t);(0,P.q)(e,this.layer.spatialReference,r);const n=Z.A.fromJSON(r);if(!this._requiresClientGraphicMapping())return n;const i=this.layer.objectIdField;for(const e of n.features){const t=e.attributes[i],r=this._idToClientGraphic.get(t);r&&(e.geometry=r.geometry)}return n.geometryType=this.layer.geometryType,n}async queryFeaturesJSON(e,t={}){if(this._requiresClientGraphicMapping())throw new p.A("query-features-json:unsupported","Cannot query in JSON format for client only geometry types (mesh and extent)");await this.load(t);const r=await this._connection.invoke("queryFeatures",e?e.toJSON():null,t);return(0,P.q)(e,this.layer.spatialReference,r),r}queryFeatureCount(e,t={}){return this.load(t).then((()=>this._connection.invoke("queryFeatureCount",e?e.toJSON():null,t)))}queryObjectIds(e,t={}){return this.load(t).then((()=>this._connection.invoke("queryObjectIds",e?e.toJSON():null,t)))}queryExtent(e,t={}){return this.load(t).then((()=>this._connection.invoke("queryExtent",e?e.toJSON():null,t))).then((e=>({count:e.count,extent:j.default.fromJSON(e.extent)})))}querySnapping(e,t={}){return this.load(t).then((()=>this._connection.invoke("querySnapping",e,t)))}async _applyEdits(e){if(!this._connection)throw new p.A("feature-layer-source:edit-failure","Memory source not loaded");const t=this.layer.objectIdField;let r=null;const n=[],i=[];await Promise.all([this._prepareClientMapping(e.addFeatures,null),this._prepareClientMapping(e.updateFeatures,null)]);const s=e=>"objectId"in e&&null!=e.objectId?e.objectId:"attributes"in e&&null!=e.attributes[t]?e.attributes[t]:null;if(e.addFeatures&&(r=this._prepareAddFeatures(e.addFeatures)),e.deleteFeatures)for(const t of e.deleteFeatures){const e=s(t);null!=e&&n.push(e)}const o=e.updateFeatures&&this._idToClientGraphic?new Map:null;if(e.updateFeatures)for(const t of e.updateFeatures)if(i.push(this._serializeFeature(t)),o){const e=s(t);null!=e&&o.set(e,t)}(0,D.u)(r?r.features:null,i,this.layer.spatialReference);const{fullExtent:a,featureEditResults:l}=await this._connection.invoke("applyEdits",{adds:r?r.features:[],updates:i,deletes:n});return this.fullExtent=a,r&&r.finish(l.uidToObjectId),this._updateClientGraphicIds(o,l),this._createEditsResult(l)}async _prepareClientMapping(e,t){if("mesh"!==this._layerOrSourceGeometryType||null==e)return;const r=[];for(const{geometry:n}of e)null==n||"mesh"!==n.type||n.hasExtent||n.loaded||r.push(n.load({signal:t}));r.length&&await Promise.all(r)}_updateClientGraphicIds(e,t){if(this._idToClientGraphic){if(e)for(const r of t.updateResults){if(!r.success)continue;const t=e.get(r.objectId);null!=t&&this._addIdToClientGraphic(t)}for(const e of t.deleteResults)e.success&&this._idToClientGraphic.delete(e.objectId)}}_createEditsResult(e){return{addFeatureResults:e.addResults?e.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:e.updateResults?e.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:e.deleteResults?e.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}_createFeatureEditResult(e){const t=!0===e.success?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:t?new p.A("feature-layer-source:edit-failure",t.description,{code:t.code}):null}}_prepareAddFeatures(e){const t=new Map,r=new Array(e.length);let n=null;for(let i=0;i<e.length;i++){const s=e[i],o=this._serializeFeature(s);n||null==s.geometry||(n=s.geometry.type),r[i]=o,t.set(`${o.uid}`,s)}const i=this;return{features:r,inferredGeometryType:n,finish(e){const r=i.sourceJSON.objectIdField;for(const n in e){const s=e[n],o=t.get(n);o&&(o.attributes||(o.attributes={}),-1===s?delete o.attributes[r]:o.attributes[r]=s,i._addIdToClientGraphic(o))}}}}_addIdToClientGraphic(e){if(!this._idToClientGraphic)return;const t=this.sourceJSON.objectIdField,r=e.attributes?.[t];null!=r&&this._idToClientGraphic.set(r,e)}get _layerOrSourceGeometryType(){return this.layer?.geometryType??this.sourceJSON?.geometryType}_requiresClientGraphicMapping(){return this._geometryTypeRequiresClientGraphicMapping(this._layerOrSourceGeometryType)}_geometryRequiresClientGraphicMapping(e){return this._geometryTypeRequiresClientGraphicMapping(e.type)}_geometryTypeRequiresClientGraphicMapping(e){return"mesh"===e||"multipatch"===e||"extent"===e}_serializeFeature(e){const{attributes:t}=e,r=this._geometryForSerialization(e),n=(z++).toString();return r?{uid:n,geometry:r.toJSON(),attributes:t}:{uid:n,attributes:t}}_geometryForSerialization(e){const{geometry:t}=e;return null==t?null:this._geometryRequiresClientGraphicMapping(t)?t.extent?V.A.fromExtent(t.extent):null:t}async _startWorker(e){this._connection=await(0,R.ho)("MemorySourceWorker",{strategy:(0,E.A)("feature-layers-workers")?"dedicated":"local",signal:e,registryTarget:this});const{fields:t,spatialReference:r,objectIdField:n,hasM:i,hasZ:s,timeInfo:o,dateFieldsTimeZone:a}=this.layer,l="defaults"===this.layer.originOf("spatialReference");await this._prepareClientMapping(this.items,e);const u=this._prepareAddFeatures(this.items);this.addHandles(this.on("before-changes",(e=>{h.A.getLogger(this).error("Source modifications will not propagate after layer has been loaded. Please use .applyEdits() instead"),e.preventDefault()})));const c={features:u.features,fields:t?.map((e=>e.toJSON())),geometryType:U.Y.toJSON(this._workerGeometryType),hasM:"mesh"!==this._layerOrSourceGeometryType&&i,hasZ:"mesh"===this._layerOrSourceGeometryType||s,objectIdField:n,spatialReference:l?null:r&&r.toJSON(),timeInfo:o?.toJSON()??null,dateFieldsTimeZone:a},p=await this._connection.invoke("load",c,{signal:e});for(const e of p.warnings)h.A.getLogger(this.layer).warn("#load()",`${e.message} (title: '${this.layer.title||"no title"}', id: '${this.layer.id??"no id"}')`,{warning:e});p.featureErrors.length&&h.A.getLogger(this.layer).warn("#load()",`Encountered ${p.featureErrors.length} validation errors while loading features. (title: '${this.layer.title||"no title"}', id: '${this.layer.id??"no id"}')`,{errors:p.featureErrors});const d=p.layerDefinition;this._geometryTypeRequiresClientGraphicMapping(u.inferredGeometryType)&&(d.geometryType=U.Y.toJSON(u.inferredGeometryType)),this.sourceJSON=d,this._requiresClientGraphicMapping()&&(this._idToClientGraphic=new Map),u.finish(p.assignedObjectIds)}};(0,n._)([(0,N.u)({Type:C.default,ensureType:(0,k.dp)(C.default)})],G.prototype,"itemType",void 0),(0,n._)([(0,v.MZ)()],G.prototype,"type",void 0),(0,n._)([(0,v.MZ)({constructOnly:!0})],G.prototype,"layer",void 0),(0,n._)([(0,v.MZ)({readOnly:!0})],G.prototype,"_workerGeometryType",null),(0,n._)([(0,v.MZ)()],G.prototype,"sourceJSON",void 0),G=(0,n._)([(0,I.$)("esri.layers.graphics.sources.MemorySource")],G);var q=r(30607),B=r(74927),$=r(1615),J=r(88243),W=r(9680),H=r(57767),Q=r(34032),K=r(19431),Y=r(92078),X=r(25353),ee=r(61380),te=r(83525);let re=class extends te.A{constructor(){super(...arguments),this.updating=!1,this.status="unknown"}};(0,n._)([(0,v.MZ)()],re.prototype,"updating",void 0),(0,n._)([(0,v.MZ)()],re.prototype,"status",void 0),re=(0,n._)([(0,I.$)("esri.layers.support.PublishingInfo")],re);const ne=re,ie=Symbol(),se=e=>{var t;let r=class extends e{constructor(){super(...arguments),this[t]=!0}get publishingInfo(){if(this.destroyed)return null;const e=this._get("publishingInfo");if(e)return e;const t=new ne;return this._checkPublishingStatus(t),t}_checkPublishingStatus(e){let t=0;const r=async i=>{let s;e.updating=!0;try{s=await this.fetchPublishingStatus()}catch(e){s="unavailable"}"published"!==s&&"unavailable"!==s||("publishing"===e.status&&this.refresh(),n.remove()),e.status=s,e.updating=!1,n.removed||(t=setTimeout(r,i,i+125))},n={removed:!1,remove(){this.removed=!0,clearTimeout(t)}};this.when().catch((()=>n.remove())),r(250),this.addHandles(n)}};return t=ie,(0,n._)([(0,v.MZ)({readOnly:!0,clonable:!1})],r.prototype,"publishingInfo",null),r=(0,n._)([(0,I.$)("esri.layers.mixins.PublishableLayer")],r),r};var oe=r(70652),ae=r(18195),le=r(85924),ue=r(93389),ce=r(7010),pe=r(23217),de=r(63648),he=r(49342),fe=r(36073),ye=r(53743),me=r(73520),ge=r(79212),we=r(85002),_e=r(36143),ve=r(61343),be=r(66866),Se=r(52374),Ie=r(7926),Me=r(18950),xe=r(28686),Fe=r(91448),Ae=r(59798);const Te="FeatureLayer";function Ce(e,t){return new p.A("layer:unsupported",`Layer (${e.title}, ${e.id}) of type '${e.declaredClass}' ${t}`,{layer:e})}function Ee(e){return e&&e instanceof c.A}const Le=(0,fe.p)();function Oe(e,t,r){const n=!!r?.writeLayerSchema;return{enabled:n,ignoreOrigin:n}}let Re=class extends((0,Q.j)((0,K.J)((0,H.F)(se((0,W.w6)((0,$.dM)((0,X.f)((0,le.e)((0,ae.j)((0,oe.J)((0,B.b)((0,Y.q)((0,ee.A)((0,f.P)((0,J.d)((0,q.p)((0,u.O)(T.A)))))))))))))))))){constructor(...e){super(...e),this.attributeTableTemplate=null,this.charts=null,this.copyright=null,this.displayField=null,this.dynamicDataSource=null,this.fields=null,this.fieldsIndex=null,this.formTemplate=null,this.fullExtent=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.infoFor3D=null,this.isTable=!1,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.objectIdField=null,this.outFields=null,this.path=null,this.popupEnabled=!0,this.popupTemplate=null,this.resourceInfo=null,this.screenSizePerspectiveEnabled=!0,this.spatialReference=A.A.WGS84,this.subtypeCode=null,this.supportedSourceTypes=new Set(["Feature Layer","Oriented Imagery Layer","Table","Catalog Layer"]),this.templates=null,this.timeInfo=null,this.title=null,this.sublayerTitleMode="item-title",this.type="feature",this.typeIdField=null,this.types=null,this.visible=!0,this._debouncedSaveOperations=(0,m.sg)((async(e,t,n)=>{const{save:i,saveAs:s}=await r.e(7835).then(r.bind(r,16240));switch(e){case Fe.X.SAVE:return i(this,t);case Fe.X.SAVE_AS:return s(this,n,t)}}))}destroy(){this.source?.destroy()}normalizeCtorArgs(e,t){return"string"==typeof e?{url:e,...t}:e}load(e){const t=null!=e?e.signal:null;if(this.portalItem?.loaded&&this.source)return this.addResolvingPromise(this.createGraphicsSource(t).then((e=>this.initLayerProperties(e)))),Promise.resolve(this);const r=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection","Scene Service"]},e).catch(m.QP).then((async()=>{if(this.url&&null==this.layerId&&/FeatureServer|MapServer\/*$/i.test(this.url)){const e=await this._fetchFirstValidLayerId(t);null!=e&&(this.layerId=e)}if(!this.url&&!this._hasMemorySource())throw new p.A("feature-layer:missing-url-or-source","Feature layer must be created with either a url or a source");return this.initLayerProperties(await this.createGraphicsSource(t))})).then((()=>(0,pe.VA)(this,"load",e)));return this.addResolvingPromise(r),Promise.resolve(this)}warnInvisibleDrapedSymbols(){"on-the-ground"===this.elevationInfo?.mode&&"simple"===this.renderer?.type&&"polygon-3d"===this.renderer.symbol?.type&&this.renderer.symbol.symbolLayers.some((e=>"fill"===e.type&&null!=e.material&&(!e.material.color||e.material.color.a*this.opacity<xe.Q)&&(this.loadWarnings.push(new _.A("feature-layer:invisible-draped-symbols","FeatureLayer has fully transparent symbols which will no longer render or highlight",{layer:this})),!0)))}readCapabilities(e,t){return t=t.layerDefinition||t,(0,we.S)(t,this.url)}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("dynamicDataSource"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("gdbVersion"),this.commitProperty("historicMoment"),this.commitProperty("returnZ"),this.commitProperty("capabilities"),this.commitProperty("returnM"),(this._get("createQueryVersion")??0)+1}get editingEnabled(){return!(this.loaded&&!this.capabilities?.operations.supportsEditing)&&(this._isOverridden("editingEnabled")?this._get("editingEnabled"):this._hasMemorySource()||this.userHasEditingPrivileges)}set editingEnabled(e){this._overrideIfSome("editingEnabled",e)}readEditingEnabled(e,t){return this._readEditingEnabled(t,!1)}readEditingEnabledFromWebMap(e,t,r){return this._readEditingEnabled(t,!0,r)}writeEditingEnabled(e,t){this._writeEditingEnabled(e,t,!1)}writeEditingEnabledToWebMap(e,t,r,n){this._writeEditingEnabled(e,t,!0,n)}get effectiveEditingEnabled(){return(0,pe.C$)(this)}readIsTable(e,t){return"Table"===(t=t?.layerDefinition??t).type||!t.geometryType}writeIsTable(e,t,r,n){n?.writeLayerSchema&&(0,y.sM)(r,e?"Table":"Feature Layer",t)}readGlobalIdField(e,t){return(0,pe.jD)(t.layerDefinition||t)}readObjectIdField(e,t){return(0,pe.Zm)(t.layerDefinition||t)}get parsedUrl(){const e=(0,w.An)(this.url);return null!=e&&(null!=this.dynamicDataSource?e.path=(0,w.fj)(e.path,"dynamicLayer"):null!=this.layerId&&(e.path=(0,w.fj)(e.path,this.layerId.toString()))),e}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(e){(0,ye.yp)(e,this.fieldsIndex),this._set("renderer",e)}readRenderer(e,t,r){t=t.layerDefinition||t;const n=t.drawingInfo?.renderer;if(n){const e=(0,s.L)(n,t,r)??void 0;return e||h.A.getLogger(this).error("Failed to create renderer",{rendererDefinition:t.drawingInfo.renderer,layer:this,context:r}),e}return(0,pe.PD)(t,r)}set source(e){const t=this._get("source");t!==e&&(Ee(t)&&this._resetMemorySource(t),Ee(e)&&this._initMemorySource(e),this._set("source",e))}castSource(e){return e?Array.isArray(e)||e instanceof c.A?new G({layer:this,items:e}):e:null}readSource(e,t){const r=Z.A.fromJSON(t.featureSet);return new G({layer:this,items:r?.features??[]})}readTemplates(e,t){const r=t.editFieldsInfo,n=r?.creatorField,i=r?.editorField;return e=e?.map((e=>de.A.fromJSON(e))),this._fixTemplates(e,n),this._fixTemplates(e,i),e}readTitle(e,t){const r=t.layerDefinition?.name??t.name,n=t.title||t.layerDefinition?.title;if(r){const e=this.portalItem?.title;if("item-title"===this.sublayerTitleMode)return this.url?(0,ue.yG)(this.url,r):r;let t=r;if(!t&&this.url){const e=(0,ue.qg)(this.url);null!=e&&(t=e.title)}if(!t)return;return"item-title-and-service-name"===this.sublayerTitleMode&&e&&e!==t&&(t=e+" - "+t),(0,ue.cr)(t)}if("item-title"===this.sublayerTitleMode&&n)return n}readTitleFromWebMap(e,t){return t.title||t.layerDefinition?.name}readTypeIdField(e,t){let r=(t=t.layerDefinition||t).typeIdField;if(r&&t.fields){r=r.toLowerCase();const e=t.fields.find((e=>e.name.toLowerCase()===r));e&&(r=e.name)}return r}readTypes(e,t){e=(t=t.layerDefinition||t).types;const r=t.editFieldsInfo,n=r?.creatorField,i=r?.editorField;return e?.map((e=>(e=he.A.fromJSON(e),this._fixTemplates(e.templates,n),this._fixTemplates(e.templates,i),e)))}readVisible(e,t){return null!=t.layerDefinition?.defaultVisibility?!!t.layerDefinition.defaultVisibility:null!=t.visibility?!!t.visibility:void 0}async addAttachment(e,t){const r=await(0,pe.Xl)(this,e,t,Te);return this.lastEditsEventDate=new Date,r}async updateAttachment(e,t,r){const n=await(0,pe.bt)(this,e,t,r,Te);return this.lastEditsEventDate=new Date,n}async applyEdits(e,t){return(0,pe.ct)(this,e,t)}async uploadAssets(e,t){return(0,pe.rn)(this,e,t)}on(e,t){return super.on(e,t)}createPopupTemplate(e){return(0,Me.tn)(this,e)}async createGraphicsSource(e){if(this._hasMemorySource()&&this.source)return this.source.load({signal:e});const{default:t}=await(0,m.qr)(r.e(9732).then(r.bind(r,72978)),e);return new t({layer:this,supportedSourceTypes:this.supportedSourceTypes}).load({signal:e})}createQuery(){const e=(0,pe.VZ)(this);e.dynamicDataSource=this.dynamicDataSource;const t=null!=this.subtypeCode?`${this.subtypeField} = ${this.subtypeCode}`:null,r=(0,g.m)(this.definitionExpression,t);return e.where=r||"1=1",e}async deleteAttachments(e,t){const r=await(0,pe.mm)(this,e,t,Te);return this.lastEditsEventDate=new Date,r}async fetchRecomputedExtents(e){return(0,pe.WP)(this,e,Te)}getFeatureType(e){return(0,pe.xd)(this.types,this.typeIdField,e)}getFieldDomain(e,t){const r=t?.feature,n=!!this.subtypes?.length;if(n&&!t?.excludeImpliedDomains){const t=(0,pe.pc)(this,e);if(t)return t}const i=n&&(0,pe.Nv)(this,r);if(i){const t=i?.domains?.[e];return"inherited"===t?.type?this._getLayerDomain(e):t}const s=this.getFeatureType(r),o=this._getLayerDomain(e);if(s){const t=s.domains&&s.domains[e];if(t&&"inherited"!==t?.type)return t;if(o)return o}if(!t?.excludeImpliedDomains){const t=(0,pe.hx)(this,e);if(t)return t}return o}getField(e){return this.fieldsIndex.get(e)}async queryAttachments(e,t){return(0,pe.lV)(this,e,t,Te)}async queryFeatures(e,t){const r=await this.load(),n=await r.source.queryFeatures(Ie.A.from(e)??r.createQuery(),t);if(n?.features)for(const e of n.features)e.layer=e.sourceLayer=r;return n}async queryObjectIds(e,t){return(0,pe.sg)(this,e,t,Te)}async queryFeatureCount(e,t){return(0,pe.Ye)(this,e,t,Te)}async queryExtent(e,t){return(0,pe.B5)(this,e,t,Te)}async queryRelatedFeatures(e,t){return(0,pe.hM)(this,e,t,Te)}async queryRelatedFeaturesCount(e,t){return(0,pe.S2)(this,e,t,Te)}async queryTopFeatures(e,t){const{source:n,capabilities:i}=await this.load();if(!n.queryTopFeatures||!i?.query?.supportsTopFeaturesQuery)throw new p.A(Te,"Layer source does not support queryTopFeatures capability");const s=await r.e(8656).then(r.bind(r,5180)),o=await n.queryTopFeatures(s.default.from(e),t);if(o?.features)for(const e of o.features)e.layer=e.sourceLayer=this;return o}async queryBins(e,t){const{source:n,capabilities:i}=await this.load();if(!n.queryBins||!i?.operations?.supportsQueryBins)throw new p.A(Te,"Layer source does not support queryBins capability");(0,pe.ZJ)(e,i,Te);const s=await r.e(9942).then(r.bind(r,19499)),o=await n.queryBins(s.default.from(e),t);if(o.features)for(const e of o.features)e.layer=e.sourceLayer=this;return o}async queryTopObjectIds(e,t){const{source:n,capabilities:i}=await this.load();if(!n.queryTopObjectIds||!i?.query.supportsTopFeaturesQuery)throw new p.A(Te,"Layer source does not support queryTopObjectIds capability");const s=await r.e(8656).then(r.bind(r,5180));return n.queryTopObjectIds(s.default.from(e),t)}async queryTopFeaturesExtent(e,t){const{source:n,capabilities:i}=await this.load();if(!n.queryTopExtents||!i?.query?.supportsTopFeaturesQuery)throw new p.A(Te,"Layer source does not support queryTopExtents capability");const s=await r.e(8656).then(r.bind(r,5180));return n.queryTopExtents(s.default.from(e),t)}async queryTopFeatureCount(e,t){const{source:n,capabilities:i}=await this.load();if(!n.queryTopCount||!i?.query?.supportsTopFeaturesQuery)throw new p.A(Te,"Layer source does not support queryFeatureCount capability");const s=await r.e(8656).then(r.bind(r,5180));return n.queryTopCount(s.default.from(e),t)}read(e,t){const r=e.featureCollection;if((r||"Feature Collection"===e.type)&&(this.resourceInfo=e),r){const e=r.layers;e&&1===e.length&&(super.read(e[0],t),null!=r.showLegend&&super.read({showLegend:r.showLegend},t))}super.read(e,t),t&&"service"===t.origin&&(this.revert(["objectIdField","fields","timeInfo","dateFieldsTimeZone"],"service"),this.spatialReference||this.revert(["spatialReference"],"service"))}write(e,t){t={...t,origin:t?.origin??void 0,writeLayerSchema:t?.writeLayerSchema??this._hasMemorySource()};const{origin:r,layerContainerType:n,messages:i}=t;if(this.dynamicDataSource)return i?.push(Ce(this,"using a dynamic data source cannot be written to web scenes, web maps and feature service items")),null;if(this.isTable){if(("web-map"===r||"web-scene"===r)&&"tables"!==n)return i?.push(Ce(this,`a table source can only be written to tables, not ${n}`)),null;if(this._hasMemorySource())return i?.push(Ce(this,"using an in-memory table source cannot be written to web scenes and web maps")),null}else if(this.loaded&&("web-map"===r||"web-scene"===r)&&"tables"===n)return i?.push(Ce(this,"using a non-table source cannot be written to tables in web maps or web scenes")),null;return super.write(e,t)}clone(){if(this._hasMemorySource())throw new p.A(Te,`FeatureLayer (title: ${this.title}, id: ${this.id}) created using in-memory source cannot be cloned`);return super.clone()}serviceSupportsSpatialReference(e){return!!this.loaded&&("memory"===this.source?.type||(0,ve.D)(this,e))}async save(e){return this._debouncedSaveOperations(Fe.X.SAVE,e)}async saveAs(e,t){return this._debouncedSaveOperations(Fe.X.SAVE_AS,t,e)}_readEditingEnabled(e,t,r){let n=e.layerDefinition?.capabilities;return n?this._hasEditingCapability(n):(n=e.capabilities,t&&"web-map"===r?.origin&&!this._hasMemorySource()&&n?this._hasEditingCapability(n):void 0)}_hasEditingCapability(e){return e.toLowerCase().split(",").map((e=>e.trim())).includes("editing")}_writeEditingEnabled(e,t,r,n){if(!e){const e=this.capabilities?.operations?.supportsSync?"Query,Sync":"Query";(0,y.sM)("layerDefinition.capabilities",e,t),r&&!n?.writeLayerSchema&&(t.capabilities=e)}}_getLayerDomain(e){const t=this.fieldsIndex.get(e);return t?t.domain:null}_fetchFirstValidLayerId(e){return(0,a.A)(this.url??"",{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:e}).then((e=>{const t=e.data;if(t)return this.findFirstValidLayerId(t)}))}async initLayerProperties(e){return this._set("source",e),e.sourceJSON&&(this.sourceJSON=e.sourceJSON,this.read(e.sourceJSON,{origin:"service",portalItem:this.portalItem,portal:this.portalItem?.portal,url:this.parsedUrl})),this._verifySource(),this._verifyFields(),(0,ye.yp)(this.renderer,this.fieldsIndex),(0,ye.sv)(this.timeInfo,this.fieldsIndex),(0,Se.L)(this,{origin:"service"})}async hasDataChanged(){return(0,pe.jp)(this)}async fetchPublishingStatus(){const e=this.source;return e?.fetchPublishingStatus?e.fetchPublishingStatus():"unavailable"}_verifyFields(){const e=this.parsedUrl?.path??"undefined";this.objectIdField||console.log("FeatureLayer: 'objectIdField' property is not defined (url: "+e+")"),this.isTable||this._hasMemorySource()||-1!==e.search(/\/FeatureServer\//i)||this.fields?.some((e=>"geometry"===e.type))||console.log("FeatureLayer: unable to find field of type 'geometry' in the layer 'fields' list. If you are using a map service layer, features will not have geometry (url: "+e+")")}_fixTemplates(e,t){e&&e.forEach((e=>{const r=e.prototype?.attributes;r&&t&&delete r[t]}))}_verifySource(){if(this._hasMemorySource()){if(this.url)throw new p.A("feature-layer:mixed-source-and-url","FeatureLayer cannot be created with both an in-memory source and a url")}else if(!this.url)throw new p.A("feature-layer:source-or-url-required","FeatureLayer requires either a url, a valid portal item or a source")}_initMemorySource(e){e.forEach((e=>{e.layer=this,e.sourceLayer=this})),this.addHandles([e.on("after-add",(e=>{e.item.layer=this,e.item.sourceLayer=this})),e.on("after-remove",(e=>{e.item.layer=null,e.item.sourceLayer=null}))],"fl-source")}_resetMemorySource(e){e.forEach((e=>{e.layer=null,e.sourceLayer=null})),this.removeHandles("fl-source")}_hasMemorySource(){return!(this.url||!this.source)}findFirstValidLayerId(e){return Array.isArray(e.layers)&&e.layers.length>0?e.layers[0].id:Array.isArray(e.tables)&&e.tables.length>0?e.tables[0].id:void 0}};(0,n._)([(0,v.MZ)(ce.zQ)],Re.prototype,"attributeTableTemplate",void 0),(0,n._)([(0,S.w)("service","capabilities")],Re.prototype,"readCapabilities",null),(0,n._)([(0,v.MZ)({json:{origins:{"web-scene":{write:!1}},write:!0}})],Re.prototype,"charts",void 0),(0,n._)([(0,v.MZ)({readOnly:!0})],Re.prototype,"createQueryVersion",null),(0,n._)([(0,v.MZ)({json:{read:{source:"layerDefinition.copyrightText"}}})],Re.prototype,"copyright",void 0),(0,n._)([(0,v.MZ)({json:{read:{source:"layerDefinition.displayField"}}})],Re.prototype,"displayField",void 0),(0,n._)([(0,v.MZ)({types:l.Es,readOnly:!0})],Re.prototype,"defaultSymbol",void 0),(0,n._)([(0,v.MZ)({type:be.L})],Re.prototype,"dynamicDataSource",void 0),(0,n._)([(0,v.MZ)({type:Boolean})],Re.prototype,"editingEnabled",null),(0,n._)([(0,S.w)(["portal-item","web-scene"],"editingEnabled",["layerDefinition.capabilities"])],Re.prototype,"readEditingEnabled",null),(0,n._)([(0,S.w)("web-map","editingEnabled",["capabilities","layerDefinition.capabilities"])],Re.prototype,"readEditingEnabledFromWebMap",null),(0,n._)([(0,M.K)(["portal-item","web-scene"],"editingEnabled",{"layerDefinition.capabilities":{type:String}})],Re.prototype,"writeEditingEnabled",null),(0,n._)([(0,M.K)("web-map","editingEnabled",{capabilities:{type:String},"layerDefinition.capabilities":{type:String}})],Re.prototype,"writeEditingEnabledToWebMap",null),(0,n._)([(0,v.MZ)({readOnly:!0})],Re.prototype,"effectiveEditingEnabled",null),(0,n._)([(0,v.MZ)({...Le.fields,json:{read:{source:"layerDefinition.fields"},origins:{service:{name:"fields"},"web-map":{write:{target:"layerDefinition.fields",overridePolicy:Oe}}}}})],Re.prototype,"fields",void 0),(0,n._)([(0,v.MZ)(Le.fieldsIndex)],Re.prototype,"fieldsIndex",void 0),(0,n._)([(0,v.MZ)({type:F.A,json:{name:"formInfo",write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],Re.prototype,"formTemplate",void 0),(0,n._)([(0,v.MZ)({json:{read:{source:"layerDefinition.extent"}}})],Re.prototype,"fullExtent",void 0),(0,n._)([(0,v.MZ)({json:{origins:{"web-map":{write:{target:"layerDefinition.geometryType",overridePolicy:Oe,writer(e,t,r){const n=e?pe.iX.toJSON(e):null;n&&(0,y.sM)(r,n,t)}}}},read:{source:"layerDefinition.geometryType",reader:pe.iX.read}}})],Re.prototype,"geometryType",void 0),(0,n._)([(0,v.MZ)({json:{read:{source:"layerDefinition.hasM"}}})],Re.prototype,"hasM",void 0),(0,n._)([(0,v.MZ)({json:{read:{source:"layerDefinition.hasZ"}}})],Re.prototype,"hasZ",void 0),(0,n._)([(0,v.MZ)(ce.id)],Re.prototype,"id",void 0),(0,n._)([(0,v.MZ)({readOnly:!0,json:{origins:{service:{read:!0}},read:!1}})],Re.prototype,"infoFor3D",void 0),(0,n._)([(0,v.MZ)({json:{origins:{"web-map":{write:{target:"layerDefinition.type"}}}}})],Re.prototype,"isTable",void 0),(0,n._)([(0,S.w)("service","isTable",["type","geometryType"]),(0,S.w)("isTable",["layerDefinition.type","layerDefinition.geometryType"])],Re.prototype,"readIsTable",null),(0,n._)([(0,M.K)("web-map","isTable")],Re.prototype,"writeIsTable",null),(0,n._)([(0,v.MZ)(ce.kF)],Re.prototype,"labelsVisible",void 0),(0,n._)([(0,v.MZ)({type:[me.A],json:{origins:{service:{name:"drawingInfo.labelingInfo",read:ge.w,write:!1},"web-scene":{name:"layerDefinition.drawingInfo.labelingInfo",read:ge.w,write:{enabled:!0,layerContainerTypes:x.K}}},name:"layerDefinition.drawingInfo.labelingInfo",read:ge.w,write:!0}})],Re.prototype,"labelingInfo",void 0),(0,n._)([(0,v.MZ)((()=>{const e=(0,d.o8)(ce.Ih);return e.json.origins["portal-item"]={write:{target:"layerDefinition.drawingInfo.transparency",writer(e,t,r){(0,y.sM)(r,(0,Ae.p)(e),t)}}},e})())],Re.prototype,"opacity",void 0),(0,n._)([(0,v.MZ)(ce.fV)],Re.prototype,"legendEnabled",void 0),(0,n._)([(0,v.MZ)({type:["show","hide"],json:(()=>{const e=(0,d.o8)(ce.C1.json);return e.origins["portal-item"]={read:!1,write:!1},e})()})],Re.prototype,"listMode",void 0),(0,n._)([(0,S.w)("globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],Re.prototype,"readGlobalIdField",null),(0,n._)([(0,v.MZ)({json:{origins:{"web-map":{write:{target:"layerDefinition.objectIdField",overridePolicy:Oe}}}}})],Re.prototype,"objectIdField",void 0),(0,n._)([(0,S.w)("objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],Re.prototype,"readObjectIdField",null),(0,n._)([(0,v.MZ)({value:"ArcGISFeatureLayer",type:["ArcGISFeatureLayer"]})],Re.prototype,"operationalLayerType",void 0),(0,n._)([(0,v.MZ)(Le.outFields)],Re.prototype,"outFields",void 0),(0,n._)([(0,v.MZ)({readOnly:!0})],Re.prototype,"parsedUrl",null),(0,n._)([(0,v.MZ)({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],Re.prototype,"path",void 0),(0,n._)([(0,v.MZ)(ce.M6)],Re.prototype,"popupEnabled",void 0),(0,n._)([(0,v.MZ)({type:i.A,json:{name:"popupInfo",write:!0}})],Re.prototype,"popupTemplate",void 0),(0,n._)([(0,v.MZ)({readOnly:!0})],Re.prototype,"defaultPopupTemplate",null),(0,n._)([(0,v.MZ)({types:o.H,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{types:o.X,name:"layerDefinition.drawingInfo.renderer",write:{layerContainerTypes:x.K,overridePolicy:(e,t,r)=>({ignoreOrigin:r?.writeLayerSchema})}}},write:{target:"layerDefinition.drawingInfo.renderer",overridePolicy:(e,t,r)=>({ignoreOrigin:r?.writeLayerSchema})}}})],Re.prototype,"renderer",null),(0,n._)([(0,S.w)("service","renderer",["drawingInfo.renderer","defaultSymbol"]),(0,S.w)("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],Re.prototype,"readRenderer",null),(0,n._)([(0,v.MZ)()],Re.prototype,"resourceInfo",void 0),(0,n._)([(0,v.MZ)((()=>{const e=(0,d.o8)(ce.PY);return e.json.origins["portal-item"]={read:!1,write:!1},e})())],Re.prototype,"screenSizePerspectiveEnabled",void 0),(0,n._)([(0,v.MZ)({clonable:!1})],Re.prototype,"source",null),(0,n._)([(0,b.w)("source")],Re.prototype,"castSource",null),(0,n._)([(0,S.w)("portal-item","source",["featureSet"]),(0,S.w)("web-map","source",["featureSet"])],Re.prototype,"readSource",null),(0,n._)([(0,v.MZ)({json:{read:{source:"layerDefinition.extent.spatialReference"}}})],Re.prototype,"spatialReference",void 0),(0,n._)([(0,v.MZ)({type:Number})],Re.prototype,"subtypeCode",void 0),(0,n._)([(0,v.MZ)({type:[de.A]})],Re.prototype,"templates",void 0),(0,n._)([(0,S.w)("templates",["editFieldsInfo","creatorField","editorField","templates"])],Re.prototype,"readTemplates",null),(0,n._)([(0,v.MZ)({type:_e.A})],Re.prototype,"timeInfo",void 0),(0,n._)([(0,v.MZ)()],Re.prototype,"title",void 0),(0,n._)([(0,S.w)("service","title",["name"]),(0,S.w)("portal-item","title",["layerDefinition.title","layerDefinition.name","title"])],Re.prototype,"readTitle",null),(0,n._)([(0,S.w)("web-map","title",["layerDefinition.name","title"])],Re.prototype,"readTitleFromWebMap",null),(0,n._)([(0,v.MZ)({type:String})],Re.prototype,"sublayerTitleMode",void 0),(0,n._)([(0,v.MZ)({json:{read:!1}})],Re.prototype,"type",void 0),(0,n._)([(0,v.MZ)({type:String})],Re.prototype,"typeIdField",void 0),(0,n._)([(0,S.w)("service","typeIdField"),(0,S.w)("typeIdField",["layerDefinition.typeIdField"])],Re.prototype,"readTypeIdField",null),(0,n._)([(0,v.MZ)({type:[he.A]})],Re.prototype,"types",void 0),(0,n._)([(0,S.w)("service","types",["types"]),(0,S.w)("types",["layerDefinition.types"])],Re.prototype,"readTypes",null),(0,n._)([(0,v.MZ)({type:Boolean,json:{origins:{"portal-item":{write:{target:"layerDefinition.defaultVisibility"}}}}})],Re.prototype,"visible",void 0),(0,n._)([(0,S.w)("portal-item","visible",["visibility","layerDefinition.defaultVisibility"])],Re.prototype,"readVisible",null),Re=(0,n._)([(0,I.$)("esri.layers.FeatureLayer")],Re);const ke=Re},30607:function(e,t,r){r.d(t,{p:function(){return o}});var n=r(53804),i=r(23502),s=(r(58941),r(40633),r(13798),r(65953));const o=e=>{let t=class extends e{get apiKey(){return this._isOverridden("apiKey")?this._get("apiKey"):"portalItem"in this?this.portalItem?.apiKey:null}set apiKey(e){null!=e?this._override("apiKey",e):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}};return(0,n._)([(0,i.MZ)({type:String})],t.prototype,"apiKey",null),t=(0,n._)([(0,s.$)("esri.layers.mixins.APIKeyMixin")],t),t}},74927:function(e,t,r){r.d(t,{b:function(){return l}});var n=r(53804),i=r(40633),s=r(23502),o=(r(58941),r(13798),r(65953)),a=r(93389);const l=e=>{let t=class extends e{get title(){if(this._get("title")&&"defaults"!==this.originOf("title"))return this._get("title");if(this.url){const e=(0,a.qg)(this.url);if(null!=e&&e.title)return e.title}return this._get("title")||""}set title(e){this._set("title",e)}set url(e){this._set("url",(0,a.Jf)(e,i.A.getLogger(this)))}};return(0,n._)([(0,s.MZ)()],t.prototype,"title",null),(0,n._)([(0,s.MZ)({type:String})],t.prototype,"url",null),t=(0,n._)([(0,o.$)("esri.layers.mixins.ArcGISService")],t),t}},88243:function(e,t,r){r.d(t,{d:function(){return o}});var n=r(53804),i=r(23502),s=(r(58941),r(40633),r(13798),r(65953));const o=e=>{let t=class extends e{constructor(){super(...arguments),this.customParameters=null}};return(0,n._)([(0,i.MZ)({type:Object,json:{write:{overridePolicy:e=>({enabled:!!(e&&Object.keys(e).length>0)})}}})],t.prototype,"customParameters",void 0),t=(0,n._)([(0,s.$)("esri.layers.mixins.CustomParametersMixin")],t),t}},9680:function(e,t,r){r.d(t,{Mk:function(){return h},Zk:function(){return p},w6:function(){return m}});var n=r(53804),i=r(48996),s=r(21609),o=r(60539),a=r(23502),l=(r(58941),r(40633),r(65953)),u=r(30193);const c=new i.A.EventEmitter;function p(e,t,r=null,n=!1){const i=(0,o.Tw)();return n=null==t||n,c.emit("apply-edits",{serviceUrl:e,layerId:t,gdbVersion:r,mayReceiveServiceEdits:n,result:i.promise}),i}const d=Symbol();function h(e){return null!=e&&"object"==typeof e&&d in e}function f(e){return null!=e&&"object"==typeof e&&"gdbVersion"in e}function y(e,t,r){const n=new URL(e).host,i=u.Z3.get(n),s=e=>!e||e===i;return s(t)&&s(r)||t===r}const m=e=>{var t;let r=class extends e{constructor(...e){super(...e),this[t]=!0,this._applyEditsHandler=e=>{const{serviceUrl:t,layerId:r,gdbVersion:n,mayReceiveServiceEdits:i,result:o}=e,a=t===this.url,l=null!=r&&null!=this.layerId&&r===this.layerId,u=f(this),c=f(this)&&y(t,n,this.gdbVersion);if(!a||u&&!c||!l&&!i)return;const p=o.then((e=>{if(this.lastEditsEventDate=new Date,l&&(e.addedFeatures.length||e.updatedFeatures.length||e.deletedFeatures.length||e.addedAttachments.length||e.updatedAttachments.length||e.deletedAttachments.length))return this.emit("edits",(0,s.o8)(e)),e;const r=e.editedFeatures?.find((({layerId:e})=>e===this.layerId));if(r){const{adds:t,updates:n,deletes:i}=r.editedFeatures,o={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:t?t.map((({attributes:e})=>({objectId:this.objectIdField&&e[this.objectIdField],globalId:this.globalIdField&&e[this.globalIdField]}))):[],deletedFeatures:i?i.map((({attributes:e})=>({objectId:this.objectIdField&&e[this.objectIdField],globalId:this.globalIdField&&e[this.globalIdField]}))):[],updatedFeatures:n?n.map((({current:{attributes:e}})=>({objectId:this.objectIdField&&e[this.objectIdField],globalId:this.globalIdField&&e[this.globalIdField]}))):[],editedFeatures:(0,s.o8)(e.editedFeatures),exceededTransferLimit:!1,historicMoment:(0,s.o8)(e.historicMoment)};return this.emit("edits",o),o}const i={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:[],deletedFeatures:[],updatedFeatures:[],editedFeatures:(0,s.o8)(e.editedFeatures),exceededTransferLimit:!1,historicMoment:(0,s.o8)(e.historicMoment)};return"historicMoment"in this&&this._shouldUpdateHistoricMoment(t,n,i.historicMoment)&&this.emit("edits",i),i})).then((e=>("historicMoment"in this&&this._shouldUpdateHistoricMoment(t,n,e.historicMoment)&&(this.historicMoment=e.historicMoment),e)));this.emit("apply-edits",{result:p})},this._updateMomentHandler=e=>{const{serviceUrl:t,gdbVersion:r,moment:n}=e,i=t===this.url,s=f(this),o=f(this)&&y(t,r,this.gdbVersion),a=f(this)&&!y(t,this.gdbVersion,null);i&&s&&o&&a&&"historicMoment"in this&&this.historicMoment!==n&&(this.historicMoment=n)},this.when().then((()=>{this.addHandles(function(e){return c.on("apply-edits",new WeakRef(e))}(this._applyEditsHandler)),"historicMoment"in this&&this.addHandles(function(e){return c.on("update-moment",new WeakRef(e))}(this._updateMomentHandler))}),(()=>{}))}_shouldUpdateHistoricMoment(e,t,r){return"historicMoment"in this&&this.historicMoment!==r&&(0,u.w5)(e,t)}};return t=d,(0,n._)([(0,a.MZ)()],r.prototype,"lastEditsEventDate",void 0),r=(0,n._)([(0,l.$)("esri.layers.mixins.EditBusLayer")],r),r}},57767:function(e,t,r){r.d(t,{F:function(){return l},Y:function(){return a}});var n=r(53804),i=r(23502),s=(r(58941),r(40633),r(13798),r(65953));const o={write:{allowNull:!0}},a={type:r(71843).A,json:{origins:{"web-map":o,"portal-item":o}}},l=e=>{let t=class extends e{constructor(){super(...arguments),this.featureEffect=null}};return(0,n._)([(0,i.MZ)(a)],t.prototype,"featureEffect",void 0),t=(0,n._)([(0,s.$)("esri.layers.mixins.FeatureEffectLayer")],t),t}},34032:function(e,t,r){r.d(t,{j:function(){return R}});var n=r(53804),i=r(78879),s=r(21609),o=r(40633),a=r(23502),l=(r(58941),r(47332)),u=r(65953),c=r(81392),p=r(64786),d=r(91484),h=r(22902),f=r(57165),y=r(93389),m=r(7010),g=r(75743),w=r(30905),_=(r(13798),r(21168));let v=class extends((0,g.O)(w.oY)){constructor(e){super(e),this.creatorField=null,this.creationDateField=null,this.editorField=null,this.editDateField=null,this.realm=null,this.timeZone=null}};(0,n._)([(0,a.MZ)()],v.prototype,"creatorField",void 0),(0,n._)([(0,a.MZ)()],v.prototype,"creationDateField",void 0),(0,n._)([(0,a.MZ)()],v.prototype,"editorField",void 0),(0,n._)([(0,a.MZ)()],v.prototype,"editDateField",void 0),(0,n._)([(0,a.MZ)()],v.prototype,"realm",void 0),(0,n._)([(0,a.MZ)((0,_.P6)("dateFieldsTimeReference",!0))],v.prototype,"timeZone",void 0),v=(0,n._)([(0,u.$)("esri.layers.support.EditFieldsInfo")],v);const b=v;let S=class extends((0,g.O)(w.oY)){constructor(e){super(e)}};(0,n._)([(0,a.MZ)({constructOnly:!0,json:{write:!0}})],S.prototype,"name",void 0),(0,n._)([(0,a.MZ)({constructOnly:!0,json:{write:!0}})],S.prototype,"fields",void 0),(0,n._)([(0,a.MZ)({constructOnly:!0,json:{write:!0}})],S.prototype,"isAscending",void 0),(0,n._)([(0,a.MZ)({constructOnly:!0,json:{write:!0}})],S.prototype,"indexType",void 0),(0,n._)([(0,a.MZ)({constructOnly:!0,json:{write:!0}})],S.prototype,"isUnique",void 0),(0,n._)([(0,a.MZ)({constructOnly:!0,json:{write:!0}})],S.prototype,"description",void 0),S=(0,n._)([(0,u.$)("esri.layers.support.FeatureIndex")],S);var I=r(23217),M=r(62938);let x=class extends((0,g.O)(w.oY)){constructor(e){super(e),this.shapeAreaField=null,this.shapeLengthField=null,this.units=null}};(0,n._)([(0,a.MZ)({type:String,json:{read:{source:"shapeAreaFieldName"}}})],x.prototype,"shapeAreaField",void 0),(0,n._)([(0,a.MZ)({type:String,json:{read:{source:"shapeLengthFieldName"}}})],x.prototype,"shapeLengthField",void 0),(0,n._)([(0,a.MZ)({type:String,json:{read:e=>M.dk.read(e)||M.Sk.read(e)}})],x.prototype,"units",void 0),x=(0,n._)([(0,u.$)("esri.layers.support.GeometryFieldsInfo")],x);const F=x;var A=r(75803),T=r(90864),C=r(85002),E=r(97424);let L=class extends((0,g.O)(w.oY)){constructor(e){super(e),this.code=null,this.defaultValues={},this.domains=null,this.name=null}readDomains(e){if(!e)return null;const t={};for(const r of Object.keys(e))t[r]=(0,E.rS)(e[r]);return t}writeDomains(e,t){if(!e)return;const r={};for(const t of Object.keys(e))e[t]&&(r[t]=e[t]?.toJSON());t.domains=r}};(0,n._)([(0,a.MZ)({type:Number,json:{write:!0}})],L.prototype,"code",void 0),(0,n._)([(0,a.MZ)({type:Object,json:{write:!0}})],L.prototype,"defaultValues",void 0),(0,n._)([(0,a.MZ)({json:{write:!0}})],L.prototype,"domains",void 0),(0,n._)([(0,l.w)("domains")],L.prototype,"readDomains",null),(0,n._)([(0,c.K)("domains")],L.prototype,"writeDomains",null),(0,n._)([(0,a.MZ)({type:String,json:{write:!0}})],L.prototype,"name",void 0),L=(0,n._)([(0,u.$)("esri.layers.support.Subtype")],L);const O=L,R=e=>{let t=class extends e{constructor(){super(...arguments),this.copyright=null,this.capabilities=null,this.dateFieldsTimeZone=null,this.datesInUnknownTimezone=!1,this.definitionExpression=null,this.displayField=null,this.editFieldsInfo=null,this.editingInfo=null,this.elevationInfo=null,this.floorInfo=null,this.fullExtent=null,this.gdbVersion=null,this.geometryFieldsInfo=null,this.geometryType=null,this.globalIdField=null,this.hasM=void 0,this.hasZ=void 0,this.heightModelInfo=null,this.historicMoment=null,this.indexes=new(i.A.ofType(S)),this.isTable=!1,this.layerId=void 0,this.maxScale=0,this.minScale=0,this.objectIdField=null,this.preferredTimeZone=null,this.relationships=null,this.returnM=void 0,this.returnZ=void 0,this.serviceDefinitionExpression=null,this.serviceItemId=null,this.sourceJSON=null,this.spatialReference=f.A.WGS84,this.subtypeField=null,this.subtypes=null,this.trackIdField=null,this.version=void 0}get authenticationTriggerEvent(){if(!this.url)return null;const{capabilities:e}=this;if(e){const{query:t,operations:r,editing:n}=e;if(!t.supportsQueryByOthers||!t.supportsQueryByAnonymous)return"load";if(r.supportsEditing&&!(n.supportsUpdateByOthers&&n.supportsUpdateByAnonymous&&n.supportsDeleteByOthers&&n.supportsDeleteByAnonymous))return"load"}if(this.serviceDefinitionExpression?.toLowerCase().includes("current_user"))return"load";if(this.userHasUpdateItemPrivileges){if((0,I.tG)(this))return"load";if(this.hasUpdateItemRestrictions)return e.operations.supportsQuery?"editing":"load"}if(this.userHasFullEditingPrivileges&&this.hasFullEditingRestrictions)return"editing";const t=this.editFieldsInfo;return(t?.creatorField||t?.editorField)&&e?.operations.supportsEditing?"editing":null}readCapabilitiesFromService(e,t){return(0,C.S)(t,this.url)}readEditingInfo(e,t){const{editingInfo:r}=t;return r?{lastEditDate:null!=r.lastEditDate?new Date(r.lastEditDate):null}:null}get effectiveCapabilities(){const e=this.capabilities;if(!e)return null;const t=(0,s.o8)(e),{operations:r,editing:n}=t;return(0,I.Pt)(this)?(this.userHasUpdateItemPrivileges&&(r.supportsQuery=!0),t):this.userHasUpdateItemPrivileges?(r.supportsAdd=r.supportsDelete=r.supportsEditing=r.supportsQuery=r.supportsUpdate=n.supportsDeleteByOthers=n.supportsGeometryUpdate=n.supportsUpdateByOthers=!0,t):(this.userHasFullEditingPrivileges&&r.supportsEditing&&(r.supportsAdd=r.supportsDelete=r.supportsUpdate=n.supportsGeometryUpdate=!0),t)}readGlobalIdFieldFromService(e,t){return(0,I.jD)(t)}get hasFullEditingRestrictions(){const e=this.capabilities;if(!e||(0,I.Pt)(this))return!1;const{operations:t,editing:r}=e;return t.supportsEditing&&!(t.supportsAdd&&t.supportsDelete&&t.supportsUpdate&&r.supportsGeometryUpdate)}get hasUpdateItemRestrictions(){const e=this.capabilities;if(!e)return!1;const{operations:t,editing:r}=e;return(0,I.Pt)(this)?!t.supportsQuery:!(t.supportsAdd&&t.supportsDelete&&t.supportsEditing&&t.supportsQuery&&t.supportsUpdate&&r.supportsDeleteByOthers&&r.supportsGeometryUpdate&&r.supportsUpdateByOthers)}readIsTableFromService(e,t){return"Table"===t.type}readMaxScale(e,t){return t.effectiveMaxScale||e||0}readMinScale(e,t){return t.effectiveMinScale||e||0}readObjectIdFieldFromService(e,t){return(0,I.Zm)(t)}readServiceDefinitionExpression(e,t){return t.definitionQuery||t.definitionExpression}set url(e){if(null==e)return void this._set("url",e);const t=(0,y.HZ)({layer:this,url:e,nonStandardUrlAllowed:!0,logger:o.A.getLogger(this)});this._set("url",t.url),null!=t.layerId&&this._set("layerId",t.layerId)}writeUrl(e,t,r,n){(0,y.LS)(this,e,null,t,n)}readVersion(e,t){return(0,I.$4)(t)}};return(0,n._)([(0,a.MZ)({readOnly:!0})],t.prototype,"authenticationTriggerEvent",null),(0,n._)([(0,a.MZ)({type:String,json:{origins:{service:{read:{source:"copyrightText"}}}}})],t.prototype,"copyright",void 0),(0,n._)([(0,a.MZ)({readOnly:!0,json:{read:!1,origins:{service:{read:{source:["advancedQueryCapabilities","allowGeometryUpdates","allowUpdateWithoutMValues","archivingInfo","capabilities","datesInUnknownTimezone","hasAttachments","hasM","hasZ","isDataBranchVersioned","isDataVersioned","maxRecordCount","maxRecordCountFactor","ownershipBasedAccessControlForFeatures","standardMaxRecordCount","supportedQueryFormats","supportsAdvancedQueries","supportsApplyEditsWithGlobalIds","supportsAttachmentsByUploadId","supportsAttachmentsResizing","supportsCalculate","supportsCoordinatesQuantization","supportsExceedsLimitStatistics","supportsFieldDescriptionProperty","supportsQuantizationEditMode","supportsRollbackOnFailureParameter","supportsStatistics","supportsTruncate","supportsValidateSql","tileMaxRecordCount","useStandardizedQueries"]}}}}})],t.prototype,"capabilities",void 0),(0,n._)([(0,l.w)("service","capabilities")],t.prototype,"readCapabilitiesFromService",null),(0,n._)([(0,a.MZ)((0,_.P6)("dateFieldsTimeReference"))],t.prototype,"dateFieldsTimeZone",void 0),(0,n._)([(0,a.MZ)({type:Boolean})],t.prototype,"datesInUnknownTimezone",void 0),(0,n._)([(0,a.MZ)({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],t.prototype,"definitionExpression",void 0),(0,n._)([(0,a.MZ)({type:String,json:{origins:{service:{read:{source:"displayField"}}}}})],t.prototype,"displayField",void 0),(0,n._)([(0,a.MZ)({readOnly:!0,type:b})],t.prototype,"editFieldsInfo",void 0),(0,n._)([(0,a.MZ)({readOnly:!0})],t.prototype,"editingInfo",void 0),(0,n._)([(0,l.w)("editingInfo")],t.prototype,"readEditingInfo",null),(0,n._)([(0,a.MZ)({readOnly:!0})],t.prototype,"effectiveCapabilities",null),(0,n._)([(0,a.MZ)((()=>{const e=(0,s.o8)(m.Yj),t=e.json.origins;return t["web-map"]={read:!1,write:!1},t["portal-item"]={read:!1,write:!1},e})())],t.prototype,"elevationInfo",void 0),(0,n._)([(0,a.MZ)({type:A.A,json:{name:"layerDefinition.floorInfo",write:!0,origins:{"web-scene":{name:"layerDefinition.floorInfo",write:{enabled:!0,layerContainerTypes:p.K}}}}})],t.prototype,"floorInfo",void 0),(0,n._)([(0,a.MZ)({type:d.default,json:{origins:{service:{read:{source:"extent"}}}}})],t.prototype,"fullExtent",void 0),(0,n._)([(0,a.MZ)()],t.prototype,"gdbVersion",void 0),(0,n._)([(0,a.MZ)({readOnly:!0,type:F,json:{read:{source:"geometryProperties"}}})],t.prototype,"geometryFieldsInfo",void 0),(0,n._)([(0,a.MZ)({type:["point","polygon","polyline","multipoint","multipatch","mesh"],json:{origins:{service:{read:I.iX.read}}}})],t.prototype,"geometryType",void 0),(0,n._)([(0,a.MZ)({type:String})],t.prototype,"globalIdField",void 0),(0,n._)([(0,l.w)("service","globalIdField",["globalIdField","fields"])],t.prototype,"readGlobalIdFieldFromService",null),(0,n._)([(0,a.MZ)({readOnly:!0})],t.prototype,"hasFullEditingRestrictions",null),(0,n._)([(0,a.MZ)({type:Boolean,json:{origins:{service:{read:!0}}}})],t.prototype,"hasM",void 0),(0,n._)([(0,a.MZ)({readOnly:!0})],t.prototype,"hasUpdateItemRestrictions",null),(0,n._)([(0,a.MZ)({type:Boolean,json:{origins:{service:{read:!0}}}})],t.prototype,"hasZ",void 0),(0,n._)([(0,a.MZ)({readOnly:!0,type:h.A})],t.prototype,"heightModelInfo",void 0),(0,n._)([(0,a.MZ)({type:Date})],t.prototype,"historicMoment",void 0),(0,n._)([(0,a.MZ)({type:i.A.ofType(S),readOnly:!0})],t.prototype,"indexes",void 0),(0,n._)([(0,a.MZ)({readOnly:!0})],t.prototype,"isTable",void 0),(0,n._)([(0,l.w)("service","isTable",["type"])],t.prototype,"readIsTableFromService",null),(0,n._)([(0,a.MZ)({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{read:!1,write:{target:"id"}}},read:!1}})],t.prototype,"layerId",void 0),(0,n._)([(0,a.MZ)(m.hG)],t.prototype,"maxScale",void 0),(0,n._)([(0,l.w)("service","maxScale",["maxScale","effectiveMaxScale"])],t.prototype,"readMaxScale",null),(0,n._)([(0,a.MZ)(m.hn)],t.prototype,"minScale",void 0),(0,n._)([(0,l.w)("service","minScale",["minScale","effectiveMinScale"])],t.prototype,"readMinScale",null),(0,n._)([(0,a.MZ)({type:String})],t.prototype,"objectIdField",void 0),(0,n._)([(0,l.w)("service","objectIdField",["objectIdField","fields"])],t.prototype,"readObjectIdFieldFromService",null),(0,n._)([(0,a.MZ)((0,_.P6)("preferredTimeReference"))],t.prototype,"preferredTimeZone",void 0),(0,n._)([(0,a.MZ)({type:[T.A],readOnly:!0})],t.prototype,"relationships",void 0),(0,n._)([(0,a.MZ)({type:Boolean})],t.prototype,"returnM",void 0),(0,n._)([(0,a.MZ)({type:Boolean})],t.prototype,"returnZ",void 0),(0,n._)([(0,a.MZ)({readOnly:!0,json:{write:!1}})],t.prototype,"serverGens",void 0),(0,n._)([(0,a.MZ)({readOnly:!0})],t.prototype,"serviceDefinitionExpression",void 0),(0,n._)([(0,l.w)("service","serviceDefinitionExpression",["definitionQuery","definitionExpression"])],t.prototype,"readServiceDefinitionExpression",null),(0,n._)([(0,a.MZ)({type:String,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],t.prototype,"serviceItemId",void 0),(0,n._)([(0,a.MZ)()],t.prototype,"sourceJSON",void 0),(0,n._)([(0,a.MZ)({type:f.A,json:{origins:{service:{read:{source:"extent.spatialReference"}}}}})],t.prototype,"spatialReference",void 0),(0,n._)([(0,a.MZ)({type:String,readOnly:!0,json:{origins:{service:{read:!0}}}})],t.prototype,"subtypeField",void 0),(0,n._)([(0,a.MZ)({type:[O],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],t.prototype,"subtypes",void 0),(0,n._)([(0,a.MZ)({type:String,json:{read:{source:"timeInfo.trackIdField"}}})],t.prototype,"trackIdField",void 0),(0,n._)([(0,a.MZ)(m.OZ)],t.prototype,"url",null),(0,n._)([(0,c.K)("url")],t.prototype,"writeUrl",null),(0,n._)([(0,a.MZ)({json:{origins:{service:{read:!0}},read:!1}})],t.prototype,"version",void 0),(0,n._)([(0,l.w)("service","version",["currentVersion","capabilities","drawingInfo","hasAttachments","htmlPopupType","relationships","timeInfo","typeIdField","types"])],t.prototype,"readVersion",null),t=(0,n._)([(0,u.$)("esri.layers.mixins.FeatureLayerBase")],t),t}},19431:function(e,t,r){r.d(t,{J:function(){return x}});var n=r(53804),i=(r(74865),r(1526),r(96173),r(52308),r(78002),r(30047),r(27777)),s=(r(61065),r(6537),r(40633)),o=r(28181),a=r(23502),l=r(58941),u=(r(13798),r(65953)),c=r(39763),p=r(93966),d=r(53096),h=r(59423),f=(r(10748),r(39819)),y=r(92709),m=r(23212),g=r(53871),w=r(90363);l.A.add("esri-cluster-arcade-enabled",!0);const _=(0,l.A)("esri-cluster-arcade-enabled"),v=new Set(["simple-line","simple-fill","picture-fill"]);function b(e,t){let r=t.clone();if(!S(r))return r;if(t.getSymbols().some((e=>v.has(e.type)))&&(r=new i.A({symbol:new w.A})),r.authoringInfo||(r.authoringInfo=new g.A),r.authoringInfo.isAutoGenerated=!0,"visualVariables"in r){const t=(r.visualVariables||[]).filter((e=>"$view.scale"!==e.valueExpression));t.forEach((t=>{"rotation"===t.type?t.field?t.field=M(e,t.field,"avg_angle","number"):t.valueExpression&&(t.field=I(e,t.valueExpression,"avg_angle","number"),t.valueExpression=null):t.normalizationField?(t.field=M(e,t.field,"avg_norm","number",t.normalizationField),t.normalizationField=null):t.field?t.field=M(e,t.field,"avg","number"):t.valueExpression&&(t.field=I(e,t.valueExpression,"avg","number"),t.valueExpression=null)})),r.visualVariables=t}switch(r.type){case"simple":break;case"pie-chart":for(const t of r.attributes)t.field?t.field=M(e,t.field,"sum","number"):t.valueExpression&&(t.field=I(e,t.valueExpression,"sum","number"),t.valueExpression=null);break;case"unique-value":r.field?r.field=M(e,r.field,"mode","string"):r.valueExpression&&(r.field=I(e,r.valueExpression,"mode","string"),r.valueExpression=null);break;case"class-breaks":r.normalizationField?(r.field=M(e,r.field,"avg_norm","number",r.normalizationField),r.normalizationField=null):r.field?r.field=M(e,r.field,"avg","number"):r.valueExpression&&(r.field=I(e,r.valueExpression,"avg","number"),r.valueExpression=null)}return r}const S=e=>{const t=t=>s.A.getLogger("esri.views.2d.layers.support.clusterUtils").error(new f.A("Unsupported-renderer",t,{renderer:e}));if(!e)return!1;switch(e.type){case"unique-value":if(e.field2||e.field3)return t("FeatureReductionCluster does not support multi-field UniqueValueRenderers"),!1;break;case"class-breaks":if(e.normalizationField){const r=e.normalizationType;if("field"!==r)return t(`FeatureReductionCluster does not support a normalizationType of ${r}`),!1}break;case"simple":case"pie-chart":break;default:return t(`FeatureReductionCluster does not support renderers of type ${e.type}`),!1}if(!_){if("valueExpression"in e&&e.valueExpression)return t("FeatureReductionCluster does not currently support renderer.valueExpression. Support will be added in a future release"),!1;if(("visualVariables"in e&&e.visualVariables||[]).some((e=>!(!("valueExpression"in e)||!e.valueExpression))))return t("FeatureReductionCluster does not currently support visualVariables with a valueExpression. Support will be added in a future release"),!1}return!0};function I(e,t,r,n){const i=(0,y.d)(t),s="mode"===r?`cluster_type_${i}`:"sum"===r?`cluster_sum_${i}`:`cluster_avg_${i}`;return e.some((e=>e.name===s))||e.push(new c.A({name:s,isAutoGenerated:!0,onStatisticExpression:new m.A({expression:t,returnType:n}),statisticType:r})),s}function M(e,t,r,n,i){if("cluster_count"===t||e.some((e=>e.name===t)))return t;const s=function(e,t,r){switch(e){case"sum":return`cluster_sum_${t}`;case"avg":case"avg_angle":return`cluster_avg_${t}`;case"mode":return`cluster_type_${t}`;case"avg_norm":{const e=r,n="field",i=t.toLowerCase()+",norm:"+n+","+e.toLowerCase();return"cluster_avg_"+(0,y.d)(i)}}}(r,t,i);return e.some((e=>e.name===s))||("avg_norm"===r?e.push(new c.A({name:s,isAutoGenerated:!0,onStatisticExpression:new m.A({expression:`$feature.${t} / $feature.${i}`,returnType:n}),statisticType:"avg"})):e.push(new c.A({name:s,isAutoGenerated:!0,onStatisticField:t,statisticType:r}))),s}const x=e=>{let t=class extends e{constructor(...e){super(...e),this.addHandles((0,o.watch)((()=>this.renderer),(()=>{if(this.featureReduction){const e=this._normalizeFeatureReduction(this.featureReduction);this._set("featureReduction",e)}}),o.OH))}set featureReduction(e){const t=this._normalizeFeatureReduction(e);this._set("featureReduction",t)}set renderer(e){}_withClusterVariable(e,t,r){const n=e.clone();return"visualVariables"in n&&(n.visualVariables||(n.visualVariables=[]),n.visualVariables.some((e=>"size"===e.type))||n.visualVariables.push(new d.A({field:"cluster_count",stops:[new h.A({value:1}),new h.A({useMinValue:!0,size:t}),new h.A({useMaxValue:!0,size:r})]}))),n}_normalizeFeatureReduction(e){if("cluster"!==e?.type)return e;const t=e.clone(),r=[new c.A({name:"cluster_count",alias:"cluster_count",isAutoGenerated:!0,statisticType:"count"})],n=(t.fields??[]).filter((e=>!e.isAutoGenerated)),s=e.renderer&&!e.renderer.authoringInfo?.isAutoGenerated,{clusterMinSize:o,clusterMaxSize:a}=t;if(s){t.fields=[...r,...n];const e=this._withClusterVariable(t.renderer,o,a);return t.effectiveFeatureRenderer=e,t.effectiveClusterRenderer=e,t}if(e.symbol){if(t.fields=[...r,...n],t.renderer=null,!this.renderer)return t.effectiveFeatureRenderer=null,t.effectiveClusterRenderer=null,t;const s=b(r,this.renderer),l=this._withClusterVariable(s,o,a),u="visualVariables"in l&&l.visualVariables?l.visualVariables:[],c=new i.A({symbol:e.symbol,visualVariables:u});return t.fields=[...r,...n],t.effectiveFeatureRenderer=l,t.effectiveClusterRenderer=c,t}if(!this.renderer)return e;const l=b(r,this.renderer);t.fields=[...r,...n],t.renderer=l;const u=this._withClusterVariable(l,o,a);return t.effectiveFeatureRenderer=u,t.effectiveClusterRenderer=u,t}};return(0,n._)([(0,a.MZ)(p.d)],t.prototype,"featureReduction",null),t=(0,n._)([(0,u.$)("esri.layers.mixins.FeatureReductionLayer")],t),t}},92078:function(e,t,r){r.d(t,{q:function(){return v}});var n=r(53804),i=r(39819),s=r(90683),o=r(23502),a=r(67888),l=(r(13798),r(58941),r(47332)),u=r(65953),c=r(81392),p=r(64786),d=r(97354),h=r(99495);const f={ArcGISAnnotationLayer:!0,ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,CatalogLayer:!0,CSV:!0,GeoJSON:!0,GeoRSS:!0,GroupLayer:!0,KML:!0,KnowledgeGraphLayer:!0,MediaLayer:!0,OGCFeatureLayer:!0,OrientedImageryLayer:!0,SubtypeGroupLayer:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},y={ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,OpenStreetMap:!0,VectorTileLayer:!0,WMS:!0,WebTiledLayer:!0},m={ArcGISFeatureLayer:!0,SubtypeGroupTable:!0},g={"web-scene/operational-layers":{ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledElevationServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BuildingSceneLayer:!0,CatalogLayer:!0,CSV:!0,GeoJSON:!0,GroupLayer:!0,IntegratedMesh3DTilesLayer:!0,IntegratedMeshLayer:!0,KML:!0,LineOfSightLayer:!0,MediaLayer:!0,OGCFeatureLayer:!0,OrientedImageryLayer:!0,PointCloudLayer:!0,RasterDataLayer:!0,VectorTileLayer:!0,ViewshedLayer:!0,Voxel:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},"web-scene/basemap":{ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,WMS:!0,WebTiledLayer:!0},"web-scene/ground":{ArcGISTiledElevationServiceLayer:!0,RasterDataElevationLayer:!0},"web-scene/tables":{ArcGISFeatureLayer:!0},"web-map/operational-layers":f,"web-map/basemap":y,"web-map/tables":m,"link-chart/operational-layers":{...f,LinkChartLayer:!0},"link-chart/basemap":y,"link-chart/tables":m,"portal-item/operational-layers":{ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,BuildingSceneLayer:!0,IntegratedMesh3DTilesLayer:!0,IntegratedMeshLayer:!0,MediaLayer:!0,OrientedImageryLayer:!0,PointCloudLayer:!0,SubtypeGroupLayer:!0}};var w=r(7010),_=r(52038);const v=e=>{let t=class extends e{constructor(){super(...arguments),this.persistenceEnabled=!0,this.title=null}readId(e,t,r){return"Group Layer"===r?.portalItem?.type?void 0:e}writeListMode(e,t,r,n){(n&&"ground"===n.layerContainerType||e&&(0,h.R)(this,r,{},n))&&(t[r]=e)}writeOperationalLayerType(e,t,r,n){e&&"tables"!==n?.layerContainerType&&(t.layerType=e)}writeTitle(e,t){t.title=e??"Layer"}readTimeExtent(e){return e?_.A.fromArray(e):null}writeTimeExtent(e,t,r,n){e&&"tables"!==n.layerContainerType&&(e.isEmpty?n?.messages&&n.messages.push(new i.A("layer:invalid-visibilityTimeExtent","visibilityTimeExtent cannot be empty")):t[r]=e.toArray())}read(e,t){t&&(t.layer=this),(0,d.t)(this,e,(t=>super.read(e,t)),t)}write(e,t){if(!this.persistenceEnabled&&!t?.ignorePersistenceEnabled)return null;if(t?.origin){const e=`${t.origin}/${t.layerContainerType||"operational-layers"}`,r=g[e];let n=!!r?.[this.operationalLayerType];if("ArcGISTiledElevationServiceLayer"===this.operationalLayerType&&"web-scene/operational-layers"===e&&(n=!1),"ArcGISDimensionLayer"===this.operationalLayerType&&"web-map/operational-layers"===e&&(n=!1),!n)return t.messages?.push(new i.A("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${e}'`,{layer:this})),null}const r=super.write(e,{...t,layer:this}),n=!!t&&!!t.messages&&!!t.messages.filter((e=>e instanceof i.A&&"web-document-write:property-required"===e.name)).length;return(0,s.w8)(r?.url)?(t?.messages?.push(new i.A("layer:invalid-url",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Blob URL cannot be written to web scenes and web maps`,{layer:this})),null):!this.url&&n?null:r}beforeSave(){}};return(0,n._)([(0,o.MZ)({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],t.prototype,"id",void 0),(0,n._)([(0,l.w)("id",["id"])],t.prototype,"readId",null),(0,n._)([(0,o.MZ)(w.C1)],t.prototype,"listMode",void 0),(0,n._)([(0,c.K)("listMode")],t.prototype,"writeListMode",null),(0,n._)([(0,o.MZ)({type:String,readOnly:!0,json:{read:!1,write:{target:"layerType",ignoreOrigin:!0},origins:{"portal-item":{write:!1},"web-scene":{name:"layerType",read:!1,write:{enabled:!0,ignoreOrigin:!0,layerContainerTypes:p.K}}}}})],t.prototype,"operationalLayerType",void 0),(0,n._)([(0,c.K)("operationalLayerType")],t.prototype,"writeOperationalLayerType",null),(0,n._)([(0,o.MZ)(w.ke)],t.prototype,"opacity",void 0),(0,n._)([(0,o.MZ)({type:Boolean,readOnly:!1})],t.prototype,"persistenceEnabled",void 0),(0,n._)([(0,o.MZ)({type:String,json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}},"portal-item":{write:!1}}},value:"Layer"})],t.prototype,"title",void 0),(0,n._)([(0,c.K)("title"),(0,c.K)(["web-scene"],"title")],t.prototype,"writeTitle",null),(0,n._)([(0,o.MZ)({type:_.A,json:{origins:{"web-scene":{write:{layerContainerTypes:p.K}}}}})],t.prototype,"visibilityTimeExtent",void 0),(0,n._)([(0,l.w)("visibilityTimeExtent")],t.prototype,"readTimeExtent",null),(0,n._)([(0,c.K)(["portal-item","web-map","web-scene"],"visibilityTimeExtent",{visibilityTimeExtent:{type:[[a.jz,a.Uv]]}})],t.prototype,"writeTimeExtent",null),(0,n._)([(0,o.MZ)({type:Boolean,json:{origins:{"web-scene":{name:"visibility",write:{enabled:!0,layerContainerTypes:p.K}}},name:"visibility",write:!0}})],t.prototype,"visible",void 0),t=(0,n._)([(0,u.$)("esri.layers.mixins.OperationalLayer")],t),t}},25353:function(e,t,r){r.d(t,{f:function(){return u},n:function(){return l}});var n=r(53804),i=r(34194),s=r(23502),o=(r(58941),r(40633),r(13798),r(65953)),a=r(41165);const l={type:[a.A],json:{origins:{"web-scene":{write:!1,read:!1}},name:"layerDefinition.orderBy",read:{reader:function(e,t,r){if(!e)return null;const n=e.find((e=>!!e.field));if(!n)return null;const i=new a.A;return i.read(n,r),[i]}},write:{writer:function(e,t,r,n){const s=e.find((e=>!!e.field));s&&(0,i.sM)(r,[s.toJSON()],t)}}}},u=e=>{let t=class extends e{constructor(){super(...arguments),this.orderBy=null}};return(0,n._)([(0,s.MZ)(l)],t.prototype,"orderBy",void 0),t=(0,n._)([(0,o.$)("esri.layers.mixins.OrderedLayer")],t),t}},61380:function(e,t,r){r.d(t,{A:function(){return S}});var n=r(53804),i=r(25591),s=r(7156),o=r(93040),a=r(77472),l=r(39819),u=r(40633),c=r(95929),p=r(60539),d=r(90683),h=r(23502),f=(r(58941),r(13798),r(47332)),y=r(65953),m=r(81392),g=r(11432),w=r(51432),_=r(43173),v=r(85956),b=r(29606);const S=e=>{let t=class extends e{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1}destroy(){this.portalItem=(0,c.pR)(this.portalItem),this.resourceReferences.portalItem=null,this.resourceReferences.paths.length=0}set portalItem(e){e!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",e))}readPortalItem(e,t,r){if(t.itemId)return new _.default({id:t.itemId,portal:r?.portal})}writePortalItem(e,t){e?.id&&(t.itemId=e.id)}async loadFromPortal(e,t){if(this.portalItem?.id)try{const{load:n}=await r.e(1536).then(r.bind(r,58615));return(0,p.Te)(t),await n({instance:this,supportedTypes:e.supportedTypes,validateItem:e.validateItem,supportsData:e.supportsData,layerModuleTypeMap:e.layerModuleTypeMap},t)}catch(e){throw(0,p.zf)(e)||u.A.getLogger(this).warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})\n  ${e}`),e}}async finishLoadEditablePortalLayer(e){this._set("userHasEditingPrivileges",await this._fetchUserHasEditingPrivileges(e).catch((e=>((0,p.QP)(e),!0))))}async setUserPrivileges(e,t){if(!i.default.userPrivilegesApplied)return this.finishLoadEditablePortalLayer(t);if(this.url)try{const{features:{edit:r,fullEdit:n},content:{updateItem:i}}=await this._fetchUserPrivileges(e,t);this._set("userHasEditingPrivileges",r),this._set("userHasFullEditingPrivileges",n),this._set("userHasUpdateItemPrivileges",i)}catch(e){(0,p.QP)(e)}}async _fetchUserPrivileges(e,t){let r=this.portalItem;if(!e||!r||!r.loaded||r.sourceUrl)return this._fetchFallbackUserPrivileges(t);const n=e===r.id;if(n&&r.portal.user)return(0,b.It)(r);let i,o;if(n)i=r.portal.url;else try{i=await(0,g.wI)(this.url,t)}catch(e){(0,p.QP)(e)}if(!i||!(0,d.b8)(i,r.portal.url))return this._fetchFallbackUserPrivileges(t);try{const e=null!=t?t.signal:null;o=await(s.id?.getCredential(`${i}/sharing`,{prompt:!1,signal:e}))}catch(e){(0,p.QP)(e)}const a=!0,l=!1,u=!1;if(!o)return{features:{edit:a,fullEdit:l},content:{updateItem:u}};try{if(n?await r.reload():(r=new _.default({id:e,portal:{url:i}}),await r.load(t)),r.portal.user)return(0,b.It)(r)}catch(e){(0,p.QP)(e)}return{features:{edit:a,fullEdit:l},content:{updateItem:u}}}async _fetchFallbackUserPrivileges(e){let t=!0;try{t=await this._fetchUserHasEditingPrivileges(e)}catch(e){(0,p.QP)(e)}return{features:{edit:t,fullEdit:!1},content:{updateItem:!1}}}async _fetchUserHasEditingPrivileges(e){const t=this.url?s.id?.findCredential(this.url):null;if(!t)return!0;const r=I.credential===t?I.user:await this._fetchEditingUser(e);return I.credential=t,I.user=r,null==r?.privileges||r.privileges.includes("features:user:edit")}async _fetchEditingUser(e){const t=this.portalItem?.portal?.user;if(t)return t;const r=s.id?.findServerInfo(this.url??"");if(!r?.owningSystemUrl)return null;const n=`${r.owningSystemUrl}/sharing/rest`,i=w.A.getDefault();if(i&&i.loaded&&(0,d.S8)(i.restUrl)===(0,d.S8)(n))return i.user;const l=`${n}/community/self`,u=null!=e?e.signal:null,c=await(0,a.Ke)((0,o.A)(l,{authMode:"no-prompt",query:{f:"json"},signal:u}));return c.ok?v.A.fromJSON(c.value.data):null}read(e,t){t&&(t.layer=this),super.read(e,t)}write(e,t){const r=t?.portal,n=this.portalItem?.id&&(this.portalItem.portal||w.A.getDefault());return r&&n&&!(0,d.ut)(n.restUrl,r.restUrl)?(t.messages&&t.messages.push(new l.A("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(e,{...t,layer:this})}};return(0,n._)([(0,h.MZ)({type:_.default})],t.prototype,"portalItem",null),(0,n._)([(0,f.w)("web-document","portalItem",["itemId"])],t.prototype,"readPortalItem",null),(0,n._)([(0,m.K)("web-document","portalItem",{itemId:{type:String}})],t.prototype,"writePortalItem",null),(0,n._)([(0,h.MZ)({clonable:!1})],t.prototype,"resourceReferences",void 0),(0,n._)([(0,h.MZ)({type:Boolean,readOnly:!0})],t.prototype,"userHasEditingPrivileges",void 0),(0,n._)([(0,h.MZ)({type:Boolean,readOnly:!0})],t.prototype,"userHasFullEditingPrivileges",void 0),(0,n._)([(0,h.MZ)({type:Boolean,readOnly:!0})],t.prototype,"userHasUpdateItemPrivileges",void 0),t=(0,n._)([(0,y.$)("esri.layers.mixins.PortalLayer")],t),t},I={credential:null,user:null}},70652:function(e,t,r){r.d(t,{J:function(){return _}});var n=r(53804),i=(r(58941),r(40633)),s=r(60539),o=r(23502),a=r(77560),l=(r(13798),r(65953)),u=r(64786),c=r(78879),p=r(28181),d=r(25638);const h=new c.A,f=new WeakMap;function y(e,t){return Number.isFinite(e)&&Number.isFinite(t)?t<=0?e:y(t,e%t):0}let m=0,g=0;function w(){const e=Date.now();let t=!1;for(const r of h){const n=r.deref();n?n.refreshInterval&&e-(f.get(n)??0)+5>=6e4*n.refreshInterval&&(f.set(n,e),n.refresh(e)):t=!0}if(t)for(let e=h.length-1;e>=0;e--)h.at(e).deref()||h.removeAt(e)}(0,d.fm)((()=>{const e=Date.now();let t=0;for(const r of h){const n=r.deref();n&&(t=y(Math.round(6e4*n.refreshInterval),t),n.refreshInterval?f.get(n)||f.set(n,e):f.delete(n))}if(t!==g){if(g=t,clearInterval(m),0===g)return void(m=0);m=setInterval(w,g)}}),p.OH);const _=e=>{let t=class extends e{constructor(...e){super(...e),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=(0,s.sg)((()=>this.hasDataChanged())),this.when().then((()=>{this.destroyed||function(e){(function(e){return null!=e&&"object"==typeof e&&"refreshInterval"in e&&"refresh"in e})(e)&&h.push(new WeakRef(e))}(this)}),(()=>{}))}destroy(){!function(e){const t=h.find((t=>t.deref()===e));t&&h.remove(t)}(this)}castRefreshInterval(e){return e>=.1?e:e<=0?0:.1}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(e=Date.now()){(0,s.QZ)(this._debounceHasDataChanged()).then((t=>{t&&this._set("refreshTimestamp",e),this.emit("refresh",{dataChanged:t})}),(e=>{i.A.getLogger(this).error(e),this.emit("refresh",{dataChanged:!1,error:e})}))}async hasDataChanged(){return!0}get test(){}};return(0,n._)([(0,o.MZ)({type:Number,json:{write:!0,origins:{"web-scene":{write:{enabled:!0,layerContainerTypes:u.K}}}}})],t.prototype,"refreshInterval",void 0),(0,n._)([(0,a.w)("refreshInterval")],t.prototype,"castRefreshInterval",null),(0,n._)([(0,o.MZ)({readOnly:!0})],t.prototype,"refreshTimestamp",void 0),(0,n._)([(0,o.MZ)({readOnly:!0})],t.prototype,"refreshParameters",null),t=(0,n._)([(0,l.$)("esri.layers.mixins.RefreshableLayer")],t),t}},85924:function(e,t,r){r.d(t,{B:function(){return h},e:function(){return f}});var n=r(53804),i=r(23502),s=(r(58941),r(40633),r(13798),r(47332)),o=r(65953),a=r(64786),l=r(53743),u=r(36143),c=r(35060),p=r(52038),d=r(92427);const h={type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation",layerContainerTypes:a.K}}},f=e=>{let t=class extends e{constructor(){super(...arguments),this.timeExtent=null,this.timeOffset=null,this.useViewTime=!0}readOffset(e,t){const r=t.timeInfo.exportOptions;if(!r)return null;const n=r.timeOffset,i=c.j.fromJSON(r.timeOffsetUnits);return n&&i?new d.A({value:n,unit:i}):null}set timeInfo(e){(0,l.sv)(e,this.fieldsIndex),this._set("timeInfo",e)}};return(0,n._)([(0,i.MZ)({type:p.A,json:{write:!1}})],t.prototype,"timeExtent",void 0),(0,n._)([(0,i.MZ)({type:d.A})],t.prototype,"timeOffset",void 0),(0,n._)([(0,s.w)("service","timeOffset",["timeInfo.exportOptions"])],t.prototype,"readOffset",null),(0,n._)([(0,i.MZ)({value:null,type:u.A,json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],t.prototype,"timeInfo",null),(0,n._)([(0,i.MZ)(h)],t.prototype,"useViewTime",void 0),t=(0,n._)([(0,o.$)("esri.layers.mixins.TemporalLayer")],t),t}},39763:function(e,t,r){r.d(t,{A:function(){return p}});var n,i=r(53804),s=r(30905),o=r(21609),a=r(23502),l=(r(58941),r(40633),r(65953)),u=r(23212);let c=n=class extends s.oY{constructor(e){super(e),this.isAutoGenerated=!1,this.name=null,this.alias=null,this.onStatisticField=null,this.onStatisticExpression=null,this.statisticType=null}clone(){return new n({name:this.name,alias:this.alias,isAutoGenerated:this.isAutoGenerated,onStatisticExpression:(0,o.o8)(this.onStatisticExpression),onStatisticField:this.onStatisticField,statisticType:this.statisticType})}};(0,i._)([(0,a.MZ)({type:Boolean,json:{write:!0}})],c.prototype,"isAutoGenerated",void 0),(0,i._)([(0,a.MZ)({type:String,json:{write:!0}})],c.prototype,"name",void 0),(0,i._)([(0,a.MZ)({type:String,json:{write:!0}})],c.prototype,"alias",void 0),(0,i._)([(0,a.MZ)({type:String,json:{write:!0}})],c.prototype,"onStatisticField",void 0),(0,i._)([(0,a.MZ)({type:u.A,json:{write:!0}})],c.prototype,"onStatisticExpression",void 0),(0,i._)([(0,a.MZ)({type:String,json:{write:!0}})],c.prototype,"statisticType",void 0),c=n=(0,i._)([(0,l.$)("esri.layers.support.AggregateField")],c);const p=c},23212:function(e,t,r){r.d(t,{A:function(){return u}});var n=r(53804),i=r(75743),s=r(30905),o=r(23502),a=(r(58941),r(40633),r(13798),r(65953));let l=class extends((0,i.O)(s.oY)){constructor(e){super(e),this.expression=null,this.title=null,this.returnType=null}};(0,n._)([(0,o.MZ)({type:String,json:{write:!0}})],l.prototype,"expression",void 0),(0,n._)([(0,o.MZ)({type:String,json:{write:!0}})],l.prototype,"title",void 0),(0,n._)([(0,o.MZ)({type:String,json:{write:!0}})],l.prototype,"returnType",void 0),l=(0,n._)([(0,a.$)("esri.layers.support.ExpressionInfo")],l);const u=l},71843:function(e,t,r){r.d(t,{A:function(){return m}});var n,i=r(53804),s=r(39819),o=r(30905),a=r(34194),l=r(23502),u=(r(58941),r(40633),r(13798),r(65953)),c=r(60318),p=r(23812);const d={read:{reader:c.LF},write:{writer:c.M9,overridePolicy(){return{allowNull:null!=this.excludedEffect,isRequired:null==this.excludedEffect}}}},h={read:{reader:c.LF},write:{writer:c.M9,overridePolicy(){return{allowNull:null!=this.includedEffect,isRequired:null==this.includedEffect}}}},f={name:"showExcludedLabels",default:!0};let y=n=class extends o.oY{constructor(e){super(e),this.filter=null,this.includedEffect=null,this.excludedEffect=null,this.excludedLabelsVisible=!1}write(e,t){const r=super.write(e,t);if(t?.origin){if(r.filter){const e=Object.keys(r.filter);if(e.length>1||"where"!==e[0])return t.messages?.push(new s.A("web-document-write:unsupported-feature-effect","Invalid feature effect 'filter'. A filter can only contain a 'where' property",{layer:t.layer,effect:this})),null}if("showExcludedLabels"in r)return t.messages?.push(new s.A("web-document-write:unsupported-feature-effect","Invalid value for property 'excludedLabelsVisible' which should always be 'true'",{layer:t.layer,effect:this})),null}return r}clone(){return new n({filter:null!=this.filter?this.filter.clone():null,includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})}};(0,i._)([(0,l.MZ)({type:p.A,json:{write:{allowNull:!0,writer(e,t,r,n){const i=e?.write({},n);i&&0!==Object.keys(i).length?(0,a.sM)(r,i,t):(0,a.sM)(r,null,t)}}}})],y.prototype,"filter",void 0),(0,i._)([(0,l.MZ)({json:{read:c.LF,write:{writer:c.M9,allowNull:!0},origins:{"web-map":d,"portal-item":d}}})],y.prototype,"includedEffect",void 0),(0,i._)([(0,l.MZ)({json:{read:c.LF,write:{writer:c.M9,allowNull:!0},origins:{"web-map":h,"portal-item":h}}})],y.prototype,"excludedEffect",void 0),(0,i._)([(0,l.MZ)({type:Boolean,json:{write:!0,name:"showExcludedLabels",origins:{"web-map":f,"portal-item":f}}})],y.prototype,"excludedLabelsVisible",void 0),y=n=(0,i._)([(0,u.$)("esri.layers.support.FeatureEffect")],y);const m=y},23812:function(e,t,r){r.d(t,{A:function(){return m}});var n,i=r(53804),s=r(50917),o=r(73037),a=r(30905),l=r(21609),u=r(23502),c=(r(58941),r(40633),r(65953)),p=r(7926),d=r(52038);const h=new o.J({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),f=new o.J({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let y=n=class extends a.oY{constructor(e){super(e),this.where=null,this.geometry=null,this.spatialRelationship="intersects",this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null}createQuery(e={}){const{where:t,geometry:r,spatialRelationship:n,timeExtent:i,objectIds:s,units:o,distance:a}=this;return new p.A({geometry:(0,l.o8)(r),objectIds:(0,l.o8)(s),spatialRelationship:n,timeExtent:(0,l.o8)(i),where:t,units:o,distance:a,...e})}clone(){const{where:e,geometry:t,spatialRelationship:r,timeExtent:i,objectIds:s,units:o,distance:a}=this;return new n({geometry:(0,l.o8)(t),objectIds:(0,l.o8)(s),spatialRelationship:r,timeExtent:(0,l.o8)(i),where:e,units:o,distance:a})}};(0,i._)([(0,u.MZ)({type:String,json:{write:!0}})],y.prototype,"where",void 0),(0,i._)([(0,u.MZ)({types:s.yR,json:{write:!0}})],y.prototype,"geometry",void 0),(0,i._)([(0,u.MZ)({type:h.apiValues,json:{name:"spatialRel",read:{reader:h.read},write:{allowNull:!1,writer:h.write,overridePolicy(){return{enabled:null!=this.geometry}}}}})],y.prototype,"spatialRelationship",void 0),(0,i._)([(0,u.MZ)({type:Number,json:{write:{overridePolicy(e){return{enabled:null!=e&&null!=this.geometry}}}}})],y.prototype,"distance",void 0),(0,i._)([(0,u.MZ)({type:[Number],json:{write:!0}})],y.prototype,"objectIds",void 0),(0,i._)([(0,u.MZ)({type:f.apiValues,json:{read:f.read,write:{writer:f.write,overridePolicy(e){return{enabled:null!=e&&null!=this.geometry}}}}})],y.prototype,"units",void 0),(0,i._)([(0,u.MZ)({type:d.A,json:{write:!0}})],y.prototype,"timeExtent",void 0),y=n=(0,i._)([(0,c.$)("esri.layers.support.FeatureFilter")],y);const m=y},84189:function(e,t,r){r.d(t,{c:function(){return a}});var n=r(53804),i=r(30905),s=r(23502),o=(r(58941),r(40633),r(13798),r(65953));let a=class extends i.oY{constructor(){super(...arguments),this.type=null}};(0,n._)([(0,s.MZ)({type:["selection","cluster","binning"],readOnly:!0,json:{read:!1,write:!0}})],a.prototype,"type",void 0),a=(0,n._)([(0,o.$)("esri.layers.support.FeatureReduction")],a)},82043:function(e,t,r){r.d(t,{A:function(){return u}});var n,i=r(53804),s=r(23502),o=(r(58941),r(40633),r(13798),r(65953)),a=r(84189);let l=n=class extends a.c{constructor(e){super(e),this.type="selection"}clone(){return new n}};(0,i._)([(0,s.MZ)({type:["selection"]})],l.prototype,"type",void 0),l=n=(0,i._)([(0,o.$)("esri.layers.support.FeatureReductionSelection")],l);const u=l},63648:function(e,t,r){r.d(t,{A:function(){return p}});var n=r(53804),i=r(75743),s=r(73037),o=r(30905),a=r(23502),l=(r(58941),r(40633),r(13798),r(65953));const u=new s.J({esriFeatureEditToolAutoCompletePolygon:"auto-complete-polygon",esriFeatureEditToolCircle:"circle",esriFeatureEditToolEllipse:"ellipse",esriFeatureEditToolFreehand:"freehand",esriFeatureEditToolLine:"line",esriFeatureEditToolNone:"none",esriFeatureEditToolPoint:"point",esriFeatureEditToolPolygon:"polygon",esriFeatureEditToolRectangle:"rectangle",esriFeatureEditToolArrow:"arrow",esriFeatureEditToolTriangle:"triangle",esriFeatureEditToolLeftArrow:"left-arrow",esriFeatureEditToolRightArrow:"right-arrow",esriFeatureEditToolUpArrow:"up-arrow",esriFeatureEditToolDownArrow:"down-arrow"});let c=class extends((0,i.O)(o.oY)){constructor(e){super(e),this.name=null,this.description=null,this.drawingTool=null,this.prototype=null,this.thumbnail=null}};(0,n._)([(0,a.MZ)({json:{write:!0}})],c.prototype,"name",void 0),(0,n._)([(0,a.MZ)({json:{write:!0}})],c.prototype,"description",void 0),(0,n._)([(0,a.MZ)({json:{read:u.read,write:u.write}})],c.prototype,"drawingTool",void 0),(0,n._)([(0,a.MZ)({json:{write:!0}})],c.prototype,"prototype",void 0),(0,n._)([(0,a.MZ)({json:{write:!0}})],c.prototype,"thumbnail",void 0),c=(0,n._)([(0,l.$)("esri.layers.support.FeatureTemplate")],c);const p=c},49342:function(e,t,r){r.d(t,{A:function(){return h}});var n=r(53804),i=r(75743),s=r(30905),o=r(23502),a=(r(58941),r(40633),r(13798),r(47332)),l=r(65953),u=r(81392),c=r(97424),p=r(63648);let d=class extends((0,i.O)(s.oY)){constructor(e){super(e),this.id=null,this.name=null,this.domains=null,this.templates=null}readDomains(e){const t={};for(const r of Object.keys(e))t[r]=(0,c.rS)(e[r]);return t}writeDomains(e,t){const r={};for(const t of Object.keys(e))e[t]&&(r[t]=e[t]?.toJSON());t.domains=r}};(0,n._)([(0,o.MZ)({json:{write:!0}})],d.prototype,"id",void 0),(0,n._)([(0,o.MZ)({json:{write:!0}})],d.prototype,"name",void 0),(0,n._)([(0,o.MZ)({json:{write:!0}})],d.prototype,"domains",void 0),(0,n._)([(0,a.w)("domains")],d.prototype,"readDomains",null),(0,n._)([(0,u.K)("domains")],d.prototype,"writeDomains",null),(0,n._)([(0,o.MZ)({type:[p.A],json:{write:!0}})],d.prototype,"templates",void 0),d=(0,n._)([(0,l.$)("esri.layers.support.FeatureType")],d);const h=d},73520:function(e,t,r){r.d(t,{A:function(){return F}});var n,i=r(53804),s=r(10748),o=(r(58941),r(73037)),a=r(30905),l=r(21609),u=r(13520),c=r(23502),p=(r(40633),r(47332)),d=r(65953),h=r(81392),f=(r(13798),r(6361));let y=n=class extends a.oY{constructor(){super(...arguments),this.expression=null,this.title=null,this.value=null}readExpression(e,t){return t.value?(0,f.mX)(t.value):e}writeExpression(e,t,r){null!=this.value&&(e=(0,f.mX)(this.value)),null!=e&&(t[r]=e)}clone(){return new n({expression:this.expression,title:this.title,value:this.value})}};(0,i._)([(0,c.MZ)({type:String,json:{write:{writerEnsuresNonNull:!0}}})],y.prototype,"expression",void 0),(0,i._)([(0,p.w)("expression",["expression","value"])],y.prototype,"readExpression",null),(0,i._)([(0,h.K)("expression")],y.prototype,"writeExpression",null),(0,i._)([(0,c.MZ)({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],y.prototype,"title",void 0),(0,i._)([(0,c.MZ)({json:{read:!1,write:!1}})],y.prototype,"value",void 0),y=n=(0,i._)([(0,d.$)("esri.layers.support.LabelExpressionInfo")],y);const m=y;var g,w=r(11432),_=r(74661),v=r(8404);const b=new o.J({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0});function S(e,t,r){return{enabled:!(0,w.TU)(r?.layer)}}function I(e){return!e||"service"!==e.origin&&!("map-image"===e.layer?.type)}function M(e){return!!function(e){return"map-image"===e?.type}(e)&&!!e.capabilities?.exportMap?.supportsArcadeExpressionForLabeling}let x=g=class extends a.oY{static evaluateWhere(e,t){const r=(e,t,r)=>{switch(t){case"=":return e==r;case"<>":return e!=r;case">":return e>r;case">=":return e>=r;case"<":return e<r;case"<=":return e<=r}return!1};try{if(null==e)return!0;const n=e.split(" ");if(3===n.length)return r(t[n[0]],n[1],n[2]);if(7===n.length){const e=r(t[n[0]],n[1],n[2]),i=n[3],s=r(t[n[4]],n[5],n[6]);switch(i){case"AND":return e&&s;case"OR":return e||s}}return!1}catch(e){}}constructor(e){super(e),this.type="label",this.name=null,this.allowOverrun=!1,this.deconflictionStrategy="static",this.labelExpression=null,this.labelExpressionInfo=null,this.labelPlacement=null,this.labelPosition="curved",this.maxScale=0,this.minScale=0,this.repeatLabel=!0,this.repeatLabelDistance=null,this.symbol=_.Hk,this.useCodedValues=void 0,this.where=null}readLabelExpression(e,t){const r=t.labelExpressionInfo;if(!r||!r.value&&!r.expression)return e}writeLabelExpression(e,t,r){if(this.labelExpressionInfo)if(null!=this.labelExpressionInfo.value)e=(0,f.D3)(this.labelExpressionInfo.value);else if(null!=this.labelExpressionInfo.expression){const t=(0,f.tH)(this.labelExpressionInfo.expression);t&&(e="["+t+"]")}null!=e&&(t[r]=e)}writeLabelExpressionInfo(e,t,r,n){if(null==e&&null!=this.labelExpression&&I(n))e=new m({expression:this.getLabelExpressionArcade()});else if(!e)return;const i=e.toJSON(n);i.expression&&(t[r]=i)}writeMaxScale(e,t){(e||this.minScale)&&(t.maxScale=e)}writeMinScale(e,t){(e||this.maxScale)&&(t.minScale=e)}getLabelExpression(){return(0,f.XJ)(this)}getLabelExpressionArcade(){return(0,f.BI)(this)}getLabelExpressionSingleField(){return(0,f.rU)(this)}hash(){return JSON.stringify(this)}clone(){return new g({allowOverrun:this.allowOverrun,deconflictionStrategy:this.deconflictionStrategy,labelExpression:this.labelExpression,labelExpressionInfo:(0,l.o8)(this.labelExpressionInfo),labelPosition:this.labelPosition,labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,repeatLabel:this.repeatLabel,repeatLabelDistance:this.repeatLabelDistance,symbol:(0,l.o8)(this.symbol),where:this.where,useCodedValues:this.useCodedValues})}};(0,i._)([(0,c.MZ)({type:String,json:{write:!0}})],x.prototype,"name",void 0),(0,i._)([(0,c.MZ)({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1},"portal-item":{default:!1,write:{overridePolicy:S}}}}})],x.prototype,"allowOverrun",void 0),(0,i._)([(0,c.MZ)({type:String,json:{write:!0,default:"static",origins:{"web-scene":{write:!1},"portal-item":{default:"static",write:{overridePolicy:S}}}}})],x.prototype,"deconflictionStrategy",void 0),(0,i._)([(0,c.MZ)({type:String,json:{write:{overridePolicy(e,t,r){return this.labelExpressionInfo&&"service"===r?.origin&&M(r.layer)?{enabled:!1}:{allowNull:!0}}}}})],x.prototype,"labelExpression",void 0),(0,i._)([(0,p.w)("labelExpression")],x.prototype,"readLabelExpression",null),(0,i._)([(0,h.K)("labelExpression")],x.prototype,"writeLabelExpression",null),(0,i._)([(0,c.MZ)({type:m,json:{write:{overridePolicy:(e,t,r)=>function(e){return I(e)||M(e?.layer)}(r)?{allowNull:!0}:{enabled:!1}}}})],x.prototype,"labelExpressionInfo",void 0),(0,i._)([(0,h.K)("labelExpressionInfo")],x.prototype,"writeLabelExpressionInfo",null),(0,i._)([(0,c.MZ)({type:b.apiValues,json:{type:b.jsonValues,read:b.read,write:b.write}})],x.prototype,"labelPlacement",void 0),(0,i._)([(0,c.MZ)({type:["curved","parallel"],json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1},"portal-item":{write:!1}}}})],x.prototype,"labelPosition",void 0),(0,i._)([(0,c.MZ)({type:Number})],x.prototype,"maxScale",void 0),(0,i._)([(0,h.K)("maxScale")],x.prototype,"writeMaxScale",null),(0,i._)([(0,c.MZ)({type:Number})],x.prototype,"minScale",void 0),(0,i._)([(0,h.K)("minScale")],x.prototype,"writeMinScale",null),(0,i._)([(0,c.MZ)({type:Boolean,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:S}}}}})],x.prototype,"repeatLabel",void 0),(0,i._)([(0,c.MZ)({type:Number,cast:u.cr,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:S}}}}})],x.prototype,"repeatLabelDistance",void 0),(0,i._)([(0,c.MZ)({types:s.em,json:{origins:{"web-scene":{types:s.Rv,write:v.oO,default:null}},write:v.oO,default:null}})],x.prototype,"symbol",void 0),(0,i._)([(0,c.MZ)({type:Boolean,json:{write:!0}})],x.prototype,"useCodedValues",void 0),(0,i._)([(0,c.MZ)({type:String,json:{write:!0}})],x.prototype,"where",void 0),x=g=(0,i._)([(0,d.$)("esri.layers.support.LabelClass")],x);const F=x},75803:function(e,t,r){r.d(t,{A:function(){return c}});var n,i=r(53804),s=r(78879),o=r(30905),a=r(23502),l=(r(58941),r(40633),r(13798),r(65953));let u=n=class extends o.oY{constructor(e){super(e),this.floorField=null,this.viewAllMode=!1,this.viewAllLevelIds=new s.A}clone(){return new n({floorField:this.floorField,viewAllMode:this.viewAllMode,viewAllLevelIds:this.viewAllLevelIds})}};(0,i._)([(0,a.MZ)({type:String,json:{write:!0}})],u.prototype,"floorField",void 0),(0,i._)([(0,a.MZ)({json:{read:!1,write:!1}})],u.prototype,"viewAllMode",void 0),(0,i._)([(0,a.MZ)({json:{read:!1,write:!1}})],u.prototype,"viewAllLevelIds",void 0),u=n=(0,i._)([(0,l.$)("esri.layers.support.LayerFloorInfo")],u);const c=u},41165:function(e,t,r){r.d(t,{A:function(){return p}});var n,i=r(53804),s=r(73037),o=r(30905),a=r(23502),l=(r(58941),r(40633),r(13798),r(65953));const u=new s.J({asc:"ascending",desc:"descending"});let c=n=class extends o.oY{constructor(e){super(e),this.field=null,this.valueExpression=null,this.order="ascending"}clone(){return new n({field:this.field,valueExpression:this.valueExpression,order:this.order})}};(0,i._)([(0,a.MZ)({type:String,json:{write:!0}})],c.prototype,"field",void 0),(0,i._)([(0,a.MZ)({type:String,json:{write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],c.prototype,"valueExpression",void 0),(0,i._)([(0,a.MZ)({type:u.apiValues,json:{type:u.jsonValues,read:u.read,write:u.write}})],c.prototype,"order",void 0),c=n=(0,i._)([(0,l.$)("esri.layers.support.OrderByInfo")],c);const p=c},90864:function(e,t,r){r.d(t,{A:function(){return d}});var n=r(53804),i=r(75743),s=r(73037),o=r(30905),a=r(23502),l=(r(58941),r(40633),r(13798),r(65953));const u=new s.J({esriRelCardinalityOneToOne:"one-to-one",esriRelCardinalityOneToMany:"one-to-many",esriRelCardinalityManyToMany:"many-to-many"}),c=new s.J({esriRelRoleOrigin:"origin",esriRelRoleDestination:"destination"});let p=class extends((0,i.O)(o.oY)){constructor(e){super(e),this.cardinality=null,this.composite=null,this.id=null,this.keyField=null,this.keyFieldInRelationshipTable=null,this.name=null,this.relatedTableId=null,this.relationshipTableId=null,this.role=null}};(0,n._)([(0,a.MZ)({json:{read:u.read,write:u.write}})],p.prototype,"cardinality",void 0),(0,n._)([(0,a.MZ)({json:{read:!0,write:!0}})],p.prototype,"composite",void 0),(0,n._)([(0,a.MZ)({json:{read:!0,write:!0}})],p.prototype,"id",void 0),(0,n._)([(0,a.MZ)({json:{read:!0,write:!0}})],p.prototype,"keyField",void 0),(0,n._)([(0,a.MZ)({json:{read:!0,write:!0}})],p.prototype,"keyFieldInRelationshipTable",void 0),(0,n._)([(0,a.MZ)({json:{read:!0,write:!0}})],p.prototype,"name",void 0),(0,n._)([(0,a.MZ)({json:{read:!0,write:!0}})],p.prototype,"relatedTableId",void 0),(0,n._)([(0,a.MZ)({json:{read:!0,write:!0}})],p.prototype,"relationshipTableId",void 0),(0,n._)([(0,a.MZ)({json:{read:c.read,write:c.write}})],p.prototype,"role",void 0),p=(0,n._)([(0,l.$)("esri.layers.support.Relationship")],p);const d=p},36143:function(e,t,r){r.d(t,{A:function(){return y}});var n=r(53804),i=r(75743),s=r(30905),o=r(23502),a=(r(58941),r(40633),r(13798),r(47332)),l=r(65953),u=r(81392),c=r(52038),p=r(92427),d=r(21168);function h(e,t){return p.A.fromJSON({value:e,unit:t})}let f=class extends((0,i.O)(s.oY)){constructor(e){super(e),this.cumulative=!1,this.endField=null,this.fullTimeExtent=null,this.hasLiveData=!1,this.interval=null,this.startField=null,this.timeZone=null,this.trackIdField=null,this.useTime=!0,this.stops=null}readFullTimeExtent(e,t){return t.timeExtent&&Array.isArray(t.timeExtent)&&2===t.timeExtent.length?c.A.fromArray(t.timeExtent):null}writeFullTimeExtent(e,t){null!=e?.start&&null!=e.end?t.timeExtent=e.toArray():t.timeExtent=null}readInterval(e,t){return t.timeInterval&&t.timeIntervalUnits?h(t.timeInterval,t.timeIntervalUnits):t.defaultTimeInterval&&t.defaultTimeIntervalUnits?h(t.defaultTimeInterval,t.defaultTimeIntervalUnits):null}writeInterval(e,t){t.timeInterval=e?.toJSON().value??null,t.timeIntervalUnits=e?.toJSON().unit??null}};(0,n._)([(0,o.MZ)({type:Boolean,json:{name:"exportOptions.timeDataCumulative",write:!0}})],f.prototype,"cumulative",void 0),(0,n._)([(0,o.MZ)({type:String,json:{name:"endTimeField",write:{enabled:!0,allowNull:!0}}})],f.prototype,"endField",void 0),(0,n._)([(0,o.MZ)({type:c.A,json:{write:{enabled:!0,allowNull:!0}}})],f.prototype,"fullTimeExtent",void 0),(0,n._)([(0,a.w)("fullTimeExtent",["timeExtent"])],f.prototype,"readFullTimeExtent",null),(0,n._)([(0,u.K)("fullTimeExtent")],f.prototype,"writeFullTimeExtent",null),(0,n._)([(0,o.MZ)({type:Boolean,json:{write:!0}})],f.prototype,"hasLiveData",void 0),(0,n._)([(0,o.MZ)({type:p.A,json:{write:{enabled:!0,allowNull:!0}}})],f.prototype,"interval",void 0),(0,n._)([(0,a.w)("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],f.prototype,"readInterval",null),(0,n._)([(0,u.K)("interval")],f.prototype,"writeInterval",null),(0,n._)([(0,o.MZ)({type:String,json:{name:"startTimeField",write:{enabled:!0,allowNull:!0}}})],f.prototype,"startField",void 0),(0,n._)([(0,o.MZ)((0,d.P6)("timeReference",!0))],f.prototype,"timeZone",void 0),(0,n._)([(0,o.MZ)({type:String,json:{write:{enabled:!0,allowNull:!0}}})],f.prototype,"trackIdField",void 0),(0,n._)([(0,o.MZ)({type:Boolean,json:{name:"exportOptions.useTime",write:!0}})],f.prototype,"useTime",void 0),(0,n._)([(0,o.MZ)({type:[Date],json:{read:!1}})],f.prototype,"stops",void 0),f=(0,n._)([(0,l.$)("esri.layers.support.TimeInfo")],f);const y=f},93389:function(e,t,r){r.d(t,{Fi:function(){return c},HZ:function(){return g},Jf:function(){return m},LS:function(){return w},Wo:function(){return y},bd:function(){return _},cr:function(){return h},iz:function(){return d},qg:function(){return p},yG:function(){return f}});var n=r(90683),i=r(60534);const s={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",knowledgegraphserver:"KnowledgeGraphServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer","3dtilesserver":"3DTilesServer",videoserver:"VideoServer"},o=Object.values(s),a=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${o.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),l=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^/\\n]+)\\/(${o.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),u=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function c(e){return a.test(e)}function p(e){if(null==e)return null;const t=(0,n.An)(e),r=t?.path.match(a)||t?.path.match(l);if(!r)return null;const[,i,o,u,c]=r,p=o.indexOf("/");return{title:h(-1!==p?o.slice(p+1):o),serverType:s[u.toLowerCase()],sublayer:null!=c&&""!==c?parseInt(c,10):null,url:{path:i}}}function d(e){const t=(0,n.An)(e).path.match(u);return t?{serviceUrl:t[1],sublayerId:Number(t[2])}:null}function h(e){return(e=e.replaceAll(/\s*[/_]+\s*/g," "))[0].toUpperCase()+e.slice(1)}function f(e,t){const r=[];if(e){const t=p(e);null!=t&&t.title&&r.push(t.title)}if(t){const e=h(t);r.push(e)}if(2===r.length){if(r[0].toLowerCase().includes(r[1].toLowerCase()))return r[0];if(r[1].toLowerCase().includes(r[0].toLowerCase()))return r[1]}return r.join(" - ")}function y(e){let t=(0,n.$z)(e,!0);return!!t&&(t=t.toLowerCase(),t.endsWith(".arcgis.com")&&(t.startsWith("services")||t.startsWith("tiles")||t.startsWith("features")))}function m(e,t){return e?(0,n.UC)((0,n.zi)(e,t)):e}function g(e){let{url:t}=e;if(!t)return{url:t};t=(0,n.zi)(t,e.logger);const r=(0,n.An)(t),i=p(r.path);let s;if(null!=i)null!=i.sublayer&&null==e.layer.layerId&&(s=i.sublayer),t=i.url.path;else if(e.nonStandardUrlAllowed){const e=d(r.path);null!=e&&(t=e.serviceUrl,s=e.sublayerId)}return{url:(0,n.UC)(t),layerId:s}}function w(e,t,r,s,o){(0,i.w)(t,s,"url",o),s.url&&null!=e.layerId&&(s.url=(0,n.fj)(s.url,r,e.layerId.toString()))}function _(e){if(!e)return!1;const t=e.toLowerCase(),r=t.includes("/services/"),n=t.includes("/mapserver/wmsserver"),i=t.includes("/imageserver/wmsserver"),s=t.includes("/wmsserver");return r&&(n||i||s)}},7010:function(e,t,r){r.d(t,{C1:function(){return M},Fm:function(){return v},Ih:function(){return _},M6:function(){return p},OZ:function(){return h},PY:function(){return c},Qo:function(){return m},Yj:function(){return y},fV:function(){return f},hG:function(){return I},hn:function(){return S},id:function(){return b},kF:function(){return d},ke:function(){return w},zQ:function(){return x}});var n=r(64786),i=r(91484),s=r(57165),o=r(60534),a=r(6422),l=r(92777),u=r(59798);const c={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:{enabled:!0,layerContainerTypes:n.K}}},p={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(e,t)=>!t.disablePopup},write:{enabled:!0,writer(e,t,r){t[r]=!e}}}},d={type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",write:{enabled:!0,layerContainerTypes:n.K}}},h={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:o.w}}},f={type:Boolean,value:!0,nonNullable:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:{enabled:!0,layerContainerTypes:n.K}}},y={value:null,type:a.A,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:{enabled:!0,layerContainerTypes:n.K}}};function m(e){return{type:e,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const g={write:{enabled:!0,layerContainerTypes:n.K},read:!0},w={type:Number,json:{origins:{"web-document":g,"portal-item":{write:!0}}}},_={...w,json:{...w.json,origins:{"web-document":{...g,write:{enabled:!0,layerContainerTypes:n.K,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}}},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(e,t,r)=>r&&"service"!==r.origin||!t.drawingInfo||void 0===t.drawingInfo.transparency?t.layerDefinition?.drawingInfo&&void 0!==t.layerDefinition.drawingInfo.transparency?(0,u.D)(t.layerDefinition.drawingInfo.transparency):void 0:(0,u.D)(t.drawingInfo.transparency)}}},v={type:i.default,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(e,t)=>{const r=i.default.fromJSON(e);return null!=t.spatialReference&&"object"==typeof t.spatialReference&&(r.spatialReference=s.A.fromJSON(t.spatialReference)),r}}}},read:!1}},b={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},S={type:Number,json:{origins:{service:{write:{enabled:!1}},"web-scene":{name:"layerDefinition.minScale",write:{enabled:!0,layerContainerTypes:n.K}}},name:"layerDefinition.minScale",write:!0}},I={type:Number,json:{origins:{service:{write:{enabled:!1}},"web-scene":{name:"layerDefinition.maxScale",write:{enabled:!0,layerContainerTypes:n.K}}},name:"layerDefinition.maxScale",write:!0}},M={json:{write:{ignoreOrigin:!0,layerContainerTypes:n.K},origins:{"web-map":{read:!1,write:!1}}}},x={type:l.A,json:{name:"attributeTableInfo",write:!0,origins:{"web-scene":{read:!1,write:!1}}}}},23217:function(e,t,r){r.d(t,{Xl:function(){return I},ct:function(){return F},pc:function(){return z},hx:function(){return G},C$:function(){return J},PD:function(){return H},VZ:function(){return P},mm:function(){return T},VA:function(){return $},WP:function(){return C},iX:function(){return S},Nv:function(){return U},xd:function(){return Y},GA:function(){return K},jp:function(){return D},tG:function(){return Q},lV:function(){return E},B5:function(){return R},Ye:function(){return O},sg:function(){return L},hM:function(){return k},S2:function(){return N},jD:function(){return Z},Zm:function(){return j},$4:function(){return V},Pt:function(){return X},bt:function(){return x},rn:function(){return A},ZJ:function(){return ee}});var n=r(7156),i=r(10748),s=r(77472),o=r(39819),a=r(73037),l=r(98737),u=r(66110),c=r(51575),p=r(4210),d=r(86038),h=r(7926);async function f(e,t,r){t=t.clone(),e.capabilities.query.supportsMaxRecordCountFactor&&(t.maxRecordCountFactor=y(e));const n=function(e){return y(e)*function(e){return e.capabilities.query.maxRecordCount||2e3}(e)}(e),i=e.capabilities.query.supportsPagination;t.start=0,t.num=n;let s=null;for(;;){const o=await e.source.queryFeaturesJSON(t,r);if(null==s?s=o:s.features=s.features.concat(o.features),s.exceededTransferLimit=o.exceededTransferLimit,!i||!o.exceededTransferLimit)break;t.start+=n}return s}function y(e){return e.capabilities.query.supportsMaxRecordCountFactor?h.A.MAX_MAX_RECORD_COUNT_FACTOR:1}var m=r(53743),g=r(11432),w=r(27777),_=r(61065),v=r(42783),b=r(95470);const S=new a.J({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"});async function I(e,t,r,n){const i=await B(e);if(await M(e,t,n),!i.addAttachment)throw new o.A(n,"Layer source does not support addAttachment capability");return i.addAttachment(t,r)}function M(e,t,r){const{attributes:n}=t,{objectIdField:i}=e;return e.capabilities?.data?.supportsAttachment?t?n?i&&n[i]?Promise.resolve():Promise.reject(new o.A(r,`feature is missing the identifying attribute ${i}`)):Promise.reject(new o.A(r,"'attributes' are required on a feature to query attachments")):Promise.reject(new o.A(r,"A feature is required to add/delete/update attachments")):Promise.reject(new o.A(r,"this layer doesn't support attachments"))}async function x(e,t,r,n,i){const s=await B(e);if(await M(e,t,i),!s.updateAttachment)throw new o.A(i,"Layer source does not support updateAttachment capability");return s.updateAttachment(t,r,n)}async function F(e,t,n){const{applyEdits:i}=await r.e(8104).then(r.bind(r,30269)),s=await e.load();let o=n;return"feature"===s.type&&s.infoFor3D&&null!=t.deleteFeatures&&null!=s.globalIdField&&(o={...o,globalIdToObjectId:await K(s,t.deleteFeatures,s.globalIdField)}),i(s,s.source,t,n)}async function A(e,t,n){const{uploadAssets:i}=await r.e(8104).then(r.bind(r,30269)),s=await e.load();return i(s,s.source,t,n)}async function T(e,t,r,n){const i=await B(e);if(await M(e,t,n),!i.deleteAttachments)throw new o.A(n,"Layer source does not support deleteAttachments capability");return i.deleteAttachments(t,r)}async function C(e,t,r){const n=(await e.load({signal:t?.signal})).source;if(!n.fetchRecomputedExtents)throw new o.A(r,"Layer source does not support fetchUpdates capability");return n.fetchRecomputedExtents(t)}async function E(e,t,r,n){t=v.A.from(t),await e.load();const i=e.source,s=e.capabilities;if(!s?.data?.supportsAttachment)throw new o.A(n,"this layer doesn't support attachments");const{attachmentTypes:a,objectIds:l,globalIds:u,num:c,size:p,start:d,where:h}=t;if(!s?.operations?.supportsQueryAttachments&&(a?.length>0||u?.length>0||p?.length>0||c||d||h))throw new o.A(n,"when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported",t);if(!(l?.length||u?.length||h))throw new o.A(n,"'objectIds', 'globalIds', or 'where' are required to perform attachment query",t);if(!i.queryAttachments)throw new o.A(n,"Layer source does not support queryAttachments capability",t);return i.queryAttachments(t)}async function L(e,t,r,n){const i=await B(e);if(!i.queryObjectIds)throw new o.A(n,"Layer source does not support queryObjectIds capability");return i.queryObjectIds(h.A.from(t)??e.createQuery(),r)}async function O(e,t,r,n){const i=await B(e);if(!i.queryFeatureCount)throw new o.A(n,"Layer source does not support queryFeatureCount capability");return i.queryFeatureCount(h.A.from(t)??e.createQuery(),r)}async function R(e,t,r,n){const i=await B(e);if(!i.queryExtent)throw new o.A(n,"Layer source does not support queryExtent capability");return i.queryExtent(h.A.from(t)??e.createQuery(),r)}async function k(e,t,r,n){const i=await B(e);if(!i.queryRelatedFeatures)throw new o.A(n,"Layer source does not support queryRelatedFeatures capability");return i.queryRelatedFeatures(b.default.from(t),r)}async function N(e,t,r,n){const i=await B(e);if(!i.queryRelatedFeaturesCount)throw new o.A(n,"Layer source does not support queryRelatedFeaturesCount capability");return i.queryRelatedFeaturesCount(b.default.from(t),r)}async function D(e){const t=e.source;if(t?.refresh)try{const{dataChanged:r,updates:n}=await t.refresh();if(null!=n&&(e.sourceJSON={...e.sourceJSON,...n},e.read(n,{origin:"service",url:e.parsedUrl})),r)return!0}catch{}if(e.definitionExpression)try{return(await(0,l.G)(e.definitionExpression,e.fieldsIndex)).hasDateFunctions}catch{}return!1}function P(e){const t=new h.A,r=e.capabilities?.data,n=e.capabilities?.query;t.historicMoment=e.historicMoment,t.gdbVersion=e.gdbVersion,t.returnGeometry=!0,n&&(t.compactGeometryEnabled=n.supportsCompactGeometry,t.defaultSpatialReferenceEnabled=n.supportsDefaultSpatialReference),r&&(r.supportsZ&&null!=e.returnZ&&(t.returnZ=e.returnZ),r.supportsM&&null!=e.returnM&&(t.returnM=e.returnM)),t.outFields=["*"];const{timeOffset:i,timeExtent:s}=e;return t.timeExtent=null!=i&&null!=s?s.offset(-i.value,i.unit):s||null,t.multipatchOption="multipatch"===e.geometryType?"xyFootprint":null,t}function Z(e){const{globalIdField:t,fields:r}=e;if(t)return t;if(r)for(const e of r)if("esriFieldTypeGlobalID"===e.type)return e.name}function j(e){const{objectIdField:t,fields:r}=e;if(t)return t;if(r)for(const e of r)if("esriFieldTypeOID"===e.type)return e.name}function V(e){return e.currentVersion?e.currentVersion:e.hasOwnProperty("capabilities")||e.hasOwnProperty("drawingInfo")||e.hasOwnProperty("hasAttachments")||e.hasOwnProperty("htmlPopupType")||e.hasOwnProperty("relationships")||e.hasOwnProperty("timeInfo")||e.hasOwnProperty("typeIdField")||e.hasOwnProperty("types")?10:9.3}function U(e,t){const{subtypes:r,subtypeField:n}=e;if(!t?.attributes||!r?.length||!n)return null;const i=t.attributes[n];return null==i?null:r.find((e=>e.code===i))}function z(e,t){const{fieldsIndex:r,subtypeField:n}=e,{name:i,type:s}=r.get(t)??{};if(!i)return null;if((n&&r.get(n)?.name)===i&&e.subtypes?.length){const t=e.subtypes.map((e=>new p.H({code:q(e.code,s),name:e.name})));if(t?.length)return new d.A({codedValues:t})}return null}function G(e,t){const{fieldsIndex:r}=e,{name:n,type:i}=r.get(t)??{};if(!n)return null;if(("typeIdField"in e?r.get(e.typeIdField)?.name:null)===n&&"types"in e&&e.types?.length){const t=e.types.map((e=>new p.H({code:q(e.id,i),name:e.name})));return new d.A({codedValues:t})}return null}function q(e,t){return t?(0,m.yM)({type:t})&&"number"==typeof e?`${e}`:(0,m.R3)({type:t})&&"string"==typeof e?Number.parseInt(e,10):e:e}async function B(e){return(await e.load()).source}async function $(e,t,r){const i=e.parsedUrl?.path;i&&e.authenticationTriggerEvent===t&&await async function(e,t){if(!n.id)return;if(n.id.findCredential(e))return;let r;try{const i=await(0,g.wI)(e,t);i&&(r=await n.id.checkSignInStatus(`${i}/sharing`))}catch(e){}if(r)try{const r=null!=t?t.signal:null;await n.id.getCredential(e,{signal:r})}catch(e){}}(i,r)}function J(e){return!X(e)&&(e.userHasUpdateItemPrivileges||e.editingEnabled)}const W=(0,c.C)({types:i.xK});function H(e,t){if(e.defaultSymbol)return e.types?.length?new _.A({defaultSymbol:W(e.defaultSymbol,e,t),field:e.typeIdField,uniqueValueInfos:e.types.map((e=>({id:e.id,symbol:W(e.symbol,e,t)})))}):new w.A({symbol:W(e.defaultSymbol,e,t)})}function Q(e){let t=e.sourceJSON?.cacheMaxAge;if(!t)return!1;const r=e.editingInfo?.lastEditDate?.getTime();return null==r||(t*=1e3,Date.now()-r<t)}async function K(e,t,r){if(null==t)return null;const n=[],{objectIdField:i}=e;if(t.forEach((e=>{let t=null;if("attributes"in e){const{attributes:n}=e;t={globalId:n[r],objectId:null!=n[i]&&-1!==n[i]?n[i]:null}}else t={globalId:e.globalId,objectId:null!=e.objectId&&-1!==e.objectId?e.objectId:null};null!=t.globalId&&(null!=t.objectId&&-1!==t.objectId||n.push(t.globalId))})),0===n.length)return null;const o=e.createQuery();o.where=n.map((e=>`${r}='${e}'`)).join(" OR "),o.returnGeometry=!1,o.outFields=[i,r],o.cacheHint=!1;const a=await(0,s.DZ)(f(e,o));if(!a.ok)return null;const l=new Map,c=a.value.features;for(const e of c){const t=e.attributes[r],n=e.attributes[i];null!=t&&null!=n&&-1!==n&&l.set((0,u.AG)(t),n)}return l}function Y(e,t,r){if(!t||!r||!e)return null;const n=r.getAttribute(t);return null==n?null:e.find((e=>{const{id:t}=e;return null!=t&&t.toString()===n.toString()}))??null}function X(e){return e.sourceJSON?.isMultiServicesView||function(e){return!!e.sourceJSON?.capabilities?.toLowerCase().split(",").map((e=>e.trim())).includes("map")}(e)}function ee(e,t,r){const n=t?.queryBins;if(!n)throw new o.A(r,"Layer source does not support binning");switch(e.binParameters.type){case"auto-interval":if(!n.supportsAutoInterval)throw new o.A(r,"Layer source does not support auto-interval binning");break;case"date":if(!n.supportsDate)throw new o.A(r,"Layer source does not support date binning");break;case"fixed-boundaries":if(!n.supportsFixedBoundaries)throw new o.A(r,"Layer source does not support fixed-boundaries binning");break;case"fixed-interval":if(!n.supportsFixedInterval)throw new o.A(r,"Layer source does not support fixed-interval binning")}const i=n?.supportedStatistics;if(e.outStatistics&&i){const t=new Map([["count","count"],["sum","sum"],["min","min"],["max","max"],["avg","avg"],["stddev","stddev"],["var","var"],["percentile-continuous","percentileContinuous"],["percentile-discrete","percentileDiscrete"],["centroid-aggregate","centroid"],["convex-hull-aggregate","convexHull"],["envelope-aggregate","envelope"]]);for(const{statisticType:n}of e.outStatistics){const e=t.get(n);if(e&&!i[e])throw new o.A(r,`Layer source does not support ${n} statistic type`)}}}},93966:function(e,t,r){r.d(t,{d:function(){return k}});var n,i=r(64786),s=r(84189),o=r(53804),a=r(90473),l=(r(74865),r(1526),r(96173),r(52308),r(78002),r(30047),r(27777)),u=(r(61065),r(6537)),c=r(31315),p=r(21609),d=r(34194),h=r(13520),f=r(23502),y=r(67888),m=r(74376),g=r(47332),w=r(65953),_=r(81392),v=r(39763),b=r(7010),S=r(23217),I=r(73520);let M=n=class extends s.c{constructor(e){super(e),this.type="binning",this.binType="geohash",this.fixedBinLevel=null,this.labelingInfo=null,this.labelsVisible=!0,this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.size=(0,h.cr)("12px"),this.fields=[],this.renderer=null}writeFields(e,t,r){const n=e.filter((e=>"avg_angle"!==e.statisticType)).map((e=>e.toJSON()));(0,d.sM)(r,n,t)}readRenderer(e,t,r){const n=t.drawingInfo?.renderer;return n?(0,u.L)(n,t,r)??void 0:(0,S.PD)(t,r)}clone(){return new n({fields:(0,p.o8)(this.fields),fixedBinLevel:this.fixedBinLevel,labelingInfo:(0,p.o8)(this.labelingInfo),labelsVisible:this.labelsVisible,maxScale:this.maxScale,popupEnabled:this.popupEnabled,popupTemplate:(0,p.o8)(this.popupTemplate),renderer:(0,p.o8)(this.renderer),binType:(0,p.o8)(this.binType),size:this.size})}};(0,o._)([(0,m.e)({binning:"binning"})],M.prototype,"type",void 0),(0,o._)([(0,m.e)({geohash:"geohash",square:"square"}),(0,f.MZ)({type:["geohash","square"]})],M.prototype,"binType",void 0),(0,o._)([(0,f.MZ)({type:Number,json:{write:!0}})],M.prototype,"fixedBinLevel",void 0),(0,o._)([(0,f.MZ)({type:[I.A],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],M.prototype,"labelingInfo",void 0),(0,o._)([(0,f.MZ)(b.kF)],M.prototype,"labelsVisible",void 0),(0,o._)([(0,f.MZ)({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],M.prototype,"maxScale",void 0),(0,o._)([(0,f.MZ)(b.M6)],M.prototype,"popupEnabled",void 0),(0,o._)([(0,f.MZ)({type:a.A,json:{name:"popupInfo",write:!0}})],M.prototype,"popupTemplate",void 0),(0,o._)([(0,f.MZ)({cast:e=>"auto"===e?e:(0,y.GB)((0,h.cr)(e))})],M.prototype,"size",void 0),(0,o._)([(0,f.MZ)({type:[v.A],json:{write:!0}})],M.prototype,"fields",void 0),(0,o._)([(0,_.K)("fields")],M.prototype,"writeFields",null),(0,o._)([(0,f.MZ)({types:c.H,json:{write:{target:"drawingInfo.renderer"}}})],M.prototype,"renderer",void 0),(0,o._)([(0,g.w)("renderer",["drawingInfo.renderer"])],M.prototype,"readRenderer",null),M=n=(0,o._)([(0,w.$)("esri.layers.support.FeatureReductionBinning")],M);const x=M;var F,A=r(10748),T=r(30905);function C(e){return"simple"===e.type&&!e.visualVariables?.length}let E=F=class extends T.oY{constructor(e){super(e),this.type="cluster",this.clusterRadius=(0,h.cr)("80px"),this.clusterMinSize=(0,h.cr)("12px"),this.clusterMaxSize=(0,h.cr)("50px"),this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.renderer=null,this.symbol=null,this.labelingInfo=null,this.labelsVisible=!0,this.fields=[]}readRenderer(e,t,r){const n=t.drawingInfo?.renderer;return n?.authoringInfo?.isAutoGenerated?null:n?C(n)?null:(0,u.L)(n,t,r)??void 0:(0,S.PD)(t,r)}readSymbol(e,t,r){const n=t.drawingInfo?.renderer;if(n?.authoringInfo?.isAutoGenerated)return null;if(n&&C(n)){const e=(0,u.L)(n,t,r);return e?.symbol}return null}writeSymbol(e,t,r,n){const i=this.renderer?.authoringInfo?.isAutoGenerated;if(!this.renderer||i){const r=new l.A({symbol:e});t.drawingInfo={renderer:r.write({},n)}}}writeFields(e,t,r){const n=e.filter((e=>"avg_angle"!==e.statisticType)).map((e=>e.toJSON()));(0,d.sM)(r,n,t)}readFields(e,t,r){return e.filter((e=>!e.isAutoGenerated)).map((e=>v.A.fromJSON(e)))}clone(){return new F({clusterRadius:this.clusterRadius,clusterMinSize:this.clusterMinSize,clusterMaxSize:this.clusterMaxSize,labelingInfo:(0,p.o8)(this.labelingInfo),labelsVisible:this.labelsVisible,fields:(0,p.o8)(this.fields),maxScale:this.maxScale,renderer:(0,p.o8)(this.renderer),symbol:(0,p.o8)(this.symbol),popupEnabled:this.popupEnabled,popupTemplate:(0,p.o8)(this.popupTemplate)})}};(0,o._)([(0,f.MZ)({type:["cluster"],readOnly:!0,json:{write:!0}})],E.prototype,"type",void 0),(0,o._)([(0,f.MZ)({cast:e=>"auto"===e?e:(0,y.GB)((0,h.cr)(e)),json:{write:!0}})],E.prototype,"clusterRadius",void 0),(0,o._)([(0,f.MZ)({type:Number,cast:h.cr,json:{write:!0}})],E.prototype,"clusterMinSize",void 0),(0,o._)([(0,f.MZ)({type:Number,cast:h.cr,json:{write:!0}})],E.prototype,"clusterMaxSize",void 0),(0,o._)([(0,f.MZ)({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],E.prototype,"maxScale",void 0),(0,o._)([(0,f.MZ)(b.M6)],E.prototype,"popupEnabled",void 0),(0,o._)([(0,f.MZ)({type:a.A,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],E.prototype,"popupTemplate",void 0),(0,o._)([(0,f.MZ)({types:c.H,json:{write:{target:"drawingInfo.renderer"}}})],E.prototype,"renderer",void 0),(0,o._)([(0,g.w)("renderer",["drawingInfo.renderer"])],E.prototype,"readRenderer",null),(0,o._)([(0,f.MZ)({types:A.q8})],E.prototype,"symbol",void 0),(0,o._)([(0,g.w)("symbol",["drawingInfo.renderer"])],E.prototype,"readSymbol",null),(0,o._)([(0,_.K)("symbol")],E.prototype,"writeSymbol",null),(0,o._)([(0,f.MZ)({type:[I.A],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],E.prototype,"labelingInfo",void 0),(0,o._)([(0,f.MZ)(b.kF)],E.prototype,"labelsVisible",void 0),(0,o._)([(0,f.MZ)({type:[v.A],json:{write:!0}})],E.prototype,"fields",void 0),(0,o._)([(0,_.K)("fields")],E.prototype,"writeFields",null),(0,o._)([(0,g.w)("fields")],E.prototype,"readFields",null),E=F=(0,o._)([(0,w.$)("esri.layers.support.FeatureReductionCluster")],E);const L=E;var O=r(82043);const R={key:"type",base:s.c,typeMap:{cluster:L,binning:x}},k={types:{key:"type",base:s.c,typeMap:{selection:O.A,cluster:L,binning:x}},json:{name:"layerDefinition.featureReduction",write:{allowNull:!0},origins:{"web-map":{types:R},"portal-item":{types:R},"web-scene":{types:{key:"type",base:s.c,typeMap:{selection:O.A}},name:"layerDefinition.featureReduction",write:{layerContainerTypes:i.K}}}}}},36073:function(e,t,r){r.d(t,{p:function(){return l}});var n=r(58941),i=r(40633),s=r(56740),o=r(7103),a=r(53743);function l(){return{fields:{type:[s.A],value:null,set:function(e){if(e&&(0,n.A)("big-integer-warning-enabled")){const t=e.filter((e=>"big-integer"===e.type||"oid"===e.type&&(e.length||0)>=8));if(t.length){const e=t.map((e=>`'${e.name}'`)).join(", ");i.A.getLogger(this).warn("#fields",`Layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}') references big-integer field(s): ${e}, support for which is experimental. Only integers less than ${Number.MAX_SAFE_INTEGER} (Number.MAX_SAFE_INTEGER) are supported.`)}}this._set("fields",e)}},fieldsIndex:{readOnly:!0,get(){return o.A.fromLayer(this)}},outFields:{type:[String],json:{read:!1},set:function(e){this._userOutFields=e,this.notifyChange("outFields")},get:function(){const e=this._userOutFields;if(!e?.length)return null;if(e.includes("*"))return["*"];if(!this.fields)return e;for(const t of e){const r=this.fieldsIndex?.has(t);r||i.A.getLogger("esri.layers.support.fieldProperties").error("field-attributes-layer:invalid-field",`Invalid field ${t} found in outFields`,{layer:this,outFields:e})}return(0,a.DB)(this.fieldsIndex,e)}}}}},6361:function(e,t,r){r.d(t,{BI:function(){return m},D3:function(){return f},XJ:function(){return y},lc:function(){return h},mX:function(){return w},rU:function(){return g},tH:function(){return I}});var n=r(50944);const i="__begin__",s="__end__",o=new RegExp(i,"ig"),a=new RegExp(s,"ig"),l=new RegExp("^"+i,"i"),u=new RegExp(s+"$","i"),c='"',p=c+" + ",d=" + "+c;function h(e){return e.replaceAll(new RegExp("\\[","g"),"{").replaceAll(new RegExp("\\]","g"),"}")}function f(e){return e.replaceAll(new RegExp("\\{","g"),"[").replaceAll(new RegExp("\\}","g"),"]")}function y(e){const t={expression:"",type:"none"};return e.labelExpressionInfo?e.labelExpressionInfo.value?(t.expression=e.labelExpressionInfo.value,t.type="conventional"):e.labelExpressionInfo.expression&&(t.expression=e.labelExpressionInfo.expression,t.type="arcade"):null!=e.labelExpression&&(t.expression=h(e.labelExpression),t.type="conventional"),t}function m(e){const t=y(e);if(!t)return null;switch(t.type){case"conventional":return w(t.expression);case"arcade":return t.expression}return null}function g(e){const t=y(e);if(!t)return null;switch(t.type){case"conventional":return function(e){const t=e?.match(_);return t?.[1].trim()||null}(t.expression);case"arcade":return I(t.expression)}return null}function w(e){let t;return e?(t=(0,n.HC)(e,(e=>i+'$feature["'+e+'"]'+s)),t=l.test(t)?t.replace(l,""):c+t,t=u.test(t)?t.replace(u,""):t+c,t=t.replaceAll(o,p).replaceAll(a,d)):t='""',t}const _=/^\s*\{([^}]+)\}\s*$/i,v=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])(.+)(\2)\]));?\s*$/i,b=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])(.+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,S=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(.+)(\1)\s*\));?\s*$/i;function I(e){if(!e)return null;let t=v.exec(e)||b.exec(e);return t?t[1]||t[3]:(t=S.exec(e),t?t[2]:null)}},79212:function(e,t,r){r.d(t,{w:function(){return l},z:function(){return c}});var n=r(39819),i=r(40633),s=r(73520);const o=()=>i.A.getLogger("esri.layers.support.labelingInfo"),a=/\[([^[\]]+)\]/gi;function l(e,t,r){return e?e.map((e=>{const n=new s.A;if(n.read(e,r),n.labelExpression){const e=t.fields||t.layerDefinition?.fields||this.fields;n.labelExpression=n.labelExpression.replaceAll(a,((t,r)=>`[${function(e,t){if(!t)return e;const r=e.toLowerCase();for(let e=0;e<t.length;e++){const n=t[e].name;if(n.toLowerCase()===r)return n}return e}(r,e)}]`))}return n})):null}const u={esriGeometryPoint:["above-right","above-center","above-left","center-center","center-left","center-right","below-center","below-left","below-right"],esriGeometryMultiPatch:["always-horizontal"],esriGeometryPolygon:["always-horizontal"],esriGeometryPolyline:["center-along","above-along","below-along"],esriGeometryMultipoint:null,esriGeometryEnvelope:null};function c(e,t){const r=[];for(const i of e){const e=i.labelPlacement,s=u[t];if(!i.symbol)return o().warn("No ILabelClass symbol specified."),[];if(!s)return o().error(new n.A("labeling:unsupported-geometry-type",`Unable to create labels for layer, geometry type '${t}' is not supported`)),[];if(s.includes(e))r.push(i);else{const n=s[0];e&&o().warn(`Found invalid label placement type ${e} for ${t}. Defaulting to ${n}`);const a=i.clone();a.labelPlacement=n,r.push(a)}}return r}},85002:function(e,t,r){r.d(t,{S:function(){return d},d:function(){return I}});var n=r(58941),i=r(93389);function s(e,t,r){return!!a(e,t,r)}function o(e,t,r){return a(e,t,r)}function a(e,t,r){return e&&e.hasOwnProperty(t)?e[t]:r}const l={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"};function u(e){const t=e?.supportedSpatialAggregationStatistics?.map((e=>e.toLowerCase()));return{envelope:!!t?.includes("envelopeaggregate"),centroid:!!t?.includes("centroidaggregate"),convexHull:!!t?.includes("convexhullaggregate")}}function c(e,t){const r=e?.supportedOperationsWithCacheHint?.map((e=>e.toLowerCase()));return!!r?.includes(t.toLowerCase())}function p(e){const t=e?.supportedStatisticTypes?.map((e=>e.toLowerCase()));return{count:!!t?.includes("count"),sum:!!t?.includes("sum"),min:!!t?.includes("min"),max:!!t?.includes("max"),avg:!!t?.includes("avg"),var:!!t?.includes("var"),stddev:!!t?.includes("stddev"),percentileContinuous:!!t?.includes("percentile_continuous"),percentileDiscrete:!!t?.includes("percentile_discrete"),envelope:!!t?.includes("envelopeaggregate"),centroid:!!t?.includes("centroidaggregate"),convexHull:!!t?.includes("convexhullaggregate")}}function d(e,t){return{analytics:h(e),attachment:f(e),data:y(e),metadata:m(e),operations:g(e.capabilities,e,t),query:w(e,t),queryBins:b(e),queryRelated:_(e),queryTopFeatures:v(e),editing:S(e)}}function h(e){return{supportsCacheHint:c(e.advancedQueryCapabilities,"queryAnalytics")}}function f(e){const t=e.attachmentProperties,r={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1,supportsCacheHint:c(e.advancedQueryCapabilities,"queryAttachments"),supportsResize:s(e,"supportsAttachmentsResizing",!1)};return t&&Array.isArray(t)&&t.forEach((e=>{const t=l[e.name];t&&(r[t]=!!e.isEnabled)})),r}function y(e){return{isVersioned:s(e,"isDataVersioned",!1),isBranchVersioned:s(e,"isDataBranchVersioned",!1),supportsAttachment:s(e,"hasAttachments",!1),supportsM:s(e,"hasM",!1),supportsZ:s(e,"hasZ",!1)}}function m(e){return{supportsAdvancedFieldProperties:s(e,"supportsFieldDescriptionProperty",!1)}}function g(e,t,r){const n=e?e.toLowerCase().split(",").map((e=>e.trim())):[],o=r?(0,i.qg)(r):null,a=n.includes(null!=o&&"MapServer"===o.serverType?"data":"query"),l=n.includes("editing")&&!t.datesInUnknownTimezone;let u=l&&n.includes("create"),c=l&&n.includes("delete"),p=l&&n.includes("update");const d=n.includes("changetracking"),h=t.advancedQueryCapabilities;return l&&!(u||c||p)&&(u=c=p=!0),{supportsCalculate:s(t,"supportsCalculate",!1),supportsTruncate:s(t,"supportsTruncate",!1),supportsValidateSql:s(t,"supportsValidateSql",!1),supportsAdd:u,supportsDelete:c,supportsEditing:l,supportsChangeTracking:d,supportsQuery:a,supportsQueryAnalytics:s(h,"supportsQueryAnalytic",!1),supportsQueryAttachments:s(h,"supportsQueryAttachments",!1),supportsQueryBins:s(h,"supportsQueryBins",!1),supportsQueryTopFeatures:s(h,"supportsTopFeaturesQuery",!1),supportsResizeAttachments:s(t,"supportsAttachmentsResizing",!1),supportsSync:n.includes("sync"),supportsUpdate:p,supportsExceedsLimitStatistics:s(t,"supportsExceedsLimitStatistics",!1),supportsAsyncConvert3D:s(t,"supportsAsyncConvert3D",!1)}}function w(e,t){const r=e.advancedQueryCapabilities,a=e.ownershipBasedAccessControlForFeatures,l=e.archivingInfo,p=e.currentVersion,d=t?.includes("MapServer"),h=!d||p>=(0,n.A)("mapserver-pbf-version-support"),f=(0,i.Wo)(t),y=new Set((e.supportedQueryFormats??"").split(",").map((e=>e.toLowerCase().trim())));return{maxRecordCount:o(e,"maxRecordCount",void 0),maxRecordCountFactor:o(e,"maxRecordCountFactor",void 0),standardMaxRecordCount:o(e,"standardMaxRecordCount",void 0),supportedSpatialAggregationStatistics:u(r),supportsCacheHint:s(r,"supportsQueryWithCacheHint",!1)||c(r,"query"),supportsCentroid:s(r,"supportsReturningGeometryCentroid",!1),supportsCompactGeometry:f,supportsDefaultSpatialReference:s(r,"supportsDefaultSR",!1),supportsDisjointSpatialRelationship:s(r,"supportsDisjointSpatialRel",!1),supportsDistance:s(r,"supportsQueryWithDistance",!1),supportsDistinct:s(r,"supportsDistinct",e.supportsAdvancedQueries),supportsExtent:s(r,"supportsReturningQueryExtent",!1),supportsFormatPBF:h&&y.has("pbf"),supportsFullTextSearch:s(r,"supportsFullTextSearch",!1),supportsGeometryProperties:s(r,"supportsReturningGeometryProperties",!1),supportsHavingClause:s(r,"supportsHavingClause",!1),supportsHistoricMoment:s(l,"supportsQueryWithHistoricMoment",!1),supportsMaxRecordCountFactor:s(r,"supportsMaxRecordCountFactor",!1),supportsOrderBy:s(r,"supportsOrderBy",e.supportsAdvancedQueries),supportsPagination:s(r,"supportsPagination",!1),supportsPercentileStatistics:s(r,"supportsPercentileStatistics",!1),supportsQuantization:s(e,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:s(e,"supportsQuantizationEditMode",!1),supportsQueryByAnonymous:s(a,"allowAnonymousToQuery",!0),supportsQueryByOthers:s(a,"allowOthersToQuery",!0),supportsQueryGeometry:s(e,"supportsReturningQueryGeometry",!1),supportsResultType:s(r,"supportsQueryWithResultType",!1),supportsSpatialAggregationStatistics:s(r,"supportsSpatialAggregationStatistics",!1),supportsSqlExpression:s(r,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:s(e,"useStandardizedQueries",!1),supportsStatistics:s(r,"supportsStatistics",e.supportsStatistics),supportsTopFeaturesQuery:s(r,"supportsTopFeaturesQuery",!1),tileMaxRecordCount:o(e,"tileMaxRecordCount",void 0)}}function _(e){const t=e.advancedQueryCapabilities,r=s(t,"supportsAdvancedQueryRelated",!1);return{supportsPagination:s(t,"supportsQueryRelatedPagination",!1),supportsCount:r,supportsOrderBy:r,supportsCacheHint:c(t,"queryRelated")}}function v(e){return{supportsCacheHint:c(e.advancedQueryCapabilities,"queryTopFilter")}}function b(e){const t=e?e.queryBinsCapabilities:void 0;return{supportsDate:s(t,"supportsDateBin",!1),supportsFixedInterval:s(t,"supportsFixedIntervalBin",!1),supportsAutoInterval:s(t,"supportsAutoIntervalBin",!1),supportsFixedBoundaries:s(t,"supportsFixedBoundariesBin",!1),supportedStatistics:p(t)}}function S(e){const t=e.ownershipBasedAccessControlForFeatures,r=e?e.advancedEditingCapabilities:void 0;return{supportsGeometryUpdate:s(e,"allowGeometryUpdates",!0),supportsGlobalId:s(e,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:s(e,"supportsReturnServiceEditsInSourceSR",!1),supportsRollbackOnFailure:s(e,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:s(e,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:s(e,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:s(t,"allowAnonymousToDelete",!0),supportsDeleteByOthers:s(t,"allowOthersToDelete",!0),supportsUpdateByAnonymous:s(t,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:s(t,"allowOthersToUpdate",!0),supportsAsyncApplyEdits:s(r,"supportsAsyncApplyEdits",!1),zDefault:o(e,"zDefault",void 0)}}function I(e){return{operations:{supportsAppend:s(e,"supportsAppend",!1),supportsCoverageQuery:e?.playbackInfo?.klv["0601"]??!1,supportsExportClip:s(e,"supportsExportClip",!1),supportsExportFrameset:s(e,"supportsExportFrameset",!1),supportsMensuration:s(e,"supportsMensuration",!1),supportsUpdate:s(e,"supportsUpdate",!1)}}}},61343:function(e,t,r){r.d(t,{D:function(){return s}});var n=r(93389);const i=[];function s(e,t){if((0,n.Wo)(e.url??""))return!0;const{wkid:r}=t;for(const t of i){if((e.version??0)>=t[0])return!0;if("function"==typeof t[1]&&(t[1]=t[1]()),t[1].has(r))return!1}return!0}i.push([10.91,()=>{const e=new Set([9709,9716,9741,9761,9766]);for(let t=9712;t<=9713;t++)e.add(t);for(let t=9748;t<=9749;t++)e.add(t);for(let t=20904;t<=20932;t++)e.add(t);for(let t=21004;t<=21032;t++)e.add(t);for(let t=21207;t<=21264;t++)e.add(t);for(let t=21307;t<=21364;t++)e.add(t);for(let t=23301;t<=23333;t++)e.add(t);for(let t=102759;t<=102760;t++)e.add(t);for(let t=102934;t<=102955;t++)e.add(t);return e}]),i.push([10.9,()=>{const e=new Set([9300,9354,9364,9367,9373,9377,9387,9456,9473,9498,9678,9680,29874,103599,103872,104028]);for(let t=9356;t<=9360;t++)e.add(t);for(let t=9404;t<=9407;t++)e.add(t);for(let t=9476;t<=9482;t++)e.add(t);for(let t=9487;t<=9494;t++)e.add(t);for(let t=9697;t<=9699;t++)e.add(t);return e}]),i.push([10.81,()=>{const e=new Set([9265,9333,103598,103699]);for(let t=9248;t<=9254;t++)e.add(t);for(let t=9271;t<=9273;t++)e.add(t);for(let t=9284;t<=9285;t++)e.add(t);for(let t=21453;t<=21463;t++)e.add(t);return e}]),i.push([10.8,()=>{const e=new Set([8088,8395,8428,8433,8531,8687,8692,8694,8699,8900,9003,9006,9009,9012,9017,9191]);for(let t=8035;t<=8036;t++)e.add(t);for(let t=8455;t<=8456;t++)e.add(t);for(let t=8518;t<=8529;t++)e.add(t);for(let t=8533;t<=8536;t++)e.add(t);for(let t=8538;t<=8540;t++)e.add(t);for(let t=8677;t<=8679;t++)e.add(t);for(let t=8902;t<=8903;t++)e.add(t);for(let t=8907;t<=8910;t++)e.add(t);for(let t=8949;t<=8951;t++)e.add(t);for(let t=8972;t<=8987;t++)e.add(t);for(let t=9039;t<=9040;t++)e.add(t);for(let t=9068;t<=9069;t++)e.add(t);for(let t=9140;t<=9141;t++)e.add(t);for(let t=9148;t<=9150;t++)e.add(t);for(let t=9153;t<=9159;t++)e.add(t);for(let t=9205;t<=9218;t++)e.add(t);for(let t=9221;t<=9222;t++)e.add(t);for(let t=54098;t<=54101;t++)e.add(t);return e}]),i.push([10.71,()=>{const e=new Set([6316]);for(let t=8351;t<=8353;t++)e.add(t);for(let t=9294;t<=9297;t++)e.add(t);for(let t=22619;t<=22621;t++)e.add(t);for(let t=103586;t<=103594;t++)e.add(t);return e}])},43173:function(e,t,r){r.r(t),r.d(t,{default:function(){return C}});var n=r(53804),i=r(53216),s=r(39819),o=r(30905),a=r(21609),l=r(31609),u=r(90683),c=r(23502),p=r(67888),d=r(47332),h=r(65953),f=r(91484),y=r(51432),m=r(83525),g=r(40633),w=r(77560);r(13798),r(58941);let _=class extends m.A{constructor(e){super(e),this.portalItem=null}normalizeCtorArgs(e){return e?.portalItem&&e.path?{...e,path:v(e.path,e.portalItem)}:e}set path(e){null!=e&&(0,u.oP)(e)?g.A.getLogger(this).error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",e)}_castPath(e){return v(e,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get cdnUrl(){return this.portalItem&&this.path?`${this.portalItem.itemCdnUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(e="json",t){const r=this.cdnUrl;if(null==r)throw new s.A("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal.request(r,{responseType:e,query:{token:this.portalItem.apiKey,_ts:t?.cacheBust?Date.now():null},signal:t?.signal})}async update(e,t){const{addOrUpdateResources:n}=await r.e(4460).then(r.bind(r,55597));return await n(this.portalItem,[{resource:this,content:e,compress:t?.compress,access:t?.access}],"update",t),this}hasPath(){return null!=this.path}};function v(e,t){return null==e?e:(e=e.replace(/^\/+/,""),null!=t&&(0,u.oP)(e)&&(e=(0,u.V1)(e,t.itemUrl)),e?.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}(0,n._)([(0,c.MZ)()],_.prototype,"portalItem",void 0),(0,n._)([(0,c.MZ)({type:String,value:null})],_.prototype,"path",null),(0,n._)([(0,w.w)("path")],_.prototype,"_castPath",null),(0,n._)([(0,c.MZ)({type:String,readOnly:!0})],_.prototype,"url",null),(0,n._)([(0,c.MZ)({type:String,readOnly:!0})],_.prototype,"cdnUrl",null),(0,n._)([(0,c.MZ)({type:String,readOnly:!0})],_.prototype,"itemRelativeUrl",null),_=(0,n._)([(0,h.$)("esri.portal.PortalItemResource")],_);const b=_;let S=class extends m.A{constructor(e){super(e),this.created=null,this.rating=null}};(0,n._)([(0,c.MZ)()],S.prototype,"created",void 0),(0,n._)([(0,c.MZ)()],S.prototype,"rating",void 0),S=(0,n._)([(0,h.$)("esri.portal.PortalRating")],S);const I=S;var M,x=r(60534);const F=new Set(["3DTiles Service","CSV","Feature Collection","Feature Service","Feed","GeoJson","Group Layer","Image Service","KML","Map Service","Media Layer","Scene Service","Stream Service","Vector Tile Service","WFS","WMS","WMTS"]),A=new Set(["KML","GeoJson","CSV"]);let T=M=class extends((0,o.Te)(l.A)){static from(e){return(0,p.PZ)(M,e)}constructor(e){super(e),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.classification=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.isOrgItem=!1,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.sourceUrl=null,this.spatialReference=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}destroy(){this.portal=null}get displayName(){const e=this.type,t=this.typeKeywords||[];let r=e;return"Feature Service"===e||"Feature Collection"===e?r=t.includes("Table")?"Table":t.includes("Route Layer")?"Route Layer":t.includes("Markup")?"Markup":"Feature Layer":"Image Service"===e?r=t.includes("Elevation 3D Layer")?"Elevation Layer":t.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":"Scene Service"===e?r="Scene Layer":"Video Service"===e?r="Video Layer":"Scene Package"===e?r="Scene Layer Package":"Stream Service"===e?r="Feature Layer":"Geoprocessing Service"===e?r=t.includes("Web Tool")?"Tool":"Geoprocessing Service":"Geoenrichment Service"===e?r="GeoEnrichment Service":"Geocoding Service"===e?r="Locator":"Microsoft Powerpoint"===e?r="Microsoft PowerPoint":"GeoJson"===e?r="GeoJSON":"Globe Service"===e?r="Globe Layer":"Vector Tile Service"===e?r="Tile Layer":"netCDF"===e?r="NetCDF":"Map Service"===e?r=t.includes("Spatiotemporal")||!t.includes("Hosted Service")&&!t.includes("Tiled")||t.includes("Relational")?"Map Image Layer":"Tile Layer":e?.toLowerCase().includes("add in")?r=e.replaceAll(/(add in)/gi,"Add-In"):"datastore catalog service"===e?r="Big Data File Share":"Compact Tile Package"===e?r="Tile Package (tpkx)":"Raster function template"===e?r="Raster Function Template":"OGCFeatureServer"===e?r="OGC Feature Layer":"web mapping application"===e&&t.includes("configurableApp")?r="Instant App":"Insights Page"===e?r="Insights Report":"Excalibur Imagery Project"===e?r="Excalibur Project":"3DTiles Service"===e?r="3D tiles layer":"3DTiles Package"===e&&(r="3D tiles package"),r}readExtent(e){return e&&e.length?new f.default(e[0][0],e[0][1],e[1][0],e[1][1]):null}get iconUrl(){const e=this.type?.toLowerCase()||"",t=this.typeKeywords||[];let r,n=!1,s=!1,o=!1,a=!1,l=!1,u=!1,c=!1,p=!1;return e.indexOf("service")>0||"feature collection"===e||"kml"===e||"wms"===e||"wmts"===e||"wfs"===e?(n=t.includes("Hosted Service"),"feature service"===e||"feature collection"===e||"kml"===e||"wfs"===e?(s=t.includes("Table"),o=t.includes("Route Layer"),a=t.includes("Markup"),l=t.includes("Spatiotemporal"),u=t.includes("UtilityNetwork"),r=l&&s?"spatiotemporaltable":s?"table":o?"routelayer":a?"markup":l?"spatiotemporal":u?"utilitynetwork":n?"featureshosted":"features"):"map service"===e||"wms"===e||"wmts"===e?(l=t.includes("Spatiotemporal"),c=t.includes("Relational"),r=l||c?"mapimages":n||t.includes("Tiled")||"wmts"===e?"maptiles":"mapimages"):r="scene service"===e?t.includes("Line")?"sceneweblayerline":t.includes("3DObject")?"sceneweblayermultipatch":t.includes("Point")?"sceneweblayerpoint":t.includes("IntegratedMesh")?"sceneweblayermesh":t.includes("PointCloud")?"sceneweblayerpointcloud":t.includes("Polygon")?"sceneweblayerpolygon":t.includes("Building")?"sceneweblayerbuilding":t.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":"image service"===e?t.includes("Elevation 3D Layer")?"elevationlayer":t.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":"stream service"===e?"streamlayer":"vector tile service"===e?"vectortile":"datastore catalog service"===e?"datastorecollection":"geocoding service"===e?"geocodeservice":"video service"===e?t.includes("Live Stream")?"livestreamvideolayer":"videolayer":"geoprocessing service"===e?t.includes("Web Tool")?"tool":"layers":"geodata service"===e?"geodataservice":"3dtiles service"===e?t.includes("3DObject")?"3dobjecttileslayer":t.includes("IntegratedMesh")?"integratedmeshtileslayer":"3dtileslayer":"layers"):"web map"===e||"cityengine web scene"===e?r="maps":"web scene"===e?r=t.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":"web mapping application"===e&&t.includes("configurableApp")?r="instantapps":"web mapping application"===e||"mobile application"===e||"application"===e||"operation view"===e||"desktop application"===e?r="apps":"map document"===e||"map package"===e||"published map"===e||"scene document"===e||"globe document"===e||"basemap package"===e||"mobile basemap package"===e||"mobile map package"===e||"project package"===e||"project template"===e||"pro map"===e||"layout"===e||"layer"===e&&t.includes("ArcGIS Pro")||"explorer map"===e&&t.indexOf("Explorer Document")?r="mapsgray":"service definition"===e||"shapefile"===e||"cad drawing"===e||"geojson"===e||"netcdf"===e||"administrative report"===e?r="datafiles":"360 vr experience"===e?r="360vr":"explorer add in"===e||"desktop add in"===e||"windows viewer add in"===e||"windows viewer configuration"===e?r="appsgray":"arcgis pro add in"===e||"arcgis pro configuration"===e?r="addindesktop":"pdf"===e?r="pdf":"microsoft word"===e?r="word":"microsoft excel"===e?r="excel":"microsoft powerpoint"===e?r="ppt":"rule package"===e||"file geodatabase"===e||"sqlite geodatabase"===e||"csv collection"===e||"kml collection"===e||"windows mobile package"===e||"map template"===e||"desktop application template"===e||"gml"===e||"arcpad package"===e||"code sample"===e||"document link"===e||"earth configuration"===e||"operations dashboard add in"===e||"rules package"===e||"workflow manager package"===e||"explorer map"===e&&t.includes("Explorer Mapping Application")||t.includes("Document")?r="datafilesgray":"network analysis service"===e||"geoprocessing service"===e||"geodata service"===e||"geometry service"===e||"geoprocessing package"===e||"locator package"===e||"geoprocessing sample"===e||"workflow manager service"===e?r="toolsgray":"layer"===e||"layer package"===e||"explorer layer"===e?r="layersgray":"analysis model"===e?r="analysismodel":"scene package"===e?r="scenepackage":"3dtiles package"===e?r="3dtileslayerpackage":"3dtiles service"===e?r="3dtileslayer":"mobile scene package"===e?r="mobilescenepackage":"tile package"===e||"compact tile package"===e?r="tilepackage":"task file"===e?r="taskfile":"report template"===e?r="report-template":"statistical data collection"===e?r="statisticaldatacollection":"insights workbook"===e?r="workbook":"insights model"===e?r="insightsmodel":"insights page"===e?r="insightspage":"insights theme"===e?r="insightstheme":"hub initiative"===e?r="hubinitiative":"hub page"===e?r="hubpage":"hub site application"===e?r="hubsite":"hub event"===e?r="hubevent":"hub project"===e?r="hubproject":"relational database connection"===e?r="relationaldatabaseconnection":"big data file share"===e?r="datastorecollection":"image collection"===e?r="imagecollection":"desktop style"===e?r="desktopstyle":"style"===e?r=t.includes("Dictionary")?"dictionarystyle":"style":"dashboard"===e?r="dashboard":"raster function template"===e?r="rasterprocessingtemplate":"vector tile package"===e?r="vectortilepackage":"ortho mapping project"===e?r="orthomappingproject":"ortho mapping template"===e?r="orthomappingtemplate":"solution"===e?r="solutions":"geopackage"===e?r="geopackage":"deep learning package"===e?r="deeplearningpackage":"real time analytic"===e?r="realtimeanalytics":"reality mapping project"===e?r="realitymappingproject":"big data analytic"===e?r="bigdataanalytics":"feed"===e?r="feed":"excalibur imagery project"===e?r="excaliburimageryproject":"notebook"===e?r="notebook":"storymap"===e?r="storymap":"survey123 add in"===e?r="survey123addin":"mission"===e?r="mission":"mission report"===e?r="missionreport":"mission template"===e?r="missiontemplate":"quickcapture project"===e?r="quickcaptureproject":"pro report"===e?r="proreport":"pro report template"===e?r="proreporttemplate":"urban model"===e?r="urbanmodel":"urban project"===e?r="urbanproject":"web experience"===e?r="experiencebuilder":"web experience template"===e?r="webexperiencetemplate":"experience builder widget"===e?r="experiencebuilderwidget":"experience builder widget package"===e?r="experiencebuilderwidgetpackage":"workflow"===e?r="workflow":"kernel gateway connection"===e?r="kernelgatewayconnection":"insights script"===e?r="insightsscript":"hub initiative template"===e?r="hubinitiativetemplate":"storymap theme"===e?r="storymaptheme":"knowledge graph"===e?r="knowledgegraph":"knowledge graph layer"===e?r="knowledgegraphlayer":"knowledge studio project"===e?r="knowledgestudio":"native application"===e?r="nativeapp":"native application installer"===e?r="nativeappinstaller":"web link chart"===e?r="linkchart":"knowledge graph web investigation"===e?r="investigation":"ogcfeatureserver"===e?r="features":"pro presentation"===e?r="propresentation":"pro project"===e?r="proproject":"insights workbook package"===e?r="insightsworkbookpackage":"apache parquet"===e?r="apacheparquet":"notebook code snippet library"===e?r="notebookcodesnippets":"suitability model"===e?r="suitabilitymodel":"esri classifier definition"===e?r="classifierdefinition":"esri classification schema"===e?r="classificationschema":"insights data engineering workbook"===e?r="dataengineeringworkbook":"insights data engineering model"===e?r="dataengineeringmodel":"deep learning studio project"===e?r="deeplearningproject":"discussion"===e?r="discussion":"allsource project"===e?r="allsourceproject":"api key"===e?r="apikey":"data pipeline"===e?r="datapipelines":"group layer"===e?(p=t.includes("Map"),r=p?"layergroup2d":"layergroup"):r="media layer"===e?"onlinemedialayer":"form"===e?t.includes("Survey123")?"survey":"datafilesgray":"csv"===e?"csv":"image"===e?"image":"maps",r?(0,i.s)("esri/images/portal/"+r+"16.png"):null}get isLayer(){return null!=this.type&&F.has(this.type)}get itemCdnUrl(){return(0,x.a)(this.itemUrl)}get itemPageUrl(){const e=this.portal?.itemPageUrl;return e&&this.id?`${e}?id=${this.id}`:null}get itemUrl(){const e=this.portal?.restUrl;return e&&this.id?`${e}/content/items/${this.id}`:null}get thumbnailUrl(){const e=this.itemUrl,t=this.thumbnail;return e&&t?this.portal?.normalizeUrl(`${e}/info/${t}?f=json`)??null:null}get userItemUrl(){const e=this.portal?.restUrl;if(!e)return null;const t=this.owner||this.portal?.user?.username;return t?`${e}/content/users/${this.ownerFolder?`${t}/${this.ownerFolder}`:t}/items/${this.id}`:null}load(e){const t=this.portal??(this.portal=y.A.getDefault()),r=t.load(e).then((()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?t.request(this.itemUrl,{signal:null!=e?e.signal:null,query:{token:this.apiKey}}):{})).then((e=>{this.sourceJSON=e,this.read(e)}));return this.addResolvingPromise(r),Promise.resolve(this)}async addRating(e){const t={method:"post",query:{}};return e instanceof I&&(e=e.rating),null==e||isNaN(e)||"number"!=typeof e||(t.query.rating=e),this.portal?(await this.portal.request(this.itemUrl+"/addRating",t),new I({rating:e,created:new Date})):null}clone(){const e={access:this.access,accessInformation:this.accessInformation,applicationProxies:(0,a.o8)(this.applicationProxies),avgRating:this.avgRating,categories:(0,a.o8)(this.categories),classification:(0,a.o8)(this.classification),created:(0,a.o8)(this.created),culture:this.culture,description:this.description,extent:(0,a.o8)(this.extent),groupCategories:(0,a.o8)(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:(0,a.o8)(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:(0,a.o8)(this.screenshots),size:this.size,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:(0,a.o8)(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:(0,a.o8)(this.typeKeywords),url:this.url};this.loaded&&(e.loadStatus="loaded");const t=new M({sourceJSON:this.sourceJSON}).set(e);return t._set("isOrgItem",this.isOrgItem),t}createPostQuery(){const e=this.toJSON();for(const t of["tags","typeKeywords","categories"])e[t]=e[t]?.join(", ");for(const t of["extent","classification"]){const r=e[t];r&&(e[t]=JSON.stringify(r))}return e}async deleteRating(){await this.portal.request(this.itemUrl+"/deleteRating",{method:"post"})}fetchData(e="json",t){return this.portal.request(this.itemUrl+"/data",{responseType:e,...t,query:{token:this.apiKey}})}async fetchRating(e){const t=await this.portal.request(this.itemUrl+"/rating",{query:{token:this.apiKey},...e});return null!=t.rating?(t.created=new Date(t.created),new I(t)):null}fetchRelatedItems(e,t){return this.portal.requestToTypedArray(this.itemUrl+"/relatedItems",{query:{...e,token:this.apiKey},...t},M)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}reload(){return this.portal.request(this.itemUrl??"",{cacheBust:!0,query:{token:this.apiKey}}).then((e=>(this.applicationProxies&&!Object.hasOwn(e,"appProxies")&&(this.applicationProxies=null),this.sourceJSON=e,this.read(e),this)))}update(e){return this.id?this.load().then((()=>this.portal.signIn())).then((()=>{const t=e?.data,r={method:"post"};r.query=this.createPostQuery();for(const e in r.query)null===r.query[e]&&(r.query[e]="");return r.query.clearEmptyFields=!0,null!=t&&("string"==typeof t?r.query.text=t:"object"==typeof t&&(r.query.text=JSON.stringify(t))),this.portal.request(`${this.userItemUrl}/update`,r).then((()=>this.reload()))})):Promise.reject(new s.A("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async copy(e){if(!this.id)throw new s.A("portal:item-does-not-exist","The item does not exist yet");await this.load();const{portal:t,itemUrl:r}=this;await t.signIn();const{copyResources:n,folder:i,tags:o,title:a}=e||{},l={method:"post",query:{copyPrivateResources:"all"===n,folder:"string"==typeof i?i:i?.id,includeResources:!!n,tags:o?.join(","),title:a}},{itemId:u}=await t.request(`${r}/copy`,l);return new M({id:u,portal:t})}updateThumbnail(e){return this.id?this.load().then((()=>this.portal.signIn())).then((()=>{const t=e.thumbnail,r=e.filename,n={method:"post"};if("string"==typeof t)(0,u.DB)(t)?n.query={data:t}:n.query={url:(0,u.s2)(t)},null!=r&&(n.query.filename=r);else{const e=new FormData;null!=r?e.append("file",t,r):e.append("file",t),n.body=e}return this.portal.request(`${this.userItemUrl}/updateThumbnail`,n).then((()=>this.reload()))})):Promise.reject(new s.A("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(e={},t){const{fetchResources:n}=await r.e(4460).then(r.bind(r,55597));return n(this,e,t)}async addResource(e,t,n){const{addOrUpdateResources:i}=await r.e(4460).then(r.bind(r,55597));return e.portalItem=this,await i(this,[{resource:e,content:t,compress:n?.compress,access:n?.access}],"add",n),e}async removeResource(e,t){const{removeResource:n}=await r.e(4460).then(r.bind(r,55597));if(e.portalItem&&e.portalItem.itemUrl!==this.itemUrl)throw new s.A("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return n(this,e,t)}async removeAllResources(e){const{removeAllResources:t}=await r.e(4460).then(r.bind(r,55597));return t(this,e)}resourceFromPath(e){return new b({portalItem:this,path:e})}toJSON(){const e=this.extent,t={accessInformation:this.accessInformation,categories:(0,a.o8)(this.categories),classification:(0,a.o8)(this.classification),created:this.created?.getTime(),description:this.description,extent:e&&[[e.xmin,e.ymin],[e.xmax,e.ymax]],id:this.id,isOrgItem:this.isOrgItem,licenseInfo:this.licenseInfo,modified:this.modified?.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:(0,a.o8)(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:(0,a.o8)(this.typeKeywords),url:this.url};return(0,a.oy)(t)}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");return new M({sourceJSON:e})}_getPostQuery(){const e=this.toJSON();for(const t in e)"tags"===t&&null!==e[t]&&(e[t]=e[t].join(", ")),"typeKeywords"===t&&null!==e[t]&&(e[t]=e[t].join(", ")),"extent"===t&&e[t]&&(e[t]=JSON.stringify(e[t]));return e}};(0,n._)([(0,c.MZ)({type:["private","shared","org","public"]})],T.prototype,"access",void 0),(0,n._)([(0,c.MZ)()],T.prototype,"accessInformation",void 0),(0,n._)([(0,c.MZ)({type:String})],T.prototype,"apiKey",void 0),(0,n._)([(0,c.MZ)({json:{read:{source:"appProxies"}}})],T.prototype,"applicationProxies",void 0),(0,n._)([(0,c.MZ)()],T.prototype,"avgRating",void 0),(0,n._)([(0,c.MZ)()],T.prototype,"categories",void 0),(0,n._)([(0,c.MZ)()],T.prototype,"classification",void 0),(0,n._)([(0,c.MZ)({type:Date})],T.prototype,"created",void 0),(0,n._)([(0,c.MZ)()],T.prototype,"culture",void 0),(0,n._)([(0,c.MZ)()],T.prototype,"description",void 0),(0,n._)([(0,c.MZ)({readOnly:!0})],T.prototype,"displayName",null),(0,n._)([(0,c.MZ)({type:f.default})],T.prototype,"extent",void 0),(0,n._)([(0,d.w)("extent")],T.prototype,"readExtent",null),(0,n._)([(0,c.MZ)()],T.prototype,"groupCategories",void 0),(0,n._)([(0,c.MZ)({readOnly:!0})],T.prototype,"iconUrl",null),(0,n._)([(0,c.MZ)()],T.prototype,"id",void 0),(0,n._)([(0,c.MZ)({readOnly:!0})],T.prototype,"isLayer",null),(0,n._)([(0,c.MZ)({type:Boolean,readOnly:!0})],T.prototype,"isOrgItem",void 0),(0,n._)([(0,c.MZ)()],T.prototype,"itemControl",void 0),(0,n._)([(0,c.MZ)({readOnly:!0})],T.prototype,"itemPageUrl",null),(0,n._)([(0,c.MZ)({readOnly:!0})],T.prototype,"itemUrl",null),(0,n._)([(0,c.MZ)()],T.prototype,"licenseInfo",void 0),(0,n._)([(0,c.MZ)({type:Date})],T.prototype,"modified",void 0),(0,n._)([(0,c.MZ)()],T.prototype,"name",void 0),(0,n._)([(0,c.MZ)()],T.prototype,"numComments",void 0),(0,n._)([(0,c.MZ)()],T.prototype,"numRatings",void 0),(0,n._)([(0,c.MZ)()],T.prototype,"numViews",void 0),(0,n._)([(0,c.MZ)()],T.prototype,"owner",void 0),(0,n._)([(0,c.MZ)()],T.prototype,"ownerFolder",void 0),(0,n._)([(0,c.MZ)({type:y.A})],T.prototype,"portal",void 0),(0,n._)([(0,c.MZ)()],T.prototype,"screenshots",void 0),(0,n._)([(0,c.MZ)()],T.prototype,"size",void 0),(0,n._)([(0,c.MZ)()],T.prototype,"snippet",void 0),(0,n._)([(0,c.MZ)()],T.prototype,"sourceJSON",void 0),(0,n._)([(0,c.MZ)({type:String})],T.prototype,"sourceUrl",void 0),(0,n._)([(0,c.MZ)({type:String})],T.prototype,"spatialReference",void 0),(0,n._)([(0,c.MZ)()],T.prototype,"tags",void 0),(0,n._)([(0,c.MZ)()],T.prototype,"thumbnail",void 0),(0,n._)([(0,c.MZ)({readOnly:!0})],T.prototype,"thumbnailUrl",null),(0,n._)([(0,c.MZ)()],T.prototype,"title",void 0),(0,n._)([(0,c.MZ)()],T.prototype,"type",void 0),(0,n._)([(0,c.MZ)()],T.prototype,"typeKeywords",void 0),(0,n._)([(0,c.MZ)({type:String,json:{read(e,t){if(A.has(t.type)){const t=this.portal?.restUrl;e||=t&&this.id?`${t}/content/items/${this.id}/data`:null}return e}}})],T.prototype,"url",void 0),(0,n._)([(0,c.MZ)({readOnly:!0})],T.prototype,"userItemUrl",null),T=M=(0,n._)([(0,h.$)("esri.portal.PortalItem")],T);const C=T},29606:function(e,t,r){r.d(t,{It:function(){return h},LG:function(){return o},OM:function(){return u},Sm:function(){return c},Y:function(){return a},bK:function(){return l},mm:function(){return d},sQ:function(){return p}});var n=r(46157),i=r(57165),s=r(1644);function o(e,t){if(!a(e,t)){const r=e.typeKeywords;r?r.push(t):e.typeKeywords=[t]}}function a(e,t){return!!e.typeKeywords?.includes(t)}function l(e){return a(e,d.HOSTED_SERVICE)}function u(e,t){const r=e.typeKeywords;if(r){const e=r.indexOf(t);e>-1&&r.splice(e,1)}}function c(e,t,r){r?o(e,t):u(e,t)}async function p(e){const t=e.clone().normalize();let r;if(t.length>1)for(const e of t)r?e.width>r.width&&(r=e):r=e;else r=t[0];return async function(e){const t=e.spatialReference;if(t.isWGS84)return e.clone();if(t.isWebMercator)return(0,s.ci)(e);const r=i.A.WGS84;return await(0,n.initializeProjection)(t,r),(0,n.project)(e,r)}(r)}const d={DEVELOPER_BASEMAP:"DeveloperBasemap",JSAPI:"ArcGIS API for JavaScript",METADATA:"Metadata",MULTI_LAYER:"Multilayer",SINGLE_LAYER:"Singlelayer",TABLE:"Table",HOSTED_SERVICE:"Hosted Service",LOCAL_SCENE:"ViewingMode-Local",TILED_IMAGERY:"Tiled Imagery",GROUP_LAYER_MAP:"Map",ORIENTED_IMAGERY_LAYER:"OrientedImageryLayer"};function h(e){const{portal:t,isOrgItem:r,itemControl:n}=e,i=t.user?.privileges;let s=!i||i.includes("features:user:edit"),o=!!r&&!!i?.includes("features:user:fullEdit");const a="update"===n||"admin"===n;return a?o=s=!0:o&&(s=!0),{features:{edit:s,fullEdit:o},content:{updateItem:a}}}},35060:function(e,t,r){r.d(t,{j:function(){return n}});const n=(0,r(73037).O)()({esriTimeUnitsMilliseconds:"milliseconds",esriTimeUnitsSeconds:"seconds",esriTimeUnitsMinutes:"minutes",esriTimeUnitsHours:"hours",esriTimeUnitsDays:"days",esriTimeUnitsWeeks:"weeks",esriTimeUnitsMonths:"months",esriTimeUnitsYears:"years",esriTimeUnitsDecades:"decades",esriTimeUnitsCenturies:"centuries",esriTimeUnitsUnknown:void 0})},74865:function(e,t,r){r.d(t,{A:function(){return T}});var n,i=r(53804),s=r(10748),o=r(73037),a=r(21609),l=r(40633),u=r(23502),c=r(77560),p=r(74376),d=r(47332),h=r(65953),f=r(81392),y=r(67888),m=r(53743),g=r(30047),w=r(29970),_=r(23879),v=r(85336),b=r(16986),S=r(54547);const I="percent-of-total",M="field",x=new o.J({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:I,esriNormalizeByField:M}),F=(0,y.dp)(_.A);let A=n=class extends((0,w.h)(g.A)){constructor(e){super(e),this._compiledValueExpression={valueExpression:null,compiledFunction:null},this.backgroundFillSymbol=null,this.classBreakInfos=null,this.defaultLabel=null,this.defaultSymbol=null,this.field=null,this.isMaxInclusive=!0,this.legendOptions=null,this.normalizationField=null,this.normalizationTotal=null,this.type="class-breaks",this.valueExpression=null,this.valueExpressionTitle=null,this._set("classBreakInfos",[])}readClassBreakInfos(e,t,r){if(!Array.isArray(e))return;let n=t.minValue;return e.map((e=>{const t=new _.A;return t.read(e,r),null==t.minValue&&(t.minValue=n),null==t.maxValue&&(t.maxValue=t.minValue),n=t.maxValue,t}))}writeClassBreakInfos(e,t,r,n){const i=e.map((e=>e.write({},n)));this._areClassBreaksConsecutive()&&i.forEach((e=>delete e.classMinValue)),t[r]=i}castField(e){return null==e?e:"function"==typeof e?(l.A.getLogger(this).error(".field: field must be a string value"),null):(0,y.GX)(e)}get minValue(){return this.classBreakInfos&&this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0}get normalizationType(){let e=this._get("normalizationType");const t=!!this.normalizationField,r=null!=this.normalizationTotal;return t||r?(e=t&&M||r&&I||null,t&&r&&l.A.getLogger(this).warn("warning: both normalizationField and normalizationTotal are set!")):e!==M&&e!==I||(e=null),e}set normalizationType(e){this._set("normalizationType",e)}addClassBreakInfo(e,t,r){let n=null;n="number"==typeof e?new _.A({minValue:e,maxValue:t,symbol:(0,s.dp)(r)}):F((0,a.o8)(e)),this.classBreakInfos.push(n),1===this.classBreakInfos.length&&this.notifyChange("minValue")}removeClassBreakInfo(e,t){const r=this.classBreakInfos.length;for(let n=0;n<r;n++){const r=[this.classBreakInfos[n].minValue,this.classBreakInfos[n].maxValue];if(r[0]===e&&r[1]===t){this.classBreakInfos.splice(n,1);break}}}getBreakIndex(e,t){return this.valueExpression&&null==t?.arcade&&l.A.getLogger(this).warn(""),this.valueExpression?this._getBreakIndexForExpression(e,t):this._getBreakIndexForField(e)}async getClassBreakInfo(e,t){let r=t;this.valueExpression&&null==t?.arcade&&(r={...r,arcade:await(0,S.lw)()});const n=this.getBreakIndex(e,r);return-1!==n?this.classBreakInfos[n]:null}getSymbol(e,t){if(this.valueExpression&&null==t?.arcade)return void l.A.getLogger(this).error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const r=this.getBreakIndex(e,t);return r>-1?this.classBreakInfos[r].symbol:this.defaultSymbol}async getSymbolAsync(e,t){let r=t;if(this.valueExpression&&null==t?.arcade){const e=await(0,S.lw)(),{arcadeUtils:t}=e;t.hasGeometryOperations(this.valueExpression)&&await t.enableGeometryOperations(),r={...r,arcade:e}}const n=this.getBreakIndex(e,r);return n>-1?this.classBreakInfos[n].symbol:this.defaultSymbol}getSymbols(){const e=[];return this.classBreakInfos.forEach((t=>{t.symbol&&e.push(t.symbol)})),this.defaultSymbol&&e.push(this.defaultSymbol),e}getAttributeHash(){return this.visualVariables?.reduce(((e,t)=>e+t.getAttributeHash()),"")??""}getMeshHash(){const e=JSON.stringify(this.backgroundFillSymbol),t=JSON.stringify(this.defaultSymbol),r=`${this.normalizationField}.${this.normalizationType}.${this.normalizationTotal}`;return`${e}.${t}.${this.classBreakInfos.reduce(((e,t)=>e+t.getMeshHash()),"")}.${r}.${this.field}.${this.valueExpression}`}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}clone(){return new n({field:this.field,backgroundFillSymbol:this.backgroundFillSymbol?.clone(),defaultLabel:this.defaultLabel,defaultSymbol:this.defaultSymbol?.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:(0,a.o8)(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:(0,a.o8)(this.visualVariables),legendOptions:(0,a.o8)(this.legendOptions),authoringInfo:(0,a.o8)(this.authoringInfo)})}async collectRequiredFields(e,t){const r=[this.collectVVRequiredFields(e,t),this.collectSymbolFields(e,t)];await Promise.all(r)}async collectSymbolFields(e,t){const r=[...this.getSymbols().map((r=>r.collectRequiredFields(e,t))),(0,m.Dx)(e,t,this.valueExpression)];(0,m.rq)(e,t,this.field),(0,m.rq)(e,t,this.normalizationField),await Promise.all(r)}_getBreakIndexForExpression(e,t){const{viewingMode:r,scale:n,spatialReference:i,arcade:s,timeZone:o}=t??{},{valueExpression:a}=this;let l=this._compiledValueExpression.valueExpression===a?this._compiledValueExpression.compiledFunction:null;const u=s.arcadeUtils;if(!l){const e=u.createSyntaxTree(a);l=u.createFunction(e),this._compiledValueExpression.compiledFunction=l}this._compiledValueExpression.valueExpression=a;const c=u.executeFunction(l,u.createExecContext(e,u.getViewInfo({viewingMode:r,scale:n,spatialReference:i}),o));return this._getBreakIndexfromInfos(c)}_getBreakIndexForField(e){const t=this.field,r=e.attributes,n=this.normalizationType;let i=parseFloat(r[t]);if(n){const e=this.normalizationTotal,t=parseFloat(this.normalizationField?r[this.normalizationField]:void 0);if("log"===n)i=Math.log(i)*Math.LOG10E;else if(n!==I||null==e||isNaN(e)){if(n===M&&!isNaN(t)){if(isNaN(i)||isNaN(t))return-1;i/=t}}else i=i/e*100}return this._getBreakIndexfromInfos(i)}_getBreakIndexfromInfos(e){const t=this.isMaxInclusive;if(null!=e&&"number"==typeof e&&!isNaN(e))for(let r=0;r<this.classBreakInfos.length;r++){const n=[this.classBreakInfos[r].minValue,this.classBreakInfos[r].maxValue];if(n[0]<=e&&(t?e<=n[1]:e<n[1]))return r}return-1}_areClassBreaksConsecutive(){const e=this.classBreakInfos,t=e.length;for(let r=1;r<t;r++)if(e[r-1].maxValue!==e[r].minValue)return!1;return!0}};(0,i._)([(0,u.MZ)(v.As)],A.prototype,"backgroundFillSymbol",void 0),(0,i._)([(0,u.MZ)({type:[_.A]})],A.prototype,"classBreakInfos",void 0),(0,i._)([(0,d.w)("classBreakInfos")],A.prototype,"readClassBreakInfos",null),(0,i._)([(0,f.K)("classBreakInfos")],A.prototype,"writeClassBreakInfos",null),(0,i._)([(0,u.MZ)({type:String,json:{write:!0}})],A.prototype,"defaultLabel",void 0),(0,i._)([(0,u.MZ)(v.z4)],A.prototype,"defaultSymbol",void 0),(0,i._)([(0,u.MZ)({type:String,json:{write:!0}})],A.prototype,"field",void 0),(0,i._)([(0,c.w)("field")],A.prototype,"castField",null),(0,i._)([(0,u.MZ)({type:Boolean})],A.prototype,"isMaxInclusive",void 0),(0,i._)([(0,u.MZ)({type:b.A,json:{write:!0}})],A.prototype,"legendOptions",void 0),(0,i._)([(0,u.MZ)({type:Number,readOnly:!0,value:null,json:{read:!1,write:{overridePolicy(){return 0!==this.classBreakInfos.length&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}})],A.prototype,"minValue",null),(0,i._)([(0,u.MZ)({type:String,json:{write:!0}})],A.prototype,"normalizationField",void 0),(0,i._)([(0,u.MZ)({type:Number,json:{write:!0}})],A.prototype,"normalizationTotal",void 0),(0,i._)([(0,u.MZ)({type:x.apiValues,value:null,json:{type:x.jsonValues,read:x.read,write:x.write}})],A.prototype,"normalizationType",null),(0,i._)([(0,p.e)({classBreaks:"class-breaks"})],A.prototype,"type",void 0),(0,i._)([(0,u.MZ)({type:String,json:{write:!0}})],A.prototype,"valueExpression",void 0),(0,i._)([(0,u.MZ)({type:String,json:{write:!0}})],A.prototype,"valueExpressionTitle",void 0),A=n=(0,i._)([(0,h.$)("esri.renderers.ClassBreaksRenderer")],A);const T=A},1526:function(e,t,r){r.d(t,{A:function(){return E}});var n=r(53804),i=r(21609),s=r(23502),o=(r(58941),r(40633)),a=r(65953),l=r(81392),u=r(53743),c=r(30047),p=r(29970),d=r(52874),h=r(93040),f=r(39819),y=r(99680),m=r(60539),g=r(58009),w=r(74697),_=r(7103),v=r(54547),b=r(38164),S=r(67895),I=r(7590);const M="esri.renderers.support.DictionaryLoader",x={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}};class F{constructor(e,t,r){this.config=null,this.fieldMap=null,this.url=null,this._ongoingRequests=new Map,this._symbolCache=new y.q(100),this._dictionaryVersion=null,this._fieldIndex=null,this._dictionaryPromise=null,this.url=e,this.config=t,this.fieldMap=r}getSymbolFields(){return this._symbolFields}async getSymbolAsync(e,t){let r;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(t));try{r=await this._dictionaryPromise}catch(e){if((0,m.zf)(e))return this._dictionaryPromise=null,null}const n=this._dictionaryVersion?.greaterEqual(4,0),i={};if(this.fieldMap)for(const t of this._symbolFields){const r=(0,I.MO)(this.fieldMap[t],this._fieldIndex);if(r){const s=e.attributes[r];i[t]=n?s:null!=s?""+e.attributes[r]:""}else i[t]=""}let s=null;try{s=r?.(i,t)}catch(e){return null}if(!s||"string"!=typeof s||"invalid"===s)return null;const o=s.split(";"),a=[],l=[];for(let t=0;t<o.length;t++){const r=o[t];if(r)if(r.includes("po:")){const t=r.slice(3).split("|");if(3===t.length){const r=t[0],n=t[1];let i=t[2];const s="countrylabel";if(r===s&&"TextString"===n){if(null!=this.fieldMap){let t=this.fieldMap[s];null==t&&(t=s,this.fieldMap[t]=t),e.attributes[t]=i}continue}if("DashTemplate"===n)i=i.split(" ").map((e=>Number(e)));else if("Color"===n){const e=new d.A(i).toRgba();i=[e[0],e[1],e[2],255*e[3]]}else i=Number(i);l.push({primitiveName:r,propertyName:n,value:i,defaultValue:null})}}else if(r.includes("|")){for(const e of r.split("|"))if(this._itemNames.has(e)){a.push(e);break}}else if(this._itemNames.has(r))a.push(r);else if(0===t){a.length=0;let t="Invalid_P";null!=e.geometry&&((0,w.Bi)(e.geometry)?t="Invalid_A":(0,w.Rg)(e.geometry)&&(t="Invalid_L")),a.push(t);break}}const u=null==e.geometry||!e.geometry.hasZ&&"point"===e.geometry.type;return this._cimPartsToCIMSymbol(e,a,l,u,t)}async fetchResources(e){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void o.A.getLogger(M).error("no valid URL!");const t=(0,h.A)(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},signal:null!=e?e.signal:null}),[{data:r}]=await Promise.all([t,(0,v.lw)()]);if(!r)throw this._dictionaryPromise=null,new f.A("esri.renderers.DictionaryRenderer","Bad dictionary data!");const{authoringInfo:n,dictionary_version:i,expression:s,itemsNames:a}=r,l=s;let u=!1;i&&(this._dictionaryVersion=g.R.parse(i),u=this._dictionaryVersion.greaterEqual(4,0)),this._refSymbolUrlTemplate=this.url+"/"+r.cimRefTemplateUrl,this._itemNames=new Set(a),this._symbolFields=n.symbol;const c={};if(this.config){const e=this.config;for(const t in e)c[t]=e[t]}if(n.configuration)for(const e of n.configuration)c.hasOwnProperty(e.name)||(c[e.name]=e.value);const p=[];if(e?.fields&&this.fieldMap)for(const t in this.fieldMap){const r=this.fieldMap[t],n=e.fields.filter((e=>e.name.toLowerCase()===r?.toLowerCase()));n.length>0&&p.push({...n[0],type:u?n[0].type:"esriFieldTypeString"})}p.length>0&&(this._fieldIndex=new _.A(p));const d=(0,v.xR)(l,null!=e?e.spatialReference:null,p,c).then((e=>{const t={scale:0};return(r,n)=>{if(null==e)return null;const i=e.repurposeFeature({geometry:null,attributes:r});return t.scale=null!=n?n.scale??void 0:void 0,e.evaluate({$feature:i,$view:t},e.services)}})).catch((e=>(o.A.getLogger(M).error("Creating dictionary expression failed:",e),null)));return this._dictionaryPromise=d,d}async _cimPartsToCIMSymbol(e,t,r,n,s){const o=new Array(t.length);for(let e=0;e<t.length;e++)o[e]=this._getSymbolPart(t[e],s);let a=await Promise.all(o);const l=this.fieldMap;if(l){a=(0,i.o8)(a);for(const t of a)S.$.applyDictionaryTextOverrides(t,e,l,this._fieldIndex,(0,I.bs)(t))}return new b.A({data:A(a,r,n)})}async _getSymbolPart(e,t){const r=this._symbolCache.get(e);if(r)return r;if(this._ongoingRequests.has(e))return this._ongoingRequests.get(e).then((e=>e.data));const n=this._refSymbolUrlTemplate.replaceAll(/\{itemName\}/gi,e),i=(0,h.A)(n,{responseType:"json",query:{f:"json"},...t});this._ongoingRequests.set(e,i),i.finally((()=>this._ongoingRequests.delete(e)));try{const t=await i;return this._symbolCache.put(e,t.data),t.data}catch(e){throw e}}}function A(e,t,r){if(!e||0===e.length)return null;const n={...e[0]};if(e.length>1){n.effects=null,n.symbolLayers=[];for(const t of e){const e=t;if(null!=e.effects)for(const t of e.symbolLayers)null==t.effects?t.effects=e.effects:t.effects.unshift(...e.effects);n.symbolLayers.unshift(...e.symbolLayers)}}return r&&(n.callout=x),{type:"CIMSymbolReference",symbol:n,primitiveOverrides:t}}var T;let C=T=class extends((0,p.h)(c.A)){constructor(e){super(e),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}get _loader(){return new F(this.url,this.config,this.fieldMap)}writeData(e,t){e&&(t.scalingExpressionInfo={expression:e,returnType:"number"})}writeVisualVariables(e,t,r,n){n?.origin||super.writeVisualVariables(e,t,r,n)}clone(){return new T({config:(0,i.o8)(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:(0,i.o8)(this.fieldMap),url:(0,i.o8)(this.url),visualVariables:(0,i.o8)(this.visualVariables)})}async getSymbolAsync(e,t){return this._loader.getSymbolAsync(e,t)}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t),this.scaleExpression&&await(0,u.Dx)(e,t,this.scaleExpression);for(const r in this.fieldMap){const n=this.fieldMap[r];t.has(n)&&e.add(n)}}get arcadeRequired(){return!0}getSymbol(){return null}getSymbols(){return[]}getAttributeHash(){return this.visualVariables?.reduce(((e,t)=>e+t.getAttributeHash()),"")??""}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._loader.getSymbolFields()}};(0,n._)([(0,s.MZ)({type:F})],C.prototype,"_loader",null),(0,n._)([(0,s.MZ)({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],C.prototype,"config",void 0),(0,n._)([(0,s.MZ)({type:Object,json:{write:!0}})],C.prototype,"fieldMap",void 0),(0,n._)([(0,s.MZ)({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],C.prototype,"scaleExpression",void 0),(0,n._)([(0,l.K)("scaleExpression")],C.prototype,"writeData",null),(0,n._)([(0,s.MZ)({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(e){return{enabled:!!e&&!!this.scaleExpression}}}}})],C.prototype,"scaleExpressionTitle",void 0),(0,n._)([(0,s.MZ)({type:String,json:{write:!0}})],C.prototype,"url",void 0),(0,n._)([(0,l.K)("visualVariables")],C.prototype,"writeVisualVariables",null),C=T=(0,n._)([(0,a.$)("esri.renderers.DictionaryRenderer")],C);const E=C},96173:function(e,t,r){r.d(t,{A:function(){return b}});var n,i=r(53804),s=r(52874),o=r(21609),a=r(23502),l=(r(58941),r(40633),r(74376)),u=r(65953),c=r(53743),p=r(30047),d=r(29970),h=r(19563),f=r(30905);r(13798);let y=n=class extends f.oY{constructor(){super(...arguments),this.unit=null}clone(){return new n({unit:this.unit})}};(0,i._)([(0,a.MZ)({type:String,json:{write:!0}})],y.prototype,"unit",void 0),y=n=(0,i._)([(0,u.$)("esri.renderers.support.DotDensityLegendOptions")],y);const m=y;var g,w=r(8740),_=r(22198);let v=g=class extends((0,d.h)(p.A)){constructor(e){super(e),this.attributes=null,this.backgroundColor=new s.A([0,0,0,0]),this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new _.A,this.dotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}calculateDotValue(e){if(null==this.referenceScale)return this.dotValue;const t=e/this.referenceScale*this.dotValue;return t<1?1:t}getSymbol(){return new w.A({outline:this.outline})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}getAttributeHash(){return this.attributes?.reduce(((e,t)=>e+t.getAttributeHash()),"")??""}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new g({attributes:(0,o.o8)(this.attributes),backgroundColor:(0,o.o8)(this.backgroundColor),dotBlendingEnabled:(0,o.o8)(this.dotBlendingEnabled),dotShape:(0,o.o8)(this.dotShape),dotSize:(0,o.o8)(this.dotSize),dotValue:(0,o.o8)(this.dotValue),legendOptions:(0,o.o8)(this.legendOptions),outline:(0,o.o8)(this.outline),referenceScale:(0,o.o8)(this.referenceScale),seed:(0,o.o8)(this.seed),visualVariables:(0,o.o8)(this.visualVariables),authoringInfo:(0,o.o8)(this.authoringInfo)})}getControllerHash(){const e=this.attributes?.map((e=>e.field||e.valueExpression||""));return`${e}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t);for(const r of this.attributes??[])r.valueExpression&&await(0,c.Dx)(e,t,r.valueExpression),r.field&&e.add(r.field)}};(0,i._)([(0,a.MZ)({type:[h.A],json:{write:!0}})],v.prototype,"attributes",void 0),(0,i._)([(0,a.MZ)({type:s.A,json:{write:!0}})],v.prototype,"backgroundColor",void 0),(0,i._)([(0,a.MZ)({type:Boolean,json:{write:!0}})],v.prototype,"dotBlendingEnabled",void 0),(0,i._)([(0,a.MZ)({type:String,json:{write:!1}})],v.prototype,"dotShape",void 0),(0,i._)([(0,a.MZ)({type:Number,json:{write:!0}})],v.prototype,"dotSize",void 0),(0,i._)([(0,a.MZ)({type:m,json:{write:!0}})],v.prototype,"legendOptions",void 0),(0,i._)([(0,a.MZ)({type:_.A,json:{default:null,write:!0}})],v.prototype,"outline",void 0),(0,i._)([(0,a.MZ)({type:Number,json:{write:!0}})],v.prototype,"dotValue",void 0),(0,i._)([(0,a.MZ)({type:Number,json:{write:!0}})],v.prototype,"referenceScale",void 0),(0,i._)([(0,a.MZ)({type:Number,json:{write:!0}})],v.prototype,"seed",void 0),(0,i._)([(0,l.e)({dotDensity:"dot-density"})],v.prototype,"type",void 0),v=g=(0,i._)([(0,u.$)("esri.renderers.DotDensityRenderer")],v);const b=v},52308:function(e,t,r){r.d(t,{A:function(){return S}});var n=r(53804),i=r(52874),s=(r(10748),r(21609)),o=r(13520),a=r(23502),l=(r(58941),r(40633),r(74376)),u=r(65953),c=r(53743),p=r(30047),d=r(53871),h=r(27419),f=r(75743),y=r(30905);r(13798);let m=class extends((0,f.O)(y.oY)){constructor(){super(...arguments),this.minLabel=null,this.maxLabel=null,this.title=null}};(0,n._)([(0,a.MZ)({type:String,json:{write:!0}})],m.prototype,"minLabel",void 0),(0,n._)([(0,a.MZ)({type:String,json:{write:!0}})],m.prototype,"maxLabel",void 0),(0,n._)([(0,a.MZ)({type:String,json:{write:!0}})],m.prototype,"title",void 0),m=(0,n._)([(0,u.$)("esri.renderers.support.HeatmapLegendOptions")],m);var g,w=r(70181),_=r(90363);function v(e){if(null!=e){const{maxDensity:t,minDensity:r,radius:n}=e;if(null!=t||null!=r||null!=n){const{blurRadius:t,maxPixelIntensity:r,minPixelIntensity:n,...i}=e;return i}}return e}let b=g=class extends p.A{constructor(e){super(e),this.authoringInfo=null,this.colorStops=[new h.A({ratio:0,color:new i.A("rgba(255, 140, 0, 0)")}),new h.A({ratio:.75,color:new i.A("rgba(255, 140, 0, 1)")}),new h.A({ratio:.9,color:new i.A("rgba(255, 0,   0, 1)")})],this.field=null,this.legendOptions=null,this.maxDensity=.04,this.minDensity=0,this.radius=18,this.referenceScale=0,this.type="heatmap",this.valueExpression=null,this.valueExpressionTitle=null}normalizeCtorArgs(e){return v(e)}get blurRadius(){return(0,w.PU)(this.radius)}set blurRadius(e){const t=this.maxPixelIntensity,r=this.minPixelIntensity;this._set("radius",(0,w.zp)(e)),this._set("maxDensity",t*this._pixelIntensityToDensity),this._set("minDensity",r*this._pixelIntensityToDensity)}get maxPixelIntensity(){return this.maxDensity/this._pixelIntensityToDensity}set maxPixelIntensity(e){this._set("maxDensity",e*this._pixelIntensityToDensity)}get minPixelIntensity(){return this.minDensity/this._pixelIntensityToDensity}set minPixelIntensity(e){this._set("minDensity",e*this._pixelIntensityToDensity)}get _pixelIntensityToDensity(){return 24/(w.ex**2*this.blurRadius**4)}read(e,t){e=v(e),super.read(e,t)}getSymbol(){return new _.A}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}async collectRequiredFields(e,t){const r=this.field,n=this.valueExpression;r&&"string"==typeof r&&(0,c.rq)(e,t,r),n&&"string"==typeof n&&await(0,c.Dx)(e,t,n)}getAttributeHash(){return""}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new g({authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),colorStops:(0,s.o8)(this.colorStops),field:this.field,legendOptions:(0,s.o8)(this.legendOptions),maxDensity:this.maxDensity,minDensity:this.minDensity,radius:this.radius,referenceScale:this.referenceScale,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};(0,n._)([(0,a.MZ)({type:d.A,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],b.prototype,"authoringInfo",void 0),(0,n._)([(0,a.MZ)({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],b.prototype,"blurRadius",null),(0,n._)([(0,a.MZ)({type:[h.A],json:{write:!0}})],b.prototype,"colorStops",void 0),(0,n._)([(0,a.MZ)({type:String,json:{write:!0}})],b.prototype,"field",void 0),(0,n._)([(0,a.MZ)({type:m,json:{write:!0}})],b.prototype,"legendOptions",void 0),(0,n._)([(0,a.MZ)({type:Number,json:{write:!0}})],b.prototype,"maxDensity",void 0),(0,n._)([(0,a.MZ)({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],b.prototype,"maxPixelIntensity",null),(0,n._)([(0,a.MZ)({type:Number,json:{write:!0}})],b.prototype,"minDensity",void 0),(0,n._)([(0,a.MZ)({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],b.prototype,"minPixelIntensity",null),(0,n._)([(0,a.MZ)({type:Number,cast:o.cr,json:{write:!0}})],b.prototype,"radius",void 0),(0,n._)([(0,a.MZ)({type:Number,range:{min:0},json:{default:0,write:!0}})],b.prototype,"referenceScale",void 0),(0,n._)([(0,l.e)({heatmap:"heatmap"})],b.prototype,"type",void 0),(0,n._)([(0,a.MZ)({type:String,json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],b.prototype,"valueExpression",void 0),(0,n._)([(0,a.MZ)({type:String})],b.prototype,"valueExpressionTitle",void 0),(0,n._)([(0,a.MZ)({readOnly:!0})],b.prototype,"_pixelIntensityToDensity",null),b=g=(0,n._)([(0,u.$)("esri.renderers.HeatmapRenderer")],b);const S=b},78002:function(e,t,r){r.d(t,{A:function(){return F}});var n=r(53804),i=r(52874),s=(r(10748),r(50659)),o=r(75743),a=r(13520),l=r(23502),u=(r(58941),r(40633),r(74376)),c=r(65953),p=r(53743),d=r(30047),h=r(29970),f=r(19563),y=r(85336),m=r(30905);r(13798);let g=class extends((0,o.O)(m.oY)){constructor(){super(...arguments),this.color=new i.A([0,0,0,0]),this.label=null,this.threshold=0}};(0,n._)([(0,l.MZ)({type:i.A,json:{write:!0}})],g.prototype,"color",void 0),(0,n._)([(0,l.MZ)({type:String,json:{write:!0}})],g.prototype,"label",void 0),(0,n._)([(0,l.MZ)({type:Number,range:{min:0,max:1},json:{write:!0}})],g.prototype,"threshold",void 0),g=(0,n._)([(0,c.$)("esri.renderers.support.OthersCategory")],g);var w=r(16986),_=r(14170),v=r(53096),b=r(64494),S=r(90363),I=r(22198);const M={base:b.A,key:"type",typeMap:{size:v.A,opacity:_.A}};let x=class extends((0,h.h)((0,o.O)(d.A))){constructor(e){super(e),this.attributes=null,this.backgroundFillSymbol=null,this.defaultColor=new i.A([0,0,0,0]),this.defaultLabel=null,this.holePercentage=0,this.othersCategory=new g,this.legendOptions=null,this.outline=null,this.size=12,this.type="pie-chart",this.visualVariables=null}getSymbol(){return new S.A({size:this.size?this.size/2+(this.outline?.width||0):0})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol(),this.backgroundFillSymbol].filter(s.Ru)}getAttributeHash(){return this.visualVariables?.reduce(((e,t)=>e+t.getAttributeHash()),"")??""}getMeshHash(){return this.getSymbols().reduce(((e,t)=>e+JSON.stringify(t)),"")}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t);for(const r of this.attributes)r.valueExpression&&await(0,p.Dx)(e,t,r.valueExpression),r.field&&e.add(r.field)}};(0,n._)([(0,l.MZ)({type:[f.A],json:{write:!0}})],x.prototype,"attributes",void 0),(0,n._)([(0,l.MZ)(y.As)],x.prototype,"backgroundFillSymbol",void 0),(0,n._)([(0,l.MZ)({type:i.A,json:{write:!0}})],x.prototype,"defaultColor",void 0),(0,n._)([(0,l.MZ)({type:String,json:{write:!0}})],x.prototype,"defaultLabel",void 0),(0,n._)([(0,l.MZ)({type:Number,range:{min:0,max:1},json:{write:!0}})],x.prototype,"holePercentage",void 0),(0,n._)([(0,l.MZ)({type:g,json:{write:!0}})],x.prototype,"othersCategory",void 0),(0,n._)([(0,l.MZ)({type:w.A,json:{write:!0}})],x.prototype,"legendOptions",void 0),(0,n._)([(0,l.MZ)({type:I.A,json:{default:null,write:!0}})],x.prototype,"outline",void 0),(0,n._)([(0,l.MZ)({type:Number,cast:a.cr,json:{write:!0}})],x.prototype,"size",void 0),(0,n._)([(0,u.e)({pieChart:"pie-chart"})],x.prototype,"type",void 0),(0,n._)([(0,l.MZ)({types:[M]})],x.prototype,"visualVariables",void 0),x=(0,n._)([(0,c.$)("esri.renderers.PieChartRenderer")],x);const F=x},30047:function(e,t,r){r.d(t,{A:function(){return p}});var n=r(53804),i=r(73037),s=r(30905),o=r(23502),a=(r(58941),r(40633),r(13798),r(65953)),l=r(53871);const u=new i.J({simple:"simple",uniqueValue:"unique-value",classBreaks:"class-breaks",heatmap:"heatmap",dotDensity:"dot-density",dictionary:"dictionary",pieChart:"pie-chart"},{ignoreUnknown:!0});let c=class extends s.oY{constructor(e){super(e),this.authoringInfo=null,this.type=null}async getRequiredFields(e){if(!this.collectRequiredFields)return[];const t=new Set;return await this.collectRequiredFields(t,e),Array.from(t).sort()}getSymbol(e,t){}async getSymbolAsync(e,t){}getSymbols(){return[]}getAttributeHash(){return JSON.stringify(this)}getMeshHash(){return JSON.stringify(this)}};(0,n._)([(0,o.MZ)({type:l.A,json:{write:!0}})],c.prototype,"authoringInfo",void 0),(0,n._)([(0,o.MZ)({type:u.apiValues,readOnly:!0,json:{type:u.jsonValues,read:!1,write:{writer:u.write,ignoreOrigin:!0}}})],c.prototype,"type",void 0),c=(0,n._)([(0,a.$)("esri.renderers.Renderer")],c);const p=c},27777:function(e,t,r){r.d(t,{A:function(){return h}});var n,i=r(53804),s=r(21609),o=r(23502),a=(r(58941),r(40633),r(74376)),l=r(65953),u=r(30047),c=r(29970),p=r(85336);let d=n=class extends((0,c.h)(u.A)){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.type="simple"}async collectRequiredFields(e,t){await Promise.all([this.collectSymbolFields(e,t),this.collectVVRequiredFields(e,t)])}async collectSymbolFields(e,t){await Promise.all(this.getSymbols().map((r=>r.collectRequiredFields(e,t))))}getSymbol(e,t){return this.symbol}async getSymbolAsync(e,t){return this.symbol}getSymbols(){return this.symbol?[this.symbol]:[]}getAttributeHash(){return this.visualVariables?.reduce(((e,t)=>e+t.getAttributeHash()),"")??""}getMeshHash(){return this.getSymbols().reduce(((e,t)=>e+JSON.stringify(t)),"")}get arcadeRequired(){return this.arcadeRequiredForVisualVariables}clone(){return new n({description:this.description,label:this.label,symbol:(0,s.o8)(this.symbol),visualVariables:(0,s.o8)(this.visualVariables),authoringInfo:(0,s.o8)(this.authoringInfo)})}};(0,i._)([(0,o.MZ)({type:String,json:{write:!0}})],d.prototype,"description",void 0),(0,i._)([(0,o.MZ)({type:String,json:{write:!0}})],d.prototype,"label",void 0),(0,i._)([(0,o.MZ)(p.Wp)],d.prototype,"symbol",void 0),(0,i._)([(0,a.e)({simple:"simple"})],d.prototype,"type",void 0),d=n=(0,i._)([(0,l.$)("esri.renderers.SimpleRenderer")],d);const h=d},61065:function(e,t,r){r.d(t,{A:function(){return $}});var n=r(53804),i=r(10748),s=r(39819),o=r(21609),a=r(40633),l=r(34194),u=r(28181),c=r(23502),p=r(77560),d=r(74376),h=r(47332),f=r(65953),y=r(81392),m=r(72952),g=r(67888),w=r(53743),_=r(51432),v=r(30047),b=r(29970),S=r(85336),I=r(16986),M=r(75743),x=r(30905);r(58941),r(13798);let F=class extends((0,M.O)(x.oY)){constructor(e){super(e),this.value=null,this.value2=null,this.value3=null}};(0,n._)([(0,c.MZ)(S.Ug)],F.prototype,"value",void 0),(0,n._)([(0,c.MZ)(S.Ug)],F.prototype,"value2",void 0),(0,n._)([(0,c.MZ)(S.Ug)],F.prototype,"value3",void 0),F=(0,n._)([(0,f.$)("esri.renderers.support.UniqueValue")],F);const A=F;var T=r(50659);let C=class extends((0,M.O)(x.oY)){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.values=null}castValues(e){if(null==e)return null;const t=typeof(e=Array.isArray(e)?e:[e])[0];return"string"===t||"number"===t?e.map((e=>new A({value:e}))):"object"===t?e[0]instanceof A?e:e.map((e=>new A(e))):null}};(0,n._)([(0,c.MZ)({type:String,json:{write:!0}})],C.prototype,"description",void 0),(0,n._)([(0,c.MZ)({type:String,json:{write:!0}})],C.prototype,"label",void 0),(0,n._)([(0,c.MZ)(S.z4)],C.prototype,"symbol",void 0),(0,n._)([(0,c.MZ)({type:[A],json:{type:[[String]],read:{reader:e=>e?e.map((e=>new A({value:e[0],value2:e[1],value3:e[2]}))):null},write:{writer:(e,t)=>{const r=[];for(const t of e){const e=[t.value,t.value2,t.value3].filter(T.Ru).map((e=>e.toString()));r.push(e)}t.values=r}}}})],C.prototype,"values",void 0),(0,n._)([(0,p.w)("values")],C.prototype,"castValues",null),C=(0,n._)([(0,f.$)("esri.renderers.support.UniqueValueClass")],C);const E=C;let L=class extends((0,M.O)(x.oY)){constructor(e){super(e),this.heading=null,this.classes=null}};(0,n._)([(0,c.MZ)({type:String,json:{write:!0}})],L.prototype,"heading",void 0),(0,n._)([(0,c.MZ)({type:[E],json:{write:!0}})],L.prototype,"classes",void 0),L=(0,n._)([(0,f.$)("esri.renderers.support.UniqueValueGroup")],L);const O=L;var R,k=r(99278),N=r(54547),D=r(60534),P=r(58916),Z=r(36e3);const j="esri.renderers.UniqueValueRenderer",V=()=>a.A.getLogger(j),U="uvInfos-watcher",z="uvGroups-watcher",G=(0,g.dp)(k.A);function q(e){return null!=e&&""!==e&&("string"!=typeof e||""!==e.trim()&&"<null>"!==e.toLowerCase())||(e=null),e+""}let B=R=class extends((0,b.h)(v.A)){constructor(e){super(e),this._valueInfoMap={},this._isDefaultSymbolDerived=!1,this._isInfosSource=null,this.type="unique-value",this.backgroundFillSymbol=null,this.orderByClassesEnabled=!1,this.valueExpressionTitle=null,this.legendOptions=null,this.defaultLabel=null,this.portal=null,this.styleOrigin=null,this.diff={uniqueValueInfos(e,t){if(!e&&!t)return;if(!e||!t)return{type:"complete",oldValue:e,newValue:t};let r=!1;const n={type:"collection",added:[],removed:[],changed:[],unchanged:[]};for(let i=0;i<t.length;i++){const s=e.find((e=>e.value===t[i].value));s?(0,m.Ui)(s,t[i])?(n.changed.push({type:"complete",oldValue:s,newValue:t[i]}),r=!0):n.unchanged.push({oldValue:s,newValue:t[i]}):(n.added.push(t[i]),r=!0)}for(let i=0;i<e.length;i++)t.find((t=>t.value===e[i].value))||(n.removed.push(e[i]),r=!0);return r?n:void 0}},this._set("uniqueValueInfos",[]),this._set("uniqueValueGroups",[])}get _cache(){return{compiledFunc:null}}set field(e){this._set("field",e),this._updateFieldDelimiter(),this._updateUniqueValues()}castField(e){return null==e||"function"==typeof e?e:(0,g.GX)(e)}writeField(e,t,r,n){"string"==typeof e?t[r]=e:n?.messages?n.messages.push(new s.A("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):V().error(".field: cannot write field to JSON since it's not a string value")}set field2(e){this._set("field2",e),this._updateFieldDelimiter(),this._updateUniqueValues()}set field3(e){this._set("field3",e),this._updateUniqueValues()}set valueExpression(e){this._set("valueExpression",e),this._updateUniqueValues()}set defaultSymbol(e){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",e)}set fieldDelimiter(e){this._set("fieldDelimiter",e),this._updateUniqueValues()}readPortal(e,t,r){return r.portal||_.A.getDefault()}readStyleOrigin(e,t,r){if(t.styleName)return Object.freeze({styleName:t.styleName});if(t.styleUrl){const e=(0,D.f)(t.styleUrl,r);return Object.freeze({styleUrl:e})}}writeStyleOrigin(e,t,r,n){e.styleName?t.styleName=e.styleName:e.styleUrl&&(t.styleUrl=(0,D.t)(e.styleUrl,n))}set uniqueValueGroups(e){this.styleOrigin?V().error("#uniqueValueGroups=","Cannot modify unique value groups of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueGroups",e),this._updateInfosFromGroups(),this._isInfosSource=!1,this._watchUniqueValueGroups())}set uniqueValueInfos(e){this.styleOrigin?V().error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",e),this._updateValueInfoMap(),this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos())}addUniqueValueInfo(e,t){if(this.styleOrigin)return void V().error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let r;r="object"==typeof e?G(e):new k.A({value:e,symbol:(0,i.dp)(t)}),this.uniqueValueInfos?.push(r),this._valueInfoMap[q(r.value)]=r,this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}removeUniqueValueInfo(e){if(this.styleOrigin)return void V().error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");const t=this.uniqueValueInfos;if(t)for(let r=0;r<t.length;r++){const n=t[r];if(String(n.value)===String(e)){delete this._valueInfoMap[q(e)],t.splice(r,1);break}}this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}async getUniqueValueInfo(e,t){let r=t;return this.valueExpression&&null==t?.arcade&&(r={...r,arcade:await(0,N.lw)()}),this._getUniqueValueInfo(e,r)}getSymbol(e,t){if(this.valueExpression&&null==t?.arcade)return void V().error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const r=this._getUniqueValueInfo(e,t);return r?.symbol||this.defaultSymbol}async getSymbolAsync(e,t){let r=t;if(this.valueExpression&&null==r?.arcade){const e=await(0,N.lw)(),{arcadeUtils:t}=e;t.hasGeometryOperations(this.valueExpression)&&await t.enableGeometryOperations(),r={...r,arcade:e}}const n=this._getUniqueValueInfo(e,r);return n?.symbol||this.defaultSymbol}getSymbols(){const e=[];for(const t of this.uniqueValueInfos??[])t.symbol&&e.push(t.symbol);return this.defaultSymbol&&e.push(this.defaultSymbol),e}getAttributeHash(){return this.visualVariables?.reduce(((e,t)=>e+t.getAttributeHash()),"")??""}getMeshHash(){const e=JSON.stringify(this.backgroundFillSymbol),t=JSON.stringify(this.defaultSymbol),r=this.uniqueValueInfos?.reduce(((e,t)=>e+t.getMeshHash()),"");return`${e}.${t}.${r}.${this.field}.${this.field2}.${this.field3}.${this.fieldDelimiter}.${this.valueExpression}`}clone(){const e=new R({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:(0,o.o8)(this.defaultSymbol),orderByClassesEnabled:this.orderByClassesEnabled,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:(0,o.o8)(this.visualVariables),legendOptions:(0,o.o8)(this.legendOptions),authoringInfo:(0,o.o8)(this.authoringInfo),backgroundFillSymbol:(0,o.o8)(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(e._isDefaultSymbolDerived=!0),e._set("portal",this.portal);const t=(0,o.o8)(this.uniqueValueInfos),r=(0,o.o8)(this.uniqueValueGroups);return this.styleOrigin&&(e._set("styleOrigin",Object.freeze((0,o.o8)(this.styleOrigin))),Object.freeze(t),Object.freeze(r)),e._set("uniqueValueInfos",t),e._updateValueInfoMap(),e._set("uniqueValueGroups",r),e._isInfosSource=this._isInfosSource,e._watchUniqueValueInfosAndGroups(),e}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}async collectRequiredFields(e,t){const r=[this.collectVVRequiredFields(e,t),this.collectSymbolFields(e,t)];await Promise.all(r)}async collectSymbolFields(e,t){const r=[...this.getSymbols().map((r=>r.collectRequiredFields(e,t))),(0,w.Dx)(e,t,this.valueExpression)];(0,w.rq)(e,t,this.field),(0,w.rq)(e,t,this.field2),(0,w.rq)(e,t,this.field3),await Promise.all(r)}populateFromStyle(){return(0,P.cF)(this.styleOrigin,{portal:this.portal}).then((e=>{const t=[];return this._valueInfoMap={},e?.data&&Array.isArray(e.data.items)&&e.data.items.forEach((r=>{const n=new Z.A({styleUrl:e.styleUrl,styleName:e.styleName,portal:this.portal,name:r.name});this.defaultSymbol||r.name!==e.data.defaultItem||(this.defaultSymbol=n,this._isDefaultSymbolDerived=!0);const i=new k.A({value:r.name,symbol:n});t.push(i),this._valueInfoMap[q(r.name)]=i})),this._set("uniqueValueInfos",Object.freeze(t)),this._updateGroupsFromInfos(!0),this._isInfosSource=null,this._watchUniqueValueInfos(),!this.defaultSymbol&&this.uniqueValueInfos?.length&&(this.defaultSymbol=this.uniqueValueInfos[0].symbol,this._isDefaultSymbolDerived=!0),this}))}_updateFieldDelimiter(){this.field&&this.field2&&!this.fieldDelimiter&&this._set("fieldDelimiter",",")}_updateUniqueValues(){null!=this._isInfosSource&&(this._isInfosSource?this._updateGroupsFromInfos():this._updateInfosFromGroups())}_updateValueInfoMap(){this._valueInfoMap={};const{uniqueValueInfos:e}=this;if(e)for(const t of e)this._valueInfoMap[q(t.value)]=t}_watchUniqueValueInfosAndGroups(){this._watchUniqueValueInfos(),this._watchUniqueValueGroups()}_watchUniqueValueInfos(){this.removeHandles(U);const{uniqueValueInfos:e}=this;if(e){const t=[];for(const r of e)t.push((0,u.watch)((()=>({symbol:r.symbol,value:r.value,label:r.label,description:r.description})),((e,t)=>{e!==t&&(this._updateGroupsFromInfos(),this._isInfosSource=!0)}),{sync:!0}));this.addHandles(t,U)}}_watchUniqueValueGroups(){this.removeHandles(z);const{uniqueValueGroups:e}=this;if(e){const t=[];for(const r of e){t.push((0,u.watch)((()=>({classes:r.classes})),((e,t)=>{e!==t&&(this._updateInfosFromGroups(),this._isInfosSource=!1)}),{sync:!0}));for(const e of r.classes??[])t.push((0,u.watch)((()=>({symbol:e.symbol,values:e.values,label:e.label,description:e.description})),((e,t)=>{e!==t&&(this._updateInfosFromGroups(),this._isInfosSource=!1)}),{sync:!0}))}this.addHandles(t,z)}}_updateInfosFromGroups(){if(!this.uniqueValueGroups)return this._set("uniqueValueInfos",null),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const e=[],{field:t,field2:r,field3:n,fieldDelimiter:i,uniqueValueGroups:s,valueExpression:o}=this;if(!t&&!o)return this._set("uniqueValueInfos",e),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const a=!(!t||!r);for(const t of s)for(const s of t.classes??[]){const{symbol:t,label:o,values:l,description:u}=s;for(const s of l??[]){const{value:l,value2:c,value3:p}=s,d=[l];r&&d.push(c),n&&d.push(p);const h=a?d.join(i||""):d[0]??void 0;e.push(new k.A({symbol:t,label:o,value:h,description:u}))}}this._set("uniqueValueInfos",e),this._updateValueInfoMap(),this._watchUniqueValueInfos()}_updateGroupsFromInfos(e=!1){if(!this.uniqueValueInfos)return this._set("uniqueValueGroups",null),void this._watchUniqueValueGroups();const{field:t,field2:r,valueExpression:n,fieldDelimiter:i,uniqueValueInfos:s}=this;if(!t&&!n||!s.length)return this._set("uniqueValueGroups",[]),void this._watchUniqueValueGroups();const o=!(!t||!r),a=s.map((e=>{const{symbol:t,label:r,value:n,description:s}=e,[a,l,u]=o?n?.toString()?.split(i||"")||[]:[n];return new E({symbol:t,label:r,description:s,values:[new A({value:a,value2:l,value3:u})]})})),l=[new O({classes:a})];e&&Object.freeze(l),this._set("uniqueValueGroups",l),this._watchUniqueValueGroups()}_getUniqueValueInfo(e,t){return this.valueExpression?this._getUnqiueValueInfoForExpression(e,t):this._getUnqiueValueInfoForFields(e)}_getUnqiueValueInfoForExpression(e,t){const{viewingMode:r,scale:n,spatialReference:i,arcade:s,timeZone:o}=t??{};let a=this._cache.compiledFunc;const l=s.arcadeUtils;if(!a){const e=l.createSyntaxTree(this.valueExpression);a=l.createFunction(e),this._cache.compiledFunc=a}const u=l.executeFunction(a,l.createExecContext(e,l.getViewInfo({viewingMode:r,scale:n,spatialReference:i}),o));return this._valueInfoMap[q(u)]}_getUnqiueValueInfoForFields(e){const t=this.field,r=e.attributes;let n;if(this.field2){const e=this.field2,i=this.field3,s=[];t&&s.push(r[t]),e&&s.push(r[e]),i&&s.push(r[i]),n=s.join(this.fieldDelimiter||"")}else t&&(n=r[t]);return this._valueInfoMap[q(n)]}static fromPortalStyle(e,t){const r=new R(t?.properties);r._set("styleOrigin",Object.freeze({styleName:e})),r._set("portal",t?.portal||_.A.getDefault());const n=r.populateFromStyle();return n.catch((t=>{V().error(`#fromPortalStyle('${e}'[, ...])`,"Failed to create unique value renderer from style name",t)})),n}static fromStyleUrl(e,t){const r=new R(t?.properties);r._set("styleOrigin",Object.freeze({styleUrl:e}));const n=r.populateFromStyle();return n.catch((t=>{V().error(`#fromStyleUrl('${e}'[, ...])`,"Failed to create unique value renderer from style URL",t)})),n}};(0,n._)([(0,c.MZ)({readOnly:!0})],B.prototype,"_cache",null),(0,n._)([(0,d.e)({uniqueValue:"unique-value"})],B.prototype,"type",void 0),(0,n._)([(0,c.MZ)(S.As)],B.prototype,"backgroundFillSymbol",void 0),(0,n._)([(0,c.MZ)({value:null,json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],B.prototype,"field",null),(0,n._)([(0,p.w)("field")],B.prototype,"castField",null),(0,n._)([(0,y.K)("field")],B.prototype,"writeField",null),(0,n._)([(0,c.MZ)({type:String,value:null,json:{write:!0}})],B.prototype,"field2",null),(0,n._)([(0,c.MZ)({type:String,value:null,json:{write:!0}})],B.prototype,"field3",null),(0,n._)([(0,c.MZ)({type:Boolean,json:{name:"drawInClassOrder",default:!1,write:!0,origins:{"web-scene":{write:!1}}}})],B.prototype,"orderByClassesEnabled",void 0),(0,n._)([(0,c.MZ)({type:String,value:null,json:{write:!0}})],B.prototype,"valueExpression",null),(0,n._)([(0,c.MZ)({type:String,json:{write:!0}})],B.prototype,"valueExpressionTitle",void 0),(0,n._)([(0,c.MZ)({type:I.A,json:{write:!0}})],B.prototype,"legendOptions",void 0),(0,n._)([(0,c.MZ)({type:String,json:{write:!0}})],B.prototype,"defaultLabel",void 0),(0,n._)([(0,c.MZ)((0,l.$N)({...S.z4},{json:{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}},origins:{"web-scene":{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}}}}}}))],B.prototype,"defaultSymbol",null),(0,n._)([(0,c.MZ)({type:String,value:null,json:{write:!0}})],B.prototype,"fieldDelimiter",null),(0,n._)([(0,c.MZ)({type:_.A,readOnly:!0})],B.prototype,"portal",void 0),(0,n._)([(0,h.w)("portal",["styleName"])],B.prototype,"readPortal",null),(0,n._)([(0,c.MZ)({readOnly:!0,json:{write:{enabled:!1,overridePolicy:()=>({enabled:!0})}}})],B.prototype,"styleOrigin",void 0),(0,n._)([(0,h.w)("styleOrigin",["styleName","styleUrl"])],B.prototype,"readStyleOrigin",null),(0,n._)([(0,y.K)("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],B.prototype,"writeStyleOrigin",null),(0,n._)([(0,c.MZ)({type:[O],json:{read:{source:["uniqueValueGroups","uniqueValueInfos"],reader:(e,t,r)=>(t.uniqueValueGroups||function(e){const{field1:t,field2:r,field3:n,fieldDelimiter:i,uniqueValueInfos:s,valueExpression:o}=e,a=!(!t||!r);return[{classes:(s??[]).map((e=>{const{symbol:s,label:l,value:u,description:c}=e,[p,d,h]=a?u?.toString()?.split(i||"")||[]:[u],f=[];return(t||o)&&f.push(p),r&&f.push(d),n&&f.push(h),{symbol:s,label:l,values:[f],description:c}}))}]}(t)).map((e=>O.fromJSON(e,r)))},write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],B.prototype,"uniqueValueGroups",null),(0,n._)([(0,c.MZ)({type:[k.A],json:{read:!1,write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],B.prototype,"uniqueValueInfos",null),B=R=(0,n._)([(0,f.$)(j)],B);const $=B},29970:function(e,t,r){r.d(t,{h:function(){return x}});var n=r(53804),i=r(23502),s=(r(58941),r(40633)),o=(r(13798),r(47332)),a=r(65953),l=r(81392),u=r(53743);const c=/^hash\(\$feature\['((\\'|[^'])+)'\]\) \* 8\.381e-8$/;var p=r(74843),d=r(14170),h=r(36604),f=r(53096),y=r(64494),m=r(83525),g=r(73037),w=r(89001);const _={color:p.A,size:f.A,opacity:d.A,rotation:h.A},v=new g.J({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),b=/^\[([^\]]+)\]$/i;let S=class extends m.A{constructor(){super(...arguments),this.colorVariables=null,this.opacityVariables=null,this.rotationVariables=null,this.sizeVariables=null}set visualVariables(e){if(this._resetVariables(),e=e?.filter((e=>!!e)),e?.length){for(const t of e)switch(t.type){case"color":this.colorVariables.push(t);break;case"opacity":this.opacityVariables.push(t);break;case"rotation":this.rotationVariables.push(t);break;case"size":this.sizeVariables.push(t)}this.sizeVariables.length&&this.sizeVariables.some((e=>!!e.target))&&e.sort(((e,t)=>{let r=null;return r=e.target===t.target?0:e.target?1:-1,r}));for(let t=0;t<e.length;t++)e[t].index=t;this._set("visualVariables",e)}else this._set("visualVariables",e)}readVariables(e,t,r){const{rotationExpression:n,rotationType:i}=t,o=n?.match(b),a=o?.[1];if(a&&(e||(e=[]),e.push({type:"rotationInfo",rotationType:i,field:a})),e)return e.map((e=>{const t=v.read(e.type),n=_[t];n||(s.A.getLogger(this).warn(`Unknown variable type: ${t}`),r?.messages&&r.messages.push(new w.A("visual-variable:unsupported",`visualVariable of type '${t}' is not supported`,{definition:e,context:r})));const i=new n;return i.read(e,r),i}))}writeVariables(e,t){const r=[];for(const n of e){const e=n.toJSON(t);e&&r.push(e)}return r}_resetVariables(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]}};(0,n._)([(0,i.MZ)()],S.prototype,"visualVariables",null),S=(0,n._)([(0,a.$)("esri.renderers.visualVariables.VisualVariableFactory")],S);const I=S,M={base:y.A,key:"type",typeMap:{opacity:d.A,color:p.A,rotation:h.A,size:f.A}},x=e=>{let t=class extends e{constructor(){super(...arguments),this._vvFactory=new I}set visualVariables(e){this._vvFactory.visualVariables=e,this._set("visualVariables",this._vvFactory.visualVariables)}readVisualVariables(e,t,r){return this._vvFactory.readVariables(e,t,r)}writeVisualVariables(e,t,r,n){t[r]=this._vvFactory.writeVariables(e,n)}get arcadeRequiredForVisualVariables(){if(!this.visualVariables)return!1;for(const e of this.visualVariables)if(e.arcadeRequired)return!0;return!1}hasVisualVariables(e,t){return e?this.getVisualVariablesForType(e,t).length>0:this.getVisualVariablesForType("size",t).length>0||this.getVisualVariablesForType("color",t).length>0||this.getVisualVariablesForType("opacity",t).length>0||this.getVisualVariablesForType("rotation",t).length>0}getVisualVariablesForType(e,t){const r=this.visualVariables;return r?r.filter((r=>r.type===e&&("string"==typeof t?r.target===t:!1!==t||!r.target))):[]}async collectVVRequiredFields(e,t){let r=[];this.visualVariables&&(r=r.concat(this.visualVariables));for(const n of r)n&&(n.field&&(0,u.rq)(e,t,n.field),n.normalizationField&&(0,u.rq)(e,t,n.normalizationField),n.valueExpression&&(F(n.valueExpression,e,t)||await(0,u.Dx)(e,t,n.valueExpression)))}};return(0,n._)([(0,i.MZ)({types:[M],value:null,json:{write:!0}})],t.prototype,"visualVariables",null),(0,n._)([(0,o.w)("visualVariables",["visualVariables","rotationType","rotationExpression"])],t.prototype,"readVisualVariables",null),(0,n._)([(0,l.K)("visualVariables")],t.prototype,"writeVisualVariables",null),t=(0,n._)([(0,a.$)("esri.renderers.mixins.VisualVariablesMixin")],t),t};function F(e,t,r){const n=(i=e,i.match(c)?.[1]?.replace(/\\'/g,"'")??null);var i;return null!=n&&((0,u.rq)(t,r,n),!0)}},19563:function(e,t,r){r.d(t,{A:function(){return h}});var n,i=r(53804),s=r(52874),o=r(30905),a=r(40633),l=r(23502),u=r(77560),c=(r(13798),r(58941),r(65953)),p=r(67888);let d=n=class extends o.oY{constructor(e){super(e),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(e){return null==e?e:"function"==typeof e?(a.A.getLogger(this).error(".field: field must be a string value"),null):(0,p.GX)(e)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){return new n({color:this.color?.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};(0,i._)([(0,l.MZ)({type:s.A,json:{type:[Number],write:!0}})],d.prototype,"color",void 0),(0,i._)([(0,l.MZ)({type:String,json:{write:!0}})],d.prototype,"field",void 0),(0,i._)([(0,u.w)("field")],d.prototype,"castField",null),(0,i._)([(0,l.MZ)({type:String,json:{write:!0}})],d.prototype,"label",void 0),(0,i._)([(0,l.MZ)({type:String,json:{write:!0}})],d.prototype,"valueExpression",void 0),(0,i._)([(0,l.MZ)({type:String,json:{write:!0}})],d.prototype,"valueExpressionTitle",void 0),d=n=(0,i._)([(0,c.$)("esri.renderers.support.AttributeColorInfo")],d);const h=d},53871:function(e,t,r){r.d(t,{A:function(){return N}});var n,i=r(53804),s=r(73037),o=r(30905),a=r(21609),l=r(23502),u=r(67888),c=r(47332),p=r(65953);r(58941),r(40633),r(13798);let d=n=class extends o.oY{constructor(e){super(e),this.minValue=0,this.maxValue=0}clone(){return new n({minValue:this.minValue,maxValue:this.maxValue})}};var h;(0,i._)([(0,l.MZ)({type:Number,json:{write:!0}})],d.prototype,"minValue",void 0),(0,i._)([(0,l.MZ)({type:Number,json:{write:!0}})],d.prototype,"maxValue",void 0),d=n=(0,i._)([(0,p.$)("esri.renderers.support.AuthoringInfoClassBreakInfo")],d);let f=h=class extends o.oY{constructor(e){super(e),this.field="",this.normalizationField="",this.label="",this.classBreakInfos=new Array}clone(){return new h({field:this.field,normalizationField:this.normalizationField,label:this.label,classBreakInfos:(0,a.o8)(this.classBreakInfos)})}};(0,i._)([(0,l.MZ)({type:String,json:{write:!0}})],f.prototype,"field",void 0),(0,i._)([(0,l.MZ)({type:String,json:{write:!0}})],f.prototype,"normalizationField",void 0),(0,i._)([(0,l.MZ)({type:String,json:{write:!0}})],f.prototype,"label",void 0),(0,i._)([(0,l.MZ)({type:[d],json:{write:!0}})],f.prototype,"classBreakInfos",void 0),f=h=(0,i._)([(0,p.$)("esri.renderers.support.AuthoringInfoFieldInfo")],f);var y,m=r(77560);let g=y=class extends o.oY{constructor(e){super(e),this.label=null,this.size=null,this.value=null}clone(){return new y({label:this.label,value:this.value,size:this.size})}};(0,i._)([(0,l.MZ)({type:String,json:{write:!0}})],g.prototype,"label",void 0),(0,i._)([(0,l.MZ)({type:Number,json:{write:!0}})],g.prototype,"size",void 0),(0,i._)([(0,l.MZ)({type:Number,json:{write:!0}})],g.prototype,"value",void 0),g=y=(0,i._)([(0,p.$)("esri.renderers.support.AuthoringInfoSizeStop")],g);const w=g;var _;const v=new s.J({percentTotal:"percent-of-total",ratio:"ratio",percent:"percent"}),b=new s.J({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),S={key:e=>"number"==typeof e?"number":"string",typeMap:{number:Number,string:String},base:null},I=["high-to-low","above-and-below","centered-on","extremes"],M=[...new Set(["high-to-low","above-and-below","centered-on","extremes","above","below","high-to-low","above-and-below","above","below","reference-size"])],x=["seconds","minutes","hours","days","months","years"];let F=_=class extends o.oY{constructor(e){super(e),this.endTime=null,this.field=null,this.maxSliderValue=null,this.minSliderValue=null,this.startTime=null,this.type=null,this.units=null}castEndTime(e){return"string"==typeof e||"number"==typeof e?e:null}get normalizationField(){return"reference-size"===this.theme?this._get("normalizationField"):null}set normalizationField(e){this._set("normalizationField",e)}get referenceSizeScale(){return"reference-size"===this.theme?this._get("referenceSizeScale"):null}set referenceSizeScale(e){this._set("referenceSizeScale",e)}get referenceSizeSymbolStyle(){return"reference-size"===this.theme?this._get("referenceSizeSymbolStyle"):null}set referenceSizeSymbolStyle(e){this._set("referenceSizeSymbolStyle",e)}castStartTime(e){return"string"==typeof e||"number"==typeof e?e:null}get sizeStops(){return"reference-size"===this.theme?this._get("sizeStops"):null}set sizeStops(e){this._set("sizeStops",e)}get style(){return"color"===this.type?this._get("style"):null}set style(e){this._set("style",e)}get theme(){return"color"===this.type||"size"===this.type?this._get("theme")||"high-to-low":null}set theme(e){this._set("theme",e)}clone(){return new _({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,normalizationField:this.normalizationField,referenceSizeScale:this.referenceSizeScale,referenceSizeSymbolStyle:this.referenceSizeSymbolStyle,sizeStops:(0,a.o8)(this.sizeStops),startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})}};(0,i._)([(0,l.MZ)({types:S,json:{write:!0}})],F.prototype,"endTime",void 0),(0,i._)([(0,m.w)("endTime")],F.prototype,"castEndTime",null),(0,i._)([(0,l.MZ)({type:String,json:{write:!0}})],F.prototype,"field",void 0),(0,i._)([(0,l.MZ)({type:Number,json:{write:!0}})],F.prototype,"maxSliderValue",void 0),(0,i._)([(0,l.MZ)({type:Number,json:{write:!0}})],F.prototype,"minSliderValue",void 0),(0,i._)([(0,l.MZ)({type:String,json:{origins:{"web-scene":{write:!1}},write:!0}})],F.prototype,"normalizationField",null),(0,i._)([(0,l.MZ)({type:Number,value:null,json:{origins:{"web-scene":{write:!1}},write:!0}})],F.prototype,"referenceSizeScale",null),(0,i._)([(0,l.MZ)({type:["circle","diamond","hexagon-flat","hexagon-pointy","square"],value:null,json:{origins:{"web-scene":{write:!1}},write:!0}})],F.prototype,"referenceSizeSymbolStyle",null),(0,i._)([(0,l.MZ)({types:S,json:{write:!0}})],F.prototype,"startTime",void 0),(0,i._)([(0,m.w)("startTime")],F.prototype,"castStartTime",null),(0,i._)([(0,l.MZ)({type:[w],json:{origins:{"web-scene":{write:!1}},write:!0}})],F.prototype,"sizeStops",null),(0,i._)([(0,l.MZ)({type:v.apiValues,value:null,json:{type:v.jsonValues,read:v.read,write:v.write}})],F.prototype,"style",null),(0,i._)([(0,l.MZ)({type:M,value:null,json:{type:M,origins:{"web-scene":{type:I,write:{writer:(e,t)=>{I.includes(e)&&(t.theme=e)}}}},write:!0}})],F.prototype,"theme",null),(0,i._)([(0,l.MZ)({type:b.apiValues,json:{type:b.jsonValues,read:b.read,write:b.write}})],F.prototype,"type",void 0),(0,i._)([(0,l.MZ)({type:x,json:{type:x,write:!0}})],F.prototype,"units",void 0),F=_=(0,i._)([(0,p.$)("esri.renderers.support.AuthoringInfoVisualVariable")],F);const A=F;var T,C=r(85982);const E=new s.J({esriClassifyDefinedInterval:"defined-interval",esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),L=new s.J({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density",flow:"flow"}),O=new s.J({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density"}),R=["inches","feet","yards","miles","nautical-miles","millimeters","centimeters","decimeters","meters","kilometers"];let k=T=class extends o.oY{constructor(e){super(e),this.colorRamp=null,this.fadeRatio=null,this.isAutoGenerated=!1,this.lengthUnit=null,this.maxSliderValue=null,this.minSliderValue=null,this.visualVariables=null}get classificationMethod(){const e=this._get("classificationMethod"),t=this.type;return t&&"relationship"!==t?"class-breaks-size"===t||"class-breaks-color"===t?e||"manual":null:e}set classificationMethod(e){this._set("classificationMethod",e)}readColorRamp(e){return e?(0,C.r)(e):void 0}get fields(){return this.type&&"predominance"!==this.type?null:this._get("fields")}set fields(e){this._set("fields",e)}get field1(){return this.type&&"relationship"!==this.type?null:this._get("field1")}set field1(e){this._set("field1",e)}get field2(){return this.type&&"relationship"!==this.type?null:this._get("field2")}set field2(e){this._set("field2",e)}get flowTheme(){return"flow"===this.type?this._get("flowTheme"):null}set flowTheme(e){this._set("flowTheme",e)}get focus(){return this.type&&"relationship"!==this.type?null:this._get("focus")}set focus(e){this._set("focus",e)}get numClasses(){return this.type&&"relationship"!==this.type?null:this._get("numClasses")}set numClasses(e){this._set("numClasses",e)}get statistics(){return"univariate-color-size"===this.type&&"above-and-below"===this.univariateTheme?this._get("statistics"):null}set statistics(e){this._set("statistics",e)}get standardDeviationInterval(){const e=this.type;return e&&"relationship"!==e&&"class-breaks-size"!==e&&"class-breaks-color"!==e||this.classificationMethod&&"standard-deviation"!==this.classificationMethod?null:this._get("standardDeviationInterval")}set standardDeviationInterval(e){this._set("standardDeviationInterval",e)}get type(){return this._get("type")}set type(e){let t=e;"classed-size"===e?t="class-breaks-size":"classed-color"===e&&(t="class-breaks-color"),this._set("type",t)}get univariateSymbolStyle(){return"univariate-color-size"===this.type&&"above-and-below"===this.univariateTheme?this._get("univariateSymbolStyle"):null}set univariateSymbolStyle(e){this._set("univariateSymbolStyle",e)}get univariateTheme(){return"univariate-color-size"===this.type?this._get("univariateTheme"):null}set univariateTheme(e){this._set("univariateTheme",e)}clone(){return new T({classificationMethod:this.classificationMethod,colorRamp:(0,a.o8)(this.colorRamp),fadeRatio:(0,a.o8)(this.fadeRatio),fields:this.fields?.slice(),field1:(0,a.o8)(this.field1),field2:(0,a.o8)(this.field2),isAutoGenerated:this.isAutoGenerated,focus:this.focus,numClasses:this.numClasses,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,lengthUnit:this.lengthUnit,statistics:this.statistics,standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map((e=>e.clone())),univariateSymbolStyle:this.univariateSymbolStyle,univariateTheme:this.univariateTheme,flowTheme:this.flowTheme})}};(0,i._)([(0,l.MZ)({type:E.apiValues,value:null,json:{type:E.jsonValues,read:E.read,write:E.write,origins:{"web-document":{default:"manual",type:E.jsonValues,read:E.read,write:E.write}}}})],k.prototype,"classificationMethod",null),(0,i._)([(0,l.MZ)({types:C.g,json:{write:!0}})],k.prototype,"colorRamp",void 0),(0,i._)([(0,c.w)("colorRamp")],k.prototype,"readColorRamp",null),(0,i._)([(0,l.MZ)({json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],k.prototype,"fadeRatio",void 0),(0,i._)([(0,l.MZ)({type:[String],value:null,json:{write:!0}})],k.prototype,"fields",null),(0,i._)([(0,l.MZ)({type:f,value:null,json:{write:!0}})],k.prototype,"field1",null),(0,i._)([(0,l.MZ)({type:f,value:null,json:{write:!0}})],k.prototype,"field2",null),(0,i._)([(0,l.MZ)({type:["flow-line","wave-front"],value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],k.prototype,"flowTheme",null),(0,i._)([(0,l.MZ)({type:["HH","HL","LH","LL"],value:null,json:{write:!0}})],k.prototype,"focus",null),(0,i._)([(0,l.MZ)({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1}}}})],k.prototype,"isAutoGenerated",void 0),(0,i._)([(0,l.MZ)({type:Number,value:null,json:{type:u.jz,write:!0}})],k.prototype,"numClasses",null),(0,i._)([(0,l.MZ)({type:R,json:{type:R,read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],k.prototype,"lengthUnit",void 0),(0,i._)([(0,l.MZ)({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],k.prototype,"maxSliderValue",void 0),(0,i._)([(0,l.MZ)({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],k.prototype,"minSliderValue",void 0),(0,i._)([(0,l.MZ)({type:Object,value:null,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],k.prototype,"statistics",null),(0,i._)([(0,l.MZ)({type:[.25,.33,.5,1],value:null,json:{type:[.25,.33,.5,1],write:!0}})],k.prototype,"standardDeviationInterval",null),(0,i._)([(0,l.MZ)({type:L.apiValues,value:null,json:{type:L.jsonValues,read:L.read,write:L.write,origins:{"web-scene":{type:O.jsonValues,write:{writer:O.write,overridePolicy:e=>({enabled:"flow"!==e})}}}}})],k.prototype,"type",null),(0,i._)([(0,l.MZ)({type:[A],json:{write:!0}})],k.prototype,"visualVariables",void 0),(0,i._)([(0,l.MZ)({type:["caret","circle-caret","arrow","circle-arrow","plus-minus","circle-plus-minus","square","circle","triangle","happy-sad","thumb","custom"],value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],k.prototype,"univariateSymbolStyle",null),(0,i._)([(0,l.MZ)({type:["high-to-low","above-and-below","above","below"],value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],k.prototype,"univariateTheme",null),k=T=(0,i._)([(0,p.$)("esri.renderers.support.AuthoringInfo")],k);const N=k},23879:function(e,t,r){r.d(t,{A:function(){return c}});var n,i=r(53804),s=r(30905),o=r(23502),a=(r(58941),r(40633),r(13798),r(65953)),l=r(85336);let u=n=class extends s.oY{constructor(e){super(e),this.description=null,this.label=null,this.minValue=null,this.maxValue=0,this.symbol=null}clone(){return new n({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:this.symbol?.clone()??null})}getMeshHash(){const e=JSON.stringify(this.symbol);return`${this.minValue}.${this.maxValue}.${e}`}};(0,i._)([(0,o.MZ)({type:String,json:{write:!0}})],u.prototype,"description",void 0),(0,i._)([(0,o.MZ)({type:String,json:{write:!0}})],u.prototype,"label",void 0),(0,i._)([(0,o.MZ)({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],u.prototype,"minValue",void 0),(0,i._)([(0,o.MZ)({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],u.prototype,"maxValue",void 0),(0,i._)([(0,o.MZ)(l.Wp)],u.prototype,"symbol",void 0),u=n=(0,i._)([(0,a.$)("esri.renderers.support.ClassBreakInfo")],u);const c=u},27419:function(e,t,r){r.d(t,{A:function(){return p}});var n,i=r(53804),s=r(52874),o=r(30905),a=r(23502),l=r(67888),u=(r(13798),r(58941),r(65953));let c=n=class extends o.oY{constructor(e){super(e),this.color=null,this.ratio=null}clone(){return new n({color:this.color&&this.color.clone(),ratio:this.ratio})}};(0,i._)([(0,a.MZ)({type:s.A,json:{type:[l.jz],default:null,write:!0}})],c.prototype,"color",void 0),(0,i._)([(0,a.MZ)({type:Number,json:{write:!0}})],c.prototype,"ratio",void 0),c=n=(0,i._)([(0,u.$)("esri.renderers.support.HeatmapColorStop")],c);const p=c},16986:function(e,t,r){r.d(t,{A:function(){return d}});var n=r(53804),i=r(75743),s=r(73037),o=r(30905),a=r(23502),l=(r(58941),r(40633),r(13798),r(74376)),u=r(65953);const c=(0,s.O)()({ascendingValues:"ascending-values",descendingValues:"descending-values"});let p=class extends((0,i.O)(o.oY)){constructor(e){super(e),this.title=null,this.order=null}};(0,n._)([(0,a.MZ)({type:String,json:{write:!0}})],p.prototype,"title",void 0),(0,n._)([(0,l.e)(c)],p.prototype,"order",void 0),p=(0,n._)([(0,u.$)("esri.renderers.support.RendererLegendOptions")],p);const d=p},99278:function(e,t,r){r.d(t,{A:function(){return c}});var n,i=r(53804),s=r(30905),o=r(23502),a=(r(58941),r(40633),r(13798),r(65953)),l=r(85336);let u=n=class extends s.oY{constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.value=null}clone(){return new n({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const e=JSON.stringify(this.symbol?.toJSON());return`${this.value}.${e}`}};(0,i._)([(0,o.MZ)({type:String,json:{write:!0}})],u.prototype,"description",void 0),(0,i._)([(0,o.MZ)({type:String,json:{write:!0}})],u.prototype,"label",void 0),(0,i._)([(0,o.MZ)(l.Wp)],u.prototype,"symbol",void 0),(0,i._)([(0,o.MZ)(l.Ug)],u.prototype,"value",void 0),u=n=(0,i._)([(0,a.$)("esri.renderers.support.UniqueValueInfo")],u);const c=u},85336:function(e,t,r){r.d(t,{As:function(){return p},Ug:function(){return d},Wp:function(){return c},z4:function(){return u}});var n=r(10748),i=r(34194),s=r(51575),o=r(8404),a=r(34563),l=r(15186);const u={types:n.xK,json:{write:{writer:o.M9},origins:{"web-scene":{types:n.On,write:{writer:o.M9},read:{reader:(0,s.C)({types:n.On})}}}}},c=(0,i.$N)({json:{origins:{"web-scene":{write:{isRequired:!0}}}}},u),p={types:{base:a.A,key:"type",typeMap:{"simple-fill":n.Es.typeMap["simple-fill"],"picture-fill":n.Es.typeMap["picture-fill"],"polygon-3d":n.Es.typeMap["polygon-3d"],cim:n.Es.typeMap.cim}},json:{write:{writer:o.M9},origins:{"web-scene":{type:l.A,write:{writer:o.M9}}}}},d={cast:e=>null==e||"string"==typeof e||"number"==typeof e?e:`${e}`,json:{type:String,write:{writer:(e,t)=>{t.value=e?.toString()}}}}},70181:function(e,t,r){r.d(t,{O3:function(){return p},PU:function(){return u},YW:function(){return h},ex:function(){return a},hv:function(){return d},zp:function(){return l}});var n=r(15774),i=r(13520),s=r(33400),o=r(41546);const a=2.4;function l(e){return(0,i.PN)(e*a)}function u(e){return(0,i.Lz)(e)/a}function c(e,t,r,i){let{color:o,ratio:a}=t,{color:l,ratio:u}=r;if(u===a){const e=1e-6;1===u?a-=e:u+=e}const c=(0,n.qE)((i-a)/(u-a),0,1);(0,s.l)(e,o.toArray(),l.toArray(),c)}function p(e){const t=new Uint8ClampedArray(2048);if((e=e.filter((({ratio:e})=>e>=0&&e<=1)).sort(((e,t)=>e.ratio-t.ratio)).map((({color:e,ratio:t})=>({color:e,ratio:Math.max(t,.001)})))).length<1)return t;let r=e[0],n=e[0],i=1;const s=(0,o.vt)();for(let o=0;o<512;o++){const a=(o+.5)/512;for(;a>n.ratio&&i<e.length;)r=n,n=e[i++];c(s,r,n,a),t.set(s,4*o)}return t}function d(e,t,r){const n=Math.sqrt(e**2+t**2)/r;return n>1?0:3/(Math.PI*r**2)*(1-n**2)**2}function h(e){return"function"==typeof e?e:e?t=>+t[e]:()=>1}},6537:function(e,t,r){r.d(t,{L:function(){return l},r:function(){return o}});var n=r(89001),i=r(51575),s=r(31315);function o(e,t){return l(e,null,t)}const a=(0,i.C)({types:s.H});function l(e,t,r){return e?e&&(e.styleName||e.styleUrl)&&"uniqueValue"!==e.type?(r?.messages&&r.messages.push(new n.A("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+e.type+"'",{definition:e,context:r})),null):a(e,t,r):null}},52374:function(e,t,r){r.d(t,{L:function(){return o}});var n=r(77472),i=r(60539),s=r(89001);async function o(e,t,r){const o=e&&e.getAtOrigin&&e.getAtOrigin("renderer",t.origin);if(o&&"unique-value"===o.type&&o.styleOrigin){const a=await(0,n.Ke)(o.populateFromStyle());if((0,i.Te)(r),!1===a.ok){const r=a.error;t?.messages&&t.messages.push(new s.A("renderer:style-reference",`Failed to create unique value renderer from style reference: ${r.message}`,{error:r,context:t})),e.clear("renderer",t?.origin)}}}},31315:function(e,t,r){r.d(t,{H:function(){return d},X:function(){return h}});var n=r(40633),i=r(74865),s=r(1526),o=r(96173),a=r(52308),l=r(78002),u=r(30047),c=r(27777),p=r(61065);const d={key:"type",base:u.A,typeMap:{heatmap:a.A,simple:c.A,"unique-value":p.A,"class-breaks":i.A,"dot-density":o.A,dictionary:s.A,"pie-chart":l.A},errorContext:"renderer"},h={key:"type",base:u.A,typeMap:{simple:c.A,"unique-value":p.A,"class-breaks":i.A,heatmap:a.A},errorContext:"renderer",validate:function(e){switch(e.type){case"simple":return function(e){if(e.symbol)return e;n.A.getLogger("esri.renderers.support.types").error("Removed invalid 'simple' renderer without a symbol from web scene.")}(e);case"unique-value":return function(e){const t=e.uniqueValueInfos,r=t?.filter((({symbol:e,label:t},r)=>(e||n.A.getLogger("esri.renderers.support.types").error(`Removed invalid unique value info ([${r}] ${t}) without a symbol from web scene.`),!!e)));return r?.length!==t?.length&&(e.uniqueValueInfos=r),e}(e);case"class-breaks":return function(e){const t=e.classBreakInfos,r=t?.filter((({symbol:e,label:t},r)=>(e||n.A.getLogger("esri.renderers.support.types").error(`Removed invalid class break info ([${r}] ${t}) without a symbol from web scene.`),!!e)));return r?.length!==t?.length&&(e.classBreakInfos=r),e}(e);case"heatmap":return e}}}},74843:function(e,t,r){r.d(t,{A:function(){return c}});var n,i=r(53804),s=r(23502),o=(r(58941),r(40633),r(13798),r(65953)),a=r(64494),l=r(71859);let u=n=class extends a.A{constructor(e){super(e),this.type="color",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(e){e&&Array.isArray(e)&&(e=e.filter((e=>!!e))).sort(((e,t)=>e.value-t.value)),this._set("stops",e)}clone(){return new n({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map((e=>e.clone())),legendOptions:this.legendOptions?.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map((e=>e.value||0))}};(0,i._)([(0,s.MZ)({readOnly:!0})],u.prototype,"cache",null),(0,i._)([(0,s.MZ)({type:["color"],json:{type:["colorInfo"]}})],u.prototype,"type",void 0),(0,i._)([(0,s.MZ)({type:String,json:{write:!0}})],u.prototype,"normalizationField",void 0),(0,i._)([(0,s.MZ)({type:[l.A],json:{write:!0}})],u.prototype,"stops",null),u=n=(0,i._)([(0,o.$)("esri.renderers.visualVariables.ColorVariable")],u);const c=u},14170:function(e,t,r){r.d(t,{A:function(){return g}});var n,i=r(53804),s=r(23502),o=(r(58941),r(40633),r(13798),r(65953)),a=r(64494),l=r(30905),u=r(67888),c=r(47332),p=r(81392),d=r(59798);let h=n=class extends l.oY{constructor(e){super(e),this.label=null,this.opacity=null,this.value=null}readOpacity(e,t){return(0,d.D)(t.transparency)}writeOpacity(e,t,r){t[r]=(0,d.p)(e)}clone(){return new n({label:this.label,opacity:this.opacity,value:this.value})}};(0,i._)([(0,s.MZ)({type:String,json:{write:!0}})],h.prototype,"label",void 0),(0,i._)([(0,s.MZ)({type:Number,json:{type:u.jz,write:{target:"transparency"}}})],h.prototype,"opacity",void 0),(0,i._)([(0,c.w)("opacity",["transparency"])],h.prototype,"readOpacity",null),(0,i._)([(0,p.K)("opacity")],h.prototype,"writeOpacity",null),(0,i._)([(0,s.MZ)({type:Number,json:{write:!0}})],h.prototype,"value",void 0),h=n=(0,i._)([(0,o.$)("esri.renderers.visualVariables.support.OpacityStop")],h);const f=h;var y;let m=y=class extends a.A{constructor(e){super(e),this.type="opacity",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(e){e&&Array.isArray(e)&&(e=e.filter((e=>!!e))).sort(((e,t)=>e.value-t.value)),this._set("stops",e)}clone(){return new y({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map((e=>e.clone())),legendOptions:this.legendOptions?.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map((e=>e.value||0))}};(0,i._)([(0,s.MZ)({readOnly:!0})],m.prototype,"cache",null),(0,i._)([(0,s.MZ)({type:["opacity"],json:{type:["transparencyInfo"]}})],m.prototype,"type",void 0),(0,i._)([(0,s.MZ)({type:String,json:{write:!0}})],m.prototype,"normalizationField",void 0),(0,i._)([(0,s.MZ)({type:[f],json:{write:!0}})],m.prototype,"stops",null),m=y=(0,i._)([(0,o.$)("esri.renderers.visualVariables.OpacityVariable")],m);const g=m},36604:function(e,t,r){r.d(t,{A:function(){return u}});var n,i=r(53804),s=r(23502),o=(r(58941),r(40633),r(13798),r(65953)),a=r(64494);let l=n=class extends a.A{constructor(e){super(e),this.axis=null,this.type="rotation",this.rotationType="geographic"}get cache(){return{hasExpression:!!this.valueExpression,compiledFunc:null}}clone(){return new n({axis:this.axis,rotationType:this.rotationType,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:this.legendOptions?.clone()})}};(0,i._)([(0,s.MZ)({readOnly:!0})],l.prototype,"cache",null),(0,i._)([(0,s.MZ)({type:["heading","tilt","roll"],json:{origins:{"web-scene":{default:"heading",write:!0}}}})],l.prototype,"axis",void 0),(0,i._)([(0,s.MZ)({type:["rotation"],json:{type:["rotationInfo"]}})],l.prototype,"type",void 0),(0,i._)([(0,s.MZ)({type:["geographic","arithmetic"],json:{write:!0,origins:{"web-document":{write:!0,default:"geographic"}}}})],l.prototype,"rotationType",void 0),l=n=(0,i._)([(0,o.$)("esri.renderers.visualVariables.RotationVariable")],l);const u=l},53096:function(e,t,r){r.d(t,{A:function(){return F}});var n=r(53804),i=r(39819),s=r(73037),o=r(40633),a=r(23502),l=r(77560),u=r(47332),c=r(65953),p=r(81392),d=r(64494),h=r(13520),f=r(59423),y=(r(58941),r(13798),r(96893));let m=class extends y.A{constructor(){super(...arguments),this.customValues=null}};(0,n._)([(0,a.MZ)({type:[Number],json:{write:!0}})],m.prototype,"customValues",void 0),m=(0,n._)([(0,c.$)("esri.renderers.visualVariables.support.SizeVariableLegendOptions")],m);const g=m;var w,_=r(32974),v=r(70481);const b=new s.J({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),S=new s.J({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers"});function I(e){if(null!=e)return"string"==typeof e||"number"==typeof e?function(e){return(0,h.cr)(e)}(e):"size"===e.type?(0,_.of)(e)?e:(delete(e={...e}).type,new x(e)):void 0}function M(e,t,r){if("object"!=typeof e)return e;const n=new x;return n.read(e,r),n}let x=w=class extends d.A{constructor(e){super(e),this.axis=null,this.legendOptions=null,this.normalizationField=null,this.scaleBy=null,this.target=null,this.type="size",this.useSymbolValue=null,this.valueExpression=null,this.valueRepresentation=null,this.valueUnit=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,isScaleDriven:null!=this.valueExpression&&v.viewScaleRE.test(this.valueExpression)}}set index(e){(0,_.of)(this.maxSize)&&(this.maxSize.index=`visualVariables[${e}].maxSize`),(0,_.of)(this.minSize)&&(this.minSize.index=`visualVariables[${e}].minSize`),this._set("index",e)}get inputValueType(){return(0,_.eh)(this)}set maxDataValue(e){e&&this.stops&&(o.A.getLogger(this).warn("cannot set maxDataValue when stops is not null."),e=null),this._set("maxDataValue",e)}set maxSize(e){e&&this.stops&&(o.A.getLogger(this).warn("cannot set maxSize when stops is not null."),e=null),this._set("maxSize",e)}castMaxSize(e){return I(e)}readMaxSize(e,t,r){return M(e,0,r)}set minDataValue(e){e&&this.stops&&(o.A.getLogger(this).warn("cannot set minDataValue when stops is not null."),e=null),this._set("minDataValue",e)}set minSize(e){e&&this.stops&&(o.A.getLogger(this).warn("cannot set minSize when stops is not null."),e=null),this._set("minSize",e)}castMinSize(e){return I(e)}readMinSize(e,t,r){return M(e,0,r)}get arcadeRequired(){return!!this.valueExpression||null!=this.minSize&&"object"==typeof this.minSize&&this.minSize.arcadeRequired||null!=this.maxSize&&"object"==typeof this.maxSize&&this.maxSize.arcadeRequired}set stops(e){null==this.minDataValue&&null==this.maxDataValue&&null==this.minSize&&null==this.maxSize?e&&Array.isArray(e)&&(e=e.filter((e=>!!e))).sort(((e,t)=>e.value-t.value)):e&&(o.A.getLogger(this).warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),e=null),this._set("stops",e)}get transformationType(){return(0,_.KZ)(this,this.inputValueType)}readValueExpression(e,t){return e||t.expression&&"$view.scale"}writeValueExpressionWebScene(e,t,r,n){if("$view.scale"===e){if(n?.messages){const e=this.index,t="string"==typeof e?e:`visualVariables[${e}]`;n.messages.push(new i.A("property:unsupported",this.type+"VisualVariable.valueExpression = '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:t+".valueExpression",context:n}))}}else t[r]=e}readValueUnit(e){return e?S.read(e):null}clone(){return new w({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:(0,_.of)(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:(0,_.of)(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops?.map((e=>e.clone())),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions?.clone()})}flipSizes(){if(this.transformationType===_._w.ClampedLinear){const{minSize:e,maxSize:t}=this;return this.minSize=t,this.maxSize=e,this}if(this.transformationType===_._w.Stops){const e=this.stops;if(!e)return this;const t=e.map((e=>e.size)).reverse(),r=e.length;for(let n=0;n<r;n++)e[n].size=t[n];return this}return this}getAttributeHash(){return`${super.getAttributeHash()}-${this.target}-${this.normalizationField}`}_interpolateData(){return this.stops?.map((e=>e.value||0))}};(0,n._)([(0,a.MZ)({readOnly:!0})],x.prototype,"cache",null),(0,n._)([(0,a.MZ)({type:b.apiValues,json:{type:b.jsonValues,origins:{"web-map":{read:!1}},read:b.read,write:b.write}})],x.prototype,"axis",void 0),(0,n._)([(0,a.MZ)()],x.prototype,"index",null),(0,n._)([(0,a.MZ)({type:String,readOnly:!0})],x.prototype,"inputValueType",null),(0,n._)([(0,a.MZ)({type:g,json:{write:!0}})],x.prototype,"legendOptions",void 0),(0,n._)([(0,a.MZ)({type:Number,value:null,json:{write:!0}})],x.prototype,"maxDataValue",null),(0,n._)([(0,a.MZ)({type:Number,value:null,json:{write:!0}})],x.prototype,"maxSize",null),(0,n._)([(0,l.w)("maxSize")],x.prototype,"castMaxSize",null),(0,n._)([(0,u.w)("maxSize")],x.prototype,"readMaxSize",null),(0,n._)([(0,a.MZ)({type:Number,value:null,json:{write:!0}})],x.prototype,"minDataValue",null),(0,n._)([(0,a.MZ)({type:Number,value:null,json:{write:!0}})],x.prototype,"minSize",null),(0,n._)([(0,l.w)("minSize")],x.prototype,"castMinSize",null),(0,n._)([(0,u.w)("minSize")],x.prototype,"readMinSize",null),(0,n._)([(0,a.MZ)({type:String,json:{write:!0}})],x.prototype,"normalizationField",void 0),(0,n._)([(0,a.MZ)({readOnly:!0})],x.prototype,"arcadeRequired",null),(0,n._)([(0,a.MZ)({type:String})],x.prototype,"scaleBy",void 0),(0,n._)([(0,a.MZ)({type:[f.A],value:null,json:{write:!0}})],x.prototype,"stops",null),(0,n._)([(0,a.MZ)({type:["outline"],json:{write:!0}})],x.prototype,"target",void 0),(0,n._)([(0,a.MZ)({type:String,readOnly:!0})],x.prototype,"transformationType",null),(0,n._)([(0,a.MZ)({type:["size"],json:{type:["sizeInfo"]}})],x.prototype,"type",void 0),(0,n._)([(0,a.MZ)({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],x.prototype,"useSymbolValue",void 0),(0,n._)([(0,a.MZ)({type:String,json:{write:!0}})],x.prototype,"valueExpression",void 0),(0,n._)([(0,u.w)("valueExpression",["valueExpression","expression"])],x.prototype,"readValueExpression",null),(0,n._)([(0,p.K)("web-scene","valueExpression")],x.prototype,"writeValueExpressionWebScene",null),(0,n._)([(0,a.MZ)({type:["radius","diameter","area","width","distance"],json:{write:!0}})],x.prototype,"valueRepresentation",void 0),(0,n._)([(0,a.MZ)({type:S.apiValues,json:{write:S.write,origins:{"web-map":{read:!1},"web-scene":{write:!0},"portal-item":{write:!0}}}})],x.prototype,"valueUnit",void 0),(0,n._)([(0,u.w)("valueUnit")],x.prototype,"readValueUnit",null),x=w=(0,n._)([(0,c.$)("esri.renderers.visualVariables.SizeVariable")],x);const F=x},64494:function(e,t,r){r.d(t,{A:function(){return f}});var n=r(53804),i=r(73037),s=r(30905),o=r(40633),a=r(23502),l=r(77560),u=r(65953),c=r(67888),p=r(96893);const d=new i.J({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"});let h=class extends s.oY{constructor(e){super(e),this.index=null,this.type=null,this.field=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null}castField(e){return null==e?e:"function"==typeof e?(o.A.getLogger(this).error(".field: field must be a string value"),null):(0,c.GX)(e)}get arcadeRequired(){return!!this.valueExpression}clone(){}getAttributeHash(){return`${this.type}-${this.field}-${this.valueExpression}`}};(0,n._)([(0,a.MZ)()],h.prototype,"index",void 0),(0,n._)([(0,a.MZ)({type:d.apiValues,readOnly:!0,json:{read:d.read,write:d.write}})],h.prototype,"type",void 0),(0,n._)([(0,a.MZ)({type:String,json:{write:!0}})],h.prototype,"field",void 0),(0,n._)([(0,l.w)("field")],h.prototype,"castField",null),(0,n._)([(0,a.MZ)({type:String,json:{write:!0}})],h.prototype,"valueExpression",void 0),(0,n._)([(0,a.MZ)({type:String,json:{write:!0}})],h.prototype,"valueExpressionTitle",void 0),(0,n._)([(0,a.MZ)({readOnly:!0})],h.prototype,"arcadeRequired",null),(0,n._)([(0,a.MZ)({type:p.A,json:{write:!0}})],h.prototype,"legendOptions",void 0),h=(0,n._)([(0,u.$)("esri.renderers.visualVariables.VisualVariable")],h);const f=h},71859:function(e,t,r){r.d(t,{A:function(){return d}});var n,i=r(53804),s=r(52874),o=r(30905),a=r(23502),l=r(67888),u=(r(13798),r(58941),r(65953)),c=r(81392);let p=n=class extends o.oY{constructor(e){super(e),this.color=null,this.label=null,this.value=null}writeValue(e,t,r){t[r]=e??0}clone(){return new n({color:this.color&&this.color.clone(),label:this.label,value:this.value})}};(0,i._)([(0,a.MZ)({type:s.A,json:{type:[l.jz],write:!0}})],p.prototype,"color",void 0),(0,i._)([(0,a.MZ)({type:String,json:{write:!0}})],p.prototype,"label",void 0),(0,i._)([(0,a.MZ)({type:Number,json:{write:{writerEnsuresNonNull:!0}}})],p.prototype,"value",void 0),(0,i._)([(0,c.K)("value")],p.prototype,"writeValue",null),p=n=(0,i._)([(0,u.$)("esri.renderers.visualVariables.support.ColorStop")],p);const d=p},59423:function(e,t,r){r.d(t,{A:function(){return c}});var n,i=r(53804),s=r(30905),o=r(13520),a=r(23502),l=(r(58941),r(40633),r(13798),r(65953));let u=n=class extends s.oY{constructor(e){super(e),this.label=null,this.size=null,this.value=null,this.useMinValue=null,this.useMaxValue=null}clone(){return new n({label:this.label,size:this.size,value:this.value,useMaxValue:this.useMaxValue,useMinValue:this.useMinValue})}};(0,i._)([(0,a.MZ)({type:String,json:{write:!0}})],u.prototype,"label",void 0),(0,i._)([(0,a.MZ)({type:Number,cast:o.cr,json:{write:!0}})],u.prototype,"size",void 0),(0,i._)([(0,a.MZ)({type:Number,json:{write:!0}})],u.prototype,"value",void 0),(0,i._)([(0,a.MZ)({type:Boolean,json:{write:!1}})],u.prototype,"useMinValue",void 0),(0,i._)([(0,a.MZ)({type:Boolean,json:{write:!1}})],u.prototype,"useMaxValue",void 0),u=n=(0,i._)([(0,l.$)("esri.renderers.visualVariables.support.SizeStop")],u);const c=u},96893:function(e,t,r){r.d(t,{A:function(){return u}});var n=r(53804),i=r(75743),s=r(30905),o=r(23502),a=(r(58941),r(40633),r(13798),r(65953));let l=class extends((0,i.O)(s.oY)){constructor(){super(...arguments),this.showLegend=null,this.title=null}};(0,n._)([(0,o.MZ)({type:Boolean,json:{write:!0}})],l.prototype,"showLegend",void 0),(0,n._)([(0,o.MZ)({type:String,json:{write:!0}})],l.prototype,"title",void 0),l=(0,n._)([(0,a.$)("esri.renderers.visualVariables.support.VisualVariableLegendOptions")],l);const u=l},32974:function(e,t,r){var n,i;function s(e){return e&&"esri.renderers.visualVariables.SizeVariable"===e.declaredClass}function o(e){return null!=e&&!isNaN(e)&&isFinite(e)}function a(e){return e.valueExpression?n.Expression:e.field&&"string"==typeof e.field?n.Field:n.Unknown}function l(e,t){const r=t||a(e),s=e.valueUnit||"unknown";return r===n.Unknown?i.Constant:e.stops?i.Stops:null!=e.minSize&&null!=e.maxSize&&null!=e.minDataValue&&null!=e.maxDataValue?i.ClampedLinear:"unknown"===s?null!=e.minSize&&null!=e.minDataValue?e.minSize&&e.minDataValue?i.Proportional:i.Additive:i.Identity:i.RealWorldSize}r.d(t,{KZ:function(){return l},Yf:function(){return n},_w:function(){return i},eh:function(){return a},gf:function(){return o},of:function(){return s}}),function(e){e.Unknown="unknown",e.Expression="expression",e.Field="field"}(n||(n={})),function(e){e.Unknown="unknown",e.Stops="stops",e.ClampedLinear="clamped-linear",e.Proportional="proportional",e.Additive="additive",e.Constant="constant",e.Identity="identity",e.RealWorldSize="real-world-size"}(i||(i={}))},70481:function(e,t,r){r.r(t),r.d(t,{getAllSizes:function(){return x},getColor:function(){return y},getOpacity:function(){return m},getRotationAngle:function(){return g},getSize:function(){return w},getSizeForValue:function(){return b},getSizeFromNumberOrVariable:function(){return _},getSizeRangeAtScale:function(){return S},getVisualVariableValues:function(){return I},viewScaleRE:function(){return f}});var n=r(52874),i=r(59469),s=r(82547),o=r(40633),a=r(85031),l=r(32974);const u=()=>o.A.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),c=e=>u().warn(`The visualVariable should be an instance of esri.renderers.visualVariables.${e}`),p=()=>u().error("Use of arcade expressions requires an arcade context"),d=new i.default,h=Math.PI,f=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function y(e,t,r){const i="visualVariables"in e&&e.visualVariables?e.visualVariables.find((e=>"color"===e.type)):e;if(!i)return;if("esri.renderers.visualVariables.ColorVariable"!==i.declaredClass)return void c("ColorVariable");const s="number"==typeof t,o=s?null:t,a=o?.attributes;let l=s?t:null;const u=i.field,{ipData:d,hasExpression:h}=i.cache;let f=i.cache.compiledFunc;if(!u&&!h){const e=i.stops;return e&&e[0]&&e[0].color}if("number"!=typeof l)if(h){if(null==r?.arcade)return void p();const e={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},t=r.arcade.arcadeUtils,n=t.getViewInfo(e),s=t.createExecContext(o,n,r.timeZone);if(!f){const e=t.createSyntaxTree(i.valueExpression);f=t.createFunction(e),i.cache.compiledFunc=f}l=t.executeFunction(f,s)}else a&&(l=a[u]);const y=i.normalizationField,m=null!=a&&null!=y?parseFloat(a[y]):void 0;if(null!=l&&(!y||s||!isNaN(m)&&0!==m)){isNaN(m)||s||(l/=m);const e=M(l,d);if(e){const t=e[0],s=e[1],o=t===s?i.stops[t].color:n.A.blendColors(i.stops[t].color,i.stops[s].color,e[2],null!=r?r.color:void 0);return new n.A(o)}}}function m(e,t,r){const n="visualVariables"in e&&e.visualVariables?e.visualVariables.find((e=>"opacity"===e.type)):e;if(!n)return;if("esri.renderers.visualVariables.OpacityVariable"!==n.declaredClass)return void c("OpacityVariable");const i="number"==typeof t,s=i?null:t,o=s?.attributes;let a=i?t:null;const l=n.field,{ipData:u,hasExpression:d}=n.cache;let h=n.cache.compiledFunc;if(!l&&!d){const e=n.stops;return e&&e[0]&&e[0].opacity}if("number"!=typeof a)if(d){if(null==r?.arcade)return void p();const e={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},t=r.arcade.arcadeUtils,i=t.getViewInfo(e),o=t.createExecContext(s,i,r.timeZone);if(!h){const e=t.createSyntaxTree(n.valueExpression);h=t.createFunction(e),n.cache.compiledFunc=h}a=t.executeFunction(h,o)}else o&&(a=o[l]);const f=n.normalizationField,y=null!=o&&null!=f?parseFloat(o[f]):void 0;if(null!=a&&(!f||i||!isNaN(y)&&0!==y)){isNaN(y)||i||(a/=y);const e=M(a,u);if(e){const t=e[0],r=e[1];if(t===r)return n.stops[t].opacity;{const i=n.stops[t].opacity;return i+(n.stops[r].opacity-i)*e[2]}}}}function g(e,t,r){const n="visualVariables"in e&&e.visualVariables?e.visualVariables.find((e=>"rotation"===e.type)):e;if(!n)return;if("esri.renderers.visualVariables.RotationVariable"!==n.declaredClass)return void c("RotationVariable");const i=n.axis||"heading",s="heading"===i&&"arithmetic"===n.rotationType?90:0,o="heading"===i&&"arithmetic"===n.rotationType?-1:1,a="number"==typeof t?null:t,l=a?.attributes,u=n.field,{hasExpression:d}=n.cache;let h=n.cache.compiledFunc,f=0;if(!u&&!d)return f;if(d){if(null==r?.arcade)return void p();const e={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},t=r.arcade.arcadeUtils,i=t.getViewInfo(e),s=t.createExecContext(a,i,r.timeZone);if(!h){const e=t.createSyntaxTree(n.valueExpression);h=t.createFunction(e),n.cache.compiledFunc=h}f=t.executeFunction(h,s)}else l&&(f=l[u]||0);return f="number"!=typeof f||isNaN(f)?null:s+o*f,f}function w(e,t,r){const n="visualVariables"in e&&e.visualVariables?e.visualVariables.find((e=>"size"===e.type)):e;if(!n)return;if("esri.renderers.visualVariables.SizeVariable"!==n.declaredClass)return void c("SizeVariable");const i=b(function(e,t,r){const n="number"==typeof t,i=n?null:t,s=i?.attributes;let o=n?t:null;const{isScaleDriven:a}=e.cache;let u=e.cache.compiledFunc;if(a){const t=null!=r?r.scale:void 0,n=null!=r?r.view:void 0;o=null==t||"3d"===n?function(e){let t=null,r=null;const n=e.stops;return n?(t=n[0].value,r=n[n.length-1].value):(t=e.minDataValue||0,r=e.maxDataValue||0),(t+r)/2}(e):t}else if(!n)switch(e.inputValueType){case l.Yf.Expression:{if(null==r?.arcade)return void p();const t={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},n=r.arcade.arcadeUtils,s=n.getViewInfo(t),a=n.createExecContext(i,s,r.timeZone);if(!u){const t=n.createSyntaxTree(e.valueExpression);u=n.createFunction(t),e.cache.compiledFunc=u}o=n.executeFunction(u,a);break}case l.Yf.Field:s&&(o=s[e.field]);break;case l.Yf.Unknown:o=null}if(!(0,l.gf)(o))return null;if(n||!e.normalizationField)return o;const c=s?parseFloat(s[e.normalizationField]):null;return(0,l.gf)(c)&&0!==c?o/c:null}(n,t,r),n,t,r,n.cache.ipData);return null==i||isNaN(i)?0:i}function _(e,t,r){return null==e?null:(0,l.of)(e)?w(e,t,r):(0,l.gf)(e)?e:null}function v(e,t,r){return(0,l.gf)(r)&&e>r?r:(0,l.gf)(t)&&e<t?t:e}function b(e,t,r,n,i){switch(t.transformationType){case l._w.Additive:return function(e,t,r,n){return e+((_(t.minSize,r,n)||t.minDataValue)??0)}(e,t,r,n);case l._w.Constant:return function(e,t,r){const n=e.stops;let i=n?.length&&n[0].size;return null==i&&(i=e.minSize),_(i,t,r)}(t,r,n);case l._w.ClampedLinear:return function(e,t,r,n){const i=(e-t.minDataValue)/(t.maxDataValue-t.minDataValue),s=_(t.minSize,r,n),o=_(t.maxSize,r,n),a=null!=n?n.shape:void 0;if(e<=t.minDataValue)return s;if(e>=t.maxDataValue)return o;if(null==s||null==o)return null;if("area"===t.scaleBy&&a){const e="circle"===a,t=e?h*(s/2)**2:s*s,r=t+i*((e?h*(o/2)**2:o*o)-t);return e?2*Math.sqrt(r/h):Math.sqrt(r)}return s+i*(o-s)}(e,t,r,n);case l._w.Proportional:return function(e,t,r,n){const i=null!=n?n.shape:void 0,s=e/t.minDataValue,o=_(t.minSize,r,n),a=_(t.maxSize,r,n);let l=null;return l="circle"===i?2*Math.sqrt(s*(o/2)**2):"square"===i||"diamond"===i||"image"===i?Math.sqrt(s*o**2):s*o,v(l,o,a)}(e,t,r,n);case l._w.Stops:return function(e,t,r,n,i){const[s,o,a]=M(e,i);if(s===o)return _(t.stops?.[s].size,r,n);{const e=_(t.stops?.[s].size,r,n);return e+(_(t.stops?.[o].size,r,n)-e)*a}}(e,t,r,n,i);case l._w.RealWorldSize:return function(e,t,r,n){const i=(n?.resolution??1)*a.j[t.valueUnit],s=_(t.minSize,r,n),o=_(t.maxSize,r,n),{valueRepresentation:l}=t;let u=null;return u="area"===l?2*Math.sqrt(e/h)/i:"radius"===l||"distance"===l?2*e/i:e/i,v(u,s,o)}(e,t,r,n);case l._w.Identity:return e;case l._w.Unknown:return null}}function S(e,t,r){const{isScaleDriven:n}=e.cache;if(!(n&&"3d"===r||t))return null;const i={scale:t,view:r};let s=_(e.minSize,d,i),o=_(e.maxSize,d,i);if(null!=s||null!=o){if(s>o){const e=o;o=s,s=e}return{minSize:s,maxSize:o}}}function I(e,t,r){if(!e.visualVariables)return;const n=[],i=[],s=[],o=[],a=[];for(const t of e.visualVariables)switch(t.type){case"color":i.push(t);break;case"opacity":s.push(t);break;case"rotation":a.push(t);break;case"size":o.push(t)}return i.forEach((e=>{const i=y(e,t,r);n.push({variable:e,value:i})})),s.forEach((e=>{const i=m(e,t,r);n.push({variable:e,value:i})})),a.forEach((e=>{const i=g(e,t,r);n.push({variable:e,value:i})})),o.forEach((e=>{const i=w(e,t,r);n.push({variable:e,value:i})})),n.filter((e=>null!=e.value))}function M(e,t){if(!t)return;let r=0,n=t.length-1;return t.some(((t,i)=>e<t?(n=i,!0):(r=i,!1))),[r,n,(e-t[r])/(t[n]-t[r])]}function x(e,t,r){const n=["proportional","proportional","proportional"];for(const i of e){const e=i.useSymbolValue?"symbol-value":w(i,t,r);switch(i.axis){case"width":n[0]=e;break;case"depth":n[1]=e;break;case"height":n[2]=e;break;case"width-and-depth":n[0]=e,n[1]=e;break;case"all":case void 0:case null:n[0]=e,n[1]=e,n[2]=e;break;default:(0,s.Xb)(i.axis)}}return n}},87295:function(e,t,r){r.d(t,{u:function(){return o}});var n=r(62938),i=r(57652);function s(e,t,r){if(null==e.hasM||e.hasZ)for(const e of t)for(const t of e)t.length>2&&(t[2]*=r)}function o(e,t,r){if(!e&&!t||!r)return;const i=(0,n.G9)(r);a(e,r,i),a(t,r,i)}function a(e,t,r){if(e)for(const n of e)l(n.geometry,t,r)}function l(e,t,r){if(!e?.spatialReference||(0,i.aI)(e.spatialReference,t))return;const o=(0,n.G9)(e.spatialReference)/r;if(1!==o)if("x"in e)null!=e.z&&(e.z*=o);else if("rings"in e)s(e,e.rings,o);else if("paths"in e)s(e,e.paths,o);else if("points"in e&&(null==e.hasM||e.hasZ))for(const t of e.points)t.length>2&&(t[2]*=o)}},45406:function(e,t,r){r.d(t,{q:function(){return i}});var n=r(6996);function i(e,t,r){if(!r?.features||!r.hasZ)return;const i=(0,n.N)(r.geometryType,t,e.outSpatialReference);if(null!=i)for(const e of r.features)i(e.geometry)}},30698:function(e,t,r){r.d(t,{A:function(){return h}});var n,i=r(53804),s=r(52874),o=r(21609),a=r(23502),l=r(67888),u=r(74376),c=r(65953),p=r(9035);let d=n=class extends p.A{constructor(e){super(e),this.algorithm=null,this.fromColor=null,this.toColor=null,this.type="algorithmic"}clone(){return new n({fromColor:(0,o.o8)(this.fromColor),toColor:(0,o.o8)(this.toColor),algorithm:this.algorithm})}};(0,i._)([(0,u.e)({esriCIELabAlgorithm:"cie-lab",esriHSVAlgorithm:"hsv",esriLabLChAlgorithm:"lab-lch"})],d.prototype,"algorithm",void 0),(0,i._)([(0,a.MZ)({type:s.A,json:{type:[l.jz],write:!0}})],d.prototype,"fromColor",void 0),(0,i._)([(0,a.MZ)({type:s.A,json:{type:[l.jz],write:!0}})],d.prototype,"toColor",void 0),(0,i._)([(0,a.MZ)({type:["algorithmic"]})],d.prototype,"type",void 0),d=n=(0,i._)([(0,c.$)("esri.rest.support.AlgorithmicColorRamp")],d);const h=d},42783:function(e,t,r){r.d(t,{A:function(){return d}});var n,i=r(53804),s=r(30905),o=r(21609),a=r(23502),l=r(67888),u=r(65953),c=r(81392);let p=n=class extends s.oY{constructor(e){super(e),this.attachmentTypes=null,this.attachmentsWhere=null,this.cacheHint=void 0,this.keywords=null,this.globalIds=null,this.name=null,this.num=null,this.objectIds=null,this.returnMetadata=!1,this.size=null,this.start=null,this.where=null}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10}clone(){return new n((0,o.o8)({attachmentTypes:this.attachmentTypes,attachmentsWhere:this.attachmentsWhere,cacheHint:this.cacheHint,keywords:this.keywords,where:this.where,globalIds:this.globalIds,name:this.name,num:this.num,objectIds:this.objectIds,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))}};(0,i._)([(0,a.MZ)({type:[String],json:{write:!0}})],p.prototype,"attachmentTypes",void 0),(0,i._)([(0,a.MZ)({type:String,json:{read:{source:"attachmentsDefinitionExpression"},write:{target:"attachmentsDefinitionExpression"}}})],p.prototype,"attachmentsWhere",void 0),(0,i._)([(0,a.MZ)({type:Boolean,json:{write:!0}})],p.prototype,"cacheHint",void 0),(0,i._)([(0,a.MZ)({type:[String],json:{write:!0}})],p.prototype,"keywords",void 0),(0,i._)([(0,a.MZ)({type:[String],json:{write:!0}})],p.prototype,"globalIds",void 0),(0,i._)([(0,a.MZ)({json:{write:!0}})],p.prototype,"name",void 0),(0,i._)([(0,a.MZ)({type:Number,json:{read:{source:"resultRecordCount"}}})],p.prototype,"num",void 0),(0,i._)([(0,a.MZ)({type:[Number],json:{write:!0}})],p.prototype,"objectIds",void 0),(0,i._)([(0,a.MZ)({type:Boolean,json:{default:!1,write:!0}})],p.prototype,"returnMetadata",void 0),(0,i._)([(0,a.MZ)({type:[Number],json:{write:!0}})],p.prototype,"size",void 0),(0,i._)([(0,a.MZ)({type:Number,json:{read:{source:"resultOffset"}}})],p.prototype,"start",void 0),(0,i._)([(0,c.K)("start"),(0,c.K)("num")],p.prototype,"writeStart",null),(0,i._)([(0,a.MZ)({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],p.prototype,"where",void 0),p=n=(0,i._)([(0,u.$)("esri.rest.support.AttachmentQuery")],p),p.from=(0,l.dp)(p);const d=p},9035:function(e,t,r){r.d(t,{A:function(){return l}});var n=r(53804),i=r(30905),s=r(23502),o=(r(58941),r(40633),r(13798),r(65953));let a=class extends i.oY{constructor(e){super(e),this.type=null}};(0,n._)([(0,s.MZ)({readOnly:!0,json:{read:!1,write:!0}})],a.prototype,"type",void 0),a=(0,n._)([(0,o.$)("esri.rest.support.ColorRamp")],a);const l=a},51084:function(e,t,r){r.d(t,{A:function(){return _}});var n,i=r(53804),s=r(50917),o=r(59469),a=r(73037),l=r(30905),u=r(21609),c=r(23502),p=(r(58941),r(40633),r(47332)),d=r(65953),h=r(81392),f=r(57165),y=r(74697),m=r(56740);const g=new a.J({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let w=n=class extends l.oY{constructor(e){super(e),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(e,t){const r=f.A.fromJSON(t.spatialReference),n=[];for(let t=0;t<e.length;t++){const i=e[t],s=o.default.fromJSON(i),a=i.geometry?.spatialReference;null==s.geometry||a||(s.geometry.spatialReference=r);const l=i.aggregateGeometries,u=s.aggregateGeometries;if(l&&null!=u)for(const e in u){const t=u[e],n=l[e],i=n?.spatialReference;null==t||i||(t.spatialReference=r)}n.push(s)}return n}writeGeometryType(e,t,r,n){if(e)return void g.write(e,t,r,n);const{features:i}=this;if(i)for(const e of i)if(null!=e?.geometry)return void g.write(e.geometry.type,t,r,n)}readQueryGeometry(e,t){if(!e)return null;const r=!!e.spatialReference,n=(0,y.rS)(e);return n&&!r&&t.spatialReference&&(n.spatialReference=f.A.fromJSON(t.spatialReference)),n}writeSpatialReference(e,t){if(e)return void(t.spatialReference=e.toJSON());const{features:r}=this;if(r)for(const e of r)if(e&&null!=e.geometry&&e.geometry.spatialReference)return void(t.spatialReference=e.geometry.spatialReference.toJSON())}clone(){return new n(this.cloneProperties())}cloneProperties(){return(0,u.o8)({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(e){const t=this.write();if(t.features&&Array.isArray(e)&&e.length>0)for(let r=0;r<t.features.length;r++){const n=t.features[r];if(n.geometry){const t=e?.[r];n.geometry=t?.toJSON()||n.geometry}}return t}quantize(e){const{scale:[t,r],translate:[n,i]}=e,s=this.features,o=this._getQuantizationFunction(this.geometryType,(e=>Math.round((e-n)/t)),(e=>Math.round((i-e)/r)));for(let e=0,t=s.length;e<t;e++)o?.(s[e].geometry)||(s.splice(e,1),e--,t--);return this.transform=e,this}unquantize(){const{geometryType:e,features:t,transform:r}=this;if(!r)return this;const{translate:[n,i],scale:[s,o]}=r;let a=null,l=null;if(this.hasZ&&null!=r?.scale?.[2]){const{translate:[,,e],scale:[,,t]}=r;a=r=>r*t+e}if(this.hasM&&null!=r?.scale?.[3]){const{translate:[,,,e],scale:[,,,t]}=r;l=r=>null==r?r:r*t+e}const u=this._getHydrationFunction(e,(e=>e*s+n),(e=>i-e*o),a,l);for(const{geometry:e}of t)null!=e&&u&&u(e);return this.transform=null,this}_quantizePoints(e,t,r){let n,i;const s=[];for(let o=0,a=e.length;o<a;o++){const a=e[o];if(o>0){const e=t(a[0]),o=r(a[1]);e===n&&o===i||(s.push([e-n,o-i]),n=e,i=o)}else n=t(a[0]),i=r(a[1]),s.push([n,i])}return s.length>0?s:null}_getQuantizationFunction(e,t,r){return"point"===e?e=>(e.x=t(e.x),e.y=r(e.y),e):"polyline"===e||"polygon"===e?e=>{const n=(0,y.Bi)(e)?e.rings:e.paths,i=[];for(let e=0,s=n.length;e<s;e++){const s=n[e],o=this._quantizePoints(s,t,r);o&&i.push(o)}return i.length>0?((0,y.Bi)(e)?e.rings=i:e.paths=i,e):null}:"multipoint"===e?e=>{const n=this._quantizePoints(e.points,t,r);return n&&n.length>0?(e.points=n,e):null}:"extent"===e?e=>e:null}_getHydrationFunction(e,t,r,n,i){return"point"===e?e=>{e.x=t(e.x),e.y=r(e.y),n&&(e.z=n(e.z))}:"polyline"===e||"polygon"===e?e=>{const s=(0,y.Bi)(e)?e.rings:e.paths;let o,a;for(let e=0,n=s.length;e<n;e++){const n=s[e];for(let e=0,i=n.length;e<i;e++){const i=n[e];e>0?(o+=i[0],a+=i[1]):(o=i[0],a=i[1]),i[0]=t(o),i[1]=r(a)}}if(n&&i)for(let e=0,t=s.length;e<t;e++){const t=s[e];for(let e=0,r=t.length;e<r;e++){const r=t[e];r[2]=n(r[2]),r[3]=i(r[3])}}else if(n)for(let e=0,t=s.length;e<t;e++){const t=s[e];for(let e=0,r=t.length;e<r;e++){const r=t[e];r[2]=n(r[2])}}else if(i)for(let e=0,t=s.length;e<t;e++){const t=s[e];for(let e=0,r=t.length;e<r;e++){const r=t[e];r[2]=i(r[2])}}}:"extent"===e?e=>{e.xmin=t(e.xmin),e.ymin=r(e.ymin),e.xmax=t(e.xmax),e.ymax=r(e.ymax),n&&null!=e.zmax&&null!=e.zmin&&(e.zmax=n(e.zmax),e.zmin=n(e.zmin)),i&&null!=e.mmax&&null!=e.mmin&&(e.mmax=i(e.mmax),e.mmin=i(e.mmin))}:"multipoint"===e?e=>{const s=e.points;let o,a;for(let e=0,n=s.length;e<n;e++){const n=s[e];e>0?(o+=n[0],a+=n[1]):(o=n[0],a=n[1]),n[0]=t(o),n[1]=r(a)}if(n&&i)for(let e=0,t=s.length;e<t;e++){const t=s[e];t[2]=n(t[2]),t[3]=i(t[3])}else if(n)for(let e=0,t=s.length;e<t;e++){const t=s[e];t[2]=n(t[2])}else if(i)for(let e=0,t=s.length;e<t;e++){const t=s[e];t[2]=i(t[2])}}:null}};(0,i._)([(0,c.MZ)({type:String,json:{write:!0}})],w.prototype,"displayFieldName",void 0),(0,i._)([(0,c.MZ)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],w.prototype,"exceededTransferLimit",void 0),(0,i._)([(0,c.MZ)({type:[o.default],json:{write:!0}})],w.prototype,"features",void 0),(0,i._)([(0,p.w)("features")],w.prototype,"readFeatures",null),(0,i._)([(0,c.MZ)({type:[m.A],json:{write:!0}})],w.prototype,"fields",void 0),(0,i._)([(0,c.MZ)({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:g.read}}})],w.prototype,"geometryType",void 0),(0,i._)([(0,h.K)("geometryType")],w.prototype,"writeGeometryType",null),(0,i._)([(0,c.MZ)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],w.prototype,"hasM",void 0),(0,i._)([(0,c.MZ)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],w.prototype,"hasZ",void 0),(0,i._)([(0,c.MZ)({types:s.yR,json:{write:!0}})],w.prototype,"queryGeometry",void 0),(0,i._)([(0,p.w)("queryGeometry")],w.prototype,"readQueryGeometry",null),(0,i._)([(0,c.MZ)({type:f.A,json:{write:!0}})],w.prototype,"spatialReference",void 0),(0,i._)([(0,h.K)("spatialReference")],w.prototype,"writeSpatialReference",null),(0,i._)([(0,c.MZ)({json:{write:!0}})],w.prototype,"transform",void 0),w=n=(0,i._)([(0,d.$)("esri.rest.support.FeatureSet")],w),w.prototype.toJSON.isDefaultToJSON=!0;const _=w},96245:function(e,t,r){r.d(t,{A:function(){return p}});var n,i=r(53804),s=r(21609),o=r(23502),a=(r(58941),r(40633),r(65953)),l=r(30698),u=r(9035);let c=n=class extends u.A{constructor(e){super(e),this.colorRamps=null,this.type="multipart"}clone(){return new n({colorRamps:(0,s.o8)(this.colorRamps)})}};(0,i._)([(0,o.MZ)({type:[l.A],json:{write:!0}})],c.prototype,"colorRamps",void 0),(0,i._)([(0,o.MZ)({type:["multipart"]})],c.prototype,"type",void 0),c=n=(0,i._)([(0,a.$)("esri.rest.support.MultipartColorRamp")],c);const p=c},95470:function(e,t,r){r.r(t),r.d(t,{default:function(){return f}});var n,i=r(53804),s=(r(50917),r(30905)),o=r(21609),a=r(23502),l=r(67888),u=r(65953),c=r(81392),p=r(66866),d=r(57165);let h=n=class extends s.oY{constructor(e){super(e),this.cacheHint=void 0,this.dynamicDataSource=void 0,this.gdbVersion=null,this.geometryPrecision=void 0,this.historicMoment=null,this.maxAllowableOffset=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.relationshipId=void 0,this.start=void 0,this.num=void 0,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.where=null}_writeHistoricMoment(e,t){t.historicMoment=e&&e.getTime()}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10,this.start>0&&null==this.where&&(t.definitionExpression="1=1")}clone(){return new n((0,o.o8)({cacheHint:this.cacheHint,dynamicDataSource:this.dynamicDataSource,gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,historicMoment:this.historicMoment&&new Date(this.historicMoment.getTime()),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,start:this.start,num:this.num,returnGeometry:this.returnGeometry,where:this.where,returnZ:this.returnZ,returnM:this.returnM}))}};(0,i._)([(0,a.MZ)({type:Boolean,json:{write:!0}})],h.prototype,"cacheHint",void 0),(0,i._)([(0,a.MZ)({type:p.L,json:{write:!0}})],h.prototype,"dynamicDataSource",void 0),(0,i._)([(0,a.MZ)({type:String,json:{write:!0}})],h.prototype,"gdbVersion",void 0),(0,i._)([(0,a.MZ)({type:Number,json:{write:!0}})],h.prototype,"geometryPrecision",void 0),(0,i._)([(0,a.MZ)({type:Date})],h.prototype,"historicMoment",void 0),(0,i._)([(0,c.K)("historicMoment")],h.prototype,"_writeHistoricMoment",null),(0,i._)([(0,a.MZ)({type:Number,json:{write:!0}})],h.prototype,"maxAllowableOffset",void 0),(0,i._)([(0,a.MZ)({json:{write:!0}})],h.prototype,"objectIds",void 0),(0,i._)([(0,a.MZ)({type:[String],json:{write:!0}})],h.prototype,"orderByFields",void 0),(0,i._)([(0,a.MZ)({type:[String],json:{write:!0}})],h.prototype,"outFields",void 0),(0,i._)([(0,a.MZ)({type:d.A,json:{read:{source:"outSR"},write:{target:"outSR"}}})],h.prototype,"outSpatialReference",void 0),(0,i._)([(0,a.MZ)({json:{write:!0}})],h.prototype,"relationshipId",void 0),(0,i._)([(0,a.MZ)({type:Number,json:{read:{source:"resultOffset"}}})],h.prototype,"start",void 0),(0,i._)([(0,c.K)("start"),(0,c.K)("num")],h.prototype,"writeStart",null),(0,i._)([(0,a.MZ)({type:Number,json:{read:{source:"resultRecordCount"}}})],h.prototype,"num",void 0),(0,i._)([(0,a.MZ)({json:{write:!0}})],h.prototype,"returnGeometry",void 0),(0,i._)([(0,a.MZ)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],h.prototype,"returnM",void 0),(0,i._)([(0,a.MZ)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],h.prototype,"returnZ",void 0),(0,i._)([(0,a.MZ)({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],h.prototype,"where",void 0),h=n=(0,i._)([(0,u.$)("esri.rest.support.RelationshipQuery")],h),h.from=(0,l.dp)(h);const f=h},85982:function(e,t,r){r.d(t,{g:function(){return o},r:function(){return a}});var n=r(30698),i=r(9035),s=r(96245);const o={key:"type",base:i.A,typeMap:{algorithmic:n.A,multipart:s.A}};function a(e){return e?.type?"algorithmic"===e.type?n.A.fromJSON(e):"multipart"===e.type?s.A.fromJSON(e):null:null}},18950:function(e,t,r){r.d(t,{DQ:function(){return c},tn:function(){return u}});var n=r(90473),i=r(53743),s=r(57435),o=(r(58439),r(57746),r(44433),r(48212)),a=(r(40401),r(16621),r(12966),r(84847),r(33504)),l=r(49595);function u({displayField:e,editFieldsInfo:t,fields:r,objectIdField:l,title:u},c){if(!r)return null;const f=function(e,t){const r=t?.visibleFieldNames;return function({fields:e,ignoreFieldTypes:t,sortDisabled:r}){const n=e;return t&&(e=e.filter((e=>!t.includes(e.type)))),e===n&&(e=e.slice()),!0!==r&&e.sort(d),e}({fields:e.fields??[],ignoreFieldTypes:t?.ignoreFieldTypes||y,sortDisabled:t?.sortDisabled}).map((t=>new a.A({fieldName:t.name,isEditable:(0,i.R$)(t,e),label:t.alias,format:h(t),visible:p(t,{...e,visibleFieldNames:r})})))}({editFieldsInfo:t,fields:r,objectIdField:l},c);if(!f.length)return null;const m=function(e){const t=(0,i.mB)(e),{titleBase:r}=e;return t?`${r}: {${t.trim()}}`:r??""}({titleBase:u,fields:r,displayField:e}),g=[new o.A,new s.A];return new n.A({title:m,content:g,fieldInfos:f})}function c(e){const{title:t,graphic:r}=e??{},{attributes:n,sourceLayer:i}=r??{},s=i&&"displayField"in i?i.displayField:null,o=s?n?.[s]:null,a=r?.getObjectId()?.toString();return t||o||a||""}const p=(e,t)=>t.visibleFieldNames?t.visibleFieldNames.has(e.name):(0,i.Bz)(e,t);function d(e,t){return"oid"===e.type?-1:"oid"===t.type?1:f(e)?-1:f(t)?1:(e.alias||e.name).toLocaleLowerCase().localeCompare((t.alias||t.name).toLocaleLowerCase())}function h(e){switch(e.type){case"small-integer":case"integer":case"single":return new l.A({digitSeparator:!0,places:0});case"double":return new l.A({digitSeparator:!0,places:2});case"string":return(0,i.JL)(e.name)?new l.A({digitSeparator:!0,places:0}):void 0;default:return}}function f(e){if("name"===(e.name&&e.name.toLowerCase()))return!0;const t=e.alias?.toLowerCase();return"name"===t}const y=["geometry","blob","raster","guid","xml"]},23532:function(e,t,r){r.d(t,{$:function(){return n},u:function(){return i}});const n="20241120",i="02addf7fe96c3305c24f844efa4a31df2498ca51"},67895:function(e,t,r){r.d(t,{$:function(){return c}});var n=r(52874),i=r(75505),s=r(21609),o=r(54547),a=r(7590),l=r(16088);const u=e=>{if(!e)return[0,0,0,0];const{r:t,g:r,b:n,a:i}=e;return[t,r,n,255*i]};class c{static findApplicableOverrides(e,t,r){if(e&&t){if(e.primitiveName){let n=!1;for(const t of r)if(t.primitiveName===e.primitiveName){n=!0;break}if(!n)for(const n of t)n.primitiveName===e.primitiveName&&r.push(n)}switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.effects)for(const n of e.effects)c.findApplicableOverrides(n,t,r);if(e.symbolLayers)for(const n of e.symbolLayers)c.findApplicableOverrides(n,t,r);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":case"CIMSolidFill":case"CIMPictureFill":case"CIMHatchFill":case"CIMGradientFill":case"CIMVectorMarker":case"CIMCharacterMarker":case"CIMPictureMarker":if(e.effects)for(const n of e.effects)c.findApplicableOverrides(n,t,r);if(e.markerPlacement&&c.findApplicableOverrides(e.markerPlacement,t,r),"CIMVectorMarker"===e.type){if(e.markerGraphics)for(const n of e.markerGraphics)c.findApplicableOverrides(n,t,r),c.findApplicableOverrides(n.symbol,t,r)}else"CIMCharacterMarker"===e.type?c.findApplicableOverrides(e.symbol,t,r):"CIMHatchFill"===e.type?c.findApplicableOverrides(e.lineSymbol,t,r):"CIMPictureMarker"===e.type&&c.findApplicableOverrides(e.animatedSymbolProperties,t,r)}}}static findEffectOverrides(e,t){if(!e)return null;if("CIMGeometricEffectDashes"===e.type&&(0,a.FH)(e),!t||!e.primitiveName)return{type:"cim-effect-param",effect:e,overrides:[]};const r=(0,a.rB)(e),n=e.primitiveName,i=[];for(const e of t)e.primitiveName===n&&i.push((0,a.rB)(e));return{type:"cim-effect-param",effect:r,overrides:(0,a.pk)(i)}}static async resolveSymbolOverrides(e,t,r,n,i,o,l){if(!e?.symbol)return null;let{symbol:u,primitiveOverrides:p}=e;const d=!!p;if(!d&&!n)return u;u=(0,s.o8)(u),p=(0,s.o8)(p);let h=!0;if(t||(t={attributes:{}},h=!1),d){if(h||(p=p.filter((e=>!e.valueExpressionInfo?.expression.includes("$feature")))),l||(p=p.filter((e=>!e.valueExpressionInfo?.expression.includes("$view")))),p.length>0){const e={spatialReference:r,fields:(0,a.O2)(t.attributes),geometryType:i};await c.createRenderExpressions(p,e),c.evaluateOverrides(p,t,i??"esriGeometryPoint",o,l)}c.applyOverrides(u,p)}return n&&c.applyDictionaryTextOverrides(u,t,n,null),u}static async createRenderExpressions(e,t){const r=[];for(const n of e){const e=n.valueExpressionInfo;if(!e||c._expressionToRenderExpression.has(e.expression))continue;const i=(0,o.Ad)(e.expression,t.spatialReference,t.fields);r.push(i),i.then((t=>c._expressionToRenderExpression.set(e.expression,t)))}r.length>0&&await Promise.all(r)}static evaluateOverrides(e,t,r,n,s){const o={$view:{scale:s?.scale}};for(const s of e){s.value&&"object"==typeof s.value&&(0,i.IB)(s.value)&&("Color"===s.propertyName||"StrokeColor"===s.propertyName)&&(s.value=u(s.value));const e=s.valueExpressionInfo;if(!e)continue;const a=c._expressionToRenderExpression.get(e.expression);a&&(s.value=(0,l.A)(a,t,o,r,n))}}static applyDictionaryTextOverrides(e,t,r,n,i="Normal"){if(e?.type)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":case"CIMTextSymbol":{const s=e.symbolLayers;if(!s)return;for(const o of s)o&&"CIMVectorMarker"===o.type&&c.applyDictionaryTextOverrides(o,t,r,n,"CIMTextSymbol"===e.type?e.textCase:i)}break;case"CIMVectorMarker":{const i=e.markerGraphics;if(!i)return;for(const e of i)e&&c.applyDictionaryTextOverrides(e,t,r,n)}break;case"CIMMarkerGraphic":{const s=e.textString;if(s&&s.includes("[")){const o=(0,a.gQ)(s,r);e.textString=(0,a.FM)(t,o,n,i)}}}}static applyOverrides(e,t,r,n){if(e.primitiveName)for(const i of t)if(i.primitiveName===e.primitiveName){const t=(0,a.YF)(i.propertyName);if(n&&n.push({cim:e,nocapPropertyName:t,value:e[t]}),r){let t=!1;for(const n of r)n.primitiveName===e.primitiveName&&(t=!0);t||r.push(i)}null!=i.value&&(e[t]=i.value)}switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.effects)for(const i of e.effects)c.applyOverrides(i,t,r,n);if(e.symbolLayers)for(const i of e.symbolLayers)c.applyOverrides(i,t,r,n);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMSolidFill":case"CIMVectorMarker":if(e.effects)for(const i of e.effects)c.applyOverrides(i,t,r,n);if("CIMVectorMarker"===e.type&&e.markerGraphics)for(const i of e.markerGraphics)c.applyOverrides(i,t,r,n),c.applyOverrides(i.symbol,t,r,n)}}static restoreOverrides(e){for(const t of e)t.cim[t.nocapPropertyName]=t.value}static buildOverrideKey(e){let t="";for(const r of e)void 0!==r.value&&(t+=`${r.primitiveName}${r.propertyName}${JSON.stringify(r.value)}`);return t}static toValue(e,t){if("DashTemplate"===e)return t.split(" ").map((e=>Number(e)));if("Color"===e){const e=new n.A(t).toRgba();return e[3]*=255,e}return t}}c._expressionToRenderExpression=new Map},38821:function(e,t,r){r.d(t,{D:function(){return s},K:function(){return i}});var n=r(33389);const i={color:[128,128,128,1],outlinecolor:[0,0,0,1],backgroundcolor:[128,128,128,1],borderlinecolor:[0,0,0,1],tintcolor:[255,255,255,1]},s={CIMVectorMarker:{scalesymbolsproportionally:!1,respectframe:!0,anchorpointunits:"Relative",offsetx:0,offsety:0,rotateclockwise:!1,rotation:0,size:10,enable:!0,colorlocked:!1},CIMPictureMarker:{scalex:1,texturefilter:"Draft",anchorpointunits:"Relative",offsetx:0,offsety:0,rotateclockwise:!1,rotation:0,size:10,enable:!0,colorlocked:!1},CIMTextSymbol:{angle:0,anglex:0,angley:0,halosize:1,height:10,horizontalalignment:"Left",kerning:!0,letterspacing:0,letterwidth:100,ligatures:!0,linegap:0,offsetx:0,offsety:0,strikethrough:!1,textcase:"Normal",textstring:"",underline:!1,verticalalignment:"Bottom",enable:!0,colorlocked:!1},CIMSolidStroke:{capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMPictureStroke:{texturefilter:"Draft",capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMGradientStroke:{capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMSolidFill:{enable:!0,colorlocked:!1},CIMPictureFill:{offsetx:0,offsety:0,rotation:0,scalex:1,height:10,texturefilter:"Draft",enable:!0,colorlocked:!1},CIMHatchFill:{offsetx:0,offsety:0,rotation:0,separation:4,enable:!0,colorlocked:!1},CIMGeometricEffectAddControlPoints:{angletolerance:120},CIMGeometricEffectArrow:{arrowtype:"OpenEnded",width:5},CIMGeometricEffectBuffer:{size:1},CIMGeometricEffectCut:{begincut:1,endcut:1,middlecut:0,invert:!1},CIMGeometricEffectDashes:{customendingoffset:0,linedashending:"NoConstraint",offsetalongline:0},CIMGeometricEffectDonut:{method:"Mitered",option:"Accurate",width:2},CIMGeometricEffectJog:{angle:225,length:20,position:50},CIMGeometricEffectControlMeasureLine:{rule:"FullGeometry"},CIMGeometricEffectMove:{offsetx:1,offsety:-1},CIMGeometricEffectOffset:{method:"Square",offset:1,option:"Fast"},CIMGeometricEffectRotate:{angle:15},CIMGeometricEffectScale:{xscalefactor:1.15,yscalefactor:1.15},CIMGeometricEffectWave:{amplitude:2,period:3,seed:1,waveform:"Sinus"},CIMMarkerPlacementAlongLine:{customendingoffset:0,endings:"WithHalfGap",offsetalongline:0,placeperpart:!0,angletoline:!0,offset:0},CIMMarkerPlacementAtExtremities:{extremityplacement:"Both",offsetalongline:0,angletoline:!0,offset:0},CIMMarkerPlacementAtRatioPositions:{beginposition:0,endposition:0,flipfirst:!0,angletoline:!0,offset:0},CIMMarkerPlacementInsidePolygon:{gridangle:0,gridtype:"Fixed",offsetx:0,offsety:0,randomness:100,seed:0,shiftoddrows:!1,stepx:16,stepy:16,clipping:"ClipAtBoundary"},CIMMarkerPlacementOnLine:{relativeto:"LineMiddle",startpointoffset:0,angletoline:!0,offset:0},CIMMarkerPlacementOnVertices:{placeperpart:!0,placeoncontrolpoints:!0,placeonendpoints:!0,placeonregularvertices:!0,angletoline:!0,offset:0},CIMMarkerPlacementPolygonCenter:{method:"OnPolygon",offsetx:0,offsety:0,clipatboundary:!1},CIMAnimatedSymbolProperties:{playanimation:!1,reverseanimation:!1,randomizestarttime:!1,randomizestartseed:0,starttimeoffset:0,duration:3,endingduration:3,useendingduration:!1,repeattype:n.fu.Loop,repeatdelay:0,easing:n.Hz.Linear},CIMSymbolAnimationSize:{tosize:10},CIMSymbolAnimationScale:{scalefactor:1},CIMSymbolAnimationColor:{tocolor:[255,255,255,1]},CIMSymbolAnimationTransparency:{totransparency:0},CIMSymbolAnimationRotation:{torotation:0},CIMSymbolAnimationOffset:{offsetx:0,offsety:0}}},33389:function(e,t,r){var n,i,s,o,a,l,u,c,p,d,h,f,y,m,g,w,_,v,b,S,I,M,x,F,A,T,C,E,L,O,R,k,N,D,P,Z,j,V,U,z,G,q,B,$,J,W,H,Q,K,Y,X,ee,te,re,ne,ie,se,oe,ae,le,ue,ce;r.d(t,{$2:function(){return a},C1:function(){return s},Hz:function(){return f},JO:function(){return i},M1:function(){return x},O$:function(){return oe},Q1:function(){return H},TZ:function(){return _},WE:function(){return L},Y:function(){return u},YI:function(){return K},bj:function(){return c},e_:function(){return W},f0:function(){return se},fu:function(){return h},g7:function(){return p},ip:function(){return Q},mU:function(){return O},oF:function(){return I},uQ:function(){return M},uT:function(){return j},vG:function(){return le},wd:function(){return G},xR:function(){return n},xn:function(){return v},xw:function(){return T},yS:function(){return V}}),function(e){e[e.BUTT=0]="BUTT",e[e.ROUND=1]="ROUND",e[e.SQUARE=2]="SQUARE",e[e.UNKNOWN=4]="UNKNOWN"}(n||(n={})),function(e){e[e.BEVEL=0]="BEVEL",e[e.ROUND=1]="ROUND",e[e.MITER=2]="MITER",e[e.UNKNOWN=4]="UNKNOWN"}(i||(i={})),function(e){e[e.SCREEN=0]="SCREEN",e[e.MAP=1]="MAP"}(s||(s={})),function(e){e[e.Tint=0]="Tint",e[e.Ignore=1]="Ignore",e[e.Multiply=99]="Multiply"}(o||(o={})),function(e){e.Both="Both",e.JustBegin="JustBegin",e.JustEnd="JustEnd",e.None="None"}(a||(a={})),function(e){e[e.Mosaic=0]="Mosaic",e[e.Centered=1]="Centered"}(l||(l={})),function(e){e[e.Normal=0]="Normal",e[e.Superscript=1]="Superscript",e[e.Subscript=2]="Subscript"}(u||(u={})),function(e){e[e.MSSymbol=0]="MSSymbol",e[e.Unicode=1]="Unicode"}(c||(c={})),function(e){e[e.Unspecified=0]="Unspecified",e[e.TrueType=1]="TrueType",e[e.PSOpenType=2]="PSOpenType",e[e.TTOpenType=3]="TTOpenType",e[e.Type1=4]="Type1"}(p||(p={})),function(e){e[e.Display=0]="Display",e[e.Map=1]="Map"}(d||(d={})),function(e){e.None="None",e.Loop="Loop",e.Oscillate="Oscillate"}(h||(h={})),function(e){e.Linear="Linear",e.EaseIn="EaseIn",e.EaseOut="EaseOut",e.EaseInOut="EaseInOut"}(f||(f={})),function(e){e[e.Z=0]="Z",e[e.X=1]="X",e[e.Y=2]="Y"}(y||(y={})),function(e){e[e.XYZ=0]="XYZ",e[e.ZXY=1]="ZXY",e[e.YXZ=2]="YXZ"}(m||(m={})),function(e){e[e.Rectangle=0]="Rectangle",e[e.RoundedRectangle=1]="RoundedRectangle",e[e.Oval=2]="Oval"}(g||(g={})),function(e){e[e.None=0]="None",e[e.Alpha=1]="Alpha",e[e.Screen=2]="Screen",e[e.Multiply=3]="Multiply",e[e.Add=4]="Add"}(w||(w={})),function(e){e[e.TTB=0]="TTB",e[e.RTL=1]="RTL",e[e.BTT=2]="BTT"}(_||(_={})),function(e){e[e.None=0]="None",e[e.SignPost=1]="SignPost",e[e.FaceNearPlane=2]="FaceNearPlane"}(v||(v={})),function(e){e[e.Float=0]="Float",e[e.String=1]="String",e[e.Boolean=2]="Boolean"}(b||(b={})),function(e){e[e.Intersect=0]="Intersect",e[e.Subtract=1]="Subtract"}(S||(S={})),function(e){e.OpenEnded="OpenEnded",e.Block="Block",e.Crossed="Crossed"}(I||(I={})),function(e){e.FullGeometry="FullGeometry",e.PerpendicularFromFirstSegment="PerpendicularFromFirstSegment",e.ReversedFirstSegment="ReversedFirstSegment",e.PerpendicularToSecondSegment="PerpendicularToSecondSegment",e.SecondSegmentWithTicks="SecondSegmentWithTicks",e.DoublePerpendicular="DoublePerpendicular",e.OppositeToFirstSegment="OppositeToFirstSegment",e.TriplePerpendicular="TriplePerpendicular",e.HalfCircleFirstSegment="HalfCircleFirstSegment",e.HalfCircleSecondSegment="HalfCircleSecondSegment",e.HalfCircleExtended="HalfCircleExtended",e.OpenCircle="OpenCircle",e.CoverageEdgesWithTicks="CoverageEdgesWithTicks",e.GapExtentWithDoubleTicks="GapExtentWithDoubleTicks",e.GapExtentMidline="GapExtentMidline",e.Chevron="Chevron",e.PerpendicularWithArc="PerpendicularWithArc",e.ClosedHalfCircle="ClosedHalfCircle",e.TripleParallelExtended="TripleParallelExtended",e.ParallelWithTicks="ParallelWithTicks",e.Parallel="Parallel",e.PerpendicularToFirstSegment="PerpendicularToFirstSegment",e.ParallelOffset="ParallelOffset",e.OffsetOpposite="OffsetOpposite",e.OffsetSame="OffsetSame",e.CircleWithArc="CircleWithArc",e.DoubleJog="DoubleJog",e.PerpendicularOffset="PerpendicularOffset",e.LineExcludingLastSegment="LineExcludingLastSegment",e.MultivertexArrow="MultivertexArrow",e.CrossedArrow="CrossedArrow",e.ChevronArrow="ChevronArrow",e.ChevronArrowOffset="ChevronArrowOffset",e.PartialFirstSegment="PartialFirstSegment",e.Arch="Arch",e.CurvedParallelTicks="CurvedParallelTicks",e.Arc90Degrees="Arc90Degrees",e.TipWithPerpendicularAndTicks="TipWithPerpendicularAndTicks",e.ConcentricCircles="ConcentricCircles",e.DoubleJogArrow="DoubleJogArrow",e.LinkedChevrons="LinkedChevrons",e.SegmentThenHalfCircle="SegmentThenHalfCircle",e.LineWithStraightTicks="LineWithStraightTicks",e.DoubleCurve="DoubleCurve",e.ParallelWithTicksByWidth="ParallelWithTicksByWidth",e.EnclosingRoundedRectangle="EnclosingRoundedRectangle"}(M||(M={})),function(e){e.Mitered="Mitered",e.Bevelled="Bevelled",e.Rounded="Rounded",e.Square="Square",e.TrueBuffer="TrueBuffer"}(x||(x={})),function(e){e.ClosePath="ClosePath",e.ConvexHull="ConvexHull",e.RectangularBox="RectangularBox"}(F||(F={})),function(e){e.BeginningOfLine="BeginningOfLine",e.EndOfLine="EndOfLine"}(A||(A={})),function(e){e.Mitered="Mitered",e.Bevelled="Bevelled",e.Rounded="Rounded",e.Square="Square"}(T||(T={})),function(e){e.Fast="Fast",e.Accurate="Accurate"}(C||(C={})),function(e){e.BeginningOfLine="BeginningOfLine",e.EndOfLine="EndOfLine"}(E||(E={})),function(e){e.Sinus="Sinus",e.Square="Square",e.Triangle="Triangle",e.Random="Random"}(L||(L={})),function(e){e[e.None=0]="None",e[e.Default=1]="Default",e[e.Force=2]="Force"}(O||(O={})),function(e){e[e.Buffered=0]="Buffered",e[e.Left=1]="Left",e[e.Right=2]="Right",e[e.AlongLine=3]="AlongLine"}(R||(R={})),function(e){e[e.Linear=0]="Linear",e[e.Rectangular=1]="Rectangular",e[e.Circular=2]="Circular",e[e.Buffered=3]="Buffered"}(k||(k={})),function(e){e[e.Discrete=0]="Discrete",e[e.Continuous=1]="Continuous"}(N||(N={})),function(e){e[e.AcrossLine=0]="AcrossLine",e[e.AloneLine=1]="AloneLine"}(D||(D={})),function(e){e[e.Left=0]="Left",e[e.Right=1]="Right",e[e.Center=2]="Center",e[e.Justify=3]="Justify"}(P||(P={})),function(e){e[e.Base=0]="Base",e[e.MidPoint=1]="MidPoint",e[e.ThreePoint=2]="ThreePoint",e[e.FourPoint=3]="FourPoint",e[e.Underline=4]="Underline",e[e.CircularCW=5]="CircularCW",e[e.CircularCCW=6]="CircularCCW"}(Z||(Z={})),function(e){e.Butt="Butt",e.Round="Round",e.Square="Square"}(j||(j={})),function(e){e.NoConstraint="NoConstraint",e.HalfPattern="HalfPattern",e.HalfGap="HalfGap",e.FullPattern="FullPattern",e.FullGap="FullGap",e.Custom="Custom"}(V||(V={})),function(e){e[e.None=-1]="None",e[e.Custom=0]="Custom",e[e.Circle=1]="Circle",e[e.OpenArrow=2]="OpenArrow",e[e.ClosedArrow=3]="ClosedArrow",e[e.Diamond=4]="Diamond"}(U||(U={})),function(e){e[e.ExtraLeading=0]="ExtraLeading",e[e.Multiple=1]="Multiple",e[e.Exact=2]="Exact"}(z||(z={})),function(e){e.Bevel="Bevel",e.Round="Round",e.Miter="Miter"}(G||(G={})),function(e){e[e.Default=0]="Default",e[e.String=1]="String",e[e.Numeric=2]="Numeric"}(q||(q={})),function(e){e[e.InsidePolygon=0]="InsidePolygon",e[e.PolygonCenter=1]="PolygonCenter",e[e.RandomlyInsidePolygon=2]="RandomlyInsidePolygon"}(B||(B={})),function(e){e[e.Tint=0]="Tint",e[e.Replace=1]="Replace",e[e.Multiply=2]="Multiply"}($||($={})),function(e){e[e.ClipAtBoundary=0]="ClipAtBoundary",e[e.RemoveIfCenterOutsideBoundary=1]="RemoveIfCenterOutsideBoundary",e[e.DoNotTouchBoundary=2]="DoNotTouchBoundary",e[e.DoNotClip=3]="DoNotClip"}(J||(J={})),function(e){e.NoConstraint="NoConstraint",e.WithMarkers="WithMarkers",e.WithFullGap="WithFullGap",e.WithHalfGap="WithHalfGap",e.Custom="Custom"}(W||(W={})),function(e){e.Fixed="Fixed",e.Random="Random",e.RandomFixedQuantity="RandomFixedQuantity"}(H||(H={})),function(e){e.LineMiddle="LineMiddle",e.LineBeginning="LineBeginning",e.LineEnd="LineEnd",e.SegmentMidpoint="SegmentMidpoint"}(Q||(Q={})),function(e){e.OnPolygon="OnPolygon",e.CenterOfMass="CenterOfMass",e.BoundingBoxCenter="BoundingBoxCenter"}(K||(K={})),function(e){e[e.Low=0]="Low",e[e.Medium=1]="Medium",e[e.High=2]="High"}(Y||(Y={})),function(e){e[e.MarkerCenter=0]="MarkerCenter",e[e.MarkerBounds=1]="MarkerBounds"}(X||(X={})),function(e){e[e.None=0]="None",e[e.PropUniform=1]="PropUniform",e[e.PropNonuniform=2]="PropNonuniform",e[e.DifUniform=3]="DifUniform",e[e.DifNonuniform=4]="DifNonuniform"}(ee||(ee={})),function(e){e.Tube="Tube",e.Strip="Strip",e.Wall="Wall"}(te||(te={})),function(e){e[e.Random=0]="Random",e[e.Increasing=1]="Increasing",e[e.Decreasing=2]="Decreasing",e[e.IncreasingThenDecreasing=3]="IncreasingThenDecreasing"}(re||(re={})),function(e){e[e.Relative=0]="Relative",e[e.Absolute=1]="Absolute"}(ne||(ne={})),function(e){e[e.Normal=0]="Normal",e[e.LowerCase=1]="LowerCase",e[e.Allcaps=2]="Allcaps"}(ie||(ie={})),function(e){e[e.LTR=0]="LTR",e[e.RTL=1]="RTL"}(se||(se={})),function(e){e.Draft="Draft",e.Picture="Picture",e.Text="Text"}(oe||(oe={})),function(e){e[e.Top=0]="Top",e[e.Center=1]="Center",e[e.Baseline=2]="Baseline",e[e.Bottom=3]="Bottom"}(ae||(ae={})),function(e){e[e.Right=0]="Right",e[e.Upright=1]="Upright"}(le||(le={})),function(e){e[e.Small=0]="Small",e[e.Medium=1]="Medium",e[e.Large=2]="Large"}(ue||(ue={})),function(e){e[e.Calm=0]="Calm",e[e.Rippled=1]="Rippled",e[e.Slight=2]="Slight",e[e.Moderate=3]="Moderate"}(ce||(ce={}))},7590:function(e,t,r){r.d(t,{$w:function(){return g},Bu:function(){return E},DW:function(){return F},FH:function(){return V},FM:function(){return u},G9:function(){return s},GV:function(){return _},Go:function(){return c},K3:function(){return j},Kn:function(){return M},MM:function(){return h},MO:function(){return G},Nl:function(){return L},Ny:function(){return v},O2:function(){return O},UE:function(){return R},YC:function(){return z},YF:function(){return N},ZO:function(){return P},_1:function(){return T},_H:function(){return S},_W:function(){return w},_d:function(){return x},bs:function(){return U},dI:function(){return H},e6:function(){return p},gQ:function(){return l},iA:function(){return Z},jn:function(){return y},lW:function(){return d},mA:function(){return f},n5:function(){return k},pM:function(){return A},pV:function(){return I},pk:function(){return q},rB:function(){return B},s4:function(){return i},xo:function(){return C},yH:function(){return b},zb:function(){return D},zr:function(){return m}});var n=r(38821);function i(e,t,r,n){return function(e){return"function"==typeof e}(e)?e(t,r,n):e}function s(e){return[e.r,e.g,e.b,e.a]}const o=" /-,\n";function a(e){let t=e.length;for(;t--;)if(!o.includes(e.charAt(t)))return!1;return!0}function l(e,t){const r=[];let n=0,i=-1;do{if(i=e.indexOf("[",n),i>=n){if(i>n){const t=e.slice(n,i);r.push([t,null,a(t)])}if(n=i+1,i=e.indexOf("]",n),i>=n){if(i>n){const s=t[e.slice(n,i)];s&&r.push([null,s,!1])}n=i+1}}}while(-1!==i);if(n<e.length){const t=e.slice(n);r.push([t,null,a(t)])}return r}function u(e,t,r,n){let i="",s=null;for(const n of t){const[t,o,a]=n;if(t)a?s=t:(s&&(i+=s,s=null),i+=t);else{let t=o;null!=r&&(t=G(o,r));const n=e.attributes[t];n&&(s&&(i+=s,s=null),i+=n)}}return function(e,t){switch("string"!=typeof e&&(e=String(e)),t){case"LowerCase":return e.toLowerCase();case"Allcaps":return e.toUpperCase();default:return e}}(i,n)}function c(e,t,r,n,i,s,o=!0){const a=t/i,l=r/s,u=Math.ceil(a/2),c=Math.ceil(l/2);for(let r=0;r<s;r++)for(let p=0;p<i;p++){const d=4*(p+(o?s-r-1:r)*i);let h=0,f=0,y=0,m=0,g=0,w=0,_=0;const v=(r+.5)*l;for(let n=Math.floor(r*l);n<(r+1)*l;n++){const r=Math.abs(v-(n+.5))/c,i=(p+.5)*a,s=r*r;for(let r=Math.floor(p*a);r<(p+1)*a;r++){let o=Math.abs(i-(r+.5))/u;const a=Math.sqrt(s+o*o);a>=-1&&a<=1&&(h=2*a*a*a-3*a*a+1,h>0&&(o=4*(r+n*t),_+=h*e[o+3],y+=h,e[o+3]<255&&(h=h*e[o+3]/250),m+=h*e[o],g+=h*e[o+1],w+=h*e[o+2],f+=h))}}n[d]=m/f,n[d+1]=g/f,n[d+2]=w/f,n[d+3]=_/y}}function p(e){return e?[e[0],e[1],e[2],e[3]/255]:[0,0,0,0]}function d(e){return e.data?.symbol??null}function h(e){return"CIMVectorMarker"===e.type||"CIMPictureMarker"===e.type||"CIMBarChartMarker"===e.type||"CIMCharacterMarker"===e.type||"CIMPieChartMarker"===e.type||"CIMStackedBarChartMarker"===e.type}function f(e){return"CIMGradientStroke"===e.type||"CIMPictureStroke"===e.type||"CIMSolidStroke"===e.type}function y(e){return null!=e&&("CIMGradientFill"===e.type||"CIMHatchFill"===e.type||"CIMPictureFill"===e.type||"CIMSolidFill"===e.type||"CIMWaterFill"===e.type)}function m(e){return null!=e&&("CIMMarkerPlacementAlongLineRandomSize"===e.type||"CIMMarkerPlacementAlongLineSameSize"===e.type||"CIMMarkerPlacementAlongLineVariableSize"===e.type||"CIMMarkerPlacementAtExtremities"===e.type||"CIMMarkerPlacementAtMeasuredUnits"===e.type||"CIMMarkerPlacementAtRatioPositions"===e.type||"CIMMarkerPlacementOnLine"===e.type||"CIMMarkerPlacementOnVertices"===e.type)}const g=(e,t=0)=>null==e||isNaN(e)?t:e,w=(e,t)=>null!=e?e:t,_=(e,t)=>e??t,v=e=>e.tintColor?p(e.tintColor):[255,255,255,1],b=e=>{if(!e)return!1;for(const t of e)switch(t.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":case"CIMGeometricEffectDonut":return!0}return!1};function S(){return r.e(4696).then(r.bind(r,28356))}function I(e){if(!e)return"normal";switch(e.toLowerCase()){case"italic":return"italic";case"oblique":return"oblique";default:return"normal"}}function M(e){if(!e)return"normal";switch(e.toLowerCase()){case"bold":return"bold";case"bolder":return"bolder";case"lighter":return"lighter";default:return"normal"}}function x(e){let t="normal",r="normal";if(e){const n=e.toLowerCase();n.includes("italic")?t="italic":n.includes("oblique")&&(t="oblique"),n.includes("bold")?r="bold":n.includes("light")&&(r="lighter")}return{style:t,weight:r}}function F(e){return e.underline?"underline":e.strikethrough?"line-through":"none"}function A(e){if(!e)return null;switch(e.type){case"CIMPolygonSymbol":if(e.symbolLayers)for(const t of e.symbolLayers){const e=A(t);if(null!=e)return e}break;case"CIMTextSymbol":return A(e.symbol);case"CIMSolidFill":return e.color}return null}function T(e){if(e)switch(e.type){case"CIMPolygonSymbol":case"CIMLineSymbol":{const t=e.symbolLayers;if(t)for(const e of t){const t=T(e);if(null!=t)return t}break}case"CIMTextSymbol":return T(e.symbol);case"CIMSolidStroke":return e.color}}function C(e){if(e)switch(e.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(e.symbolLayers)for(const t of e.symbolLayers){const e=C(t);if(void 0!==e)return e}break;case"CIMTextSymbol":return C(e.symbol);case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return e.width}}function E(e){switch(e){case"Left":default:return"left";case"Right":return"right";case"Center":case"Justify":return"center"}}function L(e){switch(e){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function O(e){return(e?Object.keys(e):[]).map((t=>({name:t,alias:t,type:"string"==typeof e[t]?"esriFieldTypeString":"esriFieldTypeDouble"})))}const R=e=>e.includes("data:image/svg+xml");function k(e){if(!e)return null;switch(e.type){case"CIMPointSymbol":case"CIMTextSymbol":return"esriGeometryPoint";case"CIMLineSymbol":return"esriGeometryPolyline";case"CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}}function N(e){return e?e.charAt(0).toLowerCase()+e.slice(1):e}function D(e,t,r,n,i,s,o=!0){const{infos:a}=s;let l=1,u=0,c=0,p=0,d=1;for(const{absoluteAnchorPoint:e,offsetX:t,offsetY:r,rotation:n,size:i,frameHeight:s,rotateClockWise:h,scaleSymbolsProportionally:f}of a)d=e?1:l,c=J(t,r,u,d,c),p=$(t,r,u,d,p),s&&(f||o)&&(l*=i/s),u=W(n,h,u);const h=J(n,i,u,d,c),f=$(n,i,u,d,p);return{size:e*l,rotation:W(t,r,u),offsetX:h,offsetY:f}}function P(e){if(null==e)return!1;if(Array.isArray(e))return e.every((e=>P(e)));switch(typeof e){case"string":return!!e;case"number":return!isNaN(e)}}function Z(e,t){if("color"===t||"outlinecolor"===t||"backgroundcolor"===t||"borderlinecolor"===t||"tintcolor"===t)return[...n.K[t]];const r=n.D[e];if(!r)throw new Error(`InternalError: default value for type ${e}.`);return r[t]}function j(e){return"string"==typeof e?function(e){return e.split(" ").map((e=>Number(e)))}(e):e}function V(e){return e?.dashTemplate&&(e.dashTemplate=j(e.dashTemplate)),e}function U(e){if(null==e)return"Normal";switch(e.type){case"CIMTextSymbol":return e.textCase??"Normal";case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const t=e.symbolLayers;if(!t)return"Normal";for(const e of t)if("CIMVectorMarker"===e.type)return U(e)}break;case"CIMVectorMarker":{const t=e.markerGraphics;if(!t)return"Normal";for(const e of t)if(e.symbol)return U(e.symbol)}}return"Normal"}function z(e){if(e)switch(e.type){case"CIMTextSymbol":return e.height;case"CIMPointSymbol":{let t=0;if(e.symbolLayers)for(const r of e.symbolLayers)if(r)switch(r.type){case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":{const e=r.size??n.D.CIMVectorMarker.size;e>t&&(t=e);break}}return t}case"CIMLineSymbol":case"CIMPolygonSymbol":{let t=0;if(e.symbolLayers)for(const r of e.symbolLayers)if(r)switch(r.type){case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":{const e=r.width;null!=e&&e>t&&(t=e);break}case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":if(r.markerPlacement&&m(r.markerPlacement)){const e=r.size??n.D.CIMVectorMarker.size;e>t&&(t=e)}break;case"CIMPictureFill":{const e=r.height;null!=e&&e>t&&(t=e)}}return t}}}function G(e,t){if(null!==t){const r=t.get(e);return r?r.name:e}return e}function q(e){return e.map((e=>({...e,propertyName:N(e.propertyName)})))}function B(e){const t={};for(const r in e){const n=e[r];t[N(r)]=n}return t}function $(e,t,r,n,i){const s=r*Math.PI/180;if(s){const r=Math.cos(s);return(Math.sin(s)*e+r*t)*n+i}return t*n+i}function J(e,t,r,n,i){const s=r*Math.PI/180;return s?(Math.cos(s)*e-Math.sin(s)*t)*n+i:e*n+i}function W(e,t,r){return t?r-e:r+e}function H(e,t,r){const n="Color"===r||"TintColor"===r||"ToColor"===r,i="Rotation"===r||"Angle"===r||"ToRotation"===r;let s=t[N(r)];if(null!=s&&(n?s=[s[0]/255,s[1]/255,s[2]/255,s[3]/255]:i&&(s*=Math.PI/180)),null==s&&(s=Z(t.type,r.toLowerCase()),null!=s&&(n?s=[s[0]/255,s[1]/255,s[2]/255,s[3]]:i&&(s*=Math.PI/180))),null!=t.primitiveName){const o=e[t.primitiveName];if(null!=o){const e=o[r];null==e||("string"==typeof e||"number"==typeof e||Array.isArray(e)?(s=e,null!=s&&(n?s=[s[0]/255,s[1]/255,s[2]/255,s[3]/255]:i&&(s*=Math.PI/180))):(s={valueExpressionInfo:e,defaultValue:s},null!=s&&(n?s={type:"Process",op:"ArcadeColor",value:s}:i&&(s={type:"Process",op:"Divide",left:s,right:180/Math.PI}))))}}if(null==s)throw new Error(`Failed to derive a value or an expression for "${r}".`);return s}},74661:function(e,t,r){r.d(t,{A7:function(){return u},Cx:function(){return c},Hk:function(){return p},JJ:function(){return y},SF:function(){return d},UK:function(){return l},jM:function(){return h},x3:function(){return f}}),r(58941);var n=r(8740),i=r(22198),s=r(90363),o=r(90972),a=r(6259);const l=s.A.fromJSON(a.Cb),u=i.A.fromJSON(a.yM),c=n.A.fromJSON(a.WR),p=o.A.fromJSON(a.JZ);function d(e){if(null==e)return null;switch(e.type){case"mesh":return null;case"point":case"multipoint":return l;case"polyline":return u;case"polygon":case"extent":return c}return null}const h=s.A.fromJSON(a.nC),f=i.A.fromJSON(a.HW),y=n.A.fromJSON(a.b6)},40990:function(e,t,r){r.d(t,{af:function(){return v},al:function(){return _},dX:function(){return b}});var n=r(52874),i=(r(10748),r(78879)),s=(r(58941),r(13520)),o=r(22762),a=r(56150),l=r(97025),u=r(78018),c=r(15186),p=r(10052),d=r(74661),h=r(6259),f=r(77529);const y=u.A.fromSimpleMarkerSymbol(d.UK),m=a.A.fromSimpleLineSymbol(d.A7),g=c.A.fromSimpleFillSymbol(d.Cx),w=new l.A({symbolLayers:new i.A([new o.A({material:{color:h.fT},edges:new p.A({size:(0,s.PN)(1),color:new n.A(h.JR)})})])}),_=new a.A({symbolLayers:new i.A([new f.A({material:{color:new n.A([0,0,0])},size:(0,s.PN)(1)})])}),v=new c.A({symbolLayers:new i.A([new o.A({outline:{color:new n.A([0,0,0]),size:(0,s.PN)(1)}})])});function b(e){if(null==e)return null;switch(e.type){case"mesh":return w;case"point":case"multipoint":return y;case"polyline":return m;case"polygon":case"extent":return g}return null}},6259:function(e,t,r){r.d(t,{Cb:function(){return s},HW:function(){return c},JR:function(){return i},JZ:function(){return l},WR:function(){return a},b6:function(){return p},fT:function(){return n},nC:function(){return u},yM:function(){return o}});const n=[252,146,31,255],i=[153,153,153,255],s={type:"esriSMS",style:"esriSMSCircle",size:6,color:n,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},o={type:"esriSLS",style:"esriSLSSolid",width:.75,color:n},a={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},l={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},u={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},c={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},p={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null}},8404:function(e,t,r){r.d(t,{M9:function(){return u},oO:function(){return c},rS:function(){return h}});var n=r(10748),i=r(39819),s=r(11432),o=r(97992),a=r(11299),l=r(36e3);function u(e,t,r,n){const i=d(e,{},{context:n,isLabelSymbol:!1});null!=i&&(t[r]=i)}function c(e,t,r,n){const i=d(e,{},{context:n,isLabelSymbol:!0});null!=i&&(t[r]=i)}function p(e){return e instanceof o.A||e instanceof l.A}function d(e,t,r){if(null==e)return null;const{context:n,isLabelSymbol:l}=r,u=n?.origin,c=n?.messages;if("web-scene"===u&&!p(e)){const r=(0,a.t)(e,{retainCIM:!0,hasLabelingContext:l});return null!=r.symbol?r.symbol.write(t,n):(c?.push(new i.A("symbol:unsupported",`Symbols of type '${e.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:e,context:n,error:r.error})),null)}return(0,s.TU)(n?.layer)&&function(e){return e instanceof o.A&&("polygon-3d"===e.type||"line-3d"===e.type)}(e)?(c?.push(new i.A("symbol:unsupported",`Symbols of type '${e.declaredClass}' are not supported on layers of type '${n?.layer?.declaredClass}'.`,{symbol:e,context:n})),null):("web-map"===u||"portal-item"===u&&!(0,s.TU)(n?.layer))&&p(e)?(c?.push(new i.A("symbol:unsupported",`Symbols of type '${e.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:e,context:n})),null):e.write(t,n)}function h(e,t){return(0,n.Bu)(e,null,t)}},58916:function(e,t,r){r.d(t,{jg:function(){return g},cF:function(){return p},bo:function(){return d},yA:function(){return f},o5:function(){return h}});var n=r(93040),i=r(39819),s=r(58941),o=r(60539),a=r(90683),l=r(51432),u=r(26544);const c=new Map;function p(e,t,r){return null!=e?.styleUrl?async function(e,t){try{return{data:(await f(e,t)).data,baseUrl:(0,a.nM)(e),styleUrl:e}}catch(e){return(0,o.QP)(e),null}}(e.styleUrl,r):null!=e?.styleName?function(e,t,r){const n=null!=t.portal?t.portal:l.A.getDefault();let s;const o=`${n.url} - ${n.user?.username} - ${e}`,a=c.get(o);if(a)return a;const p=function(e,t,r){return t.load(r).then((()=>{const n=new u.A({disableExtraQuery:!0,query:`owner:${y} AND type:${m} AND typekeywords:"${e}"`});return t.queryItems(n,r)})).then((({results:t})=>{let n=null;const s=e.toLowerCase();if(t&&Array.isArray(t))for(const e of t){const t=e.typeKeywords?.some((e=>e.toLowerCase()===s));if(t&&e.type===m&&e.owner===y){n=e;break}}if(!n)throw new i.A("symbolstyleutils:style-not-found",`The style '${e}' could not be found`,{styleName:e});return n.load(r)}))}(e,n,r).then((e=>(s=e,e.fetchData()))).then((t=>({data:t,baseUrl:s.itemUrl??"",styleName:e})));return c.set(o,p),p}(e.styleName,t,r):Promise.reject(new i.A("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function d(e){return null===e||"CIMSymbolReference"===e.type?e:{type:"CIMSymbolReference",symbol:e}}function h(e,t,r=["gltf"]){if("cimRef"===t)return encodeURI(e.cimRef);if(e.formatInfos&&!(0,s.A)("enable-feature:force-wosr"))for(const t of r){const r=e.formatInfos.find((e=>e.type===t));if(r)return r.href}return encodeURI(e.webRef)}function f(e,t){const r={responseType:"json",query:{f:"json"},...t};return(0,n.A)((0,a.S8)(e),r)}const y="esri_en",m="Style",g="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json"},11299:function(e,t,r){r.d(t,{c:function(){return w},t:function(){return _}});var n=r(10748),i=r(39819),s=r(40990),o=r(36e3),a=r(78018),l=r(22198),u=r(56150),c=r(90363),p=r(24411),d=r(8740),h=r(97025),f=r(15186),y=r(90972),m=r(56922);const g="#useCIMFallbackSymbology()",w={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function _(e,t=w){if(!e)return{symbol:null};const{retainId:r=w.retainId,ignoreDrivers:_=w.ignoreDrivers,hasLabelingContext:v=w.hasLabelingContext,retainCIM:b=w.retainCIM,cimFallbackEnabled:S=w.cimFallbackEnabled}=t;let I=null;if((0,n.wk)(e)||e instanceof o.A)I=e.clone();else if("cim"===e.type){const r=e.data?.symbol?.type;switch(r){case"CIMPointSymbol":I=b?e.clone():a.A.fromCIMSymbol(e);break;case"CIMLineSymbol":S&&(I=s.al.clone(),t?.logWarning?.(g,"Unsupported CIM line symbology converted to fallback 3D line symbology"));break;case"CIMPolygonSymbol":S&&(I=s.af.clone(),t?.logWarning?.(g,"Unsupported CIM polygon symbology converted to fallback 3D polygon symbology"))}if(!I)return{error:new i.A("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${r||"unknown"}' is unsupported in 3D`,{symbol:e})}}else if(e instanceof l.A)I=u.A.fromSimpleLineSymbol(e);else if(e instanceof c.A)I=a.A.fromSimpleMarkerSymbol(e);else if(e instanceof p.A)I=a.A.fromPictureMarkerSymbol(e);else if(e instanceof d.A)I=t.geometryType&&"mesh"===t.geometryType?h.A.fromSimpleFillSymbol(e):f.A.fromSimpleFillSymbol(e);else{if(!(e instanceof y.A))return{error:new i.A("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${e.type||e.declaredClass}' is unsupported in 3D`,{symbol:e})};I=v?m.A.fromTextSymbol(e):a.A.fromTextSymbol(e)}return r&&I&&"cim"!==I.type&&(I.id=e.id),_&&(0,n.wk)(I)&&I.symbolLayers.forEach((e=>e.ignoreDrivers=!0)),{symbol:I}}},92777:function(e,t,r){r.d(t,{A:function(){return R}});var n=r(53804),i=r(30905),s=r(21609),o=r(23502),a=r(77560),l=r(47332),u=r(65953),c=r(81392);let p=class extends i.oY{constructor(e){super(e),this.description=null,this.label=null,this.type=null}};(0,n._)([(0,o.MZ)({type:String,json:{write:!0}})],p.prototype,"description",void 0),(0,n._)([(0,o.MZ)({type:String,json:{write:!0}})],p.prototype,"label",void 0),(0,n._)([(0,o.MZ)()],p.prototype,"type",void 0),p=(0,n._)([(0,u.$)("esri.tables.elements.AttributeTableElement")],p);const d=p;var h,f=r(67888);r(58941),r(40633),r(13798);let y=h=class extends d{constructor(e){super(e),this.displayType="auto",this.type="attachment"}clone(){return new h({description:this.description,displayType:this.displayType,label:this.label})}};(0,n._)([(0,o.MZ)({type:["auto"],json:{write:!0}})],y.prototype,"displayType",void 0),(0,n._)([(0,o.MZ)({type:["attachment"],readOnly:!0,json:{read:!1,write:!0}})],y.prototype,"type",void 0),y=h=(0,n._)([(0,u.$)("esri.tables.elements.AttributeTableAttachmentElement")],y);const m=y;var g;let w=g=class extends d{constructor(e){super(e),this.fieldName=null,this.type="field"}clone(){return new g({description:this.description,fieldName:this.fieldName,label:this.label})}};(0,n._)([(0,o.MZ)({type:String,json:{write:!0}})],w.prototype,"fieldName",void 0),(0,n._)([(0,o.MZ)({type:String,json:{read:!1,write:!0}})],w.prototype,"type",void 0),w=g=(0,n._)([(0,u.$)("esri.tables.elements.AttributeTableFieldElement")],w);const _=w;var v;let b=v=class extends d{constructor(e){super(e),this.relationshipId=null,this.type="relationship"}clone(){return new v({description:this.description,label:this.label,relationshipId:this.relationshipId})}};(0,n._)([(0,o.MZ)({type:Number,json:{write:!0}})],b.prototype,"relationshipId",void 0),(0,n._)([(0,o.MZ)({type:["relationship"],json:{read:!1,write:!0}})],b.prototype,"type",void 0),b=v=(0,n._)([(0,u.$)("esri.tables.elements.AttributeTableRelationshipElement")],b);const S=b;function I(e){return{typesWithGroup:{base:d,key:"type",typeMap:{attachment:m,field:_,group:e,relationship:S}},typesWithoutGroup:{base:d,key:"type",typeMap:{attachment:m,field:_,relationship:S}}}}function M(e,t,r=!0){if(!e)return null;const n=r?t.typesWithGroup.typeMap:t.typesWithoutGroup.typeMap;return e.filter((e=>n[e.type])).map((e=>n[e.type].fromJSON(e)))}function x(e,t,r=!0){if(!e)return null;const n=r?t.typesWithGroup.typeMap:t.typesWithoutGroup.typeMap;return e.filter((e=>n[e.type])).map((e=>e.toJSON()))}function F(e,t,r=!0){return e?e.map((e=>(0,f.aq)(r?t.typesWithGroup:t.typesWithoutGroup,e))):null}var A;let T=A=class extends d{constructor(e){super(e),this.elements=null,this.type="group"}castElements(e){return F(e,C,!1)}readElements(e,t){return M(t.attributeTableElements,C,!1)}writeElements(e,t){t.attributeTableElements=x(e,C,!1)}clone(){return new A({description:this.description,elements:(0,s.o8)(this.elements),label:this.label})}};(0,n._)([(0,o.MZ)({json:{write:!0}})],T.prototype,"elements",void 0),(0,n._)([(0,a.w)("elements")],T.prototype,"castElements",null),(0,n._)([(0,l.w)("elements",["attributeTableElements"])],T.prototype,"readElements",null),(0,n._)([(0,c.K)("elements")],T.prototype,"writeElements",null),(0,n._)([(0,o.MZ)({type:String,json:{read:!1,write:!0}})],T.prototype,"type",void 0),T=A=(0,n._)([(0,u.$)("esri.tables.elements.AttributeTableGroupElement")],T);const C=I(T);var E;const L=I(T);let O=E=class extends i.oY{constructor(e){super(e),this.elements=null,this.orderByFields=null}castElements(e){return F(e,L)}readElements(e,t){return M(t.attributeTableElements,L)}writeElements(e,t){t.attributeTableElements=x(e,L)}clone(){return new E({elements:(0,s.o8)(this.elements),orderByFields:this.orderByFields})}};(0,n._)([(0,o.MZ)({json:{write:!0}})],O.prototype,"elements",void 0),(0,n._)([(0,a.w)("elements")],O.prototype,"castElements",null),(0,n._)([(0,l.w)("elements",["attributeTableElements"])],O.prototype,"readElements",null),(0,n._)([(0,c.K)("elements")],O.prototype,"writeElements",null),(0,n._)([(0,o.MZ)({type:[Object],json:{write:!0}})],O.prototype,"orderByFields",void 0),O=E=(0,n._)([(0,u.$)("esri.tables.AttributeTableTemplate")],O);const R=O},92427:function(e,t,r){r.d(t,{A:function(){return d}});var n=r(53804),i=r(75743),s=r(30905),o=r(45139),a=r(23502),l=(r(58941),r(40633),r(13798),r(74376)),u=r(65953),c=r(35060);let p=class extends((0,i.O)(s.oY)){constructor(e){super(e),this.unit="milliseconds",this.value=0}toMilliseconds(){return(0,o.t)(this.value,this.unit,"milliseconds")}};(0,n._)([(0,l.e)(c.j,{nonNullable:!0})],p.prototype,"unit",void 0),(0,n._)([(0,a.MZ)({type:Number,json:{write:!0},nonNullable:!0})],p.prototype,"value",void 0),p=(0,n._)([(0,u.$)("esri.time.TimeInterval")],p);const d=p},30193:function(e,t,r){r.d(t,{TA:function(){return i},We:function(){return a},Z3:function(){return s},ZJ:function(){return l},w5:function(){return u}});var n=r(93040);const i=(0,r(66110).vD)(),s=new Map,o=new Map;async function a(e,t,r){if(!e||!r)return!1;if(!t)return!0;const i=new URL(e).host;let o=s.get(i);if(!o){const t=e.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,"");o=(await(0,n.A)(t,{responseType:"json",query:{f:"json"}})).data.defaultVersionName}return o===t}async function l(e,t,n=!1){if(!e||!t)return!0;const s=e.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),a=o.get(s)?.entries();if(a)for(const[e,o]of a)if(o.name===t){const t=!o.stack?.hasForwardEdits();if(!t&&n){const[{deleteForwardEdits:t},{default:n}]=await Promise.all([r.e(7323).then(r.bind(r,96303)),r.e(7237).then(r.bind(r,64971))]),a=await t(s,e,new n({sessionId:i,moment:o.moment}));return a.success&&o.stack?.clearForwardEdits(),a.success}return t}return!0}function u(e,t){if(!e)return!1;const r=e.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),n=o.get(r)?.entries();if(n)for(const[e,r]of n)if(r.name===t)return"edit"===r.lockType;return!1}new Map},16088:function(e,t,r){r.d(t,{A:function(){return o}});var n=r(39819),i=r(40633),s=r(87280);function o(e,t,r,n,s){if(null==e)return null;const o=e.referencesGeometry()&&s?l(t,n,s):t,a=e.repurposeFeature(o);try{return e.evaluate({...r,$feature:a},e.services)}catch(e){return i.A.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",e),null}}const a=new Map;function l(e,t,r){const{transform:o,hasZ:l,hasM:u}=r;a.has(t)||a.set(t,function(e){const t={};switch(e){case"esriGeometryPoint":return(e,r,n,i)=>(0,s.Tr)(r,t,e,n,i);case"esriGeometryPolygon":return(e,r,n,i)=>(0,s.$X)(r,t,e,n,i);case"esriGeometryPolyline":return(e,r,n,i)=>(0,s.P5)(r,t,e,n,i);case"esriGeometryMultipoint":return(e,r,n,i)=>(0,s.SW)(r,t,e,n,i);default:return i.A.getLogger("esri.views.2d.support.arcadeOnDemand").error(new n.A("mapview-arcade",`Unable to handle geometryType: ${e}`)),e=>e}}(t));const c=a.get(t)(e.geometry,o,l,u);return{...e,geometry:c}}},28686:function(e,t,r){r.d(t,{Q:function(){return n}});const n=1/255.5},91448:function(e,t,r){var n;r.d(t,{X:function(){return n}}),function(e){e[e.SAVE=0]="SAVE",e[e.SAVE_AS=1]="SAVE_AS"}(n||(n={}))}}]);
//# sourceMappingURL=arcade-featureSetUtils.js.map