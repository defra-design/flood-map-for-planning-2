"use strict";(self.webpackChunkdefra=self.webpackChunkdefra||[]).push([[2416,3806,4292,6314,8338],{74756:function(e,t,r){r.r(t),r.d(t,{default:function(){return L}});var i=r(53804),n=r(93040),s=r(78879),o=r(61500),a=r(30905),l=r(21609),c=r(31609),u=r(75218),h=r(40633),d=r(95929),f=r(60539),p=r(90683),m=r(23502),_=(r(58941),r(65953)),g=r(81392),y=r(57165),x=r(51432),b=r(43173),w=r(11876),v=r(83525),S=(r(13798),r(22739));const T=new Set(["ar","bs","ca","hr","cs","da","nl","en","et","fi","fr","de","el","he","hu","id","it","ja","ko","lv","lt","nb","pl","ro","ru","sr","es","sv","th","tr","uk","vi"]);let I=class extends v.A{constructor(e){super(e),this.apiKey=null,this.id=null,this.language=null,this.places=null,this.serviceUrl="https://basemapstyles-api.arcgis.com/arcgis/rest/services/styles/v2/webmaps",this.worldview=null}getLanguageParamValue(){if(this.language)return this.language;const e=(0,S.JK)().toLowerCase();switch(e){case"pt-br":return"pt-BR";case"pt-pt":return"pt-PT";case"zh-cn":return"zh-CN";case"zh-hk":return"zh-HK";case"zh-tw":return"zh-TW"}const t=(0,S.Z0)(e);return"pt"===t?"pt-BR":t&&T.has(t)?t:"global"}};(0,i._)([(0,m.MZ)()],I.prototype,"apiKey",void 0),(0,i._)([(0,m.MZ)()],I.prototype,"id",void 0),(0,i._)([(0,m.MZ)()],I.prototype,"language",void 0),(0,i._)([(0,m.MZ)()],I.prototype,"places",void 0),(0,i._)([(0,m.MZ)()],I.prototype,"serviceUrl",void 0),(0,i._)([(0,m.MZ)()],I.prototype,"worldview",void 0),I=(0,i._)([(0,_.$)("esri.support.BasemapStyle")],I);const M=I;var A,E=r(84624);let P=0,C=A=class extends((0,a.Te)(c.A)){constructor(e){super(e),this.id=null,this.portalItem=null,this.spatialReference=null,this.style=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+P++,this.baseLayers=new s.A,this.referenceLayers=new s.A;const t=e=>{e.parent&&e.parent!==this&&"remove"in e.parent&&e.parent.remove(e),e.parent=this,"elevation"===e.type&&h.A.getLogger(this).error(`Layer '${e.title}, id:${e.id}' of type '${e.type}' is not supported as a basemap layer and will therefore be ignored.`)},r=e=>{e.parent=null};this.addHandles([this.baseLayers.on("after-add",(e=>t(e.item))),this.referenceLayers.on("after-add",(e=>t(e.item))),this.baseLayers.on("after-remove",(e=>r(e.item))),this.referenceLayers.on("after-remove",(e=>r(e.item)))])}initialize(){this.when().catch((e=>{h.A.getLogger(this).error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,e)})),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const e=this.baseLayers.toArray();for(const t of e)t.destroy();const t=this.referenceLayers.toArray();for(const e of t)e.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),this.portalItem=(0,d.pR)(this.portalItem)}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e={...e}).resourceInfo),e}set baseLayers(e){this._set("baseLayers",(0,o.V)(e,this._get("baseLayers")))}_writeBaseLayers(e,t,r){const i=[];e?(r={...r,layerContainerType:"basemap"},this.baseLayers.forEach((e=>{const t=(0,E.CJ)(e,r.webmap?r.webmap.getLayerJSONFromResourceInfo(e):null,r);null!=t&&i.push(t)})),this.referenceLayers.forEach((e=>{const t=(0,E.CJ)(e,r.webmap?r.webmap.getLayerJSONFromResourceInfo(e):null,r);null!=t&&("scene"!==e.type&&(t.isReference=!0),i.push(t))})),t.baseMapLayers=i):t.baseMapLayers=i}set referenceLayers(e){this._set("referenceLayers",(0,o.V)(e,this._get("referenceLayers")))}writeTitle(e,t){t.title=e||"Basemap"}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return(0,u.g)(this,(e=>{e(this.baseLayers,this.referenceLayers)}))}clone(){const e={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.map((e=>(0,l.Nb)(e)?e.clone():e)),referenceLayers:this.referenceLayers.map((e=>(0,l.Nb)(e)?e.clone():e))};return this.loaded&&(e.loadStatus="loaded"),new A({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}write(e,t){return e=e||{},t?.origin||(t={origin:"web-map",...t}),super.write(e,t),!this.loaded&&this.resourceInfo?.data.baseMapLayers&&(e.baseMapLayers=this.resourceInfo.data.baseMapLayers.map((e=>{const t=(0,l.o8)(e);return t.url&&(0,p.BQ)(t.url)&&(t.url=`https:${t.url}`),t.templateUrl&&(0,p.BQ)(t.templateUrl)&&(t.templateUrl=`https:${t.templateUrl}`),t}))),e}async _loadFromSource(e){const{resourceInfo:t,portalItem:r,style:i}=this;(0,f.Te)(e);const n=[];if(t){const r=t.context?t.context.url:null;if(n.push(this._loadLayersFromJSON(t.data,r,e)),t.data.id&&!t.data.title){const e=t.data.id;n.push((0,w.q)(e).then((e=>{e&&this.read({title:e},t.context)})))}}else r?n.push(this._loadFromItem(r,e)):i&&n.push(this._loadFromStylesService(i,e));await Promise.all(n)}async _loadLayersFromJSON(e,t,i){const n=this.resourceInfo?.context,s=this.portalItem?.portal||n?.portal||null,o=F[n?.origin||""]??"web-map",{populateOperationalLayers:a}=await r.e(3538).then(r.bind(r,80669)),l=[];if((0,f.Te)(i),e.baseMapLayers&&Array.isArray(e.baseMapLayers)){const r={context:{...n,origin:o,url:t,portal:s,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},i=e=>"web-scene"===o&&"ArcGISSceneServiceLayer"===e.layerType||e.isReference,c=a(this.baseLayers,e.baseMapLayers.filter((e=>!i(e))),r);l.push(c);const u=a(this.referenceLayers,e.baseMapLayers.filter(i),r);l.push(u)}await Promise.allSettled(l)}async _loadFromItem(e,t){const r=await e.load(t),i=await r.fetchData("json",t),n=(0,p.An)(e.itemUrl??"");return this._set("resourceInfo",{data:i.baseMap??{},context:{origin:R[e.type||""]??"web-map",portal:e.portal||x.A.getDefault(),url:n}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:i.spatialReference},this.resourceInfo.context),this.read({title:e.title,thumbnailUrl:e.thumbnailUrl},{origin:"portal-item",portal:e.portal||x.A.getDefault(),url:n}),this._loadLayersFromJSON(this.resourceInfo.data,n,t)}async _loadFromStylesService(e,t){const r=`${e.serviceUrl}/${e.id}`,i=(await(0,n.A)(r,{query:{language:e.getLanguageParamValue(),places:e.places,worldview:e.worldview,token:e.apiKey},signal:t?.signal})).data,s=(0,p.An)(r);if(this._set("resourceInfo",{data:i.baseMap??{},context:{origin:"web-map",url:s}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:i.spatialReference},this.resourceInfo.context),await this._loadLayersFromJSON(this.resourceInfo.data,s,t),e.apiKey)for(const t of[...this.baseLayers,...this.referenceLayers])"apiKey"in t&&(t.apiKey=e.apiKey)}static fromId(e){const t=w.H[e];return t?t.itemId?new A({portalItem:{id:t.itemId,portal:{url:"https://www.arcgis.com"}}}):A.fromJSON(t,{origin:t.is3d?"web-scene":"web-map"}):null}};(0,i._)([(0,m.MZ)({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(e,t,r,i){this._writeBaseLayers(e,t,i)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:s.A}},writer(e,t,r,i){this._writeBaseLayers(e,t,i)}}}}}})],C.prototype,"baseLayers",null),(0,i._)([(0,m.MZ)({type:String,json:{origins:{"web-scene":{write:!0}}}})],C.prototype,"id",void 0),(0,i._)([(0,m.MZ)({type:b.default})],C.prototype,"portalItem",void 0),(0,i._)([(0,m.MZ)()],C.prototype,"referenceLayers",null),(0,i._)([(0,m.MZ)({readOnly:!0})],C.prototype,"resourceInfo",void 0),(0,i._)([(0,m.MZ)({type:y.A})],C.prototype,"spatialReference",void 0),(0,i._)([(0,m.MZ)({type:M})],C.prototype,"style",void 0),(0,i._)([(0,m.MZ)()],C.prototype,"thumbnailUrl",void 0),(0,i._)([(0,m.MZ)({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],C.prototype,"title",void 0),(0,i._)([(0,g.K)("title")],C.prototype,"writeTitle",null),C=A=(0,i._)([(0,_.$)("esri.Basemap")],C);const R={"Web Scene":"web-scene","Web Map":"web-map","Link Chart":"link-chart"},F={"web-scene":"web-scene","web-map":"web-map","link-chart":"link-chart"},L=C},9688:function(e,t,r){r.d(t,{lY:function(){return h},mT:function(){return d}});var i,n=r(50944),s=r(92955),o=r(96285);(i||(i={})).TimeZoneNotRecognized="TimeZoneNotRecognized";const a={[i.TimeZoneNotRecognized]:"Timezone identifier has not been recognized."};class l extends Error{constructor(e,t){super((0,n.HC)(a[e],t)),this.declaredRootClass="esri.arcade.arcadedate.dateerror",Error.captureStackTrace&&Error.captureStackTrace(this,l)}}function c(e,t,r){return e<t?e-t:e>r?e-r:0}function u(e,t,r){return e<t?t:e>r?r:e}class h{constructor(e){this._date=e,this.declaredRootClass="esri.arcade.arcadedate"}static fromParts(e=0,t=1,r=1,i=0,n=0,s=0,a=0,l){if(isNaN(e)||isNaN(t)||isNaN(r)||isNaN(i)||isNaN(n)||isNaN(s)||isNaN(a))return null;const f=o.c9.local(e,t).daysInMonth;let p=o.c9.fromObject({day:u(r,1,f),year:e,month:u(t,1,12),hour:u(i,0,23),minute:u(n,0,59),second:u(s,0,59),millisecond:u(a,0,999)},{zone:d(l)});return p=p.plus({months:c(t,1,12),days:c(r,1,f),hours:c(i,0,23),minutes:c(n,0,59),seconds:c(s,0,59),milliseconds:c(a,0,999)}),new h(p)}static get systemTimeZoneCanonicalName(){return Intl.DateTimeFormat().resolvedOptions().timeZone??"system"}static arcadeDateAndZoneToArcadeDate(e,t){const r=d(t);return e.isUnknownTimeZone||r===s.GB.instance?h.fromParts(e.year,e.monthJS+1,e.day,e.hour,e.minute,e.second,e.millisecond,r):new h(e._date.setZone(r))}static dateJSToArcadeDate(e){return new h(o.c9.fromJSDate(e,{zone:"system"}))}static dateJSAndZoneToArcadeDate(e,t="system"){const r=d(t);return new h(o.c9.fromJSDate(e,{zone:r}))}static unknownEpochToArcadeDate(e){return new h(o.c9.fromMillis(e,{zone:s.GB.instance}))}static unknownDateJSToArcadeDate(e){return new h(o.c9.fromMillis(e.getTime(),{zone:s.GB.instance}))}static epochToArcadeDate(e,t="system"){const r=d(t);return new h(o.c9.fromMillis(e,{zone:r}))}static dateTimeToArcadeDate(e){return new h(e)}clone(){return new h(this._date)}changeTimeZone(e){const t=d(e);return h.dateTimeToArcadeDate(this._date.setZone(t))}static dateTimeAndZoneToArcadeDate(e,t){const r=d(t);return e.zone===s.GB.instance||r===s.GB.instance?h.fromParts(e.year,e.month,e.day,e.hour,e.minute,e.second,e.millisecond,r):new h(e.setZone(r))}static nowToArcadeDate(e){const t=d(e);return new h(o.c9.fromJSDate(new Date,{zone:t}))}static nowUTCToArcadeDate(){return new h(o.c9.utc())}get isSystem(){return"system"===this.timeZone||this.timeZone===h.systemTimeZoneCanonicalName}equals(e){return this.isSystem&&e.isSystem?this.toNumber()===e.toNumber():this.isUnknownTimeZone===e.isUnknownTimeZone&&this._date.equals(e._date)}get isUnknownTimeZone(){return this._date.zone===s.GB.instance}get isValid(){return this._date.isValid}get hour(){return this._date.hour}get second(){return this._date.second}get day(){return this._date.day}get dayOfWeekISO(){return this._date.weekday}get dayOfWeekJS(){let e=this._date.weekday;return e>6&&(e=0),e}get millisecond(){return this._date.millisecond}get monthISO(){return this._date.month}get weekISO(){return this._date.weekNumber}get yearISO(){return this._date.weekYear}get monthJS(){return this._date.month-1}get year(){return this._date.year}get minute(){return this._date.minute}get zone(){return this._date.zone}get timeZoneOffset(){return this.isUnknownTimeZone?0:this._date.offset}get timeZone(){if(this.isUnknownTimeZone)return"unknown";if("system"===this._date.zone.type)return"system";const e=this.zone;return"fixed"===e.type?0===e.fixed?"UTC":e.formatOffset(0,"short"):e.name}stringify(){return JSON.stringify(this.toJSDate())}plus(e){return new h(this._date.plus(e))}diff(e,t="milliseconds"){return this._date.diff(e._date,t)[t]}toISODate(){return this._date.toISODate()}toISOString(e){return e?this._date.toISO({suppressMilliseconds:!0,includeOffset:!this.isUnknownTimeZone}):this._date.toISO({includeOffset:!this.isUnknownTimeZone})}toISOTime(e,t){return this._date.toISOTime({suppressMilliseconds:e,includeOffset:t&&!this.isUnknownTimeZone})}toFormat(e,t){return this.isUnknownTimeZone&&(e=e.replaceAll("Z","")),this._date.toFormat(e,t)}toJSDate(){return this._date.toJSDate()}toSQLValue(){return this._date.toFormat("yyyy-LL-dd HH:mm:ss")}toSQLWithKeyword(){return`timestamp '${this.toSQLValue()}'`}toDateTime(){return this._date}toNumber(){return this._date.toMillis()}getTime(){return this._date.toMillis()}toUTC(){return new h(this._date.toUTC())}toLocal(){return new h(this._date.toLocal())}toString(){return this.toISOString(!0)}static fromReaderAsTimeStampOffset(e){if(!e)return null;const t=o.c9.fromISO(e,{setZone:!0});return new h(t)}}function d(e,t=!0){if(e instanceof o.bo)return e;if("system"===e.toLowerCase())return"system";if("utc"===e.toLowerCase())return"UTC";if("unknown"===e.toLowerCase())return s.GB.instance;if(/^[+-]?[0-9]{1,2}([:][0-9]{2})?$/.test(e)){const t=o.mQ.parseSpecifier("UTC"+(e.startsWith("+")||e.startsWith("-")?"":"+")+e);if(t)return t}const r=o.oh.create(e);if(!r.isValid){if(t)throw new l(i.TimeZoneNotRecognized);return null}return r}},80749:function(e,t,r){r.d(t,{Fq:function(){return l},SQ:function(){return o},Yc:function(){return s},Yq:function(){return a},uf:function(){return n}});var i=r(91484);function n(e){if(null==e)return null;if("number"==typeof e)return e;let t=e.toLowerCase();switch(t=t.replaceAll(/\s/g,""),t=t.replaceAll("-",""),t){case"meters":case"meter":case"m":case"squaremeters":case"squaremeter":return 109404;case"miles":case"mile":case"squaremile":case"squaremiles":return 109439;case"kilometers":case"kilometer":case"squarekilometers":case"squarekilometer":case"km":return 109414;case"acres":case"acre":case"ac":return 109402;case"hectares":case"hectare":case"ha":return 109401;case"yard":case"yd":case"yards":case"squareyards":case"squareyard":return 109442;case"feet":case"ft":case"foot":case"squarefeet":case"squarefoot":return 109405;case"nmi":case"nauticalmile":case"nauticalmiles":case"squarenauticalmile":case"squarenauticalmiles":return 109409}return null}function s(e){if(null==e)return null;switch(e.type){case"polygon":case"multipoint":case"polyline":return e.extent;case"point":return new i.default({xmin:e.x,ymin:e.y,xmax:e.x,ymax:e.y,spatialReference:e.spatialReference});case"extent":return e}return null}function o(e){if(null==e)return null;if("number"==typeof e)return e;let t=e.toLowerCase();switch(t=t.replaceAll(/\s/g,""),t=t.replaceAll("-",""),t){case"meters":case"meter":case"m":case"squaremeters":case"squaremeter":return 9001;case"miles":case"mile":case"squaremile":case"squaremiles":return 9093;case"kilometers":case"kilometer":case"squarekilometers":case"squarekilometer":case"km":return 9036;case"yard":case"yd":case"yards":case"squareyards":case"squareyard":return 9096;case"feet":case"ft":case"foot":case"squarefeet":case"squarefoot":return 9002;case"nmi":case"nauticalmile":case"nauticalmiles":case"squarenauticalmile":case"squarenauticalmiles":return 9030}return null}function a(e){if(null==e)return null;const t=e.clone();return void 0!==e.cache._geVersion&&(t.cache._geVersion=e.cache._geVersion),t}function l(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}},59122:function(e,t,r){function i(e,t,r){r=r||2;var i,s,a,l,c,u,d,f=t&&t.length,p=f?t[0]*r:e.length,m=n(e,0,p,r,!0),_=[];if(!m||m.next===m.prev)return _;if(f&&(m=h(e,t,m,r)),e.length>80*r){i=a=e[0],s=l=e[1];for(var g=r;g<p;g+=r)(c=e[g])<i&&(i=c),(u=e[g+1])<s&&(s=u),c>a&&(a=c),u>l&&(l=u);d=0!==(d=Math.max(a-i,l-s))?1/d:0}return o(m,_,r,i,s,d),_}function n(e,t,r,i,n){var s,o;if(n===R(e,t,r,i)>0)for(s=t;s<r;s+=i)o=E(s,e[s],e[s+1],o);else for(s=r-i;s>=t;s-=i)o=E(s,e[s],e[s+1],o);if(o&&v(o,o.next)){var a=o.next;P(o),o=a}return o}function s(e,t){if(!e)return e;t||(t=e);var r,i=e;do{if(r=!1,i.steiner||!v(i,i.next)&&0!==w(i.prev,i,i.next))i=i.next;else{var n=i.prev;if(P(i),(i=t=n)===i.next)break;r=!0}}while(r||i!==t);return t}function o(e,t,r,i,n,h,d){if(e){!d&&h&&_(e,i,n,h);for(var f,p,m=e;e.prev!==e.next;)if(f=e.prev,p=e.next,h?l(e,i,n,h):a(e))t.push(f.i/r),t.push(e.i/r),t.push(p.i/r),P(e),e=p.next,m=p.next;else if((e=p)===m){d?1===d?o(e=c(s(e),t,r),t,r,i,n,h,2):2===d&&u(e,t,r,i,n,h):o(s(e),t,r,i,n,h,1);break}}}function a(e){var t=e.prev,r=e,i=e.next;if(w(t,r,i)>=0)return!1;for(var n=e.next.next;n!==e.prev;){if(x(t.x,t.y,r.x,r.y,i.x,i.y,n.x,n.y)&&w(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function l(e,t,r,i){var n=e.prev,s=e,o=e.next;if(w(n,s,o)>=0)return!1;for(var a=n.x<s.x?n.x<o.x?n.x:o.x:s.x<o.x?s.x:o.x,l=n.y<s.y?n.y<o.y?n.y:o.y:s.y<o.y?s.y:o.y,c=n.x>s.x?n.x>o.x?n.x:o.x:s.x>o.x?s.x:o.x,u=n.y>s.y?n.y>o.y?n.y:o.y:s.y>o.y?s.y:o.y,h=g(a,l,t,r,i),d=g(c,u,t,r,i),f=e.prevZ,p=e.nextZ;f&&f.z>=h&&p&&p.z<=d;){if(f!==e.prev&&f!==e.next&&x(n.x,n.y,s.x,s.y,o.x,o.y,f.x,f.y)&&w(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,p!==e.prev&&p!==e.next&&x(n.x,n.y,s.x,s.y,o.x,o.y,p.x,p.y)&&w(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;f&&f.z>=h;){if(f!==e.prev&&f!==e.next&&x(n.x,n.y,s.x,s.y,o.x,o.y,f.x,f.y)&&w(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;p&&p.z<=d;){if(p!==e.prev&&p!==e.next&&x(n.x,n.y,s.x,s.y,o.x,o.y,p.x,p.y)&&w(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function c(e,t,r){var i=e;do{var n=i.prev,o=i.next.next;!v(n,o)&&S(n,i,i.next,o)&&M(n,o)&&M(o,n)&&(t.push(n.i/r),t.push(i.i/r),t.push(o.i/r),P(i),P(i.next),i=e=o),i=i.next}while(i!==e);return s(i)}function u(e,t,r,i,n,a){var l=e;do{for(var c=l.next.next;c!==l.prev;){if(l.i!==c.i&&b(l,c)){var u=A(l,c);return l=s(l,l.next),u=s(u,u.next),o(l,t,r,i,n,a),void o(u,t,r,i,n,a)}c=c.next}l=l.next}while(l!==e)}function h(e,t,r,i){var o,a,l,c=[];for(o=0,a=t.length;o<a;o++)(l=n(e,t[o]*i,o<a-1?t[o+1]*i:e.length,i,!1))===l.next&&(l.steiner=!0),c.push(y(l));for(c.sort(d),o=0;o<c.length;o++)r=s(r=p(c[o],r),r.next);return r}function d(e,t){return e.x-t.x}function f(e){if(e.next.prev===e)return e;let t=e;for(;;){const r=t.next;if(r.prev===t||r===t||r===e)break;t=r}return t}function p(e,t){var r=function(e,t){var r,i=t,n=e.x,s=e.y,o=-1/0;do{if(s<=i.y&&s>=i.next.y&&i.next.y!==i.y){var a=i.x+(s-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=n&&a>o){if(o=a,a===n){if(s===i.y)return i;if(s===i.next.y)return i.next}r=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!r)return null;if(n===o)return r;var l,c=r,u=r.x,h=r.y,d=1/0;i=r;do{n>=i.x&&i.x>=u&&n!==i.x&&x(s<h?n:o,s,u,h,s<h?o:n,s,i.x,i.y)&&(l=Math.abs(s-i.y)/(n-i.x),M(i,e)&&(l<d||l===d&&(i.x>r.x||i.x===r.x&&m(r,i)))&&(r=i,d=l)),i=i.next}while(i!==c);return r}(e,t);if(!r)return t;var i=A(r,e),n=s(r,r.next);let o=f(i);return s(o,o.next),n=f(n),f(t===r?n:t)}function m(e,t){return w(e.prev,e,t.prev)<0&&w(t.next,e,e.next)<0}function _(e,t,r,i){var n=e;do{null===n.z&&(n.z=g(n.x,n.y,t,r,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,function(e){var t,r,i,n,s,o,a,l,c=1;do{for(r=e,e=null,s=null,o=0;r;){for(o++,i=r,a=0,t=0;t<c&&(a++,i=i.nextZ);t++);for(l=c;a>0||l>0&&i;)0!==a&&(0===l||!i||r.z<=i.z)?(n=r,r=r.nextZ,a--):(n=i,i=i.nextZ,l--),s?s.nextZ=n:e=n,n.prevZ=s,s=n;r=i}s.nextZ=null,c*=2}while(o>1)}(n)}function g(e,t,r,i,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function y(e){var t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function x(e,t,r,i,n,s,o,a){return(n-o)*(t-a)-(e-o)*(s-a)>=0&&(e-o)*(i-a)-(r-o)*(t-a)>=0&&(r-o)*(s-a)-(n-o)*(i-a)>=0}function b(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&S(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&(M(e,t)&&M(t,e)&&function(e,t){var r=e,i=!1,n=(e.x+t.x)/2,s=(e.y+t.y)/2;do{r.y>s!=r.next.y>s&&r.next.y!==r.y&&n<(r.next.x-r.x)*(s-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next}while(r!==e);return i}(e,t)&&(w(e.prev,e,t.prev)||w(e,t.prev,t))||v(e,t)&&w(e.prev,e,e.next)>0&&w(t.prev,t,t.next)>0)}function w(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function v(e,t){return e.x===t.x&&e.y===t.y}function S(e,t,r,i){var n=I(w(e,t,r)),s=I(w(e,t,i)),o=I(w(r,i,e)),a=I(w(r,i,t));return n!==s&&o!==a||!(0!==n||!T(e,r,t))||!(0!==s||!T(e,i,t))||!(0!==o||!T(r,e,i))||!(0!==a||!T(r,t,i))}function T(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function I(e){return e>0?1:e<0?-1:0}function M(e,t){return w(e.prev,e,e.next)<0?w(e,t,e.next)>=0&&w(e,e.prev,t)>=0:w(e,t,e.prev)<0||w(e,e.next,t)<0}function A(e,t){var r=new C(e.i,e.x,e.y),i=new C(t.i,t.x,t.y),n=e.next,s=t.prev;return e.next=t,t.prev=e,r.next=n,n.prev=r,i.next=r,r.prev=i,s.next=i,i.prev=s,i}function E(e,t,r,i){var n=new C(e,t,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function P(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function C(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function R(e,t,r,i){for(var n=0,s=t,o=r-i;s<r;s+=i)n+=(e[o]-e[s])*(e[s+1]+e[o+1]),o=s;return n}r.d(t,{e:function(){return i}}),i.deviation=function(e,t,r,i){var n=t&&t.length,s=n?t[0]*r:e.length,o=Math.abs(R(e,0,s,r));if(n)for(var a=0,l=t.length;a<l;a++){var c=t[a]*r,u=a<l-1?t[a+1]*r:e.length;o-=Math.abs(R(e,c,u,r))}var h=0;for(a=0;a<i.length;a+=3){var d=i[a]*r,f=i[a+1]*r,p=i[a+2]*r;h+=Math.abs((e[d]-e[p])*(e[f+1]-e[d+1])-(e[d]-e[f])*(e[p+1]-e[d+1]))}return 0===o&&0===h?0:Math.abs((h-o)/o)},i.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},i=0,n=0;n<e.length;n++){for(var s=0;s<e[n].length;s++)for(var o=0;o<t;o++)r.vertices.push(e[n][s][o]);n>0&&(i+=e[n-1].length,r.holes.push(i))}return r}},88923:function(e,t,r){function i(e,t,r,i,s){n(e,t,r||0,i||e.length-1,s||o)}function n(e,t,r,i,o){for(;i>r;){if(i-r>600){var a=i-r+1,l=t-r+1,c=Math.log(a),u=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*u*(a-u)/a)*(l-a/2<0?-1:1);n(e,t,Math.max(r,Math.floor(t-l*u/a+h)),Math.min(i,Math.floor(t+(a-l)*u/a+h)),o)}var d=e[t],f=r,p=i;for(s(e,r,t),o(e[i],d)>0&&s(e,r,i);f<p;){for(s(e,f,p),f++,p--;o(e[f],d)<0;)f++;for(;o(e[p],d)>0;)p--}0===o(e[r],d)?s(e,r,p):s(e,++p,i),p<=t&&(r=p+1),t<=p&&(i=p-1)}}function s(e,t,r){var i=e[t];e[t]=e[r],e[r]=i}function o(e,t){return e<t?-1:e>t?1:0}r.d(t,{q:function(){return i}})},78952:function(e,t,r){r.d(t,{r:function(){return n}});var i=r(88923);function n(e,t){if(!(this instanceof n))return new n(e,t);this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&("function"==typeof t?this.toBBox=t:this._initFormat(t)),this.clear()}function s(e,t,r){if(!r)return t.indexOf(e);for(var i=0;i<t.length;i++)if(r(e,t[i]))return i;return-1}function o(e,t){a(e,0,e.children.length,t,e)}function a(e,t,r,i,n){n||(n=g(null)),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(var s,o=t;o<r;o++)s=e.children[o],l(n,e.leaf?i(s):s);return n}function l(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function c(e,t){return e.minX-t.minX}function u(e,t){return e.minY-t.minY}function h(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function d(e){return e.maxX-e.minX+(e.maxY-e.minY)}function f(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function p(e,t){var r=Math.max(e.minX,t.minX),i=Math.max(e.minY,t.minY),n=Math.min(e.maxX,t.maxX),s=Math.min(e.maxY,t.maxY);return Math.max(0,n-r)*Math.max(0,s-i)}function m(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function _(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function g(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function y(e,t,r,n,s){for(var o,a=[t,r];a.length;)(r=a.pop())-(t=a.pop())<=n||(o=t+Math.ceil((r-t)/n/2)*n,(0,i.q)(e,o,t,r,s),a.push(t,o,o,r))}n.prototype={all:function(){return this._all(this.data,[])},search:function(e){var t=this.data,r=[],i=this.toBBox;if(!_(e,t))return r;for(var n,s,o,a,l=[];t;){for(n=0,s=t.children.length;n<s;n++)o=t.children[n],_(e,a=t.leaf?i(o):o)&&(t.leaf?r.push(o):m(e,a)?this._all(o,r):l.push(o));t=l.pop()}return r},collides:function(e){var t=this.data,r=this.toBBox;if(!_(e,t))return!1;for(var i,n,s,o,a=[];t;){for(i=0,n=t.children.length;i<n;i++)if(s=t.children[i],_(e,o=t.leaf?r(s):s)){if(t.leaf||m(e,o))return!0;a.push(s)}t=a.pop()}return!1},load:function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0,r=e.length;t<r;t++)this.insert(e[t]);return this}var i=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){var n=this.data;this.data=i,i=n}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this},insert:function(e){return null!=e&&this._insert(e,this.data.height-1),this},clear:function(){return this.data=g([]),this},remove:function(e,t){if(null==e)return this;for(var r,i,n,o,a=this.data,l=this.toBBox(e),c=[],u=[];a||c.length;){if(a||(a=c.pop(),i=c[c.length-1],r=u.pop(),o=!0),a.leaf&&-1!==(n=s(e,a.children,t)))return a.children.splice(n,1),c.push(a),this._condense(c),this;o||a.leaf||!m(a,l)?i?(r++,a=i.children[r],o=!1):a=null:(c.push(a),u.push(r),r=0,i=a,a=a.children[0])}return this},toBBox:function(e){return e},compareMinX:c,compareMinY:u,toJSON:function(){return this.data},fromJSON:function(e){return this.data=e,this},_all:function(e,t){for(var r=[];e;)e.leaf?t.push.apply(t,e.children):r.push.apply(r,e.children),e=r.pop();return t},_build:function(e,t,r,i){var n,s=r-t+1,a=this._maxEntries;if(s<=a)return o(n=g(e.slice(t,r+1)),this.toBBox),n;i||(i=Math.ceil(Math.log(s)/Math.log(a)),a=Math.ceil(s/Math.pow(a,i-1))),(n=g([])).leaf=!1,n.height=i;var l,c,u,h,d=Math.ceil(s/a),f=d*Math.ceil(Math.sqrt(a));for(y(e,t,r,f,this.compareMinX),l=t;l<=r;l+=f)for(y(e,l,u=Math.min(l+f-1,r),d,this.compareMinY),c=l;c<=u;c+=d)h=Math.min(c+d-1,u),n.children.push(this._build(e,c,h,i-1));return o(n,this.toBBox),n},_chooseSubtree:function(e,t,r,i){for(var n,s,o,a,l,c,u,d;i.push(t),!t.leaf&&i.length-1!==r;){for(u=d=1/0,n=0,s=t.children.length;n<s;n++)l=h(o=t.children[n]),(c=f(e,o)-l)<d?(d=c,u=l<u?l:u,a=o):c===d&&l<u&&(u=l,a=o);t=a||t.children[0]}return t},_insert:function(e,t,r){var i=this.toBBox,n=r?e:i(e),s=[],o=this._chooseSubtree(n,this.data,t,s);for(o.children.push(e),l(o,n);t>=0&&s[t].children.length>this._maxEntries;)this._split(s,t),t--;this._adjustParentBBoxes(n,s,t)},_split:function(e,t){var r=e[t],i=r.children.length,n=this._minEntries;this._chooseSplitAxis(r,n,i);var s=this._chooseSplitIndex(r,n,i),a=g(r.children.splice(s,r.children.length-s));a.height=r.height,a.leaf=r.leaf,o(r,this.toBBox),o(a,this.toBBox),t?e[t-1].children.push(a):this._splitRoot(r,a)},_splitRoot:function(e,t){this.data=g([e,t]),this.data.height=e.height+1,this.data.leaf=!1,o(this.data,this.toBBox)},_chooseSplitIndex:function(e,t,r){var i,n,s,o,l,c,u,d;for(c=u=1/0,i=t;i<=r-t;i++)o=p(n=a(e,0,i,this.toBBox),s=a(e,i,r,this.toBBox)),l=h(n)+h(s),o<c?(c=o,d=i,u=l<u?l:u):o===c&&l<u&&(u=l,d=i);return d},_chooseSplitAxis:function(e,t,r){var i=e.leaf?this.compareMinX:c,n=e.leaf?this.compareMinY:u;this._allDistMargin(e,t,r,i)<this._allDistMargin(e,t,r,n)&&e.children.sort(i)},_allDistMargin:function(e,t,r,i){e.children.sort(i);var n,s,o=this.toBBox,c=a(e,0,t,o),u=a(e,r-t,r,o),h=d(c)+d(u);for(n=t;n<r-t;n++)s=e.children[n],l(c,e.leaf?o(s):s),h+=d(c);for(n=r-t-1;n>=t;n--)s=e.children[n],l(u,e.leaf?o(s):s),h+=d(u);return h},_adjustParentBBoxes:function(e,t,r){for(var i=r;i>=0;i--)l(t[i],e)},_condense:function(e){for(var t,r=e.length-1;r>=0;r--)0===e[r].children.length?r>0?(t=e[r-1].children).splice(t.indexOf(e[r]),1):this.clear():o(e[r],this.toBBox)},_initFormat:function(e){var t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(e[0])),this.compareMinY=new Function("a","b",t.join(e[1])),this.toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}}},67750:function(e,t,r){r.d(t,{A:function(){return I}});const i=[["(",")"],[")","("],["<",">"],[">","<"],["[","]"],["]","["],["{","}"],["}","{"],["«","»"],["»","«"],["‹","›"],["›","‹"],["⁽","⁾"],["⁾","⁽"],["₍","₎"],["₎","₍"],["≤","≥"],["≥","≤"],["〈","〉"],["〉","〈"],["﹙","﹚"],["﹚","﹙"],["﹛","﹜"],["﹜","﹛"],["﹝","﹞"],["﹞","﹝"],["﹤","﹥"],["﹥","﹤"]],n=["آ","أ","إ","ا"],s=["ﻵ","ﻷ","ﻹ","ﻻ"],o=["ﻶ","ﻸ","ﻺ","ﻼ"],a=["ا","ب","ت","ث","ج","ح","خ","د","ذ","ر","ز","س","ش","ص","ض","ط","ظ","ع","غ","ف","ق","ك","ل","م","ن","ه","و","ي","إ","أ","آ","ة","ى","ل","م","ن","ه","و","ي","إ","أ","آ","ة","ى","ی","ئ","ؤ"],l=["ﺍ","ﺏ","ﺕ","ﺙ","ﺝ","ﺡ","ﺥ","ﺩ","ﺫ","ﺭ","ﺯ","ﺱ","ﺵ","ﺹ","ﺽ","ﻁ","ﻅ","ﻉ","ﻍ","ﻑ","ﻕ","ﻙ","ﻝ","ﻡ","ﻥ","ﻩ","ﻭ","ﻱ","ﺇ","ﺃ","ﺁ","ﺓ","ﻯ","ﯼ","ﺉ","ﺅ","ﹰ","ﹲ","ﹴ","ﹶ","ﹸ","ﹺ","ﹼ","ﹾ","ﺀ","ﺉ","ﺅ"],c=["ﺎ","ﺐ","ﺖ","ﺚ","ﺞ","ﺢ","ﺦ","ﺪ","ﺬ","ﺮ","ﺰ","ﺲ","ﺶ","ﺺ","ﺾ","ﻂ","ﻆ","ﻊ","ﻎ","ﻒ","ﻖ","ﻚ","ﻞ","ﻢ","ﻦ","ﻪ","ﻮ","ﻲ","ﺈ","ﺄ","ﺂ","ﺔ","ﻰ","ﯽ","ﺊ","ﺆ","ﹰ","ﹲ","ﹴ","ﹶ","ﹸ","ﹺ","ﹼ","ﹾ","ﺀ","ﺊ","ﺆ"],u=["ﺎ","ﺒ","ﺘ","ﺜ","ﺠ","ﺤ","ﺨ","ﺪ","ﺬ","ﺮ","ﺰ","ﺴ","ﺸ","ﺼ","ﻀ","ﻄ","ﻈ","ﻌ","ﻐ","ﻔ","ﻘ","ﻜ","ﻠ","ﻤ","ﻨ","ﻬ","ﻮ","ﻴ","ﺈ","ﺄ","ﺂ","ﺔ","ﻰ","ﯿ","ﺌ","ﺆ","ﹱ","ﹲ","ﹴ","ﹷ","ﹹ","ﹻ","ﹽ","ﹿ","ﺀ","ﺌ","ﺆ"],h=["ﺍ","ﺑ","ﺗ","ﺛ","ﺟ","ﺣ","ﺧ","ﺩ","ﺫ","ﺭ","ﺯ","ﺳ","ﺷ","ﺻ","ﺿ","ﻃ","ﻇ","ﻋ","ﻏ","ﻓ","ﻗ","ﻛ","ﻟ","ﻣ","ﻧ","ﻫ","ﻭ","ﻳ","ﺇ","ﺃ","ﺁ","ﺓ","ﻯ","ﯾ","ﺋ","ﺅ","ﹰ","ﹲ","ﹴ","ﹶ","ﹸ","ﹺ","ﹼ","ﹾ","ﺀ","ﺋ","ﺅ"],d=["ء","آ","أ","ؤ","إ","ا","ة","د","ذ","ر","ز","و","ى"],f=["ً","ً","ٌ","؟","ٍ","؟","َ","َ","ُ","ُ","ِ","ِ","ّ","ّ","ْ","ْ","ء","آ","آ","أ","أ","ؤ","ؤ","إ","إ","ئ","ئ","ئ","ئ","ا","ا","ب","ب","ب","ب","ة","ة","ت","ت","ت","ت","ث","ث","ث","ث","ج","ج","ج","ج","ح","ح","ح","ح","خ","خ","خ","خ","د","د","ذ","ذ","ر","ر","ز","ز","س","س","س","س","ش","ش","ش","ش","ص","ص","ص","ص","ض","ض","ض","ض","ط","ط","ط","ط","ظ","ظ","ظ","ظ","ع","ع","ع","ع","غ","غ","غ","غ","ف","ف","ف","ف","ق","ق","ق","ق","ك","ك","ك","ك","ل","ل","ل","ل","م","م","م","م","ن","ن","ن","ن","ه","ه","ه","ه","و","و","ى","ى","ي","ي","ي","ي","ﻵ","ﻶ","ﻷ","ﻸ","ﻹ","ﻺ","ﻻ","ﻼ","؟","؟","؟"],p=["ء","ف"],m=["غ","ي"],_=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],g=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],y=10,x=11,b=12,w=18,v=["UBAT_L","UBAT_R","UBAT_EN","UBAT_AN","UBAT_ON","UBAT_B","UBAT_S","UBAT_AL","UBAT_WS","UBAT_CS","UBAT_ES","UBAT_ET","UBAT_NSM","UBAT_LRE","UBAT_RLE","UBAT_PDF","UBAT_LRO","UBAT_RLO","UBAT_BN"],S=[100,0,0,0,0,101,102,103,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,104,4,4,4,0,4,0,4,0,4,4,4,0,0,4,4,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,4,4,0,0,4,4,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,0,105,7,7,106,107],T=[[w,w,w,w,w,w,w,w,w,6,5,6,8,5,w,w,w,w,w,w,w,w,w,w,w,w,w,w,5,5,5,6,8,4,4,x,x,x,4,4,4,4,4,y,9,y,9,9,2,2,2,2,2,2,2,2,2,2,9,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,w,w,w,w,w,w,5,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,9,4,x,x,x,x,4,4,4,4,0,4,4,w,4,4,x,x,2,2,4,0,4,4,4,2,0,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,4,4,4,4,4,4,4,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,1,b,1,b,b,1,b,b,1,b,4,4,4,4,4,4,4,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4,4,4,4,4,1,1,1,1,1,4,4,4,4,4,4,4,4,4,4,4],[3,3,3,3,4,4,4,4,7,x,x,7,9,7,4,4,b,b,b,b,b,b,b,b,b,b,b,7,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,3,3,3,3,3,3,3,3,3,3,x,3,3,7,7,7,b,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,b,b,b,b,b,b,b,3,4,b,b,b,b,b,b,7,7,b,b,4,b,b,b,b,7,7,2,2,2,2,2,2,2,2,2,2,7,7,7,7,7,7],[7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,7,7,b,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,b,b,b,b,b,b,b,b,b,b,b,7,4,4,4,4,4,4,4,4,4,4,4,4,4,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,b,b,b,b,b,b,b,b,b,1,1,4,4,4,4,1,4,4,4,4,4],[8,8,8,8,8,8,8,8,8,8,8,w,w,w,0,1,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,8,5,13,14,15,16,17,9,x,x,x,x,x,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,9,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,8,w,w,w,w,w,4,4,4,4,4,w,w,w,w,w,w,2,0,4,4,2,2,2,2,2,2,y,y,4,4,4,0,2,2,2,2,2,2,2,2,2,2,y,y,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,4,4,4,4,4,1,b,1,1,1,1,1,1,1,1,1,1,y,1,1,1,1,1,1,1,1,1,1,1,1,1,4,1,1,1,1,1,4,1,4,1,1,4,1,1,4,1,1,1,1,1,1,1,1,1,1,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],[b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,b,b,b,b,b,b,b,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,9,4,9,4,4,9,4,4,4,4,4,4,4,4,4,x,4,4,y,y,4,4,4,4,4,x,x,4,4,4,4,4,7,7,7,7,7,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,4,w],[4,4,4,x,x,x,4,4,4,4,4,y,9,y,9,9,2,2,2,2,2,2,2,2,2,2,9,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,0,0,0,0,0,0,4,4,0,0,0,0,0,0,4,4,0,0,0,0,0,0,4,4,0,0,0,4,4,4,x,x,4,4,4,x,x,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4]];class I{constructor(){this.inputFormat="ILYNN",this.outputFormat="VLNNN",this.sourceToTarget=[],this.targetToSource=[],this.levels=[]}bidiTransform(e,t,r){if(this.sourceToTarget=[],this.targetToSource=[],!e)return"";if(function(e,t,r){W=[],$=[];for(let i=0;i<r;i++)e[i]=i,t[i]=i,W[i]=i}(this.sourceToTarget,this.targetToSource,e.length),!this.checkParameters(t,r))return e;t=this.inputFormat,r=this.outputFormat;let i=e;const a=X,u=q(t.charAt(1)),d=q(r.charAt(1)),p=("I"===t.charAt(0)?"L":t.charAt(0))+u,m=("I"===r.charAt(0)?"L":r.charAt(0))+d,_=t.charAt(2)+r.charAt(2);a.defInFormat=p,a.defOutFormat=m,a.defSwap=_;const g=M(e,p,m,_,a);let y=!1;return"R"===r.charAt(1)?y=!0:"C"!==r.charAt(1)&&"D"!==r.charAt(1)||(y="rtl"===this.checkContextual(g)),this.sourceToTarget=W,this.targetToSource=function(e){const t=new Array(e.length);for(let r=0;r<e.length;r++)t[e[r]]=r;return t}(this.sourceToTarget),Y=this.targetToSource,i=t.charAt(3)===r.charAt(3)?g:"S"===r.charAt(3)?function(e,t){if(0===t.length)return"";void 0===e&&(e=!0);const r=(t=String(t)).split("");let i=0,n=1,a=r.length;e||(i=r.length-1,n=-1,a=1);const u=function(e,t,r,i){let n=0;const a=[];let u=0;for(let d=t;d*r<i;d+=r)if(L(e[d])||V(e[d])){if("ل"===e[d]&&N(e,d+r,r,i)){e[d]=H(e[d+r],0===n?s:o),d+=r,Z(e,d,r,i),a[u]=d,u++,n=0;continue}const t=e[d];1===n?e[d]=k(e,d+r,r,i)?G(e[d]):B(e[d],c):!0===k(e,d+r,r,i)?e[d]=B(e[d],h):e[d]=B(e[d],l),V(t)||(n=1),!0===U(t)&&(n=0)}else n=0;return a}(r,i,n,a);let d="";for(let t=0;t<r.length;t++)F(u,u.length,t)>-1?(j(Y,t,!e,-1),W.splice(t,1)):d+=r[t];return d}(y,g):function(e,t){if(0===e.length)return"";void 0===t&&(t=!0);let r="";const i=(e=String(e)).split("");for(let s=0;s<e.length;s++){let o=!1;if(i[s]>="ﹰ"&&i[s]<"\ufeff"){const a=e.charCodeAt(s);i[s]>="ﻵ"&&i[s]<="ﻼ"?(t?(s>0&&" "===i[s-1]?r=r.slice(0,-1)+"ل":(r+="ل",o=!0),r+=n[(a-65269)/2]):(r+=n[(a-65269)/2],r+="ل",s+1<e.length&&" "===i[s+1]?s++:o=!0),o&&(j(Y,s,!0,1),W.splice(s,0,W[s]))):r+=f[a-65136]}else r+=i[s]}return r}(g,y),this.sourceToTarget=W,this.targetToSource=Y,this.levels=$,i}_inputFormatSetter(e){if(!te.test(e))throw new Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.inputFormat=e}_outputFormatSetter(e){if(!te.test(e))throw new Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.outputFormat=e}checkParameters(e,t){return e?this._inputFormatSetter(e):e=this.inputFormat,t?this._outputFormatSetter(t):t=this.outputFormat,e!==t}checkContextual(e){let t=A(e);if("ltr"!==t&&"rtl"!==t){try{t=document.dir.toLowerCase()}catch(e){}"ltr"!==t&&"rtl"!==t&&(t="ltr")}return t}hasBidiChar(e){return re.test(e)}}function M(e,t,r,i,n){const s=function(e,t,r){if(void 0===t.inFormat&&(t.inFormat=r.defInFormat),void 0===t.outFormat&&(t.outFormat=r.defOutFormat),void 0===t.swap&&(t.swap=r.defSwap),t.inFormat===t.outFormat)return t;const i=t.inFormat.slice(0,1),n=t.outFormat.slice(0,1);let s,o=t.inFormat.slice(1,4),a=t.outFormat.slice(1,4);return"C"===o.charAt(0)&&(s=A(e),o="ltr"===s||"rtl"===s?s.toUpperCase():"L"===t.inFormat.charAt(2)?"LTR":"RTL",t.inFormat=i+o),"C"===a.charAt(0)&&(s=A(e),"rtl"===s?a="RTL":"ltr"===s?(s=function(e){const t=e.split("");return t.reverse(),A(t.join(""))}(e),a=s.toUpperCase()):a="L"===t.outFormat.charAt(2)?"LTR":"RTL",t.outFormat=n+a),t}(e,{inFormat:t,outFormat:r,swap:i},n);if(s.inFormat===s.outFormat)return e;t=s.inFormat,r=s.outFormat,i=s.swap;const o=t.slice(0,1),a=t.slice(1,4),l=r.slice(0,1),c=r.slice(1,4);if(n.inFormat=t,n.outFormat=r,n.swap=i,"L"===o&&"VLTR"===r){if("LTR"===a)return n.dir=K,E(e,n);if("RTL"===a)return n.dir=ee,E(e,n)}if("V"===o&&"V"===l)return n.dir="RTL"===a?ee:K,R(e,n);if("L"===o&&"VRTL"===r)return"LTR"===a?(n.dir=K,e=E(e,n)):(n.dir=ee,e=E(e,n)),R(e);if("VLTR"===t&&"LLTR"===r)return n.dir=K,E(e,n);if("V"===o&&"L"===l&&a!==c)return e=R(e),"RTL"===a?M(e,"LLTR","VLTR",i,n):M(e,"LRTL","VRTL",i,n);if("VRTL"===t&&"LRTL"===r)return M(e,"LRTL","VRTL",i,n);if("L"===o&&"L"===l){const t=n.swap;return n.swap=t.slice(0,1)+"N","RTL"===a?(n.dir=ee,e=E(e,n),n.swap="N"+t.slice(1,3),n.dir=K,e=E(e,n)):(n.dir=K,e=E(e,n),n.swap="N"+t.slice(1,3),e=M(e,"VLTR","LRTL",n.swap,n)),e}return e}function A(e){const t=/[A-Za-z\u05d0-\u065f\u066a-\u06ef\u06fa-\u07ff\ufb1d-\ufdff\ufe70-\ufefc]/.exec(e);return t?t[0]<="z"?"ltr":"rtl":""}function E(e,t){const r=e.split(""),i=[];return P(r,i,t),function(e,t,r){if(0!==r.hiLevel&&r.swap[0]!==r.swap[1])for(let r=0;r<e.length;r++)1===t[r]&&(e[r]=z(e[r]))}(r,i,t),O(2,r,i,t),O(1,r,i,t),$=i,r.join("")}function P(e,t,r){const i=e.length,n=r.dir?g:_;let s=0,o=-1;const a=[],l=[];r.hiLevel=r.dir,r.lastArabic=!1,r.hasUbatAl=!1,r.hasUbatB=!1,r.hasUbatS=!1;for(let t=0;t<i;t++)a[t]=C(e[t]);for(let c=0;c<i;c++){const i=s,u=D(e,a,l,c,r);l[c]=u,s=n[i][u];const h=240&s;s&=15;const d=n[s][Q];if(t[c]=d,h>0)if(16===h){for(let e=o;e<c;e++)t[e]=1;o=-1}else o=-1;if(n[s][J])-1===o&&(o=c);else if(o>-1){for(let e=o;e<c;e++)t[e]=d;o=-1}5===a[c]&&(t[c]=0),r.hiLevel|=d}r.hasUbatS&&function(e,t,r,i){for(let n=0;n<r;n++)if(6===e[n]){t[n]=i.dir;for(let r=n-1;r>=0&&8===e[r];r--)t[r]=i.dir}}(a,t,i,r)}function C(e){const t=e.charCodeAt(0),r=S[t>>8];return r<100?r:T[r-100][255&t]}function R(e,t){const r=e.split("");if(t){const e=[];P(r,e,t),$=e}return r.reverse(),W.reverse(),r.join("")}function F(e,t,r){for(let i=0;i<t;i++)if(e[i]===r)return i;return-1}function L(e){for(let t=0;t<p.length;t++)if(e>=p[t]&&e<=m[t])return!0;return!1}function k(e,t,r,i){for(;t*r<i&&V(e[t]);)t+=r;return!!(t*r<i&&L(e[t]))}function N(e,t,r,i){for(;t*r<i&&V(e[t]);)t+=r;let s=" ";if(!(t*r<i))return!1;s=e[t];for(let e=0;e<n.length;e++)if(n[e]===s)return!0;return!1}function O(e,t,r,i){if(i.hiLevel<e)return;if(1===e&&i.dir===ee&&!i.hasUbatB)return t.reverse(),void W.reverse();const n=t.length;let s,o,a,l,c,u=0;for(;u<n;){if(r[u]>=e){for(s=u+1;s<n&&r[s]>=e;)s++;for(o=u,a=s-1;o<a;o++,a--)l=t[o],t[o]=t[a],t[a]=l,c=W[o],W[o]=W[a],W[a]=c;u=s}u++}}function D(e,t,r,i,n){const s=t[i];return{UBAT_L:()=>(n.lastArabic=!1,0),UBAT_R:()=>(n.lastArabic=!1,1),UBAT_ON:()=>4,UBAT_AN:()=>3,UBAT_EN:()=>n.lastArabic?3:2,UBAT_AL:()=>(n.lastArabic=!0,n.hasUbatAl=!0,1),UBAT_WS:()=>4,UBAT_CS:()=>{let e,s;return i<1||i+1>=t.length||2!==(e=r[i-1])&&3!==e||2!==(s=t[i+1])&&3!==s?4:(n.lastArabic&&(s=3),s===e?s:4)},UBAT_ES:()=>2===(i>0?r[i-1]:5)&&i+1<t.length&&2===t[i+1]?2:4,UBAT_ET:()=>{if(i>0&&2===r[i-1])return 2;if(n.lastArabic)return 4;let e=i+1;const s=t.length;for(;e<s&&t[e]===x;)e++;return e<s&&2===t[e]?2:4},UBAT_NSM:()=>{if("VLTR"===n.inFormat){const r=t.length;let n=i+1;for(;n<r&&t[n]===b;)n++;if(n<r){const r=e[i].charCodeAt(0),s=r>=1425&&r<=2303||64286===r,o=t[n];if(s&&(1===o||7===o))return 1}}return i<1||5===t[i-1]?4:r[i-1]},UBAT_B:()=>(n.lastArabic=!0,n.hasUbatB=!0,n.dir),UBAT_S:()=>(n.hasUbatS=!0,4),UBAT_LRE:()=>(n.lastArabic=!1,4),UBAT_RLE:()=>(n.lastArabic=!1,4),UBAT_LRO:()=>(n.lastArabic=!1,4),UBAT_RLO:()=>(n.lastArabic=!1,4),UBAT_PDF:()=>(n.lastArabic=!1,4),UBAT_BN:()=>4}[v[s]]()}function z(e){let t,r=0,n=i.length-1;for(;r<=n;)if(t=Math.floor((r+n)/2),e<i[t][0])n=t-1;else{if(!(e>i[t][0]))return i[t][1];r=t+1}return e}function U(e){for(let t=0;t<d.length;t++)if(d[t]===e)return!0;return!1}function G(e){for(let t=0;t<a.length;t++)if(e===a[t])return u[t];return e}function B(e,t){for(let r=0;r<a.length;r++)if(e===a[r])return t[r];return e}function V(e){return e>="ً"&&e<="ٕ"}function q(e){return"L"===e?"LTR":"R"===e?"RTL":"C"===e?"CLR":"D"===e?"CRL":""}function Z(e,t,r,i){for(;t*r<i&&V(e[t]);)t+=r;return t*r<i&&(e[t]=" ",!0)}function H(e,t){for(let r=0;r<n.length;r++)if(e===n[r])return t[r];return e}function j(e,t,r,i){for(let n=0;n<e.length;n++)(e[n]>t||!r&&e[n]===t)&&(e[n]+=i)}let W=[],Y=[],$=[];const X={dir:0,defInFormat:"LLTR",defoutFormat:"VLTR",defSwap:"YN",inFormat:"LLTR",outFormat:"VLTR",swap:"YN",hiLevel:0,lastArabic:!1,hasUbatAl:!1,hasBlockSep:!1,hasSegSep:!1,defOutFormat:""},Q=5,J=6,K=0,ee=1,te=/^[(I|V)][(L|R|C|D)][(Y|N)][(S|N)][N]$/,re=/[\u0591-\u06ff\ufb1d-\ufefc]/},90152:function(e,t,r){r.d(t,{y:function(){return n}});const i=new(r(67750).A);function n(e){if(null==e)return["",!1];if(!i.hasBidiChar(e))return[e,!1];let t;return t="rtl"===i.checkContextual(e)?"IDNNN":"ICNNN",[i.bidiTransform(e,t,"VLYSN"),!0]}},42827:function(e,t,r){r.d(t,{A:function(){return i}});class i{constructor(e){this.size=0,this._start=0,this.maxSize=e,this._buffer=new Array(e)}get entries(){return this._buffer}enqueue(e){if(this.size===this.maxSize){const t=this._buffer[this._start];return this._buffer[this._start]=e,this._start=(this._start+1)%this.maxSize,t}return this._buffer[(this._start+this.size++)%this.maxSize]=e,null}dequeue(){if(0===this.size)return null;const e=this._buffer[this._start];return this._buffer[this._start]=null,this.size--,this._start=(this._start+1)%this.maxSize,e}peek(){return 0===this.size?null:this._buffer[this._start]}peekLast(){return 0===this.size?null:this._buffer[(this._start+(this.size-1))%this.maxSize]}find(e){if(0===this.size)return null;for(const t of this._buffer)if(null!=t&&e(t))return t;return null}clear(e){let t=this.dequeue();for(;null!=t;)e&&e(t),t=this.dequeue()}}},99680:function(e,t,r){r.d(t,{q:function(){return n}});var i=r(85408);class n{constructor(e,t){this._storage=new i.F,this.id="",this.name="",this.size=0,this._storage.maxSize=e,this._storage.register(this),t&&this._storage.registerRemoveFunc("",t)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(e,t,r=1){this._storage.put(this,e,t,r,1)}pop(e){return this._storage.pop(this,e)}get(e){return this._storage.get(this,e)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}resetHitRate(){}}},85408:function(e,t,r){r.d(t,{F:function(){return l},Ti:function(){return n}});var i=r(7187);const n=-3,s=n-1;var o,a;(a=o||(o={}))[a.ALL=0]="ALL",a[a.SOME=1]="SOME";class l{get size(){return this._size}constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new i.A,this._users=new i.A}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(e){this._users.push(e)}deregister(e){this._users.removeUnordered(e)}registerRemoveFunc(e,t){this._removeFuncs.push([e,t])}deregisterRemoveFunc(e){this._removeFuncs.filterInPlace((t=>t[0]!==e))}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,-1),this._checkSize()}getSize(e,t){const r=this._db.get(e.id+t);return r?.size??0}put(e,t,r,i,a){t=e.id+t;const l=this._db.get(t);if(l&&(this._size-=l.size,e.size-=l.size,this._db.delete(t),l.entry!==r&&this._notifyRemove(t,l.entry,l.size,o.ALL)),i>this._maxSize)return void this._notifyRemove(t,r,i,o.ALL);if(void 0===r)return void console.warn("Refusing to cache undefined entry ");if(!i||i<0)return console.warn(`Refusing to cache entry with size ${i} for key ${t}`),void this._notifyRemove(t,r,0,o.ALL);const u=1+Math.max(a,s)-n;this._db.set(t,new c(r,i,u)),this._size+=i,e.size+=i,this._checkSize()}updateSize(e,t,r,i){t=e.id+t;const n=this._db.get(t);if(n&&n.entry===r){for(this._size-=n.size,e.size-=n.size;i>this._maxSize;){const e=this._notifyRemove(t,r,i,o.SOME);if(!(null!=e&&e>0))return void this._db.delete(t);i=e}n.size=i,this._size+=i,e.size+=i,this._checkSize()}}pop(e,t){t=e.id+t;const r=this._db.get(t);if(r)return this._size-=r.size,e.size-=r.size,this._db.delete(t),++this._hit,r.entry;++this._miss}get(e,t){t=e.id+t;const r=this._db.get(t);if(void 0!==r)return this._db.delete(t),r.lives=r.lifetime,this._db.set(t,r),++this._hit,r.entry;++this._miss}peek(e,t){const r=this._db.get(e.id+t);return r?++this._hit:++this._miss,r?.entry}get performanceInfo(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},t={},r=new Array;this._db.forEach(((e,i)=>{const n=e.lifetime;r[n]=(r[n]||0)+e.size,this._users.forAll((r=>{const{id:n,name:s}=r;if(i.startsWith(n)){const r=t[s]||0;t[s]=r+e.size}}))}));const i={};this._users.forAll((e=>{const r=e.name;if("hitRate"in e&&"number"==typeof e.hitRate&&!isNaN(e.hitRate)&&e.hitRate>0){const n=t[r]||0;t[r]=n,i[r]=Math.round(100*e.hitRate)+"%"}else i[r]="0%"}));const s=Object.keys(t);s.sort(((e,r)=>t[r]-t[e])),s.forEach((r=>e[r]=Math.round(t[r]/2**20)+"MB / "+i[r]));for(let t=r.length-1;t>=0;--t){const i=r[t];i&&(e["Priority "+(t+n-1)]=Math.round(i/this._size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forAll((e=>e.resetHitRate()))}clear(e){const t=e.id;this._db.forEach(((e,r)=>{r.startsWith(t)&&(this._size-=e.size,this._db.delete(r),this._notifyRemove(r,e.entry,e.size,o.ALL))})),e.size=0}clearAll(){this._db.forEach(((e,t)=>this._notifyRemove(t,e.entry,e.size,o.ALL))),this._users.forAll((e=>e.size=0)),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,t,r,i){let n;return this._removeFuncs.some((s=>{if(e.startsWith(s[0])){const e=s[1](t,i,r);return"number"==typeof e&&(n=e),!0}return!1})),n}_checkSize(){this._users.forAll((e=>this._checkSizeLimits(e))),this._checkSizeLimits()}_checkSizeLimits(e){const t=e??this;if(t.maxSize<0||t.size<=t.maxSize)return;const r=e?.id;let i=!0;for(;i;){i=!1;for(const[n,s]of this._db)if(0===s.lifetime&&(!r||n.startsWith(r))){if(this._purgeItem(n,s,e),t.size<=.9*t.maxSize)return;i||=this._db.has(n)}}for(const[i,n]of this._db)if((!r||i.startsWith(r))&&(this._purgeItem(i,n,e),t.size<=.9*t.maxSize))return}_purgeItem(e,t,r=this._users.find((t=>e.startsWith(t.id)))){if(this._db.delete(e),t.lives<=1){this._size-=t.size,r&&(r.size-=t.size);const i=this._notifyRemove(e,t.entry,t.size,o.SOME);null!=i&&i>0&&(this._size+=i,r&&(r.size+=i),t.lives=t.lifetime,t.size=i,this._db.set(e,t))}else--t.lives,this._db.set(e,t)}}class c{constructor(e,t,r){this.entry=e,this.size=t,this.lifetime=r,this.lives=r}}},62790:function(e,t,r){r.d(t,{A:function(){return s}});var i=r(44567),n=r(87085);class s{constructor(e){this._observable=new n.I,this._map=new Map(e)}get size(){return(0,i.gc)(this._observable),this._map.size}clear(){this._map.size>0&&(this._map.clear(),this._observable.notify())}delete(e){const t=this._map.delete(e);return t&&this._observable.notify(),t}entries(){return(0,i.gc)(this._observable),this._map.entries()}forEach(e,t){(0,i.gc)(this._observable),this._map.forEach(((r,i)=>e.call(t,r,i,this)),t)}get(e){return(0,i.gc)(this._observable),this._map.get(e)}has(e){return(0,i.gc)(this._observable),this._map.has(e)}keys(){return(0,i.gc)(this._observable),this._map.keys()}set(e,t){return this._map.set(e,t),this._observable.notify(),this}values(){return(0,i.gc)(this._observable),this._map.values()}[Symbol.iterator](){return(0,i.gc)(this._observable),this._map[Symbol.iterator]()}get[Symbol.toStringTag](){return this._map[Symbol.toStringTag]}}},72952:function(e,t,r){r.d(t,{EB:function(){return f},Im:function(){return _},Mj:function(){return d},Ui:function(){return m},w2:function(){return p}});var i=r(83525),n=r(78879),s=r(63693);const o=new Set(["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"]);function a(e){return e instanceof i.A}function l(e){return e instanceof n.A?Object.keys(e.items):a(e)?(0,s.oY)(e).keys():e?Object.keys(e):[]}function c(e,t){return e instanceof n.A?e.items[t]:e[t]}function u(e){return e?e.declaredClass:null}function h(e,t){const r=e.diff;if(r&&"function"==typeof r)return r(e,t);const i=l(e),n=l(t);if(0===i.length&&0===n.length)return;if(!i.length||!n.length||function(e,t){return!(!Array.isArray(e)||!Array.isArray(t))&&e.length!==t.length}(e,t))return{type:"complete",oldValue:e,newValue:t};const s=n.filter((e=>!i.includes(e))),d=i.filter((e=>!n.includes(e))),f=i.filter((r=>n.includes(r)&&c(e,r)!==c(t,r))).concat(s,d).sort(),p=u(e);if(p&&o.has(p)&&f.length)return{type:"complete",oldValue:e,newValue:t};let m;const _=a(e)&&a(t);for(const i of f){const n=c(e,i),s=c(t,i);let o;if((_||"function"!=typeof n&&"function"!=typeof s)&&n!==s&&(null!=n||null!=s)){if(r&&r[i]&&"function"==typeof r[i])o=r[i]?.(n,s);else if(n instanceof Date&&s instanceof Date){if(n.getTime()===s.getTime())continue;o={type:"complete",oldValue:n,newValue:s}}else o="object"==typeof n&&"object"==typeof s&&u(n)===u(s)?h(n,s):{type:"complete",oldValue:n,newValue:s};null!=o&&(null!=m?m.diff[i]=o:m={type:"partial",diff:{[i]:o}})}}return m}function d(e,t){return f(e,t)}function f(e,t){if(null==e)return!1;const r=t.split(".");let i=e;for(const e of r){if("complete"===i.type)return!0;if("partial"!==i.type)return!1;{const t=i.diff[e];if(!t)return!1;i=t}}return!0}function p(e,t){if(!e)return!1;if("partial"===e.type){const r=Object.keys(e.diff);return 1===r.length&&r[0]===t}return!1}function m(e,t){if("function"!=typeof e&&"function"!=typeof t&&(null!=e||null!=t))return null==e||null==t||"object"==typeof e&&"object"==typeof t&&u(e)!==u(t)?{type:"complete",oldValue:e,newValue:t}:h(e,t)}function _(e){if(null==e)return!0;switch(e.type){case"complete":return!1;case"collection":{const t=e;for(const e of t.added)if(!_(e))return!1;for(const e of t.removed)if(!_(e))return!1;for(const e of t.changed)if(!_(e))return!1;return!0}case"partial":for(const t in e.diff)if(!_(e.diff[t]))return!1;return!0}}},37057:function(e,t,r){function i(e){return null!=a(e)||null!=o(e)}function n(e){return l.test(e)}function s(e){return a(e)??o(e)}function o(e){const t=new Date(e);return function(e,t){if(Number.isNaN(e.getTime()))return!1;let r=!0;if(u&&/\d+\W*$/.test(t)){const e=t.match(/[a-zA-Z]{2,}/);if(e){let t=!1,i=0;for(;!t&&i<=e.length;)t=!c.test(e[i]),i++;r=!t}}return r}(t,e)?Number.isNaN(t.getTime())?null:t.getTime()-6e4*t.getTimezoneOffset():null}function a(e){const t=l.exec(e);if(!t?.groups)return null;const r=t.groups,i=+r.year,n=+r.month-1,s=+r.day,o=+(r.hours??"0"),a=+(r.minutes??"0"),c=+(r.seconds??"0");if(o>23)return null;if(a>59)return null;if(c>59)return null;const u=r.ms??"0",h=u?+u.padEnd(3,"0").slice(0,3):0;let d;if(r.isUTC||!r.offsetSign)d=Date.UTC(i,n,s,o,a,c,h);else{const e=+r.offsetHours,t=+r.offsetMinutes;d=6e4*("+"===r.offsetSign?-1:1)*(60*e+t)+Date.UTC(i,n,s,o,a,c,h)}return Number.isNaN(d)?null:d}r.d(t,{Br:function(){return n},Cq:function(){return i},_U:function(){return s}});const l=/^(?:(?<year>-?\d{4,})-(?<month>\d{2})-(?<day>\d{2}))(?:T(?<hours>\d{2}):(?<minutes>\d{2}):(?<seconds>\d{2})(?:\.(?<ms>\d+))?)?(?:(?<isUTC>Z)|(?:(?<offsetSign>\+|-)(?<offsetHours>\d{2}):(?<offsetMinutes>\d{2})))?$/,c=/^((jan(uary)?)|(feb(ruary)?)|(mar(ch)?)|(apr(il)?)|(may)|(jun(e)?)|(jul(y)?)|(aug(ust)?)|(sep(tember)?)|(oct(ober)?)|(nov(ember)?)|(dec(ember)?)|(am)|(pm)|(gmt)|(utc))$/i,u=!Number.isNaN(new Date("technology 10").getTime())},80683:function(e,t,r){r.d(t,{Al:function(){return c},NZ:function(){return u},Vb:function(){return n},af:function(){return h},rK:function(){return d}});var i=r(25591);const n="arial-unicode-ms",s="woff2",o=new Map,a=new Set;class l{constructor(e,t){this.fontFace=e,this.promise=t}}async function c(e){const t=f(e),r=d(e),n=o.get(t);if(n)return n.promise;const c=new FontFace(e.family,`url('${i.default.fontsUrl}/woff2/${r}.${s}') format('${s}')`,{style:e.style,weight:e.weight}),u=document.fonts;if(u.has(c)&&"loading"===c.status)return c.loaded;const h=c.load().then((()=>(u.add(c),c)));return o.set(t,new l(c,h)),a.add(c),h}function u(e){return a.has(e)}function h(e){if(!e)return n;const t=e.toLowerCase().split(" ").join("-");switch(t){case"serif":return"noto-serif";case"sans-serif":return"arial-unicode-ms";case"monospace":return"ubuntu-mono";case"fantasy":return"cabin-sketch";case"cursive":return"redressed";default:return t}}function d(e){const t=p(e)+m(e);return h(e.family)+(t.length>0?t:"-regular")}function f(e){const t=p(e)+m(e);return(e.family||n)+(t.length>0?t:"-regular")}function p(e){if(!e.weight)return"";switch(e.weight.toLowerCase()){case"bold":case"bolder":return"-bold"}return""}function m(e){if(!e.style)return"";switch(e.style.toLowerCase()){case"italic":case"oblique":return"-italic"}return""}},10793:function(e,t,r){function i(){const e=new Float32Array(6);return e[0]=1,e[3]=1,e}function n(e,t,r,i){const n=t[i],s=t[i+1];e[i]=r[0]*n+r[2]*s+r[4],e[i+1]=r[1]*n+r[3]*s+r[5]}function s(e,t,r,i=0,s=0,o=2){const a=s||t.length/o;for(let s=i;s<a;s++)n(e,t,r,s*o)}r.d(t,{gb:function(){return s},vt:function(){return i}}),Object.freeze(Object.defineProperty({__proto__:null,clone:function(e){const t=new Float32Array(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},create:i,createView:function(e,t){return new Float32Array(e,t,6)},fromValues:function(e,t,r,i,n,s){const o=new Float32Array(6);return o[0]=e,o[1]=t,o[2]=r,o[3]=i,o[4]=n,o[5]=s,o},transform:n,transformMany:s},Symbol.toStringTag,{value:"Module"}))},14583:function(e,t,r){function i(){return new Float32Array(2)}function n(e,t){const r=new Float32Array(2);return r[0]=e,r[1]=t,r}function s(){return i()}function o(){return n(1,1)}function a(){return n(1,0)}function l(){return n(0,1)}r.d(t,{Un:function(){return u},fA:function(){return n},uY:function(){return c},vt:function(){return i}});const c=s(),u=o(),h=a(),d=l();Object.freeze(Object.defineProperty({__proto__:null,ONES:u,UNIT_X:h,UNIT_Y:d,ZEROS:c,clone:function(e){const t=new Float32Array(2);return t[0]=e[0],t[1]=e[1],t},create:i,createView:function(e,t){return new Float32Array(e,t,2)},fromValues:n,ones:o,unitX:a,unitY:l,zeros:s},Symbol.toStringTag,{value:"Module"}))},67348:function(e,t,r){r.d(t,{$0:function(){return h},B8:function(){return o},CV:function(){return d},D_:function(){return n},Tl:function(){return u},e$:function(){return l},hZ:function(){return s},hs:function(){return c},kN:function(){return f},lw:function(){return a}});var i=r(8527);function n(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function s(e,t,r,i,n,s,o){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=s,e[5]=o,e}function o(e,t){const r=t[0],i=t[1],n=t[2],s=t[3],o=t[4],a=t[5];let l=r*s-i*n;return l?(l=1/l,e[0]=s*l,e[1]=-i*l,e[2]=-n*l,e[3]=r*l,e[4]=(n*a-s*o)*l,e[5]=(i*o-r*a)*l,e):null}function a(e,t,r){const i=t[0],n=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=r[0],u=r[1],h=r[2],d=r[3],f=r[4],p=r[5];return e[0]=i*c+s*u,e[1]=n*c+o*u,e[2]=i*h+s*d,e[3]=n*h+o*d,e[4]=i*f+s*p+a,e[5]=n*f+o*p+l,e}function l(e,t,r){const i=t[0],n=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=Math.sin(r),u=Math.cos(r);return e[0]=i*u+s*c,e[1]=n*u+o*c,e[2]=i*-c+s*u,e[3]=n*-c+o*u,e[4]=a,e[5]=l,e}function c(e,t,r){const i=t[0],n=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=r[0],u=r[1];return e[0]=i*c,e[1]=n*c,e[2]=s*u,e[3]=o*u,e[4]=a,e[5]=l,e}function u(e,t,r){const i=t[0],n=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=r[0],u=r[1];return e[0]=i,e[1]=n,e[2]=s,e[3]=o,e[4]=i*c+s*u+a,e[5]=n*c+o*u+l,e}function h(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=-r,e[3]=i,e[4]=0,e[5]=0,e}function d(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e}function f(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e}function p(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e}const m=a,_=p;Object.freeze(Object.defineProperty({__proto__:null,add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},determinant:function(e){return e[0]*e[3]-e[1]*e[2]},equals:function(e,t){const r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=t[0],u=t[1],h=t[2],d=t[3],f=t[4],p=t[5],m=(0,i.FD)();return Math.abs(r-c)<=m*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(n-u)<=m*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(s-h)<=m*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(o-d)<=m*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(a-f)<=m*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(l-p)<=m*Math.max(1,Math.abs(l),Math.abs(p))},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},frob:function(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+1)},fromRotation:h,fromScaling:d,fromTranslation:f,identity:n,invert:o,mul:m,multiply:a,multiplyScalar:function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e},multiplyScalarAndAdd:function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e},rotate:l,scale:c,set:s,str:function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},sub:_,subtract:p,translate:u},Symbol.toStringTag,{value:"Module"}))},75218:function(e,t,r){r.d(t,{L:function(){return a},g:function(){return o}});var i=r(77472),n=r(78879),s=r(31609);async function o(e,t){return await e.load(),a(e,t)}async function a(e,t){const r=[],o=(...e)=>{for(const t of e)null!=t&&(Array.isArray(t)?o(...t):n.A.isCollection(t)?t.forEach((e=>o(e))):s.A.isLoadable(t)&&r.push(t))};t(o);let a=null;if(await(0,i.Tj)(r,(async e=>{const t=await(0,i.Ke)(function(e){return"loadAll"in e&&"function"==typeof e.loadAll}(e)?e.loadAll():e.load());!1!==t.ok||a||(a=t)})),a)throw a.error;return e}},68225:function(e,t,r){r.d(t,{A:function(){return u}});var i,n,s=r(58941),o=r(56996);(n=i||(i={}))[n.varint=0]="varint",n[n.fixed64=1]="fixed64",n[n.delimited=2]="delimited",n[n.fixed32=5]="fixed32",n[n.unknown=99]="unknown";const a=4294967296,l=new TextDecoder("utf-8"),c=(0,s.A)("safari")||(0,s.A)("ios")?6:(0,s.A)("ff")?12:32;class u{constructor(e,t,r=0,n=(e?e.byteLength:0)){this._tag=0,this._dataType=i.unknown,this._init(e,t,r,n)}_init(e,t,r,i){this._data=e,this._dataView=t,this._pos=r,this._end=i}asUnsafe(){return this}clone(){return new u(this._data,this._dataView,this._pos,this._end)}pos(){return this._pos}move(e){this._pos=e}nextTag(e){for(;;){if(this._pos===this._end)return!1;const t=this._decodeVarint();if(this._tag=t>>3,this._dataType=7&t,!e||e===this._tag)break;this.skip()}return!0}next(){if(this._pos===this._end)return!1;const e=this._decodeVarint();return this._tag=e>>3,this._dataType=7&e,!0}empty(){return this._pos>=this._end}tag(){return this._tag}getInt32(){return this._decodeVarint()}getInt64(){return this._decodeVarint()}getUInt32(){let e=4294967295;if(e=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128)return e;if(e=(e|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128)return e;if(e=(e|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128)return e;if(e=(e|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128)return e;if(e=(e|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128)return e;throw new Error("Varint overflow")}getUInt64(){return this._decodeVarint()}getSInt32(){const e=this.getUInt32();return e>>>1^-(1&e)}getSInt64(){return this._decodeSVarint()}getBool(){const e=0!==this._data[this._pos];return this._skip(1),e}getEnum(){return this._decodeVarint()}getFixed64(){const e=this._dataView,t=this._pos,r=e.getUint32(t,!0)+e.getUint32(t+4,!0)*a;return this._skip(8),r}getSFixed64(){const e=this._dataView,t=this._pos,r=e.getUint32(t,!0)+e.getInt32(t+4,!0)*a;return this._skip(8),r}getDouble(){const e=this._dataView.getFloat64(this._pos,!0);return this._skip(8),e}getFixed32(){const e=this._dataView.getUint32(this._pos,!0);return this._skip(4),e}getSFixed32(){const e=this._dataView.getInt32(this._pos,!0);return this._skip(4),e}getFloat(){const e=this._dataView.getFloat32(this._pos,!0);return this._skip(4),e}getString(){const e=this._getLength(),t=this._pos,r=this._toString(this._data,t,t+e);return this._skip(e),r}getBytes(){const e=this._getLength(),t=this._pos,r=this._toBytes(this._data,t,t+e);return this._skip(e),r}getLength(){return this._getLengthUnsafe()}processMessageWithArgs(e,t,r,i){const n=this.getMessage(),s=e(n,t,r,i);return n.release(),s}processMessage(e){const t=this.getMessage(),r=e(t);return t.release(),r}getMessage(){const e=this._getLength(),t=u.pool.acquire();return t._init(this._data,this._dataView,this._pos,this._pos+e),this._skip(e),t}release(){u.pool.release(this)}dataType(){return this._dataType}skip(){switch(this._dataType){case i.varint:this._decodeVarint();break;case i.fixed64:this._skip(8);break;case i.delimited:this._skip(this._getLength());break;case i.fixed32:this._skip(4);break;default:throw new Error("Invalid data type!")}}skipLen(e){this._skip(e)}_skip(e){if(this._pos+e>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=e}_decodeVarint(){const e=this._data;let t=this._pos,r=0,i=0;if(this._end-t>=10)do{if(i=e[t++],r|=127&i,!(128&i))break;if(i=e[t++],r|=(127&i)<<7,!(128&i))break;if(i=e[t++],r|=(127&i)<<14,!(128&i))break;if(i=e[t++],r|=(127&i)<<21,!(128&i))break;if(i=e[t++],r+=268435456*(127&i),!(128&i))break;if(i=e[t++],r+=34359738368*(127&i),!(128&i))break;if(i=e[t++],r+=4398046511104*(127&i),!(128&i))break;if(i=e[t++],r+=562949953421312*(127&i),!(128&i))break;if(i=e[t++],r+=72057594037927940*(127&i),!(128&i))break;if(i=e[t++],r+=0x8000000000000000*(127&i),!(128&i))break;throw new Error("Varint too long!")}while(0);else{let n=1;for(;t!==this._end&&(i=e[t],128&i);)++t,r+=(127&i)*n,n*=128;if(t===this._end)throw new Error("Varint overrun!");++t,r+=i*n}return this._pos=t,r}_decodeSVarint(){const e=this._data;let t,r=0,i=0;const n=1&e[this._pos];if(i=e[this._pos++],r|=127&i,!(128&i))return n?-(r+1)/2:r/2;if(i=e[this._pos++],r|=(127&i)<<7,!(128&i))return n?-(r+1)/2:r/2;if(i=e[this._pos++],r|=(127&i)<<14,!(128&i))return n?-(r+1)/2:r/2;if(i=e[this._pos++],r|=(127&i)<<21,!(128&i))return n?-(r+1)/2:r/2;if(i=e[this._pos++],r+=268435456*(127&i),!(128&i))return n?-(r+1)/2:r/2;if(i=e[this._pos++],r+=34359738368*(127&i),!(128&i))return n?-(r+1)/2:r/2;if(i=e[this._pos++],r+=4398046511104*(127&i),!(128&i))return n?-(r+1)/2:r/2;if(t=BigInt(r),i=e[this._pos++],t+=0x2000000000000n*BigInt(127&i),!(128&i))return Number(n?-(t+1n)/2n:t/2n);if(i=e[this._pos++],t+=0x100000000000000n*BigInt(127&i),!(128&i))return Number(n?-(t+1n)/2n:t/2n);if(i=e[this._pos++],t+=0x8000000000000000n*BigInt(127&i),!(128&i))return Number(n?-(t+1n)/2n:t/2n);throw new Error("Varint too long!")}_getLength(){if(this._dataType!==i.delimited)throw new Error("Not a delimited data type!");return this._decodeVarint()}_getLengthUnsafe(){return this.getUInt32()}_toString(e,t,r){if((r=Math.min(this._end,r))-t>c){const i=e.subarray(t,r);return l.decode(i)}let i="",n="";for(let s=t;s<r;++s){const t=e[s];128&t?n+="%"+t.toString(16):(i+=decodeURIComponent(n)+String.fromCharCode(t),n="")}return n.length&&(i+=decodeURIComponent(n)),i}_toBytes(e,t,r){return r=Math.min(this._end,r),new Uint8Array(e.buffer,t,r-t)}}u.pool=new o.A(u,void 0,(e=>{e._data=null,e._dataView=null}))},83324:function(e,t,r){r.d(t,{M:function(){return c},s:function(){return l}});var i=r(42042),n=r(93393),s=r(359),o=r(70891),a=r(96285);function l(e,t){const r=u[e.toLowerCase()];if(null==r)throw new n.L8(n.Z7.FunctionNotRecognized);if(t.length<r.minParams||t.length>r.maxParams)throw new n.L8(n.Z7.InvalidParameterCount,{name:e.toUpperCase()});return r.evaluate(t)}function c(e,t){const r=u[e.toLowerCase()];return null!=r&&t>=r.minParams&&t<=r.maxParams}const u={min:{minParams:1,maxParams:1,evaluate:e=>f(e[0],"min")},max:{minParams:1,maxParams:1,evaluate:e=>f(e[0],"max")},avg:{minParams:1,maxParams:1,evaluate:e=>h(e[0])},sum:{minParams:1,maxParams:1,evaluate:e=>function(e){if(null===e)return null;let t=0;for(let r=0;r<e.length;r++){const i=e[r];if(null!==i){if(!d(i))throw new n.L8(n.Z7.InvalidValueForAggregateFunction);t+=i}}return t}(e[0])},stddev:{minParams:1,maxParams:1,evaluate:e=>function(e){if(null===e)return null;const t=p(e);return null===t?null:Math.sqrt(t)}(e[0])},count:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:e[0].length},var:{minParams:1,maxParams:1,evaluate:e=>p(e[0])}};function h(e){if(null===e)return null;let t=0,r=0;for(let i=0;i<e.length;i++){const s=e[i];if(null!==s){if(!d(s))throw new n.L8(n.Z7.InvalidValueForAggregateFunction);r++,t+=s}}return 0===r?null:t/e.length}function d(e){return"number"==typeof e}function f(e,t){if(null===e)return null;let r=null,n=null;for(const l of e){let e=l;e=l instanceof i.n||l instanceof o.k?l.toNumber():l instanceof a.c9?l.toMillis():l instanceof s.g?l.toMilliseconds():l,(null===r||"max"===t&&null!==n&&null!==e&&n<=e||"min"===t&&null!==n&&null!==e&&n>=e)&&(r=l,n=e)}return r}function p(e){if(null===e)return null;if(0===(e=e.filter((e=>null!==e))).length)return null;const t=h(e);if(null===t)return null;let r=0;for(const i of e){if(!d(i))throw new n.L8(n.Z7.InvalidValueForAggregateFunction);r+=(t-i)**2}return r/(e.length-1)}},42042:function(e,t,r){r.d(t,{n:function(){return a}});var i=r(9688),n=r(22739),s=r(96285);function o(e){e=e.replaceAll(/LTS|LT|L{1,4}|l{1,4}/g,"[$&]");let t="";const r=/(\[[^[]*\])|(\\)?([Hh]mm(ss)?|Mo|M{1,4}|Do|DDDo|D{1,4}|d{2,4}|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;for(const i of e.match(r)||[])switch(i){case"D":t+="d";break;case"DD":t+="dd";break;case"DDD":t+="o";break;case"d":t+="c";break;case"ddd":t+="ccc";break;case"dddd":t+="cccc";break;case"M":t+="L";break;case"MM":t+="LL";break;case"MMM":t+="LLL";break;case"MMMM":t+="LLLL";break;case"YY":t+="yy";break;case"Y":case"YYYY":t+="yyyy";break;case"Q":t+="q";break;case"X":case"x":t+=i;break;default:i.length>=2&&"["===i.slice(0,1)&&"]"===i.slice(-1)?t+=`'${i.slice(1,-1)}'`:t+=`'${i}'`}return t}class a{constructor(e,t,r){this._year=e,this._month=t,this._day=r,this.declaredRootClass="esri.core.sql.dateonly"}get month(){return this._month}get monthJS(){return this._month-1}get year(){return this._year}get day(){return this._day}get isValid(){return this.toDateTime("unknown").isValid}equals(e){return e instanceof a&&e.day===this.day&&e.month===this.month&&e.year===this.year}clone(){return new a(this._year,this._month,this._day)}toDateTime(e){return s.c9.fromObject({day:this.day,month:this.month,year:this.year},{zone:(0,i.mT)(e)})}toDateTimeLuxon(e){return s.c9.fromObject({day:this.day,month:this.month,year:this.year},{zone:(0,i.mT)(e)})}toString(){return`${this.year.toString().padStart(4,"0")}-${this.month.toString().padStart(2,"0")}-${this.day.toString().padStart(2,"0")}`}toFormat(e=null,t=!0){if(null===e||""===e)return this.toString();if(t&&(e=o(e)),!e)return"";const r=this.toDateTime("unknown");return i.lY.dateTimeToArcadeDate(r).toFormat(e,{locale:(0,n.JK)(),numberingSystem:"latn"})}toArcadeDate(){const e=this.toDateTime("unknown");return i.lY.dateTimeToArcadeDate(e)}toNumber(){return this.toDateTime("unknown").toMillis()}toJSDate(){return this.toDateTime("unknown").toJSDate()}toStorageFormat(){return this.toFormat("yyyy-LL-dd",!1)}toSQLValue(){return this.toFormat("yyyy-LL-dd",!1)}toSQLWithKeyword(){return"date '"+this.toFormat("yyyy-LL-dd",!1)+"'"}plus(e,t){return a.fromDateTime(this.toUTCDateTime().plus({[e]:t}))}toUTCDateTime(){return s.c9.utc(this.year,this.month,this.day,0,0,0,0)}difference(e,t){switch(t.toLowerCase()){case"days":case"day":case"d":return this.toUTCDateTime().diff(e.toUTCDateTime(),"days").days;case"months":case"month":return this.toUTCDateTime().diff(e.toUTCDateTime(),"months").months;case"minutes":case"minute":case"m":return"M"===t?this.toUTCDateTime().diff(e.toUTCDateTime(),"months").months:this.toUTCDateTime().diff(e.toUTCDateTime(),"minutes").minutes;case"seconds":case"second":case"s":return this.toUTCDateTime().diff(e.toUTCDateTime(),"seconds").seconds;case"milliseconds":case"millisecond":case"ms":default:return this.toUTCDateTime().diff(e.toUTCDateTime(),"milliseconds").milliseconds;case"hours":case"hour":case"h":return this.toUTCDateTime().diff(e.toUTCDateTime(),"hours").hours;case"years":case"year":case"y":return this.toUTCDateTime().diff(e.toUTCDateTime(),"years").years}}static fromMilliseconds(e){const t=s.c9.fromMillis(e,{zone:s.mQ.utcInstance});return t.isValid?a.fromParts(t.year,t.month,t.day):null}static fromSeconds(e){const t=s.c9.fromSeconds(e,{zone:s.mQ.utcInstance});return t.isValid?a.fromParts(t.year,t.month,t.day):null}static fromReader(e){if(!e)return null;const t=e.split("-");return 3!==t.length?null:new a(parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2],10))}static fromParts(e,t,r){const i=new a(e,t,r);return!1===i.isValid?null:i}static fromDateJS(e){return a.fromParts(e.getFullYear(),e.getMonth()+1,e.getDay())}static fromDateTime(e){return a.fromParts(e.year,e.month,e.day)}static fromSqlTimeStampOffset(e){return this.fromDateTime(e.toDateTime())}static fromString(e,t=null){if(""===e)return null;if(null===e)return null;const r=[];if(t)(t=o(t))&&r.push(t);else if(null===t||""===t){const t=s.c9.fromISO(e,{setZone:!0});return t.isValid?a.fromParts(t.year,t.month,t.day):null}for(const i of r){const r=s.c9.fromFormat(e,t??i);if(r.isValid)return new a(r.year,r.month,r.day)}return null}static fromNow(e="system"){const t=s.c9.fromJSDate(new Date).setZone((0,i.mT)(e));return new a(t.year,t.month,t.day)}}},359:function(e,t,r){r.d(t,{g:function(){return s}});var i=r(96285);function n(e){return Number.isNaN(e)||0===e?e:Math.trunc(e)}class s{constructor(e){this._timeStampOffset=e,this._date=null}toDateTime(){return this._date??=i.c9.fromISO(this._timeStampOffset,{setZone:!0}),this._date}get isValid(){return this.toDateTime().isValid}get timezoneOffsetHour(){return n(this.toDateTime().offset/60)}get timezoneOffsetMinutes(){return n(this.toDateTime().offset%60)}toMilliseconds(){return this.toDateTime().toMillis()}get hour(){return this.toDateTime().hour}get minute(){return this.toDateTime().minute}get second(){return this.toDateTime().second}get day(){return this.toDateTime().day}get month(){return this.toDateTime().month}get year(){return this.toDateTime().year}startOfDay(){return s.fromDateTime(this.toDateTime().startOf("day"))}static fromJSDate(e){return new s(i.c9.fromJSDate(e).toISO({includeOffset:!0}))}static fromDateTime(e){return new s(e.toISO({includeOffset:!0}))}static fromParts(e,t,r=0,i=0,n=0,o=0,a=0,l=!1,c=0,u=0){const h=`${e.toString().padStart(4,"0")}-${t.toString().padStart(2,"0")}-${r.toString().padStart(2,"0")}`;let d="";o<10&&(d="0");let f=`${i.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}:${d+o.toString()}`;0!==a&&(f+="."+a.toString().padStart(3,"0"));const p=`${l?"-":"+"}${c.toString().padStart(2,"0")}:${u.toString().padStart(2,"0")}`;return new s(h+"T"+f+p)}toStorageFormat(){return this._timeStampOffset}toString(){return this._timeStampOffset}toSQLValue(){let e=this.toDateTime().toSQL({includeOffset:!0,includeOffsetSpace:!0});return e&&(e=e.replace(".000","")),e}toSQLWithKeyword(){return`timestamp '${this.toSQLValue()}'`}addMilliseconds(e){const t=this.toDateTime().plus(e);return s.fromDateTime(t)}}},70891:function(e,t,r){r.d(t,{k:function(){return a}});var i=r(80749),n=r(22739),s=r(96285);function o(e){if(!e)return"";const t=/(a|A|hh?|HH?|mm?|ss?|SSS|S|.)/g;let r="";for(const i of e.match(t)||[])switch(i){case"SSS":case"m":case"mm":case"h":case"hh":case"H":case"HH":case"s":case"ss":r+=i;break;case"A":case"a":r+="a";break;default:r+=`'${i}'`}return r}class a{constructor(e,t,r,i){this._hour=e,this._minute=t,this._second=r,this._millisecond=i,this.declaredRootClass="esri.core.sql.timeonly"}get hour(){return this._hour}get minute(){return this._minute}get second(){return this._second}get millisecond(){return this._millisecond}equals(e){return e instanceof a&&e.hour===this.hour&&e.minute===this.minute&&e.second===this.second&&e.millisecond===this.millisecond}clone(){return new a(this.hour,this.minute,this.second,this.millisecond)}isValid(){return(0,i.Fq)(this.hour)&&(0,i.Fq)(this.minute)&&(0,i.Fq)(this.second)&&(0,i.Fq)(this.millisecond)&&this.hour>=0&&this.hour<24&&this.minute>=0&&this.minute<60&&this.second>=0&&this.second<60&&this.millisecond>=0&&this.millisecond<1e3}toString(){return`${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}`+(this.millisecond>0?"."+this.millisecond.toString().padStart(3,"0"):"")}toSQLValue(){return this.toString()}toSQLWithKeyword(){return`time '${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}${this.millisecond>0?"."+this.millisecond.toString().padStart(3,"0"):""}'`}toStorageString(){return`${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}`}toFormat(e=null){return null===e||""===e?this.toString():(e=o(e))?s.c9.local(1970,1,1,this._hour,this._minute,this._second,this._millisecond).toFormat(e,{locale:(0,n.JK)(),numberingSystem:"latn"}):""}toNumber(){return this.millisecond+1e3*this.second+1e3*this.minute*60+60*this.hour*60*1e3}static fromParts(e,t,r,i){const n=new a(e,t,r,i);return n.isValid()?n:null}static fromReader(e){if(!e)return null;const t=e.split(":");return 3!==t.length?null:new a(parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2],10),0)}static fromMilliseconds(e){if(e>864e5||e<0)return null;const t=Math.floor(e/1e3%60),r=Math.floor(e/6e4%60),i=Math.floor(e/36e5%24),n=Math.floor(e%1e3);return new a(i,r,t,n)}static fromDateJS(e){return new a(e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds())}static fromDateTime(e){return new a(e.hour,e.minute,e.second,e.millisecond)}static fromSqlTimeStampOffset(e){return this.fromDateTime(e.toDateTime())}static fromString(e,t=null){if(""===e)return null;if(null===e)return null;const r=[];t?(t=o(t))&&r.push(t):null!==t&&""!==t||(r.push("HH:mm:ss"),r.push("HH:mm:ss.SSS"),r.push("hh:mm:ss a"),r.push("hh:mm:ss.SSS a"),r.push("HH:mm"),r.push("hh:mm a"),r.push("H:mm"),r.push("h:mm a"),r.push("H:mm:ss"),r.push("h:mm:ss a"),r.push("H:mm:ss.SSS"),r.push("h:mm:ss.SSS a"));for(const t of r){const r=s.c9.fromFormat(e,t);if(r.isValid)return new a(r.hour,r.minute,r.second,r.millisecond)}return null}plus(e,t){switch(e){case"days":case"years":case"months":return this.clone();case"hours":case"minutes":case"seconds":case"milliseconds":return a.fromDateTime(this.toUTCDateTime().plus({[e]:t}))}return null}toUTCDateTime(){return s.c9.utc(1970,1,1,this.hour,this.minute,this.second,this.millisecond)}difference(e,t){switch(t.toLowerCase()){case"days":case"day":case"d":return this.toUTCDateTime().diff(e.toUTCDateTime(),"days").days;case"months":case"month":return this.toUTCDateTime().diff(e.toUTCDateTime(),"months").months;case"minutes":case"minute":case"m":return"M"===t?this.toUTCDateTime().diff(e.toUTCDateTime(),"months").months:this.toUTCDateTime().diff(e.toUTCDateTime(),"minutes").minutes;case"seconds":case"second":case"s":return this.toUTCDateTime().diff(e.toUTCDateTime(),"seconds").seconds;case"milliseconds":case"millisecond":case"ms":default:return this.toUTCDateTime().diff(e.toUTCDateTime(),"milliseconds").milliseconds;case"hours":case"hour":case"h":return this.toUTCDateTime().diff(e.toUTCDateTime(),"hours").hours;case"years":case"year":case"y":return this.toUTCDateTime().diff(e.toUTCDateTime(),"years").years}}}},92955:function(e,t,r){r.d(t,{GB:function(){return n},Qo:function(){return o},Y4:function(){return s}});var i=r(96285);class n{}function s(e){return e instanceof i.bo?e===n.instance:"unknown"===e?.toString().toLowerCase()}function o(e){return s(e)?n.instance:e}n.instance=new i.oh("Etc/UTC")},16177:function(e,t,r){r.r(t),r.d(t,{WhereClause:function(){return te},defaultAttributeAdapter:function(){return de}});var i=r(9688),n=r(58941),s=r(83324),o=r(42042),a=r(93393);class l{constructor(){this.op="+",this.day=0,this.second=0,this.hour=0,this.month=0,this.year=0,this.minute=0,this.millis=0}static _fixDefaults(e){if(null!==e.precision||null!==e.secondary)throw new a.L8(a.Z7.PrimarySecondaryQualifiers)}static _parseSecondsComponent(e,t){if(t.includes(".")){const r=t.split(".");e.second=parseFloat(r[0]),e.millis=parseInt(r[1],10)}else e.second=parseFloat(t)}static createFromMilliseconds(e){const t=new l;return t.second=e/1e3,t}static createFromValueAndQualifier(e,t,r){let i=null;const n=new l;if(n.op="-"===r?"-":"+","interval-period"===t.type){l._fixDefaults(t);const r=new RegExp("^[0-9]{1,}$");if("year"===t.period||"month"===t.period)throw new a.L8(a.Z7.YearMonthIntervals);if("second"===t.period){if(!/^[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/.test(e))throw new a.L8(a.Z7.IllegalInterval);l._parseSecondsComponent(n,e)}else{if(!r.test(e))throw new a.L8(a.Z7.IllegalInterval);n[t.period]=parseFloat(e)}}else{if(l._fixDefaults(t.start),l._fixDefaults(t.end),"year"===t.start.period||"month"===t.start.period||"year"===t.end.period||"month"===t.end.period)throw new a.L8(a.Z7.YearMonthIntervals);switch(t.start.period){case"day":switch(t.end.period){case"hour":if(i=new RegExp("^[0-9]{1,} [0-9]{1,}$"),!i.test(e))throw new a.L8(a.Z7.IllegalInterval);n[t.start.period]=parseFloat(e.split(" ")[0]),n[t.end.period]=parseFloat(e.split(" ")[1]);break;case"minute":if(i=new RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,}$"),!i.test(e))throw new a.L8(a.Z7.IllegalInterval);{n[t.start.period]=parseFloat(e.split(" ")[0]);const r=e.split(" ")[1].split(":");n.hour=parseFloat(r[0]),n.minute=parseFloat(r[1])}break;case"second":if(i=new RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$"),!i.test(e))throw new a.L8(a.Z7.IllegalInterval);{n[t.start.period]=parseFloat(e.split(" ")[0]);const r=e.split(" ")[1].split(":");n.hour=parseFloat(r[0]),n.minute=parseFloat(r[1]),l._parseSecondsComponent(n,r[2])}break;default:throw new a.L8(a.Z7.IllegalInterval)}break;case"hour":switch(t.end.period){case"minute":if(i=new RegExp("^[0-9]{1,}:[0-9]{1,}$"),!i.test(e))throw new a.L8(a.Z7.IllegalInterval);n.hour=parseFloat(e.split(":")[0]),n.minute=parseFloat(e.split(":")[1]);break;case"second":if(i=new RegExp("^[0-9]{1,}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$"),!i.test(e))throw new a.L8(a.Z7.IllegalInterval);{const t=e.split(":");n.hour=parseFloat(t[0]),n.minute=parseFloat(t[1]),l._parseSecondsComponent(n,t[2])}break;default:throw new a.L8(a.Z7.IllegalInterval)}break;case"minute":if("second"!==t.end.period)throw new a.L8(a.Z7.IllegalInterval);if(i=new RegExp("^[0-9]{1,}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$"),!i.test(e))throw new a.L8(a.Z7.IllegalInterval);{const t=e.split(":");n.minute=parseFloat(t[0]),l._parseSecondsComponent(n,t[1])}break;default:throw new a.L8(a.Z7.IllegalInterval)}}return n}valueInMilliseconds(){return("-"===this.op?-1:1)*(this.millis+1e3*this.second+60*this.minute*1e3+60*this.hour*60*1e3+24*this.day*60*60*1e3+this.month*(365/12)*24*60*60*1e3+365*this.year*24*60*60*1e3)}}var c=r(359),u=r(70891),h=r(92955),d=r(96285);const f=/^(\d{1,2}):(\d{1,2}):(\d{1,2})$/,p=/^(\d{1,2}):(\d{1,2})$/,m=/^(\d{1,2}):(\d{1,2}):(\d{1,2}).([0-9]+)$/,_=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,g=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?$/,y=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?[ ]{0,1}(\+|-)(\d{1,2}):(\d{1,2})$/,x=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})?[ ]{0,1}(\+|-)(\d{1,2}):(\d{1,2})$/,b=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/;function w(e,t){if(t instanceof d.bo)return t===h.GB.instance?d.c9.fromMillis(e.getTime(),{zone:h.GB.instance}):d.c9.fromJSDate(e,{zone:t});switch(t){case"system":case"local":case null:return d.c9.fromJSDate(e);default:return"unknown"===t?.toLowerCase()?d.c9.fromMillis(e.getTime(),{zone:h.GB.instance}):d.c9.fromJSDate(e,{zone:t})}}function v(e){return"number"==typeof e}function S(e){return"string"==typeof e||e instanceof String}function T(e){return e instanceof l}function I(e){return e instanceof Date}function M(e){return e instanceof d.c9}function A(e){return e instanceof o.n}function E(e){return e instanceof u.k}function P(e){return e instanceof c.g}function C(e){let t=f.exec(e);if(null!==t){const[,e,r,i]=t,n=u.k.fromParts(parseInt(e,10),parseInt(r,10),parseInt(i,10),0);if(null!==n)return n;throw new a.L8(a.Z7.InvalidTime)}if(t=p.exec(e),null!==t){const[,e,r]=t,i=u.k.fromParts(parseInt(e,10),parseInt(r,10),0,0);if(null!==i)return i;throw new a.L8(a.Z7.InvalidTime)}if(t=m.exec(e),null!==t){const[,e,r,i,n]=t,s=u.k.fromParts(parseInt(e,10),parseInt(r,10),parseInt(i,10),parseInt(n,10));if(null!==s)return s;throw new a.L8(a.Z7.InvalidTime)}throw new a.L8(a.Z7.InvalidTime)}function R(e,t,r=!1){let i=g.exec(e);if(null!==i){const[,e,r,n,s,o,l,c]=i,u=d.c9.fromObject({year:parseInt(e,10),month:parseInt(r,10),day:parseInt(n,10),hour:parseInt(s,10),minute:parseInt(o,10),second:parseInt(l,10),millisecond:c?parseInt(c.replace(".",""),10):0},{zone:(0,h.Qo)(t)});if(!1===u.isValid)throw new a.L8(a.Z7.InvalidTimeStamp);return u}if(i=y.exec(e),null!==i){const[,e,t,r,n,s,o,l,u,h,d]=i,f=c.g.fromParts(parseInt(e,10),parseInt(t,10),parseInt(r,10),parseInt(n,10),parseInt(s,10),parseInt(o,10),l?parseInt(l.replace(".",""),10):0,"-"===u,parseInt(h,10),parseInt(d,10));if(!1===f.isValid)throw new a.L8(a.Z7.InvalidTimeStamp);return f}if(i=x.exec(e),null!==i){const[,e,t,r,n,s,o,l,u]=i,h=c.g.fromParts(parseInt(e,10),parseInt(t,10),parseInt(r,10),parseInt(n,10),parseInt(s,10),0,0,"-"===o,parseInt(l,10),parseInt(u,10));if(!1===h.isValid)throw new a.L8(a.Z7.InvalidTimeStamp);return h}if(i=b.exec(e),null!==i){const[,e,r,n,s,o]=i,l=d.c9.fromObject({year:parseInt(e,10),month:parseInt(r,10),day:parseInt(n,10),hour:parseInt(s,10),minute:parseInt(o,10),second:0},{zone:(0,h.Qo)(t)});if(!1===l.isValid)throw new a.L8(a.Z7.InvalidTimeStamp);return l}if(i=_.exec(e),null!==i){const[,e,r,n]=i,s=d.c9.fromObject({year:parseInt(e,10),month:parseInt(r,10),day:parseInt(n,10),hour:0,minute:0,second:0},{zone:(0,h.Qo)(t)});if(!1===s.isValid)throw new a.L8(a.Z7.InvalidTimeStamp);return s}throw new a.L8(a.Z7.InvalidTimeStamp)}function F(e,t){const r=_.exec(e);if(null===r)try{return R(e,t)}catch{throw new a.L8(a.Z7.InvalidDate)}const[,i,n,s]=r,l=o.n.fromParts(parseInt(i,10),parseInt(n,10),parseInt(s,10));if(null===l)throw new a.L8(a.Z7.InvalidDate);return l}var L=r(15774),k=r(50944);function N(e){return!!M(e)||!!P(e)}function O(e){return!!(M(e)||A(e)||P(e)||E(e))}function D(e){if(M(e))return e.toMillis();if(A(e))return e.toNumber();if(P(e))return e.toMilliseconds();throw new a.L8(a.Z7.InvalidDataType)}function z(e,t,r,i){if(null==e||null==t)return null;if(v(e)){if(v(t))return U(e,t,r);if(S(t))return function(e,t,r){const i=parseFloat(t);if(!isNaN(i))return U(e,i,r);const n=e.toString();switch(r){case"<>":return n!==t;case"=":return n===t;case">":return n>t;case"<":return n<t;case">=":return n>=t;case"<=":return n<=t}}(e,t,r);if(O(t))throw new a.L8(a.Z7.InvalidOperator);if(A(t))throw new a.L8(a.Z7.InvalidOperator)}else if(S(e)){if(v(t))return function(e,t,r){const i=parseFloat(e);if(!isNaN(i))return U(i,t,r);const n=t.toString();switch(r){case"<>":return e!==n;case"=":return e===n;case">":return e>n;case"<":return e<n;case">=":return e>=n;case"<=":return e<=n}}(e,t,r);if(S(t))return function(e,t,r){switch(r){case"<>":return e!==t;case"=":return e===t;case">":return e>t;case"<":return e<t;case">=":return e>=t;case"<=":return e<=t}}(e,t,r);if(M(t))throw new a.L8(a.Z7.InvalidOperator);if(A(t))throw new a.L8(a.Z7.InvalidOperator);if(E(t))throw new a.L8(a.Z7.InvalidOperator);if(P(t))throw new a.L8(a.Z7.InvalidOperator)}else if(M(e)){if(N(t)){if(e instanceof d.c9&&(0,h.Y4)(e.zone)){if(t instanceof d.c9&&!1===(0,h.Y4)(t.zone))return G(e,t,r);if(t instanceof c.g)return G(e,t,r)}else if(t instanceof d.c9&&(0,h.Y4)(t.zone)){if(e instanceof d.c9&&!1===(0,h.Y4)(e.zone))return G(e,t,r);if(e instanceof c.g)return G(e,t,r)}return U(D(e),D(t),r)}if(S(t))throw new a.L8(a.Z7.InvalidOperator);if(A(t))return function(e,t,r){const i=t.toDateTimeLuxon(e.zone);return U((e=e.startOf("day")).toMillis(),i.toMillis(),r)}(e,t,r);if(E(t))throw new a.L8(a.Z7.InvalidOperator);if(v(t))throw new a.L8(a.Z7.InvalidOperator)}else if(A(e)){if(P(t))return function(e,t,r){const i=e.toDateTimeLuxon(t.toDateTime().zone);return t=t.startOfDay(),U(i.toMillis(),t.toMilliseconds(),r)}(e,t,r);if(M(t))return function(e,t,r){const i=e.toDateTimeLuxon(t.zone);return t=t.startOf("day"),U(i.toMillis(),t.toMillis(),r)}(e,t,r);if(S(t))throw new a.L8(a.Z7.InvalidOperator);if(A(t))return U(e.toNumber(),t.toNumber(),r);if(E(t))throw new a.L8(a.Z7.InvalidOperator);if(v(t))throw new a.L8(a.Z7.InvalidOperator)}else if(E(e)){if(E(t))return U(e.toNumber(),t.toNumber(),r);if(S(t))throw new a.L8(a.Z7.InvalidOperator);if(v(t))throw new a.L8(a.Z7.InvalidOperator);if(A(t))throw new a.L8(a.Z7.InvalidOperator);if(N(t))throw new a.L8(a.Z7.InvalidOperator)}else if(P(e)){if(N(t))return t instanceof d.c9&&(0,h.Y4)(t.zone)?G(e,t,r):U(D(e),D(t),r);if(S(t))throw new a.L8(a.Z7.InvalidOperator);if(A(t))return function(e,t,r){const i=t.toDateTimeLuxon(e.toDateTime().zone);return U((e=e.startOfDay()).toMilliseconds(),i.toMillis(),r)}(e,t,r);if(E(t))throw new a.L8(a.Z7.InvalidOperator);if(v(t))throw new a.L8(a.Z7.InvalidOperator)}switch(r){case"<>":return e!==t;case"=":return e===t;case">":return e>t;case"<":return e<t;case">=":return e>=t;case"<=":return e<=t}}function U(e,t,r){switch(r){case"<>":return e!==t;case"=":return e===t;case">":return e>t;case"<":return e<t;case">=":return e>=t;case"<=":return e<=t}}function G(e,t,r){e instanceof c.g&&(e=e.toDateTime()),t instanceof c.g&&(t=t.toDateTime());const i=B(e),n=B(t);switch(r){case"<>":return i!==n;case"=":return i===n;case">":return i>n;case"<":return i<n;case">=":return i>=n;case"<=":return i<=n}}function B(e){return 321408e5*e.year+26784e5*e.month+864e5*e.day+36e5*e.hour+6e4*e.minute+1e3*e.second+e.millisecond}function V(e,t,r){const i=j[e.toLowerCase()];if(null==i)throw new a.L8(a.Z7.FunctionNotRecognized);if(t.length<i.minParams||t.length>i.maxParams)throw new a.L8(a.Z7.InvalidParameterCount,{name:e.toUpperCase()});return i.evaluate(t,r)}function q(e){return"string"==typeof e||e instanceof String}function Z(e){return!(I(e)||A(e)||M(e)||E(e)||P(e))}function H(e){return A(e)||E(e)?e.toString():P(e)?e.toSQLValue():M(e)?0===e.millisecond?e.toFormat("yyyy-LL-dd HH:mm:ss"):e.toSQL({includeOffset:!1}):I(e)?H(d.c9.fromJSDate(e)):e.toString()}const j={extract:{minParams:2,maxParams:2,evaluate:([e,t])=>{if(null==t)return null;if(I(t))switch(e.toUpperCase()){case"SECOND":return t.getSeconds();case"MINUTE":return t.getMinutes();case"HOUR":return t.getHours();case"DAY":return t.getDate();case"MONTH":return t.getMonth()+1;case"YEAR":return t.getFullYear();case"TIMEZONE_HOUR":case"TIMEZONE_MINUTE":return 0}else if(M(t))switch(e.toUpperCase()){case"SECOND":return t.second;case"MINUTE":return t.minute;case"HOUR":return t.hour;case"DAY":return t.day;case"MONTH":return t.month;case"YEAR":return t.year;case"TIMEZONE_HOUR":case"TIMEZONE_MINUTE":throw new a.L8(a.Z7.InvalidFunctionParameters,{function:"EXTRACT"})}else if(A(t))switch(e.toUpperCase()){case"DAY":return t.day;case"MONTH":return t.month;case"YEAR":return t.year;case"TIMEZONE_HOUR":case"TIMEZONE_MINUTE":throw new a.L8(a.Z7.InvalidFunctionParameters,{function:"EXTRACT"})}else if(E(t))switch(e.toUpperCase()){case"SECOND":return t.second;case"MINUTE":return t.minute;case"HOUR":return t.hour}else if(P(t))switch(e.toUpperCase()){case"SECOND":return t.second;case"MINUTE":return t.minute;case"HOUR":return t.hour;case"DAY":return t.day;case"MONTH":return t.month;case"YEAR":return t.year;case"TIMEZONE_HOUR":return t.timezoneOffsetHour;case"TIMEZONE_MINUTE":return t.timezoneOffsetMinutes}throw new a.L8(a.Z7.InvalidFunctionParameters,{function:"EXTRACT"})}},substring:{minParams:2,maxParams:3,evaluate:e=>{if(2===e.length){const[t,r]=e;return null==t||null==r?null:t.toString().substring(r-1)}if(3===e.length){const[t,r,i]=e;return null==t||null==r||null==i?null:i<=0?"":t.toString().substring(r-1,r+i-1)}}},position:{minParams:2,maxParams:2,evaluate:([e,t])=>null==e||null==t?null:t.indexOf(e)+1},trim:{minParams:2,maxParams:3,evaluate:e=>{const t=3===e.length,r=t?e[1]:" ",i=t?e[2]:e[1];if(null==r||null==i)return null;const n=`(${(0,k.Cj)(r)})`;switch(e[0]){case"BOTH":return i.replaceAll(new RegExp(`^${n}*|${n}*$`,"g"),"");case"LEADING":return i.replaceAll(new RegExp(`^${n}*`,"g"),"");case"TRAILING":return i.replaceAll(new RegExp(`${n}*$`,"g"),"")}throw new a.L8(a.Z7.InvalidFunctionParameters,{function:"TRIM"})}},abs:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.abs(e[0])},ceiling:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.ceil(e[0])},floor:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.floor(e[0])},log:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.log(e[0])},log10:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.log(e[0])*Math.LOG10E},sin:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.sin(e[0])},cos:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.cos(e[0])},tan:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.tan(e[0])},asin:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.asin(e[0])},acos:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.acos(e[0])},atan:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.atan(e[0])},sign:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:e[0]>0?1:e[0]<0?-1:0},power:{minParams:2,maxParams:2,evaluate:e=>null==e[0]||null==e[1]?null:e[0]**e[1]},mod:{minParams:2,maxParams:2,evaluate:e=>null==e[0]||null==e[1]?null:e[0]%e[1]},round:{minParams:1,maxParams:2,evaluate:e=>{const t=e[0],r=2===e.length?10**e[1]:1;return null==t?null:Math.round(t*r)/r}},truncate:{minParams:1,maxParams:2,evaluate:e=>null==e[0]?null:1===e.length||0===e[1]?Math.trunc(e[0]):(0,L.pF)("trunc",e[0],-Number(e[1]))},char_length:{minParams:1,maxParams:1,evaluate:e=>q(e[0])?e[0].length:0},concat:{minParams:1,maxParams:1/0,evaluate:e=>{let t="";for(let r=0;r<e.length;r++){if(null==e[r])return null;t+=e[r].toString()}return t}},lower:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:e[0].toString().toLowerCase()},upper:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:e[0].toString().toUpperCase()},coalesce:{minParams:1,maxParams:1/0,evaluate:e=>{for(const t of e)if(null!==t)return t;return null}},cosh:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.cosh(e[0])},sinh:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.sinh(e[0])},tanh:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.tanh(e[0])},nullif:{minParams:2,maxParams:2,evaluate:(e,t)=>z(e[0],e[1],"=")?null:e[0]},cast:{minParams:2,maxParams:2,evaluate:(e,t)=>{const r=e[0],i=e[1];if(null===r)return null;switch(i.type){case"integer":{if(!Z(r))throw new a.L8(a.Z7.CannotCastValue);const e=parseInt(r,10);if(isNaN(e))throw new a.L8(a.Z7.CannotCastValue);return e}case"smallint":{if(!Z(r))throw new a.L8(a.Z7.CannotCastValue);const e=parseInt(r,10);if(isNaN(e))throw new a.L8(a.Z7.CannotCastValue);if(e>32767||e<-32767)throw new a.L8(a.Z7.CannotCastValue);return e}case"float":case"real":{if(!Z(r))throw new a.L8(a.Z7.CannotCastValue);const e=parseFloat(r);if(isNaN(e))throw new a.L8(a.Z7.CannotCastValue);return e}case"time":return function(e){if(I(e))return u.k.fromDateJS(e);if(M(e))return u.k.fromDateTime(e);if(A(e))throw new a.L8(a.Z7.CannotCastValue);if(E(e))return e;if(P(e))return u.k.fromSqlTimeStampOffset(e);if(q(e))return C(e);throw new a.L8(a.Z7.CannotCastValue)}(r);case"date":return function(e){if(I(e))return o.n.fromDateJS(e);if(M(e))return o.n.fromParts(e.year,e.month,e.day);if(A(e))return e;if(E(e))throw new a.L8(a.Z7.CannotCastValue);if(P(e)&&null===o.n.fromParts(e.year,e.month,e.day))throw new a.L8(a.Z7.CannotCastValue);if(q(e)){const t=o.n.fromReader(e);if(null!==t&&t.isValid)return t}throw new a.L8(a.Z7.CannotCastValue)}(r);case"timestamp":return function(e,t,r){if(I(e))return w(e,t);if(M(e))return e;if(A(e))return e.toDateTimeLuxon("unknown");if(E(e))throw new a.L8(a.Z7.CannotCastValue);if(P(e))return e;if(q(e))return R(e,"unknown",r);throw new a.L8(a.Z7.CannotCastValue)}(r,t,!0===i.withtimezone);case"varchar":{const e=H(r);if(e.length>i.size)throw new a.L8(a.Z7.CannotCastValue);return e}default:throw new a.L8(a.Z7.InvalidDataType)}}}};function W(e,t,r,i){if("||"===e)return V("concat",[t,r],i);if(null===t||null===r)return null;if(v(t)){if(v(r))return Y(t,r,e);if(T(r))return function(e,t,r){switch(r){case"+":return l.createFromMilliseconds(e+t.valueInMilliseconds());case"-":return l.createFromMilliseconds(e-t.valueInMilliseconds());case"*":return l.createFromMilliseconds(e*t.valueInMilliseconds());case"/":return l.createFromMilliseconds(e/t.valueInMilliseconds())}throw new a.L8(a.Z7.InvalidOperator)}(t,r,e);if(E(r))return function(){throw new a.L8(a.Z7.InvalidOperator)}();if(A(r))return function(){throw new a.L8(a.Z7.InvalidOperator)}();if(P(r))return function(){throw new a.L8(a.Z7.InvalidOperator)}();if(M(r))return function(){throw new a.L8(a.Z7.InvalidOperator)}();if(S(r))return function(e,t,r){const i=parseFloat(t);if(isNaN(i))throw new a.L8(a.Z7.InvalidOperator);return Y(e,i,r)}(t,r,e);throw new a.L8(a.Z7.InvalidOperator)}if(A(t)){if(v(r))return function(e,t,r){const i=1e3*t*24*60*60;switch(r){case"+":return e.plus("milliseconds",i);case"-":return e.plus("milliseconds",-1*i)}throw new a.L8(a.Z7.InvalidOperator)}(t,r,e);if(T(r))return function(e,t,r){switch(r){case"+":return e.plus("milliseconds",t.valueInMilliseconds());case"-":return e.plus("milliseconds",-1*t.valueInMilliseconds())}throw new a.L8(a.Z7.InvalidOperator)}(t,r,e);if(E(r))return function(){throw new a.L8(a.Z7.InvalidOperator)}();if(A(r))return function(e,t,r){if("-"===r)return e.toDateTimeLuxon("UTC").diff(t.toDateTimeLuxon("UTC")).as("days");throw new a.L8(a.Z7.InvalidOperator)}(t,r,e);if(P(r))return function(e,t,r){if("-"===r)return e.toDateTimeLuxon(t.toDateTime().zone).diff(t.toDateTime()).as("days");throw new a.L8(a.Z7.InvalidOperator)}(t,r,e);if(M(r))return function(e,t,r){if("-"===r)return e.toDateTimeLuxon(t.zone).diff(t).as("days");throw new a.L8(a.Z7.InvalidOperator)}(t,r,e);if(S(r))return function(){throw new a.L8(a.Z7.InvalidOperator)}();throw new a.L8(a.Z7.InvalidOperator)}if(E(t)){if(v(r))return function(e,t,r){const i=1e3*t*24*60*60;switch(r){case"+":return e.plus("milliseconds",i);case"-":return e.plus("milliseconds",-1*i)}throw new a.L8(a.Z7.InvalidOperator)}(t,r,e);if(T(r))return function(e,t,r){switch(r){case"+":return e.plus("milliseconds",t.valueInMilliseconds());case"-":return e.plus("milliseconds",-1*t.valueInMilliseconds())}throw new a.L8(a.Z7.InvalidOperator)}(t,r,e);if(E(r))return function(){throw new a.L8(a.Z7.InvalidOperator)}();if(A(r))return function(){throw new a.L8(a.Z7.InvalidOperator)}();if(P(r))return function(){throw new a.L8(a.Z7.InvalidOperator)}();if(M(r))return function(){throw new a.L8(a.Z7.InvalidOperator)}();if(S(r))return function(){throw new a.L8(a.Z7.InvalidOperator)}();throw new a.L8(a.Z7.InvalidOperator)}if(T(t)){if(v(r))return function(e,t,r){switch(r){case"+":return l.createFromMilliseconds(e.valueInMilliseconds()+t);case"-":return l.createFromMilliseconds(e.valueInMilliseconds()-t);case"*":return l.createFromMilliseconds(e.valueInMilliseconds()*t);case"/":return l.createFromMilliseconds(e.valueInMilliseconds()/t)}throw new a.L8(a.Z7.InvalidOperator)}(t,r,e);if(T(r))return function(e,t,r){switch(r){case"+":return l.createFromMilliseconds(e.valueInMilliseconds()+t.valueInMilliseconds());case"-":return l.createFromMilliseconds(e.valueInMilliseconds()-t.valueInMilliseconds());case"*":return l.createFromMilliseconds(e.valueInMilliseconds()*t.valueInMilliseconds());case"/":return l.createFromMilliseconds(e.valueInMilliseconds()/t.valueInMilliseconds())}throw new a.L8(a.Z7.InvalidOperator)}(t,r,e);if(E(r))return function(e,t,r){if("+"===r)return t.plus("milliseconds",e.valueInMilliseconds());throw new a.L8(a.Z7.InvalidOperator)}(t,r,e);if(A(r))return function(e,t,r){if("+"===r)return t.plus("milliseconds",e.valueInMilliseconds());throw new a.L8(a.Z7.InvalidOperator)}(t,r,e);if(P(r))return function(e,t,r){if("+"===r)return t.addMilliseconds(e.valueInMilliseconds());throw new a.L8(a.Z7.InvalidOperator)}(t,r,e);if(M(r))return function(e,t,r){switch(r){case"+":return t.plus({milliseconds:e.valueInMilliseconds()});case"-":return e.valueInMilliseconds()-t.toMillis()}throw new a.L8(a.Z7.InvalidOperator)}(t,r,e);if(S(r))return function(){throw new a.L8(a.Z7.InvalidOperator)}();throw new a.L8(a.Z7.InvalidOperator)}if(M(t)){if(v(r))return function(e,t,r){const i=1e3*t*24*60*60;switch(r){case"+":return e.plus({milliseconds:i});case"-":return e.minus({milliseconds:i})}throw new a.L8(a.Z7.InvalidOperator)}(t,r,e);if(T(r))return function(e,t,r){switch(r){case"+":return e.plus({milliseconds:t.valueInMilliseconds()});case"-":return e.minus({milliseconds:t.valueInMilliseconds()})}throw new a.L8(a.Z7.InvalidOperator)}(t,r,e);if(E(r))return function(){throw new a.L8(a.Z7.InvalidOperator)}();if(A(r))return function(e,t,r){if("-"===r)return e.diff(t.toDateTimeLuxon(e.zone)).as("days");throw new a.L8(a.Z7.InvalidOperator)}(t,r,e);if(P(r))return function(e,t,r){if("-"===r)return e.diff(t.toDateTime()).as("days");throw new a.L8(a.Z7.InvalidOperator)}(t,r,e);if(M(r))return function(e,t,r){if("-"===r)return e.diff(t).as("days");throw new a.L8(a.Z7.InvalidOperator)}(t,r,e);if(S(r))return function(){throw new a.L8(a.Z7.InvalidOperator)}();throw new a.L8(a.Z7.InvalidOperator)}if(P(t)){if(v(r))return function(e,t,r){const i=1e3*t*24*60*60;switch(r){case"+":return e.addMilliseconds(i);case"-":return e.addMilliseconds(-1*i)}throw new a.L8(a.Z7.InvalidOperator)}(t,r,e);if(T(r))return function(e,t,r){switch(r){case"+":return e.addMilliseconds(t.valueInMilliseconds());case"-":return e.addMilliseconds(-1*t.valueInMilliseconds())}throw new a.L8(a.Z7.InvalidOperator)}(t,r,e);if(E(r))return function(){throw new a.L8(a.Z7.InvalidOperator)}();if(A(r))return function(e,t,r){if("-"===r)return e.toDateTime().diff(t.toDateTimeLuxon(e.toDateTime().zone)).as("days");throw new a.L8(a.Z7.InvalidOperator)}(t,r,e);if(P(r))return function(e,t,r){if("-"===r)return e.toDateTime().diff(t.toDateTime()).as("days");throw new a.L8(a.Z7.InvalidOperator)}(t,r,e);if(M(r))return function(e,t,r){if("-"===r)return e.toDateTime().diff(t).as("days");throw new a.L8(a.Z7.InvalidOperator)}(t,r,e);if(S(r))return function(){throw new a.L8(a.Z7.InvalidOperator)}();throw new a.L8(a.Z7.InvalidOperator)}if(S(t)){if(v(r))return function(e,t,r){const i=parseFloat(e);if(isNaN(i))throw new a.L8(a.Z7.InvalidOperator);return Y(i,t,r)}(t,r,e);if(T(r))return function(){throw new a.L8(a.Z7.InvalidOperator)}();if(E(r))return function(){throw new a.L8(a.Z7.InvalidOperator)}();if(A(r))return function(){throw new a.L8(a.Z7.InvalidOperator)}();if(P(r))return function(){throw new a.L8(a.Z7.InvalidOperator)}();if(M(r))return function(){throw new a.L8(a.Z7.InvalidOperator)}();if(S(r))return function(e,t,r){if("+"===r)return e+t;throw new a.L8(a.Z7.InvalidOperator)}(t,r,e);throw new a.L8(a.Z7.InvalidOperator)}throw new a.L8(a.Z7.InvalidOperator)}function Y(e,t,r){switch(r){case"+":return e+t;case"-":return e-t;case"*":return e*t;case"/":return e/t}throw new a.L8(a.Z7.InvalidOperator)}function $(e,t,r,i){var n=Error.call(this,e);return Object.setPrototypeOf&&Object.setPrototypeOf(n,$.prototype),n.expected=t,n.found=r,n.location=i,n.name="SyntaxError",n}function X(e,t,r){return r=r||" ",e.length>t?e:(t-=e.length,e+(r+=r.repeat(t)).slice(0,t))}(function(e,t){function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r})($,Error),$.prototype.format=function(e){var t="Error: "+this.message;if(this.location){var r,i=null;for(r=0;r<e.length;r++)if(e[r].source===this.location.source){i=e[r].text.split(/\r\n|\n|\r/g);break}var n=this.location.start,s=this.location.source&&"function"==typeof this.location.source.offset?this.location.source.offset(n):n,o=this.location.source+":"+s.line+":"+s.column;if(i){var a=this.location.end,l=X("",s.line.toString().length," "),c=i[n.line-1],u=(n.line===a.line?a.column:c.length+1)-n.column||1;t+="\n --\x3e "+o+"\n"+l+" |\n"+s.line+" | "+c+"\n"+l+" | "+X("",n.column-1," ")+X("",u,"^")}else t+="\n at "+o}return t},$.buildMessage=function(e,t){var r={literal:function(e){return'"'+n(e.text)+'"'},class:function(e){var t=e.parts.map((function(e){return Array.isArray(e)?s(e[0])+"-"+s(e[1]):s(e)}));return"["+(e.inverted?"^":"")+t.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(e){return e.description}};function i(e){return e.charCodeAt(0).toString(16).toUpperCase()}function n(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+i(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+i(e)}))}function s(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+i(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+i(e)}))}function o(e){return r[e.type](e)}return"Expected "+function(e){var t,r,i=e.map(o);if(i.sort(),i.length>0){for(t=1,r=1;t<i.length;t++)i[t-1]!==i[t]&&(i[r]=i[t],r++);i.length=r}switch(i.length){case 1:return i[0];case 2:return i[0]+" or "+i[1];default:return i.slice(0,-1).join(", ")+", or "+i[i.length-1]}}(e)+" but "+function(e){return e?'"'+n(e)+'"':"end of input"}(t)+" found."};class Q{static parse(e){return function(e,t){var r,i={},n=(t=void 0!==t?t:{}).grammarSource,s={start:rs},o=rs,a="!",l="=",c=">=",u=">",h="<=",d="<>",f="!=",p="||",m="@",_="'",g="N'",y="''",x=".",b="null",w="true",v="false",S="in",T="is",I="like",M="escape",A="not",E="and",P="or",C="between",R="from",F="for",L="substring",k="extract",N="trim",O="position",D="timestamp",z="date",U="time",G="leading",B="trailing",V="both",q="cast",Z="as",H="integer",j="int",W="smallint",Y="float",X="real",Q="varchar",J="to",K="interval",ee="year",te="timezone_hour",re="timezone_minute",ie="month",ne="day",se="hour",oe="minute",ae="second",le="case",ce="end",ue="when",he="then",de="else",fe=",",pe="(",me=")",_e="`",ge=/^[<-=]/,ye=/^[+\-]/,xe=/^[*\/]/,be=/^[A-Za-z_\x80-\uFFFF]/,we=/^[A-Za-z0-9_]/,ve=/^[A-Za-z0-9_.\x80-\uFFFF]/,Se=/^["]/,Te=/^[^']/,Ie=/^[0-9]/,Me=/^[eE]/,Ae=/^[ \t\n\r]/,Ee=/^[^`]/,Pe=Xn("!",!1),Ce=Xn("=",!1),Re=Xn(">=",!1),Fe=Xn(">",!1),Le=Xn("<=",!1),ke=Xn("<>",!1),Ne=Qn([["<","="]],!1,!1),Oe=Xn("!=",!1),De=Qn(["+","-"],!1,!1),ze=Xn("||",!1),Ue=Qn(["*","/"],!1,!1),Ge=Qn([["A","Z"],["a","z"],"_",["","￿"]],!1,!1),Be=Qn([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),Ve=Qn([["A","Z"],["a","z"],["0","9"],"_",".",["","￿"]],!1,!1),qe=Qn(['"'],!1,!1),Ze=Xn("@",!1),He=Xn("'",!1),je=Xn("N'",!1),We=Xn("''",!1),Ye=Qn(["'"],!0,!1),$e=Xn(".",!1),Xe=Qn([["0","9"]],!1,!1),Qe=Qn(["e","E"],!1,!1),Je=Xn("NULL",!0),Ke=Xn("TRUE",!0),et=Xn("FALSE",!0),tt=Xn("IN",!0),rt=Xn("IS",!0),it=Xn("LIKE",!0),nt=Xn("ESCAPE",!0),st=Xn("NOT",!0),ot=Xn("AND",!0),at=Xn("OR",!0),lt=Xn("BETWEEN",!0),ct=Xn("FROM",!0),ut=Xn("FOR",!0),ht=Xn("SUBSTRING",!0),dt=Xn("EXTRACT",!0),ft=Xn("TRIM",!0),pt=Xn("POSITION",!0),mt=Xn("TIMESTAMP",!0),_t=Xn("DATE",!0),gt=Xn("TIME",!0),yt=Xn("LEADING",!0),xt=Xn("TRAILING",!0),bt=Xn("BOTH",!0),wt=Xn("CAST",!0),vt=Xn("AS",!0),St=Xn("INTEGER",!0),Tt=Xn("INT",!0),It=Xn("SMALLINT",!0),Mt=Xn("FLOAT",!0),At=Xn("REAL",!0),Et=Xn("VARCHAR",!0),Pt=Xn("TO",!0),Ct=Xn("INTERVAL",!0),Rt=Xn("YEAR",!0),Ft=Xn("TIMEZONE_HOUR",!0),Lt=Xn("TIMEZONE_MINUTE",!0),kt=Xn("MONTH",!0),Nt=Xn("DAY",!0),Ot=Xn("HOUR",!0),Dt=Xn("MINUTE",!0),zt=Xn("SECOND",!0),Ut=Xn("CASE",!0),Gt=Xn("END",!0),Bt=Xn("WHEN",!0),Vt=Xn("THEN",!0),qt=Xn("ELSE",!0),Zt=Xn(",",!1),Ht=Xn("(",!1),jt=Xn(")",!1),Wt=Qn([" ","\t","\n","\r"],!1,!1),Yt=Xn("`",!1),$t=Qn(["`"],!0,!1),Xt=function(e){return e},Qt=function(e){return Vo(Yn(),...e)},Jt=function(e,t,r){return{op:t,expr:r,location:Yn()}},Kt=function(e,t){return qo(e,t)},er=function(e,t,r){return{op:t,expr:r,location:Yn()}},tr=function(e,t){return qo(e,t)},rr=function(e){return function(e,t,r){return{type:"unary-expression",location:r,operator:"NOT",expr:t}}(0,e,Yn())},ir=function(e,t){return""==t||null==t||null==t?e:"arithmetic"==t.type?qo(e,t.tail):Bo(t.op,e,t.right,t.escape,Yn())},nr=function(e,t){return{op:e,expr:t,location:Yn()}},sr=function(e){return{type:"arithmetic",tail:e}},or=function(e,t){return{op:e+"NOT",right:t}},ar=function(e,t){return{op:e,right:t}},lr=function(e,t,r){return Vo(Yn(),t,r)},cr=function(e,t){return{op:"NOT"+e,right:t}},ur=function(e,t,r){return Vo(Yn(),t,r)},hr=function(e,t){return{op:e,right:t}},dr=function(e){return e[0]+" "+e[2]},fr=function(e){return e[0]+" "+e[2]},pr=function(e,t,r){return{op:e,right:t,escape:r.value}},mr=function(e,t){return{op:e,right:t,escape:""}},_r=function(e,t){return{op:e,right:t}},gr=function(e,t){return{op:e,right:t}},yr=function(e,t,r){return{op:t,expr:r,location:Yn()}},xr=function(e,t){return qo(e,t)},br=function(e,t,r){return{op:t,expr:r,location:Yn()}},wr=function(e,t){return qo(e,t)},vr=function(e){return e.paren=!0,e},Sr=function(e){return/^CURRENT_DATE$/i.test(e)?{type:"current-time",location:Yn(),mode:"date"}:/^CURRENT_TIMESTAMP$/i.test(e)?{type:"current-time",location:Yn(),mode:"timestamp"}:/^CURRENT_TIME$/i.test(e)?{type:"current-time",location:Yn(),mode:"time"}:/^CURRENT_USER$/i.test(e)?{type:"current-user",location:Yn()}:{type:"column-reference",location:Yn(),table:"",column:e}},Tr=function(e){return{type:"column-reference",location:Yn(),table:"",column:e,delimited:!0}},Ir=function(e){return e},Mr=function(e,t){return e+t.join("")},Ar=function(e,t){return e+t.join("")},Er=function(e){return e},Pr=function(e){return e.join("")},Cr=function(){return'"'},Rr=function(e){return{type:"parameter",location:Yn(),value:e[1]}},Fr=function(e,t){return Vo(Yn(),e,t)},Lr=function(e,t){return Vo(Yn(),e,t)},kr=function(e){return{type:"function",location:Yn(),name:"extract",args:e}},Nr=function(e,t,r){return Vo(Yn(),e,t,...r?[r]:[])},Or=function(e,t,r){return Vo(Yn(),e,t,r)},Dr=function(e){return{type:"function",location:Yn(),name:"substring",args:e}},zr=function(e,t){return Vo(Yn(),e,t)},Ur=function(e,t){return Vo(Yn(),e,t)},Gr=function(e){return{type:"function",location:Yn(),name:"cast",args:e}},Br=function(){return{type:"data-type",location:Yn(),value:{type:"integer"}}},Vr=function(){return{type:"data-type",location:Yn(),value:{type:"smallint"}}},qr=function(){return{type:"data-type",location:Yn(),value:{type:"float"}}},Zr=function(){return{type:"data-type",location:Yn(),value:{type:"real"}}},Hr=function(){return{type:"data-type",location:Yn(),value:{type:"date"}}},jr=function(){return{type:"data-type",location:Yn(),value:{type:"timestamp"}}},Wr=function(){return{type:"data-type",location:Yn(),value:{type:"time"}}},Yr=function(e){return{type:"data-type",location:Yn(),value:{type:"varchar",size:parseInt(e)}}},$r=function(e,t,r){return Vo(Yn(),e,t,r)},Xr=function(e,t){return Vo(Yn(),e,t)},Qr=function(e){return{type:"function",location:Yn(),name:"trim",args:e}},Jr=function(e){return{type:"string",location:Yn(),value:e??"BOTH"}},Kr=function(e,t){return Vo(Yn(),e,t)},ei=function(e,t){return Vo(Yn(),e,t)},ti=function(e){return{type:"function",location:Yn(),name:"position",args:e}},ri=function(e,t){return{type:"function",location:Yn(),name:e,args:t}},ii=function(e){return{type:"string",location:Yn(),value:e}},ni=function(e){return"string"===e.type&&function(e){!0!==/^(\d{4})-(\d{1,2})-(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/.test(e)&&$n("Timestamp literal is invalid")}(e.value),{type:"timestamp",location:Yn(),value:e.value}},si=function(e){return"string"===e.type&&function(e){!0!==/^(\d{1,2}):(\d{1,2}):(\d{1,2})$|^(\d{1,2}):(\d{1,2})$|^(\d{1,2}):(\d{1,2}):(\d{1,2}).([0-9]+)$/.test(e)&&$n("Time literal is invalid")}(e.value),{type:"time",location:Yn(),value:e.value}},oi=function(e,t,r){return{type:"interval",location:Yn(),value:t,qualifier:r,op:e}},ai=function(e,t){return{type:"interval",location:Yn(),value:e,qualifier:t,op:""}},li=function(e,t){return{type:"interval-qualifier",location:Yn(),start:e,end:t}},ci=function(e,t){return{type:"interval-period",location:Yn(),period:e.value,precision:t,secondary:null}},ui=function(e){return{type:"interval-period",location:Yn(),period:e.value,precision:null,secondary:null}},hi=function(e){return{type:"interval-period",location:Yn(),period:e.value,precision:null,secondary:null}},di=function(e,t){return{type:"interval-period",location:Yn(),period:"second",precision:e,secondary:t}},fi=function(e){return{type:"interval-period",location:Yn(),period:"second",precision:e,secondary:null}},pi=function(){return{type:"interval-period",location:Yn(),period:"second",precision:null,secondary:null}},mi=function(e,t){return{type:"interval-period",location:Yn(),period:e.value,precision:t,secondary:null}},_i=function(e){return{type:"interval-period",location:Yn(),period:e.value,precision:null,secondary:null}},gi=function(e,t){return{type:"interval-period",location:Yn(),period:"second",precision:e,secondary:t}},yi=function(e){return{type:"interval-period",location:Yn(),period:"second",precision:e,secondary:null}},xi=function(){return{type:"interval-period",location:Yn(),period:"second",precision:null,secondary:null}},bi=function(){return{type:"string",location:Yn(),value:"day"}},wi=function(){return{type:"string",location:Yn(),value:"hour"}},vi=function(){return{type:"string",location:Yn(),value:"minute"}},Si=function(){return{type:"string",location:Yn(),value:"month"}},Ti=function(){return{type:"string",location:Yn(),value:"year"}},Ii=function(e){return parseFloat(e)},Mi=function(e){return parseFloat(e)},Ai=function(e){return"string"===e.type&&function(e){!0!==/^(\d{4})-(\d{1,2})-(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/.test(e)&&$n("Date literal is invalid")}(e.value),{type:"date",location:Yn(),value:e.value}},Ei=function(){return{type:"null",location:Yn(),value:null}},Pi=function(){return{type:"boolean",location:Yn(),value:!0}},Ci=function(){return{type:"boolean",location:Yn(),value:!1}},Ri=function(){return"'"},Fi=function(e){return{type:"string",location:Yn(),value:e.join("")}},Li=function(e,t){return{type:"case-expression",location:Yn(),format:"simple",operand:e,clauses:t,else:null,elseLocation:null}},ki=function(e,t,r){return{type:"case-expression",location:Yn(),format:"simple",operand:e,clauses:t,else:r.value,elseLocation:r.location}},Ni=function(e){return{type:"case-expression",location:Yn(),format:"searched",clauses:e,else:null,elseLocation:null}},Oi=function(e,t){return{type:"case-expression",location:Yn(),format:"searched",clauses:e,else:t.value,elseLocation:t.location}},Di=function(e,t){return{type:"when-clause",location:Yn(),operand:e,value:t}},zi=function(e,t){return{type:"when-clause",location:Yn(),operand:e,value:t}},Ui=function(e){return{type:"else-clause",location:Yn(),value:e}},Gi=function(e){return{type:"number",location:Yn(),value:e}},Bi=function(e,t,r){return parseFloat(e+t+r)},Vi=function(e,t){return parseFloat(e+t)},qi=function(e,t){return parseFloat(e+t)},Zi=function(e){return parseFloat(e)},Hi=function(e,t){return e[0]+t},ji=function(e){return"."+(null!=e?e:"")},Wi=function(e,t){return e+t},Yi=function(e){return e.join("")},$i=function(e,t){return"e"+(null===t?"":t)},Xi=function(){return"IN"},Qi=function(){return"IS"},Ji=function(){return"LIKE"},Ki=function(){return"ESCAPE"},en=function(){return"NOT"},tn=function(){return"AND"},rn=function(){return"OR"},nn=function(){return"BETWEEN"},sn=function(){return"FROM"},on=function(){return"FOR"},an=function(){return"SUBSTRING"},ln=function(){return"EXTRACT"},cn=function(){return"TRIM"},un=function(){return"POSITION"},hn=function(){return"TIMESTAMP"},dn=function(){return"DATE"},fn=function(){return"TIME"},pn=function(){return"LEADING"},mn=function(){return"TRAILING"},_n=function(){return"BOTH"},gn=function(){return"CAST"},yn=function(){return"AS"},xn=function(){return"INTEGER"},bn=function(){return"INT"},wn=function(){return"SMALLINT"},vn=function(){return"FLOAT"},Sn=function(){return"REAL"},Tn=function(){return"VARCHAR"},In=function(){return"TO"},Mn=function(){return"INTERVAL"},An=function(){return"YEAR"},En=function(){return"TIMEZONE_HOUR"},Pn=function(){return"TIMEZONE_MINUTE"},Cn=function(){return"MONTH"},Rn=function(){return"DAY"},Fn=function(){return"HOUR"},Ln=function(){return"MINUTE"},kn=function(){return"SECOND"},Nn=function(){return"CASE"},On=function(){return"END"},Dn=function(){return"WHEN"},zn=function(){return"THEN"},Un=function(){return"ELSE"},Gn=function(e){return e},Bn=function(e){return e.join("")},Vn=0|t.peg$currPos,qn=Vn,Zn=[{line:1,column:1}],Hn=Vn,jn=t.peg$maxFailExpected||[],Wn=0|t.peg$silentFails;if(t.startRule){if(!(t.startRule in s))throw new Error("Can't start parsing from rule \""+t.startRule+'".');o=s[t.startRule]}function Yn(){return Kn(qn,Vn)}function $n(e,t){throw ts(e,t=void 0!==t?t:Kn(qn,Vn))}function Xn(e,t){return{type:"literal",text:e,ignoreCase:t}}function Qn(e,t,r){return{type:"class",parts:e,inverted:t,ignoreCase:r}}function Jn(t){var r,i=Zn[t];if(i)return i;if(t>=Zn.length)r=Zn.length-1;else for(r=t;!Zn[--r];);for(i={line:(i=Zn[r]).line,column:i.column};r<t;)10===e.charCodeAt(r)?(i.line++,i.column=1):i.column++,r++;return Zn[t]=i,i}function Kn(e,t,r){var i=Jn(e),s=Jn(t);return{source:n,start:{offset:e,line:i.line,column:i.column},end:{offset:t,line:s.line,column:s.column}}}function es(e){Vn<Hn||(Vn>Hn&&(Hn=Vn,jn=[]),jn.push(e))}function ts(e,t){return new $(e,null,null,t)}function rs(){var e,t;return e=Vn,zo(),(t=ns())!==i?(zo(),qn=e,e=Xt(t)):(Vn=e,e=i),e}function is(){var e,t,r,n,s,o;if(e=Vn,Oo()!==i){for(zo(),t=[],r=ns();r!==i;)t.push(r),r=Vn,n=Vn,s=zo(),(o=No())!==i?n=s=[s,o,zo()]:(Vn=n,n=i),n!==i&&(n=ns())===i?(Vn=r,r=i):r=n;r=zo(),(n=Do())!==i?(qn=e,e=Qt(t)):(Vn=e,e=i)}else Vn=e,e=i;return e}function ns(){var e,t,r,n,s,o;if(e=Vn,(t=ss())!==i){for(r=[],n=Vn,zo(),(s=Qs())!==i?(zo(),(o=ss())!==i?(qn=n,n=Jt(t,s,o)):(Vn=n,n=i)):(Vn=n,n=i);n!==i;)r.push(n),n=Vn,zo(),(s=Qs())!==i?(zo(),(o=ss())!==i?(qn=n,n=Jt(t,s,o)):(Vn=n,n=i)):(Vn=n,n=i);qn=e,e=Kt(t,r)}else Vn=e,e=i;return e}function ss(){var e,t,r,n,s,o;if(e=Vn,(t=os())!==i){for(r=[],n=Vn,zo(),(s=Xs())!==i?(zo(),(o=os())!==i?(qn=n,n=er(t,s,o)):(Vn=n,n=i)):(Vn=n,n=i);n!==i;)r.push(n),n=Vn,zo(),(s=Xs())!==i?(zo(),(o=os())!==i?(qn=n,n=er(t,s,o)):(Vn=n,n=i)):(Vn=n,n=i);qn=e,e=tr(t,r)}else Vn=e,e=i;return e}function os(){var t,r,n,s,o;return t=Vn,(r=$s())===i&&(r=Vn,33===e.charCodeAt(Vn)?(n=a,Vn++):(n=i,0===Wn&&es(Pe)),n!==i?(s=Vn,Wn++,61===e.charCodeAt(Vn)?(o=l,Vn++):(o=i,0===Wn&&es(Ce)),Wn--,o===i?s=void 0:(Vn=s,s=i),s!==i?r=n=[n,s]:(Vn=r,r=i)):(Vn=r,r=i)),r!==i?(n=zo(),(s=os())!==i?(qn=t,t=rr(s)):(Vn=t,t=i)):(Vn=t,t=i),t===i&&(t=function(){var e,t,r,n;return e=Vn,(t=us())!==i?(r=Vn,zo(),(n=function(){var e;return(e=function(){var e,t,r,n,s;if(e=Vn,t=[],r=Vn,zo(),(n=as())!==i?(zo(),(s=us())!==i?(qn=r,r=nr(n,s)):(Vn=r,r=i)):(Vn=r,r=i),r!==i)for(;r!==i;)t.push(r),r=Vn,zo(),(n=as())!==i?(zo(),(s=us())!==i?(qn=r,r=nr(n,s)):(Vn=r,r=i)):(Vn=r,r=i);else t=i;return t!==i&&(qn=e,t=sr(t)),t}())===i&&(e=function(){var e,t,r;return e=Vn,(t=cs())!==i?(zo(),(r=is())!==i?(qn=e,e=_r(t,r)):(Vn=e,e=i)):(Vn=e,e=i),e===i&&(e=Vn,(t=cs())!==i?(zo(),(r=vs())!==i?(qn=e,e=gr(t,r)):(Vn=e,e=i)):(Vn=e,e=i)),e}())===i&&(e=function(){var e,t,r,n,s,o,a,l;return e=Vn,(t=$s())!==i?(zo(),(r=Js())!==i?(n=zo(),s=Vn,(o=us())!==i?(zo(),(a=Xs())!==i?(zo(),(l=us())!==i?(qn=s,s=lr(r,o,l)):(Vn=s,s=i)):(Vn=s,s=i)):(Vn=s,s=i),s!==i?(qn=e,e=cr(r,s)):(Vn=e,e=i)):(Vn=e,e=i)):(Vn=e,e=i),e===i&&(e=Vn,(t=Js())!==i?(zo(),r=Vn,(n=us())!==i?(s=zo(),(o=Xs())!==i?(zo(),(a=us())!==i?(qn=r,r=ur(t,n,a)):(Vn=r,r=i)):(Vn=r,r=i)):(Vn=r,r=i),r!==i?(qn=e,e=hr(t,r)):(Vn=e,e=i)):(Vn=e,e=i)),e}())===i&&(e=function(){var e,t,r,n;return e=Vn,(t=js())!==i?(zo(),(r=$s())!==i?(zo(),(n=us())!==i?(qn=e,e=or(t,n)):(Vn=e,e=i)):(Vn=e,e=i)):(Vn=e,e=i),e===i&&(e=Vn,(t=js())!==i?(zo(),(r=us())!==i?(qn=e,e=ar(t,r)):(Vn=e,e=i)):(Vn=e,e=i)),e}())===i&&(e=function(){var e,t,r,n;return e=Vn,(t=ls())!==i?(zo(),(r=Rs())!==i?(zo(),Ys()!==i?(zo(),(n=Fs())!==i?(qn=e,e=pr(t,r,n)):(Vn=e,e=i)):(Vn=e,e=i)):(Vn=e,e=i)):(Vn=e,e=i),e===i&&(e=Vn,(t=ls())!==i?(zo(),(r=Rs())!==i?(qn=e,e=mr(t,r)):(Vn=e,e=i)):(Vn=e,e=i)),e}()),e}())!==i?r=n:(Vn=r,r=i),r===i&&(r=null),qn=e,e=ir(t,r)):(Vn=e,e=i),e}()),t}function as(){var t;return e.substr(Vn,2)===c?(t=c,Vn+=2):(t=i,0===Wn&&es(Re)),t===i&&(62===e.charCodeAt(Vn)?(t=u,Vn++):(t=i,0===Wn&&es(Fe)),t===i&&(e.substr(Vn,2)===h?(t=h,Vn+=2):(t=i,0===Wn&&es(Le)),t===i&&(e.substr(Vn,2)===d?(t=d,Vn+=2):(t=i,0===Wn&&es(ke)),t===i&&(t=e.charAt(Vn),ge.test(t)?Vn++:(t=i,0===Wn&&es(Ne)),t===i&&(e.substr(Vn,2)===f?(t=f,Vn+=2):(t=i,0===Wn&&es(Oe))))))),t}function ls(){var e,t,r,n,s;return e=Vn,t=Vn,(r=$s())!==i?(n=zo(),(s=Ws())!==i?t=r=[r,n,s]:(Vn=t,t=i)):(Vn=t,t=i),t!==i&&(qn=e,t=dr(t)),(e=t)===i&&(e=Ws()),e}function cs(){var e,t,r,n,s;return e=Vn,t=Vn,(r=$s())!==i?(n=zo(),(s=Hs())!==i?t=r=[r,n,s]:(Vn=t,t=i)):(Vn=t,t=i),t!==i&&(qn=e,t=fr(t)),(e=t)===i&&(e=Hs()),e}function us(){var e,t,r,n,s,o;if(e=Vn,(t=ds())!==i){for(r=[],n=Vn,zo(),(s=hs())!==i?(zo(),(o=ds())!==i?(qn=n,n=yr(t,s,o)):(Vn=n,n=i)):(Vn=n,n=i);n!==i;)r.push(n),n=Vn,zo(),(s=hs())!==i?(zo(),(o=ds())!==i?(qn=n,n=yr(t,s,o)):(Vn=n,n=i)):(Vn=n,n=i);qn=e,e=xr(t,r)}else Vn=e,e=i;return e}function hs(){var t;return t=e.charAt(Vn),ye.test(t)?Vn++:(t=i,0===Wn&&es(De)),t===i&&(e.substr(Vn,2)===p?(t=p,Vn+=2):(t=i,0===Wn&&es(ze))),t}function ds(){var e,t,r,n,s,o;if(e=Vn,(t=ps())!==i){for(r=[],n=Vn,zo(),(s=fs())!==i?(zo(),(o=ps())!==i?(qn=n,n=br(t,s,o)):(Vn=n,n=i)):(Vn=n,n=i);n!==i;)r.push(n),n=Vn,zo(),(s=fs())!==i?(zo(),(o=ps())!==i?(qn=n,n=br(t,s,o)):(Vn=n,n=i)):(Vn=n,n=i);qn=e,e=wr(t,r)}else Vn=e,e=i;return e}function fs(){var t;return t=e.charAt(Vn),xe.test(t)?Vn++:(t=i,0===Wn&&es(Ue)),t}function ps(){var e,t;return(e=function(){var e;return(e=Fs())===i&&(e=function(){var e,t,r,n;return e=Vn,(t=function(){var e,t,r,n;return e=Vn,(t=Os())!==i&&(r=Ds())!==i&&(n=zs())!==i?(qn=e,e=Bi(t,r,n)):(Vn=e,e=i),e===i&&(e=Vn,(t=Os())!==i&&(r=Ds())!==i?(qn=e,e=Vi(t,r)):(Vn=e,e=i),e===i&&(e=Vn,(t=Os())!==i&&(r=zs())!==i?(qn=e,e=qi(t,r)):(Vn=e,e=i),e===i&&(e=Vn,(t=Os())!==i&&(qn=e,t=Zi(t)),e=t))),e}())!==i?(r=Vn,Wn++,n=_s(),Wn--,n===i?r=void 0:(Vn=r,r=i),r!==i?(qn=e,e=Gi(t)):(Vn=e,e=i)):(Vn=e,e=i),e}())===i&&(e=function(){var e,t;return e=Vn,(t=qs())!==i&&(qn=e,t=Pi()),(e=t)===i&&(e=Vn,(t=Zs())!==i&&(qn=e,t=Ci()),e=t),e}())===i&&(e=function(){var e,t;return e=Vn,(t=Vs())!==i&&(qn=e,t=Ei()),t}())===i&&(e=function(){var e,t;return e=Vn,oo()!==i?(zo(),(t=Rs())!==i?(qn=e,e=Ai(t)):(Vn=e,e=i)):(Vn=e,e=i),e}())===i&&(e=function(){var e,t;return e=Vn,so()!==i?(zo(),(t=Rs())!==i?(qn=e,e=ni(t)):(Vn=e,e=i)):(Vn=e,e=i),e}())===i&&(e=Ms())===i&&(e=function(){var e,t;return e=Vn,ao()!==i?(zo(),(t=Rs())!==i?(qn=e,e=si(t)):(Vn=e,e=i)):(Vn=e,e=i),e}()),e}())===i&&(e=function(){var e,t,r,n;return e=Vn,ro()!==i?(zo(),t=Vn,Oo()!==i?(zo(),(r=Is())!==i?(zo(),Ks()!==i?(zo(),(n=ns())!==i?(zo(),Do()!==i?(qn=t,t=Fr(r,n)):(Vn=t,t=i)):(Vn=t,t=i)):(Vn=t,t=i)):(Vn=t,t=i)):(Vn=t,t=i),t===i&&(t=Vn,Oo()!==i?(zo(),(r=Is())!==i?(zo(),No()!==i?(zo(),(n=ns())!==i?(zo(),Do()!==i?(qn=t,t=Lr(r,n)):(Vn=t,t=i)):(Vn=t,t=i)):(Vn=t,t=i)):(Vn=t,t=i)):(Vn=t,t=i)),t!==i?(qn=e,e=kr(t)):(Vn=e,e=i)):(Vn=e,e=i),e}())===i&&(e=function(){var e,t,r,n,s,o,a;return e=Vn,to()!==i?(zo(),t=Vn,Oo()!==i?(zo(),(r=ns())!==i?(zo(),Ks()!==i?(zo(),(n=ns())!==i?(zo(),s=Vn,eo()!==i?(o=zo(),(a=ns())!==i?(zo(),s=a):(Vn=s,s=i)):(Vn=s,s=i),s===i&&(s=null),Do()!==i?(qn=t,t=Nr(r,n,s)):(Vn=t,t=i)):(Vn=t,t=i)):(Vn=t,t=i)):(Vn=t,t=i)):(Vn=t,t=i),t===i&&(t=Vn,Oo()!==i?(zo(),(r=ns())!==i?(zo(),No()!==i?(zo(),(n=ns())!==i?(zo(),(s=No())!==i?(zo(),(o=ns())!==i&&(a=Do())!==i?(qn=t,t=Or(r,n,o)):(Vn=t,t=i)):(Vn=t,t=i)):(Vn=t,t=i)):(Vn=t,t=i)):(Vn=t,t=i)):(Vn=t,t=i)),t!==i?(qn=e,e=Dr(t)):(Vn=e,e=i)):(Vn=e,e=i),e}())===i&&(e=function(){var e,t,r,n,s;return e=Vn,io()!==i?(zo(),t=Vn,Oo()!==i?(zo(),r=Ts(),zo(),(n=ns())!==i?(zo(),Ks()!==i?(zo(),(s=ns())!==i?(zo(),Do()!==i?(qn=t,t=$r(r,n,s)):(Vn=t,t=i)):(Vn=t,t=i)):(Vn=t,t=i)):(Vn=t,t=i)):(Vn=t,t=i),t===i&&(t=Vn,Oo()!==i?(zo(),r=Ts(),zo(),(n=ns())!==i?(zo(),Do()!==i?(qn=t,t=Xr(r,n)):(Vn=t,t=i)):(Vn=t,t=i)):(Vn=t,t=i)),t!==i?(qn=e,e=Qr(t)):(Vn=e,e=i)):(Vn=e,e=i),e}())===i&&(e=function(){var e,t,r,n;return e=Vn,no()!==i?(zo(),t=Vn,Oo()!==i?(zo(),(r=ns())!==i?(zo(),Hs()!==i?(zo(),(n=ns())!==i?(zo(),Do()!==i?(qn=t,t=Kr(r,n)):(Vn=t,t=i)):(Vn=t,t=i)):(Vn=t,t=i)):(Vn=t,t=i)):(Vn=t,t=i),t===i&&(t=Vn,Oo()!==i?(zo(),(r=ns())!==i?(zo(),No()!==i?(zo(),(n=ns())!==i?(zo(),Do()!==i?(qn=t,t=ei(r,n)):(Vn=t,t=i)):(Vn=t,t=i)):(Vn=t,t=i)):(Vn=t,t=i)):(Vn=t,t=i)),t!==i?(qn=e,e=ti(t)):(Vn=e,e=i)):(Vn=e,e=i),e}())===i&&(e=function(){var e,t,r,n;return e=Vn,ho()!==i?(zo(),t=Vn,Oo()!==i?(zo(),(r=ns())!==i?(zo(),fo()!==i?(zo(),(n=Ss())!==i?(zo(),Do()!==i?(qn=t,t=zr(r,n)):(Vn=t,t=i)):(Vn=t,t=i)):(Vn=t,t=i)):(Vn=t,t=i)):(Vn=t,t=i),t===i&&(t=Vn,Oo()!==i?(zo(),(r=ns())!==i?(zo(),No()!==i?(zo(),(n=Ss())!==i?(zo(),Do()!==i?(qn=t,t=Ur(r,n)):(Vn=t,t=i)):(Vn=t,t=i)):(Vn=t,t=i)):(Vn=t,t=i)):(Vn=t,t=i)),t!==i?(qn=e,e=Gr(t)):(Vn=e,e=i)):(Vn=e,e=i),e}())===i&&(e=function(){var e,t,r,n;return e=Vn,t=Vn,Wn++,r=ro(),Wn--,r===i?t=void 0:(Vn=t,t=i),t!==i&&(r=Go())!==i?(zo(),(n=is())!==i?(qn=e,e=ri(r,n)):(Vn=e,e=i)):(Vn=e,e=i),e}())===i&&(e=function(){var e;return(e=function(){var e,t,r,n,s;if(e=Vn,Co()!==i)if(zo(),(t=ns())!==i){for(zo(),r=[],n=Vn,(s=ks())!==i?(zo(),n=s):(Vn=n,n=i);n!==i;)r.push(n),n=Vn,(s=ks())!==i?(zo(),n=s):(Vn=n,n=i);(n=Ro())!==i?(qn=e,e=Li(t,r)):(Vn=e,e=i)}else Vn=e,e=i;else Vn=e,e=i;if(e===i)if(e=Vn,Co()!==i)if(zo(),(t=ns())!==i){for(zo(),r=[],n=Vn,(s=ks())!==i?(zo(),n=s):(Vn=n,n=i);n!==i;)r.push(n),n=Vn,(s=ks())!==i?(zo(),n=s):(Vn=n,n=i);(n=Ns())!==i?(s=zo(),Ro()!==i?(qn=e,e=ki(t,r,n)):(Vn=e,e=i)):(Vn=e,e=i)}else Vn=e,e=i;else Vn=e,e=i;return e}())===i&&(e=function(){var e,t,r,n;if(e=Vn,Co()!==i){for(zo(),t=[],r=Vn,(n=Ls())!==i?(zo(),r=n):(Vn=r,r=i);r!==i;)t.push(r),r=Vn,(n=Ls())!==i?(zo(),r=n):(Vn=r,r=i);(r=Ro())!==i?(qn=e,e=Ni(t)):(Vn=e,e=i)}else Vn=e,e=i;if(e===i)if(e=Vn,Co()!==i){for(zo(),t=[],r=Vn,(n=Ls())!==i?(zo(),r=n):(Vn=r,r=i);r!==i;)t.push(r),r=Vn,(n=Ls())!==i?(zo(),r=n):(Vn=r,r=i);(r=Ns())!==i?(n=zo(),Ro()!==i?(qn=e,e=Oi(t,r)):(Vn=e,e=i)):(Vn=e,e=i)}else Vn=e,e=i;return e}()),e}())===i&&(e=function(){var e,t;return e=Vn,(t=function(){var e,t;return e=Vn,(t=function(){var e,t,r,n;if(e=Vn,(t=_s())!==i){for(r=[],n=ys();n!==i;)r.push(n),n=ys();qn=e,e=Mr(t,r)}else Vn=e,e=i;return e}())!==i&&(qn=e,t=Ir(t)),t}())!==i&&(qn=e,t=Sr(t)),(e=t)===i&&(e=Vn,(t=function(){var e,t;return e=Vn,ws()!==i?(t=function(){var e,t,r;for(e=Vn,t=[],r=xs();r!==i;)t.push(r),r=xs();return qn=e,Pr(t)}(),ws()!==i?(qn=e,e=Er(t)):(Vn=e,e=i)):(Vn=e,e=i),e}())!==i&&(qn=e,t=Tr(t)),e=t),e}())===i&&(e=vs())===i&&(e=Vn,Oo()!==i?(zo(),(t=ns())!==i?(zo(),Do()!==i?(qn=e,e=vr(t)):(Vn=e,e=i)):(Vn=e,e=i)):(Vn=e,e=i)),e}function ms(){var e,t,r,n;if(e=Vn,(t=_s())!==i){for(r=[],n=gs();n!==i;)r.push(n),n=gs();qn=e,e=Ar(t,r)}else Vn=e,e=i;return e}function _s(){var t;return t=e.charAt(Vn),be.test(t)?Vn++:(t=i,0===Wn&&es(Ge)),t}function gs(){var t;return t=e.charAt(Vn),we.test(t)?Vn++:(t=i,0===Wn&&es(Be)),t}function ys(){var t;return t=e.charAt(Vn),ve.test(t)?Vn++:(t=i,0===Wn&&es(Ve)),t}function xs(){var e;return(e=bs())===i&&(e=function(){var e;return e=Vn,ws()!==i&&ws()!==i?(qn=e,e=Cr()):(Vn=e,e=i),e}()),e}function bs(){var t;return t=e.charAt(Vn),ve.test(t)?Vn++:(t=i,0===Wn&&es(Ve)),t}function ws(){var t;return t=e.charAt(Vn),Se.test(t)?Vn++:(t=i,0===Wn&&es(qe)),t}function vs(){var t,r,n,s;return t=Vn,r=Vn,64===e.charCodeAt(Vn)?(n=m,Vn++):(n=i,0===Wn&&es(Ze)),n!==i&&(s=ms())!==i?r=n=[n,s]:(Vn=r,r=i),r!==i&&(qn=t,r=Rr(r)),r}function Ss(){var e,t,r;return e=Vn,(t=po())===i&&(t=mo()),t!==i&&(qn=e,t=Br()),(e=t)===i&&(e=Vn,(t=_o())!==i&&(qn=e,t=Vr()),(e=t)===i&&(e=Vn,(t=go())!==i&&(qn=e,t=qr()),(e=t)===i&&(e=Vn,(t=yo())!==i&&(qn=e,t=Zr()),(e=t)===i&&(e=Vn,(t=oo())!==i&&(qn=e,t=Hr()),(e=t)===i&&(e=Vn,(t=so())!==i&&(qn=e,t=jr()),(e=t)===i&&(e=Vn,(t=ao())!==i&&(qn=e,t=Wr()),(e=t)===i&&(e=Vn,(t=xo())!==i?(zo(),Oo()!==i?(zo(),(r=Us())!==i?(zo(),Do()!==i?(qn=e,e=Yr(r)):(Vn=e,e=i)):(Vn=e,e=i)):(Vn=e,e=i)):(Vn=e,e=i)))))))),e}function Ts(){var e,t;return e=Vn,(t=lo())===i&&(t=co())===i&&(t=uo()),t===i&&(t=null),qn=e,Jr(t)}function Is(){var e,t;return e=Vn,(t=vo())===i&&(t=Io())===i&&(t=Mo())===i&&(t=Ao())===i&&(t=Eo())===i&&(t=Po())===i&&(t=So())===i&&(t=To()),t!==i&&(qn=e,t=ii(t)),t}function Ms(){var t,r,n,s;return t=Vn,wo()!==i?(zo(),r=e.charAt(Vn),ye.test(r)?Vn++:(r=i,0===Wn&&es(De)),r!==i?(zo(),(n=Rs())!==i?(zo(),(s=As())!==i?(qn=t,t=oi(r,n,s)):(Vn=t,t=i)):(Vn=t,t=i)):(Vn=t,t=i)):(Vn=t,t=i),t===i&&(t=Vn,wo()!==i?(zo(),(r=Rs())!==i?(zo(),(n=As())!==i?(qn=t,t=ai(r,n)):(Vn=t,t=i)):(Vn=t,t=i)):(Vn=t,t=i)),t}function As(){var e,t,r;return e=Vn,(t=function(){var e,t,r;return e=Vn,(t=Es())!==i?(zo(),Oo()!==i?(zo(),(r=Cs())!==i?(zo(),Do()!==i?(qn=e,e=ci(t,r)):(Vn=e,e=i)):(Vn=e,e=i)):(Vn=e,e=i)):(Vn=e,e=i),e===i&&(e=Vn,(t=Es())!==i&&(qn=e,t=ui(t)),e=t),e}())!==i?(zo(),bo()!==i?(zo(),(r=function(){var e,t,r,n;return e=Vn,(t=Es())!==i&&(qn=e,t=hi(t)),(e=t)===i&&(e=Vn,(t=Po())!==i?(zo(),Oo()!==i?(zo(),(r=Cs())!==i?(zo(),No()!==i?(zo(),(n=Ps())!==i?(zo(),Do()!==i?(qn=e,e=di(r,n)):(Vn=e,e=i)):(Vn=e,e=i)):(Vn=e,e=i)):(Vn=e,e=i)):(Vn=e,e=i)):(Vn=e,e=i),e===i&&(e=Vn,(t=Po())!==i?(zo(),Oo()!==i?(zo(),(r=Cs())!==i?(zo(),Do()!==i?(qn=e,e=fi(r)):(Vn=e,e=i)):(Vn=e,e=i)):(Vn=e,e=i)):(Vn=e,e=i),e===i&&(e=Vn,(t=Po())!==i&&(qn=e,t=pi()),e=t))),e}())!==i?(qn=e,e=li(t,r)):(Vn=e,e=i)):(Vn=e,e=i)):(Vn=e,e=i),e===i&&(e=function(){var e,t,r,n;return e=Vn,(t=Es())!==i?(zo(),Oo()!==i?(zo(),(r=Ps())!==i?(zo(),Do()!==i?(qn=e,e=mi(t,r)):(Vn=e,e=i)):(Vn=e,e=i)):(Vn=e,e=i)):(Vn=e,e=i),e===i&&(e=Vn,(t=Es())!==i&&(qn=e,t=_i(t)),(e=t)===i&&(e=Vn,(t=Po())!==i?(zo(),Oo()!==i?(zo(),(r=Cs())!==i?(zo(),No()!==i?(zo(),(n=Ps())!==i?(zo(),Do()!==i?(qn=e,e=gi(r,n)):(Vn=e,e=i)):(Vn=e,e=i)):(Vn=e,e=i)):(Vn=e,e=i)):(Vn=e,e=i)):(Vn=e,e=i),e===i&&(e=Vn,(t=Po())!==i?(zo(),Oo()!==i?(zo(),(r=Ps())!==i?(zo(),Do()!==i?(qn=e,e=yi(r)):(Vn=e,e=i)):(Vn=e,e=i)):(Vn=e,e=i)):(Vn=e,e=i),e===i&&(e=Vn,(t=Po())!==i&&(qn=e,t=xi()),e=t)))),e}()),e}function Es(){var e,t;return e=Vn,(t=Mo())!==i&&(qn=e,t=bi()),(e=t)===i&&(e=Vn,(t=Ao())!==i&&(qn=e,t=wi()),(e=t)===i&&(e=Vn,(t=Eo())!==i&&(qn=e,t=vi()),(e=t)===i&&(e=Vn,(t=Io())!==i&&(qn=e,t=Si()),(e=t)===i&&(e=Vn,(t=vo())!==i&&(qn=e,t=Ti()),e=t)))),e}function Ps(){var e,t;return e=Vn,(t=Us())!==i&&(qn=e,t=Ii(t)),t}function Cs(){var e,t;return e=Vn,(t=Us())!==i&&(qn=e,t=Mi(t)),t}function Rs(){var e;return(e=Fs())===i&&(e=vs()),e}function Fs(){var t,r,n,s,o;if(t=Vn,39===e.charCodeAt(Vn)?(r=_,Vn++):(r=i,0===Wn&&es(He)),r===i&&(e.substr(Vn,2)===g?(r=g,Vn+=2):(r=i,0===Wn&&es(je))),r!==i){for(n=[],s=Vn,e.substr(Vn,2)===y?(o=y,Vn+=2):(o=i,0===Wn&&es(We)),o!==i&&(qn=s,o=Ri()),(s=o)===i&&(s=e.charAt(Vn),Te.test(s)?Vn++:(s=i,0===Wn&&es(Ye)));s!==i;)n.push(s),s=Vn,e.substr(Vn,2)===y?(o=y,Vn+=2):(o=i,0===Wn&&es(We)),o!==i&&(qn=s,o=Ri()),(s=o)===i&&(s=e.charAt(Vn),Te.test(s)?Vn++:(s=i,0===Wn&&es(Ye)));39===e.charCodeAt(Vn)?(s=_,Vn++):(s=i,0===Wn&&es(He)),s!==i?(qn=t,t=Fi(n)):(Vn=t,t=i)}else Vn=t,t=i;return t}function Ls(){var e,t,r;return e=Vn,Fo()!==i?(zo(),(t=ns())!==i?(zo(),Lo()!==i?(zo(),(r=ns())!==i?(qn=e,e=Di(t,r)):(Vn=e,e=i)):(Vn=e,e=i)):(Vn=e,e=i)):(Vn=e,e=i),e}function ks(){var e,t,r;return e=Vn,Fo()!==i?(zo(),(t=ns())!==i?(zo(),Lo()!==i?(zo(),(r=ns())!==i?(qn=e,e=zi(t,r)):(Vn=e,e=i)):(Vn=e,e=i)):(Vn=e,e=i)):(Vn=e,e=i),e}function Ns(){var e,t;return e=Vn,ko()!==i?(zo(),(t=ns())!==i?(qn=e,e=Ui(t)):(Vn=e,e=i)):(Vn=e,e=i),e}function Os(){var t,r,n;return(t=Us())===i&&(t=Vn,r=e.charAt(Vn),ye.test(r)?Vn++:(r=i,0===Wn&&es(De)),r!==i&&(n=Us())!==i?(qn=t,t=Hi(r,n)):(Vn=t,t=i)),t}function Ds(){var t,r,n;return t=Vn,46===e.charCodeAt(Vn)?(r=x,Vn++):(r=i,0===Wn&&es($e)),r!==i?((n=Us())===i&&(n=null),qn=t,t=ji(n)):(Vn=t,t=i),t}function zs(){var e,t,r;return e=Vn,(t=Bs())!==i&&(r=Us())!==i?(qn=e,e=Wi(t,r)):(Vn=e,e=i),e}function Us(){var e,t,r;if(e=Vn,t=[],(r=Gs())!==i)for(;r!==i;)t.push(r),r=Gs();else t=i;return t!==i&&(qn=e,t=Yi(t)),t}function Gs(){var t;return t=e.charAt(Vn),Ie.test(t)?Vn++:(t=i,0===Wn&&es(Xe)),t}function Bs(){var t,r,n;return t=Vn,r=e.charAt(Vn),Me.test(r)?Vn++:(r=i,0===Wn&&es(Qe)),r!==i?(n=e.charAt(Vn),ye.test(n)?Vn++:(n=i,0===Wn&&es(De)),n===i&&(n=null),qn=t,t=$i(r,n)):(Vn=t,t=i),t}function Vs(){var t,r,n,s;return t=Vn,(r=e.substr(Vn,4)).toLowerCase()===b?Vn+=4:(r=i,0===Wn&&es(Je)),r!==i?(n=Vn,Wn++,s=gs(),Wn--,s===i?n=void 0:(Vn=n,n=i),n!==i?t=r=[r,n]:(Vn=t,t=i)):(Vn=t,t=i),t}function qs(){var t,r,n,s;return t=Vn,(r=e.substr(Vn,4)).toLowerCase()===w?Vn+=4:(r=i,0===Wn&&es(Ke)),r!==i?(n=Vn,Wn++,s=gs(),Wn--,s===i?n=void 0:(Vn=n,n=i),n!==i?t=r=[r,n]:(Vn=t,t=i)):(Vn=t,t=i),t}function Zs(){var t,r,n,s;return t=Vn,(r=e.substr(Vn,5)).toLowerCase()===v?Vn+=5:(r=i,0===Wn&&es(et)),r!==i?(n=Vn,Wn++,s=gs(),Wn--,s===i?n=void 0:(Vn=n,n=i),n!==i?t=r=[r,n]:(Vn=t,t=i)):(Vn=t,t=i),t}function Hs(){var t,r,n,s;return t=Vn,(r=e.substr(Vn,2)).toLowerCase()===S?Vn+=2:(r=i,0===Wn&&es(tt)),r!==i?(n=Vn,Wn++,s=gs(),Wn--,s===i?n=void 0:(Vn=n,n=i),n!==i?(qn=t,t=Xi()):(Vn=t,t=i)):(Vn=t,t=i),t}function js(){var t,r,n,s;return t=Vn,(r=e.substr(Vn,2)).toLowerCase()===T?Vn+=2:(r=i,0===Wn&&es(rt)),r!==i?(n=Vn,Wn++,s=gs(),Wn--,s===i?n=void 0:(Vn=n,n=i),n!==i?(qn=t,t=Qi()):(Vn=t,t=i)):(Vn=t,t=i),t}function Ws(){var t,r,n,s;return t=Vn,(r=e.substr(Vn,4)).toLowerCase()===I?Vn+=4:(r=i,0===Wn&&es(it)),r!==i?(n=Vn,Wn++,s=gs(),Wn--,s===i?n=void 0:(Vn=n,n=i),n!==i?(qn=t,t=Ji()):(Vn=t,t=i)):(Vn=t,t=i),t}function Ys(){var t,r,n,s;return t=Vn,(r=e.substr(Vn,6)).toLowerCase()===M?Vn+=6:(r=i,0===Wn&&es(nt)),r!==i?(n=Vn,Wn++,s=gs(),Wn--,s===i?n=void 0:(Vn=n,n=i),n!==i?(qn=t,t=Ki()):(Vn=t,t=i)):(Vn=t,t=i),t}function $s(){var t,r,n,s;return t=Vn,(r=e.substr(Vn,3)).toLowerCase()===A?Vn+=3:(r=i,0===Wn&&es(st)),r!==i?(n=Vn,Wn++,s=gs(),Wn--,s===i?n=void 0:(Vn=n,n=i),n!==i?(qn=t,t=en()):(Vn=t,t=i)):(Vn=t,t=i),t}function Xs(){var t,r,n,s;return t=Vn,(r=e.substr(Vn,3)).toLowerCase()===E?Vn+=3:(r=i,0===Wn&&es(ot)),r!==i?(n=Vn,Wn++,s=gs(),Wn--,s===i?n=void 0:(Vn=n,n=i),n!==i?(qn=t,t=tn()):(Vn=t,t=i)):(Vn=t,t=i),t}function Qs(){var t,r,n,s;return t=Vn,(r=e.substr(Vn,2)).toLowerCase()===P?Vn+=2:(r=i,0===Wn&&es(at)),r!==i?(n=Vn,Wn++,s=gs(),Wn--,s===i?n=void 0:(Vn=n,n=i),n!==i?(qn=t,t=rn()):(Vn=t,t=i)):(Vn=t,t=i),t}function Js(){var t,r,n,s;return t=Vn,(r=e.substr(Vn,7)).toLowerCase()===C?Vn+=7:(r=i,0===Wn&&es(lt)),r!==i?(n=Vn,Wn++,s=gs(),Wn--,s===i?n=void 0:(Vn=n,n=i),n!==i?(qn=t,t=nn()):(Vn=t,t=i)):(Vn=t,t=i),t}function Ks(){var t,r,n,s;return t=Vn,(r=e.substr(Vn,4)).toLowerCase()===R?Vn+=4:(r=i,0===Wn&&es(ct)),r!==i?(n=Vn,Wn++,s=gs(),Wn--,s===i?n=void 0:(Vn=n,n=i),n!==i?(qn=t,t=sn()):(Vn=t,t=i)):(Vn=t,t=i),t}function eo(){var t,r,n,s;return t=Vn,(r=e.substr(Vn,3)).toLowerCase()===F?Vn+=3:(r=i,0===Wn&&es(ut)),r!==i?(n=Vn,Wn++,s=gs(),Wn--,s===i?n=void 0:(Vn=n,n=i),n!==i?(qn=t,t=on()):(Vn=t,t=i)):(Vn=t,t=i),t}function to(){var t,r,n,s;return t=Vn,(r=e.substr(Vn,9)).toLowerCase()===L?Vn+=9:(r=i,0===Wn&&es(ht)),r!==i?(n=Vn,Wn++,s=gs(),Wn--,s===i?n=void 0:(Vn=n,n=i),n!==i?(qn=t,t=an()):(Vn=t,t=i)):(Vn=t,t=i),t}function ro(){var t,r,n,s;return t=Vn,(r=e.substr(Vn,7)).toLowerCase()===k?Vn+=7:(r=i,0===Wn&&es(dt)),r!==i?(n=Vn,Wn++,s=gs(),Wn--,s===i?n=void 0:(Vn=n,n=i),n!==i?(qn=t,t=ln()):(Vn=t,t=i)):(Vn=t,t=i),t}function io(){var t,r,n,s;return t=Vn,(r=e.substr(Vn,4)).toLowerCase()===N?Vn+=4:(r=i,0===Wn&&es(ft)),r!==i?(n=Vn,Wn++,s=gs(),Wn--,s===i?n=void 0:(Vn=n,n=i),n!==i?(qn=t,t=cn()):(Vn=t,t=i)):(Vn=t,t=i),t}function no(){var t,r,n,s;return t=Vn,(r=e.substr(Vn,8)).toLowerCase()===O?Vn+=8:(r=i,0===Wn&&es(pt)),r!==i?(n=Vn,Wn++,s=gs(),Wn--,s===i?n=void 0:(Vn=n,n=i),n!==i?(qn=t,t=un()):(Vn=t,t=i)):(Vn=t,t=i),t}function so(){var t,r,n,s;return t=Vn,(r=e.substr(Vn,9)).toLowerCase()===D?Vn+=9:(r=i,0===Wn&&es(mt)),r!==i?(n=Vn,Wn++,s=gs(),Wn--,s===i?n=void 0:(Vn=n,n=i),n!==i?(qn=t,t=hn()):(Vn=t,t=i)):(Vn=t,t=i),t}function oo(){var t,r,n,s;return t=Vn,(r=e.substr(Vn,4)).toLowerCase()===z?Vn+=4:(r=i,0===Wn&&es(_t)),r!==i?(n=Vn,Wn++,s=gs(),Wn--,s===i?n=void 0:(Vn=n,n=i),n!==i?(qn=t,t=dn()):(Vn=t,t=i)):(Vn=t,t=i),t}function ao(){var t,r,n,s;return t=Vn,(r=e.substr(Vn,4)).toLowerCase()===U?Vn+=4:(r=i,0===Wn&&es(gt)),r!==i?(n=Vn,Wn++,s=gs(),Wn--,s===i?n=void 0:(Vn=n,n=i),n!==i?(qn=t,t=fn()):(Vn=t,t=i)):(Vn=t,t=i),t}function lo(){var t,r,n,s;return t=Vn,(r=e.substr(Vn,7)).toLowerCase()===G?Vn+=7:(r=i,0===Wn&&es(yt)),r!==i?(n=Vn,Wn++,s=gs(),Wn--,s===i?n=void 0:(Vn=n,n=i),n!==i?(qn=t,t=pn()):(Vn=t,t=i)):(Vn=t,t=i),t}function co(){var t,r,n,s;return t=Vn,(r=e.substr(Vn,8)).toLowerCase()===B?Vn+=8:(r=i,0===Wn&&es(xt)),r!==i?(n=Vn,Wn++,s=gs(),Wn--,s===i?n=void 0:(Vn=n,n=i),n!==i?(qn=t,t=mn()):(Vn=t,t=i)):(Vn=t,t=i),t}function uo(){var t,r,n,s;return t=Vn,(r=e.substr(Vn,4)).toLowerCase()===V?Vn+=4:(r=i,0===Wn&&es(bt)),r!==i?(n=Vn,Wn++,s=gs(),Wn--,s===i?n=void 0:(Vn=n,n=i),n!==i?(qn=t,t=_n()):(Vn=t,t=i)):(Vn=t,t=i),t}function ho(){var t,r,n,s;return t=Vn,(r=e.substr(Vn,4)).toLowerCase()===q?Vn+=4:(r=i,0===Wn&&es(wt)),r!==i?(n=Vn,Wn++,s=gs(),Wn--,s===i?n=void 0:(Vn=n,n=i),n!==i?(qn=t,t=gn()):(Vn=t,t=i)):(Vn=t,t=i),t}function fo(){var t,r,n,s;return t=Vn,(r=e.substr(Vn,2)).toLowerCase()===Z?Vn+=2:(r=i,0===Wn&&es(vt)),r!==i?(n=Vn,Wn++,s=gs(),Wn--,s===i?n=void 0:(Vn=n,n=i),n!==i?(qn=t,t=yn()):(Vn=t,t=i)):(Vn=t,t=i),t}function po(){var t,r,n,s;return t=Vn,(r=e.substr(Vn,7)).toLowerCase()===H?Vn+=7:(r=i,0===Wn&&es(St)),r!==i?(n=Vn,Wn++,s=gs(),Wn--,s===i?n=void 0:(Vn=n,n=i),n!==i?(qn=t,t=xn()):(Vn=t,t=i)):(Vn=t,t=i),t}function mo(){var t,r,n,s;return t=Vn,(r=e.substr(Vn,3)).toLowerCase()===j?Vn+=3:(r=i,0===Wn&&es(Tt)),r!==i?(n=Vn,Wn++,s=gs(),Wn--,s===i?n=void 0:(Vn=n,n=i),n!==i?(qn=t,t=bn()):(Vn=t,t=i)):(Vn=t,t=i),t}function _o(){var t,r,n,s;return t=Vn,(r=e.substr(Vn,8)).toLowerCase()===W?Vn+=8:(r=i,0===Wn&&es(It)),r!==i?(n=Vn,Wn++,s=gs(),Wn--,s===i?n=void 0:(Vn=n,n=i),n!==i?(qn=t,t=wn()):(Vn=t,t=i)):(Vn=t,t=i),t}function go(){var t,r,n,s;return t=Vn,(r=e.substr(Vn,5)).toLowerCase()===Y?Vn+=5:(r=i,0===Wn&&es(Mt)),r!==i?(n=Vn,Wn++,s=gs(),Wn--,s===i?n=void 0:(Vn=n,n=i),n!==i?(qn=t,t=vn()):(Vn=t,t=i)):(Vn=t,t=i),t}function yo(){var t,r,n,s;return t=Vn,(r=e.substr(Vn,4)).toLowerCase()===X?Vn+=4:(r=i,0===Wn&&es(At)),r!==i?(n=Vn,Wn++,s=gs(),Wn--,s===i?n=void 0:(Vn=n,n=i),n!==i?(qn=t,t=Sn()):(Vn=t,t=i)):(Vn=t,t=i),t}function xo(){var t,r,n,s;return t=Vn,(r=e.substr(Vn,7)).toLowerCase()===Q?Vn+=7:(r=i,0===Wn&&es(Et)),r!==i?(n=Vn,Wn++,s=gs(),Wn--,s===i?n=void 0:(Vn=n,n=i),n!==i?(qn=t,t=Tn()):(Vn=t,t=i)):(Vn=t,t=i),t}function bo(){var t,r,n,s;return t=Vn,(r=e.substr(Vn,2)).toLowerCase()===J?Vn+=2:(r=i,0===Wn&&es(Pt)),r!==i?(n=Vn,Wn++,s=gs(),Wn--,s===i?n=void 0:(Vn=n,n=i),n!==i?(qn=t,t=In()):(Vn=t,t=i)):(Vn=t,t=i),t}function wo(){var t,r,n,s;return t=Vn,(r=e.substr(Vn,8)).toLowerCase()===K?Vn+=8:(r=i,0===Wn&&es(Ct)),r!==i?(n=Vn,Wn++,s=gs(),Wn--,s===i?n=void 0:(Vn=n,n=i),n!==i?(qn=t,t=Mn()):(Vn=t,t=i)):(Vn=t,t=i),t}function vo(){var t,r,n,s;return t=Vn,(r=e.substr(Vn,4)).toLowerCase()===ee?Vn+=4:(r=i,0===Wn&&es(Rt)),r!==i?(n=Vn,Wn++,s=gs(),Wn--,s===i?n=void 0:(Vn=n,n=i),n!==i?(qn=t,t=An()):(Vn=t,t=i)):(Vn=t,t=i),t}function So(){var t,r,n,s;return t=Vn,(r=e.substr(Vn,13)).toLowerCase()===te?Vn+=13:(r=i,0===Wn&&es(Ft)),r!==i?(n=Vn,Wn++,s=gs(),Wn--,s===i?n=void 0:(Vn=n,n=i),n!==i?(qn=t,t=En()):(Vn=t,t=i)):(Vn=t,t=i),t}function To(){var t,r,n,s;return t=Vn,(r=e.substr(Vn,15)).toLowerCase()===re?Vn+=15:(r=i,0===Wn&&es(Lt)),r!==i?(n=Vn,Wn++,s=gs(),Wn--,s===i?n=void 0:(Vn=n,n=i),n!==i?(qn=t,t=Pn()):(Vn=t,t=i)):(Vn=t,t=i),t}function Io(){var t,r,n,s;return t=Vn,(r=e.substr(Vn,5)).toLowerCase()===ie?Vn+=5:(r=i,0===Wn&&es(kt)),r!==i?(n=Vn,Wn++,s=gs(),Wn--,s===i?n=void 0:(Vn=n,n=i),n!==i?(qn=t,t=Cn()):(Vn=t,t=i)):(Vn=t,t=i),t}function Mo(){var t,r,n,s;return t=Vn,(r=e.substr(Vn,3)).toLowerCase()===ne?Vn+=3:(r=i,0===Wn&&es(Nt)),r!==i?(n=Vn,Wn++,s=gs(),Wn--,s===i?n=void 0:(Vn=n,n=i),n!==i?(qn=t,t=Rn()):(Vn=t,t=i)):(Vn=t,t=i),t}function Ao(){var t,r,n,s;return t=Vn,(r=e.substr(Vn,4)).toLowerCase()===se?Vn+=4:(r=i,0===Wn&&es(Ot)),r!==i?(n=Vn,Wn++,s=gs(),Wn--,s===i?n=void 0:(Vn=n,n=i),n!==i?(qn=t,t=Fn()):(Vn=t,t=i)):(Vn=t,t=i),t}function Eo(){var t,r,n,s;return t=Vn,(r=e.substr(Vn,6)).toLowerCase()===oe?Vn+=6:(r=i,0===Wn&&es(Dt)),r!==i?(n=Vn,Wn++,s=gs(),Wn--,s===i?n=void 0:(Vn=n,n=i),n!==i?(qn=t,t=Ln()):(Vn=t,t=i)):(Vn=t,t=i),t}function Po(){var t,r,n,s;return t=Vn,(r=e.substr(Vn,6)).toLowerCase()===ae?Vn+=6:(r=i,0===Wn&&es(zt)),r!==i?(n=Vn,Wn++,s=gs(),Wn--,s===i?n=void 0:(Vn=n,n=i),n!==i?(qn=t,t=kn()):(Vn=t,t=i)):(Vn=t,t=i),t}function Co(){var t,r,n,s;return t=Vn,(r=e.substr(Vn,4)).toLowerCase()===le?Vn+=4:(r=i,0===Wn&&es(Ut)),r!==i?(n=Vn,Wn++,s=gs(),Wn--,s===i?n=void 0:(Vn=n,n=i),n!==i?(qn=t,t=Nn()):(Vn=t,t=i)):(Vn=t,t=i),t}function Ro(){var t,r,n,s;return t=Vn,(r=e.substr(Vn,3)).toLowerCase()===ce?Vn+=3:(r=i,0===Wn&&es(Gt)),r!==i?(n=Vn,Wn++,s=gs(),Wn--,s===i?n=void 0:(Vn=n,n=i),n!==i?(qn=t,t=On()):(Vn=t,t=i)):(Vn=t,t=i),t}function Fo(){var t,r,n,s;return t=Vn,(r=e.substr(Vn,4)).toLowerCase()===ue?Vn+=4:(r=i,0===Wn&&es(Bt)),r!==i?(n=Vn,Wn++,s=gs(),Wn--,s===i?n=void 0:(Vn=n,n=i),n!==i?(qn=t,t=Dn()):(Vn=t,t=i)):(Vn=t,t=i),t}function Lo(){var t,r,n,s;return t=Vn,(r=e.substr(Vn,4)).toLowerCase()===he?Vn+=4:(r=i,0===Wn&&es(Vt)),r!==i?(n=Vn,Wn++,s=gs(),Wn--,s===i?n=void 0:(Vn=n,n=i),n!==i?(qn=t,t=zn()):(Vn=t,t=i)):(Vn=t,t=i),t}function ko(){var t,r,n,s;return t=Vn,(r=e.substr(Vn,4)).toLowerCase()===de?Vn+=4:(r=i,0===Wn&&es(qt)),r!==i?(n=Vn,Wn++,s=gs(),Wn--,s===i?n=void 0:(Vn=n,n=i),n!==i?(qn=t,t=Un()):(Vn=t,t=i)):(Vn=t,t=i),t}function No(){var t;return 44===e.charCodeAt(Vn)?(t=fe,Vn++):(t=i,0===Wn&&es(Zt)),t}function Oo(){var t;return 40===e.charCodeAt(Vn)?(t=pe,Vn++):(t=i,0===Wn&&es(Ht)),t}function Do(){var t;return 41===e.charCodeAt(Vn)?(t=me,Vn++):(t=i,0===Wn&&es(jt)),t}function zo(){var e,t;for(e=[],t=Uo();t!==i;)e.push(t),t=Uo();return e}function Uo(){var t;return t=e.charAt(Vn),Ae.test(t)?Vn++:(t=i,0===Wn&&es(Wt)),t}function Go(){var t,r,n,s;if(t=Vn,(r=ms())!==i&&(qn=t,r=Gn(r)),(t=r)===i)if(t=Vn,96===e.charCodeAt(Vn)?(r=_e,Vn++):(r=i,0===Wn&&es(Yt)),r!==i){if(n=[],s=e.charAt(Vn),Ee.test(s)?Vn++:(s=i,0===Wn&&es($t)),s!==i)for(;s!==i;)n.push(s),s=e.charAt(Vn),Ee.test(s)?Vn++:(s=i,0===Wn&&es($t));else n=i;n!==i?(96===e.charCodeAt(Vn)?(s=_e,Vn++):(s=i,0===Wn&&es(Yt)),s!==i?(qn=t,t=Bn(n)):(Vn=t,t=i)):(Vn=t,t=i)}else Vn=t,t=i;return t}function Bo(e,t,r,i,n){const s={type:"binary-expression",location:n,operator:e,left:t,right:r};return void 0!==i&&(s.escape=i),s}function Vo(e,...t){return{type:"expression-list",location:e,value:t}}function qo(e,t){let r=e;for(const{op:e,expr:i,location:{end:n}}of t)r=Bo(e,r,i,void 0,{...r.location,end:n});return r}if(r=o(),t.peg$library)return{peg$result:r,peg$currPos:Vn,peg$FAILED:i,peg$maxFailExpected:jn,peg$maxFailPos:Hn};if(r!==i&&Vn===e.length)return r;throw r!==i&&Vn<e.length&&es({type:"end"}),function(e,t,r){return new $($.buildMessage(e,t),e,t,r)}(jn,Hn<e.length?e.charAt(Hn):null,Hn<e.length?Kn(Hn,Hn+1):Kn(Hn,Hn))}(e)}}function J(e,t){if(null!=e)switch(t(e),e.type){case"when-clause":J(e.operand,t),J(e.value,t);break;case"case-expression":for(const r of e.clauses)J(r,t);"simple"===e.format&&J(e.operand,t),null!==e.else&&J(e.else,t);break;case"expression-list":for(const r of e.value)J(r,t);break;case"unary-expression":J(e.expr,t);break;case"binary-expression":J(e.left,t),J(e.right,t);break;case"function":J(e.args,t);break;case"interval":J(e.value,t),J(e.qualifier,t);break;case"interval-qualifier":J(e.start,t),J(e.end,t)}}const K=new Set(["current_timestamp","current_date","current_time"]);class ee{static makeBool(e){return re(e)}static featureValue(e,t,r,i){return he(e,t,r,i)}static equalsNull(e){return null===e}static applyLike(e,t,r){return ue(e,t,r)}static ensureArray(e){return ie(e)}static applyIn(e,t,r){return ae(e,t)}static currentTimestamp(e){return w(new Date,e)}static currentDate(e){return o.n.fromNow(e)}static currentTime(e){const t=w(new Date,e);return u.k.fromDateTime(t)}static makeSqlInterval(e,t,r){return l.createFromValueAndQualifier(e,t,r)}static convertInterval(e){return e instanceof l?e.valueInMilliseconds():e}static compare(e,t,r,i){return z(t,r,e)}static calculate(e,t,r,i){return W(e,t,r,i)}static evaluateTime(e){return C(e)}static evaluateTimestamp(e,t,r){return R(e,t,r)}static evaluateDate(e,t){return F(e,t)}static evaluateFunction(e,t,r){return V(e,t,r)}static lookup(e,t){const r=t[e];return void 0===r?null:r}static between(e,t,r){return null==e||null==t[0]||null==t[1]?null:z(e,t[0],">=")&&z(e,t[1],"<=")}static notbetween(e,t,r){return null==e||null==t[0]||null==t[1]?null:z(e,t[0],"<")||z(e,t[1],">")}static ternaryNot(e){return ne(e)}static ternaryAnd(e,t){return se(e,t)}static ternaryOr(e,t){return oe(e,t)}}class te{constructor(e,t,r="UTC",i=null){this.fieldsIndex=t,this.timeZone=r,this.currentUser=i,this.parameters={},this._hasDateFunctions=void 0,this.parseTree=Q.parse(e);const{isStandardized:n,isAggregate:s,currentUserRequired:o,referencedFieldNames:a}=this._extractExpressionInfo(t);this._referencedFieldNames=a,this.isStandardized=n,this.isAggregate=s,this.currentUserRequired=o}static convertValueToStorageFormat(e,t=null){if(null===t)return I(e)?e.getTime():M(e)?e.toMillis():P(e)?e.toStorageFormat():E(e)?e.toStorageString():A(e)?e.toStorageFormat():e;switch(t){case"date":return I(e)?e.getTime():M(e)?e.toMillis():P(e)?e.toMilliseconds():A(e)?e.toNumber():e;case"date-only":return I(e)?o.n.fromDateJS(e).toString():P(e)?o.n.fromSqlTimeStampOffset(e).toString():M(e)?o.n.fromDateTime(e).toString():e;case"time-only":return I(e)?u.k.fromDateJS(e).toStorageString():M(e)?u.k.fromDateTime(e).toStorageString():P(e)?u.k.fromSqlTimeStampOffset(e).toStorageString():E(e)?e.toStorageString():e;case"timestamp-offset":if(I(e))return c.g.fromJSDate(e).toStorageFormat();if(M(e))return c.g.fromDateTime(e).toStorageFormat();if(P(e))return e.toStorageFormat()}return e}static create(e,t={}){return new te(e,t.fieldsIndex,t.timeZone??void 0,t.currentUser)}get fieldNames(){return this._referencedFieldNames}testSet(e,t=de,r=this.currentUser){return!!this._evaluateNode(this.parseTree,null,t,e,r)}calculateValue(e,t=de,r=this.currentUser){const i=this._evaluateNode(this.parseTree,e,t,null,r);return i instanceof l?i.valueInMilliseconds()/864e5:i}calculateValueCompiled(e,t=de,r=this.currentUser){return null!=this.parseTree._compiledVersion?this.parseTree._compiledVersion(e,this.parameters,t,this.fieldsIndex,this.timeZone,r??null):(0,n.A)("esri-csp-restrictions")?this.calculateValue(e,t):(this._compileMe(),this.parseTree._compiledVersion(e,this.parameters,t,this.fieldsIndex,this.timeZone,r??null))}testFeature(e,t=de,r=this.currentUser){return!!this._evaluateNode(this.parseTree,e,t,null,r)}testFeatureCompiled(e,t=de,r=this.currentUser){return null!=this.parseTree._compiledVersion?!!this.parseTree._compiledVersion(e,this.parameters,t,this.fieldsIndex,this.timeZone,r??null):(0,n.A)("esri-csp-restrictions")?this.testFeature(e,t):(this._compileMe(),!!this.parseTree._compiledVersion(e,this.parameters,t,this.fieldsIndex,this.timeZone,r??null))}get hasDateFunctions(){return null!=this._hasDateFunctions||(this._hasDateFunctions=!1,J(this.parseTree,(e=>{"current-time"===e.type?this._hasDateFunctions=!0:"function"===e.type&&(this._hasDateFunctions=this._hasDateFunctions||K.has(e.name.toLowerCase()))}))),this._hasDateFunctions}getFunctions(){const e=new Set;return J(this.parseTree,(t=>{"function"===t.type&&e.add(t.name.toLowerCase())})),Array.from(e)}getExpressions(){const e=new Map;return J(this.parseTree,(t=>{if("function"===t.type){const r=t.name.toLowerCase(),i=t.args.value[0];if("column-reference"===i.type){const t=i.column,n=`${r}-${t}`;e.has(n)||e.set(n,{aggregateType:r,field:t})}}})),[...e.values()]}getVariables(){const e=new Set;return J(this.parseTree,(t=>{"parameter"===t.type&&e.add(t.value.toLowerCase())})),Array.from(e)}_compileMe(){const e="return this.convertInterval("+this.evaluateNodeToJavaScript(this.parseTree)+")";this.parseTree._compiledVersion=new Function("feature","lookups","attributeAdapter","fieldsIndex","timeZone","currentUser",e).bind(ee)}_extractExpressionInfo(e){const t=[],r=new Set;let i=!0,n=!1,o=!1;return J(this.parseTree,(a=>{switch(a.type){case"column-reference":{const i=e?.get(a.column);let n,s;i?n=s=i.name??"":(s=a.column,n=s.toLowerCase()),r.has(n)||(r.add(n),t.push(s)),a.column=s;break}case"current-user":o=!0;break;case"function":{const{name:e,args:t}=a,r=t.value.length;i&&(i=function(e,t){const r=j[e.toLowerCase()];return null!=r&&t>=r.minParams&&t<=r.maxParams}(e,r)),!1===n&&(n=(0,s.M)(e,r));break}}})),{referencedFieldNames:Array.from(t),isStandardized:i,isAggregate:n,currentUserRequired:o}}evaluateNodeToJavaScript(e){switch(e.type){case"interval":return"this.makeSqlInterval("+this.evaluateNodeToJavaScript(e.value)+", "+JSON.stringify(e.qualifier)+","+JSON.stringify(e.op)+")";case"case-expression":{let t="";if("simple"===e.format){const r=this.evaluateNodeToJavaScript(e.operand);t="( ";for(let i=0;i<e.clauses.length;i++)t+=" (this.compare('=',"+r+","+this.evaluateNodeToJavaScript(e.clauses[i].operand)+") ? ("+this.evaluateNodeToJavaScript(e.clauses[i].value)+") : ";null!==e.else?t+=this.evaluateNodeToJavaScript(e.else):t+="null",t+=" )"}else{t="( ";for(let r=0;r<e.clauses.length;r++)t+=" this.makeBool("+this.evaluateNodeToJavaScript(e.clauses[r].operand)+")===true ? ("+this.evaluateNodeToJavaScript(e.clauses[r].value)+") : ";null!==e.else?t+=this.evaluateNodeToJavaScript(e.else):t+="null",t+=" )"}return t}case"parameter":return"this.lookup("+JSON.stringify(e.value.toLowerCase())+",lookups)";case"expression-list":{let t="[";for(const r of e.value)"["!==t&&(t+=","),t+=this.evaluateNodeToJavaScript(r);return t+="]",t}case"unary-expression":return"this.ternaryNot("+this.evaluateNodeToJavaScript(e.expr)+")";case"binary-expression":switch(e.operator){case"AND":return"this.ternaryAnd("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+" )";case"OR":return"this.ternaryOr("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+" )";case"IS":if("null"!==e.right.type)throw new a.L8(a.Z7.UnsupportedIsRhs);return"this.equalsNull("+this.evaluateNodeToJavaScript(e.left)+")";case"ISNOT":if("null"!==e.right.type)throw new a.L8(a.Z7.UnsupportedIsRhs);return"(!(this.equalsNull("+this.evaluateNodeToJavaScript(e.left)+")))";case"IN":return"this.applyIn("+this.evaluateNodeToJavaScript(e.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(e.right)+"), timeZone)";case"NOT IN":return"this.ternaryNot(this.applyIn("+this.evaluateNodeToJavaScript(e.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(e.right)+"), timeZone))";case"BETWEEN":return"this.between("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+", timeZone)";case"NOTBETWEEN":return"this.notbetween("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+", timeZone)";case"LIKE":return"this.applyLike("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+","+JSON.stringify(e.escape)+")";case"NOT LIKE":return"this.ternaryNot(this.applyLike("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+","+JSON.stringify(e.escape)+"))";case"<>":case"<":case">":case">=":case"<=":case"=":return"this.compare("+JSON.stringify(e.operator)+","+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+", timeZone)";case"*":case"-":case"+":case"/":case"||":return"this.calculate("+JSON.stringify(e.operator)+","+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+", timeZone)";default:throw new a.L8(a.Z7.UnsupportedOperator,{operator:e.operator})}case"null":case"boolean":case"string":case"number":return JSON.stringify(e.value);case"time":return"this.evaluateTime("+JSON.stringify(e.value)+")";case"date":return"this.evaluateDate("+JSON.stringify(e.value)+", 'unknown')";case"timestamp":return"this.evaluateTimestamp("+JSON.stringify(e.value)+", 'unknown')";case"current-time":return"date"===e.mode?"this.currentDate(timeZone)":"time"===e.mode?"this.currentTime(timeZone)":"this.currentTimestamp(timeZone)";case"current-user":return"currentUser";case"column-reference":return"this.featureValue(feature,"+JSON.stringify(e.column)+",fieldsIndex,attributeAdapter)";case"function":return"this.evaluateFunction("+JSON.stringify(e.name)+","+this.evaluateNodeToJavaScript(e.args)+", timeZone)"}throw new a.L8(a.Z7.UnsupportedSyntax,{node:e.type})}_evaluateNode(e,t,r,n,o){let c;switch(e.type){case"interval":{const i=this._evaluateNode(e.value,t,r,n,o);return l.createFromValueAndQualifier(i,e.qualifier,e.op)}case"case-expression":if("simple"===e.format){const i=this._evaluateNode(e.operand,t,r,n,o);for(let s=0;s<e.clauses.length;s++)if(z(i,this._evaluateNode(e.clauses[s].operand,t,r,n,o),"=",this.timeZone))return this._evaluateNode(e.clauses[s].value,t,r,n,o);if(null!==e.else)return this._evaluateNode(e.else,t,r,n,o)}else{for(let i=0;i<e.clauses.length;i++)if(re(this._evaluateNode(e.clauses[i].operand,t,r,n,o)))return this._evaluateNode(e.clauses[i].value,t,r,n,o);if(null!==e.else)return this._evaluateNode(e.else,t,r,n,o)}return null;case"parameter":return c=this.parameters[e.value.toLowerCase()],I(c)?d.c9.fromJSDate(c):c instanceof i.lY?c.toDateTime():c;case"expression-list":{const i=[];for(const s of e.value)i.push(this._evaluateNode(s,t,r,n,o));return i}case"unary-expression":return ne(this._evaluateNode(e.expr,t,r,n,o));case"binary-expression":switch(e.operator){case"AND":return se(this._evaluateNode(e.left,t,r,n,o),this._evaluateNode(e.right,t,r,n,o));case"OR":return oe(this._evaluateNode(e.left,t,r,n,o),this._evaluateNode(e.right,t,r,n,o));case"IS":if("null"!==e.right.type)throw new a.L8(a.Z7.UnsupportedIsRhs);return null===this._evaluateNode(e.left,t,r,n,o);case"ISNOT":if("null"!==e.right.type)throw new a.L8(a.Z7.UnsupportedIsRhs);return null!==this._evaluateNode(e.left,t,r,n,o);case"IN":{const i=ie(this._evaluateNode(e.right,t,r,n,o));return ae(this._evaluateNode(e.left,t,r,n,o),i,this.timeZone)}case"NOT IN":{const i=ie(this._evaluateNode(e.right,t,r,n,o));return ne(ae(this._evaluateNode(e.left,t,r,n,o),i,this.timeZone))}case"BETWEEN":{const i=this._evaluateNode(e.left,t,r,n,o),s=this._evaluateNode(e.right,t,r,n,o);return null==i||null==s[0]||null==s[1]?null:z(i,s[0],">=",this.timeZone)&&z(i,s[1],"<=",this.timeZone)}case"NOTBETWEEN":{const i=this._evaluateNode(e.left,t,r,n,o),s=this._evaluateNode(e.right,t,r,n,o);return null==i||null==s[0]||null==s[1]?null:z(i,s[0],"<",this.timeZone)||z(i,s[1],">",this.timeZone)}case"LIKE":return ue(this._evaluateNode(e.left,t,r,n,o),this._evaluateNode(e.right,t,r,n,o),e.escape);case"NOT LIKE":return ne(ue(this._evaluateNode(e.left,t,r,n,o),this._evaluateNode(e.right,t,r,n,o),e.escape));case"<>":case"<":case">":case">=":case"<=":case"=":return z(this._evaluateNode(e.left,t,r,n,o),this._evaluateNode(e.right,t,r,n,o),e.operator,this.timeZone);case"-":case"+":case"*":case"/":case"||":return W(e.operator,this._evaluateNode(e.left,t,r,n,o),this._evaluateNode(e.right,t,r,n,o),this.timeZone)}case"null":case"boolean":case"string":case"number":return e.value;case"date":return e.parsedValue??=F(e.value,"unknown"),e.parsedValue;case"timestamp":return e.parsedValue??=R(e.value,"unknown"),e.parsedValue;case"time":return C(e.value);case"current-time":return"date"===e.mode?ee.currentDate(this.timeZone):"time"===e.mode?ee.currentTime(this.timeZone):ee.currentTimestamp(this.timeZone);case"current-user":return o??null;case"column-reference":return he(t,e.column,this.fieldsIndex,r);case"data-type":return e.value;case"function":{if(this.isAggregate&&(0,s.M)(e.name,e.args.value.length)){const t=[];for(const i of e.args?.value||[]){const e=[];for(const t of n||[])e.push(this._evaluateNode(i,t,r,null,o));t.push(e)}return(0,s.s)(e.name,t)}const i=this._evaluateNode(e.args,t,r,n,o);return V(e.name,i,this.timeZone)}}throw new a.L8(a.Z7.UnsupportedSyntax,{node:e.type})}}function re(e){return!0===e}function ie(e){return Array.isArray(e)?e:[e]}function ne(e){return null!==e?!0!==e:null}function se(e,t){return null!=e&&null!=t?!0===e&&!0===t:!1!==e&&!1!==t&&null}function oe(e,t){return null!=e&&null!=t?!0===e||!0===t:!0===e||!0===t||null}function ae(e,t,r){if(null==e)return null;let i=!1;for(const r of t)if(null==r)i=null;else{if(e===r){i=!0;break}if(O(e)&&O(r)&&(i=z(e,r,"="),i))break}return i}const le="-[]/{}()*+?.\\^$|";var ce;function ue(e,t,r){return null==e?null:function(e,t){const r=t;let i="",n=ce.Normal;for(let t=0;t<e.length;t++){const s=e.charAt(t);switch(n){case ce.Normal:s===r?n=ce.Escaped:le.includes(s)?i+="\\"+s:i+="%"===s?".*":"_"===s?".":s;break;case ce.Escaped:le.includes(s)?i+="\\"+s:i+=s,n=ce.Normal}}return new RegExp("^"+i+"$","m")}(t,r).test(e)}function he(e,t,r,i){const n=i.getAttribute(e,t),s=r?.get(t);return null==n||"esriFieldTypeDate"!==s?.type&&"date"!==s?.type?null==n||"esriFieldTypeDateOnly"!==s?.type&&"date-only"!==s?.type?null==n||"esriFieldTypeTimeOnly"!==s?.type&&"time-only"!==s?.type?null==n||"esriFieldTypeTimestampOffset"!==s?.type&&"timestamp-offset"!==s?.type?n:new c.g(n):u.k.fromReader(n):o.n.fromReader(n):w(new Date(n),r?.getLuxonTimeZone(s.name)??d.mQ.utcInstance)}!function(e){e[e.Normal=0]="Normal",e[e.Escaped=1]="Escaped"}(ce||(ce={}));const de={getAttribute:(e,t)=>(function(e){return e&&"object"==typeof e.attributes}(e)?e.attributes:e)[t]}},93393:function(e,t,r){r.d(t,{L8:function(){return a},Z7:function(){return i}});var i,n,s=r(50944);(n=i||(i={})).InvalidFunctionParameters="InvalidFunctionParameters",n.InvalidValueForAggregateFunction="InvalidValueForAggregateFunction",n.UnsupportedSqlFunction="UnsupportedSqlFunction",n.UnsupportedOperator="UnsupportedOperator",n.UnsupportedSyntax="UnsupportedSyntax",n.UnsupportedIsRhs="UnsupportedIsRhs",n.UnsupportedIsLhs="UnsupportedIsLhs",n.InvalidDataType="InvalidDataType",n.CannotCastValue="CannotCastValue",n.FunctionNotRecognized="FunctionNotRecognized",n.InvalidTime="InvalidTime",n.InvalidParameterCount="InvalidParameterCount",n.InvalidTimeStamp="InvalidTimeStamp",n.InvalidDate="InvalidDate",n.InvalidOperator="InvalidOperator",n.IllegalInterval="IllegalInterval",n.YearMonthIntervals="YearMonthIntervals",n.PrimarySecondaryQualifiers="PrimarySecondaryQualifiers",n.MissingStatisticParameters="MissingStatisticParameters";const o={[i.InvalidValueForAggregateFunction]:"Invalid value used in aggregate function",[i.MissingStatisticParameters]:"Statistic does not have 1 or 0 Parameters",[i.InvalidFunctionParameters]:"Invalid parameters for call to {function}",[i.UnsupportedIsLhs]:"Unsupported left hand expression in is statement",[i.UnsupportedIsRhs]:"Unsupported right hand expression in is statement",[i.UnsupportedOperator]:"Unsupported operator - {operator}",[i.UnsupportedSyntax]:"Unsupported syntax - {node}",[i.UnsupportedSqlFunction]:"Sql function not found = {function}",[i.InvalidDataType]:"Invalid sql data type",[i.InvalidDate]:"Invalid date encountered",[i.InvalidOperator]:"Invalid operator encountered",[i.InvalidTime]:"Invalid time encountered",[i.IllegalInterval]:"Illegal interval",[i.FunctionNotRecognized]:"Function not recognized",[i.InvalidTimeStamp]:"Invalid timestamp encountered",[i.InvalidParameterCount]:"Invalid parameter count for call to {name}",[i.PrimarySecondaryQualifiers]:"Primary and Secondary SqlInterval qualifiers not supported",[i.YearMonthIntervals]:"Year-Month Intervals not supported",[i.CannotCastValue]:"Cannot cast value to the required data type"};class a extends Error{constructor(e,t){super((0,s.HC)(o[e],t)),this.declaredRootClass="esri.arcade.featureset.support.sqlerror",Error.captureStackTrace&&Error.captureStackTrace(this,a)}}},20248:function(e,t,r){r.d(t,{U:function(){return u}});var i=r(53804),n=r(83525),s=r(61226),o=r(28181),a=r(74087),l=r(23502),c=r(65953);let u=class extends n.A{constructor(){super(...arguments),this.updating=!1,this._handleId=0,this._scheduleHandleId=0,this._pendingPromises=new Set}destroy(){this.removeAll()}add(e,t,r={}){return this._installWatch(e,t,r,o.watch)}addWhen(e,t,r={}){return this._installWatch(e,t,r,o.when)}addOnCollectionChange(e,t,{initial:r=!1,final:i=!1}={}){const n=++this._handleId;return this.addHandles([(0,o.on)(e,"after-changes",this._createSyncUpdatingCallback(),o.OH),(0,o.on)(e,"change",t,{onListenerAdd:r?e=>t({added:e.toArray(),removed:[]}):void 0,onListenerRemove:i?e=>t({added:[],removed:e.toArray()}):void 0})],n),(0,s.hA)((()=>this.removeHandles(n)))}addPromise(e){if(null==e)return e;const t=++this._handleId;this.addHandles((0,s.hA)((()=>{this._pendingPromises.delete(e)&&(0!==this._pendingPromises.size||this.hasHandles(h)||this._set("updating",!1))})),t),this._pendingPromises.add(e),this._set("updating",!0);const r=()=>this.removeHandles(t);return e.then(r,r),e}removeAll(){this._pendingPromises.clear(),this.removeAllHandles(),this._set("updating",!1)}_installWatch(e,t,r={},i){const n=++this._handleId;r.sync||this._installSyncUpdatingWatch(e,n);const o=i(e,t,r);return this.addHandles(o,n),(0,s.hA)((()=>this.removeHandles(n)))}_installSyncUpdatingWatch(e,t){const r=this._createSyncUpdatingCallback(),i=(0,o.watch)(e,r,{sync:!0,equals:()=>!1});return this.addHandles(i,t),i}_createSyncUpdatingCallback(){return()=>{this.removeHandles(h),++this._scheduleHandleId;const e=this._scheduleHandleId;this._get("updating")||this._set("updating",!0),this.addHandles((0,a._)((()=>{e===this._scheduleHandleId&&(this._set("updating",this._pendingPromises.size>0),this.removeHandles(h))})),h)}}};(0,i._)([(0,l.MZ)({readOnly:!0})],u.prototype,"updating",void 0),u=(0,i._)([(0,c.$)("esri.core.support.UpdatingHandles")],u);const h=-42},33134:function(e,t,r){r.d(t,{z:function(){return a}});var i=r(21609),n=r(49077),s=r(74697),o=r(76613);class a{static fromOptimized(e,t,r=!1,i=!1,n=1){return(new l).initialize(e,t,r,i,n)}static fromJSON(e,t=!1,r=!1){const[i,n]=u(e);return(new h).initialize(i,n,t,r,1)}static fromOptimizedCIM(e,t,r=!1,i=!1,n=1){return(new d).initialize(e,t,r,i,n)}static fromJSONCIM(e,t=!1,r=!1,i=1){const[n,s]=u(e);return(new f).initialize(n,s,t,r,i)}static fromFeatureSetReader(e){const t=e.readGeometryForDisplay(),r=e.geometryType;return t&&r?this.fromOptimized(t,r):null}static fromFeatureSetReaderCIM(e){const t=e.readGeometryForDisplay(),r=e.geometryType;return t&&r?this.fromOptimizedCIM(t,r):null}static createEmptyOptimized(e,t=!1,r=!1,i=1){return(new l).initialize(new o.A,e,t,r,i)}static createEmptyJSON(e,t=!1,r=!1){return(new h).initialize([],e,t,r,1)}static createEmptyOptimizedCIM(e,t=!1,r=!1,i=1){return(new d).initialize(new o.A,e,t,r,i)}static createEmptyJSONCIM(e,t=!1,r=!1,i=1){return(new f).initialize([],e,t,r,i)}asJSON(){const e=(0,n.x)(this);return"esriGeometryEnvelope"===this.geometryType?{xmin:e[0][0][0],ymin:e[0][0][1],xmax:e[0][2][0],ymax:e[0][2][1]}:"esriGeometryMultipoint"===this.geometryType?{points:e.flat()}:"esriGeometryPoint"===this.geometryType?{x:e[0][0][0],y:e[0][0][1]}:"esriGeometryPolygon"===this.geometryType?{rings:e}:{paths:e}}getCurrentRingArea(){if(this.pathSize<3)return 0;let e,t,r=0;if(this.seekPathStart(),!this.nextPoint())return 0;e=this.x,t=this.y;const i=e,n=t;for(;this.nextPoint();)r+=(e-this.x)*(t+this.y),e=this.x,t=this.y;return r+=(e-i)*(t+n),-.5*r}invertY(){this.yFactor*=-1}}class l extends a{constructor(){super(...arguments),this._end=-1}initialize(e,t,r,i,n){return this.hasZ=r,this.hasM=i,this.geometryType=t,this._stride=2+Number(r)+Number(i),this._geometry=e,this._pathIndex=-1,this._pathOffset=0,this._pointOffset=-this._stride,this._end=-1,this.yFactor=n,this}reset(){this.initialize(this._geometry,this.geometryType,this.hasZ,this.hasM,this.yFactor)}seekPath(e){if(e>=0&&e<this.totalSize){if(this._pathIndex<e)for(;this._pathIndex<e&&this.nextPath(););else if(this._pathIndex>e)for(;this._pathIndex>e&&this.prevPath(););return!0}return!1}seekPathStart(){this._pointOffset=this._pathOffset-this._stride}seekPathEnd(){this._pointOffset=this._end}seekInPath(e){const t=this._pathOffset+e*this._stride;return t>=0&&t<this._end&&(this._pointOffset=t,!0)}nextPoint(){return(this._pointOffset+=this._stride)<this._end}prevPoint(){return(this._pointOffset-=this._stride)>=this._pathOffset}nextPath(){return!(this.pathIndex>=this.totalSize-1||(this._pathIndex>=0&&(this._pathOffset+=this._stride*this.pathSize),this._pathIndex++,this._pointOffset=this._pathOffset-this._stride,this._end=this._pointOffset+this._stride+this._stride*this.pathSize,0))}prevPath(){return!(this.pathIndex<=0||(this._pathIndex--,this._end=this._pathOffset,this._pathOffset-=this._stride*this.pathSize,this._pointOffset=this._pathOffset-this._stride,0))}getCurrentPath(){const e=this._end,t=this._geometry.coords,r=this._pathOffset;return(new l).initialize(new o.A([this.pathSize],t.slice(r,e)),this.geometryType,this.hasZ,this.hasM,this.yFactor)}pathLength(){const e=this._end,t=this._stride,r=this._geometry.coords;let i=0;for(let n=this._pathOffset+t;n<e;n+=t){const e=r[n-t],s=r[n-t+1],o=r[n]-e,a=r[n+1]-s;i+=Math.sqrt(o*o+a*a)}return i}startPath(){this._geometry.lengths.push(0)}pushPath(e){this.startPath(),this.pushPoints(e)}pushPoint(e){for(let t=0;t<this._stride;++t)this._geometry.coords.push(e[t]);this._geometry.lengths[this.totalSize-1]++}pushXY(e,t){this._geometry.coords.push(e,t),this._geometry.lengths[this.totalSize-1]++}pushPoints(e){for(const t of e)for(let e=0;e<this._stride;++e)this._geometry.coords.push(t[e]);this._geometry.lengths[this.totalSize-1]+=e.length}pushCursor(e){const t=e.asOptimized();this._geometry.coords.push(...t.coords),this._geometry.lengths.push(...t.lengths)}asOptimized(){const e=this._geometry.clone();if(1!==this.yFactor)for(let t=1;t<e.coords.length;t+=this._stride)e.coords[t]*=this.yFactor;return"esriGeometryPoint"===this.geometryType&&(e.lengths.length=0),e}isClosed(){const e=this._geometry.coords,t=this._pathOffset,r=this._end-this._stride;for(let i=0;i<this._stride;i++)if(e[t+i]!==e[r+i])return!1;return!0}clone(){return(new l).initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._geometry.isPoint?1:this._geometry.lengths.reduce(((e,t)=>e+t))}get pathSize(){const{lengths:e}=this._geometry;return this._geometry.isPoint?1:this._pathIndex<0||this._pathIndex>e.length-1?0:e[this._pathIndex]}get totalSize(){return this._geometry.isPoint?1:this._geometry.lengths.length}get x(){return this._geometry.coords[this._pointOffset]}set x(e){this._geometry.coords[this._pointOffset]=e}get y(){return this.yFactor*this._geometry.coords[this._pointOffset+1]}set y(e){this._geometry.coords[this._pointOffset+1]=this.yFactor*e}get z(){return this._geometry.coords[this._pointOffset+2]}set z(e){this._geometry.coords[this._pointOffset+2]=e}get m(){const e=this.hasZ?3:2;return this._geometry.coords[this._pointOffset+e]}set m(e){this._geometry.coords[this._pointOffset+3]=e}get pathIndex(){return this._pathIndex}get _coordIndex(){return this._pointOffset/this._stride}}function c(e){const t=[e.x,e.y];return e.z&&t.push(e.z),e.m&&t.push(e.m),t}function u(e){return(0,s.Bi)(e)?[e.rings,"esriGeometryPolygon"]:(0,s.Rg)(e)?[e.paths,"esriGeometryPolyline"]:(0,s.U9)(e)?[[e.points],"esriGeometryMultipoint"]:(0,s.ZC)(e)?[[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]],"esriGeometryEnvelope"]:(0,s.fT)(e)?[[[c(e)]],"esriGeometryPoint"]:[[],"esriGeometryPolyline"]}class h extends a{initialize(e,t,r,i,n){return this._paths=e,this.geometryType=t,this.hasZ=r,this.hasM=i,this._pathIndex=this._pointIndex=-1,this.yFactor=n,this._mIndex=this.hasZ?3:2,this}reset(){this._pathIndex=this._pointIndex=-1}seekPath(e){return this._pathIndex=e,this._pointIndex=-1,e>=0&&e<this.totalSize&&(this._currentPath=this._paths[e],!0)}seekPathStart(){this._pointIndex=-1}seekPathEnd(){this._pointIndex=this._currentPath.length}seekInPath(e){return e>=0&&e<this._currentPath.length&&(this._pointIndex=e,this._currentPoint=this._currentPath[this._pointIndex],!0)}nextPoint(){return this._currentPoint=this._currentPath[++this._pointIndex],this._pointIndex<this._currentPath.length}prevPoint(){return this._currentPoint=this._currentPath[--this._pointIndex],this._pointIndex>=0}nextPath(){return this._pointIndex=-1,this._currentPath=this._paths[++this._pathIndex],this._pathIndex<this.totalSize}prevPath(){return this.pathIndex>0&&(this._pointIndex=-1,this._pathIndex--,this._currentPath=this._paths[this._pathIndex],!0)}pathLength(){const e=this._currentPath.length,t=this._currentPath;let r=0;for(let i=1;i<e;i++){const e=t[i-1],n=t[i],s=e[0],o=e[1],a=n[0]-s,l=n[1]-o;r+=Math.sqrt(a*a+l*l)}return r}startPath(){this._paths.push([])}getCurrentPath(){return(new h).initialize([this._currentPath],this.geometryType,this.hasZ,this.hasM,this.yFactor)}pushPath(e){this._paths.push(e)}pushPoint(e){this._paths[this.totalSize-1].push(e)}pushXY(e,t){this._paths[this.totalSize-1].push([e,t])}pushPoints(e){this._paths[this.totalSize-1].push(...e)}pushCursor(e){const t=(0,n.x)(e);for(const e of t)this.pushPath(e)}asOptimized(){const e=new o.A;if("esriGeometryPoint"===this.geometryType)e.coords.push(...this._paths[0][0]),e.lengths.length=0;else for(const t of this._paths){for(const r of t)e.coords.push(r[0]),e.coords.push(r[1]*this.yFactor),this.hasZ&&e.coords.push(r[2]),this.hasM&&e.coords.push(r[this._mIndex]);e.lengths.push(t.length)}return e}isClosed(){const e=this._currentPath[0],t=this._currentPath[this._currentPath.length-1];for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}clone(){return(new h).initialize((0,i.o8)(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._paths.map((e=>e.length)).reduce(((e,t)=>e+t))}get pathSize(){return this._pathIndex<0||this._pathIndex>this.totalSize-1?-1:this._paths[this._pathIndex].length}get totalSize(){return this._paths.length}get x(){return this._currentPoint[0]}set x(e){this._currentPoint[0]=e}get y(){return this.yFactor*this._currentPoint[1]}set y(e){this._currentPoint[1]=this.yFactor*e}get z(){return this._currentPoint[2]}set z(e){this._currentPoint[2]=e}get m(){return this._currentPoint[this._mIndex]}set m(e){this._currentPoint[this._mIndex]=e}get pathIndex(){return this._pathIndex}}class d extends l{initialize(e,t,r,i,n){return super.initialize(e,t,r,i,n),this._controlPoints||(this._controlPoints=this._controlPoints=new Array(this.totalSize).fill(void 0).map((e=>new Set))),this}startPath(){super.startPath(),this._controlPoints.push(new Set)}clone(){const e=(new d).initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor);return e._controlPoints=this._controlPoints,e}setControlPoint(){this._controlPoints[this.pathIndex].add(this._coordIndex)}getControlPoint(){return this._controlPoints[this.pathIndex].has(this._coordIndex)}setControlPointAt(e){this._controlPoints[this.pathIndex].add(e)}getControlPointAt(e){return this._controlPoints[this.pathIndex].has(e)}}class f extends h{initialize(e,t,r,i,n){return super.initialize(e,t,r,i,n)}clone(){return(new f).initialize((0,i.o8)(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}setControlPoint(){this._paths[this.pathIndex][this._pointIndex][4]=1}getControlPoint(){return 1===this._paths[this.pathIndex][this._pointIndex][4]}setControlPointAt(e){this._paths[this.pathIndex][e][4]=1}getControlPointAt(e){return 1===this._paths[this.pathIndex][e][4]}}},86029:function(e,t,r){r.d(t,{g:function(){return i}});const i={convertToGEGeometry:function(e,t){return null==t?null:e.convertJSONToGeometry(t)},exportPoint:function(e,t,r){const i=new n(e.getPointX(t),e.getPointY(t),r),s=e.hasZ(t),o=e.hasM(t);return s&&(i.z=e.getPointZ(t)),o&&(i.m=e.getPointM(t)),i},exportPolygon:function(e,t,r){return new s(e.exportPaths(t),r,e.hasZ(t),e.hasM(t))},exportPolyline:function(e,t,r){return new o(e.exportPaths(t),r,e.hasZ(t),e.hasM(t))},exportMultipoint:function(e,t,r){return new a(e.exportPoints(t),r,e.hasZ(t),e.hasM(t))},exportExtent:function(e,t,r){const i=e.hasZ(t),n=e.hasM(t),s=new l(e.getXMin(t),e.getYMin(t),e.getXMax(t),e.getYMax(t),r);if(i){const r=e.getZExtent(t);s.zmin=r.vmin,s.zmax=r.vmax}if(n){const r=e.getMExtent(t);s.mmin=r.vmin,s.mmax=r.vmax}return s}};class n{constructor(e,t,r){this.x=e,this.y=t,this.spatialReference=r,this.z=void 0,this.m=void 0}}class s{constructor(e,t,r,i){this.rings=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,r&&(this.hasZ=r),i&&(this.hasM=i)}}class o{constructor(e,t,r,i){this.paths=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,r&&(this.hasZ=r),i&&(this.hasM=i)}}class a{constructor(e,t,r,i){this.points=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,r&&(this.hasZ=r),i&&(this.hasM=i)}}class l{constructor(e,t,r,i,n){this.xmin=e,this.ymin=t,this.xmax=r,this.ymax=i,this.spatialReference=n,this.zmin=void 0,this.zmax=void 0,this.mmin=void 0,this.mmax=void 0}}},81484:function(e,t,r){r.d(t,{F:function(){return l},l:function(){return c}});var i=r(53216),n=r(58941);const s=128e3;let o=null,a=null;async function l(){return o||(o=async function(){const e=(0,n.A)("esri-csp-restrictions")?await r.e(5786).then(r.bind(r,70244)).then((e=>e.l)):await r.e(3740).then(r.bind(r,9502)).then((e=>e.l));a=await e.default({locateFile:e=>(0,i.s)(`esri/core/libs/libtess/${e}`)})}()),o}function c(e,t){const r=Math.max(e.length,s);return a.triangulate(e,t,r)}},72139:function(e,t,r){var i,n,s;r.d(t,{O3:function(){return l},Ox:function(){return c},bR:function(){return o},dC:function(){return i}}),(s=i||(i={}))[s.Unknown=0]="Unknown",s[s.Point=1]="Point",s[s.LineString=2]="LineString",s[s.Polygon=3]="Polygon";class o{constructor(e,t){this.x=e,this.y=t}clone(){return new o(this.x,this.y)}equals(e,t){return e===this.x&&t===this.y}isEqual(e){return e.x===this.x&&e.y===this.y}setCoords(e,t){return this.x=e,this.y=t,this}normalize(){const e=this.x,t=this.y,r=Math.sqrt(e*e+t*t);return this.x/=r,this.y/=r,this}rightPerpendicular(){const e=this.x;return this.x=this.y,this.y=-e,this}leftPerpendicular(){const e=this.x;return this.x=-this.y,this.y=e,this}move(e,t){return this.x+=e,this.y+=t,this}assign(e){return this.x=e.x,this.y=e.y,this}assignAdd(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}assignSub(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}rotate(e,t){const r=this.x,i=this.y;return this.x=r*e-i*t,this.y=r*t+i*e,this}scale(e){return this.x*=e,this.y*=e,this}length(){const e=this.x,t=this.y;return Math.sqrt(e*e+t*t)}sub(e){return this.x-=e.x,this.y-=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}static distance(e,t){const r=t.x-e.x,i=t.y-e.y;return Math.sqrt(r*r+i*i)}static add(e,t){return new o(e.x+t.x,e.y+t.y)}static sub(e,t){return new o(e.x-t.x,e.y-t.y)}}class a{constructor(e,t,r){this.ratio=e,this.x=t,this.y=r}}class l{constructor(e,t,r,i=8,n=8){this._lines=[],this._starts=[],this.validateTessellation=!0,this._pixelRatio=i,this._pixelMargin=n,this._tileSize=512*i,this._dz=e,this._yPos=t,this._xPos=r}setPixelMargin(e){e!==this._pixelMargin&&(this._pixelMargin=e,this.setExtent(this._extent))}setExtent(e){this._extent=e,this._finalRatio=this._tileSize/e*(1<<this._dz);let t=this._pixelRatio*this._pixelMargin;t/=this._finalRatio;const r=e>>this._dz;t>r&&(t=r),this._margin=t,this._xmin=r*this._xPos-t,this._ymin=r*this._yPos-t,this._xmax=this._xmin+r+2*t,this._ymax=this._ymin+r+2*t}reset(e){this._type=e,this._lines=[],this._starts=[],this._line=null,this._start=0}moveTo(e,t){this._pushLine(),this._prevIsIn=this._isIn(e,t),this._moveTo(e,t,this._prevIsIn),this._prevPt=new o(e,t),this._firstPt=new o(e,t),this._dist=0}lineTo(e,t){const r=this._isIn(e,t),i=new o(e,t),n=o.distance(this._prevPt,i);let s,l,c,u,h,d,f,p;if(r)this._prevIsIn?this._lineTo(e,t,!0):(s=this._prevPt,l=i,c=this._intersect(l,s),this._start=this._dist+n*(1-this._r),this._lineTo(c.x,c.y,!0),this._lineTo(l.x,l.y,!0));else if(this._prevIsIn)l=this._prevPt,s=i,c=this._intersect(l,s),this._lineTo(c.x,c.y,!0),this._lineTo(s.x,s.y,!1);else{const e=this._prevPt,t=i;if(e.x<=this._xmin&&t.x<=this._xmin||e.x>=this._xmax&&t.x>=this._xmax||e.y<=this._ymin&&t.y<=this._ymin||e.y>=this._ymax&&t.y>=this._ymax)this._lineTo(t.x,t.y,!1);else{const r=[];if((e.x<this._xmin&&t.x>this._xmin||e.x>this._xmin&&t.x<this._xmin)&&(u=(this._xmin-e.x)/(t.x-e.x),p=e.y+u*(t.y-e.y),p<=this._ymin?d=!1:p>=this._ymax?d=!0:r.push(new a(u,this._xmin,p))),(e.x<this._xmax&&t.x>this._xmax||e.x>this._xmax&&t.x<this._xmax)&&(u=(this._xmax-e.x)/(t.x-e.x),p=e.y+u*(t.y-e.y),p<=this._ymin?d=!1:p>=this._ymax?d=!0:r.push(new a(u,this._xmax,p))),(e.y<this._ymin&&t.y>this._ymin||e.y>this._ymin&&t.y<this._ymin)&&(u=(this._ymin-e.y)/(t.y-e.y),f=e.x+u*(t.x-e.x),f<=this._xmin?h=!1:f>=this._xmax?h=!0:r.push(new a(u,f,this._ymin))),(e.y<this._ymax&&t.y>this._ymax||e.y>this._ymax&&t.y<this._ymax)&&(u=(this._ymax-e.y)/(t.y-e.y),f=e.x+u*(t.x-e.x),f<=this._xmin?h=!1:f>=this._xmax?h=!0:r.push(new a(u,f,this._ymax))),0===r.length)h?d?this._lineTo(this._xmax,this._ymax,!0):this._lineTo(this._xmax,this._ymin,!0):d?this._lineTo(this._xmin,this._ymax,!0):this._lineTo(this._xmin,this._ymin,!0);else if(r.length>1&&r[0].ratio>r[1].ratio)this._start=this._dist+n*r[1].ratio,this._lineTo(r[1].x,r[1].y,!0),this._lineTo(r[0].x,r[0].y,!0);else{this._start=this._dist+n*r[0].ratio;for(let e=0;e<r.length;e++)this._lineTo(r[e].x,r[e].y,!0)}this._lineTo(t.x,t.y,!1)}}this._dist+=n,this._prevIsIn=r,this._prevPt=i}close(){if(this._line.length>2){const e=this._firstPt,t=this._prevPt;e.x===t.x&&e.y===t.y||this.lineTo(e.x,e.y);const r=this._line;let i=r.length;for(;i>=4&&(r[0].x===r[1].x&&r[0].x===r[i-2].x||r[0].y===r[1].y&&r[0].y===r[i-2].y);)r.pop(),r[0].x=r[i-2].x,r[0].y=r[i-2].y,--i}}result(e=!0){return this._pushLine(),0===this._lines.length?null:(this._type===i.Polygon&&e&&u.simplify(this._tileSize,this._margin*this._finalRatio,this._lines),this._lines)}resultWithStarts(){if(this._type!==i.LineString)throw new Error("Only valid for lines");this._pushLine();const e=this._lines,t=e.length;if(0===t)return null;const r=[];for(let i=0;i<t;i++)r.push({line:e[i],start:this._starts[i]||0});return r}_isIn(e,t){return e>=this._xmin&&e<=this._xmax&&t>=this._ymin&&t<=this._ymax}_intersect(e,t){let r,i,n;if(t.x>=this._xmin&&t.x<=this._xmax)i=t.y<=this._ymin?this._ymin:this._ymax,n=(i-e.y)/(t.y-e.y),r=e.x+n*(t.x-e.x);else if(t.y>=this._ymin&&t.y<=this._ymax)r=t.x<=this._xmin?this._xmin:this._xmax,n=(r-e.x)/(t.x-e.x),i=e.y+n*(t.y-e.y);else{i=t.y<=this._ymin?this._ymin:this._ymax,r=t.x<=this._xmin?this._xmin:this._xmax;const s=(r-e.x)/(t.x-e.x),o=(i-e.y)/(t.y-e.y);s<o?(n=s,i=e.y+s*(t.y-e.y)):(n=o,r=e.x+o*(t.x-e.x))}return this._r=n,new o(r,i)}_pushLine(){this._line&&(this._type===i.Point?this._line.length>0&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===i.LineString?this._line.length>1&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===i.Polygon&&this._line.length>3&&(this._lines.push(this._line),this._starts.push(this._start))),this._line=[],this._start=0}_moveTo(e,t,r){this._type!==i.Polygon?r&&(e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),t=Math.round((t-(this._ymin+this._margin))*this._finalRatio),this._line.push(new o(e,t))):(r||(e<this._xmin&&(e=this._xmin),e>this._xmax&&(e=this._xmax),t<this._ymin&&(t=this._ymin),t>this._ymax&&(t=this._ymax)),e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),t=Math.round((t-(this._ymin+this._margin))*this._finalRatio),this._line.push(new o(e,t)),this._isH=!1,this._isV=!1)}_lineTo(e,t,r){let n,s;if(this._type!==i.Polygon)if(r){if(e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),t=Math.round((t-(this._ymin+this._margin))*this._finalRatio),this._line.length>0&&(n=this._line[this._line.length-1],n.equals(e,t)))return;this._line.push(new o(e,t))}else this._line&&this._line.length>0&&this._pushLine();else if(r||(e<this._xmin&&(e=this._xmin),e>this._xmax&&(e=this._xmax),t<this._ymin&&(t=this._ymin),t>this._ymax&&(t=this._ymax)),e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),t=Math.round((t-(this._ymin+this._margin))*this._finalRatio),this._line&&this._line.length>0){n=this._line[this._line.length-1];const r=n.x===e,i=n.y===t;if(r&&i)return;this._isH&&r||this._isV&&i?(n.x=e,n.y=t,s=this._line[this._line.length-2],s.x===e&&s.y===t?(this._line.pop(),this._line.length<=1?(this._isH=!1,this._isV=!1):(s=this._line[this._line.length-2],this._isH=s.x===e,this._isV=s.y===t)):(this._isH=s.x===e,this._isV=s.y===t)):(this._line.push(new o(e,t)),this._isH=r,this._isV=i)}else this._line.push(new o(e,t))}}class c{setExtent(e){this._ratio=4096===e?1:4096/e}get validateTessellation(){return this._ratio<1}reset(e){this._lines=[],this._line=null}moveTo(e,t){this._line&&this._lines.push(this._line),this._line=[];const r=this._ratio;this._line.push(new o(e*r,t*r))}lineTo(e,t){const r=this._ratio;this._line.push(new o(e*r,t*r))}close(){const e=this._line;e&&!e[0].isEqual(e[e.length-1])&&e.push(e[0])}result(){return this._line&&this._lines.push(this._line),0===this._lines.length?null:this._lines}}!function(e){e[e.sideLeft=0]="sideLeft",e[e.sideRight=1]="sideRight",e[e.sideTop=2]="sideTop",e[e.sideBottom=3]="sideBottom"}(n||(n={}));class u{static simplify(e,t,r){if(!r)return;const i=-t,s=e+t,o=-t,a=e+t,l=[],c=[],h=r.length;for(let e=0;e<h;++e){const t=r[e];if(!t||t.length<2)continue;let u,h=t[0];const d=t.length;for(let r=1;r<d;++r)u=t[r],h.x===u.x&&(h.x<=i&&(h.y>u.y?(l.push(e),l.push(r),l.push(n.sideLeft),l.push(-1)):(c.push(e),c.push(r),c.push(n.sideLeft),c.push(-1))),h.x>=s&&(h.y<u.y?(l.push(e),l.push(r),l.push(n.sideRight),l.push(-1)):(c.push(e),c.push(r),c.push(n.sideRight),c.push(-1)))),h.y===u.y&&(h.y<=o&&(h.x<u.x?(l.push(e),l.push(r),l.push(n.sideTop),l.push(-1)):(c.push(e),c.push(r),c.push(n.sideTop),c.push(-1))),h.y>=a&&(h.x>u.x?(l.push(e),l.push(r),l.push(n.sideBottom),l.push(-1)):(c.push(e),c.push(r),c.push(n.sideBottom),c.push(-1)))),h=u}if(0===l.length||0===c.length)return;u.fillParent(r,c,l),u.fillParent(r,l,c);const d=[];u.calcDeltas(d,c,l),u.calcDeltas(d,l,c),u.addDeltas(d,r)}static fillParent(e,t,r){const i=r.length,s=t.length;for(let o=0;o<s;o+=4){const s=t[o],a=t[o+1],l=t[o+2],c=e[s][a-1],u=e[s][a];let d=8092,f=-1;for(let t=0;t<i;t+=4){if(r[t+2]!==l)continue;const i=r[t],s=r[t+1],o=e[i][s-1],a=e[i][s];switch(l){case n.sideLeft:case n.sideRight:if(h(c.y,o.y,a.y)&&h(u.y,o.y,a.y)){const e=Math.abs(a.y-o.y);e<d&&(d=e,f=t)}break;case n.sideTop:case n.sideBottom:if(h(c.x,o.x,a.x)&&h(u.x,o.x,a.x)){const e=Math.abs(a.x-o.x);e<d&&(d=e,f=t)}}}t[o+3]=f}}static calcDeltas(e,t,r){const i=t.length;for(let n=0;n<i;n+=4){const i=[],s=u.calcDelta(n,t,r,i);e.push(t[n]),e.push(t[n+1]),e.push(t[n+2]),e.push(s)}}static calcDelta(e,t,r,i){const n=t[e+3];if(-1===n)return 0;const s=i.length;return s>1&&i[s-2]===n?0:(i.push(n),u.calcDelta(n,r,t,i)+1)}static addDeltas(e,t){const r=e.length;let i=0;for(let t=0;t<r;t+=4){const r=e[t+3];r>i&&(i=r)}for(let s=0;s<r;s+=4){const r=t[e[s]],o=e[s+1],a=i-e[s+3];switch(e[s+2]){case n.sideLeft:r[o-1].x-=a,r[o].x-=a,1===o&&(r[r.length-1].x-=a),o===r.length-1&&(r[0].x-=a);break;case n.sideRight:r[o-1].x+=a,r[o].x+=a,1===o&&(r[r.length-1].x+=a),o===r.length-1&&(r[0].x+=a);break;case n.sideTop:r[o-1].y-=a,r[o].y-=a,1===o&&(r[r.length-1].y-=a),o===r.length-1&&(r[0].y-=a);break;case n.sideBottom:r[o-1].y+=a,r[o].y+=a,1===o&&(r[r.length-1].y+=a),o===r.length-1&&(r[0].y+=a)}}}}const h=(e,t,r)=>e>=t&&e<=r||e>=r&&e<=t},30804:function(e,t,r){r.d(t,{d:function(){return c}});var i=r(87416),n=r(35068),s=r(72228),o=r(38441),a=r(96127);const l=222045e-19;function c(e){if(0===e.totalSize)return null;const t=(0,n.z8)(e);if(!t)return null;const r=4*(Math.abs(t[0])+Math.abs(t[2])+Math.abs(t[1])+Math.abs(t[3])+1)*l;let o=0,a=0;e.reset();for(let t=0;e.nextPath();t++){const r=e.getCurrentRingArea();r>a&&(a=r,o=t)}if(e.seekPath(o),0===e.pathSize)return null;e.seekPathStart();const c=(0,n.B$)(e);if(Math.abs(a)<=2*r*r)return[(c[0]+c[2])/2,(c[1]+c[3])/2];e.seekPathStart();const f=(0,s.w2)(e,(0,i.vt)());if(null===f)return null;if(e.totalPoints<4)return f;const p=[[NaN,NaN],[NaN,NaN],[NaN,NaN],[NaN,NaN]],m=[NaN,NaN,NaN,NaN],_=[NaN,NaN,NaN,NaN];let g=!1,y=h(f,e,!0);0===y.distance&&(g=!0,p[0][0]=f[0],p[0][1]=f[1],y=h(f,e,!1)),m[0]=y.distance,_[0]=0;const x=[NaN,NaN];let S=!1,T=.25,I=-1,M=NaN;do{if(M=NaN,p[1]=d(e,b(c[0],c[2],T),0,t),isNaN(p[1][0])||isNaN(p[1][1])||(y=h(p[1],e,!1),M=y.distance),!isNaN(M)&&M>r&&u(p[1],e))S=!0,m[1]=M,_[1]=w(p[1],f);else if(!isNaN(M)&&M>I&&(I=M,x[0]=p[1][0],x[1]=p[1][1]),T-=.01,T<.1){if(!(I>=0))break;S=!0,m[1]=I,p[1][0]=x[0],p[1][1]=x[1],_[1]=w(p[1],f)}}while(!S);S=!1,T=.5,I=-1;let A=.01,E=1;do{if(M=NaN,p[2]=d(e,b(c[0],c[2],T),0,t),isNaN(p[2][0])||isNaN(p[2][1])||(y=h(p[2],e,!1),M=y.distance),!isNaN(M)&&M>r&&u(p[2],e))S=!0,m[2]=M,_[2]=w(p[2],f);else if(!isNaN(M)&&M>I)I=M,x[0]=p[2][0],x[1]=p[2][1];else if(M>I&&(I=M,x[0]=p[2][0],x[1]=p[2][1]),T=.5+A*E,A+=.01,E*=-1,T<.3||T>.7){if(!(I>=0))break;S=!0,m[2]=I,p[2][0]=x[0],p[2][1]=x[1],_[2]=w(p[2],f)}}while(!S);S=!1,T=.75,I=-1;do{if(M=NaN,p[3]=d(e,b(c[0],c[2],T),0,t),isNaN(p[3][0])||isNaN(p[3][1])||(y=h(p[3],e,!1),M=y.distance),!isNaN(M)&&M>r&&u(p[3],e))S=!0,m[3]=M,_[3]=w(p[3],f);else if(M>I&&(I=M,x[0]=p[3][0],x[1]=p[3][1]),T+=.01,T>.9){if(!(I>=0))break;S=!0,m[3]=I,p[3][0]=x[0],p[3][1]=x[1],_[3]=w(p[3],f)}}while(!S);const P=[0,1,2,3],C=g?0:1;let R;for(let e=C;e<4;e++)for(let e=C;e<3;e++){const t=_[e],r=_[e+1];v(t,r)>0&&(R=P[e],P[e]=P[e+1],P[e+1]=R,_[e]=r,_[e+1]=t)}let F=C,L=0,k=0;for(let e=C;e<4;e++){switch(e){case 0:k=2*m[P[e]];break;case 1:k=1.66666666*m[P[e]];break;case 2:k=1.33333333*m[P[e]];break;case 3:k=m[P[e]]}k>L&&(L=k,F=P[e])}return p[F]}function u(e,t){let r,i,n,s,o=0;for(t.reset();t.nextPath()&&t.nextPoint();)for(r=t.x,i=t.y;t.nextPoint();r=n,i=s)n=t.x,s=t.y,i>e[1]!=s>e[1]&&((n-r)*(e[1]-i)-(s-i)*(e[0]-r)>0?o++:o--);return 0!==o}function h(e,t,r){if(r&&u(e,t))return{coord:e,distance:0};let i=1/0,n=0,s=0,a=[0,0],l=[0,0];const c=[0,0];for(t.reset();t.nextPath()&&t.nextPoint();)if(!(t.pathSize<2))for(a[0]=t.x,a[1]=t.y;t.nextPoint();a=l){l=[t.x,t.y],(0,o.gR)(c,e,a,l);const r=w(e,c);r<i&&(i=r,n=c[0],s=c[1])}return{coord:[n,s],distance:Math.sqrt(i)}}function d(e,t,r,n){const s=[t,0];let o=1/0,l=1/0,c=!1,u=!1;const h=[[t,n[1]-1],[t,n[3]+1]],d=[0,0],p=[0,0],m=[0,0],_=[[0,0],[0,0]],g=(0,i.vt)();for(e.reset();e.nextPath()&&e.nextPoint();)if(!(e.pathSize<2))for(_[0][0]=e.x,_[0][1]=e.y;e.nextPoint();_[0][0]=_[1][0],_[0][1]=_[1][1]){if(_[1][0]=e.x,_[1][1]=e.y,null===f(g,_))continue;if(p[0]=h[0][0],p[1]=h[0][1],m[0]=h[1][0],m[1]=h[1][1],0===y(g,p,m))continue;if(!(0,a.Ql)(h[0],h[1],_[0],_[1],d))continue;const t=d[1];o>l?t<o&&(o=t,c=!0):t<l&&(l=t,u=!0)}return c&&u?s[1]=(o+l)/2:s[0]=s[1]=NaN,s}function f(e,t){if(t.length<2)return null;e||(e=(0,i.vt)());const[r,n]=t[0],[s,o]=t[1];return e[0]=Math.min(r,s),e[1]=Math.min(n,o),e[2]=Math.max(r,s),e[3]=Math.max(n,o),e}const p=1,m=4,_=3,g=12;function y(e,t,r){let i=x(t,e),n=x(r,e);const s=e[0],o=e[1],a=e[2],l=e[3];if(i&n)return 0;if(!(i|n))return 4;const c=(i?1:0)|(n?2:0);do{const c=r[0]-t[0],u=r[1]-t[1];if(c>u)i&_?(i&p?(t[1]+=u*(s-t[0])/c,t[0]=s):(t[1]+=u*(a-t[0])/c,t[0]=a),i=x(t,e)):n&_?(n&p?(r[1]+=u*(s-r[0])/c,r[0]=s):(r[1]+=u*(a-r[0])/c,r[0]=a),n=x(r,e)):i?(i&m?(t[0]+=c*(o-t[1])/u,t[1]=o):(t[0]+=c*(l-t[1])/u,t[1]=l),i=x(t,e)):(n&m?(r[0]+=c*(o-r[1])/u,r[1]=o):(r[0]+=c*(l-r[1])/u,r[1]=l),n=x(r,e));else if(i&g?(i&m?(t[0]+=c*(o-t[1])/u,t[1]=o):(t[0]+=c*(l-t[1])/u,t[1]=l),i=x(t,e)):n&g?(n&m?(r[0]+=c*(o-r[1])/u,r[1]=o):(r[0]+=c*(l-r[1])/u,r[1]=l),n=x(r,e)):i?(i&p?(t[1]+=u*(s-t[0])/c,t[0]=s):(t[1]+=u*(a-t[0])/c,t[0]=a),i=x(t,e)):(n&p?(r[1]+=u*(s-r[0])/c,r[0]=s):(r[1]+=u*(a-r[0])/c,r[0]=a),n=x(r,e)),i&n)return 0}while(i|n);return c}function x(e,t){return(e[0]<t[0]?1:0)|(e[0]>t[2]?1:0)<<1|(e[1]<t[1]?1:0)<<2|(e[1]>t[3]?1:0)<<3}function b(e,t,r){return e+(t-e)*r}function w(e,t){return(e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])}function v(e,t){if(e<t)return-1;if(e>t)return 1;if(e===t)return 0;const r=isNaN(e),i=isNaN(t);return r<i?-1:r>i?1:0}},65298:function(e,t,r){r.d(t,{O7:function(){return M},Hr:function(){return I},el:function(){return T},mT:function(){return A},XX:function(){return b}});var i=r(25591),n=r(39819),s=r(40633),o=r(44740),a=r(91508),l=r(65417),c=r(57652),u=r(1644),h=(r(50917),r(93040)),d=r(74697),f=r(39397),p=r(90683),m=r(26765);const _=()=>s.A.getLogger("esri.geometry.support.normalizeUtils");function g(e){return"polygon"===e[0].type}function y(e){return"polyline"===e[0].type}function x(e){const t=[];let r=0,i=0;for(let n=0;n<e.length;n++){const s=e[n];let o=null;for(let e=0;e<s.length;e++)o=s[e],t.push(o),0===e?(r=o[0],i=r):(r=Math.min(r,o[0]),i=Math.max(i,o[0]));o&&t.push([(r+i)/2,0])}return t}function b(e,t){if(!(e instanceof a.A||e instanceof o.A)){const e="straightLineDensify: the input geometry is neither polyline nor polygon";throw _().error(e),new n.A(e)}const r=(0,l.r8)(e),i=[];for(const e of r){const r=[];i.push(r),r.push([e[0][0],e[0][1]]);for(let i=0;i<e.length-1;i++){const n=e[i][0],s=e[i][1],o=e[i+1][0],a=e[i+1][1],l=Math.sqrt((o-n)*(o-n)+(a-s)*(a-s)),c=(a-s)/l,u=(o-n)/l,h=l/t;if(h>1){for(let e=1;e<=h-1;e++){const i=e*t,o=u*i+n,a=c*i+s;r.push([o,a])}const e=(l+Math.floor(h-1)*t)/2,i=u*e+n,o=c*e+s;r.push([i,o])}r.push([o,a])}}return function(e){return"polygon"===e.type}(e)?new o.A({rings:i,spatialReference:e.spatialReference}):new a.A({paths:i,spatialReference:e.spatialReference})}function w(e,t,r){if(t){const t=b(e,1e6);e=(0,u.ci)(t,!0)}return r&&(e=(0,l.kS)(e,r)),e}function v(e,t,r){if(Array.isArray(e)){const i=e[0];if(i>t){const r=(0,l.kd)(i,t);e[0]=i+r*(-2*t)}else if(i<r){const t=(0,l.kd)(i,r);e[0]=i+t*(-2*r)}}else{const i=e.x;if(i>t){const r=(0,l.kd)(i,t);e=e.clone().offset(r*(-2*t),0)}else if(i<r){const t=(0,l.kd)(i,r);e=e.clone().offset(t*(-2*r),0)}}return e}function S(e,t){let r=-1;for(let i=0;i<t.cutIndexes.length;i++){const n=t.cutIndexes[i],s=t.geometries[i],o=(0,l.r8)(s);for(let e=0;e<o.length;e++){const t=o[e];t.some((r=>{if(r[0]<180)return!0;{let r=0;for(let e=0;e<t.length;e++){const i=t[e][0];r=i>r?i:r}r=Number(r.toFixed(9));const i=-360*(0,l.kd)(r,180);for(let r=0;r<t.length;r++){const t=s.getPoint(e,r);s.setPoint(e,r,t.clone().offset(i,0))}return!0}}))}if(n===r){if(g(e))for(const t of(0,l.r8)(s))e[n]=e[n].addRing(t);else if(y(e))for(const t of(0,l.r8)(s))e[n]=e[n].addPath(t)}else r=n,e[n]=s}return e}async function T(e,t,r){if(!Array.isArray(e))return T([e],t);t&&"string"!=typeof t&&_().warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");const n="string"==typeof t?t:t?.url??i.default.geometryServiceUrl;let s,g,y,x,b,I,M,A,E=0;const P=[],C=[];for(const t of e)if(null!=t)if(s||(s=t.spatialReference,g=(0,c.Vp)(s),y=s.isWebMercator,I=y?102100:4326,x=l.j7[I].maxX,b=l.j7[I].minX,M=l.j7[I].plus180Line,A=l.j7[I].minus180Line),g)if("mesh"===t.type)C.push(t);else if("point"===t.type)C.push(v(t.clone(),x,b));else if("multipoint"===t.type){const e=t.clone();e.points=e.points.map((e=>v(e,x,b))),C.push(e)}else if("extent"===t.type){const e=t.clone()._normalize(!1,!1,g);C.push(e.rings?new o.A(e):e)}else if(t.extent){const e=t.extent,r=(0,l.kd)(e.xmin,b)*(2*x);let i=0===r?t.clone():(0,l.kS)(t.clone(),r);e.offset(r,0);let{xmin:n,xmax:s}=e;n=Number(n.toFixed(9)),s=Number(s.toFixed(9)),e.intersects(M)&&s!==x?(E=s>E?s:E,i=w(i,y),P.push(i),C.push("cut")):e.intersects(A)&&n!==b?(E=s*(2*x)>E?s*(2*x):E,i=w(i,y,360),P.push(i),C.push("cut")):C.push(i)}else C.push(t.clone());else C.push(t);else C.push(t);let R=(0,l.kd)(E,x),F=-90;const L=R,k=new a.A;for(;R>0;){const e=360*R-180;k.addPath([[e,F],[e,-1*F]]),F*=-1,R--}if(P.length>0&&L>0){const t=S(P,await async function(e,t,r,i){const n=(0,f.Dl)(e),s=t[0].spatialReference,o={...i,responseType:"json",query:{...n.query,f:"json",sr:(0,c.YX)(s),target:JSON.stringify({geometryType:(0,d.$B)(t[0]),geometries:t}),cutter:JSON.stringify(r)}},a=await(0,h.A)(n.path+"/cut",o),{cutIndexes:l,geometries:u=[]}=a.data;return{cutIndexes:l,geometries:u.map((e=>{const t=(0,d.rS)(e);return t.spatialReference=s,t}))}}(n,P,k,r)),i=[],s=[];for(let r=0;r<C.length;r++){const n=C[r];if("cut"!==n)s.push(n);else{const n=t.shift(),o=e[r];null!=o&&"polygon"===o.type&&o.rings&&o.rings.length>1&&n.rings.length>=o.rings.length?(i.push(n),s.push("simplify")):s.push(y?(0,u.Gh)(n):n)}}if(!i.length)return s;const o=await async function(e,t,r){const i="string"==typeof e?(0,p.An)(e):e,n=t[0].spatialReference,s=(0,d.$B)(t[0]),o={...r,query:{...i.query,f:"json",sr:(0,c.YX)(n),geometries:JSON.stringify((0,m.X)(t))}},{data:a}=await(0,h.A)(i.path+"/simplify",o);return(0,m.V)(a.geometries,s,n)}(n,i,r),a=[];for(let e=0;e<s.length;e++){const t=s[e];"simplify"!==t?a.push(t):a.push(y?(0,u.Gh)(o.shift()):o.shift())}return a}const N=[];for(let e=0;e<C.length;e++){const t=C[e];if("cut"!==t)N.push(t);else{const e=P.shift();N.push(!0===y?(0,u.Gh)(e):e)}}return N}function I(e){if(!e)return null;const t=e.extent;if(!t)return null;const r=e.spatialReference&&(0,c.Vp)(e.spatialReference);if(!r)return t;const[i,n]=r.valid,s=2*n,{width:o}=t;let a,{xmin:l,xmax:u}=t;if([l,u]=[u,l],"extent"===e.type||0===o||o<=n||o>s||l<i||u>n)return t;switch(e.type){case"polygon":if(!(e.rings.length>1))return t;a=x(e.rings);break;case"polyline":if(!(e.paths.length>1))return t;a=x(e.paths);break;case"multipoint":a=e.points}const h=t.clone();for(let e=0;e<a.length;e++){let t=a[e][0];t<0?(t+=n,u=Math.max(t,u)):(t-=n,l=Math.min(t,l))}return h.xmin=l,h.xmax=u,h.width<o?(h.xmin-=n,h.xmax-=n,h):t}function M(e,t,r){const i=(0,c.Vp)(r);if(null==i)return e;const[n,s]=i.valid,o=2*s;let a=0,l=0;t>s?a=Math.ceil(Math.abs(t-s)/o):t<n&&(a=-Math.ceil(Math.abs(t-n)/o)),e>s?l=Math.ceil(Math.abs(e-s)/o):e<n&&(l=-Math.ceil(Math.abs(e-n)/o));let u=e+(a-l)*o;const h=u-t;return h>s?u-=o:h<n&&(u+=o),u}function A(e,t){const r=(0,c.Vp)(t);if(r){const[t,i]=r.valid,n=i-t;if(e<t)for(;e<t;)e+=n;if(e>i)for(;e>i;)e-=n}return e}},65417:function(e,t,r){r.d(t,{j7:function(){return o},kS:function(){return l},kd:function(){return a},r8:function(){return c}});var i=r(91508),n=r(57165),s=r(74697);const o={102100:{maxX:20037508.342788905,minX:-20037508.342788905,plus180Line:new i.A({paths:[[[20037508.342788905,-20037508.342788905],[20037508.342788905,20037508.342788905]]],spatialReference:n.A.WebMercator}),minus180Line:new i.A({paths:[[[-20037508.342788905,-20037508.342788905],[-20037508.342788905,20037508.342788905]]],spatialReference:n.A.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new i.A({paths:[[[180,-180],[180,180]]],spatialReference:n.A.WGS84}),minus180Line:new i.A({paths:[[[-180,-180],[-180,180]]],spatialReference:n.A.WGS84})}};function a(e,t){return Math.ceil((e-t)/(2*t))}function l(e,t){const r=c(e);for(const e of r)for(const r of e)r[0]+=t;return e}function c(e){return(0,s.Bi)(e)?e.rings:e.paths}},87280:function(e,t,r){function i(e){return e?{originPosition:"upper-left"===e.originPosition?"upperLeft":"lower-left"===e.originPosition?"lowerLeft":e.originPosition,scale:e.tolerance?[e.tolerance,e.tolerance,1,1]:[1,1,1,1],translate:null!=e.extent?[e.extent.xmin,e.extent.ymax,e.extent.zmin??0,e.extent.mmin??0]:[0,0,0,0]}:null}function n(e){if(function(e){return"lowerLeft"===e.originPosition&&4===e.scale.length&&4===e.translate.length}(e))return e;const{originPosition:t,scale:r,translate:i}=e,n=r[0]??1,s=r[1]??1;return{originPosition:"lowerLeft",scale:[n,"lowerLeft"===t?s:-s,r[2]??1,r[3]??1],translate:[i[0]??0,i[1]??0,i[2]??0,i[3]??0]}}function s({scale:e,translate:t},r){return r*e[0]+t[0]}function o({scale:e,translate:t},r){return r*e[1]+t[1]}function a({scale:e,translate:t},r){return(r??0)*e[2]+t[2]}function l({scale:e,translate:t},r){return r?r*e[3]+t[3]:0}function c(e,t){return e&&t?f:e&&!t?h:!e&&t?d:u}r.d(t,{$X:function(){return y},Gy:function(){return m},P5:function(){return x},Q1:function(){return n},SW:function(){return _},Tr:function(){return g},VV:function(){return i}}),r(74697);const u=(e,t)=>{const r=new Array(t.length);if(!t.length)return r;const i=t[0];let n=s(e,i[0]),a=o(e,i[1]);r[0]=[n,a];const{scale:l,originPosition:c}=e,u=l[0],h="lowerLeft"===c?l[1]:-l[1];for(let e=1;e<t.length;e++){const[i,s]=t[e];n+=u*i,a+=h*s,r[e]=[n,a]}return r},h=(e,t)=>{const r=new Array(t.length);if(!t.length)return r;const i=t[0];let n=s(e,i[0]),l=o(e,i[1]);r[0]=[n,l,a(e,i[2])];const{scale:c,originPosition:u}=e,h=c[0],d="lowerLeft"===u?c[1]:-c[1];for(let i=1;i<t.length;i++){const[s,o,c]=t[i];n+=h*s,l+=d*o,r[i]=[n,l,a(e,c)]}return r},d=(e,t)=>{const r=new Array(t.length);if(!t.length)return r;const i=t[0];let n=s(e,i[0]),a=o(e,i[1]);r[0]=[n,a,l(e,i[2])];const{scale:c,originPosition:u}=e,h=c[0],d="lowerLeft"===u?c[1]:-c[1];for(let i=1;i<t.length;i++){const[s,o,c]=t[i];n+=h*s,a+=d*o,r[i]=[n,a,l(e,c)]}return r},f=(e,t)=>{const r=new Array(t.length);if(!t.length)return r;const i=t[0];let n=s(e,i[0]),c=o(e,i[1]);r[0]=[n,c,a(e,i[2]),l(e,i[3])];const{scale:u,originPosition:h}=e,d=u[0],f="lowerLeft"===h?u[1]:-u[1];for(let i=1;i<t.length;i++){const[s,o,u,h]=t[i];n+=d*s,c+=f*o,r[i]=[n,c,a(e,u),l(e,h)]}return r};function p(e,t,r){const i=new Array(r.length);for(let n=0;n<r.length;n++)i[n]=t(e,r[n]);return i}function m(e,t,r){const i=n(e);return t.x=function({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}(i,r.x),t.y=function({scale:e,translate:t},r){return Math.round((r-t[1])/e[1])}(i,r.y),null!=r.z&&(t.z=function({scale:e,translate:t},r){return Math.round(((r??0)-t[2])/e[2])}(i,r.z)),null!=r.m&&(t.m=function({scale:e,translate:t},r){return r?Math.round((r-t[3])/e[3]):0}(i,r.m)),t}function _(e,t,r,i=r?.hasZ??!1,s=r?.hasM??!1){if(null!=r){const o=n(e);t.points=c(i,s)(o,r.points),t.hasZ=i,t.hasM=s}return t}function g(e,t,r,i=null!=r?.z,c=null!=r?.m){if(null==r)return t;const u=n(e);return t.x=s(u,r.x),t.y=o(u,r.y),i&&(t.z=a(u,r.z)),c&&(t.m=l(u,r.m)),t}function y(e,t,r,i=r?.hasZ??!1,s=r?.hasM??!1){if(null!=r){const o=n(e);t.rings=p(o,c(i,s),r.rings),t.hasZ=i,t.hasM=s}return t}function x(e,t,r,i=r?.hasZ??!1,s=r?.hasM??!1){if(null!=r){const o=n(e);t.paths=p(o,c(i,s),r.paths),t.hasZ=i,t.hasM=s}return t}},65215:function(e,t,r){r.d(t,{N3:function(){return s},Om:function(){return n}});var i=r(76613);class n{constructor(e=null,t={},r,i){this.geometry=e,this.attributes=t,this.centroid=r,this.objectId=i,this.displayId=0,this.geohashX=0,this.geohashY=0}static fromJSON(e,t){const r=e.geometry?i.A.fromJSON(e.geometry):null,s=e.centroid?i.A.fromJSON(e.centroid):null,o=e.attributes[t];return new n(r,e.attributes,s,o)}weakClone(){const e=new n(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e.geohashX=this.geohashX,e.geohashY=this.geohashY,e}clone(){const e=this.geometry?.clone(),t=new n(e,{...this.attributes},this.centroid?.clone(),this.objectId);return t.displayId=this.displayId,t.geohashX=this.geohashX,t.geohashY=this.geohashY,t}}function s(e){return!!e.geometry?.coords?.length}},72887:function(e,t,r){r.d(t,{A:function(){return i}});class i{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const e=new i;return e.objectIdFieldName=this.objectIdFieldName,e.globalIdFieldName=this.globalIdFieldName,e.geohashFieldName=this.geohashFieldName,e.geometryProperties=this.geometryProperties,e.geometryType=this.geometryType,e.spatialReference=this.spatialReference,e.hasZ=this.hasZ,e.hasM=this.hasM,e.features=this.features,e.fields=this.fields,e.transform=this.transform,e.exceededTransferLimit=this.exceededTransferLimit,e.uniqueIdField=this.uniqueIdField,e.queryGeometry=this.queryGeometry,e.queryGeometryType=this.queryGeometryType,e}}},76613:function(e,t,r){r.d(t,{A:function(){return i}});class i{constructor(e=[],t=[]){this.lengths=e??[],this.coords=t??[]}static fromJSON(e){return new i(e.lengths,e.coords)}static fromRect(e){const[t,r,n,s]=e,o=n-t,a=s-r;return new i([5],[t,r,o,0,0,a,-o,0,0,-a])}get isPoint(){return 0===this.lengths.length&&this.coords.length>=2}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce(((e,t)=>e+t))}forEachVertex(e){let t=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let r=0;r<this.lengths.length;r++){const i=this.lengths[r];for(let r=0;r<i;r++)e(this.coords[2*(r+t)],this.coords[2*(r+t)+1]);t+=i}}deltaDecode(){const e=this.clone(),{coords:t,lengths:r}=e;let i=0;for(const e of r){for(let r=1;r<e;r++)t[2*(i+r)]+=t[2*(i+r)-2],t[2*(i+r)+1]+=t[2*(i+r)-1];i+=e}return e}clone(e){if(0===this.lengths.length)return new i([],[this.coords[0],this.coords[1]]);const t=2*(0===this.lengths.length?1:this.lengths.reduce(((e,t)=>e+t))),r=this.coords.slice(0,t);return e?(e.set(r),new i(this.lengths,e)):new i(Array.from(this.lengths),Array.from(r))}}},40302:function(e,t,r){function i(e,t){return e?t?4:3:t?3:2}function n(e,t,r,n){if(!t?.lengths.length)return null;e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0);const a=e.coords,l=[],c=r?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:u,coords:h}=t,d=i(r,n);let f=0;for(const e of u){const t=s(c,h,f,e,r,n);t&&l.push(t),f+=e*d}if(l.sort(((e,t)=>{let i=e[2]-t[2];return 0===i&&r&&(i=e[4]-t[4]),i})),l.length){let e=6*l[0][2];a[0]=l[0][0]/e,a[1]=l[0][1]/e,r&&(e=6*l[0][4],a[2]=0!==e?l[0][3]/e:0),(a[0]<c[0]||a[0]>c[1]||a[1]<c[2]||a[1]>c[3]||r&&(a[2]<c[4]||a[2]>c[5]))&&(a.length=0)}if(!a.length){const e=t.lengths[0]?o(h,0,u[0],r,n):null;if(!e)return null;a[0]=e[0],a[1]=e[1],r&&e.length>2&&(a[2]=e[2])}return e}function s(e,t,r,n,s,o){const a=i(s,o);let l=r,c=r+a,u=0,h=0,d=0,f=0,p=0;for(let r=0,i=n-1;r<i;r++,l+=a,c+=a){const r=t[l],i=t[l+1],n=t[l+2],o=t[c],a=t[c+1],m=t[c+2];let _=r*a-o*i;f+=_,u+=(r+o)*_,h+=(i+a)*_,s&&(_=r*m-o*n,d+=(n+m)*_,p+=_),r<e[0]&&(e[0]=r),r>e[1]&&(e[1]=r),i<e[2]&&(e[2]=i),i>e[3]&&(e[3]=i),s&&(n<e[4]&&(e[4]=n),n>e[5]&&(e[5]=n))}if(f>0&&(f*=-1),p>0&&(p*=-1),!f)return null;const m=[u,h,.5*f];return s&&(m[3]=d,m[4]=.5*p),m}function o(e,t,r,n,s){const o=i(n,s);let h=t,d=t+o,f=0,p=0,m=0,_=0;for(let t=0,i=r-1;t<i;t++,h+=o,d+=o){const t=e[h],r=e[h+1],i=e[h+2],s=e[d],o=e[d+1],g=e[d+2],y=n?l(t,r,i,s,o,g):a(t,r,s,o);if(y)if(f+=y,n){const e=u(t,r,i,s,o,g);p+=y*e[0],m+=y*e[1],_+=y*e[2]}else{const e=c(t,r,s,o);p+=y*e[0],m+=y*e[1]}}return f>0?n?[p/f,m/f,_/f]:[p/f,m/f]:r>0?n?[e[t],e[t+1],e[t+2]]:[e[t],e[t+1]]:null}function a(e,t,r,i){const n=r-e,s=i-t;return Math.sqrt(n*n+s*s)}function l(e,t,r,i,n,s){const o=i-e,a=n-t,l=s-r;return Math.sqrt(o*o+a*a+l*l)}function c(e,t,r,i){return[e+.5*(r-e),t+.5*(i-t)]}function u(e,t,r,i,n,s){return[e+.5*(i-e),t+.5*(n-t),r+.5*(s-r)]}r.d(t,{Q:function(){return n}})},75707:function(e,t,r){r.d(t,{d:function(){return ce}});var i=r(50659),n=r(39819),s=r(30905),o=r(21609),a=r(95929),l=r(60539),c=r(62938),u=r(46157),h=r(24761),d=r(87416),f=r(35068),p=r(74697),m=r(65298),_=r(57652),g=r(58081),y=r(99680),x=r(16177),b=r(55644);const w=new class{constructor(e,t){this._cache=new y.q(e),this._invalidCache=new y.q(t)}get(e,t){const r=`${t.uid}:${e}`,i=this._cache.get(r);if(i)return i;if(null!=this._invalidCache.get(r))return null;try{const i=x.WhereClause.create(e,{fieldsIndex:t});return this._cache.put(r,i),i}catch(e){return this._invalidCache.put(r,e),null}}getError(e,t){const r=`${t.uid}:${e}`;return this._invalidCache.get(r)??null}}(50,500),v="unsupported-query",S=" as ",T=new Set(["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeBigInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong"]),I=new Set(["esriFieldTypeDate","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]),M=new Set(["esriFieldTypeString","esriFieldTypeGUID","esriFieldTypeGlobalID",...T,...I]);function A(e,t,r={}){const i=P(t,e);if(!i){const r=w.getError(t,e);throw new n.A(v,"invalid SQL expression",{expression:t,error:r})}const s=r.expressionName||"expression";if(r.validateStandardized&&!i.isStandardized)throw new n.A(v,`${s} is not standard`,{expression:t});if(r.validateAggregate&&!i.isAggregate)throw new n.A(v,`${s} does not contain a valid aggregate function`,{expression:t});return i.fieldNames}function E(e,t,r,i,s){if(!r)return!0;const o="having clause",a=A(e,r,{validateAggregate:!0,expressionName:o});F(e,t,a,{expressionName:o,query:s});const l=P(r,e),c=l?.getExpressions().every((t=>{const{aggregateType:r,field:n}=t,s=e.get(n)?.name;return i.some((t=>{const{onStatisticField:i,statisticType:n}=t,o=e.get(i)?.name;return o===s&&n.toLowerCase().trim()===r}))}));if(!c)throw new n.A(v,"expressions in having clause should also exist in outStatistics",{having:r});return!0}function P(e,t){return e?w.get(e,t):null}function C(e){return/\((.*?)\)/.test(e)?e:e.split(S)[0]}function R(e){return e.split(S)[1]}function F(e,t,r,i={}){const s=new Map;if(function(e,t,r,i,n){const s=n.includes("*")?[...r,...n.filter((e=>"*"!==e))]:n;for(const n of s)if(t.get(n))L(e,t,r,i,n);else try{const s=A(t,C(n),{validateStandardized:!0});for(const n of s)L(e,t,r,i,n)}catch(t){e.set(n,{type:"expression-error",expression:n,error:t})}}(s,e,t,i.allowedFieldTypes??M,r),s.size){const e=i.expressionName??"expression";throw new n.A(v,`${e} contains invalid or missing fields`,{errors:Array.from(s.values()),query:i.query})}}function L(e,t,r,i,n){const s=t.get(n);s?r.has(s.name)?"all"!==i&&!1===i?.has(s.type)&&e.set(n,{type:"invalid-type",fieldName:s.name,fieldType:b.m.fromJSON(s.type),allowedFieldTypes:Array.from(i,(e=>b.m.fromJSON(e)))}):e.set(n,{type:"missing-field",fieldName:s.name}):e.set(n,{type:"invalid-field",fieldName:n})}var k=r(78956),N=r(74841);class O{constructor(){this._storage=new Map,this._purgeInterval=5,this._sweep=()=>{if(this._timer=void 0,!this._storage)return;const e=1e3*this._purgeInterval,t=performance.now()-e;for(const[r,i]of this._storage){if(!(i.time<t))return void(this._storage.size>0&&(this._timer=setTimeout(this._sweep,e)));this._storage.delete(r)}}}destroy(){this._storage?.clear(),this._storage=null,clearTimeout(this._timer)}get size(){return this._storage?.size??0}put(e,t){this._storage?.set(e,new z(t)),this._scheduleSweep()}get(e){if(!this._storage)return;const t=this._storage?.get(e);return t?(this._storage?.delete(e),t.time=performance.now(),this._storage?.set(e,t),t.items):void 0}clear(){this._storage?.clear()}_scheduleSweep(){this._storage&&(this._timer??=setTimeout(this._sweep,1e3*this._purgeInterval))}}let D=0;class z{constructor(e){this.items=e,this.time=performance.now(),this.id=D++}}var U=r(7121),G=r(72228),B=r(38503),V=r(87280),q=r(53743),Z=r(92586),H=r(66164),j=r(54547);class W{constructor(e,t,r){this._fieldDataCache=new Map,this._returnDistinctMap=new Map,this.returnDistinctValues=e.returnDistinctValues??!1,this.fieldsIndex=r,this.featureAdapter=t;const i=e.outFields;if(i&&!i.includes("*")){this.outFields=i;let e=0;for(const t of i){const i=C(t),n=this.fieldsIndex.get(i),s=n?null:P(i,r),o=n?n.name:R(t)||"FIELD_EXP_"+e++;this._fieldDataCache.set(t,{alias:o,clause:s})}}}countDistinctValues(e){return this.returnDistinctValues?(e.forEach((e=>this.getAttributes(e))),this._returnDistinctMap.size):e.length}getAttributes(e){const t=this._processAttributesForOutFields(e);return this._processAttributesForDistinctValues(t)}getFieldValue(e,t,r){const i=r?r.name:t;let n=null;return this._fieldDataCache.has(i)?n=this._fieldDataCache.get(i)?.clause:r||(n=P(t,this.fieldsIndex),this._fieldDataCache.set(i,{alias:i,clause:n})),r?this.featureAdapter.getAttribute(e,i):n?.calculateValue(e,this.featureAdapter)}getDataValues(e,t,r=!0){const i=t.normalizationType,n=t.normalizationTotal,s=this.fieldsIndex.get(t.field),o=(0,q.zD)(s)||(0,q.Ah)(s),a=(0,q.OH)(s);return e.map((e=>{let s=t.field&&this.getFieldValue(e,t.field,this.fieldsIndex.get(t.field));if(t.field2?(s=`${(0,H.gJ)(s)}${t.fieldDelimiter}${(0,H.gJ)(this.getFieldValue(e,t.field2,this.fieldsIndex.get(t.field2)))}`,t.field3&&(s=`${s}${t.fieldDelimiter}${(0,H.gJ)(this.getFieldValue(e,t.field3,this.fieldsIndex.get(t.field3)))}`)):"string"==typeof s&&r&&(o?s=s?new Date(s).getTime():null:a&&(s=s?(0,Z.rb)(s):null)),i&&Number.isFinite(s)){const r="field"===i&&t.normalizationField?this.getFieldValue(e,t.normalizationField,this.fieldsIndex.get(t.normalizationField)):null;s=(0,H.zS)(s,i,r,n)}return s}))}async getExpressionValues(e,t,r,i,n){const{arcadeUtils:s}=await(0,j.lw)(),o=s.hasGeometryOperations(t);o&&await s.enableGeometryOperations();const a=s.createFunction(t),l=s.getViewInfo(r),c={fields:this.fieldsIndex.fields};return e.map((e=>{const t={attributes:this.featureAdapter.getAttributes(e),layer:c,geometry:o?{...(0,k.pL)(i.geometryType,i.hasZ,i.hasM,this.featureAdapter.getGeometry(e)),spatialReference:r?.spatialReference}:null},u=s.createExecContext(t,l,n);return s.executeFunction(a,u)}))}validateItem(e,t){return this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:P(t,this.fieldsIndex)}),this._fieldDataCache.get(t)?.clause?.testFeature(e,this.featureAdapter)??!1}validateItems(e,t){return this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:P(t,this.fieldsIndex)}),this._fieldDataCache.get(t)?.clause?.testSet(e,this.featureAdapter)??!1}_processAttributesForOutFields(e){const t=this.outFields;if(!t?.length)return this.featureAdapter.getAttributes(e);const r={};for(const i of t){const{alias:t,clause:n}=this._fieldDataCache.get(i);r[t]=n?n.calculateValue(e,this.featureAdapter):this.featureAdapter.getAttribute(e,t)}return r}_processAttributesForDistinctValues(e){if(null==e||!this.returnDistinctValues)return e;const t=this.outFields,r=[];if(t)for(const i of t){const{alias:t}=this._fieldDataCache.get(i);r.push(e[t])}else for(const t in e)r.push(e[t]);const i=`${(t||["*"]).join(",")}=${r.join(",")}`;let n=this._returnDistinctMap.get(i)||0;return this._returnDistinctMap.set(i,++n),n>1?null:e}}var Y=r(51376);class ${constructor(e,t,r){this.items=e,this.query=t,this.geometryType=r.geometryType,this.hasM=r.hasM,this.hasZ=r.hasZ,this.fieldsIndex=r.fieldsIndex,this.objectIdField=r.objectIdField,this.spatialReference=r.spatialReference,this.featureAdapter=r.featureAdapter}get size(){return this.items.length}createQueryResponseForCount(){const e=new W(this.query,this.featureAdapter,this.fieldsIndex);if(!this.query.outStatistics)return e.countDistinctValues(this.items);const{groupByFieldsForStatistics:t,having:r,outStatistics:i}=this.query,n=t?.length;if(!n)return 1;const s=new Map,o=new Map,a=new Set;for(const n of i){const{statisticType:i}=n,l="exceedslimit"!==i?n.onStatisticField:void 0;if(!o.has(l)){const r=[];for(const i of t){const t=this._getAttributeValues(e,i,s);r.push(t)}o.set(l,this._calculateUniqueValues(r,e.returnDistinctValues))}const c=o.get(l);for(const t in c){const{data:i,items:n}=c[t],s=i.join(",");r&&!e.validateItems(n,r)||a.add(s)}}return a.size}async createQueryResponse(){let e;if(e=this.query.outStatistics?this.query.outStatistics.some((e=>"exceedslimit"===e.statisticType))?this._createExceedsLimitQueryResponse(this.query):await this._createStatisticsQueryResponse(this.query):this._createFeatureQueryResponse(this.query),this.query.returnQueryGeometry){const t=this.query.geometry;(0,_.fn)(this.query.outSR)&&!(0,_.aI)(t.spatialReference,this.query.outSR)?e.queryGeometry=(0,k.ag)({spatialReference:this.query.outSR,...(0,N.Cv)(t,t.spatialReference,this.query.outSR)}):e.queryGeometry=(0,k.ag)({spatialReference:this.query.outSR,...t})}return e}createSnappingResponse(e,t){const r=this.featureAdapter,i=Q(this.hasZ,this.hasM),{point:n,mode:s}=e,o="number"==typeof e.distance?e.distance:e.distance.x,a="number"==typeof e.distance?e.distance:e.distance.y,l={candidates:[]},c="esriGeometryPolygon"===this.geometryType,u=this._getPointCreator(s,this.spatialReference,t),h=new J(null,0),d=new J(null,0),f={x:0,y:0,z:0};for(const t of this.items){const s=r.getGeometry(t);if(null==s)continue;const{coords:p,lengths:m}=s;if(h.coords=p,d.coords=p,e.returnEdge){let e=0;for(let s=0;s<m.length;s++){const c=m[s];for(let s=0;s<c;s++,e+=i){const p=h;if(p.coordsIndex=e,s!==c-1){const s=d;s.coordsIndex=e+i;const c=f;X(f,n,p,s);const h=(n.x-c.x)/o,m=(n.y-c.y)/a,_=h*h+m*m;_<=1&&l.candidates.push((0,Y.P)(r.getObjectId(t),u(c),Math.sqrt(_),u(p),u(s)))}}}}if("none"!==e.vertexMode){const s=c?p.length-i:p.length;if("all"===e.vertexMode)for(let e=0;e<s;e+=i){const i=h;i.coordsIndex=e;const s=(n.x-i.x)/o,c=(n.y-i.y)/a,d=s*s+c*c;d<=1&&l.candidates.push((0,Y.k)(r.getObjectId(t),u(i),Math.sqrt(d)))}else if("ends"===e.vertexMode){const e=[0];c||e.push(p.length-i);for(const i of e){const e=h;e.coordsIndex=i;const s=(n.x-e.x)/o,c=(n.y-e.y)/a,d=s*s+c*c;d<=1&&l.candidates.push((0,Y.k)(r.getObjectId(t),u(e),Math.sqrt(d)))}}}}return l.candidates.sort(((e,t)=>e.distance-t.distance)),l}_getPointCreator(e,t,r){const i=null==r||(0,_.aI)(t,r)?e=>e:e=>(0,N.Cv)(e,t,r),{hasZ:n}=this;return"3d"===e?n?({x:e,y:t,z:r})=>i({x:e,y:t,z:r}):({x:e,y:t})=>i({x:e,y:t,z:0}):({x:e,y:t})=>i({x:e,y:t})}async createSummaryStatisticsResponse(e){const{field:t,valueExpression:r,normalizationField:i,normalizationType:n,normalizationTotal:s,minValue:o,maxValue:a,scale:l,timeZone:c,outStatisticTypes:u}=e,h=this.fieldsIndex.get(t),d=(0,q.vE)(h)||(0,q.zD)(h)||(0,q.Ah)(h),f=await this._getDataValues({field:t,valueExpression:r,normalizationField:i,normalizationType:n,normalizationTotal:s,scale:l,timeZone:c}),p=(0,H.Vb)({normalizationType:n,normalizationField:i,minValue:o,maxValue:a}),m={value:.5,fieldType:h?.type},_=(0,q.yM)(h)?(0,H.z9)({values:f,supportsNullCount:p,percentileParams:m,outStatisticTypes:u}):(0,H.G_)({values:f,minValue:o,maxValue:a,useSampleStdDev:!n,supportsNullCount:p,percentileParams:m,outStatisticTypes:u});return(0,H.oZ)(_,u,d)}async createUniqueValuesResponse(e){const{field:t,valueExpression:r,domains:i,returnAllCodedValues:n,scale:s,timeZone:o}=e,a=await this._getDataValues({field:t,field2:e.field2,field3:e.field3,fieldDelimiter:e.fieldDelimiter,valueExpression:r,scale:s,timeZone:o},!1),l=(0,H.b3)(a);return(0,H.lv)(l,i,n,e.fieldDelimiter)}async createClassBreaksResponse(e){const{field:t,valueExpression:r,normalizationField:i,normalizationType:n,normalizationTotal:s,classificationMethod:o,standardDeviationInterval:a,minValue:l,maxValue:c,numClasses:u,scale:h,timeZone:d}=e,f=await this._getDataValues({field:t,valueExpression:r,normalizationField:i,normalizationType:n,normalizationTotal:s,scale:h,timeZone:d}),p=(0,H.Rw)(f,{field:t,normalizationField:i,normalizationType:n,normalizationTotal:s,classificationMethod:o,standardDeviationInterval:a,minValue:l,maxValue:c,numClasses:u});return(0,H.jM)(p,o)}async createHistogramResponse(e){const{field:t,valueExpression:r,normalizationField:i,normalizationType:n,normalizationTotal:s,classificationMethod:o,standardDeviationInterval:a,minValue:l,maxValue:c,numBins:u,scale:h,timeZone:d}=e,f=await this._getDataValues({field:t,valueExpression:r,normalizationField:i,normalizationType:n,normalizationTotal:s,scale:h,timeZone:d});return(0,H.$y)(f,{field:t,normalizationField:i,normalizationType:n,normalizationTotal:s,classificationMethod:o,standardDeviationInterval:a,minValue:l,maxValue:c,numBins:u})}_sortFeatures(e,t,r){if(e.length>1&&t?.length)for(const i of t.reverse()){const t=i.split(" "),n=t[0],s=this.fieldsIndex.get(n),o=!!t[1]&&"desc"===t[1].toLowerCase(),a=(0,H.FM)(s?.type,o);e.sort(((e,t)=>{const i=r(e,n,s),o=r(t,n,s);return a(i,o)}))}}_createFeatureQueryResponse(e){const t=this.items,{geometryType:r,hasM:i,hasZ:n,objectIdField:s,spatialReference:o}=this,{outFields:a,outSR:l,quantizationParameters:c,resultRecordCount:u,resultOffset:h,returnZ:d,returnM:f}=e,p=null!=u&&t.length>(h||0)+u,m=a&&(a.includes("*")?[...this.fieldsIndex.fields]:a.map((e=>this.fieldsIndex.get(e))));return{exceededTransferLimit:p,features:this._createFeatures(e,t),fields:m,geometryType:r,hasM:i&&f,hasZ:n&&d,objectIdFieldName:s,spatialReference:(0,k.ag)(l||o),transform:c&&(0,V.VV)(c)||null}}_createFeatures(e,t){const r=new W(e,this.featureAdapter,this.fieldsIndex),{hasM:i,hasZ:n}=this,{orderByFields:s,quantizationParameters:o,returnGeometry:a,returnCentroid:l,maxAllowableOffset:c,resultOffset:u,resultRecordCount:h,returnZ:d=!1,returnM:f=!1}=e,p=n&&d,m=i&&f;let _=[],g=0;const y=[...t];if(this._sortFeatures(y,s,((e,t,i)=>r.getFieldValue(e,t,i))),this.geometryType&&(a||l)){const e=(0,V.VV)(o)??void 0,t="esriGeometryPolygon"===this.geometryType||"esriGeometryPolyline"===this.geometryType;if(a&&!l)for(const i of y){const n=this.featureAdapter.getGeometry(i),s={attributes:r.getAttributes(i),geometry:(0,k.pL)(this.geometryType,this.hasZ,this.hasM,n,c,e,p,m)};t&&n&&!s.geometry&&(s.centroid=(0,k.LQ)(this,this.featureAdapter.getCentroid(i,this),e)),_[g++]=s}else if(!a&&l)for(const t of y)_[g++]={attributes:r.getAttributes(t),centroid:(0,k.LQ)(this,this.featureAdapter.getCentroid(t,this),e)};else for(const t of y)_[g++]={attributes:r.getAttributes(t),centroid:(0,k.LQ)(this,this.featureAdapter.getCentroid(t,this),e),geometry:(0,k.pL)(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(t),c,e,p,m)}}else for(const e of y){const t=r.getAttributes(e);t&&(_[g++]={attributes:t})}const x=u||0;if(null!=h){const e=x+h;_=_.slice(x,Math.min(_.length,e))}return _}_createExceedsLimitQueryResponse(e){let t=!1,r=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,n=Number.POSITIVE_INFINITY;for(const t of e.outStatistics??[])if("exceedslimit"===t.statisticType){r=null!=t.maxPointCount?t.maxPointCount:Number.POSITIVE_INFINITY,i=null!=t.maxRecordCount?t.maxRecordCount:Number.POSITIVE_INFINITY,n=null!=t.maxVertexCount?t.maxVertexCount:Number.POSITIVE_INFINITY;break}if("esriGeometryPoint"===this.geometryType)t=this.items.length>r;else if(this.items.length>i)t=!0;else{const e=Q(this.hasZ,this.hasM),r=this.featureAdapter;t=this.items.reduce(((e,t)=>{const i=r.getGeometry(t);return e+(null!=i&&i.coords.length||0)}),0)/e>n}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(t)}}]}}async _createStatisticsQueryResponse(e){const t={attributes:{}},r=[],i=new Map,n=new Map,s=new Map,o=new Map,a=new W(e,this.featureAdapter,this.fieldsIndex),l=e.outStatistics,{groupByFieldsForStatistics:c,having:u,orderByFields:h,resultRecordCount:d}=e,f=c?.length,p=!!f,m=p?c[0]:null,_=p&&!this.fieldsIndex.get(m);for(const e of l??[]){const{outStatisticFieldName:l,statisticType:h}=e,d=e,g="exceedslimit"!==h?e.onStatisticField:void 0,y="percentile_disc"===h||"percentile_cont"===h,x="EnvelopeAggregate"===h||"CentroidAggregate"===h||"ConvexHullAggregate"===h,b=p&&1===f&&(g===m||_)&&"count"===h;if(p){if(!s.has(g)){const e=[];for(const t of c){const r=this._getAttributeValues(a,t,i);e.push(r)}s.set(g,this._calculateUniqueValues(e,!x&&a.returnDistinctValues))}const e=s.get(g);if(!e)continue;const t=Object.keys(e);for(const r of t){const{count:t,data:n,items:s,itemPositions:h}=e[r],f=n.join(",");if(!u||a.validateItems(s,u)){const e=o.get(f)||{attributes:{}};if(x){e.aggregateGeometries||(e.aggregateGeometries={});const{aggregateGeometries:t,outStatisticFieldName:r}=await this._getAggregateGeometry(d,s);e.aggregateGeometries[r]=t}else{let r=null;if(b)r=t;else{const e=this._getAttributeValues(a,g,i),t=h.map((t=>e[t]));r=y&&"statisticParameters"in d?this._getPercentileValue(d,t):this._getStatisticValue(d,t,null,a.returnDistinctValues)}e.attributes[l]=r}let r=0;c.forEach(((t,i)=>e.attributes[this.fieldsIndex.get(t)?t:"EXPR_"+ ++r]=n[i])),o.set(f,e)}}}else if(x){t.aggregateGeometries||(t.aggregateGeometries={});const{aggregateGeometries:e,outStatisticFieldName:r}=await this._getAggregateGeometry(d,this.items);t.aggregateGeometries[r]=e}else{const e=this._getAttributeValues(a,g,i);t.attributes[l]=y&&"statisticParameters"in d?this._getPercentileValue(d,e):this._getStatisticValue(d,e,n,a.returnDistinctValues)}const w="min"!==h&&"max"!==h||!(0,q.yM)(this.fieldsIndex.get(g))&&!this._isAnyDateField(g)?null:this.fieldsIndex.get(g)?.type;r.push({name:l,alias:l,type:w||"esriFieldTypeDouble"})}const g=p?Array.from(o.values()):[t];return this._sortFeatures(g,h,((e,t)=>e.attributes[t])),d&&(g.length=Math.min(d,g.length)),{fields:r,features:g}}_isAnyDateField(e){const t=this.fieldsIndex.get(e);return(0,q.vE)(t)||(0,q.zD)(t)||(0,q.Ah)(t)||(0,q.OH)(t)}async _getAggregateGeometry(e,t){const{convexHull:i,union:n}=await r.e(4696).then(r.bind(r,28356)),{statisticType:s,outStatisticFieldName:o}=e,{featureAdapter:a,spatialReference:l,geometryType:c,hasZ:u,hasM:h}=this,d=t.map((e=>(0,k.pL)(c,u,h,a.getGeometry(e)))),f=i(l,d,!0)[0],p={aggregateGeometries:null,outStatisticFieldName:null};if("EnvelopeAggregate"===s){const e=f?(0,B.v)(f):(0,B.HA)(n(l,d));p.aggregateGeometries={...e,spatialReference:l},p.outStatisticFieldName=o||"extent"}else if("CentroidAggregate"===s){const e=f?(0,G.l8)(f):(0,G.Z4)((0,B.HA)(n(l,d)));p.aggregateGeometries={x:e[0],y:e[1],spatialReference:l},p.outStatisticFieldName=o||"centroid"}else"ConvexHullAggregate"===s&&(p.aggregateGeometries=f,p.outStatisticFieldName=o||"convexHull");return p}_getStatisticValue(e,t,r,i){const{onStatisticField:n,statisticType:s}=e;let o=null;return o=r?.has(n)?r.get(n):(0,q.yM)(this.fieldsIndex.get(n))||this._isAnyDateField(n)?(0,H.z9)({values:t,returnDistinct:i}):(0,H.G_)({values:i?[...new Set(t)]:t,minValue:null,maxValue:null,useSampleStdDev:!0}),r&&r.set(n,o),o["var"===s?"variance":s]}_getPercentileValue(e,t){const{onStatisticField:r,statisticParameters:i,statisticType:n}=e,{value:s,orderBy:o}=i,a=this.fieldsIndex.get(r);return(0,H.qg)(t,{value:s,orderBy:o,fieldType:a?.type,isDiscrete:"percentile_disc"===n})}_getAttributeValues(e,t,r){if(r.has(t))return r.get(t);const i=this.fieldsIndex.get(t),n=this.items.map((r=>e.getFieldValue(r,t,i)));return r.set(t,n),n}_calculateUniqueValues(e,t){const r={},i=this.items,n=i.length;for(let s=0;s<n;s++){const n=i[s],o=[];for(const t of e)o.push(t[s]);const a=o.join(",");null==r[a]?r[a]={count:1,data:o,items:[n],itemPositions:[s]}:(t||r[a].count++,r[a].items.push(n),r[a].itemPositions.push(s))}return r}async _getDataValues(e,t=!0){const r=new W(this.query,this.featureAdapter,this.fieldsIndex),{valueExpression:i,scale:n,timeZone:s}=e;return i?r.getExpressionValues(this.items,i,{viewingMode:"map",scale:n,spatialReference:this.query.outSR||this.spatialReference},{geometryType:this.geometryType,hasZ:this.hasZ,hasM:this.hasM},s):r.getDataValues(this.items,(0,o.o8)(e),t)}}function X(e,t,r,i){const n=i.x-r.x,s=i.y-r.y,o=n*n+s*s,a=(t.x-r.x)*n+(t.y-r.y)*s,l=Math.min(1,Math.max(0,a/o));e.x=r.x+n*l,e.y=r.y+s*l}function Q(e,t){return e?t?4:3:t?3:2}class J{constructor(e,t){this.coords=e,this.coordsIndex=t}get x(){return this.coords[this.coordsIndex]}get y(){return this.coords[this.coordsIndex+1]}get z(){return this.coords[this.coordsIndex+2]}}var K=r(20932),ee=r(62512);const te="unsupported-query";async function re(e,{fieldsIndex:t,geometryType:r,spatialReference:i,availableFields:s}){if((e.distance??0)<0||null!=e.geometryPrecision||e.multipatchOption&&"xyFootprint"!==e.multipatchOption||e.pixelSize||e.relationParam||e.text)throw new n.A(te,"Unsupported query options",{query:e});return ie(t,s,e),function(e,t,r){const{outStatistics:i,groupByFieldsForStatistics:s,having:o}=r,a=s?.length,l=i?.length;if(o){if(!a||!l)throw new n.A(te,"outStatistics and groupByFieldsForStatistics should be specified with having",{query:r});E(e,t,o,i,r)}if(l){if(null==(c=i)||!c.every((e=>"exceedslimit"!==e.statisticType)))return;const o=i.map((e=>e.onStatisticField)).filter(Boolean);F(e,t,o,{expressionName:"onStatisticFields",query:r}),a&&F(e,t,s,{expressionName:"groupByFieldsForStatistics",query:r});for(const s of i){const{onStatisticField:i,statisticType:o}=s;if("percentile_disc"!==o&&"percentile_cont"!==o||!("statisticParameters"in s))e.get(i)&&"count"!==o&&"min"!==o&&"max"!==o&&F(e,t,[i],{expressionName:`outStatistics with '${o}' statistic type`,allowedFieldTypes:ne,query:r});else{const{statisticParameters:e}=s;if(!e)throw new n.A(te,"statisticParameters should be set for percentile type",{definition:s,query:r})}}}var c}(t,s,e),Promise.all([(0,ee.c0)(e,r,i),(0,N.Nk)(i,e.outSR)]).then((()=>e))}function ie(e,t,r){const{outFields:i,orderByFields:s,returnDistinctValues:o,outStatistics:a}=r,l=a?a.map((e=>e.outStatisticFieldName&&e.outStatisticFieldName.toLowerCase())).filter(Boolean):[];if(s&&s.length>0){const i=" asc",n=" desc",o=s.map((e=>{const t=e.toLowerCase();return t.includes(i)?t.split(i)[0]:t.includes(n)?t.split(n)[0]:e})).filter((e=>!l.includes(e)));F(e,t,o,{expressionName:"orderByFields",query:r})}if(i&&i.length>0)F(e,t,i,{expressionName:"outFields",query:r,allowedFieldTypes:"all"});else if(o)throw new n.A(te,"outFields should be specified for returnDistinctValues",{query:r});!function(e,t,r,i){if(!r)return!0;const n="where clause";F(e,t,A(e,r,{validateStandardized:!0,expressionName:n}),{expressionName:n,query:i})}(e,t,r.where,r)}const ne=new Set([...T,...I]);async function se(e,t,r,i){let s=[];if(r.valueExpression){const{arcadeUtils:e}=await(0,j.lw)();s=e.extractFieldNames(r.valueExpression)}if(r.field&&s.push(r.field),r.field2&&s.push(r.field2),r.field3&&s.push(r.field3),r.normalizationField&&s.push(r.normalizationField),!s.length&&!r.valueExpression)throw new n.A(te,"field or valueExpression is required",{params:r});F(e,t,s,{expressionName:"statistics",query:i})}var oe=r(20973),ae=r(7103),le=r(48961);class ce{constructor(e){this._cache=new O,this._changeHandle=null,this.capabilities={query:U.F},this.geometryType=e.geometryType,this.hasM=!!e.hasM,this.hasZ=!!e.hasZ,this.objectIdField=e.objectIdField,this.spatialReference=e.spatialReference,this.definitionExpression=e.definitionExpression,this.featureStore=e.featureStore,this.aggregateAdapter=e.aggregateAdapter,this._changeHandle=this.featureStore.events.on("changed",(()=>this.clearCache())),this.timeInfo=e.timeInfo,this.fieldsIndex=(0,s.Wj)(e.fieldsIndex)?e.fieldsIndex:ae.A.fromJSON(e.fieldsIndex),!e.availableFields||1===e.availableFields.length&&"*"===e.availableFields[0]?this.availableFields=new Set(this.fieldsIndex.fields.map((e=>e.name))):this.availableFields=new Set(e.availableFields.map((e=>this.fieldsIndex.get(e)?.name)).filter((e=>null!=e))),e.scheduler&&e.priority&&(this._frameTask=e.scheduler.registerTask(e.priority))}destroy(){this._frameTask=(0,a.xt)(this._frameTask),this.clearCache(),(0,a.pR)(this._cache),this._changeHandle=(0,a.xt)(this._changeHandle)}get featureAdapter(){return this.featureStore.featureAdapter}clearCache(){this._cache.clear(),this._allFeaturesPromise=null,this._timeExtentPromise=null,this._fullExtentPromise=null}async executeQuery(e,t){const r=(0,l.Mq)(t);try{const t=await this._executeQuery(e,{},r);return await t.createQueryResponse()}catch(t){if(t!==K.v8)throw t;return new $([],e,this).createQueryResponse()}}async executeQueryForCount(e={},t){const r=(0,l.Mq)(t);try{return(await this._executeQuery(e,{returnGeometry:!1,returnCentroid:!1,outSR:null},r)).createQueryResponseForCount()}catch(e){if(e!==K.v8)throw e;return 0}}async executeQueryForExtent(e,t){const r=(0,l.Mq)(t),i=e.outSR;try{const t=await this._executeQuery(e,{returnGeometry:!0,returnCentroid:!1,outSR:null},r),n=t.size;return n?{count:n,extent:await this._getBounds(t.items,t.spatialReference,i||this.spatialReference)}:{count:0,extent:null}}catch(e){if(e===K.v8)return{count:0,extent:null};throw e}}async executeQueryForIds(e,t){return this.executeQueryForIdSet(e,t).then((e=>Array.from(e)))}async executeQueryForIdSet(e,t){const r=(0,l.Mq)(t);try{const t=await this._executeQuery(e,{returnGeometry:!0,returnCentroid:!1,outSR:null},r),i=t.items,n=new Set;return await this._reschedule((()=>{for(const e of i)n.add(t.featureAdapter.getObjectId(e))}),r),n}catch(e){if(e===K.v8)return new Set;throw e}}async executeQueryForSnapping(e,t){const r=(0,l.Mq)(t),{point:i,distance:n,returnEdge:s,vertexMode:a}=e;if(!s&&"none"===a)return{candidates:[]};let c=(0,o.o8)(e.query);c=await this._schedule((()=>(0,K.T2)(c,this.definitionExpression,this.spatialReference)),r),c=await this._reschedule((()=>re(c,{availableFields:this.availableFields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,spatialReference:this.spatialReference})),r);const u=!(0,_.aI)(i.spatialReference,this.spatialReference);u&&await(0,N.Nk)(i.spatialReference,this.spatialReference);const h="number"==typeof n?n:n.x,d="number"==typeof n?n:n.y,f={xmin:i.x-h,xmax:i.x+h,ymin:i.y-d,ymax:i.y+d,spatialReference:i.spatialReference},g=u?(0,N.Cv)(f,this.spatialReference):f;if(!g)return{candidates:[]};const y=(await(0,m.el)((0,p.rS)(i),null,{signal:r}))[0],x=(await(0,m.el)((0,p.rS)(g),null,{signal:r}))[0];if(null==y||null==x)return{candidates:[]};const b=new $(await this._reschedule((()=>this._searchFeatures(ue(x.toJSON()))),r),c,this);await this._reschedule((()=>this._executeObjectIdsQuery(b)),r),await this._reschedule((()=>this._executeTimeQuery(b)),r),await this._reschedule((()=>this._executeAttributesQuery(b)),r),await this._reschedule((()=>this._executeGeometryQueryForSnapping(b,r)),r);const w=y.toJSON(),v=u?(0,N.Cv)(w,this.spatialReference):w,S=u?Math.max(g.xmax-g.xmin,g.ymax-g.ymin)/2:n;return b.createSnappingResponse({...e,point:v,distance:S},i.spatialReference)}async executeQueryForLatestObservations(e,t){const r=(0,l.Mq)(t);if(!this.timeInfo?.trackIdField)throw new n.A("unsupported-query","Missing timeInfo or timeInfo.trackIdField",{query:e,timeInfo:this.timeInfo});try{const t=await this._executeQuery(e,{},r);return await this._reschedule((()=>this._filterLatest(t)),r),await t.createQueryResponse()}catch(t){if(t!==K.v8)throw t;return new $([],e,this).createQueryResponse()}}async executeQueryForSummaryStatistics(e={},t,r){const i=(0,l.Mq)(r),{field:n,normalizationField:s,valueExpression:o}=t;return(await this._executeQueryForStatistics(e,{field:n,normalizationField:s,valueExpression:o},i)).createSummaryStatisticsResponse(t)}async executeQueryForUniqueValues(e={},t,r){const i=(0,l.Mq)(r),{field:n,field2:s,field3:o,valueExpression:a}=t;return(await this._executeQueryForStatistics(e,{field:n,field2:s,field3:o,valueExpression:a},i)).createUniqueValuesResponse(t)}async executeQueryForClassBreaks(e={},t,r){const i=(0,l.Mq)(r),{field:n,normalizationField:s,valueExpression:o}=t;return(await this._executeQueryForStatistics(e,{field:n,normalizationField:s,valueExpression:o},i)).createClassBreaksResponse(t)}async executeQueryForHistogram(e={},t,r){const i=(0,l.Mq)(r),{field:n,normalizationField:s,valueExpression:o}=t;return(await this._executeQueryForStatistics(e,{field:n,normalizationField:s,valueExpression:o},i)).createHistogramResponse(t)}async fetchRecomputedExtents(e){const t=(0,l.Mq)(e);this._timeExtentPromise||=(0,oe.W)(this.timeInfo,this.featureStore);const[r,i]=await Promise.all([this._getFullExtent(),this._timeExtentPromise]);return(0,l.Te)(t),{fullExtent:r,timeExtent:i}}async _getBounds(e,t,r){const i=(0,h.hZ)((0,h.vt)(),h.qv);await this.featureStore.forEachBounds(e,(e=>(0,h.RF)(i,e)));const n={xmin:i[0],ymin:i[1],xmax:i[3],ymax:i[4],spatialReference:(0,k.ag)(this.spatialReference)};this.hasZ&&isFinite(i[2])&&isFinite(i[5])&&(n.zmin=i[2],n.zmax=i[5],n.hasZ=!0);const s=(0,N.Cv)(n,t,r);if(s.spatialReference=(0,k.ag)(r),s.xmax-s.xmin==0){const e=(0,c.GA)(s.spatialReference);s.xmin-=e,s.xmax+=e}if(s.ymax-s.ymin==0){const e=(0,c.GA)(s.spatialReference);s.ymin-=e,s.ymax+=e}if(this.hasZ&&null!=s.zmin&&null!=s.zmax&&s.zmax-s.zmin==0){const e=(0,c.GA)(s.spatialReference);s.zmin-=e,s.zmax+=e}return s}_getFullExtent(){return this._fullExtentPromise||="getFullExtent"in this.featureStore&&this.featureStore.getFullExtent?Promise.resolve(this.featureStore.getFullExtent(this.spatialReference)):this._getAllFeatures().then((e=>this._getBounds(e,this.spatialReference,this.spatialReference))),this._fullExtentPromise}async _schedule(e,t){return null!=this._frameTask?this._frameTask.schedule(e,t):e(le.Bb)}async _reschedule(e,t){return null!=this._frameTask?this._frameTask.reschedule(e,t):e(le.Bb)}async _getAllFeaturesQueryEngineResult(e){return new $(await this._getAllFeatures(),e,this)}async _getAllFeatures(){if(null==this._allFeaturesPromise){const e=[];this._allFeaturesPromise=(async()=>{await this.featureStore.forEach((t=>e.push(t)))})().then((()=>e))}const e=this._allFeaturesPromise,t=await e;return e===this._allFeaturesPromise?t.slice():this._getAllFeatures()}async _executeQuery(e,t,r){e=(0,o.o8)(e),e=await this._schedule((()=>(0,K.GC)(e,this.definitionExpression,this.spatialReference)),r),e=await this._reschedule((()=>re(e,{availableFields:this.availableFields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,spatialReference:this.spatialReference})),r),e={...e,...t};const i=await this._reschedule((()=>this._executeSceneFilterQuery(e,r)),r),n=await this._reschedule((()=>this._executeGeometryQuery(e,i,r)),r);return await this._reschedule((()=>this._executeAggregateIdsQuery(n)),r),await this._reschedule((()=>this._executeObjectIdsQuery(n)),r),await this._reschedule((()=>this._executeTimeQuery(n)),r),await this._reschedule((()=>this._executeAttributesQuery(n)),r),n}async _executeSceneFilterQuery(e,t){if(null==e.sceneFilter)return null;const{outSR:r,returnGeometry:i,returnCentroid:n}=e,s=this.featureStore.featureSpatialReference,o=e.sceneFilter.geometry,a=null==s||(0,_.aI)(s,o.spatialReference)?o:(0,N.Cv)(o,s);if(!a)return null;const l=i||n,c=(0,_.fn)(r)&&!(0,_.aI)(this.spatialReference,r)&&l?async e=>this._project(e,r):e=>e,u=this.featureAdapter,h=await this._reschedule((()=>this._searchFeatures(ue(a))),t);if("disjoint"===e.sceneFilter.spatialRelationship){if(!h.length)return null;const r=new Set;for(const e of h)r.add(u.getObjectId(e));const i=await this._reschedule((()=>this._getAllFeatures()),t),n=await this._reschedule((async()=>{const n=await(0,ee.xt)("esriSpatialRelDisjoint",a,this.geometryType,this.hasZ,this.hasM),s=await this._runSpatialFilter(i,(e=>!r.has(u.getObjectId(e))||n(u.getGeometry(e))),t);return new $(s,e,this)}),t);return c(n)}if(!h.length)return new $([],e,this);if(this._canExecuteSinglePass(a,e))return c(new $(h,e,this));const d=await(0,ee.xt)("esriSpatialRelContains",a,this.geometryType,this.hasZ,this.hasM),f=await this._runSpatialFilter(h,(e=>d(u.getGeometry(e))),t);return c(new $(f,e,this))}async _executeGeometryQuery(e,t,r){if(null!=t&&0===t.items.length)return t;e=null!=t?t.query:e;const{geometry:n,outSR:s,spatialRel:o,returnGeometry:a,returnCentroid:l}=e,c=this.featureStore.featureSpatialReference,u=!n||null==c||(0,_.aI)(c,n.spatialReference)?n:(0,N.Cv)(n,c),h=a||l,d=(0,_.fn)(s)&&!(0,_.aI)(this.spatialReference,s),f=null==t?this._getCacheKey(e):null,p=f?this._cache.get(f):null;if(null!=p)return new $(p,e,this);const m=async e=>(d&&h&&await this._project(e,s),f&&this._cache.put(f,e.items),e);if(!u)return m(null!=t?t:await this._getAllFeaturesQueryEngineResult(e));const g=this.featureAdapter;let y=await this._reschedule((()=>this._searchFeatures(ue(n))),r);if("esriSpatialRelDisjoint"===o){if(!y.length)return m(null!=t?t:await this._getAllFeaturesQueryEngineResult(e));const i=new Set;for(const e of y)i.add(g.getObjectId(e));const n=null!=t?t.items:await this._reschedule((()=>this._getAllFeatures()),r),s=await this._reschedule((async()=>{const t=await(0,ee.xt)(o,u,this.geometryType,this.hasZ,this.hasM),s=await this._runSpatialFilter(n,(e=>!i.has(g.getObjectId(e))||t(g.getGeometry(e))),r);return new $(s,e,this)}),r);return m(s)}if(null!=t){const e=new i.vW;y=y.filter((r=>(0,i.qh)(t.items,r,t.items.length,e)>=0))}if(!y.length){const t=new $([],e,this);return f&&this._cache.put(f,t.items),t}if(this._canExecuteSinglePass(u,e))return m(new $(y,e,this));const x=await(0,ee.xt)(o,u,this.geometryType,this.hasZ,this.hasM),b=await this._runSpatialFilter(y,(e=>x(g.getGeometry(e))),r);return m(new $(b,e,this))}async _executeGeometryQueryForSnapping(e,t){const{query:r}=e,{spatialRel:i}=r;if(!e?.items?.length||!r.geometry||!i)return;const n=await(0,ee.xt)(i,r.geometry,this.geometryType,this.hasZ,this.hasM),s=await this._runSpatialFilter(e.items,(e=>n(e.geometry)),t);e.items=s}_executeAggregateIdsQuery(e){if(0===e.items.length||!e.query.aggregateIds?.length||null==this.aggregateAdapter)return;const t=new Set;for(const r of e.query.aggregateIds)this.aggregateAdapter.getFeatureObjectIds(r).forEach((e=>t.add(e)));const r=this.featureAdapter.getObjectId;e.items=e.items.filter((e=>t.has(r(e))))}_executeObjectIdsQuery(e){if(0===e.items.length||!e.query.objectIds?.length)return;const t=new Set(e.query.objectIds),r=this.featureAdapter.getObjectId;e.items=e.items.filter((e=>t.has(r(e))))}_executeTimeQuery(e){if(0===e.items.length)return;const t=(0,oe.I)(this.timeInfo,e.query.timeExtent,this.featureAdapter);null!=t&&(e.items=e.items.filter(t))}_executeAttributesQuery(e){if(0===e.items.length)return;const t=P(e.query.where,this.fieldsIndex);if(t){if(!t.isStandardized)throw new TypeError("Where clause is not standardized");e.items=e.items.filter((e=>t.testFeature(e,this.featureAdapter)))}}async _runSpatialFilter(e,t,r){if(!t)return e;if(null==this._frameTask)return e.filter((e=>t(e)));let i=0;const n=new Array,s=async o=>{for(;i<e.length;){const a=e[i++];t(a)&&(n.push(a),o.madeProgress()),o.done&&await this._reschedule((e=>s(e)),r)}};return this._reschedule((e=>s(e)),r).then((()=>n))}_filterLatest(e){const{trackIdField:t,startTimeField:r,endTimeField:i}=this.timeInfo,n=i||r,s=new Map,o=this.featureAdapter.getAttribute;for(const r of e.items){const e=o(r,t),i=o(r,n),a=s.get(e);(!a||i>o(a,n))&&s.set(e,r)}e.items=Array.from(s.values())}_getCacheKey(e){const{geometry:t,spatialRel:r,returnGeometry:i,returnCentroid:n,outSR:s,resultType:o,cacheHint:a}=e;if("tile"!==o&&!a)return null;const l=i||n;return(0,_.fn)(s)&&!(0,_.aI)(this.spatialReference,s)&&l?JSON.stringify([t,r,s]):JSON.stringify([t,r])}_canExecuteSinglePass(e,t){const{spatialRel:r}=t;return(0,ee.tC)(e)&&("esriSpatialRelEnvelopeIntersects"===r||"esriGeometryPoint"===this.geometryType&&("esriSpatialRelIntersects"===r||"esriSpatialRelContains"===r))}async _project(e,t){if(!t||(0,_.aI)(this.spatialReference,t))return e;const r=this.featureAdapter;let i;try{const e=await this._getFullExtent();i=(0,u.getTransformation)(this.spatialReference,t,e)}catch{}const n=await(0,N.lK)(e.items.map((e=>(0,k.pL)(this.geometryType,this.hasZ,this.hasM,r.getGeometry(e)))),this.spatialReference,t,i);return e.items=n.map(((t,i)=>r.cloneWithGeometry(e.items[i],(0,g.Ux)(t,this.hasZ,this.hasM)))),e}async _searchFeatures(e){const t=new Set;await Promise.all(e.map((e=>this.featureStore.forEachInBounds(e,(e=>t.add(e))))));const r=Array.from(t.values());return t.clear(),r}async _executeQueryForStatistics(e,t,r){e=(0,o.o8)(e);try{e=await this._schedule((()=>(0,K.GC)(e,this.definitionExpression,this.spatialReference)),r),e=await this._reschedule((()=>async function(e,t,{fieldsIndex:r,geometryType:i,spatialReference:s,availableFields:o}){if((e.distance??0)<0||null!=e.geometryPrecision||e.multipatchOption||e.pixelSize||e.relationParam||e.text||e.outStatistics||e.groupByFieldsForStatistics||e.having||e.orderByFields)throw new n.A(te,"Unsupported query options",{query:e});return ie(r,o,e),Promise.all([se(r,o,t,e),(0,ee.c0)(e,i,s),(0,N.Nk)(s,e.outSR)]).then((()=>e))}(e,t,{availableFields:this.availableFields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,spatialReference:this.spatialReference})),r);const i=await this._reschedule((()=>this._executeSceneFilterQuery(e,r)),r),s=await this._reschedule((()=>this._executeGeometryQuery(e,i,r)),r);return await this._reschedule((()=>this._executeAggregateIdsQuery(s)),r),await this._reschedule((()=>this._executeObjectIdsQuery(s)),r),await this._reschedule((()=>this._executeTimeQuery(s)),r),await this._reschedule((()=>this._executeAttributesQuery(s)),r),s}catch(t){if(t!==K.v8)throw t;return new $([],e,this)}}}function ue(e){if((0,ee.tC)(e)){if((0,p.ZC)(e))return[(0,d.fA)(Math.min(e.xmin,e.xmax),Math.min(e.ymin,e.ymax),Math.max(e.xmin,e.xmax),Math.max(e.ymin,e.ymax))];if((0,p.Bi)(e))return e.rings.map((e=>(0,d.fA)(Math.min(e[0][0],e[2][0]),Math.min(e[0][1],e[2][1]),Math.max(e[0][0],e[2][0]),Math.max(e[0][1],e[2][1]))))}return[(0,f.Rg)((0,d.vt)(),e)]}},7121:function(e,t,r){r.d(t,{F:function(){return i}});const i={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsCentroid:!0,supportsCacheHint:!0,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!0,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsTopFeaturesQuery:!1,supportsQueryByAnonymous:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsCompactGeometry:!1,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}},51376:function(e,t,r){function i(e,t,r){return{objectId:e,target:t,distance:r,type:"vertex"}}function n(e,t,r,i,n,s=!1){return{objectId:e,target:t,distance:r,type:"edge",start:i,end:n,draped:s}}r.d(t,{P:function(){return n},k:function(){return i}})},78956:function(e,t,r){r.d(t,{LQ:function(){return c},ag:function(){return h},pL:function(){return u}});var i=r(58081),n=r(76613);const s=new n.A,o=new n.A,a=new n.A,l={esriGeometryPoint:i.DF,esriGeometryPolyline:i.BW,esriGeometryPolygon:i.z5,esriGeometryMultipoint:i.qK};function c(e,t,r,n=e.hasZ,s=e.hasM){if(null==t)return null;const o=e.hasZ&&n,l=e.hasM&&s;if(r){const c=(0,i.Nl)(a,t,e.hasZ,e.hasM,"esriGeometryPoint",r,n,s);return(0,i.DF)(c,o,l)}return(0,i.DF)(t,o,l)}function u(e,t,r,n,c,u,h=t,d=r){const f=t&&h,p=r&&d,m=null!=n?"coords"in n?n:n.geometry:null;if(null==m)return null;if(c){let n=(0,i.kz)(o,m,t,r,e,c,h,d);return u&&(n=(0,i.Nl)(a,n,f,p,e,u)),l[e]?.(n,f,p)??null}if(u){const n=(0,i.Nl)(a,m,t,r,e,u,h,d);return l[e]?.(n,f,p)??null}return(0,i.Q4)(s,m,t,r,h,d),l[e]?.(s,f,p)??null}function h(e){return e&&d in e?JSON.parse(JSON.stringify(e,f)):e}const d="_geVersion",f=(e,t)=>e!==d?t:void 0},46805:function(e,t,r){r.d(t,{T:function(){return o}});var i=r(40302),n=r(65215),s=r(76613);const o={getObjectId:e=>e.objectId,getAttributes:e=>e.attributes,getAttribute:(e,t)=>e.attributes[t],cloneWithGeometry:(e,t)=>new n.Om(t,e.attributes,null,e.objectId),getGeometry:e=>e.geometry,getCentroid:(e,t)=>(null==e.centroid&&(e.centroid=(0,i.Q)(new s.A,e.geometry,t.hasZ,t.hasM)),e.centroid)}},74841:function(e,t,r){r.d(t,{Cv:function(){return _},Nk:function(){return f},lK:function(){return y}});var i=r(50659),n=r(60539),s=r(46157),o=r(86029),a=r(57652),l=r(1644);const c=[0,0];function u(e,t){if(!t)return null;if("x"in t){const r={x:0,y:0};return[r.x,r.y]=e(t.x,t.y,c),null!=t.z&&(r.z=t.z),null!=t.m&&(r.m=t.m),r}if("xmin"in t){const r={xmin:0,ymin:0,xmax:0,ymax:0};return[r.xmin,r.ymin]=e(t.xmin,t.ymin,c),[r.xmax,r.ymax]=e(t.xmax,t.ymax,c),t.hasZ&&(r.zmin=t.zmin,r.zmax=t.zmax,r.hasZ=!0),t.hasM&&(r.mmin=t.mmin,r.mmax=t.mmax,r.hasM=!0),r}return"rings"in t?{rings:h(t.rings,e),hasM:t.hasM,hasZ:t.hasZ}:"paths"in t?{paths:h(t.paths,e),hasM:t.hasM,hasZ:t.hasZ}:"points"in t?{points:d(t.points,e),hasM:t.hasM,hasZ:t.hasZ}:null}function h(e,t){const r=[];for(const i of e)r.push(d(i,t));return r}function d(e,t){const r=[];for(const i of e){const e=t(i[0],i[1],[0,0]);r.push(e),i.length>2&&e.push(i[2]),i.length>3&&e.push(i[3])}return r}async function f(e,t){if(!e||!t)return;const r=Array.isArray(e)?e.map((e=>null!=e.geometry?e.geometry.spatialReference:null)).filter(i.Ru):[e];await(0,s.initializeProjection)(r.map((e=>({source:e,dest:t}))))}const p=u.bind(null,l.je),m=u.bind(null,l.tD);function _(e,t,r,i){if(!e)return e;if(r||(r=t,t=e.spatialReference),!(0,a.fn)(t)||!(0,a.fn)(r)||(0,a.aI)(t,r))return e;if((0,l.y7)(t,r)){const t=(0,a.K8)(r)?p(e):m(e);return t.spatialReference=r,t}return(0,s.projectMany)(o.g,[e],t,r,null,i)[0]}const g=new class{constructor(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}async push(e,t,r,i){if(!e?.length||!t||!r||(0,a.aI)(t,r))return e;const s={geometries:e,inSpatialReference:t,outSpatialReference:r,geographicTransformation:i,resolve:(0,n.Tw)()};return this._jobs.push(s),this._timer??=setTimeout(this._process,10),s.resolve.promise}_process(){this._timer=null;const e=this._jobs.shift();if(!e)return;const{geometries:t,inSpatialReference:r,outSpatialReference:i,resolve:n,geographicTransformation:c}=e;(0,l.y7)(r,i)?(0,a.K8)(i)?n(t.map(p)):n(t.map(m)):n((0,s.projectMany)(o.g,t,r,i,c,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}};function y(e,t,r,i){return g.push(e,t,r,i)}},20932:function(e,t,r){r.d(t,{GC:function(){return f},T2:function(){return p},VY:function(){return h},v8:function(){return d}});var i=r(73037),n=r(62938),s=r(46157),o=r(38503),a=r(74697),l=r(65298),c=r(57652),u=r(74841);const h=new i.J({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),d=Object.freeze({});async function f(e,t,r){const{outFields:i,orderByFields:n,groupByFieldsForStatistics:s,outStatistics:o}=e;if(i)for(let e=0;e<i.length;e++)i[e]=i[e].trim();if(n)for(let e=0;e<n.length;e++)n[e]=n[e].trim();if(s)for(let e=0;e<s.length;e++)s[e]=s[e].trim();if(o)for(let e=0;e<o.length;e++)o[e].onStatisticField&&(o[e].onStatisticField=o[e].onStatisticField.trim());return e.geometry&&!e.outSR&&(e.outSR=e.geometry.spatialReference),p(e,t,r)}async function p(e,t,i){if(!e)return null;let{where:s}=e;if(e.where=s=s?.trim(),(!s||/^1 *= *1$/.test(s)||t&&t===s)&&(e.where=null),!e.geometry)return e;let f=await async function(e){const{distance:t,units:i}=e,s=e.geometry;if(null==t||"vertexAttributes"in s)return s;const o=s.spatialReference,a=i?h.fromJSON(i):(0,n.Ij)(o),l=o&&((0,c.EA)(o)||(0,c.K8)(o))?s:await(0,u.Nk)(o,c.KK).then((()=>(0,u.Cv)(s,c.KK)));return(await async function(){return(await r.e(4696).then(r.bind(r,28356))).geodesicBuffer}())(l.spatialReference,l,t,a)}(e);if(e.distance=0,e.units=null,"esriSpatialRelEnvelopeIntersects"===e.spatialRel){const{spatialReference:t}=e.geometry;f=(0,o.HA)(f),f.spatialReference=t}if(f){await(0,u.Nk)(f.spatialReference,i),f=function(e,t){const r=e.spatialReference;return m(e,t)&&(0,a.ZC)(e)?{spatialReference:r,rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]}:e}(f,i);const t=(await(0,l.el)((0,a.rS)(f)))[0];if(null==t)throw d;const r="quantizationParameters"in e&&e.quantizationParameters?.tolerance||"maxAllowableOffset"in e&&e.maxAllowableOffset||0,n=r&&m(f,i)?{densificationStep:8*r}:void 0,s=t.toJSON(),o=(0,u.Cv)(s,s.spatialReference,i,n);if(!o)throw d;o.spatialReference=i,e.geometry=o}return e}function m(e,t){if(!e)return!1;const r=e.spatialReference;return((0,a.ZC)(e)||(0,a.Bi)(e)||(0,a.Rg)(e))&&!(0,c.aI)(r,t)&&!(0,s.canProjectWithoutEngine)(r,t)}},62512:function(e,t,r){r.d(t,{tC:function(){return w},c0:function(){return b},xt:function(){return x}});var i=r(39819),n=r(61273),s=r(96127),o=r(74697),a=r(57652);function l(e,t){return e?t?4:3:t?3:2}function c(e,t,r,i,n,s){const o=l(n,s),{coords:a,lengths:c}=i;if(!c)return!1;for(let i=0,n=0;i<c.length;i++,n+=o)if(!u(e,t,r,a[n],a[n+1]))return!1;return!0}function u(e,t,r,i,n){if(!e)return!1;const s=l(t,r),{coords:o,lengths:a}=e;let c=!1,u=0;for(const e of a)c=h(c,o,s,u,e,i,n),u+=e*s;return c}function h(e,t,r,i,n,s,o){let a=e,l=i;for(let e=i,c=i+n*r;e<c;e+=r){l=e+r,l===c&&(l=i);const n=t[e],u=t[e+1],h=t[l],d=t[l+1];(u<o&&d>=o||d<o&&u>=o)&&n+(o-u)/(d-u)*(h-n)<s&&(a=!a)}return a}var d=r(58081),f=r(76613),p=r(78956),m=r(74841);const _="unsupported-query",g={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},y={spatialRelationship:{esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},queryGeometry:{esriGeometryPoint:!0,esriGeometryMultiPatch:!1,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},layerGeometry:{esriGeometryPoint:!0,esriGeometryMultiPatch:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1}};function x(e,t,i,a,l){if((0,o.Bi)(t)&&"esriGeometryPoint"===i&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e)){const e=(0,d.Ye)(new f.A,t,!1,!1);return Promise.resolve((t=>function(e,t,r,i){return u(e,!1,!1,i.coords[0],i.coords[1])}(e,0,0,t)))}if((0,o.Bi)(t)&&"esriGeometryMultipoint"===i){const r=(0,d.Ye)(new f.A,t,!1,!1);if("esriSpatialRelContains"===e)return Promise.resolve((e=>c(r,!1,!1,e,a,l)))}if((0,o.ZC)(t)&&"esriGeometryPoint"===i&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e))return Promise.resolve((e=>(0,n.qz)(t,(0,p.pL)(i,a,l,e))));if((0,o.ZC)(t)&&"esriGeometryMultipoint"===i&&"esriSpatialRelContains"===e)return Promise.resolve((e=>(0,n.rL)(t,(0,p.pL)(i,a,l,e))));if((0,o.ZC)(t)&&"esriSpatialRelIntersects"===e){const e="mesh"===(h=i)?s.xB:(0,s.xK)(h);return Promise.resolve((r=>e(t,(0,p.pL)(i,a,l,r))))}var h;return r.e(4696).then(r.bind(r,28356)).then((r=>{const n=r[g[e]].bind(null,t.spatialReference,t);return e=>n((0,p.pL)(i,a,l,e))}))}async function b(e,t,r){const{spatialRel:n,geometry:s}=e;if(s){if(!function(e){return null!=e&&!0===y.spatialRelationship[e]}(n))throw new i.A(_,"Unsupported query spatial relationship",{query:e});if((0,a.fn)(s.spatialReference)&&(0,a.fn)(r)){if(!function(e){return null!=e&&!0===y.queryGeometry[(0,o.$B)(e)]}(s))throw new i.A(_,"Unsupported query geometry type",{query:e});if(!function(e){return null!=e&&!0===y.layerGeometry[e]}(t))throw new i.A(_,"Unsupported layer geometry type",{query:e});if(e.outSR)return(0,m.Nk)(e.geometry?.spatialReference,e.outSR)}}}function w(e){if((0,o.ZC)(e))return!0;if((0,o.Bi)(e)){for(const t of e.rings){if(5!==t.length)return!1;if(t[0][0]!==t[1][0]||t[0][0]!==t[4][0]||t[2][0]!==t[3][0]||t[0][1]!==t[3][1]||t[0][1]!==t[4][1]||t[1][1]!==t[2][1])return!1}return!0}return!1}},20973:function(e,t,r){async function i(e,t){if(!e)return null;const r=t.featureAdapter,{startTimeField:i,endTimeField:n}=e;let s=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;if(i&&n)await t.forEach((e=>{const t=r.getAttribute(e,i),a=r.getAttribute(e,n);null==t||isNaN(t)||(s=Math.min(s,t)),null==a||isNaN(a)||(o=Math.max(o,a))}));else{const e=i||n;await t.forEach((t=>{const i=r.getAttribute(t,e);null==i||isNaN(i)||(s=Math.min(s,i),o=Math.max(o,i))}))}return{start:s,end:o}}function n(e,t,r){if(!t||!e)return null;const{startTimeField:i,endTimeField:n}=e;if(!i&&!n)return null;const{start:s,end:o}=t;if(null===s&&null===o)return null;if(void 0===s&&void 0===o)return()=>!1;const a=r.getAttributeAsTimestamp?.bind(r)??r.getAttribute.bind(r);return i&&n?function(e,t,r,i,n){return null!=i&&null!=n?s=>{const o=e(s,t),a=e(s,r);return(null==o||o<=n)&&(null==a||a>=i)}:null!=i?t=>{const n=e(t,r);return null==n||n>=i}:null!=n?r=>{const i=e(r,t);return null==i||i<=n}:void 0}(a,i,n,s,o):function(e,t,r,i){return null!=r&&null!=i&&r===i?i=>e(i,t)===r:null!=r&&null!=i?n=>{const s=e(n,t);return null!=s&&s>=r&&s<=i}:null!=r?i=>{const n=e(i,t);return null!=n&&n>=r}:null!=i?r=>{const n=e(r,t);return null!=n&&n<=i}:void 0}(a,i||n,s,o)}r.d(t,{I:function(){return n},W:function(){return i}})},58081:function(e,t,r){r.d(t,{B2:function(){return w},BW:function(){return O},Ch:function(){return ne},DF:function(){return S},Di:function(){return Z},E2:function(){return q},IE:function(){return b},Nl:function(){return K},Q4:function(){return se},Rk:function(){return ae},Ux:function(){return j},Ye:function(){return U},ZF:function(){return $},eU:function(){return G},eY:function(){return Q},jH:function(){return J},jQ:function(){return ie},kz:function(){return ee},oN:function(){return H},q3:function(){return X},qK:function(){return k},qN:function(){return L},z5:function(){return z},zv:function(){return W}});var i=r(39819),n=r(40633),s=r(95929),o=r(24761),a=r(87416),l=r(74697),c=r(65215),u=r(72887),h=r(76613);function d(e,t){return e?t?4:3:t?3:2}const f=()=>n.A.getLogger("esri.layers.graphics.featureConversionUtils"),p={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryMultiPatch:3,esriGeometryEnvelope:0},m=(e,t,r,i,n,s)=>{e[r]=n,e[r+1]=s},_=(e,t,r,i,n,s)=>{e[r]=n,e[r+1]=s,e[r+2]=t[i+2]},g=(e,t,r,i,n,s)=>{e[r]=n,e[r+1]=s,e[r+2]=t[i+3]},y=(e,t,r,i,n,s)=>{e[r]=n,e[r+1]=s,e[r+2]=t[i+2],e[r+3]=t[i+3]};function x(e,t,r,i){if(e){if(r)return t&&i?y:_;if(t&&i)return g}else if(t&&i)return _;return m}function b({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}function w({scale:e,translate:t},r){return Math.round((t[1]-r)/e[1])}function v({scale:e,translate:t},r,i){return r*e[i]+t[i]}function S(e,t,r){return e?t?r?C(e):M(e):r?E(e):T(e):null}function T(e){const t=e.coords;return{x:t[0],y:t[1]}}function I(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e}function M(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2]}}function A(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e}function E(e){const t=e.coords;return{x:t[0],y:t[1],m:t[2]}}function P(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.m,e}function C(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2],m:t[3]}}function R(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e.coords[3]=t.m,e}function F(e,t){return e&&t?R:e?A:t?P:I}function L(e,t,r=F(null!=t.z,null!=t.m)){return r(e,t)}function k(e,t,r){if(null==e)return null;const i=d(t,r),n=[];for(let t=0;t<e.coords.length;t+=i){const r=[];for(let n=0;n<i;n++)r.push(e.coords[t+n]);n.push(r)}return t?r?{points:n,hasZ:t,hasM:r}:{points:n,hasZ:t}:r?{points:n,hasM:r}:{points:n}}function N(e,t,r=d(t.hasZ,t.hasM)){e.lengths[0]=t.points.length;const i=e.coords;let n=0;for(const e of t.points)for(let t=0;t<r;t++)i[n++]=e[t];return e}function O(e,t,r){if(!e)return null;const i=d(t,r),{coords:n,lengths:s}=e,o=[];let a=0;for(const e of s){const t=[];for(let r=0;r<e;r++){const e=[];for(let t=0;t<i;t++)e.push(n[a++]);t.push(e)}o.push(t)}return t?r?{paths:o,hasZ:t,hasM:r}:{paths:o,hasZ:t}:r?{paths:o,hasM:r}:{paths:o}}function D(e,t,r=d(t.hasZ,t.hasM)){const{lengths:i,coords:n}=e;let s=0;for(const e of t.paths){for(const t of e)for(let e=0;e<r;e++)n[s++]=t[e];i.push(e.length)}return e}function z(e,t,r){if(!e)return null;const i=d(t,r),{coords:n,lengths:s}=e,o=[];let a=0;for(const e of s){const t=[];for(let r=0;r<e;r++){const e=[];for(let t=0;t<i;t++)e.push(n[a++]);t.push(e)}o.push(t)}return t?r?{rings:o,hasZ:t,hasM:r}:{rings:o,hasZ:t}:r?{rings:o,hasM:r}:{rings:o}}function U(e,t,r=t.hasZ,i=t.hasM){return G(e,t.rings,r,i)}function G(e,t,r,i){const n=d(r,i),{lengths:s,coords:o}=e;let a=0;le(e);for(const e of t){for(const t of e)for(let e=0;e<n;e++)o[a++]=t[e];s.push(e.length)}return e}const B=[],V=[];function q(e,t,r,i,n){B[0]=e;const[s]=Z(V,B,t,r,i,n);return ce(B),ce(V),s}function Z(e,t,r,n,s,o){if(ce(e),!r){for(const r of t){const t=o?r.attributes[o]:void 0;e.push(new c.Om(null,r.attributes,null,t))}return e}switch(r){case"esriGeometryPoint":return function(e,t,r,i,n){const s=F(r,i);for(const{geometry:r,attributes:i}of t){const t=null!=r?s(new h.A,r):null;e.push(new c.Om(t,i,null,n?i[n]:void 0))}return e}(e,t,n,s,o);case"esriGeometryMultipoint":return function(e,t,r,i,n){const s=d(r,i);for(const{geometry:r,attributes:i}of t){const t=null!=r?N(new h.A,r,s):null;e.push(new c.Om(t,i,null,n?i[n]:void 0))}return e}(e,t,n,s,o);case"esriGeometryPolyline":return function(e,t,r,i,n){const s=d(r,i);for(const{geometry:r,attributes:i,centroid:o}of t){const t=null!=r?D(new h.A,r,s):null,a=null!=o?L(new h.A,o):null;e.push(new c.Om(t,i,a,n?i[n]:void 0))}return e}(e,t,n,s,o);case"esriGeometryPolygon":case"esriGeometryMultiPatch":return function(e,t,r,i,n){for(const{geometry:s,centroid:o,attributes:a}of t){const t=null!=s?U(new h.A,s,r,i):null,l=n?a[n]:void 0;null!=o?e.push(new c.Om(t,a,I(new h.A,o),l)):e.push(new c.Om(t,a,null,l))}return e}(e,t,n,s,o);default:f().error("convertToFeatureSet:unknown-geometry",new i.A(`Unable to parse unknown geometry type '${r}'`)),ce(e)}return e}function H(e,t,r,i){V[0]=e,Y(B,V,t,r,i);const n=B[0];return ce(B),ce(V),n}function j(e,t,r){if(null==e)return null;const n=new h.A;return"hasZ"in e&&null==t&&(t=e.hasZ),"hasM"in e&&null==r&&(r=e.hasM),(0,l.fT)(e)?F(null!=t?t:null!=e.z,null!=r?r:null!=e.m)(n,e):(0,l.Bi)(e)?U(n,e,t,r):(0,l.Rg)(e)?D(n,e,d(t,r)):(0,l.U9)(e)?N(n,e,d(t,r)):void f().error("convertFromGeometry:unknown-geometry",new i.A(`Unable to parse unknown geometry type '${e}'`))}function W(e,t,r,n){const s=e&&("coords"in e?e:e.geometry);if(null==s)return null;switch(t){case"esriGeometryPoint":{let e=T;return r&&n?e=C:r?e=M:n&&(e=E),e(s)}case"esriGeometryMultipoint":return k(s,r,n);case"esriGeometryPolyline":return O(s,r,n);case"esriGeometryPolygon":return z(s,r,n);default:return f().error("convertToGeometry:unknown-geometry",new i.A(`Unable to parse unknown geometry type '${t}'`)),null}}function Y(e,t,r,n,s){if(ce(e),null==r)return function(e,t){for(const r of t)e.push({attributes:r.attributes});return e}(e,t);switch(r){case"esriGeometryPoint":return function(e,t,r,i){let n=T;r&&i?n=C:r?n=M:i&&(n=E);for(const r of t){const{geometry:t,attributes:i}=r,s=null!=t?n(t):null;e.push({attributes:i,geometry:s})}return e}(e,t,n,s);case"esriGeometryMultipoint":return function(e,t,r,i){for(const{geometry:n,attributes:s}of t)e.push({attributes:s,geometry:null!=n?k(n,r,i):null});return e}(e,t,n,s);case"esriGeometryPolyline":return function(e,t,r,i){for(const{geometry:n,attributes:s}of t)e.push({attributes:s,geometry:null!=n?O(n,r,i):null});return e}(e,t,n,s);case"esriGeometryPolygon":return function(e,t,r,i){for(const{geometry:n,attributes:s,centroid:o}of t){const t=null!=n?z(n,r,i):null;if(null!=o){const r=T(o);e.push({attributes:s,centroid:r,geometry:t})}else e.push({attributes:s,geometry:t})}return e}(e,t,n,s);default:f().error("convertToFeatureSet:unknown-geometry",new i.A(`Unable to parse unknown geometry type '${r}'`))}return e}function $(e){const{objectIdFieldName:t,spatialReference:r,transform:i,fields:n,hasM:s,hasZ:o,features:a,geometryType:l,exceededTransferLimit:c,uniqueIdField:u,queryGeometry:h,queryGeometryType:d}=e,f={features:Y([],a,l,o,s),fields:n,geometryType:l,objectIdFieldName:t,spatialReference:r,uniqueIdField:u,queryGeometry:W(h,d,!1,!1)};return i&&(f.transform=i),c&&(f.exceededTransferLimit=c),s&&(f.hasM=s),o&&(f.hasZ=o),f}function X(e,t){const r=new u.A,{hasM:n,hasZ:s,features:o,objectIdFieldName:a,spatialReference:l,geometryType:c,exceededTransferLimit:h,transform:d,fields:p}=e;return p&&(r.fields=p),r.geometryType=c??null,r.objectIdFieldName=a??t??null,r.spatialReference=l??null,r.objectIdFieldName?(o&&Z(r.features,o,c,s,n,r.objectIdFieldName),h&&(r.exceededTransferLimit=h),n&&(r.hasM=n),s&&(r.hasZ=s),d&&(r.transform=d),r):(f().error(new i.A("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),r)}function Q(e){const{transform:t,features:r,hasM:i,hasZ:n}=e;if(!t)return e;for(const e of r)null!=e.geometry&&ne(e.geometry,e.geometry,i,n,t),null!=e.centroid&&ne(e.centroid,e.centroid,i,n,t);return e.transform=null,e}function J(e,t){const{geometryType:r,features:i,hasM:n,hasZ:s}=t;if(!e)return t;for(let t=0;t<i.length;t++){const o=i[t],a=o.weakClone();a.geometry=new h.A,K(a.geometry,o.geometry,n,s,r,e),o.centroid&&(a.centroid=new h.A,K(a.centroid,o.centroid,n,s,"esriGeometryPoint",e)),i[t]=a}return t.transform=e,t}function K(e,t,r,i,n,s,o=r,a=i){if(le(e),!t?.coords.length)return null;const l=p[n],{coords:c,lengths:u}=t,h=d(r,i),f=d(r&&o,i&&a),m=x(r,i,o,a);if(!u.length)return m(e.coords,c,0,0,b(s,c[0]),w(s,c[1])),le(e,h,0),e;let _,g,y,v,S=0,T=0,I=T;for(const t of u){if(t<l)continue;let r=0;T=I,y=_=b(s,c[S]),v=g=w(s,c[S+1]),m(e.coords,c,T,S,y,v),r++,S+=h,T+=f;for(let i=1;i<t;i++,S+=h)y=b(s,c[S]),v=w(s,c[S+1]),y===_&&v===g||(m(e.coords,c,T,S,y-_,v-g),T+=f,r++,_=y,g=v);r>=l&&(e.lengths.push(r),I=T)}return ce(e.coords,I),e.coords.length?e:null}function ee(e,t,r,i,n,s,o=r,a=i){if(le(e),!t?.coords.length)return null;const l=p[n],{coords:c,lengths:u}=t,h=d(r,i),f=d(r&&o,i&&a),m=x(r,i,o,a);if(!u.length)return m(e.coords,c,0,0,c[0],c[1]),le(e,h,0),e;let _=0;const g=s*s;for(const t of u){if(t<l){_+=t*h;continue}const r=e.coords.length/f,i=_,n=_+(t-1)*h;m(e.coords,c,e.coords.length,i,c[i],c[i+1]),re(e.coords,c,h,g,m,i,n),m(e.coords,c,e.coords.length,n,c[n],c[n+1]);const s=e.coords.length/f-r;s>=l?e.lengths.push(s):ce(e.coords,r*f),_+=t*h}return e.coords.length?e:null}function te(e,t,r,i){const n=e[t],s=e[t+1],o=e[r],a=e[r+1],l=e[i],c=e[i+1];let u=o,h=a,d=l-u,f=c-h;if(0!==d||0!==f){const e=((n-u)*d+(s-h)*f)/(d*d+f*f);e>1?(u=l,h=c):e>0&&(u+=d*e,h+=f*e)}return d=n-u,f=s-h,d*d+f*f}function re(e,t,r,i,n,s,o){let a,l=i,c=0;for(let e=s+r;e<o;e+=r)a=te(t,e,s,o),a>l&&(c=e,l=a);l>i&&(c-s>r&&re(e,t,r,i,n,s,c),n(e,t,e.length,c,t[c],t[c+1]),o-c>r&&re(e,t,r,i,n,c,o))}function ie(e,t,r,i){if(!t?.coords?.length)return null;const n=d(r,i);let s=Number.POSITIVE_INFINITY,l=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,u=Number.NEGATIVE_INFINITY;if(t&&t.coords){const e=t.coords;for(let t=0;t<e.length;t+=n){const r=e[t],i=e[t+1];s=Math.min(s,r),c=Math.max(c,r),l=Math.min(l,i),u=Math.max(u,i)}}return(0,o.is)(e)?(0,o.BI)(e,s,l,c,u):(0,a.fA)(s,l,c,u,e),e}function ne(e,t,r,i,n){const{coords:o,lengths:a}=t,l=d(r,i);if(!o.length)return e!==t&&le(e),e;(0,s.Lw)(n);const{originPosition:c,scale:u,translate:h}=n,f=ue;f.originPosition=c;const p=f.scale;p[0]=u[0]??1,p[1]=-(u[1]??1),p[2]=u[2]??1,p[3]=u[3]??1;const m=f.translate;if(m[0]=h[0]??0,m[1]=h[1]??0,m[2]=h[2]??0,m[3]=h[3]??0,!a.length){for(let t=0;t<l;++t)e.coords[t]=v(f,o[t],t);return e!==t&&le(e,l,0),e}let _=0;for(let t=0;t<a.length;t++){const r=a[t];e.lengths[t]=r;for(let t=0;t<l;++t)e.coords[_+t]=v(f,o[_+t],t);let i=e.coords[_],n=e.coords[_+1];_+=l;for(let t=1;t<r;t++,_+=l){i+=o[_]*p[0],n+=o[_+1]*p[1],e.coords[_]=i,e.coords[_+1]=n;for(let t=2;t<l;++t)e.coords[_+t]=v(f,o[_+t],t)}}return e!==t&&le(e,o.length,a.length),e}function se(e,t,r,i,n,s){if(le(e),e.lengths.push(...t.lengths),r===n&&i===s)for(let r=0;r<t.coords.length;r++)e.coords.push(t.coords[r]);else{const o=d(r,i),a=x(r,i,n,s),l=t.coords;for(let t=0;t<l.length;t+=o)a(e.coords,l,e.coords.length,t,l[t],l[t+1])}return e}function oe(e,t,r,i){let n=0,s=e[i*t],o=e[i*(t+1)];for(let a=1;a<r;a++){const r=s+e[i*(t+a)],l=o+e[i*(t+a)+1],c=(r-s)*(l+o);s=r,o=l,n+=c}return.5*n}function ae(e,t){const{coords:r,lengths:i}=e;let n=0,s=0;for(let e=0;e<i.length;e++){const o=i[e];s+=oe(r,n,o,t),n+=o}return Math.abs(s)}function le(e,t=0,r=0){ce(e.lengths,r),ce(e.coords,t)}function ce(e,t=0){e.length!==t&&(e.length=t)}const ue={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]}},10310:function(e,t,r){r.r(t),r.d(t,{createConnection:function(){return A}});var i=r(53804),n=(r(50917),r(93040)),s=r(39819),o=r(40633),a=r(60539),l=r(90683),c=(r(58941),r(13798),r(65953)),u=r(23502),h=r(6996),d=r(48996);let f=class extends d.A.EventedAccessor{destroy(){this.emit("destroy")}get connectionError(){return this.errorString?new s.A("stream-connection",this.errorString):null}onFeature(e){this.emit("data-received",e)}onMessage(e){this.emit("message-received",e)}};(0,i._)([(0,u.MZ)({readOnly:!0})],f.prototype,"connectionError",null),f=(0,i._)([(0,c.$)("esri.layers.support.StreamConnection")],f);const p=f;var m,_;(_=m||(m={}))[_.CONNECTING=0]="CONNECTING",_[_.OPEN=1]="OPEN",_[_.CLOSING=2]="CLOSING",_[_.CLOSED=3]="CLOSED";let g=class extends p{constructor(e){super({}),this._outstandingMessages=[],this.errorString=null;const{geometryType:t,spatialReference:r,sourceSpatialReference:i}=e;this._config=e,this._featureZScaler=(0,h.N)(t,i,r),this._open()}normalizeCtorArgs(){return{}}async _open(){await this._tryCreateWebSocket(),this.destroyed||await this._handshake()}destroy(){super.destroy(),null!=this._websocket&&(this._websocket.onopen=null,this._websocket.onclose=null,this._websocket.onerror=null,this._websocket.onmessage=null,this._websocket.close()),this._websocket=null}get connectionStatus(){if(null==this._websocket)return"disconnected";switch(this._websocket.readyState){case m.CONNECTING:case m.OPEN:return"connected";case m.CLOSING:case m.CLOSED:return"disconnected"}}sendMessageToSocket(e){null!=this._websocket?this._websocket.send(JSON.stringify(e)):this._outstandingMessages.push(e)}sendMessageToClient(e){this._onMessage(e)}updateCustomParameters(e){this._config.customParameters=e,null!=this._websocket&&this._websocket.close()}async _tryCreateWebSocket(e=this._config.source.path,t=1e3,r=0){try{if(this.destroyed)return;const t=(0,l.a6)(e,this._config.customParameters??{});this._websocket=await this._createWebSocket(t),this.notifyChange("connectionStatus")}catch(i){const n=t/1e3;return this._config.maxReconnectionAttempts&&r>=this._config.maxReconnectionAttempts?(o.A.getLogger(this).error(new s.A("websocket-connection","Exceeded maxReconnectionAttempts attempts. No further attempts will be made")),void this.destroy()):(o.A.getLogger(this).error(new s.A("websocket-connection",`Failed to connect. Attempting to reconnect in ${n}s`,i)),await(0,a.Pl)(t),this._tryCreateWebSocket(e,Math.min(1.5*t,1e3*this._config.maxReconnectionInterval),r+1))}}_setWebSocketJSONParseHandler(e){e.onmessage=e=>{try{const t=JSON.parse(e.data);this._onMessage(t)}catch(e){return void o.A.getLogger(this).error(new s.A("websocket-connection","Failed to parse message, invalid JSON",{error:e}))}}}_createWebSocket(e){return new Promise(((t,r)=>{const i=new WebSocket(e);i.onopen=()=>{if(i.onopen=null,this.destroyed)return i.onclose=null,void i.close();i.onclose=e=>this._onClose(e),i.onerror=e=>this._onError(e),this._setWebSocketJSONParseHandler(i),t(i)},i.onclose=e=>{i.onopen=i.onclose=null,r(e)}}))}async _handshake(e=1e4){const t=this._websocket;if(null==t)return;const r=(0,a.Tw)(),i=t.onmessage,{filter:n,outFields:l,spatialReference:c}=this._config;return r.timeout(e),t.onmessage=e=>{let a=null;try{a=JSON.parse(e.data)}catch(e){}a&&"object"==typeof a||(o.A.getLogger(this).error(new s.A("websocket-connection","Protocol violation. Handshake failed - malformed message",e.data)),r.reject(),this.destroy()),a.spatialReference?.wkid!==c?.wkid&&(o.A.getLogger(this).error(new s.A("websocket-connection",`Protocol violation. Handshake failed - expected wkid of ${c.wkid}`,e.data)),r.reject(),this.destroy()),"json"!==a.format&&(o.A.getLogger(this).error(new s.A("websocket-connection","Protocol violation. Handshake failed - format is not set",e.data)),r.reject(),this.destroy()),n&&a.filter!==n&&o.A.getLogger(this).error(new s.A("websocket-connection","Tried to set filter, but server doesn't support it")),l&&a.outFields!==l&&o.A.getLogger(this).error(new s.A("websocket-connection","Tried to set outFields, but server doesn't support it")),t.onmessage=i;for(const e of this._outstandingMessages)t.send(JSON.stringify(e));this._outstandingMessages=[],r.resolve()},t.send(JSON.stringify({filter:n,outFields:l,format:"json",spatialReference:{wkid:c.wkid}})),r.promise}_onMessage(e){if(this.onMessage(e),"type"in e)switch(e.type){case"features":case"featureResult":for(const t of e.features)null!=this._featureZScaler&&this._featureZScaler(t.geometry),this.onFeature(t)}}_onError(e){const t="Encountered an error over WebSocket connection";this._set("errorString",t),o.A.getLogger(this).error("websocket-connection",t)}_onClose(e){this._websocket=null,this.notifyChange("connectionStatus"),1e3!==e.code&&o.A.getLogger(this).error("websocket-connection",`WebSocket closed unexpectedly with error code ${e.code}`),this.destroyed||this._open()}};(0,i._)([(0,u.MZ)()],g.prototype,"connectionStatus",null),(0,i._)([(0,u.MZ)()],g.prototype,"errorString",void 0),g=(0,i._)([(0,c.$)("esri.layers.graphics.sources.connections.WebSocketConnection")],g);var y=r(90066),x=r(7926),b=r(74697),w=r(57165);const v={maxQueryDepth:5,maxRecordCountFactor:3};let S=class extends g{constructor(e){super({...v,...e}),this._buddyServicesQuery=null,this._relatedFeatures=null}async _open(){const e=await this._fetchServiceDefinition(this._config.source);e.timeInfo.trackIdField||o.A.getLogger(this).warn("GeoEvent service was configured without a TrackIdField. This may result in certain functionality being disabled. The purgeOptions.maxObservations property will have no effect.");const t=this._fetchWebSocketUrl(e.streamUrls,this._config.spatialReference);this._buddyServicesQuery||(this._buddyServicesQuery=this._queryBuddyServices()),await this._buddyServicesQuery,await this._tryCreateWebSocket(t);const{filter:r,outFields:i}=this._config;this.destroyed||this._setFilter(r,i)}_onMessage(e){if("attributes"in e){let t;try{t=this._enrich(e),null!=this._featureZScaler&&this._featureZScaler(t.geometry)}catch(e){return void o.A.getLogger(this).error(new s.A("geoevent-connection","Failed to parse message",e))}this.onFeature(t)}else this.onMessage(e)}async _fetchServiceDefinition(e){const t={f:"json",...this._config.customParameters},r=(0,n.A)(e.path,{query:t,responseType:"json"}),i=(await r).data;return this._serviceDefinition=i,i}_fetchWebSocketUrl(e,t){const r=e[0],{urls:i,token:n}=r,s=this._inferWebSocketBaseUrl(i);return(0,l.a6)(`${s}/subscribe`,{outSR:""+t.wkid,token:n})}_inferWebSocketBaseUrl(e){if(1===e.length)return e[0];for(const t of e)if(t.includes("wss"))return t;return o.A.getLogger(this).error(new s.A("geoevent-connection","Unable to infer WebSocket url",e)),null}async _setFilter(e,t){const r=this._websocket;if(null==r||null==e&&null==t)return;const i=JSON.stringify({filter:this._serializeFilter(e,t)});let n=!1;const l=(0,a.Tw)();return r.onmessage=e=>{const t=JSON.parse(e.data);t.filter&&(t.error&&(o.A.getLogger(this).error(new s.A("geoevent-connection","Failed to set service filter",t.error)),this._set("errorString",`Could not set service filter - ${t.error}`),l.reject(t.error)),this._setWebSocketJSONParseHandler(r),n=!0,l.resolve())},r.send(i),setTimeout((()=>{n||(this.destroyed||this._websocket!==r||o.A.getLogger(this).error(new s.A("geoevent-connection","Server timed out when setting filter")),l.reject())}),1e4),l.promise}_serializeFilter(e,t){const r={};if(null==e&&null==t)return r;if(e?.geometry)try{const t=(0,b.rS)(e.geometry);if("extent"!==t.type)throw new s.A(`Expected extent but found type ${t.type}`);r.geometry=JSON.stringify(t.shiftCentralMeridian())}catch(e){o.A.getLogger(this).error(new s.A("geoevent-connection","Encountered an error when setting connection geometryDefinition",e))}return e?.where&&"1 = 1"!==e.where&&"1=1"!==e.where&&(r.where=e.where),null!=t&&(r.outFields=t.join(",")),r}_enrich(e){if(!this._relatedFeatures)return e;const t=this._serviceDefinition.relatedFeatures.joinField,r=e.attributes[t],i=this._relatedFeatures.get(r);if(!i)return o.A.getLogger(this).warn("geoevent-connection","Feature join failed. Is the join field configured correctly?",e),e;const{attributes:n,geometry:a}=i;for(const t in n)e.attributes[t]=n[t];return a&&(e.geometry=a),e.geometry||e.centroid||o.A.getLogger(this).error(new s.A("geoevent-connection","Found malformed feature - no geometry found",e)),e}async _queryBuddyServices(){try{const{relatedFeatures:e,keepLatestArchive:t}=this._serviceDefinition,r=this._queryRelatedFeatures(e),i=this._queryArchive(t);await r;const n=await i;if(!n)return;for(const e of n.features)this.onFeature(this._enrich(e))}catch(e){o.A.getLogger(this).error(new s.A("geoevent-connection","Encountered an error when querying buddy services",{error:e}))}}async _queryRelatedFeatures(e){if(!e)return;const t=await this._queryBuddy(e.featuresUrl);this._addRelatedFeatures(t)}async _queryArchive(e){if(e)return this._queryBuddy(e.featuresUrl)}async _queryBuddy(e){const t=new((await r.e(2938).then(r.bind(r,57534))).default)({url:e}),{capabilities:i}=await t.load(),n=i.query.supportsMaxRecordCountFactor,s=i.query.supportsPagination,o=i.query.supportsCentroid,a=this._config.maxRecordCountFactor,l=t.capabilities.query.maxRecordCount,c=n?l*a:l,u=new x.A;if(u.outFields=this._config.outFields??["*"],u.where=this._config.filter?.where??"1=1",u.returnGeometry=!0,u.returnExceededLimitFeatures=!0,u.outSpatialReference=w.A.fromJSON(this._config.spatialReference),o&&(u.returnCentroid=!0),n&&(u.maxRecordCountFactor=a),s)return u.num=c,t.destroy(),this._queryPages(e,u);const h=await(0,y.eW)(e,u,this._config.sourceSpatialReference);return t.destroy(),h.data}async _queryPages(e,t,r=[],i=0){t.start=null!=t.num?i*t.num:null;const{data:n}=await(0,y.eW)(e,t,this._config.sourceSpatialReference);return n.exceededTransferLimit&&i<(this._config.maxQueryDepth??0)?(n.features.forEach((e=>r.push(e))),this._queryPages(e,t,r,i+1)):(r.forEach((e=>n.features.push(e))),n)}_addRelatedFeatures(e){const t=new Map,r=e.features,i=this._serviceDefinition.relatedFeatures.joinField;for(const e of r){const r=e.attributes[i];t.set(r,e)}this._relatedFeatures=t}};S=(0,i._)([(0,c.$)("esri.layers.graphics.sources.connections.GeoEventConnection")],S);const T=S;let I=class extends p{constructor(e){super({}),this.connectionStatus="connected",this.errorString=null;const{geometryType:t,spatialReference:r,sourceSpatialReference:i}=e;this._featureZScaler=(0,h.N)(t,i,r)}normalizeCtorArgs(){return{}}updateCustomParameters(e){}sendMessageToSocket(e){}sendMessageToClient(e){if("type"in e)switch(e.type){case"features":case"featureResult":for(const t of e.features)null!=this._featureZScaler&&this._featureZScaler(t.geometry),this.onFeature(t)}this.onMessage(e)}};function M(e,t){if(null==e&&null==t)return null;const r={};return null!=t&&(r.geometry=t),null!=e&&(r.where=e),r}function A(e,t,r,i,n,s,o,a,l){const c={source:e,sourceSpatialReference:t,spatialReference:r,geometryType:i,filter:M(n,s),maxReconnectionAttempts:o,maxReconnectionInterval:a,customParameters:l};return e?e.path.startsWith("wss://")||e.path.startsWith("ws://")?new g(c):new T(c):new I(c)}(0,i._)([(0,u.MZ)()],I.prototype,"connectionStatus",void 0),(0,i._)([(0,u.MZ)()],I.prototype,"errorString",void 0),I=(0,i._)([(0,c.$)("esri.layers.support.ClientSideConnection")],I)},3418:function(e,t,r){r.d(t,{BM:function(){return T},bd:function(){return I},sO:function(){return S},xD:function(){return u}});var i=r(37057),n=r(39819),s=r(57652),o=r(65215),a=r(76613),l=r(53743);const c={LineString:"esriGeometryPolyline",MultiLineString:"esriGeometryPolyline",MultiPoint:"esriGeometryMultipoint",Point:"esriGeometryPoint",Polygon:"esriGeometryPolygon",MultiPolygon:"esriGeometryPolygon"};function u(e){return c[e]}function*h(e){switch(e.type){case"Feature":yield e;break;case"FeatureCollection":for(const t of e.features)t&&(yield t)}}function*d(e){if(e)switch(e.type){case"Point":yield e.coordinates;break;case"LineString":case"MultiPoint":yield*e.coordinates;break;case"MultiLineString":case"Polygon":for(const t of e.coordinates)yield*t;break;case"MultiPolygon":for(const t of e.coordinates)for(const e of t)yield*e}}function f(e){for(const t of e)if(t.length>2)return!0;return!1}function p(e){let t=0;for(let r=0;r<e.length;r++){const i=e[r],n=e[(r+1)%e.length];t+=i[0]*n[1]-n[0]*i[1]}return t<=0}function m(e){const t=e[0],r=e[e.length-1];return t[0]===r[0]&&t[1]===r[1]&&t[2]===r[2]||e.push(t),e}function _(e,t,r){switch(t.type){case"LineString":case"MultiPoint":return function(e,t,r){return x(e,t.coordinates,r),e}(e,t,r);case"MultiLineString":return function(e,t,r){for(const i of t.coordinates)x(e,i,r);return e}(e,t,r);case"MultiPolygon":return function(e,t,r){for(const i of t.coordinates){g(e,i[0],r);for(let t=1;t<i.length;t++)y(e,i[t],r)}return e}(e,t,r);case"Point":return function(e,t,r){return w(e,t.coordinates,r),e}(e,t,r);case"Polygon":return function(e,t,r){const i=t.coordinates;g(e,i[0],r);for(let t=1;t<i.length;t++)y(e,i[t],r);return e}(e,t,r)}}function g(e,t,r){const i=m(t);!function(e){return!p(e)}(i)?x(e,i,r):b(e,i,r)}function y(e,t,r){const i=m(t);!function(e){return p(e)}(i)?x(e,i,r):b(e,i,r)}function x(e,t,r){for(const i of t)w(e,i,r);e.lengths.push(t.length)}function b(e,t,r){for(let i=t.length-1;i>=0;i--)w(e,t[i],r);e.lengths.push(t.length)}function w(e,t,r){const[i,n,s]=t;e.coords.push(i,n),r.hasZ&&e.coords.push(s||0)}function v(e){switch(typeof e){case"string":return(0,i.Br)(e)?"esriFieldTypeDate":"esriFieldTypeString";case"number":return"esriFieldTypeDouble";default:return"unknown"}}function S(e,t=4326){if(!e)throw new n.A("geojson-layer:empty","GeoJSON data is empty");if("Feature"!==e.type&&"FeatureCollection"!==e.type)throw new n.A("geojson-layer:unsupported-geojson-object","missing or not supported GeoJSON object type",{data:e});const{crs:r}=e;if(!r)return;const i="string"==typeof r?r:"name"===r.type?r.properties.name:"EPSG"===r.type?r.properties.code:null,o=(0,s.oT)({wkid:t})?new RegExp(".*(CRS84H?|4326)$","i"):new RegExp(`.*(${t})$`,"i");if(!i||!o.test(i))throw new n.A("geojson:unsupported-crs","unsupported GeoJSON 'crs' member",{crs:r})}function T(e,t={}){const r=[],i=new Set,n=new Set;let s,o=!1,a=null,c=!1,{geometryType:p=null}=t;for(const t of h(e)){const{geometry:e,properties:h,id:m}=t;if((!e||(p||(p=u(e.type)),u(e.type)===p))&&(o||(o=f(d(e))),c||(c=null!=m,c&&(s=typeof m,h&&(a=Object.keys(h).filter((e=>h[e]===m))))),h&&a&&c&&null!=m&&(a.length>1?a=a.filter((e=>h[e]===m)):1===a.length&&(a=h[a[0]]===m?a:[])),h))for(const e in h){if(i.has(e))continue;const t=v(h[e]);if("unknown"===t){n.add(e);continue}n.delete(e),i.add(e);const s=(0,l.rS)(e);s&&r.push({name:s,alias:e,type:t})}}const m=(0,l.rS)(1===a?.length&&a[0]||null)??void 0;if(m)for(const e of r)if(e.name===m&&(0,l.WA)(e)){e.type="esriFieldTypeOID";break}return{fields:r,geometryType:p,hasZ:o,objectIdFieldName:m,objectIdFieldType:s,unknownFields:Array.from(n)}}function I(e,t){return Array.from(function*(e,t={}){const{geometryType:r,objectIdField:i}=t;for(const n of e){const{geometry:e,properties:s,id:l}=n;if(e&&u(e.type)!==r)continue;const c=s||{};let h;i&&(h=c[i],null==l||h||(c[i]=h=l));const d=new o.Om(e?_(new a.A,e,t):null,c,null,h??void 0);yield d}}(h(e),t))}},69619:function(e,t,r){r.d(t,{F0:function(){return l},Vx:function(){return h},e2:function(){return f},f:function(){return p}});var i=r(58941),n=r(21609),s=r(7121),o=r(79580),a=r(6259);function l(e){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===e||"esriGeometryMultipoint"===e?a.Cb:"esriGeometryPolyline"===e?a.yM:a.WR}}}const c=/^[_$a-zA-Z][_$a-zA-Z0-9]*$/;let u=1;function h(e,t){if((0,i.A)("esri-csp-restrictions"))return()=>({[t]:null,...e});try{let r=`this${d(t)} = null;`;for(const t in e)r+=`this${d(t)} = ${JSON.stringify(e[t])};`;const i=new Function(`\n      return class AttributesClass$${u++} {\n        constructor() {\n          ${r};\n        }\n      }\n    `)();return()=>new i}catch(r){return()=>({[t]:null,...e})}}function d(e){return c.test(e)?`.${e}`:`["${e}"]`}function f(e={}){return[{name:"New Feature",description:"",prototype:{attributes:(0,n.o8)(e)}}]}function p(e,t){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,isBranchVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:e},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:t,supportsDelete:t,supportsEditing:t,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryBins:!1,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:t,supportsExceedsLimitStatistics:!0,supportsAsyncConvert3D:!1},query:s.F,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},queryBins:o.$,editing:{supportsGeometryUpdate:t,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsAsyncApplyEdits:!1,zDefault:void 0}}}},89007:function(e,t,r){r.d(t,{$1:function(){return _},CR:function(){return m},MB:function(){return d},Yx:function(){return l},bP:function(){return u}});var i=r(37057),n=r(57652),s=r(53743);class o{constructor(){this.code=null,this.description=null}}class a{constructor(e){this.error=new o,this.globalId=null,this.objectId=null,this.success=!1,this.uniqueId=null,this.error.description=e}}function l(e){return new a(e)}class c{constructor(e){this.globalId=null,this.success=!0,this.objectId=this.uniqueId=e}}function u(e){return new c(e)}const h=new Set;function d(e,t,r,i=!1){h.clear();for(const n in r){const o=e.get(n);if(!o)continue;const a=f(o,r[n]);if(h.add(o.name),o&&(i||o.editable)){const e=(0,s.CJ)(o,a);if(e)return l((0,s.uo)(e,o,a));t[o.name]=a}}for(const t of e.requiredFields??[])if(!h.has(t.name))return l(`missing required field "${t.name}"`);return null}function f(e,t){let r=t;return(0,s.WA)(e)&&"string"==typeof t?r=parseFloat(t):(0,s.yM)(e)&&null!=t&&"string"!=typeof t?r=String(t):(0,s.vE)(e)&&"string"==typeof t&&(r=(0,i._U)(t)),(0,s.WX)(r)}let p;function m(e,t){if(!e||!(0,n.fn)(t))return e;if("rings"in e||"paths"in e){if(null==p)throw new TypeError("geometry engine not loaded");return p.simplify(t,e)}return e}async function _(e,t){!(0,n.fn)(e)||"esriGeometryPolygon"!==t&&"esriGeometryPolyline"!==t||await async function(){return null==p&&(p=await r.e(4696).then(r.bind(r,28356))),p}()}},47648:function(e,t,r){r.d(t,{GA:function(){return P},GL:function(){return I},I:function(){return F},J0:function(){return C},Ki:function(){return E},Px:function(){return A},QE:function(){return v},bV:function(){return M},bW:function(){return R},vJ:function(){return w}}),r(50917);var i=r(93040),n=r(39819),s=r(40633),o=r(90683),a=r(57652),l=r(1644),c=r(58081),u=r(72887),h=r(3418),d=r(69619),f=r(89007),p=r(7103),m=r(55644),_=r(21168),g=r(57165);const y=()=>s.A.getLogger("esri.layers.ogc.ogcFeatureUtils"),x="startindex",b=new Set([x,"offset"]),w="http://www.opengis.net/def/crs/",v=`${w}OGC/1.3/CRS84`;var S,T;async function I(e,t,r={},s=5){const{links:a}=e,l=D(a,"items",S.geojson)||D(a,"http://www.opengis.net/def/rel/ogc/1.0/items",S.geojson);if(null==l)throw new n.A("ogc-feature-layer:missing-items-page","Missing items url");const{apiKey:c,customParameters:u,signal:f}=r,g=(0,o.s2)(l.href,e.landingPage.url),b={limit:s,...u,token:c},w=(0,o.a6)(g,b),v={accept:S.geojson},{data:T}=await(0,i.A)(w,{signal:f,headers:v}),I=z(w,s,T.links)??x;(0,h.sO)(T);const M=(0,h.BM)(T,{geometryType:t.geometryType}),A=t.fields||M.fields||[],E=null!=t.hasZ?t.hasZ:M.hasZ,P=M.geometryType,C=t.objectIdField||M.objectIdFieldName||"OBJECTID";let R=t.timeInfo;const F=A.find((({name:e})=>e===C));if(F)F.editable=!1,F.nullable=!1;else{if(!M.objectIdFieldType)throw new n.A("ogc-feature-layer:missing-feature-id","Collection geojson require a feature id as a unique identifier");A.unshift({name:C,alias:C,type:"number"===M.objectIdFieldType?"esriFieldTypeOID":"esriFieldTypeString",editable:!1,nullable:!1})}if(C!==M.objectIdFieldName){const e=A.find((({name:e})=>e===M.objectIdFieldName));e&&(e.type="esriFieldTypeInteger")}A===M.fields&&M.unknownFields.length>0&&y().warn({name:"ogc-feature-layer:unknown-field-types",message:"Some fields types couldn't be inferred from the features and were dropped",details:{unknownFields:M.unknownFields}});for(const e of A){if(null==e.name&&(e.name=e.alias),null==e.alias&&(e.alias=e.name),"esriFieldTypeOID"!==e.type&&"esriFieldTypeGlobalID"!==e.type&&(e.editable=null==e.editable||!!e.editable,e.nullable=null==e.nullable||!!e.nullable),!e.name)throw new n.A("ogc-feature-layer:invalid-field-name","field name is missing",{field:e});if(!m.m.jsonValues.includes(e.type))throw new n.A("ogc-feature-layer:invalid-field-type",`invalid type for field "${e.name}"`,{field:e})}if(R){const e=new p.A(A);if(R.startTimeField){const t=e.get(R.startTimeField);t?(R.startTimeField=t.name,t.type="esriFieldTypeDate"):R.startTimeField=null}if(R.endTimeField){const t=e.get(R.endTimeField);t?(R.endTimeField=t.name,t.type="esriFieldTypeDate"):R.endTimeField=null}if(R.trackIdField){const t=e.get(R.trackIdField);t?R.trackIdField=t.name:(R.trackIdField=null,y().warn({name:"ogc-feature-layer:invalid-timeInfo-trackIdField",message:"trackIdField is missing",details:{timeInfo:R}}))}R.timeReference||={timeZoneIANA:_.n$},R.startTimeField||R.endTimeField||(y().warn({name:"ogc-feature-layer:invalid-timeInfo",message:"startTimeField and endTimeField are missing",details:{timeInfo:R}}),R=void 0)}return{drawingInfo:P?(0,d.F0)(P):null,extent:O(e),geometryType:P,fields:A,hasZ:!!E,objectIdField:C,paginationParameter:I,timeInfo:R}}async function M(e,t={}){const{links:r,url:s}=e,a=D(r,"data",S.json)||D(r,"http://www.opengis.net/def/rel/ogc/1.0/data",S.json);if(null==a)throw new n.A("ogc-feature-layer:missing-collections-page","Missing collections url");const{apiKey:l,customParameters:c,signal:u}=t,h=(0,o.s2)(a.href,s),{data:d}=await(0,i.A)(h,{signal:u,headers:{accept:S.json},query:{...c,token:l}});for(const t of d.collections)t.landingPage=e;return d}async function A(e,t={}){const{links:r,url:s}=e,a=D(r,"conformance",S.json)||D(r,"http://www.opengis.net/def/rel/ogc/1.0/conformance",S.json);if(null==a)throw new n.A("ogc-feature-layer:missing-conformance-page","Missing conformance url");const{apiKey:l,customParameters:c,signal:u}=t,h=(0,o.s2)(a.href,s),{data:d}=await(0,i.A)(h,{signal:u,headers:{accept:S.json},query:{...c,token:l}});return d}async function E(e,t={}){const{apiKey:r,customParameters:n,signal:s}=t,{data:o}=await(0,i.A)(e,{signal:s,headers:{accept:S.json},query:{...n,token:r}});return o.url=e,o}async function P(e,t={}){const{links:r,url:n}=e,s=D(r,"service-desc",S.openapi);if(null==s)return y().warn("ogc-feature-layer:missing-openapi-page","The OGC API-Features server does not have an OpenAPI page."),null;const{apiKey:a,customParameters:l,signal:c}=t,u=(0,o.s2)(s.href,n),{data:h}=await(0,i.A)(u,{signal:c,headers:{accept:S.openapi},query:{...l,token:a}});return h}function C(e){const t=/^http:\/\/www\.opengis.net\/def\/crs\/(?<authority>.*)\/(?<version>.*)\/(?<code>.*)$/i.exec(e),r=t?.groups;if(!r)return null;const{authority:i,code:n}=r;switch(i.toLowerCase()){case"ogc":switch(n.toLowerCase()){case"crs27":return g.A.GCS_NAD_1927.wkid;case"crs83":return 4269;case"crs84":case"crs84h":return g.A.WGS84.wkid;default:return null}case"esri":case"epsg":{const e=Number.parseInt(n,10);return Number.isNaN(e)?null:e}default:return null}}async function R(e,t,r){const i=await F(e,t,r);return(0,c.ZF)(i)}async function F(e,t,r){const{collection:{links:s,landingPage:{url:d}},layerDefinition:m,maxRecordCount:_,queryParameters:{apiKey:y,customParameters:x},spatialReference:b,supportedCrs:w}=e,v=D(s,"items",S.geojson)||D(s,"http://www.opengis.net/def/rel/ogc/1.0/items",S.geojson);if(null==v)throw new n.A("ogc-feature-layer:missing-items-page","Missing items url");const{geometry:T,num:I,start:M,timeExtent:A,where:E}=t;if(t.objectIds)throw new n.A("ogc-feature-layer:query-by-objectids-not-supported","Queries with object ids are not supported");const P=g.A.fromJSON(b),C=t.outSpatialReference??P,R=C.isWGS84?null:L(C,w),F=N(T,w),k=function(e){if(null==e)return null;const{start:t,end:r}=e;return`${null!=t?t.toISOString():".."}/${null!=r?r.toISOString():".."}`}(A),O=null!=(X=E)&&X&&"1=1"!==X?X:null,z=I??(null==M?_:10),U=0===M?void 0:M,{fields:G,geometryType:B,hasZ:V,objectIdField:q,paginationParameter:Z}=m,H=(0,o.s2)(v.href,d),{data:j}=await(0,i.A)(H,{...r,query:{...x,...F,crs:R,datetime:k,query:O,limit:z,[Z]:U,token:y},headers:{accept:S.geojson}}),W=(0,h.bd)(j,{geometryType:B,hasZ:V,objectIdField:q}),Y=W.length===z&&!!D(j.links??[],"next",S.geojson),$=new p.A(G);var X;for(const e of W){const t={};(0,f.MB)($,t,e.attributes,!0);for(const e of $.fields)e.nullable&&!(e.name in t)&&(t[e.name]=null);t[q]=e.attributes[q],e.attributes=t}if(!R&&C.isWebMercator)for(const e of W)if(null!=e.geometry&&null!=B){const t=(0,c.zv)(e.geometry,B,V,!1);t.spatialReference=g.A.WGS84,e.geometry=(0,c.Ux)((0,l.Cv)(t,C))}for(const e of W)e.objectId=e.attributes[q];const Q=R||!R&&C.isWebMercator?C.toJSON():a.KK,J=new u.A;return J.exceededTransferLimit=Y,J.features=W,J.fields=G,J.geometryType=B,J.hasZ=V,J.objectIdFieldName=q,J.spatialReference=Q,J}function L(e,t){const{isWebMercator:r,wkid:i}=e;if(!i)return null;const n=r?t[3857]??t[102100]??t[102113]??t[900913]:t[e.wkid];return n?`${w}${n}`:null}function k(e){if(null==e)return"";const{xmin:t,ymin:r,xmax:i,ymax:n}=e;return`${t},${r},${i},${n}`}function N(e,t){if(!function(e){return null!=e&&"extent"===e.type}(e))return null;const{spatialReference:r}=e;if(!r||r.isWGS84)return{bbox:k(e)};const i=L(r,t);return null!=i?{bbox:k(e),"bbox-crs":i}:r.isWebMercator?{bbox:k((0,l.Cv)(e,g.A.WGS84))}:null}function O(e){const t=e.extent?.spatial;if(!t)return null;const r=t.bbox[0],i=4===r.length,[n,s]=r,o=i?void 0:r[2];return{xmin:n,ymin:s,xmax:i?r[2]:r[3],ymax:i?r[3]:r[4],zmin:o,zmax:i?void 0:r[5],spatialReference:g.A.WGS84.toJSON()}}function D(e,t,r){return e.find((({rel:e,type:i})=>e===t&&i===r))??e.find((({rel:e,type:r})=>e===t&&!r))}function z(e,t,r){if(!r)return;const i=D(r,"next",S.geojson),n=(0,o.An)(i?.href)?.query;if(!n)return;const s=(0,o.An)(e).query,a=Object.keys(s??{}),l=Object.entries(n).filter((([e])=>!a.includes(e))).find((([e,r])=>b.has(e.toLowerCase())&&Number.parseInt(r,10)===t)),c=l?.[0];return c}(T=S||(S={})).json="application/json",T.geojson="application/geo+json",T.openapi="application/vnd.oai.openapi+json;version=3.0"},7103:function(e,t,r){r.d(t,{A:function(){return d}});var i=r(39819),n=r(30905),s=r(40633),o=r(25738),a=r(92955),l=r(53743),c=r(21168),u=r(96285);const h=new Map;class d{static fromJSON(e){return new d(e.fields,e.timeZoneByFieldName)}static fromLayer(e){return new d(e.fields??[],_(e))}static fromLayerJSON(e){return new d(e.fields??[],_(e))}constructor(e=[],t){this._fieldsMap=new Map,this._normalizedFieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this._requiredFields=null,this.dateFields=[],this.numericFields=[],this.fields=e||[],this._timeZoneByFieldName=t?new Map(t):null;const r=[];for(const e of this.fields){const t=e?.name,i=p(t);if(t&&i){const n=f(t);this._fieldsMap.set(t,e),this._fieldsMap.set(n,e),this._normalizedFieldsMap.set(i,e),r.push(`${n}:${e.type}:${this._timeZoneByFieldName?.get(t)}`),(0,l.vE)(e)?(this.dateFields.push(e),this._dateFieldsSet.add(e)):(0,l.WA)(e)&&(this._numericFieldsSet.add(e),this.numericFields.push(e)),(0,l.te)(e)||(0,l.Xz)(e)||(e.editable=null==e.editable||!!e.editable,e.nullable=null==e.nullable||!!e.nullable)}}r.sort(),this.uid=r.join()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const e of this.fields)(0,l.te)(e)||(0,l.Xz)(e)||e.nullable||void 0!==(0,l.lD)(e)||this._requiredFields.push(e)}return this._requiredFields}equals(e){return this.uid===e?.uid}has(e){return null!=this.get(e)}get(e){if(!e)return;let t=this._fieldsMap.get(e);return t||(t=this._fieldsMap.get(f(e))??this._normalizedFieldsMap.get(p(e)),t&&this._fieldsMap.set(e,t),t)}getTimeZone(e){const t=this.get(e&&"string"!=typeof e?e.name:e);return t?this._timeZoneByFieldName?this._timeZoneByFieldName.get(t.name):"date"===t.type||"esriFieldTypeDate"===t.type?(s.A.getLogger("esri.layers.support.FieldsIndex").error(new i.A("getTimeZone:no-timezone-information",`no time zone information for field '${t.name}'`)),c.n$):m.has(t.type)?c.L5:null:null}getLuxonTimeZone(e){const t=this.getTimeZone(e);return t?t===c.L5?a.GB.instance:t===c.n$?u.mQ.utcInstance:(0,o.tE)(h,t,(()=>u.oh.create(t))):null}isDateField(e){return this._dateFieldsSet.has(this.get(e))}isTimeOnlyField(e){return(0,l.OH)(this.get(e))}isNumericField(e){return this._numericFieldsSet.has(this.get(e))}normalizeFieldName(e){return this.get(e)?.name??void 0}toJSON(){return{fields:this.fields.map((e=>(0,n.Wj)(e)?e.toJSON():e)),timeZoneByFieldName:this._timeZoneByFieldName?Array.from(this._timeZoneByFieldName.entries()):null}}}function f(e){return e.trim().toLowerCase()}function p(e){return(0,l.rS)(e)?.toLowerCase()??""}const m=new Set(["time-only","date-only","timestamp-offset","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]);function _(e){const t=new Map;if(!e.fields)return t;const r=!0===e.datesInUnknownTimezone,{timeInfo:i,editFieldsInfo:n}=e,s=(i?"startField"in i?i.startField:i.startTimeField:"")??"",o=(i?"endField"in i?i.endField:i.endTimeField:"")??"",a=function(e){return"dateFieldsTimeZone"in e}(e)?e.dateFieldsTimeZone??null:e.dateFieldsTimeReference?(0,c.ZS)(e.dateFieldsTimeReference):null,l=n?function(e){return"timeZone"in e}(n)?n.timeZone??a:n.dateFieldsTimeReference?(0,c.ZS)(n.dateFieldsTimeReference):a??c.n$:null,u=i?function(e){return"timeZone"in e}(i)?i.timeZone??a:i.timeReference?(0,c.ZS)(i.timeReference):a:null,h=new Map([[f(n?.creationDateField??""),l],[f(n?.editDateField??""),l],[f(s),u],[f(o),u]]);for(const{name:i,type:n}of e.fields)if(m.has(n))t.set(i,c.L5);else if("date"!==n&&"esriFieldTypeDate"!==n)t.set(i,null);else if(r)t.set(i,c.L5);else{const e=h.get(f(i??""))??a;t.set(i,e)}return t}},44431:function(e,t,r){r.d(t,{A:function(){return u}});var i,n=r(53804),s=r(30905),o=r(23502),a=r(67888),l=(r(13798),r(58941),r(65953));let c=i=class extends s.oY{constructor(e){super(e),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new i({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};(0,n._)([(0,o.MZ)({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],c.prototype,"cols",void 0),(0,n._)([(0,o.MZ)({type:a.jz,json:{write:!0}})],c.prototype,"level",void 0),(0,n._)([(0,o.MZ)({type:String,json:{write:!0}})],c.prototype,"levelValue",void 0),(0,n._)([(0,o.MZ)({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],c.prototype,"origin",void 0),(0,n._)([(0,o.MZ)({type:Number,json:{write:!0}})],c.prototype,"resolution",void 0),(0,n._)([(0,o.MZ)({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],c.prototype,"rows",void 0),(0,n._)([(0,o.MZ)({type:Number,json:{write:!0}})],c.prototype,"scale",void 0),c=i=(0,n._)([(0,l.$)("esri.layers.support.LOD")],c);const u=c},47558:function(e,t,r){r.d(t,{T:function(){return o}});var i=r(60539),n=r(85445),s=r(55213);class o{constructor(){this._tasks=new Array,this._runningTasks=(0,n.v)(0)}get length(){return this._tasks.length}get running(){return this._runningTasks.value>0}destroy(){this.cancelAll()}runTask(e){if(0===this.length)return s.G;for(;!e.done&&this._process(e);)e.madeProgress()}push(e,t,r){return++this._runningTasks.value,new Promise(((i,n)=>this._tasks.push(new a(i,n,e,t,r)))).finally((()=>--this._runningTasks.value))}unshift(e,t,r){return++this._runningTasks.value,new Promise(((i,n)=>this._tasks.unshift(new a(i,n,e,t,r)))).finally((()=>--this._runningTasks.value))}_process(e){if(0===this._tasks.length)return!1;const t=this._tasks.shift();try{const r=(0,i.G4)(t.signal);if(r&&!t.abortCallback)t.reject((0,i.NK)());else{const n=r?t.abortCallback?.((0,i.NK)()):t.callback(e);(0,i.$X)(n)?n.then(t.resolve,t.reject):t.resolve(n)}}catch(e){t.reject(e)}return!0}cancelAll(){const e=(0,i.NK)();for(const t of this._tasks)if(t.abortCallback){const r=t.abortCallback(e);t.resolve(r)}else t.reject(e);this._tasks.length=0}}class a{constructor(e,t,r,i=void 0,n=void 0){this.resolve=e,this.reject=t,this.callback=r,this.signal=i,this.abortCallback=n}}},76226:function(e,t,r){r.r(t),r.d(t,{default:function(){return T}});var i,n=r(53804),s=r(73037),o=r(30905),a=r(62938),l=r(23502),c=r(67888),u=(r(13798),r(58941),r(47332)),h=r(65953),d=r(81392),f=r(45532),p=r(57165),m=r(87416),_=r(57652),g=r(1644),y=r(44431),x=r(29679);const b=new s.J({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let w=i=class extends o.oY{static create(e={}){const{resolutionFactor:t=1,scales:r,size:n=256,spatialReference:s=p.A.WebMercator,numLODs:o=24}=e;if(!(0,_.fn)(s)){const e=[];if(r)for(let t=0;t<r.length;t++){const i=r[t];e.push(new y.A({level:t,scale:i,resolution:i}))}else{let t=5e-4;for(let r=o-1;r>=0;r--)e.unshift(new y.A({level:r,scale:t,resolution:t})),t*=2}return new i({dpi:96,lods:e,origin:new f.default(0,0,s),size:[n,n],spatialReference:s})}const l=(0,_.Vp)(s),c=e.origin?new f.default({x:e.origin.x,y:e.origin.y,spatialReference:s}):new f.default(l?{x:l.origin[0],y:l.origin[1],spatialReference:s}:{x:0,y:0,spatialReference:s}),u=1/(39.37*(0,a.GA)(s)*96),h=[];if(r)for(let e=0;e<r.length;e++){const t=r[e],i=t*u;h.push(new y.A({level:e,scale:t,resolution:i}))}else{let e=(0,_.EA)(s)?512/n*591657527.5917094:256/n*591657527.591555;const r=Math.ceil(o/t);h.push(new y.A({level:0,scale:e,resolution:e*u}));for(let i=1;i<r;i++){const r=e/2**t,n=r*u;h.push(new y.A({level:i,scale:r,resolution:n})),e=r}}return new i({dpi:96,lods:h,origin:c,size:[n,n],spatialReference:s})}constructor(e){super(e),this.dpi=96,this.format=null,this.origin=null,this.size=null,this.spatialReference=null}get isWrappable(){const{spatialReference:e,origin:t}=this;if(e&&t){const r=(0,_.Vp)(e);return e.isWrappable&&!!r&&Math.abs(r.origin[0]-t.x)<=r.dx}return!1}readOrigin(e,t){return f.default.fromJSON({spatialReference:t.spatialReference,...e})}set lods(e){let t=0,r=0;const i=[],n=this._levelToLOD={};e&&(t=-1/0,r=1/0,e.forEach((e=>{i.push(e.scale),t=e.scale>t?e.scale:t,r=e.scale<r?e.scale:r,n[e.level]=e}))),this._set("scales",i),this._set("lods",e),this._initializeUpsampleLevels()}readSize(e,t){return[t.cols,t.rows]}writeSize(e,t){t.cols=e[0],t.rows=e[1]}zoomToScale(e){const t=this.scales;if(e<=0)return t[0];if(e>=t.length-1)return t[t.length-1];const r=Math.floor(e),i=r+1;return t[r]/(t[r]/t[i])**(e-r)}scaleToZoom(e){const t=this.scales,r=t.length-1;let i=0;for(;i<r;i++){const r=t[i],n=t[i+1];if(r<=e)return i;if(n===e)return i+1;if(r>e&&n<e)return i+Math.log(r/e)/Math.log(r/n)}return i}tileAt(e,t,r,i){const n=this.lodAt(e);if(!n)return null;let s,o;if("number"==typeof t)s=t,o=r;else if((0,_.aI)(t.spatialReference,this.spatialReference))s=t.x,o=t.y,i=r;else{const e=(0,g.Cv)(t,this.spatialReference);if(null==e)return null;s=e.x,o=e.y,i=r}const a=n.resolution*this.size[0],l=n.resolution*this.size[1];return i||(i=new x.U(null,0,0,0,(0,m.vt)())),i.level=e,i.row=Math.floor((this.origin.y-o)/l+.001),i.col=Math.floor((s-this.origin.x)/a+.001),this.updateTileInfo(i),i}updateTileInfo(e,t=i.ExtrapolateOptions.NONE){let r=this.lodAt(e.level);if(!r&&t===i.ExtrapolateOptions.POWER_OF_TWO){const t=this.lods[this.lods.length-1];t.level<e.level&&(r=t)}if(!r)return;const n=e.level-r.level,s=r.resolution*this.size[0]/2**n,o=r.resolution*this.size[1]/2**n;e.id=`${e.level}/${e.row}/${e.col}`,e.extent||(e.extent=(0,m.vt)()),e.extent[0]=this.origin.x+e.col*s,e.extent[1]=this.origin.y-(e.row+1)*o,e.extent[2]=e.extent[0]+s,e.extent[3]=e.extent[1]+o}upsampleTile(e){const t=this._upsampleLevels[e.level];return!(!t||-1===t.parentLevel||(e.level=t.parentLevel,e.row=Math.floor(e.row/t.factor+.001),e.col=Math.floor(e.col/t.factor+.001),this.updateTileInfo(e),0))}getTileBounds(e,t){const r=this.lodAt(t.level);if(null==r)return null;const{resolution:i}=r,n=i*this.size[0],s=i*this.size[1];return e[0]=this.origin.x+t.col*n,e[1]=this.origin.y-(t.row+1)*s,e[2]=e[0]+n,e[3]=e[1]+s,e}lodAt(e){return this._levelToLOD?.[e]??null}clone(){return i.fromJSON(this.write({}))}getCompatibleForVTL(e){if(this.size[0]!==this.size[1]||256===this.size[0]&&512===e)return null;const t=(512===this.size[0]&&256===e?-1:0)+(this.spatialReference.isGeographic?1:0);if(this.size[0]===e&&0===t)return this;const r=[],n=this.lods.length-t;for(let e=0;e<n;e++){const i=e+t,{scale:n,resolution:s}=i>=0?this.lods[i]:{scale:2*this.lods[0].scale,resolution:2*this.lods[0].resolution};r.push(new y.A({level:e,scale:n,resolution:s}))}return new i({size:[e,e],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:r})}_initializeUpsampleLevels(){const e=this.lods;this._upsampleLevels=[];let t=null;for(let r=0;r<e.length;r++){const i=e[r];this._upsampleLevels[i.level]={parentLevel:t?t.level:-1,factor:t?t.resolution/i.resolution:0},t=i}}};var v,S;(0,n._)([(0,l.MZ)({type:Number,json:{write:!0}})],w.prototype,"compressionQuality",void 0),(0,n._)([(0,l.MZ)({type:Number,json:{write:!0}})],w.prototype,"dpi",void 0),(0,n._)([(0,l.MZ)({type:String,json:{read:b.read,write:b.write,origins:{"web-scene":{read:!1,write:!1}}}})],w.prototype,"format",void 0),(0,n._)([(0,l.MZ)({readOnly:!0})],w.prototype,"isWrappable",null),(0,n._)([(0,l.MZ)({type:f.default,json:{write:!0}})],w.prototype,"origin",void 0),(0,n._)([(0,u.w)("origin")],w.prototype,"readOrigin",null),(0,n._)([(0,l.MZ)({type:[y.A],value:null,json:{write:!0}})],w.prototype,"lods",null),(0,n._)([(0,l.MZ)({readOnly:!0})],w.prototype,"scales",void 0),(0,n._)([(0,l.MZ)({cast:e=>Array.isArray(e)?e:"number"==typeof e?[e,e]:[256,256]})],w.prototype,"size",void 0),(0,n._)([(0,u.w)("size",["rows","cols"])],w.prototype,"readSize",null),(0,n._)([(0,d.K)("size",{cols:{type:c.jz},rows:{type:c.jz}})],w.prototype,"writeSize",null),(0,n._)([(0,l.MZ)({type:p.A,json:{write:!0}})],w.prototype,"spatialReference",void 0),w=i=(0,n._)([(0,h.$)("esri.layers.support.TileInfo")],w),v=w||(w={}),(S=v.ExtrapolateOptions||(v.ExtrapolateOptions={}))[S.NONE=0]="NONE",S[S.POWER_OF_TWO=1]="POWER_OF_TWO";const T=w},29679:function(e,t,r){r.d(t,{U:function(){return i}});class i{constructor(e,t,r,i,n=void 0){this.id=e,this.level=t,this.row=r,this.col=i,this.extent=n}}},93389:function(e,t,r){r.d(t,{Fi:function(){return u},HZ:function(){return g},Jf:function(){return _},LS:function(){return y},Wo:function(){return m},bd:function(){return x},cr:function(){return f},iz:function(){return d},qg:function(){return h},yG:function(){return p}});var i=r(90683),n=r(60534);const s={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",knowledgegraphserver:"KnowledgeGraphServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer","3dtilesserver":"3DTilesServer",videoserver:"VideoServer"},o=Object.values(s),a=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${o.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),l=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^/\\n]+)\\/(${o.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),c=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function u(e){return a.test(e)}function h(e){if(null==e)return null;const t=(0,i.An)(e),r=t?.path.match(a)||t?.path.match(l);if(!r)return null;const[,n,o,c,u]=r,h=o.indexOf("/");return{title:f(-1!==h?o.slice(h+1):o),serverType:s[c.toLowerCase()],sublayer:null!=u&&""!==u?parseInt(u,10):null,url:{path:n}}}function d(e){const t=(0,i.An)(e).path.match(c);return t?{serviceUrl:t[1],sublayerId:Number(t[2])}:null}function f(e){return(e=e.replaceAll(/\s*[/_]+\s*/g," "))[0].toUpperCase()+e.slice(1)}function p(e,t){const r=[];if(e){const t=h(e);null!=t&&t.title&&r.push(t.title)}if(t){const e=f(t);r.push(e)}if(2===r.length){if(r[0].toLowerCase().includes(r[1].toLowerCase()))return r[0];if(r[1].toLowerCase().includes(r[0].toLowerCase()))return r[1]}return r.join(" - ")}function m(e){let t=(0,i.$z)(e,!0);return!!t&&(t=t.toLowerCase(),t.endsWith(".arcgis.com")&&(t.startsWith("services")||t.startsWith("tiles")||t.startsWith("features")))}function _(e,t){return e?(0,i.UC)((0,i.zi)(e,t)):e}function g(e){let{url:t}=e;if(!t)return{url:t};t=(0,i.zi)(t,e.logger);const r=(0,i.An)(t),n=h(r.path);let s;if(null!=n)null!=n.sublayer&&null==e.layer.layerId&&(s=n.sublayer),t=n.url.path;else if(e.nonStandardUrlAllowed){const e=d(r.path);null!=e&&(t=e.serviceUrl,s=e.sublayerId)}return{url:(0,i.UC)(t),layerId:s}}function y(e,t,r,s,o){(0,n.w)(t,s,"url",o),s.url&&null!=e.layerId&&(s.url=(0,i.fj)(s.url,r,e.layerId.toString()))}function x(e){if(!e)return!1;const t=e.toLowerCase(),r=t.includes("/services/"),i=t.includes("/mapserver/wmsserver"),n=t.includes("/imageserver/wmsserver"),s=t.includes("/wmsserver");return r&&(i||n||s)}},79580:function(e,t,r){r.d(t,{$:function(){return i},P:function(){return n}});const i={supportsDate:!1,supportsFixedInterval:!1,supportsAutoInterval:!1,supportsFixedBoundaries:!1,supportedStatistics:void 0},n={analytics:{supportsCacheHint:!1},attachment:{supportsContentType:!1,supportsExifInfo:!1,supportsKeywords:!1,supportsName:!1,supportsSize:!1,supportsCacheHint:!1,supportsResize:!1},data:{isVersioned:!1,isBranchVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:!1},editing:{supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsGeometryUpdate:!1,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsAsyncApplyEdits:!1,zDefault:void 0},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:!1,supportsDelete:!1,supportsEditing:!1,supportsChangeTracking:!1,supportsQuery:!1,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryBins:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:!1,supportsExceedsLimitStatistics:!1,supportsAsyncConvert3D:!1},queryRelated:{supportsCount:!1,supportsOrderBy:!1,supportsPagination:!1,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},queryBins:i,query:{maxRecordCount:0,maxRecordCountFactor:0,standardMaxRecordCount:0,supportsCacheHint:!1,supportsCentroid:!1,supportsCompactGeometry:!1,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsDisjointSpatialRelationship:!1,supportsDistance:!1,supportsDistinct:!1,supportsExtent:!1,supportsFormatPBF:!1,supportsGeometryProperties:!1,supportsHavingClause:!1,supportsHistoricMoment:!1,supportsMaxRecordCountFactor:!1,supportsOrderBy:!1,supportsPagination:!1,supportsPercentileStatistics:!1,supportsQuantization:!1,supportsQuantizationEditMode:!1,supportsQueryByAnonymous:!1,supportsQueryByOthers:!1,supportsQueryGeometry:!1,supportsResultType:!1,supportsSqlExpression:!1,supportsStandardizedQueriesOnly:!1,supportsTopFeaturesQuery:!1,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsStatistics:!1,tileMaxRecordCount:0}}},6361:function(e,t,r){r.d(t,{BI:function(){return _},D3:function(){return p},XJ:function(){return m},lc:function(){return f},mX:function(){return y},rU:function(){return g},tH:function(){return S}});var i=r(50944);const n="__begin__",s="__end__",o=new RegExp(n,"ig"),a=new RegExp(s,"ig"),l=new RegExp("^"+n,"i"),c=new RegExp(s+"$","i"),u='"',h=u+" + ",d=" + "+u;function f(e){return e.replaceAll(new RegExp("\\[","g"),"{").replaceAll(new RegExp("\\]","g"),"}")}function p(e){return e.replaceAll(new RegExp("\\{","g"),"[").replaceAll(new RegExp("\\}","g"),"]")}function m(e){const t={expression:"",type:"none"};return e.labelExpressionInfo?e.labelExpressionInfo.value?(t.expression=e.labelExpressionInfo.value,t.type="conventional"):e.labelExpressionInfo.expression&&(t.expression=e.labelExpressionInfo.expression,t.type="arcade"):null!=e.labelExpression&&(t.expression=f(e.labelExpression),t.type="conventional"),t}function _(e){const t=m(e);if(!t)return null;switch(t.type){case"conventional":return y(t.expression);case"arcade":return t.expression}return null}function g(e){const t=m(e);if(!t)return null;switch(t.type){case"conventional":return function(e){const t=e?.match(x);return t?.[1].trim()||null}(t.expression);case"arcade":return S(t.expression)}return null}function y(e){let t;return e?(t=(0,i.HC)(e,(e=>n+'$feature["'+e+'"]'+s)),t=l.test(t)?t.replace(l,""):u+t,t=c.test(t)?t.replace(c,""):t+u,t=t.replaceAll(o,h).replaceAll(a,d)):t='""',t}const x=/^\s*\{([^}]+)\}\s*$/i,b=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])(.+)(\2)\]));?\s*$/i,w=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])(.+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,v=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(.+)(\1)\s*\));?\s*$/i;function S(e){if(!e)return null;let t=b.exec(e)||w.exec(e);return t?t[1]||t[3]:(t=v.exec(e),t?t[2]:null)}},43173:function(e,t,r){r.r(t),r.d(t,{default:function(){return P}});var i=r(53804),n=r(53216),s=r(39819),o=r(30905),a=r(21609),l=r(31609),c=r(90683),u=r(23502),h=r(67888),d=r(47332),f=r(65953),p=r(91484),m=r(51432),_=r(83525),g=r(40633),y=r(77560);r(13798),r(58941);let x=class extends _.A{constructor(e){super(e),this.portalItem=null}normalizeCtorArgs(e){return e?.portalItem&&e.path?{...e,path:b(e.path,e.portalItem)}:e}set path(e){null!=e&&(0,c.oP)(e)?g.A.getLogger(this).error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",e)}_castPath(e){return b(e,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get cdnUrl(){return this.portalItem&&this.path?`${this.portalItem.itemCdnUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(e="json",t){const r=this.cdnUrl;if(null==r)throw new s.A("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal.request(r,{responseType:e,query:{token:this.portalItem.apiKey,_ts:t?.cacheBust?Date.now():null},signal:t?.signal})}async update(e,t){const{addOrUpdateResources:i}=await r.e(4460).then(r.bind(r,55597));return await i(this.portalItem,[{resource:this,content:e,compress:t?.compress,access:t?.access}],"update",t),this}hasPath(){return null!=this.path}};function b(e,t){return null==e?e:(e=e.replace(/^\/+/,""),null!=t&&(0,c.oP)(e)&&(e=(0,c.V1)(e,t.itemUrl)),e?.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}(0,i._)([(0,u.MZ)()],x.prototype,"portalItem",void 0),(0,i._)([(0,u.MZ)({type:String,value:null})],x.prototype,"path",null),(0,i._)([(0,y.w)("path")],x.prototype,"_castPath",null),(0,i._)([(0,u.MZ)({type:String,readOnly:!0})],x.prototype,"url",null),(0,i._)([(0,u.MZ)({type:String,readOnly:!0})],x.prototype,"cdnUrl",null),(0,i._)([(0,u.MZ)({type:String,readOnly:!0})],x.prototype,"itemRelativeUrl",null),x=(0,i._)([(0,f.$)("esri.portal.PortalItemResource")],x);const w=x;let v=class extends _.A{constructor(e){super(e),this.created=null,this.rating=null}};(0,i._)([(0,u.MZ)()],v.prototype,"created",void 0),(0,i._)([(0,u.MZ)()],v.prototype,"rating",void 0),v=(0,i._)([(0,f.$)("esri.portal.PortalRating")],v);const S=v;var T,I=r(60534);const M=new Set(["3DTiles Service","CSV","Feature Collection","Feature Service","Feed","GeoJson","Group Layer","Image Service","KML","Map Service","Media Layer","Scene Service","Stream Service","Vector Tile Service","WFS","WMS","WMTS"]),A=new Set(["KML","GeoJson","CSV"]);let E=T=class extends((0,o.Te)(l.A)){static from(e){return(0,h.PZ)(T,e)}constructor(e){super(e),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.classification=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.isOrgItem=!1,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.sourceUrl=null,this.spatialReference=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}destroy(){this.portal=null}get displayName(){const e=this.type,t=this.typeKeywords||[];let r=e;return"Feature Service"===e||"Feature Collection"===e?r=t.includes("Table")?"Table":t.includes("Route Layer")?"Route Layer":t.includes("Markup")?"Markup":"Feature Layer":"Image Service"===e?r=t.includes("Elevation 3D Layer")?"Elevation Layer":t.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":"Scene Service"===e?r="Scene Layer":"Video Service"===e?r="Video Layer":"Scene Package"===e?r="Scene Layer Package":"Stream Service"===e?r="Feature Layer":"Geoprocessing Service"===e?r=t.includes("Web Tool")?"Tool":"Geoprocessing Service":"Geoenrichment Service"===e?r="GeoEnrichment Service":"Geocoding Service"===e?r="Locator":"Microsoft Powerpoint"===e?r="Microsoft PowerPoint":"GeoJson"===e?r="GeoJSON":"Globe Service"===e?r="Globe Layer":"Vector Tile Service"===e?r="Tile Layer":"netCDF"===e?r="NetCDF":"Map Service"===e?r=t.includes("Spatiotemporal")||!t.includes("Hosted Service")&&!t.includes("Tiled")||t.includes("Relational")?"Map Image Layer":"Tile Layer":e?.toLowerCase().includes("add in")?r=e.replaceAll(/(add in)/gi,"Add-In"):"datastore catalog service"===e?r="Big Data File Share":"Compact Tile Package"===e?r="Tile Package (tpkx)":"Raster function template"===e?r="Raster Function Template":"OGCFeatureServer"===e?r="OGC Feature Layer":"web mapping application"===e&&t.includes("configurableApp")?r="Instant App":"Insights Page"===e?r="Insights Report":"Excalibur Imagery Project"===e?r="Excalibur Project":"3DTiles Service"===e?r="3D tiles layer":"3DTiles Package"===e&&(r="3D tiles package"),r}readExtent(e){return e&&e.length?new p.default(e[0][0],e[0][1],e[1][0],e[1][1]):null}get iconUrl(){const e=this.type?.toLowerCase()||"",t=this.typeKeywords||[];let r,i=!1,s=!1,o=!1,a=!1,l=!1,c=!1,u=!1,h=!1;return e.indexOf("service")>0||"feature collection"===e||"kml"===e||"wms"===e||"wmts"===e||"wfs"===e?(i=t.includes("Hosted Service"),"feature service"===e||"feature collection"===e||"kml"===e||"wfs"===e?(s=t.includes("Table"),o=t.includes("Route Layer"),a=t.includes("Markup"),l=t.includes("Spatiotemporal"),c=t.includes("UtilityNetwork"),r=l&&s?"spatiotemporaltable":s?"table":o?"routelayer":a?"markup":l?"spatiotemporal":c?"utilitynetwork":i?"featureshosted":"features"):"map service"===e||"wms"===e||"wmts"===e?(l=t.includes("Spatiotemporal"),u=t.includes("Relational"),r=l||u?"mapimages":i||t.includes("Tiled")||"wmts"===e?"maptiles":"mapimages"):r="scene service"===e?t.includes("Line")?"sceneweblayerline":t.includes("3DObject")?"sceneweblayermultipatch":t.includes("Point")?"sceneweblayerpoint":t.includes("IntegratedMesh")?"sceneweblayermesh":t.includes("PointCloud")?"sceneweblayerpointcloud":t.includes("Polygon")?"sceneweblayerpolygon":t.includes("Building")?"sceneweblayerbuilding":t.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":"image service"===e?t.includes("Elevation 3D Layer")?"elevationlayer":t.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":"stream service"===e?"streamlayer":"vector tile service"===e?"vectortile":"datastore catalog service"===e?"datastorecollection":"geocoding service"===e?"geocodeservice":"video service"===e?t.includes("Live Stream")?"livestreamvideolayer":"videolayer":"geoprocessing service"===e?t.includes("Web Tool")?"tool":"layers":"geodata service"===e?"geodataservice":"3dtiles service"===e?t.includes("3DObject")?"3dobjecttileslayer":t.includes("IntegratedMesh")?"integratedmeshtileslayer":"3dtileslayer":"layers"):"web map"===e||"cityengine web scene"===e?r="maps":"web scene"===e?r=t.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":"web mapping application"===e&&t.includes("configurableApp")?r="instantapps":"web mapping application"===e||"mobile application"===e||"application"===e||"operation view"===e||"desktop application"===e?r="apps":"map document"===e||"map package"===e||"published map"===e||"scene document"===e||"globe document"===e||"basemap package"===e||"mobile basemap package"===e||"mobile map package"===e||"project package"===e||"project template"===e||"pro map"===e||"layout"===e||"layer"===e&&t.includes("ArcGIS Pro")||"explorer map"===e&&t.indexOf("Explorer Document")?r="mapsgray":"service definition"===e||"shapefile"===e||"cad drawing"===e||"geojson"===e||"netcdf"===e||"administrative report"===e?r="datafiles":"360 vr experience"===e?r="360vr":"explorer add in"===e||"desktop add in"===e||"windows viewer add in"===e||"windows viewer configuration"===e?r="appsgray":"arcgis pro add in"===e||"arcgis pro configuration"===e?r="addindesktop":"pdf"===e?r="pdf":"microsoft word"===e?r="word":"microsoft excel"===e?r="excel":"microsoft powerpoint"===e?r="ppt":"rule package"===e||"file geodatabase"===e||"sqlite geodatabase"===e||"csv collection"===e||"kml collection"===e||"windows mobile package"===e||"map template"===e||"desktop application template"===e||"gml"===e||"arcpad package"===e||"code sample"===e||"document link"===e||"earth configuration"===e||"operations dashboard add in"===e||"rules package"===e||"workflow manager package"===e||"explorer map"===e&&t.includes("Explorer Mapping Application")||t.includes("Document")?r="datafilesgray":"network analysis service"===e||"geoprocessing service"===e||"geodata service"===e||"geometry service"===e||"geoprocessing package"===e||"locator package"===e||"geoprocessing sample"===e||"workflow manager service"===e?r="toolsgray":"layer"===e||"layer package"===e||"explorer layer"===e?r="layersgray":"analysis model"===e?r="analysismodel":"scene package"===e?r="scenepackage":"3dtiles package"===e?r="3dtileslayerpackage":"3dtiles service"===e?r="3dtileslayer":"mobile scene package"===e?r="mobilescenepackage":"tile package"===e||"compact tile package"===e?r="tilepackage":"task file"===e?r="taskfile":"report template"===e?r="report-template":"statistical data collection"===e?r="statisticaldatacollection":"insights workbook"===e?r="workbook":"insights model"===e?r="insightsmodel":"insights page"===e?r="insightspage":"insights theme"===e?r="insightstheme":"hub initiative"===e?r="hubinitiative":"hub page"===e?r="hubpage":"hub site application"===e?r="hubsite":"hub event"===e?r="hubevent":"hub project"===e?r="hubproject":"relational database connection"===e?r="relationaldatabaseconnection":"big data file share"===e?r="datastorecollection":"image collection"===e?r="imagecollection":"desktop style"===e?r="desktopstyle":"style"===e?r=t.includes("Dictionary")?"dictionarystyle":"style":"dashboard"===e?r="dashboard":"raster function template"===e?r="rasterprocessingtemplate":"vector tile package"===e?r="vectortilepackage":"ortho mapping project"===e?r="orthomappingproject":"ortho mapping template"===e?r="orthomappingtemplate":"solution"===e?r="solutions":"geopackage"===e?r="geopackage":"deep learning package"===e?r="deeplearningpackage":"real time analytic"===e?r="realtimeanalytics":"reality mapping project"===e?r="realitymappingproject":"big data analytic"===e?r="bigdataanalytics":"feed"===e?r="feed":"excalibur imagery project"===e?r="excaliburimageryproject":"notebook"===e?r="notebook":"storymap"===e?r="storymap":"survey123 add in"===e?r="survey123addin":"mission"===e?r="mission":"mission report"===e?r="missionreport":"mission template"===e?r="missiontemplate":"quickcapture project"===e?r="quickcaptureproject":"pro report"===e?r="proreport":"pro report template"===e?r="proreporttemplate":"urban model"===e?r="urbanmodel":"urban project"===e?r="urbanproject":"web experience"===e?r="experiencebuilder":"web experience template"===e?r="webexperiencetemplate":"experience builder widget"===e?r="experiencebuilderwidget":"experience builder widget package"===e?r="experiencebuilderwidgetpackage":"workflow"===e?r="workflow":"kernel gateway connection"===e?r="kernelgatewayconnection":"insights script"===e?r="insightsscript":"hub initiative template"===e?r="hubinitiativetemplate":"storymap theme"===e?r="storymaptheme":"knowledge graph"===e?r="knowledgegraph":"knowledge graph layer"===e?r="knowledgegraphlayer":"knowledge studio project"===e?r="knowledgestudio":"native application"===e?r="nativeapp":"native application installer"===e?r="nativeappinstaller":"web link chart"===e?r="linkchart":"knowledge graph web investigation"===e?r="investigation":"ogcfeatureserver"===e?r="features":"pro presentation"===e?r="propresentation":"pro project"===e?r="proproject":"insights workbook package"===e?r="insightsworkbookpackage":"apache parquet"===e?r="apacheparquet":"notebook code snippet library"===e?r="notebookcodesnippets":"suitability model"===e?r="suitabilitymodel":"esri classifier definition"===e?r="classifierdefinition":"esri classification schema"===e?r="classificationschema":"insights data engineering workbook"===e?r="dataengineeringworkbook":"insights data engineering model"===e?r="dataengineeringmodel":"deep learning studio project"===e?r="deeplearningproject":"discussion"===e?r="discussion":"allsource project"===e?r="allsourceproject":"api key"===e?r="apikey":"data pipeline"===e?r="datapipelines":"group layer"===e?(h=t.includes("Map"),r=h?"layergroup2d":"layergroup"):r="media layer"===e?"onlinemedialayer":"form"===e?t.includes("Survey123")?"survey":"datafilesgray":"csv"===e?"csv":"image"===e?"image":"maps",r?(0,n.s)("esri/images/portal/"+r+"16.png"):null}get isLayer(){return null!=this.type&&M.has(this.type)}get itemCdnUrl(){return(0,I.a)(this.itemUrl)}get itemPageUrl(){const e=this.portal?.itemPageUrl;return e&&this.id?`${e}?id=${this.id}`:null}get itemUrl(){const e=this.portal?.restUrl;return e&&this.id?`${e}/content/items/${this.id}`:null}get thumbnailUrl(){const e=this.itemUrl,t=this.thumbnail;return e&&t?this.portal?.normalizeUrl(`${e}/info/${t}?f=json`)??null:null}get userItemUrl(){const e=this.portal?.restUrl;if(!e)return null;const t=this.owner||this.portal?.user?.username;return t?`${e}/content/users/${this.ownerFolder?`${t}/${this.ownerFolder}`:t}/items/${this.id}`:null}load(e){const t=this.portal??(this.portal=m.A.getDefault()),r=t.load(e).then((()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?t.request(this.itemUrl,{signal:null!=e?e.signal:null,query:{token:this.apiKey}}):{})).then((e=>{this.sourceJSON=e,this.read(e)}));return this.addResolvingPromise(r),Promise.resolve(this)}async addRating(e){const t={method:"post",query:{}};return e instanceof S&&(e=e.rating),null==e||isNaN(e)||"number"!=typeof e||(t.query.rating=e),this.portal?(await this.portal.request(this.itemUrl+"/addRating",t),new S({rating:e,created:new Date})):null}clone(){const e={access:this.access,accessInformation:this.accessInformation,applicationProxies:(0,a.o8)(this.applicationProxies),avgRating:this.avgRating,categories:(0,a.o8)(this.categories),classification:(0,a.o8)(this.classification),created:(0,a.o8)(this.created),culture:this.culture,description:this.description,extent:(0,a.o8)(this.extent),groupCategories:(0,a.o8)(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:(0,a.o8)(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:(0,a.o8)(this.screenshots),size:this.size,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:(0,a.o8)(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:(0,a.o8)(this.typeKeywords),url:this.url};this.loaded&&(e.loadStatus="loaded");const t=new T({sourceJSON:this.sourceJSON}).set(e);return t._set("isOrgItem",this.isOrgItem),t}createPostQuery(){const e=this.toJSON();for(const t of["tags","typeKeywords","categories"])e[t]=e[t]?.join(", ");for(const t of["extent","classification"]){const r=e[t];r&&(e[t]=JSON.stringify(r))}return e}async deleteRating(){await this.portal.request(this.itemUrl+"/deleteRating",{method:"post"})}fetchData(e="json",t){return this.portal.request(this.itemUrl+"/data",{responseType:e,...t,query:{token:this.apiKey}})}async fetchRating(e){const t=await this.portal.request(this.itemUrl+"/rating",{query:{token:this.apiKey},...e});return null!=t.rating?(t.created=new Date(t.created),new S(t)):null}fetchRelatedItems(e,t){return this.portal.requestToTypedArray(this.itemUrl+"/relatedItems",{query:{...e,token:this.apiKey},...t},T)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}reload(){return this.portal.request(this.itemUrl??"",{cacheBust:!0,query:{token:this.apiKey}}).then((e=>(this.applicationProxies&&!Object.hasOwn(e,"appProxies")&&(this.applicationProxies=null),this.sourceJSON=e,this.read(e),this)))}update(e){return this.id?this.load().then((()=>this.portal.signIn())).then((()=>{const t=e?.data,r={method:"post"};r.query=this.createPostQuery();for(const e in r.query)null===r.query[e]&&(r.query[e]="");return r.query.clearEmptyFields=!0,null!=t&&("string"==typeof t?r.query.text=t:"object"==typeof t&&(r.query.text=JSON.stringify(t))),this.portal.request(`${this.userItemUrl}/update`,r).then((()=>this.reload()))})):Promise.reject(new s.A("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async copy(e){if(!this.id)throw new s.A("portal:item-does-not-exist","The item does not exist yet");await this.load();const{portal:t,itemUrl:r}=this;await t.signIn();const{copyResources:i,folder:n,tags:o,title:a}=e||{},l={method:"post",query:{copyPrivateResources:"all"===i,folder:"string"==typeof n?n:n?.id,includeResources:!!i,tags:o?.join(","),title:a}},{itemId:c}=await t.request(`${r}/copy`,l);return new T({id:c,portal:t})}updateThumbnail(e){return this.id?this.load().then((()=>this.portal.signIn())).then((()=>{const t=e.thumbnail,r=e.filename,i={method:"post"};if("string"==typeof t)(0,c.DB)(t)?i.query={data:t}:i.query={url:(0,c.s2)(t)},null!=r&&(i.query.filename=r);else{const e=new FormData;null!=r?e.append("file",t,r):e.append("file",t),i.body=e}return this.portal.request(`${this.userItemUrl}/updateThumbnail`,i).then((()=>this.reload()))})):Promise.reject(new s.A("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(e={},t){const{fetchResources:i}=await r.e(4460).then(r.bind(r,55597));return i(this,e,t)}async addResource(e,t,i){const{addOrUpdateResources:n}=await r.e(4460).then(r.bind(r,55597));return e.portalItem=this,await n(this,[{resource:e,content:t,compress:i?.compress,access:i?.access}],"add",i),e}async removeResource(e,t){const{removeResource:i}=await r.e(4460).then(r.bind(r,55597));if(e.portalItem&&e.portalItem.itemUrl!==this.itemUrl)throw new s.A("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return i(this,e,t)}async removeAllResources(e){const{removeAllResources:t}=await r.e(4460).then(r.bind(r,55597));return t(this,e)}resourceFromPath(e){return new w({portalItem:this,path:e})}toJSON(){const e=this.extent,t={accessInformation:this.accessInformation,categories:(0,a.o8)(this.categories),classification:(0,a.o8)(this.classification),created:this.created?.getTime(),description:this.description,extent:e&&[[e.xmin,e.ymin],[e.xmax,e.ymax]],id:this.id,isOrgItem:this.isOrgItem,licenseInfo:this.licenseInfo,modified:this.modified?.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:(0,a.o8)(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:(0,a.o8)(this.typeKeywords),url:this.url};return(0,a.oy)(t)}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");return new T({sourceJSON:e})}_getPostQuery(){const e=this.toJSON();for(const t in e)"tags"===t&&null!==e[t]&&(e[t]=e[t].join(", ")),"typeKeywords"===t&&null!==e[t]&&(e[t]=e[t].join(", ")),"extent"===t&&e[t]&&(e[t]=JSON.stringify(e[t]));return e}};(0,i._)([(0,u.MZ)({type:["private","shared","org","public"]})],E.prototype,"access",void 0),(0,i._)([(0,u.MZ)()],E.prototype,"accessInformation",void 0),(0,i._)([(0,u.MZ)({type:String})],E.prototype,"apiKey",void 0),(0,i._)([(0,u.MZ)({json:{read:{source:"appProxies"}}})],E.prototype,"applicationProxies",void 0),(0,i._)([(0,u.MZ)()],E.prototype,"avgRating",void 0),(0,i._)([(0,u.MZ)()],E.prototype,"categories",void 0),(0,i._)([(0,u.MZ)()],E.prototype,"classification",void 0),(0,i._)([(0,u.MZ)({type:Date})],E.prototype,"created",void 0),(0,i._)([(0,u.MZ)()],E.prototype,"culture",void 0),(0,i._)([(0,u.MZ)()],E.prototype,"description",void 0),(0,i._)([(0,u.MZ)({readOnly:!0})],E.prototype,"displayName",null),(0,i._)([(0,u.MZ)({type:p.default})],E.prototype,"extent",void 0),(0,i._)([(0,d.w)("extent")],E.prototype,"readExtent",null),(0,i._)([(0,u.MZ)()],E.prototype,"groupCategories",void 0),(0,i._)([(0,u.MZ)({readOnly:!0})],E.prototype,"iconUrl",null),(0,i._)([(0,u.MZ)()],E.prototype,"id",void 0),(0,i._)([(0,u.MZ)({readOnly:!0})],E.prototype,"isLayer",null),(0,i._)([(0,u.MZ)({type:Boolean,readOnly:!0})],E.prototype,"isOrgItem",void 0),(0,i._)([(0,u.MZ)()],E.prototype,"itemControl",void 0),(0,i._)([(0,u.MZ)({readOnly:!0})],E.prototype,"itemPageUrl",null),(0,i._)([(0,u.MZ)({readOnly:!0})],E.prototype,"itemUrl",null),(0,i._)([(0,u.MZ)()],E.prototype,"licenseInfo",void 0),(0,i._)([(0,u.MZ)({type:Date})],E.prototype,"modified",void 0),(0,i._)([(0,u.MZ)()],E.prototype,"name",void 0),(0,i._)([(0,u.MZ)()],E.prototype,"numComments",void 0),(0,i._)([(0,u.MZ)()],E.prototype,"numRatings",void 0),(0,i._)([(0,u.MZ)()],E.prototype,"numViews",void 0),(0,i._)([(0,u.MZ)()],E.prototype,"owner",void 0),(0,i._)([(0,u.MZ)()],E.prototype,"ownerFolder",void 0),(0,i._)([(0,u.MZ)({type:m.A})],E.prototype,"portal",void 0),(0,i._)([(0,u.MZ)()],E.prototype,"screenshots",void 0),(0,i._)([(0,u.MZ)()],E.prototype,"size",void 0),(0,i._)([(0,u.MZ)()],E.prototype,"snippet",void 0),(0,i._)([(0,u.MZ)()],E.prototype,"sourceJSON",void 0),(0,i._)([(0,u.MZ)({type:String})],E.prototype,"sourceUrl",void 0),(0,i._)([(0,u.MZ)({type:String})],E.prototype,"spatialReference",void 0),(0,i._)([(0,u.MZ)()],E.prototype,"tags",void 0),(0,i._)([(0,u.MZ)()],E.prototype,"thumbnail",void 0),(0,i._)([(0,u.MZ)({readOnly:!0})],E.prototype,"thumbnailUrl",null),(0,i._)([(0,u.MZ)()],E.prototype,"title",void 0),(0,i._)([(0,u.MZ)()],E.prototype,"type",void 0),(0,i._)([(0,u.MZ)()],E.prototype,"typeKeywords",void 0),(0,i._)([(0,u.MZ)({type:String,json:{read(e,t){if(A.has(t.type)){const t=this.portal?.restUrl;e||=t&&this.id?`${t}/content/items/${this.id}/data`:null}return e}}})],E.prototype,"url",void 0),(0,i._)([(0,u.MZ)({readOnly:!0})],E.prototype,"userItemUrl",null),E=T=(0,i._)([(0,f.$)("esri.portal.PortalItem")],E);const P=E},70181:function(e,t,r){r.d(t,{O3:function(){return h},PU:function(){return c},YW:function(){return f},ex:function(){return a},hv:function(){return d},zp:function(){return l}});var i=r(15774),n=r(13520),s=r(33400),o=r(41546);const a=2.4;function l(e){return(0,n.PN)(e*a)}function c(e){return(0,n.Lz)(e)/a}function u(e,t,r,n){let{color:o,ratio:a}=t,{color:l,ratio:c}=r;if(c===a){const e=1e-6;1===c?a-=e:c+=e}const u=(0,i.qE)((n-a)/(c-a),0,1);(0,s.l)(e,o.toArray(),l.toArray(),u)}function h(e){const t=new Uint8ClampedArray(2048);if((e=e.filter((({ratio:e})=>e>=0&&e<=1)).sort(((e,t)=>e.ratio-t.ratio)).map((({color:e,ratio:t})=>({color:e,ratio:Math.max(t,.001)})))).length<1)return t;let r=e[0],i=e[0],n=1;const s=(0,o.vt)();for(let o=0;o<512;o++){const a=(o+.5)/512;for(;a>i.ratio&&n<e.length;)r=i,i=e[n++];u(s,r,i,a),t.set(s,4*o)}return t}function d(e,t,r){const i=Math.sqrt(e**2+t**2)/r;return i>1?0:3/(Math.PI*r**2)*(1-i**2)**2}function f(e){return"function"==typeof e?e:e?t=>+t[e]:()=>1}},26765:function(e,t,r){r.d(t,{V:function(){return s},X:function(){return n}});var i=r(74697);function n(e){return{geometryType:(0,i.$B)(e[0]),geometries:e.map((e=>e.toJSON()))}}function s(e,t,r){const n=(0,i.xD)(t);return e.map((e=>{const t=n.fromJSON(e);return t.spatialReference=r,t}))}},12873:function(e,t,r){function i(e){const t={};for(const r in e){if("declaredClass"===r)continue;const n=e[r];if(null!=n&&"function"!=typeof n)if(Array.isArray(n)){t[r]=[];for(let e=0;e<n.length;e++)t[r][e]=i(n[e])}else"object"==typeof n?n.toJSON&&(t[r]=JSON.stringify(n)):t[r]=n}return t}r.d(t,{z:function(){return i}})},45608:function(e,t,r){r.d(t,{SH:function(){return E},ae:function(){return S},cn:function(){return y}});var i=r(39819),n=r(68225),s=r(76613),o=r(38519);const a=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML","esriFieldTypeBigInteger","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"],l=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],c=["upperLeft","lowerLeft"];function u(e){return e>=a.length?null:a[e]}function h(e){return e>=l.length?null:l[e]}function d(e){return e>=c.length?null:c[e]}function f(e,t){return t>=e.geometryTypes.length?null:e.geometryTypes[t]}function p(e,t,r){const i=e.asUnsafe(),n=t.createPointGeometry(r);for(;i.next();)switch(i.tag()){case 3:{const e=i.getUInt32(),r=i.pos()+e;let s=0;for(;i.pos()<r;)t.addCoordinatePoint(n,i.getSInt64(),s++);break}default:i.skip()}return n}function m(e,t,r){const i=e.asUnsafe(),n=t.createGeometry(r),s=2+(r.hasZ?1:0)+(r.hasM?1:0);for(;i.next();)switch(i.tag()){case 2:{const e=i.getUInt32(),r=i.pos()+e;let s=0;for(;i.pos()<r;)t.addLength(n,i.getUInt32(),s++);break}case 3:{const e=i.getUInt32(),r=i.pos()+e;let o=0;for(t.allocateCoordinates(n);i.pos()<r;)t.addCoordinate(n,i.getSInt64(),o),o++,o===s&&(o=0);break}default:i.skip()}return n}function _(e){const t=e.asUnsafe(),r=new s.A;let i="esriGeometryPoint";for(;t.next();)switch(t.tag()){case 2:{const e=t.getUInt32(),i=t.pos()+e;for(;t.pos()<i;)r.lengths.push(t.getUInt32());break}case 3:{const e=t.getUInt32(),i=t.pos()+e;for(;t.pos()<i;)r.coords.push(t.getSInt64());break}case 1:i=o.z[t.getEnum()];break;default:t.skip()}return{queryGeometry:r,queryGeometryType:i}}function g(e){const t=e.asUnsafe();for(;t.next();)switch(t.tag()){case 1:return t.getString();case 2:return t.getFloat();case 3:return t.getDouble();case 4:return t.getSInt32();case 5:return t.getUInt32();case 6:return t.getInt64();case 7:return t.getUInt64();case 8:return t.getSInt64();case 9:return t.getBool();default:return t.skip(),null}return null}function y(e){const t=e.asUnsafe(),r={type:u(0)};for(;t.next();)switch(t.tag()){case 1:r.name=t.getString();break;case 2:r.type=u(t.getEnum());break;case 3:r.alias=t.getString();break;case 4:r.sqlType=h(t.getEnum());break;case 5:default:t.skip();break;case 6:r.defaultValue=t.getString()}return r}function x(e){const t={},r=e.asUnsafe();for(;r.next();)switch(r.tag()){case 1:t.name=r.getString();break;case 2:t.isSystemMaintained=r.getBool();break;default:r.skip()}return t}function b(e,t,r,i){const n=t.createFeature(r);let s=0;for(;e.next();)switch(e.tag()){case 1:{const t=i[s++].name;n.attributes[t]=e.processMessage(g);break}case 2:n.geometry=e.processMessageWithArgs(m,t,r);break;case 4:n.centroid=e.processMessageWithArgs(p,t,r);break;default:e.skip()}return n}function w(e){const t=[1,1,1,1],r=e.asUnsafe();for(;r.next();)switch(r.tag()){case 1:t[0]=r.getDouble();break;case 2:t[1]=r.getDouble();break;case 4:t[2]=r.getDouble();break;case 3:t[3]=r.getDouble();break;default:r.skip()}return t}function v(e){const t=[0,0,0,0],r=e.asUnsafe();for(;r.next();)switch(r.tag()){case 1:t[0]=r.getDouble();break;case 2:t[1]=r.getDouble();break;case 4:t[2]=r.getDouble();break;case 3:t[3]=r.getDouble();break;default:r.skip()}return t}function S(e){const t={originPosition:d(0)},r=e.asUnsafe();for(;r.next();)switch(r.tag()){case 1:t.originPosition=d(r.getEnum());break;case 2:t.scale=r.processMessage(w);break;case 3:t.translate=r.processMessage(v);break;default:r.skip()}return t}function T(e){const t={},r=e.asUnsafe();for(;r.next();)switch(r.tag()){case 1:t.shapeAreaFieldName=r.getString();break;case 2:t.shapeLengthFieldName=r.getString();break;case 3:t.units=r.getString();break;default:r.skip()}return t}function I(e,t){const r=t.createSpatialReference();for(;e.next();)switch(e.tag()){case 1:r.wkid=e.getUInt32();break;case 5:r.wkt=e.getString();break;case 2:r.latestWkid=e.getUInt32();break;case 3:r.vcsWkid=e.getUInt32();break;case 4:r.latestVcsWkid=e.getUInt32();break;default:e.skip()}return r}function M(e,t){const r=t.createFeatureResult(),i=e.asUnsafe();r.geometryType=f(t,0);let n=!1;for(;i.next();)switch(i.tag()){case 1:r.objectIdFieldName=i.getString();break;case 3:r.globalIdFieldName=i.getString();break;case 4:r.geohashFieldName=i.getString();break;case 5:r.geometryProperties=i.processMessage(T);break;case 7:r.geometryType=f(t,i.getEnum());break;case 8:r.spatialReference=i.processMessageWithArgs(I,t);break;case 10:r.hasZ=i.getBool();break;case 11:r.hasM=i.getBool();break;case 12:r.transform=i.processMessage(S);break;case 9:r.exceededTransferLimit=i.getBool();break;case 13:t.addField(r,i.processMessage(y));break;case 15:n||(t.prepareFeatures(r),n=!0),t.addFeature(r,i.processMessageWithArgs(b,t,r,r.fields));break;case 2:r.uniqueIdField=i.processMessage(x);break;default:i.skip()}return t.finishFeatureResult(r),r}function A(e,t){const r={};let i=null;for(;e.next();)switch(e.tag()){case 4:i=e.processMessageWithArgs(_);break;case 1:r.featureResult=e.processMessageWithArgs(M,t);break;default:e.skip()}return null!=i&&r.featureResult&&t.addQueryGeometry(r,i),r}function E(e,t){try{const r=2,i=new n.A(new Uint8Array(e),new DataView(e)),s={};for(;i.next();)i.tag()===r?s.queryResult=i.processMessageWithArgs(A,t):i.skip();return s}catch(e){throw new i.A("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:e})}}},38519:function(e,t,r){r.d(t,{S:function(){return c},z:function(){return l}});var i=r(62938),n=r(57652),s=r(65215),o=r(72887),a=r(76613);const l=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"];class c{constructor(e){this._options=e,this.geometryTypes=l,this._coordinatePtr=0,this._vertexDimension=0}createFeatureResult(){return new o.A}prepareFeatures(e){this._vertexDimension=2,e.hasZ&&this._vertexDimension++,e.hasM&&this._vertexDimension++}finishFeatureResult(e){if(!e?.features||!e.hasZ||!this._options.sourceSpatialReference||!e.spatialReference||(0,n.aI)(e.spatialReference,this._options.sourceSpatialReference)||e.spatialReference.vcsWkid)return;const t=(0,i.G9)(this._options.sourceSpatialReference)/(0,i.G9)(e.spatialReference);if(1!==t)for(const r of e.features){if(!(0,s.N3)(r))continue;const e=r.geometry.coords;for(let r=2;r<e.length;r+=3)e[r]*=t}}addFeature(e,t){e.features.push(t)}createFeature(){return new s.Om}createSpatialReference(){return{wkid:0}}createGeometry(){return new a.A}addField(e,t){e.fields.push(t)}allocateCoordinates(e){e.coords.length=e.lengths.reduce(((e,t)=>e+t),0)*this._vertexDimension,this._coordinatePtr=0}addCoordinate(e,t){e.coords[this._coordinatePtr++]=t}addCoordinatePoint(e,t){e.coords.push(t)}addLength(e,t){e.lengths.push(t)}addQueryGeometry(e,t){e.queryGeometry=t.queryGeometry,e.queryGeometryType=t.queryGeometryType}createPointGeometry(){return new a.A}}},55723:function(e,t,r){r.d(t,{m:function(){return n}});var i=r(45608);function n(e,t){const r=(0,i.SH)(e,t),n=r.queryResult.featureResult,s=r.queryResult.queryGeometry,o=r.queryResult.queryGeometryType;if(n&&n.features&&n.features.length&&n.objectIdFieldName){const e=n.objectIdFieldName;for(const t of n.features)t.attributes&&(t.objectId=t.attributes[e])}return n&&(n.queryGeometry=s,n.queryGeometryType=o),n}},90066:function(e,t,r){r.d(t,{IJ:function(){return p},Jf:function(){return y},Pk:function(){return _},eW:function(){return f},gW:function(){return g},kS:function(){return m}});var i=r(93040),n=r(90683),s=r(74697),o=r(65298),a=r(57652),l=r(12873),c=r(55723),u=r(45406);const h="Layer does not support extent calculation.";function d(e,t){const r=e.geometry,i=e.toJSON();delete i.compactGeometryEnabled,delete i.defaultSpatialReferenceEnabled;const n=i;let o,l,c;if(null!=r&&(l=r.spatialReference,c=(0,a.YX)(l),n.geometryType=(0,s.$B)(r),n.geometry=function(e,t){if(t&&"extent"===e.type)return`${e.xmin},${e.ymin},${e.xmax},${e.ymax}`;if(t&&"point"===e.type)return`${e.x},${e.y}`;const r=e.toJSON();return delete r.spatialReference,JSON.stringify(r)}(r,e.compactGeometryEnabled),n.inSR=c),i.groupByFieldsForStatistics&&(n.groupByFieldsForStatistics=i.groupByFieldsForStatistics.join(",")),i.objectIds&&(n.objectIds=i.objectIds.join(",")),i.orderByFields&&(n.orderByFields=i.orderByFields.join(",")),!i.outFields||!i.returnDistinctValues&&(t?.returnCountOnly||t?.returnExtentOnly||t?.returnIdsOnly)?delete n.outFields:i.outFields.includes("*")?n.outFields="*":n.outFields=i.outFields.join(","),i.outSR?(n.outSR=(0,a.YX)(i.outSR),o=e.outSpatialReference):r&&(i.returnGeometry||i.returnCentroid)&&(n.outSR=n.inSR,o=l),i.returnGeometry&&delete i.returnGeometry,i.outStatistics&&(n.outStatistics=JSON.stringify(i.outStatistics)),i.fullText&&(n.fullText=JSON.stringify(i.fullText)),i.pixelSize&&(n.pixelSize=JSON.stringify(i.pixelSize)),i.quantizationParameters&&(e.defaultSpatialReferenceEnabled&&null!=l&&null!=e.quantizationParameters?.extent&&l.equals(e.quantizationParameters.extent.spatialReference)&&delete i.quantizationParameters.extent.spatialReference,n.quantizationParameters=JSON.stringify(i.quantizationParameters)),i.parameterValues&&(n.parameterValues=JSON.stringify(i.parameterValues)),i.rangeValues&&(n.rangeValues=JSON.stringify(i.rangeValues)),i.dynamicDataSource&&(n.layer=JSON.stringify({source:i.dynamicDataSource}),delete i.dynamicDataSource),i.timeExtent){const e=i.timeExtent,{start:t,end:r}=e;null==t&&null==r||(n.time=t===r?t:`${t??"null"},${r??"null"}`),delete i.timeExtent}return e.defaultSpatialReferenceEnabled&&null!=l&&null!=o&&l.equals(o)&&(n.defaultSR=n.inSR,delete n.inSR,delete n.outSR),n}async function f(e,t,r,i){const n=null!=t.timeExtent&&t.timeExtent.isEmpty?{data:{features:[]}}:await x(e,t,"json",i);return(0,u.q)(t,r,n.data),n}async function p(e,t,r,i){if(null!=t.timeExtent&&t.timeExtent.isEmpty)return{data:r.createFeatureResult()};const n=await m(e,t,i),s=n;return s.data=(0,c.m)(n.data,r),s}function m(e,t,r){return x(e,t,"pbf",r)}function _(e,t,r){return null!=t.timeExtent&&t.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):x(e,t,"json",r,{returnIdsOnly:!0})}function g(e,t,r){return null!=t.timeExtent&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):x(e,t,"json",r,{returnIdsOnly:!0,returnCountOnly:!0})}async function y(e,t,r){if(null!=t.timeExtent&&t.timeExtent.isEmpty)return{data:{count:0,extent:null}};const i=await x(e,t,"json",r,{returnExtentOnly:!0,returnCountOnly:!0}),n=i.data;if(n.hasOwnProperty("extent"))return i;if(n.features)throw new Error(h);if(n.hasOwnProperty("count"))throw new Error(h);return i}async function x(e,t,r,s={},a={}){const c="string"==typeof e?(0,n.An)(e):e,u=t.geometry?[t.geometry]:[],h=await(0,o.el)(u,null,{signal:s.signal}),f=h?.[0];null!=f&&((t=t.clone()).geometry=f);const p=(0,l.z)({...c.query,f:r,...a,...d(t,a)});return(0,i.A)((0,n.fj)(c.path,(m=a,null==t.formatOf3DObjects||m.returnCountOnly||m.returnExtentOnly||m.returnIdsOnly?"query":"query3d")),{...s,responseType:"pbf"===r?"array-buffer":"json",query:{...p,...s.query}});var m}},45406:function(e,t,r){r.d(t,{q:function(){return n}});var i=r(6996);function n(e,t,r){if(!r?.features||!r.hasZ)return;const n=(0,i.N)(r.geometryType,t,e.outSpatialReference);if(null!=n)for(const e of r.features)n(e.geometry)}},74373:function(e,t,r){r.d(t,{A:function(){return d}});var i=r(53804),n=r(73037),s=r(30905),o=r(23502),a=(r(58941),r(40633),r(13798),r(74376)),l=r(65953);const c=new n.J({esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation",esriClassifyDefinedInterval:"defined-interval"}),u=new n.J({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:"percent-of-total",esriNormalizeByField:"field"});let h=class extends s.oY{constructor(e){super(e),this.type="class-breaks-definition",this.breakCount=null,this.classificationField=null,this.classificationMethod=null,this.normalizationField=null,this.normalizationType=null}set standardDeviationInterval(e){"standard-deviation"===this.classificationMethod&&this._set("standardDeviationInterval",e)}set definedInterval(e){"defined-interval"===this.classificationMethod&&this._set("definedInterval",e)}};(0,i._)([(0,a.e)({classBreaksDef:"class-breaks-definition"})],h.prototype,"type",void 0),(0,i._)([(0,o.MZ)({json:{write:!0}})],h.prototype,"breakCount",void 0),(0,i._)([(0,o.MZ)({json:{write:!0}})],h.prototype,"classificationField",void 0),(0,i._)([(0,o.MZ)({type:String,json:{read:c.read,write:c.write}})],h.prototype,"classificationMethod",void 0),(0,i._)([(0,o.MZ)({json:{write:!0}})],h.prototype,"normalizationField",void 0),(0,i._)([(0,o.MZ)({json:{read:u.read,write:u.write}})],h.prototype,"normalizationType",void 0),(0,i._)([(0,o.MZ)({value:null,json:{write:!0}})],h.prototype,"standardDeviationInterval",null),(0,i._)([(0,o.MZ)({value:null,json:{write:!0}})],h.prototype,"definedInterval",null),h=(0,i._)([(0,l.$)("esri.rest.support.ClassBreaksDefinition")],h);const d=h},49241:function(e,t,r){r.d(t,{t:function(){return o}});var i=r(40633);const n=()=>i.A.getLogger("esri.rest.support.generateRendererUtils");function s(e,t){return Number(e.toFixed(t))}function o(e){const{normalizationTotal:t}=e;return{classBreaks:a(e),normalizationTotal:t}}function a(e){const t=e.definition,{classificationMethod:r,normalizationType:i,definedInterval:n}=t,o=t.breakCount??1,a=[];let u=e.values;if(0===u.length)return[];u=u.sort(((e,t)=>e-t));const h=u[0],d=u[u.length-1];if("equal-interval"===r)if(u.length>=o){const e=(d-h)/o;let t=h;for(let r=1;r<o;r++){const n=s(h+r*e,6);a.push({minValue:t,maxValue:n,label:l(t,n,i)}),t=n}a.push({minValue:t,maxValue:d,label:l(t,d,i)})}else u.forEach((e=>{a.push({minValue:e,maxValue:e,label:l(e,e,i)})}));else if("natural-breaks"===r){const t=function(e){const t=[],r=[];let i=Number.MIN_VALUE,n=1,s=-1;for(let o=0;o<e.length;o++){const a=e[o];a===i?(n++,r[s]=n):null!==a&&(t.push(a),i=a,n=1,r.push(n),s++)}return{uniqueValues:t,valueFrequency:r}}(u),r=e.valueFrequency||t.valueFrequency,n=c(t.uniqueValues,r,o);let f=h;for(let e=1;e<o;e++)if(t.uniqueValues.length>e){const r=s(t.uniqueValues[n[e]],6);a.push({minValue:f,maxValue:r,label:l(f,r,i)}),f=r}a.push({minValue:f,maxValue:d,label:l(f,d,i)})}else if("quantile"===r)if(u.length>=o&&h!==d){let e=h,t=Math.ceil(u.length/o),r=0;for(let n=1;n<o;n++){let s=t+r-1;s>u.length&&(s=u.length-1),s<0&&(s=0),a.push({minValue:e,maxValue:u[s],label:l(e,u[s],i)}),e=u[s],r+=t,t=Math.ceil((u.length-r)/(o-n))}a.push({minValue:e,maxValue:d,label:l(e,d,i)})}else{let e=-1;for(let t=0;t<u.length;t++){const r=u[t];r!==e&&(e=r,a.push({minValue:e,maxValue:r,label:l(e,r,i)}),e=r)}}else if("standard-deviation"===r){const e=function(e){let t=0;for(let r=0;r<e.length;r++)t+=e[r];return t/=e.length,t}(u),t=function(e,t){let r=0;for(let i=0;i<e.length;i++){const n=e[i];r+=(n-t)*(n-t)}return r/=e.length,Math.sqrt(r)}(u,e);if(0===t)a.push({minValue:u[0],maxValue:u[0],label:l(u[0],u[0],i)});else{const r=function(e,t,r,i,n){let s=Math.max(i-e,t-i)/n/r;return s=s>=1?1:s>=.5?.5:.25,s}(h,d,o,e,t)*t;let n=0,c=h;for(let t=o;t>=1;t--){const o=s(e-(t-.5)*r,6);a.push({minValue:c,maxValue:o,label:l(c,o,i)}),c=o,n++}let u=s(e+.5*r,6);a.push({minValue:c,maxValue:u,label:l(c,u,i)}),c=u,n++;for(let t=1;t<=o;t++)u=n===2*o?d:s(e+(t+.5)*r,6),a.push({minValue:c,maxValue:u,label:l(c,u,i)}),c=u,n++}}else if("defined-interval"===r){if(!n)return a;const e=u[0],t=u[u.length-1],r=Math.ceil((t-e)/n);let o=e;for(let t=1;t<r;t++){const r=s(e+t*n,6);a.push({minValue:o,maxValue:r,label:l(o,r,i)}),o=r}a.push({minValue:o,maxValue:t,label:l(o,t,i)})}return a}function l(e,t,r){let i=null;return i=e===t?r&&"percent-of-total"===r?e+"%":e.toString():r&&"percent-of-total"===r?e+"% - "+t+"%":e+" - "+t,i}function c(e,t,r){const i=e.length,n=[];r>i&&(r=i);for(let e=0;e<r;e++)n.push(Math.round(e*i/r-1));n.push(i-1);let s=u(n,e,t,r);return function(e,t,r,i,n,s){let o=0,a=0,l=0,c=0,u=!0;for(let d=0;d<2&&u;d++){0===d&&(u=!1);for(let d=0;d<s-1;d++)for(;r[d+1]+1!==r[d+2];){r[d+1]=r[d+1]+1;const s=h(d,r,i,n);l=s.sbMean,o=s.sbSdcm;const f=h(d+1,r,i,n);if(c=f.sbMean,a=f.sbSdcm,!(o+a<t[d]+t[d+1])){r[d+1]=r[d+1]-1;break}t[d]=o,t[d+1]=a,e[d]=l,e[d+1]=c,u=!0}for(let d=s-1;d>0;d--)for(;r[d]!==r[d-1]+1;){r[d]=r[d]-1;const s=h(d-1,r,i,n);l=s.sbMean,o=s.sbSdcm;const f=h(d,r,i,n);if(c=f.sbMean,a=f.sbSdcm,!(o+a<t[d-1]+t[d])){r[d]=r[d]+1;break}t[d-1]=o,t[d]=a,e[d-1]=l,e[d]=c,u=!0}}return u}(s.mean,s.sdcm,n,e,t,r)&&(s=u(n,e,t,r)),n}function u(e,t,r,i){let n=[],s=[],o=[],a=0;const l=[],c=[];for(let n=0;n<i;n++){const i=h(n,e,t,r);l.push(i.sbMean),c.push(i.sbSdcm),a+=c[n]}let u,d=a,f=!0;for(;f||a<d;){f=!1,n=[];for(let t=0;t<i;t++)n.push(e[t]);for(let r=0;r<i;r++)for(let n=e[r]+1;n<=e[r+1];n++)if(u=t[n],r>0&&n!==e[r+1]&&Math.abs(u-l[r])>Math.abs(u-l[r-1]))e[r]=n;else if(r<i-1&&e[r]!==n-1&&Math.abs(u-l[r])>Math.abs(u-l[r+1])){e[r+1]=n-1;break}d=a,a=0,s=[],o=[];for(let n=0;n<i;n++){s.push(l[n]),o.push(c[n]);const i=h(n,e,t,r);l[n]=i.sbMean,c[n]=i.sbSdcm,a+=c[n]}}if(a>d){for(let t=0;t<i;t++)e[t]=n[t],l[t]=s[t],c[t]=o[t];a=d}return{mean:l,sdcm:c}}function h(e,t,r,i){let s=0,o=0;for(let n=t[e]+1;n<=t[e+1];n++){const e=i[n];s+=r[n]*e,o+=e}o<=0&&n().warn("Exception in Natural Breaks calculation");const a=s/o;let l=0;for(let n=t[e]+1;n<=t[e+1];n++)l+=i[n]*(r[n]-a)**2;return{sbMean:a,sbSdcm:l}}},39397:function(e,t,r){r.d(t,{Dl:function(){return o},jV:function(){return s},lF:function(){return a}}),r(25591),r(7156);var i=r(21609),n=r(90683);function s(e,t){return t?{...t,query:{...e??{},...t.query}}:{query:e}}function o(e){return"string"==typeof e?(0,n.An)(e):(0,i.o8)(e)}function a(e,t,r){const i={};for(const n in e){if("declaredClass"===n)continue;const s=e[n];if(null!=s&&"function"!=typeof s)if(Array.isArray(s))i[n]=s.map((e=>a(e)));else if("object"==typeof s)if(s.toJSON){const e=s.toJSON(r?.[n]);i[n]=t?e:JSON.stringify(e)}else i[n]=t?s:JSON.stringify(s);else i[n]=s}return i}r(48893)},92586:function(e,t,r){r.d(t,{$r:function(){return _},Jc:function(){return x},gV:function(){return g},rb:function(){return y}}),r(50917),r(39819);var i=r(13520),n=r(45139),s=r(57165),o=r(87280),a=r(57652),l=r(53743),c=r(70181),u=r(33118),h=r(66164),d=r(54547),f=r(45532);let p=null;const m=/^(?<hh>([0-1][0-9])|([2][0-3])):(?<mm>[0-5][0-9])(:(?<ss>[0-5][0-9]))?([.](?<ms>\d+))?$/;function _(e,t,r,i){const n=(0,a.d9)(r)?(0,a.Vp)(r):null,s=n?Math.round((n.valid[1]-n.valid[0])/t.scale[0]):null;return e.map((e=>{const r=new f.default(e.geometry);return(0,o.Gy)(t,r,r),e.geometry=n?function(e,t,r){return e.x<0?e.x+=t:e.x>r&&(e.x-=t),e}(r,s??0,i[0]):r,e}))}function g(e,t=18,r,n,s){const o=new Float64Array(n*s);t=Math.round((0,i.Lz)(t));let a=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY;const u=(0,c.YW)(r);for(const{geometry:r,attributes:i}of e){const{x:e,y:h}=r,d=Math.max(0,e-t),f=Math.max(0,h-t),p=Math.min(s,h+t),m=Math.min(n,e+t),_=+u(i);for(let r=f;r<p;r++)for(let i=d;i<m;i++){const s=r*n+i,u=(0,c.hv)(i-e,r-h,t)*_,d=o[s]+=u;a=Math.min(a,d),l=Math.max(l,d)}}return{min:a,max:l}}function y(e){const t=m.exec(e);if(!t)return null;const{hh:r,mm:i,ss:s,ms:o}=t.groups;return Number(r)*n.vf.hours+Number(i)*n.vf.minutes+Number(s)*n.vf.seconds+Number(o||0)}async function x(e,t,r=!0){if(!t)return[];const{field:i,field2:n,field3:o,fieldDelimiter:a,fieldInfos:c,timeZone:f}=e,m=i&&c?.find((e=>e.name.toLowerCase()===i.toLowerCase())),_=!!m&&(0,l.OH)(m),g=!!m&&(0,u.fs)(m),x=e.valueExpression,b=e.normalizationType,w=e.normalizationField,v=e.normalizationTotal,S=[],T=e.viewInfoParams;let I=null,M=null;if(x){if(!p){const{arcadeUtils:e}=await(0,d.lw)();p=e}p.hasGeometryOperations(x)&&await p.enableGeometryOperations(),I=p.createFunction(x),M=T?p.getViewInfo({viewingMode:T.viewingMode,scale:T.scale,spatialReference:new s.A(T.spatialReference)}):null}const A=e.fieldInfos,E=t[0]&&"declaredClass"in t[0]&&"esri.Graphic"===t[0].declaredClass||!A?null:{fields:A};return t.forEach((e=>{const t=e.attributes;let s;if(x){const t=E?{...e,layer:E}:e,r=p.createExecContext(t,M,f);s=p.executeFunction(I,r)}else t&&(s=t[i],n?(s=`${(0,h.gJ)(s)}${a}${(0,h.gJ)(t[n])}`,o&&(s=`${s}${a}${(0,h.gJ)(t[o])}`)):"string"==typeof s&&r&&(g?s=s?new Date(s).getTime():null:_&&(s=s?y(s):null)));if(b&&"number"==typeof s&&isFinite(s)){const e=t&&parseFloat(t[w]);s=(0,h.zS)(s,b,e,v)}S.push(s)})),S}},33118:function(e,t,r){r.d(t,{fs:function(){return o},i0:function(){return a}});var i=r(8289),n=r(53743),s=(r(54547),r(51107),r(21168));function o(e){return(0,n.vE)(e)||(0,n.zD)(e)||(0,n.Ah)(e)}function a(e,t){const{format:r,timeZoneOptions:n,fieldType:o}=t??{};let a,l;if(n&&({timeZone:a,timeZoneName:l}=(0,s.hv)(n.layerTimeZone,n.datesInUnknownTimezone,n.viewTimeZone,(0,i.J2)(r||"short-date-short-time"),o)),"string"==typeof e&&isNaN(Date.parse("time-only"===o?`1970-01-01T${e}Z`:e)))return e;switch(o){case"date-only":{const t=(0,i.J2)(r||"short-date");return"string"==typeof e?(0,i.iS)(e,{...t}):(0,i.Yq)(e,{...t,timeZone:s.n$})}case"time-only":{const t=(0,i.J2)(r||"short-time");return"string"==typeof e?(0,i.F8)(e,t):(0,i.Yq)(e,{...t,timeZone:s.n$})}case"timestamp-offset":{if(!a&&"string"==typeof e&&new Date(e).toISOString()!==e)return e;const t=r||n?(0,i.J2)(r||"short-date-short-time"):void 0,s=t?{...t,timeZone:a,timeZoneName:l}:void 0;return"string"==typeof e?(0,i.Ey)(e,s):(0,i.Yq)(e,s)}default:{const t=r||n?(0,i.J2)(r||"short-date-short-time"):void 0;return(0,i.Yq)("string"==typeof e?new Date(e):e,t?{...t,timeZone:a,timeZoneName:l}:void 0)}}}new Set(["integer","small-integer"])},66164:function(e,t,r){r.d(t,{$y:function(){return G},FM:function(){return x},G_:function(){return g},Rw:function(){return D},Vb:function(){return m},b3:function(){return L},gJ:function(){return p},jM:function(){return U},lv:function(){return N},oZ:function(){return F},qg:function(){return y},z9:function(){return _},zS:function(){return O}});var i=r(74373),n=r(49241);const s="<Null>",o="equal-interval",a=1,l=5,c=10,u=/\s*(\+|-)?((\d+(\.\d+)?)|(\.\d+))\s*/gi,h=new Set(["esriFieldTypeDate","esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong","esriFieldTypeOID","esriFieldTypeBigInteger"]),d=new Set(["esriFieldTypeTimeOnly","esriFieldTypeDateOnly"]),f=["min","max","avg","stddev","count","sum","variance","nullcount","median"];function p(e){return null==e||"string"==typeof e&&!e?s:e}function m(e){const t=null!=e.normalizationField||null!=e.normalizationType,r=null!=e.minValue||null!=e.maxValue,i=!!e.sqlExpression&&e.supportsSQLExpression;return!t&&!r&&!i}function _(e){const{outStatisticTypes:t}=e,r=e.returnDistinct?[...new Set(e.values)]:e.values,i=r.filter((e=>null!=e)).sort(),n=i.length,s={count:n,min:i[0],max:i[n-1]};return e.supportsNullCount&&(s.nullcount=r.length-n),!e.percentileParams||t?.include?.length&&!t.include.includes("median")||t?.exclude?.length&&t.exclude.includes("median")||(s.median=y(r,e.percentileParams)),s}function g(e){const{values:t,useSampleStdDev:r,supportsNullCount:i,outStatisticTypes:n}=e;let s=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,a=null,l=null,c=null,u=null,h=0;const d=null==e.minValue?-1/0:e.minValue,f=null==e.maxValue?1/0:e.maxValue;for(const e of t)Number.isFinite(e)?e>=d&&e<=f&&(a=null===a?e:a+e,s=Math.min(s,e),o=Math.max(o,e),h++):"string"==typeof e&&h++;if(h&&null!=a){l=a/h;let e=0;for(const r of t)Number.isFinite(r)&&r>=d&&r<=f&&(e+=(r-l)**2);u=r?h>1?e/(h-1):0:h>0?e/h:0,c=Math.sqrt(u)}else s=null,o=null;const p={avg:l,count:h,max:o,min:s,stddev:c,sum:a,variance:u};return i&&(p.nullcount=t.length-h),!e.percentileParams||n?.include?.length&&!n.include.includes("median")||n?.exclude?.length&&n.exclude.includes("median")||(p.median=y(t,e.percentileParams)),p}function y(e,t){const{fieldType:r,value:i,orderBy:n,isDiscrete:s}=t,o=x(r,"desc"===n);if(0===(e=[...e].filter((e=>null!=e)).sort(((e,t)=>o(e,t)))).length)return null;if(i<=0)return e[0];if(i>=1)return e[e.length-1];const a=(e.length-1)*i,l=Math.floor(a),c=l+1,u=a%1,h=e[l],d=e[c];return c>=e.length||s||"string"==typeof h||"string"==typeof d?h:h*(1-u)+d*u}function x(e,t){if(e){if(h.has(e))return C(t);if(d.has(e))return A(t,!1);if("esriFieldTypeTimestampOffset"===e)return function(e){return e?T:S}(t);const r=A(t,!0);if("esriFieldTypeString"===e)return r;if("esriFieldTypeGUID"===e||"esriFieldTypeGlobalID"===e)return(e,t)=>r(R(e),R(t))}const r=t?1:-1,i=C(t),n=A(t,!0),s=v(t);return(e,t)=>"number"==typeof e&&"number"==typeof t?i(e,t):"string"==typeof e&&"string"==typeof t?n(e,t):s(e,t)??r}const b=(e,t)=>null==e?null==t?0:1:null==t?-1:null,w=(e,t)=>null==e?null==t?0:-1:null==t?1:null;function v(e){return e?b:w}const S=(e,t)=>w(e,t)??(e===t?0:new Date(e).getTime()-new Date(t).getTime()),T=(e,t)=>b(e,t)??(e===t?0:new Date(t).getTime()-new Date(e).getTime()),I=(e,t)=>w(e,t)??(e===t?0:e<t?-1:1),M=(e,t)=>b(e,t)??(e===t?0:e<t?1:-1);function A(e,t){if(!t)return e?M:I;const r=v(e);return e?(e,t)=>{const i=r(e,t);return null!=i?i:(e=e.toUpperCase())>(t=t.toUpperCase())?-1:e<t?1:0}:(e,t)=>{const i=r(e,t);return null!=i?i:(e=e.toUpperCase())<(t=t.toUpperCase())?-1:e>t?1:0}}const E=(e,t)=>b(e,t)??t-e,P=(e,t)=>w(e,t)??e-t;function C(e){return e?E:P}function R(e){return e.slice(24,36)+e.slice(19,23)+e.slice(16,18)+e.slice(14,16)+e.slice(11,13)+e.slice(9,11)+e.slice(6,8)+e.slice(4,6)+e.slice(2,4)+e.slice(0,2)}function F(e,t,r){let i;for(i in e)t?.include?.length&&!t.include.includes(i)||t?.exclude?.length&&t.exclude.includes(i)?delete e[i]:f.includes(i)&&(Number.isFinite(e[i])||(e[i]=null));return r?(["avg","stddev","variance"].forEach((t=>{null!=e[t]&&(e[t]=Math.ceil(e[t]??0))})),e):e}function L(e){const t={};for(let r of e)(null==r||"string"==typeof r&&""===r.trim())&&(r=null),null==t[r]?t[r]={count:1,data:r}:t[r].count++;return{count:t}}function k(e){return"coded-value"!==e?.type?[]:e.codedValues.map((e=>e.code))}function N(e,t,r,i){const n=e.count,s=[];if(r&&t){const e=[],r=k(t[0]);for(const n of r)if(t[1]){const r=k(t[1]);for(const s of r)if(t[2]){const r=k(t[2]);for(const t of r)e.push(`${p(n)}${i}${p(s)}${i}${p(t)}`)}else e.push(`${p(n)}${i}${p(s)}`)}else e.push(n);for(const t of e)n.hasOwnProperty(t)||(n[t]={data:t,count:0})}for(const e in n){const t=n[e];s.push({value:t.data,count:t.count,label:t.label})}return{uniqueValueInfos:s}}function O(e,t,r,i){let n=null;switch(t){case"log":0!==e&&(n=Math.log(e)*Math.LOG10E);break;case"percent-of-total":Number.isFinite(i)&&0!==i&&(n=e/i*100);break;case"field":Number.isFinite(r)&&0!==r&&(n=e/r);break;case"natural-log":e>0&&(n=Math.log(e));break;case"square-root":e>0&&(n=e**.5)}return n}function D(e,t){const r=z({field:t.field,normalizationType:t.normalizationType,normalizationField:t.normalizationField,classificationMethod:t.classificationMethod,standardDeviationInterval:t.standardDeviationInterval,breakCount:t.numClasses||l});return e=function(e,t,r){const i=t??-1/0,n=r??1/0;return e.filter((e=>Number.isFinite(e)&&e>=i&&e<=n))}(e,t.minValue,t.maxValue),(0,n.t)({definition:r,values:e,normalizationTotal:t.normalizationTotal})}function z(e){const{breakCount:t,field:r,normalizationField:n,normalizationType:s}=e,l=e.classificationMethod||o,c="standard-deviation"===l?e.standardDeviationInterval||a:void 0,u="defined-interval"===l?e.definedInterval:void 0;return new i.A({breakCount:t,classificationField:r,classificationMethod:l,normalizationField:"field"===s?n:void 0,normalizationType:s,standardDeviationInterval:c,definedInterval:u})}function U(e,t){let r=e.classBreaks;const i=r.length,n=r[0]?.minValue,s=r[i-1]?.maxValue,o="standard-deviation"===t,a=u;return r=r.map((e=>{const t=e.label,r={minValue:e.minValue,maxValue:e.maxValue,label:t};if(o&&t){const e=t.match(a),i=e?.map((e=>+e.trim()))??[];2===i.length?(r.minStdDev=i[0],r.maxStdDev=i[1],i[0]<0&&i[1]>0&&(r.hasAvg=!0)):1===i.length&&(t.includes("<")?(r.minStdDev=null,r.maxStdDev=i[0]):t.includes(">")&&(r.minStdDev=i[0],r.maxStdDev=null))}return r})),{minValue:n,maxValue:s,classBreakInfos:r,normalizationTotal:e.normalizationTotal}}function G(e,t){const r=B(e,t);if(null==r.min&&null==r.max)return{bins:[],minValue:r.min,maxValue:r.max,normalizationTotal:t.normalizationTotal};const i=r.intervals,n=r.min??0,s=r.max??0,o=i.map(((e,t)=>({minValue:i[t][0],maxValue:i[t][1],count:0})));for(const t of e)if(null!=t&&t>=n&&t<=s){const e=V(i,t);e>-1&&o[e].count++}return{bins:o,minValue:n,maxValue:s,normalizationTotal:t.normalizationTotal}}function B(e,t){const{field:r,classificationMethod:i,standardDeviationInterval:n,normalizationType:s,normalizationField:o,normalizationTotal:a,minValue:l,maxValue:u}=t,h=t.numBins||c;let d=null,f=null,p=null;if(i&&"equal-interval"!==i||s){const{classBreaks:t}=D(e,{field:r,normalizationType:s,normalizationField:o,normalizationTotal:a,classificationMethod:i,standardDeviationInterval:n,minValue:l,maxValue:u,numClasses:h});d=t[0].minValue,f=t[t.length-1].maxValue,p=t.map((e=>[e.minValue,e.maxValue]))}else{if(null!=l&&null!=u)d=l,f=u;else{const t=g({values:e,minValue:l,maxValue:u,useSampleStdDev:!s,supportsNullCount:m({normalizationType:s,normalizationField:o,minValue:l,maxValue:u})});d=t.min??null,f=t.max??null}p=function(e,t,r){const i=(t-e)/r,n=[];let s,o=e;for(let e=1;e<=r;e++)s=o+i,s=Number(s.toFixed(16)),n.push([o,e===r?t:s]),o=s;return n}(d??0,f??0,h)}return{min:d,max:f,intervals:p}}function V(e,t){let r=-1;for(let i=e.length-1;i>=0;i--)if(t>=e[i][0]){r=i;break}return r}},11876:function(e,t,r){r.d(t,{H:function(){return o},q:function(){return s}});var i=r(53216),n=r(38225);async function s(e){if(!e)return;const t=e.includes("-vector")?e.slice(0,e.indexOf("-vector")):e.includes("-3d")?e.slice(0,e.indexOf("-3d")):e,r=await(0,n.ud)("esri/t9n/basemaps");return r[e]||r[t]}const o={satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return(0,i.s)("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return(0,i.s)("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return(0,i.s)("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return(0,i.s)("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return(0,i.s)("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return(0,i.s)("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get"dark-gray"(){return{...this["dark-gray-vector"],id:"dark-gray"}},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return(0,i.s)("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get gray(){return{...this["gray-vector"],id:"gray"}},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return(0,i.s)("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},get streets(){return{...this["streets-vector"],id:"streets"}},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return(0,i.s)("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},get topo(){return{...this["topo-vector"],id:"topo"}},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return(0,i.s)("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return(0,i.s)("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return(0,i.s)("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"topo-3d":{id:"topo-3d",is3d:!0,get thumbnailUrl(){return(0,i.s)("esri/images/basemap/topo-3d.png")},baseMapLayers:[{id:"topo-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/1e7d1784d1ef4b79ba6764d0bd6c3150/resources/styles/root.json",layerType:"VectorTileLayer",title:"Topographic",visibility:!0,opacity:1},{id:"topo-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-3d":{id:"navigation-3d",is3d:!0,get thumbnailUrl(){return(0,i.s)("esri/images/basemap/navigation-3d.jpg")},baseMapLayers:[{id:"navigation-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/ccc904ff872b4144b94934e55e32784b/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation",visibility:!0,opacity:1},{id:"navigation-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"streets-3d":{id:"streets-3d",is3d:!0,get thumbnailUrl(){return(0,i.s)("esri/images/basemap/streets-3d.png")},baseMapLayers:[{id:"streets-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/198298c4c64c4cb19de5b46aa00c198d/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"streets-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"streets-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"osm-3d":{id:"osm-3d",is3d:!0,get thumbnailUrl(){return(0,i.s)("esri/images/basemap/osm-3d.png")},baseMapLayers:[{id:"osm-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/8628d259c9d14bdc848771c23c513940/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap",visibility:!0,opacity:1},{id:"osm-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"gray-3d":{id:"gray-3d",is3d:!0,get thumbnailUrl(){return(0,i.s)("esri/images/basemap/gray-3d.png")},baseMapLayers:[{id:"gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/01a14b466345455ba4176d2e6390db92/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-dark-3d":{id:"navigation-dark-3d",itemId:"5a1365328b4943f09a54cf5fd1205707",is3d:!0,baseMapLayers:[{id:"navigation-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/451a1777ab3f4bf095fae24a117439d9/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation Dark"},{id:"navigation-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"streets-dark-3d":{id:"streets-dark-3d",itemId:"8a4efa2c20484ec9b4557895e65736ff",is3d:!0,baseMapLayers:[{id:"streets-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/bc599b6d741a4ac084b7eea7bf8c5938/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Streets Night (for 3D)"},{id:"streets-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"streets-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"dark-gray-3d":{id:"dark-gray-3d",itemId:"a8b7322a5fe94002bb0f5e0eeb0c5c18",is3d:!0,baseMapLayers:[{id:"dark-gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/4178f71acb934fb89f169e7d667c20c6/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Dark Gray Canvas (for 3D)"},{id:"dark-gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"dark-gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"arcgis-imagery":{get thumbnailUrl(){return(0,i.s)("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return(0,i.s)("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return(0,i.s)("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return(0,i.s)("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return(0,i.s)("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return(0,i.s)("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return(0,i.s)("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return(0,i.s)("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},"arcgis-topographic":{get thumbnailUrl(){return(0,i.s)("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return(0,i.s)("esri/images/basemap/oceans.jpg")},title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]},"arcgis-human-geography":{title:"Human Geography",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Base",title:"Human Geography Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Detail",title:"Human Geography Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Label",title:"Human Geography Label",isReference:!0}]},"arcgis-human-geography-dark":{title:"Human Geography (Dark)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Base",title:"Human Geography Dark Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Detail",title:"Human Geography Dark Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Label",title:"Human Geography Dark Label",isReference:!0}]}}},51107:function(e,t,r){r.d(t,{VC:function(){return u},dp:function(){return d},jj:function(){return h},ns:function(){return f}});var i=r(74756),n=r(25591),s=(r(78879),r(40633)),o=r(95929),a=(r(90683),r(67888)),l=(r(25128),r(11876));const c=()=>s.A.getLogger("esri.support.basemapUtils");function u(){return{}}function h(e){for(const t in e){const r=e[t];(0,o.pR)(r),delete e[t]}}function d(e,t){let r;if("string"==typeof e){const s=e in l.H,o=!s&&e.includes("/");if(!s&&!o){if(n.default.apiKey)c().warn(`Unable to find basemap definition for: ${e}. See available styles at https://developers.arcgis.com/rest/basemap-styles/`);else{const t=Object.entries(l.H).filter((([e,t])=>t.classic||t.is3d)).map((([e])=>`"${e}"`)).sort().join(", ");c().warn(`Unable to find basemap definition for: ${e}. Try one of these: ${t}`)}return null}t&&(r=t[e]),r||(r=s?i.default.fromId(e):new i.default({style:{id:e}}),t&&(t[e]=r))}else r=(0,a.dp)(i.default,e);return r?.destroyed&&(c().warn("The provided basemap is already destroyed",{basemap:r}),r=null),r}function f(e,t){return e.basemap?.referenceLayers?.some((e=>e.uid===t))||e.basemap?.baseLayers?.some((e=>e.uid===t))}},23454:function(e,t,r){r.d(t,{Aq:function(){return n},pC:function(){return s},rx:function(){return o}});var i=r(29076);function n(e,t){e[4]=t}class s{constructor(e,t=!0,r=!0,n=0){this.isClosed=!1,this.geometryCursor=null,this.geometryCursor=!t&&"esriGeometryPolygon"===e.geometryType||!r&&"esriGeometryPolyline"===e.geometryType?null:e,this.geomUnitsPerPoint=n,this.iterateMultiPath=!1,this.iteratePath=!1,this.internalPlacement=new i.W}next(){if(!this.geometryCursor)return null;const e=this.processMultiPath(this.geometryCursor);return this.iterateMultiPath&&e||(this.geometryCursor=null),e}processMultiPath(e){for(;this.iteratePath||e.pathIndex<e.totalSize-1;){this.iteratePath||e.nextPath(),this.iterateMultiPath=!0;const t=this.processPath(e);if(t)return t}return this.iterateMultiPath=!1,null}}class o{constructor(e,t,r,i=0){this.isClosed=!1,this.inputGeometries=e,this.acceptPolygon=t,this.acceptPolyline=r,this.geomUnitsPerPoint=i,this.iteratePath=!1,this.multiPathCursor=null}next(){for(;;){if(!this.multiPathCursor){let e=this.inputGeometries.next();for(;e&&(this.isClosed=this.acceptPolygon&&"esriGeometryPolygon"===e.geometryType||"esriGeometryEnvelope"===e.geometryType,this.multiPathCursor=e,!this.multiPathCursor);)e=this.inputGeometries.next();if(!this.multiPathCursor)return null}for(;this.iteratePath||this.multiPathCursor.nextPath();){this.multiPathCursor.seekPathStart();const e=this.processPath(this.multiPathCursor);if(e)return e}this.multiPathCursor=null}}}},62096:function(e,t,r){r.d(t,{k:function(){return a},q:function(){return l}});var i=r(33134),n=r(72139);const s=512;let o;class a{constructor(e){this._geometry=e}next(){const e=this._geometry;return this._geometry=null,e}}function l(e,t){o||(o=new n.O3(0,0,0,1));const r="esriGeometryPolygon"===e.geometryType,a=r?n.dC.Polygon:n.dC.LineString,l=r?3:2;let c,u;for(o.reset(a),o.setPixelMargin(t+1),o.setExtent(s);e.nextPath();)if(!(e.pathSize<l)){for(e.nextPoint(),c=e.x,u=-e.y,o.moveTo(c,u);e.nextPoint();)c=e.x,u=-e.y,o.lineTo(c,u);r&&o.close()}const h=o.result(!1);if(h){const t=i.z.createEmptyOptimizedCIM(e.geometryType);for(const e of h){t.startPath();for(const r of e)t.pushXY(r.x,-r.y)}return t.reset(),t}return null}},9635:function(e,t,r){r.d(t,{A:function(){return T},c:function(){return I}});var i=r(63514),n=r(82112),s=r(20391),o=r(11672),a=r(12281),l=r(2969),c=r(7889),u=r(48645),h=r(7088),d=r(17706),f=r(10183),p=r(1646),m=r(79323),_=r(34476),g=r(31771),y=r(15987),x=r(19511),b=r(20305),w=r(58892),v=r(80585),S=r(58676);function T(e){if(!e)return null;switch(e.type){case"CIMGeometricEffectAddControlPoints":return i.N.local();case"CIMGeometricEffectArrow":return n.B.local();case"CIMGeometricEffectBuffer":return s.s.local();case"CIMGeometricEffectControlMeasureLine":return o.v.local();case"CIMGeometricEffectCut":return a.y.local();case"CIMGeometricEffectDashes":return l.I.local();case"CIMGeometricEffectDonut":return c.O.local();case"CIMGeometricEffectJog":return u.U.local();case"CIMGeometricEffectMove":return h.V.local();case"CIMGeometricEffectOffset":return d.V.local();case"CIMGeometricEffectReverse":return f.C.local();case"CIMGeometricEffectRotate":return p.v.local();case"CIMGeometricEffectScale":return m.W.local();case"CIMGeometricEffectWave":return _.l.local()}return null}function I(e){if(!e)return null;switch(e.type){case"CIMMarkerPlacementAlongLineSameSize":return g.e.local();case"CIMMarkerPlacementAtExtremities":return y.y.local();case"CIMMarkerPlacementAtRatioPositions":return x.S.local();case"CIMMarkerPlacementInsidePolygon":return b.M.local();case"CIMMarkerPlacementOnLine":return w.R.local();case"CIMMarkerPlacementOnVertices":return v.A.local();case"CIMMarkerPlacementPolygonCenter":return S.L.local()}return null}},29076:function(e,t,r){r.d(t,{W:function(){return i}});class i{constructor(){this.setIdentity()}getAngle(){return(null==this.rz||0===this.rz&&1!==this.rzCos&&0!==this.rzSin)&&(this.rz=Math.atan2(this.rzSin,this.rzCos)),this.rz}setIdentity(){this.tx=0,this.ty=0,this.tz=0,this.s=1,this.rx=0,this.ry=0,this.rz=0,this.rzCos=1,this.rzSin=0}setTranslate(e,t){this.tx=e,this.ty=t}setTranslateZ(e){this.tz=e}setRotateCS(e,t){this.rz=void 0,this.rzCos=e,this.rzSin=t}setRotate(e){this.rz=e,this.rzCos=void 0,this.rzSin=void 0}setRotateY(e){this.ry=e}setScale(e){this.s=e}setMeasure(e){this.m=e}}},14817:function(e,t,r){r.d(t,{Rj:function(){return O},mx:function(){return k},CK:function(){return N},IT:function(){return F},QF:function(){return G}});var i=r(80683),n=r(58941),s=r(21609),o=r(40633),a=r(56996),l=r(13520),c=r(33134),u=r(87416),h=r(35068),d=r(72228),f=r(74697),p=r(62096);class m{applyColorSubstitution(e,t){if(!t)return e;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const{width:r,height:i}=e,n=this._rasterizationCanvas,s=n.getContext("2d",{willReadFrequently:!0});e!==n&&(n.width=r,n.height=i,s.drawImage(e,0,0,r,i));const o=s.getImageData(0,0,r,i).data;if(t)for(const e of t)if(e&&e.oldColor&&4===e.oldColor.length&&e.newColor&&4===e.newColor.length){const[t,r,i,n]=e.oldColor,[s,a,l,c]=e.newColor;if(t===s&&r===a&&i===l&&n===c)continue;for(let e=0;e<o.length;e+=4)t===o[e]&&r===o[e+1]&&i===o[e+2]&&n===o[e+3]&&(o[e]=s,o[e+1]=a,o[e+2]=l,o[e+3]=c)}const a=new ImageData(o,r,i);return s.putImageData(a,0,0),n}tintImageData(e,t){if(!t||t.length<4)return e;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const{width:r,height:i}=e,n=this._rasterizationCanvas,s=n.getContext("2d",{willReadFrequently:!0});e!==n&&(n.width=r,n.height=i,s.drawImage(e,0,0,r,i));const o=s.getImageData(0,0,r,i),a=new Uint8Array(o.data),l=[t[0]/255,t[1]/255,t[2]/255,t[3]/255];for(let e=0;e<a.length;e+=4)a[e]*=l[0],a[e+1]*=l[1],a[e+2]*=l[2],a[e+3]*=l[3];const c=new ImageData(new Uint8ClampedArray(a.buffer),r,i);return s.putImageData(c,0,0),n}}var _=r(9635),g=r(29076),y=r(38821),x=r(33389);function b(e){const t=e.getFrame(0);if(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement)return t;const r=document.createElement("canvas");r.width=e.width,r.height=e.height;const i=r.getContext("2d");return t instanceof ImageData?i.putImageData(t,0,0):i.drawImage(t,0,0),r}var w=r(82497),v=r(64303);function S(e){return`rgba(${e.slice(0,3).toString()},${e[3]})`}class T{constructor(e){e&&(this._textRasterizationCanvas=e)}rasterizeText(e,t){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const r=this._textRasterizationCanvas,i=r.getContext("2d",{willReadFrequently:!0});I(i,t),this._parameters=t,this._textLines=e.split(/\r?\n/),this._lineHeight=this._computeLineHeight();const{decoration:n,weight:s}=t.font;this._lineThroughWidthOffset=n&&"line-through"===n?.1*this._lineHeight:0;const o=null!=t.backgroundColor||null!=t.borderLine,a=o?v.y7:0,l=this._computeTextWidth(i,t)+2*a,c=this._lineHeight*this._textLines.length+2*a;if(r.width=l+2*this._lineThroughWidthOffset,r.height=c,0===r.width||0===r.height)return r.width=r.height=1,{size:[0,0],image:new Uint32Array(0),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0,canvas:r};this._renderedLineHeight=Math.round(this._lineHeight),this._renderedOutlineSize=(t.outline.size||0)*t.pixelRatio,this._renderedHaloSize=(t.halo.size||0)*t.pixelRatio,this._renderedWidth=l,this._renderedHeight=c,this._lineThroughWidthOffset*=t.pixelRatio;const u=(t.outline&&t.outline.color)??[0,0,0,0],h=t.color??[0,0,0,0],d=t.halo&&t.halo.color?t.halo.color:[0,0,0,0];this._fillStyle=S(h),this._outlineStyle=S(u),this._haloStyle=function(e){return`rgb(${e.slice(0,3).toString()})`}(d);const f=this._renderedLineHeight,p=this._renderedOutlineSize,m=this._renderedHaloSize;i.save(),i.clearRect(0,0,r.width,r.height),I(i,t);const _=a*t.pixelRatio,g=function(e,t,r){return"center"===e?.5*t:"right"===e?t-r:r}(i.textAlign,this._renderedWidth-2*_,this._renderedHaloSize+this._renderedOutlineSize)+_,y=m+p+_,x=m>0;let b=this._lineThroughWidthOffset,w=0;if(o){i.save();const e=t.backgroundColor??[0,0,0,0],n=t.borderLine?.color??[0,0,0,0],s=2*(t.borderLine?.size??0);i.fillStyle=S(e),i.strokeStyle=S(n),i.lineWidth=s,i.fillRect(0,0,r.width,r.height),i.strokeRect(0,0,r.width,r.height),i.restore()}x&&this._renderHalo(i,g,y,b,w,t),p>0&&this._renderOutline(i,g,y,b,w,t),w+=y,b+=g;for(const e of this._textLines)x?(i.globalCompositeOperation="destination-out",i.fillStyle="rgb(0, 0, 0)",i.fillText(e,b,w),i.globalCompositeOperation="source-over",i.fillStyle=this._fillStyle,i.fillText(e,b,w)):(i.fillStyle=this._fillStyle,i.fillText(e,b,w)),n&&"none"!==n&&this._renderDecoration(i,b,w,n,s),w+=f;i.restore();const T=this._renderedWidth+2*this._lineThroughWidthOffset,M=this._renderedHeight,A=i.getImageData(0,0,T,M),E=new Uint8Array(A.data);if(t.premultiplyColors){let e;for(let t=0;t<E.length;t+=4)e=E[t+3]/255,E[t]=E[t]*e,E[t+1]=E[t+1]*e,E[t+2]=E[t+2]*e}let P,C;switch(t.horizontalAlignment){case"left":P=-.5;break;case"right":P=.5;break;default:P=0}switch(t.verticalAlignment){case"bottom":C=-.5;break;case"top":C=.5;break;case"baseline":C=-1/6;break;default:C=0}return{size:[T,M],image:new Uint32Array(E.buffer),sdf:!1,simplePattern:!1,anchorX:P,anchorY:C,canvas:r}}_renderHalo(e,t,r,i,n,s){const o=this._renderedWidth,a=this._renderedHeight;this._outlineRasterizationCanvas||(this._outlineRasterizationCanvas=document.createElement("canvas")),this._outlineRasterizationCanvas.width=o,this._outlineRasterizationCanvas.height=a;const l=this._outlineRasterizationCanvas,c=l.getContext("2d");c.clearRect(0,0,o,a),I(c,s);const{decoration:u,weight:h}=s.font;c.fillStyle=this._haloStyle,c.strokeStyle=this._haloStyle,c.lineJoin="round",this._renderOutlineNative(c,t,r,u,h,this._renderedHaloSize+this._renderedOutlineSize),e.globalAlpha=this._parameters.halo.color[3],e.drawImage(l,0,0,o,a,i,n,o,a),e.globalAlpha=1}_renderOutline(e,t,r,i,n,s){const o=this._renderedWidth,a=this._renderedHeight;this._outlineRasterizationCanvas||(this._outlineRasterizationCanvas=document.createElement("canvas")),this._outlineRasterizationCanvas.width=o,this._outlineRasterizationCanvas.height=a;const l=this._outlineRasterizationCanvas,c=l.getContext("2d");c.clearRect(0,0,o,a),I(c,s);const{decoration:u,weight:h}=s.font;c.fillStyle=this._outlineStyle,c.strokeStyle=this._outlineStyle,c.lineJoin="round",this._renderOutlineNative(c,t,r,u,h,this._renderedOutlineSize),e.globalAlpha=this._parameters.outline.color[3],e.drawImage(l,0,0,o,a,i,n,o,a),e.globalAlpha=1}_renderOutlineNative(e,t,r,i,n,s){const o=this._renderedLineHeight;for(const a of this._textLines){const l=2*s,c=5,u=.1;for(let s=0;s<c;s++){const o=(1-(c-1)*u+s*u)*l;e.lineWidth=o,e.strokeText(a,t,r),i&&"none"!==i&&this._renderDecoration(e,t,r,i,n,o)}r+=o}}computeTextSize(e,t){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const r=this._textRasterizationCanvas,i=r.getContext("2d");I(i,t),this._parameters=t,this._textLines=e.split(/\r?\n/),this._lineHeight=this._computeLineHeight();const n=this._computeTextWidth(i,t),s=this._lineHeight*this._textLines.length;return r.width=n,r.height=s,[n*t.pixelRatio,s*t.pixelRatio]}_computeTextWidth(e,t){let r=0;for(const t of this._textLines)r=Math.max(r,e.measureText(t).width);const i=t.font;return("italic"===i.style||"oblique"===i.style||"string"==typeof i.weight&&("bold"===i.weight||"bolder"===i.weight)||"number"==typeof i.weight&&i.weight>600)&&(r+=.3*e.measureText("w").width),r+=2*(0,l.Lz)(this._parameters.halo.size),Math.round(r)}_computeLineHeightBase(){return 1.275*this._parameters.size}_computeLineHeight(){let e=this._computeLineHeightBase();const t=this._parameters.font.decoration;return t&&"underline"===t&&(e*=1.3),Math.round(e+2*(0,l.Lz)(this._parameters.halo.size))}_renderDecoration(e,t,r,i,n,s){let o=.9*this._lineHeight;const a="bold"===n?.06:"bolder"===n?.09:.04;switch(e.textAlign){case"center":t-=this._renderedWidth/2;break;case"right":t-=this._renderedWidth}const l=e.textBaseline;if("underline"===i)switch(o=.9*this._computeLineHeightBase(),l){case"top":r+=o;break;case"middle":r+=o/2}else if("line-through"===i)switch(l){case"top":r+=o/1.5;break;case"middle":r+=o/3}const c=s?1.5*s:Math.ceil(o*a);e.save(),e.beginPath(),e.strokeStyle=e.fillStyle,e.lineWidth=c,e.moveTo(t-this._lineThroughWidthOffset,r),e.lineTo(t+this._renderedWidth+2*this._lineThroughWidthOffset,r),e.stroke(),e.restore()}}function I(e,t){const r=Math.max(t.size,.5),i=t.font,n=`${i.style} ${i.weight} ${(0,l.Lz)(r).toFixed(1)}px ${i.family}, sans-serif`;let s;switch(e.font=n,e.textBaseline="top",t.horizontalAlignment){case"left":default:s="left";break;case"right":s="right";break;case"center":s="center"}e.textAlign=s}var M=r(7590),A=r(16043),E=r(39686),P=r(17469),C=r(96700);const R=Math.PI/180;class F{constructor(e){this._t=e}static createIdentity(){return new F([1,0,0,0,1,0])}clone(){const e=this._t;return new F(e.slice())}transform(e){const t=this._t;return[t[0]*e[0]+t[1]*e[1]+t[2],t[3]*e[0]+t[4]*e[1]+t[5]]}static createScale(e,t){return new F([e,0,0,0,t,0])}scale(e,t){const r=this._t;return r[0]*=e,r[1]*=e,r[2]*=e,r[3]*=t,r[4]*=t,r[5]*=t,this}scaleRatio(){return Math.sqrt(this._t[0]*this._t[0]+this._t[1]*this._t[1])}static createTranslate(e,t){return new F([0,0,e,0,0,t])}translate(e,t){const r=this._t;return r[2]+=e,r[5]+=t,this}static createRotate(e){const t=Math.cos(e),r=Math.sin(e);return new F([t,-r,0,r,t,0])}rotate(e){return F.multiply(this,F.createRotate(e),this)}angle(){const e=this._t[0],t=this._t[3],r=Math.sqrt(e*e+t*t);return[e/r,t/r]}static multiply(e,t,r){const i=e._t,n=t._t,s=i[0]*n[0]+i[3]*n[1],o=i[1]*n[0]+i[4]*n[1],a=i[2]*n[0]+i[5]*n[1]+n[2],l=i[0]*n[3]+i[3]*n[4],c=i[1]*n[3]+i[4]*n[4],u=i[2]*n[3]+i[5]*n[4]+n[5],h=r._t;return h[0]=s,h[1]=o,h[2]=a,h[3]=l,h[4]=c,h[5]=u,r}invert(){const e=this._t;let t=e[0]*e[4]-e[1]*e[3];if(0===t)return new F([0,0,0,0,0,0]);t=1/t;const r=(e[1]*e[5]-e[2]*e[4])*t,i=(e[2]*e[3]-e[0]*e[5])*t,n=e[4]*t,s=-e[1]*t,o=-e[3]*t,a=e[0]*t;return new F([n,s,r,o,a,i])}}class L{constructor(e,t){this._resourceManager=e,this._transfos=[],this._sizeTransfos=[],this._geomUnitsPerPoint=1,this._placementPool=new a.A(g.W,void 0,void 0,100),this._earlyReturn=!1,this._mapRotation=0,this._transfos.push(t||F.createIdentity()),this._sizeTransfos.push(t?t.scaleRatio():1)}setTransform(e,t){this._transfos=[e||F.createIdentity()],this._sizeTransfos=[t||(e?e.scaleRatio():1)]}setGeomUnitsPerPoint(e){this._geomUnitsPerPoint=e}transformPt(e){return this._transfos[this._transfos.length-1].transform(e)}transformSize(e){return e*this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformPt(e){return this._transfos[this._transfos.length-1].invert().transform(e)}reverseTransformSize(e){return e/this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformScalar(e){return e/this._transfos[this._transfos.length-1].scaleRatio()}getTransformAngle(){return this._transfos[this._transfos.length-1].angle()}geomUnitsPerPoint(){return this.isEmbedded()?1:this._geomUnitsPerPoint}prevGeomUnitsPerPoint(){return this._transfos.length>2?1:this._geomUnitsPerPoint}isEmbedded(){return this._transfos.length>1}back(){return this._transfos[this._transfos.length-1]}push(e,t){const r=t?e.scaleRatio():1;F.multiply(e,this.back(),e),this._transfos.push(e),this._sizeTransfos.push(this._sizeTransfos[this._sizeTransfos.length-1]*r)}pop(){this._transfos.splice(-1,1),this._sizeTransfos.splice(-1,1)}drawSymbol(e,t,r){if(e)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":this.drawMultiLayerSymbol(e,t);break;case"CIMTextSymbol":this.drawTextSymbol(e,t,r)}}drawMultiLayerSymbol(e,t){if(!e||!t)return;const r=e.symbolLayers;if(!r)return;const i=e.effects;if(i&&i.length>0){const e=this.executeEffects(i,t);if(e){let t=e.next();for(;t;)this.drawSymbolLayers(r,t.asJSON()),t=e.next()}}else this.drawSymbolLayers(r,t)}executeEffects(e,t){const r=this._resourceManager.geometryEngine;let i=new p.k(c.z.fromJSONCIM(t));for(const t of e){const e=(0,_.A)(t);e&&(i=e.execute(i,t,this.geomUnitsPerPoint(),null,r))}return i}drawSymbolLayers(e,t){let r=e.length;for(;r--;){const i=e[r];if(!i||!1===i.enable)continue;const n=i.effects;if(n&&n.length>0){const e=this.executeEffects(n,t);if(e){let t=null;for(;(t=e.next())&&(this.drawSymbolLayer(i,t.asJSON()),!this._earlyReturn););}}else this.drawSymbolLayer(i,t);if(this._earlyReturn)return}}drawSymbolLayer(e,t){switch(e.type){case"CIMSolidFill":this.drawSolidFill(t,e.color,e.path);break;case"CIMHatchFill":this.drawHatchFill(t,e);break;case"CIMPictureFill":this.drawPictureFill(t,e);break;case"CIMGradientFill":this.drawGradientFill(t,e);break;case"CIMSolidStroke":this.drawSolidStroke(t,e.color,e.width,e.capStyle,e.joinStyle,e.miterLimit,e.path);break;case"CIMPictureStroke":this.drawPictureStroke(t,e);break;case"CIMGradientStroke":this.drawGradientStroke(t,e);break;case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":this.drawMarkerLayer(e,t)}}drawHatchFill(e,t){const r=function(e,t,r){let i=(0,M.$w)(e.separation,y.D.CIMHatchFill.separation)*r,n=(0,M.$w)(e.rotation);if(0===i)return null;i<0&&(i=-i);let s=0;const o=.5*i;for(;s>o;)s-=i;for(;s<-o;)s+=i;const a=(0,u.vt)();(0,h.Rg)(a,t),a[0]-=o,a[1]-=o,a[2]+=o,a[3]+=o;const l=[[a[0],a[1]],[a[0],a[3]],[a[2],a[3]],[a[2],a[1]]];for(;n>180;)n-=180;for(;n<0;)n+=180;const c=Math.cos(n*R),d=Math.sin(n*R),f=-i*d,p=i*c;let m,_,g,x;s=(0,M.$w)(e.offsetX)*r*d-(0,M.$w)(e.offsetY)*r*c,m=g=Number.MAX_VALUE,_=x=-Number.MAX_VALUE;for(const e of l){const t=e[0],r=e[1],i=c*t+d*r,n=-d*t+c*r;m=Math.min(m,i),g=Math.min(g,n),_=Math.max(_,i),x=Math.max(x,n)}g=Math.floor(g/i)*i;let b=c*m-d*g-f*s/i,w=d*m+c*g-p*s/i,v=c*_-d*g-f*s/i,S=d*_+c*g-p*s/i;const T=1+Math.round((x-g)/i),I=[];for(let e=0;e<T;e++)b+=f,w+=p,v+=f,S+=p,I.push([[b,w],[v,S]]);return{paths:I}}(t,e,this.geomUnitsPerPoint());r&&(this.pushClipPath(e),this.drawMultiLayerSymbol(t.lineSymbol,r),this.popClipPath())}drawPictureFill(e,t){}drawGradientFill(e,t){}drawPictureStroke(e,t){}drawGradientStroke(e,t){}drawMarkerLayer(e,t){const r=e.markerPlacement;if(r){const i=(0,_.c)(r);if(i){const n="CIMMarkerPlacementInsidePolygon"===r.type||"CIMMarkerPlacementPolygonCenter"===r.type&&r.clipAtBoundary;n&&this.pushClipPath(t);const s=i.execute(c.z.fromJSONCIM(t),r,this.geomUnitsPerPoint(),null,this._resourceManager.geometryEngine);if(s){let t=null;for(;(t=s.next())&&(this.drawMarker(e,t),!this._earlyReturn););}n&&this.popClipPath()}}else{const r=this._placementPool.acquire();if((0,f.fT)(t))r.tx=t.x,r.ty=t.y,this.drawMarker(e,r);else if((0,f.Bi)(t)){const i=(0,d.l8)(t);i&&([r.tx,r.ty]=i,this.drawMarker(e,r))}else for(const i of t.points)if(r.tx=i[0],r.ty=i[1],this.drawMarker(e,r),this._earlyReturn)break;this._placementPool.release(r)}}drawMarker(e,t){switch(e.type){case"CIMCharacterMarker":case"CIMPictureMarker":this.drawPictureMarker(e,t);break;case"CIMVectorMarker":this.drawVectorMarker(e,t)}}drawPictureMarker(e,t){if(!e)return;const r=this._resourceManager.getResource(e.url),i=(0,M.$w)(e.size,y.D.CIMPictureMarker.size);if(null==r||i<=0)return;const n=r.width,s=r.height;if(!n||!s)return;const o=n/s,a=(0,M.$w)(e.scaleX,1),l=F.createIdentity(),c=e.anchorPoint;if(c){let t=c.x,r=c.y;"Absolute"!==e.anchorPointUnits&&(t*=i*o*a,r*=i),l.translate(-t,-r)}let u=(0,M.$w)(e.rotation);e.rotateClockwise&&(u=-u),this._mapRotation&&(u+=this._mapRotation),u&&l.rotate(u*R);let h=(0,M.$w)(e.offsetX),d=(0,M.$w)(e.offsetY);if(h||d){if(this._mapRotation){const e=R*this._mapRotation,t=Math.cos(e),r=Math.sin(e),i=h*r+d*t;h=h*t-d*r,d=i}l.translate(h,d)}const f=this.geomUnitsPerPoint();1!==f&&l.scale(f,f);const p=t.getAngle();p&&l.rotate(p),l.translate(t.tx,t.ty),this.push(l,!1),this.drawImage(e,i),this.pop()}drawVectorMarker(e,t){if(!e)return;const r=e.markerGraphics;if(!r)return;const i=(0,M.$w)(e.size,y.D.CIMVectorMarker.size),n=e.frame,s=n?n.ymax-n.ymin:0,a=i&&s?i/s:1,l=F.createIdentity();n&&l.translate(.5*-(n.xmax+n.xmin),.5*-(n.ymax+n.ymin));const c=e.anchorPoint;if(c){let t=c.x,r=c.y;"Absolute"!==e.anchorPointUnits?n&&(t*=n.xmax-n.xmin,r*=n.ymax-n.ymin):(t/=a,r/=a),l.translate(-t,-r)}1!==a&&l.scale(a,a);let u=(0,M.$w)(e.rotation);e.rotateClockwise&&(u=-u),this._mapRotation&&(u+=this._mapRotation),u&&l.rotate(u*R);let h=(0,M.$w)(e.offsetX),d=(0,M.$w)(e.offsetY);if(h||d){if(this._mapRotation){const e=R*this._mapRotation,t=Math.cos(e),r=Math.sin(e),i=h*r+d*t;h=h*t-d*r,d=i}l.translate(h,d)}const f=this.geomUnitsPerPoint();1!==f&&l.scale(f,f);const p=t.getAngle();p&&l.rotate(p),l.translate(t.tx,t.ty),this.push(l,e.scaleSymbolsProportionally);for(const e of r){e?.symbol&&e.geometry||o.A.getLogger("esri.symbols.cim.CIMSymbolDrawHelper").error("Invalid marker graphic",e);let t=e.textString;if("number"==typeof t&&(t=t.toString()),this.drawSymbol(e.symbol,e.geometry,t),this._earlyReturn)break}this.pop()}drawTextSymbol(e,t,r){if(!e)return;if(!(0,f.fT)(t))return;if((0,M.$w)(e.height,y.D.CIMTextSymbol.height)<=0)return;const i=F.createIdentity();let n=(0,M.$w)(e.angle);n=-n,n&&i.rotate(n*R);const s=(0,M.$w)(e.offsetX),o=(0,M.$w)(e.offsetY);(s||o)&&i.translate(s,o);const a=this.geomUnitsPerPoint();1!==a&&i.scale(a,a),i.translate(t.x,t.y),this.push(i,!1),this.drawText(e,r),this.pop()}}class k extends L{constructor(e,t){super(e,t),this.reset()}reset(){this._xmin=this._ymin=1/0,this._xmax=this._ymax=-1/0,this._clipCount=0}envelope(){return new w.A(this._xmin,this._ymin,this._xmax-this._xmin,this._ymax-this._ymin)}bounds(){return(0,u.fA)(this._xmin,this._ymin,this._xmax,this._ymax)}drawSolidFill(e){if(e&&!(this._clipCount>0))if((0,f.Bi)(e))this._processPath(e.rings,0);else if((0,f.Rg)(e))this._processPath(e.paths,0);else if((0,f.ZC)(e)){const t=U(e);t&&this._processPath(t.rings,0)}else console.error("drawSolidFill Unexpected geometry type!")}drawSolidStroke(e,t,r){if(!e||this._clipCount>0||null==r||r<=0)return;const i=Math.max(.5*this.transformSize((0,M.$w)(r,y.D.CIMSolidStroke.width)),.25);if((0,f.Bi)(e))this._processPath(e.rings,i);else if((0,f.Rg)(e))this._processPath(e.paths,i);else if((0,f.ZC)(e)){const t=U(e);t&&this._processPath(t.rings,i)}else console.error("drawSolidStroke unexpected geometry type!")}drawMarkerLayer(e,t){(0,f.Bi)(t)&&e.markerPlacement&&("CIMMarkerPlacementInsidePolygon"===e.markerPlacement.type||"CIMMarkerPlacementPolygonCenter"===e.markerPlacement.type&&e.markerPlacement.clipAtBoundary)?this._processPath(t.rings,0):super.drawMarkerLayer(e,t)}drawHatchFill(e,t){this.drawSolidFill(e)}drawPictureFill(e,t){this.drawSolidFill(e)}drawGradientFill(e,t){this.drawSolidFill(e)}drawPictureStroke(e,t){this.drawSolidStroke(e,null,t.width)}drawGradientStroke(e,t){this.drawSolidStroke(e,null,t.width)}pushClipPath(e){this.drawSolidFill(e),this._clipCount++}popClipPath(){this._clipCount--}drawImage(e,t){const{url:r}=e,i=(0,M.$w)(e.scaleX,1);let n=i*t,s=t;const o=this._resourceManager.getResource(r);if(null!=o){const e=o.height/o.width;n=i*(t?e>1?t:t/e:o.width),s=t?e>1?t*e:t:o.height}this._merge(this.transformPt([-n/2,-s/2]),0),this._merge(this.transformPt([-n/2,s/2]),0),this._merge(this.transformPt([n/2,-s/2]),0),this._merge(this.transformPt([n/2,s/2]),0)}drawText(e,t){if(!t||0===t.length)return;this._textRasterizer||(this._textRasterizer=new T);const r=B(e);let[i,n]=this._textRasterizer.computeTextSize(t,r);i=(0,l.PN)(i),n=(0,l.PN)(n);const s=this.transformSize(1)*this.reverseTransformScalar(1);i*=s,n*=s;let o=0;switch(e.horizontalAlignment){case"Left":o=i/2;break;case"Right":o=-i/2}let a=0;switch(e.verticalAlignment){case"Bottom":a=n/2;break;case"Top":a=-n/2;break;case"Baseline":a=n/6}this._merge(this.transformPt([-i/2+o,-n/2+a]),0),this._merge(this.transformPt([-i/2+o,n/2+a]),0),this._merge(this.transformPt([i/2+o,-n/2+a]),0),this._merge(this.transformPt([i/2+o,n/2+a]),0)}_processPath(e,t){if(e)for(const r of e){const e=r?r.length:0;if(e>1){this._merge(this.transformPt(r[0]),t);for(let i=1;i<e;i++)this._merge(this.transformPt(r[i]),t)}}}_merge(e,t){e[0]-t<this._xmin&&(this._xmin=e[0]-t),e[0]+t>this._xmax&&(this._xmax=e[0]+t),e[1]-t<this._ymin&&(this._ymin=e[1]-t),e[1]+t>this._ymax&&(this._ymax=e[1]+t)}}class N extends L{constructor(){super(...arguments),this._searchPoint=[0,0],this._searchDistPoint=0,this._textInfo=null,this._svg=null,this._path=null,this._canvas=null}destroy(){this._svg=(0,A.pK)(this._svg),this._path=null,this._canvas=null}hitTest(e,t,r,i,s,o){const a=o*(0,l.Lz)(1);this.setTransform(),this.setGeomUnitsPerPoint(a),this._searchPoint=[(e[0]+e[2])/2,(e[1]+e[3])/2],this._searchDistPoint=(e[2]-e[0])/2/a,this._textInfo=i;const c=t&&("CIMPointSymbol"===t.type&&"Map"!==t.angleAlignment||"CIMTextSymbol"===t.type);if(this._mapRotation=c?s:0,!(0,n.A)("esri-mobile")){const e=(0,l.PN)(E._M*window.devicePixelRatio),r=(0,l.PN)(E.ie);("CIMLineSymbol"!==t?.type&&"CIMPolygonSymbol"!==t?.type||!t.symbolLayers?.some(M.jn))&&"CIMMeshSymbol"!==t?.type&&((0,M.YC)(t)??0)<r&&(this._searchDistPoint=e)}return this._earlyReturn=!1,this.drawSymbol(t,r),this._earlyReturn}executeEffects(e,t){return"CIMGeometricEffectDashes"===e.at(-1)?.type&&(e=e.slice(0,-1)),super.executeEffects(e,t)}drawSolidFill(e,t,r){null!=r?this._hittestSvgPath(e,r,!0):this._hitTestFill(e)}drawHatchFill(e,t){this._hitTestFill(e)}drawPictureFill(e,t){this._hitTestFill(e)}drawGradientFill(e,t){this._hitTestFill(e)}drawSolidStroke(e,t,r,i,n,s,o){null!=o?this._hittestSvgPath(e,o,!1,r):this._hitTestStroke(e,r)}drawPictureStroke(e,t){this._hitTestStroke(e,t.width)}drawGradientStroke(e,t){this._hitTestStroke(e,t.width)}drawMarkerLayer(e,t){e.markerPlacement&&("CIMMarkerPlacementInsidePolygon"===e.markerPlacement.type||"CIMMarkerPlacementPolygonCenter"===e.markerPlacement.type&&e.markerPlacement.clipAtBoundary)?this._hitTestFill(t):super.drawMarkerLayer(e,t)}pushClipPath(e){}popClipPath(){}drawImage(e,t){const{url:r}=e,i=(0,M.$w)(e.scaleX,1),n=this._resourceManager.getResource(r);if(null==n||0===n.height||0===t)return;const s=t*this.geomUnitsPerPoint(),o=s*i*(n.width/n.height),a=this.reverseTransformPt(this._searchPoint),l=this._searchDistPoint;Math.abs(a[0])<o/2+l&&Math.abs(a[1])<s/2+l&&(this._earlyReturn=!0)}drawText(e,t){const r=this._textInfo;if(!r)return;const i=r.get(e);if(!i)return;if(!i.glyphMosaicItems.glyphs.length)return;const n=(0,C.hV)((0,M.$w)(e.height,y.D.CIMTextSymbol.height)),{lineGapType:s,lineGap:o}=e,a=s?G(s,(0,M.$w)(o),n):0,l="CIMBackgroundCallout"===e.callout?.type,c=(0,P.Tl)(i.glyphMosaicItems,{scale:n/E.eG,angle:0,xOffset:0,yOffset:0,horizontalAlignment:e.horizontalAlignment,verticalAlignment:e.verticalAlignment,maxLineWidth:(0,C.Lu)(e.lineWidth),lineHeight:E.DY*Math.max(.25,Math.min(a||1,4)),decoration:e.font.decoration||"none",useCIMAngleBehavior:!0,hasBackground:l}),u=this.reverseTransformPt(this._searchPoint),h=u[0],d=u[1];for(const e of c.glyphs)if(h>e.xTopLeft&&h<e.xBottomRight&&d>-e.yBottomRight&&d<-e.yTopLeft){this._earlyReturn=!0;break}}_hitTestFill(e){let t=null;if((0,f.ZC)(e)){const r=e;t=[[[r.xmin,r.ymin],[r.xmin,r.ymax],[r.xmax,r.ymax],[r.xmax,r.ymin],[r.xmin,r.ymin]]]}else if((0,f.Bi)(e))t=e.rings;else{if(!(0,f.Rg)(e))return;t=e.paths}const r=this.reverseTransformPt(this._searchPoint);(function(e,t){let r=0;for(const i of t){const t=i.length;for(let n=1;n<t;n++){const t=i[n-1],s=i[n];t[1]>e[1]!=s[1]>e[1]&&((s[0]-t[0])*(e[1]-t[1])-(s[1]-t[1])*(e[0]-t[0])>0?r++:r--)}}return 0!==r})(r,t)&&(this._earlyReturn=!0),this._earlyReturn||D(r,t,this.reverseTransformScalar(this._searchDistPoint)*this.prevGeomUnitsPerPoint())&&(this._earlyReturn=!0)}_getSvgPath(){return null!=this._svg&&null!=this._path||(this._svg??=(0,A.p)(),this._path??=(0,A.FJ)("path"),this._svg.appendChild(this._path)),this._path}_getCanvas(){return this._canvas??=document.createElement("canvas"),this._canvas}_hittestSvgPath(e,t,r,i){const n=(0,u.vt)();(0,h.Rg)(n,e);const s=n[0],o=n[1],a=n[2]-n[0],l=n[3]-n[1],c=this._getSvgPath();c.setAttribute("d",t);const d=c.getBBox(),f=d.width/a,p=d.height/l,m=this._getCanvas();m.width=d.width,m.height=d.height;const _=m.getContext("2d",{willReadFrequently:!0});_.setTransform(1,0,0,1,d.x,-d.y);const g=new Path2D(t);r?_.fill(g):(_.lineWidth=i*f,_.stroke(g));const y=this.reverseTransformScalar(this._searchDistPoint)*this.prevGeomUnitsPerPoint(),x=this.reverseTransformPt(this._searchPoint),b=(x[0]-s-y)*f,w=(l-(x[1]-o)-y)*p,v=2*y*f,S=2*y*p,T=_.getImageData(b,w,v,S).data;for(let e=3;e<T.length;e+=4)if(T[e]>127.5)return void(this._earlyReturn=!0)}_hitTestStroke(e,t){let r=null;if((0,f.ZC)(e)){const t=e;r=[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]}else if((0,f.Bi)(e))r=e.rings;else{if(!(0,f.Rg)(e))return;r=e.paths}D(this.reverseTransformPt(this._searchPoint),r,(0,M.$w)(t,y.D.CIMSolidStroke.width)*this.geomUnitsPerPoint()/2+this.reverseTransformScalar(this._searchDistPoint)*this.prevGeomUnitsPerPoint())&&(this._earlyReturn=!0)}}class O extends L{constructor(e,t,r,i){super(t,r),this._applyAdditionalRenderProps=i,this._colorSubstitutionHelper=new m,this._ctx=e}drawSolidFill(e,t){if(!e)return;if((0,f.Bi)(e))this._buildPath(e.rings,!0);else if((0,f.Rg)(e))this._buildPath(e.paths,!0);else if((0,f.ZC)(e))this._buildPath(U(e).rings,!0);else{if(!(0,f.U9)(e))return;console.log("CanvasDrawHelper.drawSolidFill - No implementation!")}const r=this._ctx;r.fillStyle="string"==typeof t?t:"rgba("+Math.round(t[0])+","+Math.round(t[1])+","+Math.round(t[2])+","+(t[3]??255)/255+")",r.fill("evenodd")}drawSolidStroke(e,t,r,i,n,s){if(!e||!t||0===r)return;if((0,f.Bi)(e))this._buildPath(e.rings,!0);else if((0,f.Rg)(e))this._buildPath(e.paths,!1);else{if(!(0,f.ZC)(e))return void console.log("CanvasDrawHelper.drawSolidStroke isn't implemented!");this._buildPath(U(e).rings,!0)}const o=this._ctx;o.strokeStyle="string"==typeof t?t:"rgba("+Math.round(t[0])+","+Math.round(t[1])+","+Math.round(t[2])+","+(t[3]??255)/255+")",o.lineWidth=Math.max(this.transformSize(r),.5),this._setCapStyle(i),this._setJoinStyle(n),o.miterLimit=s,o.stroke()}pushClipPath(e){if(this._ctx.save(),(0,f.Bi)(e))this._buildPath(e.rings,!0);else if((0,f.Rg)(e))this._buildPath(e.paths,!0);else{if(!(0,f.ZC)(e))return;this._buildPath(U(e).rings,!0)}this._ctx.clip("evenodd")}popClipPath(){this._ctx.restore()}drawImage(e,t){const{colorSubstitutions:r,url:i,tintColor:n}=e,s=(0,M.$w)(e.scaleX,1),o=this._resourceManager.getResource(i);if(null==o)return;let a=t*(o.width/o.height),l=t;t||(a=o.width,l=o.height);const c=(0,M.UE)(i)||"src"in o&&(0,M.UE)(o.src);let u="getFrame"in o?b(o):o;r&&(u=this._colorSubstitutionHelper.applyColorSubstitution(u,r)),this._applyAdditionalRenderProps&&!c&&n&&(u=this._colorSubstitutionHelper.tintImageData(u,n));const h=this.transformPt([0,0]),[d,f]=this.getTransformAngle(),p=this.transformSize(1),m=this._ctx;m.save(),m.setTransform({m11:s*p*d,m12:s*p*f,m21:-p*f,m22:p*d,m41:h[0],m42:h[1]}),m.drawImage(u,-a/2,-l/2,a,l),m.restore()}drawText(e,t){if(!t||0===t.length)return;this._textRasterizer||(this._textRasterizer=new T);const r=B(e,this.transformSize((0,l.PN)(1))),i=this._textRasterizer.rasterizeText(t,r);if(!i)return;const{size:n,anchorX:s,anchorY:o,canvas:a}=i,c=n[0]*(s+.5),u=n[1]*(o-.5),h=this._ctx,d=this.transformPt([0,0]),[f,p]=this.getTransformAngle();h.save(),h.setTransform({m11:1*f,m12:1*p,m21:-1*p,m22:1*f,m41:d[0]-1*c,m42:d[1]+1*u}),h.drawImage(a,0,0),h.restore()}drawPictureFill(e,t){if(!e)return;let{colorSubstitutions:r,height:i,offsetX:n,offsetY:s,rotation:o,scaleX:a,tintColor:l,url:c}=t;const u=this._resourceManager.getResource(c);if(null==u)return;if((0,f.Bi)(e))this._buildPath(e.rings,!0);else if((0,f.Rg)(e))this._buildPath(e.paths,!0);else if((0,f.ZC)(e))this._buildPath(U(e).rings,!0);else{if(!(0,f.U9)(e))return;console.log("CanvasDrawHelper.drawPictureFill - No implementation!")}const h=this._ctx,d=(0,M.UE)(c)||"src"in u&&(0,M.UE)(u.src);let p,m="getFrame"in u?b(u):u;if(r&&(m=this._colorSubstitutionHelper.applyColorSubstitution(m,r)),this._applyAdditionalRenderProps){d||l&&(m=this._colorSubstitutionHelper.tintImageData(m,l)),p=h.createPattern(m,"repeat");const e=this.transformSize(1);o||(o=0),n?n*=e:n=0,s?s*=e:s=0,i&&(i*=e);const t=i?i/u.height:1,r=a&&i?a*i/u.width:1;if(0!==o||1!==t||1!==r||0!==n||0!==s){const e=new DOMMatrix;e.rotateSelf(0,0,-o).translateSelf(n,s).scaleSelf(r,t,1),p.setTransform(e)}}else p=h.createPattern(m,"repeat");h.save(),h.fillStyle=p,h.fill("evenodd"),h.restore()}drawPictureStroke(e,t){if(!e)return;let{colorSubstitutions:r,capStyle:i,joinStyle:n,miterLimit:o,tintColor:a,url:c,width:u}=t;const h=this._resourceManager.getResource(c);if(null==h)return;let d;if((0,f.Bi)(e))d=e.rings;else if((0,f.Rg)(e))d=e.paths;else{if(!(0,f.ZC)(e))return(0,f.U9)(e)?void console.log("CanvasDrawHelper.drawPictureStroke - No implementation!"):void 0;d=U(e).rings}u||(u=h.width);const p=(0,M.UE)(c)||"src"in h&&(0,M.UE)(h.src);let m="getFrame"in h?b(h):h;r&&(m=this._colorSubstitutionHelper.applyColorSubstitution(m,r)),this._applyAdditionalRenderProps&&(p||a&&(m=this._colorSubstitutionHelper.tintImageData(m,a)));const _=Math.max(this.transformSize((0,l.Lz)(u)),.5),g=_/m.width,y=this._ctx,x=y.createPattern(m,"repeat-y");let w,v;y.save(),this._setCapStyle(i),this._setJoinStyle(n),void 0!==o&&(y.miterLimit=o),y.lineWidth=_;for(let e of d)if(e=(0,s.o8)(e),q(e),e&&!(e.length<=1)){w=this.transformPt(e[0]);for(let t=1;t<e.length;t++){v=this.transformPt(e[t]);const r=z(w,v),i=new DOMMatrix;i.translateSelf(0,w[1]-_/2).scaleSelf(g,g,1).rotateSelf(0,0,90-r),x.setTransform(i),y.strokeStyle=x,y.beginPath(),y.moveTo(w[0],w[1]),y.lineTo(v[0],v[1]),y.stroke(),w=v}}y.restore()}_buildPath(e,t){const r=this._ctx;if(r.beginPath(),e)for(const i of e){const e=i?i.length:0;if(e>1){let n=this.transformPt(i[0]);r.moveTo(n[0],n[1]);for(let t=1;t<e;t++)n=this.transformPt(i[t]),r.lineTo(n[0],n[1]);t&&r.closePath()}}}_setCapStyle(e){switch(e){case x.uT.Butt:this._ctx.lineCap="butt";break;case x.uT.Round:this._ctx.lineCap="round";break;case x.uT.Square:this._ctx.lineCap="square"}}_setJoinStyle(e){switch(e){case x.wd.Bevel:this._ctx.lineJoin="bevel";break;case x.wd.Round:this._ctx.lineJoin="round";break;case x.wd.Miter:this._ctx.lineJoin="miter"}}}function D(e,t,r){for(const i of t){const t=i.length;for(let n=1;n<t;n++){const t=i[n-1],s=i[n];let o=(s[0]-t[0])*(s[0]-t[0])+(s[1]-t[1])*(s[1]-t[1]);if(0===o)continue;o=Math.sqrt(o);const a=((s[0]-t[0])*(e[1]-t[1])-(s[1]-t[1])*(e[0]-t[0]))/o;if(Math.abs(a)<r){const i=((s[0]-t[0])*(e[0]-t[0])+(s[1]-t[1])*(e[1]-t[1]))/o;if(i>-r&&i<o+r)return!0}}}return!1}function z(e,t){const r=t[0]-e[0],i=t[1]-e[1];return 180/Math.PI*Math.atan2(i,r)}const U=e=>e?{spatialReference:e.spatialReference,rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]}:null,G=(e,t,r)=>{switch(e){case"ExtraLeading":return 1+t/r;case"Multiple":return t;case"Exact":return t/r}};function B(e,t=1){const r=(0,M.DW)(e),n=(0,M._d)(e.fontStyleName),s=e.fontFamilyName??i.Vb,{weight:o,style:a}=n,l=t*(e.height||5),c=(0,M.Bu)(e.horizontalAlignment),u=(0,M.Nl)(e.verticalAlignment),h=(0,M.pM)(e),d=(0,M.pM)(e.haloSymbol),f=null!=d?t*(e.haloSize??0):0,p=(0,M._1)(e.symbol),m=t*((0,M.xo)(e.symbol)||0),_="CIMBackgroundCallout"===e.callout?.type?e.callout.backgroundSymbol:null,g=(0,M.pM)(_),y=(0,M.xo)(_),x=(0,M._1)(_);return{color:h,size:l,horizontalAlignment:c,verticalAlignment:u,font:{family:s,style:(0,M.pV)(a),weight:(0,M.Kn)(o),decoration:r},outline:{size:m||0,color:p},halo:{size:f||0,color:d,style:a},backgroundColor:g,borderLine:null!=y&&null!=x?{size:y,color:x}:null,pixelRatio:1,premultiplyColors:!0}}const V=1e-4;function q(e){let t,r,i,n,s,o=e[0],a=1;for(;a<e.length;)t=e[a][0]-o[0],r=e[a][1]-o[1],n=0!==t?r/t:Math.PI/2,void 0!==i&&n-i<=V?(e.splice(a-1,1),o=s):(s=o,o=e[a],a++),i=n}},57176:function(e,t,r){r.d(t,{BW:function(){return q},Sc:function(){return F},Vb:function(){return A},ll:function(){return R},wp:function(){return L}});var i=r(90152),n=r(58941),s=r(21609),o=r(40633),a=r(13798),l=r(13520),c=r(87416),u=r(35068),h=r(90046),d=r(29076),f=r(14817),p=r(38821),m=r(33389),_=r(7590),g=r(74661),y=r(7056),x=r(39686),b=r(17469),w=r(96700);const v=Math.PI,S=v/2,T=Math.PI/180,I=96/72,M=()=>o.A.getLogger("esri.symbols.cim.CIMSymbolHelper");function A(e){let t;switch(e.type){case"cim":return e.data;case"web-style":return e;case"simple-marker":{const r=L.fromSimpleMarker(e);if(!r)throw new Error("InternalError: Cannot convert symbol to CIM");t=r;break}case"picture-marker":t=L.fromPictureMarker(e);break;case"simple-line":t=L.fromSimpleLineSymbol(e);break;case"simple-fill":t=L.fromSimpleFillSymbol(e);break;case"picture-fill":t=L.fromPictureFillSymbol(e);break;case"text":t=L.fromTextSymbol(e)}return{type:"CIMSymbolReference",symbol:t}}function E(e,t,r){switch(t.type){case"CIMSymbolReference":return E(e,t.symbol,r);case"CIMPointSymbol":null==r&&(r={x:0,y:0}),e.drawSymbol(t,r);break;case"CIMLineSymbol":null==r&&(r={paths:[[[0,0],[10,0]]]}),e.drawSymbol(t,r);break;case"CIMPolygonSymbol":null==r&&(r={rings:[[[0,0],[0,10],[10,10],[10,0],[0,0]]]}),e.drawSymbol(t,r);break;case"CIMTextSymbol":{const r={x:0,y:0};e.drawSymbol(t,r);break}case"CIMVectorMarker":{const r=new d.W;e.drawMarker(t,r);break}}return e.envelope()}function P(e){if(!e)return 0;switch(e.type){case"CIMMarkerPlacementAlongLineSameSize":case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAtExtremities":case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementAtRatioPositions":case"CIMMarkerPlacementOnLine":case"CIMMarkerPlacementOnVertices":return Math.abs(e.offset);default:return 0}}function C(e){if(!e)return 0;switch(e.type){case"CIMGeometricEffectArrow":return Math.abs(.5*e.width);case"CIMGeometricEffectBuffer":return Math.abs(e.size);case"CIMGeometricEffectControlMeasureLine":return 500;case"CIMGeometricEffectExtension":case"CIMGeometricEffectRadial":return Math.abs(e.length);case"CIMGeometricEffectJog":return Math.abs(.5*e.length);case"CIMGeometricEffectMove":return Math.max(Math.abs((0,_.$w)(e.offsetX)),Math.abs((0,_.$w)(e.offsetY)));case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":return Math.abs(e.offset);case"CIMGeometricEffectRegularPolygon":return Math.abs(e.radius);case"CIMGeometricEffectRotate":case"CIMGeometricEffectScale":default:return 0;case"CIMGeometricEffectTaperedPolygon":return.5*Math.max(Math.abs(e.fromWidth),Math.abs(e.toWidth));case"CIMGeometricEffectWave":return Math.abs(e.amplitude);case"CIMGeometricEffectDonut":return Math.abs(e.width)}}function R(e){if(!e)return 0;let t=0;for(const r of e)t+=C(r);return t}class F{static getSymbolInflateSize(e,t,r,i,n){return e||(e=[0,0,0,0]),t?this._getInflateSize(e,t,r,i,n):e}static safeSize(e){const t=Math.max(Math.abs(e[0]),Math.abs(e[2])),r=Math.max(Math.abs(e[1]),Math.abs(e[3]));return Math.sqrt(t*t+r*r)}static _vectorMarkerBounds(e,t,r,i){let n=!0;const s=(0,c.vt)();if(t?.markerGraphics)for(const o of t.markerGraphics){const t=[0,0,0,0];o.geometry&&((0,u.Rg)(s,o.geometry),t[0]=0,t[1]=0,t[2]=0,t[3]=0,this.getSymbolInflateSize(t,o.symbol,r,0,i),s[0]+=t[0],s[1]+=t[1],s[2]+=t[2],s[3]+=t[3],n?(e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],n=!1):(e[0]=Math.min(e[0],s[0]),e[1]=Math.min(e[1],s[1]),e[2]=Math.max(e[2],s[2]),e[3]=Math.max(e[3],s[3])))}return e}static _getInflateSize(e,t,r,i,n){if(function(e){return void 0!==e.symbolLayers}(t)){const s=this._getLayersInflateSize(e,t.symbolLayers,r,i,n),o=R(t.effects);return o>0&&(s[0]-=o,s[1]-=o,s[2]+=o,s[3]+=o),s}return this._getTextInflatedSize(e,t,n)}static _getLayersInflateSize(e,t,r,i,n){let s=!0;if(!t)return e;for(const o of t){if(!o)continue;let t=[0,0,0,0];switch(o.type){case"CIMSolidFill":case"CIMPictureFill":case"CIMHatchFill":case"CIMGradientFill":break;case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":{const e=o;let r=e.width;null!=r&&(e.capStyle===m.uT.Square||e.joinStyle===m.wd.Miter?r/=1.4142135623730951:r/=2,t[0]=-r,t[1]=-r,t[2]=r,t[3]=r);break}case"CIMCharacterMarker":case"CIMVectorMarker":case"CIMPictureMarker":{const e=o;if("CIMVectorMarker"===o.type){const e=o;if(t=this._vectorMarkerBounds(t,e,r,n),e.frame){const r=(e.frame.xmin+e.frame.xmax)/2,i=(e.frame.ymin+e.frame.ymax)/2;if(t[0]-=r,t[1]-=i,t[2]-=r,t[3]-=i,null!=e.size){const r=e.size/(e.frame.ymax-e.frame.ymin);t[0]*=r,t[1]*=r,t[2]*=r,t[3]*=r}}}else if("CIMPictureMarker"===o.type){const i=o,n=r.getResource(i.url);let s=1;if(null!=n&&n.height&&(s=n.width/n.height),null!=e.size){const r=e.size/2,n=e.size*s*i.scaleX/2;t=[-n,-r,n,r]}}else if(null!=e.size){const r=e.size/2;t=[-r,-r,r,r]}if(e.anchorPoint){let r,i;"Absolute"===e.anchorPointUnits?(r=e.anchorPoint.x,i=e.anchorPoint.y):(r=e.anchorPoint.x*(t[2]-t[0]),i=e.anchorPoint.y*(t[3]-t[1]));const n=1.25*Math.sqrt(r*r+i*i);t[0]-=n,t[1]-=n,t[2]+=n,t[3]+=n}let s=(0,_.$w)(e.rotation);if(e.rotateClockwise&&(s=-s),i&&(s-=i),s){const e=T*s,r=Math.cos(e),i=Math.sin(e),n=(0,c.vt)([y.MG,y.MG,-y.MG,-y.MG]);(0,c.tK)(n,[t[0]*r-t[1]*i,t[0]*i+t[1]*r]),(0,c.tK)(n,[t[0]*r-t[3]*i,t[0]*i+t[3]*r]),(0,c.tK)(n,[t[2]*r-t[1]*i,t[2]*i+t[1]*r]),(0,c.tK)(n,[t[2]*r-t[3]*i,t[2]*i+t[3]*r]),t=n}let a=(0,_.$w)(e.offsetX),l=(0,_.$w)(e.offsetY);if(i){const e=T*i,t=Math.cos(e),r=Math.sin(e),n=a*r+l*t;a=a*t-l*r,l=n}t[0]+=a,t[1]+=l,t[2]+=a,t[3]+=l;const u=P(e.markerPlacement);u>0&&(t[0]-=u,t[1]-=u,t[2]+=u,t[3]+=u);break}}const a=R(o.effects);a>0&&(t[0]-=a,t[1]-=a,t[2]+=a,t[3]+=a),s?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],s=!1):(e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[2]),e[3]=Math.max(e[3],t[3]))}return e}static _getTextInflatedSize(e,t,r){const i=(0,w.hV)(t.height??p.D.CIMTextSymbol.height);if(e[0]=-i/2,e[1]=-i/2,e[2]=i/2,e[3]=i/2,!r)return e;const n=r.get(t);if(!n)return e;if(!n.glyphMosaicItems.glyphs.length)return e;const{lineGapType:s,lineGap:o}=t,a=s?(0,f.QF)(s,o??0,i):0,l="CIMBackgroundCallout"===t.callout?.type,c=(0,b.Tl)(n.glyphMosaicItems,{scale:i/x.eG,angle:(0,_.$w)(t.angle),xOffset:(0,_.$w)(t.offsetX),yOffset:(0,_.$w)(t.offsetY),horizontalAlignment:t.horizontalAlignment,verticalAlignment:t.verticalAlignment,maxLineWidth:(0,w.Lu)(t.lineWidth),lineHeight:x.DY*Math.max(.25,Math.min(a||1,4)),decoration:t.font.decoration||"none",useCIMAngleBehavior:!0,hasBackground:l}).boundsT,u=Math.sqrt(c.width*c.width+c.height*c.height);return e[0]-=c.x+u,e[1]-=c.y-u,e[2]+=c.x+u,e[3]+=-c.y+u,e}}class L{static getEnvelope(e,t,r){if(!e)return null;const i=new f.mx(r);if(Array.isArray(e)){let r;for(const n of e)r?r.union(E(i,n,t)):r=E(i,n,t);return r}return E(i,e,t)}static getTextureAnchor(e,t){const r=this.getEnvelope(e,null,t);if(!r)return[0,0,0];const i=(r.x+.5*r.width)*I,n=(r.y+.5*r.height)*I,s=r.width*I+2,o=r.height*I+2;return[-i/s,-n/o,o]}static rasterize(e,t,r,i,n=!0,s){const o=r||this.getEnvelope(t,null,i);if(!o)return[null,0,0,0,0];const a=Math.max(o.width,o.height)*I;let l=null!=s?Math.max(s/a,1):1;l*=I;const c=(o.x+.5*o.width)*l,u=(o.y+.5*o.height)*l;e.width=o.width*l,e.height=o.height*l,r||(e.width+=2,e.height+=2);const h=e.getContext("2d",{willReadFrequently:!0}),p=f.IT.createScale(l,-l);p.translate(.5*e.width-c,.5*e.height+u);const m=new f.Rj(h,i,p);switch(t.type){case"CIMPointSymbol":{const e={type:"point",x:0,y:0};m.drawSymbol(t,e);break}case"CIMVectorMarker":{const e=new d.W;m.drawMarker(t,e);break}}const _=h.getImageData(0,0,e.width,e.height),g=new Uint8Array(_.data);if(n){let e;for(let t=0;t<g.length;t+=4)e=g[t+3]/255,g[t]=g[t]*e,g[t+1]=g[t+1]*e,g[t+2]=g[t+2]*e}return[g,e.width,e.height,-c/e.width,-u/e.height]}static fromTextSymbol(e){const{text:t}=e;return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPointUnits:"Relative",dominantSizeAxis3D:"Y",size:10,billboardMode3D:"FaceNearPlane",frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{x:0,y:0},symbol:L.createCIMTextSymbolfromTextSymbol(e),textString:t}],scaleSymbolsProportionally:!0,respectFrame:!0}],scaleX:1,angleAlignment:"Display"}}static fromPictureFillSymbol(e){const{height:t,outline:r,width:i,xoffset:n,xscale:s,yoffset:o,yscale:a}=e,l=[],c={type:"CIMPolygonSymbol",symbolLayers:l};if(r){const e=j(r);e&&l.push(e)}let u=e.url;"esriPFS"===e.type&&e.imageData&&(u=e.imageData);const h="angle"in e?e.angle??0:0,d=(i??0)*(s||1),f=(t??0)*(a||1);return l.push({type:"CIMPictureFill",invertBackfaceTexture:!1,scaleX:1,textureFilter:m.O$.Picture,tintColor:null,url:u,height:f,width:d,offsetX:(0,_.$w)(n),offsetY:(0,_.$w)(o),rotation:(0,_.$w)(-h),colorSubstitutions:null}),c}static fromSimpleFillSymbol(e){const{color:t,style:r,outline:i}=e,n=[],o={type:"CIMPolygonSymbol",symbolLayers:n};if(i){const e=j(i);e&&n.push(e)}if(r&&"solid"!==r&&"none"!==r&&"esriSFSSolid"!==r&&"esriSFSNull"!==r){const e={type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",color:U(t),capStyle:m.uT.Butt,joinStyle:m.wd.Miter,width:.75}]};let i=0;const o=(0,l.PN)(H(r)?8:10);switch(r){case"vertical":case"esriSFSVertical":i=90;break;case"forward-diagonal":case"esriSFSForwardDiagonal":case"diagonal-cross":case"esriSFSDiagonalCross":i=-45;break;case"backward-diagonal":case"esriSFSBackwardDiagonal":i=45;break;case"cross":case"esriSFSCross":i=0}n.push({type:"CIMHatchFill",lineSymbol:e,offsetX:0,offsetY:0,rotation:i,separation:o}),"cross"===r||"esriSFSCross"===r?n.push({type:"CIMHatchFill",lineSymbol:(0,s.o8)(e),offsetX:0,offsetY:0,rotation:90,separation:o}):"diagonal-cross"!==r&&"esriSFSDiagonalCross"!==r||n.push({type:"CIMHatchFill",lineSymbol:(0,s.o8)(e),offsetX:0,offsetY:0,rotation:45,separation:o})}else!r||"solid"!==r&&"esriSFSSolid"!==r||n.push({type:"CIMSolidFill",enable:!0,color:U(t)});return o}static fromSimpleLineSymbol(e){const{cap:t,color:r,join:i,marker:n,miterLimit:s,style:o,width:a}=e;let l=null;"solid"!==o&&"none"!==o&&"esriSLSSolid"!==o&&"esriSLSNull"!==o&&(l=[{type:"CIMGeometricEffectDashes",dashTemplate:q(o,t),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]);const c=[];if(n){let e;switch(n.placement){case"begin-end":e=m.$2.Both;break;case"begin":e=m.$2.JustBegin;break;case"end":e=m.$2.JustEnd;break;default:e=m.$2.None}const t=L.fromSimpleMarker(n,a,r).symbolLayers[0];t.markerPlacement={type:"CIMMarkerPlacementAtExtremities",placePerPart:!1,angleToLine:!0,offset:0,extremityPlacement:e,offsetAlongLine:0},c.push(t)}return c.push({type:"CIMSolidStroke",color:"none"!==o&&"esriSLSNull"!==o?U(r):[0,0,0,0],capStyle:N(t),joinStyle:O(i),miterLimit:s,width:a,effects:l}),{type:"CIMLineSymbol",symbolLayers:c}}static fromPictureMarker(e){const{angle:t,height:r,width:i,xoffset:n,yoffset:s}=e;let o=e.url;return"esriPMS"===e.type&&e.imageData&&(o=e.imageData),{type:"CIMPointSymbol",symbolLayers:[{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:m.O$.Picture,tintColor:null,url:o,size:r,width:i,offsetX:(0,_.$w)(n),offsetY:(0,_.$w)(s),rotation:(0,_.$w)(-t)}]}}static createCIMTextSymbolfromTextSymbol(e){const{angle:t,color:r,font:n,haloColor:s,haloSize:o,horizontalAlignment:a,kerning:l,lineWidth:c,text:u,verticalAlignment:h,xoffset:d,yoffset:f,backgroundColor:p,borderLineColor:g,borderLineSize:y}=e;let x,b,w,v,S,T;n&&(x=n.family,b=n.style,w=n.weight,v=n.size,S=n.decoration);let I=!1;return u&&(I=(0,i.y)(u)[1]),(p||y)&&(T={type:"CIMBackgroundCallout",margin:null,backgroundSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",color:U(p)},{type:"CIMSolidStroke",color:U(g),width:y}]},accentBarSymbol:null,gap:null,leaderLineSymbol:null,lineStyle:null}),{type:"CIMTextSymbol",angle:t,blockProgression:m.TZ.BTT,depth3D:1,extrapolateBaselines:!0,fontEffects:m.Y.Normal,fontEncoding:m.bj.Unicode,fontFamilyName:x||"Arial",fontStyleName:G(b,w),fontType:m.g7.Unspecified,haloSize:o,height:v,hinting:m.mU.Default,horizontalAlignment:D(a??"center"),kerning:l,letterWidth:100,ligatures:!0,lineGapType:"Multiple",lineWidth:c,offsetX:(0,_.$w)(d),offsetY:(0,_.$w)(f),strikethrough:"line-through"===S,underline:"underline"===S,symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:U(r)}]},haloSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:U(s)}]},shadowColor:[0,0,0,255],shadowOffsetX:1,shadowOffsetY:1,textCase:"Normal",textDirection:I?m.f0.RTL:m.f0.LTR,verticalAlignment:z(h??"baseline"),verticalGlyphOrientation:m.vG.Right,wordSpacing:100,billboardMode3D:m.xn.FaceNearPlane,callout:T}}static createPictureMarkerRasterizationParam(e){const{angle:t,height:r,width:i,xoffset:n,yoffset:s}=e,o=e.url??e.source?.url??e.source?.imageData;return o?{type:"sprite-rasterization-param",overrides:[],resource:{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:m.O$.Picture,tintColor:null,url:o,size:r,width:i,offsetX:(0,_.$w)(n),offsetY:(0,_.$w)(s),rotation:(0,_.$w)(-t)}}:null}static createPictureFillRasterizationParam(e){const{width:t,height:r,xoffset:i,yoffset:n,url:s}=e;return s?{type:"sprite-rasterization-param",overrides:[],resource:{type:"CIMPictureFill",scaleX:1,textureFilter:m.O$.Picture,tintColor:null,url:s,width:t,height:r,offsetX:(0,_.$w)(i),offsetY:(0,_.$w)(n),rotation:0}}:null}static fromSimpleMarker(e,t,r){const{style:i}=e,n=e.color??r;if("path"===i||"esriSMSPath"===i){const t=[];if("outline"in e&&e.outline){const r=e.outline;t.push({type:"CIMSolidStroke",enable:!0,width:r.width,color:U(r.color),path:e.path})}t.push({type:"CIMSolidFill",enable:!0,color:U(n),path:e.path});const[r,i]=Z("square");return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:-(0,_.$w)(e.angle),size:(0,_.$w)(e.size||6),offsetX:(0,_.$w)(e.xoffset),offsetY:(0,_.$w)(e.yoffset),scaleSymbolsProportionally:!1,frame:r,markerGraphics:[{type:"CIMMarkerGraphic",geometry:i,symbol:{type:"CIMPolygonSymbol",symbolLayers:t}}]}]}}const s=[];let o,a,l=e.size;if("outline"in e&&e.outline&&"none"!==e.outline.style&&"esriSLSNull"!==e.outline.style){const t=e.outline,r="solid"!==t.style&&"esriSLSSolid"!==t.style;[o,a]=r?Z(i,e.size):Z(i);const n=t.width??g.A7.width;if(r){const t=n/e.size,r=(o.xmax-o.xmin)*t/2,i=(o.ymax-o.ymin)*t/2;o.xmin-=r,o.xmax+=r,o.ymin-=i,o.ymax+=i,l&&(l+=n)}const c="cross"!==e.style&&"x"!==e.style||"dot"===e?.outline.style||"short-dot"===e?.outline.style?m.yS.HalfGap:m.yS.FullPattern,u=r?[{type:"CIMGeometricEffectAddControlPoints"},{type:"CIMGeometricEffectDashes",dashTemplate:q(t.style,null).map((e=>t.width&&t.width>0?e*t.width:e)),lineDashEnding:c,controlPointEnding:m.yS.FullPattern}]:void 0;s.push({type:"CIMSolidStroke",capStyle:r?m.uT.Round:m.uT.Butt,enable:!0,width:n,color:U(t.color),effects:u})}else!t||"line-marker"!==e.type||"cross"!==e.style&&"x"!==e.style?[o,a]=Z(i):([o,a]=Z(i),s.push({type:"CIMSolidStroke",enable:!0,width:t,color:U(n)}));s.push({type:"CIMSolidFill",enable:!0,color:U(n)});const c={type:"CIMPolygonSymbol",symbolLayers:s};return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:(0,_.$w)(-e.angle),size:(0,_.$w)(l||6*t),offsetX:(0,_.$w)(e.xoffset),offsetY:(0,_.$w)(e.yoffset),scaleSymbolsProportionally:!1,frame:o,markerGraphics:[{type:"CIMMarkerGraphic",geometry:a,symbol:c}]}]}}static fromCIMHatchFill(e,t){const r=t*(e.separation??p.D.CIMHatchFill.separation),i=r/2,n=(0,s.o8)(e.lineSymbol);n.symbolLayers?.forEach((e=>{switch(e.type){case"CIMSolidStroke":null!=e.width&&(e.width*=t),e.effects?.forEach((e=>{if("CIMGeometricEffectDashes"===e.type){const r=e.dashTemplate;e.dashTemplate=r?.map((e=>e*t))}}));break;case"CIMVectorMarker":{null!=e.size&&(e.size*=t);const r=e.markerPlacement;null!=r&&"placementTemplate"in r&&(r.placementTemplate=r.placementTemplate.map((e=>e*t)));break}}}));let o=this._getLineSymbolPeriod(n)||4;for(;o<4;)o*=2;const a=o/2;return{type:"CIMVectorMarker",frame:{xmin:-a,xmax:a,ymin:-i,ymax:i},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[-a,0],[a,0]]]},symbol:n}],size:r}}static fetchResources(e,t,r,i=null){return e&&t?(k(e,(e=>{(function(e,t,r){e.effects&&null==t.geometryEngine&&(t.geometryEnginePromise?r.push(t.geometryEnginePromise):(0,_.yH)(e.effects)&&(t.geometryEnginePromise=(0,_._H)(),r.push(t.geometryEnginePromise),t.geometryEnginePromise.then((e=>t.geometryEngine=e))))})(e,t,r),"url"in e&&e.url&&r.push(t.fetchResource(e.url,{signal:i}))})),r):r}static fetchFonts(e,t,r){if(e&&t)if("symbolLayers"in e&&e.symbolLayers){for(const i of e.symbolLayers)if("CIMVectorMarker"===i.type&&i.markerGraphics)for(const e of i.markerGraphics)e?.symbol&&L.fetchFonts(e.symbol,t,r)}else if("CIMTextSymbol"===e.type){const{fontFamilyName:i,fontStyleName:n}=e;if(!i||"calcitewebcoreicons"===i.toLowerCase())return;const{style:s,weight:o}=(0,_._d)(n),a=(0,_.DW)(e),l=new h.A({family:i,style:s,weight:o,decoration:a});r.push(t.loadFont(l).catch((()=>{M().error(`Unsupported font ${i} in CIM symbol`)})))}}static _getLineSymbolPeriod(e){if(e){const t=this._getEffectsRepeat(e.effects);if(t)return t;if(e.symbolLayers)for(const t of e.symbolLayers)if(t){const e=this._getEffectsRepeat(t.effects);if(e)return e;switch(t.type){case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":{const e=this._getPlacementRepeat(t.markerPlacement);if(e)return e}}}}return 0}static _getEffectsRepeat(e){if(e)for(const t of e)if(t)switch(t.type){case"CIMGeometricEffectDashes":{const e=t.dashTemplate;if(e&&e.length){let t=0;for(const r of e)t+=r;return 1&e.length&&(t*=2),t}break}case"CIMGeometricEffectWave":return t.period;default:M().error(`unsupported geometric effect type ${t.type}`)}return 0}static _getPlacementRepeat(e){if(e)switch(e.type){case"CIMMarkerPlacementAlongLineSameSize":case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineVariableSize":{const t=e.placementTemplate;if(t&&t.length){let e=0;for(const r of t)e+=+r;return 1&t.length&&(e*=2),e}break}}return 0}static fromCIMInsidePolygon(e){const t=e.markerPlacement,r={...e};r.markerPlacement=null,r.anchorPoint=null;const i=Math.abs(t.stepX),n=Math.abs(t.stepY),s=(t.randomness??100)/100;let o,c,u,h;if("Random"===t.gridType){const e=(0,l.PN)(x.yv),r=Math.max(Math.floor(e/i),1),d=Math.max(Math.floor(e/n),1);o=r*i/2,c=d*n/2,u=2*c;const f=new a.A(t.seed),p=s*i/1.5,m=s*n/1.5;h=[];for(let e=0;e<r;e++)for(let t=0;t<d;t++){const r=e*i-o+p*(.5-f.getFloat()),s=t*n-c+m*(.5-f.getFloat());h.push({x:r,y:s}),0===e&&h.push({x:r+2*o,y:s}),0===t&&h.push({x:r,y:s+2*c})}}else!0===t.shiftOddRows?(o=i/2,c=n,u=2*n,h=[{x:-o,y:0},{x:o,y:0},{x:0,y:c},{x:0,y:-c}]):(o=i/2,c=n/2,u=n,h=[{x:-i,y:0},{x:0,y:-n},{x:-i,y:-n},{x:0,y:0},{x:i,y:0},{x:0,y:n},{x:i,y:n},{x:-i,y:n},{x:i,y:-n}]);return{type:"CIMVectorMarker",frame:{xmin:-o,xmax:o,ymin:-c,ymax:c},markerGraphics:h.map((e=>({type:"CIMMarkerGraphic",geometry:e,symbol:{type:"CIMPointSymbol",symbolLayers:[r]}}))),size:u}}}function k(e,t){if(e)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const r=e.symbolLayers;if(!r)return;for(const e of r)if(t(e),"CIMVectorMarker"===e.type){const r=e.markerGraphics;if(!r)continue;for(const e of r)if(e){const r=e.symbol;r&&k(r,t)}}break}}}const N=e=>{if(!e)return m.uT.Butt;switch(e){case"butt":return m.uT.Butt;case"square":return m.uT.Square;case"round":return m.uT.Round}},O=e=>{if(!e)return m.wd.Miter;switch(e){case"miter":return m.wd.Miter;case"round":return m.wd.Round;case"bevel":return m.wd.Bevel}},D=e=>{if(null==e)return"Center";switch(e){case"left":return"Left";case"right":return"Right";case"center":return"Center"}},z=e=>{if(null==e)return"Center";switch(e){case"baseline":return"Baseline";case"top":return"Top";case"middle":return"Center";case"bottom":return"Bottom"}},U=e=>{if(!e)return[0,0,0,0];const{r:t,g:r,b:i,a:n}=e;return[t,r,i,255*n]},G=(e,t)=>{const r=B(t),i=V(e);return r&&i?`${r}-${i}`:`${r}${i}`},B=e=>{if(!e)return"";switch(e.toLowerCase()){case"bold":case"bolder":return"bold"}return""},V=e=>{if(!e)return"";switch(e.toLowerCase()){case"italic":case"oblique":return"italic"}return""},q=(e,t)=>{const r=(0,n.A)("safari")?.001:0,i="butt"===t;switch(e){case"dash":case"esriSLSDash":return i?[4,3]:[3,4];case"dash-dot":case"esriSLSDashDot":return i?[4,3,1,3]:[3,4,r,4];case"dot":case"esriSLSDot":return i?[1,3]:[r,4];case"long-dash":case"esriSLSLongDash":return i?[8,3]:[7,4];case"long-dash-dot":case"esriSLSLongDashDot":return i?[8,3,1,3]:[7,4,r,4];case"long-dash-dot-dot":case"esriSLSDashDotDot":return i?[8,3,1,3,1,3]:[7,4,r,4,r,4];case"short-dash":case"esriSLSShortDash":return i?[4,1]:[3,2];case"short-dash-dot":case"esriSLSShortDashDot":return i?[4,1,1,1]:[3,2,r,2];case"short-dash-dot-dot":case"esriSLSShortDashDotDot":return i?[4,1,1,1,1,1]:[3,2,r,2,r,2];case"short-dot":case"esriSLSShortDot":return i?[1,1]:[r,2];case"solid":case"esriSLSSolid":case"none":return M().error("Unexpected: style does not require rasterization"),[0,0];default:return M().error(`Tried to rasterize SLS, but found an unexpected style: ${e}!`),[0,0]}},Z=(e,t=100)=>{const r=t/2;let i,n;const s=e;if("circle"===s||"esriSMSCircle"===s){const e=.25;let t=Math.acos(1-e/r),s=Math.ceil(v/t/4);0===s&&(s=1),t=S/s,s*=4;const o=[];o.push([r,0]);for(let e=1;e<s;e++)o.push([r*Math.cos(e*t),-r*Math.sin(e*t)]);o.push([r,0]),i={rings:[o]},n={xmin:-r,ymin:-r,xmax:r,ymax:r}}else if("cross"===s||"esriSMSCross"===s){const e=0;i={paths:[[[e,r],[e,-r]],[[r,e],[-r,e]]]},n={xmin:-r,ymin:-r,xmax:r,ymax:r}}else if("diamond"===s||"esriSMSDiamond"===s)i={rings:[[[-r,0],[0,r],[r,0],[0,-r],[-r,0]]]},n={xmin:-r,ymin:-r,xmax:r,ymax:r};else if("square"===s||"esriSMSSquare"===s)i={rings:[[[-r,-r],[-r,r],[r,r],[r,-r],[-r,-r]]]},n={xmin:-r,ymin:-r,xmax:r,ymax:r};else if("x"===s||"esriSMSX"===s)i={paths:[[[r,r],[-r,-r]],[[r,-r],[-r,r]]]},n={xmin:-r,ymin:-r,xmax:r,ymax:r};else if("triangle"===s||"esriSMSTriangle"===s){const e=.5773502691896257*t,r=-e,s=2/3*t,o=s-t;i={rings:[[[r,o],[0,s],[e,o],[r,o]]]},n={xmin:r,ymin:o,xmax:e,ymax:s}}else"arrow"===s&&(i={rings:[[[-50,50],[50,0],[-50,-50],[-33,-20],[-33,20],[-50,50]]]},n={xmin:-r,ymin:-r,xmax:r,ymax:r});return[n,i]},H=e=>"vertical"===e||"horizontal"===e||"cross"===e||"esriSFSCross"===e||"esriSFSVertical"===e||"esriSFSHorizontal"===e;function j(e){if(!e)return null;let t=null;const{cap:r,color:i,join:n,miterLimit:s,style:o,width:a}=e;return"solid"!==o&&"none"!==o&&"esriSLSSolid"!==o&&"esriSLSNull"!==o&&(t=[{type:"CIMGeometricEffectDashes",dashTemplate:q(o,r),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]),{type:"CIMSolidStroke",color:"esriSLSNull"!==o&&"none"!==o?U(i):[0,0,0,0],capStyle:N(r),joinStyle:O(n),miterLimit:s,width:a,effects:t}}},93996:function(e,t,r){r.d(t,{I:function(){return o},U:function(){return s}});var i=r(33134),n=r(33389);const s=.03;class o{constructor(e=0,t=!1){}isEmpty(e){if(!e.nextPoint())return!0;let t,r,i,n;for(t=e.x,r=e.y;e.nextPoint();t=r,r=n)if(i=e.x,n=e.y,i!==t||n!==r)return e.seekPathStart(),!1;return e.seekPathStart(),!0}normalize(e){const t=Math.sqrt(e[0]*e[0]+e[1]*e[1]);0!==t&&(e[0]/=t,e[1]/=t)}getLength(e,t,r,i){const n=r-e,s=i-t;return Math.sqrt(n*n+s*s)}getSegLength(e){const[[t,r],[i,n]]=e;return this.getLength(t,r,i,n)}getCoord2D(e,t,r,i,n){return[e+(r-e)*n,t+(i-t)*n]}getSegCoord2D(e,t){const[[r,i],[n,s]]=e;return this.getCoord2D(r,i,n,s,t)}getAngle(e,t,r,i,n){const s=r-e,o=i-t;return Math.atan2(o,s)}getAngleCS(e,t,r,i,n){const s=r-e,o=i-t,a=Math.sqrt(s*s+o*o);return a>0?[s/a,o/a]:[1,0]}getSegAngleCS(e,t){const[[r,i],[n,s]]=e;return this.getAngleCS(r,i,n,s,t)}cut(e,t,r,i,n,s){return[n<=0?[e,t]:this.getCoord2D(e,t,r,i,n),s>=1?[r,i]:this.getCoord2D(e,t,r,i,s)]}getSubCurve(e,t,r){const n=i.z.createEmptyOptimizedCIM("esriGeometryPolyline");return this.appendSubCurve(n,e,t,r)?n:null}appendSubCurve(e,t,r,i){e.startPath(),t.seekPathStart();let n=0,s=!0;if(!t.nextPoint())return!1;let o=t.x,a=t.y;for(;t.nextPoint();){const l=this.getLength(o,a,t.x,t.y);if(0!==l){if(s){if(n+l>r){const c=(r-n)/l;let u=1,h=!1;n+l>=i&&(u=(i-n)/l,h=!0);const d=this.cut(o,a,t.x,t.y,c,u);if(d&&e.pushPoints(d),h)break;s=!1}}else{if(n+l>i){const r=this.cut(o,a,t.x,t.y,0,(i-n)/l);r&&e.pushPoint(r[1]);break}e.pushXY(t.x,t.y)}n+=l,o=t.x,a=t.y}else o=t.x,a=t.y}return!0}getCIMPointAlong(e,t){if(!e.nextPoint())return null;let r,i,n,s,o=0;for(r=e.x,i=e.y;e.nextPoint();r=n,i=s){n=e.x,s=e.y;const a=this.getLength(r,i,n,s);if(0!==a){if(o+a>t){const e=(t-o)/a;return this.getCoord2D(r,i,n,s,e)}o+=a}}return null}offset(e,t,r,i,s){if(!e||e.length<2)return null;let o=0,a=e[o++],l=o;for(;o<e.length;){const t=e[o];t[0]===a[0]&&t[1]===a[1]||(o!==l&&(e[l]=e[o]),a=e[l++]),o++}const c=e[0][0]===e[l-1][0]&&e[0][1]===e[l-1][1];if(c&&--l,l<(c?3:2))return null;const u=[];a=c?e[l-1]:null;let h=e[0];for(let s=0;s<l;s++){const o=s===l-1?c?e[0]:null:e[s+1];if(a)if(o){const e=[o[0]-h[0],o[1]-h[1]];this.normalize(e);const s=[h[0]-a[0],h[1]-a[1]];this.normalize(s);const l=s[0]*e[1]-s[1]*e[0],c=s[0]*e[0]+s[1]*e[1];if(0===l&&1===c){h=o;continue}if(l>=0==t<=0){if(c<1){const r=[e[0]-s[0],e[1]-s[1]];this.normalize(r);const n=Math.sqrt((1+c)/2);if(n>1/i){const e=-Math.abs(t)/n;u.push([h[0]-r[0]*e,h[1]-r[1]*e])}}}else switch(r){case n.xw.Mitered:{const r=Math.sqrt((1+c)/2);if(r>0&&1/r<i){const i=[e[0]-s[0],e[1]-s[1]];this.normalize(i);const n=Math.abs(t)/r;u.push([h[0]-i[0]*n,h[1]-i[1]*n]);break}}case n.xw.Bevelled:u.push([h[0]+s[1]*t,h[1]-s[0]*t]),u.push([h[0]+e[1]*t,h[1]-e[0]*t]);break;case n.xw.Rounded:if(c<1){u.push([h[0]+s[1]*t,h[1]-s[0]*t]);const r=Math.floor(2.5*(1-c));if(r>0){const i=1/r;let n=i;for(let o=1;o<r;o++,n+=i){const r=[s[1]*(1-n)+e[1]*n,-s[0]*(1-n)-e[0]*n];this.normalize(r),u.push([h[0]+r[0]*t,h[1]+r[1]*t])}}u.push([h[0]+e[1]*t,h[1]-e[0]*t])}break;case n.xw.Square:default:if(l<0)u.push([h[0]+(s[1]+s[0])*t,h[1]+(s[1]-s[0])*t]),u.push([h[0]+(e[1]-e[0])*t,h[1]-(e[0]+e[1])*t]);else{const r=Math.sqrt((1+Math.abs(c))/2),i=[e[0]-s[0],e[1]-s[1]];this.normalize(i);const n=t/r;u.push([h[0]-i[0]*n,h[1]-i[1]*n])}}}else{const e=[h[0]-a[0],h[1]-a[1]];this.normalize(e),u.push([h[0]+e[1]*t,h[1]-e[0]*t])}else{const e=[o[0]-h[0],o[1]-h[1]];this.normalize(e),u.push([h[0]+e[1]*t,h[1]-e[0]*t])}a=h,h=o}return u.length<(c?3:2)?null:(c&&u.push([u[0][0],u[0][1]]),u)}}},65661:function(e,t,r){r.d(t,{VA:function(){return a},YQ:function(){return i},Z1:function(){return u},ps:function(){return l}});var i,n,s=r(33134),o=r(93996);class a{constructor(){this._values=[],this.extPtGap=0,this.ctrlPtGap=0,this._length=0,this._currentValue=0}isEmpty(){return 0===this._values.length}size(){return this._values.length}init(e,t,r=!0){if(this._setEmpty(),!e||0===e.length)return!1;for(let t=0;t<e.length;t++){let i=Math.abs(e[t]);r&&i<1e-7&&(i=1e-7),this._values.push(i),this._length+=i}return t&&1&e.length&&(this._length*=2),0!==this._length&&(this.ctrlPtGap=this.extPtGap=0,this._currentValue=-1,!0)}scale(e){const t=this._values?this._values.length:0;for(let r=0;r<t;++r)this._values[r]*=e;this._length*=e,this.extPtGap*=e,this.ctrlPtGap*=e}addValue(e){this._length+=e,this._values.push(e)}firstValue(){return this._values[0]}lastValue(){return this._values[this._values.length-1]}nextValue(){return this._currentValue++,this._currentValue===this._values.length&&(this._currentValue=0),this._values[this._currentValue]}reset(){this._currentValue=-1}length(){return this._length}_setEmpty(){this.extPtGap=this.ctrlPtGap=this._length=0,this._currentValue=-1,this._values.length=0}}class l{constructor(){this.pt=null,this.ca=0,this.sa=0}}(n=i||(i={}))[n.FAIL=0]="FAIL",n[n.END=1]="END",n[n.CONTINUE=2]="CONTINUE";class c{constructor(){this.reset()}reset(){this.segment=null,this.segmentLength=0,this.abscissa=0,this.isPathEnd=!1,this.isPartEnd=!1}isValid(){return null!==this.segment}copyTo(e){e.segment=this.segment,e.segmentLength=this.segmentLength,e.abscissa=this.abscissa,e.isPathEnd=this.isPathEnd,e.isPartEnd=this.isPartEnd}}class u extends o.I{constructor(e=0,t=!1){super(e,t),this._tolerance=o.U,this._currentPosition=new c}updateTolerance(e){this._tolerance=o.U*e}init(e,t,r=!0){return r?(this._patternLength=t.length(),this._partExtPtGap=t.extPtGap,this._partCtrlPtGap=t.ctrlPtGap):(this._patternLength=0,this._partExtPtGap=0,this._partCtrlPtGap=0),this._currentPosition.reset(),this._partSegCount=0,this._pathCursor=e,this._seg=-1,this._setPosAtNextPart()}curPositionIsValid(){return this._currentPosition.isValid()}nextPosition(e,t=i.FAIL){const r=new c;return!!this._nextPosition(e,r,null,t)&&(r.copyTo(this._currentPosition),!0)}curPointAndAngle(e){e.pt=this._getPoint(this._currentPosition);const[t,r]=this._getAngleCS(this._currentPosition);e.ca=t,e.sa=r}nextPointAndAngle(e,t,r=i.FAIL){const n=new c;if(!this._nextPosition(e,n,null,r))return!1;n.copyTo(this._currentPosition),t.pt=this._getPoint(n);const[s,o]=this._getAngleCS(n);return t.ca=s,t.sa=o,!0}nextCurve(e){if(0===e)return null;const t=s.z.createEmptyOptimizedCIM("esriGeometryPolyline");t.startPath(),t.nextPath();const r=new c;return this._nextPosition(e,r,t,i.END)?(r.copyTo(this._currentPosition),t):null}isPathEnd(){return this._currentPosition.isPathEnd}getPathEnd(){return this._currentPosition.segment[1]}getPt(e){return this._pathCursor.seekInPath(e),[this._pathCursor.x,this._pathCursor.y]}getSeg(e){return[this.getPt(e),this.getPt(e+1)]}_nextPosition(e,t,r,n){if(this._currentPosition.isPathEnd)return!1;let s=this._currentPosition.abscissa;for(this._currentPosition.segmentLength>0&&(s/=this._currentPosition.segmentLength),this._currentPosition.copyTo(t);t.abscissa+e*this._partLengthRatio>t.segmentLength+this._tolerance;){if(r){if(0===r.pathSize)if(0===s){const e=t.segment[0];r.pushXY(e[0],e[1])}else r.pushPoint(this.getSegCoord2D(t.segment,s));const e=t.segment[1];r.pushXY(e[0],e[1])}if(s=0,e-=(t.segmentLength-t.abscissa)/this._partLengthRatio,this._partSegCount)t.segment=this._nextSegment(),t.segmentLength=this.getSegLength(t.segment),t.abscissa=0,this._partSegCount--;else{if(!this._setPosAtNextPart())return n!==i.FAIL&&(t.segmentLength=this.getSegLength(t.segment),t.isPartEnd=!0,n===i.END?(t.abscissa=t.segmentLength,t.isPathEnd=!0):t.abscissa=t.segmentLength+e,!0);this._currentPosition.copyTo(t)}}if(t.abscissa+=e*this._partLengthRatio,r){0===r.pathSize&&(0===s?r.pushPoint(t.segment[0]):r.pushPoint(this.getSegCoord2D(t.segment,s)));const e=t.abscissa/t.segmentLength;1===e?r.pushPoint(t.segment[1]):r.pushPoint(this.getSegCoord2D(t.segment,e))}return this._partSegCount||Math.abs(t.abscissa-t.segmentLength)<this._tolerance&&(t.isPathEnd=this._partIsLast,t.isPartEnd=!0),!0}_getPoint(e){const t=e.segmentLength<=0?0:e.abscissa/e.segmentLength;return this.getSegCoord2D(this._currentPosition.segment,t)}_getAngleCS(e){const t=e.segmentLength<=0?0:e.abscissa/e.segmentLength;return this.getSegAngleCS(this._currentPosition.segment,t)}_setPosAtNextPart(){for(;this._partSegCount;)this._hasNextSegment()&&this._nextSegment(),this._partSegCount--;if(!this._hasNextSegment())return!1;for(this._partLength=0,this._partIsLast=!0,this._partSegCount=0;this._hasNextSegment();)if(this._partLength+=this.getSegLength(this._nextSegment()),this._partSegCount++,this._pathCursor.getControlPointAt(this._getEndPointIndex())){this._partIsLast=!this._hasNextSegment();break}let e=this._partSegCount;for(;e;)this._previousSegment(),--e;this._currentPosition.segment=this._nextSegment(),this._currentPosition.segmentLength=this.getSegLength(this._currentPosition.segment),this._currentPosition.abscissa=0,this._currentPosition.isPathEnd=this._currentPosition.isPartEnd=!1,--this._partSegCount;const t=this._getStartPointIndex();this._ctrlPtBegin=this._pathCursor.getControlPointAt(t);let r=t+this._partSegCount+1;if(r>=this._pathCursor.pathSize&&(r=0),this._ctrlPtEnd=this._pathCursor.getControlPointAt(r),this._patternLength>0){const e=this._ctrlPtBegin?this._partCtrlPtGap:this._partExtPtGap,t=this._ctrlPtEnd?this._partCtrlPtGap:this._partExtPtGap;let r=Math.round((this._partLength-(e+t))/this._patternLength);r<=0&&(r=e+t>0?0:1),this._partLengthRatio=this._partLength/(e+t+r*this._patternLength),this._partLengthRatio<.01&&(this._partLengthRatio=1)}else this._partLengthRatio=1;return!0}_hasNextSegment(){return this._seg<this._pathCursor.pathSize-2}_previousSegment(){return this.getSeg(--this._seg)}_nextSegment(){return this.getSeg(++this._seg)}_getStartPointIndex(){return this._seg}_getEndPointIndex(){return this._seg+1}}},82497:function(e,t,r){r.d(t,{A:function(){return i}});class i{constructor(e=0,t=0,r=0,i=0){this.x=e,this.y=t,this.width=r,this.height=i}static fromExtent(e){return new i(e.xmin,-e.ymax,e.xmax-e.xmin,e.ymax-e.ymin)}get isEmpty(){return this.width<=0||this.height<=0}union(e){this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.width=Math.max(this.width,e.width),this.height=Math.max(this.height,e.height)}}},2014:function(e,t,r){r.d(t,{$o:function(){return i},$u:function(){return o},gR:function(){return s},zA:function(){return n}});const i=15.5,n=4,s=64,o=1024},38821:function(e,t,r){r.d(t,{D:function(){return s},K:function(){return n}});var i=r(33389);const n={color:[128,128,128,1],outlinecolor:[0,0,0,1],backgroundcolor:[128,128,128,1],borderlinecolor:[0,0,0,1],tintcolor:[255,255,255,1]},s={CIMVectorMarker:{scalesymbolsproportionally:!1,respectframe:!0,anchorpointunits:"Relative",offsetx:0,offsety:0,rotateclockwise:!1,rotation:0,size:10,enable:!0,colorlocked:!1},CIMPictureMarker:{scalex:1,texturefilter:"Draft",anchorpointunits:"Relative",offsetx:0,offsety:0,rotateclockwise:!1,rotation:0,size:10,enable:!0,colorlocked:!1},CIMTextSymbol:{angle:0,anglex:0,angley:0,halosize:1,height:10,horizontalalignment:"Left",kerning:!0,letterspacing:0,letterwidth:100,ligatures:!0,linegap:0,offsetx:0,offsety:0,strikethrough:!1,textcase:"Normal",textstring:"",underline:!1,verticalalignment:"Bottom",enable:!0,colorlocked:!1},CIMSolidStroke:{capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMPictureStroke:{texturefilter:"Draft",capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMGradientStroke:{capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMSolidFill:{enable:!0,colorlocked:!1},CIMPictureFill:{offsetx:0,offsety:0,rotation:0,scalex:1,height:10,texturefilter:"Draft",enable:!0,colorlocked:!1},CIMHatchFill:{offsetx:0,offsety:0,rotation:0,separation:4,enable:!0,colorlocked:!1},CIMGeometricEffectAddControlPoints:{angletolerance:120},CIMGeometricEffectArrow:{arrowtype:"OpenEnded",width:5},CIMGeometricEffectBuffer:{size:1},CIMGeometricEffectCut:{begincut:1,endcut:1,middlecut:0,invert:!1},CIMGeometricEffectDashes:{customendingoffset:0,linedashending:"NoConstraint",offsetalongline:0},CIMGeometricEffectDonut:{method:"Mitered",option:"Accurate",width:2},CIMGeometricEffectJog:{angle:225,length:20,position:50},CIMGeometricEffectControlMeasureLine:{rule:"FullGeometry"},CIMGeometricEffectMove:{offsetx:1,offsety:-1},CIMGeometricEffectOffset:{method:"Square",offset:1,option:"Fast"},CIMGeometricEffectRotate:{angle:15},CIMGeometricEffectScale:{xscalefactor:1.15,yscalefactor:1.15},CIMGeometricEffectWave:{amplitude:2,period:3,seed:1,waveform:"Sinus"},CIMMarkerPlacementAlongLine:{customendingoffset:0,endings:"WithHalfGap",offsetalongline:0,placeperpart:!0,angletoline:!0,offset:0},CIMMarkerPlacementAtExtremities:{extremityplacement:"Both",offsetalongline:0,angletoline:!0,offset:0},CIMMarkerPlacementAtRatioPositions:{beginposition:0,endposition:0,flipfirst:!0,angletoline:!0,offset:0},CIMMarkerPlacementInsidePolygon:{gridangle:0,gridtype:"Fixed",offsetx:0,offsety:0,randomness:100,seed:0,shiftoddrows:!1,stepx:16,stepy:16,clipping:"ClipAtBoundary"},CIMMarkerPlacementOnLine:{relativeto:"LineMiddle",startpointoffset:0,angletoline:!0,offset:0},CIMMarkerPlacementOnVertices:{placeperpart:!0,placeoncontrolpoints:!0,placeonendpoints:!0,placeonregularvertices:!0,angletoline:!0,offset:0},CIMMarkerPlacementPolygonCenter:{method:"OnPolygon",offsetx:0,offsety:0,clipatboundary:!1},CIMAnimatedSymbolProperties:{playanimation:!1,reverseanimation:!1,randomizestarttime:!1,randomizestartseed:0,starttimeoffset:0,duration:3,endingduration:3,useendingduration:!1,repeattype:i.fu.Loop,repeatdelay:0,easing:i.Hz.Linear},CIMSymbolAnimationSize:{tosize:10},CIMSymbolAnimationScale:{scalefactor:1},CIMSymbolAnimationColor:{tocolor:[255,255,255,1]},CIMSymbolAnimationTransparency:{totransparency:0},CIMSymbolAnimationRotation:{torotation:0},CIMSymbolAnimationOffset:{offsetx:0,offsety:0}}},47072:function(e,t,r){r.d(t,{V:function(){return c}});var i=r(33134),n=r(49077),s=r(62096),o=r(9635),a=r(57176);const l=96/72;class c{static executeEffects(e,t,r,i){const n=l,c=(0,a.ll)(e);let u=new s.k(t);for(const t of e){const e=(0,o.A)(t);e&&(u=e.execute(u,t,n,r,i,c))}return u}static applyEffects(e,t,r){if(!e)return t;const l=(0,a.ll)(e);let c,u=new s.k(i.z.fromJSONCIM(t));for(const t of e){const e=(0,o.A)(t);e&&(u=e.execute(u,t,1,null,r,l))}const h=[];let d=null;for(;c=u.next();)h.push(...(0,n.x)(c)),d=c.geometryType;return 0===h.length||null===d?null:"esriGeometryPolygon"===d?{rings:h}:{paths:h}}}},63514:function(e,t,r){r.d(t,{N:function(){return i}});class i{static local(){return null===i.instance&&(i.instance=new i),i.instance}execute(e,t,r,i,s){return new n(e,t,r)}}i.instance=null;class n{constructor(e,t,r){this._inputGeometries=e,this._angleTolerance=void 0!==t.angleTolerance?t.angleTolerance:120,this._maxCosAngle=Math.cos((1-Math.abs(this._angleTolerance)/180)*Math.PI)}next(){let e=this._inputGeometries.next();for(;e;){if("esriGeometryPolygon"===e.geometryType)this._isClosed=!0;else if("esriGeometryPolyline"===e.geometryType)this._isClosed=!1;else{if("esriGeometryEnvelope"!==e.geometryType){e=this._inputGeometries.next();continue}if(this._maxCosAngle)return e;this._isClosed=!0}for(;e.nextPath();)this._processPath(e);return e.reset(),e}return null}_processPath(e){if(e.nextPoint()){const t=e.x,r=e.y;let i=t,n=r,s=e.pathSize,o=0,a=0,l=0,c=0,u=0,h=0;this._isClosed&&++s;for(let d=1;e.nextPoint()||d<s;++d){let f,p;this._isClosed&&d===s-1?(f=t,p=r):(f=e.x,p=e.y);const m=f-i,_=p-n,g=Math.sqrt(m*m+_*_);d>1&&g>0&&l>0&&(o*m+a*_)/g/l<=this._maxCosAngle&&e.setControlPointAt(d-1),1===d&&(c=m,u=_,h=g),g>0&&(i=f,n=p,o=m,a=_,l=g)}this._isClosed&&l>0&&h>0&&(o*c+a*u)/h/l<=this._maxCosAngle&&e.setControlPointAt(0)}}}},82112:function(e,t,r){r.d(t,{B:function(){return u}});var i=r(33134),n=r(49077),s=r(23454),o=r(93996),a=r(33389);const l=1.7320508075688772,c=a.oF.OpenEnded;class u{static local(){return null===u.instance&&(u.instance=new u),u.instance}execute(e,t,r,i,n){return new h(e,t,r)}}u.instance=null;class h extends s.rx{constructor(e,t,r){super(e,!1,!0),this._curveHelper=new o.I,this._width=(void 0!==t.width?t.width:5)*r,this._arrowType=void 0!==t.geometricEffectArrowType?t.geometricEffectArrowType:void 0!==t.arrowType?t.arrowType:c,this._offsetFlattenError=o.U*r}processPath(e){const t=i.z.createEmptyOptimizedCIM(e.geometryType);switch(this._arrowType){case a.oF.OpenEnded:default:this._constructSimpleArrow(t,e,!0);break;case a.oF.Block:this._constructSimpleArrow(t,e,!1);break;case a.oF.Crossed:this._constructCrossedArrow(t,e)}return t}_constructSimpleArrow(e,t,r){const i=t.pathLength();let s=this._width;i<2*s&&(s=i/2);const o=this._curveHelper.getSubCurve(t,0,i-s);if(!o||!o.nextPath())return;o.seekPathStart();const a=s/2;if(this._curveHelper.isEmpty(o))return;const l=(0,n.A)(o),c=this._constructOffset(l,-a);if(!c)return;const u=this._constructOffset(l,a);if(!u)return;const h=this._constructArrowBasePoint(c,-a/2);if(!h)return;const d=this._constructArrowBasePoint(u,a/2);if(!d)return;t.seekInPath(t.pathSize-1);const f=[t.x,t.y];e.pushPath(u),e.nextPath(),e.nextPoint(),e.setControlPoint(),e.pushPoint(d),e.nextPoint(),e.setControlPoint(),e.pushPoint(f),e.nextPoint(),e.setControlPoint(),e.pushPoint(h),e.nextPoint(),e.setControlPoint(),e.pushPoints(c.reverse()),e.setControlPoint(),r||(e.setControlPointAt(0),e.setControlPointAt(e.pathSize-1),e.pushPoint(u[0])),e.reset()}_constructCrossedArrow(e,t){const r=t.pathLength();let i=this._width;r<i*(1+l+1)&&(i=r/(1+l+1)),t.seekPathStart();const s=this._curveHelper.getSubCurve(t,0,r-i*(1+l));if(!s)return;s.nextPath();const o=i/2;if(this._curveHelper.isEmpty(s))return;const a=(0,n.A)(s),c=this._constructOffset(a,o);if(!c)return;const u=this._constructOffset(a,-o);if(!u)return;const h=this._curveHelper.getSubCurve(t,0,r-i);if(!h)return;if(h.nextPath(),this._curveHelper.isEmpty(h))return;const d=(0,n.A)(h),f=this._constructOffset(d,o);if(!f)return;const p=this._constructOffset(d,-o);if(!p)return;const m=f[f.length-1],_=this._constructArrowBasePoint(f,o/2);if(!_)return;const g=p[p.length-1],y=this._constructArrowBasePoint(p,-o/2);if(!y)return;t.seekInPath(t.pathSize-1);const x=[t.x,t.y];e.pushPath(c),e.nextPath(),e.nextPoint(),e.setControlPoint(),e.pushPoint(g),e.nextPoint(),e.setControlPoint(),e.pushPoint(y),e.nextPoint(),e.setControlPoint(),e.pushPoint(x),e.nextPoint(),e.setControlPoint(),e.pushPoint(_),e.nextPoint(),e.setControlPoint(),e.pushPoint(m),e.nextPoint(),e.setControlPoint(),e.pushPoints(u.reverse()),e.nextPoint(),e.setControlPoint(),e.reset()}_constructOffset(e,t){return this._curveHelper.offset(e,t,a.xw.Rounded,4,this._offsetFlattenError)}_constructArrowBasePoint(e,t){if(!e||e.length<2)return null;const r=e[e.length-2],i=e[e.length-1],n=[i[0]-r[0],i[1]-r[1]];return this._curveHelper.normalize(n),[i[0]+n[1]*t,i[1]-n[0]*t]}}},20391:function(e,t,r){r.d(t,{s:function(){return c}}),r(50917);var i=r(33134),n=r(49077),s=r(62096),o=r(93996),a=r(33389),l=r(57165);class c{static local(){return null===c.instance&&(c.instance=new c),c.instance}execute(e,t,r,i,n,s){return new u(e,t,r,i,n,s)}}c.instance=null;class u{constructor(e,t,r,i,n,s){this._inputGeometries=e,this._tileKey=i,this._geometryEngine=n,this._curveHelper=new o.I,this._size=(void 0!==t.size?t.size:1)*r,this._maxInflateSize=s*r,this._offsetFlattenError=o.U*r}next(){let e;for(;e=this._inputGeometries.next();){if(0===this._size)return e;if("esriGeometryEnvelope"===e.geometryType)if(this._size>0){const t=i.z.createEmptyOptimizedCIM(e.geometryType),r=(0,n.x)(e)[0],s=this._curveHelper.offset(r,this._size,a.xw.Rounded,4,this._offsetFlattenError);if(s)return t.pushPath(s),t}else if(this._size<0){const t=e.asJSON();if(Math.min(t.xmax-t.xmin,t.ymax-t.ymin)+2*this._size>0)return i.z.fromJSONCIM({xmin:t.xmin-this._size,xmax:t.xmax+this._size,ymin:t.ymin-this._size,ymax:t.ymax+this._size})}const t=this._geometryEngine;if(null==t)return null;const r=this._tileKey?(0,s.q)(e,this._maxInflateSize):e;if(!r)continue;const o=t.buffer(l.A.WebMercator,r.asJSON(),this._size,1);return o?i.z.fromJSONCIM(o):null}return null}}},11672:function(e,t,r){r.d(t,{v:function(){return l}});var i=r(33134),n=r(49077),s=r(38441),o=r(23454),a=r(33389);class l{static local(){return null===l.instance&&(l.instance=new l),l.instance}execute(e,t,r,i,n){return new c(e,t,r)}}l.instance=null;class c{constructor(e,t,r){this._defaultPointSize=20,this._inputGeometries=e,this._geomUnitsPerPoint=r,this._rule=t.rule??a.uQ.FullGeometry,this._defaultSize=this._defaultPointSize*r}next(){let e;for(;e=this._inputGeometries.next();){const t=this._processGeom((0,n.x)(e));if(t?.length)return i.z.fromJSONCIM({paths:t})}return null}_clone(e){return[e[0],e[1]]}_mid(e,t){return[(e[0]+t[0])/2,(e[1]+t[1])/2]}_mix(e,t,r,i){return[e[0]*t+r[0]*i,e[1]*t+r[1]*i]}_add(e,t){return[e[0]+t[0],e[1]+t[1]]}_add2(e,t,r){return[e[0]+t,e[1]+r]}_sub(e,t){return[e[0]-t[0],e[1]-t[1]]}_dist(e,t){return Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1]))}_norm(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}_normalize(e,t=1){const r=t/this._norm(e);e[0]*=r,e[1]*=r}_leftPerpendicular(e){const t=-e[1],r=e[0];e[0]=t,e[1]=r}_leftPerp(e){return[-e[1],e[0]]}_rightPerpendicular(e){const t=e[1],r=-e[0];e[0]=t,e[1]=r}_rightPerp(e){return[e[1],-e[0]]}_dotProduct(e,t){return e[0]*t[0]+e[1]*t[1]}_crossProduct(e,t){return e[0]*t[1]-e[1]*t[0]}_rotateDirect(e,t,r){const i=e[0]*t-e[1]*r,n=e[0]*r+e[1]*t;e[0]=i,e[1]=n}_makeCtrlPt(e){const t=[e[0],e[1]];return(0,o.Aq)(t,1),t}_addAngledTicks(e,t,r,i){const n=this._sub(r,t);this._normalize(n);const s=this._crossProduct(n,this._sub(i,t));let o;o=s>0?this._rightPerp(n):this._leftPerp(n);const a=Math.abs(s)/2,l=[];l.push([t[0]+(o[0]-n[0])*a,t[1]+(o[1]-n[1])*a]),l.push(t),l.push(r),l.push([r[0]+(o[0]+n[0])*a,r[1]+(o[1]+n[1])*a]),e.push(l)}_addBezier2(e,t,r,i,n){if(0==n--)return void e.push(i);const s=this._mid(t,r),o=this._mid(r,i),a=this._mid(s,o);this._addBezier2(e,t,s,a,n),this._addBezier2(e,a,o,i,n)}_addBezier3(e,t,r,i,n,s){if(0==s--)return void e.push(n);const o=this._mid(t,r),a=this._mid(r,i),l=this._mid(i,n),c=this._mid(o,a),u=this._mid(a,l),h=this._mid(c,u);this._addBezier3(e,t,o,c,h,s),this._addBezier3(e,h,u,l,n,s)}_add90DegArc(e,t,r,i,n){const s=n??this._crossProduct(this._sub(r,t),this._sub(i,t))>0,o=this._mid(t,r),a=this._sub(o,t);s?this._leftPerpendicular(a):this._rightPerpendicular(a),o[0]+=a[0],o[1]+=a[1],this._addBezier3(e,t,this._mix(t,.33333,o,.66667),this._mix(r,.33333,o,.66667),r,4)}_addArrow(e,t,r){const i=t[0],n=t[1],s=t[t.length-1],o=this._sub(i,n),a=this._norm(o);this._normalize(o);const l=Math.abs(this._crossProduct(o,this._sub(s,n)));let c=this._dotProduct(o,this._sub(s,n));c<.05*a?c=.05*a:c>.95*a&&(c=.95*a);const u=.5*l,h=this._leftPerp(o),d=[n[0]+o[0]*c,n[1]+o[1]*c],f=t.length-1,p=[];p.push(r?[-h[0],-h[1]]:h);let m=[-o[0],-o[1]];for(let e=1;e<f-1;e++){const r=this._sub(t[e+1],t[e]);this._normalize(r);const i=this._dotProduct(r,m),n=this._crossProduct(r,m),s=Math.sqrt((1+i)/2),o=this._sub(r,m);this._normalize(o),o[0]/=s,o[1]/=s,p.push(n<0?[-o[0],-o[1]]:o),m=r}p.push(this._rightPerp(m));for(let r=p.length-1;r>0;r--)e.push([t[r][0]+p[r][0]*u,t[r][1]+p[r][1]*u]);e.push([d[0]+p[0][0]*u,d[1]+p[0][1]*u]),e.push([d[0]+p[0][0]*l,d[1]+p[0][1]*l]),e.push(i),e.push([d[0]-p[0][0]*l,d[1]-p[0][1]*l]),e.push([d[0]-p[0][0]*u,d[1]-p[0][1]*u]);for(let r=1;r<p.length;r++)e.push([t[r][0]-p[r][0]*u,t[r][1]-p[r][1]*u])}_addDash(e,t,r){const i=this._norm(r)/7;this._normalize(r);let n=[];for(let s=0;s<=7;s++)n.push([t[0]+r[0]*s*i,t[1]+r[1]*s*i]),1&s&&(e.push(n),n=[])}_cp2(e,t,r){return e.length>=2?e[1]:this._add2(e[0],t*this._defaultSize,r*this._defaultSize)}_cp3(e,t,r,i){if(e.length>=3)return e[2];const n=this._mix(e[0],1-r,t,r),s=this._sub(t,e[0]);return this._normalize(s),this._rightPerpendicular(s),[n[0]+s[0]*i*this._defaultSize,n[1]+s[1]*i*this._defaultSize]}_arrowPath(e){if(e.length>2)return e;const t=e[0],r=this._cp2(e,-4,0),i=this._sub(t,r);this._normalize(i);const n=this._rightPerp(i);return[t,r,[t[0]+(n[0]-i[0])*this._defaultSize,t[1]+(n[1]-i[1])*this._defaultSize]]}_arrowLastSeg(e){const t=e[0],r=this._cp2(e,-4,0);let i;if(e.length>=3)i=e[e.length-1];else{const e=this._sub(t,r);this._normalize(e);const n=this._rightPerp(e);i=[t[0]+(n[0]-e[0])*this._defaultSize,t[1]+(n[1]-e[1])*this._defaultSize]}return[r,i]}_processGeom(e){if(!e)return null;const t=[];for(const r of e){const e=r.length>1&&(0,s.Yl)(r)<this._defaultSize;if(!r||0===r.length||e)continue;const i=r.length;let n=r[0];switch(this._rule){case a.uQ.PerpendicularFromFirstSegment:{const e=this._cp2(r,0,-1),i=this._cp3(r,e,.5,4),s=[];s.push(i),s.push(this._mid(n,e)),t.push(s);break}case a.uQ.ReversedFirstSegment:{const e=this._cp2(r,0,-1);t.push([e,n]);break}case a.uQ.PerpendicularToSecondSegment:{if(r.length<3)return[];const e=this._cp2(r,-4,1),i=this._cp3(r,e,.882353,-1.94),s=[];s.push(this._mid(e,i)),s.push(n),t.push(s);break}case a.uQ.SecondSegmentWithTicks:{if(r.length<3)return[];const e=this._cp2(r,-4,1),i=this._cp3(r,e,.882353,-1.94),s=this._sub(i,e);let o;o=this._crossProduct(s,this._sub(n,e))>0?this._rightPerp(s):this._leftPerp(s);const a=[];a.push([e[0]+(o[0]-s[0])/3,e[1]+(o[1]-s[1])/3]),a.push(e),a.push(i),a.push([i[0]+(o[0]+s[0])/3,i[1]+(o[1]+s[1])/3]),t.push(a);break}case a.uQ.DoublePerpendicular:{const e=this._cp2(r,0,-1),i=this._cp3(r,e,.5,3),s=this._mid(n,e),o=this._sub(s,i);this._normalize(o);const a=this._crossProduct(o,this._sub(n,i));this._leftPerpendicular(o);const l=[];l.push(n),l.push([i[0]+o[0]*a,i[1]+o[1]*a]),t.push(l);const c=[];c.push([i[0]-o[0]*a,i[1]-o[1]*a]),c.push(e),t.push(c);break}case a.uQ.OppositeToFirstSegment:{const e=this._cp2(r,0,-1),i=this._cp3(r,e,.5,3),s=this._mid(n,e),o=this._sub(s,i);this._normalize(o);const a=this._crossProduct(o,this._sub(n,i));this._leftPerpendicular(o);const l=[];l.push([i[0]+o[0]*a,i[1]+o[1]*a]),l.push([i[0]-o[0]*a,i[1]-o[1]*a]),t.push(l);break}case a.uQ.TriplePerpendicular:{const e=this._cp2(r,0,-1),i=this._cp3(r,e,.5,4),s=this._mid(n,e),o=this._sub(s,i);this._normalize(o);const a=this._crossProduct(o,this._sub(n,i));this._leftPerpendicular(o);const l=[];l.push([i[0]+o[0]*a*.8,i[1]+o[1]*a*.8]),l.push([s[0]+.8*(n[0]-s[0]),s[1]+.8*(n[1]-s[1])]),t.push(l),t.push([i,s]);const c=[];c.push([i[0]-o[0]*a*.8,i[1]-o[1]*a*.8]),c.push([s[0]+.8*(e[0]-s[0]),s[1]+.8*(e[1]-s[1])]),t.push(c);break}case a.uQ.HalfCircleFirstSegment:{const e=this._cp2(r,0,-1),i=this._cp3(r,e,.5,4),s=this._mid(n,e);let o=this._sub(e,n);const a=Math.cos(Math.PI/18),l=Math.sin(Math.PI/18),c=Math.sqrt((1+a)/2),u=Math.sqrt((1-a)/2),h=[];let d;this._crossProduct(o,this._sub(i,n))>0?(h.push(n),o=this._sub(n,s),d=e):(h.push(e),o=this._sub(e,s),d=n),this._rotateDirect(o,c,u),o[0]/=c,o[1]/=c;for(let e=1;e<=18;e++)h.push(this._add(s,o)),this._rotateDirect(o,a,l);h.push(d),t.push(h);break}case a.uQ.HalfCircleSecondSegment:{const e=this._cp2(r,0,-1),i=this._cp3(r,e,1,-1);let s=this._sub(n,e);this._normalize(s);const o=this._crossProduct(s,this._sub(i,e))/2;this._leftPerpendicular(s);const a=[e[0]+s[0]*o,e[1]+s[1]*o];s=this._sub(e,a);const l=Math.cos(Math.PI/18);let c=Math.sin(Math.PI/18);o>0&&(c=-c);const u=[e];for(let e=1;e<=18;e++)this._rotateDirect(s,l,c),u.push(this._add(a,s));t.push(u);break}case a.uQ.HalfCircleExtended:{const e=this._cp2(r,0,-2),s=this._cp3(r,e,1,-1);let o;if(i>=4)o=r[3];else{const t=this._sub(n,e);o=this._add(s,t)}const a=this._dist(e,s)/2/.75,l=this._sub(e,n);this._normalize(l,a);const c=this._sub(s,o);this._normalize(c,a);const u=[o,s];t.push(u);const h=[this._clone(s)];this._addBezier3(h,s,this._add(s,c),this._add(e,l),e,4),h.push(n),t.push(h);break}case a.uQ.OpenCircle:{const e=this._cp2(r,-2,0),i=this._sub(e,n),s=Math.cos(Math.PI/18),o=-Math.sin(Math.PI/18),a=[e];for(let e=1;e<=33;e++)this._rotateDirect(i,s,o),a.push(this._add(n,i));t.push(a);break}case a.uQ.CoverageEdgesWithTicks:{const e=this._cp2(r,0,-1);let s,o;if(i>=3)s=r[2];else{const t=this._sub(e,n),r=this._leftPerp(t);s=[n[0]+r[0]-.25*t[0],n[1]+r[1]-.25*t[1]]}if(i>=4)o=r[3];else{const t=this._mid(n,e),r=this._sub(n,e);this._normalize(r),this._leftPerpendicular(r);const i=this._crossProduct(r,this._sub(s,t));this._rightPerpendicular(r),o=[s[0]+r[0]*i*2,s[1]+r[1]*i*2]}const a=this._sub(e,n);let l,c;l=this._crossProduct(a,this._sub(s,n))>0?this._rightPerp(a):this._leftPerp(a),c=[],c.push(s),c.push(n),c.push([n[0]+(l[0]-a[0])/3,n[1]+(l[1]-a[1])/3]),t.push(c),l=this._crossProduct(a,this._sub(o,e))>0?this._rightPerp(a):this._leftPerp(a),c=[],c.push([e[0]+(l[0]+a[0])/3,e[1]+(l[1]+a[1])/3]),c.push(e),c.push(o),t.push(c);break}case a.uQ.GapExtentWithDoubleTicks:{const e=this._cp2(r,0,2),s=this._cp3(r,e,0,1);let o;if(i>=4)o=r[3];else{const t=this._sub(e,n);o=this._add(s,t)}this._addAngledTicks(t,n,e,this._mid(s,o)),this._addAngledTicks(t,s,o,this._mid(n,e));break}case a.uQ.GapExtentMidline:{const e=this._cp2(r,2,0),s=this._cp3(r,e,0,1);let o;if(i>=4)o=r[3];else{const t=this._sub(e,n);o=this._add(s,t)}const a=[];a.push(this._mid(n,s)),a.push(this._mid(e,o)),t.push(a);break}case a.uQ.Chevron:{const e=this._cp2(r,-1,-1);let s;if(i>=3)s=r[2];else{const t=this._sub(e,n);this._leftPerpendicular(t),s=this._add(n,t)}t.push([e,this._makeCtrlPt(n),s]);break}case a.uQ.PerpendicularWithArc:{const e=this._cp2(r,0,-2),s=this._cp3(r,e,.5,-1),o=this._sub(e,n),a=this._norm(o);o[0]/=a,o[1]/=a;const l=this._crossProduct(o,this._sub(s,n));let c=this._dotProduct(o,this._sub(s,n));c<.05*a?c=.05*a:c>.95*a&&(c=.95*a);const u=[n[0]+o[0]*c,n[1]+o[1]*c];let h=this._leftPerp(o),d=[];if(d.push([u[0]-h[0]*l,u[1]-h[1]*l]),d.push([u[0]+h[0]*l,u[1]+h[1]*l]),t.push(d),i>=4){const e=r[3];let i=this._dotProduct(o,this._sub(e,n));i<.1*a?i=.1*a:i>.9*a&&(i=.9*a);const s=[n[0]+o[0]*i,n[1]+o[1]*i],l=this._crossProduct(o,this._sub(e,n)),c=[];c.push([s[0]-h[0]*l,s[1]-h[1]*l]),c.push([s[0]+h[0]*l,s[1]+h[1]*l]),t.push(c)}const f=[e[0]+h[0]*l,e[1]+h[1]*l];h=this._sub(e,f);const p=Math.cos(Math.PI/18);let m=Math.sin(Math.PI/18);l<0&&(m=-m),d=[n,e];for(let e=1;e<=9;e++)this._rotateDirect(h,p,m),d.push(this._add(f,h));t.push(d);break}case a.uQ.ClosedHalfCircle:{const e=this._cp2(r,2,0),i=this._mid(n,e),s=this._sub(e,i),o=Math.cos(Math.PI/18),a=Math.sin(Math.PI/18),l=[n,e];for(let e=1;e<=18;e++)this._rotateDirect(s,o,a),l.push(this._add(i,s));t.push(l);break}case a.uQ.TripleParallelExtended:{const e=this._cp2(r,0,-2),i=this._cp3(r,e,1,-2),s=this._mid(n,e),a=this._sub(i,e);this._normalize(a);const l=Math.abs(this._crossProduct(a,this._sub(s,e)))/2,c=this._dist(e,i),u=[e,n];u.push([n[0]+a[0]*c*.5,n[1]+a[1]*c*.5]),t.push(u);const h=[];h.push([s[0]-a[0]*l,s[1]-a[1]*l]),h.push([s[0]+a[0]*c*.375,s[1]+a[1]*c*.375]),(0,o.Aq)(h[h.length-1],1),h.push([s[0]+a[0]*c*.75,s[1]+a[1]*c*.75]),t.push(h);const d=[e,i];t.push(d);break}case a.uQ.ParallelWithTicks:{const e=this._cp2(r,3,0),i=this._cp3(r,e,.5,-1),s=this._sub(i,e);this._normalize(s);const o=this._crossProduct(s,this._sub(i,n));this._leftPerpendicular(s),this._addAngledTicks(t,n,e,i),this._addAngledTicks(t,this._mix(n,1,s,o),this._mix(e,1,s,o),this._mid(n,e));break}case a.uQ.Parallel:{const e=this._cp2(r,3,0),i=this._cp3(r,e,.5,-1),s=this._sub(e,n);this._normalize(s);const o=this._leftPerp(s),a=this._crossProduct(s,this._sub(i,n));let l=[n,e];t.push(l),l=[],l.push([n[0]+o[0]*a,n[1]+o[1]*a]),l.push([e[0]+o[0]*a,e[1]+o[1]*a]),t.push(l);break}case a.uQ.PerpendicularToFirstSegment:{const e=this._cp2(r,3,0),i=this._cp3(r,e,.5,-1),s=this._mid(n,e),o=this._sub(e,n);this._normalize(o);const a=this._crossProduct(o,this._sub(i,n));this._leftPerpendicular(o);const l=[];l.push([s[0]-o[0]*a*.25,s[1]-o[1]*a*.25]),l.push([s[0]+o[0]*a*1.25,s[1]+o[1]*a*1.25]),t.push(l);break}case a.uQ.ParallelOffset:{const e=this._cp2(r,3,0),i=this._cp3(r,e,.5,-1),s=this._sub(e,n);this._normalize(s);const o=this._crossProduct(s,this._sub(i,n));this._leftPerpendicular(s);const a=[];a.push([n[0]-s[0]*o,n[1]-s[1]*o]),a.push([e[0]-s[0]*o,e[1]-s[1]*o]),t.push(a);const l=[];l.push([n[0]+s[0]*o,n[1]+s[1]*o]),l.push([e[0]+s[0]*o,e[1]+s[1]*o]),t.push(l);break}case a.uQ.OffsetOpposite:{const e=this._cp2(r,3,0),i=this._cp3(r,e,.5,-1),s=this._sub(e,n);this._normalize(s);const o=this._crossProduct(s,this._sub(i,n));this._leftPerpendicular(s);const a=[];a.push([n[0]-s[0]*o,n[1]-s[1]*o]),a.push([e[0]-s[0]*o,e[1]-s[1]*o]),t.push(a);break}case a.uQ.OffsetSame:{const e=this._cp2(r,3,0),i=this._cp3(r,e,.5,-1),s=this._sub(e,n);this._normalize(s);const o=this._crossProduct(s,this._sub(i,n));this._leftPerpendicular(s);const a=[];a.push([n[0]+s[0]*o,n[1]+s[1]*o]),a.push([e[0]+s[0]*o,e[1]+s[1]*o]),t.push(a);break}case a.uQ.CircleWithArc:{let e=this._cp2(r,3,0);const s=this._cp3(r,e,.5,-1);let a,l;if(i>=4)a=r[3],l=this._crossProduct(this._sub(a,e),this._sub(s,e))>0;else{a=e,l=this._crossProduct(this._sub(a,n),this._sub(s,n))>0;const t=24*this._geomUnitsPerPoint,r=this._sub(a,n);this._normalize(r,t);const i=Math.sqrt(2)/2;this._rotateDirect(r,i,l?i:-i),e=this._add(n,r)}const c=this._sub(e,n),u=Math.cos(Math.PI/18),h=Math.sin(Math.PI/18),d=[e];for(let e=1;e<=36;e++)this._rotateDirect(c,u,h),d.push(this._add(n,c));this._add90DegArc(d,e,a,s,l),(0,o.Aq)(d[d.length-8],1),t.push(d);break}case a.uQ.DoubleJog:{let e,s=this._cp2(r,-3,1),o=this._cp3(r,s,-1,-.5);if(i>=4)e=r[3];else{const t=n;n=s,e=o;const r=this._dist(n,t),i=this._dist(e,t);let a=30*this._geomUnitsPerPoint;.5*r<a&&(a=.5*r),.5*i<a&&(a=.5*i),s=this._mix(n,a/r,t,(r-a)/r),o=this._mix(e,a/i,t,(i-a)/i)}const a=this._mid(n,s),l=this._mid(e,o),c=this._dist(n,s),u=this._dist(o,e);let h=Math.min(c,u)/8;h=Math.min(h,24*this._geomUnitsPerPoint);const d=Math.cos(Math.PI/4);let f=this._sub(n,s);this._normalize(f,h),this._crossProduct(f,this._sub(e,s))>0?this._rotateDirect(f,d,-d):this._rotateDirect(f,d,d);let p=[];p.push(s),p.push(this._add(a,f)),p.push(this._sub(a,f)),p.push(n),t.push(p),f=this._sub(e,o),this._normalize(f,h),this._crossProduct(f,this._sub(n,o))<0?this._rotateDirect(f,d,d):this._rotateDirect(f,d,-d),p=[],p.push(o),p.push(this._add(l,f)),p.push(this._sub(l,f)),p.push(e),t.push(p);break}case a.uQ.PerpendicularOffset:{const e=this._cp2(r,-4,1),i=this._cp3(r,e,.882353,-1.94),s=this._sub(i,e);this._crossProduct(s,this._sub(n,e))>0?this._rightPerpendicular(s):this._leftPerpendicular(s);const o=[s[0]/8,s[1]/8],a=this._sub(this._mid(e,i),o);t.push([a,n]);break}case a.uQ.LineExcludingLastSegment:{const e=this._arrowPath(r),i=[];let n=e.length-2;for(;n--;)i.push(e[n]);t.push(i);break}case a.uQ.MultivertexArrow:{const e=this._arrowPath(r),i=[];this._addArrow(i,e,!1),t.push(i);break}case a.uQ.CrossedArrow:{const e=this._arrowPath(r),i=[];this._addArrow(i,e,!0),t.push(i);break}case a.uQ.ChevronArrow:{const[e,i]=this._arrowLastSeg(r),s=10*this._geomUnitsPerPoint,o=this._sub(n,e),a=this._norm(o);this._normalize(o);const l=this._crossProduct(o,this._sub(i,e));let c=this._dotProduct(o,this._sub(i,e));c<.05*a?c=.05*a:c>.95*a-s&&(c=.95*a-s);const u=[e[0]+o[0]*c,e[1]+o[1]*c],h=this._leftPerp(o),d=[];d.push([u[0]+h[0]*l+o[0]*s,u[1]+h[1]*l+o[1]*s]),d.push(n),d.push([u[0]-h[0]*l+o[0]*s,u[1]-h[1]*l+o[1]*s]),t.push(d);break}case a.uQ.ChevronArrowOffset:{const[e,i]=this._arrowLastSeg(r),s=this._sub(n,e),o=this._norm(s);this._normalize(s);const a=this._crossProduct(s,this._sub(i,e));let l=this._dotProduct(s,this._sub(i,e));l<.05*o?l=.05*o:l>.95*o&&(l=.95*o);const c=[e[0]+s[0]*l,e[1]+s[1]*l];this._leftPerpendicular(s);const u=[];u.push([c[0]+s[0]*a*.5,c[1]+s[1]*a*.5]),u.push(this._mid(c,n)),u.push([c[0]-s[0]*a*.5,c[1]-s[1]*a*.5]),t.push(u);break}case a.uQ.PartialFirstSegment:{const[e,i]=this._arrowLastSeg(r),s=this._sub(n,e),o=this._norm(s);this._normalize(s);let a=this._dotProduct(s,this._sub(i,e));a<.05*o?a=.05*o:a>.95*o&&(a=.95*o);const l=[e[0]+s[0]*a,e[1]+s[1]*a];t.push([e,l]);break}case a.uQ.Arch:{const e=this._cp2(r,0,-1),i=this._cp3(r,e,.5,1),s=this._sub(n,e),o=this._mix(i,1,s,.55),a=this._mix(i,1,s,-.55),l=[n];this._addBezier2(l,n,o,i,4),this._addBezier2(l,i,a,e,4),t.push(l);break}case a.uQ.CurvedParallelTicks:{const e=this._cp2(r,-4,1),i=this._cp3(r,e,.882353,-1.94),s=this._sub(i,e);this._crossProduct(s,this._sub(n,e))>0?this._rightPerpendicular(s):this._leftPerpendicular(s);const o=[s[0]/8,s[1]/8],a=this._sub(this._mid(e,i),o),l=this._sub(this._mix(e,.75,i,.25),o),c=this._sub(this._mix(e,.25,i,.75),o),u=[e];this._addBezier2(u,e,l,a,3),this._addBezier2(u,a,c,i,3),t.push(u);for(let e=0;e<8;e++){const r=u[2*e+1],i=[this._clone(r)];i.push(this._add(r,[s[0]/4,s[1]/4])),t.push(i)}break}case a.uQ.Arc90Degrees:{const e=this._cp2(r,0,-1),i=this._cp3(r,e,.5,1),s=[e];this._add90DegArc(s,e,n,i),t.push(s);break}case a.uQ.TipWithPerpendicularAndTicks:{const[e,i]=this._arrowLastSeg(r),s=10*this._geomUnitsPerPoint,o=this._sub(n,e),a=this._norm(o);this._normalize(o);let l=this._crossProduct(o,this._sub(i,e)),c=this._dotProduct(o,this._sub(i,e));c<.05*a?c=.05*a:c>.95*a-s&&(c=.95*a-s);const u=this._leftPerp(o),h=[n[0]-o[0]*s,n[1]-o[1]*s],d=.5*Math.max(a-c-s,s);l=Math.abs(l);const f=[];f.push([h[0]+u[0]*(l+d)-o[0]*d,h[1]+u[1]*(l+d)-o[1]*d]),f.push([h[0]+u[0]*l,h[1]+u[1]*l]),f.push([h[0]-u[0]*l,h[1]-u[1]*l]),f.push([h[0]-u[0]*(l+d)-o[0]*d,h[1]-u[1]*(l+d)-o[1]*d]),t.push(f),t.push([h,n]);break}case a.uQ.ConcentricCircles:{const e=this._cp2(r,1,0),s=this._cp3(r,e,2,0),a=Math.cos(Math.PI/18),l=Math.sin(Math.PI/18);let c=this._dist(e,n),u=[c,0],h=[];for(let e=0;e<=36;e++)h.push(this._add(n,u)),this._rotateDirect(u,a,l);if(t.push(h),i>=4){h=[];const e=r[3];c=this._dist(e,n),u=[c,0];for(let e=0;e<=36;e++)h.push(this._add(n,u)),0===e&&(h.push(this._add(n,u)),(0,o.Aq)(h[1],1)),this._rotateDirect(u,a,l);t.push(h)}h=[],c=this._dist(s,n),u=[c,0];for(let e=0;e<=36;e++)h.push(this._add(n,u)),this._rotateDirect(u,a,l);t.push(h);break}case a.uQ.DoubleJogArrow:{n=this._arrowPath(r)[0];const[e,i]=this._arrowLastSeg(r),s=this._sub(n,e),o=this._norm(s);this._normalize(s);const a=Math.abs(this._crossProduct(s,this._sub(i,n)));let l=Math.abs(this._dotProduct(s,this._sub(i,n)));l<.05*o?l=.05*o:l>.95*o&&(l=.95*o);const c=Math.max(a,l),u=this._leftPerp(s);let h=[];const d=[n[0]-s[0]*l*.5+u[0]*a*.5,n[1]-s[1]*l*.5+u[1]*a*.5];h.push([d[0],d[1]]),d[0]+=s[0]*c*.5+u[0]*c*.4,d[1]+=s[1]*c*.5+u[1]*c*.4,h.push([d[0],d[1]]),d[0]-=u[0]*c*.25,d[1]-=u[1]*c*.25,h.push([d[0],d[1]]),d[0]+=s[0]*c*.5+u[0]*c*.4,d[1]+=s[1]*c*.5+u[1]*c*.4,h.push([d[0],d[1]]),t.push(h),h=[],d[0]=n[0]-s[0]*l*.5-u[0]*a*.5,d[1]=n[1]-s[1]*l*.5-u[1]*a*.5,h.push([d[0],d[1]]),d[0]+=s[0]*c*.5-u[0]*c*.4,d[1]+=s[1]*c*.5-u[1]*c*.4,h.push([d[0],d[1]]),d[0]+=u[0]*c*.25,d[1]+=u[1]*c*.25,h.push([d[0],d[1]]),d[0]+=s[0]*c*.5-u[0]*c*.4,d[1]+=s[1]*c*.5-u[1]*c*.4,h.push([d[0],d[1]]),t.push(h);break}case a.uQ.LinkedChevrons:{const e=this._cp2(r,-5,0),i=this._cp3(r,e,-.2,1),s=this._sub(n,e);this._normalize(s);const o=this._leftPerp(s),a=Math.abs(this._crossProduct(s,this._sub(i,e)));t.push([e,n]);const l=[];l.push([n[0]-s[0]*a+o[0]*a,n[1]-s[1]*a+o[1]*a]),l.push(n),l.push([n[0]-s[0]*a-o[0]*a,n[1]-s[1]*a-o[1]*a]),t.push(l),this._addDash(t,e,[-s[0]*a+o[0]*a,-s[1]*a+o[1]*a]),this._addDash(t,e,[-s[0]*a-o[0]*a,-s[1]*a-o[1]*a]);break}case a.uQ.SegmentThenHalfCircle:{const e=this._cp2(r,2,0),s=this._cp3(r,e,1.5,0);let o;o=i>=4?r[3]:this._cp3(r,e,1.25,-.5);const a=this._sub(e,n);this._normalize(a);const l=.5*this._dist(e,s),c=this._crossProduct(a,this._sub(o,n))>0,u=Math.cos(Math.PI/18);let h=Math.sin(Math.PI/18);c&&(h=-h);const d=[n,e];a[0]*=l,a[1]*=l;const f=this._add(e,a);a[0]=-a[0],a[1]=-a[1];for(let e=1;e<=18;e++)this._rotateDirect(a,u,h),d.push(this._add(f,a));t.push(d);break}case a.uQ.LineWithStraightTicks:{const e=this._cp2(r,-2,1),i=this._cp3(r,e,-1,-.5),s=this._sub(i,e);this._normalize(s);const o=this._dotProduct(s,this._sub(e,n)),a=this._dotProduct(s,this._sub(i,n));let l=[n];l.push([n[0]+s[0]*o,n[1]+s[1]*o]),l.push(e),t.push(l),l=[n],l.push([n[0]+s[0]*a,n[1]+s[1]*a]),l.push(i),t.push(l);break}case a.uQ.DoubleCurve:{const e=this._cp2(r,-5,-1),i=this._cp3(r,e,2,0),s=Math.atan2(1,5),a=Math.cos(s),l=Math.sin(s),c=this._sub(e,n),u=this._dist(n,e);this._normalize(c),this._rotateDirect(c,a,-l);const h=[n];h.push([n[0]+c[0]*u*.5,n[1]+c[1]*u*.5]),(0,o.Aq)(h[1],1),h.push([n[0]+c[0]*u*.8,n[1]+c[1]*u*.8]),this._addBezier2(h,h[2],[n[0]+c[0]*u,n[1]+c[1]*u],e,3);const d=this._sub(i,e),f=this._dist(e,i);this._normalize(d),this._rotateDirect(d,a,-l),this._addBezier2(h,e,[i[0]-d[0]*f,i[1]-d[1]*f],[i[0]-d[0]*f*.8,i[1]-d[1]*f*.8],3),h.push(i),t.push(h);break}case a.uQ.ParallelWithTicksByWidth:{const e=this._cp2(r,0,-1),i=this._cp3(r,e,.5,3),s=this._sub(e,n);this._normalize(s);const o=this._crossProduct(s,this._sub(i,n));this._leftPerpendicular(s),o>0?(this._addAngledTicks(t,n,[n[0]+s[0]*o,n[1]+s[1]*o],e),this._addAngledTicks(t,e,[e[0]+s[0]*o,e[1]+s[1]*o],n)):(this._addAngledTicks(t,[n[0]+s[0]*o,n[1]+s[1]*o],n,e),this._addAngledTicks(t,[e[0]+s[0]*o,e[1]+s[1]*o],n,e));break}case a.uQ.EnclosingRoundedRectangle:{const e=this._cp2(r,3,-2),t=[Math.min(n[0],e[0]),Math.max(n[1],e[1])],i=[Math.max(n[0],e[0]),Math.min(n[1],e[1])],s=i[0]-t[0],o=t[1]-i[1],a=Math.min(s,o)/10,l=[];l.push([t[0]+a+.75*(s-2*a),t[1]]),l.push([i[0]-a,t[1]]),this._add90DegArc(l,[i[0]-a,t[1]],[i[0],t[1]-a],[i[0],t[1]]),l.push([i[0],i[1]+a]),this._add90DegArc(l,[i[0],i[1]+a],[i[0]-a,i[1]],i),l.push([t[0]+a,i[1]]),this._add90DegArc(l,[t[0]+a,i[1]],[t[0],i[1]+a],[t[0],i[1]]),l.push([t[0],t[1]-a]),this._add90DegArc(l,[t[0],t[1]-a],[t[0]+a,t[1]],t),l.push([t[0]+a+.75*(s-2*a),t[1]]);break}case a.uQ.FullGeometry:default:t.push(r)}}return t}}},12281:function(e,t,r){r.d(t,{y:function(){return o}});var i=r(33134),n=r(23454),s=r(93996);class o{static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(e,t,r,i,n){return new a(e,t,r)}}o.instance=null;class a extends n.rx{constructor(e,t,r){super(e,!0,!0),this._curveHelper=new s.I,this._beginCut=(void 0!==t.beginCut?t.beginCut:1)*r,this._endCut=(void 0!==t.endCut?t.endCut:1)*r,this._middleCut=(void 0!==t.middleCut?t.middleCut:0)*r,this._invert=void 0!==t.invert&&t.invert,this._beginCut<0&&(this._beginCut=0),this._endCut<0&&(this._endCut=0),this._middleCut<0&&(this._middleCut=0)}processPath(e){const{_beginCut:t,_endCut:r,_middleCut:n}=this,s=e.pathLength(),o=i.z.createEmptyOptimizedCIM("esriGeometryPolyline");if(this._invert){if(0!==t||0!==r||0!==n)if(t+r+n>=s)for(o.startPath();e.nextPoint();)o.pushXY(e.x,e.y);else this._curveHelper.appendSubCurve(o,e,0,t),this._curveHelper.appendSubCurve(o,e,.5*(s-n),.5*(s+n)),this._curveHelper.appendSubCurve(o,e,s-r,r)}else if(0===t&&0===r&&0===n)for(o.startPath();e.nextPoint();)o.pushXY(e.x,e.y);else t+r+n<s&&(0===n?this._curveHelper.appendSubCurve(o,e,t,s-r):(this._curveHelper.appendSubCurve(o,e,t,.5*(s-n)),this._curveHelper.appendSubCurve(o,e,.5*(s+n),s-r)));return 0===o.totalSize?null:o}}},2969:function(e,t,r){r.d(t,{I:function(){return c}});var i=r(33134),n=r(49077),s=r(23454),o=r(33389),a=r(65661),l=r(7590);class c{static local(){return null===c.instance&&(c.instance=new c),c.instance}execute(e,t,r,i,n){return new u(e,t,r)}}c.instance=null;class u extends s.rx{constructor(e,t,r){super(e,!0,!0),this._firstCurve=null,this._walker=new a.Z1,this._walker.updateTolerance(r),this._endings=t.lineDashEnding,this._customDashPos=-(t.offsetAlongLine??0)*r,this._offsetAtEnd=(t.customEndingOffset??0)*r;let i=(0,l.FH)(t).dashTemplate;null==i&&(i=[]),i.length%2&&(i=[...i,...i]),this._pattern=new a.VA,this._pattern.init(i,!0),this._pattern.scale(r)}processPath(e){if(0===this._pattern.length()){this.iteratePath=!1;const t=(0,n.A)(e);return i.z.fromJSONCIM({paths:[t]})}if(!this.iteratePath){let t=!0;switch(this._endings){case o.yS.HalfPattern:case o.yS.HalfGap:default:this._pattern.extPtGap=0;break;case o.yS.FullPattern:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.firstValue());break;case o.yS.FullGap:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.lastValue());break;case o.yS.NoConstraint:this.isClosed||(t=!1);break;case o.yS.Custom:this.isClosed||(this._pattern.extPtGap=.5*this._offsetAtEnd)}const r=e.pathLength();if(this._pattern.isEmpty()||r<.1*this._pattern.length()){const t=(0,n.A)(e);return i.z.fromJSONCIM({paths:[t]})}if(!this._walker.init(e,this._pattern,t)){const t=(0,n.A)(e);return i.z.fromJSONCIM({paths:[t]})}}let t;if(this.iteratePath)t=this._pattern.nextValue();else{let e;switch(this._endings){case o.yS.HalfPattern:default:e=.5*this._pattern.firstValue();break;case o.yS.HalfGap:e=.5*-this._pattern.lastValue();break;case o.yS.FullGap:e=-this._pattern.lastValue();break;case o.yS.FullPattern:e=0;break;case o.yS.NoConstraint:case o.yS.Custom:e=-this._customDashPos}let r=e/this._pattern.length();r-=Math.floor(r),e=r*this._pattern.length(),this._pattern.reset(),t=this._pattern.nextValue();let i=!1;for(;e>=t;)e-=t,t=this._pattern.nextValue(),i=!i;t-=e,i?(this._walker.nextPosition(t),t=this._pattern.nextValue()):this.isClosed&&(this._firstCurve=this._walker.nextCurve(t),t=this._pattern.nextValue(),this._walker.nextPosition(t),t=this._pattern.nextValue())}let r=this._walker.nextCurve(t);if(r)if(this._walker.isPathEnd()){if(this.iteratePath=!1,this._firstCurve){for(this._firstCurve.nextPath();this._firstCurve.nextPoint();)r.pushXY(this._firstCurve.x,this._firstCurve.y);this._firstCurve=null}}else t=this._pattern.nextValue(),!this._walker.nextPosition(t)||this._walker.isPathEnd()?(this.iteratePath=!1,this._firstCurve&&(r.pushCursor(this._firstCurve),this._firstCurve=null)):this.iteratePath=!0;else this.iteratePath=!1,r=this._firstCurve,this._firstCurve=null;return r?.reset(),r}}},7889:function(e,t,r){r.d(t,{O:function(){return a}}),r(50917);var i=r(33134),n=r(62096),s=r(33389),o=r(57165);class a{static local(){return null===a.instance&&(a.instance=new a),a.instance}execute(e,t,r,i,n,s){return new l(e,t,r,i,n,s)}}a.instance=null;class l{constructor(e,t,r,i,n,o){switch(this._inputGeometries=e,this._tileKey=i,this._geometryEngine=n,this._maxInflateSize=o*r,this._width=(void 0!==t.width?t.width:2)*r,t.method){case s.M1.Mitered:case s.M1.Bevelled:case s.M1.Rounded:case s.M1.TrueBuffer:case s.M1.Square:}this._option=t.option}next(){let e;for(;e=this._inputGeometries.next();){if("esriGeometryEnvelope"===e.geometryType&&this._width>0){const t=e.asJSON();return Math.min(t.xmax-t.xmin,t.ymax-t.ymin)-2*this._width<0?e:i.z.fromJSONCIM({paths:[[[t.xmin+this._width,t.ymin+this._width],[t.xmax-this._width,t.ymin+this._width],[t.xmax-this._width,t.ymax-this._width],[t.xmin+this._width,t.ymax-this._width],[t.xmin+this._width,t.ymin+this._width]],[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]})}if("esriGeometryPolygon"===e.geometryType){if(0===this._width)return e.clone();const t=this._geometryEngine;if(null==t)return null;const r=this._tileKey?(0,n.q)(e,this._maxInflateSize):e.clone();if(!r)continue;const i=t.buffer(o.A.WebMercator,r.asJSON(),-this._width,1);if(i)for(const e of i.rings)if(e){r.startPath();for(const t of e.reverse())r.pushXY(t[0],r.yFactor*t[1])}return r}}return null}}},48645:function(e,t,r){r.d(t,{U:function(){return o}});var i=r(33134),n=r(23454),s=r(93996);class o{static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(e,t,r,i,n){return new a(e,t,r)}}o.instance=null;class a extends n.rx{constructor(e,t,r){super(e,!1,!0),this._curveHelper=new s.I,this._length=(void 0!==t.length?t.length:20)*r,this._angle=void 0!==t.angle?t.angle:225,this._position=void 0!==t.position?t.position:50,this._length<0&&(this._length=-this._length),this._position<20&&(this._position=20),this._position>80&&(this._position=80),this._mirror=!1}processPath(e){const t=i.z.createEmptyOptimizedCIM("esriGeometryPolyline");if(this._curveHelper.isEmpty(e))return null;e.seekInPath(0);const r=e.x,n=e.y;e.seekInPath(e.pathSize-1);const s=e.x,o=e.y,a=[s-r,o-n];this._curveHelper.normalize(a);const l=r+(s-r)*this._position/100,c=n+(o-n)*this._position/100,u=Math.cos((90-this._angle)/180*Math.PI);let h=Math.sin((90-this._angle)/180*Math.PI);this._mirror&&(h=-h),this._mirror=!this._mirror;const d=[l-this._length/2*u,c-this._length/2*h],f=[l+this._length/2*u,c+this._length/2*h];return t.pushPath([[r,n],d,f,[s,o]]),t}}},7088:function(e,t,r){r.d(t,{V:function(){return i}});class i{static local(){return null===i.instance&&(i.instance=new i),i.instance}execute(e,t,r,i,s){return new n(e,t,r)}}i.instance=null;class n{constructor(e,t,r){this._inputGeometries=e,this._offsetX=void 0!==t.offsetX?t.offsetX*r:0,this._offsetY=void 0!==t.offsetY?t.offsetY*r:0}next(){let e=this._inputGeometries.next();for(;e;){if(e.totalSize>0)return this._move(e.clone(),this._offsetX,this._offsetY);e=this._inputGeometries.next()}return null}_move(e,t,r){for(;e.nextPath();)for(;e.nextPoint();)e.x=e.x+t,e.y=e.y+r;return e.reset(),e}}},17706:function(e,t,r){r.d(t,{V:function(){return u}}),r(50917);var i=r(33134),n=r(49077),s=r(74697),o=r(62096),a=r(93996),l=r(33389),c=r(57165);class u{static local(){return null===u.instance&&(u.instance=new u),u.instance}execute(e,t,r,i,n,s){return new h(e,t,r,i,n,s)}}u.instance=null;class h{constructor(e,t,r,i,n,s){this._inputGeometries=e,this._tileKey=i,this._geometryEngine=n,this._curveHelper=new a.I,this._offset=(t.offset??1)*r,this._method=t.method,this._maxInflateSize=Math.max(Math.abs(s*r),10),this._option=t.option,this._offsetFlattenError=a.U*r}next(){let e;for(;e=this._inputGeometries.next();){if(0===this._offset)return e.clone();if("esriGeometryEnvelope"===e.geometryType){if(this._method===l.xw.Rounded&&this._offset>0){const t=(0,n.A)(e),r=this._curveHelper.offset(t,-this._offset,this._method,4,this._offsetFlattenError);if(r){const t=i.z.createEmptyOptimizedCIM(e.geometryType);return t.pushPath(r),t}return null}const t=e.asJSON();if((0,s.ZC)(t)&&Math.min(t.xmax-t.xmin,t.ymax-t.ymin)+2*this._offset>0)return i.z.fromJSONCIM({xmin:t.xmin-this._offset,xmax:t.xmax+this._offset,ymin:t.ymin-this._offset,ymax:t.ymax+this._offset})}const t=this._geometryEngine;if(null==t)continue;const r=this._tileKey?(0,o.q)(e,this._maxInflateSize):e.clone();if(!r)continue;const a=t.offset(c.A.WebMercator,r.asJSON(),-this._offset,1,this._method,4,this._offsetFlattenError);return a?i.z.fromJSONCIM(a):null}return null}}},10183:function(e,t,r){r.d(t,{C:function(){return i}});class i{static local(){return null===i.instance&&(i.instance=new i),i.instance}execute(e,t,r,i,s){return new n(e,t,r)}}i.instance=null;class n{constructor(e,t,r){this._inputGeometries=e,this._reverse=void 0===t.reverse||t.reverse}next(){let e=this._inputGeometries.next();for(;e;){if(!this._reverse)return e;if("esriGeometryPolyline"===e.geometryType)return s(e.clone());e=this._inputGeometries.next()}return null}}function s(e){for(;e.nextPath();)for(let t=0;t<e.pathSize/2;t++){e.seekInPath(t);const r=e.x,i=e.y;e.seekInPath(e.pathSize-t-1);const n=e.x,s=e.y;e.x=r,e.y=i,e.seekInPath(t),e.x=n,e.y=s}return e.reset(),e}},1646:function(e,t,r){r.d(t,{v:function(){return n}});var i=r(35068);class n{static local(){return null===n.instance&&(n.instance=new n),n.instance}execute(e,t,r,i,n){return new s(e,t,r)}}n.instance=null;class s{constructor(e,t,r){this._inputGeometries=e,this._rotateAngle=void 0!==t.angle?t.angle*Math.PI/180:0}next(){let e=this._inputGeometries.next();for(;e;){if(0===this._rotateAngle||"esriGeometryPoint"===e.geometryType)return e;if(e.totalSize>0){const t=(0,i.z8)(e),r=(t[2]+t[0])/2,n=(t[3]+t[1])/2;return e.reset(),this._rotate(e.clone(),r,n)}e=this._inputGeometries.next()}return null}_rotate(e,t,r){const i=Math.cos(this._rotateAngle),n=Math.sin(this._rotateAngle);for(;e.nextPath();)for(;e.nextPoint();){const s=e.x-t,o=e.y-r;e.x=t+s*i-o*n,e.y=r+s*n+o*i}return e.reset(),e}}},79323:function(e,t,r){r.d(t,{W:function(){return n}});var i=r(35068);class n{static local(){return null===n.instance&&(n.instance=new n),n.instance}execute(e,t,r,i,n){return new s(e,t,r)}}n.instance=null;class s{constructor(e,t,r){this._inputGeometries=e,this._xFactor=void 0!==t.xScaleFactor?t.xScaleFactor:1.15,this._yFactor=void 0!==t.yScaleFactor?t.yScaleFactor:1.15}next(){const e=this._inputGeometries.next();if(e){if(1===this._xFactor&&1===this._yFactor)return e;if("esriGeometryPoint"===e.geometryType)return e;if(e.totalSize>0){const t=(0,i.z8)(e),r=(t[2]+t[0])/2,n=(t[3]+t[1])/2;return e.reset(),this._scaleCursor(e.clone(),r,n)}}return null}_scaleCursor(e,t,r){for(;e.nextPath();)for(;e.nextPoint();)e.x=t+(e.x-t)*this._xFactor,e.y=r+(e.y-r)*this._yFactor;return e.reset(),e}}},34476:function(e,t,r){r.d(t,{l:function(){return o}});var i=r(33134),n=r(33389),s=r(65661);class o{static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(e,t,r,i,n){return new a(e,t,r)}}o.instance=null;class a{constructor(e,t,r){this._inputGeometries=e,this._height=(void 0!==t.amplitude?t.amplitude:2)*r,this._period=(void 0!==t.period?t.period:3)*r,this._style=t.waveform,this._height<=0&&(this._height=Math.abs(this._height)),this._period<=0&&(this._period=Math.abs(this._period)),this._pattern=new s.VA,this._pattern.addValue(this._period),this._pattern.addValue(this._period),this._walker=new s.Z1,this._walker.updateTolerance(r)}next(){let e=this._inputGeometries.next();for(;e;){if(0===this._height||0===this._period)return e;const t=this._processGeom(e);if(t)return t;e=this._inputGeometries.next()}return null}_processGeom(e){const t=i.z.createEmptyOptimizedCIM(e.geometryType);for(;e.nextPath();){t.startPath();const r=e.pathLength();if(this._walker.init(e,this._pattern))switch(this._style){case n.WE.Sinus:default:this._constructCurve(t,r,!1);break;case n.WE.Square:this._constructSquare(t,r);break;case n.WE.Triangle:this._constructTriangle(t,r);break;case n.WE.Random:this._constructCurve(t,r,!0)}else for(;e.nextPoint();)t.pushXY(e.x,e.y)}return t}_constructCurve(e,t,r){let i=Math.round(t/this._period);0===i&&(i=1);const n=16*i+1,o=t/i,a=this._period/16,l=1/n,c=2*Math.PI*t/o,u=2*Math.PI*Math.random(),h=2*Math.PI*Math.random(),d=2*Math.PI*Math.random(),f=.75-Math.random()/2,p=.75-Math.random()/2,m=new s.ps;this._walker.curPointAndAngle(m),e.pushPoint(m.pt);let _=0;for(;;){if(!this._walker.nextPointAndAngle(a,m)){e.pushPoint(this._walker.getPathEnd());break}{const t=_;let i;if(_+=l,r){const e=this._height/2*(1+.3*Math.sin(f*c*t+u));i=e*Math.sin(c*t+h),i+=e*Math.sin(p*c*t+d),i/=2}else i=.5*this._height*Math.sin(.5*c*t);e.pushXY(m.pt[0]-i*m.sa,m.pt[1]+i*m.ca)}}}_constructSquare(e,t){Math.round(t/this._period);let r=!0;for(;;){let t=!1;if(this._walker.curPositionIsValid()){const i=new s.ps;this._walker.curPointAndAngle(i);const n=new s.ps;if(this._walker.nextPointAndAngle(this._period,n)){const o=new s.ps;this._walker.nextPointAndAngle(this._period,o)&&(r?(e.pushPoint(i.pt),r=!1):e.pushPoint(i.pt),e.pushXY(i.pt[0]-this._height/2*i.sa,i.pt[1]+this._height/2*i.ca),e.pushXY(n.pt[0]-this._height/2*n.sa,n.pt[1]+this._height/2*n.ca),e.pushXY(n.pt[0]+this._height/2*n.sa,n.pt[1]-this._height/2*n.ca),e.pushXY(o.pt[0]+this._height/2*o.sa,o.pt[1]-this._height/2*o.ca),t=!0)}}if(!t){e.pushPoint(this._walker.getPathEnd());break}}}_constructTriangle(e,t){Math.round(t/this._period);let r=!0;for(;;){let t=!1;if(this._walker.curPositionIsValid()){const i=new s.ps;this._walker.curPointAndAngle(i);const n=new s.ps;if(this._walker.nextPointAndAngle(this._period/2,n)){const o=new s.ps;this._walker.nextPointAndAngle(this._period,o)&&(this._walker.nextPosition(this._period/2)&&(r?(e.pushPoint(i.pt),r=!1):e.pushPoint(i.pt),e.pushXY(n.pt[0]-this._height/2*n.sa,n.pt[1]+this._height/2*n.ca),e.pushXY(o.pt[0]+this._height/2*o.sa,o.pt[1]-this._height/2*o.ca)),t=!0)}}if(!t){e.pushPoint(this._walker.getPathEnd());break}}}}},33389:function(e,t,r){var i,n,s,o,a,l,c,u,h,d,f,p,m,_,g,y,x,b,w,v,S,T,I,M,A,E,P,C,R,F,L,k,N,O,D,z,U,G,B,V,q,Z,H,j,W,Y,$,X,Q,J,K,ee,te,re,ie,ne,se,oe,ae,le,ce,ue;r.d(t,{$2:function(){return a},C1:function(){return s},Hz:function(){return p},JO:function(){return n},M1:function(){return I},O$:function(){return oe},Q1:function(){return $},TZ:function(){return x},WE:function(){return R},Y:function(){return c},YI:function(){return Q},bj:function(){return u},e_:function(){return Y},f0:function(){return se},fu:function(){return f},g7:function(){return h},ip:function(){return X},mU:function(){return F},oF:function(){return S},uQ:function(){return T},uT:function(){return U},vG:function(){return le},wd:function(){return q},xR:function(){return i},xn:function(){return b},xw:function(){return E},yS:function(){return G}}),function(e){e[e.BUTT=0]="BUTT",e[e.ROUND=1]="ROUND",e[e.SQUARE=2]="SQUARE",e[e.UNKNOWN=4]="UNKNOWN"}(i||(i={})),function(e){e[e.BEVEL=0]="BEVEL",e[e.ROUND=1]="ROUND",e[e.MITER=2]="MITER",e[e.UNKNOWN=4]="UNKNOWN"}(n||(n={})),function(e){e[e.SCREEN=0]="SCREEN",e[e.MAP=1]="MAP"}(s||(s={})),function(e){e[e.Tint=0]="Tint",e[e.Ignore=1]="Ignore",e[e.Multiply=99]="Multiply"}(o||(o={})),function(e){e.Both="Both",e.JustBegin="JustBegin",e.JustEnd="JustEnd",e.None="None"}(a||(a={})),function(e){e[e.Mosaic=0]="Mosaic",e[e.Centered=1]="Centered"}(l||(l={})),function(e){e[e.Normal=0]="Normal",e[e.Superscript=1]="Superscript",e[e.Subscript=2]="Subscript"}(c||(c={})),function(e){e[e.MSSymbol=0]="MSSymbol",e[e.Unicode=1]="Unicode"}(u||(u={})),function(e){e[e.Unspecified=0]="Unspecified",e[e.TrueType=1]="TrueType",e[e.PSOpenType=2]="PSOpenType",e[e.TTOpenType=3]="TTOpenType",e[e.Type1=4]="Type1"}(h||(h={})),function(e){e[e.Display=0]="Display",e[e.Map=1]="Map"}(d||(d={})),function(e){e.None="None",e.Loop="Loop",e.Oscillate="Oscillate"}(f||(f={})),function(e){e.Linear="Linear",e.EaseIn="EaseIn",e.EaseOut="EaseOut",e.EaseInOut="EaseInOut"}(p||(p={})),function(e){e[e.Z=0]="Z",e[e.X=1]="X",e[e.Y=2]="Y"}(m||(m={})),function(e){e[e.XYZ=0]="XYZ",e[e.ZXY=1]="ZXY",e[e.YXZ=2]="YXZ"}(_||(_={})),function(e){e[e.Rectangle=0]="Rectangle",e[e.RoundedRectangle=1]="RoundedRectangle",e[e.Oval=2]="Oval"}(g||(g={})),function(e){e[e.None=0]="None",e[e.Alpha=1]="Alpha",e[e.Screen=2]="Screen",e[e.Multiply=3]="Multiply",e[e.Add=4]="Add"}(y||(y={})),function(e){e[e.TTB=0]="TTB",e[e.RTL=1]="RTL",e[e.BTT=2]="BTT"}(x||(x={})),function(e){e[e.None=0]="None",e[e.SignPost=1]="SignPost",e[e.FaceNearPlane=2]="FaceNearPlane"}(b||(b={})),function(e){e[e.Float=0]="Float",e[e.String=1]="String",e[e.Boolean=2]="Boolean"}(w||(w={})),function(e){e[e.Intersect=0]="Intersect",e[e.Subtract=1]="Subtract"}(v||(v={})),function(e){e.OpenEnded="OpenEnded",e.Block="Block",e.Crossed="Crossed"}(S||(S={})),function(e){e.FullGeometry="FullGeometry",e.PerpendicularFromFirstSegment="PerpendicularFromFirstSegment",e.ReversedFirstSegment="ReversedFirstSegment",e.PerpendicularToSecondSegment="PerpendicularToSecondSegment",e.SecondSegmentWithTicks="SecondSegmentWithTicks",e.DoublePerpendicular="DoublePerpendicular",e.OppositeToFirstSegment="OppositeToFirstSegment",e.TriplePerpendicular="TriplePerpendicular",e.HalfCircleFirstSegment="HalfCircleFirstSegment",e.HalfCircleSecondSegment="HalfCircleSecondSegment",e.HalfCircleExtended="HalfCircleExtended",e.OpenCircle="OpenCircle",e.CoverageEdgesWithTicks="CoverageEdgesWithTicks",e.GapExtentWithDoubleTicks="GapExtentWithDoubleTicks",e.GapExtentMidline="GapExtentMidline",e.Chevron="Chevron",e.PerpendicularWithArc="PerpendicularWithArc",e.ClosedHalfCircle="ClosedHalfCircle",e.TripleParallelExtended="TripleParallelExtended",e.ParallelWithTicks="ParallelWithTicks",e.Parallel="Parallel",e.PerpendicularToFirstSegment="PerpendicularToFirstSegment",e.ParallelOffset="ParallelOffset",e.OffsetOpposite="OffsetOpposite",e.OffsetSame="OffsetSame",e.CircleWithArc="CircleWithArc",e.DoubleJog="DoubleJog",e.PerpendicularOffset="PerpendicularOffset",e.LineExcludingLastSegment="LineExcludingLastSegment",e.MultivertexArrow="MultivertexArrow",e.CrossedArrow="CrossedArrow",e.ChevronArrow="ChevronArrow",e.ChevronArrowOffset="ChevronArrowOffset",e.PartialFirstSegment="PartialFirstSegment",e.Arch="Arch",e.CurvedParallelTicks="CurvedParallelTicks",e.Arc90Degrees="Arc90Degrees",e.TipWithPerpendicularAndTicks="TipWithPerpendicularAndTicks",e.ConcentricCircles="ConcentricCircles",e.DoubleJogArrow="DoubleJogArrow",e.LinkedChevrons="LinkedChevrons",e.SegmentThenHalfCircle="SegmentThenHalfCircle",e.LineWithStraightTicks="LineWithStraightTicks",e.DoubleCurve="DoubleCurve",e.ParallelWithTicksByWidth="ParallelWithTicksByWidth",e.EnclosingRoundedRectangle="EnclosingRoundedRectangle"}(T||(T={})),function(e){e.Mitered="Mitered",e.Bevelled="Bevelled",e.Rounded="Rounded",e.Square="Square",e.TrueBuffer="TrueBuffer"}(I||(I={})),function(e){e.ClosePath="ClosePath",e.ConvexHull="ConvexHull",e.RectangularBox="RectangularBox"}(M||(M={})),function(e){e.BeginningOfLine="BeginningOfLine",e.EndOfLine="EndOfLine"}(A||(A={})),function(e){e.Mitered="Mitered",e.Bevelled="Bevelled",e.Rounded="Rounded",e.Square="Square"}(E||(E={})),function(e){e.Fast="Fast",e.Accurate="Accurate"}(P||(P={})),function(e){e.BeginningOfLine="BeginningOfLine",e.EndOfLine="EndOfLine"}(C||(C={})),function(e){e.Sinus="Sinus",e.Square="Square",e.Triangle="Triangle",e.Random="Random"}(R||(R={})),function(e){e[e.None=0]="None",e[e.Default=1]="Default",e[e.Force=2]="Force"}(F||(F={})),function(e){e[e.Buffered=0]="Buffered",e[e.Left=1]="Left",e[e.Right=2]="Right",e[e.AlongLine=3]="AlongLine"}(L||(L={})),function(e){e[e.Linear=0]="Linear",e[e.Rectangular=1]="Rectangular",e[e.Circular=2]="Circular",e[e.Buffered=3]="Buffered"}(k||(k={})),function(e){e[e.Discrete=0]="Discrete",e[e.Continuous=1]="Continuous"}(N||(N={})),function(e){e[e.AcrossLine=0]="AcrossLine",e[e.AloneLine=1]="AloneLine"}(O||(O={})),function(e){e[e.Left=0]="Left",e[e.Right=1]="Right",e[e.Center=2]="Center",e[e.Justify=3]="Justify"}(D||(D={})),function(e){e[e.Base=0]="Base",e[e.MidPoint=1]="MidPoint",e[e.ThreePoint=2]="ThreePoint",e[e.FourPoint=3]="FourPoint",e[e.Underline=4]="Underline",e[e.CircularCW=5]="CircularCW",e[e.CircularCCW=6]="CircularCCW"}(z||(z={})),function(e){e.Butt="Butt",e.Round="Round",e.Square="Square"}(U||(U={})),function(e){e.NoConstraint="NoConstraint",e.HalfPattern="HalfPattern",e.HalfGap="HalfGap",e.FullPattern="FullPattern",e.FullGap="FullGap",e.Custom="Custom"}(G||(G={})),function(e){e[e.None=-1]="None",e[e.Custom=0]="Custom",e[e.Circle=1]="Circle",e[e.OpenArrow=2]="OpenArrow",e[e.ClosedArrow=3]="ClosedArrow",e[e.Diamond=4]="Diamond"}(B||(B={})),function(e){e[e.ExtraLeading=0]="ExtraLeading",e[e.Multiple=1]="Multiple",e[e.Exact=2]="Exact"}(V||(V={})),function(e){e.Bevel="Bevel",e.Round="Round",e.Miter="Miter"}(q||(q={})),function(e){e[e.Default=0]="Default",e[e.String=1]="String",e[e.Numeric=2]="Numeric"}(Z||(Z={})),function(e){e[e.InsidePolygon=0]="InsidePolygon",e[e.PolygonCenter=1]="PolygonCenter",e[e.RandomlyInsidePolygon=2]="RandomlyInsidePolygon"}(H||(H={})),function(e){e[e.Tint=0]="Tint",e[e.Replace=1]="Replace",e[e.Multiply=2]="Multiply"}(j||(j={})),function(e){e[e.ClipAtBoundary=0]="ClipAtBoundary",e[e.RemoveIfCenterOutsideBoundary=1]="RemoveIfCenterOutsideBoundary",e[e.DoNotTouchBoundary=2]="DoNotTouchBoundary",e[e.DoNotClip=3]="DoNotClip"}(W||(W={})),function(e){e.NoConstraint="NoConstraint",e.WithMarkers="WithMarkers",e.WithFullGap="WithFullGap",e.WithHalfGap="WithHalfGap",e.Custom="Custom"}(Y||(Y={})),function(e){e.Fixed="Fixed",e.Random="Random",e.RandomFixedQuantity="RandomFixedQuantity"}($||($={})),function(e){e.LineMiddle="LineMiddle",e.LineBeginning="LineBeginning",e.LineEnd="LineEnd",e.SegmentMidpoint="SegmentMidpoint"}(X||(X={})),function(e){e.OnPolygon="OnPolygon",e.CenterOfMass="CenterOfMass",e.BoundingBoxCenter="BoundingBoxCenter"}(Q||(Q={})),function(e){e[e.Low=0]="Low",e[e.Medium=1]="Medium",e[e.High=2]="High"}(J||(J={})),function(e){e[e.MarkerCenter=0]="MarkerCenter",e[e.MarkerBounds=1]="MarkerBounds"}(K||(K={})),function(e){e[e.None=0]="None",e[e.PropUniform=1]="PropUniform",e[e.PropNonuniform=2]="PropNonuniform",e[e.DifUniform=3]="DifUniform",e[e.DifNonuniform=4]="DifNonuniform"}(ee||(ee={})),function(e){e.Tube="Tube",e.Strip="Strip",e.Wall="Wall"}(te||(te={})),function(e){e[e.Random=0]="Random",e[e.Increasing=1]="Increasing",e[e.Decreasing=2]="Decreasing",e[e.IncreasingThenDecreasing=3]="IncreasingThenDecreasing"}(re||(re={})),function(e){e[e.Relative=0]="Relative",e[e.Absolute=1]="Absolute"}(ie||(ie={})),function(e){e[e.Normal=0]="Normal",e[e.LowerCase=1]="LowerCase",e[e.Allcaps=2]="Allcaps"}(ne||(ne={})),function(e){e[e.LTR=0]="LTR",e[e.RTL=1]="RTL"}(se||(se={})),function(e){e.Draft="Draft",e.Picture="Picture",e.Text="Text"}(oe||(oe={})),function(e){e[e.Top=0]="Top",e[e.Center=1]="Center",e[e.Baseline=2]="Baseline",e[e.Bottom=3]="Bottom"}(ae||(ae={})),function(e){e[e.Right=0]="Right",e[e.Upright=1]="Upright"}(le||(le={})),function(e){e[e.Small=0]="Small",e[e.Medium=1]="Medium",e[e.Large=2]="Large"}(ce||(ce={})),function(e){e[e.Calm=0]="Calm",e[e.Rippled=1]="Rippled",e[e.Slight=2]="Slight",e[e.Moderate=3]="Moderate"}(ue||(ue={}))},84646:function(e,t,r){r.d(t,{l:function(){return n}});var i=r(9635);class n{static getPlacement(e,t,r,n,s,o){const a=(0,i.c)(r);return a?(-1===t&&e.invertY(),a.execute(e,r,n,s,o)):null}}},31771:function(e,t,r){r.d(t,{e:function(){return o}});var i=r(23454),n=r(33389),s=r(65661);class o{static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(e,t,r,i,n){return new a(e,t,r)}}o.instance=null;class a extends i.pC{constructor(e,t,r){super(e),this._geometryWalker=new s.Z1,this._geometryWalker.updateTolerance(r),this._angleToLine=t.angleToLine??!0,this._offset=(t.offset?t.offset:0)*r,this._originalEndings=t.endings,this._offsetAtEnd=(t.customEndingOffset?t.customEndingOffset:0)*r,this._position=-(t.offsetAlongLine?t.offsetAlongLine:0)*r,this._pattern=new s.VA,this._pattern.init(t.placementTemplate,!1),this._pattern.scale(r),this._endings=this._originalEndings}processPath(e){if(this._pattern.isEmpty())return null;let t;if(this.iteratePath)t=this._pattern.nextValue();else{this._originalEndings===n.e_.WithFullGap&&this.isClosed?this._endings=n.e_.WithMarkers:this._endings=this._originalEndings,this._pattern.extPtGap=0;let r,i=!0;switch(this._endings){case n.e_.NoConstraint:r=-this._position,r=this._adjustPosition(r),i=!1;break;case n.e_.WithHalfGap:default:r=-this._pattern.lastValue()/2;break;case n.e_.WithFullGap:r=-this._pattern.lastValue(),this._pattern.extPtGap=this._pattern.lastValue();break;case n.e_.WithMarkers:r=0;break;case n.e_.Custom:r=-this._position,r=this._adjustPosition(r),this._pattern.extPtGap=.5*this._offsetAtEnd}if(!this._geometryWalker.init(e,this._pattern,i))return null;this._pattern.reset();let s=0;for(;r>s;)r-=s,s=this._pattern.nextValue();s-=r,t=s,this.iteratePath=!0}const r=new s.ps;return this._geometryWalker.nextPointAndAngle(t,r)?this._endings===n.e_.WithFullGap&&this._geometryWalker.isPathEnd()?(this.iteratePath=!1,null):this._endings===n.e_.WithMarkers&&this._geometryWalker.isPathEnd()&&(this.iteratePath=!1,this.isClosed)?null:(this.internalPlacement.setTranslate(r.pt[0]-this._offset*r.sa,r.pt[1]+this._offset*r.ca),this._angleToLine&&this.internalPlacement.setRotateCS(r.ca,r.sa),this.internalPlacement):(this.iteratePath=!1,null)}_adjustPosition(e){let t=e/this._pattern.length();return t-=Math.floor(t),t*this._pattern.length()}}},15987:function(e,t,r){r.d(t,{y:function(){return o}});var i=r(23454),n=r(93996),s=r(33389);class o{static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(e,t,r,i,n){return new a(e,t,r)}}o.instance=null;class a extends i.pC{constructor(e,t,r){super(e,!1,!0),this._curveHelper=new n.I,this._placePerPart=t.placePerPart??!1,this._angleToLine=void 0===t.angleToLine||t.angleToLine,this._offset=void 0!==t.offset?t.offset*r:0,this._type=t.extremityPlacement,this._position=void 0!==t.offsetAlongLine?t.offsetAlongLine*r:0,this._beginProcessed=!1}processMultiPath(e){return this._placePerPart?super.processMultiPath(e):this.processPath(e)}processPath(e){let t;switch(this._type){case s.$2.Both:default:this._beginProcessed?(t=this._atExtremities(e,this._position,!1),this._beginProcessed=!1,this.iterateMultiPath=!1,this.iteratePath=!1):(t=this._atExtremities(e,this._position,!0),this._beginProcessed=!0,this.iterateMultiPath=!0,this.iteratePath=!0);break;case s.$2.JustBegin:t=this._atExtremities(e,this._position,!0);break;case s.$2.JustEnd:t=this._atExtremities(e,this._position,!1);case s.$2.None:}return t}_atExtremities(e,t,r){if(this._placePerPart||(r?e.seekPath(0):e.seekPath(e.totalSize-1)),r||e.seekPathEnd(),r?e.nextPoint():e.prevPoint()){let i=0,[n,s]=[0,0],[o,a]=[e.x,e.y];for(;r?e.nextPoint():e.prevPoint();){n=o,s=a,o=e.x,a=e.y;const r=this._curveHelper.getLength(n,s,o,a);if(i+r>t){const e=(t-i)/r,[l,c]=this._curveHelper.getAngleCS(n,s,o,a,e),u=this._curveHelper.getCoord2D(n,s,o,a,e);return this.internalPlacement.setTranslate(u[0]-this._offset*c,u[1]+this._offset*l),this._angleToLine&&this.internalPlacement.setRotateCS(-l,-c),this.internalPlacement}i+=r}}return null}}},19511:function(e,t,r){r.d(t,{S:function(){return s}});var i=r(23454),n=r(65661);class s{static local(){return null===s.instance&&(s.instance=new s),s.instance}execute(e,t,r,i,n){return new o(e,t,r)}}s.instance=null;class o extends i.pC{constructor(e,t,r){super(e),this._walker=new n.Z1,this._walker.updateTolerance(r),this._angleToLine=void 0===t.angleToLine||t.angleToLine,this._offset=void 0!==t.offset?t.offset*r:0,this._beginGap=void 0!==t.beginPosition?t.beginPosition*r:0,this._endGap=void 0!==t.endPosition?t.endPosition*r:0,this._flipFirst=void 0===t.flipFirst||t.flipFirst,this._pattern=new n.VA,this._pattern.init(t.positionArray,!1,!1),this._subPathLen=0,this._posCount=this._pattern.size(),this._isFirst=!0,this._prevPos=0}processPath(e){if(this._pattern.isEmpty())return null;let t;if(this.iteratePath){const e=this._pattern.nextValue()*this._subPathLen,r=this._beginGap+e;t=r-this._prevPos,this._prevPos=r}else{if(this._posCount=this._pattern.size(),this._isFirst=!0,this._prevPos=0,this._subPathLen=e.pathLength()-this._beginGap-this._endGap,this._subPathLen<0)return this.iteratePath=!1,null;if(!this._walker.init(e,this._pattern,!1))return null;this._pattern.reset();const r=this._pattern.nextValue()*this._subPathLen,i=this._beginGap+r;t=i-this._prevPos,this._prevPos=i,this.iteratePath=!0}const r=new n.ps;if(!this._walker.nextPointAndAngle(t,r,n.YQ.END))return this.iteratePath=!1,null;this.internalPlacement.setTranslate(r.pt[0]-this._offset*r.sa,r.pt[1]+this._offset*r.ca);const i=this._isFirst&&this._flipFirst;let s,o;return this._angleToLine?(s=r.ca,o=r.sa):(s=1,o=0),i&&(s=-s,o=-o),this.internalPlacement.setRotateCS(s,o),this._isFirst=!1,this._posCount--,0===this._posCount&&(this.iteratePath=!1),this.internalPlacement}}},20305:function(e,t,r){r.d(t,{M:function(){return c}});var i=r(13798),n=r(29076),s=r(33389);const o=512,a=24,l=1e-6;class c{static local(){return null===c.instance&&(c.instance=new c),c.instance}execute(e,t,r,i,n){return new u(e,t,r,i,n)}}c.instance=null;class u{constructor(e,t,r,a,l){if(this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,this._currentX=0,this._currentY=0,this._accelerationMap=null,this._testInsidePolygon=!1,this._verticalSubdivision=!0,this._stepX=Math.abs(t.stepX??16)*r,this._stepY=Math.abs(t.stepY??16)*r,this._stepX=Math.round(128*this._stepX)/128,this._stepY=Math.round(128*this._stepY)/128,0!==this._stepX&&0!==this._stepY){if(this._gridType=t.gridType??s.Q1.Fixed,this._gridType===s.Q1.Random){const e=t.seed??13,r=1;this._randomLCG=new i.A(e*r),this._randomness=(t.randomness??100)/100,this._gridAngle=0,this._shiftOddRows=!1,this._cosAngle=1,this._sinAngle=0,this._offsetX=0,this._offsetY=0,this._buildRandomValues()}else{if(this._randomness=0,this._gridAngle=t.gridAngle??0,this._shiftOddRows=t.shiftOddRows??!1,this._offsetX=(t.offsetX??0)*r,this._offsetY=(t.offsetY??0)*r,this._cosAngle=Math.cos(this._gridAngle/180*Math.PI),this._sinAngle=-Math.sin(this._gridAngle/180*Math.PI),this._stepX)if(this._offsetX<0)for(;this._offsetX<-.5*this._stepX;)this._offsetX+=this._stepX;else for(;this._offsetX>=.5*this._stepX;)this._offsetX-=this._stepX;if(this._stepY)if(this._offsetY<0)for(;this._offsetY<-.5*this._stepY;)this._offsetY+=this._stepY;else for(;this._offsetY>=.5*this._stepY;)this._offsetY-=this._stepY}if(this._graphicOriginX=0,this._graphicOriginY=0,null!=a){const[e,t,r,i]=a.split("/"),n=parseFloat(e),s=parseFloat(t),l=parseFloat(r),c=parseFloat(i);this._graphicOriginX=-(c*2**n+l)*o,this._graphicOriginY=s*o,this._testInsidePolygon=!0}this._internalPlacement=new n.W,this._calculateMinMax(e),this._geometryCursor=e}}next(){return this._geometryCursor?this._nextInside():null}_buildRandomValues(){if(!u._randValues){u._randValues=[];for(let e=0;e<a;e++)for(let e=0;e<a;e++)u._randValues.push(this._randomLCG.getFloat()),u._randValues.push(this._randomLCG.getFloat())}}_calculateMinMax(e){let t,r,i,n,s,a,l,c,u,h,d,f,p,m;this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,l=c=p=d=Number.MAX_VALUE,u=h=m=f=-Number.MAX_VALUE;const _=1!==this._cosAngle;for(e.reset();e.nextPath();)for(;e.nextPoint();)a=e.x,s=e.y,t=a-this._graphicOriginX-this._offsetX,r=s-this._graphicOriginY-this._offsetY,_?(i=this._cosAngle*t-this._sinAngle*r,n=this._sinAngle*t+this._cosAngle*r):(i=t,n=r),l=Math.min(l,i),u=Math.max(u,i),c=Math.min(c,n),h=Math.max(h,n),d=Math.min(d,s),f=Math.max(f,s),p=Math.min(p,a),m=Math.max(m,a);d=d!==Number.MAX_VALUE?d:-o-this._stepY,f=f!==-Number.MAX_VALUE?f:this._stepY,p=p!==Number.MAX_VALUE?p:-this._stepX,m=m!==-Number.MAX_VALUE?m:o+this._stepX;const g=f-d,y=m-p;if(this._verticalSubdivision=g>=y,this._polygonMin=this._verticalSubdivision?d:p,this._testInsidePolygon){let e=0-this._graphicOriginX-this._offsetX-this._stepX,t=o-this._graphicOriginX-this._offsetX+this._stepX,r=-o-this._graphicOriginY-this._offsetY-this._stepY,i=0-this._graphicOriginY-this._offsetY+this._stepY;if(_){const n=[[e,r],[e,i],[t,r],[t,i]];e=r=Number.MAX_VALUE,t=i=-Number.MAX_VALUE;for(const s of n){const n=this._cosAngle*s[0]-this._sinAngle*s[1],o=this._sinAngle*s[0]+this._cosAngle*s[1];e=Math.min(e,n),t=Math.max(t,n),r=Math.min(r,o),i=Math.max(i,o)}}l=l!==Number.MAX_VALUE?Math.max(l,e):e,c=c!==Number.MAX_VALUE?Math.max(c,r):r,u=u!==-Number.MAX_VALUE?Math.min(u,t):t,h=h!==-Number.MAX_VALUE?Math.min(h,i):i}this._xMin=Math.round(l/this._stepX),this._xMax=Math.round(u/this._stepX),this._yMin=Math.round(c/this._stepY),this._yMax=Math.round(h/this._stepY),this._currentX=this._xMax+1,this._currentY=this._yMin-1,this._buildAccelerationMap(e,p,m,d,f)}_buildAccelerationMap(e,t,r,i,n){e.reset();const s=new Map,a=this._verticalSubdivision,l=a?n-i:r-t;let c=Math.ceil(l/10);if(c<=1)return;const u=Math.floor(l/c);let d,f,p,m,_,g,y,x,b,w,v;for(c++,this._delta=u,a?(b=-o-2*this._stepY,w=2*this._stepY,v=i):(b=-2*this._stepX,w=o+2*this._stepX,v=t);e.nextPath();)if(!(e.pathSize<2)&&e.nextPoint())for(d=e.x,f=e.y;e.nextPoint();d=p,f=m){if(p=e.x,m=e.y,a){if(f===m||f<b&&m<b||f>w&&m>w)continue;_=Math.min(f,m),g=Math.max(f,m)}else{if(d===p||d<b&&p<b||d>w&&p>w)continue;_=Math.min(d,p),g=Math.max(d,p)}for(;_<g;)y=Math.floor((_-v)/u),h(y,d,f,p,m,s),_+=u;x=Math.floor((g-v)/u),x>y&&h(x,d,f,p,m,s)}this._accelerationMap=s}_nextInside(){for(;;){if(this._currentX>this._xMax){if(this._currentY++,this._currentY>this._yMax)return null;this._currentX=this._xMin,this._shiftOddRows&&this._currentY%2&&this._currentX--}let e=this._currentX*this._stepX+this._offsetX;this._shiftOddRows&&this._currentY%2&&(e+=.5*this._stepX);const t=this._currentY*this._stepY+this._offsetY;let r,i;if(this._currentX++,this._gridType===s.Q1.Random){const n=(this._currentX%a+a)%a,s=(this._currentY%a+a)%a;r=this._graphicOriginX+e+this._stepX*this._randomness*(.5-u._randValues[s*a+n])*2/3,i=this._graphicOriginY+t+this._stepY*this._randomness*(.5-u._randValues[s*a+n+1])*2/3}else r=this._graphicOriginX+this._cosAngle*e+this._sinAngle*t,i=this._graphicOriginY-this._sinAngle*e+this._cosAngle*t;if(!this._testInsidePolygon||this._isInsidePolygon(r,i,this._geometryCursor))return this._internalPlacement.setTranslate(r,i),this._internalPlacement}}_isInsidePolygon(e,t,r){if(null==this._accelerationMap)return function(e,t,r){let i,n,s,o,a=0;for(e+=l,t+=l,r.reset();r.nextPath();)if(r.nextPoint())for(i=r.x,n=r.y;r.nextPoint();i=s,n=o)s=r.x,o=r.y,n>t!=o>t&&((s-i)*(t-n)-(o-n)*(e-i)>0?a++:a--);return 0!==a}(e,t,r);e+=l,t+=l;const i=this._verticalSubdivision,n=i?t:e,s=Math.floor((n-this._polygonMin)/this._delta),o=this._accelerationMap.get(s);if(!o)return!1;let a,c,u,h=0;for(const r of o){if(a=r[0],c=r[1],i){if(a[1]>t==c[1]>t)continue;u=(c[0]-a[0])*(t-a[1])-(c[1]-a[1])*(e-a[0])}else{if(a[0]>e==c[0]>e)continue;u=(c[1]-a[1])*(e-a[0])-(c[0]-a[0])*(t-a[1])}u>0?h++:h--}return 0!==h}}function h(e,t,r,i,n,s){let o=s.get(e);o||(o=[],s.set(e,o)),o.push([[t,r],[i,n]])}},58892:function(e,t,r){r.d(t,{R:function(){return o}});var i=r(23454),n=r(93996),s=r(33389);class o{static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(e,t,r,i,n){return new a(e,t,r)}}o.instance=null;class a extends i.pC{constructor(e,t,r){super(e),this._curveHelper=new n.I,this._angleToLine=void 0===t.angleToLine||t.angleToLine,this._offset=void 0!==t.offset?t.offset*r:0,this._relativeTo=t.relativeTo,this._position=void 0!==t.startPointOffset?t.startPointOffset*r:0,this._epsilon=.001*r}processPath(e){const t=this._position;if(this._relativeTo===s.ip.SegmentMidpoint){if(this.iteratePath||(this.iteratePath=!0),e.nextPoint()){let[t,r]=[e.x,e.y],[i,n]=[0,0];for(;e.nextPoint();){i=e.x,n=e.y;const s=this._curveHelper.getLength(t,r,i,n);if(s<this._epsilon){t=i,r=n;continue}const o=.5+this._position/s,[a,l]=this._curveHelper.getAngleCS(t,r,i,n,o),c=this._curveHelper.getCoord2D(t,r,i,n,o);return this.internalPlacement.setTranslate(c[0]-this._offset*l,c[1]+this._offset*a),this._angleToLine&&this.internalPlacement.setRotateCS(a,l),this.internalPlacement}}return this.iteratePath=!1,null}const r=this._relativeTo===s.ip.LineEnd;return this.onLine(e,t,r)}onLine(e,t,r){let i,n=!1;switch(this._relativeTo){case s.ip.LineMiddle:default:e.seekPathStart(),i=e.pathLength()/2+t;break;case s.ip.LineBeginning:i=t;break;case s.ip.LineEnd:i=t,n=!0}r?e.seekPathEnd():e.seekPathStart();let o=0;if(r?e.prevPoint():e.nextPoint()){let[t,s]=[e.x,e.y],[a,l]=[0,0];for(;r?e.prevPoint():e.nextPoint();){a=e.x,l=e.y;const r=this._curveHelper.getLength(t,s,a,l);if(o+r>i){const e=(i-o)/r,[c,u]=this._curveHelper.getAngleCS(t,s,a,l,e),h=this._curveHelper.getCoord2D(t,s,a,l,e),d=n?-this._offset:this._offset;return this.internalPlacement.setTranslate(h[0]-d*u,h[1]+d*c),this._angleToLine&&(n?this.internalPlacement.setRotateCS(-c,-u):this.internalPlacement.setRotateCS(c,u)),this.internalPlacement}t=a,s=l,o+=r}}return null}}},80585:function(e,t,r){r.d(t,{A:function(){return s}});var i=r(23454),n=r(93996);class s{static local(){return null===s.instance&&(s.instance=new s),s.instance}execute(e,t,r,i,n){return new o(e,t,r)}}s.instance=null;class o extends i.pC{constructor(e,t,r){super(e),this._curveHelper=new n.I,this._angleToLine=void 0===t.angleToLine||t.angleToLine,this._offset=void 0!==t.offset?t.offset*r:0,this._endPoints=void 0===t.placeOnEndPoints||t.placeOnEndPoints,this._controlPoints=void 0===t.placeOnControlPoints||t.placeOnControlPoints,this._regularVertices=void 0===t.placeOnRegularVertices||t.placeOnRegularVertices,this._tags=[],this._tagIterator=0}processPath(e){if(this.iteratePath||(this._preparePath(e),this.iteratePath=!0),this._tagIterator>=this._tags.length)return this._tags.length=0,this._tagIterator=0,this.iteratePath=!1,null;const t=this._tags[this._tagIterator];this._angleToLine&&this.internalPlacement.setRotate(t[2]);let r=t[0],i=t[1];if(0!==this._offset){const e=Math.cos(t[2]),n=Math.sin(t[2]);r-=this._offset*n,i+=this._offset*e}return this.internalPlacement.setTranslate(r,i),this._tagIterator++,this.internalPlacement}_preparePath(e){this._tags.length=0,this._tagIterator=0,e.seekPathStart();const t=e.isClosed();let r=0,i=!1,n=0,s=0;if(e.seekPathStart(),e.nextPoint()){let o=e.x,l=e.y,c=e.getControlPoint(),u=!0,h=e.nextPoint();for(;h;){const d=e.x,f=e.y,p=e.getControlPoint();(this._angleToLine||0!==this._offset)&&(n=this._curveHelper.getAngle(o,l,d,f,0)),u?(u=!1,t?(r=n,i=c):(this._endPoints||this._controlPoints&&c)&&this._tags.push([o,l,n])):c?this._controlPoints&&this._tags.push([o,l,a(s,n)]):this._regularVertices&&this._tags.push([o,l,a(s,n)]),(this._angleToLine||0!==this._offset)&&(s=this._curveHelper.getAngle(o,l,d,f,1)),h=e.nextPoint(),h||(t?p||i?this._controlPoints&&this._tags.push([d,f,a(s,r)]):this._regularVertices&&this._tags.push([d,f,a(s,r)]):(this._endPoints||this._controlPoints&&p)&&this._tags.push([d,f,s])),o=d,l=f,c=p}}this._tagIterator=0}}function a(e,t){const r=Math.PI;for(;Math.abs(t-e)>r+2e-15;)t-e>r?t-=2*r:t+=2*r;return(e+t)/2}},58676:function(e,t,r){r.d(t,{L:function(){return l}});var i=r(35068),n=r(72228),s=r(30804),o=r(29076),a=r(33389);class l{static local(){return null===l.instance&&(l.instance=new l),l.instance}execute(e,t,r,i,n){return new c(e,t,r)}}l.instance=null;class c{constructor(e,t,r){this._geometryCursor=e,this._offsetX=void 0!==t.offsetX?t.offsetX*r:0,this._offsetY=void 0!==t.offsetY?t.offsetY*r:0,this._method=void 0!==t.method?t.method:a.YI.OnPolygon,this._placementPerPart=void 0!==t.placePerPart&&t.placePerPart,this._internalPlacement=new o.W}next(){const e=this._geometryCursor;if(!e)return null;if(!this._placementPerPart)return this._geometryCursor=null,this._polygonCenter(e);for(;e.nextPath();)if(!(e.getCurrentRingArea()<0))return this._polygonCenter(e.getCurrentPath());return this._geometryCursor=null,null}_polygonCenter(e){let t=!1;switch(this._method){case a.YI.CenterOfMass:{const r=(0,n.TP)(e);r&&(this._internalPlacement.setTranslate(r[0]+this._offsetX,r[1]+this._offsetY),t=!0)}break;case a.YI.BoundingBoxCenter:{const r=(0,i.z8)(e);r&&(this._internalPlacement.setTranslate((r[2]+r[0])/2+this._offsetX,(r[3]+r[1])/2+this._offsetY),t=!0)}break;case a.YI.OnPolygon:default:{const r=(0,s.d)(e);null!==r&&(this._internalPlacement.setTranslate(r[0]+this._offsetX,r[1]+this._offsetY),t=!0)}}return t?this._internalPlacement:null}}},7590:function(e,t,r){r.d(t,{$w:function(){return g},Bu:function(){return C},DW:function(){return M},FH:function(){return G},FM:function(){return c},G9:function(){return s},GV:function(){return x},Go:function(){return u},K3:function(){return U},Kn:function(){return T},MM:function(){return f},MO:function(){return q},Nl:function(){return R},Ny:function(){return b},O2:function(){return F},UE:function(){return L},YC:function(){return V},YF:function(){return N},ZO:function(){return D},_1:function(){return E},_H:function(){return v},_W:function(){return y},_d:function(){return I},bs:function(){return B},dI:function(){return $},e6:function(){return h},gQ:function(){return l},iA:function(){return z},jn:function(){return m},lW:function(){return d},mA:function(){return p},n5:function(){return k},pM:function(){return A},pV:function(){return S},pk:function(){return Z},rB:function(){return H},s4:function(){return n},xo:function(){return P},yH:function(){return w},zb:function(){return O},zr:function(){return _}});var i=r(38821);function n(e,t,r,i){return function(e){return"function"==typeof e}(e)?e(t,r,i):e}function s(e){return[e.r,e.g,e.b,e.a]}const o=" /-,\n";function a(e){let t=e.length;for(;t--;)if(!o.includes(e.charAt(t)))return!1;return!0}function l(e,t){const r=[];let i=0,n=-1;do{if(n=e.indexOf("[",i),n>=i){if(n>i){const t=e.slice(i,n);r.push([t,null,a(t)])}if(i=n+1,n=e.indexOf("]",i),n>=i){if(n>i){const s=t[e.slice(i,n)];s&&r.push([null,s,!1])}i=n+1}}}while(-1!==n);if(i<e.length){const t=e.slice(i);r.push([t,null,a(t)])}return r}function c(e,t,r,i){let n="",s=null;for(const i of t){const[t,o,a]=i;if(t)a?s=t:(s&&(n+=s,s=null),n+=t);else{let t=o;null!=r&&(t=q(o,r));const i=e.attributes[t];i&&(s&&(n+=s,s=null),n+=i)}}return function(e,t){switch("string"!=typeof e&&(e=String(e)),t){case"LowerCase":return e.toLowerCase();case"Allcaps":return e.toUpperCase();default:return e}}(n,i)}function u(e,t,r,i,n,s,o=!0){const a=t/n,l=r/s,c=Math.ceil(a/2),u=Math.ceil(l/2);for(let r=0;r<s;r++)for(let h=0;h<n;h++){const d=4*(h+(o?s-r-1:r)*n);let f=0,p=0,m=0,_=0,g=0,y=0,x=0;const b=(r+.5)*l;for(let i=Math.floor(r*l);i<(r+1)*l;i++){const r=Math.abs(b-(i+.5))/u,n=(h+.5)*a,s=r*r;for(let r=Math.floor(h*a);r<(h+1)*a;r++){let o=Math.abs(n-(r+.5))/c;const a=Math.sqrt(s+o*o);a>=-1&&a<=1&&(f=2*a*a*a-3*a*a+1,f>0&&(o=4*(r+i*t),x+=f*e[o+3],m+=f,e[o+3]<255&&(f=f*e[o+3]/250),_+=f*e[o],g+=f*e[o+1],y+=f*e[o+2],p+=f))}}i[d]=_/p,i[d+1]=g/p,i[d+2]=y/p,i[d+3]=x/m}}function h(e){return e?[e[0],e[1],e[2],e[3]/255]:[0,0,0,0]}function d(e){return e.data?.symbol??null}function f(e){return"CIMVectorMarker"===e.type||"CIMPictureMarker"===e.type||"CIMBarChartMarker"===e.type||"CIMCharacterMarker"===e.type||"CIMPieChartMarker"===e.type||"CIMStackedBarChartMarker"===e.type}function p(e){return"CIMGradientStroke"===e.type||"CIMPictureStroke"===e.type||"CIMSolidStroke"===e.type}function m(e){return null!=e&&("CIMGradientFill"===e.type||"CIMHatchFill"===e.type||"CIMPictureFill"===e.type||"CIMSolidFill"===e.type||"CIMWaterFill"===e.type)}function _(e){return null!=e&&("CIMMarkerPlacementAlongLineRandomSize"===e.type||"CIMMarkerPlacementAlongLineSameSize"===e.type||"CIMMarkerPlacementAlongLineVariableSize"===e.type||"CIMMarkerPlacementAtExtremities"===e.type||"CIMMarkerPlacementAtMeasuredUnits"===e.type||"CIMMarkerPlacementAtRatioPositions"===e.type||"CIMMarkerPlacementOnLine"===e.type||"CIMMarkerPlacementOnVertices"===e.type)}const g=(e,t=0)=>null==e||isNaN(e)?t:e,y=(e,t)=>null!=e?e:t,x=(e,t)=>e??t,b=e=>e.tintColor?h(e.tintColor):[255,255,255,1],w=e=>{if(!e)return!1;for(const t of e)switch(t.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":case"CIMGeometricEffectDonut":return!0}return!1};function v(){return r.e(4696).then(r.bind(r,28356))}function S(e){if(!e)return"normal";switch(e.toLowerCase()){case"italic":return"italic";case"oblique":return"oblique";default:return"normal"}}function T(e){if(!e)return"normal";switch(e.toLowerCase()){case"bold":return"bold";case"bolder":return"bolder";case"lighter":return"lighter";default:return"normal"}}function I(e){let t="normal",r="normal";if(e){const i=e.toLowerCase();i.includes("italic")?t="italic":i.includes("oblique")&&(t="oblique"),i.includes("bold")?r="bold":i.includes("light")&&(r="lighter")}return{style:t,weight:r}}function M(e){return e.underline?"underline":e.strikethrough?"line-through":"none"}function A(e){if(!e)return null;switch(e.type){case"CIMPolygonSymbol":if(e.symbolLayers)for(const t of e.symbolLayers){const e=A(t);if(null!=e)return e}break;case"CIMTextSymbol":return A(e.symbol);case"CIMSolidFill":return e.color}return null}function E(e){if(e)switch(e.type){case"CIMPolygonSymbol":case"CIMLineSymbol":{const t=e.symbolLayers;if(t)for(const e of t){const t=E(e);if(null!=t)return t}break}case"CIMTextSymbol":return E(e.symbol);case"CIMSolidStroke":return e.color}}function P(e){if(e)switch(e.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(e.symbolLayers)for(const t of e.symbolLayers){const e=P(t);if(void 0!==e)return e}break;case"CIMTextSymbol":return P(e.symbol);case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return e.width}}function C(e){switch(e){case"Left":default:return"left";case"Right":return"right";case"Center":case"Justify":return"center"}}function R(e){switch(e){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function F(e){return(e?Object.keys(e):[]).map((t=>({name:t,alias:t,type:"string"==typeof e[t]?"esriFieldTypeString":"esriFieldTypeDouble"})))}const L=e=>e.includes("data:image/svg+xml");function k(e){if(!e)return null;switch(e.type){case"CIMPointSymbol":case"CIMTextSymbol":return"esriGeometryPoint";case"CIMLineSymbol":return"esriGeometryPolyline";case"CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}}function N(e){return e?e.charAt(0).toLowerCase()+e.slice(1):e}function O(e,t,r,i,n,s,o=!0){const{infos:a}=s;let l=1,c=0,u=0,h=0,d=1;for(const{absoluteAnchorPoint:e,offsetX:t,offsetY:r,rotation:i,size:n,frameHeight:s,rotateClockWise:f,scaleSymbolsProportionally:p}of a)d=e?1:l,u=W(t,r,c,d,u),h=j(t,r,c,d,h),s&&(p||o)&&(l*=n/s),c=Y(i,f,c);const f=W(i,n,c,d,u),p=j(i,n,c,d,h);return{size:e*l,rotation:Y(t,r,c),offsetX:f,offsetY:p}}function D(e){if(null==e)return!1;if(Array.isArray(e))return e.every((e=>D(e)));switch(typeof e){case"string":return!!e;case"number":return!isNaN(e)}}function z(e,t){if("color"===t||"outlinecolor"===t||"backgroundcolor"===t||"borderlinecolor"===t||"tintcolor"===t)return[...i.K[t]];const r=i.D[e];if(!r)throw new Error(`InternalError: default value for type ${e}.`);return r[t]}function U(e){return"string"==typeof e?function(e){return e.split(" ").map((e=>Number(e)))}(e):e}function G(e){return e?.dashTemplate&&(e.dashTemplate=U(e.dashTemplate)),e}function B(e){if(null==e)return"Normal";switch(e.type){case"CIMTextSymbol":return e.textCase??"Normal";case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const t=e.symbolLayers;if(!t)return"Normal";for(const e of t)if("CIMVectorMarker"===e.type)return B(e)}break;case"CIMVectorMarker":{const t=e.markerGraphics;if(!t)return"Normal";for(const e of t)if(e.symbol)return B(e.symbol)}}return"Normal"}function V(e){if(e)switch(e.type){case"CIMTextSymbol":return e.height;case"CIMPointSymbol":{let t=0;if(e.symbolLayers)for(const r of e.symbolLayers)if(r)switch(r.type){case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":{const e=r.size??i.D.CIMVectorMarker.size;e>t&&(t=e);break}}return t}case"CIMLineSymbol":case"CIMPolygonSymbol":{let t=0;if(e.symbolLayers)for(const r of e.symbolLayers)if(r)switch(r.type){case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":{const e=r.width;null!=e&&e>t&&(t=e);break}case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":if(r.markerPlacement&&_(r.markerPlacement)){const e=r.size??i.D.CIMVectorMarker.size;e>t&&(t=e)}break;case"CIMPictureFill":{const e=r.height;null!=e&&e>t&&(t=e)}}return t}}}function q(e,t){if(null!==t){const r=t.get(e);return r?r.name:e}return e}function Z(e){return e.map((e=>({...e,propertyName:N(e.propertyName)})))}function H(e){const t={};for(const r in e){const i=e[r];t[N(r)]=i}return t}function j(e,t,r,i,n){const s=r*Math.PI/180;if(s){const r=Math.cos(s);return(Math.sin(s)*e+r*t)*i+n}return t*i+n}function W(e,t,r,i,n){const s=r*Math.PI/180;return s?(Math.cos(s)*e-Math.sin(s)*t)*i+n:e*i+n}function Y(e,t,r){return t?r-e:r+e}function $(e,t,r){const i="Color"===r||"TintColor"===r||"ToColor"===r,n="Rotation"===r||"Angle"===r||"ToRotation"===r;let s=t[N(r)];if(null!=s&&(i?s=[s[0]/255,s[1]/255,s[2]/255,s[3]/255]:n&&(s*=Math.PI/180)),null==s&&(s=z(t.type,r.toLowerCase()),null!=s&&(i?s=[s[0]/255,s[1]/255,s[2]/255,s[3]]:n&&(s*=Math.PI/180))),null!=t.primitiveName){const o=e[t.primitiveName];if(null!=o){const e=o[r];null==e||("string"==typeof e||"number"==typeof e||Array.isArray(e)?(s=e,null!=s&&(i?s=[s[0]/255,s[1]/255,s[2]/255,s[3]/255]:n&&(s*=Math.PI/180))):(s={valueExpressionInfo:e,defaultValue:s},null!=s&&(i?s={type:"Process",op:"ArcadeColor",value:s}:n&&(s={type:"Process",op:"Divide",left:s,right:180/Math.PI}))))}}if(null==s)throw new Error(`Failed to derive a value or an expression for "${r}".`);return s}},74661:function(e,t,r){r.d(t,{A7:function(){return c},Cx:function(){return u},Hk:function(){return h},JJ:function(){return m},SF:function(){return d},UK:function(){return l},jM:function(){return f},x3:function(){return p}}),r(58941);var i=r(8740),n=r(22198),s=r(90363),o=r(90972),a=r(6259);const l=s.A.fromJSON(a.Cb),c=n.A.fromJSON(a.yM),u=i.A.fromJSON(a.WR),h=o.A.fromJSON(a.JZ);function d(e){if(null==e)return null;switch(e.type){case"mesh":return null;case"point":case"multipoint":return l;case"polyline":return c;case"polygon":case"extent":return u}return null}const f=s.A.fromJSON(a.nC),p=n.A.fromJSON(a.HW),m=i.A.fromJSON(a.b6)},6259:function(e,t,r){r.d(t,{Cb:function(){return s},HW:function(){return u},JR:function(){return n},JZ:function(){return l},WR:function(){return a},b6:function(){return h},fT:function(){return i},nC:function(){return c},yM:function(){return o}});const i=[252,146,31,255],n=[153,153,153,255],s={type:"esriSMS",style:"esriSMSCircle",size:6,color:i,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},o={type:"esriSLS",style:"esriSLSSolid",width:.75,color:i},a={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},l={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},c={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},u={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},h={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null}},89838:function(e,t,r){r.d(t,{OP:function(){return o},V4:function(){return n},rZ:function(){return s}}),r(58941);var i=r(40633);function n(e,t,r){if(null==e)return null;const n=t.readArcadeFeature();t.contextTimeZone=r.$view?.timeZone;try{return e.evaluate({...r,$feature:n},e.services)}catch(e){return i.A.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",e),null}}function s(e){return null==e||e===1/0||e===-1/0||"number"==typeof e&&isNaN(e)}function o(e,t,r,i){if(null==e)return null!=i?i:null;const n=t.readArcadeFeature();t.contextTimeZone=r.$view?.timeZone;const o=e.evaluate({...r,$feature:n},e.services);return s(o)?null!=i?i:null:o}},16043:function(e,t,r){function i(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function n(){const e=i("svg");return e.setAttribute("style","position: absolute;"),e.setAttribute("width","0"),e.setAttribute("height","0"),e.setAttribute("aria-hidden","true"),e.setAttribute("role","presentation"),document.body.appendChild(e),e}function s(e){return null!=e&&document.body.removeChild(e),null}r.d(t,{FJ:function(){return i},p:function(){return n},pK:function(){return s}})},7056:function(e,t,r){r.d(t,{GW:function(){return _},IU:function(){return b},Jo:function(){return o},MG:function(){return s},Wh:function(){return d},cP:function(){return T},os:function(){return u},p6:function(){return m},pJ:function(){return a},ru:function(){return v},s3:function(){return w},w4:function(){return S},wV:function(){return p},yM:function(){return I},z0:function(){return f}});var i=r(38441),n=r(72139);const s=Number.POSITIVE_INFINITY,o=Math.PI,a=2*o,l=128/o,c=256/360,u=o/180,h=1/Math.LN2;function d(e,t){return(e%=t)>=0?e:e+t}function f(e){return d(e*l,256)}function p(e){return d(e*c,256)}function m(e){return Math.log(e)*h}function _(e,t,r){return e*(1-r)+t*r}const g=8,y=14,x=16;function b(e){return g+Math.max((e-y)*x,0)}function w(e,t,r){let i,n,s,o=0;for(const a of r){i=a.length;for(let r=1;r<i;++r)n=a[r-1],s=a[r],n.y>t!=s.y>t&&((s.x-n.x)*(t-n.y)-(s.y-n.y)*(e-n.x)>0?o++:o--)}return 0!==o}function v(e,t,r,n){let s,o,a,l;const c=n*n;for(const n of r){const r=n.length;if(!(r<2)){s=n[0].x,o=n[0].y;for(let u=1;u<r;++u){if(a=n[u].x,l=n[u].y,(0,i.Ng)(e,t,s,o,a,l)<c)return!0;s=a,o=l}}}return!1}function S(e,t,r,i,n,s,o){const a=Math.max(i,Math.min(t,s))-t,l=Math.max(n,Math.min(r,o))-r;return a*a+l*l<=e*e}function T(e,t){if(0===t||Number.isNaN(t))return e;const r=[],i=new n.bR(0,0),s=new n.bR(0,0),o=new n.bR(0,0);for(let a=0;a<e.length;a++){const l=e[a],c=[];for(let e=0;e<l.length;e++){const r=l[e-1],a=l[e],u=l[e+1];0===e?i.setCoords(0,0):i.assignSub(a,r).normalize().rightPerpendicular(),e===l.length-1?s.setCoords(0,0):s.assignSub(u,a).normalize().rightPerpendicular(),o.assignAdd(i,s).normalize();const h=o.x*s.x+o.y*s.y;0!==h&&o.scale(1/h),c.push(n.bR.add(a,o.scale(t)))}r.push(c)}return r}function I(e,t,r,i){const s=new n.bR(e[0],e[1]);if(s.scale(i),"viewport"===t){const e=-r*(Math.PI/180),t=Math.cos(e),i=Math.sin(e);s.rotate(t,i)}return s}},46065:function(e,t,r){r.d(t,{A:function(){return s}});var i=r(88231),n=r(24964);class s{constructor(e,t){this.id=e,this.sortKey=t,this.records=[]}serialize(e){return e.push(this.id),e.writeF32(this.sortKey),(0,n.j)(e,this.records),e}static deserialize(e){const t=e.readInt32(),r=e.readF32(),o=new s(t,r);return o.records=(0,n._)(e,i.A)??[],o}}s.byteSizeHint=2*Uint32Array.BYTES_PER_ELEMENT+i.A.byteSizeHint},7459:function(e,t,r){r.d(t,{KQ:function(){return i},Q4:function(){return s},Ss:function(){return o}});const i=8388607,n=8388608,s=e=>e&i;function o(e,t){return((t?n:0)|e)>>>0}},88231:function(e,t,r){r.d(t,{A:function(){return i}});class i{constructor(e,t,r,i,n,s,o){this.instanceId=e,this.textureKey=t,this.indexStart=r,this.indexCount=i,this.vertexStart=n,this.vertexCount=s,this.overlaps=o}updateBaseOffsets(e){this.vertexStart+=e.vertexFrom,this.indexStart+=e.indexFrom}clone(){return new i(this.instanceId,this.textureKey,this.indexStart,this.indexCount,this.vertexStart,this.vertexCount,this.overlaps)}static write(e,t,r,i,n,s,o,a){e.push(t),e.push(r),e.push(i),e.push(n),e.push(s),e.push(o),e.push(a)}serialize(e){return e.push(this.instanceId),e.push(this.textureKey),e.push(this.indexStart),e.push(this.indexCount),e.push(this.vertexStart),e.push(this.vertexCount),e.push(this.overlaps),e}static deserialize(e){const t=e.readInt32(),r=e.readInt32(),n=e.readInt32(),s=e.readInt32(),o=e.readInt32(),a=e.readInt32(),l=e.readInt32();return new i(t,r,n,s,o,a,l)}}i.byteSizeHint=7*Uint32Array.BYTES_PER_ELEMENT},54904:function(e,t,r){r.d(t,{A:function(){return i}});class i{constructor(e=0,t=0,r=0,i=0){this.x=e,this.y=t,this.width=r,this.height=i}get isEmpty(){return this.width<=0||this.height<=0}union(e){this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.width=Math.max(this.width,e.width),this.height=Math.max(this.height,e.height)}}},42542:function(e,t,r){r.d(t,{i:function(){return p}});var i=r(33389),n=r(39686);function s(e,t){return e.x===t.x&&e.y===t.y}function o(e){if(!e)return;const t=e.length;if(t<=1)return;let r=0;for(let i=1;i<t;i++)s(e[i],e[r])||++r===i||(e[r]=e[i]);e.length=r+1}function a(e,t){return e.x=t.y,e.y=-t.x,e}function l(e,t){return e.x=-t.y,e.y=t.x,e}function c(e,t){return e.x=t.x,e.y=t.y,e}function u(e,t){return e.x=-t.x,e.y=-t.y,e}function h(e){return Math.sqrt(e.x*e.x+e.y*e.y)}function d(e,t){return e.x*t.x+e.y*t.y}function f(e,t,r,i){return e.x=t.x*r+t.y*i,e.y=t.x*i-t.y*r,e}class p{constructor(e,t,r){this._writeVertex=e,this._writeTriangle=t,this._canUseThinTessellation=r,this._prevNormal={x:void 0,y:void 0},this._nextNormal={x:void 0,y:void 0},this._textureNormalLeft={x:0,y:1},this._textureNormalRight={x:0,y:-1},this._textureNormal={x:void 0,y:void 0},this._joinNormal={x:void 0,y:void 0},this._inner={x:void 0,y:void 0},this._outer={x:void 0,y:void 0},this._roundStart={x:void 0,y:void 0},this._roundEnd={x:void 0,y:void 0},this._startBreak={x:void 0,y:void 0},this._endBreak={x:void 0,y:void 0},this._innerPrev={x:void 0,y:void 0},this._innerNext={x:void 0,y:void 0},this._bevelStart={x:void 0,y:void 0},this._bevelEnd={x:void 0,y:void 0},this._bevelMiddle={x:void 0,y:void 0}}tessellate(e,t,r=this._canUseThinTessellation){o(e),r&&t.halfWidth<n.Gh&&!t.offset?this._tessellateThin(e,t):this._tessellate(e,t)}_tessellateThin(e,t){if(e.length<2)return;const r=t.wrapDistance||65535;let i=t.initialDistance||0,n=!1,s=e[0].x,o=e[0].y;const a=e.length;for(let t=1;t<a;++t){n&&(n=!1,i=0);let a=e[t].x,l=e[t].y,c=a-s,u=l-o,h=Math.sqrt(c*c+u*u);if(c/=h,u/=h,i+h>r){n=!0;const e=(r-i)/h;h=r-i,a=(1-e)*s+e*a,l=(1-e)*o+e*l,--t}const d=this._writeVertex(s,o,0,0,c,u,u,-c,0,-1,i),f=this._writeVertex(s,o,0,0,c,u,-u,c,0,1,i);i+=h;const p=this._writeVertex(a,l,0,0,c,u,u,-c,0,-1,i),m=this._writeVertex(a,l,0,0,c,u,-u,c,0,1,i);this._writeTriangle(d,f,p),this._writeTriangle(f,p,m),s=a,o=l}}_tessellate(e,t){const r=e[0],n=e[e.length-1],o=s(r,n),p=o?3:2;if(e.length<p)return;const m=t.pixelCoordRatio,_=null!=t.capType?t.capType:i.xR.BUTT,g=null!=t.joinType?t.joinType:i.JO.MITER,y=null!=t.miterLimit?Math.min(t.miterLimit,4):2,x=null!=t.roundLimit?Math.min(t.roundLimit,1.05):1.05,b=null!=t.halfWidth?t.halfWidth:2,w=!!t.textured;let v,S,T,I=null;const M=this._prevNormal,A=this._nextNormal;let E=-1,P=-1;const C=this._joinNormal;let R,F;const L=this._textureNormalLeft,k=this._textureNormalRight,N=this._textureNormal;let O=-1,D=-1;const z=t.wrapDistance||65535;let U=t.initialDistance||0;const G=this._writeVertex,B=this._writeTriangle,V=(e,t,r,i,n,s)=>{const o=G(S,T,R,F,r,i,e,t,n,s,U);return O>=0&&D>=0&&o>=0&&B(O,D,o),O=D,D=o,o};o&&(v=e[e.length-2],A.x=n.x-v.x,A.y=n.y-v.y,P=h(A),A.x/=P,A.y/=P);let q=!1;for(let t=0;t<e.length;++t){if(q&&(q=!1,U=0),v&&(M.x=-A.x,M.y=-A.y,E=P,U+E>z&&(q=!0)),q){const r=(z-U)/E;E=z-U,v={x:(1-r)*v.x+r*e[t].x,y:(1-r)*v.y+r*e[t].y},--t}else v=e[t];S=v.x,T=v.y;const r=t<=0&&!q,n=t===e.length-1;if(r||(U+=E),I=n?o?e[1]:null:e[t+1],I?(A.x=I.x-S,A.y=I.y-T,P=h(A),A.x/=P,A.y/=P):(A.x=void 0,A.y=void 0),!o){if(r){l(C,A),R=C.x,F=C.y,_===i.xR.SQUARE&&(V(-A.y-A.x,A.x-A.y,A.x,A.y,0,-1),V(A.y-A.x,-A.x-A.y,A.x,A.y,0,1)),_===i.xR.ROUND&&(V(-A.y-A.x,A.x-A.y,A.x,A.y,-1,-1),V(A.y-A.x,-A.x-A.y,A.x,A.y,-1,1)),_!==i.xR.ROUND&&_!==i.xR.BUTT||(V(-A.y,A.x,A.x,A.y,0,-1),V(A.y,-A.x,A.x,A.y,0,1));continue}if(n){a(C,M),R=C.x,F=C.y,_!==i.xR.ROUND&&_!==i.xR.BUTT||(V(M.y,-M.x,-M.x,-M.y,0,-1),V(-M.y,M.x,-M.x,-M.y,0,1)),_===i.xR.SQUARE&&(V(M.y-M.x,-M.x-M.y,-M.x,-M.y,0,-1),V(-M.y-M.x,M.x-M.y,-M.x,-M.y,0,1)),_===i.xR.ROUND&&(V(M.y-M.x,-M.x-M.y,-M.x,-M.y,1,-1),V(-M.y-M.x,M.x-M.y,-M.x,-M.y,1,1));continue}}let s,p,G=(H=A,-((Z=M).x*H.y-Z.y*H.x));if(Math.abs(G)<.01)d(M,A)>0?(C.x=M.x,C.y=M.y,G=1,s=Number.MAX_VALUE,p=!0):(l(C,A),G=1,s=1,p=!1);else{C.x=(M.x+A.x)/G,C.y=(M.y+A.y)/G,s=h(C);const e=(s-1)*b*m;p=s>4||e>E&&e>P}R=C.x,F=C.y;let B=g;switch(g){case i.JO.BEVEL:s<1.05&&(B=i.JO.MITER);break;case i.JO.ROUND:s<x&&(B=i.JO.MITER);break;case i.JO.MITER:s>y&&(B=i.JO.BEVEL)}switch(B){case i.JO.MITER:if(V(C.x,C.y,-M.x,-M.y,0,-1),V(-C.x,-C.y,-M.x,-M.y,0,1),n)break;if(w){const e=q?0:U;O=this._writeVertex(S,T,R,F,A.x,A.y,C.x,C.y,0,-1,e),D=this._writeVertex(S,T,R,F,A.x,A.y,-C.x,-C.y,0,1,e)}break;case i.JO.BEVEL:{const e=G<0;let t,r,i,s;if(e){const e=O;O=D,D=e,t=L,r=k}else t=k,r=L;if(p)i=e?l(this._innerPrev,M):a(this._innerPrev,M),s=e?a(this._innerNext,A):l(this._innerNext,A);else{const t=e?u(this._inner,C):c(this._inner,C);i=t,s=t}const o=e?a(this._bevelStart,M):l(this._bevelStart,M);V(i.x,i.y,-M.x,-M.y,t.x,t.y);const h=V(o.x,o.y,-M.x,-M.y,r.x,r.y);if(n)break;const d=e?l(this._bevelEnd,A):a(this._bevelEnd,A);if(p){const e=this._writeVertex(S,T,R,F,-M.x,-M.y,0,0,0,0,U);O=this._writeVertex(S,T,R,F,A.x,A.y,s.x,s.y,t.x,t.y,U),D=this._writeVertex(S,T,R,F,A.x,A.y,d.x,d.y,r.x,r.y,U),this._writeTriangle(h,e,D)}else{if(w){const e=this._bevelMiddle;e.x=(o.x+d.x)/2,e.y=(o.y+d.y)/2,f(N,e,-M.x,-M.y),V(e.x,e.y,-M.x,-M.y,N.x,N.y),f(N,e,A.x,A.y),O=this._writeVertex(S,T,R,F,A.x,A.y,e.x,e.y,N.x,N.y,U),D=this._writeVertex(S,T,R,F,A.x,A.y,s.x,s.y,t.x,t.y,U)}else{const e=O;O=D,D=e}V(d.x,d.y,A.x,A.y,r.x,r.y)}if(e){const e=O;O=D,D=e}break}case i.JO.ROUND:{const e=G<0;let t,r;if(e){const e=O;O=D,D=e,t=L,r=k}else t=k,r=L;const i=e?u(this._inner,C):c(this._inner,C);let o,h;p?(o=e?l(this._innerPrev,M):a(this._innerPrev,M),h=e?a(this._innerNext,A):l(this._innerNext,A)):(o=i,h=i);const m=e?a(this._roundStart,M):l(this._roundStart,M),_=e?l(this._roundEnd,A):a(this._roundEnd,A),g=V(o.x,o.y,-M.x,-M.y,t.x,t.y),y=V(m.x,m.y,-M.x,-M.y,r.x,r.y);if(n)break;const x=this._writeVertex(S,T,R,F,-M.x,-M.y,0,0,0,0,U);p||this._writeTriangle(O,D,x);const b=u(this._outer,i),v=this._writeVertex(S,T,R,F,A.x,A.y,_.x,_.y,r.x,r.y,U);let I,E;const P=s>2;if(P){let t;s!==Number.MAX_VALUE?(b.x/=s,b.y/=s,t=d(M,b),t=(s*(t*t-1)+1)/t):t=-1,I=e?a(this._startBreak,M):l(this._startBreak,M),I.x+=M.x*t,I.y+=M.y*t,E=e?l(this._endBreak,A):a(this._endBreak,A),E.x+=A.x*t,E.y+=A.y*t}f(N,b,-M.x,-M.y);const z=this._writeVertex(S,T,R,F,-M.x,-M.y,b.x,b.y,N.x,N.y,U);f(N,b,A.x,A.y);const B=w?this._writeVertex(S,T,R,F,A.x,A.y,b.x,b.y,N.x,N.y,U):z,q=x,Z=w?this._writeVertex(S,T,R,F,A.x,A.y,0,0,0,0,U):x;let H=-1,j=-1;if(P&&(f(N,I,-M.x,-M.y),H=this._writeVertex(S,T,R,F,-M.x,-M.y,I.x,I.y,N.x,N.y,U),f(N,E,A.x,A.y),j=this._writeVertex(S,T,R,F,A.x,A.y,E.x,E.y,N.x,N.y,U)),w?P?(this._writeTriangle(q,y,H),this._writeTriangle(q,H,z),this._writeTriangle(Z,B,j),this._writeTriangle(Z,j,v)):(this._writeTriangle(q,y,z),this._writeTriangle(Z,B,v)):P?(this._writeTriangle(x,y,H),this._writeTriangle(x,H,j),this._writeTriangle(x,j,v)):(this._writeTriangle(x,y,z),this._writeTriangle(x,B,v)),p?(O=this._writeVertex(S,T,R,F,A.x,A.y,h.x,h.y,t.x,t.y,U),D=v):(O=w?this._writeVertex(S,T,R,F,A.x,A.y,h.x,h.y,t.x,t.y,U):g,this._writeTriangle(O,Z,v),D=v),e){const e=O;O=D,D=e}break}}}var Z,H}}},88413:function(e,t,r){r.d(t,{AV:function(){return h},ES:function(){return _},IF:function(){return b},Qz:function(){return d},UE:function(){return g},bX:function(){return y},sZ:function(){return x}});var i=r(39819),n=r(40633),s=(r(33389),r(13798),r(58941),r(41835),r(85456)),o=(r(96402),r(69452),r(48347)),a=r(12285),l=r(10956),c=r(3817);const u=()=>n.A.getLogger("esri.views.2d.engine.webgl.Utils");function h(e){switch(e){case s.ld.UNSIGNED_BYTE:return 1;case s.ld.UNSIGNED_SHORT_4_4_4_4:return 2;case s.ld.FLOAT:return 4;default:return void u().error(new i.A("webgl-utils",`Unable to handle type ${e}`))}}function d(e){switch(e){case s.ld.UNSIGNED_BYTE:return Uint8Array;case s.ld.UNSIGNED_SHORT_4_4_4_4:return Uint16Array;case s.ld.FLOAT:return Float32Array;default:return void u().error(new i.A("webgl-utils",`Unable to handle type ${e}`))}}const f=e=>{const t=new Map;for(const r in e)for(const i of e[r])t.set(i.name,i.location);return t},p=e=>{const t={};return e.forEach(((e,r)=>t[r]=e?.length?e[0].stride:0)),t},m=new Map,_=(e,t)=>{if(!m.has(e)){const r=function(e){const t=new Map;for(const r in e){const i=e[r];let n=0;t.set(r,i.map((e=>{const t=new c._(e.name,e.count,e.type,n,0,e.normalized||!1);return n+=e.count*(0,o._)(e.type),t}))),t.get(r).forEach((e=>e.stride=n))}return t}(t),i={strides:p(r),bufferLayouts:r,attributes:f(t)};m.set(e,i)}return m.get(e)},g=e=>e.includes("data:image/svg+xml");function y(e){const t=[];for(let r=0;r<e.length;r++)t.push(e.charCodeAt(r));return t}function x(e,t,r){const i=new l.R(t.width,t.height);return i.dataType=t.dataType,t.depth&&(i.depth=t.depth),t.flipped&&(i.flipped=t.flipped),t.hasMipmap&&(i.hasMipmap=t.hasMipmap),i.internalFormat=t.internalFormat,t.isImmutable&&(i.isImmutable=t.isImmutable),t.isOpaque&&(i.isOpaque=t.isOpaque),t.maxAnisotropy&&(i.maxAnisotropy=t.maxAnisotropy),i.pixelFormat=t.pixelFormat,t.preMultiplyAlpha&&(i.preMultiplyAlpha=t.preMultiplyAlpha),t.samplingMode&&(i.samplingMode=t.samplingMode),t.target&&(i.target=t.target),i.uniform=t.uniform,t.unpackAlignment&&(i.unpackAlignment=t.unpackAlignment),t.wrapMode&&(i.wrapMode=t.wrapMode),new a.g(e,i,r)}function b(e){return"url"in e&&"urlHash"in e?{...e,url:""}:e}},96564:function(e,t,r){r.d(t,{Dy:function(){return d},UD:function(){return c},fO:function(){return u},gy:function(){return o},iT:function(){return h},xy:function(){return l}});var i=r(40633);const n=()=>i.A.getLogger("esri.views.2d.engine.webgl.alignmentUtils");var s,o,a;function l(e){if(!e)return s.Center;switch(e){case"Left":case"left":return s.Left;case"Right":case"right":return s.Right;case"Justify":return n().warnOnce("Horizontal alignment 'justify' is not implemented. Falling back to 'center'."),s.Center;case"Center":case"center":return s.Center}}function c(e){if(!e)return o.Center;switch(e){case"Top":case"top":return o.Top;case"Center":case"middle":return o.Center;case"Baseline":case"baseline":return o.Baseline;case"Bottom":case"bottom":return o.Bottom}}function u(e){switch(e){case"above-left":case"esriServerPointLabelPlacementAboveLeft":return["right","bottom"];case"above-center":case"above-along":case"esriServerPointLabelPlacementAboveCenter":case"esriServerLinePlacementAboveAlong":return["center","bottom"];case"above-right":case"esriServerPointLabelPlacementAboveRight":return["left","bottom"];case"center-left":case"esriServerPointLabelPlacementCenterLeft":return["right","middle"];case"center-center":case"center-along":case"esriServerPointLabelPlacementCenterCenter":case"esriServerLinePlacementCenterAlong":case"always-horizontal":case"esriServerPolygonPlacementAlwaysHorizontal":return["center","middle"];case"center-right":case"esriServerPointLabelPlacementCenterRight":return["left","middle"];case"below-left":case"esriServerPointLabelPlacementBelowLeft":return["right","top"];case"below-center":case"below-along":case"esriServerPointLabelPlacementBelowCenter":case"esriServerLinePlacementBelowAlong":return["center","top"];case"below-right":case"esriServerPointLabelPlacementBelowRight":return["left","top"];default:return console.debug(`Found invalid placement type ${e}`),["center","middle"]}}function h(e){switch(e){case s.Right:case"right":return-1;case s.Center:case"center":return 0;case s.Left:case"left":return 1;default:return console.debug(`Found invalid horizontal alignment ${e}`),0}}function d(e){switch(e){case o.Top:case"top":return 1;case o.Center:case"middle":return 0;case o.Bottom:case o.Baseline:case"baseline":case"bottom":return-1;default:return console.debug(`Found invalid vertical alignment ${e}`),0}}(a=s||(s={}))[a.Left=-1]="Left",a[a.Center=0]="Center",a[a.Right=1]="Right",function(e){e[e.Top=1]="Top",e[e.Center=0]="Center",e[e.Bottom=-1]="Bottom",e[e.Baseline=2]="Baseline"}(o||(o={}))},99121:function(e,t,r){var i;r.d(t,{DW:function(){return p},GA:function(){return h},mv:function(){return i}}),function(e){e.Local="Local",e.Global="Global"}(i||(i={}));class n{generateSource(e){const t=[];for(let r=1;r<this.length;r++)t.push(`vec4 atom${r} = texture(${e.animationTexture}, (pointer + 0.5) / size);`),t.push("pointer.x += 1.0;");for(let e=0;e<this.ins;e++)t.push("top--;"),t.push(`vec4 in${this.ins-e-1} = stack[top];`);for(let e=0;e<this.outs;e++)t.push(`vec4 out${e};`);const{microcode:r}=this;for(const e of r)t.push(e);for(let e=0;e<this.outs;e++)t.push(`stack[top] = out${e};`),t.push("top++;"),t.push(`if (top >= ${f}) { top = ${f-1}; }`);return t}}let s=128;function o(e){return[`float duration = clamp(${e.duration}, 0.05, 3600.0);`,`float startTimeOffset = ${e.startTimeOffset};`,`float repeatDelay = ${e.repeatDelay};`,`float timeOriginSelector = ${e.timeOriginSelector};`,`float repeatType = ${e.repeatType};`,`float easing = ${e.easing};`,`float playAnimation = ${e.playAnimation} * (1.0 - step(0.0, -${e.duration}));`,`float reverseAnimation = ${e.reverseAnimation};`,"float time = globalTime - (timeOriginSelector == 1.0 ? localTimeOrigin : 0.0);","time *= playAnimation;","time *= 1.0 - reverseAnimation * 2.0;","float period = duration + repeatDelay;","time += reverseAnimation == 1.0 ? (period - startTimeOffset - 0.001) : startTimeOffset + 0.001;","float omega = time / period;","float oi = floor(omega);","omega = repeatType == 1.0 || repeatType == 3.0 ? omega - oi : omega;","float of = omega * period;","of = (clamp(of, reverseAnimation * repeatDelay, period - (1.0 - reverseAnimation) * repeatDelay) - reverseAnimation * repeatDelay) / duration;","of = easing == 2.0 ? pow(of, 3.0) : of;","of = easing == 3.0 ? 1.0 - pow(1.0 - of, 3.0) : of;","of = easing == 4.0 ? of < 0.5 ? 4.0 * pow(of, 3.0) : 1.0 - pow(-2.0 * of + 2.0, 3.0) / 2.0 : of;","bool oscillate = repeatType == 3.0 && mod(oi, 2.0) == 1.0;",`${e.out} = oscillate ? 1.0 - of : of;`]}const a={Linear:1,EaseIn:2,EaseOut:3,EaseInOut:4},l={Loop:1,None:2,Oscillate:3},c={Local:1,Global:2};function u(e){const t=a[e.easing],r=l[e.repeatType],i=c[e.timeOriginSelector];return[[e.duration,e.startTimeOffset,e.repeatDelay,i],[r,t,e.playAnimation,e.reverseAnimation]]}const h={scalar:new class extends n{constructor(){super(...arguments),this.opcode=++s,this.length=1,this.ins=0,this.outs=1,this.microcode=["out0 = vec4(atom0.y, atom0.y, atom0.y, atom0.y);"]}encode(e){return[[this.opcode,e,0,0]]}},vector3:new class extends n{constructor(){super(...arguments),this.opcode=++s,this.length=1,this.ins=0,this.outs=1,this.microcode=["out0 = vec4(atom0.yzw, 0.0);"]}encode(e){return[[this.opcode,e[0]||0,e[1]||0,e[2]||0]]}},vector4:new class extends n{constructor(){super(...arguments),this.opcode=++s,this.length=2,this.ins=0,this.outs=1,this.microcode=["out0 = atom1;"]}encode(e){return[[this.opcode,0,0,0],e]}},animatedTransform:new class extends n{constructor(){super(...arguments),this.opcode=++s,this.length=10,this.ins=1,this.outs=1,this.microcode=["vec2 fromTranslation = atom1.xy;","vec2 toTranslation = atom1.zw;","float fromRotation = atom2.x;","float toRotation = atom2.y;","float fromScale = atom2.z;","float toScale = atom2.w;","bool relativeTranslation = atom9.x == 1.0;","bool absoluteScale = atom9.y == 1.0;","vec2 translationMultiplier = relativeTranslation ? pixelDimensions : vec2(1.0, 1.0);","float scaleDivisor = absoluteScale ? pixelDimensions.y : 1.0;","float fTranslation;","{",...o({duration:"atom3.x",startTimeOffset:"atom3.y",repeatDelay:"atom3.z",timeOriginSelector:"atom3.w",repeatType:"atom4.x",easing:"atom4.y",playAnimation:"atom4.z",reverseAnimation:"atom4.w",out:"fTranslation"}),"}","float fRotation;","{",...o({duration:"atom5.x",startTimeOffset:"atom5.y",repeatDelay:"atom5.z",timeOriginSelector:"atom5.w",repeatType:"atom6.x",easing:"atom6.y",playAnimation:"atom6.z",reverseAnimation:"atom6.w",out:"fRotation"}),"}","float fScale;","{",...o({duration:"atom7.x",startTimeOffset:"atom7.y",repeatDelay:"atom7.z",timeOriginSelector:"atom7.w",repeatType:"atom8.x",easing:"atom8.y",playAnimation:"atom8.z",reverseAnimation:"atom8.w",out:"fScale"}),"}","vec2 aTranslation = mix(fromTranslation, toTranslation, fTranslation);","float aRotation = mix(fromRotation, toRotation, fRotation);","float aScale = mix(fromScale, toScale, fScale);","vec2 pTranslation = in0.xy;","float pRotation = in0.z;","float pScale = in0.w;","aTranslation *= translationMultiplier;","aScale /= scaleDivisor;","float rotation = pRotation + aRotation;","float scale = pScale * aScale;","float sin1 = sin(pRotation);","float cos1 = cos(pRotation);","float s1 = pScale;","float x1 = pTranslation.x;","float y1 = pTranslation.y;","float x2 = aTranslation.x;","float y2 = aTranslation.y;","\n    vec2 translation = vec2(\n      cos1 * s1 * x2 - sin1 * s1 * y2 + x1,\n      sin1 * s1 * x2 + cos1 * s1 * y2 + y1\n    );\n    ","out0 = vec4(translation, rotation, scale);"]}encode(e){return[[this.opcode,0,0,0],[e.translation.from[0],e.translation.from[1],e.translation.to[0],e.translation.to[1]],[e.rotation.from,e.rotation.to,e.scale.from,e.scale.to],...u(e.translation.timing),...u(e.rotation.timing),...u(e.scale.timing),[e.relativeTranslation?1:0,e.absoluteScale?1:0,0,0]]}},animatedColor:new class extends n{constructor(){super(...arguments),this.opcode=++s,this.length=7,this.ins=1,this.outs=1,this.microcode=["float fromOpacity = atom0.y;","float toOpacity = atom0.z;","vec4 fromColor = atom1;","vec4 toColor = atom2;","float fColor;","{",...o({duration:"atom3.x",startTimeOffset:"atom3.y",repeatDelay:"atom3.z",timeOriginSelector:"atom3.w",repeatType:"atom4.x",easing:"atom4.y",playAnimation:"atom4.z",reverseAnimation:"atom4.w",out:"fColor"}),"}","float fOpacity;","{",...o({duration:"atom5.x",startTimeOffset:"atom5.y",repeatDelay:"atom5.z",timeOriginSelector:"atom5.w",repeatType:"atom6.x",easing:"atom6.y",playAnimation:"atom6.z",reverseAnimation:"atom6.w",out:"fOpacity"}),"}","vec4 aColor = mix(fromColor, toColor, fColor);","aColor.a *= mix(fromOpacity, toOpacity, fOpacity);","vec4 pColor = in0;","out0 = aColor * pColor;"]}encode(e){return[[this.opcode,e.opacity.from,e.opacity.to,0],[e.color.from[0],e.color.from[1],e.color.from[2],e.color.from[3]],[e.color.to[0],e.color.to[1],e.color.to[2],e.color.to[3]],...u(e.color.timing),...u(e.opacity.timing)]}},ret:new class extends n{constructor(){super(...arguments),this.opcode=++s,this.length=1,this.ins=0,this.outs=0,this.microcode=["break;"]}encode(){return[[this.opcode,0,0,0]]}}},d=40,f=4;function p(e){const t=[];t.push(`float globalTime = ${e.globalTime};`),t.push(`float localTimeOrigin = ${e.localTimeOrigin};`),t.push(`vec2 pointer = ${e.animationPointer};`),t.push(`vec2 size = ${e.animationTextureSize};`),t.push("int top = 0;"),t.push(`vec4 stack[${f}];`),t.push(`for (int counter = 0; counter < ${d}; counter++) {`),t.push(`vec4 atom0 = texture(${e.animationTexture}, (pointer + 0.5) / size);`),t.push("pointer.x += 1.0;"),t.push(`vec2 pixelDimensions = ${e.pixelDimensions};`),t.push("if (false) {");for(const r in h){const i=h[r];t.push(`} else if (int(atom0.x) == ${i.opcode}) {`);for(const r of i.generateSource(e))t.push(r)}return t.push("} // End if-else."),t.push("} // End for."),t.push(`${e.out} = top > 0 ? stack[top - 1] : vec4(0.0);`),t.join("\n")}},87573:function(e,t,r){r.d(t,{A:function(){return n}});var i=r(14583);class n{constructor(e,t,r,n){this.transformedX=0,this.transformedY=0,this.center=(0,i.fA)(e,t),this.centerT=(0,i.vt)(),this.halfWidth=r/2,this.halfHeight=n/2,this.width=r,this.height=n}get x(){return this.center[0]}get y(){return this.center[1]}get blX(){return this.center[0]+this.halfWidth}get blY(){return this.center[1]+this.halfHeight}get trX(){return this.center[0]-this.halfWidth}get trY(){return this.center[1]-this.halfHeight}get xmin(){return this.x-this.halfWidth}get xmax(){return this.x+this.halfWidth}get ymin(){return this.y-this.halfHeight}get ymax(){return this.y+this.halfHeight}set x(e){this.center[0]=e}set y(e){this.center[1]=e}clone(){return new n(this.x,this.y,this.width,this.height)}serialize(e){return e.writeF32(this.center[0]),e.writeF32(this.center[1]),e.push(this.width),e.push(this.height),e}findCollisionDelta(e,t=4){const r=Math.abs(e.centerT[0]-this.centerT[0]),i=Math.abs(e.centerT[1]-this.centerT[1]),n=(e.halfWidth+this.halfWidth+t)/r,s=(e.halfHeight+this.halfHeight+t)/i,o=Math.min(n,s);return Math.log2(o)}extend(e){const t=Math.min(this.xmin,e.xmin),r=Math.min(this.ymin,e.ymin),i=Math.max(this.xmax,e.xmax)-t,n=Math.max(this.ymax,e.ymax)-r,s=t+i/2,o=r+n/2;this.width=i,this.height=n,this.halfWidth=i/2,this.halfHeight=n/2,this.x=s,this.y=o}static deserialize(e){const t=e.readF32(),r=e.readF32(),i=e.readInt32(),s=e.readInt32();return new n(t,r,i,s)}}},57650:function(e,t,r){r.d(t,{f:function(){return s}});var i=r(87573),n=r(24964);class s{constructor(e,t,r,i,n,s,o,a,l=[]){this.entityTexel=e,this.anchorX=t,this.anchorY=r,this.directionX=i,this.directionY=n,this.maxScale=s,this.minScale=o,this.referenceBounds=a,this.bounds=l}serialize(e){e.push(this.entityTexel),e.writeF32(this.anchorX),e.writeF32(this.anchorY),e.writeF32(this.directionX),e.writeF32(this.directionY),e.writeF32(this.maxScale),e.writeF32(this.minScale),null===this.referenceBounds?(e.writeF32(0),e.writeF32(0),e.writeF32(0)):(e.writeF32(this.referenceBounds.size),e.writeF32(this.referenceBounds.offsetX),e.writeF32(this.referenceBounds.offsetY)),(0,n.j)(e,this.bounds)}static deserialize(e){const t=e.readInt32(),r=e.readF32(),o=e.readF32(),a=e.readF32(),l=e.readF32(),c=e.readF32(),u=e.readF32(),h=e.readF32(),d=e.readF32(),f=e.readF32(),p=(0,n._)(e,i.A)??[];return new s(t,r,o,a,l,c,u,{size:h,offsetX:d,offsetY:f},p)}}},39686:function(e,t,r){r.d(t,{$U:function(){return N},C2:function(){return c},CQ:function(){return n},CR:function(){return v},C_:function(){return D},Cp:function(){return S},DY:function(){return a},GR:function(){return K},Gh:function(){return C},LY:function(){return E},O5:function(){return W},Pq:function(){return u},Qb:function(){return H},Qs:function(){return te},Sr:function(){return x},TB:function(){return J},U5:function(){return A},V3:function(){return F},Vl:function(){return Q},Xh:function(){return X},YS:function(){return d},YV:function(){return s},_M:function(){return L},_x:function(){return Y},cp:function(){return ee},dV:function(){return I},eG:function(){return l},eI:function(){return $},fq:function(){return q},fy:function(){return R},g0:function(){return P},hM:function(){return z},ie:function(){return k},ju:function(){return o},lL:function(){return _},mg:function(){return O},n9:function(){return y},nM:function(){return m},nW:function(){return B},oj:function(){return V},p:function(){return U},qM:function(){return i},r1:function(){return j},sn:function(){return g},tP:function(){return re},uM:function(){return f},ue:function(){return h},vN:function(){return T},vd:function(){return w},yA:function(){return G},yv:function(){return Z},z2:function(){return p},zt:function(){return b}});const i=1e-30,n=512,s=16777216,o=8,a=29,l=24,c=4,u=0,h=0,d=0,f=1,p=2,m=3,_=4,g=5,y=6,x=12,b=13,w=5,v=6,S=5,T=6;var I,M;(M=I||(I={}))[M.FilterFlags=0]="FilterFlags",M[M.Animation=1]="Animation",M[M.GPGPU=2]="GPGPU",M[M.VV=3]="VV",M[M.DD0=4]="DD0",M[M.DD1=5]="DD1",M[M.DD2=6]="DD2",M[M.LocalTimeOrigin=7]="LocalTimeOrigin";const A=6,E=1<<A,P=E<<1,C=1.05,R=3,F=1,L=3,k=3,N=5,O=6,D=1.15,z=2,U=128,G=256-2*z,B=2,V=128,q=10,Z=1024,H=128,j=4,W=1,Y=1<<20,$=.75,X=10,Q=.75,J=256,K=32,ee=512,te=0,re=1},95415:function(e,t,r){r.d(t,{A:function(){return s},J:function(){return n}});var i=r(50944);function n(e,t){let r;if("string"==typeof e)r=(0,i.Wm)(e+`-seed(${t})`);else{let i=12;r=e^t;do{r=107*(r>>8^r)+i|0}while(0!=--i)}return(1+r/(1<<31))/2}function s(e){return Math.floor(n(e,o)*a)}const o=53290320,a=10},80308:function(e,t,r){r.d(t,{U:function(){return a}});var i=r(46065),n=r(88231);class s{get length(){return this._pos}constructor(e,t){this._pos=0;const r=t?this._roundToNearest(t,e.BYTES_PER_ELEMENT):40;this._array=new ArrayBuffer(r),this._buffer=new e(this._array),this._ctor=e,this._i16View=new Int16Array(this._array)}_roundToNearest(e,t){const r=Math.round(e);return 1===t?r:r+(t-r%t)}_ensureSize(e){if(this._pos+e>=this._buffer.length){const t=this._roundToNearest(1.25*(this._array.byteLength+e*this._buffer.BYTES_PER_ELEMENT),this._buffer.BYTES_PER_ELEMENT),r=new ArrayBuffer(t),i=new this._ctor(r);i.set(this._buffer,0),this._array=r,this._buffer=i,this._i16View=new Int16Array(this._array)}}ensureSize(e){this._ensureSize(e)}writeF32(e){this._ensureSize(1);const t=this._pos;return new Float32Array(this._array,4*this._pos,1)[0]=e,this._pos++,t}push(e){this._ensureSize(1);const t=this._pos;return this._buffer[this._pos++]=e,t}writeFixed(e){this._buffer[this._pos++]=e}setValue(e,t){this._buffer[e]=t}i1616Add(e,t,r){this._i16View[2*e]+=t,this._i16View[2*e+1]+=r}getValue(e){return this._buffer[e]}getValueF32(e){return new Float32Array(this._array,4*e,1)[0]}incr(e){if(this._buffer.length<e)throw new Error("Increment index overflows the target buffer");this._buffer[e]++}decr(e){this._buffer[e]--}writeRegion(e){this._ensureSize(e.length);const t=this._pos;return this._buffer.set(e,this._pos),this._pos+=e.length,t}writeManyFrom(e,t,r){this._ensureSize(r-t);for(let i=t;i!==r;i++)this.writeFixed(e._buffer[i])}buffer(){const e=this._array.slice(0,4*this._pos);return this.destroy(),e}toArray(){return[...this._buffer]}seek(e){this._pos=e}destroy(){this._array=null,this._buffer=null}}class o{constructor(e,t,r=0){const i=6*r*Uint32Array.BYTES_PER_ELEMENT,n=4*r*t.stride,o=t.stride/4,a=t.attributes.find((e=>"pos"===e.name||"position"===e.name));if(!a)throw new Error("InternalError: Unable to find position attribute");this.layout={...t,position:a},this._indices=new s(Uint32Array,i),this._vertices=new s(Uint32Array,n),this._metrics=new s(Uint32Array,0),this._metricCountOffset=this._metrics.push(0),this._strideInt=o,this._instanceId=e}serialize(e){const t=this._indices.buffer(),r=this._vertices.buffer(),i=this._metrics.length?this._metrics.buffer():null;return e.push(t,r),{instanceId:this._instanceId,layout:this.layout,indices:t,vertices:r,metrics:i}}get strideInt(){return this._strideInt}get vertexCount(){return this._vertices.length/this._strideInt}get indexCount(){return this._indices.length}get indexWriter(){return this._indices}get vertexWriter(){return this._vertices}get metricWriter(){return this._metrics}vertexEnsureSize(e){this._vertices.ensureSize(e)}indexEnsureSize(e){this._indices.ensureSize(e)}writeIndex(e){this._indices.push(e)}writeVertex(e){this._vertices.push(e)}writeVertexRegion(e){this._vertices.writeRegion(e)}writeVertexF32(e){this._vertices.writeF32(e)}writeMetric(e){this._metrics.incr(this._metricCountOffset),e.serialize(this._metrics)}}class a{constructor(e,t=0){this._id=e,this._sizeHint=t,this._entityRecordCountOffset=0,this._entityCountOffset=0,this._entityIdIndex=0,this._entitySortKeyIndex=0,this._didEntityStart=!1,this._instanceIdToVertexData=new Map,this._recordIndexStart=0,this._recordIndexCount=0,this._recordVertexStart=0,this._recordVertexCount=0,this._current={metric:null,writer:null,start:0,sortKey:0,instanceId:0,layoutHash:0,indexStart:0,vertexStart:0,textureKey:0,metricBoxLenPointer:0},this._entities=new s(Uint32Array,this._sizeHint*i.A.byteSizeHint),this._entityCountOffset=this._entities.push(0)}get id(){return this._id}serialize(){const e=new Array,t=[],r=this._entities.buffer();for(const r of this._instanceIdToVertexData.values())t.push(r.serialize(e));return{message:{data:t,entities:r},transferList:e}}vertexCount(){return this._current.writer?.vertexCount??0}indexCount(){return this._current.writer?.indexCount??0}vertexEnsureSize(e){this._current.writer.vertexEnsureSize(e)}indexEnsureSize(e){this._current.writer.indexEnsureSize(e)}vertexWrite(e){this._current.writer.writeVertex(e)}vertexWriteRegion(e){this._current.writer.writeVertexRegion(e)}vertexWriteF32(e){this._current.writer.writeVertexF32(e)}recordBounds(e,t,r,i){}indexWrite(e){this._current.writer.writeIndex(e)}metricStart(e){this._current.metric=e}metricEnd(){const e=this._current.writer;this._current.metric.bounds.length&&e.writeMetric(this._current.metric)}metricBoxWrite(e){this._current.metric.bounds.push(e)}entityStart(e,t=e){this._entityIdIndex=this._entities.push(e),this._entitySortKeyIndex=this._entities.writeF32(t),this._entityRecordCountOffset=this._entities.push(0),this._didEntityStart=!0}entityRecordCount(){return this._entities.getValue(this._entityRecordCountOffset)}entityEnd(){this._didEntityStart&&(0===this.entityRecordCount()?this._entities.seek(this._entityIdIndex):this._entities.incr(this._entityCountOffset),this._didEntityStart=!1)}recordCount(){return this._entities.getValue(this._entityRecordCountOffset)}recordStart(e,t,r=0){this._current.writer=this._getVertexWriter(e,t),this._current.indexStart=this._current.writer.indexCount,this._current.vertexStart=this._current.writer.vertexCount,this._current.instanceId=e,this._current.layoutHash=t.hash,this._current.textureKey=r}recordEnd(e=0){const t=this._current.vertexStart,r=this._current.writer.vertexCount-t;if(!r)return!1;const i=this._current.indexStart,s=this._current.writer.indexCount-i;return this._recordIndexStart=i,this._recordIndexCount=s,this._recordVertexStart=t,this._recordVertexCount=r,this._entities.incr(this._entityRecordCountOffset),n.A.write(this._entities,this._current.instanceId,this._current.textureKey,i,s,t,r,e),!0}copyLast(e,t){const r=this._recordVertexStart+this._recordVertexCount;this._entities.incr(this._entityRecordCountOffset),n.A.write(this._entities,this._current.instanceId,this._current.textureKey,this._recordIndexStart+this._recordIndexCount,this._recordIndexCount,r,this._recordVertexCount,0);const i=this._current.writer.indexWriter,s=this._current.writer.vertexWriter,o=this._recordIndexStart+this._recordIndexCount,a=this._recordVertexCount;for(let e=this._recordIndexStart;e!==o;e++){const t=i.getValue(e);i.push(t+a)}const l=this._current.writer.layout.stride/Uint32Array.BYTES_PER_ELEMENT,c=this._recordVertexStart*l,u=(this._recordVertexStart+this._recordVertexCount)*l;for(let e=c;e!==u;e++){const t=s.getValue(e);s.push(t)}const h=this._current.writer.layout.position,d=h.packPrecisionFactor??1,f=h.offset/Uint32Array.BYTES_PER_ELEMENT,p=e*d,m=t*d;for(let e=r*l;e<=s.length;e+=l)s.i1616Add(e+f,p,m)}copyLastFrom(e,t,r){const i=e._entities.getValue(e._entityIdIndex);if(i!==this._entities.getValue(this._entityIdIndex)){const t=e._entities.getValueF32(e._entitySortKeyIndex);this.entityStart(i,t)}this.recordStart(e._current.instanceId,e._current.writer.layout,e._current.textureKey);const n=this._current.writer.layout.stride/Uint32Array.BYTES_PER_ELEMENT,s=this._current.vertexStart,o=e._current.vertexStart-s,a=this._current.writer.indexWriter,l=this._current.writer.vertexWriter,c=e._current.writer.indexWriter,u=e._current.writer.vertexWriter;for(let t=e._current.indexStart;t!==c.length;t++){const e=c.getValue(t);a.push(e-o)}for(let t=e._current.vertexStart*n;t!==u.length;t++){const e=u.getValue(t);l.push(e)}const h=this._current.writer.layout.position,d=h.packPrecisionFactor??1,f=h.offset/Uint32Array.BYTES_PER_ELEMENT,p=t*d,m=r*d;for(let e=s*n;e<=l.length;e+=n)l.i1616Add(e+f,p,m);this.recordEnd()}_getVertexWriter(e,t){const r=this._instanceIdToVertexData;return r.has(e)||r.set(e,new o(e,t,this._sizeHint)),r.get(e)}}},93561:function(e,t,r){r.d(t,{J:function(){return o}});var i=r(50944),n=r(88413);class s{}class o extends s{constructor(e){super(),this._fetcher=e,this._controller=new AbortController,this._pendingIds=new Set,this._pendingRequests=[],this._resourceIdToResource=new Map}destroy(){this._controller.abort()}get _abortOptions(){return{signal:this._controller.signal}}enqueueRequest(e){const t=(0,n.IF)(e.resource),r=(0,i.Wm)(JSON.stringify(t));return this._pendingIds.has(r)||(this._pendingIds.add(r),this._pendingRequests.push({...e,resourceId:r})),r}async fetchEnqueuedResources(){const e=this._pendingRequests;this._pendingIds.clear(),this._pendingRequests=[];const t=await this._fetcher.fetch(e,this._abortOptions);for(let r=0;r<t.length;r++){const i=e[r].resourceId;this._resourceIdToResource.set(i,t[r])}}async fetchResourceImmediate(e){const t=await this._fetcher.fetch([e],this._abortOptions);if(1!==t.length)throw new Error("FeaturePipelineResourceProxy: failed to fetch resources");return t[0]}async fetchDictionaryResourceImmediate(e){const t=await this._fetcher.fetchDictionary([e],this._abortOptions);if(1!==t.length)throw new Error("FeaturePipelineResourceProxy: failed to fetch dictionary resources");return t[0]}getResource(e){return this._resourceIdToResource.get(e)}}},17469:function(e,t,r){r.d(t,{Tl:function(){return T}});var i=r(67348),n=r(10793),s=r(13786),o=r(14583),a=r(96564),l=r(54904),c=r(87573);const u=22,h=4,d=u+h,f=u-6,p=3,m=Math.PI/180;class _{constructor(e,t,r,i){this._rotationT=(0,n.vt)(),this._xBounds=0,this._yBounds=0,this.minZoom=0,this.maxZoom=255,this._bounds=null;const s=r.rect,o=new Float32Array(8);e*=i,t*=i;const a=r.code?s.width*i:r.metrics.width,l=r.code?s.height*i:r.metrics.height;this.width=a,this.height=l,o[0]=e,o[1]=t,o[2]=e+a,o[3]=t,o[4]=e,o[5]=t+l,o[6]=e+a,o[7]=t+l,this._data=o,this._setTextureCoords(s),this._scale=i,this._mosaic=r,this.x=e,this.y=t,this.maxOffset=Math.max(e+a,t+l)}get mosaic(){return this._mosaic}set angle(e){this._angle=e,(0,i.$0)(this._rotationT,-e),this._setOffsets()}get angle(){return this._angle}get xTopLeft(){return this._data[0]}get yTopLeft(){return this._data[1]}get xBottomRight(){return this._data[6]}get yBottomRight(){return this._data[7]}get texcoords(){return this._texcoords}get textureBinding(){return this._mosaic.textureBinding}get offsets(){return this._offsets||this._setOffsets(),this._offsets}get char(){return String.fromCharCode(this._mosaic.code)}get code(){return this._mosaic.code}get bounds(){if(!this._bounds){const{height:e,width:t}=this._mosaic.metrics,r=t*this._scale,s=Math.abs(e)*this._scale,o=new Float32Array(8);o[0]=this.x,o[1]=this.y,o[2]=this.x+r,o[3]=this.y,o[4]=this.x,o[5]=this.y+s,o[6]=this.x+r,o[7]=this.y+s;const a=(0,i.lw)((0,n.vt)(),this._rotationT,this._transform);(0,n.gb)(o,o,a);let l=1/0,u=1/0,h=-1/0,d=-1/0;for(let e=0;e<4;e++){const t=o[2*e],r=o[2*e+1];l=Math.min(l,t),u=Math.min(u,r),h=Math.max(h,t),d=Math.max(d,r)}const f=h-l,p=d-u,m=l+f/2,_=u+p/2;this._bounds=new c.A(m,_,f,p)}return this._bounds}setTransform(e){this._transform=e,this._offsets=null}_setOffsets(){this._offsets||(this._offsets={topLeft:[0,0],topRight:[0,0],bottomLeft:[0,0],bottomRight:[0,0]});const e=(0,i.lw)((0,n.vt)(),this._rotationT,this._transform);this._offsets.topLeft[0]=this._data[0],this._offsets.topLeft[1]=this._data[1],this._offsets.topRight[0]=this._data[2],this._offsets.topRight[1]=this._data[3],this._offsets.bottomLeft[0]=this._data[4],this._offsets.bottomLeft[1]=this._data[5],this._offsets.bottomRight[0]=this._data[6],this._offsets.bottomRight[1]=this._data[7],(0,s.l0)(this._offsets.topLeft,this._offsets.topLeft,e),(0,s.l0)(this._offsets.topRight,this._offsets.topRight,e),(0,s.l0)(this._offsets.bottomLeft,this._offsets.bottomLeft,e),(0,s.l0)(this._offsets.bottomRight,this._offsets.bottomRight,e)}_setTextureCoords({x:e,y:t,width:r,height:i}){this._texcoords={topLeft:[e,t],topRight:[e+r,t],bottomLeft:[e,t+i],bottomRight:[e+r,t+i]}}}const g=(e,t)=>({code:0,page:0,sdf:!0,rect:new l.A(0,0,11,8),textureBinding:t,metrics:{advance:0,height:4,width:e,left:0,top:0}});function y(e,t){return e.forEach((e=>(0,s.l0)(e,e,t))),{topLeft:e[0],topRight:e[1],bottomLeft:e[2],bottomRight:e[3]}}class x{constructor(e,t,r){this._rotation=0,this._decorate(e,t,r),this.glyphs=e,this.bounds=this._createBounds(e),this.isMultiline=t.length>1,this._hasRotation=0!==r.angle,this._transform=this._createGlyphTransform(this.bounds,r),this._borderLineSizePx=r.borderLineSizePx,(r.borderLineSizePx||r.hasBackground)&&([this.bounds,this.textBox]=this.shapeBackground(this._transform));for(const t of e)t.setTransform(this._transform)}setRotation(e){if(0===e&&0===this._rotation)return;this._rotation=e;const t=this._transform,r=(0,i.$0)((0,n.vt)(),e);(0,i.lw)(t,r,t);for(const e of this.glyphs)e.setTransform(this._transform)}_decorate(e,t,r){if(!r.decoration||"none"===r.decoration||!e.length)return;const i=r.scale,n="underline"===r.decoration?d:f,s=e[0].textureBinding;for(const r of t){const t=r.startX*i,o=r.startY*i,a=(r.width+r.glyphWidthEnd)*i;e.push(new _(t,o+n*i,g(a,s),1))}}shapeBackground(e){const t=(1.5+(this._borderLineSizePx||0))/2,r=this._borderLineSizePx?t:0,{xmin:i,ymin:n,xmax:s,ymax:o,x:a,y:l,width:u,height:h}=this.bounds,d=[i-8,n-8],f=[s+8,n-8],p=[i-8,o+8],m=[s+8,o+8],_=y([[d[0]-t,d[1]-t],[f[0]+t,f[1]-t],[d[0]+r,d[1]+r],[f[0]-r,f[1]+r]],e),g=y([[p[0]+r,p[1]-r],[m[0]-r,m[1]-r],[p[0]-t,p[1]+t],[m[0]+t,m[1]+t]],e),x=y([[d[0]-t,d[1]-t],[d[0]+r,d[1]+r],[p[0]-t,p[1]+t],[p[0]+r,p[1]-r]],e),b=y([[f[0]-r,f[1]+r],[f[0]+t,f[1]-t],[m[0]-r,m[1]-r],[m[0]+t,m[1]+t]],e),w={main:y([d,f,p,m],e),top:_,bot:g,left:x,right:b};return[new c.A(a,l,u+2*t,h+2*t),w]}get boundsT(){const e=this.bounds,t=(0,s.hZ)((0,o.vt)(),e.x,e.y);if((0,s.l0)(t,t,this._transform),this._hasRotation){const r=Math.max(e.width,e.height);return new c.A(t[0],t[1],r,r)}return new c.A(t[0],t[1],e.width,e.height)}_createBounds(e){let t=1/0,r=1/0,i=0,n=0;for(const s of e)t=Math.min(t,s.xTopLeft),r=Math.min(r,s.yTopLeft),i=Math.max(i,s.xBottomRight),n=Math.max(n,s.yBottomRight);const s=i-t,o=n-r;return new c.A(t+s/2,r+o/2,s,o)}_createGlyphTransform(e,t){const r=m*t.angle,a=(0,n.vt)(),l=(0,o.vt)();return(0,i.Tl)(a,a,(0,s.hZ)(l,t.xOffset,-t.yOffset)),t.useCIMAngleBehavior?(0,i.e$)(a,a,r):((0,i.Tl)(a,a,(0,s.hZ)(l,e.x,e.y)),(0,i.e$)(a,a,r),(0,i.Tl)(a,a,(0,s.hZ)(l,-e.x,-e.y))),a}}class b{constructor(e,t,r,i,n,s){this.glyphWidthEnd=0,this.startX=0,this.startY=0,this.start=Math.max(0,Math.min(t,r)),this.end=Math.max(0,Math.max(t,r)),this.end<e.length&&(this.glyphWidthEnd=e[this.end].metrics.width),this.width=i,this.yMin=n,this.yMax=s}}const w=e=>10===e,v=e=>32===e;function S(e,t){let r=0;for(let t=0;t<e.length;t++){const{width:i}=e[t];r=Math.max(i,r)}const i="underline"===t.decoration?h:0,n=e[0].yMin;return{x:0,y:n,height:e[e.length-1].yMax+t.lineHeight*(e.length-1)+i-n,width:r}}function T(e,t){const r=t.scale,i=new Array,{glyphs:n,isRightToLeft:s}=e,o=function(e,t,r){const i=new Array,n=1/r.scale,s=r.maxLineWidth*n,o=t?e.length-1:0,a=t?-1:e.length,l=t?-1:1;let c=o,u=0,h=0,d=c,f=d,p=0,m=1/0,_=0;for(;c!==a;){const{code:t,metrics:r}=e[c],n=Math.abs(r.top);if(w(t)||v(t)||(m=Math.min(m,n),_=Math.max(_,n+r.height)),w(t))c!==o&&(i.push(new b(e,d,c-l,u,m===1/0?0:m,_)),m=1/0,_=0),u=0,d=c+l,f=c+l,h=0;else if(v(t))f=c+l,h=0,p=r.advance,u+=r.advance;else if(u>s){if(f!==d){const t=f-2*l;u-=p,i.push(new b(e,d,t,u-h,m,_)),m=1/0,_=0,d=f,u=h}else i.push(new b(e,d,c-l,u,m,_)),m=1/0,_=0,d=c,f=c,u=0;u+=r.advance,h+=r.advance}else u+=r.advance,h+=r.advance;c+=l}const g=new b(e,d,c-l,u,m,_);return g.start>=0&&g.end<e.length&&i.push(g),i}(n,s,t),l=o.length?S(o,t):{x:0,y:0,height:0,width:0},c=(0,a.xy)(t.horizontalAlignment),h=(0,a.UD)(t.verticalAlignment),d=h===a.gy.Baseline?1:0,f=d?0:h-1,m=(1-d)*-l.y+f*(l.height/2)+(d?1:0)*-u;for(let s=0;s<o.length;s++){const{start:a,end:l,width:u}=o[s];let h=-1*(c+1)*(u/2)-p;const d=(e.isRightToLeft?o.length-1-s:s)*t.lineHeight+m-p;o[s].startX=h,o[s].startY=d;for(let e=a;e<=l;e++){const t=n[e];if(w(t.code))continue;const s=new _(h+t.metrics.left,d-t.metrics.top,t,r);h+=t.metrics.advance,i.push(s)}}return new x(i,o,t)}},69825:function(e,t,r){r.d(t,{uS:function(){return B},FE:function(){return G},lO:function(){return z},XZ:function(){return U}}),r(59122);var i=r(81484),n=r(72139),s=r(76613),o=r(39686);function a(e,t,r,i,n,s,o){F=0;const a=(i-r)*s,c=n&&n.length,h=c?(n[0]-r)*s:a;let d,f,p,m,g,y=l(t,r,0,0,h,s,!0);if(y&&y.next!==y.prev){if(c&&(y=_(t,r,i,n,y,s)),a>80*s){d=p=t[0+r*s],f=m=t[1+r*s];for(let e=s;e<h;e+=s){const i=t[e+r*s],n=t[e+1+r*s];d=Math.min(d,i),f=Math.min(f,n),p=Math.max(p,i),m=Math.max(m,n)}g=Math.max(p-d,m-f),g=0!==g?1/g:0}u(y,e,s,d,f,g,o,0)}}function l(e,t,r,i,n,s,o){let a;if(o===function(e,t,r,i,n,s){let o=0;for(let r=i,a=n-s;r<n;r+=s)o+=(e[a+t*s]-e[r+t*s])*(e[r+1+t*s]+e[a+1+t*s]),a=r;return o}(e,t,0,i,n,s)>0)for(let r=i;r<n;r+=s)a=f(r+t*s,e[r+t*s],e[r+1+t*s],a);else for(let r=n-s;r>=i;r-=s)a=f(r+t*s,e[r+t*s],e[r+1+t*s],a);return a&&T(a,a.next)&&(p(a),a=a.next),a}function c(e,t=e){if(!e)return e;let r,i=e;do{if(r=!1,i.steiner||!T(i,i.next)&&0!==x(i.prev,i,i.next))i=i.next;else{if(p(i),i=t=i.prev,i===i.next)break;r=!0}}while(r||i!==t);return t}function u(e,t,r,i,n,s,o,a){if(!e)return;!a&&s&&(e=y(e,i,n,s));let l=e;for(;e.prev!==e.next;){const f=e.prev,m=e.next;if(s?d(e,i,n,s):h(e))t.push(f.index/r+o),t.push(e.index/r+o),t.push(m.index/r+o),p(e),e=m.next,l=m.next;else if((e=m)===l){a?1===a?u(e=M(e,t,r,o),t,r,i,n,s,o,2):2===a&&A(e,t,r,i,n,s,o):u(c(e),t,r,i,n,s,o,1);break}}}function h(e){const t=e.prev,r=e,i=e.next;if(x(t,r,i)>=0)return!1;let n=e.next.next;const s=n;let o=0;for(;n!==e.prev&&(0===o||n!==s);){if(o++,w(t.x,t.y,r.x,r.y,i.x,i.y,n.x,n.y)&&x(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function d(e,t,r,i){const n=e.prev,s=e,o=e.next;if(x(n,s,o)>=0)return!1;const a=n.x<s.x?n.x<o.x?n.x:o.x:s.x<o.x?s.x:o.x,l=n.y<s.y?n.y<o.y?n.y:o.y:s.y<o.y?s.y:o.y,c=n.x>s.x?n.x>o.x?n.x:o.x:s.x>o.x?s.x:o.x,u=n.y>s.y?n.y>o.y?n.y:o.y:s.y>o.y?s.y:o.y,h=S(a,l,t,r,i),d=S(c,u,t,r,i);let f=e.prevZ,p=e.nextZ;for(;f&&f.z>=h&&p&&p.z<=d;){if(f!==e.prev&&f!==e.next&&w(n.x,n.y,s.x,s.y,o.x,o.y,f.x,f.y)&&x(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,p!==e.prev&&p!==e.next&&w(n.x,n.y,s.x,s.y,o.x,o.y,p.x,p.y)&&x(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;f&&f.z>=h;){if(f!==e.prev&&f!==e.next&&w(n.x,n.y,s.x,s.y,o.x,o.y,f.x,f.y)&&x(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;p&&p.z<=d;){if(p!==e.prev&&p!==e.next&&w(n.x,n.y,s.x,s.y,o.x,o.y,p.x,p.y)&&x(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function f(e,t,r,i){const n=C.create(e,t,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function p(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function m(e){let t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function _(e,t,r,i,n,s){const o=new Array;for(let n=0,a=i.length;n<a;n++){const c=l(e,t,0,i[n]*s,n<a-1?i[n+1]*s:r*s,s,!1);c===c.next&&(c.steiner=!0),o.push(m(c))}o.sort(I);for(const e of o)n=g(e,n);return n}function g(e,t){const r=function(e,t){let r=t;const i=e.x,n=e.y;let s,o=-1/0;do{if(n<=r.y&&n>=r.next.y&&r.next.y!==r.y){const e=r.x+(n-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(e<=i&&e>o){if(o=e,e===i){if(n===r.y)return r;if(n===r.next.y)return r.next}s=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!s)return null;if(i===o)return s.prev;const a=s,l=s.x,c=s.y;let u,h=1/0;for(r=s.next;r!==a;)i>=r.x&&r.x>=l&&i!==r.x&&w(n<c?i:o,n,l,c,n<c?o:i,n,r.x,r.y)&&(u=Math.abs(n-r.y)/(i-r.x),(u<h||u===h&&r.x>s.x)&&v(r,e)&&(s=r,h=u)),r=r.next;return s}(e,t);if(!r)return t;const i=P(r,e);return c(i,i.next),c(r,r.next)}function y(e,t,r,i){let n;for(;n!==e;n=n.next){if(n=n||e,null===n.z&&(n.z=S(n.x,n.y,t,r,i)),n.prev.next!==n||n.next.prev!==n)return n.prev.next=n,n.next.prev=n,y(e,t,r,i);n.prevZ=n.prev,n.nextZ=n.next}return e.prevZ.nextZ=null,e.prevZ=null,function(e){let t,r=1;for(;;){let i,n=e;e=null,t=null;let s=0;for(;n;){s++,i=n;let o=0;for(;o<r&&i;o++)i=i.nextZ;let a=r;for(;o>0||a>0&&i;){let r;0===o?(r=i,i=i.nextZ,a--):0!==a&&i?n.z<=i.z?(r=n,n=n.nextZ,o--):(r=i,i=i.nextZ,a--):(r=n,n=n.nextZ,o--),t?t.nextZ=r:e=r,r.prevZ=t,t=r}n=i}if(t.nextZ=null,r*=2,s<2)return e}}(e)}function x(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function b(e,t,r,i){return!!(T(e,t)&&T(r,i)||T(e,i)&&T(r,t))||x(e,t,r)>0!=x(e,t,i)>0&&x(r,i,e)>0!=x(r,i,t)>0}function w(e,t,r,i,n,s,o,a){return(n-o)*(t-a)-(e-o)*(s-a)>=0&&(e-o)*(i-a)-(r-o)*(t-a)>=0&&(r-o)*(s-a)-(n-o)*(i-a)>=0}function v(e,t){return x(e.prev,e,e.next)<0?x(e,t,e.next)>=0&&x(e,e.prev,t)>=0:x(e,t,e.prev)<0||x(e,e.next,t)<0}function S(e,t,r,i,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function T(e,t){return e.x===t.x&&e.y===t.y}function I(e,t){return e.x-t.x}function M(e,t,r,i){let n=e;do{const s=n.prev,o=n.next.next;!T(s,o)&&b(s,n,n.next,o)&&v(s,o)&&v(o,s)&&(t.push(s.index/r+i),t.push(n.index/r+i),t.push(o.index/r+i),p(n),p(n.next),n=e=o),n=n.next}while(n!==e);return n}function A(e,t,r,i,n,s,o){let a=e;do{let e=a.next.next;for(;e!==a.prev;){if(a.index!==e.index&&E(a,e)){let l=P(a,e);return a=c(a,a.next),l=c(l,l.next),u(a,t,r,i,n,s,o,0),void u(l,t,r,i,n,s,o,0)}e=e.next}a=a.next}while(a!==e)}function E(e,t){return e.next.index!==t.index&&e.prev.index!==t.index&&!function(e,t){let r=e;do{if(r.index!==e.index&&r.next.index!==e.index&&r.index!==t.index&&r.next.index!==t.index&&b(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&v(e,t)&&v(t,e)&&function(e,t){let r=e,i=!1;const n=(e.x+t.x)/2,s=(e.y+t.y)/2;do{r.y>s!=r.next.y>s&&r.next.y!==r.y&&n<(r.next.x-r.x)*(s-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next}while(r!==e);return i}(e,t)}function P(e,t){const r=C.create(e.index,e.x,e.y),i=C.create(t.index,t.x,t.y),n=e.next,s=t.prev;return e.next=t,t.prev=e,r.next=n,n.prev=r,i.next=r,r.prev=i,s.next=i,i.prev=s,i}r(58941);class C{constructor(){this.index=0,this.x=0,this.y=0,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}static create(e,t,r){const i=F<R.length?R[F++]:new C;return i.index=e,i.x=t,i.y=r,i.prev=null,i.next=null,i.z=null,i.prevZ=null,i.nextZ=null,i.steiner=!1,i}}const R=[];let F=0;for(let e=0;e<8096;e++)R.push(new C);const L=1e-5,k=new n.O3(0,0,0,1,0),N=new n.O3(0,0,0,1,0);function O(e,t,r){let i=0;for(let n=1;n<r;n++){const r=e[2*(t+n-1)],s=e[2*(t+n-1)+1];i+=(e[2*(t+n)]-r)*(e[2*(t+n)+1]+s)}return i}function D(e,t,r,i,n){let s=0;for(let o=r;o<i;o+=3){const r=2*(e[o]-n),i=2*(e[o+1]-n),a=2*(e[o+2]-n);s+=Math.abs((t[r]-t[a])*(t[i+1]-t[r+1])-(t[r]-t[i])*(t[a+1]-t[r+1]))}return s}function z(e,t){const{coords:r,lengths:i}=t,n=e;let s=0;for(let e=0;e<i.length;){let t=e,o=i[e],l=O(r,s,o);const c=[];for(;++t<i.length;){const e=i[t],n=O(r,s+o,e);if(!(n>0))break;l+=n,c.push(s+o),o+=e}const u=n.length;a(n,r,s,s+o,c,2,0);const h=D(n,r,u,n.length,0),d=Math.abs(l);if(Math.abs((h-d)/Math.max(1e-7,d))>L)return n.length=0,!1;e=t,s+=o}return!0}function U(e){const{coords:t,lengths:r}=e,{buffer:n}=(0,i.l)(t,r);return n}function G(e,t){if(null==e)return null;if(!function(e,t,r){let i=0;for(let t=0;t<e.lengths.length;t++){const n=e.lengths[t];for(let t=0;t<n;t++){const n=e.coords[2*(t+i)],s=e.coords[2*(t+i)+1];if(n<-128||n>r||s<-128||s>r)return!0}i+=n}return!1}(e,0,o.CQ+128))return e;k.setPixelMargin(t),k.reset(n.dC.Polygon);let r=0;for(let t=0;t<e.lengths.length;t++){const i=e.lengths[t];let n=e.coords[2*(0+r)],s=e.coords[2*(0+r)+1];k.moveTo(n,s);for(let t=1;t<i;t++)n=e.coords[2*(t+r)],s=e.coords[2*(t+r)+1],k.lineTo(n,s);k.close(),r+=i}const i=k.result(!1);if(!i)return null;const a=[],l=[];for(const e of i){let t=0;for(const r of e)l.push(r.x),l.push(r.y),t++;a.push(t)}return new s.A(a,l)}function B(e,t){N.setPixelMargin(t);const r=N,i=-t,s=o.CQ+t;let a=[],l=!1;if(!e.nextPath())return null;let c=!0;for(;c;){e.seekPathStart();const t=[];if(!e.pathSize)return null;r.reset(n.dC.LineString),e.nextPoint();let o=e.x,u=e.y;if(l)r.moveTo(o,u);else{if(o<i||o>s||u<i||u>s){l=!0;continue}t.push({x:o,y:u})}let h=!1;for(;e.nextPoint();)if(o=e.x,u=e.y,l)r.lineTo(o,u);else{if(o<i||o>s||u<i||u>s){h=!0;break}t.push({x:o,y:u})}if(h)l=!0;else{if(l){const e=r.resultWithStarts();if(e)for(const t of e)a.push(t)}else a.push({line:t,start:0});c=e.nextPath(),l=!1}}return a=a.filter((e=>e.line.length>1)),0===a.length?null:a}k.setExtent(o.CQ),N.setExtent(o.CQ)},85475:function(e,t,r){r.d(t,{Kl:function(){return l},M9:function(){return o},fw:function(){return a}});const i=new Float32Array(1),n=new Uint32Array(i.buffer);function s(e){return i[0]=e,n[0]}function o(e,t){return 65535&e|t<<16}function a(e){const t=s(e),r=t>>>31;let i=t>>>23&255,n=8388607&t;return i-=127,i>15?r<<15|31744:i<-25?0:(i<-14&&(n+=8388608,n/=2**(-14-i),i=-15),i+=15,n/=8192,n=function(e){const t=Math.floor(e),r=e-t;return t<1023&&(r>.5||.5===r&&t%2==1)?t+1:t}(n),r<<15|i<<10|n)}function l(e){let t=e>>>15,r=e>>10&31,i=1023&e;return t=t?-1:1,r-=15,i/=1024,r>-15?i+=1:r=-14,t*2**r*i}},98282:function(e,t,r){r.d(t,{Y7:function(){return O},HS:function(){return D},mm:function(){return z},A:function(){return G},k2:function(){return U},ZA:function(){return N},E8:function(){return L},hF:function(){return C},C5:function(){return P},uK:function(){return F},Pi:function(){return R}});var i=r(53804),n=(r(58941),r(40633)),s=r(50944),o=r(39819),a=r(54516),l=r(90553);class c{constructor(){this._includedModules=new Map}include(e,t){this._includedModules.has(e)?this._includedModules.get(e):(this._includedModules.set(e,t),e(this.builder,t))}}class u extends c{constructor(){super(...arguments),this.vertex=new f,this.fragment=new f,this.attributes=new p,this.varyings=new m,this.extensions=new _,this.constants=new g}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(e,t=!0){const r=this.extensions.generateSource(e),i=this.attributes.generateSource(e),n=this.varyings.generateSource(e),s="vertex"===e?this.vertex:this.fragment,o=s.uniforms.generateSource(),a=s.code.generateSource(),l="vertex"===e?y:"#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif\n",c=this.constants.generateSource().concat(s.constants.generateSource());return`${t?"#version 300 es":""}\n${r.join("\n")}\n${l}\n${c.join("\n")}\n${o.join("\n")}\n${i.join("\n")}\n${n.join("\n")}\n${a.join("\n")}`}generateBindPass(e){const t=new Map;this.vertex.uniforms.entries.forEach((e=>{const r=e.bind[a.c.Pass];r&&t.set(e.name,r)})),this.fragment.uniforms.entries.forEach((e=>{const r=e.bind[a.c.Pass];r&&t.set(e.name,r)}));const r=Array.from(t.values()),i=r.length;return(t,n)=>{for(let s=0;s<i;++s)r[s](e,t,n)}}generateBindDraw(e){const t=new Map;this.vertex.uniforms.entries.forEach((e=>{const r=e.bind[a.c.Draw];r&&t.set(e.name,r)})),this.fragment.uniforms.entries.forEach((e=>{const r=e.bind[a.c.Draw];r&&t.set(e.name,r)}));const r=Array.from(t.values()),i=r.length;return(t,n,s)=>{for(let o=0;o<i;++o)r[o](e,s,t,n)}}}class h{constructor(){this._entries=new Map}add(...e){for(const t of e)this._add(t)}get(e){return this._entries.get(e)}_add(e){if(null!=e){if(this._entries.has(e.name)&&!this._entries.get(e.name).equals(e))throw new o.A(`Duplicate uniform name ${e.name} for different uniform type`);this._entries.set(e.name,e)}else n.A.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder").error(`Trying to add null Uniform from ${(new Error).stack}.`)}generateSource(){return Array.from(this._entries.values()).map((e=>null!=e.arraySize?`uniform ${e.type} ${e.name}[${e.arraySize}];`:`uniform ${e.type} ${e.name};`))}get entries(){return Array.from(this._entries.values())}}class d{constructor(){this._entries=new Array}add(e){this._entries.push(e)}generateSource(){return this._entries}}class f extends c{constructor(){super(...arguments),this.uniforms=new h,this.code=new d,this.constants=new g}get builder(){return this}}class p{constructor(){this._entries=new Array}add(e,t){this._entries.push([e,t])}generateSource(e){return"fragment"===e?[]:this._entries.map((e=>`in ${e[1]} ${e[0]};`))}}class m{constructor(){this._entries=new Map}add(e,t){this._entries.has(e)&&(0,l.vA)(this._entries.get(e)===t),this._entries.set(e,t)}generateSource(e){const t=new Array;return this._entries.forEach(((r,i)=>t.push("vertex"===e?`out ${r} ${i};`:`in ${r} ${i};`))),t}}class _{constructor(){this._entries=new Set}add(e){this._entries.add(e)}generateSource(e){const t="vertex"===e?_.ALLOWLIST_VERTEX:_.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter((e=>t.includes(e))).map((e=>`#extension ${e} : enable`))}}_.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],_.ALLOWLIST_VERTEX=[];class g{constructor(){this._entries=new Set}add(e,t,r){let i="ERROR_CONSTRUCTOR_STRING";switch(t){case"float":i=g._numberToFloatStr(r);break;case"int":i=g._numberToIntStr(r);break;case"bool":i=r.toString();break;case"vec2":i=`vec2(${g._numberToFloatStr(r[0])},                            ${g._numberToFloatStr(r[1])})`;break;case"vec3":i=`vec3(${g._numberToFloatStr(r[0])},                            ${g._numberToFloatStr(r[1])},                            ${g._numberToFloatStr(r[2])})`;break;case"vec4":i=`vec4(${g._numberToFloatStr(r[0])},                            ${g._numberToFloatStr(r[1])},                            ${g._numberToFloatStr(r[2])},                            ${g._numberToFloatStr(r[3])})`;break;case"ivec2":i=`ivec2(${g._numberToIntStr(r[0])},                             ${g._numberToIntStr(r[1])})`;break;case"ivec3":i=`ivec3(${g._numberToIntStr(r[0])},                             ${g._numberToIntStr(r[1])},                             ${g._numberToIntStr(r[2])})`;break;case"ivec4":i=`ivec4(${g._numberToIntStr(r[0])},                             ${g._numberToIntStr(r[1])},                             ${g._numberToIntStr(r[2])},                             ${g._numberToIntStr(r[3])})`;break;case"mat2":case"mat3":case"mat4":i=`${t}(${Array.prototype.map.call(r,(e=>g._numberToFloatStr(e))).join(", ")})`}return this._entries.add(`const ${t} ${e} = ${i};`),this}static _numberToIntStr(e){return e.toFixed(0)}static _numberToFloatStr(e){return Number.isInteger(e)?e.toFixed(1):e.toString()}generateSource(){return Array.from(this._entries)}}const y="precision highp float;\nprecision highp sampler2D;";var x=r(70931);function b(e,t,r){const i=t.split("\n");for(const t of i)if(t.trim().length){{let t="";null!=r&&(t+=`/*id:${r??"000"}*/   `),e.body+=t.padEnd(14)}e.body+=" ".repeat(e.indent)+t+"\n"}}class w{write(e){for(const t of e.rootOutputNodes())e.shouldPruneOutputNode(t)||(t.variableName=this._write(e,t.node));return e}_createVarName(e,t){let r="";return"boolean"!=typeof t&&"number"!=typeof t&&t.debugInfo.name&&(r=`${t.debugInfo.name}_`),`${r}v${e.varCount++}`}_write(e,t,r=!1){if("number"==typeof t)return t.toString();if("boolean"==typeof t)return t.toString();let i=e.getEmit(t);if(i)return i;switch(t.shaderType){case"scope-node":i=this._writeScopeNode(e,t);break;case"primitive-node":i=this._writePrimitiveNode(e,t,r);break;case"function-node":i=this._writeFunctionNode(e,t);break;case"property-access-node":i=this._writePropertyAccessNode(e,t);break;case"text-node":i=t.text;break;case"block-node":i=this._writeBlockNode(e,t);break;case"condition-node":i=this._writeConditionNode(e,t)}return e.setEmit(t,i),i}_writeScopeNode(e,t){const r=new t.child.constructor;r.setDebugName(t.debugInfo.name);const i=this._write(e,r,!0);return b(e,`{ /*ScopeStart: ${t.uid} ${t.debugInfo.name}*/`),e.indent+=2,b(e,`${i} = ${this._write(e,t.child)};`),e.indent-=2,b(e,`} /*ScopeEnd: ${t.uid} ${t.debugInfo.name}*/`),i}_writeConditionNode(e,t){const r=new t.ifTrue.constructor,i=this._write(e,r,!0);b(e,`if (${this._write(e,t.condition)}) {`),e.indent+=2;const n=e.createSubgraphContext(),s=this._write(n,t.ifTrue);if(e.body+=n.body,s&&b(e,`${i} = ${s};`),e.indent-=2,b(e,"}"),t.ifFalse){b(e,"else {"),e.indent+=2;const r=e.createSubgraphContext(),n=this._write(r,t.ifFalse);e.body+=r.body,n&&b(e,`${i} = ${n};`),e.indent-=2,b(e,"}")}return i}_writeBlockNode(e,t){const{captureList:r,generator:i,returnType:n}=t,s={};for(const t in r){if(!r[t])continue;const i=this._write(e,r[t]);s[t]=i}const o=new n,a=this._write(e,o,!0);if(s.out=a,t.subgraph){const r=e.createSubgraphContext(),i=this._write(r,t.subgraph.child),n=r.body;s.subgraph={varName:i,body:n}}const l=i(s);return b(e,"{\n"),e.indent+=2,b(e,l),e.indent-=2,b(e,"}\n"),a}_writePropertyAccessNode(e,t){const r=this._write(e,t.target);return"string"==typeof t.property&&t.property.includes("[")?`${r}${t.property}`:"string"!=typeof t.property?`${r}[${this._write(e,t.property)}]`:`${r}.${t.property}`}_writeFunctionNode(e,t){const r=t.returnType.type;if(t.isInfix){const[i,n]=t.children.map((t=>this._write(e,t))),s=this._createVarName(e,t);return b(e,`${r.padEnd(5)} ${s} = ${i} ${t.token} ${n};`,t.uid),s}const i=t.children.map((t=>this._write(e,t))).join(", "),n=this._createVarName(e,t);return b(e,`${r.padEnd(5)} ${n} = ${t.token}(${i});`,t.uid),n}_writePrimitiveNode(e,t,r=!1){const i=e.getInput(t);if(i)return i.isUsed=!0,i.variableName;const n=1===t.children.length&&t.children[0]?.type===t.type;if(t.isImplicit||n)return this._write(e,t.children[0]);const s=this._createVarName(e,t);if(r)return b(e,`${t.type.padEnd(5)} ${s};`,t.uid),s;const o=!t.debugInfo.name&&!t.isMutable;if(o&&"float"===t.type&&"number"==typeof t.children[0])return Number.isInteger(t.children[0])?t.children[0].toFixed(1):t.children[0].toString();if(o&&"int"===t.type&&"number"==typeof t.children[0]&&Number.isInteger(t.children[0]))return t.children[0].toString();const a=t.children.map((t=>this._write(e,t))).join(", ");return"array"===t.type?(b(e,`${t.type.padEnd(5)} ${s} = [${a}];`,t.uid),s):o?`${t.type}(${a})`:(b(e,`${t.type.padEnd(5)} ${s} = ${t.type}(${a});`,t.uid),s)}}var v=r(44784);class S{constructor(e,t,r){this.variableName=e,this.variableInputType=t,this.node=r,this.type="shader-input",this.isUsed=!1}clone(){return new S(this.variableName,this.variableInputType,(0,v.vA)(this.node))}}class T{constructor(e,t,r){this.outVariableName=e,this.outVariableType=t,this.node=r,this.type="shader-output"}clone(){const e=new T(this.outVariableName,this.outVariableType,(0,v.vA)(this.node));return e.variableName=this.variableName,e}}class I{static createVertex(e,t,r,i,n,s){const o=[];for(const t in e){const i=e[t],n=r.get(t);n?o.push(new S(n,"builtin",i)):o.push(new S("a_"+t,"in",i))}for(const e of i){const t=e.uniformHydrated;o.push(new S(e.uniformName,"uniform",t))}const a=[];for(const e in t){const r=t[e];"glPosition"===e?a.push(new T("gl_Position","builtin",r)):"glPointSize"===e?a.push(new T("gl_PointSize","builtin",r)):a.push(new T("v_"+e,"out",r))}return new I(o,a,n,s)}static createFragment(e,t,r,i,n,s){const o=[],a=Array.from(n.rootOutputNodes());for(const t in e){const i=e[t],n=r.get(t);if(n){o.push(new S(n,"builtin",i));continue}const s=a.find((e=>e.node===i));s&&o.push(new S(s.outVariableName,"in",i))}for(const e of i){const t=e.uniformHydrated;o.push(new S(e.uniformName,"uniform",t))}const l=[];for(const e in t){const i=t[e],n=r.get(e);"discard"===e?l.push(new T(null,"discard",i)):n?l.push(new T(n,"builtin",i)):l.push(new T(e,"out",i))}return new I(o,l,s)}constructor(e,t,r,i){this.type="shader-graph-context",this.indent=0,this.body="",this.varCount=0,this._inputShaderTypesByNodeUid=new Map,this._nodeEmitMap=new Map;for(const t of e)this._inputShaderTypesByNodeUid.set(t.node.uid,t);this._outputShaderTypes=t,this._transformFeedbackBindings=r,this._transformFeedbackNames=new Set(r.map((e=>"v_"+e.propertyKey))),this._usedInFragmentShader=i}shouldPruneOutputNode(e){return!!this._usedInFragmentShader&&"builtin"!==e.outVariableType&&!this._transformFeedbackNames.has(e.outVariableName)&&!this._usedInFragmentShader.has(e.node.uid)}setEmit(e,t){this._nodeEmitMap.set(e.uid,t)}getEmit(e){return this._nodeEmitMap.get(e.uid)}inputs(){return this._inputShaderTypesByNodeUid.values()}getInput(e){return this._inputShaderTypesByNodeUid.get(e.uid)}*rootOutputNodes(){for(const e of this._outputShaderTypes)yield e}*nodes(){const e=[];for(const t of this._outputShaderTypes.values())e.push(t.node);for(;e.length;){const t=e.pop();"number"!=typeof t&&"boolean"!=typeof t&&e.push(...t.children.filter(Boolean)),yield t}}*nodesOfTypeOrFunction(){for(const e of this.nodes())"number"!=typeof e&&"boolean"!=typeof e&&(yield e)}createSubgraphContext(){const e=this.clone();return e.body="",e.indent=this.indent+2,e._nodeEmitMap=new Map(this._nodeEmitMap),e}clone(){const e=new I([],this._outputShaderTypes,this._transformFeedbackBindings,this._usedInFragmentShader);return e._inputShaderTypesByNodeUid=this._inputShaderTypesByNodeUid,e.indent=this.indent,e.body=this.body,e.varCount=this.varCount,e._nodeEmitMap=this._nodeEmitMap,e}insertVertexShader(e){e.vertex.code.add(""),this._insertInputs(e,"vertex"),e.vertex.code.add(""),e.vertex.code.add("// OUTPUTS: "),e.vertex.code.add("// --------------------------------------------------------- ");for(const t of this.rootOutputNodes()){const r="builtin"===t.outVariableType;this.shouldPruneOutputNode(t)||(r?e.vertex.code.add(`// ${t.outVariableType.padEnd(7)} ${t.node.type.padEnd(9)} ${t.outVariableName};`):e.vertex.code.add(`${t.outVariableType.padEnd(10)} ${t.node.type.padEnd(9)} ${t.outVariableName};`))}e.vertex.code.add(""),e.vertex.code.add("void main() {"),e.vertex.code.add("  "+this.body.split("\n").join("\n  "));for(const t of this.rootOutputNodes())this.shouldPruneOutputNode(t)||e.vertex.code.add(`  ${t.outVariableName} = ${t.variableName};`);e.vertex.code.add("}")}insertFragmentShader(e){this._insertInputs(e,"fragment"),e.fragment.code.add(""),e.fragment.code.add("// OUTPUTS: "),e.fragment.code.add("// --------------------------------------------------------- ");for(const t of this.rootOutputNodes())"builtin"===t.outVariableType?e.fragment.code.add(`// ${t.outVariableType.padEnd(7)} ${t.node.type.padEnd(9)} ${t.outVariableName};`):e.fragment.code.add(`${t.outVariableType.padEnd(10)} ${t.node.type.padEnd(9)} ${t.outVariableName};`);e.fragment.code.add(""),e.fragment.code.add("void main() {"),e.fragment.code.add("  "+this.body.split("\n").join("\n  "));for(const t of this.rootOutputNodes())"discard"===t.outVariableType?(e.fragment.code.add("  // TODO: Should ensure codegen for discard appears first in fragment shader"),e.fragment.code.add(`  if (${t.variableName}) {`),e.fragment.code.add("    discard;"),e.fragment.code.add("  }"),e.fragment.code.add("  ")):e.fragment.code.add(`  ${t.outVariableName} = ${t.variableName};`);e.fragment.code.add("}")}_insertInputs(e,t){e[t].code.add("// INPUTS: "),e[t].code.add("// --------------------------------------------------------- ");for(const r of this.inputs())r.isUsed&&"builtin"!==r.variableInputType&&("array"===r.node.type?e[t].code.add(`${r.variableInputType.padEnd(10)} ${r.node.elementType.type.padEnd(9)} ${r.variableName}[${r.node.size}];`):e[t].code.add(`${r.variableInputType.padEnd(10)} ${r.node.type.padEnd(9)} ${r.variableName};`))}}var M=r(22516);function A(e){return new e}function E(e,t,r){const i=e.constructor[t]??[];e.constructor.hasOwnProperty(t)||Object.defineProperty(e.constructor,t,{value:i.slice()}),e.constructor[t].push(r)}function P(e,t){return(r,i)=>{E(r,"locations",{typeCtor:t,propertyKey:i,parameterIndex:null,index:e})}}const C=e=>(t,r,i)=>{E(t,"inputs",{inputCtor:e,propertyKey:r,parameterIndex:i})},R=e=>(t,r)=>{E(t,"uniforms",{typeCtor:e,propertyKey:r})},F=e=>(t,r)=>{E(t,"options",{typeCtor:e,propertyKey:r})},L=(e,t)=>{E(e,"defines",{propertyKey:t})},k=(e,t)=>(r,i)=>{r.constructor.builtins.push({builtin:e,propertyKey:i,typeCtor:t})};class N{}N.builtins=[],(0,i._)([k("gl_VertexID",x.Ai)],N.prototype,"glVertexID",void 0);class O{}class D{}D.builtins=[],(0,i._)([k("gl_FragCoord",x.Zb)],D.prototype,"glFragCoord",void 0),(0,i._)([k("gl_PointCoord",x.ZY)],D.prototype,"glPointCoord",void 0);class z{}class U{constructor(){this.type="uniform-group"}get _uniforms(){return this.constructor.uniforms??[]}}class G{constructor(){this.logShader=!1,this.computeAttributes={}}get vertexInput(){const e=this._shaderModuleClass.inputs.findLast((e=>"vertex"===e.propertyKey&&0===e.parameterIndex));if(!e)throw new Error("Unable to find vertex input parameter");return e}get computeInput(){return this._shaderModuleClass.inputs.findLast((e=>"vertex"===e.propertyKey&&1===e.parameterIndex))}get fragmentInput(){const e=this._shaderModuleClass.inputs.findLast((e=>"fragment"===e.propertyKey));if(!e)throw new Error("Unable to find fragment input parameter");return e}get transformFeedbackBindings(){return this.fragmentInput.inputCtor.transformFeedbackBindings??[]}get locations(){return[...this.vertexInput.inputCtor.locations,...this.computeInput?.inputCtor.locations??[]]}get locationsMap(){const e=new Map,t=new Set;for(const r of this.locations)t.has(r.index)?n.A.getLogger("esri.views.2d.engine.webgl.shaderGraph.GraphShaderModule").warnOnce("mapview-rendering",`Unable to assigned attribute ${r.propertyKey} to ${r.index}. Index already in use`,{locationsMap:e}):(e.set(r.propertyKey,r.index),t.add(r.index));return e}get locationInfo(){if(!this._locationInfo){const e=this.locationsMap,t=Array.from(e.entries()).map((([e,t])=>`${e}.${t}`)).join("."),r=(0,s.Wm)(t),i=this.computeAttributes;this._locationInfo={hash:r,locations:e,computeAttributeMap:i}}return this._locationInfo}get renamedLocationsMap(){const e=new Map;for(const t of this.locations)e.set("a_"+t.propertyKey,t.index);return e}get optionPropertyKeys(){if(!this._optionPropertyKeys){const e=new Set;for(const t of this._options)e.add(t.propertyKey);this._optionPropertyKeys=e}return this._optionPropertyKeys}get _shaderModuleClass(){return this.constructor}get _defines(){return this._shaderModuleClass.defines??[]}get _options(){return this._shaderModuleClass.options??[]}get _uniforms(){return this._shaderModuleClass.uniforms??[]}getProgram(e,t,r,i){try{const{vertex:n,fragment:s,uniformBindings:o}=this._generateShaders(e,t,r,i);return new M.K(n,s,this.renamedLocationsMap,this.locationInfo,o,this.transformFeedbackBindings)}catch(e){return new M.K("","",this.renamedLocationsMap,this.locationInfo,[],this.transformFeedbackBindings)}}getDebugUniformClassInfo(e){const t=this._options.find((t=>t.propertyKey===e));if(t)return{type:"option",className:t.typeCtor};const r=this._uniforms.find((t=>t.propertyKey===e));if(!r)throw new Error(`Unable to find uniform class type for property: ${e}`);return{type:"required",className:r.typeCtor}}getShaderKey(e,t,r,i){const n=Object.keys(e).map((t=>`${t}.${e[t]}`)).join("."),s=Object.keys(r).map((e=>`${e}.${r[e]}`)).join("."),o=Object.keys(i).map((e=>`${e}.${i[e]}`)).join("."),a=Object.keys(t).filter((e=>this.optionPropertyKeys.has(e)&&t[e])).join(".");return`${this.constructor.name}.${n}.${s}.${o}.${a}`}_generateShaders(e,t,r,i){const n=[];this._setDefines(r),this._setOptionalUniforms(n,t),this._setRequiredUniforms(n);const s=this._hydrateVertexInput(i),o=this._injectPackPrecisionFactor(s,e),a=this._hydrateComputeInput(),l=a&&this._injectComputePackPrecisionFactor(a,e),c=this.vertex(o,l),u=this._hydrateFragmentInput(c),h=this.fragment(u),d=new Set;for(const e in h){const t=h[e];(0,v.rz)(d,t)}const f=this._getVertexInputBuiltins(),p=I.createVertex({...s,...a},c,f,n,this.transformFeedbackBindings,d);(new w).write(p);const m=this._getFragmentInputBuiltins(h);m.set("glPointCoord","gl_PointCoord");const _=I.createFragment(u,h,m,n,p,this.transformFeedbackBindings);(new w).write(_);const g=this._createShaderBuilder(p,_),y=g.generate("vertex",!0),x=g.generate("fragment",!0);return this.logShader&&(console.log(y),console.log(x)),{vertex:y,fragment:x,uniformBindings:n}}_setDefines(e){for(const t in e)this[t]=e[t]}_setOptionalUniforms(e,t){for(const r of this._options)t[r.propertyKey]?this[r.propertyKey]=this._hydrateUniformGroup(e,r):this[r.propertyKey]=null}_setRequiredUniforms(e){for(const t of this._uniforms)this[t.propertyKey]=this._hydrateUniformGroup(e,t)}_hydrateUniformGroup(e,t){const r=new(0,t.typeCtor);for(const i of r._uniforms??[]){const n=A(i.typeCtor),s=`u_${t.propertyKey}_${i.propertyKey}`,o=n.type,a=[t.propertyKey,i.propertyKey].join(".");if("type"in i.typeCtor&&"array"===i.typeCtor.type){const t=n;e.push({shaderModulePath:a,uniformName:s,uniformType:o,uniformArrayLength:t.size,uniformArrayElementType:t.elementType.type,uniformHydrated:n})}else e.push({shaderModulePath:a,uniformName:s,uniformType:o,uniformHydrated:n});r[i.propertyKey]=n}return r}_hydrateVertexInput(e){const t=this.vertexInput.inputCtor,r=t.locations.reduce(((t,r)=>!1===e[r.propertyKey]?t:{...t,[r.propertyKey]:A(r.typeCtor)}),{});for(const{propertyKey:e,typeCtor:i}of t.builtins){const t=A(i);r[e]=t}return r}_hydrateComputeInput(){return null==this.computeInput?null:this.computeInput.inputCtor.locations.reduce(((e,t)=>({...e,[t.propertyKey]:A(t.typeCtor)})),{})}_injectPackPrecisionFactor(e,t){const r={};for(const i in e){const n=e[i],s=t[i];if(s){if("float"!==n.type&&"vec2"!==n.type&&"vec3"!==n.type&&"vec4"!==n.type)throw new Error(`InternalError: packPrecisionFactor requires GenType, but found ${n.type}`);r[i]=n.divide(new x.nt(s))}else r[i]=n}return r}_injectComputePackPrecisionFactor(e,t){const r={},i=new Map;for(const e in this.computeAttributes)for(const t of this.computeAttributes[e]??[])i.set(t,e);for(const n in e){const s=e[n],o=i.get(n);if(!o)continue;const a=t[o];if(a){if("float"!==s.type&&"vec2"!==s.type&&"vec3"!==s.type&&"vec4"!==s.type)throw new Error(`InternalError: packPrecisionFactor requires GenType, but found ${s.type}`);r[n]=s.divide(new x.nt(a))}else r[n]=s}return r}_hydrateFragmentInput(e){const t={};for(const r in e)t[r]=e[r];for(const{propertyKey:e,typeCtor:r}of D.builtins){const i=A(r);t[e]=i}return t}_getVertexInputBuiltins(){const e=this.vertexInput.inputCtor,t=new Map;for(const{builtin:r,propertyKey:i}of e.builtins)t.set(i,r);return t}_getFragmentInputBuiltins(e){const t=e.constructor,r=new Map;for(const e of t.builtins??[])r.set(e.propertyKey,e.builtin);return r}_createShaderBuilder(e,t){const r=new u;return this._insertDebugInfo(r),e.insertVertexShader(r),t.insertFragmentShader(r),r}_insertDebugInfo(e){e.vertex.code.add("// DEFINES: "),e.vertex.code.add("// --------------------------------------------------------- ");for(const t of this._defines)this[t.propertyKey]?e.vertex.code.add(`//   ${t.propertyKey}: true`):e.vertex.code.add(`//   ${t.propertyKey}: false`);e.vertex.code.add(""),e.vertex.code.add("// OPTIONS: "),e.vertex.code.add("// --------------------------------------------------------- ");for(const t of this._options)this[t.propertyKey]?e.vertex.code.add(`//   ${t.propertyKey}: true`):e.vertex.code.add(`//   ${t.propertyKey}: false`)}}},44784:function(e,t,r){function i(e,t){const r=[];for(r.push(t);r.length;){const t=r.pop();if("object"==typeof t&&!e.has(t.uid)){e.add(t.uid);for(const e of t.children)r.push(e)}}}r.d(t,{XL:function(){return c},aw:function(){return h},rR:function(){return u},rz:function(){return i},vA:function(){return s},vL:function(){return o},zg:function(){return l}});class n{constructor(){this.uid=n.NodeCount++,this._debugName=null,this._isMutable=!1,this.isImplicit=!1}get isMutable(){return this._isMutable}setMutable(){return this._isMutable=!0,this}setDebugName(e){return e=e.split(" ").map(((e,t)=>t>0?e.charAt(0).toUpperCase()+e.slice(1):e)).join(""),this._debugName=e,this.isImplicit&&this.children[0]instanceof n&&this.children[0].setDebugName(e),this}get debugInfo(){return{name:this._debugName??""}}cloneInto(e){e._debugName=this._debugName,e._isMutable=this._isMutable,e.isImplicit=this.isImplicit,e.uid=this.uid}}function s(e){return"object"==typeof e?e.clone():e}n.NodeCount=0;class o extends n{constructor(){super(...arguments),this.shaderType="primitive-node"}}class a extends n{constructor(e){super(),this.child=e,this.shaderType="scope-node"}get children(){return[this.child]}clone(){const e=new a(s(this.child));return this.cloneInto(e),e}}class l extends n{constructor(e,t,r){super(),this.property=e,this.target=t,this.returnType=r,this.shaderType="property-access-node"}get children(){const e=[this.target];return"string"!=typeof this.property&&e.push(this.property),e}clone(){const e=new l(this.property,s(this.target),this.returnType);return this.cloneInto(e),e}}class c extends n{constructor(e,t,r){super(),this.condition=e,this.ifTrue=t,this.ifFalse=r,this.shaderType="condition-node"}get children(){return[this.condition,this.ifTrue,this.ifFalse]}clone(){const e=s(this.ifTrue),t=this.ifFalse?s(this.ifFalse):null,r=new c(this.condition,e,t);return this.cloneInto(r),r}}class u extends n{constructor(e,t,r,i){super(),this.captureList=e,this.returnType=t,this.generator=i,this.shaderType="block-node",r&&(this.subgraph=new a(r))}get children(){return Object.keys(this.captureList).map((e=>this.captureList[e])).concat(this.subgraph??[])}clone(){const e={};for(const t in this.captureList)e[t]=s(this.captureList[t]);const t=new u(e,this.returnType,this.subgraph?s(this.subgraph.child):this.subgraph,this.generator);return this.cloneInto(t),t}}class h extends n{constructor(e,t,r,i,n,s=!1){super(),this.token=e,this._children=t,this.isInfix=r,this.isPropertyAccess=i,this.returnType=n,this.isTernary=s,this.shaderType="function-node"}get children(){return this._children}clone(){const e=new h(this.token,this._children.map(s),this.isInfix,this.isPropertyAccess,this.returnType,this.isTernary);return this.cloneInto(e),e}}},70931:function(e,t,r){r.d(t,{$5:function(){return me},$I:function(){return q},AU:function(){return De},Ai:function(){return D},Bw:function(){return Re},F8:function(){return Ge},Gb:function(){return ue},Io:function(){return Ae},LC:function(){return fe},LI:function(){return Ue},MM:function(){return _e},My:function(){return v},Ny:function(){return B},Om:function(){return Ee},PM:function(){return qe},RI:function(){return Pe},RZ:function(){return Ve},S8:function(){return Oe},Sj:function(){return he},T9:function(){return Fe},TF:function(){return Be},Tk:function(){return ne},U:function(){return V},US:function(){return Ze},Uo:function(){return xe},Wh:function(){return H},Xe:function(){return pe},ZY:function(){return I},Zb:function(){return A},Zc:function(){return W},aX:function(){return ge},eB:function(){return M},eR:function(){return Y},fV:function(){return j},gn:function(){return Me},j1:function(){return se},jc:function(){return Ce},jh:function(){return ke},jk:function(){return Le},ln:function(){return $},lw:function(){return oe},mk:function(){return Te},n7:function(){return ze},nf:function(){return de},nt:function(){return T},om:function(){return ie},or:function(){return ye},qE:function(){return Ie},rY:function(){return Se},tn:function(){return be},w0:function(){return X},x:function(){return F},z7:function(){return S},ze:function(){return re},zi:function(){return Ne}});var i,n,s,o,a,l,c,u,h,d,f,p,m,_,g=r(53804),y=r(44784);function x(e){return new Proxy(e,{get(t,r){if("constructor"===r)return new Proxy(t.constructor,{construct:(e,t,r)=>x(new e(...t))});if(r in t)return t[r];if("string"==typeof r){const t=function(e){const t=[["float","vec2","vec3","vec4"],["int","ivec2","ivec3","ivec4"],["uint","uvec2","uvec3","uvec4"],["bool","bvec2","bvec3","bvec4"]];for(const r of t)if(r.includes(e))return r.map((e=>Z[e]));throw new Error("Unable to find type family")}(e.type);return Q(e,r,t[r.length-1])}}})}function b(e){return new Proxy(e,{construct:(e,t,r)=>x(new e(...t))})}class w extends Error{}let v=i=class extends y.vL{constructor(e,t){super(),this.elementType=e,this.size=t,this.children=[],this.type="array"}clone(){const e=new i(this.elementType,this.size);return super.cloneInto(e),e}get(e){if("number"==typeof e){const t=new D(e);return t.isImplicit=!0,Q(this,t,this.elementType.constructor)}return Q(this,e,this.elementType.constructor)}last(){return this.get(this.size-1)}first(){return this.get(0)}findIndex(e,t,r){return function(e,t,r=0,i=e.size){const n=new D(r).setMutable().setDebugName("FindIndexIterator"),s=t(e.get(n)).setDebugName("FindIndexPredicate"),o=ie({iter:n},D,s,(({out:e,iter:t,subgraph:r})=>`\n${e} = -1;\n\nfor (; ${t} < ${i}; ${t}++) {\n\n${r.body}\n\n  if (${r.varName}) {\n    ${e} = ${t};\n    break;\n  }\n\n}\n`)).setDebugName("FindIndexBlock");return o}(this,e,t,r)}glslFindIndex(e,t,r){return function(e,t,r=0,i=e.size){const n=ie({array:e},D,null,(({out:e,array:n})=>`\n${e} = -1;\nfor (int i = ${r}; i < ${i}; i++) {\n  bool condition;\n  ${t({array:n,i:"i",out:"condition"})}\n  if (condition) {\n    ${e} = i;\n    break;\n  }\n}\n`)).setDebugName("GlslFindIndexBlock");return n}(this,e,t,r)}static ofType(e,t){const r={construct:(r,n)=>new i(new e,t)};return new Proxy(i,r)}};v.type="array",v=i=(0,g._)([function(e){return new Proxy(e,{construct:(e,t,r)=>function(e){return new Proxy(e,{get(t,r){if(r in t)return t[r];if("string"==typeof r){const t=parseInt(r,10);if(!isNaN(t))return Q(e,`[${t}]`,e.elementType.constructor)}}})}(new e(...t))})}],v);class S extends y.vL{constructor(){super(...arguments),this.type="sampler2D",this.children=[]}clone(){const e=new S;return e.children=this.children.map(y.vA),super.cloneInto(e),e}}S.type="sampler2D";class T extends y.vL{constructor(e){super(),this.type="float",this.children=[e]}clone(){const e=new T((0,y.vA)(this.children[0]));return super.cloneInto(e),e}multiply(e){return oe(this,"number"==typeof e?N(e,T):e)}divide(e){return ae(this,"number"==typeof e?N(e,T):e)}add(e){return le(this,"number"==typeof e?N(e,T):e)}subtract(e){return ce(this,"number"==typeof e?N(e,T):e)}}T.type="float";let I=n=class extends y.vL{constructor(e,t){super(),this.type="vec2",this.children=[e,t].filter((e=>null!=e))}clone(){const e=new n((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]));return super.cloneInto(e),e}get 0(){return Q(this,"[0]",T)}get 1(){return Q(this,"[1]",T)}get 2(){throw new w}get 3(){throw new w}multiply(e){return oe(this,"number"==typeof e?N(e,T):e)}divide(e){return ae(this,"number"==typeof e?N(e,T):e)}add(e){return le(this,"number"==typeof e?N(e,T):e)}subtract(e){return ce(this,"number"==typeof e?N(e,T):e)}};I.type="vec2",I=n=(0,g._)([b],I);let M=s=class extends y.vL{constructor(e,t,r){super(),this.type="vec3",this.children=[e,t,r].filter((e=>null!=e))}get 0(){return Q(this,"[0]",T)}get 1(){return Q(this,"[1]",T)}get 2(){return Q(this,"[2]",T)}get 3(){throw new w}clone(){const e=new s((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]));return super.cloneInto(e),e}multiply(e){return oe(this,"number"==typeof e?N(e,T):e)}divide(e){return ae(this,"number"==typeof e?N(e,T):e)}add(e){return le(this,"number"==typeof e?N(e,T):e)}subtract(e){return ce(this,"number"==typeof e?N(e,T):e)}};M.type="vec3",M=s=(0,g._)([b],M);let A=o=class extends y.vL{constructor(e,t,r,i){super(),this.type="vec4",this.children=[e,t,r,i].filter((e=>null!=e))}clone(){const e=new o((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]),(0,y.vA)(this.children[3]));return super.cloneInto(e),e}get 0(){return Q(this,"[0]",T)}get 1(){return Q(this,"[1]",T)}get 2(){return Q(this,"[2]",T)}get 3(){return Q(this,"[3]",T)}multiply(e){return oe(this,"number"==typeof e?N(e,T):e)}divide(e){return ae(this,"number"==typeof e?N(e,T):e)}add(e){return le(this,"number"==typeof e?N(e,T):e)}subtract(e){return ce(this,"number"==typeof e?N(e,T):e)}};A.type="vec4",A=o=(0,g._)([b],A);let E=a=class extends y.vL{constructor(e){super(),this.type="uint",this.children=[e]}clone(){const e=new a((0,y.vA)(this.children[0]));return super.cloneInto(e),e}};E.type="uint",E=a=(0,g._)([b],E);let P=l=class extends y.vL{constructor(e,t){super(),this.type="uvec2",this.children=[e,t].filter((e=>null!=e))}clone(){const e=new l((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]));return super.cloneInto(e),e}};P.type="uvec2",P=l=(0,g._)([b],P);let C=c=class extends y.vL{constructor(e,t,r){super(),this.type="uvec3",this.children=[e,t,r].filter((e=>null!=e))}clone(){const e=new c((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]));return super.cloneInto(e),e}};C.type="uvec3",C=c=(0,g._)([b],C);let R=u=class extends y.vL{constructor(e,t,r,i){super(),this.type="uvec4",this.children=[e,t,r,i].filter((e=>null!=e))}clone(){const e=new u((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]),(0,y.vA)(this.children[3]));return super.cloneInto(e),e}};R.type="uvec4",R=u=(0,g._)([b],R);class F extends y.vL{constructor(e){super(),this.type="bool",this.children=[e]}and(e){return xe(this,e)}or(e){return ye(this,e)}clone(){const e=new F((0,y.vA)(this.children[0]));return super.cloneInto(e),e}}F.type="bool";let L=h=class extends y.vL{constructor(e,t){super(),this.type="bvec2",this.children=[e,t].filter((e=>null!=e))}all(){return we(this)}any(){return ve(this)}clone(){const e=new h((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]));return super.cloneInto(e),e}};L.type="bvec2",L=h=(0,g._)([b],L);let k=d=class extends y.vL{constructor(e,t,r){super(),this.type="bvec3",this.children=[e,t,r].filter((e=>null!=e))}all(){return we(this)}any(){return ve(this)}clone(){const e=new d((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]));return super.cloneInto(e),e}};function N(e,t){return"number"==typeof e?new t(e):e}k.type="bvec3",k=d=(0,g._)([b],k);let O=f=class extends y.vL{constructor(e,t,r,i){super(),this.type="bvec4",this.children=[e,t,r,i].filter((e=>null!=e))}all(){return we(this)}any(){return ve(this)}clone(){const e=new f((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]),(0,y.vA)(this.children[3]));return super.cloneInto(e),e}};O.type="bvec4",O=f=(0,g._)([b],O);class D extends y.vL{constructor(e){super(),this.type="int",this.children=[e]}multiply(e){return oe(this,N(e,D))}add(e){return le(this,N(e,D))}subtract(e){return ce(this,N(e,D))}divide(e){return ae(this,N(e,D))}clone(){const e=new D((0,y.vA)(this.children[0]));return super.cloneInto(e),e}}D.type="int";let z=p=class extends y.vL{constructor(e,t){super(),this.type="ivec2",this.children=[e,t].filter((e=>null!=e))}clone(){const e=new p((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]));return super.cloneInto(e),e}};z.type="ivec2",z=p=(0,g._)([b],z);let U=m=class extends y.vL{constructor(e,t,r){super(),this.type="ivec3",this.children=[e,t,r].filter((e=>null!=e))}clone(){const e=new m((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]));return super.cloneInto(e),e}};U.type="ivec3",U=m=(0,g._)([b],U);let G=_=class extends y.vL{constructor(e,t,r,i){super(),this.type="ivec4",this.children=[e,t,r,i].filter((e=>null!=e))}clone(){const e=new _((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]),(0,y.vA)(this.children[3]));return super.cloneInto(e),e}};G.type="ivec4",G=_=(0,g._)([b],G);class B extends y.vL{constructor(e,t,r,i){super(),this.type="mat2",this.children=[e,t,r,i]}clone(){const e=new B((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]),(0,y.vA)(this.children[3]));return super.cloneInto(e),e}multiply(e){return oe(this,e)}}B.type="mat2";class V extends y.vL{static identity(){return new V(1,0,0,0,1,0,0,0,1)}static fromRotation(e){const t=Ge(e),r=Me(e);return new V(r,t,0,re(t),r,0,0,0,1)}constructor(e,t,r,i,n,s,o,a,l){super(),this.type="mat3",this.children=[e,t,r,i,n,s,o,a,l]}add(e){return le(this,e)}multiply(e){return oe(this,e)}clone(){const e=new V((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]),(0,y.vA)(this.children[3]),(0,y.vA)(this.children[4]),(0,y.vA)(this.children[5]),(0,y.vA)(this.children[6]),(0,y.vA)(this.children[7]),(0,y.vA)(this.children[8]));return super.cloneInto(e),e}}V.type="mat3";class q extends y.vL{static identity(){return new q(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}constructor(e,t,r,i,n,s,o,a,l,c,u,h,d,f,p,m){super(),this.type="mat4",this.children=[e,t,r,i,n,s,o,a,l,c,u,h,d,f,p,m]}static fromColumns(e,t,r,i){return new q(e.x,e.y,e.z,e.w,t.x,t.y,t.z,t.w,r.x,r.y,r.z,r.w,i.x,i.y,i.z,i.w)}multiply(e){return oe(this,e)}clone(){const e=new q((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]),(0,y.vA)(this.children[3]),(0,y.vA)(this.children[4]),(0,y.vA)(this.children[5]),(0,y.vA)(this.children[6]),(0,y.vA)(this.children[7]),(0,y.vA)(this.children[8]),(0,y.vA)(this.children[9]),(0,y.vA)(this.children[10]),(0,y.vA)(this.children[11]),(0,y.vA)(this.children[12]),(0,y.vA)(this.children[13]),(0,y.vA)(this.children[14]),(0,y.vA)(this.children[15]));return super.cloneInto(e),e}}q.type="mat4";const Z={float:T,vec2:I,vec3:M,vec4:A,int:D,ivec2:z,ivec3:U,ivec4:G,uint:E,uvec2:P,uvec3:C,uvec4:R,bool:F,bvec2:L,bvec3:k,bvec4:O},H=(...e)=>new D(...e),j=(...e)=>new T(...e),W=(...e)=>new I(...e),Y=(...e)=>new M(...e),$=(...e)=>new A(...e),X=(...e)=>new V(...e);function Q(e,t,r){const i=new r(new y.zg(t,e,r));return i.isImplicit=!0,i}function J(e,t,r,i=null){if(i){const n=new i,s=new i(new y.aw(e,[t,r],!0,!1,n));return s.isImplicit=!0,s}if("float"===t.type||"int"===t.type){const i=new r.constructor(new y.aw(e,[t,r],!0,!1,r.constructor));return i.isImplicit=!0,i}if(("mat2"===t.type||"mat3"===t.type||"mat4"===t.type)&&"float"!==r.type){const i=new r.constructor(new y.aw(e,[t,r],!0,!1,r.constructor));return i.isImplicit=!0,i}const n=new t.constructor(new y.aw(e,[t,r],!0,!1,t.constructor));return n.isImplicit=!0,n}function K(e,t,r=t.constructor){const i=new r(new y.aw(e,[t],!1,!1,r));return i.isImplicit=!0,i}function ee(e,t,r,i=t.constructor){const n=new i(new y.aw(e,[t,r],!1,!1,i));return n.isImplicit=!0,n}function te(e,t,r,i,n=t.constructor){const s=new n(new y.aw(e,[t,r,i],!1,!1,n));return s.isImplicit=!0,s}function re(e){return oe(e,j(-1))}function ie(e,t,r,i){return new t(new y.rR(e,t,r,i))}function ne(e,t,r){const i="function"==typeof t?t():t,n="function"==typeof r?r():r,s=new i.constructor(new y.XL(e,i,n));return s.isImplicit=!0,s}function se(...e){const t=e.map((([e,t])=>"function"==typeof t?[e,t()]:[e,t])),r=t[0][1].constructor,i=t.findIndex((e=>!0===e[0]));if(-1===i)throw new Error("A cond must have a fallthrough case with `true`/; ");const n=t.slice(0,i),s=t[i][1],o=new r(n.reduceRight(((e,t)=>ne(t[0],t[1],e)),s));return o.isImplicit=!0,o}function oe(e,t){return J("*",e,t)}function ae(e,t){return J("/",e,t)}function le(e,t){return J("+",e,t)}function ce(e,t){return J("-",e,t)}function ue(e,t){return J("%",e,t)}function he(e,t){return J(">>",e,t)}function de(e,t){return J("&",e,t)}function fe(e,t){return J("==",e,t,F)}function pe(e,t){return J("<",e,t,F)}function me(e,t){return J("<=",e,t,F)}function _e(e,t){return J(">",e,t,F)}function ge(e,t){return J(">=",e,t,F)}function ye(...e){return e.length<=1?e[0]:e.slice(1).reduce(((e,t)=>function(e,t){return J("||",e,t,F)}(e,t)),e[0])}function xe(...e){return e.length<=1?e[0]:e.slice(1).reduce(((e,t)=>function(e,t){return J("&&",e,t,F)}(e,t)),e[0])}function be(e){return K("abs",e)}function we(e){return K("all",e,F)}function ve(e){return K("any",e,F)}function Se(e,t){return null==t?K("atan",e):ee("atan",e,t,e.constructor)}function Te(e){return K("ceil",e)}function Ie(e,t,r){return te("clamp",e,t,r,e.constructor)}function Me(e){return K("cos",e)}function Ae(e,t){return ee("distance",e,t,T)}function Ee(e,t){return ee("dot",e,t,T)}function Pe(e){return K("floor",e)}function Ce(e){return K("fract",e)}function Re(e){return K("length",e,T)}function Fe(e,t){return ee("max",e,t)}function Le(e,t){return ee("min",e,t)}function ke(e,t,r){return te("mix",e,t,r)}function Ne(e,t){return ee("mod",e,t)}function Oe(e){return K("normalize",e)}function De(e){return"bool"===e.type?K("!",e):K("not",e)}function ze(e,t){return ee("pow",e,t)}function Ue(e){return K("round",e)}function Ge(e){return K("sin",e)}function Be(e,t,r){return te("smoothstep",e,t,r)}function Ve(e){return K("sqrt",e)}function qe(e,t){return ee("step",e,t,t.constructor)}function Ze(e,t){return ee("texture",e,t,A)}},81728:function(e,t,r){var i;r.d(t,{N:function(){return i}}),function(e){e[e.AnimatedMarker=0]="AnimatedMarker",e[e.Blend=1]="Blend",e[e.ComplexFill=2]="ComplexFill",e[e.ComplexOutlineFill=3]="ComplexOutlineFill",e[e.DotDensity=4]="DotDensity",e[e.Fill=5]="Fill",e[e.Grid=6]="Grid",e[e.Heatmap=7]="Heatmap",e[e.Label=8]="Label",e[e.Line=9]="Line",e[e.Magnifier=10]="Magnifier",e[e.Marker=11]="Marker",e[e.OutlineFill=12]="OutlineFill",e[e.Overlay=13]="Overlay",e[e.PatternFill=14]="PatternFill",e[e.PatternOutlineFill=15]="PatternOutlineFill",e[e.PieChart=16]="PieChart",e[e.Test=17]="Test",e[e.Text=18]="Text",e[e.TexturedLine=19]="TexturedLine"}(i||(i={}))},56791:function(e,t,r){r.d(t,{k:function(){return o}});var i=r(31654),n=r(85456);const s={createComputedParams:e=>e,optionalAttributes:{},attributes:{id:{type:n.pe.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:n.pe.UNSIGNED_BYTE,count:1},pos:{type:n.pe.SHORT,count:2,pack:"position",packPrecisionFactor:10},inverseArea:{type:n.pe.FLOAT,count:1,packTessellation:({inverseArea:e})=>e}}};class o extends i.N{constructor(){super(...arguments),this.vertexSpec=s}createTesselationParams(e){return{inverseArea:1/e.readGeometryArea()}}}},31654:function(e,t,r){r.d(t,{N:function(){return l}});var i=r(58941),n=r(81484),s=r(69825),o=r(54601);const a=(0,i.A)("featurelayer-fast-triangulation-enabled");class l extends o.r{async loadDependencies(){await Promise.all([super.loadDependencies(),(0,n.F)()])}_write(e,t,r){const i=r?.asOptimized()??t.readGeometryForDisplay(),n=this._clip(i);n&&(e.recordStart(this.instanceId,this.attributeLayout),this._writeGeometry(e,t,n),e.recordEnd())}_clip(e){if(!e)return null;const t=this.hasEffects;return(0,s.FE)(e,t?256:8)}_writeGeometry(e,t,r){const i=r.maxLength>100,n=[],o=this.createTesselationParams(t);if(!i&&a&&(0,s.lO)(n,r))return void(n.length&&this._writeVertices(e,t,r.coords,o,n));const l=(0,s.XZ)(r);this._writeVertices(e,t,l,o)}_writeVertices(e,t,r,i,n){const s=t.getDisplayId(),o=e.vertexCount(),a=this.hasEffects;let l=0;if(n)for(const t of n){const n=r[2*t],o=r[2*t+1];a&&e.recordBounds(n,o,0,0),this._writeVertex(e,s,n,o,i),l++}else for(let t=0;t<r.length;t+=2){const n=Math.round(r[t]),o=Math.round(r[t+1]);a&&e.recordBounds(n,o,0,0),this._writeVertex(e,s,n,o,i),l++}e.indexEnsureSize(l);for(let t=0;t<l;t++)e.indexWrite(t+o)}}},46869:function(e,t,r){r.d(t,{KE:function(){return d},KI:function(){return u},lB:function(){return h},oI:function(){return c}});var i=r(13520),n=r(7056),s=r(54417),o=r(83919),a=r(40846),l=r(85456);function c(e){const{sprite:t,aspectRatio:r,scaleProportionally:n}=e,s=(0,i.Lz)(e.height),o=s>0?s:t.height;let a=s*r;return a<=0?a=t.width:n&&(a*=t.width/t.height),{width:a,height:o}}function u(e){const{applyRandomOffset:t,sampleAlphaOnly:r}=e;return(0,s.xo)([[a.Fz,t],[a.cn,r]])}const h={createComputedParams:e=>e,optionalAttributes:o.l.optionalAttributes,attributes:{...o.l.attributes,bitset:{count:1,type:l.pe.UNSIGNED_BYTE,pack:u},width:{count:1,type:l.pe.HALF_FLOAT,pack:e=>c(e).width},height:{count:1,type:l.pe.HALF_FLOAT,pack:e=>c(e).height},offset:{count:2,type:l.pe.HALF_FLOAT,pack:({offsetX:e,offsetY:t})=>[(0,i.Lz)(e),-(0,i.Lz)(t)]},scale:{count:2,type:l.pe.UNSIGNED_BYTE,packPrecisionFactor:16,pack:({scaleX:e,scaleY:t})=>[e,t]},angle:{count:1,type:l.pe.UNSIGNED_BYTE,pack:({angle:e})=>(0,n.wV)(e)}}};class d extends o.m{constructor(){super(...arguments),this.vertexSpec=h}}},57413:function(e,t,r){r.d(t,{O:function(){return _}});var i=r(13520),n=r(33134),s=r(46869),o=r(54417),a=r(31859),l=r(47461),c=r(40846),u=r(85456);const h=s.lB,d=a.e4,f={createComputedParams:e=>e,optionalAttributes:h.optionalAttributes,attributes:{...h.attributes,bitset:{type:u.pe.UNSIGNED_BYTE,count:1,pack:e=>(0,s.KI)(e)},aux1:{count:1,type:u.pe.HALF_FLOAT,pack:e=>(0,s.oI)(e).width},aux2:{count:1,type:u.pe.HALF_FLOAT,pack:e=>(0,s.oI)(e).height},aux3:{count:2,type:u.pe.HALF_FLOAT,pack:({offsetX:e,offsetY:t})=>[(0,i.Lz)(e),(0,i.Lz)(t)]},aux4:{count:2,type:u.pe.UNSIGNED_BYTE,pack:({scaleX:e,scaleY:t})=>[e*l.cZ,t*l.cZ]}}},p={createComputedParams:e=>e,optionalAttributes:h.optionalAttributes,attributes:{...h.attributes,color:d.attributes.color,bitset:{type:u.pe.UNSIGNED_BYTE,count:1,pack:e=>(0,o.xo)([[c.Xx,!0]])},aux1:{count:1,type:u.pe.HALF_FLOAT,pack:e=>(0,i.Lz)(.5*e.width)},aux2:{count:1,type:u.pe.HALF_FLOAT,pack:e=>(0,i.Lz)(.5*e.referenceWidth)},aux3:{count:2,type:u.pe.HALF_FLOAT,packTessellation:({extrusionOffsetX:e,extrusionOffsetY:t})=>[e,t]},aux4:{count:2,type:u.pe.UNSIGNED_BYTE,packTessellation:({normalX:e,normalY:t})=>[e*l.cZ+l.v9,t*l.cZ+l.v9]}}};class m extends a.eY{constructor(){super(...arguments),this.vertexSpec=p}}class _ extends a.w0{constructor(){super(...arguments),this.vertexSpec=f}_createOutlineWriter(e,t,r,i){return new m(e,t,r,i)}_write(e,t,r){const i=r?.asOptimized()??t.readGeometryForDisplay(),s=this._clip(i);if(!s)return;const o=this.evaluatedMeshParams.sprite?.textureBinding;e.recordStart(this.instanceId,this.attributeLayout,o),this._writeGeometry(e,t,s),this._lineMeshWriter.writeLineVertices(e,n.z.fromOptimizedCIM(s,"esriGeometryPolyline"),t),e.recordEnd()}ensurePacked(e,t,r){super.ensurePacked(e,t,r),this._lineMeshWriter.ensurePacked(e,t,r)}enqueueRequest(e,t,r){super.enqueueRequest(e,t,r),this._lineMeshWriter.enqueueRequest(e,t,r)}async loadDependencies(){await Promise.all([super.loadDependencies(),this._lineMeshWriter.loadDependencies()])}}},28615:function(e,t,r){r.d(t,{Y:function(){return l},v:function(){return a}});var i=r(39686),n=r(31654),s=r(54417),o=r(85456);const a={createComputedParams:e=>e,optionalAttributes:{zoomRange:{type:o.pe.SHORT,count:2,packPrecisionFactor:i.fq,pack:({scaleInfo:e},{tileInfo:t})=>(0,s.My)(e,t)}},attributes:{id:{type:o.pe.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:o.pe.UNSIGNED_BYTE,count:1},pos:{type:o.pe.SHORT,count:2,pack:"position",packPrecisionFactor:10},color:{type:o.pe.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:e})=>(0,s.Jb)(e)}}};class l extends n.N{constructor(){super(...arguments),this.vertexSpec=a}createTesselationParams(e){return null}}},31859:function(e,t,r){r.d(t,{Lm:function(){return h},e4:function(){return d},eY:function(){return f},w0:function(){return p}});var i=r(33134),n=r(69825),s=r(28615),o=r(54417),a=r(67293),l=r(25731),c=r(40846),u=r(85456);const h={createComputedParams:e=>e,optionalAttributes:a.Eq.optionalAttributes,attributes:{...a.Eq.attributes,bitset:{type:u.pe.UNSIGNED_BYTE,count:1,pack:e=>0},color:{type:u.pe.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:e})=>(0,o.Jb)(e)}}},d={createComputedParams:e=>e,optionalAttributes:a.Eq.optionalAttributes,attributes:{...a.Eq.attributes,bitset:{type:u.pe.UNSIGNED_BYTE,count:1,pack:e=>(0,o.xo)([[c.Xx,!0]])},color:{type:u.pe.UNSIGNED_BYTE,count:4,normalized:!0,pack:({outlineColor:e})=>(0,o.Jb)(e)}}};class f extends a.Bw{constructor(){super(...arguments),this.vertexSpec=d}}class p extends s.Y{constructor(e,t,r,i){super(e,t,r,i),this.vertexSpec=h,this._lineMeshWriter=this._createOutlineWriter(e,t,r,i)}_createOutlineWriter(e,t,r,i){return new f(e,t,r,i)}_write(e,t,r){const n=r?.asOptimized()??t.readGeometryForDisplay(),s=this._clip(n);s&&(e.recordStart(this.instanceId,this.attributeLayout),this._writeGeometry(e,t,s),this._lineMeshWriter.writeLineVertices(e,i.z.fromOptimizedCIM(s,"esriGeometryPolyline"),t),e.recordEnd())}_clip(e){return e?(0,n.FE)(e,(0,l.Z0)(this.evaluatedMeshParams)):null}ensurePacked(e,t,r){super.ensurePacked(e,t,r),this._lineMeshWriter.ensurePacked(e,t,r)}enqueueRequest(e,t,r){super.enqueueRequest(e,t,r),this._lineMeshWriter.enqueueRequest(e,t,r)}async loadDependencies(){await Promise.all([super.loadDependencies(),this._lineMeshWriter.loadDependencies()])}}},83919:function(e,t,r){r.d(t,{l:function(){return o},m:function(){return a}});var i=r(39686),n=r(28615),s=r(85456);const o={createComputedParams:e=>e,optionalAttributes:n.v.optionalAttributes,attributes:{...n.v.attributes,tlbr:{count:4,type:s.pe.UNSIGNED_SHORT,pack:({sprite:e})=>{const{rect:t,width:r,height:n}=e,s=t.x+i.hM,o=t.y+i.hM;return[s,o,s+r,o+n]}},inverseRasterizationScale:{count:1,type:s.pe.BYTE,packPrecisionFactor:16,pack:({sprite:e})=>1/e.rasterizationScale}}};class a extends n.Y{constructor(){super(...arguments),this.vertexSpec=o}_write(e,t,r){const i=r?.asOptimized()??t.readGeometryForDisplay(),n=this._clip(i);if(!n)return;const s=this.evaluatedMeshParams.sprite?.textureBinding;e.recordStart(this.instanceId,this.attributeLayout,s),this._writeGeometry(e,t,n),e.recordEnd()}}},21099:function(e,t,r){r.d(t,{Q:function(){return c}});var i=r(33134),n=r(31859),s=r(83919);const o={optionalAttributes:s.l.optionalAttributes,createComputedParams:e=>e,attributes:{...s.l.attributes,...n.Lm.attributes}},a={optionalAttributes:s.l.optionalAttributes,createComputedParams:e=>e,attributes:{...s.l.attributes,...n.e4.attributes}};class l extends n.eY{constructor(){super(...arguments),this.vertexSpec=a}}class c extends n.w0{constructor(){super(...arguments),this.vertexSpec=o}_createOutlineWriter(e,t,r,i){return new l(e,t,r,i)}_write(e,t,r){const n=r?.asOptimized()??t.readGeometryForDisplay(),s=this._clip(n);if(!s)return;const o=this.evaluatedMeshParams.sprite?.textureBinding;e.recordStart(this.instanceId,this.attributeLayout,o),this._writeGeometry(e,t,s),this._lineMeshWriter.writeLineVertices(e,i.z.fromOptimizedCIM(s,"esriGeometryPolyline"),t),e.recordEnd()}ensurePacked(e,t,r){super.ensurePacked(e,t,r),this._lineMeshWriter.ensurePacked(e,t,r)}enqueueRequest(e,t,r){super.enqueueRequest(e,t,r),this._lineMeshWriter.enqueueRequest(e,t,r)}async loadDependencies(){await Promise.all([super.loadDependencies(),this._lineMeshWriter.loadDependencies()])}}},54417:function(e,t,r){r.d(t,{By:function(){return g},Jb:function(){return f},My:function(){return u},i8:function(){return _},mR:function(){return h},qE:function(){return m},ue:function(){return p},xo:function(){return d}});var i=r(52874),n=r(39819),s=r(40633),o=r(33389);const a=()=>s.A.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.meshWriterUtils"),l=0,c=100;function u(e,t){return[!!e?.minScale&&t.scaleToZoom(e.minScale)||l,!!e?.maxScale&&t.scaleToZoom(e.maxScale)||c]}function h(e){return 1<<e}function d(e){let t=0;for(const[r,i]of e)i&&(t|=1<<r);return t}function f(e){let t;if(!e)return[0,0,0,0];if("string"==typeof e){const r=i.A.fromString(e);if(!r)return a().errorOnce(new n.A("mapview:mesh-processing","Unable to parse string into color",{color:e})),[0,0,0,0];t=r.toArray()}else t=e;const[r,s,o,l]=t;return[r*(l/255),s*(l/255),o*(l/255),l]}function p(e){switch(e){case"butt":case o.uT.Butt:return o.xR.BUTT;case"round":case o.uT.Round:return o.xR.ROUND;case"square":case o.uT.Square:return o.xR.SQUARE}}function m(e){switch(e){case"bevel":case o.wd.Bevel:return o.JO.BEVEL;case"miter":case o.wd.Miter:return o.JO.MITER;case"round":case o.wd.Round:return o.JO.ROUND}}function _(e,t){return Math.round(Math.min(Math.sqrt(e*t),255))}function g(e,t){return Math.round(e*t)/t}},37463:function(e,t,r){r.d(t,{h:function(){return o}});var i=r(54601),n=r(85456);const s={createComputedParams:e=>e,optionalAttributes:{},attributes:{pos:{type:n.pe.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:n.pe.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:n.pe.UNSIGNED_BYTE,count:1},offset:{type:n.pe.BYTE,count:2,packAlternating:{count:4,pack:()=>[[-1,-1],[1,-1],[-1,1],[1,1]]}}}};class o extends i.r{constructor(){super(...arguments),this.vertexSpec=s}_write(e,t){e.recordStart(this.instanceId,this.attributeLayout);const r=t.getDisplayId();if("esriGeometryPoint"===t.geometryType){const i=t.readXForDisplay(),n=t.readYForDisplay();this._writeQuad(e,r,i,n)}else if("esriGeometryMultipoint"===t.geometryType){const i=t.readGeometryForDisplay();i?.forEachVertex(((t,i)=>{t>=0&&t<=512&&i>=0&&i<=512&&this._writeQuad(e,r,t,i)}))}e.recordEnd()}_writeQuad(e,t,r,i){const n=e.vertexCount();this._writeVertex(e,t,r,i),e.indexWrite(n+0),e.indexWrite(n+1),e.indexWrite(n+2),e.indexWrite(n+1),e.indexWrite(n+3),e.indexWrite(n+2)}}},67293:function(e,t,r){r.d(t,{Bw:function(){return m},Eq:function(){return f}});var i=r(13520),n=r(33134),s=r(39686),o=r(42542),a=r(69825),l=r(54417),c=r(54601),u=r(25731),h=r(85456);class d{constructor(){this.extrusionOffsetX=0,this.extrusionOffsetY=0,this.normalX=0,this.normalY=0,this.directionX=0,this.directionY=0,this.distance=0}}const f={createComputedParams:e=>e,optionalAttributes:{zoomRange:{type:h.pe.SHORT,count:2,packPrecisionFactor:s.fq,pack:({scaleInfo:e},{tileInfo:t})=>(0,l.My)(e,t)}},attributes:{id:{type:h.pe.UNSIGNED_BYTE,count:3,pack:"id"},pos:{type:h.pe.SHORT,count:2,pack:"position",packPrecisionFactor:10},bitset:{type:h.pe.UNSIGNED_BYTE,count:1},color:{type:h.pe.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:e})=>(0,l.Jb)(e)},offset:{type:h.pe.BYTE,count:2,packPrecisionFactor:16,packTessellation:({extrusionOffsetX:e,extrusionOffsetY:t})=>[(0,l.By)(e,16),(0,l.By)(t,16)]},normal:{type:h.pe.BYTE,count:2,packPrecisionFactor:16,packTessellation:({normalX:e,normalY:t})=>[(0,l.By)(e,16),(0,l.By)(t,16)]},halfWidth:{type:h.pe.HALF_FLOAT,count:1,pack:({width:e})=>(0,i.Lz)(.5*e)},referenceHalfWidth:{type:h.pe.HALF_FLOAT,count:1,pack:({referenceWidth:e})=>(0,i.Lz)(.5*e)}}};class p{constructor(){this.id=0,this.bitset=0,this.indexCount=0,this.vertexCount=0,this.vertexFrom=0,this.vertexBounds=0}}class m extends c.r{constructor(e,t,r,i){super(e,t,r,i),this.vertexSpec=f,this._currentWrite=new p,this._tessellationOptions={halfWidth:0,pixelCoordRatio:1,offset:0,wrapDistance:65535,textured:!1},this._tessParams=new d,this._initializeTessellator()}writeLineVertices(e,t,r){const i=this._getLines(t);null!=i&&this._writeVertices(e,r,i)}_initializeTessellator(){this._lineTessellator=new o.i(this._writeTesselatedVertex.bind(this),this._writeTriangle.bind(this),!0)}_write(e,t,r){const i=r??n.z.fromFeatureSetReaderCIM(t);i&&this._writeGeometry(e,t,i)}_writeGeometry(e,t,r,i){e.recordStart(this.instanceId,this.attributeLayout,i),this.writeLineVertices(e,r,t),e.recordEnd()}_getLines(e){return(0,a.uS)(e,(0,u.Z0)(this.evaluatedMeshParams))}_writeVertices(e,t,r){const{_currentWrite:n,_tessellationOptions:o,evaluatedMeshParams:a}=this,{width:c,capType:u,joinType:h,miterLimit:d,hasSizeVV:f}=a,p=(0,i.Lz)(.5*c);o.halfWidth=p,o.capType=(0,l.ue)(u),o.joinType=(0,l.qE)(h),o.miterLimit=d;const m=!f;n.out=e,n.id=t.getDisplayId(),n.vertexCount=0,n.indexCount=0,n.vertexFrom=e.vertexCount(),n.vertexBounds=m&&p<s.Gh?0:1;for(const{line:e,start:t}of r)o.initialDistance=t%65535,this._lineTessellator.tessellate(e,o,m)}_writeTesselatedVertex(e,t,r,i,n,s,o,a,l,c,u){const{out:h,id:d,vertexBounds:f}=this._currentWrite;return this.hasEffects&&h.recordBounds(e,t,f,f),this._tessParams.extrusionOffsetX=o,this._tessParams.extrusionOffsetY=a,this._tessParams.normalX=l,this._tessParams.normalY=c,this._tessParams.directionX=n,this._tessParams.directionY=s,this._tessParams.distance=u,this._writeVertex(h,d,e,t,this._tessParams),this._currentWrite.vertexFrom+this._currentWrite.vertexCount++}_writeTriangle(e,t,r){const{out:i}=this._currentWrite;i.indexEnsureSize(3),i.indexWrite(e),i.indexWrite(t),i.indexWrite(r),this._currentWrite.indexCount+=3}}},63124:function(e,t,r){r.d(t,{K:function(){return d}});var i=r(13520),n=r(33134),s=r(33389),o=r(39686),a=r(54417),l=r(67293),c=r(40846),u=r(85456);const h={createComputedParams:e=>e,optionalAttributes:l.Eq.optionalAttributes,attributes:{...l.Eq.attributes,bitset:{type:u.pe.UNSIGNED_BYTE,count:1,pack:({shouldSampleAlphaOnly:e,shouldScaleDash:t,isSDF:r})=>(0,a.xo)([[c.cn,e],[c.kx,t],[c.b5,r]])},tlbr:{type:u.pe.UNSIGNED_SHORT,count:4,pack:({sprite:e})=>{const{rect:t,width:r,height:i}=e,n=t.x+o.hM,s=t.y+o.hM;return[n,s,n+r,s+i]}},accumulatedDistance:{type:u.pe.UNSIGNED_SHORT,count:1,packTessellation:({distance:e})=>e},segmentDirection:{type:u.pe.BYTE,count:2,packPrecisionFactor:16,packTessellation:({directionX:e,directionY:t})=>[e,t]},offsetAlongLine:{type:u.pe.HALF_FLOAT,count:1,pack:({offsetAlongLine:e})=>(0,i.Lz)(e)},capType:{type:u.pe.UNSIGNED_BYTE,count:1,pack:({capType:e})=>{switch(e){case s.uT.Butt:case"butt":return 0;case s.uT.Square:case"square":return 1;case s.uT.Round:case"round":return 2;default:return 0}}}}};class d extends l.Bw{constructor(e,t,r,i){super(e,t,r,i),this.vertexSpec=h,this._tessellationOptions.textured=!0}_write(e,t,r){const i=r??n.z.fromFeatureSetReaderCIM(t);if(!i)return;const{sprite:s}=this.evaluatedMeshParams;this._writeGeometry(e,t,i,s?.textureBinding)}}},82806:function(e,t,r){r.d(t,{H:function(){return w}});var i=r(13520),n=r(67348),s=r(10793),o=r(13786),a=r(33134),l=r(2014),c=r(33389),u=r(84646),h=r(39686),d=r(54417),f=r(7590);class p{static from(e){return"width"in e?this.fromSimpleMeshParams(e):this.fromComplexMeshParams(e)}static fromSimpleMeshParams(e){const t=new p(e.sprite,e.color,e.outlineColor,e.minPixelBuffer,e.placement,e.scaleInfo,e.effects),{type:r,width:n,height:s,angle:o,alignment:a,outlineSize:l,referenceSize:c,sprite:u,overrideOutlineColor:h}=e;return t.rawWidth=(0,i.Lz)(n),t.rawHeight=(0,i.Lz)(s),t.angle=o,t.alignment=a,t.outlineSize=(0,i.Lz)(l),t.referenceSize=(0,i.Lz)(c),t.overrideOutlineColor=h,t.offsetX=(0,i.Lz)(e.offsetX),t.offsetY=(0,i.Lz)(e.offsetY),"simple"!==r||u.sdf||(t.rawWidth=u.width,t.rawHeight=u.height),t._computeSize(e,!1),t}static fromComplexMeshParams(e){const t=new p(e.sprite,e.color,e.outlineColor,e.minPixelBuffer,e.placement,e.scaleInfo,e.effects);let{alignment:r,transforms:n,size:s,scaleX:o,anchorX:a,anchorY:l,angle:c,colorLocked:u,frameHeight:h,widthRatio:d,offsetX:m,offsetY:_,outlineSize:g,referenceSize:y,scaleFactor:x,sizeRatio:b,isAbsoluteAnchorPoint:w,rotateClockwise:v,scaleSymbolsProportionally:S,sprite:T}=e;if(n&&n.infos.length>0){const e=(0,f.zb)(s,c,v,m,_,n);s=e.size,c=e.rotation,m=e.offsetX,_=e.offsetY,v=!1}x&&(s*=x,m*=x,_*=x);const I=o*(T.width/T.height);t.alignment=r,t.rawHeight=(0,i.Lz)(s),t.rawWidth=t.rawHeight*I,t.referenceSize=(0,i.Lz)(y),t.sizeRatio=b,t.sdfDecodeCoeff=(T.sdfDecodeCoeff??1)*b,t.angle=c,t.rotateClockwise=v,t.anchorX=a,t.anchorY=l,t.offsetX=(0,i.Lz)(m),t.offsetY=(0,i.Lz)(_),w&&s&&(T.sdf?t.anchorX=a/(s*d):t.anchorX=a/(s*I),t.anchorY=l/s);const M=S&&h?s/h:1;return t.outlineSize=0===g||isNaN(g)?0:(0,i.Lz)(g)*M,t.scaleSymbolsProportionally=S,t.colorLocked=u,t._computeSize(e,!0),t}constructor(e,t,r,i,n,s,o){this.sprite=e,this.color=t,this.outlineColor=r,this.minPixelBuffer=i,this.placement=n,this.scaleInfo=s,this.effects=o,this.rawWidth=0,this.rawHeight=0,this.angle=0,this.outlineSize=0,this.referenceSize=0,this.sizeRatio=1,this.sdfDecodeCoeff=1,this.alignment=c.C1.SCREEN,this.scaleSymbolsProportionally=!1,this.overrideOutlineColor=!1,this.colorLocked=!1,this.anchorX=0,this.anchorY=0,this.computedWidth=0,this.computedHeight=0,this.texXmin=0,this.texYmin=0,this.texXmax=0,this.texYmax=0,this.offsetX=0,this.offsetY=0,this.rotateClockwise=!0}get boundsInfo(){return{size:Math.max(this.computedHeight,this.computedWidth),offsetX:this.offsetX,offsetY:this.offsetY}}_computeSize(e,t){const{sprite:r,hasSizeVV:i}=e,n=!!r.sdf,s=r.sdfPaddingRatio??.5,{rawWidth:o,rawHeight:a,sizeRatio:l,outlineSize:c}=this,u=l*(n?1/(1-s):1),d=o*u,f=a*u;if(n&&!i){const e=t&&o>a?d:o,r=a,i=c+2;this.computedWidth=Math.min(e+i,d),this.computedHeight=Math.min(r+i,f)}else this.computedWidth=d,this.computedHeight=f;const p=n?Math.max(r.width,r.height)/Math.max(d,f):1,m=.5*(d-this.computedWidth)*p,_=.5*(f-this.computedHeight)*p,g=r.rect.x+h.hM+m,y=r.rect.y+h.hM+_,x=g+r.width-2*m,b=y+r.height-2*_;this.texXmin=Math.floor(g),this.texYmin=Math.floor(y),this.texXmax=Math.ceil(x),this.texYmax=Math.ceil(b),this.computedWidth*=(this.texXmax-this.texXmin)/(x-g),this.computedHeight*=(this.texYmax-this.texYmin)/(b-y),this.anchorX*=d/this.computedWidth,this.anchorY*=f/this.computedHeight}}var m=r(97473),_=r(68758),g=r(54601),y=r(85456);const x=128/Math.PI;const b={createComputedParams:e=>p.from(e),optionalAttributes:{zoomRange:{type:y.pe.SHORT,count:2,packPrecisionFactor:h.fq,pack:({scaleInfo:e},{tileInfo:t})=>(0,d.My)(e,t)}},attributes:{pos:{type:y.pe.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:y.pe.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:y.pe.UNSIGNED_BYTE,count:1,pack:({sprite:e,alignment:t,scaleSymbolsProportionally:r,overrideOutlineColor:i,colorLocked:n})=>{let s=0;return e.sdf&&(s|=(0,d.mR)(m.c.bitset.isSDF)),t===c.C1.MAP&&(s|=(0,d.mR)(m.c.bitset.isMapAligned)),r&&(s|=(0,d.mR)(m.c.bitset.scaleSymbolsProportionally)),i&&(s|=(0,d.mR)(m.c.bitset.overrideOutlineColor)),n&&(s|=(0,d.mR)(m.c.bitset.colorLocked)),s}},offset:{type:y.pe.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:({angle:e,computedWidth:t,computedHeight:r,anchorX:i,anchorY:a,offsetX:l,offsetY:c,rotateClockwise:u})=>{const h=function(e,t,r,i,o=!1){const a=(0,s.vt)(),l=o?1:-1;return(0,n.D_)(a),(t||r)&&(0,n.Tl)(a,a,[t,-r]),i&&(0,n.e$)(a,a,.017453292519944444*l*-i),a}(0,l,c,-e,u),d=-(.5+i)*t,f=-(.5-a)*r,p=[d,f],m=[d+t,f],_=[d,f+r],g=[d+t,f+r];return(0,o.l0)(p,p,h),(0,o.l0)(m,m,h),(0,o.l0)(_,_,h),(0,o.l0)(g,g,h),[p,m,_,g]}}},textureUV:{type:y.pe.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:({texXmax:e,texXmin:t,texYmax:r,texYmin:i})=>[[t,i],[e,i],[t,r],[e,r]]}},color:{type:y.pe.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:e})=>(0,d.Jb)(e)},outlineColor:{type:y.pe.UNSIGNED_BYTE,count:4,normalized:!0,pack:({outlineColor:e})=>(0,d.Jb)(e)},sizing:{type:y.pe.UNSIGNED_BYTE,count:4,pack:({rawWidth:e,rawHeight:t,outlineSize:r,referenceSize:i})=>{const n=Math.max(e,t);return[(0,d.i8)(n,128),(0,d.i8)(r,128),(0,d.i8)(i,128),0]}},placementAngle:{type:y.pe.UNSIGNED_BYTE,count:1,packTessellation:({placementAngle:e})=>function(e){return function(e){return e%=256,Math.abs(e>=0?e:e+256)}(e*x)}(e)},sdfDecodeCoeff:{type:y.pe.UNSIGNED_SHORT,count:1,packPrecisionFactor:64,pack:({sdfDecodeCoeff:e})=>e}}};class w extends g.r{constructor(){super(...arguments),this.vertexSpec=b}getBoundsInfo(){return this.evaluatedMeshParams.boundsInfo}_write(e,t,r){const i=this.evaluatedMeshParams.sprite?.textureBinding,n=t.getDisplayId();e.recordStart(this.instanceId,this.attributeLayout,i);const s=this.evaluatedMeshParams.minPixelBuffer,o=Math.max(this.evaluatedMeshParams.computedWidth,s),a=Math.max(this.evaluatedMeshParams.computedHeight,s),c=-this.evaluatedMeshParams.anchorX*this.evaluatedMeshParams.computedWidth,u=this.evaluatedMeshParams.anchorY*this.evaluatedMeshParams.computedHeight,h=this.evaluatedMeshParams.offsetX+c,d=-this.evaluatedMeshParams.offsetY+u;if(null!=this.evaluatedMeshParams.placement)this._writePlacedMarkers(e,t,r,o,a);else if(r?.nextPath()){r.nextPoint();const t=r.x,i=r.y;e.recordBounds(t+h,i+d,o,a),this._writeQuad(e,n,t,i)}else if("esriGeometryPolygon"===t.geometryType){const r=t.readCentroidForDisplay();if(!r)return;const[i,s]=r.coords;e.recordBounds(i+h,s+d,o,a),this._writeQuad(e,n,i,s)}else if("esriGeometryPoint"===t.geometryType){const r=t.readXForDisplay(),i=t.readYForDisplay();e.recordBounds(r+h,i+d,o,a),this._writeQuad(e,n,r,i)}else{const r=t.readGeometryForDisplay();r?.forEachVertex(((t,r)=>{e.recordBounds(t+h,r+d,o,a),Math.abs(t)>l.$u||Math.abs(r)>l.$u||this._writeQuad(e,n,t,r)}))}e.recordEnd()}_writePlacedMarkers(e,t,r,n,s){const o=r??a.z.fromFeatureSetReaderCIM(t)?.clone();if(!o)return;const c=u.l.getPlacement(o,-1,this.evaluatedMeshParams.placement,(0,i.Lz)(1),e.id,(0,_.z)());if(!c)return;const h=t.getDisplayId();let d=c.next();const f=this.evaluatedMeshParams.offsetX,p=-this.evaluatedMeshParams.offsetY;for(;null!=d;){const t=d.tx,r=-d.ty;if(Math.abs(t)>l.$u||Math.abs(r)>l.$u){d=c.next();continue}const i=-d.getAngle();e.recordBounds(t+f,r+p,n,s),this._writeQuad(e,h,t,r,i),d=c.next()}}_writeQuad(e,t,r,i,n){const s=e.vertexCount(),o=null==n?null:{placementAngle:n};this._writeVertex(e,t,r,i,o),e.indexWrite(s+0),e.indexWrite(s+1),e.indexWrite(s+2),e.indexWrite(s+1),e.indexWrite(s+3),e.indexWrite(s+2)}}},97473:function(e,t,r){r.d(t,{c:function(){return i}});const i={bitset:{isSDF:0,isMapAligned:1,scaleSymbolsProportionally:2,overrideOutlineColor:3,colorLocked:4,isStroke:5}}},54601:function(e,t,r){r.d(t,{r:function(){return f}});var i=r(33134),n=r(47072),s=r(68758),o=r(85475),a=(r(58941),r(25731)),l=r(85456);function c(e){switch(e){case l.pe.BYTE:case l.pe.UNSIGNED_BYTE:return 1;case l.pe.SHORT:case l.pe.UNSIGNED_SHORT:case l.pe.HALF_FLOAT:return 2;case l.pe.FLOAT:case l.pe.INT:case l.pe.UNSIGNED_INT:return 4}}class u{static fromVertexSpec(e,t){const{attributes:r,optionalAttributes:i}=e;let n,s,o;const a=[];for(const e in r){const t=r[e];"position"===t.pack?n={...t,name:e,offset:0}:"id"===t.pack?s={...t,name:e,offset:4}:"bitset"===e?o={...t,name:e,offset:7}:a.push({...t,name:e})}for(const e in i)if(!0===t[e]){const t=i[e];a.push({...t,name:e})}const l=function(e){const t=[],r=[],i=[];for(const n of e){const e=c(n.type)*n.count;switch(e%2||e%4||4){case 4:t.push(n);continue;case 2:r.push(n);continue;case 1:i.push(n);continue;default:throw new Error("Found unexpected dataType byte count")}}return t.push(...r),t.push(...i),t}(a),h=[];let d=8,f=1;for(const e of l)h.push({...e,offset:d}),d+=c(e.type)*e.count,e.packAlternating&&(f=Math.max(e.packAlternating.count,f));const p=Uint32Array.BYTES_PER_ELEMENT,m=d%p;return new u(n,s,o,h,d+(m?p-m:0),f)}constructor(e,t,r,i,n,s){this.position=e,this.id=t,this.bitset=r,this.standardAttributes=i,this.stride=n,this.packVertexCount=s,i.push(r),this._attributes=[e,t,r,...i]}get attributeLayout(){if(!this._attributeLayout){const e=(0,a.hU)(this._attributes),t=this._attributes.map((e=>({name:e.name,count:e.count,offset:e.offset,type:e.type,packPrecisionFactor:e.packPrecisionFactor,normalized:e.normalized??!1})));this._attributeLayout={attributes:t,hash:e,stride:this.stride}}return this._attributeLayout}}var h=r(5544);class d{static fromVertexSpec(e,t){const r=u.fromVertexSpec(e,t);return new d(r)}constructor(e){this._spec=e,this._packed=new Uint8Array(this._spec.stride*this._spec.packVertexCount),this._packedU32View=new Uint32Array(this._packed.buffer),this._dataView=new DataView(this._packed.buffer)}get attributeLayout(){return this._spec.attributeLayout}get stride(){return this._spec.stride}writeVertex(e,t,r,i,n,s){for(let e=0;e<this._spec.packVertexCount;e++){const o=e*this._spec.stride;this._packPosition(r,i,o),this._packId(t,o);const a=this._spec.bitset;if(s){if(a.packTessellation){const e=a.packTessellation(s,n);this._pack(e,a,o)}for(const e of this._spec.standardAttributes)if(null!=e.packTessellation){const t=e.packTessellation(s,n);this._pack(t,e,o)}else if(e.packAlternating?.packTessellation){const t=e.packAlternating.packTessellation(s,n);for(let r=0;r<this._spec.packVertexCount;r++){const i=t[r];this._pack(i,e,r*this._spec.stride)}}}}e.vertexWriteRegion(this._packedU32View)}pack(e,t){for(const r of this._spec.standardAttributes)if(r.pack&&"string"!=typeof r.pack){const i=r.pack(e,t);for(let e=0;e<this._spec.packVertexCount;e++)this._pack(i,r,e*this._spec.stride)}else if(r.packAlternating?.pack){const i=r.packAlternating.pack(e,t);for(let e=0;e<this._spec.packVertexCount;e++){const t=i[e];this._pack(t,r,e*this._spec.stride)}}}_packPosition(e,t,r){const{offset:i}=this._spec.position,n=this._spec.position.packPrecisionFactor??1,s=(0,o.M9)(e*n,t*n);this._dataView.setUint32(r+i,s,!0)}_packId(e,t){const r=e*(this._spec.id.packPrecisionFactor??1),i=4278190080&this._dataView.getUint32(t+this._spec.id.offset,!0);this._dataView.setUint32(t+this._spec.id.offset,r|i,!0)}_pack(e,t,r){(0,h.F)(this._dataView,e,t,r)}}class f{constructor(e,t,r,i){this._instanceId=e,this._evaluator=t,this._enabledOptionalAttributes=r,this._viewParams=i,this._evaluator.evaluator=e=>this.vertexSpec.createComputedParams(e)}get _vertexPack(){if(!this._cachedVertexPack){const e=d.fromVertexSpec(this.vertexSpec,this._enabledOptionalAttributes);this._evaluator.hasDynamicProperties||e.pack(this._evaluator.evaluatedMeshParams,this._viewParams),this._cachedVertexPack=e}return this._cachedVertexPack}get evaluatedMeshParams(){return this._evaluator.evaluatedMeshParams}get hasEffects(){return!!this.evaluatedMeshParams.effects}get instanceId(){return this._instanceId}get attributeLayout(){return this._vertexPack.attributeLayout}setReferences(e){this._references=e}getBoundsInfo(){return null}getTileInfo(){return this._viewParams.tileInfo}async loadDependencies(){(function(e){if(!e)return!1;for(const t of e)switch(t.effect.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":case"CIMGeometricEffectDonut":return!0}return!1})(this._evaluator.inputMeshParams.effects?.effectInfos)&&await(0,s.R)()}enqueueRequest(e,t,r){this._evaluator.hasDynamicProperties&&this._evaluator.enqueueRequest(e,t,r)}write(e,t,r,o,a){this.ensurePacked(t,r,o);const l=this.evaluatedMeshParams.effects;if(!l||0===l.length)return void this._write(e,r,void 0,a);const c=r.readGeometryForDisplay()?.clone();if(!c)return;const u=i.z.fromOptimizedCIM(c,r.geometryType),h=(0,s.z)();u.invertY();const d=e.id||"",f=n.V.executeEffects(l,u,d,h);let p;for(;p=f.next();)p.invertY(),this._write(e,r,p,a)}ensurePacked(e,t,r){if(!this._evaluator.hasDynamicProperties)return;const i=this._evaluator.evaluateMeshParams(e,t,r);this._vertexPack.pack(i,this._viewParams)}_writeVertex(e,t,r,i,n){const s=this.evaluatedMeshParams;this._vertexPack.writeVertex(e,t,r,i,s,n)}}},99483:function(e,t,r){r.d(t,{o:function(){return Ie}});var i=r(81728),n=r(13520),s=r(39686),o=r(54417),a=r(97473),l=r(54601);class c extends l.r{}function u(e){const{sprite:t,isMapAligned:r,colorLocked:i,scaleSymbolsProportionally:n,isStroke:s}=e;let l=0;return r&&(l|=(0,o.mR)(a.c.bitset.isMapAligned)),i&&(l|=(0,o.mR)(a.c.bitset.colorLocked)),t.sdf&&(l|=(0,o.mR)(a.c.bitset.isSDF)),n&&(l|=(0,o.mR)(a.c.bitset.scaleSymbolsProportionally)),s&&(l|=(0,o.mR)(a.c.bitset.isStroke)),l}var h=r(40846),d=r(85456);class f extends c{get vertexSpec(){return{createComputedParams:e=>{let{pixelDimensions:t,texelDimensions:r,baseSize:i,referenceSize:s,strokeWidth:o,sizeRatio:a}=e;t||(t=e.sprite.sdf?[0,0]:[e.sprite.width,e.sprite.height]),r||(r=e.sprite.sdf?[0,0]:t),i=(0,n.Lz)(i),s=(0,n.Lz)(s),o=(0,n.Lz)(o);const l=(e.sprite.sdfDecodeCoeff??1)*a;return{...e,pixelDimensions:t,texelDimensions:r,baseSize:i,referenceSize:s,strokeWidth:o,sdfDecodeCoeff:l}},optionalAttributes:{zoomRange:{type:d.pe.SHORT,count:2,packPrecisionFactor:s.fq,pack:({scaleInfo:e},{tileInfo:t})=>(0,o.My)(e,t)}},attributes:{id:{type:d.pe.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:d.pe.UNSIGNED_BYTE,count:1,pack:u},pos:{type:d.pe.SHORT,count:2,pack:"position",packPrecisionFactor:1},offset:{type:d.pe.FLOAT,count:2,packAlternating:{count:4,pack:e=>{const t=e.texelDimensions;return[[-.5*t[0],-.5*t[1]],[.5*t[0],-.5*t[1]],[-.5*t[0],.5*t[1]],[.5*t[0],.5*t[1]]]}}},uv:{type:d.pe.SHORT,count:2,packPrecisionFactor:1,packAlternating:{count:4,packTessellation:({texXmax:e,texXmin:t,texYmax:r,texYmin:i})=>[[t,i],[e,i],[t,r],[e,r]]}},animationPointerAndBaseSizeAndReferenceSize:{type:d.pe.UNSIGNED_SHORT,count:4,packPrecisionFactor:1,pack:({animations:e,baseSize:t,referenceSize:r})=>[e.dataColumn,e.dataRow,t,r]},sizing:{type:d.pe.UNSIGNED_SHORT,count:4,packPrecisionFactor:8,pack:({strokeWidth:e,pixelDimensions:t,baseSize:r,sprite:i,sizeRatio:n})=>{const s=Math.max(r*i.width/i.height,r),o=i.sdfDecodeCoeff*s*n;return[t[0],t[1],e,o]}},angle:{type:d.pe.BYTE,count:1,packTessellation:({angle:e})=>e}}}}_write(e,t){const r=this.evaluatedMeshParams.sprite,{textureBinding:i}=r;e.recordStart(this.instanceId,this.attributeLayout,i);const n=t.getDisplayId();if("esriGeometryPolygon"===t.geometryType){const r=t.readCentroidForDisplay();if(!r)return;const[i,s]=r.coords;this._writeQuad(e,n,i,s)}else if("esriGeometryPoint"===t.geometryType){const r=t.readXForDisplay(),i=t.readYForDisplay();this._writeQuad(e,n,r,i)}else{const r=t.readGeometryForDisplay();if(r){const{angleToLine:t}=this.evaluatedMeshParams;if(t){let t=!0,i=null,s=null;r.forEachVertex(((r,o)=>{if(null!=i&&null!=s){const a=Math.atan2(o-s,r-i)/h.rp;t&&(this._writeQuad(e,n,i,s,a),t=!1),this._writeQuad(e,n,r,o,a)}i=r,s=o}))}else r.forEachVertex(((t,r)=>{this._writeQuad(e,n,t,r)}))}}e.recordEnd()}_writeQuad(e,t,r,i,n=0){const s=this.evaluatedMeshParams.sprite,{rect:o}=s,a=o.x+2,l=o.y+2,c=o.x+o.width-2,u=o.y+o.height-2,h=e.vertexCount();e.recordBounds(r,i,64,64);const d={texXmin:a,texYmin:l,texXmax:c,texYmax:u,angle:n};for(let n=0;n<4;n++)this._writeVertex(e,t,r,i,d);e.indexEnsureSize(6),e.indexWrite(h),e.indexWrite(h+1),e.indexWrite(h+2),e.indexWrite(h+1),e.indexWrite(h+3),e.indexWrite(h+2)}}var p=r(56791),m=r(46869),_=r(57413),g=r(28615),y=r(31859),x=r(83919),b=r(21099),w=r(37463),v=r(25738),S=r(67348),T=r(10793),I=r(13786),M=r(14583),A=r(1932),E=r(58081),P=r(76613),C=r(96564),R=r(7459),F=r(57650),L=r(2014);function k(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function N(e,t){return Math.sqrt(e*e+t*t)}function O(e){const t=N(e[0],e[1]);e[0]/=t,e[1]/=t}function D(e,t){return N(e[0]-t[0],e[1]-t[1])}function z(e){return e.length-1}function U(e){let t=0;for(let r=0;r<z(e);r++)t+=G(e,r);return t}function G(e,t,r=1){let[i,n]=function(e,t){return e[t+1]}(e,t);return[i,n]=[Math.round(i),Math.round(n)],Math.sqrt(i*i+n*n)*r}class B{constructor(e,t,r,i,n){this._segments=e,this._index=t,this._distance=r,this._xStart=i,this._yStart=n,this._done=!1}static create(e){return new B(e,0,0,e[0][0],e[0][1])}clone(){return new B(this._segments,this._index,this._distance,this.xStart,this.yStart)}equals(e){return this._index===e._index||e._index===this._index-1&&(0===this._distance||1===e._distance)||e._index===this._index+1&&(1===this._distance||0===e._distance)}leq(e){return this._index<e._index||this._index===e._index&&this._distance<=e._distance}geq(e){return this._index>e._index||this._index===e._index&&this._distance>=e._distance}get _segment(){return this._segments[this._index+1]}get angle(){const e=this.dy,t=(0*e+-1*-this.dx)/(1*this.length);let r=Math.acos(t);return e>0&&(r=2*Math.PI-r),r}get xStart(){return this._xStart}get yStart(){return this._yStart}get x(){return this.xStart+this.distance*this.dx}get y(){return this.yStart+this.distance*this.dy}get dx(){return this._segment[0]}get dy(){return this._segment[1]}get xMidpoint(){return this.xStart+.5*this.dx}get yMidpoint(){return this.yStart+.5*this.dy}get xEnd(){return this.xStart+this.dx}get yEnd(){return this.yStart+this.dy}get length(){const{dx:e,dy:t}=this;return Math.sqrt(e*e+t*t)}get remainingLength(){return this.length*(1-this._distance)}get backwardLength(){return this.length*this._distance}get distance(){return this._distance}get done(){return this._done}hasPrev(){return this._index-1>=0}hasNext(){return this._index+1<z(this._segments)}next(){return this.hasNext()?(this._xStart+=this.dx,this._yStart+=this.dy,this._distance=0,this._index+=1,this):null}prev(){return this.hasPrev()?(this._index-=1,this._xStart-=this.dx,this._yStart-=this.dy,this._distance=1,this):(this._done=!0,null)}_seekBackwards(e,t){const r=this.backwardLength;if(e<=r)return this._distance=(r-e)/this.length,this;let i=this.backwardLength;for(;this.prev();){if(i+this.length>e)return this._seekBackwards(e-i);i+=this.length}return this._distance=0,t?this:null}seek(e,t=!1){if(e<0)return this._seekBackwards(Math.abs(e),t);if(e<=this.remainingLength)return this._distance=(this.backwardLength+e)/this.length,this;let r=this.remainingLength;for(;this.next();){if(r+this.length>e)return this.seek(e-r,t);r+=this.length}return this._distance=1,t?this:null}}function V(e,t,r,i=!0){const n=U(e),s=B.create(e),o=n/2;if(!i)return s.seek(o),void(Math.abs(s.x)<L.$u&&Math.abs(s.y)<L.$u&&r(s.clone(),0,o+0*t,n));const a=Math.max((n-t)/2,0),l=Math.floor(a/t),c=o-l*t;s.seek(c);for(let e=-l;e<=l;e++)Math.abs(s.x)<L.$u&&Math.abs(s.y)<L.$u&&r(s.clone(),e,o+e*t,n),s.seek(t)}function q(e,t){const r=t;for(let t=0;t<e.length;t++){let i=e[t];Z(i,r);const n=[];n.push(i[0]);for(let e=1;e<i.length;e++){const[t,r]=i[e-1],[s,o]=i[e],a=s-t,l=o-r;n.push([a,l])}e[t]=n,i=n}return e}function Z(e,t){const r=1e-6;if(t<=0)return;const i=e.length;if(i<3)return;const n=[];let s=0;n.push(0);for(let t=1;t<i;t++)s+=D(e[t],e[t-1]),n.push(s);t=Math.min(t,.2*s);const o=[];o.push(e[0][0]),o.push(e[0][1]);const a=e[i-1][0],l=e[i-1][1],c=k([0,0],e[0],e[1]);O(c),e[0][0]+=t*c[0],e[0][1]+=t*c[1],k(c,e[i-1],e[i-2]),O(c),e[i-1][0]+=t*c[0],e[i-1][1]+=t*c[1];for(let e=1;e<i;e++)n[e]+=t;n[i-1]+=t;const u=.5*t;for(let s=1;s<i-1;s++){let a=0,l=0,c=0;for(let i=s-1;i>=0&&!(n[i+1]<n[s]-u);i--){const o=u+n[i+1]-n[s],h=n[i+1]-n[i],d=n[s]-n[i]<u?1:o/h;if(Math.abs(d)<r)break;const f=d*d,p=d*o-.5*f*h,m=d*h/t,_=e[i+1],g=e[i][0]-_[0],y=e[i][1]-_[1];a+=m/p*(_[0]*d*o+.5*f*(o*g-h*_[0])-f*d*h*g/3),l+=m/p*(_[1]*d*o+.5*f*(o*y-h*_[1])-f*d*h*y/3),c+=m}for(let o=s+1;o<i&&!(n[o-1]>n[s]+u);o++){const i=u-n[o-1]+n[s],h=n[o]-n[o-1],d=n[o]-n[s]<u?1:i/h;if(Math.abs(d)<r)break;const f=d*d,p=d*i-.5*f*h,m=d*h/t,_=e[o-1],g=e[o][0]-_[0],y=e[o][1]-_[1];a+=m/p*(_[0]*d*i+.5*f*(i*g-h*_[0])-f*d*h*g/3),l+=m/p*(_[1]*d*i+.5*f*(i*y-h*_[1])-f*d*h*y/3),c+=m}o.push(a/c),o.push(l/c)}o.push(a),o.push(l);for(let t=0,r=0;t<i;t++)e[t][0]=o[r++],e[t][1]=o[r++]}var H=r(53972);const j=(0,v.Bj)((e=>{let t=0;if(0===e)return 1/0;for(;!(e%2);)t++,e/=2;return t}));class W extends H.G8{constructor(){super(...arguments),this._zoomLevel=0}_write(e,t,r,i){if(this._zoomLevel=i||0,null!=r)throw new Error("InternalError: EffectGeometry not support for LabelMeshWriter");switch(t.geometryType){case"esriGeometryPoint":{const r=t.readXForDisplay(),i=t.readYForDisplay();this._writePoint(e,r,i,t);break}case"esriGeometryEnvelope":case"esriGeometryPolygon":case"esriGeometryMultipoint":{const r=t.readCentroidForDisplay();if(!r)return;const[i,n]=r.coords;this._writePoint(e,i,n,t);break}case"esriGeometryPolyline":this._writeLines(e,t)}}_createLineLabelMetric(e,t,r,i){const n=(0,R.Q4)(e),s="right"===this.evaluatedMeshParams.horizontalAlignment?-1:1,o="bottom"===this.evaluatedMeshParams.verticalAlignment?-1:1,a=this.evaluatedMeshParams.scaleInfo?.maxScale??0,l=this.evaluatedMeshParams.scaleInfo?.minScale??0;return new F.f(n,t,r,s,o,a,l,i??null)}_writePoint(e,t,r,i){const n=this._getShaping();if(!n)return;const s=i.getDisplayId(),o=(0,C.xy)(this.evaluatedMeshParams.horizontalAlignment),a=(0,C.UD)(this.evaluatedMeshParams.verticalAlignment),l=this.evaluatedMeshParams.scaleInfo?.maxScale??0,c=this.evaluatedMeshParams.scaleInfo?.minScale??0,u=(0,R.Q4)(i.getDisplayId()),h=this._getPointReferenceBounds()||{offsetX:0,offsetY:0,size:0};e.metricStart(new F.f(u,t,r,o,a,l,c,h)),this._writeGlyphs(e,s,t,r,n,0,h),e.metricBoxWrite(n.boundsT),e.metricEnd()}_getPointReferenceBounds(){if(!this._references)return null;for(const e of this._references){const t=e.getBoundsInfo();if(t)return t}return null}_writeLines(e,t){const{scaleInfo:r,verticalAlignment:i}=this.evaluatedMeshParams,n=this.evaluatedMeshParams.repeatLabelDistance||128,s=this._getShaping("middle");if(!s)return;const a=(e,t,r,i)=>this._placeSubdivGlyphs(e,t,r,i),l=(s.bounds.width+n)/2;this._current={out:e,id:t.getDisplayId(),shaping:s,zoomRange:(0,o.My)(r,this.getTileInfo()),referenceBounds:this._getPointReferenceBounds()||{offsetX:0,offsetY:0,size:0},offsetDirection:null},this._verticalPlacement="bottom"===i?"above":"top"===i?"below":null,this._verticalPlacement?this._writeAboveAndBelowAlong(t,a,l):this._writeCenterAlong(t,a,l)}_writeAboveAndBelowAlong(e,t,r){const{repeatLabel:i}=this.evaluatedMeshParams,{shaping:n}=this._current,s=n.bounds.halfHeight,o=e.readGeometryForDisplay();if(!o)return;const a=new P.A;(0,E.kz)(a,o,!1,!1,"esriGeometryPolyline",1);const l=Y(new P.A,a,s),c=Y(new P.A,a,-s),u=(0,E.zv)(c,"esriGeometryPolyline",!1,!1),h=q((0,E.zv)(l,"esriGeometryPolyline",!1,!1).paths,n.bounds.width),d=q(u.paths,n.bounds.width);this._current.offsetDirection="above";for(const e of h)V(e,r,t,!!i);this._current.offsetDirection="below";for(const e of d)V(e,r,t,!!i)}_writeCenterAlong(e,t,r){const{repeatLabel:i}=this.evaluatedMeshParams,{shaping:n}=this._current,s=q(e.readLegacyGeometryForDisplay().paths,n.bounds.width);for(const e of s)V(e,r,t,!!i)}_placeSubdivGlyphs(e,t,r,i){const{allowOverrun:n,labelPosition:s,repeatLabelDistance:o}=this.evaluatedMeshParams,a=this._current.zoomRange[0],l=j(t),c=this._current.shaping.bounds.width/2,u=Math.sqrt(o||128)/2,h=Math.min(r,i-r),d=this._current.shaping.isMultiline?H.GJ:Math.log2(h/(u+c/2)),f=0===t?d:Math.min(l,d),p=Math.max(a,this._zoomLevel+1-f),m=this._zoomLevel-p,_=this._current.shaping.bounds.width/2*2**m;this._current.shaping.isMultiline?0===t&&this._placeStraight(e,p):n&&m<0?this._placeStraightAlong(e,a):"parallel"===s?this._placeStraightAlong(e,p):"curved"===s&&this._placeCurved(e,p,_)}_placeStraight(e,t){const{out:r,id:i,shaping:n,referenceBounds:s}=this._current,{x:o,y:a}=e;r.metricStart(this._createLineLabelMetric(i,o,a)),r.metricBoxWrite(n.boundsT);const l=e.angle*(180/Math.PI)%360,c=(e.angle*(180/Math.PI)+180)%360;this._writeGlyphs(r,i,o,a,n,0,s,{clipAngle:l,mapAligned:!0,isLineLabel:!0,minZoom:t}),this._writeGlyphs(r,i,o,a,n,0,s,{clipAngle:c,mapAligned:!0,isLineLabel:!0,minZoom:t}),r.metricEnd()}_placeCurved(e,t,r){const{out:i,id:n}=this._current;i.metricStart(this._createLineLabelMetric(n,e.x,e.y));const s=e.clone(),o=e.angle*(180/Math.PI)%360,a=(e.angle*(180/Math.PI)+180)%360;this._verticalPlacement&&this._verticalPlacement!==this._current.offsetDirection||(this._placeFirst(s,t,1,o),this._placeBack(e,s,t,r,1,o),this._placeForward(e,s,t,r,1,o)),this._verticalPlacement&&this._verticalPlacement===this._current.offsetDirection||(this._placeFirst(s,t,0,a),this._placeBack(e,s,t,r,0,a),this._placeForward(e,s,t,r,0,a)),i.metricEnd()}_placeStraightAlong(e,t){const{out:r,id:i,shaping:s,zoomRange:o,referenceBounds:a}=this._current,{boxBorderLineColor:l,boxBackgroundColor:c}=this.evaluatedMeshParams,u=e.clone(),h=e.angle*(180/Math.PI)%360,d=(e.angle*(180/Math.PI)+180)%360,f=s.glyphs.length>0&&!(!l&&!c);if(r.metricStart(this._createLineLabelMetric(i,e.x,e.y)),f){const l=Math.max(t,o[0],0),c=Math.min(H.GJ,o[1]),u=(0,S.$0)((0,T.vt)(),-e.angle),f={minZoom:l,maxZoom:c,clipAngle:h,mapAligned:!0,isLineLabel:!0},p=(0,n.Lz)(this.evaluatedMeshParams.offsetX),m=(0,n.Lz)(this.evaluatedMeshParams.offsetY);if(!this._verticalPlacement||this._verticalPlacement===this._current.offsetDirection){const t=(0,M.fA)(p,-1*m),[n,o]=s.shapeBackground((0,S.Tl)((0,T.vt)(),u,t));r.recordStart(this.instanceId,this.attributeLayout,s.glyphs[0].textureBinding);const l=2*Math.max(n.width,n.height);r.recordBounds(e.x+n.x,e.y+n.y,l,l),this._writeTextBox(r,i,e.x,e.y,o,a,f),r.recordEnd()}if(!this._verticalPlacement||this._verticalPlacement!==this._current.offsetDirection){const t=(0,M.fA)(p,m),[n,o]=s.shapeBackground((0,S.Tl)((0,T.vt)(),u,t));f.clipAngle=d,r.recordStart(this.instanceId,this.attributeLayout,s.glyphs[0].textureBinding);const l=2*Math.max(n.width,n.height);r.recordBounds(e.x+n.x,e.y+n.y,l,l),this._writeTextBox(r,i,e.x,e.y,o,a,f),r.recordEnd()}}this._verticalPlacement&&this._verticalPlacement!==this._current.offsetDirection||this._placeFirst(u,t,1,h,!0),this._verticalPlacement&&this._verticalPlacement===this._current.offsetDirection||this._placeFirst(u,t,0,d,!0),r.metricEnd()}_placeBack(e,t,r,i,n,s){const o=e.clone();let a=e.backwardLength+0;for(;o.prev()&&!(a>=i);)this._placeOnSegment(o,t,a,r,-1,n,s),a+=o.length+0}_placeForward(e,t,r,i,n,s){const o=e.clone();let a=e.remainingLength+0;for(;o.next()&&!(a>=i);)this._placeOnSegment(o,t,a,r,1,n,s),a+=o.length+0}_placeFirst(e,t,r,i,n=!1){const{out:s,id:o,shaping:a,zoomRange:l,referenceBounds:c}=this._current,u=a.glyphs;for(const h of u){const u=h.x>a.bounds.x?r:1-r,d=u*e.remainingLength+(1-u)*e.backwardLength,f=Math.abs(h.x+h.width/2-a.bounds.x),p=Math.max(0,this._zoomLevel+Math.log2(f/(d+0))),m=Math.max(t,n?0:p);h.maxZoom=Math.min(l[1],H.GJ),h.angle=e.angle+(1-r)*Math.PI,h.minZoom=Math.max(l[0],m),this._writeLineGlyph(s,o,e.x,e.y,a.bounds,h,i,c,!0),(r||this._current.offsetDirection)&&this._isVisible(h.minZoom,h.maxZoom)&&s.metricBoxWrite(h.bounds)}}_placeOnSegment(e,t,r,i,n,s,o){const{out:a,id:l,shaping:c,referenceBounds:u}=this._current,h=c.glyphs,d=e.dx/e.length,f=e.dy/e.length,p={x:e.x+r*-n*d,y:e.y+r*-n*f};for(const t of h){const h=t.x>c.bounds.x?s:1-s;if(!(h&&1===n||!h&&-1===n))continue;const d=Math.abs(t.x+t.width/2-c.bounds.x),f=Math.max(0,this._zoomLevel+Math.log2(d/r)-.1),m=Math.max(i,this._zoomLevel+Math.log2(d/(r+e.length+0)));0!==f&&(t.angle=e.angle+(1-s)*Math.PI,t.minZoom=m,t.maxZoom=f,this._writeLineGlyph(a,l,p.x,p.y,c.bounds,t,o,u,!0),(s||this._current.offsetDirection)&&this._isVisible(t.minZoom,t.maxZoom)&&a.metricBoxWrite(t.bounds))}}_writeLineGlyph(e,t,r,i,n,s,a,l,c){const u=r+n.x,h=i+n.y,d=2*(this.evaluatedMeshParams.minPixelBuffer?this.evaluatedMeshParams.minPixelBuffer/this._textMeshTransformProps.fontSize:1),f=Math.max(n.width,n.height)*d;e.recordStart(this.instanceId,this.attributeLayout,s.textureBinding),e.recordBounds(u,h,f,f);const{texcoords:p,offsets:m}=s,{fontSize:_,haloSize:g,outlineSize:y}=this._textMeshTransformProps;this._writeQuad(e,t,r,i,{texcoords:p,offsets:m,fontSize:_,haloSize:g,outlineSize:y,color:(0,o.Jb)(this.evaluatedMeshParams.color),isBackground:!1,referenceBounds:l,minZoom:Math.max(this._current.zoomRange[0],s.minZoom),maxZoom:Math.min(this._current.zoomRange[1],s.maxZoom),clipAngle:a,mapAligned:c,isLineLabel:!0}),e.recordEnd()}_isVisible(e,t){const r=Math.floor(this._zoomLevel*s.fq)/s.fq;return e<=r&&r<=t}}function Y(e,t,r){const{coords:i,lengths:n}=t,s=(0,A.vt)(),o=(0,A.vt)(),a=(0,A.vt)(),l=(0,A.vt)(),c=(0,A.vt)(),u=(0,A.vt)();let h=0;for(let t=0;t<n.length;t++){const d=n[t];for(let t=0;t<d;t++){const n=2*(t+h-1),f=2*(t+h),p=2*(t+h+1);t>0?(0,I.hZ)(s,i[n],i[n+1]):(0,I.hZ)(s,0,0),(0,I.hZ)(o,i[f],i[f+1]),t<d-1?(0,I.hZ)(a,i[p],i[p+1]):(0,I.hZ)(a,0,0),0===t?(0,I.hZ)(l,0,0):((0,I.jb)(l,o,s),(0,I.S8)(l,l),(0,I.hZ)(l,l[1],-l[0])),t===d-1?(0,I.hZ)(c,0,0):((0,I.jb)(c,a,o),(0,I.S8)(c,c),(0,I.hZ)(c,c[1],-c[0])),(0,I.WQ)(u,l,c),(0,I.S8)(u,u);const m=u[0]*c[0]+u[1]*c[1];0!==m&&(0,I.hs)(u,u,m),(0,I.hs)(u,u,r),e.coords.push(o[0]+u[0],o[1]+u[1])}e.lengths.push(d),h+=d}return e}var $=r(67293),X=r(63124),Q=r(82806),J=r(50659),K=r(39819),ee=r(21609),te=r(40633),re=r(95415),ie=r(99121);function ne(e){return e instanceof se?e:"object"==typeof e&&"type"in e?ce[e.type].hydrate(e):new oe(e)}class se{constructor(e){this.inputs=e}encode(){const e=[];for(const t of this.inputs)e.push(...t.encode());return e.push(...this.instructions),e}}class oe extends se{constructor(e){super([]),this.value=e}simplify(){return this}get instructions(){if(Array.isArray(this.value)){const[e,t,r,i]=this.value;return null!=i?ie.GA.vector4.encode([e,t||0,r||0,i]):ie.GA.vector3.encode([e,t||0,r||0])}return ie.GA.scalar.encode(this.value)}}class ae extends se{constructor(e,t){super([t]),this._config=e,this._parent=t}static hydrate(e){return new ae(e,ne(e.parent))}simplify(){if(this._config.relativeTranslation||this._config.absoluteScale)return this;const e=this._parent.simplify();if(!(e instanceof oe))return this;const[t,r,i,n]=e.value,s=this._config.translation.from[0],o=this._config.translation.from[1],a=this._config.rotation.from,l=this._config.scale.from;if(s===this._config.translation.to[0]&&o===this._config.translation.to[1]&&a===this._config.rotation.to&&l===this._config.scale.to){const e=i+a,c=n*l,u=Math.sin(i),h=Math.cos(i);return new oe([h*n*s-u*n*o+t,u*n*s+h*n*o+r,e,c])}return new ae(this._config,e)}get instructions(){return ie.GA.animatedTransform.encode(this._config)}}class le extends se{constructor(e,t){super([t]),this._config=e,this._parent=t}static hydrate(e){return new le(e,ne(e.parent))}simplify(){const e=this._parent.simplify();if(!(e instanceof oe))return this;const[t,r,i,n]=e.value,s=this._config.color.from[0],o=this._config.color.from[1],a=this._config.color.from[2];let l=this._config.color.from[3];const c=this._config.opacity.from;return s===this._config.color.to[0]&&o===this._config.color.to[1]&&a===this._config.color.to[2]&&l===this._config.color.to[3]&&c===this._config.opacity.to?(l*=c,new oe([t*s,r*o,i*a,n*l])):new le(this._config,e)}get instructions(){return ie.GA.animatedColor.encode(this._config)}}const ce={AnimatedTransform:ae,AnimatedColor:le};var ue=r(52874);function he(e){return fe(e.map((e=>me(e))).map((e=>ne(e).simplify())))}function de(e){const t=[];return t.push(e.transform),t.push(e.fromColor),t.push(e.toColor),t.push(e.colorMix),t.push(e.toOpacity),t.push(e.opacityMix),t}function fe(e){const t=[],r=[];let i=0;for(const n of e){const s=[...n.encode(),...ie.GA.ret.encode()];t.push([i+e.length,0,0,0]),r.push(...s),i+=s.length}return[...t,...r]}async function pe(e,t){const r=e;let i;if("number"==typeof r||"string"==typeof r||"boolean"==typeof r)i=r;else if(Array.isArray(r))i=await Promise.all(r.map((e=>pe(e,t))));else if("object"==typeof r)if("valueExpressionInfo"in r){const{valueExpressionInfo:e}=r,{expression:n}=e;i={...r,computed:await t.createComputedField({expression:n})}}else{i={};for(const e in r)i[e]=await pe(r[e],t)}return i}function me(e,t,r){const i=e;let n;if("number"==typeof i||"string"==typeof i||"boolean"==typeof i)n=i;else if(Array.isArray(i))n=i.map((e=>me(e,t,r)));else if("object"==typeof i)if("type"in i&&null!=i.type&&"Process"===i.type)switch(i.op){case"ArcadeColor":{const e=me(i.value,t,r);_e(Array.isArray(e)&&4===e.length),n=[e[0]/255,e[1]/255,e[2]/255,e[3]]}break;case"Transparency":{const e=me(i.value,t,r);_e("number"==typeof e),n=1-e/100}break;case"Divide":{const e=me(i.left,t,r);_e("number"==typeof e);const s=me(i.right,t,r);_e("number"==typeof s),n=e/s}break;case"Random":{const e=me(i.seed,t,r),s=me(i.min,t,r),o=me(i.max,t,r),a=t.getObjectId(),l=(0,re.A)(a||0);n=s+(0,re.J)(l,e)*(o-s)}}else if("computed"in i)n=function(e){if(!("computed"in e))return e;let i=e.computed.readWithDefault(t,r,[255*e.defaultValue[0],255*e.defaultValue[1],255*e.defaultValue[2],e.defaultValue[3]]);if("string"==typeof i){const e=ue.A.fromString(i);e&&(i=[e.r,e.g,e.b,e.a])}return i}(i);else{n={};for(const e in i)n[e]=me(i[e],t,r)}return n}function _e(e){if(!e)throw new Error("Assertion failed.")}var ge=r(25731),ye=r(37069);async function xe(e,t,r=!1){const{defaultValue:i,valueExpressionInfo:n,value:s}=t;if(n){const{expression:s}=n,o=await e.createComputedField({expression:s},r);return o?{...t,computed:o,defaultValue:i}:null}return{...t,computed:new ye.G(s),defaultValue:i}}async function be(e,t){const{valueExpressionInfo:r}=t,{expression:i}=r,n=await e.createComputedField({expression:i});return n?{...t,computed:n}:null}function we(e){return"object"==typeof e&&null!=e&&(!(!("valueExpressionInfo"in e)||!e.valueExpressionInfo)||"type"in e&&"Process"===e.type&&"op"in e&&"Random"===e.op)}function ve(e){if(Array.isArray(e))for(const t of e)if(ve(t))return!0;if("object"==typeof e){if(we(e))return!0;for(const t in e)if(ve(e[t]))return!0}return!1}class Se{static async create(e,t,r){const i={},n=new Map,s=new Map,o=new Map,a=new Map,l=new Map,c=new Map;for(const u in r){const h=r[u];if(null!=h&&"object"==typeof h)if(Array.isArray(h)){if("object"==typeof h[0])throw new Error(`InternalError: Cannot handle ${u}. Nested array params are not supported`);i[u]=h}else if("valueExpressionInfo"in h){if(h.value){i[u]=h.value;continue}const t=await be(e,h);if(!t){i[u]=h.defaultValue;continue}n.set(u,t),i[u]=null}else switch(h.type){case"cim-effect-infos":if(h.effectInfos.some((e=>e.overrides.length))){s.set(u,{effects:await Promise.all(h.effectInfos.map((async t=>{const r=t.overrides.map((t=>xe(e,t)));return{effect:t.effect,compiledOverrides:(await Promise.all(r)).filter(J.Ru)}})))});break}i[u]=h.effectInfos.map((e=>e.effect));break;case"cim-marker-placement-param":h.overrides.length&&o.set(u,{placementInfo:h,compiledOverrides:(await Promise.all(h.overrides.map((t=>xe(e,t))))).filter(J.Ru)}),i[u]=h.placement;break;case"text-rasterization-param":{if(h.overrides.length){const t=h.overrides.map((t=>xe(e,t,h.useLegacyLabelEvaluationRules)));a.set(u,{compiledOverrides:(await Promise.all(t)).filter(J.Ru),rasterizationParam:h,objectIdToResourceId:new Map});continue}const r={type:"cim-rasterization-info",resource:h.resource};i[u]=await t.fetchResourceImmediate(r)??null;break}case"sprite-rasterization-param":{if(h.overrides.length){const t=h.overrides.map((t=>xe(e,t)));a.set(u,{compiledOverrides:(await Promise.all(t)).filter(J.Ru),rasterizationParam:h,objectIdToResourceId:new Map});continue}if("animated"===h.resource.type){a.set(u,{compiledOverrides:[],rasterizationParam:h,objectIdToResourceId:new Map});continue}const r={type:"cim-rasterization-info",resource:h.resource};i[u]=await t.fetchResourceImmediate(r)??null;break}case"cim-marker-transform-param":{const{params:t}=h;if(ve(t)){const r={compiledMarkerInfos:[]};await Promise.all(t.map((async t=>{const i={props:{}};for(const r in t)if(we(t[r])){const n=await be(e,t[r]);i.compiledExpressionMap||(i.compiledExpressionMap=new Map);const s=i.compiledExpressionMap;n&&s.set(r,n)}else i.props[r]=t[r];r.compiledMarkerInfos.push(i)}))),l.set(u,r)}else i[u]={type:"cim-marker-transform-info",infos:t};break}case"animation-params":{const{params:r}=h,n=de(r);if(ve(n)){const t=await Promise.all(n.map((t=>pe(t,e))));c.set(u,{params:t,propertyIdToResourceId:new Map,key:u})}else{const e=he(n),r=await t.fetchResourceImmediate({type:"animation-info",resource:e});null!=r&&"sprite"===r.type&&(i[u]={dataRow:r.rect.y,dataColumn:r.rect.x})}break}default:i[u]=h}else i[u]=h}return new Se(r,i,n,s,o,a,l,c)}constructor(e,t,r,i,n,s,o,a){this.inputMeshParams=e,this._resolvedMeshParams=t,this._dynamicProperties=r,this._dynamicEffectProperties=i,this._dynamicPlacementProperties=n,this._dynamicAsyncProperties=s,this._dynamicTransformProperties=o,this._dynamicAsyncAnimations=a,this.evaluator=e=>e}get hasDynamicProperties(){return!!(this._dynamicProperties.size||this._dynamicAsyncProperties.size||this._dynamicEffectProperties.size||this._dynamicTransformProperties.size||this._dynamicPlacementProperties.size||this._dynamicAsyncAnimations.size)}get evaluatedMeshParams(){return this._evaluatedMeshParams||(this._evaluatedMeshParams=this.evaluator(this._resolvedMeshParams)),this._evaluatedMeshParams}enqueueRequest(e,t,r){for(const i of this._dynamicAsyncProperties.values()){const n=(0,ee.o8)(i.rasterizationParam.resource);"animated"===i.rasterizationParam.resource.type&&i.rasterizationParam.resource.randomizeStartTime&&(n.primitiveName="__RESERVED__PRIMITIVE__NAME__",n.startGroup=(0,re.A)(t.getObjectId()||0));for(const{primitiveName:e,propertyName:s,computed:o,defaultValue:a,valueExpressionInfo:l}of i.compiledOverrides)try{const l="animated"===i.rasterizationParam.resource.type?n.primitiveName:e;(0,ge.Ph)(n,l,s,o,t,r,a)}catch(t){te.A.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.mesh.MeshWriterInputEvaluator").errorOnce(new K.A("invalid-arcade-expression",`Encountered an error when evaluating the arcade expression '${l?.expression}' (primitive: '${e}', property: '${s}')`,t))}const s=e.enqueueRequest({type:"cim-rasterization-info",resource:n});i.objectIdToResourceId.set(t.getObjectId(),s)}for(const i of this._dynamicAsyncAnimations.values()){const n=i.params.map((e=>me(e,t,r))).map(ne).map((e=>e.simplify())),s=fe(n),o=e.enqueueRequest({type:"animation-info",resource:s});i.propertyIdToResourceId.set(t.getObjectId()+"."+i.key,o)}}evaluateMeshParams(e,t,r){for(const[e,i]of this._dynamicProperties.entries())this._resolvedMeshParams[e]=i.computed.readWithDefault(t,r,i.defaultValue);for(const[e,i]of this._dynamicPlacementProperties.entries())for(const{computed:n,defaultValue:s,propertyName:o}of i.compiledOverrides){const a=n.readWithDefault(t,r,s);i.placementInfo.placement[o]=a,this._resolvedMeshParams[e]=i.placementInfo.placement}for(const[e,i]of this._dynamicEffectProperties.entries())for(const n of i.effects){for(const{computed:e,defaultValue:i,propertyName:s}of n.compiledOverrides){const o=e.readWithDefault(t,r,i);n.effect[s]=o}this._resolvedMeshParams[e]=i.effects.map((e=>e.effect))}for(const[e,i]of this._dynamicTransformProperties.entries()){const n={type:"cim-marker-transform-info",infos:[]};for(const e of i.compiledMarkerInfos){const i={...e.props};if(e.compiledExpressionMap)for(const[n,s]of e.compiledExpressionMap){const e=s.computed.readWithDefault(t,r,s.defaultValue);i[n]="number"==typeof e||"boolean"==typeof e?e:s.defaultValue}n.infos.push(i)}this._resolvedMeshParams[e]=n}for(const[r,i]of this._dynamicAsyncProperties.entries()){const n=i.objectIdToResourceId.get(t.getObjectId());if(null==n)continue;const s=e.getResource(n);this._resolvedMeshParams[r]=s}for(const[r,i]of this._dynamicAsyncAnimations.entries()){const n=i.propertyIdToResourceId.get(t.getObjectId()+"."+r);if(null==n)continue;const s=e.getResource(n);this._resolvedMeshParams[r]={dataRow:s.rect.y,dataColumn:s.rect.x}}return this._evaluatedMeshParams=this.evaluator(this._resolvedMeshParams),this.evaluatedMeshParams}}var Te=r(77981);class Ie{async createMeshWriter(e,t,r,i){const n=this._getMeshWriter(i.techniqueType),s=await Se.create(e,t,i.inputParams),o=new n(i.id,s,i.optionalAttributes,r);return await o.loadDependencies(),o}_getMeshWriter(e){switch(e){case i.N.Fill:return g.Y;case i.N.DotDensity:return p.k;case i.N.ComplexFill:return m.KE;case i.N.PatternFill:return x.m;case i.N.OutlineFill:return y.w0;case i.N.PatternOutlineFill:return b.Q;case i.N.ComplexOutlineFill:return _.O;case i.N.Marker:return Q.H;case i.N.PieChart:return Te.v;case i.N.Text:return H.G8;case i.N.Line:return $.Bw;case i.N.TexturedLine:return X.K;case i.N.Heatmap:return w.h;case i.N.Label:return W;case i.N.AnimatedMarker:return f;default:throw new Error("Internal Error: Mesh writer not in the registry")}}}},5544:function(e,t,r){r.d(t,{F:function(){return s},q:function(){return o}});var i=r(85475),n=r(85456);function s(e,t,r,s){const o=r.packPrecisionFactor??1;switch(r.type){case n.pe.BYTE:if(1===r.count)e.setInt8(s+r.offset,t*o);else for(let i=0;i<r.count;i++){const n=i*Int8Array.BYTES_PER_ELEMENT;e.setInt8(s+r.offset+n,t[i]*o)}break;case n.pe.UNSIGNED_BYTE:if(1===r.count)e.setUint8(s+r.offset,t*o);else for(let i=0;i<r.count;i++){const n=i*Uint8Array.BYTES_PER_ELEMENT;e.setUint8(s+r.offset+n,t[i]*o)}break;case n.pe.SHORT:if(1===r.count)e.setInt16(s+r.offset,t*o,!0);else for(let i=0;i<r.count;i++){const n=i*Int16Array.BYTES_PER_ELEMENT;e.setInt16(s+r.offset+n,t[i]*o,!0)}break;case n.pe.UNSIGNED_SHORT:if(1===r.count)e.setUint16(s+r.offset,t*o,!0);else for(let i=0;i<r.count;i++){const n=i*Uint16Array.BYTES_PER_ELEMENT;e.setUint16(s+r.offset+n,t[i]*o,!0)}break;case n.pe.INT:if(1===r.count)e.setInt32(s+r.offset,t*o,!0);else for(let i=0;i<r.count;i++){const n=i*Int32Array.BYTES_PER_ELEMENT;e.setInt32(s+r.offset+n,t[i]*o,!0)}break;case n.pe.UNSIGNED_INT:if(1===r.count)e.setUint32(s+r.offset,t*o,!0);else for(let i=0;i<r.count;i++){const n=i*Uint32Array.BYTES_PER_ELEMENT;e.setUint32(s+r.offset+n,t[i]*o,!0)}break;case n.pe.FLOAT:if(1===r.count)e.setFloat32(s+r.offset,t*o,!0);else for(let i=0;i<r.count;i++){const n=i*Float32Array.BYTES_PER_ELEMENT;e.setFloat32(s+r.offset+n,t[i]*o,!0)}break;case n.pe.HALF_FLOAT:if(1===r.count)e.setUint16(s+r.offset,(0,i.fw)(t*o),!0);else for(let n=0;n<r.count;n++){const a=n*Uint16Array.BYTES_PER_ELEMENT;e.setUint16(s+r.offset+a,(0,i.fw)(t[n]*o),!0)}}}function o(e,t,r){switch(t.type){case n.pe.BYTE:{if(1===t.count)return e.getInt8(r+t.offset);const i=[];for(let n=0;n<t.count;n++){const s=n*Int8Array.BYTES_PER_ELEMENT;i.push(e.getInt8(r+t.offset+s))}return i}case n.pe.UNSIGNED_BYTE:{if(1===t.count)return e.getUint8(r+t.offset);const i=[];for(let n=0;n<t.count;n++){const s=n*Uint8Array.BYTES_PER_ELEMENT;i.push(e.getUint8(r+t.offset+s))}return i}case n.pe.SHORT:{if(1===t.count)return e.getInt16(r+t.offset,!0);const i=[];for(let n=0;n<t.count;n++){const s=n*Int16Array.BYTES_PER_ELEMENT;i.push(e.getInt16(r+t.offset+s,!0))}return i}case n.pe.UNSIGNED_SHORT:{if(1===t.count)return e.getUint16(r+t.offset,!0);const i=[];for(let n=0;n<t.count;n++){const s=n*Uint16Array.BYTES_PER_ELEMENT;i.push(e.getUint16(r+t.offset+s,!0))}return i}case n.pe.INT:{if(1===t.count)return e.getInt32(r+t.offset,!0);const i=[];for(let n=0;n<t.count;n++){const s=n*Int32Array.BYTES_PER_ELEMENT;i.push(e.getInt32(r+t.offset+s,!0))}return i}case n.pe.UNSIGNED_INT:{if(1===t.count)return e.getUint32(r+t.offset,!0);const i=[];for(let n=0;n<t.count;n++){const s=n*Uint32Array.BYTES_PER_ELEMENT;i.push(e.getUint32(r+t.offset+s,!0))}return i}case n.pe.FLOAT:{if(1===t.count)return e.getFloat32(r+t.offset,!0);const i=[];for(let n=0;n<t.count;n++){const s=n*Float32Array.BYTES_PER_ELEMENT;i.push(e.getFloat32(r+t.offset+s,!0))}return i}case n.pe.HALF_FLOAT:{if(1===t.count)return(0,i.Kl)(e.getUint16(r+t.offset,!0));const n=[];for(let s=0;s<t.count;s++){const o=s*Uint16Array.BYTES_PER_ELEMENT;n.push((0,i.Kl)(e.getUint16(r+t.offset+o,!0)))}return n}}}},68758:function(e,t,r){r.d(t,{R:function(){return s},z:function(){return n}});let i=null;function n(){return i}async function s(){i=await r.e(4696).then(r.bind(r,28356))}},25731:function(e,t,r){r.d(t,{Ph:function(){return s},Z0:function(){return a},hU:function(){return n}});var i=r(50944);function n(e){const t=e.map((({name:e,count:t,type:r})=>`${e}.${t}.${r}`)).join(",");return(0,i.Wm)(t)}function s(e,t,r,i,n,o,a){if(e.primitiveName===t){let t=i?.readWithDefault(n,o,e[r]&&a);return"text"===e.type&&(t=t.toString()),void(e[r]=t)}if("type"in e&&null!=e.type){if(e.effects)for(const l of e.effects)s(l,t,r,i,n,o,a);switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.symbolLayers)for(const l of e.symbolLayers)s(l,t,r,i,n,o,a);break;case"CIMTextSymbol":e.symbol&&s(e.symbol,t,r,i,n,o,a);break;case"CIMHatchFill":e.lineSymbol&&s(e.lineSymbol,t,r,i,n,o,a);break;case"CIMPictureMarker":case"CIMCharacterMarker":case"CIMVectorMarker":if(e.markerPlacement&&s(e.markerPlacement,t,r,i,n,o,a),"CIMVectorMarker"===e.type&&e.markerGraphics)for(const l of e.markerGraphics)s(l,t,r,i,n,o,a),s(l.symbol,t,r,i,n,o,a)}}}const o=400;function a(e){const t=e.width;return null!=e.effects?o:Math.max(1.25*t,8)}},77981:function(e,t,r){r.d(t,{v:function(){return l}});var i=r(13520),n=r(54417),s=r(54601),o=r(85456);const a={createComputedParams:e=>e,optionalAttributes:{},attributes:{pos:{type:o.pe.SHORT,count:2,packPrecisionFactor:10,pack:"position"},id:{type:o.pe.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:o.pe.UNSIGNED_BYTE,count:1,pack:e=>0},offset:{type:o.pe.SHORT,count:2,packPrecisionFactor:16,packAlternating:{count:4,pack:({size:e})=>{const t=(0,i.Lz)(e),r=-t/2,n=-t/2;return[[r,n],[r+t,n],[r,n+t],[r+t,n+t]]}}},texCoords:{type:o.pe.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:()=>[[0,1],[1,1],[0,0],[1,0]]}},size:{type:o.pe.UNSIGNED_BYTE,count:2,pack:({size:e})=>[e,e]},referenceSize:{type:o.pe.UNSIGNED_BYTE,count:1,pack:({size:e})=>(0,i.Lz)(e)},zoomRange:{type:o.pe.UNSIGNED_BYTE,count:2,pack:({scaleInfo:e},{tileInfo:t})=>(0,n.My)(e,t)}}};class l extends s.r{constructor(){super(...arguments),this.vertexSpec=a}_write(e,t){const r=t.getDisplayId(),n=this.evaluatedMeshParams.minPixelBuffer,s=Math.max((0,i.Lz)(this.evaluatedMeshParams.size),n);let o,a;if("esriGeometryPoint"===t.geometryType)o=t.readXForDisplay(),a=t.readYForDisplay();else{const e=t.readCentroidForDisplay();if(!e)return;o=e?.coords[0],a=e?.coords[1]}e.recordStart(this.instanceId,this.attributeLayout),e.recordBounds(o,a,s,s);const l=e.vertexCount();this._writeVertex(e,r,o,a),e.indexWrite(l+0),e.indexWrite(l+1),e.indexWrite(l+2),e.indexWrite(l+1),e.indexWrite(l+3),e.indexWrite(l+2),e.recordEnd()}}},33702:function(e,t,r){r.d(t,{f_:function(){return _},$Z:function(){return p},DM:function(){return m},rz:function(){return f}});var i=r(53804),n=r(39686),s=r(98282),o=r(70931),a=r(58941),l=r(86486);class c extends s.k2{getVisualVariableData(e){if(!this._vvData){const t=this.getAttributeDataCoords(e);this._vvData=(0,o.US)(this.visualVariableData,t).setDebugName("storage2")}return this._vvData}getAttributeDataCoords(e){if(!this._uv){const t=(0,l.Kt)(e),r=this.size,i=(0,o.Wh)(t.x),n=(0,o.Wh)(t.y).multiply((0,o.Wh)(256)),s=(0,o.Wh)(t.z).multiply((0,o.Wh)(256)).multiply((0,o.Wh)(256)),a=(0,o.fV)(i.add(n).add(s)),c=(0,o.zi)(a,r),u=a.subtract(c).divide(r);this._uv=new o.ZY(c,u).add(.5).divide(r)}return this._uv}getFilterData(e){const t=this.getAttributeDataCoords(e);return(0,o.US)(this.filterFlags,t).setDebugName("storage0")}getAnimationData(e){const t=this.getAttributeDataCoords(e);return(0,o.US)(this.animation,t).setDebugName("storage1")}getVVData(e){return this.getVisualVariableData(e)}getDataDrivenData0(e){const t=this.getAttributeDataCoords(e);return(0,o.US)(this.dataDriven0,t).setDebugName("storage30")}getDataDrivenData1(e){const t=this.getAttributeDataCoords(e);return(0,o.US)(this.dataDriven1,t).setDebugName("storage31")}getDataDrivenData2(e){const t=this.getAttributeDataCoords(e);return(0,o.US)(this.dataDriven2,t).setDebugName("storage32")}getGPGPUData(e){const t=this.getAttributeDataCoords(e);return(0,o.US)(this.gpgpu,t).setDebugName("storage4")}getLocalTimeOrigin(e){const t=this.getAttributeDataCoords(e);return(0,o.US)(this.localTimeOrigin,t).x.setDebugName("storage5")}getFilterFlags(e){return(0,a.A)("webgl-ignores-sampler-precision")?(0,o.mk)(this.getFilterData(e).x.multiply((0,o.fV)(255))):this.getFilterData(e).x.multiply((0,o.fV)(255))}getLabelVisibility(e){const t=this.getFilterData(e).y.multiply(255);return new o.nt(1).subtract(t)}getAnimationValue(e){return this.getAnimationData(e).x}getSizeValue(e){return this.getVisualVariableData(e).x}getColorValue(e){return this.getVisualVariableData(e).y}getOpacityValue(e){return this.getVisualVariableData(e).z}getRotationValue(e){return this.getVisualVariableData(e).w}}(0,i._)([(0,s.Pi)(o.z7)],c.prototype,"filterFlags",void 0),(0,i._)([(0,s.Pi)(o.z7)],c.prototype,"animation",void 0),(0,i._)([(0,s.Pi)(o.z7)],c.prototype,"gpgpu",void 0),(0,i._)([(0,s.Pi)(o.z7)],c.prototype,"localTimeOrigin",void 0),(0,i._)([(0,s.Pi)(o.z7)],c.prototype,"visualVariableData",void 0),(0,i._)([(0,s.Pi)(o.z7)],c.prototype,"dataDriven0",void 0),(0,i._)([(0,s.Pi)(o.z7)],c.prototype,"dataDriven1",void 0),(0,i._)([(0,s.Pi)(o.z7)],c.prototype,"dataDriven2",void 0),(0,i._)([(0,s.Pi)(o.nt)],c.prototype,"size",void 0);class u extends s.k2{}(0,i._)([(0,s.Pi)(o.nt)],u.prototype,"activeReasons",void 0),(0,i._)([(0,s.Pi)(o.nt)],u.prototype,"highlightAll",void 0);class h extends s.k2{}(0,i._)([(0,s.Pi)(o.ZY)],h.prototype,"position",void 0),(0,i._)([(0,s.Pi)(o.nt)],h.prototype,"distance",void 0),(0,i._)([(0,s.Pi)(o.nt)],h.prototype,"smallSymbolDistance",void 0),(0,i._)([(0,s.Pi)(o.nt)],h.prototype,"smallSymbolSizeThreshold",void 0);var d=r(64522);class f extends s.ZA{}(0,i._)([(0,s.C5)(0,o.eB)],f.prototype,"id",void 0),(0,i._)([(0,s.C5)(1,o.nt)],f.prototype,"bitset",void 0),(0,i._)([(0,s.C5)(2,o.ZY)],f.prototype,"pos",void 0);class p extends s.Y7{}(0,i._)([(0,s.C5)(14,o.ZY)],p.prototype,"nextPos1",void 0),(0,i._)([(0,s.C5)(15,o.ZY)],p.prototype,"nextPos2",void 0);class m extends s.HS{}class _ extends s.A{clip(e,t){let r=new o.nt(0);const i=this.storage.getFilterFlags(e);if(r=r.add((0,o.fV)(2).multiply((0,o.fV)(1).subtract((0,l.i6)(i,0)))),this.inside?r=r.add((0,o.fV)(2).multiply((0,o.fV)(1).subtract((0,l.i6)(i,1)))):this.outside?r=r.add((0,o.fV)(2).multiply((0,l.i6)(i,1))):this.highlight&&(r=r.add((0,o.fV)(2).multiply((0,o.fV)(1).subtract(this._checkHighlight(i))))),null!=t){const e=new o.nt(1).subtract((0,o.PM)(t.x,this.view.currentZoom)),i=(0,o.PM)(t.y,this.view.currentZoom);r=r.add(new o.nt(2).multiply(e.add(i)))}return r}getFragmentOutput(e,t,r=new o.nt(1/255)){const i=new s.mm;return i.glFragColor=this._maybeWriteHittest(t)??this._maybeHighlight(e,r)??e,i}_maybeHighlight(e,t){return this.highlight?new o.Zb(e.rgb,(0,o.PM)(t,e.a)):null}_checkHighlight(e){let t=this._checkHighlightBit(e,0);for(let r=1;r<n.U5;r++)t=t.add(this._checkHighlightBit(e,r));return(0,o.PM)(new o.nt(.1),t.add(this.highlight.highlightAll))}_checkHighlightBit(e,t){return(0,l.yS)(e,t).multiply((0,l.mh)(this.highlight.activeReasons,t))}maybeRunHittest(e,t,r){if(null==this.hittestRequest)return null;const i=this.hittest(e,t,r);let n=(0,o.Tk)((0,o.MM)(i,this.hittestRequest.distance),new o.nt(2),new o.nt(0));const s=this.storage.getAttributeDataCoords(e.id),a=(0,l.nb)(s);n=n.add(this.clip(e.id,e.zoomRange));const c=new o.Zb(new o.nt(1/255),0,0,0);return{glPointSize:new o.nt(1),glPosition:new o.Zb(a,n,1),color:c}}_maybeWriteHittest(e){return null!=this.hittestRequest?e.color:null}}(0,i._)([s.E8],_.prototype,"inside",void 0),(0,i._)([s.E8],_.prototype,"outside",void 0),(0,i._)([(0,s.uK)(u)],_.prototype,"highlight",void 0),(0,i._)([(0,s.Pi)(c)],_.prototype,"storage",void 0),(0,i._)([(0,s.Pi)(d.o)],_.prototype,"view",void 0),(0,i._)([(0,s.uK)(h)],_.prototype,"hittestRequest",void 0)},58991:function(e,t,r){r.d(t,{Bh:function(){return m},KP:function(){return p},Ps:function(){return _}});var i=r(53804),n=r(98282),s=r(70931),o=r(33702),a=r(40846),l=r(42203),c=r(31299),u=r(39979),h=r(86486);class d extends l._{}(0,i._)([(0,n.C5)(5,s.Zb)],d.prototype,"tlbr",void 0),(0,i._)([(0,n.C5)(6,s.nt)],d.prototype,"width",void 0),(0,i._)([(0,n.C5)(7,s.nt)],d.prototype,"height",void 0),(0,i._)([(0,n.C5)(8,s.ZY)],d.prototype,"offset",void 0),(0,i._)([(0,n.C5)(9,s.ZY)],d.prototype,"scale",void 0),(0,i._)([(0,n.C5)(10,s.nt)],d.prototype,"angle",void 0);class f extends o.DM{}function p(e,t){const r=e.view.requiredZoomFactor,i=new s.ZY(t.width,t.height),n=i.multiply(t.scale).multiply(r),o=t.angle.multiply(a.rp),l=(0,s.F8)(o),c=(0,s.gn)(o),u=function(e,t,r,i,n){const o=(0,s.LC)((0,h.mh)(n,a.Fz),(0,s.fV)(1)),l=(0,h.Rj)(new s.Zb(e,0));return(0,s.Tk)(o,(0,s.w0)(i.divide(t.x),r.divide(t.y),0,(0,s.ze)(r.divide(t.x)),i.divide(t.y),0,(0,h._9)((0,s.Zc)(l,0)),(0,h._9)((0,s.Zc)(0,l)),1),(0,s.w0)(i.divide(t.x),r.divide(t.y),0,(0,s.ze)(r.divide(t.x)),i.divide(t.y),0,0,0,1))}(t.id,n,l,c,t.bitset),d=e.localTileOffset.getPatternOffsetAtTileOrigin(i,l,c),f=r.multiply(t.scale).multiply(t.offset.subtract(d)).divide(n),p=new s.eB(t.pos,1),m=u.multiply(p).xy.subtract(f),_=t.tlbr.divide(e.mosaicInfo.size.xyxy);let g=(0,h.mh)(t.bitset,a.cn);return null!=e.visualVariableColor&&(g=(0,s.Tk)((0,h.M8)(e.storage.getColorValue(t.id)),new s.nt(0),g)),{tileTextureCoord:m,tlbr:_,sampleAlphaOnly:g}}function m(e,t){const r=(0,s.zi)(t.tileTextureCoord,new s.nt(1)),i=(0,s.jh)(t.tlbr.xy,t.tlbr.zw,r);let n=(0,s.US)(e.mosaicInfo.texture,i);return n=(0,s.Tk)((0,s.MM)(t.sampleAlphaOnly,new s.nt(.5)),n.aaaa,n),t.color.multiply(n)}class _ extends l.z{vertex(e,t){return{...super.vertex(e,t),...p(this,e)}}fragment(e){const t=m(this,e);return this.getFragmentOutput(t,e,new s.nt(0))}}(0,i._)([(0,n.Pi)(u.b)],_.prototype,"mosaicInfo",void 0),(0,i._)([(0,n.Pi)(c.P)],_.prototype,"localTileOffset",void 0),(0,i._)([(0,i.a)(0,(0,n.hF)(d)),(0,i.a)(1,(0,n.hF)(o.$Z))],_.prototype,"vertex",null),(0,i._)([(0,i.a)(0,(0,n.hF)(f))],_.prototype,"fragment",null)},47461:function(e,t,r){r.d(t,{RH:function(){return x},cZ:function(){return p},v9:function(){return _}});var i=r(53804),n=r(98282),s=r(70931),o=r(33702),a=r(58991),l=r(66425),c=r(59224),u=r(31299),h=r(39979),d=r(54537),f=r(15087);const p=16,m=1/p,_=128;class g extends o.rz{}(0,i._)([(0,n.C5)(3,s.Zb)],g.prototype,"color",void 0),(0,i._)([(0,n.C5)(4,s.Zb)],g.prototype,"tlbr",void 0),(0,i._)([(0,n.C5)(5,s.nt)],g.prototype,"angle",void 0),(0,i._)([(0,n.C5)(6,s.nt)],g.prototype,"aux1",void 0),(0,i._)([(0,n.C5)(7,s.nt)],g.prototype,"aux2",void 0),(0,i._)([(0,n.C5)(8,s.ZY)],g.prototype,"aux3",void 0),(0,i._)([(0,n.C5)(9,s.ZY)],g.prototype,"aux4",void 0),(0,i._)([(0,n.C5)(10,s.ZY)],g.prototype,"zoomRange",void 0);class y extends f.A1{}class x extends d.My{vertex(e,t){const{aux1:r,aux2:i,aux3:n,aux4:o}=e,l={...e,width:r,height:i,offset:n,scale:o.multiply(m)},c={...e,halfWidth:r,referenceHalfWidth:i,offset:n,normal:o.subtract(_).multiply(m)},u=(0,d.Yb)(this,c),h=(0,a.KP)(this,l),f=(0,s.MM)(u.isOutline,new s.nt(.5));return{...u,...h,...this.maybeRunHittest(e,t,f)}}fragment(e){const{isOutline:t}=e,r=(0,s.MM)(t,new s.nt(.5)),i=(0,c.o7)(e,this.antialiasingControls.blur),n=(0,a.Bh)(this,e),o=(0,s.Tk)(r,i,n),l=(0,s.Tk)(r,new s.nt(1/255),new s.nt(0));return this.getFragmentOutput(o,e,l)}hittest(e,t,r){return(0,s.Tk)(r,(0,l.My)(this.hittestRequest),(0,l.Lq)(this,e,t))}}(0,i._)([(0,n.Pi)(h.b)],x.prototype,"mosaicInfo",void 0),(0,i._)([(0,n.Pi)(u.P)],x.prototype,"localTileOffset",void 0),(0,i._)([(0,i.a)(0,(0,n.hF)(g)),(0,i.a)(1,(0,n.hF)(o.$Z))],x.prototype,"vertex",null),(0,i._)([(0,i.a)(0,(0,n.hF)(y))],x.prototype,"fragment",null)},42203:function(e,t,r){r.d(t,{_:function(){return h},z:function(){return d}});var i=r(53804),n=r(98282),s=r(70931),o=r(33702),a=r(66425),l=r(81432),c=r(12026),u=r(90906);class h extends o.rz{}(0,i._)([(0,n.C5)(3,s.Zb)],h.prototype,"color",void 0),(0,i._)([(0,n.C5)(4,s.ZY)],h.prototype,"zoomRange",void 0);class d extends o.f_{constructor(){super(...arguments),this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(e,t){const r=(0,u.cF)(this,e.id),i=(0,u.G7)(this,e.id,e.color).multiply(r),n=this.view.displayViewScreenMat3.multiply(new s.eB(e.pos.xy,1)),o=this.clip(e.id,e.zoomRange);return{glPosition:new s.Zb(n.xy,o,1),color:i,...this.maybeRunHittest(e,t,null)}}fragment(e){return this.getFragmentOutput(e.color,e,new s.nt(0))}hittest(e,t){return(0,a.Lq)(this,e,t)}}(0,i._)([(0,n.uK)(l._)],d.prototype,"visualVariableColor",void 0),(0,i._)([(0,n.uK)(c.i)],d.prototype,"visualVariableOpacity",void 0),(0,i._)([(0,i.a)(0,(0,n.hF)(h)),(0,i.a)(1,(0,n.hF)(o.$Z))],d.prototype,"vertex",null),(0,i._)([(0,i.a)(0,(0,n.hF)(o.DM))],d.prototype,"fragment",null)},59224:function(e,t,r){r.d(t,{$0:function(){return w},Xc:function(){return _},cM:function(){return S},fF:function(){return g},fg:function(){return y},o7:function(){return v},xw:function(){return b}});var i=r(53804),n=r(98282),s=r(70931),o=r(33702),a=r(40846),l=r(66425),c=r(81432),u=r(12026),h=r(13635),d=r(21385),f=r(21813),p=r(76347),m=r(90906);class _ extends o.rz{}(0,i._)([(0,n.C5)(3,s.Zb)],_.prototype,"color",void 0),(0,i._)([(0,n.C5)(4,s.ZY)],_.prototype,"offset",void 0),(0,i._)([(0,n.C5)(5,s.ZY)],_.prototype,"normal",void 0),(0,i._)([(0,n.C5)(6,s.nt)],_.prototype,"halfWidth",void 0),(0,i._)([(0,n.C5)(7,s.nt)],_.prototype,"referenceHalfWidth",void 0),(0,i._)([(0,n.C5)(8,s.ZY)],_.prototype,"zoomRange",void 0);class g extends o.DM{}class y extends n.k2{}function x(e){return(0,s.T9)(new s.nt(a.Fb).multiply((0,s.PM)(e,new s.nt(a.J5))),new s.nt(1))}function b(e,t){const{halfWidth:r,normal:i}=e,n=x(r),o=(0,s.Bw)(i).multiply(r);return(0,s.qE)(n.multiply(r.subtract(o)).divide(t.add(n).subtract(new s.nt(1))),new s.nt(0),new s.nt(1))}function w(e,t){const{id:r,offset:i,pos:n,normal:o,zoomRange:l}=t,{displayViewScreenMat3:c,displayViewMat3:u}=e.view,h=(0,m.G7)(e,r,t.color),d=(0,m.cF)(e,r),f=function(e,t){const{id:r,halfWidth:i,referenceHalfWidth:n}=t;if((0,m.G5)(e)){const t=new s.nt(2).multiply(n),o=(0,m.Mg)(e,r,t);return new s.nt(.5).multiply(i.divide((0,s.T9)(n,new s.nt(a.Ni)))).multiply(o)}return i}(e,t),p=new s.nt(.5).multiply(e.antialiasingControls.antialiasing),_=(0,s.T9)(f.add(p),new s.nt(.45)).add(new s.nt(.1).multiply(p)),g=x(_).multiply(_).multiply(i),y=u.multiply(new s.eB(g,new s.nt(0))),b=c.multiply(new s.eB(n,new s.nt(1))).add(y),w=new s.nt(2).multiply((0,s.PM)(f,new s.nt(0))).add(e.clip(r,l)),v=new s.Zb(b.xy,w,1);return{color:h,opacity:d,halfWidth:_,normal:o,scaledOffset:g,scaledHalfWidth:f,glPosition:new s.Zb(v.xy,w,1)}}function v(e,t){const{opacity:r,color:i}=e,n=b(e,t);return r.multiply(i).multiply(n)}(0,i._)([(0,n.Pi)(s.nt)],y.prototype,"antialiasing",void 0),(0,i._)([(0,n.Pi)(s.nt)],y.prototype,"blur",void 0);class S extends o.f_{constructor(){super(...arguments),this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(e,t){const r=w(this,e);return{...r,...this.maybeRunHittest(e,t,r.halfWidth)}}fragment(e){const t=v(e,this.antialiasingControls.blur);return this.getFragmentOutput(t,e)}hittest(e,t,r){const{viewMat3:i,tileMat3:n}=this.view,o=i.multiply(n),a=o.multiply(new s.eB(e.pos,1)),c=o.multiply(new s.eB(t.nextPos1,1)),u=o.multiply(new s.eB(t.nextPos2,1)),{distance:h,smallSymbolDistance:d,smallSymbolSizeThreshold:f}=this.hittestRequest,p=(0,s.PM)(r,f.multiply(.5)).multiply(h.subtract(d)),m=this.hittestRequest.position;return(0,s.jk)((0,l.E2)(m,a.xy,c.xy),(0,l.E2)(m,a.xy,u.xy)).subtract(r).add(p)}}(0,i._)([(0,n.Pi)(y)],S.prototype,"antialiasingControls",void 0),(0,i._)([(0,n.uK)(c._)],S.prototype,"visualVariableColor",void 0),(0,i._)([(0,n.uK)(u.i)],S.prototype,"visualVariableOpacity",void 0),(0,i._)([(0,n.uK)(h.n)],S.prototype,"visualVariableSizeMinMaxValue",void 0),(0,i._)([(0,n.uK)(d.F)],S.prototype,"visualVariableSizeScaleStops",void 0),(0,i._)([(0,n.uK)(f.N)],S.prototype,"visualVariableSizeStops",void 0),(0,i._)([(0,n.uK)(p.d)],S.prototype,"visualVariableSizeUnitValue",void 0),(0,i._)([(0,i.a)(0,(0,n.hF)(_)),(0,i.a)(1,(0,n.hF)(o.$Z))],S.prototype,"vertex",null),(0,i._)([(0,i.a)(0,(0,n.hF)(g))],S.prototype,"fragment",null)},31299:function(e,t,r){r.d(t,{P:function(){return a}});var i=r(53804),n=r(98282),s=r(70931),o=r(40846);class a extends n.k2{getPatternOffsetAtTileOrigin(e,t=new s.nt(0),r=new s.nt(1)){const i=new s.ZY(o.YV).divide(e);let n=e.multiply((0,s.jc)(this.maxIntsToLocalOrigin.multiply(i))).add(this.tileOffsetFromLocalOrigin).subtract(new s.nt(.5).multiply(e));return n=new s.ZY(n.x.multiply(r).subtract(n.y.multiply(t)),n.x.multiply(t).add(n.y.multiply(r))),(0,s.zi)(n,e)}}(0,i._)([(0,n.Pi)(s.ZY)],a.prototype,"tileOffsetFromLocalOrigin",void 0),(0,i._)([(0,n.Pi)(s.ZY)],a.prototype,"maxIntsToLocalOrigin",void 0)},39979:function(e,t,r){r.d(t,{b:function(){return o}});var i=r(53804),n=r(98282),s=r(70931);class o extends n.k2{}(0,i._)([(0,n.Pi)(s.ZY)],o.prototype,"size",void 0),(0,i._)([(0,n.Pi)(s.z7)],o.prototype,"texture",void 0)},54537:function(e,t,r){r.d(t,{A7:function(){return x},My:function(){return w},Yb:function(){return b},nj:function(){return v},wG:function(){return y}});var i=r(53804),n=r(98282),s=r(70931),o=r(33702),a=r(40846),l=r(66425),c=r(59224),u=r(86486),h=r(81432),d=r(12026),f=r(13635),p=r(21385),m=r(21813),_=r(76347),g=r(90906);class y extends o.rz{}(0,i._)([(0,n.C5)(3,s.ZY)],y.prototype,"offset",void 0),(0,i._)([(0,n.C5)(4,s.Zb)],y.prototype,"color",void 0),(0,i._)([(0,n.C5)(5,s.ZY)],y.prototype,"normal",void 0),(0,i._)([(0,n.C5)(6,s.nt)],y.prototype,"halfWidth",void 0),(0,i._)([(0,n.C5)(7,s.nt)],y.prototype,"referenceHalfWidth",void 0),(0,i._)([(0,n.C5)(8,s.ZY)],y.prototype,"zoomRange",void 0);class x extends c.fF{}function b(e,t,r){const{id:i,bitset:n}=t,o=(0,u.mh)(n,a.Xx),l=(0,s.MM)(o,new s.nt(.5)),h=(0,c.$0)(e,t),d=(0,s.Tk)(l,h.halfWidth,new s.nt(0)),f=(0,g.cF)(e,i),p=(0,g.G7)(e,i,t.color),m=(0,s.Tk)(l,t.color,p.multiply(f)),_=e.view.displayViewScreenMat3.multiply(new s.eB(t.pos.xy,1)),y=e.clip(t.id),x=new s.Zb(_.xy,y,1),b=(0,s.Tk)(l,h.glPosition,x),w=r&&e.maybeRunHittest(t,r,l);return{isOutline:o,color:m,opacity:new s.nt(1),halfWidth:d,normal:h.normal,glPosition:b,...w}}class w extends o.f_{constructor(){super(...arguments),this.computeAttributes={pos:["nextPos1","nextPos2"]}}}(0,i._)([(0,n.Pi)(c.fg)],w.prototype,"antialiasingControls",void 0),(0,i._)([(0,n.uK)(h._)],w.prototype,"visualVariableColor",void 0),(0,i._)([(0,n.uK)(d.i)],w.prototype,"visualVariableOpacity",void 0),(0,i._)([(0,n.uK)(f.n)],w.prototype,"visualVariableSizeMinMaxValue",void 0),(0,i._)([(0,n.uK)(p.F)],w.prototype,"visualVariableSizeScaleStops",void 0),(0,i._)([(0,n.uK)(m.N)],w.prototype,"visualVariableSizeStops",void 0),(0,i._)([(0,n.uK)(_.d)],w.prototype,"visualVariableSizeUnitValue",void 0);class v extends w{vertex(e,t){return b(this,e,t)}fragment(e){const{color:t,isOutline:r}=e,i=(0,s.MM)(r,new s.nt(.5)),n=(0,c.o7)(e,this.antialiasingControls.blur),o=(0,s.Tk)(i,n,t),a=(0,s.Tk)(i,new s.nt(1/255),new s.nt(0));return this.getFragmentOutput(o,e,a)}hittest(e,t,r){return(0,s.Tk)(r,(0,l.My)(this.hittestRequest),(0,l.Lq)(this,e,t))}}(0,i._)([(0,i.a)(0,(0,n.hF)(y)),(0,i.a)(1,(0,n.hF)(o.$Z))],v.prototype,"vertex",null),(0,i._)([(0,i.a)(0,(0,n.hF)(x))],v.prototype,"fragment",null)},51741:function(e,t,r){r.d(t,{_u:function(){return d},dW:function(){return f},vx:function(){return p}});var i=r(53804),n=r(98282),s=r(70931),o=r(33702),a=r(42203),l=r(31299),c=r(39979);class u extends a._{}(0,i._)([(0,n.C5)(5,s.Zb)],u.prototype,"tlbr",void 0),(0,i._)([(0,n.C5)(6,s.nt)],u.prototype,"inverseRasterizationScale",void 0);class h extends o.DM{}function d(e,t){const r=t.tlbr.xy,i=t.tlbr.zw,n=i.x.subtract(r.x),o=r.y.subtract(i.y),a=new s.ZY(n,o).multiply(t.inverseRasterizationScale),l=a.multiply(e.view.requiredZoomFactor),c=function(e){const t=new s.nt(1),r=new s.nt(0);return new s.U(t.divide(e.x),r.divide(e.y),0,(0,s.ze)(r.divide(e.x)),t.divide(e.y),0,0,0,1)}(l),u=e.localTileOffset.getPatternOffsetAtTileOrigin(a).divide(l),h=new s.eB(t.pos,1);return{tileTextureCoord:c.multiply(h).xy.subtract(u),tlbr:t.tlbr.divide(e.mosaicInfo.size.xyxy)}}function f(e,t){const r=(0,s.zi)(e.tileTextureCoord,new s.nt(1)),i=(0,s.jh)(e.tlbr.xy,e.tlbr.zw,r),n=(0,s.US)(t.texture,i);return e.color.multiply(n)}class p extends a.z{vertex(e,t){return{...super.vertex(e,t),...d(this,e)}}fragment(e){const t=f(e,this.mosaicInfo);return this.getFragmentOutput(t,e,new s.nt(0))}}(0,i._)([(0,n.Pi)(c.b)],p.prototype,"mosaicInfo",void 0),(0,i._)([(0,n.Pi)(l.P)],p.prototype,"localTileOffset",void 0),(0,i._)([(0,i.a)(0,(0,n.hF)(u)),(0,i.a)(1,(0,n.hF)(o.$Z))],p.prototype,"vertex",null),(0,i._)([(0,i.a)(0,(0,n.hF)(h))],p.prototype,"fragment",null)},15087:function(e,t,r){r.d(t,{A1:function(){return f},tA:function(){return p}});var i=r(53804),n=r(98282),s=r(70931),o=r(33702),a=r(59224),l=r(31299),c=r(39979),u=r(54537),h=r(51741);class d extends u.wG{}(0,i._)([(0,n.C5)(9,s.Zb)],d.prototype,"tlbr",void 0),(0,i._)([(0,n.C5)(10,s.nt)],d.prototype,"inverseRasterizationScale",void 0);class f extends u.A7{}class p extends u.nj{vertex(e,t){return{...(0,u.Yb)(this,e,t),...(0,h._u)(this,e)}}fragment(e){const{isOutline:t}=e,r=(0,s.MM)(t,new s.nt(.5)),i=(0,a.o7)(e,this.antialiasingControls.blur),n=(0,h.dW)(e,this.mosaicInfo),o=(0,s.Tk)(r,i,n),l=(0,s.Tk)(r,new s.nt(1/255),new s.nt(0));return this.getFragmentOutput(o,e,l)}}(0,i._)([(0,n.Pi)(c.b)],p.prototype,"mosaicInfo",void 0),(0,i._)([(0,n.Pi)(l.P)],p.prototype,"localTileOffset",void 0),(0,i._)([(0,i.a)(0,(0,n.hF)(d)),(0,i.a)(1,(0,n.hF)(o.$Z))],p.prototype,"vertex",null),(0,i._)([(0,i.a)(0,(0,n.hF)(f))],p.prototype,"fragment",null)},64522:function(e,t,r){r.d(t,{o:function(){return o}});var i=r(53804),n=r(98282),s=r(70931);class o extends n.k2{}(0,i._)([(0,n.Pi)(s.U)],o.prototype,"displayViewScreenMat3",void 0),(0,i._)([(0,n.Pi)(s.U)],o.prototype,"displayViewMat3",void 0),(0,i._)([(0,n.Pi)(s.U)],o.prototype,"displayMat3",void 0),(0,i._)([(0,n.Pi)(s.U)],o.prototype,"viewMat3",void 0),(0,i._)([(0,n.Pi)(s.U)],o.prototype,"tileMat3",void 0),(0,i._)([(0,n.Pi)(s.nt)],o.prototype,"displayZoomFactor",void 0),(0,i._)([(0,n.Pi)(s.nt)],o.prototype,"requiredZoomFactor",void 0),(0,i._)([(0,n.Pi)(s.ZY)],o.prototype,"tileOffset",void 0),(0,i._)([(0,n.Pi)(s.nt)],o.prototype,"currentScale",void 0),(0,i._)([(0,n.Pi)(s.nt)],o.prototype,"currentZoom",void 0),(0,i._)([(0,n.Pi)(s.nt)],o.prototype,"metersPerSRUnit",void 0),(0,i._)([(0,n.Pi)(s.nt)],o.prototype,"rotation",void 0),(0,i._)([(0,n.Pi)(s.nt)],o.prototype,"pixelRatio",void 0)},81432:function(e,t,r){r.d(t,{_:function(){return a}});var i=r(53804),n=r(98282),s=r(70931),o=r(86486);class a extends n.k2{getColor(e,t,r){return(0,s.j1)([(0,s.or)((0,o.M8)(e),r),t],[(0,s.$5)(e,this.values.first()),this.colors.first()],[(0,s.aX)(e,this.values.last()),this.colors.last()],[!0,()=>{const t=this.values.findIndex((t=>(0,s.MM)(t,e))),r=this.values.get(t),i=t.subtract(1),n=this.values.get(i),o=e.subtract(n).divide(r.subtract(n));return(0,s.jh)(this.colors.get(i),this.colors.get(t),o)}])}}(0,i._)([(0,n.Pi)(s.My.ofType(s.Zb,8))],a.prototype,"colors",void 0),(0,i._)([(0,n.Pi)(s.My.ofType(s.nt,8))],a.prototype,"values",void 0)},12026:function(e,t,r){r.d(t,{i:function(){return a}});var i=r(53804),n=r(98282),s=r(70931),o=r(86486);class a extends n.k2{getOpacity(e){return(0,s.j1)([(0,o.M8)(e),new s.nt(1)],[(0,s.$5)(e,this.opacityValues.first()),this.opacities.first()],[(0,s.aX)(e,this.opacityValues.last()),this.opacities.last()],[!0,()=>{const t=this.opacityValues.findIndex((t=>(0,s.MM)(t,e))),r=this.opacityValues.get(t),i=t.subtract(1),n=this.opacityValues.get(i),o=e.subtract(n).divide(r.subtract(n));return(0,s.jh)(this.opacities.get(i),this.opacities.get(t),o)}])}}(0,i._)([(0,n.Pi)(s.My.ofType(s.nt,8))],a.prototype,"opacities",void 0),(0,i._)([(0,n.Pi)(s.My.ofType(s.nt,8))],a.prototype,"opacityValues",void 0)},13635:function(e,t,r){r.d(t,{n:function(){return a}});var i=r(53804),n=r(98282),s=r(70931),o=r(86486);class a extends n.k2{getSize(e,t){const r=this.minMaxValueAndSize.xy,i=this.minMaxValueAndSize.zw;return(0,s.Tk)((0,o.M8)(e),t,(()=>{const t=e.subtract(r.x).divide(r.y.subtract(r.x)),n=(0,s.qE)(t,new s.nt(0),new s.nt(1));return i.x.add(n.multiply(i.y.subtract(i.x)))}))}}(0,i._)([(0,n.Pi)(s.Zb)],a.prototype,"minMaxValueAndSize",void 0)},21385:function(e,t,r){r.d(t,{F:function(){return o}});var i=r(53804),n=r(98282),s=r(70931);class o extends n.k2{getSizeForViewScale(e){return(0,s.j1)([(0,s.$5)(e,this.values.first()),this.sizes.first()],[(0,s.aX)(e,this.values.last()),this.sizes.last()],[!0,()=>{const t=this.values.findIndex((t=>(0,s.MM)(t,e))),r=this.values.get(t),i=t.subtract(1),n=this.values.get(i),o=e.subtract(n).divide(r.subtract(n));return(0,s.jh)(this.sizes.get(i),this.sizes.get(t),o)}])}}(0,i._)([(0,n.Pi)(s.My.ofType(s.nt,8))],o.prototype,"sizes",void 0),(0,i._)([(0,n.Pi)(s.My.ofType(s.nt,8))],o.prototype,"values",void 0)},21813:function(e,t,r){r.d(t,{N:function(){return a}});var i=r(53804),n=r(98282),s=r(70931),o=r(86486);class a extends n.k2{getSize(e,t){const r=(0,s.j1)([(0,o.M8)(e),t],[(0,s.$5)(e,this.values.first()),this.sizes.first()],[(0,s.aX)(e,this.values.last()),this.sizes.last()],[!0,()=>{const t=this.values.findIndex((t=>(0,s.MM)(t,e))),r=this.values.get(t),i=t.subtract(1),n=this.values.get(i),o=e.subtract(n).divide(r.subtract(n));return(0,s.jh)(this.sizes.get(i),this.sizes.get(t),o)}]);return(0,s.Tk)((0,o.M8)(r),t,r)}}(0,i._)([(0,n.Pi)(s.My.ofType(s.nt,8))],a.prototype,"sizes",void 0),(0,i._)([(0,n.Pi)(s.My.ofType(s.nt,8))],a.prototype,"values",void 0)},76347:function(e,t,r){r.d(t,{d:function(){return a}});var i=r(53804),n=r(98282),s=r(70931),o=r(86486);class a extends n.k2{getSize(e,t){return(0,s.Tk)((0,o.M8)(e),t,e.multiply(this.unitValueToPixelsRatio))}}(0,i._)([(0,n.Pi)(s.nt)],a.prototype,"unitValueToPixelsRatio",void 0)},40846:function(e,t,r){var i;r.d(t,{$w:function(){return u},Fb:function(){return a},Fz:function(){return _},H_:function(){return i},J5:function(){return l},M:function(){return d},Ni:function(){return h},V5:function(){return o},Xx:function(){return m},YV:function(){return w},au:function(){return c},b5:function(){return y},bg:function(){return x},cn:function(){return p},eo:function(){return v},kx:function(){return g},os:function(){return n},qM:function(){return f},rp:function(){return s},ti:function(){return b}}),function(e){e[e.Geographic=0]="Geographic",e[e.Arithmatic=1]="Arithmatic"}(i||(i={}));const n=3.14159265359/180,s=3.14159265359/128,o=1,a=1.1,l=1,c=24,u=8,h=1e-5,d=.05,f=1e-30,p=4,m=0,_=2,g=2,y=3,x=0,b=3,w=16777216,v=1.1},66425:function(e,t,r){r.d(t,{Bo:function(){return u},Bs:function(){return l},E2:function(){return o},Lq:function(){return d},My:function(){return h},g$:function(){return f},kW:function(){return a}});var i=r(70931),n=r(40846),s=r(86486);function o(e,t,r){const n=r.subtract(t),s=(a=e.subtract(t),l=n,(0,i.Om)(a,(0,i.S8)(l))),o=(0,i.qE)(s.divide((0,i.Bw)(n)),new i.nt(0),new i.nt(1));var a,l;return(0,i.Io)(e,t.add(o.multiply(r.subtract(t))))}function a(e){const t=(0,i.tn)(e);return(0,i.PM)(t.x.add(t.y).add(t.z),new i.nt(1.05))}function l(e,t,r,n){const s=new i.U(r.x.multiply(n.y).subtract(n.x.multiply(r.y)),n.x.multiply(t.y).subtract(t.x.multiply(n.y)),t.x.multiply(r.y).subtract(r.x.multiply(t.y)),r.y.subtract(n.y),n.y.subtract(t.y),t.y.subtract(r.y),n.x.subtract(r.x),t.x.subtract(n.x),r.x.subtract(t.x)),o=t.x.multiply(r.y.subtract(n.y)),a=r.x.multiply(n.y.subtract(t.y)),l=n.x.multiply(t.y.subtract(r.y)),c=o.add(a).add(l);return new i.nt(1).divide(c).multiply(s.multiply(new i.eB(1,e)))}function c(e,t,r,n){return(0,i.LC)(a(l(e,t,r,n)),new i.nt(1))}function u(e,t,r,a){const l=r.subtract(t),u=a.subtract(t),h=(0,s.tL)(l,u),d=(0,i.Uo)((0,i.Xe)(h,new i.nt(n.M)),(0,i.MM)(h,new i.nt(-n.M)));return(0,i.j1)([(0,i.Uo)((0,i.AU)(d),c(e.xy,t,r,a)),new i.nt(-1)],[!0,()=>{const n=o(e,t,r),s=o(e,r,a),l=o(e,a,t);return(0,i.jk)((0,i.jk)(n,s),l)}])}function h(e){return e.distance.add(1)}function d(e,t,r){const{viewMat3:n,tileMat3:s}=e.view,o=n.multiply(s),a=o.multiply(new i.eB(t.pos,1)),l=o.multiply(new i.eB(r.nextPos1,1)),c=o.multiply(new i.eB(r.nextPos2,1));return u(e.hittestRequest.position,a.xy,l.xy,c.xy)}function f(e,t,r){return(0,i.Io)(e,r).subtract(t)}},86486:function(e,t,r){r.d(t,{K5:function(){return h},Kt:function(){return p},M8:function(){return a},Rj:function(){return m},_9:function(){return o},i6:function(){return d},mh:function(){return u},nb:function(){return c},p8:function(){return y},tL:function(){return l},xf:function(){return _},yS:function(){return f},zb:function(){return g},zy:function(){return x}});var i=r(39686),n=r(70931),s=r(40846);function o(e){const t=(0,n.fV)(12.9898),r=(0,n.fV)(78.233),i=(0,n.fV)(43758.5453),s=(0,n.Om)(e,(0,n.Zc)(t,r)),o=(0,n.zi)(s,(0,n.fV)(3.14));return(0,n.jc)((0,n.F8)(o).multiply(i))}function a(e){return(0,n.LC)(e,(0,n.fV)(s.qM))}function l(e,t){return e.x.multiply(t.y).subtract(t.x.multiply(e.y))}function c(e){return e.multiply(2).subtract(1)}function u(e,t){const r=(0,n.fV)(2**t);return(0,n.zi)((0,n.RI)(e.divide(r)),(0,n.fV)(2))}function h(e,t){return(0,n.MM)(u(e,t),(0,n.fV)(.5))}function d(e,t){return u(e,t+i.U5)}function f(e,t){return u(e,t)}function p(e){const t=u(e.z,7),r=(0,n.fV)(1).subtract(t),i=e.xyz.subtract((0,n.eR)(0,0,(0,n.fV)(128)));return r.multiply(e).add(t.multiply(i))}function m(e){const t=(0,n.ln)(255/256,255/65536,255/16777216,255/4294967296);return(0,n.Om)(e,t)}function _(e){return(0,n.T9)((0,n.T9)((0,n.T9)(e.x,e.y),e.z),e.w)}function g(e){return new n.nt(1).subtract(e)}function y(e){return e.subtract(new n.nt(1))}function x(e,t){return e.subtract(new n.nt(t))}},90906:function(e,t,r){r.d(t,{G5:function(){return n},G7:function(){return o},Mg:function(){return s},TL:function(){return l},cF:function(){return a},g_:function(){return c}});var i=r(70931);function n(e){return null!=e.visualVariableSizeMinMaxValue||null!=e.visualVariableSizeScaleStops||null!=e.visualVariableSizeStops||null!=e.visualVariableSizeUnitValue}function s(e,t,r){if(n(e)){const i=e.storage.getSizeValue(t);return e.visualVariableSizeMinMaxValue?.getSize(i,r)??e.visualVariableSizeScaleStops?.getSizeForViewScale(e.view.currentScale)??e.visualVariableSizeStops?.getSize(i,r)??e.visualVariableSizeUnitValue?.getSize(i,r)}return r}function o(e,t,r,n=new i.x(!1)){if(null==e.visualVariableColor)return r;const s=e.storage.getColorValue(t);return e.visualVariableColor.getColor(s,r,n)}function a(e,t){if(null==e.visualVariableOpacity)return new i.nt(1);const r=e.storage.getOpacityValue(t);return e.visualVariableOpacity.getOpacity(r)}function l(e,t){if(null==e.visualVariableRotation)return i.U.identity();const r=e.storage.getRotationValue(t);return e.visualVariableRotation.getVVRotationMat3(r)}function c(e,t){if(null==e.visualVariableRotation)return new i.nt(0);const r=e.storage.getRotationValue(t);return e.visualVariableRotation.getNormalizedAngle(r)}},53972:function(e,t,r){r.d(t,{G8:function(){return C},GJ:function(){return g}});var i=r(15774),n=r(13520),s=r(33134),o=r(84646),a=r(96564),l=r(39686),c=r(17469),u=r(54417),h=r(68758),d=r(54601),f=r(40846),p=r(7590);class m{constructor(e){const{offsetX:t,offsetY:r,postAngle:i,fontSize:n,haloSize:s,outlineSize:o,scaleFactor:a,transforms:l}=e;if(this.offsetX=t,this.offsetY=r,this.postAngle=i,this.fontSize=Math.min(n,96),this.haloSize=s??0,this.outlineSize=o??0,this.transforms=l,l&&l.infos.length>1){const e=(0,p.zb)(n,i,!1,t,r,l,!1);this.fontSize=Math.min(e.size,96);const s=e.size/n;this.haloSize*=s,this.outlineSize*=s,this.postAngle=e.rotation,this.offsetX=e.offsetX,this.offsetY=e.offsetY}a&&(this.fontSize*=a,this.offsetX*=a,this.offsetY*=a)}}var _=r(85456);const g=28,y=[4,4],x=[16,4],b={topLeft:x,topRight:x,bottomLeft:x,bottomRight:x},w=[4,2],v=[4,6],S={topLeft:w,topRight:w,bottomLeft:v,bottomRight:v},T={topLeft:w,topRight:v,bottomLeft:w,bottomRight:v},I={topLeft:v,topRight:v,bottomLeft:y,bottomRight:y},M={topLeft:y,topRight:y,bottomLeft:v,bottomRight:v},A={topLeft:v,topRight:y,bottomLeft:v,bottomRight:y},E={topLeft:y,topRight:v,bottomLeft:y,bottomRight:v},P={createComputedParams:e=>e,optionalAttributes:{zoomRange:{type:_.pe.UNSIGNED_SHORT,count:2,packPrecisionFactor:l.fq,packTessellation:({minZoom:e,maxZoom:t})=>[e||0,t||g]},clipAngle:{type:_.pe.UNSIGNED_BYTE,count:1,packTessellation:({clipAngle:e})=>R(e||0)},referenceSymbol:{type:_.pe.BYTE,count:4,packPrecisionFactor:1,packTessellation:(e,t)=>{const r=e.isLineLabel||!e.referenceBounds,i=(0,a.iT)(r?"center":t.horizontalAlignment),s=(0,a.Dy)(r?"middle":t.verticalAlignment),{offsetX:o,offsetY:l,size:c}=r?{offsetX:0,offsetY:0,size:0}:e.referenceBounds;return[(0,n.Lz)(o),-(0,n.Lz)(l),Math.round((0,n.Lz)(c)),i+1<<2|s+1]}}},attributes:{pos:{type:_.pe.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:_.pe.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:_.pe.UNSIGNED_BYTE,count:1,packTessellation:({isBackground:e,mapAligned:t})=>(0,u.xo)([[f.bg,e],[f.ti,!!t]])},offset:{type:_.pe.SHORT,count:2,packPrecisionFactor:8,packAlternating:{count:4,packTessellation:({offsets:e})=>{const{bottomLeft:t,bottomRight:r,topLeft:i,topRight:n}=e;return[i,n,t,r]}}},textureUV:{type:_.pe.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,packTessellation:({texcoords:e})=>{const{bottomLeft:t,bottomRight:r,topLeft:i,topRight:n}=e;return[i,n,t,r]}}},color:{type:_.pe.UNSIGNED_BYTE,count:4,normalized:!0,packTessellation:({color:e})=>e},fontSize:{type:_.pe.UNSIGNED_SHORT,count:1,packPrecisionFactor:4,packTessellation:({fontSize:e})=>Math.round((0,n.Lz)(e))},referenceSize:{type:_.pe.UNSIGNED_BYTE,count:1,packPrecisionFactor:4,packTessellation:({fontSize:e},{referenceSize:t})=>Math.round((0,n.Lz)(t??e))},outlineColor:{type:_.pe.UNSIGNED_BYTE,count:4,normalized:!0,pack:({outlineColor:e})=>(0,u.Jb)(e)},haloColor:{type:_.pe.UNSIGNED_BYTE,count:4,normalized:!0,pack:({haloColor:e})=>(0,u.Jb)(e)},outlineAndHaloSize:{type:_.pe.UNSIGNED_SHORT,count:2,packPrecisionFactor:4,packTessellation:({outlineSize:e,haloSize:t})=>[Math.round((0,n.Lz)(e)),Math.round((0,n.Lz)(t))]}}};class C extends d.r{constructor(){super(...arguments),this.vertexSpec=P,this._textMeshParamsPropsInitialized=!1}ensurePacked(e,t,r){super.ensurePacked(e,t,r),this._textMeshParamsPropsInitialized&&!this._evaluator.hasDynamicProperties||(this._textMeshTransformProps=new m(this.evaluatedMeshParams),this._textMeshParamsPropsInitialized=!0)}_write(e,t,r){const i=this._getShaping();if(!i)return;const n=t.getDisplayId();if(null!=this.evaluatedMeshParams.placement)return this._writePlacedTextMarkers(e,t,i,r);if(r?.nextPath())return r.nextPoint(),this._writeGlyphs(e,n,r.x,r.y,i,0);if("esriGeometryPolygon"===t.geometryType){const r=t.readCentroidForDisplay();if(!r)return;const[s,o]=r.coords;return this._writeGlyphs(e,n,s,o,i,0)}if("esriGeometryMultipoint"===t.geometryType){const r=t.readGeometryForDisplay();return void r?.forEachVertex(((t,r)=>this._writeGlyphs(e,n,t,r,i,0)))}const s=t.readXForDisplay(),o=t.readYForDisplay();return this._writeGlyphs(e,n,s,o,i,0)}_writePlacedTextMarkers(e,t,r,i){const a=i??s.z.fromFeatureSetReaderCIM(t);if(!a)return;const l=o.l.getPlacement(a,-1,this.evaluatedMeshParams.placement,(0,n.Lz)(1),e.id,(0,h.z)());if(!l)return;const c=t.getDisplayId();let u=l.next();for(;null!=u;){const t=u.tx,i=-u.ty,n=-u.getAngle();this._writeGlyphs(e,c,t,i,r,n),u=l.next()}}_getShaping(e){const t=this._textMeshTransformProps,r=this.evaluatedMeshParams;if(!r.glyphs?.glyphs.length)return null;const s=(0,n.Lz)(t.fontSize),o=(0,n.Lz)(t.offsetX),a=(0,n.Lz)(t.offsetY),u=(0,i.qE)((0,n.Lz)(r.lineWidth),l.GR,l.cp),h=l.DY*(0,i.qE)(r.lineHeightRatio,.25,4);return(0,c.Tl)(r.glyphs,{scale:s/l.eG,angle:t.postAngle,xOffset:o,yOffset:a,horizontalAlignment:r.horizontalAlignment,verticalAlignment:e||r.verticalAlignment,maxLineWidth:u,lineHeight:h,decoration:r.decoration,borderLineSizePx:(0,n.Lz)(r.boxBorderLineSize),hasBackground:!!r.boxBackgroundColor,useCIMAngleBehavior:r.useCIMAngleBehavior})}_writeGlyphs(e,t,r,i,s,o,a,l){const c=this.evaluatedMeshParams,h=this._textMeshTransformProps,d=(0,n.Lz)(h.fontSize),f=h.haloSize,p=h.outlineSize,m=(0,n.Lz)(h.offsetX),_=(0,n.Lz)(h.offsetY),[g,y]=(0,u.My)(c.scaleInfo,this.getTileInfo());0!==o&&s.setRotation(o);const x=s.bounds,b=r+x.x+m,w=i+x.y-_,v=2*(c.minPixelBuffer?c.minPixelBuffer/d:1),S=Math.max(x.width,x.height)*v;s.textBox&&(e.recordStart(this.instanceId,this.attributeLayout,s.glyphs[0].textureBinding),e.recordBounds(b,w,S,S),this._writeTextBox(e,t,r,i,s.textBox,a,l),e.recordEnd());for(const n of s.glyphs){e.recordStart(this.instanceId,this.attributeLayout,n.textureBinding),e.recordBounds(b,w,S,S);const{texcoords:s,offsets:o}=n;this._writeQuad(e,t,r,i,{texcoords:s,offsets:o,fontSize:d,haloSize:f,outlineSize:p,color:(0,u.Jb)(c.color),isBackground:!1,referenceBounds:a,minZoom:g,maxZoom:y,...l}),e.recordEnd()}0!==o&&s.setRotation(-o)}_writeTextBox(e,t,r,i,n,s,o){const a=this.evaluatedMeshParams,{fontSize:l,haloSize:c,outlineSize:h}=this._textMeshTransformProps,{boxBackgroundColor:d,boxBorderLineColor:f}=a,p={isBackground:!0,fontSize:l,haloSize:c,outlineSize:h,referenceBounds:s,...o};d&&(this._writeQuad(e,t,r,i,{texcoords:b,offsets:n.main,color:(0,u.Jb)(d),...p}),f||(this._writeQuad(e,t,r,i,{texcoords:I,offsets:n.top,color:(0,u.Jb)(d),...p}),this._writeQuad(e,t,r,i,{texcoords:M,offsets:n.bot,color:(0,u.Jb)(d),...p}),this._writeQuad(e,t,r,i,{texcoords:A,offsets:n.left,color:(0,u.Jb)(d),...p}),this._writeQuad(e,t,r,i,{texcoords:E,offsets:n.right,color:(0,u.Jb)(d),...p}))),f&&(this._writeQuad(e,t,r,i,{texcoords:S,offsets:n.top,color:(0,u.Jb)(f),...p}),this._writeQuad(e,t,r,i,{texcoords:S,offsets:n.bot,color:(0,u.Jb)(f),...p}),this._writeQuad(e,t,r,i,{texcoords:T,offsets:n.left,color:(0,u.Jb)(f),...p}),this._writeQuad(e,t,r,i,{texcoords:T,offsets:n.right,color:(0,u.Jb)(f),...p}))}_writeQuad(e,t,r,i,n){const s=e.vertexCount();this._writeVertex(e,t,r,i,n),e.indexWrite(s+0),e.indexWrite(s+1),e.indexWrite(s+2),e.indexWrite(s+1),e.indexWrite(s+3),e.indexWrite(s+2)}}const R=e=>Math.round(e*(254/360))},22516:function(e,t,r){r.d(t,{K:function(){return c}});var i=r(39819),n=r(40633),s=r(34194),o=(r(13798),r(58941),r(41835),r(85456),r(96402),r(95904)),a=(r(69452),r(12285),r(88413));function l(e,t,r){const s=t.length;if(s!==r){const o=new i.A("Invalid Uniform",`Invalid length, expected ${r} but got ${s}`,{uniformName:e,values:t});n.A.getLogger("esri.views.2d.engine.webgl.shaderGraph.typed.TypedShaderProgram").errorOnce(o)}}class c{constructor(e,t,r,i,n,s){this._program=null,this._vao=null,this._temporaryTextures=[],this.vertexShader=e,this.fragmentShader=t,this._locations=r,this._locationInfo=i,this._uniformBindings=n,this._transformFeedbackBindings=s}destroy(){this._program&&this._program.dispose(),this.cleanupTemporaryTextures()}get locations(){return this._locations}get locationInfo(){return this._locationInfo}setUniforms(e){this._uniforms=e}cleanupTemporaryTextures(){for(const e of this._temporaryTextures)e.dispose();this._temporaryTextures=[]}bind(e){const t=this._uniforms;if(!this._program){const t=new Map;for(const[e,r]of this._locations)t.set(e,r);const r=[];for(const e of this._transformFeedbackBindings??[]){const{index:t,propertyKey:i}=e;r[t]=`v_${i}`}this._program=new o.B(e,this.vertexShader,this.fragmentShader,t,new Map,r)}const r=this._program;e.useProgram(r);for(const i of this._uniformBindings){const{shaderModulePath:n,uniformName:o,uniformType:c,uniformArrayLength:u}=i,h=(0,s.wc)(n,t);if(null==h){if("sampler2D"===c)continue;throw new Error(`Failed to find uniform value for ${n}`)}switch("array"===c?i.uniformArrayElementType:c){case"sampler2D":{const{unit:t,texture:i}=h;if(r.setUniform1i(o,t),"type"in i)e.bindTexture(i,t);else{const r=(0,a.sZ)(e,i.descriptor,i.data);e.bindTexture(r,t)}break}case"int":if(!u){r.setUniform1i(o,h);break}l(i.uniformName,h,u),r.setUniform1iv(o,h);break;case"float":if(!u){r.setUniform1f(o,h);break}l(i.uniformName,h,u),r.setUniform1fv(o,h);break;case"vec2":if(!u){r.setUniform2f(o,h[0],h[1]);break}l(i.uniformName,h,u),r.setUniform2fv(o,h.flat());break;case"vec3":if(!u){r.setUniform3f(o,h[0],h[1],h[2]);break}l(i.uniformName,h,u),r.setUniform3fv(o,h.flat());break;case"vec4":if(!u){r.setUniform4f(o,h[0],h[1],h[2],h[3]);break}l(i.uniformName,h,u),r.setUniform4fv(o,h.flat());break;case"mat3":r.setUniformMatrix3fv(o,h);break;case"mat4":r.setUniformMatrix4fv(o,h);break;default:throw new Error(`Unable to set uniform for type ${c}`)}}}}},24964:function(e,t,r){function i(e,t){if(null!==t){e.push(t.length);for(const r of t)r.serialize(e);return e}e.push(0)}function n(e,t,r){const i=e.readInt32(),n=new Array(i);for(let i=0;i<n.length;i++)n[i]=t.deserialize(e,r);return n}r.d(t,{_:function(){return n},j:function(){return i}})},25423:function(e,t,r){r.r(t),r.d(t,{default:function(){return Jr}});var i=r(39819),n=r(61226),s=r(58941),o=r(29601),a=r(60539),l=r(13798),c=r(28181),u=r(13520),h=r(64272),d=r(76226),f=r(54608),p=r(36008),m=(r(38648),r(82563),r(39686));class _{constructor(e){this._client=e,this.layerView=this._client.createInvokeProxy(""),this.container=this._client.createInvokeProxy("container"),this._eventLog=this._client.createInvokeProxy("eventLog")}onEvent(e){(0,h.oV)(this._eventLog.onEvent(e))}}var g=r(95929),y=r(34194),x=r(72952),b=r(57165),w=r(80308);function v(e){switch(e){case 1:case 8:case 32:return-1;case 2:case 64:return 0;case 4:case 16:case 128:return 1}}function S(e){switch(e){case 1:case 2:case 4:return-1;case 8:case 16:return 0;case 32:case 64:case 128:return 1}}class T{constructor(e,t,r,i,n=0){this.tileKey=e,this._bufferingEnabled=t,this._sizeHint=n,this._meshes={self:new w.U(this.id,this._sizeHint),neighbors:new Array},this._currentRecordOverlaps=0,this._currentEntityOverlaps=0;const s=i?1:0;this._copyBufferedDataIntoSelf=r&&this._bufferingEnabled&&e.level===s}get id(){return this.tileKey.id}vertexCount(){return this._meshes.self.vertexCount()}indexCount(){return this._meshes.self.indexCount()}indexEnsureSize(e){this._meshes.self.indexEnsureSize(e)}entityStart(e,t=e){this._currentEntityOverlaps=0,this._meshes.self.entityStart(e,t)}entityRecordCount(){return this._meshes.self.entityRecordCount()}entityEnd(){if(this._meshes.self.entityEnd(),this._bufferingEnabled){if(this._copyBufferedDataIntoSelf)return;for(let e=0;e<8;e++){const t=1<<e;this._currentEntityOverlaps&t&&this._meshes.neighbors[e].entityEnd()}}}recordStart(e,t,r){this._currentRecordOverlaps=0,this._meshes.self.recordStart(e,t,r)}recordEnd(e=0){const t=this._meshes.self.recordEnd(this._currentRecordOverlaps);return t&&0!==this._currentRecordOverlaps?(this._copyIntoNeighbors(),this._currentEntityOverlaps|=this._currentRecordOverlaps,!0):t}recordBounds(e,t,r,i){this._bufferingEnabled&&this._addOverlap(e,t,r,i)}recordCount(){return this._meshes.self.recordCount()}metricStart(e){this._meshes.self.metricStart(e)}metricBoxWrite(e){this._meshes.self.metricBoxWrite(e)}metricEnd(){this._meshes.self.metricEnd()}vertexWrite(e){this._meshes.self.vertexWrite(e)}vertexWriteF32(e){this._meshes.self.vertexWriteF32(e)}vertexWriteRegion(e){this._meshes.self.vertexWriteRegion(e)}indexWrite(e){this._meshes.self.indexWrite(e)}serialize(e){const t={message:[],transferList:[]},r=this._meshes.self.serialize();return t.message.push({tileId:this.tileKey.id,...r.message}),t.transferList.push(...r.transferList),this._meshes.neighbors.forEach(((r,i)=>{const n=r.serialize(),s=1<<i,o=v(s),a=S(s),l=new p.A(this.tileKey).getNormalizedNeighbor(o,a,e);t.message.push({tileId:l.id,...n.message}),t.transferList.push(...n.transferList)})),t}_addOverlap(e,t,r,i){const n=Math.min(m.CQ/2,r),s=Math.min(m.CQ/2,i),o=255^((e<0+n?148:e>=m.CQ-n?41:189)|(t<0+s?224:t>=m.CQ-s?7:231));this._currentRecordOverlaps|=o}_copyIntoNeighbors(){for(let e=0;e<8;e++){const t=1<<e;if(this._currentRecordOverlaps&t){if(this._copyBufferedDataIntoSelf){const e=-v(t)*m.CQ,r=-S(t)*m.CQ;if(0!==r)continue;this._meshes.self.copyLast(e,r);continue}if(!this._meshes.neighbors[e]){const r=Math.floor(this._sizeHint/16);this._meshes.neighbors[e]=new w.U(t,r)}const r=this._meshes.neighbors[e],i=-v(t)*m.CQ,n=-S(t)*m.CQ;r.copyLastFrom(this._meshes.self,i,n)}}}}class I{}class M{constructor(){this._defaultResult=null,this._backgroundFillResult=null}static async from(e,t){const r=new M;return r.setDefault(await e.createMeshWriters(t.meshes)),r}size(){return 1}getDefault(){return this._defaultResult}setDefault(e){this._defaultResult=e}getBackgroundFill(){return this._backgroundFillResult}setBackgroundFill(e){this._backgroundFillResult=e}match(e,t){const r=this.doMatch(e,t)||this.getDefault();if(r&&r.length>0){const e=this.getBackgroundFill();if(e)return[...e,...r]}return r}getSortKey(e,t){return 0}doMatch(e,t){return null}async fetchResources(e,t){}}class A extends M{static async fromDictionaryRenderer(e,t){return new A(e,t)}constructor(e,t){super(),this._context=e,this._schema=t,this._hashToGroup=new Map}get fieldMap(){return this._schema.fieldMap}async fetchResources(e,t){const r=t.getCursor(),i=[];for(;r.next();)i.push(this._updateMeshWriterGroup(e,r));await Promise.all(i)}match(e,t){const r=e.getAttributeHash();return this._hashToGroup.get(r)}async _updateMeshWriterGroup(e,t){const r=t.readLegacyFeatureForDisplay(),i=t.getAttributeHash();if(this._hashToGroup.has(i))return;this._hashToGroup.set(i,null);const n=await e.fetchDictionaryResourceImmediate({type:"dictionary-request",feature:r});if(!n)return;const s=await this._context.createMeshWriters(n.meshes);this._hashToGroup.set(i,s)}}class E extends M{constructor(e,t){super(),this._intervals=[],this._isMaxInclusive=t,this._field=e}static async fromIntervalSchema(e,t){const r=await e.storage.createComputedField(t),i=new E(r,t.isMaxInclusive);await Promise.all(t.intervals.map((async t=>{const r=await e.createMeshWriters(t.meshes);i.add(t,r)})));const n=await e.createMeshWriters(t.defaultSymbol);i.setDefault(n);const s=await e.createMeshWriters(t.backgroundFill);return i.setBackgroundFill(s),i}add(e,t){this._intervals.push({interval:e,result:t}),this._intervals.sort(((e,t)=>e.interval.min-t.interval.min))}size(){return super.size()+this._intervals.length}doMatch(e,t){const r=this._field?.read(e,t);if(null==r||isNaN(r)||r===1/0||r===-1/0)return null;for(let e=0;e<this._intervals.length;e++){const{interval:t,result:i}=this._intervals[e],n=r>=t.min,s=this._isMaxInclusive?r<=t.max:r<t.max;if(n&&s)return i}return null}}class P extends M{static async fromLabelSchema(e,t){const r=t.classes.map((async t=>{const r=await e.createMeshWriters(t.meshes);return{minScale:t.minScale,maxScale:t.maxScale,meshes:r,expression:null,where:await e.storage.createWhereClause(t.where)}})),i=await Promise.all(r);return new P(i)}constructor(e){super(),this._labels=e}match(e,t){if(!this._labels.length)return null;const r=this._getLabels(t.$view.scale),i=[];for(const t of r)t.where&&!t.where(e)||i.push(...t.meshes);return i}_getLabels(e){return this._labels.filter((t=>this._validForTileScale(t,e)))}_validForTileScale(e,t){const r=t-t/4,i=t+t/2;return(!e.minScale||e.minScale>=r)&&(!e.maxScale||e.maxScale<=i)}}class C extends M{constructor(e,t){super(),this._defaultSymbolSortKey=0,this._nullResult=null,this._resultsMap=new Map,this._fields=[],this._fields=e,this._separator=t||""}static async fromMatcherSchema(e,t){const r=t.expression?[e.storage.createComputedField({expression:t.expression})]:[t.field?e.storage.createComputedField({field:t.field}):null,t.field2?e.storage.createComputedField({field:t.field2}):null,t.field3?e.storage.createComputedField({field:t.field3}):null],i=(await Promise.all(r)).filter((e=>!!e)),n=new C(i,t.fieldDelimiter),s=await e.createMeshWriters(t.defaultSymbol);n.setDefault(s);const o=await e.createMeshWriters(t.backgroundFill);return n.setBackgroundFill(o),await Promise.all(t.map.map((async(t,r)=>{const i=await e.createMeshWriters(t.symbol);"<Null>"===t.value?n.setNullResult(i):n.add(t.value,i,r+1)}))),n}setNullResult(e){this._nullResult=e}getSortKey(e,t){const r=this._getValueFromFields(e,t);if(null==r||""===r||"<Null>"===r)return 0;const i=this._resultsMap.get(r.toString());return i?i.sortKey:this._defaultSymbolSortKey}add(e,t,r){this._resultsMap.set(e.toString(),{meshWriters:t,sortKey:r}),this._defaultSymbolSortKey=Math.max(this._defaultSymbolSortKey,r+1)}size(){return super.size()+this._resultsMap.size}doMatch(e,t){const r=this._getValueFromFields(e,t);if(null!==this._nullResult&&(null==r||""===r||"<Null>"===r))return this._nullResult;if(null==r)return null;const i=r.toString();return this._resultsMap.get(i)?.meshWriters}_getValueFromFields(e,t){const r=[];for(const i of this._fields){const n=i.read(e,t);null==n||""===n?r.push("<Null>"):r.push(n)}return r.join(this._separator)}}async function R(e,t){switch(t.type){case"simple":case"heatmap":case"dot-density":case"pie-chart":return M.from(e,t);case"interval":return E.fromIntervalSchema(e,t);case"dictionary":return A.fromDictionaryRenderer(e,t);case"label":return P.fromLabelSchema(e,t);case"map":return C.fromMatcherSchema(e,t);case"subtype":return F.fromSubtypes(e,t);case"cluster":return L.fromClusterSchema(e,t);default:throw new Error("Impl")}}class F extends M{constructor(e,t){super(),this._subMatchers=e,this._subtypeField=t}static async fromSubtypes(e,t){const r=new Map,i=[];for(const n in t.renderers){const s=parseInt(n,10),o=R(e,t.renderers[n]).then((e=>r.set(s,e)));i.push(o)}return await Promise.all(i),new F(r,t.subtypeField)}match(e,t){const r=e.readAttribute(this._subtypeField),i=this._subMatchers.get(r);return i?i.match(e,t):null}}class L extends M{static async fromClusterSchema(e,t){const[r,i]=await Promise.all([R(e,t.feature),R(e,t.cluster)]);return new L(r,i)}constructor(e,t){super(),this._featureMatcher=e,this._clusterMatcher=t}match(e,t){return 1===e.readAttribute("cluster_count")?this._featureMatcher.match(e,t):this._clusterMatcher.match(e,t)}}class k extends I{static async create(e,t){const r=await R(e,t.symbology),i=t.labels?await R(e,t.labels):null;return new k(r,i)}constructor(e,t){super(),this._symbology=e,this._labels=t}destroy(){}async enqueueMatcherRequests(e,t){await Promise.all([this._symbology.fetchResources(e,t),this._labels?.fetchResources(e,t)])}enqueueWriterRequests(e,t,r){const i=this._symbology.match(t,r);if(i){for(const n of i)n.enqueueRequest(e,t,r);if(this._labels){const i=this._labels.match(t,r);if(!i)return;for(const n of i)n.enqueueRequest(e,t,r)}}}write(e,t,r,i,n){const s=this._symbology.match(r,i);if(s){for(const o of s)o.write(e,t,r,i,n);if(e.entityRecordCount()>=1&&this._labels){const o=this._labels.match(r,i);if(!o)return;for(const a of o)a.setReferences(s),a.write(e,t,r,i,n)}}}getSortKey(e,t){return this._symbology.getSortKey(e,t)}}var N=r(93561),O=r(99483);class D{constructor(e,t,r,i){this.storage=e,this.proxy=t,this.viewParams=r,this.registry=i}async createMeshWriters(e){const t=e.map((e=>this.registry.createMeshWriter(this.storage,this.proxy,this.viewParams,e)));return Promise.all(t)}}var z=r(46863);class U{constructor(e){this._outstandingMessages=[],this._queue=new z.e({concurrency:e.concurrency,process:t=>e.process(t)})}async push(e){if(e.end)return await Promise.all(this._outstandingMessages),await this._queue.push(e),void(this._outstandingMessages=[]);const t=this._queue.push(e);return this._outstandingMessages.push(t),t}}r(50917);var G=r(58081),B=r(65215),V=r(74841),q=r(7103),Z=r(37069);class H{static async create(e,t){if("count"===t.statisticType){const e=new Z.G(1);return new H(t.name,t.alias,t.type,t.statisticType,e)}const r=await e.createComputedField({expression:t.onStatisticExpression?.expression,field:t.onStatisticField});return new H(t.name,t.alias,t.type,t.statisticType,r)}constructor(e,t,r,i,n){this.name=e,this.alias=t,this.type=r,this.statisticType=i,this.computed=n}}var j=r(48996),W=r(24761),Y=r(46805),$=r(75707);class X{constructor(e){this.subscription=e,this.handledChunks=new Set}destroy(){}}class Q{constructor(e,t){this._source=e,this._attributeStore=t,this._sendStates=new Map}destroy(){}get enablePixelBuffering(){return!0}onSubscribe(e){const t=this.createState(e);this._sendStates.set(e.key.id,t),this.updateChunks()}onUnsubscribe(e){this._sendStates.get(e.key.id)?.destroy(),this._sendStates.delete(e.key.id)}invalidate(){const e=Array.from(this._sendStates.values());this._sendStates.clear();for(const t of e)t.destroy(),this.onSubscribe(t.subscription)}invalidateAttributeData(){}getFeatureObjectIdsForAggregate(e){throw new Error("InternalError: AggregateId lookup not supported")}getDisplayIds(e){return this.displayMap(e,(e=>e),(e=>e))}getDisplayAndObjectIds(e){return this.displayMap(e,(e=>e),((e,t,r)=>[e,r]))}beforeUpdateChunks(){}afterUpdateChunks(){}}class J extends Q{constructor(e,t,r,i){super(e,t),this.spatialReference=r,this.aggregateFields=i,this.events=new j.A,this.featureAdapter=Y.T}get aggregateQueryEngine(){return this._aggregateQueryEngine||(this._aggregateQueryEngine=new $.d({featureStore:this,fieldsIndex:this._metadata.fieldsIndex,geometryType:this._metadata.geometryType,objectIdField:this._metadata.objectIdField,spatialReference:this.spatialReference})),this._aggregateQueryEngine}removeChunks(e){}forEach(e){return this.forEachAggregateWorldSpace(e)}forEachInBounds(e,t){}forEachBounds(e,t){const r=(0,W.vt)();for(const i of e){const e=(0,G.jQ)(r,i.geometry,!1,!1);e&&t(e)}}}class K{constructor(e,t,r,i,n){this.subscription=e,this.reader=t,this.clear=r,this.end=i,this.debugInfo=n,this.type="append"}get id(){return this.subscription.tile.id}createMessage(e,t,r){return{type:"append",clear:this.clear,id:this.id,append:e,end:this.end,debugInfo:this.debugInfo,subscriptionVesrion:this.subscription.version,version:t,attributeEpoch:r}}}class ee{constructor(e,t,r,i,n){this.subscription=e,this.reader=t,this.remove=r,this.end=i,this.debugInfo=n,this.type="update"}get id(){return this.subscription.tile.id}createMessage(e,t,r){return{type:"update",id:this.id,modify:e,debugInfo:this.debugInfo,remove:this.remove,version:t,subscriptionVesrion:this.subscription.version,end:this.end,attributeEpoch:r}}}var te=r(78952);class re{static fromReader(e){const t=[],r=e.copy(),i=(0,W.vt)();for(;r.next();)r.getBounds(i)&&t.push(r.getIndex());const n=(0,te.r)(9,(e=>(r.setIndex(e),{minX:r.getBoundsXMin(),minY:r.getBoundsYMin(),maxX:r.getBoundsXMax(),maxY:r.getBoundsYMax()})));return n.load(t),new re(n)}constructor(e){this._index=e}search(e){const t={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]};return this._index.search(t)}}var ie=r(15774),ne=r(91484),se=r(44740),oe=r(43587),ae=r(76613);function le(e,t,r,i){if(i.isWebMercator){const i=(0,ie.KJ)(e/oe.$O.radius),n=i-360*Math.floor((i+180)/360),s=[0,0];return ce(s,0,(0,ie.KJ)(Math.PI/2-2*Math.atan(Math.exp(-t/oe.$O.radius))),n,r),s}const n=(0,V.Cv)({x:e,y:t},i,b.A.WGS84);if(!n)return null;const s=[0,0];return ce(s,0,n.y,n.x,r),s}function ce(e,t,r,i,n){n%2&&(n+=1);let s=0,o=0,a=-90,l=90,c=-180,u=180;for(let e=0;e<n/2;e++){for(let t=0;t<5;t++){const r=(c+u)/2,n=i>r?1:0;s|=n<<29-(t+5*e),c=(1-n)*c+n*r,u=(1-n)*r+n*u}for(let t=0;t<5;t++){const i=(a+l)/2,n=r>i?1:0;o|=n<<29-(t+5*e),a=(1-n)*a+n*i,l=(1-n)*i+n*l}}e[2*t]=s,e[2*t+1]=o}new Float64Array(2),new Float64Array(2);class ue{constructor(e){this._statistics=e}get statistics(){return this._statistics}}var he=r(89838);const de=Math.PI/180;class fe{static create(e){return new fe(e.map((e=>function(e){switch(e.statisticType){case"min":return new me(e);case"max":return new _e(e);case"avg":return new ye(e);case"avg_angle":return new xe(e);case"sum":case"count":return new ge(e);case"mode":return new be(e)}}(e))))}constructor(e){this._statistics=e}values(){return this._statistics.values()}insert(e,t){for(const r of this._statistics)r.insert(e,t)}merge(e){for(let t=0;t<this._statistics.length;t++){const r=this._statistics[t],i=e._statistics[t];if(r.field.name!==i.field.name)throw new Error("InternalError: Tried to merge incompatible statistics");r.merge(i)}}clone(){return new fe(this._statistics.map((e=>e.clone())))}}class pe{constructor(e){this.field=e}insert(e,t){if(!this.field.computed)return;const r=this.field.computed.read(e,t);(0,he.rZ)(r)||this._insertValue(r)}}class me extends pe{constructor(){super(...arguments),this.type="min",this.value=Number.MAX_VALUE}_insertValue(e){this.value=Math.min(this.value,e)}merge(e){this.value=Math.min(this.value,e.value)}clone(){const e=new me(this.field);return e.value=this.value,e}}class _e extends pe{constructor(){super(...arguments),this.type="max",this.value=Number.MIN_VALUE}_insertValue(e){this.value=Math.max(this.value,e)}merge(e){this.value=Math.max(this.value,e.value)}clone(){const e=new _e(this.field);return e.value=this.value,e}}class ge extends pe{constructor(){super(...arguments),this.type="sum",this.value=0}_insertValue(e){this.value+=e}merge(e){this.value+=e.value}clone(){const e=new ge(this.field);return e.value=this.value,e}}class ye extends pe{constructor(){super(...arguments),this.type="avg",this._total=0,this._count=0}get value(){return this._total/this._count}_insertValue(e){this._total+=e,this._count+=1}merge(e){this._total+=e._total,this._count+=e._count}clone(){const e=new ye(this.field);return e._total=this._total,e._count=this._count,e}}class xe extends pe{constructor(){super(...arguments),this.type="avg_angle",this._x=0,this._y=0,this._count=0}get value(){const e=this._x/this._count,t=this._y/this._count,r=180/Math.PI;return Math.atan2(t,e)*r}_insertValue(e){this._x=this._x+Math.cos(e*de),this._y=this._y+Math.sin(e*de),this._count+=1}merge(e){this._x+=e._x,this._y+=e._y,this._count+=e._count}clone(){const e=new xe(this.field);return e._x=this._x,e._y=this._y,e._count=this._count,e}}class be extends pe{constructor(){super(...arguments),this._frequencies=new Map}get value(){let e,t=0;for(const[r,i]of this._frequencies.entries())i>t&&(t=i,e=r);return e}_insertValue(e){const t=this._frequencies.get(e);null!=t?this._frequencies.set(e,t+1):this._frequencies.set(e,1)}merge(e){for(const[t,r]of e._frequencies.entries()){const e=this._frequencies.get(t);null!=e?this._frequencies.set(t,e+r):this._frequencies.set(t,r)}}clone(){const e=new be(this.field);return e._frequencies=new Map(this._frequencies),e}}class we extends ue{static create(e,t,r,i){const n=fe.create(e),s=new Array(32);for(let e=0;e<s.length;e++)s[e]=null;return new we(n,t,r,i,s)}constructor(e,t,r,i,n){super(e),this.xNode=t,this.yNode=r,this.depth=i,this.children=n,this._objectIds=new Set,this._count=0,this._xWorldTotal=0,this._yWorldTotal=0,this._xGeohashTotal=0,this._yGeohashTotal=0,this.next=null}get id(){return`${this.xNode}.${this.yNode}`}get containedObjectIds(){return this._objectIds}get count(){return this._count}clone(){const e=new we(this._statistics.clone(),this.xNode,this.yNode,this.depth,this.children);return e._count=this._count,e._xWorldTotal=this._xWorldTotal,e._yWorldTotal=this._yWorldTotal,e._xGeohashTotal=this._xGeohashTotal,e._yGeohashTotal=this._yGeohashTotal,e.next=this.next,e._objectIds=new Set(this._objectIds),e}insert(e,t,r,i,n,s){this._count+=1,this._xWorldTotal+=t,this._yWorldTotal+=r,this._xGeohashTotal+=i,this._yGeohashTotal+=n,this._statistics.insert(e,s),this._objectIds.add(e.getObjectId())}merge(e){if(0!==e._count){this._count+=e._count,this._xWorldTotal+=e._xWorldTotal,this._yWorldTotal+=e._yWorldTotal,this._xGeohashTotal+=e._xWorldTotal,this._yGeohashTotal+=e._yWorldTotal,this._statistics.merge(e._statistics);for(const t of e._objectIds.values())this._objectIds.add(t)}}getCentroid(e){throw new Error("getCentroid not supported for GeohashNode")}getGeometry(e,t){const r=this._getLngLatBounds(),[i,n,s,o]=r,a=(0,V.Cv)({rings:[[[i,n],[i,o],[s,o],[s,n],[i,n]]]},b.A.WGS84,e),l=(0,G.Ye)(new ae.A,a,!1,!1);return null!=t?(0,G.Nl)(new ae.A,l,!1,!1,"esriGeometryPolygon",t,!1,!1):l}getGeometricCentroid(e,t){const r=this._getLngLatBounds(),[i,n,s,o]=r,a=(0,V.Cv)({x:(i+s)/2,y:(n+o)/2},b.A.WGS84,e),l=(0,G.qN)(new ae.A,a);return null!=t?(0,G.Nl)(new ae.A,l,!1,!1,"esriGeometryPoint",t,!1,!1):l}getAttributes(){const e={aggregateId:this.id};for(const t of this._statistics.values())e[t.field.name]=t.value;return e.aggregateCount=this._count,e}find(e,t,r,i,n,s){if(i>=r)return this;const o=1-i%2,a=3*o+2*(1-o),l=2*o+3*(1-o),c=30-n-a,u=30-s-l,h=((e&7*o+3*(1-o)<<c)>>c)+((t&3*o+7*(1-o)<<u)>>u)*(8*o+4*(1-o)),d=this.children[h];return null==d?null:d.find(e,t,r,i+1,n+a,s+l)}_getLngLatBounds(){const e=this.depth,t=Math.ceil(e/2),r=Math.floor(e/2),i=30-(3*t+2*r),n=30-(2*t+3*r);return function(e,t){let r=-90,i=90,n=-180,s=180;for(let o=0;o<t;o++){const t=Math.ceil((o+1)/2),a=Math.floor((o+1)/2),l=1-o%2,c=30-(3*t+2*a),u=30-(2*t+3*a),h=2*l+3*(1-l),d=(7*l+3*(1-l)<<c&e.geohashX)>>c,f=(3*l+7*(1-l)<<u&e.geohashY)>>u;for(let e=3*l+2*(1-l)-1;e>=0;e--){const t=(n+s)/2,r=d&1<<e?1:0;n=(1-r)*n+r*t,s=(1-r)*t+r*s}for(let e=h-1;e>=0;e--){const t=(r+i)/2,n=f&1<<e?1:0;r=(1-n)*r+n*t,i=(1-n)*t+n*i}}return[n,r,s,i]}({geohashX:this.xNode<<i,geohashY:this.yNode<<n},this.depth)}}class ve{constructor(e){this._fields=e,this._size=0,this._depth=0,this._root=we.create(this._fields,0,0,0)}destroy(){}get size(){return this._size}get depth(){return this._depth}find(e,t,r){return this._root.find(e,t,r,0,0,0)}insert(e,t,r,i,n,s,o){let a=this._root,l=0,c=0,u=0;for(;null!==a;){if(a.insert(e,t,r,i,n,o),l>=s)return;const h=Math.ceil((l+1)/2),d=Math.floor((l+1)/2),f=1-l%2,p=30-(3*h+2*d),m=30-(2*h+3*d),_=(i&7*f+3*(1-f)<<p)>>p,g=(n&3*f+7*(1-f)<<m)>>m,y=_+g*(8*f+4*(1-f));c=c<<3*f+2*(1-f)|_,u=u<<2*f+3*(1-f)|g,null==a.children[y]&&(a.children[y]=we.create(this._fields,c,u,l+1),this._depth=Math.max(this._depth,l+1),this._size+=1),l+=1,a=a.children[y]}}putBins(e,t){for(const r of this.getNodes(t)){const t=e.get(r.id);t?t.merge(r):e.set(r.id,r.clone())}}getNodes(e){const t=[],{geohashBounds:r,level:i}=e;let n=this._root;for(;null!==n;){const e=n.depth,s=n.xNode,o=n.yNode;if(e>=i){t.push(n),n=n.next;continue}const a=Math.ceil((e+1)/2),l=Math.floor((e+1)/2),c=1-e%2,u=30-(3*a+2*l),h=30-(2*a+3*l),d=~((1<<u)-1),f=~((1<<h)-1),p=(r.xLL&d)>>u,m=(r.yLL&f)>>h,_=(r.xTR&d)>>u,g=(r.yTR&f)>>h,y=s<<3*c+2*(1-c),x=o<<2*c+3*(1-c),b=y+8*c+4*(1-c),w=x+4*c+8*(1-c),v=Math.max(y,p),S=Math.max(x,m),T=Math.min(b,_),I=Math.min(w,g);let M=null,A=null;for(let e=S;e<=I;e++)for(let t=v;t<=T;t++){const r=t-y+(e-x)*(8*c+4*(1-c)),i=n.children[r];i&&(M||(M=i,M.next=n.next),A&&(A.next=i),A=i,i.next=n.next)}n=M||n.next}return t}}class Se{constructor(e){this._options=e}insert(e,t){const r=e.getCursor(),i={$view:{scale:this._options.scale,timeZone:this._options.timeZone}};for(;r.next();)this._insertFeature(r,i,t)}_insertFeature(e,t,r){const{featureFilter:i}=this._options;if(null!==i&&!i.check(e))return;let n=0,s=0;if("esriGeometryPoint"===e.geometryType)n=e.readXWorldSpace(),s=e.readYWorldSpace();else{if(r){const t=e.readCentroidForDisplay();if(null==t)return;const[r,i]=t.coords;if(r<0||r>m.CQ||i<0||i>m.CQ)return}const t=e.readCentroidWorldSpace();if(null==t)return;n=t.coords[0],s=t.coords[1]}this._insert(e,n,s,t)}}class Te extends Se{constructor(e){super(e),this._tree=new ve(this._options.fields)}put(e){throw new Error("Geohash tree does not support put")}putBounded(e,t,r){const{geohashLevel:i,spatialReference:n}=this._options,s=function(e,t,r,i){const n=[e.xmin,e.ymin,e.xmax,e.ymax],s=se.A.fromExtent(ne.default.fromBounds(n,i)),o=(0,V.Cv)(s,i,b.A.WGS84,{densificationStep:64*t});if(!o)return null;const a=(0,G.Ye)(new ae.A,o,!1,!1),l=a.coords.filter(((e,t)=>!(t%2))),c=a.coords.filter(((e,t)=>t%2)),u=Math.min(...l),h=Math.min(...c),d=Math.max(...l),f=Math.max(...c),p=le(u,h,r,b.A.WGS84),m=le(d,f,r,b.A.WGS84);return p&&m?{bounds:n,geohashBounds:{xLL:p[0],yLL:p[1],xTR:m[0],yTR:m[1]},level:r}:null}(t,r,i,n);null!=s&&this._tree.putBins(e,s)}_insert(e,t,r,i){const{geohashLevel:n,spatialReference:s}=this._options,o=le(t,r,n,s);o&&this._tree.insert(e,t,r,o[0],o[1],n,i)}}var Ie=r(62938);class Me extends ue{static createId(e,t){return`${e}.${t}`}static create(e,t,r,i){return new Me(e,t,fe.create(r),i)}constructor(e,t,r,i){super(r),this.gridX=e,this.gridY=t,this._worldUnitsPerCell=i,this._count=0,this._xWorldTotal=0,this._yWorldTotal=0,this._objectIds=new Set}get id(){return Me.createId(this.gridX,this.gridY)}get containedObjectIds(){return this._objectIds}get count(){return this._count}get firstObjectId(){return this._objectIds.values().next().value}get centroidXWorld(){return this._xWorldTotal/this._count}get centroidYWorld(){return this._yWorldTotal/this._count}clone(){const e=new Me(this.gridX,this.gridY,this._statistics.clone(),this._worldUnitsPerCell);return e._count=this._count,e._xWorldTotal=this._xWorldTotal,e._yWorldTotal=this._yWorldTotal,e._firstFeatureAttributes=this._firstFeatureAttributes,e._objectIds=new Set(this._objectIds),e}insert(e,t,r,i){0===this._count?this._firstFeatureAttributes=e.readAttributes():this._firstFeatureAttributes=null,this._count+=1,this._xWorldTotal+=r,this._yWorldTotal+=i,this._statistics.insert(e,t),this._objectIds.add(e.getObjectId())}merge(e){if(0!==e._count){this._count+=e._count,this._firstFeatureAttributes=e._firstFeatureAttributes,this._xWorldTotal+=e._xWorldTotal,this._yWorldTotal+=e._yWorldTotal,this._statistics.merge(e._statistics);for(const t of e._objectIds.values())this._objectIds.add(t)}}getCentroidX(e){return null==e?this.centroidXWorld:(0,G.IE)(e,this.centroidXWorld)}getCentroidY(e){return null==e?this.centroidYWorld:(0,G.B2)(e,this.centroidYWorld)}getGeometry(e,t){const r=this.gridX*this._worldUnitsPerCell,i=this.gridY*this._worldUnitsPerCell,n=new ae.A([4],[r,i,r+this._worldUnitsPerCell,i,r+this._worldUnitsPerCell,i+this._worldUnitsPerCell,r,i+this._worldUnitsPerCell]);if(null!=t){const e=new ae.A;return(0,G.Nl)(e,n,!1,!1,"esriGeometryPolygon",t)}return n}getCentroid(e){const t=new ae.A([],[this.centroidXWorld,this.centroidYWorld]);if(null!=e){const r=new ae.A;return(0,G.Nl)(r,t,!1,!1,"esriGeometryPoint",e)}return t}getGeometricCentroid(e,t){const r=this.gridX*this._worldUnitsPerCell+.5*this._worldUnitsPerCell,i=this.gridY*this._worldUnitsPerCell+.5*this._worldUnitsPerCell,n=new ae.A([],[r,i]);if(null!=t){const e=new ae.A;return(0,G.Nl)(e,n,!1,!1,"esriGeometryPoint",t)}return n}getAttributes(){const e={aggregateId:this.id};for(const t of this._statistics.values())e[t.field.name]=t.value;return null!=this._firstFeatureAttributes?{...e,...this._firstFeatureAttributes}:e}}function Ae(e,t){return(0,Ie.GA)(e)*Ie.dy*96/t}class Ee extends Se{constructor(e){super(e),this._cells=new Map,this._pixelsPerMapUnit=Ae(e.spatialReference,e.scale)}put(e){for(const t of this._cells.values()){const r=e.get(t.id);r?r.merge(t):e.set(t.id,t.clone())}}putBounded(e,t,r){const i=[t.xmin,t.ymin,t.xmax,t.ymax],[n,s,o,a]=i,l=Math.floor(n*this._pixelsPerMapUnit/this._options.cellSize),c=Math.floor(s*this._pixelsPerMapUnit/this._options.cellSize),u=Math.ceil(o*this._pixelsPerMapUnit/this._options.cellSize),h=Math.ceil(a*this._pixelsPerMapUnit/this._options.cellSize);for(let t=c;t<=h;t++)for(let r=l;r<=u;r++){const i=`${r}.${t}`,n=this._cells.get(i);if(!n)continue;const s=e.get(n.id);s?n&&!e.has(n.id)&&s.merge(n):e.set(n.id,n.clone())}}_insert(e,t,r,i){const n=t*this._pixelsPerMapUnit,s=r*this._pixelsPerMapUnit,o=Math.floor(n/this._options.cellSize),a=Math.floor(s/this._options.cellSize);this._getCellOrCreate(o,a).insert(e,i,t,r)}_getCellOrCreate(e,t){const r=Me.createId(e,t);let i=this._cells.get(r);if(!i){const n=1*this._options.cellSize/this._pixelsPerMapUnit;i=Me.create(e,t,this._options.fields,n),this._cells.set(r,i)}return i}}var Pe=r(63139);class Ce extends Pe.Y{static from(e,t){return new Ce(e.copy(),t)}constructor(e,t){super(e.metadata),this._currentIndex=-1,this._displayTranslationX=0,this._displayTranslationY=0,this._displayScaleX=1,this._displayScaleY=1,this._reader=e,this._indices=t,this._isPoint="esriGeometryPoint"===e.geometryType}setTransformForDisplay(e){const t=this._reader.getInTransform();if(null==t){const[t,r]=e.scale,[i,n]=e.translate;return this._displayTranslationX=-i/t,this._displayScaleX=1/t,this._displayTranslationY=n/r,this._displayScaleY=1/-r,void(this._displayTransform=e)}const[r,i]=t.scale,[n,s]=t.translate,[o,a]=e.scale,[l,c]=e.translate;if(this._displayScaleX=r/o,this._displayTranslationX=(n-l)/o,this._displayScaleY=i/a,this._displayTranslationY=(-s+c)/a,!this._isPoint&&t)throw new Error("InternalError: Relative transformations not supported for non-point features");this._displayTransform=e}getInTransform(){return this._reader.getInTransform()}get fields(){return this._reader.fields}get hasNext(){return this._currentIndex+1<this._indices.length}getSize(){return this._indices.length}getCursor(){return this.copy()}copy(){const e=new Ce(this._reader.copy(),this._indices);return e._currentIndex=this._currentIndex,e._displayTransform=this._displayTransform,e._displayTranslationX=this._displayTranslationX,e._displayTranslationY=this._displayTranslationY,e._displayScaleX=this._displayScaleX,e._displayScaleY=this._displayScaleY,e}get contextTimeZone(){return this._reader.contextTimeZone}set contextTimeZone(e){this._reader.contextTimeZone=e}_nextIndex(){return++this._currentIndex<this._indices.length&&(this._reader.setIndex(this._indices[this._currentIndex]),!0)}next(){for(;this._nextIndex()&&!this._reader._getExists(););return this._currentIndex<this._indices.length}readXForDisplay(){return this._reader.readXForDisplay()*this._displayScaleX+this._displayTranslationX}readYForDisplay(){return this._reader.readYForDisplay()*this._displayScaleY+this._displayTranslationY}readGeometryForDisplay(){const e=this._reader.readGeometryForDisplay();if(!this._displayTransform)return e;const t=new ae.A;return(0,G.Nl)(t,e,this.hasZ,this.hasM,this.geometryType,this._displayTransform),t.deltaDecode()}readCentroidForDisplay(){const e=this._reader.readCentroidForDisplay()?.clone();if(e){const[t,r]=e.coords;e.coords[0]=t*this._displayScaleX+this._displayTranslationX,e.coords[1]=r*this._displayScaleY+this._displayTranslationY}return e}get geometryType(){return this._reader.geometryType}get hasFeatures(){return this._reader.hasFeatures}get exceededTransferLimit(){return this._reader.exceededTransferLimit}get hasZ(){return this._reader.hasZ}get hasM(){return this._reader.hasM}readAttribute(e,t=!1){return this._reader.readAttribute(e,t)}readAttributes(){return this._reader.readAttributes()}joinAttributes(e){return this._reader.joinAttributes(e)}getBounds(e){return this._reader.getBounds(e)}getAttributeHash(){return this._reader.getAttributeHash()}getObjectId(){return this._reader.getObjectId()}getDisplayId(){return this._reader.getDisplayId()}setDisplayId(e){return this._reader.setDisplayId(e)}setIndex(e){return this._reader.setIndex(e)}getIndex(){return this._reader.getIndex()}readXWorldSpace(){return this._reader.readXWorldSpace()}readYWorldSpace(){return this._reader.readYWorldSpace()}_readX(){return this._reader.readXForDisplay()}_readY(){return this._reader.readYForDisplay()}_readServerCentroid(){return this._reader._readServerCentroid()}readLegacyFeatureForDisplay(){const e=this.readCentroidForDisplay();return{attributes:this.readAttributes(),geometry:this.readLegacyGeometryForDisplay(),centroid:(e&&{x:e.coords[0],y:e.coords[1]})??null}}readLegacyGeometryForDisplay(){const e=this.readGeometryForDisplay();return(0,G.zv)(e,this.geometryType,!1,!1)}readGeometryArea(){return this._reader.readGeometryArea()}readGeometryWorldSpace(){return this._reader.readGeometryWorldSpace()}_readGeometry(){return this._reader._readGeometry()}_readAttribute(e,t){throw new Error("Error: Should not be called. Underlying _reader should be used instead")}_readAttributes(){throw new Error("Error: Should not be called. Underlying _reader should be used instead")}readArcadeFeature(){return this._reader.readArcadeFeature()}geometry(){return this._reader.geometry()}field(e){return this._reader.field(e)}hasField(e){return this._reader.hasField(e)}setField(e,t){return this._reader.setField(e,t)}keys(){return this._reader.keys()}castToText(e=!1){return this._reader.castToText(e)}}class Re{size(){return this.reader.getSize()}get fields(){return this.reader.fields}invalidate(){this._aggregateIndex=null,this._aggregateIndexHash=null,this._spatialIndex=null}queryFeaturesInBounds(e){const t=this._getSpatialIndex().search(e);return Ce.from(this.reader,t)}getAggregateIndex(e){const t=JSON.stringify(e);if(t!==this._aggregateIndexHash){switch(this._aggregateIndexHash=t,e.type){case"grid":this._aggregateIndex=new Ee(e);break;case"geohash":this._aggregateIndex=new Te(e)}this._aggregateIndex.insert(this.reader,this.isTiled)}return this._aggregateIndex}_getSpatialIndex(){return this._spatialIndex||(this._spatialIndex=re.fromReader(this.reader)),this._spatialIndex}}class Fe extends Pe.Y{static fromFeatures(e,t){const{objectIdField:r,geometryType:i}=t,n=(0,G.Di)([],e,i,!1,!1,r);for(let t=0;t<n.length;t++)n[t].displayId=e[t].displayId;return Fe.fromOptimizedFeatures(n,t)}static fromFeatureSet(e,t){const r=(0,G.q3)(e,t.objectIdField);return Fe.fromOptimizedFeatureSet(r,t)}static fromOptimizedFeatureSet(e,t){const r=Fe.fromOptimizedFeatures(e.features,t);return r._exceededTransferLimit=e.exceededTransferLimit,r._transform=e.transform,r._fieldsIndex=new q.A(e.fields),r}static fromOptimizedFeatures(e,t,r){const i=new Fe(e,t);return i._fieldsIndex=t.fieldsIndex,i._transform=r,i}static empty(e){return new Fe([],e)}constructor(e,t){super(t),this._exceededTransferLimit=!1,this._featureIndex=-1,this._fieldsIndex=null,this._geometryType=t.geometryType,this._features=e}get fields(){return this._fieldsIndex}get geometryType(){return this._geometryType}get hasFeatures(){return!!this._features.length}get hasNext(){return this._featureIndex+1<this._features.length}get exceededTransferLimit(){return this._exceededTransferLimit}get hasZ(){return!1}get hasM(){return!1}get _current(){return this._features[this._featureIndex]}removeIds(e){const t=new Set(e);this._features=this._features.filter((e=>!(null!=e.objectId&&t.has(e.objectId))))}getSize(){return this._features.length}getCursor(){return this.copy()}getInTransform(){return this._transform}getAttributeHash(){let e="";for(const t in this._current.attributes)e+=this._current.attributes[t];return e}getIndex(){return this._featureIndex}setIndex(e){this._featureIndex=e}getObjectId(){return this._current?.objectId}getDisplayId(){return this._current.displayId}setDisplayId(e){this._current.displayId=e}copy(){const e=new Fe(this._features,this.metadata);return this.copyInto(e),e}next(){for(;++this._featureIndex<this._features.length&&!this._getExists(););return this._featureIndex<this._features.length}readGeometryArea(){return(0,B.N3)(this._current)?(0,G.Rk)(this._current.geometry,2):0}_readX(){return(0,B.N3)(this._current)?this._current.geometry.coords[0]:0}_readY(){return(0,B.N3)(this._current)?this._current.geometry.coords[1]:0}_readGeometry(){return(0,B.N3)(this._current)?this._current.geometry??null:null}_readServerCentroid(){return this._current.centroid}_readAttribute(e,t){if(!this._fieldsIndex){const t=this._current.attributes[e];if(void 0!==t)return t;const r=e.toLowerCase();for(const e in this._current.attributes)if(e.toLowerCase()===r)return this._current.attributes[e];return}const r=this._fieldsIndex.get(e);if(!r)return;const i=this._current.attributes[r.name];return null==i?i:t&&this.fields.isDateField(e)?new Date(i):i}_readAttributes(){return this._current.attributes}copyInto(e){super.copyInto(e),e._featureIndex=this._featureIndex,e._transform=this._transform,e._fieldsIndex=this._fieldsIndex}}function Le(e){return"localEdit"===e.chunkId}class ke extends Re{constructor(e,t){super(),this.metadata=e,this.removed=new Set,this.overriddenIds=new Set,this._features=[],this.chunkId=t,this.normalizedChunkId=t}get reader(){return Fe.fromOptimizedFeatures(this._features,this.metadata)}get queryInfo(){return{}}get first(){return!1}get end(){return!1}get isTiled(){return!1}get lastLocalEditDropped(){return this._lastLocalEditDropped}applyOverrides(e){this._onChange();const{reader:t,removed:r}=e,i=[],n=new Set,s=t.getCursor(),o=new Set(r);for(this.overriddenIds.clear();s.next();){const e=s.readOptimizedFeatureWorldSpace(),t=e.objectId;i.push(e),n.add(t),this.overriddenIds.add(t),this.removed.delete(t)}for(const e of this._features){const t=e.objectId;o.has(t)||n.has(t)||(i.push(e),this.overriddenIds.add(t))}this._features=i;for(const e of n.values())this.removed.delete(e);for(const e of r)this.removed.add(e),this.overriddenIds.add(e)}removeOverrides(e){this._lastLocalEditDropped=performance.now(),this._onChange();const t=e.reader.getCursor(),r=new Set;for(;t.next();){const e=t.getObjectId();this.overriddenIds.has(e)&&(r.add(e),this.overriddenIds.delete(e))}this._features=this._features.filter((e=>!r.has(e.objectId)))}getTileReader(e){if(!this._features.length)return null;const t=this.queryFeaturesInBounds(e.bounds);return t.setTransformForDisplay(e.transform),t}_onChange(){this.invalidate()}}var Ne=r(67057),Oe=r(70132),De=r(24231);class ze extends X{constructor(e,t){super(e),this.bins=new Map,this.featureCache=new Map,this.done=!1,this._store=t}reset(){this.destroy(),this.done=!1}invaldateForLocalEditDropped(){this.handledChunks.clear(),this.bins.clear()}destroy(){const e=this.subscription.tile.key.level;for(const t of this.featureCache.keys())this._store.releaseDisplayIdForObjectId(`${t}.${e}`);this.bins.clear(),this.featureCache.clear(),this.handledChunks.clear()}get tile(){return this.subscription.tile}*featuresWorldSpace(){for(const e of this.featureCache.values()){const t=e.clone();t.geometry&&(0,G.Ch)(t.geometry,t.geometry,!1,!1,this.subscription.tile.transform),yield t}}}class Ue extends J{static async create(e,t,r,i,n){const s=new Ne.l({spatialReference:t}),o=await Promise.all(e.fields.map((async e=>H.create(s,e)))),a=e.featureFilter?await Oe.A.create({geometryType:r.metadata.geometryType,hasM:!1,hasZ:!1,timeInfo:r.metadata.timeInfo,fieldsIndex:r.metadata.fieldsIndex,spatialReference:t,filterJSON:e.featureFilter}):null;return"geohash"===e.index.type&&await(0,V.Nk)(t,b.A.WGS84),new Ue(e,a,n,o,t,r,i)}constructor(e,t,r,i,n,s,o){super(s,o,n,i),this._schema=e,this._featureFilter=t,this._timeZone=r,this._metadata=De.i.createFeature({geometryType:"esriGeometryPolygon",objectIdField:"aggregateId",fieldsIndex:new q.A(e.fields).toJSON(),globalIdField:null,spatialReference:s.metadata.spatialReference,subtypeField:null,subtypes:null,timeInfo:null,timeReferenceUnknownClient:null,typeIdField:null,types:null})}createState(e){return new ze(e,this._attributeStore)}async*applyLocalEdit(e){for(const e of this._sendStates.values()){e.reset();const t=new K(e.subscription,Fe.empty(this._source.metadata),!0,!1,{});yield t}}displayMap(e,t,r){const i=new Map(e.map((e=>[t(e),e]))),n=[];for(const e of this._sendStates.values())for(const t of e.featuresWorldSpace()){const{objectId:e,displayId:s}=t,o=i.get(e);if(null!=o){const t=r(s,o,e);n.push(t),i.delete(e)}}return n}getDisplayFeatures(e){const t=new Set(e),r=new Set,i=[];for(const e of this._sendStates.values())for(const n of e.featuresWorldSpace())t.has(n.displayId)&&!r.has(n.objectId)&&(n.geometry&&i.push({...(0,G.oN)(n,this._metadata.geometryType,!1,!1),displayId:n.displayId}),r.add(n.objectId));return{features:[],aggregates:i}}getFeatureObjectIdsForAggregate(e){for(const t of this._sendStates.values())for(const r of t.bins.values())if(r.id===e)return Array.from(r.containedObjectIds);return[]}beforeUpdateChunks(){const e=this._source.chunks();if(!e.length)return;let t=!1;for(const r of e)Le(r)&&r.lastLocalEditDropped!==this._lastHandledLocalEdit&&(this._lastHandledLocalEdit=r.lastLocalEditDropped,t=!0);if(t)for(const e of this._sendStates.values())e.invaldateForLocalEditDropped()}async*updateChunks(){for(const e of this._sendStates.values())yield*this._update(e,this._source)}forEachAggregateWorldSpace(e){const t=new Set;for(const r of this._sendStates.values())for(const i of r.featuresWorldSpace())t.has(i.objectId)||(e(i),t.add(i.objectId))}_createIndexOptions(e){switch(this._schema.index.type){case"geohash":return{type:"geohash",fields:this.aggregateFields,featureFilter:this._featureFilter,geohashLevel:this._schema.index.fixBinLevel,spatialReference:this.spatialReference,timeZone:this._timeZone,scale:e.scale};case"grid":{const t=this._schema.index.fixedBinLevel,r=null!=t?e.tileInfoView.getLODInfoAt(t).scale:e.scale;return{type:"grid",fields:this.aggregateFields,cellSize:this._schema.index.size,featureFilter:this._featureFilter,spatialReference:this.spatialReference,timeZone:this._timeZone,scale:r}}}}async*_update(e,t){const{handledChunks:r,subscription:i,bins:n,featureCache:s}=e,o=i.tile;if(e.done)return;for(const i of t.chunks()){if(r.has(i.chunkId))continue;r.add(i.chunkId);const t=i.queryInfo;if("tileId"in t){const e=new p.A(t.tileId);if(e.level!==o.level||e.world!==o.key.world)continue}i.getAggregateIndex(this._createIndexOptions(e.tile)).putBounded(n,e.tile.extent,e.tile.resolution)}const a=[],l=i.tile.transform,c=i.tile.key.level;for(const e of n.values()){let t=s.get(e.id);if(t)t.attributes=e.getAttributes();else{const r=e.getGeometry(this.spatialReference,l);t=new B.Om(r,e.getAttributes(),null),r||(t.centroid=e.getGeometricCentroid(this.spatialReference,l)),t.objectId=e.id,t.displayId=this._attributeStore.createDisplayIdForObjectId(`${t.objectId}.${c}`),s.set(e.id,t)}a.push(t)}this.events.emit("changed"),e.done=!t.updateTracking.updating;const u=Fe.fromOptimizedFeatures(a,this._metadata,l),h=u.getCursor(),d=e.subscription.tile.createArcadeEvaluationOptions(this._timeZone);for(;h.next();)this._attributeStore.setAttributeData(h.getDisplayId(),h,d);const f=new ee(e.subscription,u,[],e.done,{});yield f}}class Ge{constructor(e,t){this.inner=e,this.displayId=t}}class Be extends X{constructor(e){super(e),this.didSend=!1,this.done=!1}}class Ve{constructor(e,t,r,i,n){this._level=e,this._scale=t,this._indexOptions=r,this._clusterRadius=i,this._store=n,this._cells=new Map,this._handledChunks=new Set,this._statistics=new Map,this._clusters=new Map}destroy(){this._clearClusters()}_clearClusters(){for(const e of this._clusters.values())this._store.releaseDisplayIdForObjectId(e.inner.id);this._clusters.clear()}*aggregatesWorldSpace(){for(const e of this._clusters.values()){const t=e.inner.getCentroid(null),r=new B.Om(t,e.inner.getAttributes(),null);r.objectId=e.inner.id,r.displayId=e.displayId,yield r}}clusters(){return this._clusters.values()}updateChunks(e,t){let r=!1;for(const t of e){const e=t.queryInfo;"tileId"in e&&new p.A(e.tileId).level!==this._level||this._handledChunks.has(t.normalizedChunkId)||(this._handledChunks.add(t.normalizedChunkId),r=!0,t.getAggregateIndex({...this._indexOptions,scale:this._scale}).put(this._cells))}const i={xMin:1/0,yMin:1/0,xMax:-1/0,yMax:-1/0},n=Ae(this._indexOptions.spatialReference,this._scale),s=this._indexOptions.cellSize;for(const{subscription:e}of t){const t=e.tile.bounds,r=Math.floor(t[0]*n/s),o=Math.floor(t[1]*n/s),a=Math.ceil(t[2]*n/s),l=Math.ceil(t[3]*n/s);i.xMin=Math.min(i.xMin,r),i.yMin=Math.min(i.yMin,o),i.xMax=Math.max(i.xMax,a),i.yMax=Math.max(i.yMax,l)}return null!=this._lastCellBounds&&i.xMin===this._lastCellBounds.xMin&&i.yMin===this._lastCellBounds.yMin&&i.yMin===this._lastCellBounds.yMin&&i.yMax===this._lastCellBounds.yMax||(r=!0,this._lastCellBounds=i),r&&this._clusterCells(i),r}async updateStatistics(e){let t=!1;for(const e of this._clusters.values())e.inner.count>1&&(t=this._updateAggregateStatistics(this._statistics,e.inner)||t);if(t){const t=Array.from(this._statistics.entries()).map((([e,t])=>({fieldName:e,minValue:t.minValue,maxValue:t.maxValue})));await e.container.updateStatistics(this._level,t)}}createAggregateFeatures(e,t){const r=e.subscription,i=[],n=r.tile.transform;for(const e of this._clusters.values()){let t=e.inner.getCentroidX(n);const s=e.inner.getCentroidY(n),o=r.tile.lod,a=o.wrap?o.worldSize[0]:null,l=1===e.inner.count?e.inner.firstObjectId:e.inner.id,c=e.displayId;if(null!=a)if(1===a){const r=new ae.A([],[t,s]),n=new B.Om(r,e.inner.getAttributes(),null);n.geometry.coords[0]-=m.CQ,n.objectId=l,n.displayId=c,i.push(n);const o=new ae.A([],[t,s]),a=new B.Om(o,e.inner.getAttributes(),null);a.geometry.coords[0]+=m.CQ,a.objectId=l,a.displayId=c,i.push(a)}else t>m.CQ+m.CQ/2?t-=a*m.CQ:t<-m.CQ/2&&(t+=a*m.CQ);if(t<m.CQ+128&&t>=-128&&s<m.CQ+128&&s>=-128){const r=new ae.A([],[t,s]),n=new B.Om(r,e.inner.getAttributes(),null);n.objectId=l,n.displayId=c,i.push(n)}}return Fe.fromOptimizedFeatures(i,t,r.tile.transform)}_clusterCells(e){let t=Array.from(this._cells.values());t=t.sort(((e,t)=>t.count-e.count));const r=[];for(const e of this._clusters.values())r.push(e.inner.id);this._clusters.clear();const i=this._clusterRadius*(1/Ae(this._indexOptions.spatialReference,this._scale)),n=1+this._clusterRadius/this._indexOptions.cellSize,s=new Set;for(const r of t){if(s.has(r.id))continue;if(r.gridX<e.xMin||r.gridX>e.xMax||r.gridY<e.yMin||r.gridY>e.yMax)continue;const t=this._store.createDisplayIdForObjectId(r.id),o=new Ge(r.clone(),t);s.add(r.id),this._clusters.set(r.id,o);const a=r.centroidXWorld,l=r.centroidYWorld;for(let e=r.gridY-n;e<=r.gridY+n;e++)for(let t=r.gridX-n;t<=r.gridX+n;t++){if(e===r.gridY&&t===r.gridX)continue;const n=this._cells.get(Me.createId(t,e));if(!n||s.has(n.id))continue;const c=Math.abs(n.centroidXWorld-a),u=Math.abs(n.centroidYWorld-l);c<i&&u<i&&(o.inner.merge(n),s.add(n.id))}}for(const e of r)this._store.releaseDisplayIdForObjectId(e)}_updateAggregateStatistics(e,t){let r=!1;for(const i of t.statistics.values()){if("esriFieldTypeString"===i.field.type)continue;const t=i.value,n=i.field,s=e.get(n.name);if(s){const{minValue:e,maxValue:i}=s,n=Math.min(s.minValue,t),o=Math.max(s.maxValue,t);e===n&&i===o||(s.minValue=n,s.maxValue=o,r=!0)}else e.set(n.name,{minValue:t,maxValue:t}),r=!0}return r}}class qe extends J{static async create(e,t,r,i,n,s){const o=new Ne.l({spatialReference:r}),a={type:"grid",fields:await Promise.all(t.fields.map((async e=>H.create(o,e)))),spatialReference:r,featureFilter:t.featureFilter?await Oe.A.create({geometryType:i.metadata.geometryType,hasM:!1,hasZ:!1,timeInfo:i.metadata.timeInfo,fieldsIndex:i.metadata.fieldsIndex,spatialReference:r,filterJSON:t.featureFilter}):null,cellSize:t.clusterRadius/4,timeZone:s};return new qe(e,t.clusterRadius,a,t.fields,i,n)}constructor(e,t,r,i,n,s){super(n,s,r.spatialReference,r.fields),this._connection=e,this._clusterRadius=t,this._indexOptions=r,this._cellsPerScale=new Map,this._metadata=De.i.createFeature({geometryType:"esriGeometryPoint",objectIdField:"aggregateId",fieldsIndex:new q.A([...i,...this._source.metadata.fieldsIndex.fields,{name:"aggregateId",alias:"aggregateId",type:"esriFieldTypeOID"}]).toJSON(),globalIdField:null,spatialReference:n.metadata.spatialReference,subtypeField:null,subtypes:null,timeInfo:null,timeReferenceUnknownClient:null,typeIdField:null,types:null})}get enablePixelBuffering(){return!1}invalidate(){super.invalidate();for(const e of this._cellsPerScale.values())e.destroy();this._cellsPerScale.clear()}onSubscribe(e){super.onSubscribe(e),this._requiredLevel=e.tile.level,this._requiredScale=e.tile.scale}createState(e){return new Be(e)}async*applyLocalEdit(e){for(const e of this._cellsPerScale.values())e.destroy();this._cellsPerScale.clear();for(const e of this._sendStates.values())e.done=!1}displayMap(e,t,r){const i=new Map(e.map((e=>[t(e),e]))),n=[],s=this._getClusterState(this._requiredLevel,this._requiredScale);for(const e of s.clusters()){const t=i.get(e.inner.id);if(null==t){if(1===e.inner.count){const t=i.get(e.inner.firstObjectId);if(null!=t){const s=r(e.displayId,t,e.inner.firstObjectId);n.push(s),i.delete(e.inner.firstObjectId)}}}else{const s=r(e.displayId,t,e.inner.id);n.push(s),i.delete(e.inner.id)}}return n}getDisplayFeatures(e){const t=new Set(e),r=new Set,i=[],n=[],s=this._getClusterState(this._requiredLevel,this._requiredScale);for(const e of s.aggregatesWorldSpace())if(t.has(e.displayId)&&!r.has(e.displayId)){const t=(0,G.oN)(e,this._metadata.geometryType,!1,!1);if(r.add(e.displayId),1===t.attributes.cluster_count){i.push({...t,displayId:e.displayId});continue}n.push({...t,displayId:e.displayId})}return{features:i,aggregates:n}}getFeatureObjectIdsForAggregate(e){const t=this._getClusterState(this._requiredLevel,this._requiredScale);for(const r of t.clusters())if(r.inner.id===e)return Array.from(r.inner.containedObjectIds);return[]}async*updateChunks(){const e=this._source.chunks();if(!e.length)return;for(const t of e)Le(t)&&t.lastLocalEditDropped!==this._lastHandledLocalEdit&&(this.invalidate(),this._lastHandledLocalEdit=t.lastLocalEditDropped);const t=this._getClusterState(this._requiredLevel,this._requiredScale),r=Array.from(this._sendStates.values()).filter((e=>e.subscription.tile.level===this._requiredLevel));if(t.updateChunks(e,r)||!this._source.updateTracking.updating)for(const e of r)e.subscription.tile.level===this._requiredLevel&&(e.didSend=!1,e.done=!1);const i=Array.from(this._sendStates.values()).filter((e=>e.done)).map((e=>e.subscription.tile.key)),n=new Set(i);for(const e of this._sendStates.values()){if(this._source.updateTracking.updating){if(i.some((t=>t.containsChild(e.subscription.tile.key))))continue;if(e.subscription.tile.key.getChildKeys().every((e=>n.has(e))))continue}e.didSend||e.subscription.tile.level!==this._requiredLevel||(e.didSend=!0,yield*this._update(e,t,this._source))}await t.updateStatistics(this._connection)}forEachAggregateWorldSpace(e){if(null==this._requiredLevel||null==this._requiredScale)return;const t=this._getClusterState(this._requiredLevel,this._requiredScale);for(const r of t.aggregatesWorldSpace())e(r)}_getClusterState(e,t){if(null==e||null==t)throw new Error("InternalError: Level and scale must be defined");let r=this._cellsPerScale.get(t);return r||(r=new Ve(e,t,this._indexOptions,this._clusterRadius,this._attributeStore),this._cellsPerScale.set(t,r)),r}async*_update(e,t,r){if(e.done)return;const i=t.createAggregateFeatures(e,this._metadata);this.events.emit("changed"),e.done=!r.updateTracking.updating;const n=i.getCursor(),s=e.subscription.tile.createArcadeEvaluationOptions(this._indexOptions.timeZone);for(;n.next();)this._attributeStore.setAttributeData(n.getDisplayId(),n,s);const o=new K(e.subscription,i,!0,e.done,{});yield o}}class Ze extends X{}class He extends Q{constructor(e,t,r){super(e,t),this._timeZone=r,this.handledChunks=new Set,this.handledChunksForIdCreation=new Set,this.handledChunksForAttributeData=new Set,this._streamLayerDeferredObjectIdsToRemove=[]}destroy(){super.destroy();for(const e of this._source.chunks())this._cleanupChunkIds(e)}invalidateAttributeData(){this.handledChunksForAttributeData.clear()}onSubscribe(e){super.onSubscribe(e),this._evalOptions=e.tile.createArcadeEvaluationOptions(this._timeZone)}createState(e){return new Ze(e)}get aggregateQueryEngine(){return null}displayMap(e,t,r){const i=new Map(e.map((e=>[t(e),e]))),n=[];for(const e of this._source.chunks()){const t=e.reader.getCursor();for(;t.next();){const e=t.getObjectId(),s=t.getDisplayId(),o=i.get(e);if(null!=o){const t=r(s,o,e);n.push(t),i.delete(e)}}}return n}getDisplayFeatures(e){const t=new Set(e),r=new Set,i=[];for(const e of this._source.chunks()){const n=e.reader.getCursor();for(;n.next();){const e=n.getObjectId(),s=n.getDisplayId();t.has(s)&&!r.has(e)&&(i.push({...n.readLegacyFeatureWorldSpace(),displayId:s}),r.add(e))}}return{features:i,aggregates:[]}}async*applyLocalEdit(e){const t=[],r=e.reader.getCursor();for(;r.next();){const e=r.getObjectId(),i=this._attributeStore.createDisplayIdForObjectId(e);r.setDisplayId(i),this._attributeStore.setAttributeData(i,r,this._evalOptions),t.push(i)}const i=[];for(const t of e.removed){const e=this._attributeStore.getDisplayIdForObjectId(t);null!=e&&i.push(e)}(0,s.A)("esri-2d-update-debug")&&console.debug("FeatureUpdateStrategy.applyLocalEdit",{message:e,modifiedDisplayIds:t,removedDisplayIds:i});const n=new ke(this._source.metadata,"localEdit");n.applyOverrides(e),this.handledChunks.add(n.chunkId),this.handledChunksForAttributeData.add(n.chunkId),this.handledChunksForIdCreation.add(n.chunkId);for(const e of this._sendStates.values())e.handledChunks.add(n.chunkId),yield new ee(e.subscription,null,t,!1,n.queryInfo);for(const e of this._sendStates.values()){const t=n.getTileReader(e.subscription.tile);yield new ee(e.subscription,t,i,!1,n.queryInfo)}for(const t of e.removed)this._attributeStore.releaseDisplayIdForObjectId(t)}async*updateChunks(){if(this._source.chunks().length){await this._updateAttributeData();for(const e of this._sendStates.values())yield*this._update(e)}}removeChunks(e){for(const t of e)this.handledChunks.delete(t.chunkId),this.handledChunksForAttributeData.delete(t.chunkId),this._cleanupChunkIds(t)}afterUpdateChunks(){for(const e of this._streamLayerDeferredObjectIdsToRemove)this._attributeStore.releaseDisplayIdForObjectId(e);this._streamLayerDeferredObjectIdsToRemove=[]}_cleanupChunkIds(e){if(this.handledChunksForIdCreation.has(e.chunkId)){const t=e.reader.getCursor();for(;t.next();){const e=t.getObjectId();this._source.isStream?this._streamLayerDeferredObjectIdsToRemove.push(e):this._attributeStore.releaseDisplayIdForObjectId(e)}this.handledChunksForIdCreation.delete(e.chunkId)}}async _updateAttributeData(){for(const e of this._source.chunks()){const{chunkId:t,reader:r}=e;if(!this.handledChunksForIdCreation.has(t)){this.handledChunksForIdCreation.add(t);const e=r.getCursor();for(;e.next();){const t=this._attributeStore.createDisplayIdForObjectId(e.getObjectId());e.setDisplayId(t)}}}for(const e of this._source.chunks())if(!this.handledChunksForAttributeData.has(e.chunkId)){this.handledChunksForAttributeData.add(e.chunkId);const t=e.reader.getCursor();for(;t.next();){const e=t.getDisplayId();this._attributeStore.setAttributeData(e,t,this._evalOptions)}}}*_update(e){const{subscription:t,handledChunks:r}=e;for(const i of this._source.chunks()){const{chunkId:n}=i;if(r.has(n))continue;r.add(n);const s=i.getTileReader(t.tile);s&&(yield new K(e.subscription,s,!1,i.end,i.queryInfo))}}}var je=r(12564);class We{constructor(e,t){this._connection=e,this._source=t,this._version=1,this._registry=new O.o,this._proxy=new N.J({fetch:(e,t)=>this._connection.layerView.fetch(e,t),fetchDictionary:(e,t)=>this._connection.layerView.fetchDictionary(e,t)}),this._attributeStore=new je.K({isLocal:!1,update:e=>(0,h.oV)(this._connection.container.updateAttributeView(e))})}destroy(){this._proxy.destroy(),this._strategy?.destroy(),this._attributeStore.destroy()}get aggregateQueryEngine(){return this._strategy?.aggregateQueryEngine}getDisplayFeatures(e){return this._strategy?this._strategy.getDisplayFeatures(e):{features:[],aggregates:[]}}getDisplayIds(e){const t={};return this._strategy?(this._strategy.displayMap(e,(e=>e),((e,r,i)=>{t[i]=e})),t):t}getFeatureObjectIdsForAggregate(e){return this._strategy?this._strategy.getFeatureObjectIdsForAggregate(e):[]}onSubscribe(e){this._strategy?.onSubscribe(e)}onUnsubscribe(e){this._strategy?.onUnsubscribe(e)}async update(e,t,r,i,n){const o=e.processor,a=(0,y.i8)(this._schema?.storage,o.storage),l=(0,y.i8)(this._schema?.mesh.properties,o.mesh.properties),c=(0,y.i8)(this._schema?.mesh.factory,o.mesh.factory),u=(0,y.i8)(this._schema?.mesh.strategy,o.mesh.strategy),h=l||c||u;if(!a&&!h&&!i)return;(0,s.A)("esri-2d-update-debug")&&console.debug(`Version[${this._version}] SymbolProcessor.update`,{changes:(0,x.Ui)(this._schema,o),schema:o}),this._schema=o;const d=b.A.fromJSON(this._source.service.outSpatialReference),f=new Ne.l({fields:this._source.metadata.fieldsIndex,spatialReference:d});if(await this._attributeStore.update(o.storage,f,this._source.metadata,d,t),this._strategy?.invalidateAttributeData(),!i&&!h)return;(u||l)&&await this._updateStrategy(o.mesh.strategy,d,n,o.mesh.properties.timeZone),this._updateSortKey(f,"sortKey"in o.mesh.properties?o.mesh.properties.sortKey:null);const p=new D(f,this._proxy,r,this._registry);return(c||"dictionary"===o.mesh.factory.symbology.type)&&(this._factory=await k.create(p,o.mesh.factory)),this._invalidate(),this._version=t,this._connection.container.updateRenderState(this._version)}async applyLocalEdit(e){if(!this._strategy)return;const t=this._strategy.applyLocalEdit(e);for await(const e of t)try{await this._process(e)}catch(e){}}async updateChunks(){this._strategy?.beforeUpdateChunks(),await this._doUpdateChunks(),this._strategy?.afterUpdateChunks()}async removeChunks(e){this._strategy?.removeChunks(e),this._attributeStore.incrementDisplayIdGeneration()}updateHighlight({highlights:e}){if(!this._strategy)return void this._attributeStore.setHighlight(e.map((({objectId:e,highlightFlags:t})=>({objectId:e,highlightFlags:t,displayId:-1}))),e);const t=this._strategy.displayMap(e,(({objectId:e})=>e),((e,{highlightFlags:t},r)=>({objectId:r,displayId:e,highlightFlags:t})));this._attributeStore.setHighlight(t,e)}async _doUpdateChunks(){if(!this._strategy)return;const e=this._strategy.updateChunks(),t=[],r=new Map;for await(const i of e){let e=r.get(i.id);null==e&&(e=new U({concurrency:16,process:e=>this._process(e)}),r.set(i.id,e));const n=e.push(i).catch((e=>(0,a.jH)(e)));t.push(n)}try{await Promise.all(t)}catch(e){}(0,s.A)("esri-2d-update-debug")&&console.log("SendUpdates"),this._attributeStore.sendUpdates(),(0,s.A)("esri-2d-update-debug")&&console.log("SendUpdates.await")}async _updateStrategy(e,t,r,i){switch(this._strategy?.destroy(),e.type){case"feature":this._strategy=new He(this._source,this._attributeStore,i);break;case"binning":this._strategy=await Ue.create(e,t,this._source,this._attributeStore,i);break;case"cluster":this._strategy=await qe.create(this._connection,e,t,this._source,this._attributeStore,i)}for(const e of r)this._strategy.onSubscribe(e)}async _updateSortKey(e,t){if(this._sortInfo=(0,g.pR)(this._sortInfo?.computed),null!=t){const r=t.byRenderer?null:await e.createComputedField(t);this._sortInfo={...t,computed:r}}}_invalidate(){this._strategy&&this._strategy.invalidate()}async _process(e){const t=e.subscription;if((0,s.A)("esri-2d-update-debug")){const r=t.tile;console.debug(`Version[${this._version}] Tile[${r.key.id}, end=${e.end}] Processor._process`)}await this._fetchResources(e),(0,a.Te)(t.signal);const r=await this._write(e,t.tile.createArcadeEvaluationOptions(this._schema?.mesh.properties.timeZone)),i=t.tile.tileInfoView.getLODInfoAt(t.tile.key),{message:n,transferList:o}=r.serialize(i),l={objectIdMap:null,inner:e.createMessage(n,this._version,this._attributeStore.epoch)};if(this._schema?.mesh.properties.returnMeshObjectId){l.objectIdMap={};const t=e.reader?.getCursor();if(t)for(;t.next();)l.objectIdMap[t.getDisplayId()]=t.getObjectId()}if((0,a.Te)(t.signal),await this._connection.container.onMessage(l,{signal:t.signal,transferList:o}),this._attributeStore.sendUpdates(),(0,s.A)("esri-2d-update-debug")){const r=t.tile;console.debug(`Version[${this._version}] Tile[${r.key.id}, end=${e.end}] Processor._process.await`)}}async _fetchResources(e){await this._fetchMatcherResources(e),await this._fetchWriterResources(e)}async _fetchMatcherResources(e){if(e.reader)return this._factory.enqueueMatcherRequests(this._proxy,e.reader)}async _fetchWriterResources(e){if(!e.reader)return;const t=e.reader.getCursor(),r=e.subscription.tile.createArcadeEvaluationOptions(this._schema.mesh.properties.timeZone);for(;t.next();)this._factory.enqueueWriterRequests(this._proxy,t,r);await this._proxy.fetchEnqueuedResources()}async _write(e,t){const r=e.subscription.tile,i=e.reader?.getCursor(),n=i?.getSize()??0,s=r.tileInfoView.tileInfo.isWrappable,o=r.tileInfoView.tileInfo.spatialReference.isWGS84,a=new T(r.key,this._strategy.enablePixelBuffering,s,o,n);if(!i)return a;const l=r.createArcadeEvaluationOptions(this._schema.mesh.properties.timeZone);for(;i.next();){const e=this._getSortKeyValue(i,t);a.entityStart(i.getDisplayId(),e),this._factory.write(a,this._proxy,i,l,r.level),a.entityEnd()}return a}_getSortKeyValue(e,t){if(!this._sortInfo)return 0;const{computed:r,order:i,byRenderer:n}=this._sortInfo,s=n?this._factory.getSortKey(e,t):r?.read(e,t);return null==s||isNaN(s)?0:s*("asc"===i?-1:1)}}var Ye=r(93040),$e=r(90066);class Xe{static from(e){let t=0,r=0,i=0;return e.forEach((e=>{const n=e._readGeometry();n&&(r+=n.isPoint?1:n.lengths.reduce(((e,t)=>e+t),0),i+=n.isPoint?1:n.lengths.length,t+=1)})),new Xe(t,r,i)}constructor(e,t,r){this.featureCount=e,this.vertexCount=t,this.ringCount=r}toJSON(){return{featureCount:this.featureCount,ringCount:this.featureCount,vertexCount:this.featureCount}}}var Qe=r(98737),Je=r(93389),Ke=r(7926),et=r(52038);class tt{static fromSchema(e,t,r){const i="feature"===t.type?t.mutable.dataFilter.queryScaleRanges:[];return new tt(function(e,t,r){const i=e.orderByFields??r.objectIdField+" ASC",n=e.source,s={returnCentroid:!(null!==n&&"object"==typeof n&&"path"in n&&(0,Je.Wo)(n.path))&&"esriGeometryPolygon"===r.serviceGeometryType,returnGeometry:!0,timeReferenceUnknownClient:r.timeReferenceUnknownClient??void 0,outSpatialReference:b.A.fromJSON(e.outSpatialReference),orderByFields:"memory"===e.type?[]:[i],where:t.mutable.dataFilter.definitionExpression??"1=1",outFields:t.mutable.availableFields,multipatchOption:"esriGeometryMultiPatch"===r.serviceGeometryType?"xyFootprint":null};if("feature"===t.type){const{gdbVersion:e,historicMoment:r,timeExtent:i}=t.mutable.dataFilter;return{...s,gdbVersion:e,historicMoment:r?new Date(r):null,timeExtent:i?et.A.fromJSON(i):null,outFields:t.mutable.availableFields}}return s}(e,t,r),i,r.subtypeField,t.mutable.dataFilter.customParameters,r.geometryType,e.queryMetadata)}constructor(e,t,r,i,n,s){this._queryParams=e,this._queryScaleRanges=t,this._subtypeField=r,this._customParameters=i,this._geometryType=n,this._queryMetadata=s}get pageSize(){if(null==this._queryMetadata)throw new Error("InternalError: Service does not support paged queries");const e=this._queryMetadata.supportsMaxRecordCountFactor?4:null,t=(this._queryMetadata.maxRecordCount??8e3)*(e??1);return Math.min(8e3,t)}updateHistoricMoment(e){this._queryParams.historicMoment=e}updateFields(e){this._queryParams.outFields=e}createPatchFieldsQuery(e,t){if(!t.getSize())return null;const r=e.clone();if("*"===this._queryParams.outFields[0]){if("*"===(r.outFields??[])[0])return null;r.outFields=this._queryParams.outFields}else{const e=new Set(this._queryParams.outFields),i=[];for(const r of e)t.hasField(r)||i.push(r);if(0===i.length)return null;r.outFields=i}return r.returnGeometry=!1,r.returnCentroid=!1,r.quantizationParameters=null,r.cacheHint=!0,{inner:r,customParameters:this._customParameters}}createQuery(e={}){if(!this._queryParams)throw new Error("InternalError: queryInfo should be defined");return{inner:new Ke.A({...this._queryParams,...e}),customParameters:this._customParameters}}createTileQuery(e,t){if(null==this._queryMetadata)throw new Error("InternalError: Service does not support tile queries");const r=this.createQuery(t),i=r.inner;if(this._queryScaleRanges.length){const t=this._queryScaleRanges.filter((t=>(!t.minScale||t.minScale>=e.maxScale)&&(!t.maxScale||t.maxScale<=e.minScale))).map((e=>e.subtypeCode));if(t.length){const e=`${this._subtypeField} IN (${t})`;i.where=(0,Qe.m)(i.where,e)}}if(i.quantizationParameters=t.quantizationParameters??e.getQuantizationParameters(),i.resultType="tile",i.geometry=e.extent,this._queryMetadata.supportsQuantization?"esriGeometryPolyline"===this._geometryType&&(i.maxAllowableOffset=e.resolution*(0,s.A)("feature-polyline-generalization-factor")):"esriGeometryPolyline"!==this._geometryType&&"esriGeometryPolygon"!==this._geometryType||(i.maxAllowableOffset=e.resolution,"esriGeometryPolyline"===this._geometryType&&(i.maxAllowableOffset*=(0,s.A)("feature-polyline-generalization-factor"))),i.defaultSpatialReferenceEnabled=this._queryMetadata.supportsDefaultSpatialReference,i.compactGeometryEnabled=this._queryMetadata.supportsCompactGeometry,this._queryMetadata.supportsMaxRecordCountFactor&&(i.maxRecordCountFactor=4),(0,s.A)("esri-tiles-debug")){const t=e.id.replaceAll("/",".");r.customParameters=r.customParameters?{...r.customParameters,tileId:t}:{tileId:t}}return r}createPagedTileQuery(e,t){const r=this.pageSize;return this.createTileQuery(e,{start:r*t,num:r,returnExceededLimitFeatures:!0})}createPagedQuery(e){const t=this.pageSize;return this.createQuery({start:t*e,num:t,returnExceededLimitFeatures:!0,maxRecordCountFactor:4})}}var rt=r(53804),it=r(83525),nt=r(23502),st=r(40633),ot=r(65953);let at=class extends it.A{constructor(e){super(),this._connection=e,this._enabledEventTypes=new Set,this._updateInfo={websocket:0,client:0},this._lastTime=performance.now(),this._queuedCommands=[],this.addHandles([(0,c.watch)((()=>this._strategy?.connectionStatus??"disconnected"),(e=>{this._layerView.setProperty({propertyName:"pipelineConnectionStatus",value:e})}),{initial:!0}),(0,c.watch)((()=>this._strategy?.errorString||null),(e=>this._layerView.setProperty({propertyName:"pipelineErrorString",value:e})),{initial:!0})])}destroy(){this._strategy=null,this.removeAllHandles()}get _layerView(){return this._connection.layerView}set strategy(e){null==this._strategy&&this._resetUpdateInfo(performance.now());const t="event-handles";this.removeHandles(t),null!=e&&(this.addHandles([e.events.on("data-received",(e=>this._onFeature(e))),e.events.on("message-received",(e=>this._onWebSocketMessage(e))),e.events.on("features-updated",(e=>this._onUpdate(e))),e.events.on("tick",(()=>this._onTick()))],t),this._queuedCommands.forEach((t=>t(e))),this._queuedCommands=[]),this._strategy=e}updateCustomParameters(e){null!=e&&this._callOrEnqueue((t=>t.updateCustomParameters(e)))}sendMessageToSocket(e){this._callOrEnqueue((t=>t.sendMessageToSocket(e)))}sendMessageToClient(e){this._callOrEnqueue((t=>t.sendMessageToClient(e)))}enableEvent(e,t){t?this._enabledEventTypes.add(e):this._enabledEventTypes.delete(e)}disconnect(){this._strategy?.disconnect()}connect(){this._strategy?.connect()}clear(){this._strategy?.clear()}_onWebSocketMessage(e){this._enabledEventTypes.has("message-received")&&this._layerView.emitEvent({name:"message-received",event:e})}_onFeature(e){this._updateInfo.websocket++,this._enabledEventTypes.has("data-received")&&this._layerView.emitEvent({name:"data-received",event:{attributes:e.attributes,centroid:e.centroid,geometry:e.geometry}})}_onUpdate(e){this._updateInfo.client+=e}_onTick(){const e=performance.now(),t=e-this._lastTime;if(t>2500){const r=Math.round(this._updateInfo.client/(t/1e3)),i=Math.round(this._updateInfo.websocket/(t/1e3));this._resetUpdateInfo(e),this._layerView.emitEvent({name:"update-rate",event:{client:r,websocket:i}})}}_resetUpdateInfo(e){this._lastTime=e,this._updateInfo.client=0,this._updateInfo.websocket=0}_callOrEnqueue(e){null!=this._strategy?e(this._strategy):this._queuedCommands.push(e)}};(0,rt._)([(0,nt.MZ)()],at.prototype,"_strategy",void 0),at=(0,rt._)([(0,ot.$)("esri.views.2d.layers.features.sources.StreamMessenger")],at);class lt{constructor(e){this._store=e,this._controller=new AbortController}destroy(){this._controller.abort()}get _options(){return{signal:this._controller.signal}}unsafeSetQueryHistoricMoment(e){throw new Error("InternalError: LoadStrategy does not support query info")}async queryOverride(e){throw new Error("InternalError: LoadStrategy does not support fetching")}async queryByObjectId(e){throw new Error("InternalError: LoadStrategy does not support fetching")}async addParquetFile(e){throw new Error("InternalError: LoadStrategy does not support loading blobs")}}var ct=r(37797),ut=r(87280),ht=r(47648),dt=r(68225),ft=r(87036),pt=r(45608);const mt=268435455;class _t{constructor(){this.hasFeatures=!1,this.exceededTransferLimit=!1,this.fieldCount=0,this.featureCount=0,this.objectIdFieldIndex=0,this.vertexCount=0,this.offsets={attributes:new Array,geometry:new Array},this.centroid=new Array}}const gt=268435455,yt=128e3,xt={small:{delta:new Int32Array(128),decoded:new Int32Array(128)},large:{delta:new Int32Array(yt),decoded:new Int32Array(yt)}};function bt(e){return e<=xt.small.delta.length?xt.small:(e<=xt.large.delta.length||(xt.large.delta=new Int32Array(Math.round(1.25*e)),xt.large.decoded=new Int32Array(Math.round(1.25*e))),xt.large)}function wt(e){for(;e.next();){if(1===e.tag())return e.getMessage();e.skip()}return null}function vt(e,t,r,i,n,s){return.5*Math.abs(e*i+r*s+n*t-e*s-r*t-n*i)}function St(e,t,r,i,n){return!!e&&0==t*n-i*r&&t*i+r*n>0}class Tt extends Pe.Y{static fromBuffer(e,t,r=!1){const n=t.geometryType,s=function(e){try{const t=2,r=new dt.A(new Uint8Array(e),new DataView(e));for(;r.next();){if(r.tag()===t)return wt(r.getMessage());r.skip()}}catch(e){const t=new i.A("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:e});st.A.getLogger("esri.view.2d.layers.features.support.FeatureSetReaderPBF").error(t)}return null}(e),o=function(e,t,r=!1){const n=e.asUnsafe(),s=n.pos(),o=new _t;let a=0,l=0,c=null,u=null,h=null,d=!1;const f=[];for(;n.next();)switch(n.tag()){case 1:c=n.getString();break;case 3:u=n.getString();break;case 12:h=n.processMessage(pt.ae);break;case 9:if(o.exceededTransferLimit=n.getBool(),o.exceededTransferLimit){o.offsets.geometry=r?new Float64Array(8e3):new Int32Array(8e3),o.centroid=r?new Float64Array(16e3):new Int32Array(16e3);for(let e=0;e<o.centroid.length;e++)o.centroid[e]=mt}break;case 13:{const e=n.processMessage(pt.cn);e.index=a++,f.push(e);break}case 15:{const e=n.getLength(),i=n.pos()+e;if(!o.exceededTransferLimit){const e=o.offsets.geometry,t=o.centroid;e.push(0),t.push(mt),t.push(mt)}!d&&o.exceededTransferLimit&&(d=!0,o.offsets.attributes=r?new Float64Array(8e3*a):new Uint32Array(8e3*a));let s=l*a;for(;n.pos()<i&&n.next();)switch(n.tag()){case 1:{d?o.offsets.attributes[s++]=n.pos():o.offsets.attributes.push(n.pos());const e=n.getLength();n.skipLen(e);break}case 2:if(t){const e=n.getLength(),t=n.pos()+e;for(;n.pos()<t&&n.next();)switch(n.tag()){case 3:{n.getUInt32();const e=n.getSInt64(),t=n.getSInt64();o.centroid[2*l]=e,o.centroid[2*l+1]=t;break}default:n.skip()}}else{o.offsets.geometry[l]=n.pos();const e=n.getLength();o.vertexCount+=e,n.skipLen(e)}break;case 4:{const e=n.getLength(),t=n.pos()+e;for(;n.pos()<t&&n.next();)switch(n.tag()){case 3:{n.getUInt32();const e=n.getSInt64(),t=n.getSInt64();o.centroid[2*l]=e,o.centroid[2*l+1]=t;break}default:n.skip()}break}default:n.skip()}l++,o.hasFeatures=!0;break}default:n.skip()}const p=c||u;if(!p)throw new i.A("FeatureSet has no objectId or globalId field name");return o.fields=new q.A(f),o.featureCount=l,o.fieldCount=a,o.objectIdFieldIndex=o.fields.get(p)?.index,o.transform=h,o.displayIds=new Uint32Array(o.featureCount),o.groupIds=new Uint16Array(o.featureCount),n.move(s),o}(s,"esriGeometryPoint"===n,r);return new Tt(s,o,t)}constructor(e,t,r){super(r),this._hasNext=!1,this._isPoints=!1,this._featureIndex=-1,this._featureOffset=0,this._cache={area:0,unquantGeometry:void 0,geometry:void 0,centroid:void 0,legacyFeature:void 0,optFeature:void 0},this._parseCaches=new Array,this._geometryType=r.geometryType,this._reader=e,this._header=t,this._hasNext=t.hasFeatures,this._isPoints="esriGeometryPoint"===r.geometryType}get _size(){return this._header.featureCount}get fields(){return this._header.fields}get geometryType(){return this._geometryType}get hasZ(){return!1}get hasM(){return!1}get hasFeatures(){return this._header.hasFeatures}get hasNext(){return this._hasNext}get exceededTransferLimit(){return this._header.exceededTransferLimit}getSize(){return this._size}getInTransform(){return this._header.transform}getCursor(){return this.copy()}getIndex(){return this._featureIndex}setIndex(e){this._cache.area=0,this._cache.unquantGeometry=void 0,this._cache.geometry=void 0,this._cache.centroid=void 0,this._cache.legacyFeature=void 0,this._cache.optFeature=void 0,this._featureIndex=e}getAttributeHash(){let e="";for(const t of this._header.fields.fields)e+=this._readAttributeAtIndex(t.index)+".";return e}getObjectId(){return this._readAttributeAtIndex(this._header.objectIdFieldIndex)}getDisplayId(){return this._header.displayIds[this._featureIndex]}setDisplayId(e){this._header.displayIds[this._featureIndex]=e}readGeometryArea(){return this._cache.area||this._readGeometry(!0),this._cache.area}copy(){const e=this._reader.clone(),t=new Tt(e,this._header,this.metadata);return this.copyInto(t),t}next(){for(this._cache.area=0,this._cache.unquantGeometry=void 0,this._cache.geometry=void 0,this._cache.centroid=void 0,this._cache.legacyFeature=void 0,this._cache.optFeature=void 0;++this._featureIndex<this._size&&!this._getExists(););return this._featureIndex<this._size}_readX(){return this._header.centroid[2*this._featureIndex]}_readY(){return this._header.centroid[2*this._featureIndex+1]}_readServerCentroid(){const e=this._header.centroid[2*this._featureIndex],t=this._header.centroid[2*this._featureIndex+1];return e===gt?null:new ae.A([],[e,t])}_readGeometry(e=!1){if(void 0===this._cache.geometry){let t=null;if(this._isPoints){if(this._header.centroid[2*this._featureIndex]===gt)return null;const e=this._header.centroid[2*this._featureIndex],r=this._header.centroid[2*this._featureIndex+1];t=new ae.A([],[e,r])}else{const r=this._header.offsets.geometry[this._featureIndex],i=this._reader;if(0===r)return null;i.move(r);try{t=e?this._parseGeometryForDisplay(i):this._parseGeometry(i)}catch(e){return null}}return 0===t?.coords.length&&(t=null),this._cache.geometry=t,t}return this._cache.geometry}_readAttribute(e,t){const r=this._header.fields.get(e);if(null==r)return;const i=this._readAttributeAtIndex(r.index),n=this._header.fields.isDateField(r.name);return t?null==i?i:n?new Date(i):i:i}_readAttributes(){const e={};for(const t of this._header.fields.fields)e[t.name]=this._readAttributeAtIndex(t.index);return e}copyInto(e){super.copyInto(e),e._featureIndex=this._featureIndex,e._featureOffset=this._featureOffset,e._hasNext=this._hasNext,e._parseCaches=this._parseCaches}_readAttributeAtIndex(e){let t=this._parseCaches[e];if(t||(t=new ft.P(this.getSize()),this._parseCaches[e]=t),t.has(this._featureIndex))return t.get(this._featureIndex);const r=this._header.offsets.attributes[this._featureIndex*this._header.fieldCount+e],i=this._reader;i.move(r);const n=function(e){const t=e.getLength(),r=e.pos()+t;for(;e.pos()<r&&e.next();)switch(e.tag()){case 1:return e.getString();case 2:return e.getFloat();case 3:return e.getDouble();case 4:return e.getSInt32();case 5:return e.getUInt32();case 6:return e.getInt64();case 7:return e.getUInt64();case 8:return e.getSInt64();case 9:return e.getBool();default:return e.skip(),null}return null}(i);return t.set(this._featureIndex,n),n}_readGeometryDeltaDecoded(e=!1){if(void 0===this._cache.unquantGeometry){const t=this._readGeometry(e);if(!t)return this._cache.unquantGeometry=void 0,null;if(!this.getInTransform())return this._cache.unquantGeometry=t,t;const r=bt(t.coords.length).decoded,i=t.clone(r),n=i.coords;let s=0;for(const e of i.lengths){for(let t=1;t<e;t++){const e=2*(s+t),r=2*(s+t-1);n[e]+=n[r],n[e+1]+=n[r+1]}s+=e}return this._cache.unquantGeometry=i,i}return this._cache.unquantGeometry}_parseGeometry(e){const t=e.asUnsafe(),r=t.getLength(),i=t.pos()+r,n=[],s=[];for(;t.pos()<i&&t.next();)switch(t.tag()){case 2:{const e=t.getUInt32(),r=t.pos()+e;for(;t.pos()<r;)s.push(t.getUInt32());break}case 3:{const e=t.getUInt32(),r=t.pos()+e;for(n.push(t.getSInt64()),n.push(t.getSInt64()),this.hasZ&&t.getSInt64(),this.hasM&&t.getSInt64();t.pos()<r;)n.push(t.getSInt64()),n.push(t.getSInt64()),this.hasZ&&t.getSInt64(),this.hasM&&t.getSInt64();break}default:t.skip()}return new ae.A(s,n)}_parseGeometryForDisplay(e){const t=e.asUnsafe(),r=t.getLength(),i=t.pos()+r,n=[],s=[];let o=0,a=0,l=null,c=0;const u="esriGeometryPolygon"===this.geometryType,h="esriGeometryPolyline"===this.geometryType,d=u||h;for(;t.pos()<i&&t.next();)switch(t.tag()){case 2:{const e=t.getUInt32(),r=t.pos()+e;for(;t.pos()<r;){const e=t.getUInt32();n.push(e),o+=e}l=bt(2*o).delta;break}case 3:{t.getUInt32();const e=2+(this.hasZ?1:0)+(this.hasM?1:0);(0,g.Lw)(l);for(const r of n)if(a+e*r>l.length)for(let e=0;e<r;e++)t.getSInt32(),t.getSInt32(),this.hasZ&&t.getSInt32(),this.hasM&&t.getSInt32();else if(u){const e=this.getAreaSimplificationThreshold(r,this._header.vertexCount);let i=2,n=1;const o=!1;let u=t.getSInt32(),h=t.getSInt32();l[a++]=u,l[a++]=h,this.hasZ&&t.getSInt32(),this.hasM&&t.getSInt32();let f=t.getSInt32(),p=t.getSInt32();for(this.hasZ&&t.getSInt32(),this.hasM&&t.getSInt32();i<r;){let r=t.getSInt32(),s=t.getSInt32();this.hasZ&&t.getSInt32(),this.hasM&&t.getSInt32();const o=u+f,m=h+p;vt(u,h,o,m,o+r,m+s)>=e?(c+=-.5*(o-u)*(m+h),n>1&&St(d,l[a-2],l[a-1],f,p)?(l[a-2]+=f,l[a-1]+=p):(l[a++]=f,l[a++]=p,n++),u=o,h=m):(r+=f,s+=p),f=r,p=s,i++}n<3||o?a-=2*n:(c+=-.5*(u+f-u)*(h+p+h),St(d,l[a-2],l[a-1],f,p)?(l[a-2]+=f,l[a-1]+=p,s.push(n)):(l[a++]=f,l[a++]=p,s.push(++n)))}else{let e=0,i=t.getSInt32(),n=t.getSInt32();this.hasZ&&t.getSInt32(),this.hasM&&t.getSInt32(),l[a++]=i,l[a++]=n,e+=1;for(let s=1;s<r;s++){const r=t.getSInt32(),o=t.getSInt32(),u=i+r,h=n+o;c+=-.5*(u-i)*(h+n),this.hasZ&&t.getSInt32(),this.hasM&&t.getSInt32(),s>2&&St(d,l[a-2],l[a-1],r,o)?(l[a-2]+=r,l[a-1]+=o):(l[a++]=r,l[a++]=o,e+=1),i=u,n=h}s.push(e)}break}default:t.skip()}return this._cache.area=c,s.length?new ae.A(s,l):null!=l?this._createQuantizedExtrudedGeometry(l[0],l[1]):null}}class It{constructor(e,t){this.service=e,this._metadata=t}destroy(){}}class Mt extends It{constructor(e,t){super(e,t),this._portsOpen=async function(e){const t=new ct.A;return await t.open(e,{}),t}(e.source).then((e=>this.client=e))}destroy(){this.client.close(),this.client=null}async executeQuery(e,t){await this._portsOpen;const r=await this.client.invoke("queryFeatures",e.toJSON(),t);return Fe.fromFeatureSet(r,this._metadata)}}class At extends It{async executeQuery(e,t){const{data:r}=await(0,$e.kS)(this.service.source,e,t),i=!e.quantizationParameters;return Tt.fromBuffer(r,this._metadata,i)}}class Et extends It{async executeQuery(e,t){const{source:r,queryMetadata:i}=this.service;if(null!=e.quantizationParameters&&!i.supportsQuantization){const i=e.clone(),n=(0,ut.VV)(i.quantizationParameters);i.quantizationParameters=null;const{data:s}=await(0,$e.eW)(r,i,this._metadata.spatialReference,t),o=(0,G.q3)(s,this._metadata.objectIdField);return(0,G.jH)(n,o),Fe.fromOptimizedFeatureSet(o,this._metadata)}const{data:n}=await(0,$e.eW)(r,e,this._metadata.spatialReference,t);return"esriGeometryPoint"===this._metadata.geometryType&&(n.features=n.features?.filter((e=>{if(null!=e.geometry){const t=e.geometry;return Number.isFinite(t.x)&&Number.isFinite(t.y)}return!0}))),Fe.fromFeatureSet(n,this._metadata)}}class Pt extends It{async executeQuery(e,t){if(e.quantizationParameters&&!this.service.queryMetadata.supportsQuantization){const r=e.clone(),i=(0,ut.VV)(r.quantizationParameters);r.quantizationParameters=null;const n=await(0,ht.I)(this.service.source,e,t);return(0,G.jH)(i,n),Fe.fromOptimizedFeatureSet(n,this._metadata)}const r=await(0,ht.I)(this.service.source,e,t);return Fe.fromOptimizedFeatureSet(r,this._metadata)}}class Ct extends lt{constructor(e,t,r,i,n){super(r),this._serviceInfo=e,this._queryInfo=t,this._metadata=i,this._connection=n,this._queue=new z.e({concurrency:16,process:async e=>{const t={signal:e.options?.signal,query:e.query.customParameters};return this._adapter.executeQuery(e.query.inner,t)}}),this._adapter=function(e,t){switch(e.type){case"memory":return new Mt(e,t);case"ogc":return new Pt(e,t);case"feature-service":return e.queryMetadata.supportsFormatPBF&&(0,s.A)("featurelayer-pbf")?new At(e,t):new Et(e,t)}}(e,i)}unsafeSetQueryHistoricMoment(e){this._queryInfo.updateHistoricMoment(e)}async updateFields(e){this._queryInfo.updateFields(e);const t=Array.from(this._store.chunks()).map((async e=>{const t=Ke.A.fromJSON(e.queryInfo.queryJSON);if(t)try{return await this._tryUpdateFields(e.reader,t),null}catch(e){return e}})),r=(await Promise.all(t)).filter((e=>e));if(r.length)throw new i.A("featurelayer-query","Encountered errors when downloading fields",{errors:r})}async queryByObjectId(e){if(0===e.length)return Fe.empty(this._metadata);const t=this._queryInfo.createQuery({objectIds:e});return this._fetch(t)}async _fetch(e,t){const r=await this._enqueue(e,t);return await this._tryUpdateFields(r,e.inner),r}async _tryUpdateFields(e,t){const r=this._queryInfo.createPatchFieldsQuery(t,e);if(!r)return;const i=await this._enqueue(r,this._options);e.joinAttributes(i)}async _enqueue(e,t){return this._connection.onEvent({type:"fetchStart"}),this._queue.push({query:e,options:t}).finally((()=>{this._connection.onEvent({type:"fetchEnd",done:0===this._queue.length})}))}}class Rt extends Ct{constructor(){super(...arguments),this._chunksById=new Map}unload(e){this._removeChunks(e.tile)}_addChunk(e){const t=e.tile.id;this._chunksById.has(t)||this._chunksById.set(t,[]);const r=e.size();(r||e.first||e.end)&&((0,s.A)("esri-2d-update-debug")&&console.debug(`Chunk[${e.chunkId}] ATileLoadStrategy.addChunk [count=${r}]`),this._chunksById.get(t).push(e),this._store.insert(e))}_removeChunks(e){const t=this._chunksById.get(e.key.id)??[];for(const r of t)(0,s.A)("esri-2d-update-debug")&&console.debug(`Tile[${e.key.id}] Chunk[${r.chunkId}] ATileLoadStrategy.removeChunk`),this._store.remove(r);this._chunksById.delete(e.key.id)}}class Ft extends Re{constructor(e,t,r,i,n,s){super(),this._reader=e,this._queryJSON=t,this._tile=r,this._sourceTile=i,this._sourceTileDepth=n,this._end=s,this.chunkId=`${this._tile.key.id}.${this._sourceTile?.key.id}${this._end?"e":""}`,this.normalizedChunkId=`${this._tile.key.normalizedId}.${this._sourceTile?.key.normalizedId}${this._end?"e":""}`}get queryInfo(){return{type:"drill-down-tile",chunkId:this.chunkId,tileId:this._tile.key.id,queryJSON:this._queryJSON,sourceTileDepth:this._sourceTileDepth,sourceTileId:this._sourceTile?.key.id,size:this.size(),end:this.end}}get first(){return 0===this._sourceTileDepth}get reader(){return this._reader}get end(){return this._end}get tile(){return this._tile}get isTiled(){return!0}getTileReader(e){return this._tile.key.id===e.key.id?this.reader:null}}class Lt{constructor(e,t){this.subscription=e,this._tileIdToResult=new Map,this._controller=new AbortController,this._handles=(0,n.vE)([(0,a.u7)(e.signal,(()=>this._controller.abort())),(0,a.u7)(t,(()=>this._controller.abort()))])}destroy(){this._controller.abort(),this._handles.remove()}get(e){return this._tileIdToResult.get(e)}set(e,t){this._tileIdToResult.set(e,t)}get options(){return{signal:this._controller.signal}}}class kt extends Rt{constructor(){super(...arguments),this._loadStates=new Map}destroy(){super.destroy();for(const e of this._loadStates.values())e.destroy();this._loadStates.clear()}get about(){return{willQueryAllFeatures:!1,willQueryFullResolutionGeometry:!1}}async load(e){this._loadStates.has(e.key.id)||this._loadStates.set(e.key.id,new Lt(e,this._options));const t=this._loadStates.get(e.key.id);let r;try{for await(const r of this._fetchChunkInfos(t,e.tile,0)){const{queryJSON:e,reader:i,sourceTile:n,sourceTileDepth:s,tile:o}=r,l=new Ft(i,e,o,n,s,!1);(0,a.Te)(t.options),this._addChunk(l)}}catch(e){r=e}const i=new Ft(Fe.empty(this._metadata),null,e.tile,null,-1,!0);if(this._addChunk(i),r)throw r}unload(e){super.unload(e),this._loadStates.get(e.key.id)?.destroy(),this._loadStates.delete(e.key.id)}async*_fetchChunkInfos(e,t,r){let i=e.get(t.id);const n=!!i;if(i||(i=await this._fetchChunkInfo(e,t,r),e.set(t.id,i)),i.reader.exceededTransferLimit&&r<(0,s.A)("featurelayer-query-max-depth"))for(const i of t.createChildTiles())yield*this._fetchChunkInfos(e,i,r+1);else n||(yield i)}async _fetchChunkInfo(e,t,r){const i=e.subscription.tile.getQuantizationParameters(),n=this._queryInfo.createTileQuery(t,{returnExceededLimitFeatures:!1,quantizationParameters:i});return{reader:await this._fetch(n,e.options),queryJSON:n.inner.toJSON(),tile:e.subscription.tile,sourceTile:t,sourceTileDepth:r}}}class Nt extends Re{constructor(e,t,r,i,n){super(),this._reader=e,this._queryJSON=t,this._tile=r,this._page=i,this._end=n,this.chunkId=`${this._tile.key.id}.${this._page}${this.end?"e":""}`,this.normalizedChunkId=`${this._tile.key.normalizedId}.${this._page}${this.end?"e":""}`}get queryInfo(){return{type:"paged-tile",chunkId:this.chunkId,tileId:this._tile.key.id,queryJSON:this._queryJSON,page:this._page,size:this.size(),end:this.end}}get reader(){return this._reader}get first(){return 0===this._page}get end(){return this._end}get page(){return this._page}get tile(){return this._tile}get isTiled(){return!0}getTileReader(e){return this._tile.key.id===e.key.id?this.reader:null}}class Ot{constructor(e,t){this.subscription=e,this._pages=new Set,this._controller=new AbortController,this._done=!1,this._handles=(0,n.vE)([(0,a.u7)(e.signal,(()=>this._controller.abort())),(0,a.u7)(t,(()=>this._controller.abort()))])}destroy(){this._controller.abort(),this._handles.remove()}get pageStart(){let e=-1;for(const t of this._pages.values())e=Math.max(e,t);return e+1}get done(){return this._done}get options(){return{signal:this._controller.signal}}add(e,t){this._pages.add(e),this._done=this._done||t}}class Dt extends Rt{constructor(){super(...arguments),this._loadStates=new Map}destroy(){super.destroy();for(const e of this._loadStates.values())e.destroy();this._loadStates.clear()}get about(){return{willQueryAllFeatures:!1,willQueryFullResolutionGeometry:!1}}async load(e){this._loadStates.has(e.key.id)||this._loadStates.set(e.key.id,new Ot(e,this._options));const t=this._loadStates.get(e.key.id);let r;try{await this._fetchPages(t)}catch(e){r=e}const i=new Nt(Fe.empty(this._metadata),null,e.tile,-1,!0);if((0,a.G4)(t.options)||this._addChunk(i),r)throw r}unload(e){super.unload(e),this._loadStates.get(e.key.id)?.destroy(),this._loadStates.delete(e.key.id)}async _fetchPages(e){let t=0,r=e.pageStart,i=1;for(;t<20&&!e.done;){const n=[];for(let t=0;t<i;t++)n.push(this._fetchChunk(e,r++));const s=await Promise.all(n);for(const t of s)(0!==t.size()||t.first)&&(e.add(t.page,!t.reader.exceededTransferLimit),(0,a.Te)(e.options),this._addChunk(t));t++,i=Math.min(i+1,4)}}async _fetchChunk(e,t){const r=e.subscription.tile,i=this._queryInfo.createPagedTileQuery(r,t),n=await this._fetch(i,e.options);return new Nt(n,i.inner.toJSON(),r,t,!1)}}var zt=r(17660),Ut=r(53216);let Gt;const Bt=new Array(128).fill(void 0);function Vt(e){return Bt[e]}Bt.push(void 0,null,!0,!1);let qt=Bt.length;function Zt(e){const t=Vt(e);return function(e){e<132||(Bt[e]=qt,qt=e)}(e),t}function Ht(e){qt===Bt.length&&Bt.push(Bt.length+1);const t=qt;return qt=Bt[t],Bt[t]=e,t}const jt="undefined"!=typeof TextDecoder?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};"undefined"!=typeof TextDecoder&&jt.decode();let Wt=null;function Yt(){return null!==Wt&&0!==Wt.byteLength||(Wt=new Uint8Array(Gt.memory.buffer)),Wt}function $t(e,t){return e>>>=0,jt.decode(Yt().subarray(e,e+t))}const Xt="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>{Gt.__wbindgen_export_0.get(e.dtor)(e.a,e.b)}));function Qt(e,t,r){Gt._dyn_core__ops__function__FnMut__A____Output___R_as_wasm_bindgen__closure__WasmClosure___describe__invoke__h7be72b1871260ae2(e,t,Ht(r))}let Jt=0;const Kt="undefined"!=typeof TextEncoder?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},er="function"==typeof Kt.encodeInto?function(e,t){return Kt.encodeInto(e,t)}:function(e,t){const r=Kt.encode(e);return t.set(r),{read:e.length,written:r.length}};function tr(e,t,r){if(void 0===r){const r=Kt.encode(e),i=t(r.length,1)>>>0;return Yt().subarray(i,i+r.length).set(r),Jt=r.length,i}let i=e.length,n=t(i,1)>>>0;const s=Yt();let o=0;for(;o<i;o++){const t=e.charCodeAt(o);if(t>127)break;s[n+o]=t}if(o!==i){0!==o&&(e=e.slice(o)),n=r(n,i,i=o+3*e.length,1)>>>0;const t=Yt().subarray(n+o,n+i);o+=er(e,t).written,n=r(n,i,o,1)>>>0}return Jt=o,n}let rr=null;function ir(){return(null===rr||!0===rr.buffer.detached||void 0===rr.buffer.detached&&rr.buffer!==Gt.memory.buffer)&&(rr=new DataView(Gt.memory.buffer)),rr}function nr(e,t){try{return e.apply(this,t)}catch(e){Gt.__wbindgen_exn_store(Ht(e))}}let sr=null;function or(e,t){const r=t(2*e.length,2)>>>0;return(null!==sr&&0!==sr.byteLength||(sr=new Uint16Array(Gt.memory.buffer)),sr).set(e,r/2),Jt=e.length,r}function ar(e,t,r){const i=tr(e,Gt.__wbindgen_malloc,Gt.__wbindgen_realloc),n=Jt;return Zt(Gt.readMetadata(i,n,Ht(t),Ht(r)))}function lr(e,t){if(!(e instanceof t))throw new Error(`expected instance of ${t.name}`);return e.ptr}function cr(e){return null==e}const ur="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>Gt.__wbg_fieldmetadata_free(e>>>0,1)));class hr{static __wrap(e){e>>>=0;const t=Object.create(hr.prototype);return t.__wbg_ptr=e,ur.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ur.unregister(this),e}free(){const e=this.__destroy_into_raw();Gt.__wbg_fieldmetadata_free(e,0)}get name(){let e,t;try{const n=Gt.__wbindgen_add_to_stack_pointer(-16);Gt.fieldmetadata_name(n,this.__wbg_ptr);var r=ir().getInt32(n+0,!0),i=ir().getInt32(n+4,!0);return e=r,t=i,$t(r,i)}finally{Gt.__wbindgen_add_to_stack_pointer(16),Gt.__wbindgen_free(e,t,1)}}get index(){return Gt.fieldmetadata_index(this.__wbg_ptr)}get type(){return["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeBigInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"][Gt.fieldmetadata_esri_type(this.__wbg_ptr)]}}const dr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>Gt.__wbg_filemetadata_free(e>>>0,1)));class fr{static __wrap(e){e>>>=0;const t=Object.create(fr.prototype);return t.__wbg_ptr=e,dr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,dr.unregister(this),e}free(){const e=this.__destroy_into_raw();Gt.__wbg_filemetadata_free(e,0)}version(){return Gt.filemetadata_version(this.__wbg_ptr)}numRows(){return Gt.filemetadata_numRows(this.__wbg_ptr)>>>0}numFields(){return Gt.filemetadata_numFields(this.__wbg_ptr)>>>0}keyValueMetadata(e){try{const i=Gt.__wbindgen_add_to_stack_pointer(-16),n=tr(e,Gt.__wbindgen_malloc,Gt.__wbindgen_realloc),s=Jt;Gt.filemetadata_keyValueMetadata(i,this.__wbg_ptr,n,s);var t=ir().getInt32(i+0,!0),r=ir().getInt32(i+4,!0);let o;return 0!==t&&(o=$t(t,r).slice(),Gt.__wbindgen_free(t,1*r,1)),o}finally{Gt.__wbindgen_add_to_stack_pointer(16)}}getFieldIndex(e){const t=tr(e,Gt.__wbindgen_malloc,Gt.__wbindgen_realloc),r=Jt,i=Gt.filemetadata_getFieldIndex(this.__wbg_ptr,t,r);return 16777215===i?void 0:i}getFieldByIndex(e){const t=Gt.filemetadata_getFieldByIndex(this.__wbg_ptr,e);return 0===t?void 0:hr.__wrap(t)}}const pr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>Gt.__wbg_geometryinfodescriptor_free(e>>>0,1)));class mr{static __wrap(e){e>>>=0;const t=Object.create(mr.prototype);return t.__wbg_ptr=e,pr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,pr.unregister(this),e}free(){const e=this.__destroy_into_raw();Gt.__wbg_geometryinfodescriptor_free(e,0)}get wkbIndex(){const e=Gt.__wbg_get_geometryinfodescriptor_wkbIndex(this.__wbg_ptr);return 16777215===e?void 0:e}set wkbIndex(e){Gt.__wbg_set_geometryinfodescriptor_wkbIndex(this.__wbg_ptr,cr(e)?16777215:e)}get lngIndex(){const e=Gt.__wbg_get_geometryinfodescriptor_lngIndex(this.__wbg_ptr);return 16777215===e?void 0:e}set lngIndex(e){Gt.__wbg_set_geometryinfodescriptor_lngIndex(this.__wbg_ptr,cr(e)?16777215:e)}get latIndex(){const e=Gt.__wbg_get_geometryinfodescriptor_latIndex(this.__wbg_ptr);return 16777215===e?void 0:e}set latIndex(e){Gt.__wbg_set_geometryinfodescriptor_latIndex(this.__wbg_ptr,cr(e)?16777215:e)}static new(){const e=Gt.geometryinfodescriptor_new();return mr.__wrap(e)}}const _r="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>Gt.__wbg_parquetchunk_free(e>>>0,1)));class gr{static __wrap(e){e>>>=0;const t=Object.create(gr.prototype);return t.__wbg_ptr=e,_r.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,_r.unregister(this),e}free(){const e=this.__destroy_into_raw();Gt.__wbg_parquetchunk_free(e,0)}size(){return Gt.parquetchunk_size(this.__wbg_ptr)>>>0}hasField(e){return 0!==Gt.parquetchunk_hasField(this.__wbg_ptr,e)}readX(e){return Gt.parquetchunk_readX(this.__wbg_ptr,e)}readY(e){return Gt.parquetchunk_readY(this.__wbg_ptr,e)}readAttributes(e){return Zt(Gt.parquetchunk_readAttributes(this.__wbg_ptr,e))}readAttribute(e,t){return Zt(Gt.parquetchunk_readAttribute(this.__wbg_ptr,e,t))}}const yr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>Gt.__wbg_parquetfile_free(e>>>0,1)));let xr=class e{static __wrap(t){t>>>=0;const r=Object.create(e.prototype);return r.__wbg_ptr=t,yr.register(r,r.__wbg_ptr,r),r}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,yr.unregister(this),e}free(){const e=this.__destroy_into_raw();Gt.__wbg_parquetfile_free(e,0)}metadata(){const e=Gt.parquetfile_metadata(this.__wbg_ptr);return fr.__wrap(e)}readChunksWithCallback(e,t){const r=or(e,Gt.__wbindgen_malloc),i=Jt;return Zt(Gt.parquetfile_readChunksWithCallback(this.__wbg_ptr,r,i,Ht(t)))}updateChunks(e){const t=or(e,Gt.__wbindgen_malloc),r=Jt;return Zt(Gt.parquetfile_updateChunks(this.__wbg_ptr,t,r))}};const br="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>Gt.__wbg_rangeproviderjs_free(e>>>0,1)));class wr{static __wrap(e){e>>>=0;const t=Object.create(wr.prototype);return t.__wbg_ptr=e,br.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,br.unregister(this),e}free(){const e=this.__destroy_into_raw();Gt.__wbg_rangeproviderjs_free(e,0)}static new(e,t){const r=Gt.rangeproviderjs_new(Ht(e),Ht(t));return wr.__wrap(r)}static withFetch(){const e=Gt.rangeproviderjs_withFetch();return wr.__wrap(e)}}function vr(){const e={wbg:{}};return e.wbg.__wbg_new_abda76e883ba8a5f=function(){return Ht(new Error)},e.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const r=tr(Vt(t).stack,Gt.__wbindgen_malloc,Gt.__wbindgen_realloc),i=Jt;ir().setInt32(e+4,i,!0),ir().setInt32(e+0,r,!0)},e.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let r,i;try{r=e,i=t,console.error($t(e,t))}finally{Gt.__wbindgen_free(r,i,1)}},e.wbg.__wbindgen_object_drop_ref=function(e){Zt(e)},e.wbg.__wbindgen_is_function=function(e){return"function"==typeof Vt(e)},e.wbg.__wbg_self_3093d5d1f7bcb682=function(){return nr((function(){return Ht(self.self)}),arguments)},e.wbg.__wbg_window_3bcfc4d31bc012f8=function(){return nr((function(){return Ht(window.window)}),arguments)},e.wbg.__wbg_globalThis_86b222e13bdf32ed=function(){return nr((function(){return Ht(globalThis.globalThis)}),arguments)},e.wbg.__wbg_global_e5a3fe56f8be9485=function(){return nr((function(){return Ht(global.global)}),arguments)},e.wbg.__wbindgen_is_undefined=function(e){return void 0===Vt(e)},e.wbg.__wbg_newnoargs_76313bd6ff35d0f2=function(e,t){return Ht(new Function($t(e,t)))},e.wbg.__wbindgen_object_clone_ref=function(e){return Ht(Vt(e))},e.wbg.__wbindgen_number_new=function(e){return Ht(e)},e.wbg.__wbg_new_525245e2b9901204=function(){return Ht(new Object)},e.wbg.__wbindgen_string_new=function(e,t){return Ht($t(e,t))},e.wbg.__wbg_call_1084a111329e68ce=function(){return nr((function(e,t){return Ht(Vt(e).call(Vt(t)))}),arguments)},e.wbg.__wbg_call_89af060b4e1523f2=function(){return nr((function(e,t,r){return Ht(Vt(e).call(Vt(t),Vt(r)))}),arguments)},e.wbg.__wbg_call_7de908392845a9a5=function(){return nr((function(e,t,r,i,n){return Ht(Vt(e).call(Vt(t),Vt(r),Vt(i),Vt(n)))}),arguments)},e.wbg.__wbg_valueOf_563b3487b1b116aa=function(e){return Vt(e).valueOf()},e.wbg.__wbg_set_eacc7d73fefaafdf=function(){return nr((function(e,t,r){return Reflect.set(Vt(e),Vt(t),Vt(r))}),arguments)},e.wbg.__wbg_buffer_b7b08af79b0b0974=function(e){return Ht(Vt(e).buffer)},e.wbg.__wbg_new_b85e72ed1bfd57f9=function(e,t){try{var r={a:e,b:t};return Ht(new Promise(((e,t)=>{const i=r.a;r.a=0;try{return function(e,t,r,i){Gt.wasm_bindgen__convert__closures__invoke2_mut__h35729c14da098d24(e,t,Ht(r),Ht(i))}(i,r.b,e,t)}finally{r.a=i}})))}finally{r.a=r.b=0}},e.wbg.__wbg_resolve_570458cb99d56a43=function(e){return Ht(Promise.resolve(Vt(e)))},e.wbg.__wbg_then_95e6edc0f89b73b1=function(e,t){return Ht(Vt(e).then(Vt(t)))},e.wbg.__wbg_then_876bb3c633745cc6=function(e,t,r){return Ht(Vt(e).then(Vt(t),Vt(r)))},e.wbg.__wbg_new_ea1883e1e5e86686=function(e){return Ht(new Uint8Array(Vt(e)))},e.wbg.__wbg_length_8339fcf5d8ecd12e=function(e){return Vt(e).length},e.wbg.__wbg_set_d1e79e2388520f18=function(e,t,r){Vt(e).set(Vt(t),r>>>0)},e.wbg.__wbindgen_throw=function(e,t){throw new Error($t(e,t))},e.wbg.__wbindgen_memory=function(){return Ht(Gt.memory)},e.wbg.__wbg_queueMicrotask_48421b3cc9052b68=function(e){return Ht(Vt(e).queueMicrotask)},e.wbg.__wbindgen_cb_drop=function(e){const t=Zt(e).original;return 1==t.cnt--&&(t.a=0,!0)},e.wbg.__wbg_queueMicrotask_12a30234db4045d3=function(e){queueMicrotask(Vt(e))},e.wbg.__wbg_parquetchunk_new=function(e){return Ht(gr.__wrap(e))},e.wbg.__wbindgen_bigint_from_i64=function(e){return Ht(e)},e.wbg.__wbg_parquetfile_new=function(e){return Ht(xr.__wrap(e))},e.wbg.__wbg_filemetadata_new=function(e){return Ht(fr.__wrap(e))},e.wbg.__wbindgen_closure_wrapper1401=function(e,t,r){return Ht(function(e,t,r,i){const n={a:e,b:t,cnt:1,dtor:74},s=(...e)=>{n.cnt++;const t=n.a;n.a=0;try{return i(t,n.b,...e)}finally{0==--n.cnt?(Gt.__wbindgen_export_0.get(n.dtor)(t,n.b),Xt.unregister(n)):n.a=t}};return s.original=n,Xt.register(s,n,n),s}(e,t,0,Qt))},e}function Sr(e,t){return Gt=e.exports,Tr.__wbindgen_wasm_module=t,rr=null,sr=null,Wt=null,Gt}async function Tr(e){if(void 0!==Gt)return Gt;void 0!==e&&Object.getPrototypeOf(e)===Object.prototype?({module_or_path:e}=e):console.warn("using deprecated parameters for the initialization function; pass a single object instead");const t=vr();("string"==typeof e||"function"==typeof Request&&e instanceof Request||"function"==typeof URL&&e instanceof URL)&&(e=fetch(e));const{instance:r,module:i}=await async function(e,t){if("function"==typeof Response&&e instanceof Response){if("function"==typeof WebAssembly.instantiateStreaming)try{return await WebAssembly.instantiateStreaming(e,t)}catch(t){if("application/wasm"==e.headers.get("Content-Type"))throw t;console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",t)}const r=await e.arrayBuffer();return await WebAssembly.instantiate(r,t)}{const r=await WebAssembly.instantiate(e,t);return r instanceof WebAssembly.Instance?{instance:r,module:e}:r}}(await e,t);return Sr(r,i)}const Ir=Object.freeze(Object.defineProperty({__proto__:null,FieldMetadata:hr,FileMetadata:fr,GeometryInfoDescriptor:mr,ParquetChunk:gr,ParquetFile:xr,RangeProviderJs:wr,default:Tr,enableTracing:function(){Gt.enableTracing()},initSync:function(e){if(void 0!==Gt)return Gt;void 0!==e&&Object.getPrototypeOf(e)===Object.prototype?({module:e}=e):console.warn("using deprecated parameters for `initSync()`; pass a single object instead");const t=vr();return e instanceof WebAssembly.Module||(e=new WebAssembly.Module(e)),Sr(new WebAssembly.Instance(e,t),e)},readFile:function(e,t,r,i,n){const s=tr(e,Gt.__wbindgen_malloc,Gt.__wbindgen_realloc),o=Jt;lr(i,fr);var a=i.__destroy_into_raw();lr(n,mr);var l=n.__destroy_into_raw();return Zt(Gt.readFile(s,o,Ht(t),Ht(r),a,l))},readMetadata:ar},Symbol.toStringTag,{value:"Module"}));let Mr=null;async function Ar(){return Mr||(Mr=async function(){const e=await Promise.resolve().then((()=>Ir));return await e.default({module_or_path:(0,Ut.s)("esri/libs/parquet/pkg/arcgis_parquet_bg.wasm")}),e.enableTracing(),e}()),Mr}const Er=e=>async function(t,r,i){const n=e(),{data:s}=await(0,Ye.A)(t,{responseType:"array-buffer",query:n,headers:{range:`bytes=${r}-${i}`}});return s},Pr=e=>async function(t){const r=e(),{data:i}=await(0,Ye.A)(t,{responseType:"native",method:"head",query:r}),n=i.headers.get("Content-Length");if(null==n)throw new Error("Unable to parse content length");return parseInt(n,10)};class Cr{static async create(e,t){const r=await Ar(),i=await r.readMetadata(e,Er(t),Pr(t));return Cr.fromFileMetadata(i)}static fromFileMetadata(e){const t=[];for(let r=0;r<e.numFields();r++){const i=e.getFieldByIndex(r);t.push({name:i.name,type:i.type,alias:i.name,index:i.index}),i.free()}return new Cr(e,t)}constructor(e,t){this._inner=e,this.fields=t}destroy(){this._inner.free()}[Symbol.dispose](){this.destroy()}get size(){return this._inner.numRows()}getFieldIndex(e){return this._inner.getFieldIndex(e)}tryReadGeoMetadata(){const e=this._inner.keyValueMetadata("geo");return null==e?null:JSON.parse(e)}}class Rr{static async create(e,t){const r=await Ar(),i=Er(t.getCustomParameters),n=Pr(t.getCustomParameters),s=await ar(e,i,n),{geometryInfo:o}=t,a=mr.new();"location"===o.type?(a.latIndex=s.getFieldIndex(o.latitudeFieldName),a.lngIndex=s.getFieldIndex(o.longitudeFieldName)):a.wkbIndex=s.getFieldIndex(o.primaryFieldName);const l=await r.readFile(e,i,n,s,a);return new Rr(l,Cr.fromFileMetadata(l.metadata()))}constructor(e,t){this.inner=e,this.metadata=t}destroy(){this.inner.free(),this.metadata.destroy()}[Symbol.dispose](){this.destroy()}}class Fr extends Re{constructor(e,t,r,i){super(),this._reader=e,this._queryJSON=t,this._page=r,this._end=i,this.chunkId=`${this._page}${this.end?"e":""}`,this.normalizedChunkId=this.chunkId}get reader(){return this._reader}get first(){return 0===this._page}get end(){return this._end}get queryInfo(){return{type:"snapshot",chunkId:this.chunkId,queryJSON:this._queryJSON,page:this._page,size:this.size(),end:this.end}}get isTiled(){return!1}getTileReader(e){const t=this.queryFeaturesInBounds(e.bounds);return t.setTransformForDisplay(e.transform),t}}var Lr=r(1644);class kr extends Pe.Y{constructor(e,t,r,i,n,s=new Uint32Array(i.size())){super(e),this._fields=t,this._geometryInfo=r,this._inner=i,this._chunkId=n,this._displayIds=s,this._index=-1,this._size=this._inner.size(),"geometry"===this._geometryInfo.type&&(this._primaryGeometryIndex=this._fields.get(this._geometryInfo.primaryFieldName)?.index),null!=e.objectIdField&&(this._objectIdFieldIndex=this._fields.get(e.objectIdField)?.index),this._chunkId>65535&&console.error("Exceeded max allowed parquet reader size")}destroy(){super.destroy(),this._inner.free()}get fields(){return this._fields}get geometryType(){return"esriGeometryPoint"}get hasFeatures(){return!0}get hasNext(){throw new Error("Method not implemented.")}get exceededTransferLimit(){return!1}get hasZ(){return!1}get hasM(){return!1}getInTransform(){return null}getSize(){return this._size}getCursor(){return this.copy()}getAttributeHash(){let e="";for(const t of this.fields.fields)e+=this._readAttribute(t.name,!1)+".";return e}getObjectId(){return null!=this._objectIdFieldIndex?this._inner.readAttribute(this._index,this._objectIdFieldIndex):this._index<<16|this._chunkId}getDisplayId(){return this._displayIds[this._index]}setDisplayId(e){this._displayIds[this._index]=e}setIndex(e){this._index=e}getIndex(){return this._index}next(){for(;++this._index<this._size&&!this._getExists(););return this._index<this._size}readGeometryArea(){throw new Error("Method not implemented.")}copy(){const e=new kr(this.metadata,this._fields,this._geometryInfo,this._inner,this._chunkId,this._displayIds);return this.copyInto(e),e}copyInto(e){super.copyInto(e),e._index=this._index}_readGeometry(e){const t=(0,Lr.je)(this._inner.readX(this._index),this._inner.readY(this._index));return new ae.A([],t)}_readX(){return this._readGeometry()?.coords[0]}_readY(){return this._readGeometry()?.coords[1]}_readServerCentroid(){return null}_readAttribute(e,t){const r=this.fields.get(e);if(!r)return;const i=this._inner.readAttribute(this._index,r.index);if(null==i)return i;const n=this.fields.isDateField(r.name);return t?null==i?i:n?new Date(i):i:i}_readAttributes(){const e={};for(const t of this._fields.fields)this._inner.hasField(t.index)&&t.index!==this._primaryGeometryIndex&&(e[t.name]=this._readAttribute(t.name,!1));return null==this._objectIdFieldIndex&&(e.__OBJECTID=this.getObjectId()),e}}class Nr extends lt{constructor(e,t,r,i){super(i),this._service=e,this._metadata=t,this._schema=r,this._chunkId=0,this._files=[],this._availableFields=new Set(r.mutable.availableFields);const{geometryInfo:n}=this._service;"location"===n.type?(this._availableFields.add(n.latitudeFieldName),this._availableFields.add(n.longitudeFieldName)):this._availableFields.add(n.primaryFieldName)}destroy(){for(const e of this._files)e.destroy()}get about(){return{willQueryAllFeatures:!0,willQueryFullResolutionGeometry:!0}}async updateFields(e){await this._promise;const t=new Set(e),r=(0,zt.iv)(t,this._availableFields);this._availableFields=(0,zt.KC)(r,this._availableFields),await Promise.all(this._files.map((e=>{const t=Array.from(r).map((t=>e.metadata.getFieldIndex(t)));return e.inner.updateChunks(new Uint16Array(t))})))}async load(e){return null==this._promise&&(this._promise=this._download()),this._promise}unload(e){}async addParquetFile(e){this._insert(e)}async _insert(e){const t=await Rr.create(e,{geometryInfo:this._service.geometryInfo,outSpatialReference:this._service.outSpatialReference,getCustomParameters:()=>this._schema.mutable.dataFilter.customParameters}),{geometryInfo:r}=this._service;(0,a.Te)(this._options);const{fields:i,timeZoneByFieldName:n}=this._service.metadata.fieldsIndex,s=i.map((e=>({...e,index:t.metadata.getFieldIndex(e.name)}))),o=q.A.fromJSON({fields:s,timeZoneByFieldName:n}),l=new Uint16Array(Array.from(this._availableFields.values()).map((e=>o.get(e)?.index)));await t.inner.readChunksWithCallback(l,(e=>{const t=this._chunkId++,i=new kr(this._metadata,o,r,e,t),n=new Fr(i,null,t,!1);this._store.insert(n)})),this._files.push(t)}async _download(){try{await Promise.all(this._service.source.urls.map((e=>this._insert(e))));const e=new Fr(Fe.empty(this._metadata),null,-1,!0);this._store.insert(e)}catch(e){throw console.error(e),e}}}class Or extends Ct{constructor(e,t,r,i,n,s){super(e,t,r,n,s),this._random=new l.A(1e3),this._featureCount=i}get about(){return{willQueryAllFeatures:!0,willQueryFullResolutionGeometry:!0}}load(e){return null==this._promise&&(this._promise=this._downloadPages(this._featureCount)),this._promise}unload(e){}async _downloadPages(e){const t=Math.ceil(e/this._queryInfo.pageSize),r=Array.from({length:t},((e,t)=>t)).sort(((e,t)=>this._random.getInt()-this._random.getInt())),n=await Promise.all(r.map((e=>this._downloadPage(e)))),s=new Fr(Fe.empty(this._metadata),null,-1,!0);this._store.insert(s);const o=n.filter((e=>e));if(o.length)throw new i.A("featurelayer-query","Encountered errors when downloading data",{errors:o})}async _downloadPage(e){try{const t=this._queryInfo.createPagedQuery(e),r=await this._fetch(t,this._options),i=new Fr(r,t.inner.toJSON(),e,!1);return(0,a.Te)(this._options),this._store.insert(i),null}catch(e){return e}}}var Dr=r(42827);const zr="__esri_timestamp__";class Ur{constructor(e,t,r,i,n=128){this._trackIdToObservations=new Map,this._idCounter=0,this._lastPurge=performance.now(),this._addOrUpdated=new Map,this._removed=[],this._maxAge=0,this._timeInfo=r,this._purgeOptions=i,this.store=e,this.objectIdField=t,this.purgeInterval=n,this._useGeneratedIds="__esri_stream_id__"===this.objectIdField}removeById(e){this._removed.push(e)}removeByTrackId(e){const t=this._trackIdToObservations.get(e);if(t)for(const e of t.entries)this._removed.push(e)}add(e){if(this._useGeneratedIds){const t=this._nextId();e.attributes[this.objectIdField]=t,e.objectId=t}else e.objectId=e.attributes[this.objectIdField];const t=e.objectId;if(this._addOrUpdated.set(t,e),this._maxAge=Math.max(this._maxAge,e.attributes[this._timeInfo.startTimeField]),!this._timeInfo.trackIdField)return null==this._trackIdLessObservations&&(this._trackIdLessObservations=new Dr.A(1e5)),void this._trackIdLessObservations.enqueue(t);const r=e.attributes[this._timeInfo.trackIdField];if(!this._trackIdToObservations.has(r)){const e=null!=this._purgeOptions?.maxObservations?this._purgeOptions.maxObservations:1e3,t=(0,ie.qE)(e,0,1e3);this._trackIdToObservations.set(r,new Dr.A(t))}const i=this._trackIdToObservations.get(r),n=i?.enqueue(t);null!=n&&(this._addOrUpdated.has(n)?this._addOrUpdated.delete(n):this._removed.push(n))}checkForUpdates(){const e=this._getToAdd(),t=this._getToRemove(),r=performance.now();r-this._lastPurge>=this.purgeInterval&&(this._purge(r),this._lastPurge=r);const i=[];if(null!=t)for(const e of t){const t=this.store.removeById(e);null!=t&&i.push(t)}const n=[];if(null!=e){const i=new Set(t??[]);for(const t of e)i.has(t.objectId)||(t.attributes[zr]=r,this.store.add(t),n.push(t))}return!(!n.length&&!i?.length||(this.store.update(n,i),0))}_getToAdd(){if(!this._addOrUpdated.size)return null;const e=new Array(this._addOrUpdated.size);let t=0;return this._addOrUpdated.forEach((r=>e[t++]=r)),this._addOrUpdated.clear(),e}_getToRemove(){const e=this._removed;return this._removed.length?(this._removed=[],e):null}_nextId(){const e=this._idCounter;return this._idCounter=(this._idCounter+1)%4294967294+1,e}_purge(e){const t=this._purgeOptions;null!=t&&(this._purgeSomeByDisplayCount(t),this._purgeByAge(t),this._purgeByAgeReceived(e,t),this._purgeTracks())}_purgeSomeByDisplayCount(e){if(!e.displayCount)return;let t=this.store.size;if(t>e.displayCount){if(this._timeInfo.trackIdField)for(const r of this._trackIdToObservations.values())if(t>e.displayCount&&r.size){const e=r.dequeue();this._removed.push(e),t--}if(null!=this._trackIdLessObservations){let r=t-e.displayCount;for(;r-- >0;){const e=this._trackIdLessObservations.dequeue();null!=e&&this._removed.push(e)}}}}_purgeByAge(e){const t=this._timeInfo?.startTimeField;if(!e.age||!t)return;const r=60*e.age*1e3,i=this._maxAge-r;this.store.forEach((e=>{e.attributes[t]<i&&this._removed.push(e.objectId)}))}_purgeByAgeReceived(e,t){if(!t.ageReceived)return;const r=e-60*t.ageReceived*1e3;this.store.forEach((e=>{e.attributes[zr]<r&&this._removed.push(e.objectId)}))}_purgeTracks(){this._trackIdToObservations.forEach(((e,t)=>{0===e.size&&this._trackIdToObservations.delete(t)}))}}var Gr=r(10310);let Br=class extends it.A{constructor(e){super(e)}get connectionStatus(){return this.connection?.connectionStatus}get errorString(){return this.connection?.errorString}};(0,rt._)([(0,nt.MZ)()],Br.prototype,"connection",void 0),(0,rt._)([(0,nt.MZ)()],Br.prototype,"connectionStatus",null),(0,rt._)([(0,nt.MZ)()],Br.prototype,"errorString",null),Br=(0,rt._)([(0,ot.$)("esri.views.2d.layers.features.sources.StreamConnectionState")],Br);class Vr{constructor(e,t){this._metadata=e,this._onUpdate=t,this._objectIdToFeature=new Map}get size(){return this._objectIdToFeature.size}get reader(){return Fe.fromFeatures([...this._objectIdToFeature.values()],this._metadata)}add(e){this._objectIdToFeature.set(e.objectId,e)}forEach(e){this._objectIdToFeature.forEach(e)}removeById(e){const t=this._objectIdToFeature.get(e);return t?(this._objectIdToFeature.delete(e),t):null}clear(){this._objectIdToFeature=new Map}update(e,t){this._onUpdate(e?.length??0)}}class qr extends Re{constructor(e){super(),this._reader=e,this.chunkId="stream-chunk",this.normalizedChunkId="stream-chunk"}get reader(){return this._reader}get first(){return!0}get end(){return!0}get queryInfo(){return{type:"stream",chunkId:this.chunkId,size:this.size(),end:this.end}}get isTiled(){return!1}getTileReader(e){const t=this.queryFeaturesInBounds(e.bounds);return t.setTransformForDisplay(e.transform),t}}class Zr extends lt{constructor(e,t,r,i,n){super(r),this._service=e,this._dataFilter=t,this._streamOptions=i,this._metadata=n,this._connectionState=new Br,this._forceRefresh=!1,this.events=new j.A;const{objectIdField:s,timeInfo:o}=this._metadata,{purgeOptions:a}=t;this._stagingStore=new Vr(this._metadata,(e=>this.events.emit("features-updated",e))),this._manager=new Ur(this._stagingStore,s,o,a),this.connect()}destroy(){super.destroy(),this.disconnect()}get about(){return{willQueryAllFeatures:!1,willQueryFullResolutionGeometry:!1}}get connectionStatus(){return this._connectionState.connectionStatus}get errorString(){return this._connectionState?.errorString}async refresh(){const e=null!=this._chunk;this._manager.checkForUpdates()||!e||this._forceRefresh?(this._chunk&&this._store.remove(this._chunk),this._forceRefresh=!1,this._chunk=new qr(this._stagingStore.reader),this._store.insert(this._chunk),this.events.emit("tick")):this.events.emit("tick")}async updateFields(e){throw new Error("Updating available fields not supported for StreamLayer")}async load(e){}unload(e){}disconnect(){this._connection=(0,g.pR)(this._connection),this._connectionState.connection=null,this._handlesGroup?.remove()}connect(){if(null!=this._connection)return;const{geometryType:e,spatialReference:t}=this._metadata,{maxReconnectionAttempts:r,maxReconnectionInterval:i,geometryDefinition:s,definitionExpression:o,customParameters:a}=this._dataFilter;this._connection=(0,Gr.createConnection)(this._service.source,t,this._streamOptions.outSR,e,o,s,r,i,a),this._handlesGroup=(0,n.vE)([this._connection.on("data-received",(e=>this._onFeature(e))),this._connection.on("message-received",(e=>this._onWebSocketMessage(e)))]),this._connectionState.connection=this._connection}clear(){this._manager.checkForUpdates(),this._stagingStore.clear(),this._forceRefresh=!0}updateCustomParameters(e){this._connection?.updateCustomParameters(e)}sendMessageToSocket(e){this._connection?.sendMessageToSocket(e)}sendMessageToClient(e){this._connection?.sendMessageToClient(e)}_onWebSocketMessage(e){if("type"in e)switch(e.type){case"delete":if(e.objectIds)for(const t of e.objectIds)this._manager.removeById(t);if(e.trackIds)for(const t of e.trackIds)this._manager.removeByTrackId(t);break;case"clear":this.clear()}this.events.emit("message-received",e)}_onFeature(e){try{this._manager.add(e),this.events.emit("data-received",e)}catch(e){}}}var Hr=r(6578);class jr{constructor(e){this._onChange=e,this._chunks=new Map,this._chunksToRemove=[],this.events=new j.A,this.featureAdapter=new Hr.Z}destroy(){this.clear()}clear(){for(const e of this._chunks.values())this._chunksToRemove.push(e);this._chunks.clear(),null!=this._localEditChunk&&this._chunksToRemove.push(this._localEditChunk),this._localEditChunk=null}*chunks(){this._localEditChunk&&(yield this._localEditChunk),this._localOverridesChunk&&(yield this._localOverridesChunk),yield*this._chunks.values()}dataChunks(){return this._chunks.values()}insert(e){(0,s.A)("esri-2d-update-debug")&&console.debug(`Chunk[${e.chunkId}] SourceChunkStore.insert`),this._localOverridesChunk?.overriddenIds.size&&(e.reader.removeIds(this._localOverridesChunk.overriddenIds),e.invalidate()),this._localEditChunk?.overriddenIds.size&&this._localEditChunk.removeOverrides(e),this._chunks.set(e.chunkId,e),this.events.emit("changed"),this._onChange()}remove(e){(0,s.A)("esri-2d-update-debug")&&console.debug(`Chunk[${e.chunkId}] SourceChunkStore.remove`),this._chunks.delete(e.chunkId),this._chunksToRemove.push(e)}cleanupRemovedChunks(){const e=this._chunksToRemove;return this._chunksToRemove=[],e}applyLocalOverrides(e,t){null==this._localOverridesChunk&&(this._localOverridesChunk=new ke(t,"localOverride")),this._localOverridesChunk.applyOverrides(e);for(const e of this._chunks.values())e.reader.removeIds(this._localOverridesChunk.overriddenIds),e.invalidate();this.events.emit("changed")}applyLocalEdit(e,t){null==this._localEditChunk&&(this._localEditChunk=new ke(t,"localEdit")),this._localEditChunk.applyOverrides(e);for(const e of this._chunks.values())e.reader.removeIds(this._localEditChunk.overriddenIds),e.invalidate();this.events.emit("changed")}forEach(e){const t=new Set;for(const r of this.chunks()){const i=r.reader.getCursor();for(;i.next();){const r=i.getObjectId();t.has(r)||(e(i.copy()),t.add(r))}}}forEachUnsafe(e){const t=new Set;for(const r of this.chunks()){const i=r.reader.getCursor();for(;i.next();){const r=i.getObjectId();t.has(r)||(e(i),t.add(r))}}}forEachInBounds(e,t){const r=new Set;for(const i of this.chunks()){const n=i.queryFeaturesInBounds(e);for(;n.next();){const e=n.getObjectId();r.has(e)||(t(n.copy()),r.add(e))}}}forEachBounds(e,t){const r=(0,W.vt)();for(const i of e)i.getBounds(r)&&t(r)}}var Wr=r(60478);class Yr{constructor(e,t,r,i,n){this.service=e,this._aggregateAdapter=t,this._subscriptions=r,this._onChange=i,this._connection=n,this._updateTracking=new Wr.F({debugName:"FeatureSource"}),this._didInvalidateData=!1,this._store=new jr(this._onChange),this._metadata=De.i.createFeature(e.metadata)}destroy(){this._strategy?.destroy(),this._store.destroy(),this._streamMessenger?.destroy(),"memory"===this.service.type&&this.service.source.map((e=>e.close()))}get metadata(){if(!this._metadata)throw new Error("InternalError: Metadata not defined. Was update called?");return this._metadata}get store(){return this._store}get streamMessenger(){return null==this._streamMessenger&&this._initStreamMessenger(),this._streamMessenger}get statistics(){return Xe.from(this._store)}get updateTracking(){return this._updateTracking}get queryEngine(){if(!this._queryEngine){if(!this._schema)return null;const{dataFilter:e}=this._schema.mutable,t=this._schema.mutable.availableFields,r=this._metadata;this._queryEngine=new $.d({featureStore:this._store,fieldsIndex:r.fieldsIndex,geometryType:r.geometryType,objectIdField:r.objectIdField,hasM:!1,hasZ:!1,spatialReference:this.service.outSpatialReference,aggregateAdapter:this._aggregateAdapter,timeInfo:r.timeInfo,definitionExpression:e.definitionExpression,availableFields:t})}return this._queryEngine}get isStream(){return"stream"===this._schema.type}chunks(){return Array.from(this._store.chunks())}cleanupRemovedChunks(){return this._store.cleanupRemovedChunks()}onSubscribe(e){this._connection.onEvent({type:"subscribe",tile:e.tile.id});const t=this._strategy?.load(e);t&&(t.then((()=>this._connection.onEvent({type:"loaded",tile:e.tile.id}))).catch((t=>this._connection.onEvent({type:"error",tile:e.tile.id,error:t}))),this._updateTracking.addPromise(t))}onResume(e){this._updateTracking.addPromise((0,a.QZ)(this._strategy?.load(e)))}onUnsubscribe(e){this._connection.onEvent({type:"unsubscribe",tile:e.tile.id}),this._strategy?.unload(e)}getLocalEdit(e){return this._updateTracking.addPromise(this._getGetLocalEdit(e))}applyLocalEdit(e){this._didInvalidateData=!0,this._store.applyLocalEdit(e,this.metadata)}async update(e,t){const r=e.source,i=(0,x.Ui)(this._schema?.mutable,r.mutable);if(!i)return!1;if((0,s.A)("esri-2d-update-debug")&&console.debug(`Version[${t}] FeatureSource.update`,{changes:i}),this._schema=r,this._queryEngine?.destroy(),this._queryEngine=null,"feature-service"===this.service.type&&null!=this.service.queryMetadata.lastEditDate&&(this._lastEditDate=this.service.queryMetadata.lastEditDate),null==this._streamMessenger&&"stream"===this._schema.type&&this._initStreamMessenger(),(0,x.w2)(i,"sourceRefreshVersion")&&this._strategy?.refresh)return await this._strategy.refresh(),!0;if(("feature"===r.type||"parquet"===r.type)&&(0,x.w2)(i,"availableFields")){if(await this._queryLastEditDateChanged()||this._didInvalidateData)this._didInvalidateData=!1,await this._updateStrategy(t);else{this._connection.onEvent({type:"updateFieldsStart"});try{await this._strategy.updateFields(r.mutable.availableFields),this._connection.onEvent({type:"updateFieldsEnd"})}catch(e){this._connection.onEvent({type:"updateFieldsError",error:e})}}return!1}return!(!(0,x.Mj)(i,"dataFilter")&&!(0,x.Mj)(i,"sourceRefreshVersion")||(await this._updateStrategy(t),0))}async addParquetFile(e){this._strategy.addParquetFile(e)}_initStreamMessenger(){null==this._streamMessenger&&(this._streamMessenger=new at(this._connection))}async _getGetLocalEdit(e){if(e.historicMoment&&"feature"===this._schema.type&&(this._schema.mutable.dataFilter.historicMoment=e.historicMoment,this._strategy.unsafeSetQueryHistoricMoment(new Date(e.historicMoment))),"edit-by-feature"===e.type){const t=[...e.added,...e.updated].map((e=>B.Om.fromJSON(e,this.metadata.objectIdField)));return{reader:Fe.fromOptimizedFeatures(t,this.metadata),removed:this._resolveIdentifiers(e.removed)}}const t=this._resolveIdentifiers(e.removed);if(!e.updated.length&&!e.added.length)return{reader:Fe.empty(this.metadata),removed:t};const r=this._resolveIdentifiers([...e.added,...e.updated]);return{reader:await this._strategy.queryByObjectId(r),removed:t}}_resolveIdentifiers(e){const t=[],r=[];for(const i of e)null!=i.objectId&&-1!==i.objectId?r.push(i.objectId):t.push(i.globalId);if(t.length){const e=new Set(t),i=this.metadata.globalIdField;if(null==i)throw new Error("InternalError: Recieved an edit with globalIds, but not supported by the service");this._store.forEachUnsafe((t=>{const n=t.readAttribute(i);e.has(n)&&r.push(t.getObjectId())}))}return r}async _queryLastEditDateChanged(){if(null==this._lastEditDate)return!1;const e=this.service.source,t={...e.query,f:"json"},r=(await(0,Ye.A)(e.path,{query:t,responseType:"json"})).data.editingInfo.lastEditDate;return r!==this._lastEditDate&&(this._lastEditDate=r,!0)}async _createStrategy(){const e="isSourceHosted"in this.service&&this.service.isSourceHosted,t=Array.isArray(this.service.source),r=this.service.source&&"collection"in this.service.source,i=e||t||r;if("stream"===this._schema.type){const e=new Zr(this.service,this._schema.mutable.dataFilter,this._store,{outSR:this.service.outSpatialReference},this.metadata);return this._streamMessenger.strategy=e,e}if("parquet"===this._schema.type){const e=this.service;return new Nr(e,this._metadata,this._schema,this._store)}const n=this.service,s=tt.fromSchema(n,this._schema,this._metadata),o=await this._supportSnapshotMode(n,s);return o?new Or(n,s,this._store,o.featureCount,this.metadata,this._connection):i?new Dt(n,s,this._store,this.metadata,this._connection):new kt(n,s,this._store,this.metadata,this._connection)}async _updateStrategy(e){const t=await this._createStrategy();this._connection.onEvent({type:"updateStrategyStart",about:t.about});const r=!!this._strategy;this._store.clear(),this._strategy?.destroy(),this._strategy=t,(0,s.A)("esri-2d-update-debug")&&console.debug(`Version[${e}] FeatureSource.updateStrategy`,{strategy:t});const i=Array.from(this._subscriptions.values());if(!i.length)return void this._connection.onEvent({type:"updateStrategyEnd"});const n=Promise.all(i.map((e=>this._strategy.load(e).then((()=>this._connection.onEvent({type:"loaded",tile:e.tile.id}))).catch((t=>this._connection.onEvent({type:"error",tile:e.tile.id,error:t}))))));this._updateTracking.addPromise(n);try{r&&await n}catch(e){(0,a.jH)(e)}this._connection.onEvent({type:"updateStrategyEnd"}),(0,s.A)("esri-2d-update-debug")&&console.debug(`Version[${e}] FeatureSource.updateStrategyEnd`,{strategy:t})}async _supportSnapshotMode(e,t){const{queryMetadata:r}=e,i=r.snapshotInfo;if(!i||!i.supportsSnapshotMinThreshold||!i.snapshotCountThresholds)return null;const n=e.source,s=t.createQuery();s.inner.orderByFields=[],s.inner.returnGeometry=!1;const o=(await(0,$e.gW)(n,s.inner,{query:s.customParameters})).data.count,{min:a,max:l}=i.snapshotCountThresholds;return o<=a||i.supportsSnapshotMaxThreshold&&o<l?{featureCount:o}:null}}class $r{constructor(e,t){this.tile=e,this.version=t,this._abortController=new AbortController}get key(){return this.tile.key}get signal(){return this._abortController.signal}abort(){this._abortController.abort()}}var Xr=r(21970);class Qr{constructor(e){this.inner=e,this.resolver=(0,a.Tw)()}}class Jr{constructor(){this._aggregateAdapter={getFeatureObjectIds:e=>this._processor.getFeatureObjectIdsForAggregate(e)},this._subscriptions=new Map,this._updateRequested=!1,this._updateSubscriptionRequests=[],this._updateHighlightRequests=[]}destroy(){this._subscriptions.clear(),this._processor?.destroy(),this._source?.destroy(),this._handles?.remove(),this._updateLocalEditsRequest=null,this._tileInfoView=null}onAttach(e){(0,s.A)("esri-2d-update-debug")&&console.debug("Pipeline.onAttach");const t=this._connection,r=d.default.fromJSON(e.tileInfoJSON);this._tileInfoView=new f.A(r),this._source=new Yr(e.service,this._aggregateAdapter,this._subscriptions,(()=>this._requestUpdate()),t),this._processor=new We(t,this._source),this._handles=(0,n.vE)([(0,c.watch)((()=>this._source.updateTracking.updating),(()=>{this._requestUpdate(),(0,a.QZ)(this._connection.layerView.setUpdating({data:this._source.updateTracking.updating,pipeline:!0}))}))])}onDetach(){(0,s.A)("esri-2d-update-debug")&&console.debug("Pipeline.onDetach"),this.destroy()}set remoteClient(e){this._connection=new _(e)}get features(){const e=this._source?.queryEngine;if(!e)throw new i.A("no-queryEngine","No query engine defined");return e}get aggregates(){const e=this._processor?.aggregateQueryEngine;if(!e)throw new i.A("no-queryEngine","No aggregate query engine defined");return e}get processor(){return this._processor}get streamMessenger(){return this._source.streamMessenger}getDisplayFeatures(e){return this._processor.getDisplayFeatures(e)}getDisplayIds(e){return this._processor.getDisplayIds(e)}async updateSchema(e,t){return(0,s.A)("esri-2d-update-debug")&&this._updateSchemaRequest&&console.error("InternalError: Schema already updating"),this._updateSchemaRequest=new Qr({schema:e,version:t}),this._requestUpdate(),this._updateSchemaRequest.resolver.promise}updateSubscriptions(e){const t=new Qr(e);return this._updateSubscriptionRequests.push(t),this._requestUpdate(),t.resolver.promise}updateHighlight(e){const t=new Qr(e);return this._updateHighlightRequests.push(t),this._requestUpdate(),t.resolver.promise}async addParquetFile(e){return this._source.addParquetFile(e)}async onEdits(e){if(null!=this._updateLocalEditsRequest)throw new i.A("InternalError - Already processing an edit");this._updateLocalEditsRequest=new Qr(e);const t=this._updateLocalEditsRequest.resolver.promise;return this._requestUpdate(),t}queryStatistics(){return this._source.statistics.toJSON()}async queryVisibleFeatures(e,t){return this.features.executeQuery(e,t)}async queryHeatmapStatistics(e){const t=Math.round((0,u.Lz)(e.radius));let r=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;const n="string"==typeof e.fieldOffset,s=e.fieldOffset??0,o=Array.from(this._subscriptions.values()),a=this._source.chunks(),l=t**2,c=3/(Math.PI*l),h=2*t,d=Math.ceil(m.CQ/h);for(const t of o){const o=t.tile,u=new Float64Array(d*d);for(const t of a){const r=t.getTileReader(o);if(!r)continue;const i=r.getCursor();for(;i.next();){let t=1;if(null!=e.field){const r=i.readAttribute(e.field);t=n?-1*+r:+r+s}const r=i.readXForDisplay()/h,o=i.readYForDisplay()/h,a=Math.floor(r),f=Math.floor(o);if(a<0||f<0||a>=d||f>=d)continue;const p=((.5+a-r)*h)**2+((.5+f-o)*h)**2;if(p>l)continue;const m=t*(c*(1-p/l)**2);u[f+a*d]+=m}}for(let e=0;e<u.length;e++)r=Math.min(r,u[e]),i=Math.max(i,u[e])}return{max:i,min:r}}async getSampleFeatures(e){const t=this._source.chunks();if(t.reduce(((e,t)=>e+t.size()),0)<=e.minFeatureCount){if(!this._source.updateTracking.updating){const e=[];return this._source.store.forEachUnsafe((t=>e.push(t.readLegacyFeatureWorldSpace()))),e}return null}const r=new Set,i=[],n=t.map((e=>e.reader.getCursor())),s=new l.A,o=3*e.sampleSize;for(let a=0;a<o&&i.length<e.sampleSize;a++){const e=n[s.getIntRange(0,t.length-1)];if(0===e.getSize())continue;const o=s.getIntRange(0,e.getSize()-1);e.setIndex(o);const a=e.getObjectId();r.has(a)||(r.add(a),i.push(e.readLegacyFeatureWorldSpace()))}return i.length>=e.sampleSize?i:null}_requestUpdate(){this._updateRequested||(this._updateRequested=!0,(0,o.d)((()=>this._scheduleNextUpdate())))}_scheduleNextUpdate(){this._updateRequested&&(this._ongoingUpdate||(this._ongoingUpdate=(0,h.oV)(this._doUpdate()).finally((()=>{this._ongoingUpdate=null,this._scheduleNextUpdate()})),this._updateRequested=!1))}_subscribe(e){const t=e.tileId;if(this._subscriptions.has(t))return;(0,s.A)("esri-2d-update-debug")&&console.debug(`Tile[${t}] Pipeline.subscribe`);const r=new Xr.F(this._tileInfoView,t),i=new $r(r,e.version);this._subscriptions.set(t,i),this._source.onSubscribe(i),this._processor.onSubscribe(i)}_unsubscribe(e){const t=this._subscriptions.get(e);t&&((0,s.A)("esri-2d-update-debug")&&console.debug(`Tile[${e}] Pipeline.unsubscribe`),t.abort(),this._source.onUnsubscribe(t),this._processor.onUnsubscribe(t),this._subscriptions.delete(t.key.id))}async _doUpdate(){if((0,s.A)("esri-2d-update-debug")&&console.debug("Pipeline._doUpdateStart"),await this._connection.layerView.setUpdating({data:this._source.updateTracking.updating,pipeline:!0}),this._updateSubscriptionRequests.length){const e=this._updateSubscriptionRequests;this._updateSubscriptionRequests=[];for(const t of e)this._doUpdateSubscriptions(t.inner),t.resolver.resolve()}const e=this._updateSchemaRequest;if(this._updateSchemaRequest=null,null!=e){const{schema:t,version:r}=e.inner;await this._doUpdateSchema(t,r)}const t=this._updateLocalEditsRequest;if(this._updateLocalEditsRequest=null,null!=t){(0,s.A)("esri-2d-update-debug")&&console.debug("Pipeline.applyEditOverride",t.inner);const e=await this._source.getLocalEdit(t.inner);await this._processor.applyLocalEdit(e),this._source.applyLocalEdit(e),(0,s.A)("esri-2d-update-debug")&&console.debug("Pipeline.endEditOverride",t.inner)}if(this._updateHighlightRequests.length){const e=this._updateHighlightRequests;this._updateHighlightRequests=[];for(const t of e)this._processor.updateHighlight(t.inner),t.resolver.resolve()}const r=this._source.cleanupRemovedChunks();this._processor.removeChunks(r);try{this._subscriptions.size&&((0,s.A)("esri-2d-update-debug")&&console.debug("Pipeline.updateChunksStart"),await this._processor.updateChunks(),(0,s.A)("esri-2d-update-debug")&&console.debug("Pipeline.updateChunksEnd"))}catch(e){(0,a.jH)(e)}null!=t&&t.resolver.resolve(),null!=e&&e.resolver.resolve(),this._updateRequested?((0,s.A)("esri-2d-update-debug")&&console.debug("Pipeline._doUpdateEnd [updateRequested=true]"),await this._connection.layerView.setUpdating({data:this._source.updateTracking.updating,pipeline:!0})):((0,s.A)("esri-2d-update-debug")&&console.debug("Pipeline._doUpdateEnd [updateRequested=false, After flush]"),await this._connection.layerView.setUpdating({data:this._source.updateTracking.updating,pipeline:this._updateRequested}))}async _doUpdateSchema(e,t){(0,s.A)("esri-2d-update-debug")&&console.debug(`Version[${t}] Pipeline.updateStart`,{schema:e});const r={tileInfo:this._tileInfoView?.tileInfo},i=await this._source.update(e,t),n=Array.from(this._subscriptions.values());await this._processor.update(e,t,r,i,n),(0,s.A)("esri-2d-update-debug")&&console.debug(`Version[${t}] Pipeline.updateEnd`)}_doUpdateSubscriptions(e){(0,s.A)("esri-2d-update-debug")&&console.debug("Pipeline.updateSubscriptions",e);for(const t of e.subscribe)this._subscribe(t);for(const t of e.unsubscribe)this._unsubscribe(t)}}},6578:function(e,t,r){r.d(t,{Z:function(){return i}});class i{getObjectId(e){return e.getObjectId()}getAttributes(e){return e.readAttributes()}getAttribute(e,t){return e.readAttribute(t)}getAttributeAsTimestamp(e,t){return e.readAttributeAsTimestamp(t)}cloneWithGeometry(e,t){return e}getGeometry(e){return e.readGeometryWorldSpace()}getCentroid(e,t){return e.readCentroidForDisplay()}}i.Shared=new i},7910:function(e,t,r){r.d(t,{L:function(){return i}});class i{destroy(){}}},12564:function(e,t,r){r.d(t,{K:function(){return x}});var i=r(39819),n=r(58941),s=r(40633),o=r(72952),a=r(39686),l=r(7459),c=r(88413),u=r(40846);class h{constructor(e){this.data=e,this._referenceCount=0}increment(){this._referenceCount+=1}decrement(){this._referenceCount-=1}empty(){return 0===this._referenceCount}}class d{constructor(){this._freeIdsGenerationA=[],this._freeIdsGenerationB=[],this._idCounter=1,this._freeIds=this._freeIdsGenerationA,this._objectIdToDisplayId=new Map}createIdForObjectId(e){let t=this._objectIdToDisplayId.get(e);return t?t.increment():(t=new h((0,l.Ss)(this._getFreeId(),!1)),t.increment(),this._objectIdToDisplayId.set(e,t)),t.data}releaseIdForObjectId(e){const t=this._objectIdToDisplayId.get(e);t&&(t.decrement(),t.empty()&&(this._objectIdToDisplayId.delete(e),this._freeIds.push(t.data)))}getDisplayIdForObjectId(e){const t=this._objectIdToDisplayId.get(e);return null!=t?t.data:null}releaseAll(){for(const e of this._objectIdToDisplayId.values())this._freeIds.push(e.data);this._objectIdToDisplayId.clear()}incrementGeneration(){this._freeIds=this._freeIds===this._freeIdsGenerationA?this._freeIdsGenerationB:this._freeIdsGenerationA}_getFreeId(){return this._freeIds.length?this._freeIds.pop():this._idCounter++}}var f=r(70132),p=r(85456);const m=()=>s.A.getLogger("esri.views.layers.2d.features.support.AttributeStore"),_=(m(),()=>null),g=(0,n.A)("esri-shared-array-buffer");(0,n.A)("esri-atomics");class y{constructor(e,t,r){this.size=0,this.texelSize=4,this.dirtyStart=0,this.dirtyEnd=0;const{pixelType:i,layout:n,textureOnly:s}=t;this.textureOnly=s||!1,this.pixelType=i,this.layout=n,this._resetRange(),this.size=e,this.isLocal=r,s||(this.data=this._initData(i,e))}get buffer(){return this.data?.buffer}unsetComponentAllTexels(e,t){const r=this.data;for(let i=0;i<this.size*this.size;i++)r[i*this.texelSize+e]&=~t;this.dirtyStart=0,this.dirtyEnd=this.size*this.size-1}setComponentAllTexels(e,t){const r=this.data;for(let i=0;i<this.size*this.size;i++)r[i*this.texelSize+e]|=255&t;this.dirtyStart=0,this.dirtyEnd=this.size*this.size-1}setComponent(e,t,r){const i=this.data;for(const n of r)i[n*this.texelSize+e]|=t,this.dirtyStart=Math.min(this.dirtyStart,n),this.dirtyEnd=Math.max(this.dirtyEnd,n)}setComponentTexel(e,t,r){this.data[r*this.texelSize+e]|=t,this.dirtyStart=Math.min(this.dirtyStart,r),this.dirtyEnd=Math.max(this.dirtyEnd,r)}unsetComponentTexel(e,t,r){this.data[r*this.texelSize+e]&=~t,this.dirtyStart=Math.min(this.dirtyStart,r),this.dirtyEnd=Math.max(this.dirtyEnd,r)}getData(e,t){const r=(0,l.Q4)(e);return this.data[r*this.texelSize+t]}setData(e,t,r){const i=(0,l.Q4)(e),n=1<<t;this.layout&n?null!=this.data&&(this.data[i*this.texelSize+t]=r,this.dirtyStart=Math.min(this.dirtyStart,i),this.dirtyEnd=Math.max(this.dirtyEnd,i)):m().error("mapview-attributes-store","Tried to set a value for a texel's readonly component")}expand(e){if(this.size=e,!this.textureOnly){const t=this._initData(this.pixelType,e),r=this.data;t.set(r),this.data=t}}toMessage(){const e=this.dirtyStart,t=this.dirtyEnd,r=this.texelSize;if(e>t)return null;this._resetRange();const i=!this.isLocal,n=this.pixelType,s=this.layout,o=this.data;return{start:e,end:t,data:i&&o.slice(e*r,(t+1)*r)||null,pixelType:n,layout:s}}_initData(e,t){const r=ArrayBuffer,i=(0,c.Qz)(e),n=new i(new r(t*t*4*i.BYTES_PER_ELEMENT));for(let e=0;e<n.length;e+=4)n[e+1]=255;return n}_resetRange(){this.dirtyStart=2147483647,this.dirtyEnd=0}}class x{constructor(e){this._client=e,this._filters=[],this._blocks=new Array,this._attributeComputeInfo=null,this._abortController=new AbortController,this._size=a.TB,this._idsToHighlight=new Map,this._referencesScale=!1,this._referencesGeometry=!1,this._initialized=!1,this.version=0,this._idGenerator=new d,this._epoch=1}destroy(){this._abortController.abort()}_initialize(){if(null!=this._blockDescriptors)return;const e=p.ld.FLOAT;_(`Creating AttributeStore ${g?"with":"without"} shared memory`),this._blockDescriptors=[{pixelType:p.ld.UNSIGNED_BYTE,layout:1},{pixelType:p.ld.UNSIGNED_BYTE,layout:15,textureOnly:!0},{pixelType:p.ld.UNSIGNED_BYTE,layout:15,textureOnly:!0},{pixelType:e,layout:15},{pixelType:e,layout:15},{pixelType:e,layout:15},{pixelType:e,layout:15},{pixelType:p.ld.FLOAT,layout:15}],this._blocks=this._blockDescriptors.map((()=>null))}get referencesScale(){return this._referencesScale}get referencesGeometry(){return this._referencesGeometry}get hasHighlight(){return this._idsToHighlight.size>0}createDisplayIdForObjectId(e){return this._idGenerator.createIdForObjectId(e)}releaseDisplayIdForObjectId(e){return this._idGenerator.releaseIdForObjectId(e)}getDisplayIdForObjectId(e){return this._idGenerator.getDisplayIdForObjectId(e)}incrementDisplayIdGeneration(){this._idGenerator.incrementGeneration()}releaseAllIds(){this._idGenerator.releaseAll()}async update(e,t,r,i,s=0){const a=(0,o.Ui)(this._schema,e);if(this.version=s,a&&((0,n.A)("esri-2d-update-debug")&&console.debug(`Version[${s}] AttributeStore.update`,{changed:a}),this._schema=e,this._attributeComputeInfo=null,this._initialize(),null!=e))if(r&&(this._filters=await Promise.all(e.filters.map((e=>e?f.A.create({geometryType:r.geometryType,hasM:!1,hasZ:!1,timeInfo:r.timeInfo,fieldsIndex:r.fieldsIndex,spatialReference:i??r.spatialReference,filterJSON:e}):null)))),"subtype"!==e.type)this._attributeComputeInfo={isSubtype:!1,map:new Map},await Promise.all(e.bindings.map((async e=>{const r=await this._bind(t,e);this._referencesGeometry=this._referencesGeometry||(r?.referencesGeometry()??!1),this._referencesScale=this._referencesScale||(r?.referencesScale()??!1)})));else{this._attributeComputeInfo={isSubtype:!0,subtypeField:e.subtypeField,map:new Map},this._referencesScale=!1,this._referencesGeometry=!1;for(const r in e.bindings){const i=e.bindings[r];await Promise.all(i.map((async e=>{const i=await this._bind(t,e,parseInt(r,10));this._referencesGeometry=this._referencesGeometry||(i?.referencesGeometry()??!1),this._referencesScale=this._referencesScale||(i?.referencesScale()??!1)})))}}}setHighlight(e,t){const r=this._getBlock(0);r.unsetComponentAllTexels(0,(1<<a.U5)-1);for(const{displayId:t,highlightFlags:i}of e){if(null==t)continue;const e=(0,l.Q4)(t);r.setComponent(0,i,[e])}this._idsToHighlight.clear();for(const{objectId:t,highlightFlags:r}of e)this._idsToHighlight.set(t,r);for(const{objectId:e,highlightFlags:r}of t)this._idsToHighlight.set(e,r)}setData(e,t,r,i){const n=(0,l.Q4)(e);this._ensureSizeForTexel(n),this._getBlock(t).setData(e,r,i)}getData(e,t,r){return this._getBlock(t).getData(e,r)}getHighlightFlags(e){return this._idsToHighlight.get(e)||0}unsetAttributeData(e){const t=(0,l.Q4)(e);this._getBlock(0).setData(t,0,0)}setAttributeData(e,t,r){const i=(0,l.Q4)(e);this._ensureSizeForTexel(i),this._getBlock(0).setData(i,0,this.getFilterFlags(t));const n=this._attributeComputeInfo;let s=null;n&&(s=n.isSubtype?n.map.get(t.readAttribute(n.subtypeField)):n.map,s?.size&&s.forEach(((e,n)=>{const s=1*n%4,o=Math.floor(1*n/4),l=this._getBlock(o+a.dV.VV);let c=e.field?.read(t,r);e.valueRepresentation&&(c=function(e,t){if(!e||!t)return e;switch(t){case"radius":case"distance":return 2*e;case"diameter":case"width":return e;case"area":return Math.sqrt(e)}return e}(c,e.valueRepresentation)),(null===c||isNaN(c)||c===1/0||c===-1/0)&&(c=u.qM),l.setData(i,s,c)})))}get epoch(){return this._epoch}sendUpdates(){const e=this._blocks.map((e=>null!=e?e.toMessage():null)),t=this._getInitArgs();(0,n.A)("esri-2d-log-updating")&&console.log("AttributeStore: _doSendUpdate.start"),this._client.update({initArgs:t,blockData:e,version:this.version,sendUpdateEpoch:this._epoch}),this._epoch+=1,(0,n.A)("esri-2d-log-updating")&&console.log("AttributeStore: _doSendUpdate.end")}_ensureSizeForTexel(e){for(;e>=this._size*this._size;)if(this._expand())return}async _bind(e,t,r){const i=await e.createComputedField(t),{valueRepresentation:n}=t,s=this._attributeComputeInfo;if(s.isSubtype){const e=s.map.get(r)??new Map;e.set(t.binding,{field:i,valueRepresentation:n}),s.map.set(r,e)}else s.map.set(t.binding,{field:i,valueRepresentation:n});return i}_getInitArgs(){return this._initialized?null:(this._initialized=!0,this._getBlock(a.dV.Animation),this._getBlock(a.dV.GPGPU),this._getBlock(a.dV.LocalTimeOrigin),{blockSize:this._size,blockDescriptors:this._blocks.map((e=>null!=e?{textureOnly:e.textureOnly,buffer:e.buffer,pixelType:e.pixelType}:null))})}_getBlock(e){const t=this._blocks[e];if(null!=t)return t;_(`Initializing AttributeBlock at index ${e}`);const r=new y(this._size,this._blockDescriptors[e],this._client.isLocal);return this._blocks[e]=r,this._initialized=!1,r}_expand(){if(this._size<this._schema.capabilities.maxTextureSize){const e=this._size<<=1;_("Expanding block size to",e,this._blocks);for(const t of this._blocks)t?.expand(e);return this._initialized=!1,this._size=e,0}return m().error(new i.A("mapview-limitations","Maximum number of onscreen features exceeded.")),-1}isVisible(e){return!!(this._getBlock(0).getData(e,0)&1<<a.U5)}getFilterFlags(e){let t=0;for(let r=0;r<this._filters.length;r++){const i=!!(1<<r),n=this._filters[r];t|=(!i||null==n||n.check(e)?1:0)<<r}let r=0;if(this._idsToHighlight.size){const t=e.getObjectId();r=this.getHighlightFlags(t)}return t<<a.U5|r}}},67057:function(e,t,r){r.d(t,{l:function(){return I}});var i=r(39819),n=r(40633),s=r(24761),o=r(7459),a=r(7910);class l extends a.L{constructor(e){super(),this._field=e}resize(e){throw new Error("Method not implemented.")}read(e,t){return e.readAttribute(this._field)}readWithDefault(e,t){return e.readAttribute(this._field)}referencesScale(){return!1}referencesGeometry(){return!1}}var c=r(50944),u=r(54547),h=r(89838);class d extends a.L{static async create(e,t){const r=await(0,u.Ad)(e,t.spatialReference,t.fields),i=(0,c.Wm)(e);return new d(r,i)}constructor(e,t){super(),this._compiled=e,this._cacheKey=t}resize(e){}read(e,t){return this.referencesScale()||"system"!==t.$view.timeZone?(0,h.V4)(this._compiled,e,t):this._readCached(e,t)}readWithDefault(e,t,r){return this.referencesScale()||"system"!==t.$view.timeZone?(0,h.OP)(this._compiled,e,t,r):this._readWithDefaultCached(e,t,r)}referencesScale(){return this._compiled?.referencesScale()??!1}referencesGeometry(){return this._compiled?.referencesGeometry()??!1}_readCached(e,t){if(e.setCache(this._cacheKey),e.hasCachedValue())return e.getCachedValue();const r=(0,h.V4)(this._compiled,e,t);return e.setCachedValue(r),r}_readWithDefaultCached(e,t,r){if(e.setCache(this._cacheKey),e.hasCachedValue())return e.getCachedValue();const i=(0,h.OP)(this._compiled,e,t,r);return e.setCachedValue(i),i}}var f=r(8289),p=r(2900),m=r(16645),_=r(53743),g=r(6361);class y extends a.L{static async create(e,t){const r=(0,g.lc)(e);return new y((e=>r.replaceAll(/{[^}]*}/g,(t=>{const r=t.slice(1,-1),i=e.metadata.fieldsIndex.get(r);if(null==i)return t;const n=e.readAttribute(r);return null==n?"":function(e,t){if(null==e)return"";const r=t.domain;if(r)if("codedValue"===r.type||"coded-value"===r.type){const t=e;for(const e of r.codedValues)if(e.code===t)return e.name}else if("range"===r.type){const{max:i,min:n}=(0,m.A5)(t),s=+e;if(null!=n&&null!=i&&n<=s&&s<=i)return r.name}let i=e;return(0,_.vE)(t)?i=(0,f.Yq)(i,(0,f.J2)("short-date")):(0,_.WA)(t)&&(i=(0,p.ZV)(+i)),i||""}(n,i)}))))}constructor(e){super(),this._evaluator=e}resize(e){}read(e,t){return this._evaluator(e)}readWithDefault(e,t,r){const i=this._evaluator(e);return(0,h.rZ)(i)?r:i}referencesScale(){return!1}referencesGeometry(){return!1}}class x extends a.L{constructor(e,t){super(),this._field=e,this._normalizationInfo=t}resize(e){throw new Error("Method not implemented.")}read(e,t){return this._readNormalized(e)}readWithDefault(e,t){return this._readNormalized(e)}referencesScale(){return!1}referencesGeometry(){return!1}_readNormalized(e){const t=e.readAttribute(this._field);if(null==t)return null;const{normalizationField:r,normalizationTotal:i,normalizationType:n}=this._normalizationInfo,s=e.readAttribute(r);switch(n??"esriNormalizeByField"){case"esriNormalizeByField":return s?s?t/s:void 0:null;case"esriNormalizeByLog":return Math.log(t)*Math.LOG10E;case"esriNormalizeByPercentOfTotal":return i?t/i*100:null}}}var b=r(45273),w=r(19886);const v=()=>n.A.getLogger("esri.views.2d.layers.features.support.ComputedAttributeStorage"),S=4294967295;function T(e,t,r){if(!(e.length>t))for(;e.length<=t;)e.push(r)}class I{constructor(e){this._numerics=[],this._strings=[],this._allocatedSize=256,this._bitsets=[],this._instanceIds=[],this._bounds=[],this._dirtyBitset=this.getBitset(this.createBitset()),this.compilationOptions=e}createBitset(){const e=this._bitsets.length;return this._bitsets.push(b.y.create(this._allocatedSize,o.KQ)),e+1}async createComputedField(e,t=!1){if(e.expression)try{if(!this.compilationOptions)throw new Error("InternalError: Compilation options not defined");return t?await y.create(e.expression,this.compilationOptions):await d.create(e.expression,this.compilationOptions)}catch(t){const r=new i.A("featurelayer","Failed to compile arcade expression",{error:t,expression:e.expression});return v().error(r),null}if(e.normalizationType||e.normalizationField)return new x(e.field,e);if(e.field)return new l(e.field);const r=new i.A("featurelayer","Unable to create computed field. No expression or field found",{info:e});return v().error(r),null}async createWhereClause(e){return e?(0,w.$)(e,this.compilationOptions.fields):null}getBitset(e){return this._bitsets[e-1]}getComputedNumeric(e,t){return this.getComputedNumericAtIndex(e&o.KQ,0)}setComputedNumeric(e,t,r){return this.setComputedNumericAtIndex(e&o.KQ,r,0)}getComputedString(e,t){return this.getComputedStringAtIndex(e&o.KQ,0)}setComputedString(e,t,r){return this.setComputedStringAtIndex(e&o.KQ,0,r)}getComputedNumericAtIndex(e,t){const r=e&o.KQ;return this._ensureNumeric(t,r),this._numerics[t][r]}setComputedNumericAtIndex(e,t,r){const i=e&o.KQ;this._ensureNumeric(t,i),this._numerics[t][i]=r}getPackedChunkId(e){const t=e&o.KQ;return this._ensureInstanceId(t),this._instanceIds[t]}setPackedChunkId(e,t){const r=e&o.KQ;this._ensureInstanceId(r),this._instanceIds[r]=t}getComputedStringAtIndex(e,t){const r=e&o.KQ;return this._ensureString(t,r),this._strings[t][r]}setComputedStringAtIndex(e,t,r){const i=e&o.KQ;this._ensureString(t,i),this._strings[t][i]=r}getXMin(e){return this._bounds[4*(e&o.KQ)]}getYMin(e){return this._bounds[4*(e&o.KQ)+1]}getXMax(e){return this._bounds[4*(e&o.KQ)+2]}getYMax(e){return this._bounds[4*(e&o.KQ)+3]}setBounds(e,t,r=!1){const i=e&o.KQ;if(!r&&!this._dirtyBitset.has(e))return this._bounds[4*i]!==S;this._dirtyBitset.unset(e);const n=t.readGeometryWorldSpace();if(T(this._bounds,4*i+4,0),!n||!n.coords.length)return this._bounds[4*i]=S,this._bounds[4*i+1]=S,this._bounds[4*i+2]=S,this._bounds[4*i+3]=S,!1;let s=1/0,a=1/0,l=-1/0,c=-1/0;return n.forEachVertex(((e,t)=>{s=Math.min(s,e),a=Math.min(a,t),l=Math.max(l,e),c=Math.max(c,t)})),this._bounds[4*i]=s,this._bounds[4*i+1]=a,this._bounds[4*i+2]=l,this._bounds[4*i+3]=c,!0}getBounds(e,t){const r=this.getXMin(t),i=this.getYMin(t),n=this.getXMax(t),o=this.getYMax(t);return(0,s.BI)(e,r,i,n,o),r!==S}_ensureNumeric(e,t){this._numerics[e]||(this._numerics[e]=[]),T(this._numerics[e],t,0)}_ensureInstanceId(e){T(this._instanceIds,e,0)}_ensureString(e,t){this._strings[e]||(this._strings[e]=[]),T(this._strings[e],t,null)}}},37069:function(e,t,r){r.d(t,{G:function(){return n}});var i=r(7910);class n extends i.L{constructor(e){super(),this._value=e}resize(e){}read(e,t){return this._value}readWithDefault(e,t,r){return this._value}referencesScale(){return!1}referencesGeometry(){return!1}}},70132:function(e,t,r){r.d(t,{A:function(){return f}});var i=r(39819),n=r(40633),s=r(87416),o=r(35068),a=r(20932),l=r(62512),c=r(20973),u=r(7926),h=r(6578),d=r(19886);class f{constructor(e){this._geometryBounds=(0,s.vt)(),this._idToVisibility=new Map,this._serviceInfo=e}static async create(e){const t=new f(e);return await t.update(e.filterJSON,e.spatialReference),t}get hash(){return this._hash}check(e){return this._applyFilter(e)}clear(){const e=this._resetAllHiddenIds();return this.update(),{show:e,hide:[]}}invalidate(){this._idToVisibility.forEach(((e,t)=>{this._idToVisibility.set(t,0)}))}setKnownIds(e){for(const t of e)this._idToVisibility.set(t,1)}setTrue(e){const t=[],r=[],i=new Set(e);return this._idToVisibility.forEach(((e,n)=>{const s=!!(1&this._idToVisibility.get(n)),o=i.has(n);!s&&o?t.push(n):s&&!o&&r.push(n),this._idToVisibility.set(n,o?3:0)})),{show:t,hide:r}}createQuery(){const{geometry:e,spatialRel:t,where:r,timeExtent:i,objectIds:n}=this;return u.A.fromJSON({geometry:e,spatialRel:t,where:r,timeExtent:i,objectIds:n})}async update(e,t){this._hash=JSON.stringify(e);const r=await(0,a.T2)(e,null,t);await Promise.all([this._setGeometryFilter(r),this._setIdFilter(r),this._setAttributeFilter(r),this._setTimeFilter(r)])}async _setAttributeFilter(e){if(!e?.where)return this._clause=null,void(this.where=null);this._clause=await(0,d.$)(e.where,this._serviceInfo.fieldsIndex),this.where=e.where}_setIdFilter(e){this._idsToShow=e?.objectIds&&new Set(e.objectIds),this._idsToHide=e?.hiddenIds&&new Set(e.hiddenIds),this.objectIds=e?.objectIds}async _setGeometryFilter(e){if(!e?.geometry)return this._spatialQueryOperator=null,this.geometry=null,void(this.spatialRel=null);const t=e.geometry,r=e.spatialRel||"esriSpatialRelIntersects",i=await(0,l.xt)(r,t,this._serviceInfo.geometryType,this._serviceInfo.hasZ,this._serviceInfo.hasM);(0,o.Rg)(this._geometryBounds,t),this._spatialQueryOperator=i,this.geometry=t,this.spatialRel=r}_setTimeFilter(e){if(this.timeExtent=this._timeOperator=null,e?.timeExtent)if(this._serviceInfo.timeInfo)this.timeExtent=e.timeExtent,this._timeOperator=(0,c.I)(this._serviceInfo.timeInfo,e.timeExtent,h.Z.Shared);else{const t=new i.A("feature-layer-view:time-filter-not-available","Unable to apply time filter, as layer doesn't have time metadata.",e.timeExtent);n.A.getLogger("esri.views.2d.layers.features.controllers.FeatureFilter").error(t)}}_applyFilter(e){return this._filterByGeometry(e)&&this._filterById(e)&&this._filterByTime(e)&&this._filterByExpression(e)}_filterByExpression(e){return!this.where||this._clause(e)}_filterById(e){return(!this._idsToHide?.size||!this._idsToHide.has(e.getObjectId()))&&(!this._idsToShow?.size||this._idsToShow.has(e.getObjectId()))}_filterByGeometry(e){if(!this.geometry)return!0;const t=e.readGeometryWorldSpace();return!!t&&this._spatialQueryOperator(t)}_filterByTime(e){return null==this._timeOperator||this._timeOperator(e)}_resetAllHiddenIds(){const e=[];return this._idToVisibility.forEach(((t,r)=>{1&t||(this._idToVisibility.set(r,1),e.push(r))})),e}}},24231:function(e,t,r){r.d(t,{h:function(){return o},i:function(){return s}});var i=r(57165),n=r(7103);class s{static minimal(e,t,r=[]){return new s({geometryType:e,fieldsIndex:new n.A(r).toJSON(),objectIdField:t,subtypes:null,subtypeField:null,types:null,globalIdField:null,spatialReference:null,timeInfo:null,timeReferenceUnknownClient:null,typeIdField:null})}static createFeature(e){return new s(e)}constructor(e){this._options=e,this._fieldsIndex=n.A.fromJSON(e.fieldsIndex),e.spatialReference&&(this._spatialReference=i.A.fromJSON(e.spatialReference)),this._arcadeSchema={fields:this.fieldsIndex.fields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,objectIdField:this.objectIdField,globalIdField:this._options.globalIdField,spatialReference:this._spatialReference,timeInfo:this._options.timeInfo,typeIdField:this._options.typeIdField??void 0,types:this._options.types??void 0,subtypeField:this._options.subtypeField,subtypes:this._options.subtypes??void 0}}get fieldsIndex(){return this._fieldsIndex}get geometryType(){return"esriGeometryMultiPatch"===this._options.geometryType?"esriGeometryPolygon":this._options.geometryType}get serviceGeometryType(){return this._options.geometryType}get subtypeField(){return this._options.subtypeField}get timeInfo(){return this._options.timeInfo}get objectIdField(){return this._options.objectIdField}get globalIdField(){return this._options.globalIdField}get arcadeSchema(){return this._arcadeSchema}get spatialReference(){return this._spatialReference}get timeReferenceUnknownClient(){return this._options.timeReferenceUnknownClient}}class o extends s{static createGraphics(e){return new o({fieldsIndex:(new n.A).toJSON(),objectIdField:"uid",geometryType:null,spatialReference:e,globalIdField:null,subtypeField:null,subtypes:null,timeInfo:null,typeIdField:null,types:null,timeReferenceUnknownClient:null})}}},87036:function(e,t,r){r.d(t,{P:function(){return n}});var i=r(45273);class n{constructor(e){this._valid=i.y.create(e),this._data=new Array(e)}has(e){return this._valid.has(e)}set(e,t){this._valid.set(e),this._data[e]=t}get(e){return this._data[e]}}},63139:function(e,t,r){r.d(t,{Y:function(){return R}}),r(50917);var i=r(9688),n=r(58941),s=r(95929),o=r(42042),a=r(70891),l=r(33134),c=r(24761),u=r(30804),h=r(40302),d=r(58081),f=r(65215),p=r(76613),m=r(21168),_=r(87036),g=r(45273),y=r(74697);const x=(0,n.A)("featurelayer-simplify-thresholds")??[.5,.5,.5,.5],b=x[0],w=x[1],v=x[2],S=x[3],T=(0,n.A)("featurelayer-simplify-payload-size-factors")??[1,2,4],I=T[0],M=T[1],A=T[2],E=(0,n.A)("featurelayer-simplify-mobile-factor")??2,P=(0,n.A)("esri-mobile"),C=4294967295;class R{constructor(e){this.metadata=e,this.type="FeatureSetReader",this._deleted=null,this._joined=[],this._objectIdToIndex=null,this._boundsBuffer=[],this._caches=new Map,this.arcadeDeclaredClass="esri.arcade.Feature",this._contextTimeZone=null}destroy(){}[Symbol.dispose](){this.destroy()}get isEmpty(){return null!=this._deleted&&this._deleted.countSet()===this.getSize()}getAreaSimplificationThreshold(e,t){let r=1;const i=P?E:1;t>4e6?r=A*i:t>1e6?r=M*i:t>5e5?r=I*i:t>1e5&&(r=i);let n=0;return e>4e3?n=S*r:e>2e3?n=v*r:e>100?n=w:e>15&&(n=b),n}getBounds(e){if(function(e,t){if(!(e.length>t))for(;e.length<=t;)e.push(0)}(this._boundsBuffer,4*this.getIndex()+4),this.getBoundsXMin()===C)return!1;if(0===this.getBoundsXMin()){const t=this.readGeometryWorldSpace();if(!t)return this.setBoundsXMin(C),!1;let r=1/0,i=1/0,n=-1/0,s=-1/0;return t.forEachVertex(((e,t)=>{r=Math.min(r,e),i=Math.min(i,t),n=Math.max(n,e),s=Math.max(s,t)})),this.setBoundsXMin(r),this.setBoundsYMin(i),this.setBoundsXMax(n),this.setBoundsYMax(s),(0,c.BI)(e,r,i,n,s),!0}const t=this.getBoundsXMin(),r=this.getBoundsYMin(),i=this.getBoundsXMax(),n=this.getBoundsYMax();return(0,c.BI)(e,t,r,i,n),!0}getBoundsXMin(){return this._boundsBuffer[4*this.getIndex()]}setBoundsXMin(e){this._boundsBuffer[4*this.getIndex()]=e}getBoundsYMin(){return this._boundsBuffer[4*this.getIndex()+1]}setBoundsYMin(e){this._boundsBuffer[4*this.getIndex()+1]=e}getBoundsXMax(){return this._boundsBuffer[4*this.getIndex()+2]}setBoundsXMax(e){this._boundsBuffer[4*this.getIndex()+2]=e}getBoundsYMax(){return this._boundsBuffer[4*this.getIndex()+3]}setBoundsYMax(e){this._boundsBuffer[4*this.getIndex()+3]=e}readAttributeAsTimestamp(e){const t=this.readAttribute(e);return"string"==typeof t?new Date(t).getTime():"number"==typeof t||null==t?t:null}readAttribute(e,t=!1){const r=this._readAttribute(e,t);if(void 0!==r)return r;for(const r of this._joined){r.setIndex(this.getIndex());const i=r._readAttribute(e,t);if(void 0!==i)return i}}readAttributes(){const e=this._readAttributes();for(const t of this._joined){t.setIndex(this.getIndex());const r=t._readAttributes();for(const t of Object.keys(r))e[t]=r[t]}return e}joinAttributes(e){this._joined.push(e)}removeIds(e){if(null==this._objectIdToIndex){const e=new Map,t=this.getCursor();for(;t.next();){const r=t.getObjectId();(0,s.Lw)(r),e.set(r,t.getIndex())}this._objectIdToIndex=e}const t=this._objectIdToIndex;for(const r of e.values())t.has(r)&&this._removeAtIndex(t.get(r))}readOptimizedFeatureWorldSpace(){const e=this.readGeometryWorldSpace(),t=this.readAttributes(),r=this.readCentroidWorldSpace(),i=new f.Om(e,t,r);return i.objectId=this.getObjectId(),i.displayId=this.getDisplayId(),i}readLegacyFeatureForDisplay(){const e=this.readCentroidForDisplay();return{attributes:this.readAttributes(),geometry:this.readLegacyGeometryForDisplay(),centroid:(e&&{x:e.coords[0],y:e.coords[1]})??null}}readLegacyFeatureWorldSpace(){const e=this.readCentroidWorldSpace();return{attributes:this.readAttributes(),geometry:this._readLegacyGeometryWorldSpace(),centroid:(e&&{x:e.coords[0],y:e.coords[1]})??null}}readLegacyGeometryForDisplay(){const e=this.readGeometryForDisplay();return(0,d.zv)(e,this.geometryType,!1,!1)}readXForDisplay(){return this._readX()}readYForDisplay(){return this._readY()}readXWorldSpace(){const e=this._readX(),t=this.getInTransform();return null==t?e:e*t.scale[0]+t.translate[0]}readYWorldSpace(){const e=this._readY(),t=this.getInTransform();return null==t?e:t.translate[1]-e*t.scale[1]}readGeometryForDisplay(){const e=this._readGeometryDeltaDecoded(!0);if(!e){const e=this._createGeometryFromServerCentroid();return e?e.deltaDecode():null}return e}readGeometryWorldSpace(){let e=this._readGeometry();if(e||(e=this._createGeometryFromServerCentroid()),!e)return null;const t=e.clone(),r=this.getInTransform();return null!=r&&(0,d.Ch)(t,t,this.hasZ,this.hasM,r),t}readCentroidForDisplay(){const e=this.readGeometryForDisplay();return e?this._computeDisplayCentroid(e):this._readServerCentroid()}readCentroidWorldSpace(){const e=this.readGeometryForDisplay(),t=e?this._computeDisplayCentroid(e):this._readServerCentroid();if(!t)return null;const r=t.clone(),i=this.getInTransform();return null!=i&&(0,d.Ch)(r,r,this.hasZ,this.hasM,i),r}setCache(e){let t=this._caches.get(e);null==t&&(t=new _.P(this.getSize()),this._caches.set(e,t)),this._activeCache=t}setCachedValue(e){this._activeCache.set(this.getIndex(),e)}hasCachedValue(){return this._activeCache.has(this.getIndex())}getCachedValue(){return this._activeCache.get(this.getIndex())}_readGeometryDeltaDecoded(e){const t=this._readGeometry(e);return"esriGeometryPoint"!==this.geometryType&&t&&this.getInTransform()?t.deltaDecode():t}get contextTimeZone(){return this._contextTimeZone}set contextTimeZone(e){this._contextTimeZone=e}readArcadeFeature(){return this}hasField(e){return this.fields.has(e)||this._joined.some((t=>t.hasField(e)))}geometry(){const e=this.readGeometryWorldSpace(),t=(0,d.zv)(e,this.geometryType,this.hasZ,this.hasM),r=(0,y.rS)(t);if(r){if(!this.metadata.spatialReference)throw new Error("InternalError: Expected spatial reference to be defined");r.spatialReference=this.metadata.spatialReference}return r}autocastArcadeDate(e,t){return t&&t instanceof Date?this.isUnknownDateTimeField(e)?i.lY.unknownDateJSToArcadeDate(t):i.lY.dateJSAndZoneToArcadeDate(t,this.contextTimeZone??m.qU):t}isUnknownDateTimeField(e){return this.metadata.fieldsIndex.getTimeZone(e)===m.L5}field(e){let t=this.fields.get(e);if(t)switch(t.type){case"date-only":case"esriFieldTypeDateOnly":return o.n.fromReader(this.readAttribute(e,!1));case"time-only":case"esriFieldTypeTimeOnly":return a.k.fromReader(this.readAttribute(e,!1));case"esriFieldTypeTimestampOffset":case"timestamp-offset":return i.lY.fromReaderAsTimeStampOffset(this.readAttribute(e,!1));case"date":case"esriFieldTypeDate":return this.autocastArcadeDate(e,this.readAttribute(e,!0));default:return this.readAttribute(e,!1)}for(const r of this._joined)if(r.setIndex(this.getIndex()),t=r.fields.get(e),t)switch(t.type){case"date-only":case"esriFieldTypeDateOnly":return o.n.fromReader(r._readAttribute(e,!1));case"time-only":case"esriFieldTypeTimeOnly":return a.k.fromReader(r._readAttribute(e,!1));case"esriFieldTypeTimestampOffset":case"timestamp-offset":return i.lY.fromReaderAsTimeStampOffset(r._readAttribute(e,!1));case"date":case"esriFieldTypeDate":return this.autocastArcadeDate(e,r._readAttribute(e,!0));default:return this.readAttribute(e,!1)}throw new Error(`Field ${e} does not exist`)}setField(e,t){throw new Error("Unable to update feature attribute values, feature is readonly")}keys(){return this.fields.fields.map((e=>e.name))}castToText(e=!1){if(!e)return JSON.stringify(this.readLegacyFeatureForDisplay());const t=this.readLegacyFeatureForDisplay();if(!t)return JSON.stringify(null);const r={geometry:t.geometry,attributes:{...t.attributes??{}}};for(const e in r.attributes){const t=r.attributes[e];t instanceof Date&&(r.attributes[e]=t.getTime())}return JSON.stringify(r)}gdbVersion(){return null}fullSchema(){return this.metadata.arcadeSchema}castAsJson(e=null){return{attributes:this._readAttributes(),geometry:!0===e?.keepGeometryType?this.geometry():this.geometry()?.toJSON()??null}}castAsJsonAsync(e=null,t=null){return Promise.resolve(this.castAsJson(t))}_getExists(){return null==this._deleted||!this._deleted.has(this.getIndex())}_computeDisplayCentroid(e){if(null==this.getInTransform())return(0,h.Q)(new p.A,e,this.hasM,this.hasZ);const t=l.z.fromOptimized(e,this.geometryType);t.yFactor*=-1;const r=(0,u.d)(t);return r?(r[1]*=-1,new p.A([],r)):null}copyInto(e){e._joined=this._joined,e._deleted=this._deleted,e._objectIdToIndex=this._objectIdToIndex,e._boundsBuffer=this._boundsBuffer,e._activeCache=this._activeCache,e._caches=this._caches,e._contextTimeZone=this._contextTimeZone}_readLegacyGeometryWorldSpace(){const e=this.readGeometryWorldSpace();return(0,d.zv)(e,this.geometryType,!1,!1)}_createGeometryFromServerCentroid(){const e=this._readServerCentroid();if(!e)return null;const[t,r]=e.coords;return this._createQuantizedExtrudedGeometry(t,r)}_createQuantizedExtrudedGeometry(e,t){return"esriGeometryPolyline"===this.geometryType?this._createQuantizedExtrudedLine(e,t):this._createQuantizedExtrudedQuad(e,t)}_createQuantizedExtrudedQuad(e,t){return new p.A([5],[e-1,t,1,-1,1,1,-1,1,-1,-1])}_createQuantizedExtrudedLine(e,t){return new p.A([2],[e-1,t+1,1,-1])}_removeAtIndex(e){null==this._deleted&&(this._deleted=g.y.create(this.getSize())),this._deleted.set(e)}}},45273:function(e,t,r){r.d(t,{y:function(){return i}});class i{static fromBuffer(e,t){return new i(e,t)}static create(e,t=4294967295){const r=new Uint32Array(Math.ceil(e/32));return new i(r,t)}constructor(e,t){this._mask=0,this._buf=e,this._mask=t}_getIndex(e){return Math.floor(e/32)}has(e){const t=this._mask&e;return!!(this._buf[this._getIndex(t)]&1<<t%32)}hasRange(e,t){let r=e,i=t;for(;r%32&&r!==i;){if(this.has(r))return!0;r++}for(;i%32&&r!==i;){if(this.has(r))return!0;i--}if(r===i)return!1;for(let e=r/32;e!==i/32;e++)if(this._buf[e])return!0;return!1}set(e){const t=this._mask&e,r=this._getIndex(t),i=1<<t%32;this._buf[r]|=i}setRange(e,t){let r=e,i=t;for(;r%32&&r!==i;)this.set(r++);for(;i%32&&r!==i;)this.set(i--);if(r!==i)for(let e=r/32;e!==i/32;e++)this._buf[e]=4294967295}unset(e){const t=this._mask&e,r=this._getIndex(t),i=1<<t%32;this._buf[r]&=4294967295^i}resize(e){const t=this._buf,r=new Uint32Array(Math.ceil(e/32));r.set(t),this._buf=r}or(e){for(let t=0;t<this._buf.length;t++)this._buf[t]|=e._buf[t];return this}and(e){for(let t=0;t<this._buf.length;t++)this._buf[t]&=e._buf[t];return this}xor(e){for(let t=0;t<this._buf.length;t++)this._buf[t]^=e._buf[t];return this}ior(e){for(let t=0;t<this._buf.length;t++)this._buf[t]|=~e._buf[t];return this}iand(e){for(let t=0;t<this._buf.length;t++)this._buf[t]&=~e._buf[t];return this}ixor(e){for(let t=0;t<this._buf.length;t++)this._buf[t]^=~e._buf[t];return this}any(){for(let e=0;e<this._buf.length;e++)if(this._buf[e])return!0;return!1}copy(e){for(let t=0;t<this._buf.length;t++)this._buf[t]=e._buf[t];return this}clone(){return new i(this._buf.slice(),this._mask)}clear(){for(let e=0;e<this._buf.length;e++)this._buf[e]=0;return this}forEachSet(e){for(let t=0;t<this._buf.length;t++){let r=this._buf[t],i=32*t;if(r)for(;r;)1&r&&e(i),r>>>=1,i++}}countSet(){let e=0;return this.forEachSet((t=>{e++})),e}}},21970:function(e,t,r){r.d(t,{F:function(){return l}});var i=r(14130),n=r(91484),s=r(87416),o=r(75363),a=r(36008);class l{constructor(e,t){this.key=new a.A(0,0,0,0),this.bounds=(0,s.vt)(),this.objectIds=new Set,this.key.set(t);const r=e.getLODInfoAt(this.key);this.tileInfoView=e,this.tileInfoView.getTileBounds(this.bounds,this.key,!0),this.resolution=r.resolution,this.level=r.level,this.scale=r.scale,this.minScale=e.zoomToScale(r.level-1),this.maxScale=e.zoomToScale(r.level+1)}get lod(){return this.tileInfoView.getLODInfoAt(this.key)}get id(){return this.key.id}get extent(){return n.default.fromBounds(this.bounds,this.tileInfoView.tileInfo.spatialReference)}get transform(){return{originPosition:"upperLeft",scale:[this.resolution,this.resolution],translate:[this.bounds[0],this.bounds[3]]}}createArcadeEvaluationOptions(e){return{$view:{scale:this.scale,timeZone:e}}}createChildTiles(){const e=this.key.getChildKeys(),t=i.A.acquire();for(let r=0;r<e.length;r++)t[r]=new l(this.tileInfoView,e[r]);return t}getQuantizationParameters(){return o.A.fromJSON({mode:"view",originPosition:"upperLeft",tolerance:this.resolution,extent:{xmin:this.bounds[0],ymin:this.bounds[1],xmax:this.bounds[2],ymax:this.bounds[3],spatialReference:this.tileInfoView.tileInfo.spatialReference}})}}},19886:function(e,t,r){r.d(t,{$:function(){return l}});var i=r(39819),n=r(40633),s=r(98737);const o=()=>n.A.getLogger("esri.views.2d.layers.features.support.whereUtils"),a={getAttribute:(e,t)=>e.readAttribute(t)};async function l(e,t){try{const r=await(0,s.G)(e,t);if(!r.isStandardized){const e=new i.A("mapview - bad input","Unable to apply filter's definition expression, as expression is not standardized.",r);o().error(e)}return t=>{const i=t.readArcadeFeature();try{return r.testFeature(i,a)}catch(t){return o().warn("mapview-bad-where-clause","Encountered an error when evaluating where clause",e),!0}}}catch(t){return o().warn("mapview-bad-where-clause","Encountered an error when evaluating where clause",e),e=>!0}}},96700:function(e,t,r){r.d(t,{DF:function(){return a},Lu:function(){return c},RA:function(){return o},hV:function(){return l}});var i=r(13520),n=r(44740),s=(r(87416),r(57652),r(39686));const o=50;function a(e){if(!e)return null;const{xmin:t,ymin:r,xmax:i,ymax:s,spatialReference:o}=e;return new n.A({rings:[[[t,r],[t,s],[i,s],[i,r],[t,r]]],spatialReference:o})}function l(e){return(0,i.PN)(Math.round((0,i.Lz)(e)))}function c(e){const t=(0,i.PN)(s.GR),r=(0,i.PN)(s.cp);return Math.max(t,Math.min(e||r,r))}},60478:function(e,t,r){r.d(t,{F:function(){return h}});var i=r(53804),n=r(83525),s=r(58941),o=r(62790),a=r(28181),l=r(23502),c=(r(40633),r(13798),r(65953)),u=r(20248);let h=class extends n.A{constructor(e){super(e),this.debugName="",this._updatingHandles=new u.U,this._idToUpdatingState=new o.A}get updating(){const e=this._updatingHandles.updating||Array.from(this._idToUpdatingState.values()).some((e=>e));if((0,s.A)("esri-2d-log-updating")){const t=Array.from(this._idToUpdatingState.entries()).map((([e,t])=>`-> ${e}: ${t}`)).join("\n");console.log(`${this.debugName}: Updating: ${e}\n-> Handles: ${this._updatingHandles.updating}\n${t}`)}return e}addUpdateTracking(e,t){const r=(0,a.watch)((()=>t.updating),(t=>this._idToUpdatingState.set(e,t)),{sync:!0});this.addHandles(r)}addPromise(e){return this._updatingHandles.addPromise(e)}};(0,i._)([(0,l.MZ)({constructOnly:!0})],h.prototype,"debugName",void 0),(0,i._)([(0,l.MZ)({readOnly:!0})],h.prototype,"updating",null),h=(0,i._)([(0,c.$)("esri.views.2d.layers.support.UpdateTracking2D")],h)},11689:function(e,t,r){r.d(t,{A:function(){return s}});var i=r(56996),n=r(36008);class s{constructor(){this.spans=[]}acquire(e){this.lodInfo=e}release(){this.lodInfo=null,this.spans.length=0}*keys(){const e=this.lodInfo;for(const{row:t,colFrom:r,colTo:i}of this.spans)for(let s=r;s<=i;s++){const r=e.getWorldForColumn(s);yield new n.A(e.level,t,e.normalizeCol(s),r)}}forEach(e,t){const{spans:r,lodInfo:i}=this,{level:n}=i;if(0!==r.length)for(const{row:s,colFrom:o,colTo:a}of r)for(let r=o;r<=a;r++)e.call(t,n,s,i.normalizeCol(r),i.getWorldForColumn(r))}}s.pool=new i.A(s)},54608:function(e,t,r){r.d(t,{A:function(){return p}});var i=r(57652),n=r(36008);function s(e,t){return[e,t]}function o(e,t,r){return e[0]=t,e[1]=r,e}const a=new n.A("0/0/0/0");class l{static create(e,t,r=null){const n=(0,i.Vp)(e.spatialReference),a=t.origin||s(e.origin.x,e.origin.y),c=s(e.size[0]*t.resolution,e.size[1]*t.resolution),u=s(-1/0,-1/0),h=s(1/0,1/0),d=s(1/0,1/0);null!=r&&(o(u,Math.max(0,Math.floor((r.xmin-a[0])/c[0])),Math.max(0,Math.floor((a[1]-r.ymax)/c[1]))),o(h,Math.max(0,Math.floor((r.xmax-a[0])/c[0])),Math.max(0,Math.floor((a[1]-r.ymin)/c[1]))),o(d,h[0]-u[0]+1,h[1]-u[1]+1));const{cols:f,rows:p}=t;let m,_,g,y;return!r&&f&&p&&(o(u,f[0],p[0]),o(h,f[1],p[1]),o(d,f[1]-f[0]+1,p[1]-p[0]+1)),e.isWrappable?(m=s(Math.ceil(Math.round((n.valid[1]-n.valid[0])/t.resolution)/e.size[0]),d[1]),_=!0,g=n.origin,y=n.valid):(m=d,_=!1),new l(t.level,t.resolution,t.scale,a,u,h,d,c,m,_,g,y)}constructor(e,t,r,i,n,s,o,a,l,c,u,h){this.level=e,this.resolution=t,this.scale=r,this.origin=i,this.first=n,this.last=s,this.size=o,this.norm=a,this.worldSize=l,this.wrap=c,this._spatialReferenceOrigin=u,this._spatialReferenceValid=h}normalizeCol(e){if(!this.wrap)return e;const t=this.worldSize[0];return e<0?t-1-Math.abs((e+1)%t):e%t}normalizeKey(e){if(!this.wrap)return;const t=this.worldSize[0],r=e.col;r<0?(e.col=r+t,e.world-=1):r>=t&&(e.col=r-t,e.world+=1)}denormalizeCol(e,t){return this.wrap?this.worldSize[0]*t+e:e}getWorldForColumn(e){return this.wrap?Math.floor(e/this.worldSize[0]):0}getFirstColumnForWorld(e){return e*this.worldSize[0]+this.first[0]}getLastColumnForWorld(e){return e*this.worldSize[0]+this.first[0]+this.size[0]-1}getColumnForX(e){return(e-this.origin[0])/this.norm[0]}getXForColumn(e){const t=this.origin[0]+e*this.norm[0],r=this._spatialReferenceOrigin,i=this._spatialReferenceValid;return this.wrap&&r&&i?t===r[0]?i[0]:this.origin[0]===r[0]&&e===this.worldSize[0]?i[1]:t:t}getRowForY(e){return(this.origin[1]-e)/this.norm[1]}getYForRow(e){return this.origin[1]-e*this.norm[1]}getTileBounds(e,t,r=!1){a.set(t);const i=r?a.col:this.denormalizeCol(a.col,a.world),n=a.row;return function(e,t,r,i,n){e[0]=t,e[1]=r,e[2]=i,e[3]=n}(e,this.getXForColumn(i),this.getYForRow(n+1),this.getXForColumn(i+1),this.getYForRow(n)),e}getTileCoords(e,t,r=!1){a.set(t);const i=r?a.col:this.denormalizeCol(a.col,a.world);return Array.isArray(e)?o(e,this.getXForColumn(i),this.getYForRow(a.row)):(e.x=this.getXForColumn(i),e.y=this.getYForRow(a.row)),e}}var c=r(11689);class u{constructor(e,t,r){this.row=e,this.colFrom=t,this.colTo=r}}const h=new n.A("0/0/0/0");class d{static create(e,t){e[1]>t[1]&&([e,t]=[t,e]);const[r,i]=e,[n,s]=t,o=n-r,a=s-i,l=0!==a?o/a:0,c=(Math.ceil(i)-i)*l,u=(Math.floor(i)-i)*l;return new d(r,Math.floor(i),Math.ceil(s),l,o<0?c:u,o<0?u:c,o<0?n:r,o<0?r:n)}constructor(e,t,r,i,n,s,o,a){this.x=e,this.ymin=t,this.ymax=r,this.invM=i,this.leftAdjust=n,this.rightAdjust=s,this.leftBound=o,this.rightBound=a}incrRow(){this.x+=this.invM}getLeftCol(){return Math.max(this.x+this.leftAdjust,this.leftBound)}getRightCol(){return Math.min(this.x+this.rightAdjust,this.rightBound)}}const f=[[0,0],[0,0],[0,0],[0,0]];class p{constructor(e,t=null,r=e.lods[0].level,i=e.lods[e.lods.length-1].level){this.tileInfo=e,this.fullExtent=t,this.scales=[],this._infoByScale={},this._infoByLevel={};const n=e.lods.filter((e=>e.level>=r&&e.level<=i));this.minScale=n[0].scale,this.maxScale=n[n.length-1].scale;const s=this._lodInfos=n.map((r=>l.create(e,r,t)));n.forEach(((e,t)=>{this._infoByLevel[e.level]=s[t],this._infoByScale[e.scale]=s[t],this.scales[t]=e.scale}),this),this._wrap=e.isWrappable}get spatialReference(){return this.tileInfo.spatialReference}getLODInfoAt(e){return this._infoByLevel["number"==typeof e?e:e.level]}getTileBounds(e,t,r=!1){h.set(t);const i=this._infoByLevel[h.level];return i?i.getTileBounds(e,h,r):e}getTileCoords(e,t,r=!1){h.set(t);const i=this._infoByLevel[h.level];return i?i.getTileCoords(e,h,r):e}getTileCoverage(e,t=192,r=!0,i="closest"){if(!r&&(e.scale>this.minScale||e.scale<this.maxScale))return null;const n="closest"===i?this.getClosestInfoForScale(e.scale):this.getSmallestInfoForScale(e.scale),s=c.A.pool.acquire(n),o=this._wrap;let a,l,h,p=1/0,m=-1/0;const _=s.spans;f[0][0]=f[0][1]=f[1][1]=f[3][0]=-t,f[1][0]=f[2][0]=e.size[0]+t,f[2][1]=f[3][1]=e.size[1]+t;for(const t of f)e.toMap(t,t),t[0]=n.getColumnForX(t[0]),t[1]=n.getRowForY(t[1]);const g=[];let y=3;for(let e=0;e<4;e++){if(f[e][1]===f[y][1]){y=e;continue}const t=d.create(f[e],f[y]);p=Math.min(t.ymin,p),m=Math.max(t.ymax,m),void 0===g[t.ymin]&&(g[t.ymin]=[]),g[t.ymin].push(t),y=e}if(null==p||null==m||m-p>100)return null;let x=[];for(a=p;a<m;){null!=g[a]&&(x=x.concat(g[a])),l=1/0,h=-1/0;for(let e=x.length-1;e>=0;e--){const t=x[e];l=Math.min(l,t.getLeftCol()),h=Math.max(h,t.getRightCol())}if(l=Math.floor(l),h=Math.floor(h),a>=n.first[1]&&a<=n.last[1])if(o)if(n.size[0]<n.worldSize[0]){const e=Math.floor(h/n.worldSize[0]);for(let t=Math.floor(l/n.worldSize[0]);t<=e;t++)_.push(new u(a,Math.max(n.getFirstColumnForWorld(t),l),Math.min(n.getLastColumnForWorld(t),h)))}else _.push(new u(a,l,h));else l>n.last[0]||h<n.first[0]||(l=Math.max(l,n.first[0]),h=Math.min(h,n.last[0]),_.push(new u(a,l,h)));a+=1;for(let e=x.length-1;e>=0;e--){const t=x[e];t.ymax>=a?t.incrRow():x.splice(e,1)}}return s}getTileParentId(e){h.set(e);const t=this._infoByLevel[h.level],r=this._lodInfos.indexOf(t)-1;return r<0?null:(this._getTileIdAtLOD(h,this._lodInfos[r],h),h.id)}getTileResolution(e){const t=this._infoByLevel["object"==typeof e?e.level:e];return t?t.resolution:-1}getTileScale(e){const t=this._infoByLevel[e.level];return t?t.scale:-1}intersects(e,t){h.set(t);const r=this._infoByLevel[h.level],i=e.lodInfo;if(i.resolution>r.resolution){this._getTileIdAtLOD(h,i,h);const t=i.denormalizeCol(h.col,h.world);for(const r of e.spans)if(r.row===h.row&&r.colFrom<=t&&r.colTo>=t)return!0}if(i.resolution<r.resolution){const[t,n,s,o]=e.spans.reduce(((e,t)=>(e[0]=Math.min(e[0],t.row),e[1]=Math.max(e[1],t.row),e[2]=Math.min(e[2],t.colFrom),e[3]=Math.max(e[3],t.colTo),e)),[1/0,-1/0,1/0,-1/0]),a=r.denormalizeCol(h.col,h.world),l=i.getColumnForX(r.getXForColumn(a)),c=i.getRowForY(r.getYForRow(h.row)),u=i.getColumnForX(r.getXForColumn(a+1))-1,d=i.getRowForY(r.getYForRow(h.row+1))-1;return!(l>o||u<s||c>n||d<t)}const n=i.denormalizeCol(h.col,h.world);return e.spans.some((e=>e.row===h.row&&e.colFrom<=n&&e.colTo>=n))}normalizeBounds(e,t,r){if(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],this._wrap){const t=(0,i.Vp)(this.tileInfo.spatialReference),n=-r*(t.valid[1]-t.valid[0]);e[0]+=n,e[2]+=n}return e}getSmallestInfoForScale(e){const t=this.scales;if(this._infoByScale[e])return this._infoByScale[e];if(e>t[0])return this._infoByScale[t[0]];for(let r=1;r<t.length-1;r++)if(e>t[r]+1e-6)return this._infoByScale[t[r-1]];return this._infoByScale[t[t.length-1]]}getClosestInfoForScale(e){const t=this.scales;return this._infoByScale[e]||(e=t.reduce(((t,r)=>Math.abs(r-e)<Math.abs(t-e)?r:t),t[0])),this._infoByScale[e]}scaleToLevel(e){const t=this.scales;if(this._infoByScale[e])return this._infoByScale[e].level;for(let r=t.length-1;r>=0;r--)if(e<t[r])return r===t.length-1?this._infoByScale[t[t.length-1]].level:this._infoByScale[t[r]].level+(t[r]-e)/(t[r]-t[r+1]);return this._infoByScale[t[0]].level}scaleToZoom(e){return this.tileInfo.scaleToZoom(e)}zoomToScale(e){return this.tileInfo.zoomToScale(e)}_getTileIdAtLOD(e,t,r){const i=this._infoByLevel[r.level];return e.set(r),t.resolution<i.resolution?null:(t.resolution===i.resolution||(e.level=t.level,e.col=Math.floor(r.col*i.resolution/t.resolution+.01),e.row=Math.floor(r.row*i.resolution/t.resolution+.01)),e)}}},36008:function(e,t,r){r.d(t,{A:function(){return n}});var i=r(56996);class n{static getId(e,t,r,i){return"object"==typeof e?`${e.level}/${e.row}/${e.col}/${e.world}`:`${e}/${t}/${r}/${i}`}constructor(e,t,r,i){this.set(e,t,r,i)}get key(){return this}get id(){return this.toString()}get normalizedId(){return`${this.level}/${this.row}/${this.col}`}set id(e){this.set(e)}get hash(){const e=4095&this.row,t=4095&this.col,r=63&this.level;return(3&this.world)<<30|t<<22|e<<8|r}acquire(e,t,r,i){this.set(e,t,r,i)}contains(e){const t=e.level-this.level;return t>=0&&this.row===e.row>>t&&this.col===e.col>>t&&this.world===e.world}containsChild(e){const t=e.level-this.level;return t>0&&this.row===e.row>>t&&this.col===e.col>>t&&this.world===e.world}equals(e){return this.level===e.level&&this.row===e.row&&this.col===e.col&&this.world===e.world}clone(){return new n(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(e,t,r,i){if(null==e)this.level=0,this.row=0,this.col=0,this.world=0;else if("object"==typeof e)this.level=e.level||0,this.row=e.row||0,this.col=e.col||0,this.world=e.world||0;else if("string"==typeof e){const[t,r,i,n]=e.split("/");this.level=parseFloat(t),this.row=parseFloat(r),this.col=parseFloat(i),this.world=parseFloat(n)}else this.level=+e,this.row=+t,this.col=+r,this.world=+i||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new n(this.level-1,this.row>>1,this.col>>1,this.world)}getNormalizedNeighbor(e,t,r){const i=this.clone();return i.col+=e,i.row+=t,r.normalizeKey(i),i}getChildKeys(){const e=this.level+1,t=this.row<<1,r=this.col<<1,i=this.world;return[new n(e,t,r,i),new n(e,t,r+1,i),new n(e,t+1,r,i),new n(e,t+1,r+1,i)]}compareRowMajor(e){return this.row<e.row?-1:this.row>e.row?1:this.col<e.col?-1:this.col>e.col?1:0}}n.pool=new i.A(n,null,null,25,50)},38648:function(e,t,r){r.d(t,{A:function(){return p}});var i=r(53804),n=r(83525),s=r(25738),o=r(95929),a=r(17660),l=r(23502),c=(r(58941),r(40633),r(13798),r(65953)),u=r(13786),h=r(46863);const d=[0,0];let f=class extends n.A{constructor(e){super(e),this._keyToItem=new Map,this._tilesByScale=new Map,this.concurrency=6}initialize(){const{concurrency:e,process:t,scheduler:r,priority:i}=this;this._queue=new h.e({concurrency:e,scheduler:r,priority:i,process:(e,r)=>{const i=this._keyToItem.get(e);return t(i,{signal:r})},peeker:e=>this._peek(e)})}destroy(){this.clear(),this._queue=(0,o.pR)(this._queue)}get length(){return this._queue?this._queue.length:0}abort(e){const t="string"==typeof e?e:e.id;this._queue.abort(t)}clear(){this._queue.clear(),this._keyToItem.clear(),this._tilesByScale.clear()}has(e){return"string"==typeof e?this._keyToItem.has(e):this._keyToItem.has(e.id)}pause(){this._queue.pause()}push(e){const t=e.key.id;if(this._queue.has(t))return this._queue.get(t);const r=this._queue.push(t),i=this.tileInfoView.getTileScale(e.key),n=(0,s.tE)(this._tilesByScale,i,(()=>new Set)),o=()=>{n.delete(e.key),0===n.size&&this._tilesByScale.delete(i),this._keyToItem.delete(t)};return n.add(e.key),this._keyToItem.set(t,e),r.then(o,o),r}reset(){this._queue.reset()}resume(){this._queue.resume()}_peek(e){if(!this.state)return e.values().next().value;const t=new Set;for(const r of e)t.add(this._keyToItem.get(r).key);const r=this.state.scale;let i,n=Number.POSITIVE_INFINITY;for(const[e,s]of this._tilesByScale)if((0,a.bw)(s,(e=>t.has(e)))){const t=Math.abs(e-r);t<n&&(i=s,n=t)}return this._getClosestTileKey(i,e).id}_getClosestTileKey(e,t){const r=this.tileInfoView,i=this.state.center;let n,s=Number.POSITIVE_INFINITY;for(const o of e)if(t.has(o.id)){r.getTileCoords(d,o);const e=(0,u.Io)(d,i);e<s&&(s=e,n=o)}return n}};(0,i._)([(0,l.MZ)({constructOnly:!0})],f.prototype,"concurrency",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0})],f.prototype,"priority",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0})],f.prototype,"process",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0})],f.prototype,"scheduler",void 0),(0,i._)([(0,l.MZ)()],f.prototype,"state",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0})],f.prototype,"tileInfoView",void 0),f=(0,i._)([(0,c.$)("esri.views.2d.tiling.TileQueue")],f);const p=f},82563:function(e,t,r){r.d(t,{A:function(){return d}});var i=r(87416),n=r(13786);class s{constructor(e,t,r){this.maxSize=e,this._tileInfoView=t,this._removedFunc=r,this._tilePerId=new Map,this._tileKeysPerLevel=[]}clear(){this._tilePerId.clear(),this._tileKeysPerLevel=[]}has(e){return this._tilePerId.has(e)}get(e){return this._tilePerId.get(e)}pop(e){const t=this._tilePerId.get(e);if(!t)return;const r=t.key.level,i=this._tileKeysPerLevel[r];o(this._tilePerId,e);for(let t=0;t<i.length;t++)if(i[t].id===e){i.splice(t,1);break}return t.visible=!0,t}add(e){e.visible=!1;const t=e.key,r=t.id;if(this._tilePerId.has(r))return;this._tilePerId.set(r,e);const i=t.level;this._tileKeysPerLevel[i]||(this._tileKeysPerLevel[i]=[]),this._tileKeysPerLevel[i].push(t)}prune(e,t,r){let i=this._tilePerId.size;if(i<=this.maxSize)return;let n=this._tileKeysPerLevel.length-1;for(;i>this.maxSize&&n>=0;)n!==e&&(i=this._pruneAroundCenterTile(i,t,r,n)),n--;i>this.maxSize&&(i=this._pruneAroundCenterTile(i,t,r,e))}_pruneAroundCenterTile(e,t,r,i){const s=this._tileKeysPerLevel[i];if(!s||0===s.length)return e;const{size:o,origin:a}=this._tileInfoView.tileInfo,l=r*o[0],c=r*o[1],u=[0,0],h=[0,0];for(s.sort(((e,r)=>(u[0]=a.x+l*(e.col+.5),u[1]=a.y-c*(e.row+.5),h[0]=a.x+l*(r.col+.5),h[1]=a.y-c*(r.row+.5),(0,n.hG)(u,t)-(0,n.hG)(h,t))));s.length>0;){const t=s.pop();if(this._removeTile(t.id),--e===this.maxSize)break}return e}_removeTile(e){const t=this._tilePerId.get(e);this._removedFunc&&t&&this._removedFunc(t),o(this._tilePerId,e)}}function o(e,t){e.delete(t)}var a=r(11689);const l=new(r(36008).A)(0,0,0,0),c=new Map,u=[],h=[];class d{constructor(e){this._previousScale=Number.POSITIVE_INFINITY,this.cachePolicy="keep",this.coveragePolicy="closest",this.resampling=!0,this.tileIndex=new Map,this.tiles=[],this.buffer=192,this.acquireTile=e.acquireTile,this.releaseTile=e.releaseTile,this.tileInfoView=e.tileInfoView,null!=e.resampling&&(this.resampling=e.resampling),e.cachePolicy&&(this.cachePolicy=e.cachePolicy),e.coveragePolicy&&(this.coveragePolicy=e.coveragePolicy),null!=e.buffer&&(this.buffer=e.buffer),e.cacheSize&&(this._tileCache=new s(e.cacheSize,this.tileInfoView,(e=>{this.releaseTile(e)})))}destroy(){this.tileIndex.clear()}update(e){const{resampling:t,tileIndex:r}=this,{scale:i,center:n,resolution:s}=e.state,{minScale:o,maxScale:d}=this.tileInfoView,f=!e.stationary&&i>this._previousScale;if(this._previousScale=i,!t&&(i>o||i<d))return this.tiles.length=0,void this.clear();const p=this.tileInfoView.getTileCoverage(e.state,this.buffer,this.resampling,this.coveragePolicy);if(!p)return this.tiles.length=0,void this.clear();const{spans:m,lodInfo:_}=p,{level:g}=_;this.tiles.length=0,r.forEach((e=>e.visible=!0));let y=0,x=0;if(m.length>0)for(const{row:e,colFrom:t,colTo:i}of m)for(let n=t;n<=i;n++){y++;const t=l.set(g,e,_.normalizeCol(n),_.getWorldForColumn(n)).id;let i=r.get(t);if(i)i.isReady?(c.set(t,i),x++):f||this._addParentTile(t,c);else{if(this._tileCache?.has(t)){if(i=this._tileCache.pop(t),this.tileIndex.set(t,i),i.isReady){c.set(t,i),x++;continue}}else i=this.acquireTile(l),this.tileIndex.set(t,i);f||this._addParentTile(t,c)}}const b=x===y;for(const[e,t]of r){if(c.has(e))continue;l.set(e);const r=this.tileInfoView.intersects(p,l),i="purge"===this.cachePolicy?l.level!==g:l.level>g;!r||!f&&b?!i&&r||u.push(t):t.isReady?i&&"purge"===this.cachePolicy&&this._hasReadyAncestor(l,g)?u.push(t):h.push(t):i&&u.push(t)}for(const e of h)e.isReady&&c.set(e.key.id,e);for(const e of u)this._tileCache?this._tileCache.add(e):this.releaseTile(e),r.delete(e.key.id);for(const e of c.values())this.tiles.push(e);for(const e of r.values())c.has(e.key.id)||(e.visible=!1);this._tileCache?.prune(g,n,s),a.A.pool.release(p),h.length=0,u.length=0,c.clear()}clear(){const{tileIndex:e}=this;for(const t of e.values())this.releaseTile(t);e.clear()}refresh(e){for(const t of this.tileIndex.values())e(t);this._tileCache?.clear()}updateCacheSize(e){this._tileCache&&(this._tileCache.maxSize=e)}_addParentTile(e,t){let r=e,i=null;for(;r=this.tileInfoView.getTileParentId(r),r;)if(this.tileIndex.has(r)){if(i=this.tileIndex.get(r),i?.isReady){t.has(i.key.id)||t.set(i.key.id,i);break}}else if(this._tileCache?.has(r)&&(i=this._tileCache.pop(r),this.tileIndex.set(r,i),i?.isReady)){t.has(i.key.id)||t.set(i.key.id,i);break}}_hasReadyAncestor(e,t){const r=(0,i.vt)();this.tileInfoView.getTileBounds(r,e,!0);for(const n of this.tileIndex.values())if(n.isReady&&n.key.level>=t&&n.key.level<e.level){const e=(0,i.vt)();if(this.tileInfoView.getTileBounds(e,n.key,!0),(0,i.gR)(e,r))return!0}return!1}}},54516:function(e,t,r){var i;r.d(t,{c:function(){return i}}),function(e){e[e.Pass=0]="Pass",e[e.Draw=1]="Draw"}(i||(i={}))},90553:function(e,t,r){r.d(t,{L:function(){return l},MX:function(){return o},O_:function(){return a},kL:function(){return c},vA:function(){return s},zH:function(){return u}});var i=r(1932);r(33400),(0,r(41546).vt)();class n{constructor(e){this.message=e}toString(){return`AssertException: ${this.message}`}}function s(e,t="Assertion"){if(!e){const e=new Error(t).stack;throw new n(`${t} at ${e}`)}}function o(e,t){e||(t=t||"",console.warn("Verify failed: "+t+"\n"+new Error("verify").stack))}function a(e,t,r,i){let n,s=(r[0]-e[0])/t[0],o=(i[0]-e[0])/t[0];s>o&&(n=s,s=o,o=n);let a=(r[1]-e[1])/t[1],l=(i[1]-e[1])/t[1];if(a>l&&(n=a,a=l,l=n),s>l||a>o)return!1;a>s&&(s=a),l<o&&(o=l);let c=(r[2]-e[2])/t[2],u=(i[2]-e[2])/t[2];return c>u&&(n=c,c=u,u=n),!(s>u||c>o||(u<o&&(o=u),o<0))}function l(e,t,r,n,s,o=(0,i.vt)()){const a=(n[s]-r[s])*(t[0]-e[0])-(n[0]-r[0])*(t[s]-e[s]),l=(n[0]-r[0])*(e[s]-r[s])-(n[s]-r[s])*(e[0]-r[0]);if(0===a)return!1;const c=l/a;return o[0]=e[0]+c*(t[0]-e[0]),o[1]=e[s]+c*(t[s]-e[s]),!0}function c(e,t){return Math.log(e)/Math.log(t)}function u(e){return 1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&1===e[15]}},46863:function(e,t,r){r.d(t,{e:function(){return u}}),r(58941);var i=r(95929),n=r(60539),s=r(51846),o=r(62790),a=r(74087),l=r(85445);class c{constructor(e,t){this.item=e,this.controller=t,this.promise=null}}class u{constructor(e){this._schedule=null,this._task=null,this._deferreds=new o.A,this._controllers=new o.A,this._processingItems=new o.A,this._pausedSignal=(0,l.v)(!1),this.concurrency=1,e.concurrency&&(this.concurrency=e.concurrency),this._queue=new s.A(e.peeker),this.process=e.process;const t=e.scheduler;e.priority&&t&&(this._task=t.registerTask(e.priority,this))}destroy(){this.clear(),this._schedule=(0,i.xt)(this._schedule),this._task=(0,i.xt)(this._task)}get updating(){return!!this._task?.updating||this.running}get length(){return this._processingItems.size+this._queue.length}abort(e){const t=this._controllers.get(e);t&&t.abort()}clear(){this._queue.clear();const e=[];this._controllers.forEach((t=>e.push(t))),this._controllers.clear(),e.forEach((e=>e.abort())),this._processingItems.clear(),this._cancelNext()}forEach(e){this._deferreds.forEach(((t,r)=>e(r)))}get(e){const t=this._deferreds.get(e);return t?t.promise:void 0}isOngoing(e){return this._processingItems.has(e)}has(e){return this._deferreds.has(e)}pause(){this._pausedSignal.value||(this._pausedSignal.value=!0,this._cancelNext())}push(e,t){const r=this.get(e);if(r)return r;const i=new AbortController;let s=null;t&&(s=(0,n.u7)(t,(()=>i.abort())));const o=()=>{a.remove(),null!=s&&s.remove(),this._removeItem(e),this._queue.remove(e),this._scheduleNext()},a=(0,n.NY)(i.signal,(()=>{const t=this._processingItems.get(e);t&&t.controller.abort(),o(),l.reject((0,n.NK)())})),l=(0,n.Tw)();return this._deferreds.set(e,l),this._controllers.set(e,i),l.promise.then(o,o),this._queue.push(e),this._scheduleNext(),l.promise}last(){return this._queue.last()}lastPromise(){const e=this.last();return e?this.get(e):null}peek(){return this._queue.peek()}popLast(){const e=this._queue.popLast();return e&&(this._deferreds.get(e)?.reject((0,n.NK)()),this._removeItem(e)),e}reset(){const e=Array.from(this._processingItems.values());this._processingItems.clear();for(const t of e)this._queue.push(t.item),t.controller.abort();this._scheduleNext()}resume(){this._pausedSignal.value&&(this._pausedSignal.value=!1,this._scheduleNext())}takeAll(){const e=[];for(;this._queue.length;)e.push(this._queue.pop());return this.clear(),e}get running(){return!this._pausedSignal.value&&this._queue.length>0&&this._processingItems.size<this.concurrency}runTask(e){for(;!e.done&&this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop()),e.madeProgress()}_removeItem(e){this._deferreds.delete(e),this._controllers.delete(e),this._processingItems.delete(e)}_scheduleNext(){this._task||this._pausedSignal.value||this._schedule||(this._schedule=(0,a._)((()=>{this._schedule=null,this._next()})))}_next(){for(;this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())}_cancelNext(){this._schedule&&(this._schedule.remove(),this._schedule=null)}_processResult(e,t){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).resolve(t))}_processError(e,t){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).reject(t))}_canProcessFulfillment(e){return!!this._deferreds.get(e.item)&&this._processingItems.get(e.item)===e}_process(e){if(null==e)return;let t;const r=new AbortController,i=new c(e,r);this._processingItems.set(e,i);try{t=this.process(e,r.signal)}catch(e){this._processError(i,e)}(0,n.$X)(t)?(i.promise=t,t.then((e=>this._processResult(i,e)),(e=>this._processError(i,e)))):this._processResult(i,t)}get test(){}}},81197:function(e,t,r){var i;r.d(t,{M:function(){return i}}),function(e){e[e.ANIMATING=0]="ANIMATING",e[e.INTERACTING=1]="INTERACTING",e[e.IDLE=2]="IDLE"}(i||(i={}))},48961:function(e,t,r){r.d(t,{Bb:function(){return E},W6:function(){return i},mj:function(){return y},nu:function(){return P}});var i,n,s=r(14606),o=(r(58941),r(40633)),a=r(95929),l=r(69739),c=r(7187),u=r(60539),h=r(28181),d=r(85445),f=r(38504),p=r(47558),m=r(16164),_=r(81197),g=r(55213);function y(){return new M.Scheduler}(n=i||(i={})).RESOURCE_CONTROLLER_IMMEDIATE="immediate",n.RESOURCE_CONTROLLER="schedule",n.SLIDE="slide",n.STREAM_DATA_LOADER="stream loader",n.ELEVATION_QUERY="elevation query",n.TERRAIN_SURFACE="terrain",n.SURFACE_GEOMETRY_UPDATES="surface geometry updates",n.LOD_RENDERER="LoD renderer",n.GRAPHICS_CORE="Graphics3D",n.I3S_CONTROLLER="I3S",n.POINT_CLOUD_LAYER="point cloud",n.FEATURE_TILE_FETCHER="feature fetcher",n.OVERLAY="overlay",n.STAGE="stage",n.GRAPHICS_DECONFLICTOR="graphics deconflictor",n.FILTER_VISIBILITY="Graphics3D filter visibility",n.SCALE_VISIBILITY="Graphics3D scale visibility",n.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",n.POINT_OF_INTEREST_FREQUENT="POI frequent",n.POINT_OF_INTEREST_INFREQUENT="POI infrequent",n.LABELER="labeler",n.FEATURE_QUERY_ENGINE="feature query",n.FEATURE_TILE_TREE="feature tile tree",n.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",n.ELEVATION_ALIGNMENT="elevation alignment",n.ELEVATION_ALIGNMENT_SCENE="elevation alignment scene",n.TEXT_TEXTURE_ATLAS="text texture atlas",n.TEXTURE_UNLOAD="texture unload",n.LINE_OF_SIGHT_TOOL="line of sight tool",n.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",n.ELEVATION_PROFILE="elevation profile",n.SNAPPING="snapping",n.SHADOW_ACCUMULATOR="shadow accumulator",n.CLOUDS_GENERATOR="clouds generator",n.MAPVIEW_FETCH_QUEUE="mapview fetch queue",n.MAPVIEW_LAYERVIEW_UPDATE="mapview layerview update",n.MAPVIEW_VECTOR_TILE_PARSING_QUEUE="mapview vector tile parsing queue",n[n.NONE=0]="NONE",n[n.TEST_PRIO=1]="TEST_PRIO";const x=new Map([[i.RESOURCE_CONTROLLER_IMMEDIATE,0],[i.RESOURCE_CONTROLLER,4],[i.SLIDE,0],[i.STREAM_DATA_LOADER,0],[i.ELEVATION_QUERY,0],[i.TERRAIN_SURFACE,1],[i.SURFACE_GEOMETRY_UPDATES,1],[i.LOD_RENDERER,2],[i.GRAPHICS_CORE,2],[i.I3S_CONTROLLER,2],[i.POINT_CLOUD_LAYER,2],[i.FEATURE_TILE_FETCHER,2],[i.CLOUDS_GENERATOR,2],[i.OVERLAY,4],[i.STAGE,4],[i.GRAPHICS_DECONFLICTOR,4],[i.FILTER_VISIBILITY,4],[i.SCALE_VISIBILITY,4],[i.FRUSTUM_VISIBILITY,4],[i.POINT_OF_INTEREST_FREQUENT,6],[i.POINT_OF_INTEREST_INFREQUENT,30],[i.LABELER,8],[i.FEATURE_QUERY_ENGINE,8],[i.FEATURE_TILE_TREE,16],[i.FEATURE_TILE_TREE_ACTIVE,0],[i.ELEVATION_ALIGNMENT,12],[i.ELEVATION_ALIGNMENT_SCENE,14],[i.TEXT_TEXTURE_ATLAS,12],[i.TEXTURE_UNLOAD,12],[i.LINE_OF_SIGHT_TOOL,16],[i.LINE_OF_SIGHT_TOOL_INTERACTIVE,0],[i.SNAPPING,0],[i.SHADOW_ACCUMULATOR,30],[i.MAPVIEW_FETCH_QUEUE,0],[i.MAPVIEW_LAYERVIEW_UPDATE,2],[i.MAPVIEW_VECTOR_TILE_PARSING_QUEUE,0]]);function b(e){return x.has(e)?x.get(e):"number"==typeof e?e:1}const w=(0,f.l5)(6.5),v=(0,f.l5)(1),S=(0,f.l5)(30),T=(0,f.l5)(1e3/30),I=(0,f.l5)(100);var M,A;!function(e){e.Scheduler=class{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some((e=>e.needsUpdate))}constructor(){this._updating=(0,d.v)(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new l.A("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new r,this._state=_.M.INTERACTING,this._tasks=new c.A,this._runQueue=new c.A,this._load=0,this._idleStateCallbacks=new c.A,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=(0,h.watch)((()=>m.A.SCHEDULER_LOG_SLOW_TASKS),(e=>this._debug=e),h.Vh);for(const e of Object.keys(i))this.performanceInfo.tasks.set(i[e],new l.A(i[e]))}destroy(){this._tasks.toArray().forEach((e=>e.remove())),this._tasks.clear(),(0,a.xt)(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(e){this._updatingChanged(),e&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask((()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this.frame())})))}registerTask(e,r){const i=new t(this,e,r);return this._tasks.push(i),this._updatingChanged(),this.performanceInfo.tasks.has(e)||this.performanceInfo.tasks.set(e,new l.A(e)),i}registerIdleStateCallbacks(e,t){const r={idleBegin:e,idleEnd:t};this._idleStateCallbacks.push(r),this.state===_.M.IDLE&&this._idleUpdatesStartFired&&r.idleBegin();const i=this;return{remove:()=>this._removeIdleStateCallbacks(r),set idleBegin(e){i._idleUpdatesStartFired&&(r.idleEnd(),i._state===_.M.IDLE&&e()),r.idleBegin=e},set idleEnd(e){r.idleEnd=e}}}get load(){return this._load}set state(e){this._state!==e&&(this._state=e,this.state!==_.M.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll((e=>e.idleEnd()))))}get state(){return this._state}updateBudget(e){this._test&&(this._test.usedBudget=0),++this._frameNumber;let t=w,r=e.frameDuration,i=v;switch(this.state){case _.M.IDLE:t=(0,f.l5)(0),r=(0,f.l5)(Math.max(I,e.frameDuration)),i=S;break;case _.M.INTERACTING:r=(0,f.l5)(Math.max(T,e.frameDuration));case _.M.ANIMATING:}return r=(0,f.l5)(r-e.elapsedFrameTime-t),this.state!==_.M.IDLE&&r<v&&!this._forceTask?(this._forceTask=!0,!1):(r=(0,f.l5)(Math.max(r,i)),this._budget.reset(r,this.state),this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case _.M.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll((e=>e.idleBegin()))),this._runIdle();break;case _.M.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test&&(this._test.usedBudget=this._budget.elapsed)}stopFrame(){this._budget.reset((0,f.l5)(0),this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(e){this._idleUpdatesStartFired&&e.idleEnd(),this._idleStateCallbacks.removeUnordered(e)}removeTask(e){this._tasks.removeUnordered(e),this._runQueue.removeUnordered(e),this._updatingChanged()}_updateTask(e){this._tasks.forAll((t=>{t.name===e&&t.setPriority(e)}))}_getState(e){if(this._runQueue.some((t=>t.name===e)))return A.SCHEDULED;let t=A.IDLE;return this._tasks.forAll((r=>{r.name===e&&r.needsUpdate&&(r.schedulePriority<=1?t=A.READY:t!==A.READY&&(t=A.WAITING))})),t}_getRuntime(e){let t=0;return this._tasks.forAll((r=>{r.name===e&&(t+=r.runtime)})),t}_resetRuntimes(){this._tasks.forAll((e=>e.runtime=0))}_getRunning(){const e=new Map;if(this._tasks.forAll((t=>{t.needsUpdate&&e.set(t.name,(e.get(t.name)||0)+1)})),0===e.size)return null;let t="";return e.forEach(((e,r)=>{t+=e>1?` ${e}x ${r}`:` ${r}`})),t}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const e=this._tasks.reduce(((e,t)=>t.needsUpdate?++e:e),0);this._load=.9*this._load+e*(1-.9)}_schedule(){for(this._runQueue.filterInPlace((e=>!!e.needsUpdate||(e.schedulePriority=e.basePriority,!1))),this._tasks.forAll((e=>{0===e.basePriority&&e.needsUpdate&&!this._runQueue.includes(e)&&e.blockFrame!==this._frameNumber&&this._runQueue.unshift(e)}));0===this._runQueue.length;){let e=!1,t=0;if(this._tasks.forAll((r=>{r.needsUpdate&&0!==r.schedulePriority&&0!==r.basePriority&&r.blockFrame!==this._frameNumber&&(e=!0,t=Math.max(t,r.basePriority),1===r.schedulePriority?(r.schedulePriority=0,this._runQueue.push(r)):--r.schedulePriority)})),!e)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){const e=this._budget.now();this._startFrameTaskTimes();do{for(;this._runQueue.length>0;){const t=this._budget.now(),r=this._runQueue.pop();this._budget.resetProgress();try{r.task.runTask(this._budget)===g.G&&(r.blockFrame=this._frameNumber)}catch(e){o.A.getLogger("esri.views.support.Scheduler").error(`Exception in task "${r.name}"`,e),r.blockFrame=this._frameNumber}!this._budget.hasProgressed&&r.blockFrame!==this._frameNumber&&r.needsUpdate&&(r.name,i.I3S_CONTROLLER,r.blockFrame=this._frameNumber),r.schedulePriority=r.basePriority;const n=this._budget.now()-t;if(r.runtime+=n,this._frameTaskTimes.set(r.priority,this._frameTaskTimes.get(r.priority)+n),this._budget.remaining<=0)return this._updatingChanged(),void this._recordFrameTaskTimes(this._budget.now()-e)}}while(this._schedule());this._updatingChanged(),this._recordFrameTaskTimes(this._budget.now()-e)}_startFrameTaskTimes(){for(const e of Object.keys(i))this._frameTaskTimes.set(i[e],0)}_recordFrameTaskTimes(e){this._frameTaskTimes.forEach(((e,t)=>this.performanceInfo.tasks.get(t).push(e))),this.performanceInfo.total.push(e)}get test(){return this._test}};class t{get task(){return this._task.value}get updating(){return this._queue.running}constructor(e,t,r){this._scheduler=e,this.name=t,this.blockFrame=0,this.runtime=0,this._queue=new p.T,this._handles=new s.A,this._basePriority=b(t),this.schedulePriority=this._basePriority,this._task=(0,d.v)(null!=r?r:this._queue),this._handles.add((0,h.when)((()=>this.task.running),(t=>e.taskRunningChanged(t))))}remove(){this.processQueue(E),this._scheduler.removeTask(this),this.schedule=P.schedule,this.reschedule=P.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(e){if(this.name===e)return;this.name=e;const t=b(e);0!==this._basePriority&&0===this.schedulePriority||(this.schedulePriority=t),this._basePriority=t}get priority(){return this.name}set priority(e){this.setPriority(e)}get needsUpdate(){return this.updating||this.task.running}schedule(e,t,r){return this._queue.push(e,t,r)}reschedule(e,t,r){return this._queue.unshift(e,t,r)}processQueue(e){return this._queue.runTask(e)}}class r{constructor(){this._begin="undefined"!=typeof performance?performance.now():0,this._budget=0,this._state=_.M.IDLE,this._done=!1,this._progressed=!1,this._enabled=!0}run(e){return!this.done&&(!0===e()&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get state(){return this._state}get enabled(){return this._enabled}set enabled(e){this._enabled=e}reset(e,t){this._begin=this.now(),this._budget=e,this._state=t,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return this.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}e.Budget=r}(M||(M={})),function(e){e.SCHEDULED="s",e.READY="r",e.WAITING="w",e.IDLE="i"}(A||(A={}));const E=(()=>{const e=new M.Budget;return e.enabled=!1,e})(),P=new class{remove(){}processQueue(){}schedule(e,t,r){try{if((0,u.G4)(t)){const e=(0,u.NK)();return r?Promise.resolve(r(e)):Promise.reject(e)}return(0,u.z7)(e(E))}catch(e){return Promise.reject(e)}}reschedule(e,t,r){return this.schedule(e,t,r)}}},55213:function(e,t,r){r.d(t,{G:function(){return i}});const i=Symbol("Yield")},16164:function(e,t,r){r.d(t,{A:function(){return l}});var i=r(53804),n=r(83525),s=r(23502),o=(r(58941),r(40633),r(13798),r(65953));let a=class extends n.A{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};(0,i._)([(0,s.MZ)()],a.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),(0,i._)([(0,s.MZ)()],a.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),a=(0,i._)([(0,o.$)("esri.views.support.debugFlags")],a);const l=new a},86305:function(e,t,r){r.d(t,{g:function(){return c}});var i=r(50659),n=(r(58941),r(40633)),s=r(24540),o=r(41835),a=r(85456);const l=()=>n.A.getLogger("esri.views.webgl.BufferObject");class c{static createIndex(e,t,r){return new c(e,a.NZ.ELEMENT_ARRAY_BUFFER,t,r)}static createVertex(e,t,r){return new c(e,a.NZ.ARRAY_BUFFER,t,r)}static createUniform(e,t,r){return new c(e,a.NZ.UNIFORM_BUFFER,t,r)}static createPixelPack(e,t=a._U.STREAM_READ,r){const i=new c(e,a.NZ.PIXEL_PACK_BUFFER,t);return r&&i.setSize(r),i}static createPixelUnpack(e,t=a._U.STREAM_DRAW,r){return new c(e,a.NZ.PIXEL_UNPACK_BUFFER,t,r)}static createTransformFeedback(e,t=a._U.STATIC_DRAW,r){const i=new c(e,a.NZ.TRANSFORM_FEEDBACK_BUFFER,t);return i.setSize(r),i}constructor(e,t,r,i){this._context=e,this.bufferType=t,this.usage=r,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(a.vt.BufferObject,this),this._glName=this._context.gl.createBuffer(),(0,o.Y2)(this._context.gl),i&&this.setData(i)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get usedMemory(){if(this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER){if(this._indexType===a.pe.UNSIGNED_INT)return 4*this._size;if(this._indexType===a.pe.UNSIGNED_SHORT)return 2*this._size}return this._size}get _isVAOAware(){return this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER||this.bufferType===a.NZ.ARRAY_BUFFER}dispose(){this._context?.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(a.vt.BufferObject,this),this._context=null):this._glName&&l().warn("Leaked WebGL buffer object")}setSize(e,t=null){if(this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER&&null!=t)switch(this._indexType=t,t){case a.pe.UNSIGNED_SHORT:e*=2;break;case a.pe.UNSIGNED_INT:e*=4}this._setBufferData(e)}setData(e){if(!e)return;let t=e.byteLength;this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER&&((0,s.mg)(e)?this._indexType=a.pe.UNSIGNED_BYTE:(0,s.jq)(e)?(t/=2,this._indexType=a.pe.UNSIGNED_SHORT):(0,s.XJ)(e)&&(t/=4,this._indexType=a.pe.UNSIGNED_INT)),this._setBufferData(t,e)}_setBufferData(e,t=null){this._size=e;const r=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const i=this._context.gl;null!=t?i.bufferData(this.bufferType,t,this.usage):i.bufferData(this.bufferType,e,this.usage),(0,o.Y2)(i),this._isVAOAware&&this._context.bindVAO(r)}setSubData(e,t,r,i){if(!e)return;const n=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const{gl:s}=this._context;s.bufferSubData(this.bufferType,t*e.BYTES_PER_ELEMENT,e,r,i-r),(0,o.Y2)(s),this._isVAOAware&&this._context.bindVAO(n)}getSubData(e,t=0,r,n){if(r<0||n<0)return;const s=function(e){return(0,i.Xj)(e)}(e)?e.BYTES_PER_ELEMENT:1;if(s*((r??0)+(n??0))>e.byteLength)return;t+s*(n??0)>this.usedMemory&&l().warn("Potential problem getting subdata: requested data exceeds buffer size!");const o=this._context.gl;this.bufferType===a.NZ.TRANSFORM_FEEDBACK_BUFFER?(this._context.bindBuffer(this,a.NZ.TRANSFORM_FEEDBACK_BUFFER),o.getBufferSubData(a.NZ.TRANSFORM_FEEDBACK_BUFFER,t,e,r,n),this._context.unbindBuffer(a.NZ.TRANSFORM_FEEDBACK_BUFFER)):(this._context.bindBuffer(this,a.NZ.COPY_READ_BUFFER),o.getBufferSubData(a.NZ.COPY_READ_BUFFER,t,e,r,n),this._context.unbindBuffer(a.NZ.COPY_READ_BUFFER))}async getSubDataAsync(e,t=0,r,i){await this._context.clientWaitAsync(),this.getSubData(e,t,r,i)}}},96402:function(e,t,r){r.d(t,{H:function(){return h}}),r(58941);var i=r(40633),n=r(95929),s=r(86305),o=r(41835),a=r(85456),l=r(69452),c=r(49414),u=r(12285);class h{constructor(e,t,r=null){this._context=e,this._glName=null,this._colorAttachments=new Map,this._depthStencilBuffer=null,this._depthStencilTexture=null,this._initialized=!1,e.instanceCounter.increment(a.vt.FramebufferObject,this);const i=d(t)?t:new u.g(this._context,t);if(this._colorAttachments.set(a.Nm.COLOR_ATTACHMENT0,i),this._validateTextureDescriptor(i.descriptor),this._validateColorAttachmentPoint(a.Nm.COLOR_ATTACHMENT0),null!=r)if(function(e){return d(e)||null!=e&&"pixelFormat"in e}(r))this._depthStencilTexture=d(r)?r:new u.g(this._context,r),this._validateTextureDescriptor(this._depthStencilTexture.descriptor);else{const e=function(e){return null!=e&&"type"in e&&e.type===l.p.RenderBuffer}(r)?r:new c.l(this._context,r);this._depthStencilBuffer=e,this._validateRenderBufferDescriptor(e.descriptor)}}dispose(){if(0===this._colorAttachments.size&&!this._glName)return;const e=this._context.getBoundFramebufferObject();this._colorAttachments.forEach(((e,t)=>this.detachColorTexture(t)?.dispose())),this.detachDepthStencilBuffer()?.dispose(),this.detachDepthStencilTexture()?.dispose(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(e),this._context.instanceCounter.decrement(a.vt.FramebufferObject,this)}get glName(){return this._glName}get colorTexture(){return this._colorAttachments.get(a.Nm.COLOR_ATTACHMENT0)}get depthStencil(){return this._depthStencilTexture||this._depthStencilBuffer}get depthStencilTexture(){return this._depthStencilTexture}get width(){const e=this._colorAttachments.get(a.Nm.COLOR_ATTACHMENT0);return e?.descriptor?.width??0}get height(){const e=this._colorAttachments.get(a.Nm.COLOR_ATTACHMENT0);return e?.descriptor?.height??0}get usedMemory(){return[...this._colorAttachments].reduce(((e,[t,r])=>e+r.usedMemory),this.depthStencil?.usedMemory??0)}getColorTexture(e){const t=this._colorAttachments.get(e);return t&&d(t)?t:null}get colorAttachments(){return[...this._colorAttachments.keys()]}attachColorTexture(e,t=a.Nm.COLOR_ATTACHMENT0){if(!e)return;this._validateColorAttachmentPoint(t);const r=e.descriptor;this._validateTextureDescriptor(r),this.detachColorTexture(t)?.dispose(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,t)),this._colorAttachments.set(t,e)}detachColorTexture(e=a.Nm.COLOR_ATTACHMENT0){const t=this._colorAttachments.get(e);if(t){if(this._initialized){const t=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e),this._context.bindFramebuffer(t)}return this._colorAttachments.delete(e),t}}setColorTextureTarget(e,t=a.Nm.COLOR_ATTACHMENT0){const r=this._colorAttachments.get(t);r&&this._framebufferTexture2D(r.glName,t,e)}attachDepthStencil(e){if(e)switch(e.type){case l.p.Texture:return this._attachDepthStencilTexture(e);case l.p.RenderBuffer:return this._attachDepthStencilBuffer(e)}}_attachDepthStencilTexture(e){if(null==e)return;const t=e.descriptor;t.pixelFormat!==a.Ab.DEPTH_STENCIL&&t.pixelFormat!==a.Ab.DEPTH24_STENCIL8&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),t.dataType!==a.ld.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._validateTextureDescriptor(t),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,a.nI)),this._depthStencilTexture?.dispose(),this._depthStencilTexture=e}detachDepthStencilTexture(){const e=this._depthStencilTexture;if(e&&this._initialized){const e=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this),this._framebufferTexture2D(null,a.nI),this._context.bindFramebuffer(e)}return this._depthStencilTexture=null,e}_attachDepthStencilBuffer(e){if(null==e)return;const t=e.descriptor;if(this._validateRenderBufferDescriptor(t),this._disposeDepthStencilAttachments(),this._initialized){this._context.bindFramebuffer(this);const r=this._context.gl,i=this._getGLAttachmentPoint(t);r.framebufferRenderbuffer(a.R.FRAMEBUFFER,i,r.RENDERBUFFER,e.glName)}this._depthStencilBuffer=e}detachDepthStencilBuffer(){const e=this._depthStencilBuffer;if(e&&this._initialized){const t=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this);const r=this._context.gl,i=this._getGLAttachmentPoint(e.descriptor);r.framebufferRenderbuffer(a.R.FRAMEBUFFER,i,r.RENDERBUFFER,null),this._context.bindFramebuffer(t)}return this._depthStencilBuffer=null,e}copyToTexture(e,t,r,i,n,s,o){(e<0||t<0||n<0||s<0)&&console.error("Offsets cannot be negative!"),(r<=0||i<=0)&&console.error("Copy width and height must be greater than zero!");const l=o.descriptor;o.descriptor.target!==a.Ap.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),(null==l?.width||null==l?.height||e+r>this.width||t+i>this.height||n+r>l.width||s+i>l.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const c=this._context,h=c.bindTexture(o,u.g.TEXTURE_UNIT_FOR_UPDATES);c.setActiveTexture(u.g.TEXTURE_UNIT_FOR_UPDATES),c.bindFramebuffer(this),c.gl.copyTexSubImage2D(a.Ap.TEXTURE_2D,0,n,s,e,t,r,i),c.bindTexture(h,u.g.TEXTURE_UNIT_FOR_UPDATES)}readPixels(e,t,r,i,n,s,o){(r<=0||i<=0)&&console.error("Copy width and height must be greater than zero!"),o||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(e,t,r,i,n,s,o)}async readPixelsAsync(e,t,r,i,n,o,l){const{gl:c}=this._context,u=s.g.createPixelPack(this._context,a._U.STREAM_READ,l.byteLength);this._context.bindBuffer(u);const h=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this),c.readPixels(e,t,r,i,n,o,0),this._context.unbindBuffer(a.NZ.PIXEL_PACK_BUFFER),this._context.bindFramebuffer(h),await u.getSubDataAsync(l),u.dispose()}resize(e,t){if(this.width===e&&this.height===t)return;const r={width:e,height:t};f(r,this._context.parameters.maxTextureSize),this._colorAttachments.forEach((e=>e.resize(r.width,r.height))),this._depthStencilTexture?.resize(r.width,r.height),this._initialized&&(f(r,this._context.parameters.maxRenderbufferSize),this._depthStencilBuffer?.resize(r.width,r.height),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1)}initializeAndBind(e=a.R.FRAMEBUFFER){const t=this._context.gl;if(this._initialized)return void t.bindFramebuffer(e,this.glName);this._glName&&t.deleteFramebuffer(this._glName);const r=t.createFramebuffer();if(t.bindFramebuffer(e,r),this._colorAttachments.forEach(((t,r)=>this._framebufferTexture2D(t.glName,r,p(t),e))),this._depthStencilBuffer){const r=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);t.framebufferRenderbuffer(e,r,t.RENDERBUFFER,this._depthStencilBuffer.glName)}else this._depthStencilTexture&&this._framebufferTexture2D(this._depthStencilTexture.glName,t.DEPTH_STENCIL_ATTACHMENT,p(this._depthStencilTexture),e);(0,o.en)()&&t.checkFramebufferStatus(e)!==t.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=r,this._initialized=!0}_framebufferTexture2D(e,t=a.Nm.COLOR_ATTACHMENT0,r=a.Ap.TEXTURE_2D,i=a.R.FRAMEBUFFER,n=0){this._context.gl.framebufferTexture2D(i,t,r,e,n)}_disposeDepthStencilAttachments(){const e=this._context.gl;if(this._depthStencilBuffer){if(this._initialized){this._context.bindFramebuffer(this);const t=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);e.framebufferRenderbuffer(a.R.FRAMEBUFFER,t,e.RENDERBUFFER,null)}this._depthStencilBuffer=(0,n.WD)(this._depthStencilBuffer)}this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture=(0,n.WD)(this._depthStencilTexture))}_validateTextureDescriptor(e){e.target!==a.Ap.TEXTURE_2D&&e.target!==a.Ap.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),f(e,this._context.parameters.maxTextureSize),this._validateBufferDimensions(e)}_validateRenderBufferDescriptor(e){f(e,this._context.parameters.maxRenderbufferSize),this._validateBufferDimensions(e)}_validateBufferDimensions(e){e.width<=0&&(e.width=this.width),e.height<=0&&(e.height=this.height),this.width>0&&this.height>0&&(this.width===e.width&&this.height===e.height||console.error("Attachment size must match framebuffer size!"))}_getGLAttachmentPoint(e){switch(e.internalFormat){case a.yQ.DEPTH_COMPONENT16:case a.yQ.DEPTH_COMPONENT24:case a.yQ.DEPTH_COMPONENT32F:return this._context.gl.DEPTH_ATTACHMENT;case a.yQ.DEPTH24_STENCIL8:case a.yQ.DEPTH32F_STENCIL8:case a.yQ.DEPTH_STENCIL:return this._context.gl.DEPTH_STENCIL_ATTACHMENT;case a.yQ.STENCIL_INDEX8:return this._context.gl.STENCIL_ATTACHMENT}}_validateColorAttachmentPoint(e){if(-1===h._MAX_COLOR_ATTACHMENTS){const{gl:e}=this._context;h._MAX_COLOR_ATTACHMENTS=e.getParameter(e.MAX_COLOR_ATTACHMENTS)}const t=e-a.Nm.COLOR_ATTACHMENT0;t+1>h._MAX_COLOR_ATTACHMENTS&&i.A.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${t+1}. Implementation supports up to ${h._MAX_COLOR_ATTACHMENTS} color attachments`)}}function d(e){return null!=e&&"type"in e&&e.type===l.p.Texture}function f(e,t){const r=Math.max(e.width,e.height);if(r>t){i.A.getLogger("esri.views.webgl.FramebufferObject").warn(`Resizing FBO attachment size ${e.width}x${e.height} to device limit ${t}`);const n=t/r;return e.width=Math.round(e.width*n),e.height=Math.round(e.height*n),!1}return!0}function p(e){return e.descriptor.target===a.Ap.TEXTURE_CUBE_MAP?a.Ap.TEXTURE_CUBE_MAP_POSITIVE_X:a.Ap.TEXTURE_2D}h._MAX_COLOR_ATTACHMENTS=-1},69452:function(e,t,r){var i;r.d(t,{p:function(){return i}}),function(e){e[e.Texture=0]="Texture",e[e.RenderBuffer=1]="RenderBuffer"}(i||(i={}))},95904:function(e,t,r){r.d(t,{B:function(){return b}}),r(58941);var i=r(41835),n=r(85456);const s=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"],o=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"],a=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"],l=["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT","textureSize","texelFetch"];var c=999,u=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function h(e){return function(e){var t=function(){var e,t,r,i=0,n=0,s=c,h=[],d=[],f=1,p=0,m=0,_=!1,g=!1,y="";return function(e){return d=[],null!==e?b(e.replace?e.replace(/\r\n/g,"\n"):e):(h.length&&x(h.join("")),s=10,x("(eof)"),d)};function x(e){e.length&&d.push({type:u[s],data:e,position:m,line:f,column:p})}function b(t){var o;for(i=0,r=(y+=t).length;e=y[i],i<r;){switch(o=i,s){case 0:i=T();break;case 1:case 2:i=S();break;case 3:i=I();break;case 4:i=E();break;case 11:i=A();break;case 5:i=P();break;case 9999:i=C();break;case 9:i=v();break;case c:i=w()}o!==i&&("\n"===y[o]?(p=0,++f):++p)}return n+=i,y=y.slice(i),d}function w(){return h=h.length?[]:h,"/"===t&&"*"===e?(m=n+i-1,s=0,t=e,i+1):"/"===t&&"/"===e?(m=n+i-1,s=1,t=e,i+1):"#"===e?(s=2,m=n+i,i):/\s/.test(e)?(s=9,m=n+i,i):(_=/\d/.test(e),g=/[^\w_]/.test(e),m=n+i,s=_?4:g?3:9999,i)}function v(){return/[^\s]/g.test(e)?(x(h.join("")),s=c,i):(h.push(e),t=e,i+1)}function S(){return"\r"!==e&&"\n"!==e||"\\"===t?(h.push(e),t=e,i+1):(x(h.join("")),s=c,i)}function T(){return"/"===e&&"*"===t?(h.push(e),x(h.join("")),s=c,i+1):(h.push(e),t=e,i+1)}function I(){if("."===t&&/\d/.test(e))return s=5,i;if("/"===t&&"*"===e)return s=0,i;if("/"===t&&"/"===e)return s=1,i;if("."===e&&h.length){for(;M(h););return s=5,i}if(";"===e||")"===e||"("===e){if(h.length)for(;M(h););return x(e),s=c,i+1}var r=2===h.length&&"="!==e;if(/[\w_\d\s]/.test(e)||r){for(;M(h););return s=c,i}return h.push(e),t=e,i+1}function M(e){for(var t,r,i=0;;){if(t=a.indexOf(e.slice(0,e.length+i).join("")),r=a[t],-1===t){if(i--+e.length>0)continue;r=e.slice(0,1).join("")}return x(r),m+=r.length,(h=h.slice(r.length)).length}}function A(){return/[^a-fA-F0-9]/.test(e)?(x(h.join("")),s=c,i):(h.push(e),t=e,i+1)}function E(){return"."===e||/[eE]/.test(e)?(h.push(e),s=5,t=e,i+1):"x"===e&&1===h.length&&"0"===h[0]?(s=11,h.push(e),t=e,i+1):/[^\d]/.test(e)?(x(h.join("")),s=c,i):(h.push(e),t=e,i+1)}function P(){return"f"===e&&(h.push(e),t=e,i+=1),/[eE]/.test(e)||"-"===e&&/[eE]/.test(t)?(h.push(e),t=e,i+1):/[^\d]/.test(e)?(x(h.join("")),s=c,i):(h.push(e),t=e,i+1)}function C(){if(/[^\d\w_]/.test(e)){var r=h.join("");return s=o.indexOf(r)>-1?8:l.indexOf(r)>-1?7:6,x(h.join("")),s=c,i}return h.push(e),t=e,i+1}}(),r=[];return(r=r.concat(t(e))).concat(t(null))}(e)}const d=new Set(["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"]);function f(e,t){for(let r=t-1;r>=0;r--){const t=e[r];if("whitespace"!==t.type&&"block-comment"!==t.type){if("keyword"!==t.type)break;if("attribute"===t.data||"in"===t.data)return!0}}return!1}function p(e,t,r,i){i=i||r;for(const n of e)if("ident"===n.type&&n.data===r)return i in t?t[i]++:t[i]=0,p(e,t,i+"_"+t[i],i);return r}function m(e,t,r="afterVersion"){function i(e,t){for(let r=t;r<e.length;r++){const t=e[r];if("operator"===t.type&&";"===t.data)return r}return null}const n={data:"\n",type:"whitespace"},s=t=>t<e.length&&/[^\r\n]$/.test(e[t].data);let o=function(e){let t=-1,n=0,s=-1;for(let o=0;o<e.length;o++){const a=e[o];if("preprocessor"===a.type&&(/#(if|ifdef|ifndef)\s+.+/.test(a.data)?++n:/#endif\s*.*/.test(a.data)&&--n),"afterVersion"!==r&&"afterPrecision"!==r||"preprocessor"===a.type&&a.data.startsWith("#version")&&(s=Math.max(s,o)),"afterPrecision"===r&&"keyword"===a.type&&"precision"===a.data){const t=i(e,o);if(null===t)throw new Error("precision statement not followed by any semicolons!");s=Math.max(s,t)}t<s&&0===n&&(t=o)}return t+1}(e);s(o-1)&&e.splice(o++,0,n);for(const r of t)e.splice(o++,0,r);s(o-1)&&s(o)&&e.splice(o,0,n)}function _(e,t,r,i="lowp"){m(e,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}function g(e,t,r,i,n="lowp"){m(e,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:i.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:n},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}function y(e,t){let r,i,n=-1;for(let s=t;s<e.length;s++){const t=e[s];if("operator"===t.type&&("["===t.data&&(r=s),"]"===t.data)){i=s;break}"integer"===t.type&&(n=parseInt(t.data,10))}return r&&i&&e.splice(r,i-r+1),n}function x(e,t){if(e.startsWith("#version 300"))return e;const r=h(e);if("300 es"===function(e,t="100",r="300 es"){const i=/^\s*#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const n of e)if("preprocessor"===n.type){const e=i.exec(n.data);if(e){const i=e[1].replaceAll(/\s{2,}/g," ");if(i===r)return i;if(i===t)return n.data="#version "+r,t;throw new Error("unknown glsl version: "+i)}}return e.splice(0,0,{type:"preprocessor",data:"#version "+r},{type:"whitespace",data:"\n"}),null}(r,"100","300 es"))return e;let i=null,o=null;const a={},l={};for(let e=0;e<r.length;++e){const c=r[e];switch(c.type){case"keyword":t===n.Co.VERTEX_SHADER&&"attribute"===c.data?c.data="in":"varying"===c.data&&(c.data=t===n.Co.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(c.data.trim())&&(c.data=c.data.replaceAll(/(2D|Cube|EXT)/g,"")),t===n.Co.FRAGMENT_SHADER&&"gl_FragColor"===c.data&&(i||(i=p(r,a,"fragColor"),_(r,i,"vec4")),c.data=i),t===n.Co.FRAGMENT_SHADER&&"gl_FragData"===c.data){const t=y(r,e+1),i=p(r,a,"fragData");g(r,i,"vec4",t,"mediump"),c.data=i}else t===n.Co.FRAGMENT_SHADER&&"gl_FragDepthEXT"===c.data&&(o||(o=p(r,a,"gl_FragDepth")),c.data=o);break;case"ident":if(s.includes(c.data)){if(t===n.Co.VERTEX_SHADER&&f(r,e))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");c.data in l||(l[c.data]=p(r,a,c.data)),c.data=l[c.data]}}}for(let e=r.length-1;e>=0;--e){const t=r[e];if("preprocessor"===t.type){const i=t.data.match(/#extension\s+(.*):/);if(i?.[1]&&d.has(i[1].trim())){const t=r[e+1];r.splice(e,t&&"whitespace"===t.type?2:1)}const n=t.data.match(/#ifdef\s+(.*)/);n?.[1]&&d.has(n[1].trim())&&(t.data="#if 1");const s=t.data.match(/#ifndef\s+(.*)/);s?.[1]&&d.has(s[1].trim())&&(t.data="#if 0")}}return c=function(e){return e.map((e=>"eof"!==e.type?e.data:"")).join("")}(r),c;var c}new Map;class b{constructor(e,t,r,s,o=new Map,a=[]){this._context=e,this._locations=s,this._uniformBlockBindings=o,this._transformFeedbackVaryings=a,this._refCount=1,this._compiled=!1,this._linesOfCode=0,this._nameToUniformLocation=new Map,this._nameToUniform1=new Map,this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,e||console.error("RenderingContext isn't initialized!"),0===t.length&&console.error("Shaders source should not be empty!"),t=x(t,n.Co.VERTEX_SHADER),r=x(r,n.Co.FRAGMENT_SHADER),this._vShader=w(this._context,n.Co.VERTEX_SHADER,t),this._fShader=w(this._context,n.Co.FRAGMENT_SHADER,r),S.enabled&&(this._linesOfCode=t.match(/\n/g).length+r.match(/\n/g).length+2,this._context.instanceCounter.increment(n.vt.LinesOfCode,this._vShader,this._linesOfCode)),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(n.vt.Shader,this),(0,i.Xc)()&&(this.vertexShader=t,this.fragmentShader=r),this.usedMemory=t.length+r.length;const l=this._context.gl,c=l.createProgram();l.attachShader(c,this._vShader),l.attachShader(c,this._fShader),this._locations.forEach(((e,t)=>l.bindAttribLocation(c,e,t))),this._transformFeedbackVaryings?.length&&l.transformFeedbackVaryings(c,this._transformFeedbackVaryings,l.SEPARATE_ATTRIBS),l.linkProgram(c),(0,i.Xc)()&&!l.getProgramParameter(c,l.LINK_STATUS)&&console.error(`Could not link shader\nvalidated: ${l.getProgramParameter(c,l.VALIDATE_STATUS)}, gl error ${l.getError()}, vertex: ${l.getShaderParameter(this._vShader,l.COMPILE_STATUS)}, fragment: ${l.getShaderParameter(this._fShader,l.COMPILE_STATUS)}, info log: ${l.getProgramInfoLog(c)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`);for(const[e,t]of this._uniformBlockBindings){const r=l.getUniformBlockIndex(c,e);r<4294967295&&l.uniformBlockBinding(c,r,t)}this._glName=c,this._context.instanceCounter.increment(n.vt.Program,this)}get glName(){return this._glName}get hasGLName(){return null!=this._glName}get hasTransformFeedbackVaryings(){return!!this._transformFeedbackVaryings?.length}get compiled(){if(this._compiled)return!0;const e=this._context.gl.getExtension("KHR_parallel_shader_compile");return null==e||null==this.glName?(this._compiled=!0,!0):(this._compiled=!!this._context.gl.getProgramParameter(this.glName,e.COMPLETION_STATUS_KHR),this._compiled)}dispose(){if(--this._refCount>0)return;const e=this._context.gl,t=this._context.instanceCounter;this._nameToUniformLocation.forEach((e=>e&&t.decrement(n.vt.Uniform,e))),this._nameToUniformLocation.clear(),this._vShader&&(this._linesOfCode>0&&(t.decrement(n.vt.LinesOfCode,this._vShader,this._linesOfCode),this._linesOfCode=0),e.deleteShader(this._vShader),this._vShader=null,t.decrement(n.vt.Shader,this)),this._fShader&&(e.deleteShader(this._fShader),this._fShader=null),this._glName&&(e.deleteProgram(this._glName),this._glName=null,t.decrement(n.vt.Program,this))}ref(){++this._refCount}_getUniformLocation(e){const t=this._nameToUniformLocation.get(e);if(void 0!==t)return t;if(this.glName){const t=this._context.gl.getUniformLocation(this.glName,e);return this._nameToUniformLocation.set(e,t),t&&this._context.instanceCounter.increment(n.vt.Uniform,t),t}return null}hasUniform(e){return null!=this._getUniformLocation(e)}setUniform1i(e,t){const r=this._nameToUniform1.get(e);void 0!==r&&t===r||(this._context.gl.uniform1i(this._getUniformLocation(e),t),this._nameToUniform1.set(e,t))}setUniform1iv(e,t){v(this._nameToUniform1v,e,t)&&this._context.gl.uniform1iv(this._getUniformLocation(e),t)}setUniform2iv(e,t){v(this._nameToUniform2,e,t)&&this._context.gl.uniform2iv(this._getUniformLocation(e),t)}setUniform3iv(e,t){v(this._nameToUniform3,e,t)&&this._context.gl.uniform3iv(this._getUniformLocation(e),t)}setUniform4iv(e,t){v(this._nameToUniform4,e,t)&&this._context.gl.uniform4iv(this._getUniformLocation(e),t)}setUniform1f(e,t){const r=this._nameToUniform1.get(e);void 0!==r&&t===r||(this._context.gl.uniform1f(this._getUniformLocation(e),t),this._nameToUniform1.set(e,t))}setUniform1fv(e,t){v(this._nameToUniform1v,e,t)&&this._context.gl.uniform1fv(this._getUniformLocation(e),t)}setUniform2f(e,t,r){const i=this._nameToUniform2.get(e);void 0===i?(this._context.gl.uniform2f(this._getUniformLocation(e),t,r),this._nameToUniform2.set(e,[t,r])):t===i[0]&&r===i[1]||(this._context.gl.uniform2f(this._getUniformLocation(e),t,r),i[0]=t,i[1]=r)}setUniform2fv(e,t){v(this._nameToUniform2,e,t)&&this._context.gl.uniform2fv(this._getUniformLocation(e),t)}setUniform3f(e,t,r,i){const n=this._nameToUniform3.get(e);void 0===n?(this._context.gl.uniform3f(this._getUniformLocation(e),t,r,i),this._nameToUniform3.set(e,[t,r,i])):t===n[0]&&r===n[1]&&i===n[2]||(this._context.gl.uniform3f(this._getUniformLocation(e),t,r,i),n[0]=t,n[1]=r,n[2]=i)}setUniform3fv(e,t){const r=this._getUniformLocation(e);null!=r&&v(this._nameToUniform3,e,t)&&this._context.gl.uniform3fv(r,t)}setUniform4f(e,t,r,i,n){const s=this._nameToUniform4.get(e);void 0===s?(this._context.gl.uniform4f(this._getUniformLocation(e),t,r,i,n),this._nameToUniform4.set(e,[t,r,i,n])):void 0!==s&&t===s[0]&&r===s[1]&&i===s[2]&&n===s[3]||(this._context.gl.uniform4f(this._getUniformLocation(e),t,r,i,n),s[0]=t,s[1]=r,s[2]=i,s[3]=n)}setUniform4fv(e,t){const r=this._getUniformLocation(e);null!=r&&v(this._nameToUniform4,e,t)&&this._context.gl.uniform4fv(r,t)}setUniformMatrix3fv(e,t,r=!1){const i=this._getUniformLocation(e);null!=i&&v(this._nameToUniformMatrix3,e,t)&&this._context.gl.uniformMatrix3fv(i,r,t)}setUniformMatrix4fv(e,t,r=!1){const i=this._getUniformLocation(e);null!=i&&v(this._nameToUniformMatrix4,e,t)&&this._context.gl.uniformMatrix4fv(i,r,t)}stop(){}}function w(e,t,r){const s=e.gl,o=s.createShader(t);return s.shaderSource(o,r),s.compileShader(o),(0,i.Xc)()&&!s.getShaderParameter(o,s.COMPILE_STATUS)&&(console.error("Compile error in ".concat(t===n.Co.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(s.getShaderInfoLog(o)),console.error(function(e){let t=2;return e.replaceAll("\n",(()=>"\n"+function(e){return e>=1e3?e.toString():("  "+e).slice(-3)}(t++)+":"))}(r))),o}function v(e,t,r){const i=e.get(t);if(!i)return e.set(t,Array.from(r)),!0;const n=r.length;if(i.length!==n)return e.set(t,Array.from(r)),!0;for(let e=0;e<n;++e){const t=r[e];if(i[e]!==t){for(i[e]=t;e<n;++e)i[e]=r[e];return!0}}return!1}const S={enabled:!1}},49414:function(e,t,r){r.d(t,{l:function(){return o}});var i=r(85456),n=r(69452),s=r(15167);class o{constructor(e,t){this._context=e,this._descriptor=t,this.type=n.p.RenderBuffer,this._context.instanceCounter.increment(i.vt.Renderbuffer,this);const r=this._context.gl;this.glName=r.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:s,height:o,internalFormat:a,multisampled:l}=t;l?r.renderbufferStorageMultisample(r.RENDERBUFFER,this.samples,a,s,o):r.renderbufferStorage(r.RENDERBUFFER,a,s,o),this._context.bindRenderbuffer(null)}get descriptor(){return this._descriptor}get samples(){const e=this._descriptor.samples,t=this._context.parameters.maxSamples;return e?Math.min(e,t):t}get usedMemory(){return(0,s.e)(this._descriptor)}resize(e,t){const r=this._descriptor;if(r.width===e&&r.height===t)return;r.width=e,r.height=t;const i=this._context.gl;this._context.bindRenderbuffer(this),r.multisampled?i.renderbufferStorageMultisample(i.RENDERBUFFER,this.samples,r.internalFormat,r.width,r.height):i.renderbufferStorage(i.RENDERBUFFER,r.internalFormat,r.width,r.height),this._context.bindRenderbuffer(null)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(i.vt.Renderbuffer,this),this._context=null)}}},15167:function(e,t,r){r.d(t,{e:function(){return s},q:function(){return n}});var i=r(93380);class n{constructor(e,t,r=t){this.internalFormat=e,this.width=t,this.height=r,this.multisampled=!1,this.samples=1}}function s(e){return e.width<=0||e.height<=0||null==e.internalFormat?0:e.width*e.height*(0,i.IB)(e.internalFormat)}},12285:function(e,t,r){r.d(t,{g:function(){return c}});var i=r(39819),n=(r(58941),r(41835)),s=r(85456),o=r(69452),a=r(10956),l=r(31516);let c=class e{constructor(e,t=null,r=null){if(this.type=o.p.Texture,this._glName=null,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._wasImmutablyAllocated=!1,"context"in e)this._descriptor=e,r=t;else{const r=l.z.validate(e,t);if(!r)throw new i.A("Texture descriptor invalid");this._descriptor=r}this._descriptor.target===s.Ap.TEXTURE_CUBE_MAP?this._setDataCubeMap(r):this.setData(r)}get glName(){return this._glName}get descriptor(){return this._descriptor}get usedMemory(){return(0,a.e)(this._descriptor)}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._glName&&this._descriptor.context.instanceCounter.decrement(s.vt.Texture,this),this._descriptor.context.gl&&this._glName&&(this._descriptor.context.unbindTexture(this),this._descriptor.context.gl.deleteTexture(this._glName),this._glName=null)}release(){this.dispose()}resize(e,t){const r=this._descriptor;if(r.width!==e||r.height!==t){if(this._wasImmutablyAllocated)throw new i.A("Immutable textures can't be resized!");r.width=e,r.height=t,this._descriptor.target===s.Ap.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(e=null){for(let t=s.Ap.TEXTURE_CUBE_MAP_POSITIVE_X;t<=s.Ap.TEXTURE_CUBE_MAP_NEGATIVE_Z;t++)this._setData(e,t)}setData(e){this._setData(e)}_setData(t,r){const o=this._descriptor.context?.gl;if(!o)return;(0,n.Y2)(o),this._glName||(this._glName=o.createTexture(),this._glName&&this._descriptor.context.instanceCounter.increment(s.vt.Texture,this));const a=this._descriptor,l=r??a.target,c=m(l),g=this._descriptor.context.bindTexture(this,e.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(e.TEXTURE_UNIT_FOR_UPDATES),u(a),this._configurePixelStorage(),(0,n.Y2)(o);const y=this._deriveInternalFormat();if(p(t)){let e="width"in t?t.width:t.codedWidth,r="height"in t?t.height:t.codedHeight;const i=1;t instanceof HTMLVideoElement&&(e=t.videoWidth,r=t.videoHeight),a.width&&a.height,c&&a.depth,a.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(l,y,a.hasMipmap,e,r,i),this._texImage(l,0,y,e,r,i,t),(0,n.Y2)(o),a.hasMipmap&&(this.generateMipmap(),(0,n.Y2)(o)),a.width||(a.width=e),a.height||(a.height=r),c&&!a.depth&&(a.depth=i)}else{const{width:e,height:r,depth:u}=a;if(null==e||null==r)throw new i.A("Width and height must be specified!");if(c&&null==u)throw new i.A("Depth must be specified!");if(a.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(l,y,a.hasMipmap,e,r,u),f(t)){const n=t.levels,c=_(l,e,r,u),h=Math.min(c-1,n.length-1);o.texParameteri(a.target,this._descriptor.context.gl.TEXTURE_MAX_LEVEL,h);const d=y;if(!(d in s.CQ))throw new i.A("Attempting to use compressed data with an uncompressed format!");this._forEachMipmapLevel(((e,t,r,i)=>{const s=n[Math.min(e,n.length-1)];this._compressedTexImage(l,e,d,t,r,i,s)}),h)}else this._texImage(l,0,y,e,r,u,t),(0,n.Y2)(o),a.hasMipmap&&this.generateMipmap()}h(o,this._descriptor),d(o,this._descriptor),function(e,t){const r=e.capabilities.textureFilterAnisotropic;r&&e.gl.texParameterf(t.target,r.TEXTURE_MAX_ANISOTROPY,t.maxAnisotropy??1)}(this._descriptor.context,this._descriptor),(0,n.Y2)(o),this._descriptor.context.bindTexture(g,e.TEXTURE_UNIT_FOR_UPDATES)}updateData(t,r,n,s,o,a,l=0){a||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const c=this._descriptor,u=this._deriveInternalFormat(),{context:h,pixelFormat:d,dataType:m,target:_,isImmutable:g}=c;if(g&&!this._wasImmutablyAllocated)throw new i.A("Cannot update immutable texture before allocation!");const y=h.bindTexture(this,e.TEXTURE_UNIT_FOR_UPDATES,!0);(r<0||n<0||r+s>c.width||n+o>c.height)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage();const{gl:x}=h;l&&x.pixelStorei(x.UNPACK_SKIP_ROWS,l),p(a)?x.texSubImage2D(_,t,r,n,s,o,d,m,a):f(a)?x.compressedTexSubImage2D(_,t,r,n,s,o,u,a.levels[t]):x.texSubImage2D(_,t,r,n,s,o,d,m,a),l&&x.pixelStorei(x.UNPACK_SKIP_ROWS,0),h.bindTexture(y,e.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(t,r,n,s,o,a,l,c){c||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const u=this._descriptor,h=this._deriveInternalFormat(),{context:d,pixelFormat:p,dataType:_,isImmutable:g,target:y}=u;if(g&&!this._wasImmutablyAllocated)throw new i.A("Cannot update immutable texture before allocation!");m(y)||console.warn("Attempting to set 3D texture data on a non-3D texture");const x=d.bindTexture(this,e.TEXTURE_UNIT_FOR_UPDATES);d.setActiveTexture(e.TEXTURE_UNIT_FOR_UPDATES),(r<0||n<0||s<0||r+o>u.width||n+a>u.height||s+l>u.depth)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage();const{gl:b}=d;if(f(c))c=c.levels[t],b.compressedTexSubImage3D(y,t,r,n,s,o,a,l,h,c);else{const e=c;b.texSubImage3D(y,t,r,n,s,o,a,l,p,_,e)}d.bindTexture(x,e.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const t=this._descriptor;if(!t.hasMipmap){if(this._wasImmutablyAllocated)throw new i.A("Cannot add mipmaps to immutable texture after allocation");t.hasMipmap=!0,this._samplingModeDirty=!0,u(t)}t.samplingMode===s.Cj.LINEAR?(this._samplingModeDirty=!0,t.samplingMode=s.Cj.LINEAR_MIPMAP_NEAREST):t.samplingMode===s.Cj.NEAREST&&(this._samplingModeDirty=!0,t.samplingMode=s.Cj.NEAREST_MIPMAP_NEAREST);const r=this._descriptor.context.bindTexture(this,e.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(e.TEXTURE_UNIT_FOR_UPDATES),this._descriptor.context.gl.generateMipmap(t.target),this._descriptor.context.bindTexture(r,e.TEXTURE_UNIT_FOR_UPDATES)}clearMipmap(){const e=this._descriptor;if(e.hasMipmap){if(this._wasImmutablyAllocated)throw new i.A("Cannot delete mipmaps to immutable texture after allocation");e.hasMipmap=!1,this._samplingModeDirty=!0,u(e)}e.samplingMode===s.Cj.LINEAR_MIPMAP_NEAREST?(this._samplingModeDirty=!0,e.samplingMode=s.Cj.LINEAR):e.samplingMode===s.Cj.NEAREST_MIPMAP_NEAREST&&(this._samplingModeDirty=!0,e.samplingMode=s.Cj.NEAREST)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,u(this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const e=this._descriptor,t=e.context.gl;this._samplingModeDirty&&(h(t,e),this._samplingModeDirty=!1),this._wrapModeDirty&&(d(t,e),this._wrapModeDirty=!1)}_deriveInternalFormat(){if(null!=this._descriptor.internalFormat)return this._descriptor.internalFormat===s.Ab.DEPTH_STENCIL&&(this._descriptor.internalFormat=s.Ab.DEPTH24_STENCIL8),this._descriptor.internalFormat;switch(this._descriptor.dataType){case s.ld.FLOAT:switch(this._descriptor.pixelFormat){case s.Ab.RGBA:return this._descriptor.internalFormat=s.H0.RGBA32F;case s.Ab.RGB:return this._descriptor.internalFormat=s.H0.RGB32F;default:throw new i.A("Unable to derive format")}case s.ld.UNSIGNED_BYTE:switch(this._descriptor.pixelFormat){case s.Ab.RGBA:return this._descriptor.internalFormat=s.H0.RGBA8;case s.Ab.RGB:return this._descriptor.internalFormat=s.H0.RGB8}}return this._descriptor.internalFormat=this._descriptor.pixelFormat===s.Ab.DEPTH_STENCIL?s.Ab.DEPTH24_STENCIL8:this._descriptor.pixelFormat}_configurePixelStorage(){const e=this._descriptor.context.gl,{unpackAlignment:t,flipped:r,preMultiplyAlpha:i}=this._descriptor;e.pixelStorei(e.UNPACK_ALIGNMENT,t),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r?1:0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i?1:0)}_texStorage(e,t,r,n,o,a){const{gl:l}=this._descriptor.context;if(!(t in s.H0))throw new i.A("Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const c=r?_(e,n,o,a):1;if(m(e)){if(null==a)throw new i.A("Missing depth dimension for 3D texture upload");l.texStorage3D(e,c,t,n,o,a)}else l.texStorage2D(e,c,t,n,o);this._wasImmutablyAllocated=!0}_texImage(e,t,r,n,s,o,a){const l=this._descriptor.context.gl,c=m(e),{isImmutable:u,pixelFormat:h,dataType:d}=this._descriptor;if(u){if(null!=a){const r=a;if(c){if(null==o)throw new i.A("Missing depth dimension for 3D texture upload");l.texSubImage3D(e,t,0,0,0,n,s,o,h,d,r)}else l.texSubImage2D(e,t,0,0,n,s,h,d,r)}}else{const u=a;if(c){if(null==o)throw new i.A("Missing depth dimension for 3D texture upload");l.texImage3D(e,t,r,n,s,o,0,h,d,u)}else l.texImage2D(e,t,r,n,s,0,h,d,u)}}_compressedTexImage(e,t,r,n,s,o,a){const l=this._descriptor.context.gl,c=m(e);if(this._descriptor.isImmutable){if(null!=a)if(c){if(null==o)throw new i.A("Missing depth dimension for 3D texture upload");l.compressedTexSubImage3D(e,t,0,0,0,n,s,o,r,a)}else l.compressedTexSubImage2D(e,t,0,0,n,s,r,a)}else if(c){if(null==o)throw new i.A("Missing depth dimension for 3D texture upload");l.compressedTexImage3D(e,t,r,n,s,o,0,a)}else l.compressedTexImage2D(e,t,r,n,s,0,a)}_forEachMipmapLevel(e,t=1/0){let{width:r,height:n,depth:o,hasMipmap:a,target:l}=this._descriptor;const c=l===s.Ap.TEXTURE_3D;if(null==r||null==n||c&&null==o)throw new i.A("Missing texture dimensions for mipmap calculation");for(let i=0;e(i,r,n,o),a&&(1!==r||1!==n||c&&1!==o)&&!(i>=t);++i)r=Math.max(1,r>>1),n=Math.max(1,n>>1),c&&(o=Math.max(1,o>>1))}};function u(e){(null!=e.width&&e.width<0||null!=e.height&&e.height<0||null!=e.depth&&e.depth<0)&&console.error("Negative dimension parameters are not allowed!")}function h(e,t){let r=t.samplingMode,i=t.samplingMode;r===s.Cj.LINEAR_MIPMAP_NEAREST||r===s.Cj.LINEAR_MIPMAP_LINEAR?(r=s.Cj.LINEAR,t.hasMipmap||(i=s.Cj.LINEAR)):r!==s.Cj.NEAREST_MIPMAP_NEAREST&&r!==s.Cj.NEAREST_MIPMAP_LINEAR||(r=s.Cj.NEAREST,t.hasMipmap||(i=s.Cj.NEAREST)),e.texParameteri(t.target,e.TEXTURE_MAG_FILTER,r),e.texParameteri(t.target,e.TEXTURE_MIN_FILTER,i)}function d(e,t){"number"==typeof t.wrapMode?(e.texParameteri(t.target,e.TEXTURE_WRAP_S,t.wrapMode),e.texParameteri(t.target,e.TEXTURE_WRAP_T,t.wrapMode)):(e.texParameteri(t.target,e.TEXTURE_WRAP_S,t.wrapMode.s),e.texParameteri(t.target,e.TEXTURE_WRAP_T,t.wrapMode.t))}function f(e){return null!=e&&"type"in e&&"compressed"===e.type}function p(e){return null!=e&&!f(e)&&!function(e){return null!=e&&"byteLength"in e}(e)}function m(e){return e===s.Ap.TEXTURE_3D||e===s.Ap.TEXTURE_2D_ARRAY}function _(e,t,r,i=1){let n=Math.max(t,r);return e===s.Ap.TEXTURE_3D&&(n=Math.max(n,i)),Math.round(Math.log(n)/Math.LN2)+1}c.TEXTURE_UNIT_FOR_UPDATES=0},10956:function(e,t,r){r.d(t,{R:function(){return s},e:function(){return o}});var i=r(85456),n=r(93380);class s{constructor(e=0,t=e){this.width=e,this.height=t,this.target=i.Ap.TEXTURE_2D,this.pixelFormat=i.Ab.RGBA,this.dataType=i.ld.UNSIGNED_BYTE,this.samplingMode=i.Cj.LINEAR,this.wrapMode=i.pF.REPEAT,this.maxAnisotropy=1,this.flipped=!1,this.hasMipmap=!1,this.isOpaque=!1,this.unpackAlignment=4,this.preMultiplyAlpha=!1,this.depth=1,this.isImmutable=!1}}function o(e){return e.width<=0||e.height<=0?0:Math.round(e.width*e.height*(e.hasMipmap?4/3:1)*(null==e.internalFormat?4:(0,n.IB)(e.internalFormat))*(e.target===i.Ap.TEXTURE_CUBE_MAP?6:1))}},93380:function(e,t,r){r.d(t,{Hi:function(){return l},IB:function(){return c},WH:function(){return o},yu:function(){return a}}),r(58941);var i=r(41835),n=r(85456),s=r(48347);function o(e){const t=e.gl;switch(t.getError()){case t.NO_ERROR:return null;case t.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case t.INVALID_VALUE:return"An unacceptable value has been specified for an argument";case t.INVALID_OPERATION:return"The specified command is not allowed for the current state";case t.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case t.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case t.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function a(e,t,r,n,a=0){const l=e.gl;e.bindBuffer(r);for(const r of n){const n=t.get(r.name);if(null==n){console.warn(`There is no location for vertex attribute '${r.name}' defined.`);continue}const c=a*r.stride;if(r.count<=4)l.vertexAttribPointer(n,r.count,r.type,r.normalized,r.stride,r.offset+c),l.enableVertexAttribArray(n),r.divisor>0&&e.gl.vertexAttribDivisor(n,r.divisor);else if(9===r.count)for(let t=0;t<3;t++)l.vertexAttribPointer(n+t,3,r.type,r.normalized,r.stride,r.offset+12*t+c),l.enableVertexAttribArray(n+t),r.divisor>0&&e.gl.vertexAttribDivisor(n+t,r.divisor);else if(16===r.count)for(let t=0;t<4;t++)l.vertexAttribPointer(n+t,4,r.type,r.normalized,r.stride,r.offset+16*t+c),l.enableVertexAttribArray(n+t),r.divisor>0&&e.gl?.vertexAttribDivisor(n+t,r.divisor);else console.error("Unsupported vertex attribute element count: "+r.count);if((0,i.en)()){const t=o(e),i=(0,s._)(r.type),n=r.offset,a=Math.round(i/n)!==i/n?`. Offset not a multiple of stride. DataType requires ${i} bytes, but descriptor has an offset of ${n}`:"";t&&console.error(`Unable to bind vertex attribute "${r.name}" with baseInstanceOffset ${c}${a}:`,t,r)}}}function l(e,t,r,i){const s=e.gl;e.bindBuffer(r);for(const r of i){const i=t.get(r.name);if(r.count<=4)s.disableVertexAttribArray(i),r.divisor&&r.divisor>0&&e.gl?.vertexAttribDivisor(i,0);else if(9===r.count)for(let t=0;t<3;t++)s.disableVertexAttribArray(i+t),r.divisor&&r.divisor>0&&e.gl?.vertexAttribDivisor(i+t,0);else if(16===r.count)for(let t=0;t<4;t++)s.disableVertexAttribArray(i+t),r.divisor&&r.divisor>0&&e.gl?.vertexAttribDivisor(i+t,0);else console.error("Unsupported vertex attribute element count: "+r.count)}e.unbindBuffer(n.NZ.ARRAY_BUFFER)}function c(e){switch(e){case n.Ab.ALPHA:case n.Ab.LUMINANCE:case n.Ab.RED:case n.Ab.RED_INTEGER:case n.H0.R8:case n.H0.R8I:case n.H0.R8UI:case n.H0.R8_SNORM:case n.yQ.STENCIL_INDEX8:return 1;case n.Ab.LUMINANCE_ALPHA:case n.Ab.RG:case n.Ab.RG_INTEGER:case n.H0.RGBA4:case n.H0.R16F:case n.H0.R16I:case n.H0.R16UI:case n.H0.RG8:case n.H0.RG8I:case n.H0.RG8UI:case n.H0.RG8_SNORM:case n.H0.RGB565:case n.H0.RGB5_A1:case n.yQ.DEPTH_COMPONENT16:return 2;case n.Ab.DEPTH_COMPONENT:case n.Ab.RGB:case n.Ab.RGB_INTEGER:case n.H0.RGB8:case n.H0.RGB8I:case n.H0.RGB8UI:case n.H0.RGB8_SNORM:case n.H0.SRGB8:case n.yQ.DEPTH_COMPONENT24:return 3;case n.Ab.DEPTH_STENCIL:case n.Ab.DEPTH24_STENCIL8:case n.Ab.RGBA:case n.Ab.RGBA_INTEGER:case n.H0.RGBA8:case n.H0.R32F:case n.H0.R11F_G11F_B10F:case n.H0.RG16F:case n.H0.R32I:case n.H0.R32UI:case n.H0.RG16I:case n.H0.RG16UI:case n.H0.RGBA8I:case n.H0.RGBA8UI:case n.H0.RGBA8_SNORM:case n.H0.SRGB8_ALPHA8:case n.H0.RGB9_E5:case n.H0.RGB10_A2UI:case n.H0.RGB10_A2:case n.yQ.DEPTH_STENCIL:case n.yQ.DEPTH_COMPONENT32F:case n.yQ.DEPTH24_STENCIL8:return 4;case n.yQ.DEPTH32F_STENCIL8:return 5;case n.H0.RGB16F:case n.H0.RGB16I:case n.H0.RGB16UI:return 6;case n.H0.RG32F:case n.H0.RG32I:case n.H0.RG32UI:case n.H0.RGBA16F:case n.H0.RGBA16I:case n.H0.RGBA16UI:return 8;case n.H0.RGB32F:case n.H0.RGB32I:case n.H0.RGB32UI:return 12;case n.H0.RGBA32F:case n.H0.RGBA32I:case n.H0.RGBA32UI:return 16;case n.CQ.COMPRESSED_RGB_S3TC_DXT1_EXT:case n.CQ.COMPRESSED_RGBA_S3TC_DXT1_EXT:return.5;case n.CQ.COMPRESSED_RGBA_S3TC_DXT3_EXT:case n.CQ.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case n.CQ.COMPRESSED_R11_EAC:case n.CQ.COMPRESSED_SIGNED_R11_EAC:case n.CQ.COMPRESSED_RGB8_ETC2:case n.CQ.COMPRESSED_SRGB8_ETC2:case n.CQ.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case n.CQ.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return.5;case n.CQ.COMPRESSED_RG11_EAC:case n.CQ.COMPRESSED_SIGNED_RG11_EAC:case n.CQ.COMPRESSED_RGBA8_ETC2_EAC:case n.CQ.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}},31516:function(e,t,r){r.d(t,{z:function(){return s}});var i=r(85456),n=r(10956);class s extends n.R{constructor(e,t){switch(super(),this.context=e,Object.assign(this,t),this.internalFormat){case i.H0.R16F:case i.H0.R16I:case i.H0.R16UI:case i.H0.R32F:case i.H0.R32I:case i.H0.R32UI:case i.H0.R8_SNORM:case i.H0.R8:case i.H0.R8I:case i.H0.R8UI:this.pixelFormat=i.Ab.RED}}static validate(e,t){return new s(e,t)}}},3817:function(e,t,r){r.d(t,{_:function(){return i}});class i{constructor(e,t,r,i,n,s=!1,o=0){this.name=e,this.count=t,this.type=r,this.offset=i,this.stride=n,this.normalized=s,this.divisor=o}}},41835:function(e,t,r){r.d(t,{Xc:function(){return c},Y2:function(){return u},en:function(){return l}});var i=r(39819),n=r(58941),s=r(40633);const o=()=>s.A.getLogger("esri.views.webgl.checkWebGLError"),a=!!(0,n.A)("enable-feature:webgl-debug");function l(){return a}function c(){return a}function u(e){if(l()){const t=e.getError();if(t){const r=function(e,t){switch(t){case e.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case e.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case e.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case e.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case e.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case e.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}(e,t),n=(new Error).stack;o().error(new i.A("webgl-error","WebGL error occurred",{message:r,stack:n}))}}}},85456:function(e,t,r){var i,n,s,o,a,l,c,u,h,d,f,p,m,_,g,y,x,b,w,v;r.d(t,{Ab:function(){return _},Ac:function(){return c},Ap:function(){return m},CQ:function(){return E},Cj:function(){return f},Co:function(){return w},H0:function(){return g},Hr:function(){return M},MT:function(){return h},NV:function(){return i},NZ:function(){return a},Nm:function(){return I},R:function(){return v},Tb:function(){return o},WR:function(){return n},Y7:function(){return l},_U:function(){return b},dn:function(){return s},eA:function(){return d},ld:function(){return y},nI:function(){return A},pF:function(){return p},pe:function(){return u},sS:function(){return F},tx:function(){return L},vt:function(){return T},xM:function(){return S},xV:function(){return P},yQ:function(){return x}}),function(e){e[e.DEPTH=256]="DEPTH",e[e.STENCIL=1024]="STENCIL",e[e.COLOR=16384]="COLOR"}(i||(i={})),function(e){e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(n||(n={})),function(e){e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(s||(s={})),function(e){e[e.ADD=32774]="ADD",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX",e[e.SUBTRACT=32778]="SUBTRACT",e[e.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"}(o||(o={})),function(e){e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",e[e.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER"}(a||(a={})),function(e){e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(l||(l={})),function(e){e[e.CW=2304]="CW",e[e.CCW=2305]="CCW"}(c||(c={})),function(e){e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.HALF_FLOAT=5131]="HALF_FLOAT"}(u||(u={})),function(e){e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS"}(h||(h={})),function(e){e[e.ZERO=0]="ZERO",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP"}(d||(d={})),function(e){e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(f||(f={})),function(e){e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.REPEAT=10497]="REPEAT",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(p||(p={})),function(e){e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"}(m||(m={})),function(e){e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.RED=6403]="RED",e[e.RG=33319]="RG",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER"}(_||(_={})),function(e){e[e.RGBA4=32854]="RGBA4",e[e.R16F=33325]="R16F",e[e.RG16F=33327]="RG16F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.R32F=33326]="R32F",e[e.RG32F=33328]="RG32F",e[e.RGBA32F=34836]="RGBA32F",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB5_A1=32855]="RGB5_A1",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.RGB16F=34843]="RGB16F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.RGB565=36194]="RGB565",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2=32857]="RGB10_A2",e[e.RGB10_A2UI=36975]="RGB10_A2UI"}(g||(g={})),function(e){e[e.FLOAT=5126]="FLOAT",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.INT=5124]="INT",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"}(y||(y={})),function(e){e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"}(x||(x={})),function(e){e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_READ=35045]="STATIC_READ",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.STREAM_COPY=35042]="STREAM_COPY"}(b||(b={})),function(e){e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER"}(w||(w={})),function(e){e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"}(v||(v={}));const S=33984;var T,I,M;!function(e){e[e.Texture=0]="Texture",e[e.BufferObject=1]="BufferObject",e[e.VertexArrayObject=2]="VertexArrayObject",e[e.Shader=3]="Shader",e[e.Program=4]="Program",e[e.FramebufferObject=5]="FramebufferObject",e[e.Renderbuffer=6]="Renderbuffer",e[e.TransformFeedback=7]="TransformFeedback",e[e.Sync=8]="Sync",e[e.UNCOUNTED=9]="UNCOUNTED",e[e.LinesOfCode=9]="LinesOfCode",e[e.Uniform=10]="Uniform",e[e.COUNT=11]="COUNT"}(T||(T={})),function(e){e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"}(I||(I={})),function(e){e[e.NONE=0]="NONE",e[e.BACK=1029]="BACK"}(M||(M={}));const A=33306;var E,P,C,R,F,L,k;!function(e){e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"}(E||(E={})),function(e){e[e.FLOAT=5126]="FLOAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT=5124]="INT",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"}(P||(P={})),function(e){e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS"}(C||(C={})),function(e){e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED"}(R||(R={})),function(e){e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED"}(F||(F={})),function(e){e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"}(L||(L={})),function(e){e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"}(k||(k={}))},48347:function(e,t,r){r.d(t,{_:function(){return n}});var i=r(85456);function n(e){switch(e){case i.pe.BYTE:case i.pe.UNSIGNED_BYTE:return 1;case i.pe.SHORT:case i.pe.UNSIGNED_SHORT:case i.pe.HALF_FLOAT:return 2;case i.pe.FLOAT:case i.pe.INT:case i.pe.UNSIGNED_INT:return 4}}},84624:function(e,t,r){r.d(t,{CJ:function(){return d}});var i=r(39819),n=r(21609),s=r(34194),o=r(47527),a=r(11432);const l=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wms","wmts"]),c=new Set(["catalog","csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","knowledge-graph","map-image","map-notes","media","ogc-feature","oriented-imagery","route","stream","subtype-group","tile","unknown","unsupported","vector-tile","web-tile","wfs","wms","wmts"]);function u(e,t){if(t.restrictedWebMapWriting){const r=function(e){return"basemap"===e.layerContainerType?l:"operational-layers"===e.layerContainerType?c:null}(t);return null==r||r.has(e.type)&&!(0,a.Ov)(e)}return!0}function h(e,t){"maxScale"in e&&(t.maxScale=(0,o.B)(e.maxScale)??void 0),"minScale"in e&&(t.minScale=(0,o.B)(e.minScale)??void 0)}function d(e,t,r){if(!e.persistenceEnabled)return null;if(!("write"in e)||!e.write)return r?.messages&&r.messages.push(new i.A("layer:unsupported",`Layers (${e.title}, ${e.id}) of type '${e.declaredClass}' cannot be persisted`,{layer:e})),null;if((0,a.Ov)(e)&&!e.isTable)t=e.resourceInfo;else if(u(e,r)){const t={};return e.write(t,r)?t:null}return null!=t&&function(e,t){if(function(e,t){if(t)if((0,a.Ov)(e)){const r=(0,s.wc)("featureCollection.layers",t),i=r?.[0]?.layerDefinition;i&&h(e,i)}else"group"!==e.type&&h(e,t)}(e,t),t&&(t.id=e.id,"blendMode"in e&&(t.blendMode=e.blendMode,"normal"===t.blendMode&&delete t.blendMode),t.opacity=(0,o.B)(e.opacity)??void 0,t.title=e.title||"Layer",t.visibility=e.visible,"legendEnabled"in e&&"wmts"!==e.type))if((0,a.Ov)(e)){const r=t.featureCollection;r&&(r.showLegend=e.legendEnabled)}else t.showLegend=e.legendEnabled}(e,t=(0,n.o8)(t)),t}}}]);
//# sourceMappingURL=views-2d-layers-features-FeaturePipelineWorker.js.map