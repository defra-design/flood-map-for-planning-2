"use strict";(self.webpackChunkdefra=self.webpackChunkdefra||[]).push([[9732],{87725:function(e,t,r){function n(){return[1,0,0,0,1,0,0,0,1]}function s(e,t,r,n,s,o,i,a,u){return[e,t,r,n,s,o,i,a,u]}r.d(t,{fA:function(){return s},vt:function(){return n},zK:function(){return o}});const o=[1,0,0,0,1,0,0,0,1];Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:o,clone:function(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]},create:n,createView:function(e,t){return new Float64Array(e,t,9)},fromValues:s},Symbol.toStringTag,{value:"Module"}))},39714:function(e,t,r){function n(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function s(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]}function o(e,t,r,n,s,o,i,a,u,l,c,p,d,f,h,y){return[e,t,r,n,s,o,i,a,u,l,c,p,d,f,h,y]}r.d(t,{fA:function(){return o},o8:function(){return s},vt:function(){return n},zK:function(){return i}});const i=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:i,clone:s,create:n,createView:function(e,t){return new Float64Array(e,t,16)},fromValues:o},Symbol.toStringTag,{value:"Module"}))},61769:function(e,t,r){function n(){return[0,0,0,1]}function s(e){return[e[0],e[1],e[2],e[3]]}r.d(t,{o8:function(){return s},vt:function(){return n},zK:function(){return o}});const o=[0,0,0,1];Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:o,clone:s,create:n,fromValues:function(e,t,r,n){return[e,t,r,n]}},Symbol.toStringTag,{value:"Module"}))},32237:function(e,t,r){r.d(t,{A6:function(){return g},B8:function(){return f},Xd:function(){return c},Xr:function(){return h},Yc:function(){return O},hZ:function(){return b},lw:function(){return p},t2:function(){return q},x8:function(){return l}});var n=r(87725),s=r(61769),o=r(32501),i=r(8527),a=r(20551),u=r(33400);function l(e,t,r){r*=.5;const n=Math.sin(r);return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=Math.cos(r),e}function c(e,t){const r=2*Math.acos(t[3]),n=Math.sin(r/2);return n>(0,i.FD)()?(e[0]=t[0]/n,e[1]=t[1]/n,e[2]=t[2]/n):(e[0]=1,e[1]=0,e[2]=0),r}function p(e,t,r){const n=t[0],s=t[1],o=t[2],i=t[3],a=r[0],u=r[1],l=r[2],c=r[3];return e[0]=n*c+i*a+s*l-o*u,e[1]=s*c+i*u+o*a-n*l,e[2]=o*c+i*l+n*u-s*a,e[3]=i*c-n*a-s*u-o*l,e}function d(e,t,r,n){const s=t[0],o=t[1],a=t[2],u=t[3];let l,c,p,d,f,h=r[0],y=r[1],g=r[2],m=r[3];return c=s*h+o*y+a*g+u*m,c<0&&(c=-c,h=-h,y=-y,g=-g,m=-m),1-c>(0,i.FD)()?(l=Math.acos(c),p=Math.sin(l),d=Math.sin((1-n)*l)/p,f=Math.sin(n*l)/p):(d=1-n,f=n),e[0]=d*s+f*h,e[1]=d*o+f*y,e[2]=d*a+f*g,e[3]=d*u+f*m,e}function f(e,t){const r=t[0],n=t[1],s=t[2],o=t[3],i=r*r+n*n+s*s+o*o,a=i?1/i:0;return e[0]=-r*a,e[1]=-n*a,e[2]=-s*a,e[3]=o*a,e}function h(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function y(e,t){const r=t[0]+t[4]+t[8];let n;if(r>0)n=Math.sqrt(r+1),e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{let r=0;t[4]>t[0]&&(r=1),t[8]>t[3*r+r]&&(r=2);const s=(r+1)%3,o=(r+2)%3;n=Math.sqrt(t[3*r+r]-t[3*s+s]-t[3*o+o]+1),e[r]=.5*n,n=.5/n,e[3]=(t[3*s+o]-t[3*o+s])*n,e[s]=(t[3*s+r]+t[3*r+s])*n,e[o]=(t[3*o+r]+t[3*r+o])*n}return e}function g(e,t,r,n){const s=.5*Math.PI/180;t*=s,r*=s,n*=s;const o=Math.sin(t),i=Math.cos(t),a=Math.sin(r),u=Math.cos(r),l=Math.sin(n),c=Math.cos(n);return e[0]=o*u*c-i*a*l,e[1]=i*a*c+o*u*l,e[2]=i*u*l-o*a*c,e[3]=i*u*c+o*a*l,e}const m=u.c,b=u.s,w=u.g,_=p,A=u.d,S=u.h,F=u.l,x=u.j,I=x,v=u.b,R=v,M=u.n,q=u.a,T=u.e;function O(e,t,r){const n=(0,a.f)(t,r);return n<-.999999?((0,a.e)(k,E,t),(0,a.G)(k)<1e-6&&(0,a.e)(k,N,t),(0,a.n)(k,k),l(e,k,Math.PI),e):n>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):((0,a.e)(k,t,r),e[0]=k[0],e[1]=k[1],e[2]=k[2],e[3]=1+n,M(e,e))}const k=(0,o.vt)(),E=(0,o.fA)(1,0,0),N=(0,o.fA)(0,1,0),P=(0,s.vt)(),G=(0,s.vt)(),D=(0,n.vt)();Object.freeze(Object.defineProperty({__proto__:null,add:w,calculateW:function(e,t){const r=t[0],n=t[1],s=t[2];return e[0]=r,e[1]=n,e[2]=s,e[3]=Math.sqrt(Math.abs(1-r*r-n*n-s*s)),e},conjugate:h,copy:m,dot:S,equals:T,exactEquals:q,fromEuler:g,fromMat3:y,getAxisAngle:c,identity:function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},invert:f,len:I,length:x,lerp:F,mul:_,multiply:p,normalize:M,random:function(e){const t=i.Ov,r=t(),n=t(),s=t(),o=Math.sqrt(1-r),a=Math.sqrt(r);return e[0]=o*Math.sin(2*Math.PI*n),e[1]=o*Math.cos(2*Math.PI*n),e[2]=a*Math.sin(2*Math.PI*s),e[3]=a*Math.cos(2*Math.PI*s),e},rotateX:function(e,t,r){r*=.5;const n=t[0],s=t[1],o=t[2],i=t[3],a=Math.sin(r),u=Math.cos(r);return e[0]=n*u+i*a,e[1]=s*u+o*a,e[2]=o*u-s*a,e[3]=i*u-n*a,e},rotateY:function(e,t,r){r*=.5;const n=t[0],s=t[1],o=t[2],i=t[3],a=Math.sin(r),u=Math.cos(r);return e[0]=n*u-o*a,e[1]=s*u+i*a,e[2]=o*u+n*a,e[3]=i*u-s*a,e},rotateZ:function(e,t,r){r*=.5;const n=t[0],s=t[1],o=t[2],i=t[3],a=Math.sin(r),u=Math.cos(r);return e[0]=n*u+s*a,e[1]=s*u-n*a,e[2]=o*u+i*a,e[3]=i*u-o*a,e},rotationTo:O,scale:A,set:b,setAxes:function(e,t,r,n){const s=D;return s[0]=r[0],s[3]=r[1],s[6]=r[2],s[1]=n[0],s[4]=n[1],s[7]=n[2],s[2]=-t[0],s[5]=-t[1],s[8]=-t[2],M(e,y(e,s))},setAxisAngle:l,slerp:d,sqlerp:function(e,t,r,n,s,o){return d(P,t,s,o),d(G,r,n,o),d(e,P,G,2*o*(1-o)),e},sqrLen:R,squaredLength:v,str:function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}},Symbol.toStringTag,{value:"Module"}))},68225:function(e,t,r){r.d(t,{A:function(){return c}});var n,s,o=r(58941),i=r(56996);(s=n||(n={}))[s.varint=0]="varint",s[s.fixed64=1]="fixed64",s[s.delimited=2]="delimited",s[s.fixed32=5]="fixed32",s[s.unknown=99]="unknown";const a=4294967296,u=new TextDecoder("utf-8"),l=(0,o.A)("safari")||(0,o.A)("ios")?6:(0,o.A)("ff")?12:32;class c{constructor(e,t,r=0,s=(e?e.byteLength:0)){this._tag=0,this._dataType=n.unknown,this._init(e,t,r,s)}_init(e,t,r,n){this._data=e,this._dataView=t,this._pos=r,this._end=n}asUnsafe(){return this}clone(){return new c(this._data,this._dataView,this._pos,this._end)}pos(){return this._pos}move(e){this._pos=e}nextTag(e){for(;;){if(this._pos===this._end)return!1;const t=this._decodeVarint();if(this._tag=t>>3,this._dataType=7&t,!e||e===this._tag)break;this.skip()}return!0}next(){if(this._pos===this._end)return!1;const e=this._decodeVarint();return this._tag=e>>3,this._dataType=7&e,!0}empty(){return this._pos>=this._end}tag(){return this._tag}getInt32(){return this._decodeVarint()}getInt64(){return this._decodeVarint()}getUInt32(){let e=4294967295;if(e=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128)return e;if(e=(e|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128)return e;if(e=(e|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128)return e;if(e=(e|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128)return e;if(e=(e|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128)return e;throw new Error("Varint overflow")}getUInt64(){return this._decodeVarint()}getSInt32(){const e=this.getUInt32();return e>>>1^-(1&e)}getSInt64(){return this._decodeSVarint()}getBool(){const e=0!==this._data[this._pos];return this._skip(1),e}getEnum(){return this._decodeVarint()}getFixed64(){const e=this._dataView,t=this._pos,r=e.getUint32(t,!0)+e.getUint32(t+4,!0)*a;return this._skip(8),r}getSFixed64(){const e=this._dataView,t=this._pos,r=e.getUint32(t,!0)+e.getInt32(t+4,!0)*a;return this._skip(8),r}getDouble(){const e=this._dataView.getFloat64(this._pos,!0);return this._skip(8),e}getFixed32(){const e=this._dataView.getUint32(this._pos,!0);return this._skip(4),e}getSFixed32(){const e=this._dataView.getInt32(this._pos,!0);return this._skip(4),e}getFloat(){const e=this._dataView.getFloat32(this._pos,!0);return this._skip(4),e}getString(){const e=this._getLength(),t=this._pos,r=this._toString(this._data,t,t+e);return this._skip(e),r}getBytes(){const e=this._getLength(),t=this._pos,r=this._toBytes(this._data,t,t+e);return this._skip(e),r}getLength(){return this._getLengthUnsafe()}processMessageWithArgs(e,t,r,n){const s=this.getMessage(),o=e(s,t,r,n);return s.release(),o}processMessage(e){const t=this.getMessage(),r=e(t);return t.release(),r}getMessage(){const e=this._getLength(),t=c.pool.acquire();return t._init(this._data,this._dataView,this._pos,this._pos+e),this._skip(e),t}release(){c.pool.release(this)}dataType(){return this._dataType}skip(){switch(this._dataType){case n.varint:this._decodeVarint();break;case n.fixed64:this._skip(8);break;case n.delimited:this._skip(this._getLength());break;case n.fixed32:this._skip(4);break;default:throw new Error("Invalid data type!")}}skipLen(e){this._skip(e)}_skip(e){if(this._pos+e>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=e}_decodeVarint(){const e=this._data;let t=this._pos,r=0,n=0;if(this._end-t>=10)do{if(n=e[t++],r|=127&n,!(128&n))break;if(n=e[t++],r|=(127&n)<<7,!(128&n))break;if(n=e[t++],r|=(127&n)<<14,!(128&n))break;if(n=e[t++],r|=(127&n)<<21,!(128&n))break;if(n=e[t++],r+=268435456*(127&n),!(128&n))break;if(n=e[t++],r+=34359738368*(127&n),!(128&n))break;if(n=e[t++],r+=4398046511104*(127&n),!(128&n))break;if(n=e[t++],r+=562949953421312*(127&n),!(128&n))break;if(n=e[t++],r+=72057594037927940*(127&n),!(128&n))break;if(n=e[t++],r+=0x8000000000000000*(127&n),!(128&n))break;throw new Error("Varint too long!")}while(0);else{let s=1;for(;t!==this._end&&(n=e[t],128&n);)++t,r+=(127&n)*s,s*=128;if(t===this._end)throw new Error("Varint overrun!");++t,r+=n*s}return this._pos=t,r}_decodeSVarint(){const e=this._data;let t,r=0,n=0;const s=1&e[this._pos];if(n=e[this._pos++],r|=127&n,!(128&n))return s?-(r+1)/2:r/2;if(n=e[this._pos++],r|=(127&n)<<7,!(128&n))return s?-(r+1)/2:r/2;if(n=e[this._pos++],r|=(127&n)<<14,!(128&n))return s?-(r+1)/2:r/2;if(n=e[this._pos++],r|=(127&n)<<21,!(128&n))return s?-(r+1)/2:r/2;if(n=e[this._pos++],r+=268435456*(127&n),!(128&n))return s?-(r+1)/2:r/2;if(n=e[this._pos++],r+=34359738368*(127&n),!(128&n))return s?-(r+1)/2:r/2;if(n=e[this._pos++],r+=4398046511104*(127&n),!(128&n))return s?-(r+1)/2:r/2;if(t=BigInt(r),n=e[this._pos++],t+=0x2000000000000n*BigInt(127&n),!(128&n))return Number(s?-(t+1n)/2n:t/2n);if(n=e[this._pos++],t+=0x100000000000000n*BigInt(127&n),!(128&n))return Number(s?-(t+1n)/2n:t/2n);if(n=e[this._pos++],t+=0x8000000000000000n*BigInt(127&n),!(128&n))return Number(s?-(t+1n)/2n:t/2n);throw new Error("Varint too long!")}_getLength(){if(this._dataType!==n.delimited)throw new Error("Not a delimited data type!");return this._decodeVarint()}_getLengthUnsafe(){return this.getUInt32()}_toString(e,t,r){if((r=Math.min(this._end,r))-t>l){const n=e.subarray(t,r);return u.decode(n)}let n="",s="";for(let o=t;o<r;++o){const t=e[o];128&t?s+="%"+t.toString(16):(n+=decodeURIComponent(s)+String.fromCharCode(t),s="")}return s.length&&(n+=decodeURIComponent(s)),n}_toBytes(e,t,r){return r=Math.min(this._end,r),new Uint8Array(e.buffer,t,r-t)}}c.pool=new i.A(c,void 0,(e=>{e._data=null,e._dataView=null}))},65907:function(e,t,r){r.d(t,{A:function(){return p}});var n,s=r(53804),o=r(75743),i=r(30905),a=r(23502),u=(r(58941),r(40633),r(13798),r(74376)),l=r(65953);let c=n=class extends((0,o.O)(i.oY)){constructor(e){super(e),this.type="georeferenced",this.origin=null}};c.absolute=new n,(0,s._)([(0,u.e)({georeferenced:"georeferenced"},{readOnly:!0})],c.prototype,"type",void 0),(0,s._)([(0,a.MZ)({type:[Number],nonNullable:!1,json:{write:!0}})],c.prototype,"origin",void 0),c=n=(0,s._)([(0,l.$)("esri.geometry.support.MeshGeoreferencedVertexSpace")],c);const p=c},20460:function(e,t,r){r.d(t,{A:function(){return p}});var n=r(53804),s=r(75743),o=r(30905),i=r(23502),a=(r(58941),r(40633),r(13798),r(74376)),u=r(65953),l=r(32501);let c=class extends((0,s.O)(o.oY)){constructor(e){super(e),this.type="local",this.origin=(0,l.vt)()}};(0,n._)([(0,a.e)({local:"local"},{readOnly:!0})],c.prototype,"type",void 0),(0,n._)([(0,i.MZ)({type:[Number],nonNullable:!0,json:{write:!0}})],c.prototype,"origin",void 0),c=(0,n._)([(0,u.$)("esri.geometry.support.MeshLocalVertexSpace")],c);const p=c},36405:function(e,t,r){r.d(t,{A:function(){return g}});var n,s=r(53804),o=r(30905),i=r(23502),a=(r(58941),r(40633),r(13798),r(65953)),u=r(73364),l=r(39714),c=r(32237),p=r(61769),d=r(32501),f=r(26133);let h=n=class extends o.oY{constructor(e){super(e),this.translation=(0,d.vt)(),this.rotationAxis=(0,d.ci)(f.up),this.rotationAngle=0,this.scale=(0,d.fA)(1,1,1)}get rotation(){return(0,f.i4)(this.rotationAxis,this.rotationAngle)}set rotation(e){this.rotationAxis=(0,d.o8)((0,f.yo)(e)),this.rotationAngle=(0,f.g7)(e)}get localMatrix(){const e=(0,l.vt)();return(0,c.x8)(y,(0,f.yo)(this.rotation),(0,f.$I)(this.rotation)),(0,u.o1)(e,y,this.translation,this.scale),e}get localMatrixInverse(){return(0,u.B8)((0,l.vt)(),this.localMatrix)}equals(e){return this===e||null!=e&&(0,u.t2)(this.localMatrix,e.localMatrix)}clone(){const e={translation:(0,d.o8)(this.translation),rotationAxis:(0,d.o8)(this.rotationAxis),rotationAngle:this.rotationAngle,scale:(0,d.o8)(this.scale)};return new n(e)}};(0,s._)([(0,i.MZ)({type:[Number],nonNullable:!0,json:{write:!0}})],h.prototype,"translation",void 0),(0,s._)([(0,i.MZ)({type:[Number],nonNullable:!0,json:{write:!0}})],h.prototype,"rotationAxis",void 0),(0,s._)([(0,i.MZ)({type:Number,nonNullable:!0,json:{write:!0}})],h.prototype,"rotationAngle",void 0),(0,s._)([(0,i.MZ)({type:[Number],nonNullable:!0,json:{write:!0}})],h.prototype,"scale",void 0),(0,s._)([(0,i.MZ)()],h.prototype,"rotation",null),(0,s._)([(0,i.MZ)()],h.prototype,"localMatrix",null),(0,s._)([(0,i.MZ)()],h.prototype,"localMatrixInverse",null),h=n=(0,s._)([(0,a.$)("esri.geometry.support.MeshTransform")],h);const y=(0,p.vt)(),g=h},26133:function(e,t,r){r.d(t,{$I:function(){return m},AU:function(){return h},Cr:function(){return p},g7:function(){return g},i4:function(){return c},ui:function(){return d},up:function(){return w},vt:function(){return l},yo:function(){return y}});var n=r(15774),s=r(73364),o=r(32237),i=r(61769),a=r(20551),u=r(32501);function l(e=w){return[e[0],e[1],e[2],e[3]]}function c(e,t,r=l()){return(0,a.c)(r,e),r[3]=t,r}function p(e,t,r){return(0,a.e)(r,e,t),(0,a.n)(r,r),r[3]=-(0,a.r)(e,t),r}function d(e,t=l()){const r=(0,s.l)(_,e);return b(t,(0,n.KJ)((0,o.Xd)(t,r))),t}function f(e,t,r=l()){return(0,o.x8)(_,e,m(e)),(0,o.x8)(A,t,m(t)),(0,o.lw)(_,A,_),b(r,(0,n.KJ)((0,o.Xd)(r,_)))}function h(e,t,r,n=l()){return c(u.Cw,e,S),c(u.JP,t,F),c(u.Cb,r,x),f(S,F,S),f(S,x,n),n}function y(e){return e}function g(e){return e[3]}function m(e){return(0,n.kU)(e[3])}function b(e,t){return e[3]=t,e}const w=[0,0,1,0],_=(0,i.vt)(),A=(0,i.vt)(),S=(l(),l()),F=l(),x=l()},23572:function(e,t,r){r.d(t,{Bq:function(){return u},Qp:function(){return a},WN:function(){return b},dK:function(){return w},eN:function(){return h},fH:function(){return m},in:function(){return y},yr:function(){return l}});var n=r(93040),s=r(50659),o=r(60539),i=r(66228);class a{constructor(e,t,r){this.assetName=e,this.assetMimeType=t,this.parts=r}equals(e){return this===e||this.assetName===e.assetName&&this.assetMimeType===e.assetMimeType&&(0,s.aI)(this.parts,e.parts,((e,t)=>e.equals(t)))}isOnService(e){return this.parts.every((t=>t.isOnService(e)))}makeHash(){let e="";for(const t of this.parts)e+=t.partHash;return e}async toBlob(e){const{parts:t}=this;if(1===t.length)return t[0].toBlob(e);const r=await Promise.all(t.map((t=>t.toBlob(e))));return(0,o.Te)(e),new Blob(r)}}class u{constructor(e,t){this.partUrl=e,this.partHash=t}equals(e){return this===e||this.partUrl===e.partUrl&&this.partHash===e.partHash}isOnService(e){return this.partUrl.startsWith(`${e.path}/assets/`)}async toBlob(e){const{data:t}=await(0,n.A)(this.partUrl,{responseType:"blob"});return(0,o.Te)(e),t}}function l(e){return function(e){return!!e&&(Array.isArray(e)?e.some(f):f(e))}(e?.source)}function c(e){return!!Array.isArray(e)&&e.every((e=>e instanceof a))}const p=/^(model\/gltf\+json)|(model\/gltf-binary)$/,d=/\.(gltf|glb)/i;function f(e){if(e instanceof File){const{type:t,name:r}=e;return p.test(t)||d.test(r)}return p.test(e.assetMimeType)||d.test(e.assetName)}function h(e,t){if(!e)return!1;const{source:r}=e;return function(e,t){if(Array.isArray(e)){const r=e;return r.length>0&&r.every((e=>g(e,t)))}return g(e,t)}(r,t)}function y(e,t){if(e===t)return!0;const{source:r}=e,{source:n}=t;if(r===n)return!0;if(c(r)&&c(n)){if(r.length!==n.length)return!1;const e=(e,t)=>e.assetName<t.assetName?-1:e.assetName>t.assetName?1:0,t=[...r].sort(e),s=[...n].sort(e);for(let e=0;e<t.length;++e)if(!t[e].equals(s[e]))return!1;return!0}return!1}function g(e,t){return e instanceof a&&e.isOnService(t)}function m(e,t){return e instanceof File?(0,i.rq)(e,t):(0,i.z$)(e.assetMimeType,e.assetName,t)}function b(e){return Array.isArray(e)?e:[e]}function w(e){return!!e.original}},67376:function(e,t,r){r.d(t,{CK:function(){return d},E9:function(){return c},Hq:function(){return p},MW:function(){return f},TE:function(){return h},yJ:function(){return y}});var n=r(88022),s=r(40633),o=r(20551),i=r(45532),a=r(65907),u=r(20460);function l(){return s.A.getLogger("esri.geometry.Mesh")}function c(e){return!p(e)}function p(e){return null!=e.origin}function d(e){return p(e.vertexSpace)}function f(e,t){if(!p(e))return null;const[r,n,s]=e.origin;return new i.default({x:r,y:n,z:s,spatialReference:t})}function h(e,t){const{x:r,y:s,z:o,spatialReference:i}=e,c=[r,s,o??0];return void 0!==t?.geographic&&((0,n.io)(l(),"option: geographic",{replacement:"Use the `vertexSpace` option instead.",version:"4.29",warnOnce:!0}),t.vertexSpace&&l().warn("Deprecated geographic flag ignored since vertexSpace option is provided.")),"local"===(t?.vertexSpace??(p=t?.geographic,null==p?void 0:p?"local":"georeferenced")??function(e){return e.isGeographic||e.isWebMercator?"local":"georeferenced"}(i))?new u.A({origin:c}):new a.A({origin:c});var p}function y(e,t){return e.type===t.type&&(e.origin===t.origin||null!=e.origin&&null!=t.origin&&(0,o.p)(e.origin,t.origin))}},65298:function(e,t,r){r.d(t,{O7:function(){return v},Hr:function(){return I},el:function(){return x},mT:function(){return R},XX:function(){return _}});var n=r(25591),s=r(39819),o=r(40633),i=r(44740),a=r(91508),u=r(65417),l=r(57652),c=r(1644),p=(r(50917),r(93040)),d=r(74697),f=r(39397),h=r(90683),y=r(26765);const g=()=>o.A.getLogger("esri.geometry.support.normalizeUtils");function m(e){return"polygon"===e[0].type}function b(e){return"polyline"===e[0].type}function w(e){const t=[];let r=0,n=0;for(let s=0;s<e.length;s++){const o=e[s];let i=null;for(let e=0;e<o.length;e++)i=o[e],t.push(i),0===e?(r=i[0],n=r):(r=Math.min(r,i[0]),n=Math.max(n,i[0]));i&&t.push([(r+n)/2,0])}return t}function _(e,t){if(!(e instanceof a.A||e instanceof i.A)){const e="straightLineDensify: the input geometry is neither polyline nor polygon";throw g().error(e),new s.A(e)}const r=(0,u.r8)(e),n=[];for(const e of r){const r=[];n.push(r),r.push([e[0][0],e[0][1]]);for(let n=0;n<e.length-1;n++){const s=e[n][0],o=e[n][1],i=e[n+1][0],a=e[n+1][1],u=Math.sqrt((i-s)*(i-s)+(a-o)*(a-o)),l=(a-o)/u,c=(i-s)/u,p=u/t;if(p>1){for(let e=1;e<=p-1;e++){const n=e*t,i=c*n+s,a=l*n+o;r.push([i,a])}const e=(u+Math.floor(p-1)*t)/2,n=c*e+s,i=l*e+o;r.push([n,i])}r.push([i,a])}}return function(e){return"polygon"===e.type}(e)?new i.A({rings:n,spatialReference:e.spatialReference}):new a.A({paths:n,spatialReference:e.spatialReference})}function A(e,t,r){if(t){const t=_(e,1e6);e=(0,c.ci)(t,!0)}return r&&(e=(0,u.kS)(e,r)),e}function S(e,t,r){if(Array.isArray(e)){const n=e[0];if(n>t){const r=(0,u.kd)(n,t);e[0]=n+r*(-2*t)}else if(n<r){const t=(0,u.kd)(n,r);e[0]=n+t*(-2*r)}}else{const n=e.x;if(n>t){const r=(0,u.kd)(n,t);e=e.clone().offset(r*(-2*t),0)}else if(n<r){const t=(0,u.kd)(n,r);e=e.clone().offset(t*(-2*r),0)}}return e}function F(e,t){let r=-1;for(let n=0;n<t.cutIndexes.length;n++){const s=t.cutIndexes[n],o=t.geometries[n],i=(0,u.r8)(o);for(let e=0;e<i.length;e++){const t=i[e];t.some((r=>{if(r[0]<180)return!0;{let r=0;for(let e=0;e<t.length;e++){const n=t[e][0];r=n>r?n:r}r=Number(r.toFixed(9));const n=-360*(0,u.kd)(r,180);for(let r=0;r<t.length;r++){const t=o.getPoint(e,r);o.setPoint(e,r,t.clone().offset(n,0))}return!0}}))}if(s===r){if(m(e))for(const t of(0,u.r8)(o))e[s]=e[s].addRing(t);else if(b(e))for(const t of(0,u.r8)(o))e[s]=e[s].addPath(t)}else r=s,e[s]=o}return e}async function x(e,t,r){if(!Array.isArray(e))return x([e],t);t&&"string"!=typeof t&&g().warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");const s="string"==typeof t?t:t?.url??n.default.geometryServiceUrl;let o,m,b,w,_,I,v,R,M=0;const q=[],T=[];for(const t of e)if(null!=t)if(o||(o=t.spatialReference,m=(0,l.Vp)(o),b=o.isWebMercator,I=b?102100:4326,w=u.j7[I].maxX,_=u.j7[I].minX,v=u.j7[I].plus180Line,R=u.j7[I].minus180Line),m)if("mesh"===t.type)T.push(t);else if("point"===t.type)T.push(S(t.clone(),w,_));else if("multipoint"===t.type){const e=t.clone();e.points=e.points.map((e=>S(e,w,_))),T.push(e)}else if("extent"===t.type){const e=t.clone()._normalize(!1,!1,m);T.push(e.rings?new i.A(e):e)}else if(t.extent){const e=t.extent,r=(0,u.kd)(e.xmin,_)*(2*w);let n=0===r?t.clone():(0,u.kS)(t.clone(),r);e.offset(r,0);let{xmin:s,xmax:o}=e;s=Number(s.toFixed(9)),o=Number(o.toFixed(9)),e.intersects(v)&&o!==w?(M=o>M?o:M,n=A(n,b),q.push(n),T.push("cut")):e.intersects(R)&&s!==_?(M=o*(2*w)>M?o*(2*w):M,n=A(n,b,360),q.push(n),T.push("cut")):T.push(n)}else T.push(t.clone());else T.push(t);else T.push(t);let O=(0,u.kd)(M,w),k=-90;const E=O,N=new a.A;for(;O>0;){const e=360*O-180;N.addPath([[e,k],[e,-1*k]]),k*=-1,O--}if(q.length>0&&E>0){const t=F(q,await async function(e,t,r,n){const s=(0,f.Dl)(e),o=t[0].spatialReference,i={...n,responseType:"json",query:{...s.query,f:"json",sr:(0,l.YX)(o),target:JSON.stringify({geometryType:(0,d.$B)(t[0]),geometries:t}),cutter:JSON.stringify(r)}},a=await(0,p.A)(s.path+"/cut",i),{cutIndexes:u,geometries:c=[]}=a.data;return{cutIndexes:u,geometries:c.map((e=>{const t=(0,d.rS)(e);return t.spatialReference=o,t}))}}(s,q,N,r)),n=[],o=[];for(let r=0;r<T.length;r++){const s=T[r];if("cut"!==s)o.push(s);else{const s=t.shift(),i=e[r];null!=i&&"polygon"===i.type&&i.rings&&i.rings.length>1&&s.rings.length>=i.rings.length?(n.push(s),o.push("simplify")):o.push(b?(0,c.Gh)(s):s)}}if(!n.length)return o;const i=await async function(e,t,r){const n="string"==typeof e?(0,h.An)(e):e,s=t[0].spatialReference,o=(0,d.$B)(t[0]),i={...r,query:{...n.query,f:"json",sr:(0,l.YX)(s),geometries:JSON.stringify((0,y.X)(t))}},{data:a}=await(0,p.A)(n.path+"/simplify",i);return(0,y.V)(a.geometries,o,s)}(s,n,r),a=[];for(let e=0;e<o.length;e++){const t=o[e];"simplify"!==t?a.push(t):a.push(b?(0,c.Gh)(i.shift()):i.shift())}return a}const P=[];for(let e=0;e<T.length;e++){const t=T[e];if("cut"!==t)P.push(t);else{const e=q.shift();P.push(!0===b?(0,c.Gh)(e):e)}}return P}function I(e){if(!e)return null;const t=e.extent;if(!t)return null;const r=e.spatialReference&&(0,l.Vp)(e.spatialReference);if(!r)return t;const[n,s]=r.valid,o=2*s,{width:i}=t;let a,{xmin:u,xmax:c}=t;if([u,c]=[c,u],"extent"===e.type||0===i||i<=s||i>o||u<n||c>s)return t;switch(e.type){case"polygon":if(!(e.rings.length>1))return t;a=w(e.rings);break;case"polyline":if(!(e.paths.length>1))return t;a=w(e.paths);break;case"multipoint":a=e.points}const p=t.clone();for(let e=0;e<a.length;e++){let t=a[e][0];t<0?(t+=s,c=Math.max(t,c)):(t-=s,u=Math.min(t,u))}return p.xmin=u,p.xmax=c,p.width<i?(p.xmin-=s,p.xmax-=s,p):t}function v(e,t,r){const n=(0,l.Vp)(r);if(null==n)return e;const[s,o]=n.valid,i=2*o;let a=0,u=0;t>o?a=Math.ceil(Math.abs(t-o)/i):t<s&&(a=-Math.ceil(Math.abs(t-s)/i)),e>o?u=Math.ceil(Math.abs(e-o)/i):e<s&&(u=-Math.ceil(Math.abs(e-s)/i));let c=e+(a-u)*i;const p=c-t;return p>o?c-=i:p<s&&(c+=i),c}function R(e,t){const r=(0,l.Vp)(t);if(r){const[t,n]=r.valid,s=n-t;if(e<t)for(;e<t;)e+=s;if(e>n)for(;e>n;)e-=s}return e}},65417:function(e,t,r){r.d(t,{j7:function(){return i},kS:function(){return u},kd:function(){return a},r8:function(){return l}});var n=r(91508),s=r(57165),o=r(74697);const i={102100:{maxX:20037508.342788905,minX:-20037508.342788905,plus180Line:new n.A({paths:[[[20037508.342788905,-20037508.342788905],[20037508.342788905,20037508.342788905]]],spatialReference:s.A.WebMercator}),minus180Line:new n.A({paths:[[[-20037508.342788905,-20037508.342788905],[-20037508.342788905,20037508.342788905]]],spatialReference:s.A.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new n.A({paths:[[[180,-180],[180,180]]],spatialReference:s.A.WGS84}),minus180Line:new n.A({paths:[[[-180,-180],[-180,180]]],spatialReference:s.A.WGS84})}};function a(e,t){return Math.ceil((e-t)/(2*t))}function u(e,t){const r=l(e);for(const e of r)for(const r of e)r[0]+=t;return e}function l(e){return(0,o.Bi)(e)?e.rings:e.paths}},65215:function(e,t,r){r.d(t,{N3:function(){return o},Om:function(){return s}});var n=r(76613);class s{constructor(e=null,t={},r,n){this.geometry=e,this.attributes=t,this.centroid=r,this.objectId=n,this.displayId=0,this.geohashX=0,this.geohashY=0}static fromJSON(e,t){const r=e.geometry?n.A.fromJSON(e.geometry):null,o=e.centroid?n.A.fromJSON(e.centroid):null,i=e.attributes[t];return new s(r,e.attributes,o,i)}weakClone(){const e=new s(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e.geohashX=this.geohashX,e.geohashY=this.geohashY,e}clone(){const e=this.geometry?.clone(),t=new s(e,{...this.attributes},this.centroid?.clone(),this.objectId);return t.displayId=this.displayId,t.geohashX=this.geohashX,t.geohashY=this.geohashY,t}}function o(e){return!!e.geometry?.coords?.length}},72887:function(e,t,r){r.d(t,{A:function(){return n}});class n{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const e=new n;return e.objectIdFieldName=this.objectIdFieldName,e.globalIdFieldName=this.globalIdFieldName,e.geohashFieldName=this.geohashFieldName,e.geometryProperties=this.geometryProperties,e.geometryType=this.geometryType,e.spatialReference=this.spatialReference,e.hasZ=this.hasZ,e.hasM=this.hasM,e.features=this.features,e.fields=this.fields,e.transform=this.transform,e.exceededTransferLimit=this.exceededTransferLimit,e.uniqueIdField=this.uniqueIdField,e.queryGeometry=this.queryGeometry,e.queryGeometryType=this.queryGeometryType,e}}},76613:function(e,t,r){r.d(t,{A:function(){return n}});class n{constructor(e=[],t=[]){this.lengths=e??[],this.coords=t??[]}static fromJSON(e){return new n(e.lengths,e.coords)}static fromRect(e){const[t,r,s,o]=e,i=s-t,a=o-r;return new n([5],[t,r,i,0,0,a,-i,0,0,-a])}get isPoint(){return 0===this.lengths.length&&this.coords.length>=2}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce(((e,t)=>e+t))}forEachVertex(e){let t=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let r=0;r<this.lengths.length;r++){const n=this.lengths[r];for(let r=0;r<n;r++)e(this.coords[2*(r+t)],this.coords[2*(r+t)+1]);t+=n}}deltaDecode(){const e=this.clone(),{coords:t,lengths:r}=e;let n=0;for(const e of r){for(let r=1;r<e;r++)t[2*(n+r)]+=t[2*(n+r)-2],t[2*(n+r)+1]+=t[2*(n+r)-1];n+=e}return e}clone(e){if(0===this.lengths.length)return new n([],[this.coords[0],this.coords[1]]);const t=2*(0===this.lengths.length?1:this.lengths.reduce(((e,t)=>e+t))),r=this.coords.slice(0,t);return e?(e.set(r),new n(this.lengths,e)):new n(Array.from(this.lengths),Array.from(r))}}},7121:function(e,t,r){r.d(t,{F:function(){return n}});const n={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsCentroid:!0,supportsCacheHint:!0,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!0,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsTopFeaturesQuery:!1,supportsQueryByAnonymous:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsCompactGeometry:!1,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}},30269:function(e,t,r){r.d(t,{applyEdits:function(){return S},r3:function(){return w},uploadAssets:function(){return q},zp:function(){return A}});var n=r(59469),s=r(78879),o=r(39819),i=r(21609),a=r(40633),u=r(60539),l=r(90683),c=r(66110),p=r(65298),d=r(57652),f=r(9680),h=r(53743),y=r(66228),g=r(11432);function m(e){return null!=e?.applyEdits}function b(e){return"object"==typeof e&&null!=e&&"objectId"in e&&!!e.objectId}function w(e){return e.every(b)}function _(e){return"object"==typeof e&&null!=e&&"globalId"in e&&!!e.globalId}function A(e){return e.every(_)}async function S(e,t,r,n={}){let l;const p="gdbVersion"in e?e.gdbVersion:null,d=n.gdbVersion??p;if((0,f.Mk)(e)&&e.url)l=(0,f.Zk)(e.url,e.layerId,d,"original-and-current-features"===n.returnServiceEditsOption);else{l=(0,u.Tw)(),l.promise.then((t=>{(t.addedFeatures.length||t.updatedFeatures.length||t.deletedFeatures.length||t.addedAttachments.length||t.updatedAttachments.length||t.deletedAttachments.length)&&e.emit("edits",t)}));const t={result:l.promise};e.emit("apply-edits",t)}try{const{results:u,edits:p}=await async function(e,t,r,n){if(await e.load(),!m(t))throw new o.A(`${e.type}-layer:no-editing-support`,"Layer source does not support applyEdits capability",{layer:e});if(!(0,g.tk)(e))throw new o.A(`${e.type}-layer:editing-disabled`,"Editing is disabled for layer",{layer:e});const{edits:i,options:u}=await async function(e,t,r){const n=(0,g.BR)(e),i=t&&(t.addFeatures||t.updateFeatures||t.deleteFeatures),u=t&&(t.addAttachments||t.updateAttachments||t.deleteAttachments),l=null!=e.infoFor3D;if(function(e,t,r,n,s,i){if(!e||!n&&!s)throw new o.A(`${i}:missing-parameters`,"'addFeatures', 'updateFeatures', 'deleteFeatures', 'addAttachments', 'updateAttachments' or 'deleteAttachments' parameter is required");if(!t.editing.supportsGlobalId&&r?.globalIdUsed)throw new o.A(`${i}:invalid-parameter`,"This layer does not support 'globalIdUsed' parameter. See: 'capabilities.editing.supportsGlobalId'");if(!t.editing.supportsGlobalId&&s)throw new o.A(`${i}:invalid-parameter`,"'addAttachments', 'updateAttachments' and 'deleteAttachments' are applicable only if the layer supports global ids. See: 'capabilities.editing.supportsGlobalId'");if(!r?.globalIdUsed&&s)throw new o.A(`${i}:invalid-parameter`,"When 'addAttachments', 'updateAttachments' or 'deleteAttachments' is specified, globalIdUsed should be set to true")}(t,n,r,!!i,!!u,`${e.type}-layer`),!n.data.isVersioned&&r?.gdbVersion)throw new o.A(`${e.type}-layer:invalid-parameter`,"'gdbVersion' is applicable only if the layer supports versioned data. See: 'capabilities.data.isVersioned'");if(!n.editing.supportsRollbackOnFailure&&r?.rollbackOnFailureEnabled)throw new o.A(`${e.type}-layer:invalid-parameter`,"This layer does not support 'rollbackOnFailureEnabled' parameter. See: 'capabilities.editing.supportsRollbackOnFailure'");const p={...r};if(null!=p.rollbackOnFailureEnabled||n.editing.supportsRollbackOnFailure||(p.rollbackOnFailureEnabled=!0),p.rollbackOnFailureEnabled||"original-and-current-features"!==p.returnServiceEditsOption||(!1===p.rollbackOnFailureEnabled&&a.A.getLogger("esri.layers.graphics.editingSupport").warn(`${e.type}-layer:invalid-parameter`,"'original-and-current-features' is valid for 'returnServiceEditsOption' only when 'rollBackOnFailure' is true, but 'rollBackOnFailure' was set to false. 'rollBackOnFailure' has been overwritten and set to true."),p.rollbackOnFailureEnabled=!0),!n.editing.supportsReturnServiceEditsInSourceSpatialReference&&p.returnServiceEditsInSourceSR)throw new o.A(`${e.type}-layer:invalid-parameter`,"This layer does not support 'returnServiceEditsInSourceSR' parameter. See: 'capabilities.editing.supportsReturnServiceEditsInSourceSpatialReference'");if(p.returnServiceEditsInSourceSR&&"original-and-current-features"!==p.returnServiceEditsOption)throw new o.A(`${e.type}-layer:invalid-parameter`,"'returnServiceEditsInSourceSR' is valid only when 'returnServiceEditsOption' is set to 'original-and-current-features'");const d=function(e,t,r){const n=function(e){return{addFeatures:Array.from(e?.addFeatures??[]),updateFeatures:Array.from(e?.updateFeatures??[]),deleteFeatures:e&&s.A.isCollection(e.deleteFeatures)?e.deleteFeatures.toArray():e.deleteFeatures||[],addAttachments:e.addAttachments||[],updateAttachments:e.updateAttachments||[],deleteAttachments:e.deleteAttachments||[]}}(e);if(n.addFeatures?.length&&!t.operations.supportsAdd)throw new o.A(`${r}:unsupported-operation`,"Layer does not support adding features.");if(n.updateFeatures?.length&&!t.operations.supportsUpdate)throw new o.A(`${r}:unsupported-operation`,"Layer does not support updating features.");if(n.deleteFeatures?.length&&!t.operations.supportsDelete)throw new o.A(`${r}:unsupported-operation`,"Layer does not support deleting features.");return n.addFeatures=n.addFeatures.map(R),n.updateFeatures=n.updateFeatures.map(R),n.addAssetFeatures=[],n}(t,n,`${e.type}-layer`),f=r?.globalIdUsed||l,h=e.fields.filter((e=>"big-integer"===e.type||"oid"===e.type&&(e.length||0)>=8));if(f){const{globalIdField:t}=e;if(null==t)throw new o.A(`${e.type}-layer:invalid-parameter`,"Layer does not specify a global id field.");d.addFeatures.forEach((e=>function(e,t){const{attributes:r}=e;null==r[t]&&(r[t]=(0,c.yS)())}(e,t)))}return d.addFeatures.forEach((t=>function(e,t,r,n){F(e,t,r,n),x(e,t)}(t,e,f,h))),d.updateFeatures.forEach((t=>function(e,t,r,n){F(e,t,r,n),x(e,t);const s=(0,g.BR)(t);if("geometry"in e&&null!=e.geometry&&!s?.editing.supportsGeometryUpdate)throw new o.A(`${t.type}-layer:unsupported-operation`,"Layer does not support geometry updates.")}(t,e,f,h))),d.deleteFeatures.forEach((t=>function(e,t,r,n){F(e,t,r,n)}(t,e,f,h))),d.addAttachments.forEach((t=>I(t,e))),d.updateAttachments.forEach((t=>I(t,e))),l&&await async function(e,t){const{infoFor3D:r}=t;if(null==r)return;if(!(0,y.JQ)(r))throw new o.A(`${t.type}-layer:binary-gltf-asset-not-supported`,"3DObjectFeatureLayer requires binary glTF (.glb) support for updating mesh geometry.");e.addAssetFeatures??=[];const{addAssetFeatures:n}=e;for(const t of e.addFeatures??[])M(t)&&n.push(t);for(const t of e.updateFeatures??[])M(t)&&n.push(t)}(d,e),{edits:await v(d),options:p}}(e,r,n);return i.addFeatures?.length||i.updateFeatures?.length||i.deleteFeatures?.length||i.addAttachments?.length||i.updateAttachments?.length||i.deleteAttachments?.length?{edits:i,results:await t.applyEdits(i,u)}:{edits:i,results:{addFeatureResults:[],updateFeatureResults:[],deleteFeatureResults:[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}}(e,t,r,n),d=e=>e.filter((e=>!e.error)).map(i.o8),f={edits:p,addedFeatures:d(u.addFeatureResults),updatedFeatures:d(u.updateFeatureResults),deletedFeatures:d(u.deleteFeatureResults),addedAttachments:d(u.addAttachmentResults),updatedAttachments:d(u.updateAttachmentResults),deletedAttachments:d(u.deleteAttachmentResults),exceededTransferLimit:!1,historicMoment:u.editMoment?new Date(u.editMoment):null,globalIdToObjectId:n.globalIdToObjectId};return u.editedFeatureResults?.length&&(f.editedFeatures=u.editedFeatureResults),l.resolve(f),u}catch(e){throw l.reject(e),e}}function F(e,t,r,n){if(r){if("attributes"in e&&!e.attributes[t.globalIdField])throw new o.A(`${t.type}-layer:invalid-parameter`,`Feature should have '${t.globalIdField}' when 'globalIdUsed' is true`);if(!("attributes"in e)&&!e.globalId)throw new o.A(`${t.type}-layer:invalid-parameter`,"`'globalId' of the feature should be passed when 'globalIdUsed' is true")}if(n.length&&"attributes"in e)for(const r of n){const n=e.attributes[r.name];if(void 0!==n&&!(0,h.OG)(r,n))throw new o.A(`${t.type}-layer:invalid-parameter`,`Big-integer field '${r.name}' of the feature must be less than ${Number.MAX_SAFE_INTEGER}`,{feature:e})}if("geometry"in e&&null!=e.geometry){if(e.geometry.hasZ&&!1===t.capabilities?.data.supportsZ)throw new o.A(`${t.type}-layer:z-unsupported`,"Layer does not support z values while feature has z values.");if(e.geometry.hasM&&!1===t.capabilities?.data.supportsM)throw new o.A(`${t.type}-layer:m-unsupported`,"Layer does not support m values while feature has m values.")}}function x(e,t){if("geometry"in e&&"mesh"===e.geometry?.type&&null!=t.infoFor3D&&null!=t.spatialReference){const{geometry:r}=e,{spatialReference:n,vertexSpace:s}=r,i=t.spatialReference,a="local"===s.type,u=(0,d.EA)(i),l=(0,d.aI)(i,n),c=l||(0,d.oT)(i)&&((0,d.oT)(n)||(0,d.K8)(n));if(!(a&&u&&c||!a&&!u&&l))throw new o.A(`${t.type}-layer:mesh-unsupported`,`Uploading a mesh with a ${s.type} vertex space and a spatial reference wkid:${n.wkid} to a layer with a spatial reference wkid:${i.wkid} is not supported.`)}}function I(e,t){const{feature:r,attachment:n}=e;if(!r||"attributes"in r&&!r.attributes[t.globalIdField])throw new o.A(`${t.type}-layer:invalid-parameter`,"Attachment should have reference to a feature with 'globalId'");if(!("attributes"in r)&&!r.globalId)throw new o.A(`${t.type}-layer:invalid-parameter`,"Attachment should have reference to 'globalId' of the parent feature");if(!n.globalId)throw new o.A(`${t.type}-layer:invalid-parameter`,"Attachment should have 'globalId'");if(!n.data&&!n.uploadId)throw new o.A(`${t.type}-layer:invalid-parameter`,"Attachment should have 'data' or 'uploadId'");if(!(n.data instanceof File&&n.data.name||n.name))throw new o.A(`${t.type}-layer:invalid-parameter`,"'name' is required when attachment is specified as Base64 encoded string using 'data'");if(!t.capabilities?.editing.supportsUploadWithItemId&&n.uploadId)throw new o.A(`${t.type}-layer:invalid-parameter`,"This layer does not support 'uploadId' parameter. See: 'capabilities.editing.supportsUploadWithItemId'");if("string"==typeof n.data){const e=(0,l.r$)(n.data);if(e&&!e.isBase64)throw new o.A(`${t.type}-layer:invalid-parameter`,"Attachment 'data' should be a Blob, File or Base64 encoded string")}}async function v(e){const t=e.addFeatures??[],r=e.updateFeatures??[],n=t.concat(r).map((e=>e.geometry)),s=await(0,p.el)(n),o=t.length,i=r.length;return s.slice(0,o).forEach(((e,r)=>t[r].geometry=e)),s.slice(o,o+i).forEach(((e,t)=>r[t].geometry=e)),e}function R(e){const t=new n.default;return e.attributes||(e.attributes={}),t.geometry=e.geometry,t.attributes=e.attributes,t}function M(e){return"mesh"===e?.geometry?.type}function q(e,t,r,n){if(!m(t))throw new o.A(`${e.type}-layer:no-editing-support`,"Layer source does not support applyEdits capability",{layer:e});if(!t.uploadAssets)throw new o.A(`${e.type}-layer:no-asset-upload-support`,"Layer source does not support uploadAssets capability",{layer:e});return t.uploadAssets(r,n)}},58081:function(e,t,r){r.d(t,{B2:function(){return A},BW:function(){return G},Ch:function(){return se},DF:function(){return F},Di:function(){return Z},E2:function(){return L},IE:function(){return _},Nl:function(){return K},Q4:function(){return oe},Rk:function(){return ae},Ux:function(){return z},Ye:function(){return j},ZF:function(){return W},eU:function(){return U},eY:function(){return H},jH:function(){return Y},jQ:function(){return ne},kz:function(){return ee},oN:function(){return $},q3:function(){return X},qK:function(){return N},qN:function(){return E},z5:function(){return C},zv:function(){return J}});var n=r(39819),s=r(40633),o=r(95929),i=r(24761),a=r(87416),u=r(74697),l=r(65215),c=r(72887),p=r(76613);function d(e,t){return e?t?4:3:t?3:2}const f=()=>s.A.getLogger("esri.layers.graphics.featureConversionUtils"),h={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryMultiPatch:3,esriGeometryEnvelope:0},y=(e,t,r,n,s,o)=>{e[r]=s,e[r+1]=o},g=(e,t,r,n,s,o)=>{e[r]=s,e[r+1]=o,e[r+2]=t[n+2]},m=(e,t,r,n,s,o)=>{e[r]=s,e[r+1]=o,e[r+2]=t[n+3]},b=(e,t,r,n,s,o)=>{e[r]=s,e[r+1]=o,e[r+2]=t[n+2],e[r+3]=t[n+3]};function w(e,t,r,n){if(e){if(r)return t&&n?b:g;if(t&&n)return m}else if(t&&n)return g;return y}function _({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}function A({scale:e,translate:t},r){return Math.round((t[1]-r)/e[1])}function S({scale:e,translate:t},r,n){return r*e[n]+t[n]}function F(e,t,r){return e?t?r?T(e):v(e):r?M(e):x(e):null}function x(e){const t=e.coords;return{x:t[0],y:t[1]}}function I(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e}function v(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2]}}function R(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e}function M(e){const t=e.coords;return{x:t[0],y:t[1],m:t[2]}}function q(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.m,e}function T(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2],m:t[3]}}function O(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e.coords[3]=t.m,e}function k(e,t){return e&&t?O:e?R:t?q:I}function E(e,t,r=k(null!=t.z,null!=t.m)){return r(e,t)}function N(e,t,r){if(null==e)return null;const n=d(t,r),s=[];for(let t=0;t<e.coords.length;t+=n){const r=[];for(let s=0;s<n;s++)r.push(e.coords[t+s]);s.push(r)}return t?r?{points:s,hasZ:t,hasM:r}:{points:s,hasZ:t}:r?{points:s,hasM:r}:{points:s}}function P(e,t,r=d(t.hasZ,t.hasM)){e.lengths[0]=t.points.length;const n=e.coords;let s=0;for(const e of t.points)for(let t=0;t<r;t++)n[s++]=e[t];return e}function G(e,t,r){if(!e)return null;const n=d(t,r),{coords:s,lengths:o}=e,i=[];let a=0;for(const e of o){const t=[];for(let r=0;r<e;r++){const e=[];for(let t=0;t<n;t++)e.push(s[a++]);t.push(e)}i.push(t)}return t?r?{paths:i,hasZ:t,hasM:r}:{paths:i,hasZ:t}:r?{paths:i,hasM:r}:{paths:i}}function D(e,t,r=d(t.hasZ,t.hasM)){const{lengths:n,coords:s}=e;let o=0;for(const e of t.paths){for(const t of e)for(let e=0;e<r;e++)s[o++]=t[e];n.push(e.length)}return e}function C(e,t,r){if(!e)return null;const n=d(t,r),{coords:s,lengths:o}=e,i=[];let a=0;for(const e of o){const t=[];for(let r=0;r<e;r++){const e=[];for(let t=0;t<n;t++)e.push(s[a++]);t.push(e)}i.push(t)}return t?r?{rings:i,hasZ:t,hasM:r}:{rings:i,hasZ:t}:r?{rings:i,hasM:r}:{rings:i}}function j(e,t,r=t.hasZ,n=t.hasM){return U(e,t.rings,r,n)}function U(e,t,r,n){const s=d(r,n),{lengths:o,coords:i}=e;let a=0;ue(e);for(const e of t){for(const t of e)for(let e=0;e<s;e++)i[a++]=t[e];o.push(e.length)}return e}const V=[],B=[];function L(e,t,r,n,s){V[0]=e;const[o]=Z(B,V,t,r,n,s);return le(V),le(B),o}function Z(e,t,r,s,o,i){if(le(e),!r){for(const r of t){const t=i?r.attributes[i]:void 0;e.push(new l.Om(null,r.attributes,null,t))}return e}switch(r){case"esriGeometryPoint":return function(e,t,r,n,s){const o=k(r,n);for(const{geometry:r,attributes:n}of t){const t=null!=r?o(new p.A,r):null;e.push(new l.Om(t,n,null,s?n[s]:void 0))}return e}(e,t,s,o,i);case"esriGeometryMultipoint":return function(e,t,r,n,s){const o=d(r,n);for(const{geometry:r,attributes:n}of t){const t=null!=r?P(new p.A,r,o):null;e.push(new l.Om(t,n,null,s?n[s]:void 0))}return e}(e,t,s,o,i);case"esriGeometryPolyline":return function(e,t,r,n,s){const o=d(r,n);for(const{geometry:r,attributes:n,centroid:i}of t){const t=null!=r?D(new p.A,r,o):null,a=null!=i?E(new p.A,i):null;e.push(new l.Om(t,n,a,s?n[s]:void 0))}return e}(e,t,s,o,i);case"esriGeometryPolygon":case"esriGeometryMultiPatch":return function(e,t,r,n,s){for(const{geometry:o,centroid:i,attributes:a}of t){const t=null!=o?j(new p.A,o,r,n):null,u=s?a[s]:void 0;null!=i?e.push(new l.Om(t,a,I(new p.A,i),u)):e.push(new l.Om(t,a,null,u))}return e}(e,t,s,o,i);default:f().error("convertToFeatureSet:unknown-geometry",new n.A(`Unable to parse unknown geometry type '${r}'`)),le(e)}return e}function $(e,t,r,n){B[0]=e,Q(V,B,t,r,n);const s=V[0];return le(V),le(B),s}function z(e,t,r){if(null==e)return null;const s=new p.A;return"hasZ"in e&&null==t&&(t=e.hasZ),"hasM"in e&&null==r&&(r=e.hasM),(0,u.fT)(e)?k(null!=t?t:null!=e.z,null!=r?r:null!=e.m)(s,e):(0,u.Bi)(e)?j(s,e,t,r):(0,u.Rg)(e)?D(s,e,d(t,r)):(0,u.U9)(e)?P(s,e,d(t,r)):void f().error("convertFromGeometry:unknown-geometry",new n.A(`Unable to parse unknown geometry type '${e}'`))}function J(e,t,r,s){const o=e&&("coords"in e?e:e.geometry);if(null==o)return null;switch(t){case"esriGeometryPoint":{let e=x;return r&&s?e=T:r?e=v:s&&(e=M),e(o)}case"esriGeometryMultipoint":return N(o,r,s);case"esriGeometryPolyline":return G(o,r,s);case"esriGeometryPolygon":return C(o,r,s);default:return f().error("convertToGeometry:unknown-geometry",new n.A(`Unable to parse unknown geometry type '${t}'`)),null}}function Q(e,t,r,s,o){if(le(e),null==r)return function(e,t){for(const r of t)e.push({attributes:r.attributes});return e}(e,t);switch(r){case"esriGeometryPoint":return function(e,t,r,n){let s=x;r&&n?s=T:r?s=v:n&&(s=M);for(const r of t){const{geometry:t,attributes:n}=r,o=null!=t?s(t):null;e.push({attributes:n,geometry:o})}return e}(e,t,s,o);case"esriGeometryMultipoint":return function(e,t,r,n){for(const{geometry:s,attributes:o}of t)e.push({attributes:o,geometry:null!=s?N(s,r,n):null});return e}(e,t,s,o);case"esriGeometryPolyline":return function(e,t,r,n){for(const{geometry:s,attributes:o}of t)e.push({attributes:o,geometry:null!=s?G(s,r,n):null});return e}(e,t,s,o);case"esriGeometryPolygon":return function(e,t,r,n){for(const{geometry:s,attributes:o,centroid:i}of t){const t=null!=s?C(s,r,n):null;if(null!=i){const r=x(i);e.push({attributes:o,centroid:r,geometry:t})}else e.push({attributes:o,geometry:t})}return e}(e,t,s,o);default:f().error("convertToFeatureSet:unknown-geometry",new n.A(`Unable to parse unknown geometry type '${r}'`))}return e}function W(e){const{objectIdFieldName:t,spatialReference:r,transform:n,fields:s,hasM:o,hasZ:i,features:a,geometryType:u,exceededTransferLimit:l,uniqueIdField:c,queryGeometry:p,queryGeometryType:d}=e,f={features:Q([],a,u,i,o),fields:s,geometryType:u,objectIdFieldName:t,spatialReference:r,uniqueIdField:c,queryGeometry:J(p,d,!1,!1)};return n&&(f.transform=n),l&&(f.exceededTransferLimit=l),o&&(f.hasM=o),i&&(f.hasZ=i),f}function X(e,t){const r=new c.A,{hasM:s,hasZ:o,features:i,objectIdFieldName:a,spatialReference:u,geometryType:l,exceededTransferLimit:p,transform:d,fields:h}=e;return h&&(r.fields=h),r.geometryType=l??null,r.objectIdFieldName=a??t??null,r.spatialReference=u??null,r.objectIdFieldName?(i&&Z(r.features,i,l,o,s,r.objectIdFieldName),p&&(r.exceededTransferLimit=p),s&&(r.hasM=s),o&&(r.hasZ=o),d&&(r.transform=d),r):(f().error(new n.A("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),r)}function H(e){const{transform:t,features:r,hasM:n,hasZ:s}=e;if(!t)return e;for(const e of r)null!=e.geometry&&se(e.geometry,e.geometry,n,s,t),null!=e.centroid&&se(e.centroid,e.centroid,n,s,t);return e.transform=null,e}function Y(e,t){const{geometryType:r,features:n,hasM:s,hasZ:o}=t;if(!e)return t;for(let t=0;t<n.length;t++){const i=n[t],a=i.weakClone();a.geometry=new p.A,K(a.geometry,i.geometry,s,o,r,e),i.centroid&&(a.centroid=new p.A,K(a.centroid,i.centroid,s,o,"esriGeometryPoint",e)),n[t]=a}return t.transform=e,t}function K(e,t,r,n,s,o,i=r,a=n){if(ue(e),!t?.coords.length)return null;const u=h[s],{coords:l,lengths:c}=t,p=d(r,n),f=d(r&&i,n&&a),y=w(r,n,i,a);if(!c.length)return y(e.coords,l,0,0,_(o,l[0]),A(o,l[1])),ue(e,p,0),e;let g,m,b,S,F=0,x=0,I=x;for(const t of c){if(t<u)continue;let r=0;x=I,b=g=_(o,l[F]),S=m=A(o,l[F+1]),y(e.coords,l,x,F,b,S),r++,F+=p,x+=f;for(let n=1;n<t;n++,F+=p)b=_(o,l[F]),S=A(o,l[F+1]),b===g&&S===m||(y(e.coords,l,x,F,b-g,S-m),x+=f,r++,g=b,m=S);r>=u&&(e.lengths.push(r),I=x)}return le(e.coords,I),e.coords.length?e:null}function ee(e,t,r,n,s,o,i=r,a=n){if(ue(e),!t?.coords.length)return null;const u=h[s],{coords:l,lengths:c}=t,p=d(r,n),f=d(r&&i,n&&a),y=w(r,n,i,a);if(!c.length)return y(e.coords,l,0,0,l[0],l[1]),ue(e,p,0),e;let g=0;const m=o*o;for(const t of c){if(t<u){g+=t*p;continue}const r=e.coords.length/f,n=g,s=g+(t-1)*p;y(e.coords,l,e.coords.length,n,l[n],l[n+1]),re(e.coords,l,p,m,y,n,s),y(e.coords,l,e.coords.length,s,l[s],l[s+1]);const o=e.coords.length/f-r;o>=u?e.lengths.push(o):le(e.coords,r*f),g+=t*p}return e.coords.length?e:null}function te(e,t,r,n){const s=e[t],o=e[t+1],i=e[r],a=e[r+1],u=e[n],l=e[n+1];let c=i,p=a,d=u-c,f=l-p;if(0!==d||0!==f){const e=((s-c)*d+(o-p)*f)/(d*d+f*f);e>1?(c=u,p=l):e>0&&(c+=d*e,p+=f*e)}return d=s-c,f=o-p,d*d+f*f}function re(e,t,r,n,s,o,i){let a,u=n,l=0;for(let e=o+r;e<i;e+=r)a=te(t,e,o,i),a>u&&(l=e,u=a);u>n&&(l-o>r&&re(e,t,r,n,s,o,l),s(e,t,e.length,l,t[l],t[l+1]),i-l>r&&re(e,t,r,n,s,l,i))}function ne(e,t,r,n){if(!t?.coords?.length)return null;const s=d(r,n);let o=Number.POSITIVE_INFINITY,u=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY,c=Number.NEGATIVE_INFINITY;if(t&&t.coords){const e=t.coords;for(let t=0;t<e.length;t+=s){const r=e[t],n=e[t+1];o=Math.min(o,r),l=Math.max(l,r),u=Math.min(u,n),c=Math.max(c,n)}}return(0,i.is)(e)?(0,i.BI)(e,o,u,l,c):(0,a.fA)(o,u,l,c,e),e}function se(e,t,r,n,s){const{coords:i,lengths:a}=t,u=d(r,n);if(!i.length)return e!==t&&ue(e),e;(0,o.Lw)(s);const{originPosition:l,scale:c,translate:p}=s,f=ce;f.originPosition=l;const h=f.scale;h[0]=c[0]??1,h[1]=-(c[1]??1),h[2]=c[2]??1,h[3]=c[3]??1;const y=f.translate;if(y[0]=p[0]??0,y[1]=p[1]??0,y[2]=p[2]??0,y[3]=p[3]??0,!a.length){for(let t=0;t<u;++t)e.coords[t]=S(f,i[t],t);return e!==t&&ue(e,u,0),e}let g=0;for(let t=0;t<a.length;t++){const r=a[t];e.lengths[t]=r;for(let t=0;t<u;++t)e.coords[g+t]=S(f,i[g+t],t);let n=e.coords[g],s=e.coords[g+1];g+=u;for(let t=1;t<r;t++,g+=u){n+=i[g]*h[0],s+=i[g+1]*h[1],e.coords[g]=n,e.coords[g+1]=s;for(let t=2;t<u;++t)e.coords[g+t]=S(f,i[g+t],t)}}return e!==t&&ue(e,i.length,a.length),e}function oe(e,t,r,n,s,o){if(ue(e),e.lengths.push(...t.lengths),r===s&&n===o)for(let r=0;r<t.coords.length;r++)e.coords.push(t.coords[r]);else{const i=d(r,n),a=w(r,n,s,o),u=t.coords;for(let t=0;t<u.length;t+=i)a(e.coords,u,e.coords.length,t,u[t],u[t+1])}return e}function ie(e,t,r,n){let s=0,o=e[n*t],i=e[n*(t+1)];for(let a=1;a<r;a++){const r=o+e[n*(t+a)],u=i+e[n*(t+a)+1],l=(r-o)*(u+i);o=r,i=u,s+=l}return.5*s}function ae(e,t){const{coords:r,lengths:n}=e;let s=0,o=0;for(let e=0;e<n.length;e++){const i=n[e];o+=ie(r,s,i,t),s+=i}return Math.abs(o)}function ue(e,t=0,r=0){le(e.lengths,r),le(e.coords,t)}function le(e,t=0){e.length!==t&&(e.length=t)}const ce={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]}},72978:function(e,t,r){r.r(t),r.d(t,{default:function(){return H}});var n=r(53804),s=r(25591),o=(r(50917),r(93040)),i=r(50659),a=r(39819),u=r(58941),l=r(73037),c=r(31609),p=r(40633),d=r(34194),f=r(60539),h=r(28181),y=r(90683),g=r(66110),m=r(23502),b=r(65953),w=r(91484),_=r(65907),A=r(67376),S=r(23572),F=r(59469),x=r(62938),I=r(46157),v=r(74697),R=r(36405),M=r(57652),q=r(30269);async function T(e,t,r){const{geometry:n}=t,s={...t.attributes};if(null!=r&&"mesh"===n?.type){const{transformFieldRoles:t}=r,{origin:o,spatialReference:i,vertexSpace:a}=n,u=n.transform??new R.A,l="local"===a.type,c=e.spatialReference,p=c.isGeographic,d=(0,M.aI)(c,i),f=(0,I.isEqualBaseGCS)(i,c)&&(0,I.canProjectWithoutEngine)(i,c);if(!(l&&p&&f||!l&&!p&&d))return null;const h=(0,I.projectWithoutEngine)(o,i,c);if(null==h)return null;if(s[t.originX]=h.x,s[t.originY]=h.y,s[t.originZ]=h.z??0,null!=u){const{translation:e,scale:r,rotation:n}=u,o=l?1:(0,x.KX)(i)/(0,x.KX)(c);s[t.translationX]=e[0]*o,s[t.translationY]=e[2]*o,s[t.translationZ]=-e[1]*o,s[t.scaleX]=r[0],s[t.scaleY]=r[2],s[t.scaleZ]=r[1],s[t.rotationX]=n[0],s[t.rotationY]=n[2],s[t.rotationZ]=-n[1],s[t.rotationDeg]=n[3]}return{attributes:s}}return null==n?{attributes:s}:"mesh"===n.type||"extent"===n.type?null:{geometry:n.toJSON(),attributes:s}}async function O(e,t){const r=await Promise.all((t.addAttachments??[]).map((t=>k(e,t)))),n=await Promise.all((t.updateAttachments??[]).map((t=>k(e,t)))),s=t.deleteAttachments??[];return r.length||n.length||s.length?{adds:r,updates:n,deletes:[...s]}:null}async function k(e,t){const{feature:r,attachment:n}=t,{globalId:s,name:o,contentType:i,data:a,uploadId:u}=n,l={globalId:s};if(r&&("attributes"in r?l.parentGlobalId=r.attributes?.[e.globalIdField]:r.globalId&&(l.parentGlobalId=r.globalId)),u)l.uploadId=u;else if(a){const e=await(0,y._0)(a);e&&(l.contentType=e.mediaType,l.data=e.data),a instanceof File&&(l.name=a.name)}return o&&(l.name=o),i&&(l.contentType=i),l}function E(e){const t=!0===e.success?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:t?new a.A("feature-layer-source:edit-failure",t.description,{code:t.code}):null}}function N(e,t){return new F.default({attributes:e.attributes,geometry:(0,v.rS)({...e.geometry,spatialReference:t})})}function P(e,t){return{adds:e?.adds?.map((e=>N(e,t)))||[],updates:e?.updates?.map((e=>({original:N(e[0],t),current:N(e[1],t)})))||[],deletes:e?.deletes?.map((e=>N(e,t)))||[],spatialReference:t}}var G=r(69619),D=r(79013),C=r(93389),j=r(23217),U=r(66228),V=r(94072),B=r(87295),L=r(7926),Z=r(52038),$=r(30193),z=r(57165);const J=new l.J({originalAndCurrentFeatures:"original-and-current-features",none:"none"}),Q=new l.J({Started:"published",Publishing:"publishing",Stopped:"unavailable"});let W=class extends c.A{constructor(e){super(e),this.type="feature-layer",this.supportedSourceTypes=new Set(["Feature Layer","Oriented Imagery Layer","Table","Catalog Layer"]),this.refresh=(0,f.sg)((async()=>{await this.load();const e=this.sourceJSON.editingInfo?.lastEditDate;if(null==e)return{dataChanged:!0,updates:{}};try{await this._fetchService(null)}catch{return{dataChanged:!0,updates:{}}}const t=e!==this.sourceJSON.editingInfo?.lastEditDate;return{dataChanged:t,updates:t?{editingInfo:this.sourceJSON.editingInfo,extent:this.sourceJSON.extent}:null}})),this._ongoingAssetUploads=new Map}load(e){const t=this.layer.sourceJSON,r=this._fetchService(t,{...e}).then((()=>this.layer.setUserPrivileges(this.sourceJSON.serviceItemId,e))).then((()=>this._ensureLatestMetadata(e)));return this.addResolvingPromise(r),Promise.resolve(this)}initialize(){this.addHandles([(0,h.watch)((()=>{const e=this.layer;return e&&"lastEditsEventDate"in e?e.lastEditsEventDate:null}),(e=>this._handleLastEditsEventChange(e)))])}destroy(){this._removeEditInterceptor()}get queryTask(){const{capabilities:e,parsedUrl:t,gdbVersion:r,spatialReference:n,fieldsIndex:s}=this.layer,o="infoFor3D"in this.layer?this.layer.infoFor3D:null,i="dynamicDataSource"in this.layer?this.layer.dynamicDataSource:null,a=(0,u.A)("featurelayer-pbf")&&e?.query.supportsFormatPBF&&null==o,l=e?.operations?.supportsQueryAttachments??!1;return new D.A({url:t.path,pbfSupported:a,fieldsIndex:s,infoFor3D:o,dynamicDataSource:i,gdbVersion:r,sourceSpatialReference:n,queryAttachmentsSupported:l})}async addAttachment(e,t){await this.load();const{layer:r}=this;await(0,j.VA)(r,"editing");const n=e.attributes[r.objectIdField],s=r.parsedUrl.path+"/"+n+"/addAttachment",i=this._getLayerRequestOptions(),a=this._getFormDataForAttachment(t,i.query);try{return E((await(0,o.A)(s,{body:a})).data.addAttachmentResult)}catch(e){throw this._createAttachmentErrorResult(n,e)}}async updateAttachment(e,t,r){await this.load();const{layer:n}=this;await(0,j.VA)(n,"editing");const s=e.attributes[n.objectIdField],i=n.parsedUrl.path+"/"+s+"/updateAttachment",a=this._getLayerRequestOptions({query:{attachmentId:t}}),u=this._getFormDataForAttachment(r,a.query);try{return E((await(0,o.A)(i,{body:u})).data.updateAttachmentResult)}catch(e){throw this._createAttachmentErrorResult(s,e)}}async applyEdits(e,t){await this.load();const{layer:r}=this;await(0,j.VA)(r,"editing");const n="infoFor3D"in r?r.infoFor3D:null,s=null!=n,u=s||(t?.globalIdUsed??!1),l=s?await this._uploadMeshesAndGetAssetMapEditsJSON(e):null,c=e.addFeatures?.map((e=>T(this.layer,e,n)))??[],p=(await Promise.all(c)).filter(i.Ru),d=e.updateFeatures?.map((e=>T(this.layer,e,n)))??[],f=(await Promise.all(d)).filter(i.Ru),h=function(e,t,r){if(!t||0===t.length)return[];if(r&&(0,q.zp)(t))return t.map((e=>e.globalId));if((0,q.r3)(t))return t.map((e=>e.objectId));const n=r?e.globalIdField:e.objectIdField;return n?t.map((e=>e.getAttribute(n))):[]}(this.layer,e.deleteFeatures,u);(0,B.u)(p,f,r.spatialReference);const y=await O(this.layer,e),g=r.capabilities.editing.supportsAsyncApplyEdits&&s,m=t?.gdbVersion||r.gdbVersion,b={gdbVersion:m,rollbackOnFailure:t?.rollbackOnFailureEnabled,useGlobalIds:u,returnEditMoment:t?.returnEditMoment,usePreviousEditMoment:t?.usePreviousEditMoment,async:g};await(0,$.ZJ)(this.layer.url,m,!0);const w=(0,$.w5)(this.layer.url,m||null);if(await(0,$.We)(r.url,m,r.historicMoment))throw new a.A("feature-layer-source:historic-version","Editing a historic version is not allowed");t?.returnServiceEditsOption?(b.edits=JSON.stringify([{id:r.layerId,adds:p.length?p:null,updates:f.length?f:null,deletes:h.length?h:null,attachments:y,assetMaps:l}]),b.returnServiceEditsOption=J.toJSON(t?.returnServiceEditsOption),b.returnServiceEditsInSourceSR=t?.returnServiceEditsInSourceSR):(b.adds=p.length?JSON.stringify(p):null,b.updates=f.length?JSON.stringify(f):null,b.deletes=h.length?u?JSON.stringify(h):h.join(","):null,b.attachments=y&&JSON.stringify(y),b.assetMaps=null!=l?JSON.stringify(l):void 0);const _=this._getLayerRequestOptions({method:"post",query:b});w&&(_.authMode="immediate",_.query.returnEditMoment=!0,_.query.sessionId=$.TA);const A=t?.returnServiceEditsOption?r.url:r.parsedUrl.path;let S;try{S=g?await this._asyncApplyEdits(A+"/applyEdits",_):await(0,o.A)(A+"/applyEdits",_)}catch(e){if(!function(e){const t=e.details.raw,r=+t.code,n=+t.extendedCode;return 500===r&&(-2147217144===n||-2147467261===n)}(e))throw e;_.authMode="immediate",S=g?await this._asyncApplyEdits(A+"/applyEdits",_):await(0,o.A)(A+"/applyEdits",_)}return this._createEditsResult(S)}async deleteAttachments(e,t){await this.load();const{layer:r}=this;await(0,j.VA)(r,"editing");const n=e.attributes[r.objectIdField],s=r.parsedUrl.path+"/"+n+"/deleteAttachments";try{return(await(0,o.A)(s,this._getLayerRequestOptions({query:{attachmentIds:t.join(",")},method:"post"}))).data.deleteAttachmentResults.map(E)}catch(e){throw this._createAttachmentErrorResult(n,e)}}fetchRecomputedExtents(e={}){const t=e.signal;return this.load({signal:t}).then((async()=>{const t=this._getLayerRequestOptions({...e,query:{returnUpdates:!0}}),{layerId:r,url:n}=this.layer,{data:s}=await(0,o.A)(`${n}/${r}`,t),{id:i,extent:a,fullExtent:u,timeExtent:l}=s,c=a||u;return{id:i,fullExtent:c&&w.default.fromJSON(c),timeExtent:l&&Z.A.fromJSON({start:l[0],end:l[1]})}}))}async queryAttachments(e,t={}){await this.load();const r=this._getLayerRequestOptions(t);return this.queryTask.executeAttachmentQuery(e,r)}async queryFeatures(e,t){await this.load();const r=await this.queryTask.execute(e,{...t,query:this._createRequestQueryOptions(t)});return e.outStatistics?.length&&r.features.length&&r.features.forEach((t=>{const r=t.attributes;e.outStatistics?.forEach((({outStatisticFieldName:e})=>{if(e){const t=e.toLowerCase();t&&t in r&&e!==t&&(r[e]=r[t],delete r[t])}}))})),r}async queryFeaturesJSON(e,t){return await this.load(),this.queryTask.executeJSON(e,{...t,query:this._createRequestQueryOptions(t)})}async queryObjectIds(e,t){return await this.load(),this.queryTask.executeForIds(e,{...t,query:this._createRequestQueryOptions(t)})}async queryFeatureCount(e,t){return await this.load(),this.queryTask.executeForCount(e,{...t,query:this._createRequestQueryOptions(t)})}async queryExtent(e,t){return await this.load(),this.queryTask.executeForExtent(e,{...t,query:this._createRequestQueryOptions(t)})}async queryRelatedFeatures(e,t){return await this.load(),this.queryTask.executeRelationshipQuery(e,{...t,query:this._createRequestQueryOptions(t)})}async queryRelatedFeaturesCount(e,t){return await this.load(),this.queryTask.executeRelationshipQueryForCount(e,{...t,query:this._createRequestQueryOptions(t)})}async queryTopFeatures(e,t){return await this.load(),this.queryTask.executeTopFeaturesQuery(e,{...t,query:this._createRequestQueryOptions(t)})}async queryBins(e,t){return await this.load(),this.queryTask.executeBinsQuery(e,{...t,query:this._createRequestQueryOptions(t)})}async queryTopObjectIds(e,t){return await this.load(),this.queryTask.executeForTopIds(e,{...t,query:this._createRequestQueryOptions(t)})}async queryTopExtents(e,t){return await this.load(),this.queryTask.executeForTopExtents(e,{...t,query:this._createRequestQueryOptions(t)})}async queryTopCount(e,t){return await this.load(),this.queryTask.executeForTopCount(e,{...t,query:this._createRequestQueryOptions(t)})}async fetchPublishingStatus(){if(!(0,C.Wo)(this.layer.url))return"unavailable";const e=(0,y.fj)(this.layer.url,"status"),t=await(0,o.A)(e,{query:{f:"json"}});return Q.fromJSON(t.data.status)}async uploadAssets(e,t){const{uploadAssets:n}=await r.e(9933).then(r.bind(r,71783));return n(e,{layer:this.layer,ongoingUploads:this._ongoingAssetUploads},t)}_handleLastEditsEventChange(e){const t=this.layer;if(null==e||!("capabilities"in t)||!("effectiveCapabilities"in t))return;if(t.capabilities?.operations?.supportsEditing||!t.effectiveCapabilities?.operations?.supportsEditing)return;const r=t.url;null!=r&&("layerId"in t&&(0,y.fj)(r,t.layerId.toString()),this._getOrCreateEditInterceptor(r).before=t=>{const r=t.requestOptions.method??"auto";if("auto"===r||"head"===r){const r=t.requestOptions.query??{};r._ts=e.getTime(),t.requestOptions.query=r}})}_getOrCreateEditInterceptor(e){return null==this._editInterceptor&&(this._editInterceptor={urls:e},s.default.request.internalInterceptors.push(this._editInterceptor)),this._editInterceptor}_removeEditInterceptor(){null!=this._editInterceptor&&((0,i.TF)(s.default.request.internalInterceptors,this._editInterceptor),this._editInterceptor=null)}async _asyncApplyEdits(e,t){const r=(await(0,o.A)(e,t)).data.statusUrl;for(;;){const e=(await(0,o.A)(r,{query:{f:"json"},responseType:"json"})).data;switch(e.status){case"Completed":return(0,o.A)(e.resultUrl,{query:{f:"json"},responseType:"json"});case"CompletedWithErrors":throw new a.A("async-applyEdits-failed","asynchronous applyEdits call failed.");case"Failed ImportChanges":case"InProgress":case"Pending":case"ExportAttachments":case"ExportChanges":case"ExportingData":case"ExportingSnapshot":case"ImportAttachments":case"ProvisioningReplica":case"UnRegisteringReplica":break;default:throw new a.A("async-applyEdits-failed","asynchronous applyEdits call failed (undefined response status)")}await(0,f.Pl)(X)}}_createRequestQueryOptions(e){const t={...this.layer.customParameters,token:this.layer.apiKey,...e?.query};return this.layer.datesInUnknownTimezone&&(t.timeReferenceUnknownClient=!0),t}async _fetchService(e,t){if(!e){const r={};(0,u.A)("featurelayer-advanced-symbols")&&(r.returnAdvancedSymbols=!0),t?.cacheBust&&(r._ts=Date.now());const{data:n}=await(0,o.A)(this.layer.parsedUrl.path,this._getLayerRequestOptions({query:r,signal:t?.signal}));e=n}this.sourceJSON=await this._patchServiceJSON(e,t?.signal);const r=e.type;if(!this.supportedSourceTypes.has(r))throw new a.A("feature-layer-source:unsupported-type",`Source type "${r}" is not supported`)}async _patchServiceJSON(e,t){if("Table"!==e.type&&e.geometryType&&!e?.drawingInfo?.renderer&&!e.defaultSymbol){const t=(0,G.F0)(e.geometryType).renderer;(0,d.sM)("drawingInfo.renderer",t,e)}if("esriGeometryMultiPatch"===e.geometryType&&e.infoFor3D&&(e.geometryType="mesh"),null==e.extent)try{const{data:r}=await(0,o.A)(this.layer.url,this._getLayerRequestOptions({signal:t}));r.spatialReference&&(e.extent={xmin:0,ymin:0,xmax:0,ymax:0,spatialReference:r.spatialReference})}catch(e){(0,f.QP)(e)}return e}async _ensureLatestMetadata(e){if(this.layer.userHasUpdateItemPrivileges&&this.sourceJSON.cacheMaxAge>0)return this._fetchService(null,{...e,cacheBust:!0})}async _uploadMeshesAndGetAssetMapEditsJSON(e){const{addAssetFeatures:t}=e;if(!t?.length)return null;if(await this._areAllAssetsAlreadyMapped(t))return null;const n=e.addFeatures.filter((e=>e.geometry));if(t.length!==n.length+e.updateFeatures.length)throw new a.A("feature-layer-source:unsupported-mesh-edits","Mixing attribute only edits with mesh geometry edits is not currently supported");const s=new Array,o=new Map;for(const e of t){const{geometry:t}=e,{vertexSpace:n}=t;if((0,A.Hq)(n))s.push(t);else{const n=t.origin,{convertMeshVertexSpace:i}=await r.e(2659).then(r.bind(r,1993)),a=await i(t,new _.A({origin:[n.x,n.y,n.z??0]}));o.set(a,t),e.geometry=a,s.push(a)}}await this.uploadAssets(s);for(const[e,t]of o)t.addExternalSources(e.metadata.externalSources.items);return{adds:this._getAssetMapEditsJSON(t),updates:[],deletes:[]}}_getAssetMapEditsJSON(e){const t=new Array,r=this.layer.globalIdField,n=this.layer.parsedUrl;for(const s of e){const e=s.geometry,{metadata:o}=e,i=o.getExternalSourcesOnService(n),a=s.getAttribute(r);if(0===i.length){p.A.getLogger(this).error(`Skipping feature ${a}. The mesh it is associated with has not been uploaded to the service and cannot be mapped to it.`);continue}const{source:u}=i.find(S.dK)??i[0];for(const e of u)1===e.parts.length?t.push({globalId:(0,g.yS)(),parentGlobalId:a,assetName:e.assetName,assetHash:e.parts[0].partHash,flags:[]}):p.A.getLogger(this).error(`Skipping asset ${e.assetName}. It does not have exactly one part, so we cannot map it to a feature.`)}return t}_createEditsResult(e){const t=e.data,{layerId:r}=this.layer,n=[];let s=null;if(Array.isArray(t))for(const e of t)n.push({id:e.id,editedFeatures:e.editedFeatures}),e.id===r&&(s={addResults:e.addResults??[],updateResults:e.updateResults??[],deleteResults:e.deleteResults??[],attachments:e.attachments,editMoment:e.editMoment});else s=t;const o=function(e){const t=e?.assetMaps;if(t){for(const e of t.addResults)e.success||p.A.getLogger("esri.layers.graphics.sources.support.sourceUtils").error(`Failed to map asset to feature with globalId ${e.globalId}.`);for(const e of t.updateResults)e.success||p.A.getLogger("esri.layers.graphics.sources.support.sourceUtils").error(`Failed to map asset to feature with globalId ${e.globalId}.`)}const r=e?.attachments,n={addFeatureResults:e?.addResults?.map(E)??[],updateFeatureResults:e?.updateResults?.map(E)??[],deleteFeatureResults:e?.deleteResults?.map(E)??[],addAttachmentResults:r?.addResults?r.addResults.map(E):[],updateAttachmentResults:r?.updateResults?r.updateResults.map(E):[],deleteAttachmentResults:r?.deleteResults?r.deleteResults.map(E):[]};return e?.editMoment&&(n.editMoment=e.editMoment),n}(s);if(n.length>0){o.editedFeatureResults=[];for(const e of n){const{editedFeatures:t}=e,r=t?.spatialReference?new z.A(t.spatialReference):null;o.editedFeatureResults.push({layerId:e.id,editedFeatures:P(t,r)})}}return o}_createAttachmentErrorResult(e,t){const r=t.details.messages?.[0]||t.message,n=t.details.httpStatus||t.details.messageCode;return{objectId:e,globalId:null,error:new a.A("feature-layer-source:attachment-failure",r,{code:n})}}_getFormDataForAttachment(e,t){const r=e instanceof FormData?e:e&&e.elements?new FormData(e):null;if(r)for(const e in t){const n=t[e];null!=n&&(r.set?r.set(e,n):r.append(e,n))}return r}_getLayerRequestOptions(e={}){const{layer:t,layer:{parsedUrl:r,gdbVersion:n}}=this;return{...e,query:{gdbVersion:n,layer:"dynamicDataSource"in t&&t.dynamicDataSource?JSON.stringify({source:t.dynamicDataSource}):void 0,...r.query,f:"json",...this._createRequestQueryOptions(e)},responseType:"json"}}async _areAllAssetsAlreadyMapped(e){const{layer:t}=this,{globalIdField:r,parsedUrl:n}=t,s="infoFor3D"in t?t.infoFor3D:null;if(null==s||null==r)return!1;const o=(0,U.JZ)(s);if(null==o)return!1;const a=(0,y.fj)(n.path,`../${o.id}`),u=new Array;for(const t of e){if(!(t.geometry.metadata.getExternalSourcesOnService(n).length>0))return!1;u.push(t)}const l=u.map((e=>e.getAttribute(r))).filter(i.Ru);if(0===l.length)return!1;const{assetMapFieldRoles:{parentGlobalId:c,assetHash:p}}=s,d=new L.A({where:`${c} IN (${l.map((e=>`'${e}'`))})`,outFields:[p,c],returnGeometry:!1}),f=await(0,V.s)(a,d),{features:h}=f;return 0!==h.length&&!u.some((e=>{const t=e.getAttribute(r);if(!t)return!0;const{metadata:s}=e.geometry,o=h.filter((e=>e.getAttribute(c)===t));if(0===o.length)return!0;const i=o.map((e=>e.getAttribute(p)));return s.getExternalSourcesOnService(n).flatMap((({source:e})=>e.flatMap((e=>e.parts.map((e=>e.partHash)))))).some((e=>i.every((t=>e!==t))))}))}};(0,n._)([(0,m.MZ)()],W.prototype,"type",void 0),(0,n._)([(0,m.MZ)({constructOnly:!0})],W.prototype,"layer",void 0),(0,n._)([(0,m.MZ)({constructOnly:!0})],W.prototype,"supportedSourceTypes",void 0),(0,n._)([(0,m.MZ)({readOnly:!0})],W.prototype,"queryTask",null),W=(0,n._)([(0,b.$)("esri.layers.graphics.sources.FeatureLayerSource")],W);const X=1e3,H=W},79013:function(e,t,r){r.d(t,{A:function(){return E}});var n=r(53804),s=r(83525),o=r(39819),i=r(58941),a=r(60539),u=r(90683),l=r(23502),c=(r(40633),r(13798),r(65953)),p=r(57652),d=r(66228),f=r(66866),h=r(39397),y=r(48066),g=(r(50917),r(90066)),m=r(7926),b=r(91484),w=r(30067),_=r(94072),A=r(95929),S=r(6996),F=r(58081);function x(e,t){return t}function I(e,t,r,n){switch(r){case 0:return q(e,t+n,0);case 1:return"lowerLeft"===e.originPosition?q(e,t+n,1):function({translate:e,scale:t},r,n){return e[n]-r*t[n]}(e,t+n,1)}}function v(e,t,r,n){return 2===r?q(e,t,2):I(e,t,r,n)}function R(e,t,r,n){return 2===r?0===t?0:q(e,t,3):I(e,t,r,n)}function M(e,t,r,n){return 3===r?0===t?0:q(e,t,3):v(e,t,r,n)}function q({translate:e,scale:t},r,n){return e[n]+r*t[n]}class T{constructor(e){this._options=e,this.geometryTypes=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"],this._previousCoordinate=[0,0],this._transform=null,this._applyTransform=x,this._lengths=[],this._currentLengthIndex=0,this._toAddInCurrentPath=0,this._vertexDimension=0,this._mValueOffset=null,this._coordinateBuffer=null,this._coordinateBufferPtr=0,this._attributesConstructor=class{}}createFeatureResult(){return{fields:[],features:[]}}finishFeatureResult(e){if(this._options.applyTransform&&(e.transform=null),this._attributesConstructor=class{},this._coordinateBuffer=null,this._lengths.length=0,!e.hasZ)return;const t=(0,S.N)(e.geometryType,this._options.sourceSpatialReference,e.spatialReference);if(null!=t)for(const r of e.features)t(r.geometry)}createSpatialReference(){return{}}addField(e,t){const r=e.fields;(0,A.Lw)(r),r.push(t);const n=r.map((e=>e.name));this._attributesConstructor=function(){for(const e of n)this[e]=null}}addFeature(e,t){e.features.push(t)}prepareFeatures(e){switch(this._transform=e.transform,this._options.applyTransform&&e.transform&&(this._applyTransform=this._deriveApplyTransform(e)),this._mValueOffset=null,this._vertexDimension=2,e.hasZ&&this._vertexDimension++,e.hasM&&(this._mValueOffset=this._vertexDimension,this._vertexDimension++),e.geometryType){case"esriGeometryPoint":this.addCoordinate=(e,t,r)=>this.addCoordinatePoint(e,t,r),this.createGeometry=e=>this.createPointGeometry(e);break;case"esriGeometryPolygon":this.addCoordinate=(e,t,r)=>this._addCoordinatePolygon(e,t,r),this.createGeometry=e=>this._createPolygonGeometry(e);break;case"esriGeometryPolyline":this.addCoordinate=(e,t,r)=>this._addCoordinatePolyline(e,t,r),this.createGeometry=e=>this._createPolylineGeometry(e);break;case"esriGeometryMultipoint":this.addCoordinate=(e,t,r)=>this._addCoordinateMultipoint(e,t,r),this.createGeometry=e=>this._createMultipointGeometry(e)}}createFeature(){return this._lengths.length=0,this._currentLengthIndex=0,this._previousCoordinate[0]=0,this._previousCoordinate[1]=0,this._coordinateBuffer=null,this._coordinateBufferPtr=0,{attributes:new this._attributesConstructor}}allocateCoordinates(){}addLength(e,t,r){0===this._lengths.length&&(this._toAddInCurrentPath=t),this._lengths.push(t)}addQueryGeometry(e,t){const{queryGeometry:r,queryGeometryType:n}=t,s=(0,F.Ch)(r.clone(),r,!1,!1,this._transform),o=(0,F.zv)(s,n,!1,!1);e.queryGeometryType=n,e.queryGeometry={...o}}createPointGeometry(e){const t={x:0,y:0,spatialReference:e.spatialReference};return e.hasZ&&(t.z=0),e.hasM&&(t.m=0),t}addCoordinatePoint(e,t,r){const n=this._transform;switch(t=this._applyTransform(n,t,r,0),r){case 0:e.x=t;break;case 1:e.y=t;break;case 2:"z"in e?e.z=t:e.m=t;break;case 3:e.m=t}}_transformPathLikeValue(e,t){let r=0;t<=1&&(r=this._previousCoordinate[t],this._previousCoordinate[t]+=e);const n=this._transform;return null!==this._mValueOffset&&0===e&&t>0&&!(t%this._mValueOffset)?0:this._applyTransform(n,e,t,r)}_addCoordinatePolyline(e,t,r){this._dehydratedAddPointsCoordinate(e.paths,t,r)}_addCoordinatePolygon(e,t,r){this._dehydratedAddPointsCoordinate(e.rings,t,r)}_addCoordinateMultipoint(e,t,r){0===r&&e.points.push([]);const n=this._transformPathLikeValue(t,r);e.points[e.points.length-1].push(n)}_createPolygonGeometry(e){return{rings:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}_createPolylineGeometry(e){return{paths:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}_createMultipointGeometry(e){return{points:[],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}_dehydratedAddPointsCoordinate(e,t,r){0===r&&0==this._toAddInCurrentPath--&&(e.push([]),this._toAddInCurrentPath=this._lengths[++this._currentLengthIndex]-1,this._previousCoordinate[0]=0,this._previousCoordinate[1]=0);const n=this._transformPathLikeValue(t,r),s=e[e.length-1];0===r&&(this._coordinateBufferPtr=0,this._coordinateBuffer=new Array(this._vertexDimension),s.push(this._coordinateBuffer)),this._coordinateBuffer[this._coordinateBufferPtr++]=n}_deriveApplyTransform(e){const{hasZ:t,hasM:r}=e;return t&&r?M:t?v:r?R:I}}var O=r(51084);let k=class extends s.A{constructor(e){super(e),this.dynamicDataSource=null,this.fieldsIndex=null,this.gdbVersion=null,this.infoFor3D=null,this.pbfSupported=!1,this.queryAttachmentsSupported=!1,this.sourceSpatialReference=null,this.url=null}get parsedUrl(){return(0,u.An)(this.url)}async execute(e,t){const r=await this.executeJSON(e,t);return this.featureSetFromJSON(e,r,t)}async executeJSON(e,t){const r=this._normalizeQuery(e),n=null!=e.outStatistics?.[0],s=(0,i.A)("featurelayer-pbf-statistics"),o=!n||s;let a;if(this.pbfSupported&&o)try{a=await async function(e,t,r){const n=(0,h.Dl)(e),s={...r},o=m.A.from(t),i=!o.quantizationParameters,{data:a}=await(0,g.IJ)(n,o,new T({sourceSpatialReference:o.sourceSpatialReference,applyTransform:i}),s);return a}(this.url,r,t)}catch(e){if("query:parsing-pbf"!==e.name)throw e;this.pbfSupported=!1}return this.pbfSupported&&o||(a=await(0,_.e)(this.url,r,t)),this._normalizeFields(a.fields),a}async featureSetFromJSON(e,t,n){if(!this._queryIs3DObjectFormat(e)||null==this.infoFor3D||!t.features)return O.A.fromJSON(t);const{meshFeatureSetFromJSON:s}=await(0,a.qr)(r.e(3473).then(r.bind(r,79289)),n);return s(e,this.infoFor3D,t)}executeForCount(e,t){return(0,y.I)(this.url,this._normalizeQuery(e),t)}executeForExtent(e,t){return async function(e,t,r){const n=(0,h.Dl)(e),s=await(0,g.Jf)(n,m.A.from(t),{...r}),o=s.data.extent;return!o||isNaN(o.xmin)||isNaN(o.ymin)||isNaN(o.xmax)||isNaN(o.ymax)?{count:s.data.count,extent:null}:{count:s.data.count,extent:b.default.fromJSON(o)}}(this.url,this._normalizeQuery(e),t)}executeForIds(e,t){return(0,w.V)(this.url,this._normalizeQuery(e),t)}async executeRelationshipQuery(e,t){const[{default:n},{executeRelationshipQuery:s}]=await(0,a.qr)(Promise.all([Promise.resolve().then(r.bind(r,95470)),r.e(9520).then(r.bind(r,89675))]),t);return e=n.from(e),(this.gdbVersion||this.dynamicDataSource)&&((e=e.clone()).gdbVersion=e.gdbVersion||this.gdbVersion,e.dynamicDataSource=e.dynamicDataSource||this.dynamicDataSource),s(this.url,e,t)}async executeRelationshipQueryForCount(e,t){const[{default:n},{executeRelationshipQueryForCount:s}]=await(0,a.qr)(Promise.all([Promise.resolve().then(r.bind(r,95470)),r.e(9520).then(r.bind(r,89675))]),t);return e=n.from(e),(this.gdbVersion||this.dynamicDataSource)&&((e=e.clone()).gdbVersion=e.gdbVersion||this.gdbVersion,e.dynamicDataSource=e.dynamicDataSource||this.dynamicDataSource),s(this.url,e,t)}async executeAttachmentQuery(e,t){const{executeAttachmentQuery:n,fetchAttachments:s,processAttachmentQueryResult:o}=await(0,a.qr)(r.e(9436).then(r.bind(r,83878)),t),i=(0,h.Dl)(this.url);return o(i,await(this.queryAttachmentsSupported?n(i,e,t):s(i,e,t)))}async executeBinsQuery(e,t){const{executeBinsQuery:n}=await(0,a.qr)(r.e(118).then(r.bind(r,19839)),t);return n(this.parsedUrl,e,t)}async executeTopFeaturesQuery(e,t){const{executeTopFeaturesQuery:n}=await(0,a.qr)(r.e(4464).then(r.bind(r,89916)),t);return n(this.parsedUrl,e,this.sourceSpatialReference,t)}async executeForTopIds(e,t){const{executeForTopIds:n}=await(0,a.qr)(r.e(6928).then(r.bind(r,57922)),t);return n(this.parsedUrl,e,t)}async executeForTopExtents(e,t){const{executeForTopExtents:n}=await(0,a.qr)(r.e(8857).then(r.bind(r,34534)),t);return n(this.parsedUrl,e,t)}async executeForTopCount(e,t){const{executeForTopCount:n}=await(0,a.qr)(r.e(3127).then(r.bind(r,56099)),t);return n(this.parsedUrl,e,t)}_normalizeQuery(e){let t=m.A.from(e);t.sourceSpatialReference=t.sourceSpatialReference||this.sourceSpatialReference,(this.gdbVersion||this.dynamicDataSource)&&(t=t===e?t.clone():t,t.gdbVersion=e.gdbVersion||this.gdbVersion,t.dynamicDataSource=e.dynamicDataSource?f.L.from(e.dynamicDataSource):this.dynamicDataSource);const{infoFor3D:r}=this;if(null!=r&&this._queryIs3DObjectFormat(e)){t=t===e?t.clone():t,t.formatOf3DObjects=null;const n=(0,d.U9)(r),s=(0,d.CW)(r);for(const e of r.queryFormats){if(e===n){t.formatOf3DObjects=e;break}e!==s||t.formatOf3DObjects||(t.formatOf3DObjects=e)}if(!t.formatOf3DObjects)throw new o.A("query:unsupported-3d-query-formats","Could not find any supported 3D object query format. Only supported formats are 3D_glb and 3D_gltf");if(t.outSpatialReference&&!(0,p.aI)(t.outSpatialReference,this.sourceSpatialReference))throw new o.A("query:unsupported-out-spatial-reference","3D object feature services do not support projection of geometries");if(null==t.outFields||!t.outFields.includes("*")){t=t===e?t.clone():t,null==t.outFields&&(t.outFields=[]);const{originX:n,originY:s,originZ:o,translationX:i,translationY:a,translationZ:u,scaleX:l,scaleY:c,scaleZ:p,rotationX:d,rotationY:f,rotationZ:h,rotationDeg:y}=r.transformFieldRoles;t.outFields.push(n,s,o,i,a,u,l,c,p,d,f,h,y)}}return t}_normalizeFields(e){if(null!=this.fieldsIndex&&null!=e)for(const t of e){const e=this.fieldsIndex.get(t.name);e&&Object.assign(t,e.toJSON())}}_queryIs3DObjectFormat(e){return null!=this.infoFor3D&&!0===e.returnGeometry&&"xyFootprint"!==e.multipatchOption&&!e.outStatistics}};(0,n._)([(0,l.MZ)({type:f.L})],k.prototype,"dynamicDataSource",void 0),(0,n._)([(0,l.MZ)()],k.prototype,"fieldsIndex",void 0),(0,n._)([(0,l.MZ)()],k.prototype,"gdbVersion",void 0),(0,n._)([(0,l.MZ)()],k.prototype,"infoFor3D",void 0),(0,n._)([(0,l.MZ)({readOnly:!0})],k.prototype,"parsedUrl",null),(0,n._)([(0,l.MZ)()],k.prototype,"pbfSupported",void 0),(0,n._)([(0,l.MZ)()],k.prototype,"queryAttachmentsSupported",void 0),(0,n._)([(0,l.MZ)()],k.prototype,"sourceSpatialReference",void 0),(0,n._)([(0,l.MZ)({type:String})],k.prototype,"url",void 0),k=(0,n._)([(0,c.$)("esri.layers.graphics.sources.support.QueryTask")],k);const E=k},69619:function(e,t,r){r.d(t,{F0:function(){return u},Vx:function(){return p},e2:function(){return f},f:function(){return h}});var n=r(58941),s=r(21609),o=r(7121),i=r(79580),a=r(6259);function u(e){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===e||"esriGeometryMultipoint"===e?a.Cb:"esriGeometryPolyline"===e?a.yM:a.WR}}}const l=/^[_$a-zA-Z][_$a-zA-Z0-9]*$/;let c=1;function p(e,t){if((0,n.A)("esri-csp-restrictions"))return()=>({[t]:null,...e});try{let r=`this${d(t)} = null;`;for(const t in e)r+=`this${d(t)} = ${JSON.stringify(e[t])};`;const n=new Function(`\n      return class AttributesClass$${c++} {\n        constructor() {\n          ${r};\n        }\n      }\n    `)();return()=>new n}catch(r){return()=>({[t]:null,...e})}}function d(e){return l.test(e)?`.${e}`:`["${e}"]`}function f(e={}){return[{name:"New Feature",description:"",prototype:{attributes:(0,s.o8)(e)}}]}function h(e,t){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,isBranchVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:e},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:t,supportsDelete:t,supportsEditing:t,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryBins:!1,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:t,supportsExceedsLimitStatistics:!0,supportsAsyncConvert3D:!1},query:o.F,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},queryBins:i.$,editing:{supportsGeometryUpdate:t,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsAsyncApplyEdits:!1,zDefault:void 0}}}},79580:function(e,t,r){r.d(t,{$:function(){return n},P:function(){return s}});const n={supportsDate:!1,supportsFixedInterval:!1,supportsAutoInterval:!1,supportsFixedBoundaries:!1,supportedStatistics:void 0},s={analytics:{supportsCacheHint:!1},attachment:{supportsContentType:!1,supportsExifInfo:!1,supportsKeywords:!1,supportsName:!1,supportsSize:!1,supportsCacheHint:!1,supportsResize:!1},data:{isVersioned:!1,isBranchVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:!1},editing:{supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsGeometryUpdate:!1,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsAsyncApplyEdits:!1,zDefault:void 0},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:!1,supportsDelete:!1,supportsEditing:!1,supportsChangeTracking:!1,supportsQuery:!1,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryBins:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:!1,supportsExceedsLimitStatistics:!1,supportsAsyncConvert3D:!1},queryRelated:{supportsCount:!1,supportsOrderBy:!1,supportsPagination:!1,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},queryBins:n,query:{maxRecordCount:0,maxRecordCountFactor:0,standardMaxRecordCount:0,supportsCacheHint:!1,supportsCentroid:!1,supportsCompactGeometry:!1,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsDisjointSpatialRelationship:!1,supportsDistance:!1,supportsDistinct:!1,supportsExtent:!1,supportsFormatPBF:!1,supportsGeometryProperties:!1,supportsHavingClause:!1,supportsHistoricMoment:!1,supportsMaxRecordCountFactor:!1,supportsOrderBy:!1,supportsPagination:!1,supportsPercentileStatistics:!1,supportsQuantization:!1,supportsQuantizationEditMode:!1,supportsQueryByAnonymous:!1,supportsQueryByOthers:!1,supportsQueryGeometry:!1,supportsResultType:!1,supportsSqlExpression:!1,supportsStandardizedQueriesOnly:!1,supportsTopFeaturesQuery:!1,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsStatistics:!1,tileMaxRecordCount:0}}},66228:function(e,t,r){r.d(t,{CW:function(){return f},Fm:function(){return u},JQ:function(){return d},JZ:function(){return _},ND:function(){return y},R_:function(){return i},U9:function(){return p},fu:function(){return s},nr:function(){return h},oF:function(){return o},rq:function(){return l},z$:function(){return c}});const n=[["binary","application/octet-stream","bin",""]];function s(e,t){return null!=m(t.name,e?.supportedFormats??[])}function o(e,t){if(!e)return!1;const r=l(t,e.supportedFormats??[]);return null!=r&&e.editFormats.includes(r)}function i(e,t){return b(function(e,t){const r=e.toLowerCase();return g(t).find((e=>w(e)===r))}(e,t))}function a(e,t){return b(m(e,t))}function u(e,t){return w(function(e,t){return g(t).find((t=>b(t)===e))}(e,t))}function l(e,t){return a(e.name,t)??i(e.type,t)}function c(e,t,r){return i(e,r)??a(t,r)}function p({supportedFormats:e}){return c("model/gltf-binary","glb",e)}function d(e){const t=p(e);return null!=t&&e.editFormats.includes(t)}function f({supportedFormats:e}){return c("model/gltf+json","gltf",e)}function h({supportedFormats:e}){return c("application/esri3do-SR_world","wld",e)}function y({supportedFormats:e}){return c("application/esri3do-SR_prj","prj",e)}function g(e){return[...n,...e]}function m(e,t){const r=e.toLowerCase();return g(t).find((e=>function(e){return e?.[2].split(",").map((e=>e.toLowerCase()))??[]}(e).some((e=>r.endsWith(e)))))}function b(e){return e?.[0]}function w(e){return e?.[1].toLowerCase()}function _(e){return e.tables?.find((e=>"assetMaps"===e.role))}},26765:function(e,t,r){r.d(t,{V:function(){return o},X:function(){return s}});var n=r(74697);function s(e){return{geometryType:(0,n.$B)(e[0]),geometries:e.map((e=>e.toJSON()))}}function o(e,t,r){const s=(0,n.xD)(t);return e.map((e=>{const t=s.fromJSON(e);return t.spatialReference=r,t}))}},12873:function(e,t,r){function n(e){const t={};for(const r in e){if("declaredClass"===r)continue;const s=e[r];if(null!=s&&"function"!=typeof s)if(Array.isArray(s)){t[r]=[];for(let e=0;e<s.length;e++)t[r][e]=n(s[e])}else"object"==typeof s?s.toJSON&&(t[r]=JSON.stringify(s)):t[r]=s}return t}r.d(t,{z:function(){return n}})},48066:function(e,t,r){r.d(t,{I:function(){return i}});var n=r(39397),s=r(90066),o=r(7926);async function i(e,t,r){const i=(0,n.Dl)(e),{data:a}=await(0,s.gW)(i,o.A.from(t),r);return a.count}},30067:function(e,t,r){r.d(t,{V:function(){return i}});var n=r(39397),s=r(90066),o=r(7926);async function i(e,t,r){const i=(0,n.Dl)(e),{data:a}=await(0,s.Pk)(i,o.A.from(t),r);return a.objectIds}},94072:function(e,t,r){r.d(t,{e:function(){return u},s:function(){return a}});var n=r(39397),s=r(90066),o=r(51084),i=r(7926);async function a(e,t,r){const n=await u(e,t,r);return o.A.fromJSON(n)}async function u(e,t,r){const o=(0,n.Dl)(e),a={...r},u=i.A.from(t),{data:l}=await(0,s.eW)(o,u,u.sourceSpatialReference,a);return l}},87295:function(e,t,r){r.d(t,{u:function(){return i}});var n=r(62938),s=r(57652);function o(e,t,r){if(null==e.hasM||e.hasZ)for(const e of t)for(const t of e)t.length>2&&(t[2]*=r)}function i(e,t,r){if(!e&&!t||!r)return;const s=(0,n.G9)(r);a(e,r,s),a(t,r,s)}function a(e,t,r){if(e)for(const n of e)u(n.geometry,t,r)}function u(e,t,r){if(!e?.spatialReference||(0,s.aI)(e.spatialReference,t))return;const i=(0,n.G9)(e.spatialReference)/r;if(1!==i)if("x"in e)null!=e.z&&(e.z*=i);else if("rings"in e)o(e,e.rings,i);else if("paths"in e)o(e,e.paths,i);else if("points"in e&&(null==e.hasM||e.hasZ))for(const t of e.points)t.length>2&&(t[2]*=i)}},45608:function(e,t,r){r.d(t,{SH:function(){return M},ae:function(){return F},cn:function(){return b}});var n=r(39819),s=r(68225),o=r(76613),i=r(38519);const a=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML","esriFieldTypeBigInteger","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"],u=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],l=["upperLeft","lowerLeft"];function c(e){return e>=a.length?null:a[e]}function p(e){return e>=u.length?null:u[e]}function d(e){return e>=l.length?null:l[e]}function f(e,t){return t>=e.geometryTypes.length?null:e.geometryTypes[t]}function h(e,t,r){const n=e.asUnsafe(),s=t.createPointGeometry(r);for(;n.next();)switch(n.tag()){case 3:{const e=n.getUInt32(),r=n.pos()+e;let o=0;for(;n.pos()<r;)t.addCoordinatePoint(s,n.getSInt64(),o++);break}default:n.skip()}return s}function y(e,t,r){const n=e.asUnsafe(),s=t.createGeometry(r),o=2+(r.hasZ?1:0)+(r.hasM?1:0);for(;n.next();)switch(n.tag()){case 2:{const e=n.getUInt32(),r=n.pos()+e;let o=0;for(;n.pos()<r;)t.addLength(s,n.getUInt32(),o++);break}case 3:{const e=n.getUInt32(),r=n.pos()+e;let i=0;for(t.allocateCoordinates(s);n.pos()<r;)t.addCoordinate(s,n.getSInt64(),i),i++,i===o&&(i=0);break}default:n.skip()}return s}function g(e){const t=e.asUnsafe(),r=new o.A;let n="esriGeometryPoint";for(;t.next();)switch(t.tag()){case 2:{const e=t.getUInt32(),n=t.pos()+e;for(;t.pos()<n;)r.lengths.push(t.getUInt32());break}case 3:{const e=t.getUInt32(),n=t.pos()+e;for(;t.pos()<n;)r.coords.push(t.getSInt64());break}case 1:n=i.z[t.getEnum()];break;default:t.skip()}return{queryGeometry:r,queryGeometryType:n}}function m(e){const t=e.asUnsafe();for(;t.next();)switch(t.tag()){case 1:return t.getString();case 2:return t.getFloat();case 3:return t.getDouble();case 4:return t.getSInt32();case 5:return t.getUInt32();case 6:return t.getInt64();case 7:return t.getUInt64();case 8:return t.getSInt64();case 9:return t.getBool();default:return t.skip(),null}return null}function b(e){const t=e.asUnsafe(),r={type:c(0)};for(;t.next();)switch(t.tag()){case 1:r.name=t.getString();break;case 2:r.type=c(t.getEnum());break;case 3:r.alias=t.getString();break;case 4:r.sqlType=p(t.getEnum());break;case 5:default:t.skip();break;case 6:r.defaultValue=t.getString()}return r}function w(e){const t={},r=e.asUnsafe();for(;r.next();)switch(r.tag()){case 1:t.name=r.getString();break;case 2:t.isSystemMaintained=r.getBool();break;default:r.skip()}return t}function _(e,t,r,n){const s=t.createFeature(r);let o=0;for(;e.next();)switch(e.tag()){case 1:{const t=n[o++].name;s.attributes[t]=e.processMessage(m);break}case 2:s.geometry=e.processMessageWithArgs(y,t,r);break;case 4:s.centroid=e.processMessageWithArgs(h,t,r);break;default:e.skip()}return s}function A(e){const t=[1,1,1,1],r=e.asUnsafe();for(;r.next();)switch(r.tag()){case 1:t[0]=r.getDouble();break;case 2:t[1]=r.getDouble();break;case 4:t[2]=r.getDouble();break;case 3:t[3]=r.getDouble();break;default:r.skip()}return t}function S(e){const t=[0,0,0,0],r=e.asUnsafe();for(;r.next();)switch(r.tag()){case 1:t[0]=r.getDouble();break;case 2:t[1]=r.getDouble();break;case 4:t[2]=r.getDouble();break;case 3:t[3]=r.getDouble();break;default:r.skip()}return t}function F(e){const t={originPosition:d(0)},r=e.asUnsafe();for(;r.next();)switch(r.tag()){case 1:t.originPosition=d(r.getEnum());break;case 2:t.scale=r.processMessage(A);break;case 3:t.translate=r.processMessage(S);break;default:r.skip()}return t}function x(e){const t={},r=e.asUnsafe();for(;r.next();)switch(r.tag()){case 1:t.shapeAreaFieldName=r.getString();break;case 2:t.shapeLengthFieldName=r.getString();break;case 3:t.units=r.getString();break;default:r.skip()}return t}function I(e,t){const r=t.createSpatialReference();for(;e.next();)switch(e.tag()){case 1:r.wkid=e.getUInt32();break;case 5:r.wkt=e.getString();break;case 2:r.latestWkid=e.getUInt32();break;case 3:r.vcsWkid=e.getUInt32();break;case 4:r.latestVcsWkid=e.getUInt32();break;default:e.skip()}return r}function v(e,t){const r=t.createFeatureResult(),n=e.asUnsafe();r.geometryType=f(t,0);let s=!1;for(;n.next();)switch(n.tag()){case 1:r.objectIdFieldName=n.getString();break;case 3:r.globalIdFieldName=n.getString();break;case 4:r.geohashFieldName=n.getString();break;case 5:r.geometryProperties=n.processMessage(x);break;case 7:r.geometryType=f(t,n.getEnum());break;case 8:r.spatialReference=n.processMessageWithArgs(I,t);break;case 10:r.hasZ=n.getBool();break;case 11:r.hasM=n.getBool();break;case 12:r.transform=n.processMessage(F);break;case 9:r.exceededTransferLimit=n.getBool();break;case 13:t.addField(r,n.processMessage(b));break;case 15:s||(t.prepareFeatures(r),s=!0),t.addFeature(r,n.processMessageWithArgs(_,t,r,r.fields));break;case 2:r.uniqueIdField=n.processMessage(w);break;default:n.skip()}return t.finishFeatureResult(r),r}function R(e,t){const r={};let n=null;for(;e.next();)switch(e.tag()){case 4:n=e.processMessageWithArgs(g);break;case 1:r.featureResult=e.processMessageWithArgs(v,t);break;default:e.skip()}return null!=n&&r.featureResult&&t.addQueryGeometry(r,n),r}function M(e,t){try{const r=2,n=new s.A(new Uint8Array(e),new DataView(e)),o={};for(;n.next();)n.tag()===r?o.queryResult=n.processMessageWithArgs(R,t):n.skip();return o}catch(e){throw new n.A("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:e})}}},38519:function(e,t,r){r.d(t,{S:function(){return l},z:function(){return u}});var n=r(62938),s=r(57652),o=r(65215),i=r(72887),a=r(76613);const u=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"];class l{constructor(e){this._options=e,this.geometryTypes=u,this._coordinatePtr=0,this._vertexDimension=0}createFeatureResult(){return new i.A}prepareFeatures(e){this._vertexDimension=2,e.hasZ&&this._vertexDimension++,e.hasM&&this._vertexDimension++}finishFeatureResult(e){if(!e?.features||!e.hasZ||!this._options.sourceSpatialReference||!e.spatialReference||(0,s.aI)(e.spatialReference,this._options.sourceSpatialReference)||e.spatialReference.vcsWkid)return;const t=(0,n.G9)(this._options.sourceSpatialReference)/(0,n.G9)(e.spatialReference);if(1!==t)for(const r of e.features){if(!(0,o.N3)(r))continue;const e=r.geometry.coords;for(let r=2;r<e.length;r+=3)e[r]*=t}}addFeature(e,t){e.features.push(t)}createFeature(){return new o.Om}createSpatialReference(){return{wkid:0}}createGeometry(){return new a.A}addField(e,t){e.fields.push(t)}allocateCoordinates(e){e.coords.length=e.lengths.reduce(((e,t)=>e+t),0)*this._vertexDimension,this._coordinatePtr=0}addCoordinate(e,t){e.coords[this._coordinatePtr++]=t}addCoordinatePoint(e,t){e.coords.push(t)}addLength(e,t){e.lengths.push(t)}addQueryGeometry(e,t){e.queryGeometry=t.queryGeometry,e.queryGeometryType=t.queryGeometryType}createPointGeometry(){return new a.A}}},55723:function(e,t,r){r.d(t,{m:function(){return s}});var n=r(45608);function s(e,t){const r=(0,n.SH)(e,t),s=r.queryResult.featureResult,o=r.queryResult.queryGeometry,i=r.queryResult.queryGeometryType;if(s&&s.features&&s.features.length&&s.objectIdFieldName){const e=s.objectIdFieldName;for(const t of s.features)t.attributes&&(t.objectId=t.attributes[e])}return s&&(s.queryGeometry=o,s.queryGeometryType=i),s}},90066:function(e,t,r){r.d(t,{IJ:function(){return h},Jf:function(){return b},Pk:function(){return g},eW:function(){return f},gW:function(){return m},kS:function(){return y}});var n=r(93040),s=r(90683),o=r(74697),i=r(65298),a=r(57652),u=r(12873),l=r(55723),c=r(45406);const p="Layer does not support extent calculation.";function d(e,t){const r=e.geometry,n=e.toJSON();delete n.compactGeometryEnabled,delete n.defaultSpatialReferenceEnabled;const s=n;let i,u,l;if(null!=r&&(u=r.spatialReference,l=(0,a.YX)(u),s.geometryType=(0,o.$B)(r),s.geometry=function(e,t){if(t&&"extent"===e.type)return`${e.xmin},${e.ymin},${e.xmax},${e.ymax}`;if(t&&"point"===e.type)return`${e.x},${e.y}`;const r=e.toJSON();return delete r.spatialReference,JSON.stringify(r)}(r,e.compactGeometryEnabled),s.inSR=l),n.groupByFieldsForStatistics&&(s.groupByFieldsForStatistics=n.groupByFieldsForStatistics.join(",")),n.objectIds&&(s.objectIds=n.objectIds.join(",")),n.orderByFields&&(s.orderByFields=n.orderByFields.join(",")),!n.outFields||!n.returnDistinctValues&&(t?.returnCountOnly||t?.returnExtentOnly||t?.returnIdsOnly)?delete s.outFields:n.outFields.includes("*")?s.outFields="*":s.outFields=n.outFields.join(","),n.outSR?(s.outSR=(0,a.YX)(n.outSR),i=e.outSpatialReference):r&&(n.returnGeometry||n.returnCentroid)&&(s.outSR=s.inSR,i=u),n.returnGeometry&&delete n.returnGeometry,n.outStatistics&&(s.outStatistics=JSON.stringify(n.outStatistics)),n.fullText&&(s.fullText=JSON.stringify(n.fullText)),n.pixelSize&&(s.pixelSize=JSON.stringify(n.pixelSize)),n.quantizationParameters&&(e.defaultSpatialReferenceEnabled&&null!=u&&null!=e.quantizationParameters?.extent&&u.equals(e.quantizationParameters.extent.spatialReference)&&delete n.quantizationParameters.extent.spatialReference,s.quantizationParameters=JSON.stringify(n.quantizationParameters)),n.parameterValues&&(s.parameterValues=JSON.stringify(n.parameterValues)),n.rangeValues&&(s.rangeValues=JSON.stringify(n.rangeValues)),n.dynamicDataSource&&(s.layer=JSON.stringify({source:n.dynamicDataSource}),delete n.dynamicDataSource),n.timeExtent){const e=n.timeExtent,{start:t,end:r}=e;null==t&&null==r||(s.time=t===r?t:`${t??"null"},${r??"null"}`),delete n.timeExtent}return e.defaultSpatialReferenceEnabled&&null!=u&&null!=i&&u.equals(i)&&(s.defaultSR=s.inSR,delete s.inSR,delete s.outSR),s}async function f(e,t,r,n){const s=null!=t.timeExtent&&t.timeExtent.isEmpty?{data:{features:[]}}:await w(e,t,"json",n);return(0,c.q)(t,r,s.data),s}async function h(e,t,r,n){if(null!=t.timeExtent&&t.timeExtent.isEmpty)return{data:r.createFeatureResult()};const s=await y(e,t,n),o=s;return o.data=(0,l.m)(s.data,r),o}function y(e,t,r){return w(e,t,"pbf",r)}function g(e,t,r){return null!=t.timeExtent&&t.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):w(e,t,"json",r,{returnIdsOnly:!0})}function m(e,t,r){return null!=t.timeExtent&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):w(e,t,"json",r,{returnIdsOnly:!0,returnCountOnly:!0})}async function b(e,t,r){if(null!=t.timeExtent&&t.timeExtent.isEmpty)return{data:{count:0,extent:null}};const n=await w(e,t,"json",r,{returnExtentOnly:!0,returnCountOnly:!0}),s=n.data;if(s.hasOwnProperty("extent"))return n;if(s.features)throw new Error(p);if(s.hasOwnProperty("count"))throw new Error(p);return n}async function w(e,t,r,o={},a={}){const l="string"==typeof e?(0,s.An)(e):e,c=t.geometry?[t.geometry]:[],p=await(0,i.el)(c,null,{signal:o.signal}),f=p?.[0];null!=f&&((t=t.clone()).geometry=f);const h=(0,u.z)({...l.query,f:r,...a,...d(t,a)});return(0,n.A)((0,s.fj)(l.path,(y=a,null==t.formatOf3DObjects||y.returnCountOnly||y.returnExtentOnly||y.returnIdsOnly?"query":"query3d")),{...o,responseType:"pbf"===r?"array-buffer":"json",query:{...h,...o.query}});var y}},45406:function(e,t,r){r.d(t,{q:function(){return s}});var n=r(6996);function s(e,t,r){if(!r?.features||!r.hasZ)return;const s=(0,n.N)(r.geometryType,t,e.outSpatialReference);if(null!=s)for(const e of r.features)s(e.geometry)}},51084:function(e,t,r){r.d(t,{A:function(){return w}});var n,s=r(53804),o=r(50917),i=r(59469),a=r(73037),u=r(30905),l=r(21609),c=r(23502),p=(r(58941),r(40633),r(47332)),d=r(65953),f=r(81392),h=r(57165),y=r(74697),g=r(56740);const m=new a.J({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let b=n=class extends u.oY{constructor(e){super(e),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(e,t){const r=h.A.fromJSON(t.spatialReference),n=[];for(let t=0;t<e.length;t++){const s=e[t],o=i.default.fromJSON(s),a=s.geometry?.spatialReference;null==o.geometry||a||(o.geometry.spatialReference=r);const u=s.aggregateGeometries,l=o.aggregateGeometries;if(u&&null!=l)for(const e in l){const t=l[e],n=u[e],s=n?.spatialReference;null==t||s||(t.spatialReference=r)}n.push(o)}return n}writeGeometryType(e,t,r,n){if(e)return void m.write(e,t,r,n);const{features:s}=this;if(s)for(const e of s)if(null!=e?.geometry)return void m.write(e.geometry.type,t,r,n)}readQueryGeometry(e,t){if(!e)return null;const r=!!e.spatialReference,n=(0,y.rS)(e);return n&&!r&&t.spatialReference&&(n.spatialReference=h.A.fromJSON(t.spatialReference)),n}writeSpatialReference(e,t){if(e)return void(t.spatialReference=e.toJSON());const{features:r}=this;if(r)for(const e of r)if(e&&null!=e.geometry&&e.geometry.spatialReference)return void(t.spatialReference=e.geometry.spatialReference.toJSON())}clone(){return new n(this.cloneProperties())}cloneProperties(){return(0,l.o8)({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(e){const t=this.write();if(t.features&&Array.isArray(e)&&e.length>0)for(let r=0;r<t.features.length;r++){const n=t.features[r];if(n.geometry){const t=e?.[r];n.geometry=t?.toJSON()||n.geometry}}return t}quantize(e){const{scale:[t,r],translate:[n,s]}=e,o=this.features,i=this._getQuantizationFunction(this.geometryType,(e=>Math.round((e-n)/t)),(e=>Math.round((s-e)/r)));for(let e=0,t=o.length;e<t;e++)i?.(o[e].geometry)||(o.splice(e,1),e--,t--);return this.transform=e,this}unquantize(){const{geometryType:e,features:t,transform:r}=this;if(!r)return this;const{translate:[n,s],scale:[o,i]}=r;let a=null,u=null;if(this.hasZ&&null!=r?.scale?.[2]){const{translate:[,,e],scale:[,,t]}=r;a=r=>r*t+e}if(this.hasM&&null!=r?.scale?.[3]){const{translate:[,,,e],scale:[,,,t]}=r;u=r=>null==r?r:r*t+e}const l=this._getHydrationFunction(e,(e=>e*o+n),(e=>s-e*i),a,u);for(const{geometry:e}of t)null!=e&&l&&l(e);return this.transform=null,this}_quantizePoints(e,t,r){let n,s;const o=[];for(let i=0,a=e.length;i<a;i++){const a=e[i];if(i>0){const e=t(a[0]),i=r(a[1]);e===n&&i===s||(o.push([e-n,i-s]),n=e,s=i)}else n=t(a[0]),s=r(a[1]),o.push([n,s])}return o.length>0?o:null}_getQuantizationFunction(e,t,r){return"point"===e?e=>(e.x=t(e.x),e.y=r(e.y),e):"polyline"===e||"polygon"===e?e=>{const n=(0,y.Bi)(e)?e.rings:e.paths,s=[];for(let e=0,o=n.length;e<o;e++){const o=n[e],i=this._quantizePoints(o,t,r);i&&s.push(i)}return s.length>0?((0,y.Bi)(e)?e.rings=s:e.paths=s,e):null}:"multipoint"===e?e=>{const n=this._quantizePoints(e.points,t,r);return n&&n.length>0?(e.points=n,e):null}:"extent"===e?e=>e:null}_getHydrationFunction(e,t,r,n,s){return"point"===e?e=>{e.x=t(e.x),e.y=r(e.y),n&&(e.z=n(e.z))}:"polyline"===e||"polygon"===e?e=>{const o=(0,y.Bi)(e)?e.rings:e.paths;let i,a;for(let e=0,n=o.length;e<n;e++){const n=o[e];for(let e=0,s=n.length;e<s;e++){const s=n[e];e>0?(i+=s[0],a+=s[1]):(i=s[0],a=s[1]),s[0]=t(i),s[1]=r(a)}}if(n&&s)for(let e=0,t=o.length;e<t;e++){const t=o[e];for(let e=0,r=t.length;e<r;e++){const r=t[e];r[2]=n(r[2]),r[3]=s(r[3])}}else if(n)for(let e=0,t=o.length;e<t;e++){const t=o[e];for(let e=0,r=t.length;e<r;e++){const r=t[e];r[2]=n(r[2])}}else if(s)for(let e=0,t=o.length;e<t;e++){const t=o[e];for(let e=0,r=t.length;e<r;e++){const r=t[e];r[2]=s(r[2])}}}:"extent"===e?e=>{e.xmin=t(e.xmin),e.ymin=r(e.ymin),e.xmax=t(e.xmax),e.ymax=r(e.ymax),n&&null!=e.zmax&&null!=e.zmin&&(e.zmax=n(e.zmax),e.zmin=n(e.zmin)),s&&null!=e.mmax&&null!=e.mmin&&(e.mmax=s(e.mmax),e.mmin=s(e.mmin))}:"multipoint"===e?e=>{const o=e.points;let i,a;for(let e=0,n=o.length;e<n;e++){const n=o[e];e>0?(i+=n[0],a+=n[1]):(i=n[0],a=n[1]),n[0]=t(i),n[1]=r(a)}if(n&&s)for(let e=0,t=o.length;e<t;e++){const t=o[e];t[2]=n(t[2]),t[3]=s(t[3])}else if(n)for(let e=0,t=o.length;e<t;e++){const t=o[e];t[2]=n(t[2])}else if(s)for(let e=0,t=o.length;e<t;e++){const t=o[e];t[2]=s(t[2])}}:null}};(0,s._)([(0,c.MZ)({type:String,json:{write:!0}})],b.prototype,"displayFieldName",void 0),(0,s._)([(0,c.MZ)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],b.prototype,"exceededTransferLimit",void 0),(0,s._)([(0,c.MZ)({type:[i.default],json:{write:!0}})],b.prototype,"features",void 0),(0,s._)([(0,p.w)("features")],b.prototype,"readFeatures",null),(0,s._)([(0,c.MZ)({type:[g.A],json:{write:!0}})],b.prototype,"fields",void 0),(0,s._)([(0,c.MZ)({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:m.read}}})],b.prototype,"geometryType",void 0),(0,s._)([(0,f.K)("geometryType")],b.prototype,"writeGeometryType",null),(0,s._)([(0,c.MZ)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],b.prototype,"hasM",void 0),(0,s._)([(0,c.MZ)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],b.prototype,"hasZ",void 0),(0,s._)([(0,c.MZ)({types:o.yR,json:{write:!0}})],b.prototype,"queryGeometry",void 0),(0,s._)([(0,p.w)("queryGeometry")],b.prototype,"readQueryGeometry",null),(0,s._)([(0,c.MZ)({type:h.A,json:{write:!0}})],b.prototype,"spatialReference",void 0),(0,s._)([(0,f.K)("spatialReference")],b.prototype,"writeSpatialReference",null),(0,s._)([(0,c.MZ)({json:{write:!0}})],b.prototype,"transform",void 0),b=n=(0,s._)([(0,d.$)("esri.rest.support.FeatureSet")],b),b.prototype.toJSON.isDefaultToJSON=!0;const w=b},39397:function(e,t,r){r.d(t,{Dl:function(){return i},jV:function(){return o},lF:function(){return a}}),r(25591),r(7156);var n=r(21609),s=r(90683);function o(e,t){return t?{...t,query:{...e??{},...t.query}}:{query:e}}function i(e){return"string"==typeof e?(0,s.An)(e):(0,n.o8)(e)}function a(e,t,r){const n={};for(const s in e){if("declaredClass"===s)continue;const o=e[s];if(null!=o&&"function"!=typeof o)if(Array.isArray(o))n[s]=o.map((e=>a(e)));else if("object"==typeof o)if(o.toJSON){const e=o.toJSON(r?.[s]);n[s]=t?e:JSON.stringify(e)}else n[s]=t?o:JSON.stringify(o);else n[s]=o}return n}r(48893)}}]);
//# sourceMappingURL=graphics-sources-FeatureLayerSource.js.map