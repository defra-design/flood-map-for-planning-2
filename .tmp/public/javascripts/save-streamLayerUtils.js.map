{"version":3,"file":"save-streamLayerUtils.js","mappings":"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","sources":["webpack://defra/./node_modules/@arcgis/core/core/accessorSupport/originUtils.js","webpack://defra/./node_modules/@arcgis/core/core/multiOriginJSONSupportUtils.js","webpack://defra/./node_modules/@arcgis/core/layers/save/streamLayerUtils.js","webpack://defra/./node_modules/@arcgis/core/layers/save/utils.js","webpack://defra/./node_modules/@arcgis/core/portal/support/jsonContext.js","webpack://defra/./node_modules/@arcgis/core/webdoc/support/saveUtils.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport{isMultiOriginJSONMixin as r}from\"../multiOriginJSONSupportUtils.js\";function i(i){i?.writtenProperties&&i.writtenProperties.forEach((({target:i,propName:t,newOrigin:e})=>{r(i)&&e&&i.originOf(t)!==e&&i.updateOrigin(t,e)}))}export{i as updateOrigins};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nfunction i(i){return i&&\"getAtOrigin\"in i&&\"originOf\"in i}export{i as isMultiOriginJSONMixin};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport{save as e,saveAs as t}from\"./utils.js\";import{getWGS84ExtentForItem as r,removeTypeKeyword as a,typeKeyword as s,addTypeKeyword as l}from\"../../portal/support/portalItemUtils.js\";const n=\"Stream Service\",i=\"Feed\",o=\"stream-layer-save\",m=\"stream-layer-save-as\";function u(e){return{isValid:\"stream\"===e.type&&!!e.url&&!e.webSocketUrl,errorMessage:\"Stream layer should be created using a url to a stream service\"}}function c(e){const t=e.layerJSON;return Promise.resolve(t&&Object.keys(t).length?t:null)}async function y(e,t){const{parsedUrl:n,title:i,fullExtent:o}=e;t.url=n.path,t.title||=i,t.extent=null,null!=o&&(t.extent=await r(o)),a(t,s.METADATA),l(t,s.SINGLE_LAYER)}async function p(t,r){return e({layer:t,itemType:n,additionalItemType:i,validateLayer:u,createItemData:c,errorNamePrefix:o},r)}async function f(e,r,a){return t({layer:e,itemType:n,validateLayer:u,createItemData:c,errorNamePrefix:m,newItem:r,setItemProperties:y},a)}export{p as save,f as saveAs};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport e from\"../../core/Error.js\";import{updateOrigins as t}from\"../../core/accessorSupport/originUtils.js\";import r from\"../../portal/Portal.js\";import a from\"../../portal/PortalItem.js\";import{createForItemWrite as o}from\"../../portal/support/jsonContext.js\";import{addTypeKeyword as i,typeKeyword as n}from\"../../portal/support/portalItemUtils.js\";import{evaluateWriteErrors as s}from\"../../webdoc/support/saveUtils.js\";function p(t,r,a){const o=a(t);if(!o.isValid)throw new e(`${r}:invalid-parameters`,o.errorMessage,{layer:t})}async function l(e){const{layer:t,errorNamePrefix:r,validateLayer:a}=e;await t.load(),p(t,r,a)}function m(e,t){return`Layer (title: ${e.title}, id: ${e.id}) of type '${e.declaredClass}' ${t}`}function c(t){const{item:r,errorNamePrefix:a,layer:o,validateItem:i}=t;if(u(t),i){const t=i(r);if(!t.isValid)throw new e(`${a}:invalid-parameters`,t.errorMessage,{layer:o})}}function u(t){const{item:r,itemType:a,additionalItemType:o,errorNamePrefix:i,layer:n}=t,s=[a];if(o&&s.push(o),!s.includes(r.type)){const t=s.map((e=>`'${e}'`)).join(\", \");throw new e(`${i}:portal-item-wrong-type`,`Portal item type should be one of: \"${t}\"`,{item:r,layer:n})}}function f(t){const{layer:r,errorNamePrefix:a}=t,{portalItem:o}=r;if(!o)throw new e(`${a}:portal-item-not-set`,m(r,\"requires the portalItem property to be set\"));if(!o.loaded)throw new e(`${a}:portal-item-not-loaded`,m(r,\"cannot be saved to a portal item that does not exist or is inaccessible\"));c({...t,item:o})}function d(e){const{newItem:t,itemType:o}=e;let i=a.from(t);return i.id&&(i=i.clone(),i.id=null),i.type??=o,i.portal??=r.getDefault(),c({...e,item:i}),i}function y(e){return o(e,\"portal-item\")}async function w(e,t,r){\"beforeSave\"in e&&\"function\"==typeof e.beforeSave&&await e.beforeSave();const a=e.write({},t);return await Promise.all(t.resources?.pendingOperations??[]),s(t,{errorName:\"layer-write:unsupported\"},r),a}function I(e){i(e,n.JSAPI),e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter(((e,t,r)=>r.indexOf(e)===t)))}async function v(e,t,r){const a=e.portal;await a.signIn(),await a.user.addItem({item:e,data:t,folder:r?.folder})}async function P(e,r){const{layer:a,createItemData:o,createJSONContext:i,setItemProperties:n,saveResources:s,supplementalUnsupportedErrors:p}=e;await l(e),f(e);const m=a.portalItem,c=i?i(m):y(m),u=await w(a,c,{...r,supplementalUnsupportedErrors:p}),d=await o({layer:a,layerJSON:u},m);return await(n?.(a,m,d)),I(m),await m.update({data:d}),t(c),await(s?.(m,c)),m}async function $(e,r){const{layer:a,createItemData:o,createJSONContext:i,setItemProperties:n,saveResources:s,supplementalUnsupportedErrors:p}=e;await l(e);const m=d(e),c=i?i(m):y(m),u=await w(a,c,{...r,supplementalUnsupportedErrors:p}),f=await o({layer:a,layerJSON:u},m);return await n(a,m,f),I(m),await v(m,f,r),a.portalItem=m,t(c),await(s?.(m,c)),m}export{v as addItem,m as createErrorMessage,y as createJSONContextForWrite,f as ensureItemConfig,p as ensureLayerConfig,w as getLayerJSON,d as getPortalItem,P as save,$ as saveAs,I as setCommonItemProperties};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport{urlToObject as t}from\"../../core/urlUtils.js\";import r from\"../Portal.js\";function e(t,r){return{...l(t,r),readResourcePaths:[]}}function o(r,e,o){const i=t(r.itemUrl);return{...l(r,e),messages:[],writtenProperties:[],blockedRelativeUrls:[],verifyItemRelativeUrls:i?{rootPath:i.path,writtenUrls:[]}:null,resources:o?{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}:null}}function l(e,o){return{origin:o,url:t(e.itemUrl),portal:e.portal||r.getDefault(),portalItem:e}}export{e as createForItemRead,o as createForItemWrite};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport e from\"../../core/Error.js\";async function r(e){const r=[];for(const o of e.allLayers)if(\"beforeSave\"in o&&\"function\"==typeof o.beforeSave){const e=o.beforeSave();e&&r.push(e)}await Promise.allSettled(r)}const o=new Set([\"layer:unsupported\",\"property:unsupported\",\"symbol:unsupported\",\"symbol-layer:unsupported\",\"url:unsupported\"]);function t(r,t,n){let s=(r.messages??[]).filter((({type:e})=>\"error\"===e)).map((({name:r,message:o,details:t})=>new e(r,o,t)));if(r.blockedRelativeUrls&&(s=s.concat(r.blockedRelativeUrls.map((r=>new e(\"url:unsupported\",`Relative url '${r}' is not supported`))))),n){const{ignoreUnsupported:e,supplementalUnsupportedErrors:r=[],requiredPropertyChecksDisabled:t}=n;e&&(s=s.filter((({name:e})=>!(o.has(e)||r.includes(e))))),t&&(s=s.filter((e=>\"web-document-write:property-required\"!==e.name)))}if(s.length>0)throw new e(t.errorName,\"Failed to save due to unsupported or invalid content. See 'details.errors' for more detailed information\",{errors:s})}export{r as beforeSave,t as evaluateWriteErrors};\n"],"names":["i","writtenProperties","forEach","target","propName","t","newOrigin","e","originOf","updateOrigin","n","o","m","u","isValid","type","url","webSocketUrl","errorMessage","c","layerJSON","Promise","resolve","Object","keys","length","async","y","parsedUrl","title","fullExtent","path","extent","METADATA","SINGLE_LAYER","p","r","layer","itemType","additionalItemType","validateLayer","createItemData","errorNamePrefix","f","a","newItem","setItemProperties","l","load","id","declaredClass","item","validateItem","s","push","includes","map","join","portalItem","loaded","d","from","clone","portal","getDefault","w","beforeSave","write","all","resources","pendingOperations","errorName","I","JSAPI","typeKeywords","filter","indexOf","P","createJSONContext","saveResources","supplementalUnsupportedErrors","update","data","$","signIn","user","addItem","folder","v","readResourcePaths","itemUrl","messages","blockedRelativeUrls","verifyItemRelativeUrls","rootPath","writtenUrls","toAdd","toUpdate","toKeep","origin","allLayers","allSettled","Set","name","message","details","concat","ignoreUnsupported","requiredPropertyChecksDisabled","has","errors"],"sourceRoot":""}