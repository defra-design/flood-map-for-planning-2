"use strict";(self.webpackChunkdefra=self.webpackChunkdefra||[]).push([[9250],{38474:function(t,e,i){i.d(e,{C:function(){return y},b:function(){return _}});var r=i(27264),s=i(13668),n=i(34178),o=i(27271),a=i(85709),l=i(77771),h=i(58766),c=i(23864),u=i(20830),d=i(38917),f=i(39506),p=i(62988),m=i(65839),g=i(25124);function _(t){const e=new p.N5,{vertex:i,fragment:_,attributes:y,varyings:v}=e;(0,u.NB)(i,t),e.include(n.d,t),e.include(a.c,t),e.include(h.A,t),e.include(o.g,t),e.include(s.HQ,t),e.include(g.z,t),y.add(m.r.POSITION,"vec3"),t.vvColor&&y.add(m.r.COLORFEATUREATTRIBUTE,"float"),v.add("vColor","vec4"),v.add("vpos","vec3");const x=t.terrainDepthTest&&t.output===r.V.Color;return x&&v.add("depth","float"),i.uniforms.add(new d.E("eColor",(t=>t.color))),i.main.add(f.H`
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();

      ${t.hasVertexColors?"vColor *= eColor;":t.vvColor?"vColor = eColor * interpolateVVColor(colorFeatureAttribute);":"vColor = eColor;"}
      ${x?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = transformPosition(proj, view, vpos);`),e.include(s.HQ,t),x&&e.include(l.Z,t),_.include(c.a),_.main.add(f.H`
    discardBySlice(vpos);
    ${x?"terrainDepthTest(depth);":""}
    vec4 fColor = vColor;
    outputColorHighlightOID(fColor, vpos);`),e}const y=Object.freeze(Object.defineProperty({__proto__:null,build:_},Symbol.toStringTag,{value:"Module"}))},88008:function(t,e,i){i.d(e,{H:function(){return z},b:function(){return I},c:function(){return L},s:function(){return O}});var r=i(13786),s=i(1932),n=i(41546),o=i(43587),a=i(27264),l=i(13668),h=i(27271),c=i(10155),u=i(1143),d=i(50399),f=i(80231),p=i(84435),m=i(58766),g=i(28686),_=i(23864),y=i(52766),v=i(19202),x=i(20830),b=i(11687),w=i(41356),P=i(38917),S=i(14543),C=i(39506),T=i(62988),M=i(39838),A=i(54840),R=i(65839);const O={occludedFadeFactor:.6};function I(t){const e=new T.N5,i=t.signedDistanceFieldEnabled;if(e.include(u.Q,t),e.include(l.HQ,t),t.occlusionPass)return e.include(d.I,t),e;const{vertex:s,fragment:I}=e;e.include(v.Y6),e.include(m.A,t),e.include(h.g,t),e.include(f.y),I.include(y.W),I.include(_.a),e.varyings.add("vcolor","vec4"),e.varyings.add("vtc","vec2"),e.varyings.add("vsize","vec2"),e.varyings.add("voccluded","float"),s.uniforms.add(new P.E("viewport",((t,e)=>e.camera.fullViewport)),new b.G("screenOffset",((t,e)=>(0,r.hZ)(D,2*t.screenOffset[0]*e.camera.pixelRatio,2*t.screenOffset[1]*e.camera.pixelRatio))),new b.G("anchorPosition",(t=>L(t))),new P.E("materialColor",(t=>t.color)),new S.m("materialRotation",(t=>t.rotation))),(0,x.Nz)(s),i&&(s.uniforms.add(new P.E("outlineColor",(t=>t.outlineColor))),I.uniforms.add(new P.E("outlineColor",(t=>E(t)?t.outlineColor:n.uY)),new S.m("outlineSize",(t=>E(t)?t.outlineSize:0)))),t.horizonCullingEnabled&&s.uniforms.add(new w.V("pointDistanceSphere",((t,e)=>{const i=e.camera.eye,r=t.origin;return(0,n.fA)(r[0]-i[0],r[1]-i[1],r[2]-i[2],o.$O.radius)}))),t.pixelSnappingEnabled&&s.include(c.K),t.hasScreenSizePerspective&&((0,v.pM)(s),(0,v.OH)(s)),t.debugDrawLabelBorder&&e.varyings.add("debugBorderCoords","vec4"),e.attributes.add(R.r.UV0,"vec2"),e.attributes.add(R.r.COLOR,"vec4"),e.attributes.add(R.r.SIZE,"vec2"),e.attributes.add(R.r.ROTATION,"float"),e.attributes.add(R.r.FEATUREATTRIBUTE,"vec4"),s.code.add(t.horizonCullingEnabled?C.H`bool behindHorizon(vec3 posModel) {
vec3 camToEarthCenter = pointDistanceSphere.xyz - localOrigin;
vec3 camToPos = pointDistanceSphere.xyz + posModel;
float earthRadius = pointDistanceSphere.w;
float a = dot(camToPos, camToPos);
float b = dot(camToPos, camToEarthCenter);
float c = dot(camToEarthCenter, camToEarthCenter) - earthRadius * earthRadius;
return  b > 0.0 && b < a && b * b  > a * c;
}`:C.H`bool behindHorizon(vec3 posModel) { return false; }`),s.main.add(C.H`
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }

      if (behindHorizon(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }

      vec2 inputSize;
      ${(0,C.If)(t.hasScreenSizePerspective,C.H`
          inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
          vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);`,C.H`
          inputSize = size;
          vec2 screenOffsetScaled = screenOffset;`)}
      ${(0,C.If)(t.vvSize,C.H`inputSize *= vvScale(featureAttribute).xx;`)}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);
      bool visible = testHUDVisibility(posProj);
      voccluded = visible ? 0.0 : 1.0;
    `);const z=C.H`
      vec2 uv01 = floor(uv0);
      vec2 uv = uv0 - uv01;
      quadOffset.xy = (uv01 - anchorPosition) * 2.0 * combinedSize;

      ${(0,C.If)(t.hasRotation,C.H`
          float angle = radians(materialRotation + rotation);
          float cosAngle = cos(angle);
          float sinAngle = sin(angle);
          mat2 rotate = mat2(cosAngle, -sinAngle, sinAngle,  cosAngle);

          quadOffset.xy = rotate * quadOffset.xy;
        `)}

      quadOffset.xy = (quadOffset.xy + screenOffsetScaled) / viewport.zw * posProj.w;
  `,N=t.pixelSnappingEnabled?i?C.H`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:C.H`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:C.H`posProj += quadOffset;`;s.main.add(C.H`
    ${(0,C.If)(t.occlusionTestEnabled,C.H`
      if (!visible) {
        vtc = vec2(0.0);
        ${(0,C.If)(t.debugDrawLabelBorder,"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);")}
        return;
      }`)}
    ${z}
    ${t.vvColor?"vcolor = interpolateVVColor(featureAttribute.y) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    ${(0,C.If)(t.output===a.V.ObjectAndLayerIdColor,C.H`vcolor.a = 1.0;`)}

    bool alphaDiscard = vcolor.a < ${C.H.float(g.Q)};
    ${(0,C.If)(i,`alphaDiscard = alphaDiscard && outlineColor.a < ${C.H.float(g.Q)};`)}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${N}
      gl_Position = posProj;
    }

    vtc = uv;

    ${(0,C.If)(t.debugDrawLabelBorder,C.H`debugBorderCoords = vec4(uv01, 1.5 / combinedSize);`)}
    vsize = inputSize;
  `),I.uniforms.add(new M.N("tex",(t=>t.texture))),t.occludedFragmentFade&&(I.uniforms.add(new M.N("depthMap",((t,e)=>e.mainDepth))),I.uniforms.add(new S.m("fadeFactor",(()=>O.occludedFadeFactor))));const F=t.debugDrawLabelBorder?C.H`(isBorder > 0.0 ? 0.0 : ${C.H.float(g.Q)})`:C.H.float(g.Q),k=t.output===a.V.Highlight,V=C.H`
    ${(0,C.If)(t.debugDrawLabelBorder,C.H`float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`)}

    ${(0,C.If)(t.sampleSignedDistanceFieldTexelCenter,C.H`
      float txSize = float(textureSize(tex, 0).x);
      float texelSize = 1.0 / txSize;

      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;`,C.H`vec2 samplePos = vtc;`)}

    ${i?C.H`
      vec4 fillPixelColor = vcolor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${F} ||
          fillPixelColor.a + outlinePixelColor.a < ${C.H.float(g.Q)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        ${(0,C.If)(!k,C.H`fragColor = vec4(compositeColor, compositeAlpha);`)}
      } else {
        if (fillAlphaFactor < ${F}) {
          discard;
        }

        ${(0,C.If)(!k,C.H`fragColor = premultiplyAlpha(fillPixelColor);`)}
      }

      // visualize SDF:
      // fragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:C.H`
          vec4 texColor = texture(tex, vtc, -0.5);
          if (texColor.a < ${F}) {
            discard;
          }
          ${(0,C.If)(!k,C.H`fragColor = texColor * premultiplyAlpha(vcolor);`)}
          `}

    ${(0,C.If)(t.occludedFragmentFade&&!k,C.H`
        float zSample = texelFetch(depthMap, ivec2(gl_FragCoord.xy), 0).x;
        if (zSample < gl_FragCoord.z) {
          fragColor *= fadeFactor;
        }
        `)}

    ${(0,C.If)(!k&&t.debugDrawLabelBorder,C.H`fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`)}
  `;switch(t.output){case a.V.Color:t.oitPass===A.Y.ColorAlpha&&(e.outputs.add("fragColor","vec4",0),e.outputs.add("fragAlpha","float",1)),I.main.add(C.H`
        ${V}
        ${(0,C.If)(t.oitPass===A.Y.FrontFace,C.H`fragColor.rgb /= fragColor.a;`)}
        ${(0,C.If)(t.oitPass===A.Y.ColorAlpha,C.H`fragAlpha = fragColor.a;`)}`);break;case a.V.ObjectAndLayerIdColor:I.main.add(C.H`
        ${V}
        outputObjectAndLayerIdColor();`);break;case a.V.Highlight:e.include(p.Q,t),I.main.add(C.H`
        ${V}
        outputHighlight(voccluded == 1.0);`)}return e}function E(t){return t.outlineColor[3]>0&&t.outlineSize>0}function L(t,e=D){return t.textureIsSignedDistanceField?function(t,e,i){null!=e?(0,r.hZ)(i,t[0]*(e[2]-e[0])+e[0],t[1]*(e[3]-e[1])+e[1]):(0,r.hZ)(i,0,0)}(t.anchorPosition,t.distanceFieldBoundingBox,e):(0,r.C)(e,t.anchorPosition),e}const D=(0,s.vt)(),z=Object.freeze(Object.defineProperty({__proto__:null,build:I,calculateAnchorPosForRendering:L,shaderSettings:O},Symbol.toStringTag,{value:"Module"}))},82186:function(t,e,i){i.d(e,{H:function(){return u},b:function(){return c}});var r=i(28721),s=i(74571),n=i(14543),o=i(50295),a=i(39506),l=i(62988),h=i(39838);function c(){const t=new l.N5;t.include(r.Q);const{fragment:e}=t;return e.uniforms.add(new h.N("highlightTexture",(t=>t.highlightTexture)),new h.N("highlightOptionsTexture",(t=>t.highlightOptionsTexture)),new n.m("pixelRatio",(t=>t.pixelRatio)),new n.m("occludedIntensityFactor",(t=>t.occludedFactor)),new o.c("maxHighlightLevel",(t=>t.maxHighlightLevel))),e.constants.add("pixelSampleScale","float",1),t.include(s.y),e.code.add(a.H`const float pascal17[9] = float[9](12870.0, 11440.0, 8008.0, 4368.0, 1820.0, 560.0, 120.0, 16.0, 1.0);
const float denom17 =  65536.0;
float colorWeight[16] = float[16](0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0);
float colorOcclusion[16] = float[16](0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0);
float weights[16] = float[16](0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0);
void applyTexel(vec2 texel, float weight) {
if (texel != vec2(0.0)){
int maxChannel = (maxHighlightLevel >> 2) & 1;
for (int channelIndex = 0; channelIndex <= maxChannel; ++channelIndex){
uint channel = readChannel(texel, channelIndex << 2);
int firstIndex = channelIndex << 2;
int maxIndex  = min(firstIndex + 3, maxHighlightLevel);
for (int highlightIndex = firstIndex; highlightIndex <= maxIndex; ++highlightIndex ) {
uint v = readChannelBits(channel, highlightIndex);
if ((v & 1u) == 1u){
colorWeight[highlightIndex] += weight;
if ((v & 2u) == 2u){
colorOcclusion[highlightIndex] += weight;
}
}
}
}
}
}
vec2 readTexel(ivec2 iuv, int du, int dv) {
return texelFetch(highlightTexture, iuv + ivec2(du, dv), 0).rg;
}
void readAndApplyTexel(ivec2 iuv, int du, int dv, float weight) {
vec2 texel = readTexel(iuv, du, dv);
applyTexel(texel, weight);
}
void readAndApply2TexelsU(ivec2 iuv, int du, int dv, float weight) {
readAndApplyTexel(iuv, -du, dv, weight);
readAndApplyTexel(iuv, +du, dv, weight);
}
float getWeight(int pixelDistance) {
float scaledDistance = float(pixelDistance) * pixelSampleScale / pixelRatio;
float d0f = floor(scaledDistance);
int d0 = int(d0f);
if (d0 >= 8){
return 0.0;
}
float w0 = pascal17[d0];
float w1 = pascal17[d0+1];
float f =  scaledDistance - d0f;
return mix(w0, w1, f);
}`),e.main.add(a.H`vec2 highlightTextureSize = vec2(textureSize(highlightTexture,0));
ivec2 iuv = ivec2(sUV * highlightTextureSize);
vec2 centerTexel = texelFetch(highlightTexture, iuv, 0).rg;
bool outlinePossible = false;
if (vOutlinePossible > 0.0){
for (int highlightLevel=0; highlightLevel<= maxHighlightLevel; ++highlightLevel) {
if ((readLevelBits(centerTexel,highlightLevel) & 1u) == 0u) {
outlinePossible = true;
break;
}
}
}
if (outlinePossible) {
int maxPixelDistance = clamp(int(8.0 * pixelRatio / pixelSampleScale), 2, 16);
float weightSum = 0.0;
for(int y = 0; y <= maxPixelDistance; ++y) {
float w = getWeight(y);
weights[y] = w;
weightSum += w * (y == 0 ? 1.0 : 2.0);
}
for(int y = 0; y <= maxPixelDistance; ++y) {
weights[y] = weights[y] / weightSum;
}
float weight0 = weights[0];
applyTexel(centerTexel, weight0 * weight0);
for(int y = 0; y <= maxPixelDistance; y += 1) {
float yFactor = weights[y];
if (y != 0) {
float xFactor = weight0;
float weight = xFactor * yFactor;
if (weight > 0.0) {
readAndApplyTexel(iuv, 0, +y, weight);
readAndApplyTexel(iuv, 0, -y, weight);
}
}
for(int x = 1; x <= maxPixelDistance; x += 1) {
float xFactor = weights[x];
float weight = xFactor * yFactor;
if (weight > 0.0) {
readAndApply2TexelsU(iuv, x, +y, weight);
if (y != 0){
readAndApply2TexelsU(iuv, x, -y, weight);
}
}
}
}
} else {
applyTexel(centerTexel, 1.0);
}
int frontColorIndex = 999;
int maxColorIndex = 0;
for (int i = 0; i <= maxHighlightLevel; ++i) {
if (colorWeight[i] > 0.0){
frontColorIndex = min(frontColorIndex, i);
maxColorIndex = max(maxColorIndex, i);
}
}
if (frontColorIndex == 999){
fragColor = vec4(0.0);
return;
}
vec4 accumulatedColor = vec4(0.0);
for (int curColorIndex = frontColorIndex; curColorIndex <= maxColorIndex; ++curColorIndex) {
float curColorWeight = colorWeight[curColorIndex];
if (curColorWeight <= 0.01){
continue;
}
uint vc = readLevelBits(centerTexel, curColorIndex);
bool centerFilled = (vc & 1u) == 1u;
bool centerOccluded = (vc & 3u) == 3u;
float curColorOcclusion = colorOcclusion[curColorIndex];
bool occluded = centerFilled ? centerOccluded : curColorOcclusion > 0.5 * curColorWeight;
int colorChannel = centerFilled ? 0 : 1;
vec4 colorBase = texelFetch(highlightOptionsTexture, ivec2(curColorIndex, colorChannel), 0);
float occlusionFactor = occluded ? occludedIntensityFactor : 1.0;
float outlineFactor = centerFilled ? 1.0 : smoothstep(0.0, 0.03, curColorWeight);
float intensity = colorBase.a * occlusionFactor * outlineFactor;
vec3 currentColor = colorBase.rgb;
float a0 = accumulatedColor.a;
float a1 = intensity;
float alpha = clamp(a0 + a1 - a0 * a1, 0.0, 1.0);
if (alpha > 0.001){
vec3 blendedColor = ((1.0 - a1) * a0 * accumulatedColor.rgb + a1 * currentColor) / alpha;
accumulatedColor = vec4(blendedColor, alpha);
}
}
fragColor = accumulatedColor;`),t}const u=Object.freeze(Object.defineProperty({__proto__:null,build:c},Symbol.toStringTag,{value:"Module"}))},40434:function(t,e,i){i.d(e,{H:function(){return a},a:function(){return d},b:function(){return u},c:function(){return l},g:function(){return h},o:function(){return c}});var r=i(77423),s=i(39506),n=i(62988),o=i(40075);class a extends s.Y{}function l(){const t=new n.N5,{outputs:e,fragment:i}=t;return t.include(r.c),i.uniforms.add(new o.o("textureInput",(t=>t.input))),i.constants.add("outlineWidth","int",Math.ceil(c)),i.constants.add("cellSize","int",h),e.add("fragGrid","vec2"),i.main.add(s.H`vec2 inputTextureSize = vec2(textureSize(textureInput, 0));
vec2 cellBottomLeftCornerInput = floor(gl_FragCoord.xy) * vec2(cellSize);
vec2 coordMid =  (cellBottomLeftCornerInput + 0.5 * vec2(cellSize)) / inputTextureSize;
vec2 commonValue = texture(textureInput, coordMid).rg;
int margin = outlineWidth;
float marginSquare = float(margin*margin);
for(int y = -margin; y <= cellSize + margin; y+=2) {
int dy = y < 0 ? -y : y > cellSize ? y-cellSize : 0;
int xMargin = dy > 0 ? int(ceil(sqrt(marginSquare - float(dy*dy)))) : margin;
for(int x = -xMargin; x <= cellSize + xMargin; x+=2) {
vec2 coord = (cellBottomLeftCornerInput + vec2(x, y)) / inputTextureSize;
vec2 value = texture(textureInput, coord).rg;
if (value != commonValue){
fragGrid = vec2(1.0, 1.0);
return;
}
}
}
bool hasAny = commonValue != vec2(0.0);
fragGrid = vec2(hasAny ? 1.0 : 0.0, 0.0);`),t}const h=32,c=9,u=.4,d=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:a,blurSize:u,build:l,gridCellPixelSize:h,outlineSize:c},Symbol.toStringTag,{value:"Module"}))},46655:function(t,e,i){i.d(e,{H:function(){return c},b:function(){return h}});var r=i(28721),s=i(74571),n=i(50295),o=i(39506),a=i(62988),l=i(39838);function h(){const t=new a.N5;t.include(r.Q),t.include(s.y);const{fragment:e}=t;return t.outputs.add("fragSingleHighlight","vec2",0),e.uniforms.add(new l.N("highlightTexture",(t=>t.highlightTexture)),new n.c("maxHighlightLevel",(t=>t.maxHighlightLevel)),new n.c("highlightLevel",(t=>t.highlightLevel))),t.include(s.y),e.main.add(o.H`ivec2 iuv = ivec2(gl_FragCoord.xy);
vec2 inputTexel = texelFetch(highlightTexture, iuv, 0).rg;
uint bits = readLevelBits(inputTexel, highlightLevel);
bool hasHighlight = (bits & 1u) == 1u;
bool hasOccluded  = (bits & 2u) == 2u;
fragSingleHighlight = vec2(hasHighlight ? 1.0 : 0.0, hasOccluded ? 1.0 : 0.0);`),t}const c=Object.freeze(Object.defineProperty({__proto__:null,build:h},Symbol.toStringTag,{value:"Module"}))},88630:function(t,e,i){i.d(e,{L:function(){return S},b:function(){return P}});var r=i(33710),s=i(27264),n=i(13668),o=i(55123),a=i(84435),l=i(91981),h=i(77771),c=i(23864),u=i(52766),d=i(20830),f=i(11687),p=i(38917),m=i(14543),g=i(39506),_=i(70340),y=i(62988),v=i(39838),x=i(65839),b=i(50678),w=i(25124);function P(t){const e=new y.N5,i=t.terrainDepthTest&&t.output===s.V.Color,P=t.space===b.lM.World;e.include(o.s,t),e.include(l.r,t);const{vertex:S,fragment:C}=e;return C.include(u.W),(0,d.NB)(S,t),e.attributes.add(x.r.POSITION,"vec3"),e.attributes.add(x.r.PREVPOSITION,"vec3"),e.attributes.add(x.r.UV0,"vec2"),e.varyings.add("vColor","vec4"),e.varyings.add("vpos","vec3"),e.varyings.add("vUV","vec2"),e.varyings.add("vSize","float"),i&&e.varyings.add("depth","float"),t.hasTip&&e.varyings.add("vLineWidth","float"),S.uniforms.add(new f.G("nearFar",((t,e)=>e.camera.nearFar)),new p.E("viewport",((t,e)=>e.camera.fullViewport))),S.code.add(g.H`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),S.code.add(g.H`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
float interpolation = (-vnp - pos.z) / (prev.z - pos.z);
prev = mix(pos, prev, interpolation);
}
}`),P?(e.attributes.add(x.r.NORMAL,"vec3"),(0,d.S7)(S),S.constants.add("tiltThreshold","float",.7),S.code.add(g.H`vec3 perpendicular(vec3 v) {
vec3 n = (viewNormal * vec4(normal.xyz, 1.0)).xyz;
vec3 n2 = cross(v, n);
vec3 forward = vec3(0.0, 0.0, 1.0);
float tiltDot = dot(forward, n);
return abs(tiltDot) < tiltThreshold ? n : n2;
}`)):S.code.add(g.H`vec2 perpendicular(vec2 v) {
return vec2(v.y, -v.x);
}`),S.code.add(g.H`
      #define vecN ${P?"vec3":"vec2"}

      vecN normalizedSegment(vecN pos, vecN prev) {
        vecN segment = pos - prev;
        float segmentLen = length(segment);

        // normalize or zero if too short
        return (segmentLen > 0.001) ? segment / segmentLen : ${P?"vec3(0.0, 0.0, 0.0)":"vec2(0.0, 0.0)"};
      }

      vecN displace(vecN pos, vecN prev, float displacementLen) {
        vecN segment = normalizedSegment(pos, prev);

        vecN displacementDirU = perpendicular(segment);
        vecN displacementDirV = segment;

        ${t.anchor===b.kJ.Tip?"pos -= 0.5 * displacementLen * displacementDirV;":""}

        return pos + displacementLen * (uv0.x * displacementDirU + uv0.y * displacementDirV);
      }
    `),t.space===b.lM.Screen&&(S.uniforms.add(new _.X("inverseProjectionMatrix",((t,e)=>e.camera.inverseProjectionMatrix))),S.code.add(g.H`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),S.code.add(g.H`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),S.uniforms.add(new m.m("perScreenPixelRatio",((t,e)=>e.camera.perScreenPixelRatio))),S.code.add(g.H`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${t.hasCap?"\n                if(prev.z > posLeft.z) {\n                  vec2 diff = posLeft.xy - posRight.xy;\n                  planeOrigin.xy += perpendicular(diff) / 2.0;\n                }\n              ":""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `)),(0,d.Nz)(S),S.main.add(g.H`
    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      float lineWidth = getLineWidth();
      float screenMarkerSize = getScreenMarkerSize();

      vec4 pos  = view * vec4(position, 1.0);
      vec4 prev = view * vec4(prevPosition, 1.0);
      clip(pos, prev);

      ${P?g.H`${t.hideOnShortSegments?g.H`
                  if (areWorldMarkersHidden(pos, prev)) {
                    // Project out of clip space
                    gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
                    return;
                  }`:""}
            pos.xyz = displace(pos.xyz, prev.xyz, getWorldMarkerSize(pos));
            vec4 displacedPosScreen = projectAndScale(pos);`:g.H`
            vec4 posScreen = projectAndScale(pos);
            vec4 prevScreen = projectAndScale(prev);
            vec4 displacedPosScreen = posScreen;

            displacedPosScreen.xy = displace(posScreen.xy, prevScreen.xy, screenMarkerSize);
            ${t.space===b.lM.Screen?g.H`
                vec2 displacementDirU = perpendicular(normalizedSegment(posScreen.xy, prevScreen.xy));

                // We need three points of the ribbon line in camera space to calculate the plane it lies in
                // Note that we approximate the third point, since we have no information about the join around prev
                vec3 lineRight = inverseProject(posScreen + lineWidth * vec4(displacementDirU.xy, 0.0, 0.0));
                vec3 lineLeft = pos.xyz + (pos.xyz - lineRight);

                pos = toFront(displacedPosScreen, lineLeft, lineRight, prev.xyz, lineWidth);
                displacedPosScreen = projectAndScale(pos);`:""}`}

      ${i?"depth = pos.z;":""}

      // Convert back into NDC
      displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

      // Convert texture coordinate into [0,1]
      vUV = (uv0 + 1.0) / 2.0;
      ${P?"":"vUV *= displacedPosScreen.w;"}
      ${t.hasTip?"vLineWidth = lineWidth;":""}

      vSize = screenMarkerSize;
      vColor = getColor();

      // Use camera space for slicing
      vpos = pos.xyz;

      gl_Position = displacedPosScreen;
    }`),i&&e.include(h.Z,t),e.include(n.HQ,t),e.include(w.z,t),C.uniforms.add(new p.E("intrinsicColor",(t=>t.color)),new v.N("tex",(t=>t.markerTexture))),C.include(c.a),C.constants.add("texelSize","float",1/r.vO),C.code.add(g.H`float markerAlpha(vec2 samplePos) {
samplePos += vec2(0.5, -0.5) * texelSize;
float sdf = rgba2float(texture(tex, samplePos)) - 0.5;
float distance = sdf * vSize;
distance -= 0.5;
return clamp(0.5 - distance, 0.0, 1.0);
}`),t.hasTip&&C.constants.add("relativeMarkerSize","float",r.Cz/r.vO).constants.add("relativeTipLineWidth","float",r.DZ).code.add(g.H`
    float tipAlpha(vec2 samplePos) {
      // Convert coordinates s.t. they are in pixels and relative to the tip of an arrow marker
      samplePos -= vec2(0.5, 0.5 + 0.5 * relativeMarkerSize);
      samplePos *= vSize;

      float halfMarkerSize = 0.5 * relativeMarkerSize * vSize;
      float halfTipLineWidth = 0.5 * max(1.0, relativeTipLineWidth * vLineWidth);

      ${P?"halfTipLineWidth *= fwidth(samplePos.y);":""}

      float distance = max(abs(samplePos.x) - halfMarkerSize, abs(samplePos.y) - halfTipLineWidth);
      return clamp(0.5 - distance, 0.0, 1.0);
    }
  `),e.include(a.Q,t),C.main.add(g.H`
    discardBySlice(vpos);
    ${i?"terrainDepthTest(depth);":""}

    vec4 finalColor = intrinsicColor * vColor;
    ${P?"vec2 samplePos = vUV;":"vec2 samplePos = vUV * gl_FragCoord.w;"}
    ${t.hasTip?"finalColor.a *= max(markerAlpha(samplePos), tipAlpha(samplePos));":"finalColor.a *= markerAlpha(samplePos);"}
    outputColorHighlightOID(finalColor, vpos);`),e}const S=Object.freeze(Object.defineProperty({__proto__:null,build:P},Symbol.toStringTag,{value:"Module"}))},59121:function(t,e,i){i.d(e,{N:function(){return g},b:function(){return m}});var r=i(27264),s=i(13668),n=i(34178),o=i(85709),a=i(84435),l=i(28686),h=i(20830),c=i(38917),u=i(14543),d=i(39506),f=i(62988),p=i(65839);function m(t){const e=new f.N5,{vertex:i,fragment:m}=e;return e.include(n.d,t),e.include(o.c,t),(0,h.NB)(i,t),e.attributes.add(p.r.POSITION,"vec3"),e.varyings.add("vpos","vec3"),i.main.add(d.H`vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);`),e.include(a.Q,t),e.include(s.HQ,t),m.uniforms.add(new u.m("alphaCoverage",((t,e)=>Math.min(1,t.width*e.camera.pixelRatio)))),t.hasVertexColors||m.uniforms.add(new c.E("constantColor",(t=>t.color))),m.main.add(d.H`
    discardBySlice(vpos);

    vec4 color = ${t.hasVertexColors?"vColor":"constantColor"};

    ${t.output===r.V.ObjectAndLayerIdColor?"color.a = 1.0;":""}

    if (color.a < ${d.H.float(l.Q)}) {
      discard;
    }

    ${t.output===r.V.Color?d.H`fragColor = highlightSlice(color, vpos);`:""}
    calculateOcclusionAndOutputHighlight();
  `),e}const g=Object.freeze(Object.defineProperty({__proto__:null,build:m},Symbol.toStringTag,{value:"Module"}))},94010:function(t,e,i){i.d(e,{O:function(){return c},a:function(){return d},b:function(){return u}});var r=i(86398),s=i(77423),n=i(14543),o=i(50295),a=i(39506),l=i(62988),h=i(39838);class c extends a.Y{constructor(){super(...arguments),this.overlayIndex=r.vr.INNER,this.opacity=1}}function u(){const t=new l.N5;return t.include(s.c),t.fragment.uniforms.add(new h.N("tex",(t=>t.texture))),t.fragment.uniforms.add(new o.c("overlayIdx",(t=>t.overlayIndex))),t.fragment.uniforms.add(new n.m("opacity",(t=>t.opacity))),t.fragment.main.add(a.H`vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
fragColor = texture(tex, overlayUV) * opacity;`),t}const d=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:c,build:u},Symbol.toStringTag,{value:"Module"}))},39387:function(t,e,i){i.d(e,{P:function(){return M},b:function(){return T}});var r=i(30087),s=i(27264),n=i(13668),o=i(34178),a=i(27271),l=i(26762),h=i(84464),c=i(84435),u=i(32488),d=i(97910),f=i(42426),p=i(50865),m=i(69701),g=i(11520),_=i(56574),y=i(77771),v=i(23864),x=i(20830),b=i(82598),w=i(14543),P=i(39506),S=i(62988),C=i(25124);function T(t){const e=new S.N5,{vertex:i,fragment:T}=e;(0,x.NB)(i,t),e.varyings.add("vpos","vec3"),e.include(l.H,t);const{output:M,spherical:A,pbrMode:R,receiveShadows:O}=t,I=(0,s.RN)(M);switch((I||M===s.V.ObjectAndLayerIdColor)&&(e.include(o.d,t),e.include(_.Bz,t),e.include(r.oD,t),e.include(a.g,t),e.varyings.add("vnormal","vec3"),e.varyings.add("vcolor","vec4"),t.terrainDepthTest&&e.varyings.add("depth","float"),i.main.add(P.H`
      vpos = calculateVPos();
      vnormal = normalize(localNormal());

      ${t.terrainDepthTest?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = transformPosition(proj, view, vpos);

      ${I?"forwardLinearDepth();":""}
      forwardObjectAndLayerIdColor();

      vcolor = getColor();`)),e.include(y.Z,t),M){case s.V.ColorEmission:case s.V.Color:e.include(g._Z,t),e.include(d.kA,t),e.include(u.n,t),e.include(_.Bz,t),e.include(p.r,t),e.include(n.HQ,t),e.include(C.z,t),(0,x.yu)(T,t),(0,d.a8)(T),(0,d.eU)(T),T.uniforms.add(i.uniforms.get("localOrigin"),new b.t("ambient",(t=>t.ambient)),new b.t("diffuse",(t=>t.diffuse)),new b.t("specular",(t=>t.specular)),new w.m("opacity",(t=>t.opacity))),T.include(v.a),(0,f.O4)(T),T.main.add(P.H`
        discardBySlice(vpos);
        ${t.terrainDepthTest?P.H`terrainDepthTest(depth);`:""}

        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        shadingParams.normalView = vnormal;
        vec3 normal = shadingNormal(shadingParams);
        float ssao = evaluateAmbientOcclusionInverse();

        vec3 posWorld = vpos + localOrigin;
        vec3 normalGround = ${A?"normalize(posWorld);":"vec3(0.0, 0.0, 1.0);"}

        float additionalAmbientScale = additionalDirectedAmbientLight(posWorld);
        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        float shadow = ${O?"max(lightingGlobalFactor * (1.0 - additionalAmbientScale), readShadowMap(vpos, linearDepth));":A?"lightingGlobalFactor * (1.0 - additionalAmbientScale);":"0.0;"}
        vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
        float combinedOpacity = vcolor.a * opacity;
        albedo += 0.25 * specular; // don't completely ignore specular for now

        ${(0,P.If)(R===g.A9.Schematic,"float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];\n           vec4 emission = getEmissions();")}

        vec3 shadedColor = ${R===g.A9.Schematic?"evaluateSceneLightingPBR(normal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);":"evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);"}
        vec4 finalColor = vec4(shadedColor, combinedOpacity);
        outputColorHighlightOID(finalColor, vpos);`);break;case s.V.Depth:e.include(o.d,t),i.main.add(P.H`vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);`),e.include(n.HQ,t),T.main.add(P.H`discardBySlice(vpos);`);break;case s.V.Shadow:case s.V.ShadowHighlight:case s.V.ShadowExcludeHighlight:case s.V.ViewshedShadow:e.include(o.d,t),(0,r.xJ)(e),e.varyings.add("depth","float"),i.main.add(P.H`vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);`),e.include(n.HQ,t),e.include(h.L,t),T.main.add(P.H`discardBySlice(vpos);
outputDepth(depth);`);break;case s.V.ObjectAndLayerIdColor:e.include(n.HQ,t),T.main.add(P.H`discardBySlice(vpos);
outputObjectAndLayerIdColor();`);break;case s.V.Normal:e.include(o.d,t),e.include(m.n,t),(0,x.S7)(i),e.varyings.add("vnormal","vec3"),i.main.add(P.H`vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);`),e.include(n.HQ,t),T.main.add(P.H`discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
fragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);`);break;case s.V.Highlight:e.include(o.d,t),e.include(m.n,t),e.varyings.add("vnormal","vec3"),i.main.add(P.H`vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);`),e.include(n.HQ,t),e.include(c.Q,t),T.main.add(P.H`discardBySlice(vpos);
calculateOcclusionAndOutputHighlight();`)}return e}const M=Object.freeze(Object.defineProperty({__proto__:null,build:T},Symbol.toStringTag,{value:"Module"}))},25770:function(t,e,i){i.d(e,{P:function(){return C},b:function(){return S}});var r=i(27264),s=i(13668),n=i(34178),o=i(27271),a=i(85709),l=i(77771),h=i(58766),c=i(23864),u=i(20830),d=i(38917),f=i(14543),p=i(39506),m=i(62988),g=i(65839),_=i(67721),y=i(25124);const v=.70710678118,x=v,b=.08715574274,w=10,P=1;function S(t){const e=new m.N5,{vertex:i,fragment:S,attributes:C,varyings:T}=e,M=t.terrainDepthTest&&t.output===r.V.Color,A=t.output===r.V.Highlight;(0,u.NB)(i,t),e.include(n.d,t),e.include(a.c,t),e.include(h.A,t),e.include(o.g,t),e.include(s.HQ,t),e.include(y.z,t),t.draped?i.uniforms.add(new f.m("worldToScreenRatio",((t,e)=>1/e.screenToPCSRatio))):C.add(g.r.BOUNDINGRECT,"mat3"),C.add(g.r.POSITION,"vec3"),C.add(g.r.UVMAPSPACE,"vec4"),t.vvColor&&C.add(g.r.COLORFEATUREATTRIBUTE,"float"),T.add("vColor","vec4"),T.add("vpos","vec3"),T.add("vuv","vec2"),M&&T.add("depth","float"),i.uniforms.add(new d.E("uColor",(t=>t.color)));const R=t.style===_.O.ForwardDiagonal||t.style===_.O.BackwardDiagonal||t.style===_.O.DiagonalCross;return R&&i.code.add(p.H`
      const mat2 rotate45 = mat2(${p.H.float(v)}, ${p.H.float(-x)},
                                 ${p.H.float(x)}, ${p.H.float(v)});
    `),t.draped||((0,u.yu)(i,t),i.uniforms.add(new f.m("worldToScreenPerDistanceRatio",((t,e)=>1/e.camera.perScreenPixelRatio))),i.code.add(p.H`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),i.code.add(p.H`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),i.code.add(p.H`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${p.H.float(b)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `)),i.code.add(p.H`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${R?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${R?" * rotate45":""};

      ${t.draped?"":p.H`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${p.H.float(w)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `),i.main.add(p.H`
    vuv = scaledUV();
    vpos = position;
    ${M?"depth = (view * vec4(vpos, 1.0)).z;":""}
    forwardNormalizedVertexColor();
    forwardObjectAndLayerIdColor();
    ${t.hasVertexColors?"vColor *= uColor;":t.vvColor?"vColor = uColor * interpolateVVColor(colorFeatureAttribute);":"vColor = uColor;"}
    gl_Position = transformPosition(proj, view, vpos);
  `),S.include(c.a),t.draped&&S.uniforms.add(new f.m("texelSize",((t,e)=>1/e.camera.pixelRatio))),M&&e.include(l.Z,t),A||(S.code.add(p.H`
      const float lineWidth = ${p.H.float(P)};
      const float spacing = ${p.H.float(w)};
      const float spacingINV = ${p.H.float(1/w)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),t.draped||S.code.add(p.H`const int maxSamples = 5;
float sampleAA(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`)),S.main.add(p.H`
    discardBySlice(vpos);
    ${M?"terrainDepthTest(depth);":""}
    vec4 color = vColor;
    ${A?"":p.H`color.a *= ${function(t){function e(e){return t.draped?p.H`coverage(vuv.${e}, texelSize)`:p.H`sampleAA(vuv.${e})`}switch(t.style){case _.O.ForwardDiagonal:case _.O.Horizontal:return e("y");case _.O.BackwardDiagonal:case _.O.Vertical:return e("x");case _.O.DiagonalCross:case _.O.Cross:return p.H`1.0 - (1.0 - ${e("x")}) * (1.0 - ${e("y")})`;default:return"0.0"}}(t)};`}
    outputColorHighlightOID(color, vpos);
  `),e}const C=Object.freeze(Object.defineProperty({__proto__:null,build:S},Symbol.toStringTag,{value:"Module"}))},966:function(t,e,i){i.d(e,{S:function(){return f},b:function(){return d}});var r=i(28721),s=i(74571),n=i(30262),o=i(14543),a=i(50295),l=i(39506),h=i(62988),c=i(39838),u=i(40434);function d(){const t=new h.N5;t.include(r.Q);const{fragment:e}=t;return e.uniforms.add(new c.N("blurInput",(t=>t.singleHighlightBlurTexture)),new n.t("blurSize",(t=>t.blurSize)),new c.N("highlightTexture",(t=>t.highlightTexture)),new c.N("highlightOptionsTexture",(t=>t.highlightOptionsTexture)),new a.c("highlightLevel",(t=>t.highlightLevel)),new o.m("occludedIntensityFactor",(t=>t.occludedFactor))),e.constants.add("inner","float",1-(u.o-u.b)/u.o),t.include(s.y),e.main.add(l.H`vec2 highlightTextureSize = vec2(textureSize(highlightTexture,0));
vec2 uv = sUV;
vec2 center = texture(blurInput, uv).rg;
vec2 blurredHighlightValue = (vOutlinePossible == 0.0)
? center
: center * 0.204164
+ texture(blurInput, uv + blurSize * 1.407333).rg * 0.304005
+ texture(blurInput, uv - blurSize * 1.407333).rg * 0.304005
+ texture(blurInput, uv + blurSize * 3.294215).rg * 0.093913
+ texture(blurInput, uv - blurSize * 3.294215).rg * 0.093913;
float highlightIntensity = blurredHighlightValue.r;
float occlusionWeight = blurredHighlightValue.g;
if (highlightIntensity <= 0.01) {
discard;
}
vec4 fillColor    = texelFetch(highlightOptionsTexture, ivec2(highlightLevel, 0), 0);
vec4 outlineColor = texelFetch(highlightOptionsTexture, ivec2(highlightLevel, 1), 0);
vec2 centerTexel = texelFetch(highlightTexture, ivec2(uv * highlightTextureSize), 0).rg;
uint centerBits = readLevelBits(centerTexel, highlightLevel);
bool centerFilled = (centerBits & 1u) == 1u;
bool centerOccluded = (centerBits & 3u) == 3u;
bool occluded = centerOccluded || (0.5 * highlightIntensity < occlusionWeight);
float occlusionFactor = occluded ? occludedIntensityFactor : 1.0;
float outlineFactor = centerFilled ? 1.0 : smoothstep(0.0, inner, highlightIntensity);
float fillFactor = centerFilled ? 1.0 : 0.0;
vec4 baseColor = mix(outlineColor, fillColor, fillFactor);
float intensity = baseColor.a * occlusionFactor * outlineFactor;
fragColor = vec4(baseColor.rgb, intensity);`),t}const f=Object.freeze(Object.defineProperty({__proto__:null,build:d},Symbol.toStringTag,{value:"Module"}))},2963:function(t,e,i){i.d(e,{S:function(){return h},a:function(){return u},b:function(){return c}});var r=i(1932),s=i(28721),n=i(30262),o=i(39506),a=i(62988),l=i(40075);class h extends o.Y{constructor(){super(...arguments),this.blurSize=(0,r.vt)()}}function c(){const t=new a.N5;return t.include(s.Q),t.fragment.uniforms.add(new n.t("blurSize",(t=>t.blurSize)),new l.o("blurInput",(t=>t.blurInput))),t.outputs.add("fragSingleHighlight","vec2",0),t.fragment.main.add(o.H`vec2 highlightTextureSize = vec2(textureSize(blurInput,0));
vec2 uv = sUV;
vec2 center = texture(blurInput, uv).rg;
if (vOutlinePossible == 0.0) {
fragSingleHighlight = center;
} else {
vec2 sum = center * 0.204164;
sum += texture(blurInput, uv + blurSize * 1.407333).rg * 0.304005;
sum += texture(blurInput, uv - blurSize * 1.407333).rg * 0.304005;
sum += texture(blurInput, uv + blurSize * 3.294215).rg * 0.093913;
sum += texture(blurInput, uv - blurSize * 3.294215).rg * 0.093913;
fragSingleHighlight = sum;
}`),t}const u=Object.freeze(Object.defineProperty({__proto__:null,SingleHighlightBlurDrawParameters:h,build:c},Symbol.toStringTag,{value:"Module"}))},55747:function(t,e,i){i.d(e,{T:function(){return h},a:function(){return u},b:function(){return c}});var r=i(32501),s=i(77423),n=i(82598),o=i(39506),a=i(62988),l=i(39838);class h extends o.Y{constructor(){super(...arguments),this.color=(0,r.fA)(1,1,1)}}function c(){const t=new a.N5;return t.include(s.c),t.fragment.uniforms.add(new l.N("tex",(t=>t.texture)),new n.t("uColor",(t=>t.color))),t.fragment.main.add(o.H`vec4 texColor = texture(tex, uv);
fragColor = texColor * vec4(uColor, 1.0);`),t}const u=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:h,build:c},Symbol.toStringTag,{value:"Module"}))},52352:function(t,e,i){i.d(e,{W:function(){return M},b:function(){return T}});var r=i(30087),s=i(27264),n=i(13668),o=i(34178),a=i(27271),l=i(84435),h=i(46042),c=i(42426),u=i(69701),d=i(11520),f=i(56574),p=i(77771),m=i(5830),g=i(15985),_=i(28686),y=i(23864),v=i(20830),x=i(38917),b=i(14543),w=i(39506),P=i(62988),S=i(65839),C=i(25124);function T(t){const e=new P.N5,{vertex:i,fragment:T}=e;(0,v.NB)(i,t),e.include(o.d,t),e.attributes.add(S.r.POSITION,"vec3"),e.attributes.add(S.r.UV0,"vec2");const M=new x.E("waterColor",(t=>t.color));if(t.output===s.V.Color&&t.draped)return e.varyings.add("vpos","vec3"),i.uniforms.add(M),i.main.add(w.H`
      if (waterColor.a < ${w.H.float(_.Q)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      vpos = position;
      gl_Position = transformPosition(proj, view, vpos);`),T.uniforms.add(M),T.main.add(w.H`fragColor = waterColor;`),e;switch(t.output===s.V.Color&&(e.include(u.n,t),e.include(r.oD,t),e.varyings.add("vuv","vec2"),e.varyings.add("vpos","vec3"),e.varyings.add("vnormal","vec3"),e.varyings.add("vtbnMatrix","mat3"),t.terrainDepthTest&&e.varyings.add("depth","float"),i.uniforms.add(M),i.main.add(w.H`
      if (waterColor.a < ${w.H.float(_.Q)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      vuv = uv0;
      vpos = position;

      vnormal = getLocalUp(vpos, localOrigin);
      vtbnMatrix = getTBNMatrix(vnormal);

      ${t.terrainDepthTest?"depth = (view * vec4(vpos, 1.0)).z;":""}

      gl_Position = transformPosition(proj, view, vpos);
      ${t.output===s.V.Color?"forwardLinearDepth();":""}`)),e.include(p.Z,t),t.output){case s.V.Color:e.include(h.W,{pbrMode:d.A9.Disabled,lightingSphericalHarmonicsOrder:2}),e.include(g.V),e.include(f.Bz,t),e.include(m.E,t),e.include(n.HQ,t),e.include(C.z,t),T.uniforms.add(M,new b.m("timeElapsed",(t=>t.timeElapsed)),i.uniforms.get("view"),i.uniforms.get("localOrigin")),(0,v.yu)(T,t),T.include(y.a),(0,c.Gc)(T),(0,c.O4)(T),T.main.add(w.H`
        discardBySlice(vpos);
        ${t.terrainDepthTest?"terrainDepthTest(depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${t.receiveShadows?w.H`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view * vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, mainLightDirection, waterColor.rgb, mainLightIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        fragColor = delinearizeGamma(final);
        outputColorHighlightOID(fragColor, vpos);`);break;case s.V.Normal:e.include(u.n,t),e.include(g.V,t),e.include(n.HQ,t),e.varyings.add("vpos","vec3"),e.varyings.add("vuv","vec2"),i.uniforms.add(M),i.main.add(w.H`
        if (waterColor.a < ${w.H.float(_.Q)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        gl_Position = transformPosition(proj, view, vpos);`),T.uniforms.add(new b.m("timeElapsed",(t=>t.timeElapsed))),T.main.add(w.H`discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
fragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);`);break;case s.V.Highlight:e.include(l.Q,t),e.varyings.add("vpos","vec3"),i.uniforms.add(M),i.main.add(w.H`
        if (waterColor.a < ${w.H.float(_.Q)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);`),e.include(n.HQ,t),T.main.add(w.H`discardBySlice(vpos);
calculateOcclusionAndOutputHighlight();`);break;case s.V.ObjectAndLayerIdColor:e.include(a.g,t),e.varyings.add("vpos","vec3"),i.uniforms.add(M),i.main.add(w.H`
        if (waterColor.a < ${w.H.float(_.Q)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
        forwardObjectAndLayerIdColor();`),e.include(n.HQ,t),T.main.add(w.H`discardBySlice(vpos);
outputObjectAndLayerIdColor();`)}return e}const M=Object.freeze(Object.defineProperty({__proto__:null,build:T},Symbol.toStringTag,{value:"Module"}))},59122:function(t,e,i){function r(t,e,i){i=i||2;var r,n,a,l,h,c,d,f=e&&e.length,p=f?e[0]*i:t.length,m=s(t,0,p,i,!0),g=[];if(!m||m.next===m.prev)return g;if(f&&(m=u(t,e,m,i)),t.length>80*i){r=a=t[0],n=l=t[1];for(var _=i;_<p;_+=i)(h=t[_])<r&&(r=h),(c=t[_+1])<n&&(n=c),h>a&&(a=h),c>l&&(l=c);d=0!==(d=Math.max(a-r,l-n))?1/d:0}return o(m,g,i,r,n,d),g}function s(t,e,i,r,s){var n,o;if(s===I(t,e,i,r)>0)for(n=e;n<i;n+=r)o=A(n,t[n],t[n+1],o);else for(n=i-r;n>=e;n-=r)o=A(n,t[n],t[n+1],o);if(o&&w(o,o.next)){var a=o.next;R(o),o=a}return o}function n(t,e){if(!t)return t;e||(e=t);var i,r=t;do{if(i=!1,r.steiner||!w(r,r.next)&&0!==b(r.prev,r,r.next))r=r.next;else{var s=r.prev;if(R(r),(r=e=s)===r.next)break;i=!0}}while(i||r!==e);return e}function o(t,e,i,r,s,u,d){if(t){!d&&u&&g(t,r,s,u);for(var f,p,m=t;t.prev!==t.next;)if(f=t.prev,p=t.next,u?l(t,r,s,u):a(t))e.push(f.i/i),e.push(t.i/i),e.push(p.i/i),R(t),t=p.next,m=p.next;else if((t=p)===m){d?1===d?o(t=h(n(t),e,i),e,i,r,s,u,2):2===d&&c(t,e,i,r,s,u):o(n(t),e,i,r,s,u,1);break}}}function a(t){var e=t.prev,i=t,r=t.next;if(b(e,i,r)>=0)return!1;for(var s=t.next.next;s!==t.prev;){if(v(e.x,e.y,i.x,i.y,r.x,r.y,s.x,s.y)&&b(s.prev,s,s.next)>=0)return!1;s=s.next}return!0}function l(t,e,i,r){var s=t.prev,n=t,o=t.next;if(b(s,n,o)>=0)return!1;for(var a=s.x<n.x?s.x<o.x?s.x:o.x:n.x<o.x?n.x:o.x,l=s.y<n.y?s.y<o.y?s.y:o.y:n.y<o.y?n.y:o.y,h=s.x>n.x?s.x>o.x?s.x:o.x:n.x>o.x?n.x:o.x,c=s.y>n.y?s.y>o.y?s.y:o.y:n.y>o.y?n.y:o.y,u=_(a,l,e,i,r),d=_(h,c,e,i,r),f=t.prevZ,p=t.nextZ;f&&f.z>=u&&p&&p.z<=d;){if(f!==t.prev&&f!==t.next&&v(s.x,s.y,n.x,n.y,o.x,o.y,f.x,f.y)&&b(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,p!==t.prev&&p!==t.next&&v(s.x,s.y,n.x,n.y,o.x,o.y,p.x,p.y)&&b(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;f&&f.z>=u;){if(f!==t.prev&&f!==t.next&&v(s.x,s.y,n.x,n.y,o.x,o.y,f.x,f.y)&&b(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;p&&p.z<=d;){if(p!==t.prev&&p!==t.next&&v(s.x,s.y,n.x,n.y,o.x,o.y,p.x,p.y)&&b(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function h(t,e,i){var r=t;do{var s=r.prev,o=r.next.next;!w(s,o)&&P(s,r,r.next,o)&&T(s,o)&&T(o,s)&&(e.push(s.i/i),e.push(r.i/i),e.push(o.i/i),R(r),R(r.next),r=t=o),r=r.next}while(r!==t);return n(r)}function c(t,e,i,r,s,a){var l=t;do{for(var h=l.next.next;h!==l.prev;){if(l.i!==h.i&&x(l,h)){var c=M(l,h);return l=n(l,l.next),c=n(c,c.next),o(l,e,i,r,s,a),void o(c,e,i,r,s,a)}h=h.next}l=l.next}while(l!==t)}function u(t,e,i,r){var o,a,l,h=[];for(o=0,a=e.length;o<a;o++)(l=s(t,e[o]*r,o<a-1?e[o+1]*r:t.length,r,!1))===l.next&&(l.steiner=!0),h.push(y(l));for(h.sort(d),o=0;o<h.length;o++)i=n(i=p(h[o],i),i.next);return i}function d(t,e){return t.x-e.x}function f(t){if(t.next.prev===t)return t;let e=t;for(;;){const i=e.next;if(i.prev===e||i===e||i===t)break;e=i}return e}function p(t,e){var i=function(t,e){var i,r=e,s=t.x,n=t.y,o=-1/0;do{if(n<=r.y&&n>=r.next.y&&r.next.y!==r.y){var a=r.x+(n-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=s&&a>o){if(o=a,a===s){if(n===r.y)return r;if(n===r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!i)return null;if(s===o)return i;var l,h=i,c=i.x,u=i.y,d=1/0;r=i;do{s>=r.x&&r.x>=c&&s!==r.x&&v(n<u?s:o,n,c,u,n<u?o:s,n,r.x,r.y)&&(l=Math.abs(n-r.y)/(s-r.x),T(r,t)&&(l<d||l===d&&(r.x>i.x||r.x===i.x&&m(i,r)))&&(i=r,d=l)),r=r.next}while(r!==h);return i}(t,e);if(!i)return e;var r=M(i,t),s=n(i,i.next);let o=f(r);return n(o,o.next),s=f(s),f(e===i?s:e)}function m(t,e){return b(t.prev,t,e.prev)<0&&b(e.next,t,t.next)<0}function g(t,e,i,r){var s=t;do{null===s.z&&(s.z=_(s.x,s.y,e,i,r)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next}while(s!==t);s.prevZ.nextZ=null,s.prevZ=null,function(t){var e,i,r,s,n,o,a,l,h=1;do{for(i=t,t=null,n=null,o=0;i;){for(o++,r=i,a=0,e=0;e<h&&(a++,r=r.nextZ);e++);for(l=h;a>0||l>0&&r;)0!==a&&(0===l||!r||i.z<=r.z)?(s=i,i=i.nextZ,a--):(s=r,r=r.nextZ,l--),n?n.nextZ=s:t=s,s.prevZ=n,n=s;i=r}n.nextZ=null,h*=2}while(o>1)}(s)}function _(t,e,i,r,s){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*s)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*s)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function y(t){var e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function v(t,e,i,r,s,n,o,a){return(s-o)*(e-a)-(t-o)*(n-a)>=0&&(t-o)*(r-a)-(i-o)*(e-a)>=0&&(i-o)*(n-a)-(s-o)*(r-a)>=0}function x(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&P(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(T(t,e)&&T(e,t)&&function(t,e){var i=t,r=!1,s=(t.x+e.x)/2,n=(t.y+e.y)/2;do{i.y>n!=i.next.y>n&&i.next.y!==i.y&&s<(i.next.x-i.x)*(n-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==t);return r}(t,e)&&(b(t.prev,t,e.prev)||b(t,e.prev,e))||w(t,e)&&b(t.prev,t,t.next)>0&&b(e.prev,e,e.next)>0)}function b(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function w(t,e){return t.x===e.x&&t.y===e.y}function P(t,e,i,r){var s=C(b(t,e,i)),n=C(b(t,e,r)),o=C(b(i,r,t)),a=C(b(i,r,e));return s!==n&&o!==a||!(0!==s||!S(t,i,e))||!(0!==n||!S(t,r,e))||!(0!==o||!S(i,t,r))||!(0!==a||!S(i,e,r))}function S(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function C(t){return t>0?1:t<0?-1:0}function T(t,e){return b(t.prev,t,t.next)<0?b(t,e,t.next)>=0&&b(t,t.prev,e)>=0:b(t,e,t.prev)<0||b(t,t.next,e)<0}function M(t,e){var i=new O(t.i,t.x,t.y),r=new O(e.i,e.x,e.y),s=t.next,n=e.prev;return t.next=e,e.prev=t,i.next=s,s.prev=i,r.next=i,i.prev=r,n.next=r,r.prev=n,r}function A(t,e,i,r){var s=new O(t,e,i);return r?(s.next=r.next,s.prev=r,r.next.prev=s,r.next=s):(s.prev=s,s.next=s),s}function R(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function O(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function I(t,e,i,r){for(var s=0,n=e,o=i-r;n<i;n+=r)s+=(t[o]-t[n])*(t[n+1]+t[o+1]),o=n;return s}i.d(e,{e:function(){return r}}),r.deviation=function(t,e,i,r){var s=e&&e.length,n=s?e[0]*i:t.length,o=Math.abs(I(t,0,n,i));if(s)for(var a=0,l=e.length;a<l;a++){var h=e[a]*i,c=a<l-1?e[a+1]*i:t.length;o-=Math.abs(I(t,h,c,i))}var u=0;for(a=0;a<r.length;a+=3){var d=r[a]*i,f=r[a+1]*i,p=r[a+2]*i;u+=Math.abs((t[d]-t[p])*(t[f+1]-t[d+1])-(t[d]-t[f])*(t[p+1]-t[d+1]))}return 0===o&&0===u?0:Math.abs((u-o)/o)},r.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},r=0,s=0;s<t.length;s++){for(var n=0;n<t[s].length;n++)for(var o=0;o<e;o++)i.vertices.push(t[s][n][o]);s>0&&(r+=t[s-1].length,i.holes.push(r))}return i}},78598:function(t,e,i){i.d(e,{a:function(){return n},f:function(){return o},n:function(){return s}});var r=i(24540);function s(t,e){n(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function n(t,e,i=2,s=i){const n=e.length/2;let o=0,a=0;if((0,r.cy)(e)||(0,r.dk)(e)){for(let r=0;r<n;++r)t[o]=e[a],t[o+1]=e[a+1],o+=i,a+=s;return}const l=(0,r.a3)(e);if((0,r.JI)(e))for(let r=0;r<n;++r)t[o]=Math.max(e[a]/l,-1),t[o+1]=Math.max(e[a+1]/l,-1),o+=i,a+=s;else for(let r=0;r<n;++r)t[o]=e[a]/l,t[o+1]=e[a+1]/l,o+=i,a+=s}function o(t,e,i,r){const s=t.typedBuffer,n=t.typedBufferStride,o=r?.count??t.count;let a=(r?.dstIndex??0)*n;for(let t=0;t<o;++t)s[a]=e,s[a+1]=i,a+=n}Object.freeze(Object.defineProperty({__proto__:null,fill:o,normalizeIntegerBuffer:n,normalizeIntegerBufferView:s},Symbol.toStringTag,{value:"Module"}))},62693:function(t,e,i){function r(t,e,i){s(t.typedBuffer,e.typedBuffer,i,t.typedBufferStride,e.typedBufferStride)}function s(t,e,i,r=3,s=r){if(t.length/r!==Math.ceil(e.length/s))return t;const n=t.length/r,o=i[0],a=i[1],l=i[2],h=i[4],c=i[5],u=i[6],d=i[8],f=i[9],p=i[10],m=i[12],g=i[13],_=i[14];let y=0,v=0;for(let i=0;i<n;i++){const i=e[y],n=e[y+1],x=e[y+2];t[v]=o*i+h*n+d*x+m,t[v+1]=a*i+c*n+f*x+g,t[v+2]=l*i+u*n+p*x+_,y+=s,v+=r}return t}function n(t,e,i){o(t.typedBuffer,e.typedBuffer,i,t.typedBufferStride,e.typedBufferStride)}function o(t,e,i,r=3,s=r){if(t.length/r!==Math.ceil(e.length/s))return;const n=t.length/r,o=i[0],a=i[1],l=i[2],h=i[3],c=i[4],u=i[5],d=i[6],f=i[7],p=i[8];let m=0,g=0;for(let i=0;i<n;i++){const i=e[m],n=e[m+1],_=e[m+2];t[g]=o*i+h*n+d*_,t[g+1]=a*i+c*n+f*_,t[g+2]=l*i+u*n+p*_,m+=s,g+=r}}function a(t,e,i){l(t.typedBuffer,e.typedBuffer,i,t.typedBufferStride,e.typedBufferStride)}function l(t,e,i,r=3,s=r){const n=Math.min(t.length/r,e.length/s);let o=0,a=0;for(let l=0;l<n;l++)t[a]=i*e[o],t[a+1]=i*e[o+1],t[a+2]=i*e[o+2],o+=s,a+=r;return t}function h(t,e,i,r=3,s=r){const n=t.length/r;if(n!==Math.ceil(e.length/s))return t;let o=0,a=0;for(let l=0;l<n;l++)t[a]=e[o]+i[0],t[a+1]=e[o+1]+i[1],t[a+2]=e[o+2]+i[2],o+=s,a+=r;return t}function c(t,e){u(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function u(t,e,i=3,r=i){const s=Math.min(t.length/i,e.length/r);let n=0,o=0;for(let a=0;a<s;a++){const s=e[n],a=e[n+1],l=e[n+2],h=s*s+a*a+l*l;if(h>0){const e=1/Math.sqrt(h);t[o]=e*s,t[o+1]=e*a,t[o+2]=e*l}n+=r,o+=i}}i.d(e,{a:function(){return h},b:function(){return o},c:function(){return n},d:function(){return r},e:function(){return c},f:function(){return l},n:function(){return u},s:function(){return a},t:function(){return s}}),i(58941),i(40633),Object.freeze(Object.defineProperty({__proto__:null,normalize:u,normalizeView:c,scale:l,scaleView:a,shiftRight:function(t,e,i){const r=Math.min(t.count,e.count),s=t.typedBuffer,n=t.typedBufferStride,o=e.typedBuffer,a=e.typedBufferStride;let l=0,h=0;for(let t=0;t<r;t++)s[h]=o[l]>>i,s[h+1]=o[l+1]>>i,s[h+2]=o[l+2]>>i,l+=a,h+=n},transformMat3:o,transformMat3View:n,transformMat4:s,transformMat4View:r,translate:h},Symbol.toStringTag,{value:"Module"}))},96400:function(t,e,i){function r(t,e){s(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function s(t,e,i=3,r=i){const s=e.length/r;let n=0,o=0;for(let a=0;a<s;++a)t[n]=e[o],t[n+1]=e[o+1],t[n+2]=e[o+2],n+=i,o+=r}function n(t,e,i,r,s){const n=t.typedBuffer,o=t.typedBufferStride,a=s?.count??t.count;let l=(s?.dstIndex??0)*o;for(let t=0;t<a;++t)n[l]=e,n[l+1]=i,n[l+2]=r,l+=o}i.d(e,{a:function(){return r},c:function(){return s},f:function(){return n}}),Object.freeze(Object.defineProperty({__proto__:null,copy:s,copyView:r,fill:n},Symbol.toStringTag,{value:"Module"}))},32003:function(t,e,i){i.d(e,{a:function(){return s},b:function(){return l},n:function(){return o},s:function(){return a},t:function(){return n}}),i(58941);var r=i(40633);function s(t,e,i){n(t.typedBuffer,e.typedBuffer,i,t.typedBufferStride,e.typedBufferStride)}function n(t,e,i,r=4,s=r){if(t.length/r!=e.length/s)return;const n=t.length/r,o=i[0],a=i[1],l=i[2],h=i[3],c=i[4],u=i[5],d=i[6],f=i[7],p=i[8];let m=0,g=0;for(let i=0;i<n;i++){const i=e[m],n=e[m+1],_=e[m+2],y=e[m+3];t[g]=o*i+h*n+d*_,t[g+1]=a*i+c*n+f*_,t[g+2]=l*i+u*n+p*_,t[g+3]=y,m+=s,g+=r}}function o(t,e){const i=Math.min(t.count,e.count),r=t.typedBuffer,s=t.typedBufferStride,n=e.typedBuffer,o=e.typedBufferStride;for(let t=0;t<i;t++){const e=t*s,i=t*o,a=n[i],l=n[i+1],h=n[i+2],c=a*a+l*l+h*h;if(c>0){const t=1/Math.sqrt(c);r[e]=t*a,r[e+1]=t*l,r[e+2]=t*h}}}function a(t,e,i){l(t.typedBuffer,e,i,t.typedBufferStride)}function l(t,e,i,r=4){const s=Math.min(t.length/r,e.count),n=e.typedBuffer,o=e.typedBufferStride;let a=0,l=0;for(let e=0;e<s;e++)t[l]=i*n[a],t[l+1]=i*n[a+1],t[l+2]=i*n[a+2],t[l+3]=i*n[a+3],a+=o,l+=r}Object.freeze(Object.defineProperty({__proto__:null,normalize:o,scale:l,scaleView:a,transformMat3:n,transformMat3View:s,transformMat4:function(t,e,i,s=4,n=s){if(t.length/s!=e.length/n)return void r.A.getLogger("esri.views.3d.support.buffer.math").error("source and destination buffers need to have the same number of elements");const o=t.length/s,a=i[0],l=i[1],h=i[2],c=i[3],u=i[4],d=i[5],f=i[6],p=i[7],m=i[8],g=i[9],_=i[10],y=i[11],v=i[12],x=i[13],b=i[14],w=i[15];let P=0,S=0;for(let i=0;i<o;i++){const i=e[P],r=e[P+1],o=e[P+2],C=e[P+3];t[S]=a*i+u*r+m*o+v*C,t[S+1]=l*i+d*r+g*o+x*C,t[S+2]=h*i+f*r+_*o+b*C,t[S+3]=c*i+p*r+y*o+w*C,P+=n,S+=s}},transformMat4View:function(t,e,i){if(t.count!==e.count)return;const r=t.count,s=i[0],n=i[1],o=i[2],a=i[3],l=i[4],h=i[5],c=i[6],u=i[7],d=i[8],f=i[9],p=i[10],m=i[11],g=i[12],_=i[13],y=i[14],v=i[15],x=t.typedBuffer,b=t.typedBufferStride,w=e.typedBuffer,P=e.typedBufferStride;for(let t=0;t<r;t++){const e=t*b,i=t*P,r=w[i],S=w[i+1],C=w[i+2],T=w[i+3];x[e]=s*r+l*S+d*C+g*T,x[e+1]=n*r+h*S+f*C+_*T,x[e+2]=o*r+c*S+p*C+y*T,x[e+3]=a*r+u*S+m*C+v*T}}},Symbol.toStringTag,{value:"Module"}))},84111:function(t,e,i){function r(t,e){s(t.typedBuffer,e,t.typedBufferStride)}function s(t,e,i=4){const r=e.typedBuffer,s=e.typedBufferStride,n=e.count;let o=0,a=0;for(let e=0;e<n;++e)t[o]=r[a],t[o+1]=r[a+1],t[o+2]=r[a+2],t[o+3]=r[a+3],o+=i,a+=s}function n(t,e,i,r,s,n){const o=t.typedBuffer,a=t.typedBufferStride,l=n?.count??t.count;let h=(n?.dstIndex??0)*a;for(let t=0;t<l;++t)o[h]=e,o[h+1]=i,o[h+2]=r,o[h+3]=s,h+=a}i.d(e,{a:function(){return s},c:function(){return r},f:function(){return n}}),Object.freeze(Object.defineProperty({__proto__:null,copy:s,copyView:r,fill:n},Symbol.toStringTag,{value:"Module"}))},67750:function(t,e,i){i.d(e,{A:function(){return C}});const r=[["(",")"],[")","("],["<",">"],[">","<"],["[","]"],["]","["],["{","}"],["}","{"],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""]],s=["","","",""],n=["","","",""],o=["","","",""],a=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],l=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],h=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],c=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],u=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],d=["","","","","","","","","","","","",""],f=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],p=["",""],m=["",""],g=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],_=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],y=10,v=11,x=12,b=18,w=["UBAT_L","UBAT_R","UBAT_EN","UBAT_AN","UBAT_ON","UBAT_B","UBAT_S","UBAT_AL","UBAT_WS","UBAT_CS","UBAT_ES","UBAT_ET","UBAT_NSM","UBAT_LRE","UBAT_RLE","UBAT_PDF","UBAT_LRO","UBAT_RLO","UBAT_BN"],P=[100,0,0,0,0,101,102,103,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,104,4,4,4,0,4,0,4,0,4,4,4,0,0,4,4,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,4,4,0,0,4,4,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,0,105,7,7,106,107],S=[[b,b,b,b,b,b,b,b,b,6,5,6,8,5,b,b,b,b,b,b,b,b,b,b,b,b,b,b,5,5,5,6,8,4,4,v,v,v,4,4,4,4,4,y,9,y,9,9,2,2,2,2,2,2,2,2,2,2,9,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,b,b,b,b,b,b,5,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,9,4,v,v,v,v,4,4,4,4,0,4,4,b,4,4,v,v,2,2,4,0,4,4,4,2,0,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,4,4,4,4,4,4,4,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,1,x,1,x,x,1,x,x,1,x,4,4,4,4,4,4,4,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4,4,4,4,4,1,1,1,1,1,4,4,4,4,4,4,4,4,4,4,4],[3,3,3,3,4,4,4,4,7,v,v,7,9,7,4,4,x,x,x,x,x,x,x,x,x,x,x,7,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,3,3,3,3,3,3,3,3,3,3,v,3,3,7,7,7,x,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,x,x,x,x,x,x,x,3,4,x,x,x,x,x,x,7,7,x,x,4,x,x,x,x,7,7,2,2,2,2,2,2,2,2,2,2,7,7,7,7,7,7],[7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,7,7,x,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,x,x,x,x,x,x,x,x,x,x,x,7,4,4,4,4,4,4,4,4,4,4,4,4,4,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,x,x,x,x,x,x,x,x,x,1,1,4,4,4,4,1,4,4,4,4,4],[8,8,8,8,8,8,8,8,8,8,8,b,b,b,0,1,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,8,5,13,14,15,16,17,9,v,v,v,v,v,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,9,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,8,b,b,b,b,b,4,4,4,4,4,b,b,b,b,b,b,2,0,4,4,2,2,2,2,2,2,y,y,4,4,4,0,2,2,2,2,2,2,2,2,2,2,y,y,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,4,4,4,4,4,1,x,1,1,1,1,1,1,1,1,1,1,y,1,1,1,1,1,1,1,1,1,1,1,1,1,4,1,1,1,1,1,4,1,4,1,1,4,1,1,4,1,1,1,1,1,1,1,1,1,1,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],[x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,x,x,x,x,x,x,x,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,9,4,9,4,4,9,4,4,4,4,4,4,4,4,4,v,4,4,y,y,4,4,4,4,4,v,v,4,4,4,4,4,7,7,7,7,7,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,4,b],[4,4,4,v,v,v,4,4,4,4,4,y,9,y,9,9,2,2,2,2,2,2,2,2,2,2,9,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,0,0,0,0,0,0,4,4,0,0,0,0,0,0,4,4,0,0,0,0,0,0,4,4,0,0,0,4,4,4,v,v,4,4,4,v,v,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4]];class C{constructor(){this.inputFormat="ILYNN",this.outputFormat="VLNNN",this.sourceToTarget=[],this.targetToSource=[],this.levels=[]}bidiTransform(t,e,i){if(this.sourceToTarget=[],this.targetToSource=[],!t)return"";if(function(t,e,i){Z=[],Y=[];for(let r=0;r<i;r++)t[r]=r,e[r]=r,Z[r]=r}(this.sourceToTarget,this.targetToSource,t.length),!this.checkParameters(e,i))return t;e=this.inputFormat,i=this.outputFormat;let r=t;const a=X,c=H(e.charAt(1)),d=H(i.charAt(1)),p=("I"===e.charAt(0)?"L":e.charAt(0))+c,m=("I"===i.charAt(0)?"L":i.charAt(0))+d,g=e.charAt(2)+i.charAt(2);a.defInFormat=p,a.defOutFormat=m,a.defSwap=g;const _=T(t,p,m,g,a);let y=!1;return"R"===i.charAt(1)?y=!0:"C"!==i.charAt(1)&&"D"!==i.charAt(1)||(y="rtl"===this.checkContextual(_)),this.sourceToTarget=Z,this.targetToSource=function(t){const e=new Array(t.length);for(let i=0;i<t.length;i++)e[t[i]]=i;return e}(this.sourceToTarget),q=this.targetToSource,r=e.charAt(3)===i.charAt(3)?_:"S"===i.charAt(3)?function(t,e){if(0===e.length)return"";void 0===t&&(t=!0);const i=(e=String(e)).split("");let r=0,s=1,a=i.length;t||(r=i.length-1,s=-1,a=1);const c=function(t,e,i,r){let s=0;const a=[];let c=0;for(let d=e;d*i<r;d+=i)if(L(t[d])||G(t[d])){if(""===t[d]&&z(t,d+i,i,r)){t[d]=j(t[d+i],0===s?n:o),d+=i,W(t,d,i,r),a[c]=d,c++,s=0;continue}const e=t[d];1===s?t[d]=D(t,d+i,i,r)?B(t[d]):U(t[d],h):!0===D(t,d+i,i,r)?t[d]=U(t[d],u):t[d]=U(t[d],l),G(e)||(s=1),!0===V(e)&&(s=0)}else s=0;return a}(i,r,s,a);let d="";for(let e=0;e<i.length;e++)E(c,c.length,e)>-1?($(q,e,!t,-1),Z.splice(e,1)):d+=i[e];return d}(y,_):function(t,e){if(0===t.length)return"";void 0===e&&(e=!0);let i="";const r=(t=String(t)).split("");for(let n=0;n<t.length;n++){let o=!1;if(r[n]>=""&&r[n]<"\ufeff"){const a=t.charCodeAt(n);r[n]>=""&&r[n]<=""?(e?(n>0&&" "===r[n-1]?i=i.slice(0,-1)+"":(i+="",o=!0),i+=s[(a-65269)/2]):(i+=s[(a-65269)/2],i+="",n+1<t.length&&" "===r[n+1]?n++:o=!0),o&&($(q,n,!0,1),Z.splice(n,0,Z[n]))):i+=f[a-65136]}else i+=r[n]}return i}(_,y),this.sourceToTarget=Z,this.targetToSource=q,this.levels=Y,r}_inputFormatSetter(t){if(!et.test(t))throw new Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.inputFormat=t}_outputFormatSetter(t){if(!et.test(t))throw new Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.outputFormat=t}checkParameters(t,e){return t?this._inputFormatSetter(t):t=this.inputFormat,e?this._outputFormatSetter(e):e=this.outputFormat,t!==e}checkContextual(t){let e=M(t);if("ltr"!==e&&"rtl"!==e){try{e=document.dir.toLowerCase()}catch(t){}"ltr"!==e&&"rtl"!==e&&(e="ltr")}return e}hasBidiChar(t){return it.test(t)}}function T(t,e,i,r,s){const n=function(t,e,i){if(void 0===e.inFormat&&(e.inFormat=i.defInFormat),void 0===e.outFormat&&(e.outFormat=i.defOutFormat),void 0===e.swap&&(e.swap=i.defSwap),e.inFormat===e.outFormat)return e;const r=e.inFormat.slice(0,1),s=e.outFormat.slice(0,1);let n,o=e.inFormat.slice(1,4),a=e.outFormat.slice(1,4);return"C"===o.charAt(0)&&(n=M(t),o="ltr"===n||"rtl"===n?n.toUpperCase():"L"===e.inFormat.charAt(2)?"LTR":"RTL",e.inFormat=r+o),"C"===a.charAt(0)&&(n=M(t),"rtl"===n?a="RTL":"ltr"===n?(n=function(t){const e=t.split("");return e.reverse(),M(e.join(""))}(t),a=n.toUpperCase()):a="L"===e.outFormat.charAt(2)?"LTR":"RTL",e.outFormat=s+a),e}(t,{inFormat:e,outFormat:i,swap:r},s);if(n.inFormat===n.outFormat)return t;e=n.inFormat,i=n.outFormat,r=n.swap;const o=e.slice(0,1),a=e.slice(1,4),l=i.slice(0,1),h=i.slice(1,4);if(s.inFormat=e,s.outFormat=i,s.swap=r,"L"===o&&"VLTR"===i){if("LTR"===a)return s.dir=K,A(t,s);if("RTL"===a)return s.dir=tt,A(t,s)}if("V"===o&&"V"===l)return s.dir="RTL"===a?tt:K,I(t,s);if("L"===o&&"VRTL"===i)return"LTR"===a?(s.dir=K,t=A(t,s)):(s.dir=tt,t=A(t,s)),I(t);if("VLTR"===e&&"LLTR"===i)return s.dir=K,A(t,s);if("V"===o&&"L"===l&&a!==h)return t=I(t),"RTL"===a?T(t,"LLTR","VLTR",r,s):T(t,"LRTL","VRTL",r,s);if("VRTL"===e&&"LRTL"===i)return T(t,"LRTL","VRTL",r,s);if("L"===o&&"L"===l){const e=s.swap;return s.swap=e.slice(0,1)+"N","RTL"===a?(s.dir=tt,t=A(t,s),s.swap="N"+e.slice(1,3),s.dir=K,t=A(t,s)):(s.dir=K,t=A(t,s),s.swap="N"+e.slice(1,3),t=T(t,"VLTR","LRTL",s.swap,s)),t}return t}function M(t){const e=/[A-Za-z\u05d0-\u065f\u066a-\u06ef\u06fa-\u07ff\ufb1d-\ufdff\ufe70-\ufefc]/.exec(t);return e?e[0]<="z"?"ltr":"rtl":""}function A(t,e){const i=t.split(""),r=[];return R(i,r,e),function(t,e,i){if(0!==i.hiLevel&&i.swap[0]!==i.swap[1])for(let i=0;i<t.length;i++)1===e[i]&&(t[i]=k(t[i]))}(i,r,e),N(2,i,r,e),N(1,i,r,e),Y=r,i.join("")}function R(t,e,i){const r=t.length,s=i.dir?_:g;let n=0,o=-1;const a=[],l=[];i.hiLevel=i.dir,i.lastArabic=!1,i.hasUbatAl=!1,i.hasUbatB=!1,i.hasUbatS=!1;for(let e=0;e<r;e++)a[e]=O(t[e]);for(let h=0;h<r;h++){const r=n,c=F(t,a,l,h,i);l[h]=c,n=s[r][c];const u=240&n;n&=15;const d=s[n][Q];if(e[h]=d,u>0)if(16===u){for(let t=o;t<h;t++)e[t]=1;o=-1}else o=-1;if(s[n][J])-1===o&&(o=h);else if(o>-1){for(let t=o;t<h;t++)e[t]=d;o=-1}5===a[h]&&(e[h]=0),i.hiLevel|=d}i.hasUbatS&&function(t,e,i,r){for(let s=0;s<i;s++)if(6===t[s]){e[s]=r.dir;for(let i=s-1;i>=0&&8===t[i];i--)e[i]=r.dir}}(a,e,r,i)}function O(t){const e=t.charCodeAt(0),i=P[e>>8];return i<100?i:S[i-100][255&e]}function I(t,e){const i=t.split("");if(e){const t=[];R(i,t,e),Y=t}return i.reverse(),Z.reverse(),i.join("")}function E(t,e,i){for(let r=0;r<e;r++)if(t[r]===i)return r;return-1}function L(t){for(let e=0;e<p.length;e++)if(t>=p[e]&&t<=m[e])return!0;return!1}function D(t,e,i,r){for(;e*i<r&&G(t[e]);)e+=i;return!!(e*i<r&&L(t[e]))}function z(t,e,i,r){for(;e*i<r&&G(t[e]);)e+=i;let n=" ";if(!(e*i<r))return!1;n=t[e];for(let t=0;t<s.length;t++)if(s[t]===n)return!0;return!1}function N(t,e,i,r){if(r.hiLevel<t)return;if(1===t&&r.dir===tt&&!r.hasUbatB)return e.reverse(),void Z.reverse();const s=e.length;let n,o,a,l,h,c=0;for(;c<s;){if(i[c]>=t){for(n=c+1;n<s&&i[n]>=t;)n++;for(o=c,a=n-1;o<a;o++,a--)l=e[o],e[o]=e[a],e[a]=l,h=Z[o],Z[o]=Z[a],Z[a]=h;c=n}c++}}function F(t,e,i,r,s){const n=e[r];return{UBAT_L:()=>(s.lastArabic=!1,0),UBAT_R:()=>(s.lastArabic=!1,1),UBAT_ON:()=>4,UBAT_AN:()=>3,UBAT_EN:()=>s.lastArabic?3:2,UBAT_AL:()=>(s.lastArabic=!0,s.hasUbatAl=!0,1),UBAT_WS:()=>4,UBAT_CS:()=>{let t,n;return r<1||r+1>=e.length||2!==(t=i[r-1])&&3!==t||2!==(n=e[r+1])&&3!==n?4:(s.lastArabic&&(n=3),n===t?n:4)},UBAT_ES:()=>2===(r>0?i[r-1]:5)&&r+1<e.length&&2===e[r+1]?2:4,UBAT_ET:()=>{if(r>0&&2===i[r-1])return 2;if(s.lastArabic)return 4;let t=r+1;const n=e.length;for(;t<n&&e[t]===v;)t++;return t<n&&2===e[t]?2:4},UBAT_NSM:()=>{if("VLTR"===s.inFormat){const i=e.length;let s=r+1;for(;s<i&&e[s]===x;)s++;if(s<i){const i=t[r].charCodeAt(0),n=i>=1425&&i<=2303||64286===i,o=e[s];if(n&&(1===o||7===o))return 1}}return r<1||5===e[r-1]?4:i[r-1]},UBAT_B:()=>(s.lastArabic=!0,s.hasUbatB=!0,s.dir),UBAT_S:()=>(s.hasUbatS=!0,4),UBAT_LRE:()=>(s.lastArabic=!1,4),UBAT_RLE:()=>(s.lastArabic=!1,4),UBAT_LRO:()=>(s.lastArabic=!1,4),UBAT_RLO:()=>(s.lastArabic=!1,4),UBAT_PDF:()=>(s.lastArabic=!1,4),UBAT_BN:()=>4}[w[n]]()}function k(t){let e,i=0,s=r.length-1;for(;i<=s;)if(e=Math.floor((i+s)/2),t<r[e][0])s=e-1;else{if(!(t>r[e][0]))return r[e][1];i=e+1}return t}function V(t){for(let e=0;e<d.length;e++)if(d[e]===t)return!0;return!1}function B(t){for(let e=0;e<a.length;e++)if(t===a[e])return c[e];return t}function U(t,e){for(let i=0;i<a.length;i++)if(t===a[i])return e[i];return t}function G(t){return t>=""&&t<=""}function H(t){return"L"===t?"LTR":"R"===t?"RTL":"C"===t?"CLR":"D"===t?"CRL":""}function W(t,e,i,r){for(;e*i<r&&G(t[e]);)e+=i;return e*i<r&&(t[e]=" ",!0)}function j(t,e){for(let i=0;i<s.length;i++)if(t===s[i])return e[i];return t}function $(t,e,i,r){for(let s=0;s<t.length;s++)(t[s]>e||!i&&t[s]===e)&&(t[s]+=r)}let Z=[],q=[],Y=[];const X={dir:0,defInFormat:"LLTR",defoutFormat:"VLTR",defSwap:"YN",inFormat:"LLTR",outFormat:"VLTR",swap:"YN",hiLevel:0,lastArabic:!1,hasUbatAl:!1,hasBlockSep:!1,hasSegSep:!1,defOutFormat:""},Q=5,J=6,K=0,tt=1,et=/^[(I|V)][(L|R|C|D)][(Y|N)][(S|N)][N]$/,it=/[\u0591-\u06ff\ufb1d-\ufefc]/},90152:function(t,e,i){i.d(e,{y:function(){return s}});const r=new(i(67750).A);function s(t){if(null==t)return["",!1];if(!r.hasBidiChar(t))return[t,!1];let e;return e="rtl"===r.checkContextual(t)?"IDNNN":"ICNNN",[r.bidiTransform(t,e,"VLYSN"),!0]}},7970:function(t,e,i){i.d(e,{O:function(){return r}});class r{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return 0===this._outer.size}get(t,e){return this._outer.get(t)?.get(e)}getInner(t){return this._outer.get(t)}set(t,e,i){const r=this._outer.get(t);r?r.set(e,i):this._outer.set(t,new Map([[e,i]]))}delete(t,e){const i=this._outer.get(t);i&&(i.delete(e),0===i.size&&this._outer.delete(t))}forEach(t){this._outer.forEach(((e,i)=>t(e,i)))}forAll(t){for(const e of this._outer.values())for(const i of e.values())t(i)}}},14520:function(t,e,i){function r(t){return t=t||globalThis.location.hostname,h.some((e=>null!=t?.match(e)))}function s(t,e){return t?(e=e||globalThis.location.hostname)?null!=e.match(n)||null!=e.match(a)?t.replace("static.arcgis.com","staticdev.arcgis.com"):null!=e.match(o)||null!=e.match(l)?t.replace("static.arcgis.com","staticqa.arcgis.com"):t:t:null}i.d(e,{EM:function(){return s},b5:function(){return r}});const n=/^devext\.arcgis\.com$/,o=/^qaext\.arcgis\.com$/,a=/^[\w-]*\.mapsdevext\.arcgis\.com$/,l=/^[\w-]*\.mapsqa\.arcgis\.com$/,h=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local\.esri\.com$/,n,o,/^jsapps\.esri\.com$/,a,l]},80683:function(t,e,i){i.d(e,{Al:function(){return h},NZ:function(){return c},Vb:function(){return s},af:function(){return u},rK:function(){return d}});var r=i(25591);const s="arial-unicode-ms",n="woff2",o=new Map,a=new Set;class l{constructor(t,e){this.fontFace=t,this.promise=e}}async function h(t){const e=f(t),i=d(t),s=o.get(e);if(s)return s.promise;const h=new FontFace(t.family,`url('${r.default.fontsUrl}/woff2/${i}.${n}') format('${n}')`,{style:t.style,weight:t.weight}),c=document.fonts;if(c.has(h)&&"loading"===h.status)return h.loaded;const u=h.load().then((()=>(c.add(h),h)));return o.set(e,new l(h,u)),a.add(h),u}function c(t){return a.has(t)}function u(t){if(!t)return s;const e=t.toLowerCase().split(" ").join("-");switch(e){case"serif":return"noto-serif";case"sans-serif":return"arial-unicode-ms";case"monospace":return"ubuntu-mono";case"fantasy":return"cabin-sketch";case"cursive":return"redressed";default:return e}}function d(t){const e=p(t)+m(t);return u(t.family)+(e.length>0?e:"-regular")}function f(t){const e=p(t)+m(t);return(t.family||s)+(e.length>0?e:"-regular")}function p(t){if(!t.weight)return"";switch(t.weight.toLowerCase()){case"bold":case"bolder":return"-bold"}return""}function m(t){if(!t.style)return"";switch(t.style.toLowerCase()){case"italic":case"oblique":return"-italic"}return""}},87847:function(t,e,i){i.d(e,{M5:function(){return f},eV:function(){return u},xR:function(){return c}});var r=i(93040),s=i(39819),n=i(60539),o=i(90683),a=i(40845);let l=null,h=!0;function c(t,e,i){if(!t||!e)throw new Error("Cannot construct image data without dimensions");if(h)try{return new ImageData(t,e)}catch(t){h=!1}return d(t,e,i)}function u(t,e,i,r){if(!e||!i)throw new Error("Cannot construct image data without dimensions");if(h)try{return new ImageData(t,e,i)}catch(t){h=!1}const s=d(e,i,r);return s.data.set(t,0),s}function d(t,e,i){return i||(l||(l=document.createElement("canvas"),l.width=1,l.height=1),i=l),i.getContext("2d").createImageData(t,e)}async function f(t,e){const{arrayBuffer:l,mediaType:h}=await async function(t,e){const i=(0,o.r$)(t);if(i?.isBase64)return{arrayBuffer:(0,a.M)(i.data),mediaType:i.mediaType};const s=await(0,r.A)(t,{responseType:"array-buffer",...e});return{arrayBuffer:s.data,mediaType:s.getHeader?.("Content-Type")??""}}(t,e),c="image/png"===h;if("image/gif"===h){const{isAnimatedGIF:t,parseGif:r}=await i.e(8627).then(i.bind(i,36089));if(t(l))return r(l,e)}if(c){const{isAnimatedPNG:t,parseApng:r}=await i.e(5297).then(i.bind(i,9073));if(t(l))return r(l,e)}return async function(t,e){const i=window.URL.createObjectURL(t);try{const{data:t}=await(0,r.A)(i,{...e,responseType:"image"});return t}catch(t){if(!(0,n.zf)(t))throw new s.A("invalid-image",`Could not fetch requested image at ${i}`);throw t}finally{window.URL.revokeObjectURL(i)}}(new Blob([l],{type:h}),e)}},10793:function(t,e,i){function r(){const t=new Float32Array(6);return t[0]=1,t[3]=1,t}function s(t,e,i,r){const s=e[r],n=e[r+1];t[r]=i[0]*s+i[2]*n+i[4],t[r+1]=i[1]*s+i[3]*n+i[5]}function n(t,e,i,r=0,n=0,o=2){const a=n||e.length/o;for(let n=r;n<a;n++)s(t,e,i,n*o)}i.d(e,{gb:function(){return n},vt:function(){return r}}),Object.freeze(Object.defineProperty({__proto__:null,clone:function(t){const e=new Float32Array(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},create:r,createView:function(t,e){return new Float32Array(t,e,6)},fromValues:function(t,e,i,r,s,n){const o=new Float32Array(6);return o[0]=t,o[1]=e,o[2]=i,o[3]=r,o[4]=s,o[5]=n,o},transform:s,transformMany:n},Symbol.toStringTag,{value:"Module"}))},67348:function(t,e,i){i.d(e,{$0:function(){return u},B8:function(){return o},CV:function(){return d},D_:function(){return s},Tl:function(){return c},e$:function(){return l},hZ:function(){return n},hs:function(){return h},kN:function(){return f},lw:function(){return a}});var r=i(8527);function s(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function n(t,e,i,r,s,n,o){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t[4]=n,t[5]=o,t}function o(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5];let l=i*n-r*s;return l?(l=1/l,t[0]=n*l,t[1]=-r*l,t[2]=-s*l,t[3]=i*l,t[4]=(s*a-n*o)*l,t[5]=(r*o-i*a)*l,t):null}function a(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],h=i[0],c=i[1],u=i[2],d=i[3],f=i[4],p=i[5];return t[0]=r*h+n*c,t[1]=s*h+o*c,t[2]=r*u+n*d,t[3]=s*u+o*d,t[4]=r*f+n*p+a,t[5]=s*f+o*p+l,t}function l(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],h=Math.sin(i),c=Math.cos(i);return t[0]=r*c+n*h,t[1]=s*c+o*h,t[2]=r*-h+n*c,t[3]=s*-h+o*c,t[4]=a,t[5]=l,t}function h(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],h=i[0],c=i[1];return t[0]=r*h,t[1]=s*h,t[2]=n*c,t[3]=o*c,t[4]=a,t[5]=l,t}function c(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],h=i[0],c=i[1];return t[0]=r,t[1]=s,t[2]=n,t[3]=o,t[4]=r*h+n*c+a,t[5]=s*h+o*c+l,t}function u(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=-i,t[3]=r,t[4]=0,t[5]=0,t}function d(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function f(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function p(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t}const m=a,g=p;Object.freeze(Object.defineProperty({__proto__:null,add:function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},determinant:function(t){return t[0]*t[3]-t[1]*t[2]},equals:function(t,e){const i=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],h=e[0],c=e[1],u=e[2],d=e[3],f=e[4],p=e[5],m=(0,r.FD)();return Math.abs(i-h)<=m*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(s-c)<=m*Math.max(1,Math.abs(s),Math.abs(c))&&Math.abs(n-u)<=m*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(o-d)<=m*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(a-f)<=m*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(l-p)<=m*Math.max(1,Math.abs(l),Math.abs(p))},exactEquals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},frob:function(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+1)},fromRotation:u,fromScaling:d,fromTranslation:f,identity:s,invert:o,mul:m,multiply:a,multiplyScalar:function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t},multiplyScalarAndAdd:function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t},rotate:l,scale:h,set:n,str:function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},sub:g,subtract:p,translate:c},Symbol.toStringTag,{value:"Module"}))},33134:function(t,e,i){i.d(e,{z:function(){return a}});var r=i(21609),s=i(49077),n=i(74697),o=i(76613);class a{static fromOptimized(t,e,i=!1,r=!1,s=1){return(new l).initialize(t,e,i,r,s)}static fromJSON(t,e=!1,i=!1){const[r,s]=c(t);return(new u).initialize(r,s,e,i,1)}static fromOptimizedCIM(t,e,i=!1,r=!1,s=1){return(new d).initialize(t,e,i,r,s)}static fromJSONCIM(t,e=!1,i=!1,r=1){const[s,n]=c(t);return(new f).initialize(s,n,e,i,r)}static fromFeatureSetReader(t){const e=t.readGeometryForDisplay(),i=t.geometryType;return e&&i?this.fromOptimized(e,i):null}static fromFeatureSetReaderCIM(t){const e=t.readGeometryForDisplay(),i=t.geometryType;return e&&i?this.fromOptimizedCIM(e,i):null}static createEmptyOptimized(t,e=!1,i=!1,r=1){return(new l).initialize(new o.A,t,e,i,r)}static createEmptyJSON(t,e=!1,i=!1){return(new u).initialize([],t,e,i,1)}static createEmptyOptimizedCIM(t,e=!1,i=!1,r=1){return(new d).initialize(new o.A,t,e,i,r)}static createEmptyJSONCIM(t,e=!1,i=!1,r=1){return(new f).initialize([],t,e,i,r)}asJSON(){const t=(0,s.x)(this);return"esriGeometryEnvelope"===this.geometryType?{xmin:t[0][0][0],ymin:t[0][0][1],xmax:t[0][2][0],ymax:t[0][2][1]}:"esriGeometryMultipoint"===this.geometryType?{points:t.flat()}:"esriGeometryPoint"===this.geometryType?{x:t[0][0][0],y:t[0][0][1]}:"esriGeometryPolygon"===this.geometryType?{rings:t}:{paths:t}}getCurrentRingArea(){if(this.pathSize<3)return 0;let t,e,i=0;if(this.seekPathStart(),!this.nextPoint())return 0;t=this.x,e=this.y;const r=t,s=e;for(;this.nextPoint();)i+=(t-this.x)*(e+this.y),t=this.x,e=this.y;return i+=(t-r)*(e+s),-.5*i}invertY(){this.yFactor*=-1}}class l extends a{constructor(){super(...arguments),this._end=-1}initialize(t,e,i,r,s){return this.hasZ=i,this.hasM=r,this.geometryType=e,this._stride=2+Number(i)+Number(r),this._geometry=t,this._pathIndex=-1,this._pathOffset=0,this._pointOffset=-this._stride,this._end=-1,this.yFactor=s,this}reset(){this.initialize(this._geometry,this.geometryType,this.hasZ,this.hasM,this.yFactor)}seekPath(t){if(t>=0&&t<this.totalSize){if(this._pathIndex<t)for(;this._pathIndex<t&&this.nextPath(););else if(this._pathIndex>t)for(;this._pathIndex>t&&this.prevPath(););return!0}return!1}seekPathStart(){this._pointOffset=this._pathOffset-this._stride}seekPathEnd(){this._pointOffset=this._end}seekInPath(t){const e=this._pathOffset+t*this._stride;return e>=0&&e<this._end&&(this._pointOffset=e,!0)}nextPoint(){return(this._pointOffset+=this._stride)<this._end}prevPoint(){return(this._pointOffset-=this._stride)>=this._pathOffset}nextPath(){return!(this.pathIndex>=this.totalSize-1||(this._pathIndex>=0&&(this._pathOffset+=this._stride*this.pathSize),this._pathIndex++,this._pointOffset=this._pathOffset-this._stride,this._end=this._pointOffset+this._stride+this._stride*this.pathSize,0))}prevPath(){return!(this.pathIndex<=0||(this._pathIndex--,this._end=this._pathOffset,this._pathOffset-=this._stride*this.pathSize,this._pointOffset=this._pathOffset-this._stride,0))}getCurrentPath(){const t=this._end,e=this._geometry.coords,i=this._pathOffset;return(new l).initialize(new o.A([this.pathSize],e.slice(i,t)),this.geometryType,this.hasZ,this.hasM,this.yFactor)}pathLength(){const t=this._end,e=this._stride,i=this._geometry.coords;let r=0;for(let s=this._pathOffset+e;s<t;s+=e){const t=i[s-e],n=i[s-e+1],o=i[s]-t,a=i[s+1]-n;r+=Math.sqrt(o*o+a*a)}return r}startPath(){this._geometry.lengths.push(0)}pushPath(t){this.startPath(),this.pushPoints(t)}pushPoint(t){for(let e=0;e<this._stride;++e)this._geometry.coords.push(t[e]);this._geometry.lengths[this.totalSize-1]++}pushXY(t,e){this._geometry.coords.push(t,e),this._geometry.lengths[this.totalSize-1]++}pushPoints(t){for(const e of t)for(let t=0;t<this._stride;++t)this._geometry.coords.push(e[t]);this._geometry.lengths[this.totalSize-1]+=t.length}pushCursor(t){const e=t.asOptimized();this._geometry.coords.push(...e.coords),this._geometry.lengths.push(...e.lengths)}asOptimized(){const t=this._geometry.clone();if(1!==this.yFactor)for(let e=1;e<t.coords.length;e+=this._stride)t.coords[e]*=this.yFactor;return"esriGeometryPoint"===this.geometryType&&(t.lengths.length=0),t}isClosed(){const t=this._geometry.coords,e=this._pathOffset,i=this._end-this._stride;for(let r=0;r<this._stride;r++)if(t[e+r]!==t[i+r])return!1;return!0}clone(){return(new l).initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._geometry.isPoint?1:this._geometry.lengths.reduce(((t,e)=>t+e))}get pathSize(){const{lengths:t}=this._geometry;return this._geometry.isPoint?1:this._pathIndex<0||this._pathIndex>t.length-1?0:t[this._pathIndex]}get totalSize(){return this._geometry.isPoint?1:this._geometry.lengths.length}get x(){return this._geometry.coords[this._pointOffset]}set x(t){this._geometry.coords[this._pointOffset]=t}get y(){return this.yFactor*this._geometry.coords[this._pointOffset+1]}set y(t){this._geometry.coords[this._pointOffset+1]=this.yFactor*t}get z(){return this._geometry.coords[this._pointOffset+2]}set z(t){this._geometry.coords[this._pointOffset+2]=t}get m(){const t=this.hasZ?3:2;return this._geometry.coords[this._pointOffset+t]}set m(t){this._geometry.coords[this._pointOffset+3]=t}get pathIndex(){return this._pathIndex}get _coordIndex(){return this._pointOffset/this._stride}}function h(t){const e=[t.x,t.y];return t.z&&e.push(t.z),t.m&&e.push(t.m),e}function c(t){return(0,n.Bi)(t)?[t.rings,"esriGeometryPolygon"]:(0,n.Rg)(t)?[t.paths,"esriGeometryPolyline"]:(0,n.U9)(t)?[[t.points],"esriGeometryMultipoint"]:(0,n.ZC)(t)?[[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]],"esriGeometryEnvelope"]:(0,n.fT)(t)?[[[h(t)]],"esriGeometryPoint"]:[[],"esriGeometryPolyline"]}class u extends a{initialize(t,e,i,r,s){return this._paths=t,this.geometryType=e,this.hasZ=i,this.hasM=r,this._pathIndex=this._pointIndex=-1,this.yFactor=s,this._mIndex=this.hasZ?3:2,this}reset(){this._pathIndex=this._pointIndex=-1}seekPath(t){return this._pathIndex=t,this._pointIndex=-1,t>=0&&t<this.totalSize&&(this._currentPath=this._paths[t],!0)}seekPathStart(){this._pointIndex=-1}seekPathEnd(){this._pointIndex=this._currentPath.length}seekInPath(t){return t>=0&&t<this._currentPath.length&&(this._pointIndex=t,this._currentPoint=this._currentPath[this._pointIndex],!0)}nextPoint(){return this._currentPoint=this._currentPath[++this._pointIndex],this._pointIndex<this._currentPath.length}prevPoint(){return this._currentPoint=this._currentPath[--this._pointIndex],this._pointIndex>=0}nextPath(){return this._pointIndex=-1,this._currentPath=this._paths[++this._pathIndex],this._pathIndex<this.totalSize}prevPath(){return this.pathIndex>0&&(this._pointIndex=-1,this._pathIndex--,this._currentPath=this._paths[this._pathIndex],!0)}pathLength(){const t=this._currentPath.length,e=this._currentPath;let i=0;for(let r=1;r<t;r++){const t=e[r-1],s=e[r],n=t[0],o=t[1],a=s[0]-n,l=s[1]-o;i+=Math.sqrt(a*a+l*l)}return i}startPath(){this._paths.push([])}getCurrentPath(){return(new u).initialize([this._currentPath],this.geometryType,this.hasZ,this.hasM,this.yFactor)}pushPath(t){this._paths.push(t)}pushPoint(t){this._paths[this.totalSize-1].push(t)}pushXY(t,e){this._paths[this.totalSize-1].push([t,e])}pushPoints(t){this._paths[this.totalSize-1].push(...t)}pushCursor(t){const e=(0,s.x)(t);for(const t of e)this.pushPath(t)}asOptimized(){const t=new o.A;if("esriGeometryPoint"===this.geometryType)t.coords.push(...this._paths[0][0]),t.lengths.length=0;else for(const e of this._paths){for(const i of e)t.coords.push(i[0]),t.coords.push(i[1]*this.yFactor),this.hasZ&&t.coords.push(i[2]),this.hasM&&t.coords.push(i[this._mIndex]);t.lengths.push(e.length)}return t}isClosed(){const t=this._currentPath[0],e=this._currentPath[this._currentPath.length-1];for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}clone(){return(new u).initialize((0,r.o8)(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._paths.map((t=>t.length)).reduce(((t,e)=>t+e))}get pathSize(){return this._pathIndex<0||this._pathIndex>this.totalSize-1?-1:this._paths[this._pathIndex].length}get totalSize(){return this._paths.length}get x(){return this._currentPoint[0]}set x(t){this._currentPoint[0]=t}get y(){return this.yFactor*this._currentPoint[1]}set y(t){this._currentPoint[1]=this.yFactor*t}get z(){return this._currentPoint[2]}set z(t){this._currentPoint[2]=t}get m(){return this._currentPoint[this._mIndex]}set m(t){this._currentPoint[this._mIndex]=t}get pathIndex(){return this._pathIndex}}class d extends l{initialize(t,e,i,r,s){return super.initialize(t,e,i,r,s),this._controlPoints||(this._controlPoints=this._controlPoints=new Array(this.totalSize).fill(void 0).map((t=>new Set))),this}startPath(){super.startPath(),this._controlPoints.push(new Set)}clone(){const t=(new d).initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor);return t._controlPoints=this._controlPoints,t}setControlPoint(){this._controlPoints[this.pathIndex].add(this._coordIndex)}getControlPoint(){return this._controlPoints[this.pathIndex].has(this._coordIndex)}setControlPointAt(t){this._controlPoints[this.pathIndex].add(t)}getControlPointAt(t){return this._controlPoints[this.pathIndex].has(t)}}class f extends u{initialize(t,e,i,r,s){return super.initialize(t,e,i,r,s)}clone(){return(new f).initialize((0,r.o8)(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}setControlPoint(){this._paths[this.pathIndex][this._pointIndex][4]=1}getControlPoint(){return 1===this._paths[this.pathIndex][this._pointIndex][4]}setControlPointAt(t){this._paths[this.pathIndex][t][4]=1}getControlPointAt(t){return 1===this._paths[this.pathIndex][t][4]}}},56919:function(t,e,i){i.d(e,{E:function(){return n}});var r=i(32501),s=(i(46157),i(68734));function n(t,e,i){return!!(0,s.F)(t,e,o,i.spatialReference)&&(i.x=o[0],i.y=o[1],i.z=o[2],!0)}const o=(0,r.vt)()},54466:function(t,e,i){i.d(e,{A:function(){return g}});var r,s=i(53804),n=i(30905),o=i(21609),a=i(40633),l=i(23502),h=i(77560),c=i(65953),u=i(67888),d=i(94332),f=i(95123),p=i(6164);let m=r=class extends n.oY{static from(t){return(0,u.PZ)(r,t)}constructor(t){super(t),this.faces=null,this.material=null,this.name=void 0,this.shading="source",this.trustSourceNormals=!1}castFaces(t){return(0,p.b)(t,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},a.A.getLogger(this))}castMaterial(t){return(0,u.PZ)(t&&"object"==typeof t&&("metallic"in t||"roughness"in t||"metallicRoughnessTexture"in t)?f.A:d.A,t)}clone(){return new r({faces:(0,o.o8)(this.faces),shading:this.shading,material:(0,o.o8)(this.material),trustSourceNormals:this.trustSourceNormals,name:this.name})}cloneWithDeduplication(t,e){const i={faces:(0,o.o8)(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(t,e):null,trustSourceNormals:this.trustSourceNormals,name:this.name};return new r(i)}get memoryUsage(){let t=0;return null!=this.faces&&(t+=this.faces.byteLength),null!=this.material&&(t+=this.material.memoryUsage),t}};(0,s._)([(0,l.MZ)({json:{write:p.B}})],m.prototype,"faces",void 0),(0,s._)([(0,h.w)("faces")],m.prototype,"castFaces",null),(0,s._)([(0,l.MZ)({type:d.A,json:{write:!0}})],m.prototype,"material",void 0),(0,s._)([(0,h.w)("material")],m.prototype,"castMaterial",null),(0,s._)([(0,l.MZ)({json:{write:!0}})],m.prototype,"name",void 0),(0,s._)([(0,l.MZ)({type:String,json:{write:!0}})],m.prototype,"shading",void 0),(0,s._)([(0,l.MZ)({type:Boolean})],m.prototype,"trustSourceNormals",void 0),m=r=(0,s._)([(0,c.$)("esri.geometry.support.MeshComponent")],m);const g=m},94332:function(t,e,i){i.d(e,{A:function(){return d}});var r,s=i(53804),n=i(52874),o=i(30905),a=i(23502),l=(i(58941),i(40633),i(13798),i(65953)),h=i(29646),c=i(16824);let u=r=class extends o.oY{constructor(t){super(t),this.color=null,this.colorTexture=null,this.colorTextureTransform=null,this.normalTexture=void 0,this.normalTextureTransform=void 0,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const i=null!=t?t.get(this):null;if(i)return i;const s=new r(this.clonePropertiesWithDeduplication(e));return null!=t&&t.set(this,s),s}clonePropertiesWithDeduplication(t){return{color:null!=this.color?this.color.clone():null,colorTexture:this.colorTexture?.cloneWithDeduplication(t),normalTexture:this.normalTexture?.cloneWithDeduplication(t),alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided,colorTextureTransform:this.colorTextureTransform?.clone(),normalTextureTransform:this.normalTextureTransform?.clone()}}get memoryUsage(){return this.getMemoryUsage()}getMemoryUsage(){let t=0;return t+=null!=this.color?16:0,null!=this.colorTexture&&(t+=this.colorTexture.memoryUsage),t+=null!=this.colorTextureTransform?20:0,null!=this.normalTexture&&(t+=this.normalTexture.memoryUsage),t+=null!=this.normalTextureTransform?20:0,t}};(0,s._)([(0,a.MZ)({type:n.A,json:{write:!0}})],u.prototype,"color",void 0),(0,s._)([(0,a.MZ)({type:h.A,json:{write:!0}})],u.prototype,"colorTexture",void 0),(0,s._)([(0,a.MZ)({type:c.A,json:{write:!0}})],u.prototype,"colorTextureTransform",void 0),(0,s._)([(0,a.MZ)({type:h.A,json:{write:!0}})],u.prototype,"normalTexture",void 0),(0,s._)([(0,a.MZ)({type:c.A,json:{write:!0}})],u.prototype,"normalTextureTransform",void 0),(0,s._)([(0,a.MZ)({nonNullable:!0,json:{write:!0}})],u.prototype,"alphaMode",void 0),(0,s._)([(0,a.MZ)({nonNullable:!0,json:{write:!0}})],u.prototype,"alphaCutoff",void 0),(0,s._)([(0,a.MZ)({nonNullable:!0,json:{write:!0}})],u.prototype,"doubleSided",void 0),u=r=(0,s._)([(0,l.$)("esri.geometry.support.MeshMaterial")],u);const d=u},95123:function(t,e,i){i.d(e,{A:function(){return d}});var r,s=i(53804),n=i(52874),o=i(23502),a=(i(58941),i(40633),i(13798),i(65953)),l=i(94332),h=i(29646),c=i(16824);let u=r=class extends l.A{constructor(t){super(t),this.emissiveColor=null,this.emissiveTexture=null,this.emissiveTextureTransform=void 0,this.occlusionTexture=null,this.occlusionTextureTransform=void 0,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null,this.metallicRoughnessTextureTransform=void 0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const i=null!=t?t.get(this):null;if(i)return i;const s=new r(this.clonePropertiesWithDeduplication(e));return null!=t&&t.set(this,s),s}getMemoryUsage(){let t=super.getMemoryUsage();return t+=null!=this.emissiveColor?16:0,null!=this.emissiveTexture&&(t+=this.emissiveTexture.memoryUsage),t+=null!=this.emissiveTextureTransform?20:0,null!=this.occlusionTexture&&(t+=this.occlusionTexture.memoryUsage),t+=null!=this.occlusionTextureTransform?20:0,null!=this.metallicRoughnessTexture&&(t+=this.metallicRoughnessTexture.memoryUsage),t+=null!=this.metallicRoughnessTextureTransform?20:0,t}clonePropertiesWithDeduplication(t){return{...super.clonePropertiesWithDeduplication(t),emissiveColor:this.emissiveColor?.clone(),emissiveTexture:this.emissiveTexture?.cloneWithDeduplication(t),emissiveTextureTransform:this.emissiveTextureTransform?.clone(),occlusionTexture:this.occlusionTexture?.cloneWithDeduplication(t),occlusionTextureTransform:this.occlusionTextureTransform?.clone(),metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:this.metallicRoughnessTexture?.cloneWithDeduplication(t),metallicRoughnessTextureTransform:this.metallicRoughnessTextureTransform?.clone()}}};(0,s._)([(0,o.MZ)({type:n.A,json:{write:!0}})],u.prototype,"emissiveColor",void 0),(0,s._)([(0,o.MZ)({type:h.A,json:{write:!0}})],u.prototype,"emissiveTexture",void 0),(0,s._)([(0,o.MZ)({type:c.A,json:{write:!0}})],u.prototype,"emissiveTextureTransform",void 0),(0,s._)([(0,o.MZ)({type:h.A,json:{write:!0}})],u.prototype,"occlusionTexture",void 0),(0,s._)([(0,o.MZ)({type:c.A,json:{write:!0}})],u.prototype,"occlusionTextureTransform",void 0),(0,s._)([(0,o.MZ)({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],u.prototype,"metallic",void 0),(0,s._)([(0,o.MZ)({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],u.prototype,"roughness",void 0),(0,s._)([(0,o.MZ)({type:h.A,json:{write:!0}})],u.prototype,"metallicRoughnessTexture",void 0),(0,s._)([(0,o.MZ)({type:c.A,json:{write:!0}})],u.prototype,"metallicRoughnessTextureTransform",void 0),u=r=(0,s._)([(0,a.$)("esri.geometry.support.MeshMaterialMetallicRoughness")],u);const d=u},29646:function(t,e,i){i.d(e,{A:function(){return v}});var r,s=i(53804),n=(i(58941),i(87847)),o=i(30905),a=i(23502),l=i(67888),h=(i(13798),i(47332)),c=i(65953),u=i(81392),d=i(60534);const f=new WeakMap;let p=0,m=r=class extends o.oY{constructor(t){super(t),this.wrap="repeat"}get url(){return this._get("url")||null}set url(t){this._set("url",t),t&&this._set("data",null)}get data(){return this._get("data")||null}set data(t){this._set("data",t),t&&this._set("url",null)}writeData(t,e,i,r){if(t instanceof HTMLImageElement){const s={type:"image-element",src:(0,d.t)(t.src,r),crossOrigin:t.crossOrigin};e[i]=s}else if(t instanceof HTMLCanvasElement){const r={type:"canvas-element",imageData:g(t.getContext("2d").getImageData(0,0,t.width,t.height))};e[i]=r}else if(t instanceof HTMLVideoElement){const s={type:"video-element",src:(0,d.t)(t.src,r),autoplay:t.autoplay,loop:t.loop,muted:t.muted,crossOrigin:t.crossOrigin,preload:t.preload};e[i]=s}else if(t instanceof ImageData){const r={type:"image-data",imageData:g(t)};e[i]=r}}readData(t){switch(t.type){case"image-element":{const e=new Image;return e.src=t.src,e.crossOrigin=t.crossOrigin,e}case"canvas-element":{const e=_(t.imageData),i=document.createElement("canvas");return i.width=e.width,i.height=e.height,i.getContext("2d").putImageData(e,0,0),i}case"image-data":return _(t.imageData);case"video-element":{const e=document.createElement("video");return e.src=t.src,e.crossOrigin=t.crossOrigin,e.autoplay=t.autoplay,e.loop=t.loop,e.muted=t.muted,e.preload=t.preload,e}default:return}}get transparent(){const{data:t,url:e}=this;return t instanceof HTMLCanvasElement?y(t.getContext("2d").getImageData(0,0,t.width,t.height)):t instanceof ImageData?y(t):!(!e?.toLowerCase().endsWith(".png")&&!e?.toLocaleLowerCase().startsWith("data:image/png;"))}set transparent(t){this._overrideIfSome("transparent",t)}get contentHash(){const t="string"==typeof this.wrap?this.wrap:"object"==typeof this.wrap?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",e=(e="")=>`d:${e},t:${this.transparent},w:${t}`;return null!=this.url?e(this.url):null!=this.data?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?e(this.data.src):(f.has(this.data)||f.set(this.data,++p),e(f.get(this.data))):e()}get memoryUsage(){let t=0;if(t+=null!=this.url?this.url.length:0,null!=this.data){const e=this.data;"data"in e?t+=e.data.byteLength:e instanceof HTMLImageElement?t+=e.naturalWidth*e.naturalHeight*3:e instanceof HTMLCanvasElement&&(t+=e.width*e.height*3)}return t}clone(){const t={url:this.url,data:this.data,wrap:this._cloneWrap()};return new r(t)}cloneWithDeduplication(t){const e=t.get(this);if(e)return e;const i=this.clone();return t.set(this,i),i}_cloneWrap(){return"string"==typeof this.wrap?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}static from(t){return"string"==typeof t?new r({url:t}):t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData||t instanceof HTMLVideoElement?new r({data:t}):(0,l.PZ)(r,t)}};function g(t){let e="";for(let i=0;i<t.data.length;i++)e+=String.fromCharCode(t.data[i]);return{data:btoa(e),width:t.width,height:t.height}}function _(t){const e=atob(t.data),i=new Uint8ClampedArray(e.length);for(let t=0;t<e.length;t++)i[t]=e.charCodeAt(t);return(0,n.eV)(i,t.width,t.height)}function y(t){for(let e=3;e<t.data.length;e+=4)if(255!==t.data[e])return!0;return!1}(0,s._)([(0,a.MZ)({type:String,json:{write:d.w}})],m.prototype,"url",null),(0,s._)([(0,a.MZ)({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),(0,a.MZ)()],m.prototype,"data",null),(0,s._)([(0,u.K)("data")],m.prototype,"writeData",null),(0,s._)([(0,h.w)("data")],m.prototype,"readData",null),(0,s._)([(0,a.MZ)({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],m.prototype,"transparent",null),(0,s._)([(0,a.MZ)({json:{write:!0}})],m.prototype,"wrap",void 0),(0,s._)([(0,a.MZ)({readOnly:!0})],m.prototype,"contentHash",null),m=r=(0,s._)([(0,c.$)("esri.geometry.support.MeshTexture")],m);const v=m},16824:function(t,e,i){i.d(e,{A:function(){return h}});var r=i(53804),s=i(75743),n=i(30905),o=i(23502),a=(i(58941),i(40633),i(13798),i(65953));let l=class extends((0,s.O)(n.oY)){constructor(t){super(t),this.offset=[0,0],this.rotation=0,this.scale=[1,1]}};(0,r._)([(0,o.MZ)({type:[Number],nonNullable:!0,json:{write:!0}})],l.prototype,"offset",void 0),(0,r._)([(0,o.MZ)({type:Number,nonNullable:!0,json:{write:!0}})],l.prototype,"rotation",void 0),(0,r._)([(0,o.MZ)({type:[Number],nonNullable:!0,json:{write:!0}})],l.prototype,"scale",void 0),l=(0,r._)([(0,a.$)("esri.geometry.support.MeshTextureTransform")],l);const h=l},72139:function(t,e,i){var r,s,n;i.d(e,{O3:function(){return l},Ox:function(){return h},bR:function(){return o},dC:function(){return r}}),(n=r||(r={}))[n.Unknown=0]="Unknown",n[n.Point=1]="Point",n[n.LineString=2]="LineString",n[n.Polygon=3]="Polygon";class o{constructor(t,e){this.x=t,this.y=e}clone(){return new o(this.x,this.y)}equals(t,e){return t===this.x&&e===this.y}isEqual(t){return t.x===this.x&&t.y===this.y}setCoords(t,e){return this.x=t,this.y=e,this}normalize(){const t=this.x,e=this.y,i=Math.sqrt(t*t+e*e);return this.x/=i,this.y/=i,this}rightPerpendicular(){const t=this.x;return this.x=this.y,this.y=-t,this}leftPerpendicular(){const t=this.x;return this.x=-this.y,this.y=t,this}move(t,e){return this.x+=t,this.y+=e,this}assign(t){return this.x=t.x,this.y=t.y,this}assignAdd(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}assignSub(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}rotate(t,e){const i=this.x,r=this.y;return this.x=i*t-r*e,this.y=i*e+r*t,this}scale(t){return this.x*=t,this.y*=t,this}length(){const t=this.x,e=this.y;return Math.sqrt(t*t+e*e)}sub(t){return this.x-=t.x,this.y-=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}static distance(t,e){const i=e.x-t.x,r=e.y-t.y;return Math.sqrt(i*i+r*r)}static add(t,e){return new o(t.x+e.x,t.y+e.y)}static sub(t,e){return new o(t.x-e.x,t.y-e.y)}}class a{constructor(t,e,i){this.ratio=t,this.x=e,this.y=i}}class l{constructor(t,e,i,r=8,s=8){this._lines=[],this._starts=[],this.validateTessellation=!0,this._pixelRatio=r,this._pixelMargin=s,this._tileSize=512*r,this._dz=t,this._yPos=e,this._xPos=i}setPixelMargin(t){t!==this._pixelMargin&&(this._pixelMargin=t,this.setExtent(this._extent))}setExtent(t){this._extent=t,this._finalRatio=this._tileSize/t*(1<<this._dz);let e=this._pixelRatio*this._pixelMargin;e/=this._finalRatio;const i=t>>this._dz;e>i&&(e=i),this._margin=e,this._xmin=i*this._xPos-e,this._ymin=i*this._yPos-e,this._xmax=this._xmin+i+2*e,this._ymax=this._ymin+i+2*e}reset(t){this._type=t,this._lines=[],this._starts=[],this._line=null,this._start=0}moveTo(t,e){this._pushLine(),this._prevIsIn=this._isIn(t,e),this._moveTo(t,e,this._prevIsIn),this._prevPt=new o(t,e),this._firstPt=new o(t,e),this._dist=0}lineTo(t,e){const i=this._isIn(t,e),r=new o(t,e),s=o.distance(this._prevPt,r);let n,l,h,c,u,d,f,p;if(i)this._prevIsIn?this._lineTo(t,e,!0):(n=this._prevPt,l=r,h=this._intersect(l,n),this._start=this._dist+s*(1-this._r),this._lineTo(h.x,h.y,!0),this._lineTo(l.x,l.y,!0));else if(this._prevIsIn)l=this._prevPt,n=r,h=this._intersect(l,n),this._lineTo(h.x,h.y,!0),this._lineTo(n.x,n.y,!1);else{const t=this._prevPt,e=r;if(t.x<=this._xmin&&e.x<=this._xmin||t.x>=this._xmax&&e.x>=this._xmax||t.y<=this._ymin&&e.y<=this._ymin||t.y>=this._ymax&&e.y>=this._ymax)this._lineTo(e.x,e.y,!1);else{const i=[];if((t.x<this._xmin&&e.x>this._xmin||t.x>this._xmin&&e.x<this._xmin)&&(c=(this._xmin-t.x)/(e.x-t.x),p=t.y+c*(e.y-t.y),p<=this._ymin?d=!1:p>=this._ymax?d=!0:i.push(new a(c,this._xmin,p))),(t.x<this._xmax&&e.x>this._xmax||t.x>this._xmax&&e.x<this._xmax)&&(c=(this._xmax-t.x)/(e.x-t.x),p=t.y+c*(e.y-t.y),p<=this._ymin?d=!1:p>=this._ymax?d=!0:i.push(new a(c,this._xmax,p))),(t.y<this._ymin&&e.y>this._ymin||t.y>this._ymin&&e.y<this._ymin)&&(c=(this._ymin-t.y)/(e.y-t.y),f=t.x+c*(e.x-t.x),f<=this._xmin?u=!1:f>=this._xmax?u=!0:i.push(new a(c,f,this._ymin))),(t.y<this._ymax&&e.y>this._ymax||t.y>this._ymax&&e.y<this._ymax)&&(c=(this._ymax-t.y)/(e.y-t.y),f=t.x+c*(e.x-t.x),f<=this._xmin?u=!1:f>=this._xmax?u=!0:i.push(new a(c,f,this._ymax))),0===i.length)u?d?this._lineTo(this._xmax,this._ymax,!0):this._lineTo(this._xmax,this._ymin,!0):d?this._lineTo(this._xmin,this._ymax,!0):this._lineTo(this._xmin,this._ymin,!0);else if(i.length>1&&i[0].ratio>i[1].ratio)this._start=this._dist+s*i[1].ratio,this._lineTo(i[1].x,i[1].y,!0),this._lineTo(i[0].x,i[0].y,!0);else{this._start=this._dist+s*i[0].ratio;for(let t=0;t<i.length;t++)this._lineTo(i[t].x,i[t].y,!0)}this._lineTo(e.x,e.y,!1)}}this._dist+=s,this._prevIsIn=i,this._prevPt=r}close(){if(this._line.length>2){const t=this._firstPt,e=this._prevPt;t.x===e.x&&t.y===e.y||this.lineTo(t.x,t.y);const i=this._line;let r=i.length;for(;r>=4&&(i[0].x===i[1].x&&i[0].x===i[r-2].x||i[0].y===i[1].y&&i[0].y===i[r-2].y);)i.pop(),i[0].x=i[r-2].x,i[0].y=i[r-2].y,--r}}result(t=!0){return this._pushLine(),0===this._lines.length?null:(this._type===r.Polygon&&t&&c.simplify(this._tileSize,this._margin*this._finalRatio,this._lines),this._lines)}resultWithStarts(){if(this._type!==r.LineString)throw new Error("Only valid for lines");this._pushLine();const t=this._lines,e=t.length;if(0===e)return null;const i=[];for(let r=0;r<e;r++)i.push({line:t[r],start:this._starts[r]||0});return i}_isIn(t,e){return t>=this._xmin&&t<=this._xmax&&e>=this._ymin&&e<=this._ymax}_intersect(t,e){let i,r,s;if(e.x>=this._xmin&&e.x<=this._xmax)r=e.y<=this._ymin?this._ymin:this._ymax,s=(r-t.y)/(e.y-t.y),i=t.x+s*(e.x-t.x);else if(e.y>=this._ymin&&e.y<=this._ymax)i=e.x<=this._xmin?this._xmin:this._xmax,s=(i-t.x)/(e.x-t.x),r=t.y+s*(e.y-t.y);else{r=e.y<=this._ymin?this._ymin:this._ymax,i=e.x<=this._xmin?this._xmin:this._xmax;const n=(i-t.x)/(e.x-t.x),o=(r-t.y)/(e.y-t.y);n<o?(s=n,r=t.y+n*(e.y-t.y)):(s=o,i=t.x+o*(e.x-t.x))}return this._r=s,new o(i,r)}_pushLine(){this._line&&(this._type===r.Point?this._line.length>0&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===r.LineString?this._line.length>1&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===r.Polygon&&this._line.length>3&&(this._lines.push(this._line),this._starts.push(this._start))),this._line=[],this._start=0}_moveTo(t,e,i){this._type!==r.Polygon?i&&(t=Math.round((t-(this._xmin+this._margin))*this._finalRatio),e=Math.round((e-(this._ymin+this._margin))*this._finalRatio),this._line.push(new o(t,e))):(i||(t<this._xmin&&(t=this._xmin),t>this._xmax&&(t=this._xmax),e<this._ymin&&(e=this._ymin),e>this._ymax&&(e=this._ymax)),t=Math.round((t-(this._xmin+this._margin))*this._finalRatio),e=Math.round((e-(this._ymin+this._margin))*this._finalRatio),this._line.push(new o(t,e)),this._isH=!1,this._isV=!1)}_lineTo(t,e,i){let s,n;if(this._type!==r.Polygon)if(i){if(t=Math.round((t-(this._xmin+this._margin))*this._finalRatio),e=Math.round((e-(this._ymin+this._margin))*this._finalRatio),this._line.length>0&&(s=this._line[this._line.length-1],s.equals(t,e)))return;this._line.push(new o(t,e))}else this._line&&this._line.length>0&&this._pushLine();else if(i||(t<this._xmin&&(t=this._xmin),t>this._xmax&&(t=this._xmax),e<this._ymin&&(e=this._ymin),e>this._ymax&&(e=this._ymax)),t=Math.round((t-(this._xmin+this._margin))*this._finalRatio),e=Math.round((e-(this._ymin+this._margin))*this._finalRatio),this._line&&this._line.length>0){s=this._line[this._line.length-1];const i=s.x===t,r=s.y===e;if(i&&r)return;this._isH&&i||this._isV&&r?(s.x=t,s.y=e,n=this._line[this._line.length-2],n.x===t&&n.y===e?(this._line.pop(),this._line.length<=1?(this._isH=!1,this._isV=!1):(n=this._line[this._line.length-2],this._isH=n.x===t,this._isV=n.y===e)):(this._isH=n.x===t,this._isV=n.y===e)):(this._line.push(new o(t,e)),this._isH=i,this._isV=r)}else this._line.push(new o(t,e))}}class h{setExtent(t){this._ratio=4096===t?1:4096/t}get validateTessellation(){return this._ratio<1}reset(t){this._lines=[],this._line=null}moveTo(t,e){this._line&&this._lines.push(this._line),this._line=[];const i=this._ratio;this._line.push(new o(t*i,e*i))}lineTo(t,e){const i=this._ratio;this._line.push(new o(t*i,e*i))}close(){const t=this._line;t&&!t[0].isEqual(t[t.length-1])&&t.push(t[0])}result(){return this._line&&this._lines.push(this._line),0===this._lines.length?null:this._lines}}!function(t){t[t.sideLeft=0]="sideLeft",t[t.sideRight=1]="sideRight",t[t.sideTop=2]="sideTop",t[t.sideBottom=3]="sideBottom"}(s||(s={}));class c{static simplify(t,e,i){if(!i)return;const r=-e,n=t+e,o=-e,a=t+e,l=[],h=[],u=i.length;for(let t=0;t<u;++t){const e=i[t];if(!e||e.length<2)continue;let c,u=e[0];const d=e.length;for(let i=1;i<d;++i)c=e[i],u.x===c.x&&(u.x<=r&&(u.y>c.y?(l.push(t),l.push(i),l.push(s.sideLeft),l.push(-1)):(h.push(t),h.push(i),h.push(s.sideLeft),h.push(-1))),u.x>=n&&(u.y<c.y?(l.push(t),l.push(i),l.push(s.sideRight),l.push(-1)):(h.push(t),h.push(i),h.push(s.sideRight),h.push(-1)))),u.y===c.y&&(u.y<=o&&(u.x<c.x?(l.push(t),l.push(i),l.push(s.sideTop),l.push(-1)):(h.push(t),h.push(i),h.push(s.sideTop),h.push(-1))),u.y>=a&&(u.x>c.x?(l.push(t),l.push(i),l.push(s.sideBottom),l.push(-1)):(h.push(t),h.push(i),h.push(s.sideBottom),h.push(-1)))),u=c}if(0===l.length||0===h.length)return;c.fillParent(i,h,l),c.fillParent(i,l,h);const d=[];c.calcDeltas(d,h,l),c.calcDeltas(d,l,h),c.addDeltas(d,i)}static fillParent(t,e,i){const r=i.length,n=e.length;for(let o=0;o<n;o+=4){const n=e[o],a=e[o+1],l=e[o+2],h=t[n][a-1],c=t[n][a];let d=8092,f=-1;for(let e=0;e<r;e+=4){if(i[e+2]!==l)continue;const r=i[e],n=i[e+1],o=t[r][n-1],a=t[r][n];switch(l){case s.sideLeft:case s.sideRight:if(u(h.y,o.y,a.y)&&u(c.y,o.y,a.y)){const t=Math.abs(a.y-o.y);t<d&&(d=t,f=e)}break;case s.sideTop:case s.sideBottom:if(u(h.x,o.x,a.x)&&u(c.x,o.x,a.x)){const t=Math.abs(a.x-o.x);t<d&&(d=t,f=e)}}}e[o+3]=f}}static calcDeltas(t,e,i){const r=e.length;for(let s=0;s<r;s+=4){const r=[],n=c.calcDelta(s,e,i,r);t.push(e[s]),t.push(e[s+1]),t.push(e[s+2]),t.push(n)}}static calcDelta(t,e,i,r){const s=e[t+3];if(-1===s)return 0;const n=r.length;return n>1&&r[n-2]===s?0:(r.push(s),c.calcDelta(s,i,e,r)+1)}static addDeltas(t,e){const i=t.length;let r=0;for(let e=0;e<i;e+=4){const i=t[e+3];i>r&&(r=i)}for(let n=0;n<i;n+=4){const i=e[t[n]],o=t[n+1],a=r-t[n+3];switch(t[n+2]){case s.sideLeft:i[o-1].x-=a,i[o].x-=a,1===o&&(i[i.length-1].x-=a),o===i.length-1&&(i[0].x-=a);break;case s.sideRight:i[o-1].x+=a,i[o].x+=a,1===o&&(i[i.length-1].x+=a),o===i.length-1&&(i[0].x+=a);break;case s.sideTop:i[o-1].y-=a,i[o].y-=a,1===o&&(i[i.length-1].y-=a),o===i.length-1&&(i[0].y-=a);break;case s.sideBottom:i[o-1].y+=a,i[o].y+=a,1===o&&(i[i.length-1].y+=a),o===i.length-1&&(i[0].y+=a)}}}}const u=(t,e,i)=>t>=e&&t<=i||t>=i&&t<=e},26133:function(t,e,i){i.d(e,{$I:function(){return _},AU:function(){return p},Cr:function(){return u},g7:function(){return g},i4:function(){return c},ui:function(){return d},up:function(){return v},vt:function(){return h},yo:function(){return m}});var r=i(15774),s=i(73364),n=i(32237),o=i(61769),a=i(20551),l=i(32501);function h(t=v){return[t[0],t[1],t[2],t[3]]}function c(t,e,i=h()){return(0,a.c)(i,t),i[3]=e,i}function u(t,e,i){return(0,a.e)(i,t,e),(0,a.n)(i,i),i[3]=-(0,a.r)(t,e),i}function d(t,e=h()){const i=(0,s.l)(x,t);return y(e,(0,r.KJ)((0,n.Xd)(e,i))),e}function f(t,e,i=h()){return(0,n.x8)(x,t,_(t)),(0,n.x8)(b,e,_(e)),(0,n.lw)(x,b,x),y(i,(0,r.KJ)((0,n.Xd)(i,x)))}function p(t,e,i,r=h()){return c(l.Cw,t,w),c(l.JP,e,P),c(l.Cb,i,S),f(w,P,w),f(w,S,r),r}function m(t){return t}function g(t){return t[3]}function _(t){return(0,r.kU)(t[3])}function y(t,e){return t[3]=e,t}const v=[0,0,1,0],x=(0,o.vt)(),b=(0,o.vt)(),w=(h(),h()),P=h(),S=h()},30804:function(t,e,i){i.d(e,{d:function(){return h}});var r=i(87416),s=i(35068),n=i(72228),o=i(38441),a=i(96127);const l=222045e-19;function h(t){if(0===t.totalSize)return null;const e=(0,s.z8)(t);if(!e)return null;const i=4*(Math.abs(e[0])+Math.abs(e[2])+Math.abs(e[1])+Math.abs(e[3])+1)*l;let o=0,a=0;t.reset();for(let e=0;t.nextPath();e++){const i=t.getCurrentRingArea();i>a&&(a=i,o=e)}if(t.seekPath(o),0===t.pathSize)return null;t.seekPathStart();const h=(0,s.B$)(t);if(Math.abs(a)<=2*i*i)return[(h[0]+h[2])/2,(h[1]+h[3])/2];t.seekPathStart();const f=(0,n.w2)(t,(0,r.vt)());if(null===f)return null;if(t.totalPoints<4)return f;const p=[[NaN,NaN],[NaN,NaN],[NaN,NaN],[NaN,NaN]],m=[NaN,NaN,NaN,NaN],g=[NaN,NaN,NaN,NaN];let _=!1,y=u(f,t,!0);0===y.distance&&(_=!0,p[0][0]=f[0],p[0][1]=f[1],y=u(f,t,!1)),m[0]=y.distance,g[0]=0;const v=[NaN,NaN];let P=!1,S=.25,C=-1,T=NaN;do{if(T=NaN,p[1]=d(t,x(h[0],h[2],S),0,e),isNaN(p[1][0])||isNaN(p[1][1])||(y=u(p[1],t,!1),T=y.distance),!isNaN(T)&&T>i&&c(p[1],t))P=!0,m[1]=T,g[1]=b(p[1],f);else if(!isNaN(T)&&T>C&&(C=T,v[0]=p[1][0],v[1]=p[1][1]),S-=.01,S<.1){if(!(C>=0))break;P=!0,m[1]=C,p[1][0]=v[0],p[1][1]=v[1],g[1]=b(p[1],f)}}while(!P);P=!1,S=.5,C=-1;let M=.01,A=1;do{if(T=NaN,p[2]=d(t,x(h[0],h[2],S),0,e),isNaN(p[2][0])||isNaN(p[2][1])||(y=u(p[2],t,!1),T=y.distance),!isNaN(T)&&T>i&&c(p[2],t))P=!0,m[2]=T,g[2]=b(p[2],f);else if(!isNaN(T)&&T>C)C=T,v[0]=p[2][0],v[1]=p[2][1];else if(T>C&&(C=T,v[0]=p[2][0],v[1]=p[2][1]),S=.5+M*A,M+=.01,A*=-1,S<.3||S>.7){if(!(C>=0))break;P=!0,m[2]=C,p[2][0]=v[0],p[2][1]=v[1],g[2]=b(p[2],f)}}while(!P);P=!1,S=.75,C=-1;do{if(T=NaN,p[3]=d(t,x(h[0],h[2],S),0,e),isNaN(p[3][0])||isNaN(p[3][1])||(y=u(p[3],t,!1),T=y.distance),!isNaN(T)&&T>i&&c(p[3],t))P=!0,m[3]=T,g[3]=b(p[3],f);else if(T>C&&(C=T,v[0]=p[3][0],v[1]=p[3][1]),S+=.01,S>.9){if(!(C>=0))break;P=!0,m[3]=C,p[3][0]=v[0],p[3][1]=v[1],g[3]=b(p[3],f)}}while(!P);const R=[0,1,2,3],O=_?0:1;let I;for(let t=O;t<4;t++)for(let t=O;t<3;t++){const e=g[t],i=g[t+1];w(e,i)>0&&(I=R[t],R[t]=R[t+1],R[t+1]=I,g[t]=i,g[t+1]=e)}let E=O,L=0,D=0;for(let t=O;t<4;t++){switch(t){case 0:D=2*m[R[t]];break;case 1:D=1.66666666*m[R[t]];break;case 2:D=1.33333333*m[R[t]];break;case 3:D=m[R[t]]}D>L&&(L=D,E=R[t])}return p[E]}function c(t,e){let i,r,s,n,o=0;for(e.reset();e.nextPath()&&e.nextPoint();)for(i=e.x,r=e.y;e.nextPoint();i=s,r=n)s=e.x,n=e.y,r>t[1]!=n>t[1]&&((s-i)*(t[1]-r)-(n-r)*(t[0]-i)>0?o++:o--);return 0!==o}function u(t,e,i){if(i&&c(t,e))return{coord:t,distance:0};let r=1/0,s=0,n=0,a=[0,0],l=[0,0];const h=[0,0];for(e.reset();e.nextPath()&&e.nextPoint();)if(!(e.pathSize<2))for(a[0]=e.x,a[1]=e.y;e.nextPoint();a=l){l=[e.x,e.y],(0,o.gR)(h,t,a,l);const i=b(t,h);i<r&&(r=i,s=h[0],n=h[1])}return{coord:[s,n],distance:Math.sqrt(r)}}function d(t,e,i,s){const n=[e,0];let o=1/0,l=1/0,h=!1,c=!1;const u=[[e,s[1]-1],[e,s[3]+1]],d=[0,0],p=[0,0],m=[0,0],g=[[0,0],[0,0]],_=(0,r.vt)();for(t.reset();t.nextPath()&&t.nextPoint();)if(!(t.pathSize<2))for(g[0][0]=t.x,g[0][1]=t.y;t.nextPoint();g[0][0]=g[1][0],g[0][1]=g[1][1]){if(g[1][0]=t.x,g[1][1]=t.y,null===f(_,g))continue;if(p[0]=u[0][0],p[1]=u[0][1],m[0]=u[1][0],m[1]=u[1][1],0===y(_,p,m))continue;if(!(0,a.Ql)(u[0],u[1],g[0],g[1],d))continue;const e=d[1];o>l?e<o&&(o=e,h=!0):e<l&&(l=e,c=!0)}return h&&c?n[1]=(o+l)/2:n[0]=n[1]=NaN,n}function f(t,e){if(e.length<2)return null;t||(t=(0,r.vt)());const[i,s]=e[0],[n,o]=e[1];return t[0]=Math.min(i,n),t[1]=Math.min(s,o),t[2]=Math.max(i,n),t[3]=Math.max(s,o),t}const p=1,m=4,g=3,_=12;function y(t,e,i){let r=v(e,t),s=v(i,t);const n=t[0],o=t[1],a=t[2],l=t[3];if(r&s)return 0;if(!(r|s))return 4;const h=(r?1:0)|(s?2:0);do{const h=i[0]-e[0],c=i[1]-e[1];if(h>c)r&g?(r&p?(e[1]+=c*(n-e[0])/h,e[0]=n):(e[1]+=c*(a-e[0])/h,e[0]=a),r=v(e,t)):s&g?(s&p?(i[1]+=c*(n-i[0])/h,i[0]=n):(i[1]+=c*(a-i[0])/h,i[0]=a),s=v(i,t)):r?(r&m?(e[0]+=h*(o-e[1])/c,e[1]=o):(e[0]+=h*(l-e[1])/c,e[1]=l),r=v(e,t)):(s&m?(i[0]+=h*(o-i[1])/c,i[1]=o):(i[0]+=h*(l-i[1])/c,i[1]=l),s=v(i,t));else if(r&_?(r&m?(e[0]+=h*(o-e[1])/c,e[1]=o):(e[0]+=h*(l-e[1])/c,e[1]=l),r=v(e,t)):s&_?(s&m?(i[0]+=h*(o-i[1])/c,i[1]=o):(i[0]+=h*(l-i[1])/c,i[1]=l),s=v(i,t)):r?(r&p?(e[1]+=c*(n-e[0])/h,e[0]=n):(e[1]+=c*(a-e[0])/h,e[0]=a),r=v(e,t)):(s&p?(i[1]+=c*(n-i[0])/h,i[0]=n):(i[1]+=c*(a-i[0])/h,i[0]=a),s=v(i,t)),r&s)return 0}while(r|s);return h}function v(t,e){return(t[0]<e[0]?1:0)|(t[0]>e[2]?1:0)<<1|(t[1]<e[1]?1:0)<<2|(t[1]>e[3]?1:0)<<3}function x(t,e,i){return t+(e-t)*i}function b(t,e){return(t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])}function w(t,e){if(t<e)return-1;if(t>e)return 1;if(t===e)return 0;const i=isNaN(t),r=isNaN(e);return i<r?-1:i>r?1:0}},6164:function(t,e,i){function r(t,e,i,r){const{loggerTag:s,stride:n}=e;return t.length%n!=0?(r.error(s,`Invalid array length, expected a multiple of ${n}`),new i([])):t}function s(t,e,i,s,n){if(!t)return t;if(t instanceof e)return r(t,s,e,n);for(const o of i)if(t instanceof o)return r(new e(t),s,e,n);if(Array.isArray(t))return r(new e(t),s,e,n);{const r=i.map((t=>`'${t.name}'`));return n.error(`Failed to set property, expected one of ${r}, but got ${t.constructor.name}`),new e([])}}function n(t,e,i){e[i]=function(t){const e=new Array(t.length);for(let i=0;i<t.length;i++)e[i]=t[i];return e}(t)}i.d(e,{B:function(){return n},b:function(){return s}})},61003:function(t,e,i){i.d(e,{b:function(){return n}});var r=i(15774),s=i(37819);function n(t,e,i){const n=Array.isArray(t),c=n?t.length/e:t.byteLength/(4*e),u=n?t:new Uint32Array(t,0,c*e),d=i?.minReduction??0,f=i?.originalIndices||null,p=f?f.length:0,m=i?.componentOffsets||null;let g=0;if(m)for(let t=0;t<m.length-1;t++){const e=m[t+1]-m[t];e>g&&(g=e)}else g=c;const _=Math.floor(1.1*g)+1;(null==h||h.length<2*_)&&(h=new Uint32Array((0,r.cU)(2*_)));for(let t=0;t<2*_;t++)h[t]=0;let y=0;const v=!!m&&!!f,x=v?p:c;let b=(0,s.my)(c);const w=new Uint32Array(p),P=1.96;let S=0!==d?Math.ceil(4*P*P/(d*d)*d*(1-d)):x,C=1,T=m?m[1]:x;for(let t=0;t<x;t++){if(t===S){const e=1-y/t;if(e+P*Math.sqrt(e*(1-e)/t)<d)return null;S*=2}if(t===T){for(let t=0;t<2*_;t++)h[t]=0;if(f)for(let t=m[C-1];t<m[C];t++)w[t]=b[f[t]];T=m[++C]}const i=v?f[t]:t,r=i*e,s=l(u,r,e);let n=s%_,a=y;for(;0!==h[2*n+1];){if(h[2*n]===s){const t=h[2*n+1]-1;if(o(u,r,t*e,e)){a=b[t];break}}n++,n>=_&&(n-=_)}a===y&&(h[2*n]=s,h[2*n+1]=i+1,y++),b[i]=a}if(0!==d&&1-y/c<d)return null;if(v){for(let t=m[C-1];t<w.length;t++)w[t]=b[f[t]];b=(0,s.Dg)(w)}const M=n?new Array(y):new Uint32Array(y*e);y=0;for(let t=0;t<x;t++)b[t]===y&&(a(u,(v?f[t]:t)*e,M,y*e,e),y++);if(f&&!v){const t=new Uint32Array(p);for(let e=0;e<t.length;e++)t[e]=b[f[e]];b=(0,s.Dg)(t)}return{buffer:Array.isArray(M)?M:M.buffer,indices:b,uniqueCount:y}}function o(t,e,i,r){for(let s=0;s<r;s++)if(t[e+s]!==t[i+s])return!1;return!0}function a(t,e,i,r,s){for(let n=0;n<s;n++)i[r+n]=t[e+n]}function l(t,e,i){let r=0;for(let s=0;s<i;s++)r=t[e+s]+r|0,r=r+(r<<11)+(r>>>2)|0;return r>>>0}let h=null},47797:function(t,e,i){i.d(e,{projectMeshVertexPositions:function(){return a}});var r=i(57617),s=i(65907),n=i(57652),o=i(20007);function a(t,e){const i=(0,o.UR)(t,s.A.absolute);if(!i)return null;let a=i.position;return(0,n.aI)(t.spatialReference,e)||(a=new Float64Array(i.position.length),(0,r.projectBuffer)(i.position,t.spatialReference,0,a,e,0))?a:null}},83614:function(t,e,i){i.d(e,{$5:function(){return P},CN:function(){return v},GN:function(){return M},JP:function(){return y},KM:function(){return C},Mv:function(){return O},OD:function(){return I},X4:function(){return x},gZ:function(){return T},gr:function(){return w},qs:function(){return S},si:function(){return b},xA:function(){return R}});var r=i(15774),s=i(44705),n=i(87725),o=i(73364),a=i(39714),l=i(20551),h=i(32501),c=i(7456),u=i(57617),d=i(43587),f=i(57652),p=i(1644),m=i(92754),g=i(62693),_=i(32003);const y="Projection may be possible after calling projection.load().";function v(t,e,i,r){t.error(`Failed to project from (wkid:${e.wkid}) to (wkid:${i.wkid}).${r?" ":""}${r}`)}function x(t,e,i,r,s,n){return z(E.TO_PCPF,m.xs.fromTypedArray(t),I.NORMAL,m.Xm.fromTypedArray(e),i,m.Xm.fromTypedArray(r),s,m.xs.fromTypedArray(n))?n:null}function b(t,e,i,r,s,n){return z(E.FROM_PCPF,m.xs.fromTypedArray(t),I.NORMAL,m.Xm.fromTypedArray(e),i,m.Xm.fromTypedArray(r),s,m.xs.fromTypedArray(n))?n:null}function w(t,e,i,r){return(0,u.projectBuffer)(t,e,0,i,r,0)?i:null}function P(t,e,i,r){return(0,u.projectBuffer)(t,e,0,i,r,0)?i:null}function S(t,e,i){return(0,s.Ge)(V,i),(0,g.b)(e,t,V),(0,r.or)(V)&&(0,g.n)(e,e),e}function C(t,e,i){return(0,s.z0)(V,i),(0,_.t)(e,t,V),(0,r.or)(V)&&(0,g.n)(e,e,4),e}function T(t,e,i,s){const n=e===I.NORMAL;return A(t,e,i,((t,e)=>{const i=Math.cos((0,r.kU)(t));e[0]=n?i:1/i,e[1]=1}),s)}function M(t,e,i,r){const s=e===I.NORMAL;return A(t,e,i,((t,e)=>{const i=Math.cosh(-t/d.$O.radius);e[0]=1,e[1]=s?i:1/i}),r)}function A(t,e,i,r,s){const n=e===I.NORMAL?3:4,o=[0,0];for(let e=0,a=1;e<t.length;e+=n,a+=3){r(i[a],o);const l=t[e]*o[0],h=t[e+1]*o[1],c=t[e+2],u=1/Math.sqrt(l*l+h*h+c*c);s[e]=l*u,s[e+1]=h*u,s[e+2]=c*u,4===n&&(s[e+3]=t[e+3])}return s}function R(t,e,i,r,s,n){if(!z(E.TO_PCPF,m.xs.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT),I.TANGENT,m.Xm.fromTypedArray(e),i,m.Xm.fromTypedArray(r),s,m.xs.fromTypedArray(n,4*Float32Array.BYTES_PER_ELEMENT)))return null;for(let e=3;e<t.length;e+=4)n[e]=t[e];return n}function O(t,e,i,r,s,n){if(!z(E.FROM_PCPF,m.xs.fromTypedArray(t,16),I.TANGENT,m.Xm.fromTypedArray(e),i,m.Xm.fromTypedArray(r),s,m.xs.fromTypedArray(n,16)))return null;for(let e=3;e<t.length;e+=4)n[e]=t[e];return n}var I,E,L;function D(t,e,i,r,n){switch((0,c.l)(r,i,k,r),t===E.FROM_PCPF&&(0,o.B8)(k,k),e){case I.NORMAL:return(0,s.Ge)(n,k);case I.TANGENT:return(0,s.z0)(n,k)}}function z(t,e,i,r,s,n,o,a){if(!e)return;const h=r.count;if(function(t){return t.isWGS84||(0,f.x1)(t)||(0,f.q8)(t)||(0,f.KQ)(t)}(s))for(let r=0;r<h;r++)n.getVec(r,N),e.getVec(r,F),(0,l.q)(F,F,D(t,i,N,o,V)),a.setVec(r,F);else for(let s=0;s<h;s++){n.getVec(s,N),e.getVec(s,F);const h=(0,p.jg)(r.get(s,1));let c=Math.cos(h);i===I.TANGENT!=(t===E.TO_PCPF)&&(c=1/c),D(t,i,N,o,V),t===E.TO_PCPF?(V[0]*=c,V[1]*=c,V[2]*=c,V[3]*=c,V[4]*=c,V[5]*=c):(V[0]*=c,V[3]*=c,V[6]*=c,V[1]*=c,V[4]*=c,V[7]*=c),(0,l.q)(F,F,V),(0,l.n)(F,F),a.setVec(s,F)}return a}(L=I||(I={}))[L.NORMAL=0]="NORMAL",L[L.TANGENT=1]="TANGENT",function(t){t[t.TO_PCPF=0]="TO_PCPF",t[t.FROM_PCPF=1]="FROM_PCPF"}(E||(E={}));const N=(0,h.vt)(),F=(0,h.vt)(),k=(0,a.vt)(),V=(0,n.vt)()},20007:function(t,e,i){i.d(e,{UR:function(){return b},p5:function(){return x},xK:function(){return M}});var r=i(40633),s=i(15774),n=i(62938),o=i(44705),a=i(87725),l=i(73364),h=i(39714),c=i(20551),u=i(32501),d=i(96611),f=i(7456),p=i(56763),m=i(67376),g=i(57652),_=i(62693),y=i(83614);const v=()=>r.A.getLogger("esri.geometry.support.meshUtils.vertexSpaceConversion");function x(t,e,{vertexSpace:i,spatialReference:r}){if("georeferenced"===i.type){const s=t;if(!(0,p.g)(e,s,r))return!1;const{origin:n}=i;return(0,c.d)(t,s,n),!0}const s=(0,d.lO)(r),n=t;if(!(0,p.g)(e,n,s))return!1;const{origin:o}=i,a=E;if(!(0,f.l)(r,o,a,s))return!1;const h=(0,l.B8)(E,a);return null!=h&&((0,c.t)(t,n,h),!0)}function b(t,e,i){const{vertexSpace:r,transform:s,vertexAttributes:n}=t,a=(0,m.Hq)(r)?s:null,u=C(t.spatialReference,i,L.SOURCE_AND_TARGET);if((0,m.yJ)(r,e)&&(!a||(0,l.t2)(a.localMatrix,h.zK))&&T(u)){const{position:t,normal:e,tangent:r}=n,s=i?.allowBufferReuse;return{position:s?t:t.slice(),normal:s?e:e?.slice(),tangent:s?r:r?.slice()}}switch(t.vertexSpace.type){case"local":return"local"===e.type?function({vertexAttributes:t,spatialReference:e,transform:i},{origin:r},s,n){const o=w(e,n);if(!(0,f.l)(e,r,A,o))return(0,y.CN)(v(),e,o),null;if(i&&(0,l.lw)(A,A,i.localMatrix),!(0,f.l)(e,s,R,o))return(0,y.CN)(v(),o,e),null;(0,l.B8)(R,R);const a=(0,l.lw)(A,R,A);return S(a,e,n,L.SOURCE_AND_TARGET),P(t,a)}(t,t.vertexSpace,e.origin,i):function({spatialReference:t,vertexAttributes:e,transform:i},{origin:r},s,n){const o=w(t,n);if(!(0,f.l)(t,r,A,o))return(0,y.CN)(v(),t,o),null;i&&(0,l.lw)(A,A,i.localMatrix),S(A,t,n,L.SOURCE);const a=new Float64Array(e.position.length),h=function(t,e,i,r,s){(0,_.t)(r,t,e);const n=new Float64Array(t.length);return(0,y.$5)(r,s,n,i)?n:((0,y.CN)(v(),s,i),null)}(e.position,A,t,a,o);if(!h)return null;const u=function(t,e,i,r,s,n){if(null==s)return null;const o=new Float32Array(s.length);return(0,y.qs)(s,o,n),(0,y.si)(o,t,e,i,r,o)?o:((0,y.CN)(v(),r,e),null)}(h,t,a,o,e.normal,A);if(e.normal&&!u)return null;const d=function(t,e,i,r,s,n){if(null==s)return null;const o=new Float32Array(s.length);return(0,y.KM)(s,o,n),(0,y.Mv)(o,t,e,i,r,o)?o:((0,y.CN)(v(),r,e),null)}(h,t,a,o,e.tangent,A);if(e.tangent&&!d)return null;if(s){const t=(0,c.v)(I,s);(0,_.a)(h,h,t)}return{position:h,normal:u,tangent:d}}(t,t.vertexSpace,e.origin,i);case"georeferenced":return"local"===e.type?function({vertexAttributes:t,spatialReference:e,transform:i},{origin:r},s,n){const a=w(e,n);if(!(0,f.l)(e,s,A,a))return(0,y.CN)(v(),e,a),null;const h=1/C(e,n,L.TARGET);(0,l.hs)(A,A,[h,h,h]);const c=(0,l.B8)(R,A),{position:u,normal:d,tangent:p}=function(t,e,i){if(!e)return t;if(!i){const{position:i,normal:r,tangent:s}=t;return{position:(0,_.a)(new Float64Array(i.length),i,e),tangent:s,normal:r}}const r=P(t,i.localMatrix);return(0,_.a)(r.position,r.position,e),r}(t,r,i),m=new Float64Array(u.length),g=function(t,e,i,r,s){const n=(0,y.gr)(t,e,r,s);if(!n)return(0,y.CN)(v(),e,s),null;const o=new Float64Array(n.length);return(0,_.t)(o,n,i),o}(u,e,c,m,a);if(!g)return null;const x=(0,o.Ge)(O,c),b=function(t,e,i,r,s,n,o){if(null==t)return null;const a=o??new Float32Array(t.length);return(0,y.X4)(t,e,i,r,s,a)?((0,_.b)(a,a,n),a):((0,y.CN)(v(),i,s),null)}(d,u,e,m,a,x,d!==t.normal?d:void 0);if(!b&&d)return null;const S=function(t,e,i,r,s,n,o){if(null==t)return null;const a=o??new Float32Array(t.length);return(0,y.xA)(t,e,i,r,s,a)?((0,_.b)(a,a,n,4),a):((0,y.CN)(v(),i,s),null)}(p,u,e,m,a,x,p!==t.tangent?p:void 0);return!S&&p?null:{position:g,normal:b,tangent:S}}(t,t.vertexSpace,e.origin,i):function({vertexAttributes:t,transform:e,spatialReference:i},{origin:r},s,n){const o=C(i,n,L.SOURCE_AND_TARGET),a=r||!T(o)?(0,l.C)(A,e?.localMatrix??h.zK):null;a&&S(a,i,n,L.SOURCE_AND_TARGET);const{position:u,normal:d,tangent:f}=a?P(t,a):t,p=n?.allowBufferReuse,m=p?u:new Float64Array(u.length);let g=u;if(r&&(g=(0,_.a)(m,g,r)),s){const t=(0,c.v)(I,s);g=(0,_.a)(m,g,t)}return{position:g!==t.position||p?g:g.slice(),normal:d!==t.normal||p?d:d?.slice(),tangent:f!==t.tangent||p?f:f?.slice()}}(t,t.vertexSpace,e.origin,i)}}function w(t,e){return e?.useEllipsoid&&(0,g.B3)(t)?d.Y0:(0,d.lO)(t)}function P(t,e){const i=new Float64Array(t.position.length);(0,_.t)(i,t.position,e);const r=t.normal?new Float32Array(t.normal.length):null,s=t.tangent?new Float32Array(t.tangent.length):null;return r&&t.normal&&(0,y.qs)(t.normal,r,e),s&&t.tangent&&(0,y.KM)(t.tangent,s,e),{position:i,normal:r,tangent:s}}function S(t,e,i,r){const s=C(e,i,r);T(s)||(0,l.hs)(t,t,[s,s,s])}function C(t,e,i){const r=!!(i&L.SOURCE),s=!!(i&L.TARGET),n=e?.sourceUnit,o=e?.targetUnit;if(!n&&!o)return 1;let a=M(n,t);r||!n||T(a)||(v().warn("source unit conversion not supported"),a=1);let l=1/M(o,t);return s||!o||T(l)||(v().warn("target unit conversion not supported"),l=1),a*l}function T(t){return(0,s.Io)(t,1)}function M(t,e){if(null==t)return 1;const i=(0,n.KX)(e);return 1/(0,n.oU)(i,"meters",t)}const A=(0,h.vt)(),R=(0,h.vt)(),O=(0,a.vt)(),I=(0,u.vt)(),E=(0,h.vt)();var L,D;(D=L||(L={}))[D.NONE=0]="NONE",D[D.SOURCE=1]="SOURCE",D[D.TARGET=2]="TARGET",D[D.SOURCE_AND_TARGET=3]="SOURCE_AND_TARGET"},6527:function(t,e,i){i.d(e,{S:function(){return l}});var r=i(15774),s=i(62938),n=i(20551),o=i(72485),a=i(5596);function l(t,e,i){const l=function(t,e,i,r){const o=(t=>!Array.isArray(t[0]))(e)?(t,i)=>e[3*t+i]:(t,i)=>e[t][i],l=r?(0,s.GA)(r)/(0,s.G9)(r):1;return(0,a.lU)(t,((t,e)=>(0,n.i)(t,o(e,0)*l,o(e,1)*l,o(e,2))),i)}(h,t,e,i)?(0,a.Qj)(h):[0,0,1];return Math.abs(l[2])>Math.cos((0,r.kU)(80))?o._.Z:Math.abs(l[1])>Math.abs(l[0])?o._.Y:o._.X}const h=(0,a.vt)()},82588:function(t,e,i){i.d(e,{Wq:function(){return r},lO:function(){return d},oR:function(){return f}});var r,s,n=i(59122),o=i(72485),a=i(38441),l=i(50240),h=i(37819),c=i(6527),u=i(61003);function d(t){const e=f(t.rings,t.hasZ,r.CCW_IS_HOLE,t.spatialReference),i=new Array;let s=0,o=0;for(const t of e.polygons){const r=t.count,a=t.index,c=(0,l.l5)(e.position,3*a,3*r),u=t.holeIndices.map((t=>t-a)),d=(0,h.Dg)((0,n.e)(c,u,3));i.push({position:c,faces:d}),s+=c.length,o+=d.length}const a=function(t,e,i){if(1===t.length)return t[0];const r=(0,l.jh)(e),s=new Array(i);let n=0,o=0,a=0;for(const e of t){for(let t=0;t<e.position.length;t++)r[n++]=e.position[t];for(const t of e.faces)s[o++]=t+a;a=n/3}return{position:r,faces:(0,h.Dg)(s)}}(i,s,o),c=Array.isArray(a.position)?(0,u.b)(a.position,3,{originalIndices:a.faces}):(0,u.b)(a.position.buffer,6,{originalIndices:a.faces});return a.position=(0,l.xm)(new Float64Array(c.buffer)),a.faces=c.indices,a}function f(t,e,i,s){const n=t.length,o=new Array(n),a=new Array(n),h=new Array(n);let c=0;for(let e=0;e<n;++e)c+=t[e].length;let u=0,d=0,f=0;const g=(0,l.jh)(3*c);let _=0;for(let l=n-1;l>=0;l--){const c=t[l],y=i===r.CCW_IS_HOLE&&m(c,e,s);if(y&&1!==n)o[u++]=c;else{let t=c.length;for(let e=0;e<u;++e)t+=o[e].length;const i={index:_,pathLengths:new Array(u+1),count:t,holeIndices:new Array(u)};i.pathLengths[0]=c.length,c.length>0&&(h[f++]={index:_,count:c.length}),_=y?p(c,c.length-1,-1,g,_,c.length,e):p(c,0,1,g,_,c.length,e);for(let t=0;t<u;++t){const r=o[t];i.holeIndices[t]=_,i.pathLengths[t+1]=r.length,r.length>0&&(h[f++]={index:_,count:r.length}),_=p(r,0,1,g,_,r.length,e)}u=0,i.count>0&&(a[d++]=i)}}for(let t=0;t<u;++t){const i=o[t];i.length>0&&(h[f++]={index:_,count:i.length}),_=p(i,0,1,g,_,i.length,e)}return a.length=d,h.length=f,{position:g,polygons:a,outlines:h}}function p(t,e,i,r,s,n,o){s*=3;for(let a=0;a<n;++a){const n=t[e];r[s++]=n[0],r[s++]=n[1],r[s++]=o&&n[2]?n[2]:0,e+=i}return s/3}function m(t,e,i){if(!e)return!(0,a.$3)(t);const r=t.length-1;switch((0,c.S)(t,r,i)){case o._.X:return!(0,a.$3)(t,o._.Y,o._.Z);case o._.Y:return!(0,a.$3)(t,o._.X,o._.Z);case o._.Z:return!(0,a.$3)(t,o._.X,o._.Y)}}(s=r||(r={}))[s.NONE=0]="NONE",s[s.CCW_IS_HOLE=1]="CCW_IS_HOLE"},51376:function(t,e,i){function r(t,e,i){return{objectId:t,target:e,distance:i,type:"vertex"}}function s(t,e,i,r,s,n=!1){return{objectId:t,target:e,distance:i,type:"edge",start:r,end:s,draped:n}}i.d(e,{P:function(){return s},k:function(){return r}})},14921:function(t,e,i){var r;i.d(e,{$:function(){return r}}),function(t){t[t.EnableFastUpdates=0]="EnableFastUpdates",t[t.DisableFastUpdates=1]="DisableFastUpdates",t[t.UpdateFastLocalOrigin=2]="UpdateFastLocalOrigin"}(r||(r={}))},23454:function(t,e,i){i.d(e,{Aq:function(){return s},pC:function(){return n},rx:function(){return o}});var r=i(29076);function s(t,e){t[4]=e}class n{constructor(t,e=!0,i=!0,s=0){this.isClosed=!1,this.geometryCursor=null,this.geometryCursor=!e&&"esriGeometryPolygon"===t.geometryType||!i&&"esriGeometryPolyline"===t.geometryType?null:t,this.geomUnitsPerPoint=s,this.iterateMultiPath=!1,this.iteratePath=!1,this.internalPlacement=new r.W}next(){if(!this.geometryCursor)return null;const t=this.processMultiPath(this.geometryCursor);return this.iterateMultiPath&&t||(this.geometryCursor=null),t}processMultiPath(t){for(;this.iteratePath||t.pathIndex<t.totalSize-1;){this.iteratePath||t.nextPath(),this.iterateMultiPath=!0;const e=this.processPath(t);if(e)return e}return this.iterateMultiPath=!1,null}}class o{constructor(t,e,i,r=0){this.isClosed=!1,this.inputGeometries=t,this.acceptPolygon=e,this.acceptPolyline=i,this.geomUnitsPerPoint=r,this.iteratePath=!1,this.multiPathCursor=null}next(){for(;;){if(!this.multiPathCursor){let t=this.inputGeometries.next();for(;t&&(this.isClosed=this.acceptPolygon&&"esriGeometryPolygon"===t.geometryType||"esriGeometryEnvelope"===t.geometryType,this.multiPathCursor=t,!this.multiPathCursor);)t=this.inputGeometries.next();if(!this.multiPathCursor)return null}for(;this.iteratePath||this.multiPathCursor.nextPath();){this.multiPathCursor.seekPathStart();const t=this.processPath(this.multiPathCursor);if(t)return t}this.multiPathCursor=null}}}},62096:function(t,e,i){i.d(e,{k:function(){return a},q:function(){return l}});var r=i(33134),s=i(72139);const n=512;let o;class a{constructor(t){this._geometry=t}next(){const t=this._geometry;return this._geometry=null,t}}function l(t,e){o||(o=new s.O3(0,0,0,1));const i="esriGeometryPolygon"===t.geometryType,a=i?s.dC.Polygon:s.dC.LineString,l=i?3:2;let h,c;for(o.reset(a),o.setPixelMargin(e+1),o.setExtent(n);t.nextPath();)if(!(t.pathSize<l)){for(t.nextPoint(),h=t.x,c=-t.y,o.moveTo(h,c);t.nextPoint();)h=t.x,c=-t.y,o.lineTo(h,c);i&&o.close()}const u=o.result(!1);if(u){const e=r.z.createEmptyOptimizedCIM(t.geometryType);for(const t of u){e.startPath();for(const i of t)e.pushXY(i.x,-i.y)}return e.reset(),e}return null}},9635:function(t,e,i){i.d(e,{A:function(){return S},c:function(){return C}});var r=i(63514),s=i(82112),n=i(20391),o=i(11672),a=i(12281),l=i(2969),h=i(7889),c=i(48645),u=i(7088),d=i(17706),f=i(10183),p=i(1646),m=i(79323),g=i(34476),_=i(31771),y=i(15987),v=i(19511),x=i(20305),b=i(58892),w=i(80585),P=i(58676);function S(t){if(!t)return null;switch(t.type){case"CIMGeometricEffectAddControlPoints":return r.N.local();case"CIMGeometricEffectArrow":return s.B.local();case"CIMGeometricEffectBuffer":return n.s.local();case"CIMGeometricEffectControlMeasureLine":return o.v.local();case"CIMGeometricEffectCut":return a.y.local();case"CIMGeometricEffectDashes":return l.I.local();case"CIMGeometricEffectDonut":return h.O.local();case"CIMGeometricEffectJog":return c.U.local();case"CIMGeometricEffectMove":return u.V.local();case"CIMGeometricEffectOffset":return d.V.local();case"CIMGeometricEffectReverse":return f.C.local();case"CIMGeometricEffectRotate":return p.v.local();case"CIMGeometricEffectScale":return m.W.local();case"CIMGeometricEffectWave":return g.l.local()}return null}function C(t){if(!t)return null;switch(t.type){case"CIMMarkerPlacementAlongLineSameSize":return _.e.local();case"CIMMarkerPlacementAtExtremities":return y.y.local();case"CIMMarkerPlacementAtRatioPositions":return v.S.local();case"CIMMarkerPlacementInsidePolygon":return x.M.local();case"CIMMarkerPlacementOnLine":return b.R.local();case"CIMMarkerPlacementOnVertices":return w.A.local();case"CIMMarkerPlacementPolygonCenter":return P.L.local()}return null}},29076:function(t,e,i){i.d(e,{W:function(){return r}});class r{constructor(){this.setIdentity()}getAngle(){return(null==this.rz||0===this.rz&&1!==this.rzCos&&0!==this.rzSin)&&(this.rz=Math.atan2(this.rzSin,this.rzCos)),this.rz}setIdentity(){this.tx=0,this.ty=0,this.tz=0,this.s=1,this.rx=0,this.ry=0,this.rz=0,this.rzCos=1,this.rzSin=0}setTranslate(t,e){this.tx=t,this.ty=e}setTranslateZ(t){this.tz=t}setRotateCS(t,e){this.rz=void 0,this.rzCos=t,this.rzSin=e}setRotate(t){this.rz=t,this.rzCos=void 0,this.rzSin=void 0}setRotateY(t){this.ry=t}setScale(t){this.s=t}setMeasure(t){this.m=t}}},14817:function(t,e,i){i.d(e,{Rj:function(){return N},mx:function(){return D},CK:function(){return z},IT:function(){return E},QF:function(){return B}});var r=i(80683),s=i(58941),n=i(21609),o=i(40633),a=i(56996),l=i(13520),h=i(33134),c=i(87416),u=i(35068),d=i(72228),f=i(74697),p=i(62096);class m{applyColorSubstitution(t,e){if(!e)return t;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const{width:i,height:r}=t,s=this._rasterizationCanvas,n=s.getContext("2d",{willReadFrequently:!0});t!==s&&(s.width=i,s.height=r,n.drawImage(t,0,0,i,r));const o=n.getImageData(0,0,i,r).data;if(e)for(const t of e)if(t&&t.oldColor&&4===t.oldColor.length&&t.newColor&&4===t.newColor.length){const[e,i,r,s]=t.oldColor,[n,a,l,h]=t.newColor;if(e===n&&i===a&&r===l&&s===h)continue;for(let t=0;t<o.length;t+=4)e===o[t]&&i===o[t+1]&&r===o[t+2]&&s===o[t+3]&&(o[t]=n,o[t+1]=a,o[t+2]=l,o[t+3]=h)}const a=new ImageData(o,i,r);return n.putImageData(a,0,0),s}tintImageData(t,e){if(!e||e.length<4)return t;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const{width:i,height:r}=t,s=this._rasterizationCanvas,n=s.getContext("2d",{willReadFrequently:!0});t!==s&&(s.width=i,s.height=r,n.drawImage(t,0,0,i,r));const o=n.getImageData(0,0,i,r),a=new Uint8Array(o.data),l=[e[0]/255,e[1]/255,e[2]/255,e[3]/255];for(let t=0;t<a.length;t+=4)a[t]*=l[0],a[t+1]*=l[1],a[t+2]*=l[2],a[t+3]*=l[3];const h=new ImageData(new Uint8ClampedArray(a.buffer),i,r);return n.putImageData(h,0,0),s}}var g=i(9635),_=i(29076),y=i(38821),v=i(33389);function x(t){const e=t.getFrame(0);if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement)return e;const i=document.createElement("canvas");i.width=t.width,i.height=t.height;const r=i.getContext("2d");return e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0),i}var b=i(82497),w=i(64303);function P(t){return`rgba(${t.slice(0,3).toString()},${t[3]})`}class S{constructor(t){t&&(this._textRasterizationCanvas=t)}rasterizeText(t,e){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const i=this._textRasterizationCanvas,r=i.getContext("2d",{willReadFrequently:!0});C(r,e),this._parameters=e,this._textLines=t.split(/\r?\n/),this._lineHeight=this._computeLineHeight();const{decoration:s,weight:n}=e.font;this._lineThroughWidthOffset=s&&"line-through"===s?.1*this._lineHeight:0;const o=null!=e.backgroundColor||null!=e.borderLine,a=o?w.y7:0,l=this._computeTextWidth(r,e)+2*a,h=this._lineHeight*this._textLines.length+2*a;if(i.width=l+2*this._lineThroughWidthOffset,i.height=h,0===i.width||0===i.height)return i.width=i.height=1,{size:[0,0],image:new Uint32Array(0),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0,canvas:i};this._renderedLineHeight=Math.round(this._lineHeight),this._renderedOutlineSize=(e.outline.size||0)*e.pixelRatio,this._renderedHaloSize=(e.halo.size||0)*e.pixelRatio,this._renderedWidth=l,this._renderedHeight=h,this._lineThroughWidthOffset*=e.pixelRatio;const c=(e.outline&&e.outline.color)??[0,0,0,0],u=e.color??[0,0,0,0],d=e.halo&&e.halo.color?e.halo.color:[0,0,0,0];this._fillStyle=P(u),this._outlineStyle=P(c),this._haloStyle=function(t){return`rgb(${t.slice(0,3).toString()})`}(d);const f=this._renderedLineHeight,p=this._renderedOutlineSize,m=this._renderedHaloSize;r.save(),r.clearRect(0,0,i.width,i.height),C(r,e);const g=a*e.pixelRatio,_=function(t,e,i){return"center"===t?.5*e:"right"===t?e-i:i}(r.textAlign,this._renderedWidth-2*g,this._renderedHaloSize+this._renderedOutlineSize)+g,y=m+p+g,v=m>0;let x=this._lineThroughWidthOffset,b=0;if(o){r.save();const t=e.backgroundColor??[0,0,0,0],s=e.borderLine?.color??[0,0,0,0],n=2*(e.borderLine?.size??0);r.fillStyle=P(t),r.strokeStyle=P(s),r.lineWidth=n,r.fillRect(0,0,i.width,i.height),r.strokeRect(0,0,i.width,i.height),r.restore()}v&&this._renderHalo(r,_,y,x,b,e),p>0&&this._renderOutline(r,_,y,x,b,e),b+=y,x+=_;for(const t of this._textLines)v?(r.globalCompositeOperation="destination-out",r.fillStyle="rgb(0, 0, 0)",r.fillText(t,x,b),r.globalCompositeOperation="source-over",r.fillStyle=this._fillStyle,r.fillText(t,x,b)):(r.fillStyle=this._fillStyle,r.fillText(t,x,b)),s&&"none"!==s&&this._renderDecoration(r,x,b,s,n),b+=f;r.restore();const S=this._renderedWidth+2*this._lineThroughWidthOffset,T=this._renderedHeight,M=r.getImageData(0,0,S,T),A=new Uint8Array(M.data);if(e.premultiplyColors){let t;for(let e=0;e<A.length;e+=4)t=A[e+3]/255,A[e]=A[e]*t,A[e+1]=A[e+1]*t,A[e+2]=A[e+2]*t}let R,O;switch(e.horizontalAlignment){case"left":R=-.5;break;case"right":R=.5;break;default:R=0}switch(e.verticalAlignment){case"bottom":O=-.5;break;case"top":O=.5;break;case"baseline":O=-1/6;break;default:O=0}return{size:[S,T],image:new Uint32Array(A.buffer),sdf:!1,simplePattern:!1,anchorX:R,anchorY:O,canvas:i}}_renderHalo(t,e,i,r,s,n){const o=this._renderedWidth,a=this._renderedHeight;this._outlineRasterizationCanvas||(this._outlineRasterizationCanvas=document.createElement("canvas")),this._outlineRasterizationCanvas.width=o,this._outlineRasterizationCanvas.height=a;const l=this._outlineRasterizationCanvas,h=l.getContext("2d");h.clearRect(0,0,o,a),C(h,n);const{decoration:c,weight:u}=n.font;h.fillStyle=this._haloStyle,h.strokeStyle=this._haloStyle,h.lineJoin="round",this._renderOutlineNative(h,e,i,c,u,this._renderedHaloSize+this._renderedOutlineSize),t.globalAlpha=this._parameters.halo.color[3],t.drawImage(l,0,0,o,a,r,s,o,a),t.globalAlpha=1}_renderOutline(t,e,i,r,s,n){const o=this._renderedWidth,a=this._renderedHeight;this._outlineRasterizationCanvas||(this._outlineRasterizationCanvas=document.createElement("canvas")),this._outlineRasterizationCanvas.width=o,this._outlineRasterizationCanvas.height=a;const l=this._outlineRasterizationCanvas,h=l.getContext("2d");h.clearRect(0,0,o,a),C(h,n);const{decoration:c,weight:u}=n.font;h.fillStyle=this._outlineStyle,h.strokeStyle=this._outlineStyle,h.lineJoin="round",this._renderOutlineNative(h,e,i,c,u,this._renderedOutlineSize),t.globalAlpha=this._parameters.outline.color[3],t.drawImage(l,0,0,o,a,r,s,o,a),t.globalAlpha=1}_renderOutlineNative(t,e,i,r,s,n){const o=this._renderedLineHeight;for(const a of this._textLines){const l=2*n,h=5,c=.1;for(let n=0;n<h;n++){const o=(1-(h-1)*c+n*c)*l;t.lineWidth=o,t.strokeText(a,e,i),r&&"none"!==r&&this._renderDecoration(t,e,i,r,s,o)}i+=o}}computeTextSize(t,e){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const i=this._textRasterizationCanvas,r=i.getContext("2d");C(r,e),this._parameters=e,this._textLines=t.split(/\r?\n/),this._lineHeight=this._computeLineHeight();const s=this._computeTextWidth(r,e),n=this._lineHeight*this._textLines.length;return i.width=s,i.height=n,[s*e.pixelRatio,n*e.pixelRatio]}_computeTextWidth(t,e){let i=0;for(const e of this._textLines)i=Math.max(i,t.measureText(e).width);const r=e.font;return("italic"===r.style||"oblique"===r.style||"string"==typeof r.weight&&("bold"===r.weight||"bolder"===r.weight)||"number"==typeof r.weight&&r.weight>600)&&(i+=.3*t.measureText("w").width),i+=2*(0,l.Lz)(this._parameters.halo.size),Math.round(i)}_computeLineHeightBase(){return 1.275*this._parameters.size}_computeLineHeight(){let t=this._computeLineHeightBase();const e=this._parameters.font.decoration;return e&&"underline"===e&&(t*=1.3),Math.round(t+2*(0,l.Lz)(this._parameters.halo.size))}_renderDecoration(t,e,i,r,s,n){let o=.9*this._lineHeight;const a="bold"===s?.06:"bolder"===s?.09:.04;switch(t.textAlign){case"center":e-=this._renderedWidth/2;break;case"right":e-=this._renderedWidth}const l=t.textBaseline;if("underline"===r)switch(o=.9*this._computeLineHeightBase(),l){case"top":i+=o;break;case"middle":i+=o/2}else if("line-through"===r)switch(l){case"top":i+=o/1.5;break;case"middle":i+=o/3}const h=n?1.5*n:Math.ceil(o*a);t.save(),t.beginPath(),t.strokeStyle=t.fillStyle,t.lineWidth=h,t.moveTo(e-this._lineThroughWidthOffset,i),t.lineTo(e+this._renderedWidth+2*this._lineThroughWidthOffset,i),t.stroke(),t.restore()}}function C(t,e){const i=Math.max(e.size,.5),r=e.font,s=`${r.style} ${r.weight} ${(0,l.Lz)(i).toFixed(1)}px ${r.family}, sans-serif`;let n;switch(t.font=s,t.textBaseline="top",e.horizontalAlignment){case"left":default:n="left";break;case"right":n="right";break;case"center":n="center"}t.textAlign=n}var T=i(7590),M=i(16043),A=i(39686),R=i(17469),O=i(96700);const I=Math.PI/180;class E{constructor(t){this._t=t}static createIdentity(){return new E([1,0,0,0,1,0])}clone(){const t=this._t;return new E(t.slice())}transform(t){const e=this._t;return[e[0]*t[0]+e[1]*t[1]+e[2],e[3]*t[0]+e[4]*t[1]+e[5]]}static createScale(t,e){return new E([t,0,0,0,e,0])}scale(t,e){const i=this._t;return i[0]*=t,i[1]*=t,i[2]*=t,i[3]*=e,i[4]*=e,i[5]*=e,this}scaleRatio(){return Math.sqrt(this._t[0]*this._t[0]+this._t[1]*this._t[1])}static createTranslate(t,e){return new E([0,0,t,0,0,e])}translate(t,e){const i=this._t;return i[2]+=t,i[5]+=e,this}static createRotate(t){const e=Math.cos(t),i=Math.sin(t);return new E([e,-i,0,i,e,0])}rotate(t){return E.multiply(this,E.createRotate(t),this)}angle(){const t=this._t[0],e=this._t[3],i=Math.sqrt(t*t+e*e);return[t/i,e/i]}static multiply(t,e,i){const r=t._t,s=e._t,n=r[0]*s[0]+r[3]*s[1],o=r[1]*s[0]+r[4]*s[1],a=r[2]*s[0]+r[5]*s[1]+s[2],l=r[0]*s[3]+r[3]*s[4],h=r[1]*s[3]+r[4]*s[4],c=r[2]*s[3]+r[5]*s[4]+s[5],u=i._t;return u[0]=n,u[1]=o,u[2]=a,u[3]=l,u[4]=h,u[5]=c,i}invert(){const t=this._t;let e=t[0]*t[4]-t[1]*t[3];if(0===e)return new E([0,0,0,0,0,0]);e=1/e;const i=(t[1]*t[5]-t[2]*t[4])*e,r=(t[2]*t[3]-t[0]*t[5])*e,s=t[4]*e,n=-t[1]*e,o=-t[3]*e,a=t[0]*e;return new E([s,n,i,o,a,r])}}class L{constructor(t,e){this._resourceManager=t,this._transfos=[],this._sizeTransfos=[],this._geomUnitsPerPoint=1,this._placementPool=new a.A(_.W,void 0,void 0,100),this._earlyReturn=!1,this._mapRotation=0,this._transfos.push(e||E.createIdentity()),this._sizeTransfos.push(e?e.scaleRatio():1)}setTransform(t,e){this._transfos=[t||E.createIdentity()],this._sizeTransfos=[e||(t?t.scaleRatio():1)]}setGeomUnitsPerPoint(t){this._geomUnitsPerPoint=t}transformPt(t){return this._transfos[this._transfos.length-1].transform(t)}transformSize(t){return t*this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformPt(t){return this._transfos[this._transfos.length-1].invert().transform(t)}reverseTransformSize(t){return t/this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformScalar(t){return t/this._transfos[this._transfos.length-1].scaleRatio()}getTransformAngle(){return this._transfos[this._transfos.length-1].angle()}geomUnitsPerPoint(){return this.isEmbedded()?1:this._geomUnitsPerPoint}prevGeomUnitsPerPoint(){return this._transfos.length>2?1:this._geomUnitsPerPoint}isEmbedded(){return this._transfos.length>1}back(){return this._transfos[this._transfos.length-1]}push(t,e){const i=e?t.scaleRatio():1;E.multiply(t,this.back(),t),this._transfos.push(t),this._sizeTransfos.push(this._sizeTransfos[this._sizeTransfos.length-1]*i)}pop(){this._transfos.splice(-1,1),this._sizeTransfos.splice(-1,1)}drawSymbol(t,e,i){if(t)switch(t.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":this.drawMultiLayerSymbol(t,e);break;case"CIMTextSymbol":this.drawTextSymbol(t,e,i)}}drawMultiLayerSymbol(t,e){if(!t||!e)return;const i=t.symbolLayers;if(!i)return;const r=t.effects;if(r&&r.length>0){const t=this.executeEffects(r,e);if(t){let e=t.next();for(;e;)this.drawSymbolLayers(i,e.asJSON()),e=t.next()}}else this.drawSymbolLayers(i,e)}executeEffects(t,e){const i=this._resourceManager.geometryEngine;let r=new p.k(h.z.fromJSONCIM(e));for(const e of t){const t=(0,g.A)(e);t&&(r=t.execute(r,e,this.geomUnitsPerPoint(),null,i))}return r}drawSymbolLayers(t,e){let i=t.length;for(;i--;){const r=t[i];if(!r||!1===r.enable)continue;const s=r.effects;if(s&&s.length>0){const t=this.executeEffects(s,e);if(t){let e=null;for(;(e=t.next())&&(this.drawSymbolLayer(r,e.asJSON()),!this._earlyReturn););}}else this.drawSymbolLayer(r,e);if(this._earlyReturn)return}}drawSymbolLayer(t,e){switch(t.type){case"CIMSolidFill":this.drawSolidFill(e,t.color,t.path);break;case"CIMHatchFill":this.drawHatchFill(e,t);break;case"CIMPictureFill":this.drawPictureFill(e,t);break;case"CIMGradientFill":this.drawGradientFill(e,t);break;case"CIMSolidStroke":this.drawSolidStroke(e,t.color,t.width,t.capStyle,t.joinStyle,t.miterLimit,t.path);break;case"CIMPictureStroke":this.drawPictureStroke(e,t);break;case"CIMGradientStroke":this.drawGradientStroke(e,t);break;case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":this.drawMarkerLayer(t,e)}}drawHatchFill(t,e){const i=function(t,e,i){let r=(0,T.$w)(t.separation,y.D.CIMHatchFill.separation)*i,s=(0,T.$w)(t.rotation);if(0===r)return null;r<0&&(r=-r);let n=0;const o=.5*r;for(;n>o;)n-=r;for(;n<-o;)n+=r;const a=(0,c.vt)();(0,u.Rg)(a,e),a[0]-=o,a[1]-=o,a[2]+=o,a[3]+=o;const l=[[a[0],a[1]],[a[0],a[3]],[a[2],a[3]],[a[2],a[1]]];for(;s>180;)s-=180;for(;s<0;)s+=180;const h=Math.cos(s*I),d=Math.sin(s*I),f=-r*d,p=r*h;let m,g,_,v;n=(0,T.$w)(t.offsetX)*i*d-(0,T.$w)(t.offsetY)*i*h,m=_=Number.MAX_VALUE,g=v=-Number.MAX_VALUE;for(const t of l){const e=t[0],i=t[1],r=h*e+d*i,s=-d*e+h*i;m=Math.min(m,r),_=Math.min(_,s),g=Math.max(g,r),v=Math.max(v,s)}_=Math.floor(_/r)*r;let x=h*m-d*_-f*n/r,b=d*m+h*_-p*n/r,w=h*g-d*_-f*n/r,P=d*g+h*_-p*n/r;const S=1+Math.round((v-_)/r),C=[];for(let t=0;t<S;t++)x+=f,b+=p,w+=f,P+=p,C.push([[x,b],[w,P]]);return{paths:C}}(e,t,this.geomUnitsPerPoint());i&&(this.pushClipPath(t),this.drawMultiLayerSymbol(e.lineSymbol,i),this.popClipPath())}drawPictureFill(t,e){}drawGradientFill(t,e){}drawPictureStroke(t,e){}drawGradientStroke(t,e){}drawMarkerLayer(t,e){const i=t.markerPlacement;if(i){const r=(0,g.c)(i);if(r){const s="CIMMarkerPlacementInsidePolygon"===i.type||"CIMMarkerPlacementPolygonCenter"===i.type&&i.clipAtBoundary;s&&this.pushClipPath(e);const n=r.execute(h.z.fromJSONCIM(e),i,this.geomUnitsPerPoint(),null,this._resourceManager.geometryEngine);if(n){let e=null;for(;(e=n.next())&&(this.drawMarker(t,e),!this._earlyReturn););}s&&this.popClipPath()}}else{const i=this._placementPool.acquire();if((0,f.fT)(e))i.tx=e.x,i.ty=e.y,this.drawMarker(t,i);else if((0,f.Bi)(e)){const r=(0,d.l8)(e);r&&([i.tx,i.ty]=r,this.drawMarker(t,i))}else for(const r of e.points)if(i.tx=r[0],i.ty=r[1],this.drawMarker(t,i),this._earlyReturn)break;this._placementPool.release(i)}}drawMarker(t,e){switch(t.type){case"CIMCharacterMarker":case"CIMPictureMarker":this.drawPictureMarker(t,e);break;case"CIMVectorMarker":this.drawVectorMarker(t,e)}}drawPictureMarker(t,e){if(!t)return;const i=this._resourceManager.getResource(t.url),r=(0,T.$w)(t.size,y.D.CIMPictureMarker.size);if(null==i||r<=0)return;const s=i.width,n=i.height;if(!s||!n)return;const o=s/n,a=(0,T.$w)(t.scaleX,1),l=E.createIdentity(),h=t.anchorPoint;if(h){let e=h.x,i=h.y;"Absolute"!==t.anchorPointUnits&&(e*=r*o*a,i*=r),l.translate(-e,-i)}let c=(0,T.$w)(t.rotation);t.rotateClockwise&&(c=-c),this._mapRotation&&(c+=this._mapRotation),c&&l.rotate(c*I);let u=(0,T.$w)(t.offsetX),d=(0,T.$w)(t.offsetY);if(u||d){if(this._mapRotation){const t=I*this._mapRotation,e=Math.cos(t),i=Math.sin(t),r=u*i+d*e;u=u*e-d*i,d=r}l.translate(u,d)}const f=this.geomUnitsPerPoint();1!==f&&l.scale(f,f);const p=e.getAngle();p&&l.rotate(p),l.translate(e.tx,e.ty),this.push(l,!1),this.drawImage(t,r),this.pop()}drawVectorMarker(t,e){if(!t)return;const i=t.markerGraphics;if(!i)return;const r=(0,T.$w)(t.size,y.D.CIMVectorMarker.size),s=t.frame,n=s?s.ymax-s.ymin:0,a=r&&n?r/n:1,l=E.createIdentity();s&&l.translate(.5*-(s.xmax+s.xmin),.5*-(s.ymax+s.ymin));const h=t.anchorPoint;if(h){let e=h.x,i=h.y;"Absolute"!==t.anchorPointUnits?s&&(e*=s.xmax-s.xmin,i*=s.ymax-s.ymin):(e/=a,i/=a),l.translate(-e,-i)}1!==a&&l.scale(a,a);let c=(0,T.$w)(t.rotation);t.rotateClockwise&&(c=-c),this._mapRotation&&(c+=this._mapRotation),c&&l.rotate(c*I);let u=(0,T.$w)(t.offsetX),d=(0,T.$w)(t.offsetY);if(u||d){if(this._mapRotation){const t=I*this._mapRotation,e=Math.cos(t),i=Math.sin(t),r=u*i+d*e;u=u*e-d*i,d=r}l.translate(u,d)}const f=this.geomUnitsPerPoint();1!==f&&l.scale(f,f);const p=e.getAngle();p&&l.rotate(p),l.translate(e.tx,e.ty),this.push(l,t.scaleSymbolsProportionally);for(const t of i){t?.symbol&&t.geometry||o.A.getLogger("esri.symbols.cim.CIMSymbolDrawHelper").error("Invalid marker graphic",t);let e=t.textString;if("number"==typeof e&&(e=e.toString()),this.drawSymbol(t.symbol,t.geometry,e),this._earlyReturn)break}this.pop()}drawTextSymbol(t,e,i){if(!t)return;if(!(0,f.fT)(e))return;if((0,T.$w)(t.height,y.D.CIMTextSymbol.height)<=0)return;const r=E.createIdentity();let s=(0,T.$w)(t.angle);s=-s,s&&r.rotate(s*I);const n=(0,T.$w)(t.offsetX),o=(0,T.$w)(t.offsetY);(n||o)&&r.translate(n,o);const a=this.geomUnitsPerPoint();1!==a&&r.scale(a,a),r.translate(e.x,e.y),this.push(r,!1),this.drawText(t,i),this.pop()}}class D extends L{constructor(t,e){super(t,e),this.reset()}reset(){this._xmin=this._ymin=1/0,this._xmax=this._ymax=-1/0,this._clipCount=0}envelope(){return new b.A(this._xmin,this._ymin,this._xmax-this._xmin,this._ymax-this._ymin)}bounds(){return(0,c.fA)(this._xmin,this._ymin,this._xmax,this._ymax)}drawSolidFill(t){if(t&&!(this._clipCount>0))if((0,f.Bi)(t))this._processPath(t.rings,0);else if((0,f.Rg)(t))this._processPath(t.paths,0);else if((0,f.ZC)(t)){const e=V(t);e&&this._processPath(e.rings,0)}else console.error("drawSolidFill Unexpected geometry type!")}drawSolidStroke(t,e,i){if(!t||this._clipCount>0||null==i||i<=0)return;const r=Math.max(.5*this.transformSize((0,T.$w)(i,y.D.CIMSolidStroke.width)),.25);if((0,f.Bi)(t))this._processPath(t.rings,r);else if((0,f.Rg)(t))this._processPath(t.paths,r);else if((0,f.ZC)(t)){const e=V(t);e&&this._processPath(e.rings,r)}else console.error("drawSolidStroke unexpected geometry type!")}drawMarkerLayer(t,e){(0,f.Bi)(e)&&t.markerPlacement&&("CIMMarkerPlacementInsidePolygon"===t.markerPlacement.type||"CIMMarkerPlacementPolygonCenter"===t.markerPlacement.type&&t.markerPlacement.clipAtBoundary)?this._processPath(e.rings,0):super.drawMarkerLayer(t,e)}drawHatchFill(t,e){this.drawSolidFill(t)}drawPictureFill(t,e){this.drawSolidFill(t)}drawGradientFill(t,e){this.drawSolidFill(t)}drawPictureStroke(t,e){this.drawSolidStroke(t,null,e.width)}drawGradientStroke(t,e){this.drawSolidStroke(t,null,e.width)}pushClipPath(t){this.drawSolidFill(t),this._clipCount++}popClipPath(){this._clipCount--}drawImage(t,e){const{url:i}=t,r=(0,T.$w)(t.scaleX,1);let s=r*e,n=e;const o=this._resourceManager.getResource(i);if(null!=o){const t=o.height/o.width;s=r*(e?t>1?e:e/t:o.width),n=e?t>1?e*t:e:o.height}this._merge(this.transformPt([-s/2,-n/2]),0),this._merge(this.transformPt([-s/2,n/2]),0),this._merge(this.transformPt([s/2,-n/2]),0),this._merge(this.transformPt([s/2,n/2]),0)}drawText(t,e){if(!e||0===e.length)return;this._textRasterizer||(this._textRasterizer=new S);const i=U(t);let[r,s]=this._textRasterizer.computeTextSize(e,i);r=(0,l.PN)(r),s=(0,l.PN)(s);const n=this.transformSize(1)*this.reverseTransformScalar(1);r*=n,s*=n;let o=0;switch(t.horizontalAlignment){case"Left":o=r/2;break;case"Right":o=-r/2}let a=0;switch(t.verticalAlignment){case"Bottom":a=s/2;break;case"Top":a=-s/2;break;case"Baseline":a=s/6}this._merge(this.transformPt([-r/2+o,-s/2+a]),0),this._merge(this.transformPt([-r/2+o,s/2+a]),0),this._merge(this.transformPt([r/2+o,-s/2+a]),0),this._merge(this.transformPt([r/2+o,s/2+a]),0)}_processPath(t,e){if(t)for(const i of t){const t=i?i.length:0;if(t>1){this._merge(this.transformPt(i[0]),e);for(let r=1;r<t;r++)this._merge(this.transformPt(i[r]),e)}}}_merge(t,e){t[0]-e<this._xmin&&(this._xmin=t[0]-e),t[0]+e>this._xmax&&(this._xmax=t[0]+e),t[1]-e<this._ymin&&(this._ymin=t[1]-e),t[1]+e>this._ymax&&(this._ymax=t[1]+e)}}class z extends L{constructor(){super(...arguments),this._searchPoint=[0,0],this._searchDistPoint=0,this._textInfo=null,this._svg=null,this._path=null,this._canvas=null}destroy(){this._svg=(0,M.pK)(this._svg),this._path=null,this._canvas=null}hitTest(t,e,i,r,n,o){const a=o*(0,l.Lz)(1);this.setTransform(),this.setGeomUnitsPerPoint(a),this._searchPoint=[(t[0]+t[2])/2,(t[1]+t[3])/2],this._searchDistPoint=(t[2]-t[0])/2/a,this._textInfo=r;const h=e&&("CIMPointSymbol"===e.type&&"Map"!==e.angleAlignment||"CIMTextSymbol"===e.type);if(this._mapRotation=h?n:0,!(0,s.A)("esri-mobile")){const t=(0,l.PN)(A._M*window.devicePixelRatio),i=(0,l.PN)(A.ie);("CIMLineSymbol"!==e?.type&&"CIMPolygonSymbol"!==e?.type||!e.symbolLayers?.some(T.jn))&&"CIMMeshSymbol"!==e?.type&&((0,T.YC)(e)??0)<i&&(this._searchDistPoint=t)}return this._earlyReturn=!1,this.drawSymbol(e,i),this._earlyReturn}executeEffects(t,e){return"CIMGeometricEffectDashes"===t.at(-1)?.type&&(t=t.slice(0,-1)),super.executeEffects(t,e)}drawSolidFill(t,e,i){null!=i?this._hittestSvgPath(t,i,!0):this._hitTestFill(t)}drawHatchFill(t,e){this._hitTestFill(t)}drawPictureFill(t,e){this._hitTestFill(t)}drawGradientFill(t,e){this._hitTestFill(t)}drawSolidStroke(t,e,i,r,s,n,o){null!=o?this._hittestSvgPath(t,o,!1,i):this._hitTestStroke(t,i)}drawPictureStroke(t,e){this._hitTestStroke(t,e.width)}drawGradientStroke(t,e){this._hitTestStroke(t,e.width)}drawMarkerLayer(t,e){t.markerPlacement&&("CIMMarkerPlacementInsidePolygon"===t.markerPlacement.type||"CIMMarkerPlacementPolygonCenter"===t.markerPlacement.type&&t.markerPlacement.clipAtBoundary)?this._hitTestFill(e):super.drawMarkerLayer(t,e)}pushClipPath(t){}popClipPath(){}drawImage(t,e){const{url:i}=t,r=(0,T.$w)(t.scaleX,1),s=this._resourceManager.getResource(i);if(null==s||0===s.height||0===e)return;const n=e*this.geomUnitsPerPoint(),o=n*r*(s.width/s.height),a=this.reverseTransformPt(this._searchPoint),l=this._searchDistPoint;Math.abs(a[0])<o/2+l&&Math.abs(a[1])<n/2+l&&(this._earlyReturn=!0)}drawText(t,e){const i=this._textInfo;if(!i)return;const r=i.get(t);if(!r)return;if(!r.glyphMosaicItems.glyphs.length)return;const s=(0,O.hV)((0,T.$w)(t.height,y.D.CIMTextSymbol.height)),{lineGapType:n,lineGap:o}=t,a=n?B(n,(0,T.$w)(o),s):0,l="CIMBackgroundCallout"===t.callout?.type,h=(0,R.Tl)(r.glyphMosaicItems,{scale:s/A.eG,angle:0,xOffset:0,yOffset:0,horizontalAlignment:t.horizontalAlignment,verticalAlignment:t.verticalAlignment,maxLineWidth:(0,O.Lu)(t.lineWidth),lineHeight:A.DY*Math.max(.25,Math.min(a||1,4)),decoration:t.font.decoration||"none",useCIMAngleBehavior:!0,hasBackground:l}),c=this.reverseTransformPt(this._searchPoint),u=c[0],d=c[1];for(const t of h.glyphs)if(u>t.xTopLeft&&u<t.xBottomRight&&d>-t.yBottomRight&&d<-t.yTopLeft){this._earlyReturn=!0;break}}_hitTestFill(t){let e=null;if((0,f.ZC)(t)){const i=t;e=[[[i.xmin,i.ymin],[i.xmin,i.ymax],[i.xmax,i.ymax],[i.xmax,i.ymin],[i.xmin,i.ymin]]]}else if((0,f.Bi)(t))e=t.rings;else{if(!(0,f.Rg)(t))return;e=t.paths}const i=this.reverseTransformPt(this._searchPoint);(function(t,e){let i=0;for(const r of e){const e=r.length;for(let s=1;s<e;s++){const e=r[s-1],n=r[s];e[1]>t[1]!=n[1]>t[1]&&((n[0]-e[0])*(t[1]-e[1])-(n[1]-e[1])*(t[0]-e[0])>0?i++:i--)}}return 0!==i})(i,e)&&(this._earlyReturn=!0),this._earlyReturn||F(i,e,this.reverseTransformScalar(this._searchDistPoint)*this.prevGeomUnitsPerPoint())&&(this._earlyReturn=!0)}_getSvgPath(){return null!=this._svg&&null!=this._path||(this._svg??=(0,M.p)(),this._path??=(0,M.FJ)("path"),this._svg.appendChild(this._path)),this._path}_getCanvas(){return this._canvas??=document.createElement("canvas"),this._canvas}_hittestSvgPath(t,e,i,r){const s=(0,c.vt)();(0,u.Rg)(s,t);const n=s[0],o=s[1],a=s[2]-s[0],l=s[3]-s[1],h=this._getSvgPath();h.setAttribute("d",e);const d=h.getBBox(),f=d.width/a,p=d.height/l,m=this._getCanvas();m.width=d.width,m.height=d.height;const g=m.getContext("2d",{willReadFrequently:!0});g.setTransform(1,0,0,1,d.x,-d.y);const _=new Path2D(e);i?g.fill(_):(g.lineWidth=r*f,g.stroke(_));const y=this.reverseTransformScalar(this._searchDistPoint)*this.prevGeomUnitsPerPoint(),v=this.reverseTransformPt(this._searchPoint),x=(v[0]-n-y)*f,b=(l-(v[1]-o)-y)*p,w=2*y*f,P=2*y*p,S=g.getImageData(x,b,w,P).data;for(let t=3;t<S.length;t+=4)if(S[t]>127.5)return void(this._earlyReturn=!0)}_hitTestStroke(t,e){let i=null;if((0,f.ZC)(t)){const e=t;i=[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]}else if((0,f.Bi)(t))i=t.rings;else{if(!(0,f.Rg)(t))return;i=t.paths}F(this.reverseTransformPt(this._searchPoint),i,(0,T.$w)(e,y.D.CIMSolidStroke.width)*this.geomUnitsPerPoint()/2+this.reverseTransformScalar(this._searchDistPoint)*this.prevGeomUnitsPerPoint())&&(this._earlyReturn=!0)}}class N extends L{constructor(t,e,i,r){super(e,i),this._applyAdditionalRenderProps=r,this._colorSubstitutionHelper=new m,this._ctx=t}drawSolidFill(t,e){if(!t)return;if((0,f.Bi)(t))this._buildPath(t.rings,!0);else if((0,f.Rg)(t))this._buildPath(t.paths,!0);else if((0,f.ZC)(t))this._buildPath(V(t).rings,!0);else{if(!(0,f.U9)(t))return;console.log("CanvasDrawHelper.drawSolidFill - No implementation!")}const i=this._ctx;i.fillStyle="string"==typeof e?e:"rgba("+Math.round(e[0])+","+Math.round(e[1])+","+Math.round(e[2])+","+(e[3]??255)/255+")",i.fill("evenodd")}drawSolidStroke(t,e,i,r,s,n){if(!t||!e||0===i)return;if((0,f.Bi)(t))this._buildPath(t.rings,!0);else if((0,f.Rg)(t))this._buildPath(t.paths,!1);else{if(!(0,f.ZC)(t))return void console.log("CanvasDrawHelper.drawSolidStroke isn't implemented!");this._buildPath(V(t).rings,!0)}const o=this._ctx;o.strokeStyle="string"==typeof e?e:"rgba("+Math.round(e[0])+","+Math.round(e[1])+","+Math.round(e[2])+","+(e[3]??255)/255+")",o.lineWidth=Math.max(this.transformSize(i),.5),this._setCapStyle(r),this._setJoinStyle(s),o.miterLimit=n,o.stroke()}pushClipPath(t){if(this._ctx.save(),(0,f.Bi)(t))this._buildPath(t.rings,!0);else if((0,f.Rg)(t))this._buildPath(t.paths,!0);else{if(!(0,f.ZC)(t))return;this._buildPath(V(t).rings,!0)}this._ctx.clip("evenodd")}popClipPath(){this._ctx.restore()}drawImage(t,e){const{colorSubstitutions:i,url:r,tintColor:s}=t,n=(0,T.$w)(t.scaleX,1),o=this._resourceManager.getResource(r);if(null==o)return;let a=e*(o.width/o.height),l=e;e||(a=o.width,l=o.height);const h=(0,T.UE)(r)||"src"in o&&(0,T.UE)(o.src);let c="getFrame"in o?x(o):o;i&&(c=this._colorSubstitutionHelper.applyColorSubstitution(c,i)),this._applyAdditionalRenderProps&&!h&&s&&(c=this._colorSubstitutionHelper.tintImageData(c,s));const u=this.transformPt([0,0]),[d,f]=this.getTransformAngle(),p=this.transformSize(1),m=this._ctx;m.save(),m.setTransform({m11:n*p*d,m12:n*p*f,m21:-p*f,m22:p*d,m41:u[0],m42:u[1]}),m.drawImage(c,-a/2,-l/2,a,l),m.restore()}drawText(t,e){if(!e||0===e.length)return;this._textRasterizer||(this._textRasterizer=new S);const i=U(t,this.transformSize((0,l.PN)(1))),r=this._textRasterizer.rasterizeText(e,i);if(!r)return;const{size:s,anchorX:n,anchorY:o,canvas:a}=r,h=s[0]*(n+.5),c=s[1]*(o-.5),u=this._ctx,d=this.transformPt([0,0]),[f,p]=this.getTransformAngle();u.save(),u.setTransform({m11:1*f,m12:1*p,m21:-1*p,m22:1*f,m41:d[0]-1*h,m42:d[1]+1*c}),u.drawImage(a,0,0),u.restore()}drawPictureFill(t,e){if(!t)return;let{colorSubstitutions:i,height:r,offsetX:s,offsetY:n,rotation:o,scaleX:a,tintColor:l,url:h}=e;const c=this._resourceManager.getResource(h);if(null==c)return;if((0,f.Bi)(t))this._buildPath(t.rings,!0);else if((0,f.Rg)(t))this._buildPath(t.paths,!0);else if((0,f.ZC)(t))this._buildPath(V(t).rings,!0);else{if(!(0,f.U9)(t))return;console.log("CanvasDrawHelper.drawPictureFill - No implementation!")}const u=this._ctx,d=(0,T.UE)(h)||"src"in c&&(0,T.UE)(c.src);let p,m="getFrame"in c?x(c):c;if(i&&(m=this._colorSubstitutionHelper.applyColorSubstitution(m,i)),this._applyAdditionalRenderProps){d||l&&(m=this._colorSubstitutionHelper.tintImageData(m,l)),p=u.createPattern(m,"repeat");const t=this.transformSize(1);o||(o=0),s?s*=t:s=0,n?n*=t:n=0,r&&(r*=t);const e=r?r/c.height:1,i=a&&r?a*r/c.width:1;if(0!==o||1!==e||1!==i||0!==s||0!==n){const t=new DOMMatrix;t.rotateSelf(0,0,-o).translateSelf(s,n).scaleSelf(i,e,1),p.setTransform(t)}}else p=u.createPattern(m,"repeat");u.save(),u.fillStyle=p,u.fill("evenodd"),u.restore()}drawPictureStroke(t,e){if(!t)return;let{colorSubstitutions:i,capStyle:r,joinStyle:s,miterLimit:o,tintColor:a,url:h,width:c}=e;const u=this._resourceManager.getResource(h);if(null==u)return;let d;if((0,f.Bi)(t))d=t.rings;else if((0,f.Rg)(t))d=t.paths;else{if(!(0,f.ZC)(t))return(0,f.U9)(t)?void console.log("CanvasDrawHelper.drawPictureStroke - No implementation!"):void 0;d=V(t).rings}c||(c=u.width);const p=(0,T.UE)(h)||"src"in u&&(0,T.UE)(u.src);let m="getFrame"in u?x(u):u;i&&(m=this._colorSubstitutionHelper.applyColorSubstitution(m,i)),this._applyAdditionalRenderProps&&(p||a&&(m=this._colorSubstitutionHelper.tintImageData(m,a)));const g=Math.max(this.transformSize((0,l.Lz)(c)),.5),_=g/m.width,y=this._ctx,v=y.createPattern(m,"repeat-y");let b,w;y.save(),this._setCapStyle(r),this._setJoinStyle(s),void 0!==o&&(y.miterLimit=o),y.lineWidth=g;for(let t of d)if(t=(0,n.o8)(t),H(t),t&&!(t.length<=1)){b=this.transformPt(t[0]);for(let e=1;e<t.length;e++){w=this.transformPt(t[e]);const i=k(b,w),r=new DOMMatrix;r.translateSelf(0,b[1]-g/2).scaleSelf(_,_,1).rotateSelf(0,0,90-i),v.setTransform(r),y.strokeStyle=v,y.beginPath(),y.moveTo(b[0],b[1]),y.lineTo(w[0],w[1]),y.stroke(),b=w}}y.restore()}_buildPath(t,e){const i=this._ctx;if(i.beginPath(),t)for(const r of t){const t=r?r.length:0;if(t>1){let s=this.transformPt(r[0]);i.moveTo(s[0],s[1]);for(let e=1;e<t;e++)s=this.transformPt(r[e]),i.lineTo(s[0],s[1]);e&&i.closePath()}}}_setCapStyle(t){switch(t){case v.uT.Butt:this._ctx.lineCap="butt";break;case v.uT.Round:this._ctx.lineCap="round";break;case v.uT.Square:this._ctx.lineCap="square"}}_setJoinStyle(t){switch(t){case v.wd.Bevel:this._ctx.lineJoin="bevel";break;case v.wd.Round:this._ctx.lineJoin="round";break;case v.wd.Miter:this._ctx.lineJoin="miter"}}}function F(t,e,i){for(const r of e){const e=r.length;for(let s=1;s<e;s++){const e=r[s-1],n=r[s];let o=(n[0]-e[0])*(n[0]-e[0])+(n[1]-e[1])*(n[1]-e[1]);if(0===o)continue;o=Math.sqrt(o);const a=((n[0]-e[0])*(t[1]-e[1])-(n[1]-e[1])*(t[0]-e[0]))/o;if(Math.abs(a)<i){const r=((n[0]-e[0])*(t[0]-e[0])+(n[1]-e[1])*(t[1]-e[1]))/o;if(r>-i&&r<o+i)return!0}}}return!1}function k(t,e){const i=e[0]-t[0],r=e[1]-t[1];return 180/Math.PI*Math.atan2(r,i)}const V=t=>t?{spatialReference:t.spatialReference,rings:[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]}:null,B=(t,e,i)=>{switch(t){case"ExtraLeading":return 1+e/i;case"Multiple":return e;case"Exact":return e/i}};function U(t,e=1){const i=(0,T.DW)(t),s=(0,T._d)(t.fontStyleName),n=t.fontFamilyName??r.Vb,{weight:o,style:a}=s,l=e*(t.height||5),h=(0,T.Bu)(t.horizontalAlignment),c=(0,T.Nl)(t.verticalAlignment),u=(0,T.pM)(t),d=(0,T.pM)(t.haloSymbol),f=null!=d?e*(t.haloSize??0):0,p=(0,T._1)(t.symbol),m=e*((0,T.xo)(t.symbol)||0),g="CIMBackgroundCallout"===t.callout?.type?t.callout.backgroundSymbol:null,_=(0,T.pM)(g),y=(0,T.xo)(g),v=(0,T._1)(g);return{color:u,size:l,horizontalAlignment:h,verticalAlignment:c,font:{family:n,style:(0,T.pV)(a),weight:(0,T.Kn)(o),decoration:i},outline:{size:m||0,color:p},halo:{size:f||0,color:d,style:a},backgroundColor:_,borderLine:null!=y&&null!=v?{size:y,color:v}:null,pixelRatio:1,premultiplyColors:!0}}const G=1e-4;function H(t){let e,i,r,s,n,o=t[0],a=1;for(;a<t.length;)e=t[a][0]-o[0],i=t[a][1]-o[1],s=0!==e?i/e:Math.PI/2,void 0!==r&&s-r<=G?(t.splice(a-1,1),o=n):(n=o,o=t[a],a++),r=s}},57176:function(t,e,i){i.d(e,{BW:function(){return H},Sc:function(){return E},Vb:function(){return M},ll:function(){return I},wp:function(){return L}});var r=i(90152),s=i(58941),n=i(21609),o=i(40633),a=i(13798),l=i(13520),h=i(87416),c=i(35068),u=i(90046),d=i(29076),f=i(14817),p=i(38821),m=i(33389),g=i(7590),_=i(74661),y=i(7056),v=i(39686),x=i(17469),b=i(96700);const w=Math.PI,P=w/2,S=Math.PI/180,C=96/72,T=()=>o.A.getLogger("esri.symbols.cim.CIMSymbolHelper");function M(t){let e;switch(t.type){case"cim":return t.data;case"web-style":return t;case"simple-marker":{const i=L.fromSimpleMarker(t);if(!i)throw new Error("InternalError: Cannot convert symbol to CIM");e=i;break}case"picture-marker":e=L.fromPictureMarker(t);break;case"simple-line":e=L.fromSimpleLineSymbol(t);break;case"simple-fill":e=L.fromSimpleFillSymbol(t);break;case"picture-fill":e=L.fromPictureFillSymbol(t);break;case"text":e=L.fromTextSymbol(t)}return{type:"CIMSymbolReference",symbol:e}}function A(t,e,i){switch(e.type){case"CIMSymbolReference":return A(t,e.symbol,i);case"CIMPointSymbol":null==i&&(i={x:0,y:0}),t.drawSymbol(e,i);break;case"CIMLineSymbol":null==i&&(i={paths:[[[0,0],[10,0]]]}),t.drawSymbol(e,i);break;case"CIMPolygonSymbol":null==i&&(i={rings:[[[0,0],[0,10],[10,10],[10,0],[0,0]]]}),t.drawSymbol(e,i);break;case"CIMTextSymbol":{const i={x:0,y:0};t.drawSymbol(e,i);break}case"CIMVectorMarker":{const i=new d.W;t.drawMarker(e,i);break}}return t.envelope()}function R(t){if(!t)return 0;switch(t.type){case"CIMMarkerPlacementAlongLineSameSize":case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAtExtremities":case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementAtRatioPositions":case"CIMMarkerPlacementOnLine":case"CIMMarkerPlacementOnVertices":return Math.abs(t.offset);default:return 0}}function O(t){if(!t)return 0;switch(t.type){case"CIMGeometricEffectArrow":return Math.abs(.5*t.width);case"CIMGeometricEffectBuffer":return Math.abs(t.size);case"CIMGeometricEffectControlMeasureLine":return 500;case"CIMGeometricEffectExtension":case"CIMGeometricEffectRadial":return Math.abs(t.length);case"CIMGeometricEffectJog":return Math.abs(.5*t.length);case"CIMGeometricEffectMove":return Math.max(Math.abs((0,g.$w)(t.offsetX)),Math.abs((0,g.$w)(t.offsetY)));case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":return Math.abs(t.offset);case"CIMGeometricEffectRegularPolygon":return Math.abs(t.radius);case"CIMGeometricEffectRotate":case"CIMGeometricEffectScale":default:return 0;case"CIMGeometricEffectTaperedPolygon":return.5*Math.max(Math.abs(t.fromWidth),Math.abs(t.toWidth));case"CIMGeometricEffectWave":return Math.abs(t.amplitude);case"CIMGeometricEffectDonut":return Math.abs(t.width)}}function I(t){if(!t)return 0;let e=0;for(const i of t)e+=O(i);return e}class E{static getSymbolInflateSize(t,e,i,r,s){return t||(t=[0,0,0,0]),e?this._getInflateSize(t,e,i,r,s):t}static safeSize(t){const e=Math.max(Math.abs(t[0]),Math.abs(t[2])),i=Math.max(Math.abs(t[1]),Math.abs(t[3]));return Math.sqrt(e*e+i*i)}static _vectorMarkerBounds(t,e,i,r){let s=!0;const n=(0,h.vt)();if(e?.markerGraphics)for(const o of e.markerGraphics){const e=[0,0,0,0];o.geometry&&((0,c.Rg)(n,o.geometry),e[0]=0,e[1]=0,e[2]=0,e[3]=0,this.getSymbolInflateSize(e,o.symbol,i,0,r),n[0]+=e[0],n[1]+=e[1],n[2]+=e[2],n[3]+=e[3],s?(t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],s=!1):(t[0]=Math.min(t[0],n[0]),t[1]=Math.min(t[1],n[1]),t[2]=Math.max(t[2],n[2]),t[3]=Math.max(t[3],n[3])))}return t}static _getInflateSize(t,e,i,r,s){if(function(t){return void 0!==t.symbolLayers}(e)){const n=this._getLayersInflateSize(t,e.symbolLayers,i,r,s),o=I(e.effects);return o>0&&(n[0]-=o,n[1]-=o,n[2]+=o,n[3]+=o),n}return this._getTextInflatedSize(t,e,s)}static _getLayersInflateSize(t,e,i,r,s){let n=!0;if(!e)return t;for(const o of e){if(!o)continue;let e=[0,0,0,0];switch(o.type){case"CIMSolidFill":case"CIMPictureFill":case"CIMHatchFill":case"CIMGradientFill":break;case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":{const t=o;let i=t.width;null!=i&&(t.capStyle===m.uT.Square||t.joinStyle===m.wd.Miter?i/=1.4142135623730951:i/=2,e[0]=-i,e[1]=-i,e[2]=i,e[3]=i);break}case"CIMCharacterMarker":case"CIMVectorMarker":case"CIMPictureMarker":{const t=o;if("CIMVectorMarker"===o.type){const t=o;if(e=this._vectorMarkerBounds(e,t,i,s),t.frame){const i=(t.frame.xmin+t.frame.xmax)/2,r=(t.frame.ymin+t.frame.ymax)/2;if(e[0]-=i,e[1]-=r,e[2]-=i,e[3]-=r,null!=t.size){const i=t.size/(t.frame.ymax-t.frame.ymin);e[0]*=i,e[1]*=i,e[2]*=i,e[3]*=i}}}else if("CIMPictureMarker"===o.type){const r=o,s=i.getResource(r.url);let n=1;if(null!=s&&s.height&&(n=s.width/s.height),null!=t.size){const i=t.size/2,s=t.size*n*r.scaleX/2;e=[-s,-i,s,i]}}else if(null!=t.size){const i=t.size/2;e=[-i,-i,i,i]}if(t.anchorPoint){let i,r;"Absolute"===t.anchorPointUnits?(i=t.anchorPoint.x,r=t.anchorPoint.y):(i=t.anchorPoint.x*(e[2]-e[0]),r=t.anchorPoint.y*(e[3]-e[1]));const s=1.25*Math.sqrt(i*i+r*r);e[0]-=s,e[1]-=s,e[2]+=s,e[3]+=s}let n=(0,g.$w)(t.rotation);if(t.rotateClockwise&&(n=-n),r&&(n-=r),n){const t=S*n,i=Math.cos(t),r=Math.sin(t),s=(0,h.vt)([y.MG,y.MG,-y.MG,-y.MG]);(0,h.tK)(s,[e[0]*i-e[1]*r,e[0]*r+e[1]*i]),(0,h.tK)(s,[e[0]*i-e[3]*r,e[0]*r+e[3]*i]),(0,h.tK)(s,[e[2]*i-e[1]*r,e[2]*r+e[1]*i]),(0,h.tK)(s,[e[2]*i-e[3]*r,e[2]*r+e[3]*i]),e=s}let a=(0,g.$w)(t.offsetX),l=(0,g.$w)(t.offsetY);if(r){const t=S*r,e=Math.cos(t),i=Math.sin(t),s=a*i+l*e;a=a*e-l*i,l=s}e[0]+=a,e[1]+=l,e[2]+=a,e[3]+=l;const c=R(t.markerPlacement);c>0&&(e[0]-=c,e[1]-=c,e[2]+=c,e[3]+=c);break}}const a=I(o.effects);a>0&&(e[0]-=a,e[1]-=a,e[2]+=a,e[3]+=a),n?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],n=!1):(t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[2]),t[3]=Math.max(t[3],e[3]))}return t}static _getTextInflatedSize(t,e,i){const r=(0,b.hV)(e.height??p.D.CIMTextSymbol.height);if(t[0]=-r/2,t[1]=-r/2,t[2]=r/2,t[3]=r/2,!i)return t;const s=i.get(e);if(!s)return t;if(!s.glyphMosaicItems.glyphs.length)return t;const{lineGapType:n,lineGap:o}=e,a=n?(0,f.QF)(n,o??0,r):0,l="CIMBackgroundCallout"===e.callout?.type,h=(0,x.Tl)(s.glyphMosaicItems,{scale:r/v.eG,angle:(0,g.$w)(e.angle),xOffset:(0,g.$w)(e.offsetX),yOffset:(0,g.$w)(e.offsetY),horizontalAlignment:e.horizontalAlignment,verticalAlignment:e.verticalAlignment,maxLineWidth:(0,b.Lu)(e.lineWidth),lineHeight:v.DY*Math.max(.25,Math.min(a||1,4)),decoration:e.font.decoration||"none",useCIMAngleBehavior:!0,hasBackground:l}).boundsT,c=Math.sqrt(h.width*h.width+h.height*h.height);return t[0]-=h.x+c,t[1]-=h.y-c,t[2]+=h.x+c,t[3]+=-h.y+c,t}}class L{static getEnvelope(t,e,i){if(!t)return null;const r=new f.mx(i);if(Array.isArray(t)){let i;for(const s of t)i?i.union(A(r,s,e)):i=A(r,s,e);return i}return A(r,t,e)}static getTextureAnchor(t,e){const i=this.getEnvelope(t,null,e);if(!i)return[0,0,0];const r=(i.x+.5*i.width)*C,s=(i.y+.5*i.height)*C,n=i.width*C+2,o=i.height*C+2;return[-r/n,-s/o,o]}static rasterize(t,e,i,r,s=!0,n){const o=i||this.getEnvelope(e,null,r);if(!o)return[null,0,0,0,0];const a=Math.max(o.width,o.height)*C;let l=null!=n?Math.max(n/a,1):1;l*=C;const h=(o.x+.5*o.width)*l,c=(o.y+.5*o.height)*l;t.width=o.width*l,t.height=o.height*l,i||(t.width+=2,t.height+=2);const u=t.getContext("2d",{willReadFrequently:!0}),p=f.IT.createScale(l,-l);p.translate(.5*t.width-h,.5*t.height+c);const m=new f.Rj(u,r,p);switch(e.type){case"CIMPointSymbol":{const t={type:"point",x:0,y:0};m.drawSymbol(e,t);break}case"CIMVectorMarker":{const t=new d.W;m.drawMarker(e,t);break}}const g=u.getImageData(0,0,t.width,t.height),_=new Uint8Array(g.data);if(s){let t;for(let e=0;e<_.length;e+=4)t=_[e+3]/255,_[e]=_[e]*t,_[e+1]=_[e+1]*t,_[e+2]=_[e+2]*t}return[_,t.width,t.height,-h/t.width,-c/t.height]}static fromTextSymbol(t){const{text:e}=t;return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPointUnits:"Relative",dominantSizeAxis3D:"Y",size:10,billboardMode3D:"FaceNearPlane",frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{x:0,y:0},symbol:L.createCIMTextSymbolfromTextSymbol(t),textString:e}],scaleSymbolsProportionally:!0,respectFrame:!0}],scaleX:1,angleAlignment:"Display"}}static fromPictureFillSymbol(t){const{height:e,outline:i,width:r,xoffset:s,xscale:n,yoffset:o,yscale:a}=t,l=[],h={type:"CIMPolygonSymbol",symbolLayers:l};if(i){const t=$(i);t&&l.push(t)}let c=t.url;"esriPFS"===t.type&&t.imageData&&(c=t.imageData);const u="angle"in t?t.angle??0:0,d=(r??0)*(n||1),f=(e??0)*(a||1);return l.push({type:"CIMPictureFill",invertBackfaceTexture:!1,scaleX:1,textureFilter:m.O$.Picture,tintColor:null,url:c,height:f,width:d,offsetX:(0,g.$w)(s),offsetY:(0,g.$w)(o),rotation:(0,g.$w)(-u),colorSubstitutions:null}),h}static fromSimpleFillSymbol(t){const{color:e,style:i,outline:r}=t,s=[],o={type:"CIMPolygonSymbol",symbolLayers:s};if(r){const t=$(r);t&&s.push(t)}if(i&&"solid"!==i&&"none"!==i&&"esriSFSSolid"!==i&&"esriSFSNull"!==i){const t={type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",color:V(e),capStyle:m.uT.Butt,joinStyle:m.wd.Miter,width:.75}]};let r=0;const o=(0,l.PN)(j(i)?8:10);switch(i){case"vertical":case"esriSFSVertical":r=90;break;case"forward-diagonal":case"esriSFSForwardDiagonal":case"diagonal-cross":case"esriSFSDiagonalCross":r=-45;break;case"backward-diagonal":case"esriSFSBackwardDiagonal":r=45;break;case"cross":case"esriSFSCross":r=0}s.push({type:"CIMHatchFill",lineSymbol:t,offsetX:0,offsetY:0,rotation:r,separation:o}),"cross"===i||"esriSFSCross"===i?s.push({type:"CIMHatchFill",lineSymbol:(0,n.o8)(t),offsetX:0,offsetY:0,rotation:90,separation:o}):"diagonal-cross"!==i&&"esriSFSDiagonalCross"!==i||s.push({type:"CIMHatchFill",lineSymbol:(0,n.o8)(t),offsetX:0,offsetY:0,rotation:45,separation:o})}else!i||"solid"!==i&&"esriSFSSolid"!==i||s.push({type:"CIMSolidFill",enable:!0,color:V(e)});return o}static fromSimpleLineSymbol(t){const{cap:e,color:i,join:r,marker:s,miterLimit:n,style:o,width:a}=t;let l=null;"solid"!==o&&"none"!==o&&"esriSLSSolid"!==o&&"esriSLSNull"!==o&&(l=[{type:"CIMGeometricEffectDashes",dashTemplate:H(o,e),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]);const h=[];if(s){let t;switch(s.placement){case"begin-end":t=m.$2.Both;break;case"begin":t=m.$2.JustBegin;break;case"end":t=m.$2.JustEnd;break;default:t=m.$2.None}const e=L.fromSimpleMarker(s,a,i).symbolLayers[0];e.markerPlacement={type:"CIMMarkerPlacementAtExtremities",placePerPart:!1,angleToLine:!0,offset:0,extremityPlacement:t,offsetAlongLine:0},h.push(e)}return h.push({type:"CIMSolidStroke",color:"none"!==o&&"esriSLSNull"!==o?V(i):[0,0,0,0],capStyle:z(e),joinStyle:N(r),miterLimit:n,width:a,effects:l}),{type:"CIMLineSymbol",symbolLayers:h}}static fromPictureMarker(t){const{angle:e,height:i,width:r,xoffset:s,yoffset:n}=t;let o=t.url;return"esriPMS"===t.type&&t.imageData&&(o=t.imageData),{type:"CIMPointSymbol",symbolLayers:[{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:m.O$.Picture,tintColor:null,url:o,size:i,width:r,offsetX:(0,g.$w)(s),offsetY:(0,g.$w)(n),rotation:(0,g.$w)(-e)}]}}static createCIMTextSymbolfromTextSymbol(t){const{angle:e,color:i,font:s,haloColor:n,haloSize:o,horizontalAlignment:a,kerning:l,lineWidth:h,text:c,verticalAlignment:u,xoffset:d,yoffset:f,backgroundColor:p,borderLineColor:_,borderLineSize:y}=t;let v,x,b,w,P,S;s&&(v=s.family,x=s.style,b=s.weight,w=s.size,P=s.decoration);let C=!1;return c&&(C=(0,r.y)(c)[1]),(p||y)&&(S={type:"CIMBackgroundCallout",margin:null,backgroundSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",color:V(p)},{type:"CIMSolidStroke",color:V(_),width:y}]},accentBarSymbol:null,gap:null,leaderLineSymbol:null,lineStyle:null}),{type:"CIMTextSymbol",angle:e,blockProgression:m.TZ.BTT,depth3D:1,extrapolateBaselines:!0,fontEffects:m.Y.Normal,fontEncoding:m.bj.Unicode,fontFamilyName:v||"Arial",fontStyleName:B(x,b),fontType:m.g7.Unspecified,haloSize:o,height:w,hinting:m.mU.Default,horizontalAlignment:F(a??"center"),kerning:l,letterWidth:100,ligatures:!0,lineGapType:"Multiple",lineWidth:h,offsetX:(0,g.$w)(d),offsetY:(0,g.$w)(f),strikethrough:"line-through"===P,underline:"underline"===P,symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:V(i)}]},haloSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:V(n)}]},shadowColor:[0,0,0,255],shadowOffsetX:1,shadowOffsetY:1,textCase:"Normal",textDirection:C?m.f0.RTL:m.f0.LTR,verticalAlignment:k(u??"baseline"),verticalGlyphOrientation:m.vG.Right,wordSpacing:100,billboardMode3D:m.xn.FaceNearPlane,callout:S}}static createPictureMarkerRasterizationParam(t){const{angle:e,height:i,width:r,xoffset:s,yoffset:n}=t,o=t.url??t.source?.url??t.source?.imageData;return o?{type:"sprite-rasterization-param",overrides:[],resource:{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:m.O$.Picture,tintColor:null,url:o,size:i,width:r,offsetX:(0,g.$w)(s),offsetY:(0,g.$w)(n),rotation:(0,g.$w)(-e)}}:null}static createPictureFillRasterizationParam(t){const{width:e,height:i,xoffset:r,yoffset:s,url:n}=t;return n?{type:"sprite-rasterization-param",overrides:[],resource:{type:"CIMPictureFill",scaleX:1,textureFilter:m.O$.Picture,tintColor:null,url:n,width:e,height:i,offsetX:(0,g.$w)(r),offsetY:(0,g.$w)(s),rotation:0}}:null}static fromSimpleMarker(t,e,i){const{style:r}=t,s=t.color??i;if("path"===r||"esriSMSPath"===r){const e=[];if("outline"in t&&t.outline){const i=t.outline;e.push({type:"CIMSolidStroke",enable:!0,width:i.width,color:V(i.color),path:t.path})}e.push({type:"CIMSolidFill",enable:!0,color:V(s),path:t.path});const[i,r]=W("square");return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:-(0,g.$w)(t.angle),size:(0,g.$w)(t.size||6),offsetX:(0,g.$w)(t.xoffset),offsetY:(0,g.$w)(t.yoffset),scaleSymbolsProportionally:!1,frame:i,markerGraphics:[{type:"CIMMarkerGraphic",geometry:r,symbol:{type:"CIMPolygonSymbol",symbolLayers:e}}]}]}}const n=[];let o,a,l=t.size;if("outline"in t&&t.outline&&"none"!==t.outline.style&&"esriSLSNull"!==t.outline.style){const e=t.outline,i="solid"!==e.style&&"esriSLSSolid"!==e.style;[o,a]=i?W(r,t.size):W(r);const s=e.width??_.A7.width;if(i){const e=s/t.size,i=(o.xmax-o.xmin)*e/2,r=(o.ymax-o.ymin)*e/2;o.xmin-=i,o.xmax+=i,o.ymin-=r,o.ymax+=r,l&&(l+=s)}const h="cross"!==t.style&&"x"!==t.style||"dot"===t?.outline.style||"short-dot"===t?.outline.style?m.yS.HalfGap:m.yS.FullPattern,c=i?[{type:"CIMGeometricEffectAddControlPoints"},{type:"CIMGeometricEffectDashes",dashTemplate:H(e.style,null).map((t=>e.width&&e.width>0?t*e.width:t)),lineDashEnding:h,controlPointEnding:m.yS.FullPattern}]:void 0;n.push({type:"CIMSolidStroke",capStyle:i?m.uT.Round:m.uT.Butt,enable:!0,width:s,color:V(e.color),effects:c})}else!e||"line-marker"!==t.type||"cross"!==t.style&&"x"!==t.style?[o,a]=W(r):([o,a]=W(r),n.push({type:"CIMSolidStroke",enable:!0,width:e,color:V(s)}));n.push({type:"CIMSolidFill",enable:!0,color:V(s)});const h={type:"CIMPolygonSymbol",symbolLayers:n};return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:(0,g.$w)(-t.angle),size:(0,g.$w)(l||6*e),offsetX:(0,g.$w)(t.xoffset),offsetY:(0,g.$w)(t.yoffset),scaleSymbolsProportionally:!1,frame:o,markerGraphics:[{type:"CIMMarkerGraphic",geometry:a,symbol:h}]}]}}static fromCIMHatchFill(t,e){const i=e*(t.separation??p.D.CIMHatchFill.separation),r=i/2,s=(0,n.o8)(t.lineSymbol);s.symbolLayers?.forEach((t=>{switch(t.type){case"CIMSolidStroke":null!=t.width&&(t.width*=e),t.effects?.forEach((t=>{if("CIMGeometricEffectDashes"===t.type){const i=t.dashTemplate;t.dashTemplate=i?.map((t=>t*e))}}));break;case"CIMVectorMarker":{null!=t.size&&(t.size*=e);const i=t.markerPlacement;null!=i&&"placementTemplate"in i&&(i.placementTemplate=i.placementTemplate.map((t=>t*e)));break}}}));let o=this._getLineSymbolPeriod(s)||4;for(;o<4;)o*=2;const a=o/2;return{type:"CIMVectorMarker",frame:{xmin:-a,xmax:a,ymin:-r,ymax:r},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[-a,0],[a,0]]]},symbol:s}],size:i}}static fetchResources(t,e,i,r=null){return t&&e?(D(t,(t=>{(function(t,e,i){t.effects&&null==e.geometryEngine&&(e.geometryEnginePromise?i.push(e.geometryEnginePromise):(0,g.yH)(t.effects)&&(e.geometryEnginePromise=(0,g._H)(),i.push(e.geometryEnginePromise),e.geometryEnginePromise.then((t=>e.geometryEngine=t))))})(t,e,i),"url"in t&&t.url&&i.push(e.fetchResource(t.url,{signal:r}))})),i):i}static fetchFonts(t,e,i){if(t&&e)if("symbolLayers"in t&&t.symbolLayers){for(const r of t.symbolLayers)if("CIMVectorMarker"===r.type&&r.markerGraphics)for(const t of r.markerGraphics)t?.symbol&&L.fetchFonts(t.symbol,e,i)}else if("CIMTextSymbol"===t.type){const{fontFamilyName:r,fontStyleName:s}=t;if(!r||"calcitewebcoreicons"===r.toLowerCase())return;const{style:n,weight:o}=(0,g._d)(s),a=(0,g.DW)(t),l=new u.A({family:r,style:n,weight:o,decoration:a});i.push(e.loadFont(l).catch((()=>{T().error(`Unsupported font ${r} in CIM symbol`)})))}}static _getLineSymbolPeriod(t){if(t){const e=this._getEffectsRepeat(t.effects);if(e)return e;if(t.symbolLayers)for(const e of t.symbolLayers)if(e){const t=this._getEffectsRepeat(e.effects);if(t)return t;switch(e.type){case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":{const t=this._getPlacementRepeat(e.markerPlacement);if(t)return t}}}}return 0}static _getEffectsRepeat(t){if(t)for(const e of t)if(e)switch(e.type){case"CIMGeometricEffectDashes":{const t=e.dashTemplate;if(t&&t.length){let e=0;for(const i of t)e+=i;return 1&t.length&&(e*=2),e}break}case"CIMGeometricEffectWave":return e.period;default:T().error(`unsupported geometric effect type ${e.type}`)}return 0}static _getPlacementRepeat(t){if(t)switch(t.type){case"CIMMarkerPlacementAlongLineSameSize":case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineVariableSize":{const e=t.placementTemplate;if(e&&e.length){let t=0;for(const i of e)t+=+i;return 1&e.length&&(t*=2),t}break}}return 0}static fromCIMInsidePolygon(t){const e=t.markerPlacement,i={...t};i.markerPlacement=null,i.anchorPoint=null;const r=Math.abs(e.stepX),s=Math.abs(e.stepY),n=(e.randomness??100)/100;let o,h,c,u;if("Random"===e.gridType){const t=(0,l.PN)(v.yv),i=Math.max(Math.floor(t/r),1),d=Math.max(Math.floor(t/s),1);o=i*r/2,h=d*s/2,c=2*h;const f=new a.A(e.seed),p=n*r/1.5,m=n*s/1.5;u=[];for(let t=0;t<i;t++)for(let e=0;e<d;e++){const i=t*r-o+p*(.5-f.getFloat()),n=e*s-h+m*(.5-f.getFloat());u.push({x:i,y:n}),0===t&&u.push({x:i+2*o,y:n}),0===e&&u.push({x:i,y:n+2*h})}}else!0===e.shiftOddRows?(o=r/2,h=s,c=2*s,u=[{x:-o,y:0},{x:o,y:0},{x:0,y:h},{x:0,y:-h}]):(o=r/2,h=s/2,c=s,u=[{x:-r,y:0},{x:0,y:-s},{x:-r,y:-s},{x:0,y:0},{x:r,y:0},{x:0,y:s},{x:r,y:s},{x:-r,y:s},{x:r,y:-s}]);return{type:"CIMVectorMarker",frame:{xmin:-o,xmax:o,ymin:-h,ymax:h},markerGraphics:u.map((t=>({type:"CIMMarkerGraphic",geometry:t,symbol:{type:"CIMPointSymbol",symbolLayers:[i]}}))),size:c}}}function D(t,e){if(t)switch(t.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const i=t.symbolLayers;if(!i)return;for(const t of i)if(e(t),"CIMVectorMarker"===t.type){const i=t.markerGraphics;if(!i)continue;for(const t of i)if(t){const i=t.symbol;i&&D(i,e)}}break}}}const z=t=>{if(!t)return m.uT.Butt;switch(t){case"butt":return m.uT.Butt;case"square":return m.uT.Square;case"round":return m.uT.Round}},N=t=>{if(!t)return m.wd.Miter;switch(t){case"miter":return m.wd.Miter;case"round":return m.wd.Round;case"bevel":return m.wd.Bevel}},F=t=>{if(null==t)return"Center";switch(t){case"left":return"Left";case"right":return"Right";case"center":return"Center"}},k=t=>{if(null==t)return"Center";switch(t){case"baseline":return"Baseline";case"top":return"Top";case"middle":return"Center";case"bottom":return"Bottom"}},V=t=>{if(!t)return[0,0,0,0];const{r:e,g:i,b:r,a:s}=t;return[e,i,r,255*s]},B=(t,e)=>{const i=U(e),r=G(t);return i&&r?`${i}-${r}`:`${i}${r}`},U=t=>{if(!t)return"";switch(t.toLowerCase()){case"bold":case"bolder":return"bold"}return""},G=t=>{if(!t)return"";switch(t.toLowerCase()){case"italic":case"oblique":return"italic"}return""},H=(t,e)=>{const i=(0,s.A)("safari")?.001:0,r="butt"===e;switch(t){case"dash":case"esriSLSDash":return r?[4,3]:[3,4];case"dash-dot":case"esriSLSDashDot":return r?[4,3,1,3]:[3,4,i,4];case"dot":case"esriSLSDot":return r?[1,3]:[i,4];case"long-dash":case"esriSLSLongDash":return r?[8,3]:[7,4];case"long-dash-dot":case"esriSLSLongDashDot":return r?[8,3,1,3]:[7,4,i,4];case"long-dash-dot-dot":case"esriSLSDashDotDot":return r?[8,3,1,3,1,3]:[7,4,i,4,i,4];case"short-dash":case"esriSLSShortDash":return r?[4,1]:[3,2];case"short-dash-dot":case"esriSLSShortDashDot":return r?[4,1,1,1]:[3,2,i,2];case"short-dash-dot-dot":case"esriSLSShortDashDotDot":return r?[4,1,1,1,1,1]:[3,2,i,2,i,2];case"short-dot":case"esriSLSShortDot":return r?[1,1]:[i,2];case"solid":case"esriSLSSolid":case"none":return T().error("Unexpected: style does not require rasterization"),[0,0];default:return T().error(`Tried to rasterize SLS, but found an unexpected style: ${t}!`),[0,0]}},W=(t,e=100)=>{const i=e/2;let r,s;const n=t;if("circle"===n||"esriSMSCircle"===n){const t=.25;let e=Math.acos(1-t/i),n=Math.ceil(w/e/4);0===n&&(n=1),e=P/n,n*=4;const o=[];o.push([i,0]);for(let t=1;t<n;t++)o.push([i*Math.cos(t*e),-i*Math.sin(t*e)]);o.push([i,0]),r={rings:[o]},s={xmin:-i,ymin:-i,xmax:i,ymax:i}}else if("cross"===n||"esriSMSCross"===n){const t=0;r={paths:[[[t,i],[t,-i]],[[i,t],[-i,t]]]},s={xmin:-i,ymin:-i,xmax:i,ymax:i}}else if("diamond"===n||"esriSMSDiamond"===n)r={rings:[[[-i,0],[0,i],[i,0],[0,-i],[-i,0]]]},s={xmin:-i,ymin:-i,xmax:i,ymax:i};else if("square"===n||"esriSMSSquare"===n)r={rings:[[[-i,-i],[-i,i],[i,i],[i,-i],[-i,-i]]]},s={xmin:-i,ymin:-i,xmax:i,ymax:i};else if("x"===n||"esriSMSX"===n)r={paths:[[[i,i],[-i,-i]],[[i,-i],[-i,i]]]},s={xmin:-i,ymin:-i,xmax:i,ymax:i};else if("triangle"===n||"esriSMSTriangle"===n){const t=.5773502691896257*e,i=-t,n=2/3*e,o=n-e;r={rings:[[[i,o],[0,n],[t,o],[i,o]]]},s={xmin:i,ymin:o,xmax:t,ymax:n}}else"arrow"===n&&(r={rings:[[[-50,50],[50,0],[-50,-50],[-33,-20],[-33,20],[-50,50]]]},s={xmin:-i,ymin:-i,xmax:i,ymax:i});return[s,r]},j=t=>"vertical"===t||"horizontal"===t||"cross"===t||"esriSFSCross"===t||"esriSFSVertical"===t||"esriSFSHorizontal"===t;function $(t){if(!t)return null;let e=null;const{cap:i,color:r,join:s,miterLimit:n,style:o,width:a}=t;return"solid"!==o&&"none"!==o&&"esriSLSSolid"!==o&&"esriSLSNull"!==o&&(e=[{type:"CIMGeometricEffectDashes",dashTemplate:H(o,i),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]),{type:"CIMSolidStroke",color:"esriSLSNull"!==o&&"none"!==o?V(r):[0,0,0,0],capStyle:z(i),joinStyle:N(s),miterLimit:n,width:a,effects:e}}},93996:function(t,e,i){i.d(e,{I:function(){return o},U:function(){return n}});var r=i(33134),s=i(33389);const n=.03;class o{constructor(t=0,e=!1){}isEmpty(t){if(!t.nextPoint())return!0;let e,i,r,s;for(e=t.x,i=t.y;t.nextPoint();e=i,i=s)if(r=t.x,s=t.y,r!==e||s!==i)return t.seekPathStart(),!1;return t.seekPathStart(),!0}normalize(t){const e=Math.sqrt(t[0]*t[0]+t[1]*t[1]);0!==e&&(t[0]/=e,t[1]/=e)}getLength(t,e,i,r){const s=i-t,n=r-e;return Math.sqrt(s*s+n*n)}getSegLength(t){const[[e,i],[r,s]]=t;return this.getLength(e,i,r,s)}getCoord2D(t,e,i,r,s){return[t+(i-t)*s,e+(r-e)*s]}getSegCoord2D(t,e){const[[i,r],[s,n]]=t;return this.getCoord2D(i,r,s,n,e)}getAngle(t,e,i,r,s){const n=i-t,o=r-e;return Math.atan2(o,n)}getAngleCS(t,e,i,r,s){const n=i-t,o=r-e,a=Math.sqrt(n*n+o*o);return a>0?[n/a,o/a]:[1,0]}getSegAngleCS(t,e){const[[i,r],[s,n]]=t;return this.getAngleCS(i,r,s,n,e)}cut(t,e,i,r,s,n){return[s<=0?[t,e]:this.getCoord2D(t,e,i,r,s),n>=1?[i,r]:this.getCoord2D(t,e,i,r,n)]}getSubCurve(t,e,i){const s=r.z.createEmptyOptimizedCIM("esriGeometryPolyline");return this.appendSubCurve(s,t,e,i)?s:null}appendSubCurve(t,e,i,r){t.startPath(),e.seekPathStart();let s=0,n=!0;if(!e.nextPoint())return!1;let o=e.x,a=e.y;for(;e.nextPoint();){const l=this.getLength(o,a,e.x,e.y);if(0!==l){if(n){if(s+l>i){const h=(i-s)/l;let c=1,u=!1;s+l>=r&&(c=(r-s)/l,u=!0);const d=this.cut(o,a,e.x,e.y,h,c);if(d&&t.pushPoints(d),u)break;n=!1}}else{if(s+l>r){const i=this.cut(o,a,e.x,e.y,0,(r-s)/l);i&&t.pushPoint(i[1]);break}t.pushXY(e.x,e.y)}s+=l,o=e.x,a=e.y}else o=e.x,a=e.y}return!0}getCIMPointAlong(t,e){if(!t.nextPoint())return null;let i,r,s,n,o=0;for(i=t.x,r=t.y;t.nextPoint();i=s,r=n){s=t.x,n=t.y;const a=this.getLength(i,r,s,n);if(0!==a){if(o+a>e){const t=(e-o)/a;return this.getCoord2D(i,r,s,n,t)}o+=a}}return null}offset(t,e,i,r,n){if(!t||t.length<2)return null;let o=0,a=t[o++],l=o;for(;o<t.length;){const e=t[o];e[0]===a[0]&&e[1]===a[1]||(o!==l&&(t[l]=t[o]),a=t[l++]),o++}const h=t[0][0]===t[l-1][0]&&t[0][1]===t[l-1][1];if(h&&--l,l<(h?3:2))return null;const c=[];a=h?t[l-1]:null;let u=t[0];for(let n=0;n<l;n++){const o=n===l-1?h?t[0]:null:t[n+1];if(a)if(o){const t=[o[0]-u[0],o[1]-u[1]];this.normalize(t);const n=[u[0]-a[0],u[1]-a[1]];this.normalize(n);const l=n[0]*t[1]-n[1]*t[0],h=n[0]*t[0]+n[1]*t[1];if(0===l&&1===h){u=o;continue}if(l>=0==e<=0){if(h<1){const i=[t[0]-n[0],t[1]-n[1]];this.normalize(i);const s=Math.sqrt((1+h)/2);if(s>1/r){const t=-Math.abs(e)/s;c.push([u[0]-i[0]*t,u[1]-i[1]*t])}}}else switch(i){case s.xw.Mitered:{const i=Math.sqrt((1+h)/2);if(i>0&&1/i<r){const r=[t[0]-n[0],t[1]-n[1]];this.normalize(r);const s=Math.abs(e)/i;c.push([u[0]-r[0]*s,u[1]-r[1]*s]);break}}case s.xw.Bevelled:c.push([u[0]+n[1]*e,u[1]-n[0]*e]),c.push([u[0]+t[1]*e,u[1]-t[0]*e]);break;case s.xw.Rounded:if(h<1){c.push([u[0]+n[1]*e,u[1]-n[0]*e]);const i=Math.floor(2.5*(1-h));if(i>0){const r=1/i;let s=r;for(let o=1;o<i;o++,s+=r){const i=[n[1]*(1-s)+t[1]*s,-n[0]*(1-s)-t[0]*s];this.normalize(i),c.push([u[0]+i[0]*e,u[1]+i[1]*e])}}c.push([u[0]+t[1]*e,u[1]-t[0]*e])}break;case s.xw.Square:default:if(l<0)c.push([u[0]+(n[1]+n[0])*e,u[1]+(n[1]-n[0])*e]),c.push([u[0]+(t[1]-t[0])*e,u[1]-(t[0]+t[1])*e]);else{const i=Math.sqrt((1+Math.abs(h))/2),r=[t[0]-n[0],t[1]-n[1]];this.normalize(r);const s=e/i;c.push([u[0]-r[0]*s,u[1]-r[1]*s])}}}else{const t=[u[0]-a[0],u[1]-a[1]];this.normalize(t),c.push([u[0]+t[1]*e,u[1]-t[0]*e])}else{const t=[o[0]-u[0],o[1]-u[1]];this.normalize(t),c.push([u[0]+t[1]*e,u[1]-t[0]*e])}a=u,u=o}return c.length<(h?3:2)?null:(h&&c.push([c[0][0],c[0][1]]),c)}}},65661:function(t,e,i){i.d(e,{VA:function(){return a},YQ:function(){return r},Z1:function(){return c},ps:function(){return l}});var r,s,n=i(33134),o=i(93996);class a{constructor(){this._values=[],this.extPtGap=0,this.ctrlPtGap=0,this._length=0,this._currentValue=0}isEmpty(){return 0===this._values.length}size(){return this._values.length}init(t,e,i=!0){if(this._setEmpty(),!t||0===t.length)return!1;for(let e=0;e<t.length;e++){let r=Math.abs(t[e]);i&&r<1e-7&&(r=1e-7),this._values.push(r),this._length+=r}return e&&1&t.length&&(this._length*=2),0!==this._length&&(this.ctrlPtGap=this.extPtGap=0,this._currentValue=-1,!0)}scale(t){const e=this._values?this._values.length:0;for(let i=0;i<e;++i)this._values[i]*=t;this._length*=t,this.extPtGap*=t,this.ctrlPtGap*=t}addValue(t){this._length+=t,this._values.push(t)}firstValue(){return this._values[0]}lastValue(){return this._values[this._values.length-1]}nextValue(){return this._currentValue++,this._currentValue===this._values.length&&(this._currentValue=0),this._values[this._currentValue]}reset(){this._currentValue=-1}length(){return this._length}_setEmpty(){this.extPtGap=this.ctrlPtGap=this._length=0,this._currentValue=-1,this._values.length=0}}class l{constructor(){this.pt=null,this.ca=0,this.sa=0}}(s=r||(r={}))[s.FAIL=0]="FAIL",s[s.END=1]="END",s[s.CONTINUE=2]="CONTINUE";class h{constructor(){this.reset()}reset(){this.segment=null,this.segmentLength=0,this.abscissa=0,this.isPathEnd=!1,this.isPartEnd=!1}isValid(){return null!==this.segment}copyTo(t){t.segment=this.segment,t.segmentLength=this.segmentLength,t.abscissa=this.abscissa,t.isPathEnd=this.isPathEnd,t.isPartEnd=this.isPartEnd}}class c extends o.I{constructor(t=0,e=!1){super(t,e),this._tolerance=o.U,this._currentPosition=new h}updateTolerance(t){this._tolerance=o.U*t}init(t,e,i=!0){return i?(this._patternLength=e.length(),this._partExtPtGap=e.extPtGap,this._partCtrlPtGap=e.ctrlPtGap):(this._patternLength=0,this._partExtPtGap=0,this._partCtrlPtGap=0),this._currentPosition.reset(),this._partSegCount=0,this._pathCursor=t,this._seg=-1,this._setPosAtNextPart()}curPositionIsValid(){return this._currentPosition.isValid()}nextPosition(t,e=r.FAIL){const i=new h;return!!this._nextPosition(t,i,null,e)&&(i.copyTo(this._currentPosition),!0)}curPointAndAngle(t){t.pt=this._getPoint(this._currentPosition);const[e,i]=this._getAngleCS(this._currentPosition);t.ca=e,t.sa=i}nextPointAndAngle(t,e,i=r.FAIL){const s=new h;if(!this._nextPosition(t,s,null,i))return!1;s.copyTo(this._currentPosition),e.pt=this._getPoint(s);const[n,o]=this._getAngleCS(s);return e.ca=n,e.sa=o,!0}nextCurve(t){if(0===t)return null;const e=n.z.createEmptyOptimizedCIM("esriGeometryPolyline");e.startPath(),e.nextPath();const i=new h;return this._nextPosition(t,i,e,r.END)?(i.copyTo(this._currentPosition),e):null}isPathEnd(){return this._currentPosition.isPathEnd}getPathEnd(){return this._currentPosition.segment[1]}getPt(t){return this._pathCursor.seekInPath(t),[this._pathCursor.x,this._pathCursor.y]}getSeg(t){return[this.getPt(t),this.getPt(t+1)]}_nextPosition(t,e,i,s){if(this._currentPosition.isPathEnd)return!1;let n=this._currentPosition.abscissa;for(this._currentPosition.segmentLength>0&&(n/=this._currentPosition.segmentLength),this._currentPosition.copyTo(e);e.abscissa+t*this._partLengthRatio>e.segmentLength+this._tolerance;){if(i){if(0===i.pathSize)if(0===n){const t=e.segment[0];i.pushXY(t[0],t[1])}else i.pushPoint(this.getSegCoord2D(e.segment,n));const t=e.segment[1];i.pushXY(t[0],t[1])}if(n=0,t-=(e.segmentLength-e.abscissa)/this._partLengthRatio,this._partSegCount)e.segment=this._nextSegment(),e.segmentLength=this.getSegLength(e.segment),e.abscissa=0,this._partSegCount--;else{if(!this._setPosAtNextPart())return s!==r.FAIL&&(e.segmentLength=this.getSegLength(e.segment),e.isPartEnd=!0,s===r.END?(e.abscissa=e.segmentLength,e.isPathEnd=!0):e.abscissa=e.segmentLength+t,!0);this._currentPosition.copyTo(e)}}if(e.abscissa+=t*this._partLengthRatio,i){0===i.pathSize&&(0===n?i.pushPoint(e.segment[0]):i.pushPoint(this.getSegCoord2D(e.segment,n)));const t=e.abscissa/e.segmentLength;1===t?i.pushPoint(e.segment[1]):i.pushPoint(this.getSegCoord2D(e.segment,t))}return this._partSegCount||Math.abs(e.abscissa-e.segmentLength)<this._tolerance&&(e.isPathEnd=this._partIsLast,e.isPartEnd=!0),!0}_getPoint(t){const e=t.segmentLength<=0?0:t.abscissa/t.segmentLength;return this.getSegCoord2D(this._currentPosition.segment,e)}_getAngleCS(t){const e=t.segmentLength<=0?0:t.abscissa/t.segmentLength;return this.getSegAngleCS(this._currentPosition.segment,e)}_setPosAtNextPart(){for(;this._partSegCount;)this._hasNextSegment()&&this._nextSegment(),this._partSegCount--;if(!this._hasNextSegment())return!1;for(this._partLength=0,this._partIsLast=!0,this._partSegCount=0;this._hasNextSegment();)if(this._partLength+=this.getSegLength(this._nextSegment()),this._partSegCount++,this._pathCursor.getControlPointAt(this._getEndPointIndex())){this._partIsLast=!this._hasNextSegment();break}let t=this._partSegCount;for(;t;)this._previousSegment(),--t;this._currentPosition.segment=this._nextSegment(),this._currentPosition.segmentLength=this.getSegLength(this._currentPosition.segment),this._currentPosition.abscissa=0,this._currentPosition.isPathEnd=this._currentPosition.isPartEnd=!1,--this._partSegCount;const e=this._getStartPointIndex();this._ctrlPtBegin=this._pathCursor.getControlPointAt(e);let i=e+this._partSegCount+1;if(i>=this._pathCursor.pathSize&&(i=0),this._ctrlPtEnd=this._pathCursor.getControlPointAt(i),this._patternLength>0){const t=this._ctrlPtBegin?this._partCtrlPtGap:this._partExtPtGap,e=this._ctrlPtEnd?this._partCtrlPtGap:this._partExtPtGap;let i=Math.round((this._partLength-(t+e))/this._patternLength);i<=0&&(i=t+e>0?0:1),this._partLengthRatio=this._partLength/(t+e+i*this._patternLength),this._partLengthRatio<.01&&(this._partLengthRatio=1)}else this._partLengthRatio=1;return!0}_hasNextSegment(){return this._seg<this._pathCursor.pathSize-2}_previousSegment(){return this.getSeg(--this._seg)}_nextSegment(){return this.getSeg(++this._seg)}_getStartPointIndex(){return this._seg}_getEndPointIndex(){return this._seg+1}}},82497:function(t,e,i){i.d(e,{A:function(){return r}});class r{constructor(t=0,e=0,i=0,r=0){this.x=t,this.y=e,this.width=i,this.height=r}static fromExtent(t){return new r(t.xmin,-t.ymax,t.xmax-t.xmin,t.ymax-t.ymin)}get isEmpty(){return this.width<=0||this.height<=0}union(t){this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.width=Math.max(this.width,t.width),this.height=Math.max(this.height,t.height)}}},63514:function(t,e,i){i.d(e,{N:function(){return r}});class r{static local(){return null===r.instance&&(r.instance=new r),r.instance}execute(t,e,i,r,n){return new s(t,e,i)}}r.instance=null;class s{constructor(t,e,i){this._inputGeometries=t,this._angleTolerance=void 0!==e.angleTolerance?e.angleTolerance:120,this._maxCosAngle=Math.cos((1-Math.abs(this._angleTolerance)/180)*Math.PI)}next(){let t=this._inputGeometries.next();for(;t;){if("esriGeometryPolygon"===t.geometryType)this._isClosed=!0;else if("esriGeometryPolyline"===t.geometryType)this._isClosed=!1;else{if("esriGeometryEnvelope"!==t.geometryType){t=this._inputGeometries.next();continue}if(this._maxCosAngle)return t;this._isClosed=!0}for(;t.nextPath();)this._processPath(t);return t.reset(),t}return null}_processPath(t){if(t.nextPoint()){const e=t.x,i=t.y;let r=e,s=i,n=t.pathSize,o=0,a=0,l=0,h=0,c=0,u=0;this._isClosed&&++n;for(let d=1;t.nextPoint()||d<n;++d){let f,p;this._isClosed&&d===n-1?(f=e,p=i):(f=t.x,p=t.y);const m=f-r,g=p-s,_=Math.sqrt(m*m+g*g);d>1&&_>0&&l>0&&(o*m+a*g)/_/l<=this._maxCosAngle&&t.setControlPointAt(d-1),1===d&&(h=m,c=g,u=_),_>0&&(r=f,s=p,o=m,a=g,l=_)}this._isClosed&&l>0&&u>0&&(o*h+a*c)/u/l<=this._maxCosAngle&&t.setControlPointAt(0)}}}},82112:function(t,e,i){i.d(e,{B:function(){return c}});var r=i(33134),s=i(49077),n=i(23454),o=i(93996),a=i(33389);const l=1.7320508075688772,h=a.oF.OpenEnded;class c{static local(){return null===c.instance&&(c.instance=new c),c.instance}execute(t,e,i,r,s){return new u(t,e,i)}}c.instance=null;class u extends n.rx{constructor(t,e,i){super(t,!1,!0),this._curveHelper=new o.I,this._width=(void 0!==e.width?e.width:5)*i,this._arrowType=void 0!==e.geometricEffectArrowType?e.geometricEffectArrowType:void 0!==e.arrowType?e.arrowType:h,this._offsetFlattenError=o.U*i}processPath(t){const e=r.z.createEmptyOptimizedCIM(t.geometryType);switch(this._arrowType){case a.oF.OpenEnded:default:this._constructSimpleArrow(e,t,!0);break;case a.oF.Block:this._constructSimpleArrow(e,t,!1);break;case a.oF.Crossed:this._constructCrossedArrow(e,t)}return e}_constructSimpleArrow(t,e,i){const r=e.pathLength();let n=this._width;r<2*n&&(n=r/2);const o=this._curveHelper.getSubCurve(e,0,r-n);if(!o||!o.nextPath())return;o.seekPathStart();const a=n/2;if(this._curveHelper.isEmpty(o))return;const l=(0,s.A)(o),h=this._constructOffset(l,-a);if(!h)return;const c=this._constructOffset(l,a);if(!c)return;const u=this._constructArrowBasePoint(h,-a/2);if(!u)return;const d=this._constructArrowBasePoint(c,a/2);if(!d)return;e.seekInPath(e.pathSize-1);const f=[e.x,e.y];t.pushPath(c),t.nextPath(),t.nextPoint(),t.setControlPoint(),t.pushPoint(d),t.nextPoint(),t.setControlPoint(),t.pushPoint(f),t.nextPoint(),t.setControlPoint(),t.pushPoint(u),t.nextPoint(),t.setControlPoint(),t.pushPoints(h.reverse()),t.setControlPoint(),i||(t.setControlPointAt(0),t.setControlPointAt(t.pathSize-1),t.pushPoint(c[0])),t.reset()}_constructCrossedArrow(t,e){const i=e.pathLength();let r=this._width;i<r*(1+l+1)&&(r=i/(1+l+1)),e.seekPathStart();const n=this._curveHelper.getSubCurve(e,0,i-r*(1+l));if(!n)return;n.nextPath();const o=r/2;if(this._curveHelper.isEmpty(n))return;const a=(0,s.A)(n),h=this._constructOffset(a,o);if(!h)return;const c=this._constructOffset(a,-o);if(!c)return;const u=this._curveHelper.getSubCurve(e,0,i-r);if(!u)return;if(u.nextPath(),this._curveHelper.isEmpty(u))return;const d=(0,s.A)(u),f=this._constructOffset(d,o);if(!f)return;const p=this._constructOffset(d,-o);if(!p)return;const m=f[f.length-1],g=this._constructArrowBasePoint(f,o/2);if(!g)return;const _=p[p.length-1],y=this._constructArrowBasePoint(p,-o/2);if(!y)return;e.seekInPath(e.pathSize-1);const v=[e.x,e.y];t.pushPath(h),t.nextPath(),t.nextPoint(),t.setControlPoint(),t.pushPoint(_),t.nextPoint(),t.setControlPoint(),t.pushPoint(y),t.nextPoint(),t.setControlPoint(),t.pushPoint(v),t.nextPoint(),t.setControlPoint(),t.pushPoint(g),t.nextPoint(),t.setControlPoint(),t.pushPoint(m),t.nextPoint(),t.setControlPoint(),t.pushPoints(c.reverse()),t.nextPoint(),t.setControlPoint(),t.reset()}_constructOffset(t,e){return this._curveHelper.offset(t,e,a.xw.Rounded,4,this._offsetFlattenError)}_constructArrowBasePoint(t,e){if(!t||t.length<2)return null;const i=t[t.length-2],r=t[t.length-1],s=[r[0]-i[0],r[1]-i[1]];return this._curveHelper.normalize(s),[r[0]+s[1]*e,r[1]-s[0]*e]}}},20391:function(t,e,i){i.d(e,{s:function(){return h}}),i(50917);var r=i(33134),s=i(49077),n=i(62096),o=i(93996),a=i(33389),l=i(57165);class h{static local(){return null===h.instance&&(h.instance=new h),h.instance}execute(t,e,i,r,s,n){return new c(t,e,i,r,s,n)}}h.instance=null;class c{constructor(t,e,i,r,s,n){this._inputGeometries=t,this._tileKey=r,this._geometryEngine=s,this._curveHelper=new o.I,this._size=(void 0!==e.size?e.size:1)*i,this._maxInflateSize=n*i,this._offsetFlattenError=o.U*i}next(){let t;for(;t=this._inputGeometries.next();){if(0===this._size)return t;if("esriGeometryEnvelope"===t.geometryType)if(this._size>0){const e=r.z.createEmptyOptimizedCIM(t.geometryType),i=(0,s.x)(t)[0],n=this._curveHelper.offset(i,this._size,a.xw.Rounded,4,this._offsetFlattenError);if(n)return e.pushPath(n),e}else if(this._size<0){const e=t.asJSON();if(Math.min(e.xmax-e.xmin,e.ymax-e.ymin)+2*this._size>0)return r.z.fromJSONCIM({xmin:e.xmin-this._size,xmax:e.xmax+this._size,ymin:e.ymin-this._size,ymax:e.ymax+this._size})}const e=this._geometryEngine;if(null==e)return null;const i=this._tileKey?(0,n.q)(t,this._maxInflateSize):t;if(!i)continue;const o=e.buffer(l.A.WebMercator,i.asJSON(),this._size,1);return o?r.z.fromJSONCIM(o):null}return null}}},11672:function(t,e,i){i.d(e,{v:function(){return l}});var r=i(33134),s=i(49077),n=i(38441),o=i(23454),a=i(33389);class l{static local(){return null===l.instance&&(l.instance=new l),l.instance}execute(t,e,i,r,s){return new h(t,e,i)}}l.instance=null;class h{constructor(t,e,i){this._defaultPointSize=20,this._inputGeometries=t,this._geomUnitsPerPoint=i,this._rule=e.rule??a.uQ.FullGeometry,this._defaultSize=this._defaultPointSize*i}next(){let t;for(;t=this._inputGeometries.next();){const e=this._processGeom((0,s.x)(t));if(e?.length)return r.z.fromJSONCIM({paths:e})}return null}_clone(t){return[t[0],t[1]]}_mid(t,e){return[(t[0]+e[0])/2,(t[1]+e[1])/2]}_mix(t,e,i,r){return[t[0]*e+i[0]*r,t[1]*e+i[1]*r]}_add(t,e){return[t[0]+e[0],t[1]+e[1]]}_add2(t,e,i){return[t[0]+e,t[1]+i]}_sub(t,e){return[t[0]-e[0],t[1]-e[1]]}_dist(t,e){return Math.sqrt((t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1]))}_norm(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}_normalize(t,e=1){const i=e/this._norm(t);t[0]*=i,t[1]*=i}_leftPerpendicular(t){const e=-t[1],i=t[0];t[0]=e,t[1]=i}_leftPerp(t){return[-t[1],t[0]]}_rightPerpendicular(t){const e=t[1],i=-t[0];t[0]=e,t[1]=i}_rightPerp(t){return[t[1],-t[0]]}_dotProduct(t,e){return t[0]*e[0]+t[1]*e[1]}_crossProduct(t,e){return t[0]*e[1]-t[1]*e[0]}_rotateDirect(t,e,i){const r=t[0]*e-t[1]*i,s=t[0]*i+t[1]*e;t[0]=r,t[1]=s}_makeCtrlPt(t){const e=[t[0],t[1]];return(0,o.Aq)(e,1),e}_addAngledTicks(t,e,i,r){const s=this._sub(i,e);this._normalize(s);const n=this._crossProduct(s,this._sub(r,e));let o;o=n>0?this._rightPerp(s):this._leftPerp(s);const a=Math.abs(n)/2,l=[];l.push([e[0]+(o[0]-s[0])*a,e[1]+(o[1]-s[1])*a]),l.push(e),l.push(i),l.push([i[0]+(o[0]+s[0])*a,i[1]+(o[1]+s[1])*a]),t.push(l)}_addBezier2(t,e,i,r,s){if(0==s--)return void t.push(r);const n=this._mid(e,i),o=this._mid(i,r),a=this._mid(n,o);this._addBezier2(t,e,n,a,s),this._addBezier2(t,a,o,r,s)}_addBezier3(t,e,i,r,s,n){if(0==n--)return void t.push(s);const o=this._mid(e,i),a=this._mid(i,r),l=this._mid(r,s),h=this._mid(o,a),c=this._mid(a,l),u=this._mid(h,c);this._addBezier3(t,e,o,h,u,n),this._addBezier3(t,u,c,l,s,n)}_add90DegArc(t,e,i,r,s){const n=s??this._crossProduct(this._sub(i,e),this._sub(r,e))>0,o=this._mid(e,i),a=this._sub(o,e);n?this._leftPerpendicular(a):this._rightPerpendicular(a),o[0]+=a[0],o[1]+=a[1],this._addBezier3(t,e,this._mix(e,.33333,o,.66667),this._mix(i,.33333,o,.66667),i,4)}_addArrow(t,e,i){const r=e[0],s=e[1],n=e[e.length-1],o=this._sub(r,s),a=this._norm(o);this._normalize(o);const l=Math.abs(this._crossProduct(o,this._sub(n,s)));let h=this._dotProduct(o,this._sub(n,s));h<.05*a?h=.05*a:h>.95*a&&(h=.95*a);const c=.5*l,u=this._leftPerp(o),d=[s[0]+o[0]*h,s[1]+o[1]*h],f=e.length-1,p=[];p.push(i?[-u[0],-u[1]]:u);let m=[-o[0],-o[1]];for(let t=1;t<f-1;t++){const i=this._sub(e[t+1],e[t]);this._normalize(i);const r=this._dotProduct(i,m),s=this._crossProduct(i,m),n=Math.sqrt((1+r)/2),o=this._sub(i,m);this._normalize(o),o[0]/=n,o[1]/=n,p.push(s<0?[-o[0],-o[1]]:o),m=i}p.push(this._rightPerp(m));for(let i=p.length-1;i>0;i--)t.push([e[i][0]+p[i][0]*c,e[i][1]+p[i][1]*c]);t.push([d[0]+p[0][0]*c,d[1]+p[0][1]*c]),t.push([d[0]+p[0][0]*l,d[1]+p[0][1]*l]),t.push(r),t.push([d[0]-p[0][0]*l,d[1]-p[0][1]*l]),t.push([d[0]-p[0][0]*c,d[1]-p[0][1]*c]);for(let i=1;i<p.length;i++)t.push([e[i][0]-p[i][0]*c,e[i][1]-p[i][1]*c])}_addDash(t,e,i){const r=this._norm(i)/7;this._normalize(i);let s=[];for(let n=0;n<=7;n++)s.push([e[0]+i[0]*n*r,e[1]+i[1]*n*r]),1&n&&(t.push(s),s=[])}_cp2(t,e,i){return t.length>=2?t[1]:this._add2(t[0],e*this._defaultSize,i*this._defaultSize)}_cp3(t,e,i,r){if(t.length>=3)return t[2];const s=this._mix(t[0],1-i,e,i),n=this._sub(e,t[0]);return this._normalize(n),this._rightPerpendicular(n),[s[0]+n[0]*r*this._defaultSize,s[1]+n[1]*r*this._defaultSize]}_arrowPath(t){if(t.length>2)return t;const e=t[0],i=this._cp2(t,-4,0),r=this._sub(e,i);this._normalize(r);const s=this._rightPerp(r);return[e,i,[e[0]+(s[0]-r[0])*this._defaultSize,e[1]+(s[1]-r[1])*this._defaultSize]]}_arrowLastSeg(t){const e=t[0],i=this._cp2(t,-4,0);let r;if(t.length>=3)r=t[t.length-1];else{const t=this._sub(e,i);this._normalize(t);const s=this._rightPerp(t);r=[e[0]+(s[0]-t[0])*this._defaultSize,e[1]+(s[1]-t[1])*this._defaultSize]}return[i,r]}_processGeom(t){if(!t)return null;const e=[];for(const i of t){const t=i.length>1&&(0,n.Yl)(i)<this._defaultSize;if(!i||0===i.length||t)continue;const r=i.length;let s=i[0];switch(this._rule){case a.uQ.PerpendicularFromFirstSegment:{const t=this._cp2(i,0,-1),r=this._cp3(i,t,.5,4),n=[];n.push(r),n.push(this._mid(s,t)),e.push(n);break}case a.uQ.ReversedFirstSegment:{const t=this._cp2(i,0,-1);e.push([t,s]);break}case a.uQ.PerpendicularToSecondSegment:{if(i.length<3)return[];const t=this._cp2(i,-4,1),r=this._cp3(i,t,.882353,-1.94),n=[];n.push(this._mid(t,r)),n.push(s),e.push(n);break}case a.uQ.SecondSegmentWithTicks:{if(i.length<3)return[];const t=this._cp2(i,-4,1),r=this._cp3(i,t,.882353,-1.94),n=this._sub(r,t);let o;o=this._crossProduct(n,this._sub(s,t))>0?this._rightPerp(n):this._leftPerp(n);const a=[];a.push([t[0]+(o[0]-n[0])/3,t[1]+(o[1]-n[1])/3]),a.push(t),a.push(r),a.push([r[0]+(o[0]+n[0])/3,r[1]+(o[1]+n[1])/3]),e.push(a);break}case a.uQ.DoublePerpendicular:{const t=this._cp2(i,0,-1),r=this._cp3(i,t,.5,3),n=this._mid(s,t),o=this._sub(n,r);this._normalize(o);const a=this._crossProduct(o,this._sub(s,r));this._leftPerpendicular(o);const l=[];l.push(s),l.push([r[0]+o[0]*a,r[1]+o[1]*a]),e.push(l);const h=[];h.push([r[0]-o[0]*a,r[1]-o[1]*a]),h.push(t),e.push(h);break}case a.uQ.OppositeToFirstSegment:{const t=this._cp2(i,0,-1),r=this._cp3(i,t,.5,3),n=this._mid(s,t),o=this._sub(n,r);this._normalize(o);const a=this._crossProduct(o,this._sub(s,r));this._leftPerpendicular(o);const l=[];l.push([r[0]+o[0]*a,r[1]+o[1]*a]),l.push([r[0]-o[0]*a,r[1]-o[1]*a]),e.push(l);break}case a.uQ.TriplePerpendicular:{const t=this._cp2(i,0,-1),r=this._cp3(i,t,.5,4),n=this._mid(s,t),o=this._sub(n,r);this._normalize(o);const a=this._crossProduct(o,this._sub(s,r));this._leftPerpendicular(o);const l=[];l.push([r[0]+o[0]*a*.8,r[1]+o[1]*a*.8]),l.push([n[0]+.8*(s[0]-n[0]),n[1]+.8*(s[1]-n[1])]),e.push(l),e.push([r,n]);const h=[];h.push([r[0]-o[0]*a*.8,r[1]-o[1]*a*.8]),h.push([n[0]+.8*(t[0]-n[0]),n[1]+.8*(t[1]-n[1])]),e.push(h);break}case a.uQ.HalfCircleFirstSegment:{const t=this._cp2(i,0,-1),r=this._cp3(i,t,.5,4),n=this._mid(s,t);let o=this._sub(t,s);const a=Math.cos(Math.PI/18),l=Math.sin(Math.PI/18),h=Math.sqrt((1+a)/2),c=Math.sqrt((1-a)/2),u=[];let d;this._crossProduct(o,this._sub(r,s))>0?(u.push(s),o=this._sub(s,n),d=t):(u.push(t),o=this._sub(t,n),d=s),this._rotateDirect(o,h,c),o[0]/=h,o[1]/=h;for(let t=1;t<=18;t++)u.push(this._add(n,o)),this._rotateDirect(o,a,l);u.push(d),e.push(u);break}case a.uQ.HalfCircleSecondSegment:{const t=this._cp2(i,0,-1),r=this._cp3(i,t,1,-1);let n=this._sub(s,t);this._normalize(n);const o=this._crossProduct(n,this._sub(r,t))/2;this._leftPerpendicular(n);const a=[t[0]+n[0]*o,t[1]+n[1]*o];n=this._sub(t,a);const l=Math.cos(Math.PI/18);let h=Math.sin(Math.PI/18);o>0&&(h=-h);const c=[t];for(let t=1;t<=18;t++)this._rotateDirect(n,l,h),c.push(this._add(a,n));e.push(c);break}case a.uQ.HalfCircleExtended:{const t=this._cp2(i,0,-2),n=this._cp3(i,t,1,-1);let o;if(r>=4)o=i[3];else{const e=this._sub(s,t);o=this._add(n,e)}const a=this._dist(t,n)/2/.75,l=this._sub(t,s);this._normalize(l,a);const h=this._sub(n,o);this._normalize(h,a);const c=[o,n];e.push(c);const u=[this._clone(n)];this._addBezier3(u,n,this._add(n,h),this._add(t,l),t,4),u.push(s),e.push(u);break}case a.uQ.OpenCircle:{const t=this._cp2(i,-2,0),r=this._sub(t,s),n=Math.cos(Math.PI/18),o=-Math.sin(Math.PI/18),a=[t];for(let t=1;t<=33;t++)this._rotateDirect(r,n,o),a.push(this._add(s,r));e.push(a);break}case a.uQ.CoverageEdgesWithTicks:{const t=this._cp2(i,0,-1);let n,o;if(r>=3)n=i[2];else{const e=this._sub(t,s),i=this._leftPerp(e);n=[s[0]+i[0]-.25*e[0],s[1]+i[1]-.25*e[1]]}if(r>=4)o=i[3];else{const e=this._mid(s,t),i=this._sub(s,t);this._normalize(i),this._leftPerpendicular(i);const r=this._crossProduct(i,this._sub(n,e));this._rightPerpendicular(i),o=[n[0]+i[0]*r*2,n[1]+i[1]*r*2]}const a=this._sub(t,s);let l,h;l=this._crossProduct(a,this._sub(n,s))>0?this._rightPerp(a):this._leftPerp(a),h=[],h.push(n),h.push(s),h.push([s[0]+(l[0]-a[0])/3,s[1]+(l[1]-a[1])/3]),e.push(h),l=this._crossProduct(a,this._sub(o,t))>0?this._rightPerp(a):this._leftPerp(a),h=[],h.push([t[0]+(l[0]+a[0])/3,t[1]+(l[1]+a[1])/3]),h.push(t),h.push(o),e.push(h);break}case a.uQ.GapExtentWithDoubleTicks:{const t=this._cp2(i,0,2),n=this._cp3(i,t,0,1);let o;if(r>=4)o=i[3];else{const e=this._sub(t,s);o=this._add(n,e)}this._addAngledTicks(e,s,t,this._mid(n,o)),this._addAngledTicks(e,n,o,this._mid(s,t));break}case a.uQ.GapExtentMidline:{const t=this._cp2(i,2,0),n=this._cp3(i,t,0,1);let o;if(r>=4)o=i[3];else{const e=this._sub(t,s);o=this._add(n,e)}const a=[];a.push(this._mid(s,n)),a.push(this._mid(t,o)),e.push(a);break}case a.uQ.Chevron:{const t=this._cp2(i,-1,-1);let n;if(r>=3)n=i[2];else{const e=this._sub(t,s);this._leftPerpendicular(e),n=this._add(s,e)}e.push([t,this._makeCtrlPt(s),n]);break}case a.uQ.PerpendicularWithArc:{const t=this._cp2(i,0,-2),n=this._cp3(i,t,.5,-1),o=this._sub(t,s),a=this._norm(o);o[0]/=a,o[1]/=a;const l=this._crossProduct(o,this._sub(n,s));let h=this._dotProduct(o,this._sub(n,s));h<.05*a?h=.05*a:h>.95*a&&(h=.95*a);const c=[s[0]+o[0]*h,s[1]+o[1]*h];let u=this._leftPerp(o),d=[];if(d.push([c[0]-u[0]*l,c[1]-u[1]*l]),d.push([c[0]+u[0]*l,c[1]+u[1]*l]),e.push(d),r>=4){const t=i[3];let r=this._dotProduct(o,this._sub(t,s));r<.1*a?r=.1*a:r>.9*a&&(r=.9*a);const n=[s[0]+o[0]*r,s[1]+o[1]*r],l=this._crossProduct(o,this._sub(t,s)),h=[];h.push([n[0]-u[0]*l,n[1]-u[1]*l]),h.push([n[0]+u[0]*l,n[1]+u[1]*l]),e.push(h)}const f=[t[0]+u[0]*l,t[1]+u[1]*l];u=this._sub(t,f);const p=Math.cos(Math.PI/18);let m=Math.sin(Math.PI/18);l<0&&(m=-m),d=[s,t];for(let t=1;t<=9;t++)this._rotateDirect(u,p,m),d.push(this._add(f,u));e.push(d);break}case a.uQ.ClosedHalfCircle:{const t=this._cp2(i,2,0),r=this._mid(s,t),n=this._sub(t,r),o=Math.cos(Math.PI/18),a=Math.sin(Math.PI/18),l=[s,t];for(let t=1;t<=18;t++)this._rotateDirect(n,o,a),l.push(this._add(r,n));e.push(l);break}case a.uQ.TripleParallelExtended:{const t=this._cp2(i,0,-2),r=this._cp3(i,t,1,-2),n=this._mid(s,t),a=this._sub(r,t);this._normalize(a);const l=Math.abs(this._crossProduct(a,this._sub(n,t)))/2,h=this._dist(t,r),c=[t,s];c.push([s[0]+a[0]*h*.5,s[1]+a[1]*h*.5]),e.push(c);const u=[];u.push([n[0]-a[0]*l,n[1]-a[1]*l]),u.push([n[0]+a[0]*h*.375,n[1]+a[1]*h*.375]),(0,o.Aq)(u[u.length-1],1),u.push([n[0]+a[0]*h*.75,n[1]+a[1]*h*.75]),e.push(u);const d=[t,r];e.push(d);break}case a.uQ.ParallelWithTicks:{const t=this._cp2(i,3,0),r=this._cp3(i,t,.5,-1),n=this._sub(r,t);this._normalize(n);const o=this._crossProduct(n,this._sub(r,s));this._leftPerpendicular(n),this._addAngledTicks(e,s,t,r),this._addAngledTicks(e,this._mix(s,1,n,o),this._mix(t,1,n,o),this._mid(s,t));break}case a.uQ.Parallel:{const t=this._cp2(i,3,0),r=this._cp3(i,t,.5,-1),n=this._sub(t,s);this._normalize(n);const o=this._leftPerp(n),a=this._crossProduct(n,this._sub(r,s));let l=[s,t];e.push(l),l=[],l.push([s[0]+o[0]*a,s[1]+o[1]*a]),l.push([t[0]+o[0]*a,t[1]+o[1]*a]),e.push(l);break}case a.uQ.PerpendicularToFirstSegment:{const t=this._cp2(i,3,0),r=this._cp3(i,t,.5,-1),n=this._mid(s,t),o=this._sub(t,s);this._normalize(o);const a=this._crossProduct(o,this._sub(r,s));this._leftPerpendicular(o);const l=[];l.push([n[0]-o[0]*a*.25,n[1]-o[1]*a*.25]),l.push([n[0]+o[0]*a*1.25,n[1]+o[1]*a*1.25]),e.push(l);break}case a.uQ.ParallelOffset:{const t=this._cp2(i,3,0),r=this._cp3(i,t,.5,-1),n=this._sub(t,s);this._normalize(n);const o=this._crossProduct(n,this._sub(r,s));this._leftPerpendicular(n);const a=[];a.push([s[0]-n[0]*o,s[1]-n[1]*o]),a.push([t[0]-n[0]*o,t[1]-n[1]*o]),e.push(a);const l=[];l.push([s[0]+n[0]*o,s[1]+n[1]*o]),l.push([t[0]+n[0]*o,t[1]+n[1]*o]),e.push(l);break}case a.uQ.OffsetOpposite:{const t=this._cp2(i,3,0),r=this._cp3(i,t,.5,-1),n=this._sub(t,s);this._normalize(n);const o=this._crossProduct(n,this._sub(r,s));this._leftPerpendicular(n);const a=[];a.push([s[0]-n[0]*o,s[1]-n[1]*o]),a.push([t[0]-n[0]*o,t[1]-n[1]*o]),e.push(a);break}case a.uQ.OffsetSame:{const t=this._cp2(i,3,0),r=this._cp3(i,t,.5,-1),n=this._sub(t,s);this._normalize(n);const o=this._crossProduct(n,this._sub(r,s));this._leftPerpendicular(n);const a=[];a.push([s[0]+n[0]*o,s[1]+n[1]*o]),a.push([t[0]+n[0]*o,t[1]+n[1]*o]),e.push(a);break}case a.uQ.CircleWithArc:{let t=this._cp2(i,3,0);const n=this._cp3(i,t,.5,-1);let a,l;if(r>=4)a=i[3],l=this._crossProduct(this._sub(a,t),this._sub(n,t))>0;else{a=t,l=this._crossProduct(this._sub(a,s),this._sub(n,s))>0;const e=24*this._geomUnitsPerPoint,i=this._sub(a,s);this._normalize(i,e);const r=Math.sqrt(2)/2;this._rotateDirect(i,r,l?r:-r),t=this._add(s,i)}const h=this._sub(t,s),c=Math.cos(Math.PI/18),u=Math.sin(Math.PI/18),d=[t];for(let t=1;t<=36;t++)this._rotateDirect(h,c,u),d.push(this._add(s,h));this._add90DegArc(d,t,a,n,l),(0,o.Aq)(d[d.length-8],1),e.push(d);break}case a.uQ.DoubleJog:{let t,n=this._cp2(i,-3,1),o=this._cp3(i,n,-1,-.5);if(r>=4)t=i[3];else{const e=s;s=n,t=o;const i=this._dist(s,e),r=this._dist(t,e);let a=30*this._geomUnitsPerPoint;.5*i<a&&(a=.5*i),.5*r<a&&(a=.5*r),n=this._mix(s,a/i,e,(i-a)/i),o=this._mix(t,a/r,e,(r-a)/r)}const a=this._mid(s,n),l=this._mid(t,o),h=this._dist(s,n),c=this._dist(o,t);let u=Math.min(h,c)/8;u=Math.min(u,24*this._geomUnitsPerPoint);const d=Math.cos(Math.PI/4);let f=this._sub(s,n);this._normalize(f,u),this._crossProduct(f,this._sub(t,n))>0?this._rotateDirect(f,d,-d):this._rotateDirect(f,d,d);let p=[];p.push(n),p.push(this._add(a,f)),p.push(this._sub(a,f)),p.push(s),e.push(p),f=this._sub(t,o),this._normalize(f,u),this._crossProduct(f,this._sub(s,o))<0?this._rotateDirect(f,d,d):this._rotateDirect(f,d,-d),p=[],p.push(o),p.push(this._add(l,f)),p.push(this._sub(l,f)),p.push(t),e.push(p);break}case a.uQ.PerpendicularOffset:{const t=this._cp2(i,-4,1),r=this._cp3(i,t,.882353,-1.94),n=this._sub(r,t);this._crossProduct(n,this._sub(s,t))>0?this._rightPerpendicular(n):this._leftPerpendicular(n);const o=[n[0]/8,n[1]/8],a=this._sub(this._mid(t,r),o);e.push([a,s]);break}case a.uQ.LineExcludingLastSegment:{const t=this._arrowPath(i),r=[];let s=t.length-2;for(;s--;)r.push(t[s]);e.push(r);break}case a.uQ.MultivertexArrow:{const t=this._arrowPath(i),r=[];this._addArrow(r,t,!1),e.push(r);break}case a.uQ.CrossedArrow:{const t=this._arrowPath(i),r=[];this._addArrow(r,t,!0),e.push(r);break}case a.uQ.ChevronArrow:{const[t,r]=this._arrowLastSeg(i),n=10*this._geomUnitsPerPoint,o=this._sub(s,t),a=this._norm(o);this._normalize(o);const l=this._crossProduct(o,this._sub(r,t));let h=this._dotProduct(o,this._sub(r,t));h<.05*a?h=.05*a:h>.95*a-n&&(h=.95*a-n);const c=[t[0]+o[0]*h,t[1]+o[1]*h],u=this._leftPerp(o),d=[];d.push([c[0]+u[0]*l+o[0]*n,c[1]+u[1]*l+o[1]*n]),d.push(s),d.push([c[0]-u[0]*l+o[0]*n,c[1]-u[1]*l+o[1]*n]),e.push(d);break}case a.uQ.ChevronArrowOffset:{const[t,r]=this._arrowLastSeg(i),n=this._sub(s,t),o=this._norm(n);this._normalize(n);const a=this._crossProduct(n,this._sub(r,t));let l=this._dotProduct(n,this._sub(r,t));l<.05*o?l=.05*o:l>.95*o&&(l=.95*o);const h=[t[0]+n[0]*l,t[1]+n[1]*l];this._leftPerpendicular(n);const c=[];c.push([h[0]+n[0]*a*.5,h[1]+n[1]*a*.5]),c.push(this._mid(h,s)),c.push([h[0]-n[0]*a*.5,h[1]-n[1]*a*.5]),e.push(c);break}case a.uQ.PartialFirstSegment:{const[t,r]=this._arrowLastSeg(i),n=this._sub(s,t),o=this._norm(n);this._normalize(n);let a=this._dotProduct(n,this._sub(r,t));a<.05*o?a=.05*o:a>.95*o&&(a=.95*o);const l=[t[0]+n[0]*a,t[1]+n[1]*a];e.push([t,l]);break}case a.uQ.Arch:{const t=this._cp2(i,0,-1),r=this._cp3(i,t,.5,1),n=this._sub(s,t),o=this._mix(r,1,n,.55),a=this._mix(r,1,n,-.55),l=[s];this._addBezier2(l,s,o,r,4),this._addBezier2(l,r,a,t,4),e.push(l);break}case a.uQ.CurvedParallelTicks:{const t=this._cp2(i,-4,1),r=this._cp3(i,t,.882353,-1.94),n=this._sub(r,t);this._crossProduct(n,this._sub(s,t))>0?this._rightPerpendicular(n):this._leftPerpendicular(n);const o=[n[0]/8,n[1]/8],a=this._sub(this._mid(t,r),o),l=this._sub(this._mix(t,.75,r,.25),o),h=this._sub(this._mix(t,.25,r,.75),o),c=[t];this._addBezier2(c,t,l,a,3),this._addBezier2(c,a,h,r,3),e.push(c);for(let t=0;t<8;t++){const i=c[2*t+1],r=[this._clone(i)];r.push(this._add(i,[n[0]/4,n[1]/4])),e.push(r)}break}case a.uQ.Arc90Degrees:{const t=this._cp2(i,0,-1),r=this._cp3(i,t,.5,1),n=[t];this._add90DegArc(n,t,s,r),e.push(n);break}case a.uQ.TipWithPerpendicularAndTicks:{const[t,r]=this._arrowLastSeg(i),n=10*this._geomUnitsPerPoint,o=this._sub(s,t),a=this._norm(o);this._normalize(o);let l=this._crossProduct(o,this._sub(r,t)),h=this._dotProduct(o,this._sub(r,t));h<.05*a?h=.05*a:h>.95*a-n&&(h=.95*a-n);const c=this._leftPerp(o),u=[s[0]-o[0]*n,s[1]-o[1]*n],d=.5*Math.max(a-h-n,n);l=Math.abs(l);const f=[];f.push([u[0]+c[0]*(l+d)-o[0]*d,u[1]+c[1]*(l+d)-o[1]*d]),f.push([u[0]+c[0]*l,u[1]+c[1]*l]),f.push([u[0]-c[0]*l,u[1]-c[1]*l]),f.push([u[0]-c[0]*(l+d)-o[0]*d,u[1]-c[1]*(l+d)-o[1]*d]),e.push(f),e.push([u,s]);break}case a.uQ.ConcentricCircles:{const t=this._cp2(i,1,0),n=this._cp3(i,t,2,0),a=Math.cos(Math.PI/18),l=Math.sin(Math.PI/18);let h=this._dist(t,s),c=[h,0],u=[];for(let t=0;t<=36;t++)u.push(this._add(s,c)),this._rotateDirect(c,a,l);if(e.push(u),r>=4){u=[];const t=i[3];h=this._dist(t,s),c=[h,0];for(let t=0;t<=36;t++)u.push(this._add(s,c)),0===t&&(u.push(this._add(s,c)),(0,o.Aq)(u[1],1)),this._rotateDirect(c,a,l);e.push(u)}u=[],h=this._dist(n,s),c=[h,0];for(let t=0;t<=36;t++)u.push(this._add(s,c)),this._rotateDirect(c,a,l);e.push(u);break}case a.uQ.DoubleJogArrow:{s=this._arrowPath(i)[0];const[t,r]=this._arrowLastSeg(i),n=this._sub(s,t),o=this._norm(n);this._normalize(n);const a=Math.abs(this._crossProduct(n,this._sub(r,s)));let l=Math.abs(this._dotProduct(n,this._sub(r,s)));l<.05*o?l=.05*o:l>.95*o&&(l=.95*o);const h=Math.max(a,l),c=this._leftPerp(n);let u=[];const d=[s[0]-n[0]*l*.5+c[0]*a*.5,s[1]-n[1]*l*.5+c[1]*a*.5];u.push([d[0],d[1]]),d[0]+=n[0]*h*.5+c[0]*h*.4,d[1]+=n[1]*h*.5+c[1]*h*.4,u.push([d[0],d[1]]),d[0]-=c[0]*h*.25,d[1]-=c[1]*h*.25,u.push([d[0],d[1]]),d[0]+=n[0]*h*.5+c[0]*h*.4,d[1]+=n[1]*h*.5+c[1]*h*.4,u.push([d[0],d[1]]),e.push(u),u=[],d[0]=s[0]-n[0]*l*.5-c[0]*a*.5,d[1]=s[1]-n[1]*l*.5-c[1]*a*.5,u.push([d[0],d[1]]),d[0]+=n[0]*h*.5-c[0]*h*.4,d[1]+=n[1]*h*.5-c[1]*h*.4,u.push([d[0],d[1]]),d[0]+=c[0]*h*.25,d[1]+=c[1]*h*.25,u.push([d[0],d[1]]),d[0]+=n[0]*h*.5-c[0]*h*.4,d[1]+=n[1]*h*.5-c[1]*h*.4,u.push([d[0],d[1]]),e.push(u);break}case a.uQ.LinkedChevrons:{const t=this._cp2(i,-5,0),r=this._cp3(i,t,-.2,1),n=this._sub(s,t);this._normalize(n);const o=this._leftPerp(n),a=Math.abs(this._crossProduct(n,this._sub(r,t)));e.push([t,s]);const l=[];l.push([s[0]-n[0]*a+o[0]*a,s[1]-n[1]*a+o[1]*a]),l.push(s),l.push([s[0]-n[0]*a-o[0]*a,s[1]-n[1]*a-o[1]*a]),e.push(l),this._addDash(e,t,[-n[0]*a+o[0]*a,-n[1]*a+o[1]*a]),this._addDash(e,t,[-n[0]*a-o[0]*a,-n[1]*a-o[1]*a]);break}case a.uQ.SegmentThenHalfCircle:{const t=this._cp2(i,2,0),n=this._cp3(i,t,1.5,0);let o;o=r>=4?i[3]:this._cp3(i,t,1.25,-.5);const a=this._sub(t,s);this._normalize(a);const l=.5*this._dist(t,n),h=this._crossProduct(a,this._sub(o,s))>0,c=Math.cos(Math.PI/18);let u=Math.sin(Math.PI/18);h&&(u=-u);const d=[s,t];a[0]*=l,a[1]*=l;const f=this._add(t,a);a[0]=-a[0],a[1]=-a[1];for(let t=1;t<=18;t++)this._rotateDirect(a,c,u),d.push(this._add(f,a));e.push(d);break}case a.uQ.LineWithStraightTicks:{const t=this._cp2(i,-2,1),r=this._cp3(i,t,-1,-.5),n=this._sub(r,t);this._normalize(n);const o=this._dotProduct(n,this._sub(t,s)),a=this._dotProduct(n,this._sub(r,s));let l=[s];l.push([s[0]+n[0]*o,s[1]+n[1]*o]),l.push(t),e.push(l),l=[s],l.push([s[0]+n[0]*a,s[1]+n[1]*a]),l.push(r),e.push(l);break}case a.uQ.DoubleCurve:{const t=this._cp2(i,-5,-1),r=this._cp3(i,t,2,0),n=Math.atan2(1,5),a=Math.cos(n),l=Math.sin(n),h=this._sub(t,s),c=this._dist(s,t);this._normalize(h),this._rotateDirect(h,a,-l);const u=[s];u.push([s[0]+h[0]*c*.5,s[1]+h[1]*c*.5]),(0,o.Aq)(u[1],1),u.push([s[0]+h[0]*c*.8,s[1]+h[1]*c*.8]),this._addBezier2(u,u[2],[s[0]+h[0]*c,s[1]+h[1]*c],t,3);const d=this._sub(r,t),f=this._dist(t,r);this._normalize(d),this._rotateDirect(d,a,-l),this._addBezier2(u,t,[r[0]-d[0]*f,r[1]-d[1]*f],[r[0]-d[0]*f*.8,r[1]-d[1]*f*.8],3),u.push(r),e.push(u);break}case a.uQ.ParallelWithTicksByWidth:{const t=this._cp2(i,0,-1),r=this._cp3(i,t,.5,3),n=this._sub(t,s);this._normalize(n);const o=this._crossProduct(n,this._sub(r,s));this._leftPerpendicular(n),o>0?(this._addAngledTicks(e,s,[s[0]+n[0]*o,s[1]+n[1]*o],t),this._addAngledTicks(e,t,[t[0]+n[0]*o,t[1]+n[1]*o],s)):(this._addAngledTicks(e,[s[0]+n[0]*o,s[1]+n[1]*o],s,t),this._addAngledTicks(e,[t[0]+n[0]*o,t[1]+n[1]*o],s,t));break}case a.uQ.EnclosingRoundedRectangle:{const t=this._cp2(i,3,-2),e=[Math.min(s[0],t[0]),Math.max(s[1],t[1])],r=[Math.max(s[0],t[0]),Math.min(s[1],t[1])],n=r[0]-e[0],o=e[1]-r[1],a=Math.min(n,o)/10,l=[];l.push([e[0]+a+.75*(n-2*a),e[1]]),l.push([r[0]-a,e[1]]),this._add90DegArc(l,[r[0]-a,e[1]],[r[0],e[1]-a],[r[0],e[1]]),l.push([r[0],r[1]+a]),this._add90DegArc(l,[r[0],r[1]+a],[r[0]-a,r[1]],r),l.push([e[0]+a,r[1]]),this._add90DegArc(l,[e[0]+a,r[1]],[e[0],r[1]+a],[e[0],r[1]]),l.push([e[0],e[1]-a]),this._add90DegArc(l,[e[0],e[1]-a],[e[0]+a,e[1]],e),l.push([e[0]+a+.75*(n-2*a),e[1]]);break}case a.uQ.FullGeometry:default:e.push(i)}}return e}}},12281:function(t,e,i){i.d(e,{y:function(){return o}});var r=i(33134),s=i(23454),n=i(93996);class o{static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(t,e,i,r,s){return new a(t,e,i)}}o.instance=null;class a extends s.rx{constructor(t,e,i){super(t,!0,!0),this._curveHelper=new n.I,this._beginCut=(void 0!==e.beginCut?e.beginCut:1)*i,this._endCut=(void 0!==e.endCut?e.endCut:1)*i,this._middleCut=(void 0!==e.middleCut?e.middleCut:0)*i,this._invert=void 0!==e.invert&&e.invert,this._beginCut<0&&(this._beginCut=0),this._endCut<0&&(this._endCut=0),this._middleCut<0&&(this._middleCut=0)}processPath(t){const{_beginCut:e,_endCut:i,_middleCut:s}=this,n=t.pathLength(),o=r.z.createEmptyOptimizedCIM("esriGeometryPolyline");if(this._invert){if(0!==e||0!==i||0!==s)if(e+i+s>=n)for(o.startPath();t.nextPoint();)o.pushXY(t.x,t.y);else this._curveHelper.appendSubCurve(o,t,0,e),this._curveHelper.appendSubCurve(o,t,.5*(n-s),.5*(n+s)),this._curveHelper.appendSubCurve(o,t,n-i,i)}else if(0===e&&0===i&&0===s)for(o.startPath();t.nextPoint();)o.pushXY(t.x,t.y);else e+i+s<n&&(0===s?this._curveHelper.appendSubCurve(o,t,e,n-i):(this._curveHelper.appendSubCurve(o,t,e,.5*(n-s)),this._curveHelper.appendSubCurve(o,t,.5*(n+s),n-i)));return 0===o.totalSize?null:o}}},2969:function(t,e,i){i.d(e,{I:function(){return h}});var r=i(33134),s=i(49077),n=i(23454),o=i(33389),a=i(65661),l=i(7590);class h{static local(){return null===h.instance&&(h.instance=new h),h.instance}execute(t,e,i,r,s){return new c(t,e,i)}}h.instance=null;class c extends n.rx{constructor(t,e,i){super(t,!0,!0),this._firstCurve=null,this._walker=new a.Z1,this._walker.updateTolerance(i),this._endings=e.lineDashEnding,this._customDashPos=-(e.offsetAlongLine??0)*i,this._offsetAtEnd=(e.customEndingOffset??0)*i;let r=(0,l.FH)(e).dashTemplate;null==r&&(r=[]),r.length%2&&(r=[...r,...r]),this._pattern=new a.VA,this._pattern.init(r,!0),this._pattern.scale(i)}processPath(t){if(0===this._pattern.length()){this.iteratePath=!1;const e=(0,s.A)(t);return r.z.fromJSONCIM({paths:[e]})}if(!this.iteratePath){let e=!0;switch(this._endings){case o.yS.HalfPattern:case o.yS.HalfGap:default:this._pattern.extPtGap=0;break;case o.yS.FullPattern:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.firstValue());break;case o.yS.FullGap:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.lastValue());break;case o.yS.NoConstraint:this.isClosed||(e=!1);break;case o.yS.Custom:this.isClosed||(this._pattern.extPtGap=.5*this._offsetAtEnd)}const i=t.pathLength();if(this._pattern.isEmpty()||i<.1*this._pattern.length()){const e=(0,s.A)(t);return r.z.fromJSONCIM({paths:[e]})}if(!this._walker.init(t,this._pattern,e)){const e=(0,s.A)(t);return r.z.fromJSONCIM({paths:[e]})}}let e;if(this.iteratePath)e=this._pattern.nextValue();else{let t;switch(this._endings){case o.yS.HalfPattern:default:t=.5*this._pattern.firstValue();break;case o.yS.HalfGap:t=.5*-this._pattern.lastValue();break;case o.yS.FullGap:t=-this._pattern.lastValue();break;case o.yS.FullPattern:t=0;break;case o.yS.NoConstraint:case o.yS.Custom:t=-this._customDashPos}let i=t/this._pattern.length();i-=Math.floor(i),t=i*this._pattern.length(),this._pattern.reset(),e=this._pattern.nextValue();let r=!1;for(;t>=e;)t-=e,e=this._pattern.nextValue(),r=!r;e-=t,r?(this._walker.nextPosition(e),e=this._pattern.nextValue()):this.isClosed&&(this._firstCurve=this._walker.nextCurve(e),e=this._pattern.nextValue(),this._walker.nextPosition(e),e=this._pattern.nextValue())}let i=this._walker.nextCurve(e);if(i)if(this._walker.isPathEnd()){if(this.iteratePath=!1,this._firstCurve){for(this._firstCurve.nextPath();this._firstCurve.nextPoint();)i.pushXY(this._firstCurve.x,this._firstCurve.y);this._firstCurve=null}}else e=this._pattern.nextValue(),!this._walker.nextPosition(e)||this._walker.isPathEnd()?(this.iteratePath=!1,this._firstCurve&&(i.pushCursor(this._firstCurve),this._firstCurve=null)):this.iteratePath=!0;else this.iteratePath=!1,i=this._firstCurve,this._firstCurve=null;return i?.reset(),i}}},7889:function(t,e,i){i.d(e,{O:function(){return a}}),i(50917);var r=i(33134),s=i(62096),n=i(33389),o=i(57165);class a{static local(){return null===a.instance&&(a.instance=new a),a.instance}execute(t,e,i,r,s,n){return new l(t,e,i,r,s,n)}}a.instance=null;class l{constructor(t,e,i,r,s,o){switch(this._inputGeometries=t,this._tileKey=r,this._geometryEngine=s,this._maxInflateSize=o*i,this._width=(void 0!==e.width?e.width:2)*i,e.method){case n.M1.Mitered:case n.M1.Bevelled:case n.M1.Rounded:case n.M1.TrueBuffer:case n.M1.Square:}this._option=e.option}next(){let t;for(;t=this._inputGeometries.next();){if("esriGeometryEnvelope"===t.geometryType&&this._width>0){const e=t.asJSON();return Math.min(e.xmax-e.xmin,e.ymax-e.ymin)-2*this._width<0?t:r.z.fromJSONCIM({paths:[[[e.xmin+this._width,e.ymin+this._width],[e.xmax-this._width,e.ymin+this._width],[e.xmax-this._width,e.ymax-this._width],[e.xmin+this._width,e.ymax-this._width],[e.xmin+this._width,e.ymin+this._width]],[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]})}if("esriGeometryPolygon"===t.geometryType){if(0===this._width)return t.clone();const e=this._geometryEngine;if(null==e)return null;const i=this._tileKey?(0,s.q)(t,this._maxInflateSize):t.clone();if(!i)continue;const r=e.buffer(o.A.WebMercator,i.asJSON(),-this._width,1);if(r)for(const t of r.rings)if(t){i.startPath();for(const e of t.reverse())i.pushXY(e[0],i.yFactor*e[1])}return i}}return null}}},48645:function(t,e,i){i.d(e,{U:function(){return o}});var r=i(33134),s=i(23454),n=i(93996);class o{static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(t,e,i,r,s){return new a(t,e,i)}}o.instance=null;class a extends s.rx{constructor(t,e,i){super(t,!1,!0),this._curveHelper=new n.I,this._length=(void 0!==e.length?e.length:20)*i,this._angle=void 0!==e.angle?e.angle:225,this._position=void 0!==e.position?e.position:50,this._length<0&&(this._length=-this._length),this._position<20&&(this._position=20),this._position>80&&(this._position=80),this._mirror=!1}processPath(t){const e=r.z.createEmptyOptimizedCIM("esriGeometryPolyline");if(this._curveHelper.isEmpty(t))return null;t.seekInPath(0);const i=t.x,s=t.y;t.seekInPath(t.pathSize-1);const n=t.x,o=t.y,a=[n-i,o-s];this._curveHelper.normalize(a);const l=i+(n-i)*this._position/100,h=s+(o-s)*this._position/100,c=Math.cos((90-this._angle)/180*Math.PI);let u=Math.sin((90-this._angle)/180*Math.PI);this._mirror&&(u=-u),this._mirror=!this._mirror;const d=[l-this._length/2*c,h-this._length/2*u],f=[l+this._length/2*c,h+this._length/2*u];return e.pushPath([[i,s],d,f,[n,o]]),e}}},7088:function(t,e,i){i.d(e,{V:function(){return r}});class r{static local(){return null===r.instance&&(r.instance=new r),r.instance}execute(t,e,i,r,n){return new s(t,e,i)}}r.instance=null;class s{constructor(t,e,i){this._inputGeometries=t,this._offsetX=void 0!==e.offsetX?e.offsetX*i:0,this._offsetY=void 0!==e.offsetY?e.offsetY*i:0}next(){let t=this._inputGeometries.next();for(;t;){if(t.totalSize>0)return this._move(t.clone(),this._offsetX,this._offsetY);t=this._inputGeometries.next()}return null}_move(t,e,i){for(;t.nextPath();)for(;t.nextPoint();)t.x=t.x+e,t.y=t.y+i;return t.reset(),t}}},17706:function(t,e,i){i.d(e,{V:function(){return c}}),i(50917);var r=i(33134),s=i(49077),n=i(74697),o=i(62096),a=i(93996),l=i(33389),h=i(57165);class c{static local(){return null===c.instance&&(c.instance=new c),c.instance}execute(t,e,i,r,s,n){return new u(t,e,i,r,s,n)}}c.instance=null;class u{constructor(t,e,i,r,s,n){this._inputGeometries=t,this._tileKey=r,this._geometryEngine=s,this._curveHelper=new a.I,this._offset=(e.offset??1)*i,this._method=e.method,this._maxInflateSize=Math.max(Math.abs(n*i),10),this._option=e.option,this._offsetFlattenError=a.U*i}next(){let t;for(;t=this._inputGeometries.next();){if(0===this._offset)return t.clone();if("esriGeometryEnvelope"===t.geometryType){if(this._method===l.xw.Rounded&&this._offset>0){const e=(0,s.A)(t),i=this._curveHelper.offset(e,-this._offset,this._method,4,this._offsetFlattenError);if(i){const e=r.z.createEmptyOptimizedCIM(t.geometryType);return e.pushPath(i),e}return null}const e=t.asJSON();if((0,n.ZC)(e)&&Math.min(e.xmax-e.xmin,e.ymax-e.ymin)+2*this._offset>0)return r.z.fromJSONCIM({xmin:e.xmin-this._offset,xmax:e.xmax+this._offset,ymin:e.ymin-this._offset,ymax:e.ymax+this._offset})}const e=this._geometryEngine;if(null==e)continue;const i=this._tileKey?(0,o.q)(t,this._maxInflateSize):t.clone();if(!i)continue;const a=e.offset(h.A.WebMercator,i.asJSON(),-this._offset,1,this._method,4,this._offsetFlattenError);return a?r.z.fromJSONCIM(a):null}return null}}},10183:function(t,e,i){i.d(e,{C:function(){return r}});class r{static local(){return null===r.instance&&(r.instance=new r),r.instance}execute(t,e,i,r,n){return new s(t,e,i)}}r.instance=null;class s{constructor(t,e,i){this._inputGeometries=t,this._reverse=void 0===e.reverse||e.reverse}next(){let t=this._inputGeometries.next();for(;t;){if(!this._reverse)return t;if("esriGeometryPolyline"===t.geometryType)return n(t.clone());t=this._inputGeometries.next()}return null}}function n(t){for(;t.nextPath();)for(let e=0;e<t.pathSize/2;e++){t.seekInPath(e);const i=t.x,r=t.y;t.seekInPath(t.pathSize-e-1);const s=t.x,n=t.y;t.x=i,t.y=r,t.seekInPath(e),t.x=s,t.y=n}return t.reset(),t}},1646:function(t,e,i){i.d(e,{v:function(){return s}});var r=i(35068);class s{static local(){return null===s.instance&&(s.instance=new s),s.instance}execute(t,e,i,r,s){return new n(t,e,i)}}s.instance=null;class n{constructor(t,e,i){this._inputGeometries=t,this._rotateAngle=void 0!==e.angle?e.angle*Math.PI/180:0}next(){let t=this._inputGeometries.next();for(;t;){if(0===this._rotateAngle||"esriGeometryPoint"===t.geometryType)return t;if(t.totalSize>0){const e=(0,r.z8)(t),i=(e[2]+e[0])/2,s=(e[3]+e[1])/2;return t.reset(),this._rotate(t.clone(),i,s)}t=this._inputGeometries.next()}return null}_rotate(t,e,i){const r=Math.cos(this._rotateAngle),s=Math.sin(this._rotateAngle);for(;t.nextPath();)for(;t.nextPoint();){const n=t.x-e,o=t.y-i;t.x=e+n*r-o*s,t.y=i+n*s+o*r}return t.reset(),t}}},79323:function(t,e,i){i.d(e,{W:function(){return s}});var r=i(35068);class s{static local(){return null===s.instance&&(s.instance=new s),s.instance}execute(t,e,i,r,s){return new n(t,e,i)}}s.instance=null;class n{constructor(t,e,i){this._inputGeometries=t,this._xFactor=void 0!==e.xScaleFactor?e.xScaleFactor:1.15,this._yFactor=void 0!==e.yScaleFactor?e.yScaleFactor:1.15}next(){const t=this._inputGeometries.next();if(t){if(1===this._xFactor&&1===this._yFactor)return t;if("esriGeometryPoint"===t.geometryType)return t;if(t.totalSize>0){const e=(0,r.z8)(t),i=(e[2]+e[0])/2,s=(e[3]+e[1])/2;return t.reset(),this._scaleCursor(t.clone(),i,s)}}return null}_scaleCursor(t,e,i){for(;t.nextPath();)for(;t.nextPoint();)t.x=e+(t.x-e)*this._xFactor,t.y=i+(t.y-i)*this._yFactor;return t.reset(),t}}},34476:function(t,e,i){i.d(e,{l:function(){return o}});var r=i(33134),s=i(33389),n=i(65661);class o{static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(t,e,i,r,s){return new a(t,e,i)}}o.instance=null;class a{constructor(t,e,i){this._inputGeometries=t,this._height=(void 0!==e.amplitude?e.amplitude:2)*i,this._period=(void 0!==e.period?e.period:3)*i,this._style=e.waveform,this._height<=0&&(this._height=Math.abs(this._height)),this._period<=0&&(this._period=Math.abs(this._period)),this._pattern=new n.VA,this._pattern.addValue(this._period),this._pattern.addValue(this._period),this._walker=new n.Z1,this._walker.updateTolerance(i)}next(){let t=this._inputGeometries.next();for(;t;){if(0===this._height||0===this._period)return t;const e=this._processGeom(t);if(e)return e;t=this._inputGeometries.next()}return null}_processGeom(t){const e=r.z.createEmptyOptimizedCIM(t.geometryType);for(;t.nextPath();){e.startPath();const i=t.pathLength();if(this._walker.init(t,this._pattern))switch(this._style){case s.WE.Sinus:default:this._constructCurve(e,i,!1);break;case s.WE.Square:this._constructSquare(e,i);break;case s.WE.Triangle:this._constructTriangle(e,i);break;case s.WE.Random:this._constructCurve(e,i,!0)}else for(;t.nextPoint();)e.pushXY(t.x,t.y)}return e}_constructCurve(t,e,i){let r=Math.round(e/this._period);0===r&&(r=1);const s=16*r+1,o=e/r,a=this._period/16,l=1/s,h=2*Math.PI*e/o,c=2*Math.PI*Math.random(),u=2*Math.PI*Math.random(),d=2*Math.PI*Math.random(),f=.75-Math.random()/2,p=.75-Math.random()/2,m=new n.ps;this._walker.curPointAndAngle(m),t.pushPoint(m.pt);let g=0;for(;;){if(!this._walker.nextPointAndAngle(a,m)){t.pushPoint(this._walker.getPathEnd());break}{const e=g;let r;if(g+=l,i){const t=this._height/2*(1+.3*Math.sin(f*h*e+c));r=t*Math.sin(h*e+u),r+=t*Math.sin(p*h*e+d),r/=2}else r=.5*this._height*Math.sin(.5*h*e);t.pushXY(m.pt[0]-r*m.sa,m.pt[1]+r*m.ca)}}}_constructSquare(t,e){Math.round(e/this._period);let i=!0;for(;;){let e=!1;if(this._walker.curPositionIsValid()){const r=new n.ps;this._walker.curPointAndAngle(r);const s=new n.ps;if(this._walker.nextPointAndAngle(this._period,s)){const o=new n.ps;this._walker.nextPointAndAngle(this._period,o)&&(i?(t.pushPoint(r.pt),i=!1):t.pushPoint(r.pt),t.pushXY(r.pt[0]-this._height/2*r.sa,r.pt[1]+this._height/2*r.ca),t.pushXY(s.pt[0]-this._height/2*s.sa,s.pt[1]+this._height/2*s.ca),t.pushXY(s.pt[0]+this._height/2*s.sa,s.pt[1]-this._height/2*s.ca),t.pushXY(o.pt[0]+this._height/2*o.sa,o.pt[1]-this._height/2*o.ca),e=!0)}}if(!e){t.pushPoint(this._walker.getPathEnd());break}}}_constructTriangle(t,e){Math.round(e/this._period);let i=!0;for(;;){let e=!1;if(this._walker.curPositionIsValid()){const r=new n.ps;this._walker.curPointAndAngle(r);const s=new n.ps;if(this._walker.nextPointAndAngle(this._period/2,s)){const o=new n.ps;this._walker.nextPointAndAngle(this._period,o)&&(this._walker.nextPosition(this._period/2)&&(i?(t.pushPoint(r.pt),i=!1):t.pushPoint(r.pt),t.pushXY(s.pt[0]-this._height/2*s.sa,s.pt[1]+this._height/2*s.ca),t.pushXY(o.pt[0]+this._height/2*o.sa,o.pt[1]-this._height/2*o.ca)),e=!0)}}if(!e){t.pushPoint(this._walker.getPathEnd());break}}}}},31771:function(t,e,i){i.d(e,{e:function(){return o}});var r=i(23454),s=i(33389),n=i(65661);class o{static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(t,e,i,r,s){return new a(t,e,i)}}o.instance=null;class a extends r.pC{constructor(t,e,i){super(t),this._geometryWalker=new n.Z1,this._geometryWalker.updateTolerance(i),this._angleToLine=e.angleToLine??!0,this._offset=(e.offset?e.offset:0)*i,this._originalEndings=e.endings,this._offsetAtEnd=(e.customEndingOffset?e.customEndingOffset:0)*i,this._position=-(e.offsetAlongLine?e.offsetAlongLine:0)*i,this._pattern=new n.VA,this._pattern.init(e.placementTemplate,!1),this._pattern.scale(i),this._endings=this._originalEndings}processPath(t){if(this._pattern.isEmpty())return null;let e;if(this.iteratePath)e=this._pattern.nextValue();else{this._originalEndings===s.e_.WithFullGap&&this.isClosed?this._endings=s.e_.WithMarkers:this._endings=this._originalEndings,this._pattern.extPtGap=0;let i,r=!0;switch(this._endings){case s.e_.NoConstraint:i=-this._position,i=this._adjustPosition(i),r=!1;break;case s.e_.WithHalfGap:default:i=-this._pattern.lastValue()/2;break;case s.e_.WithFullGap:i=-this._pattern.lastValue(),this._pattern.extPtGap=this._pattern.lastValue();break;case s.e_.WithMarkers:i=0;break;case s.e_.Custom:i=-this._position,i=this._adjustPosition(i),this._pattern.extPtGap=.5*this._offsetAtEnd}if(!this._geometryWalker.init(t,this._pattern,r))return null;this._pattern.reset();let n=0;for(;i>n;)i-=n,n=this._pattern.nextValue();n-=i,e=n,this.iteratePath=!0}const i=new n.ps;return this._geometryWalker.nextPointAndAngle(e,i)?this._endings===s.e_.WithFullGap&&this._geometryWalker.isPathEnd()?(this.iteratePath=!1,null):this._endings===s.e_.WithMarkers&&this._geometryWalker.isPathEnd()&&(this.iteratePath=!1,this.isClosed)?null:(this.internalPlacement.setTranslate(i.pt[0]-this._offset*i.sa,i.pt[1]+this._offset*i.ca),this._angleToLine&&this.internalPlacement.setRotateCS(i.ca,i.sa),this.internalPlacement):(this.iteratePath=!1,null)}_adjustPosition(t){let e=t/this._pattern.length();return e-=Math.floor(e),e*this._pattern.length()}}},15987:function(t,e,i){i.d(e,{y:function(){return o}});var r=i(23454),s=i(93996),n=i(33389);class o{static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(t,e,i,r,s){return new a(t,e,i)}}o.instance=null;class a extends r.pC{constructor(t,e,i){super(t,!1,!0),this._curveHelper=new s.I,this._placePerPart=e.placePerPart??!1,this._angleToLine=void 0===e.angleToLine||e.angleToLine,this._offset=void 0!==e.offset?e.offset*i:0,this._type=e.extremityPlacement,this._position=void 0!==e.offsetAlongLine?e.offsetAlongLine*i:0,this._beginProcessed=!1}processMultiPath(t){return this._placePerPart?super.processMultiPath(t):this.processPath(t)}processPath(t){let e;switch(this._type){case n.$2.Both:default:this._beginProcessed?(e=this._atExtremities(t,this._position,!1),this._beginProcessed=!1,this.iterateMultiPath=!1,this.iteratePath=!1):(e=this._atExtremities(t,this._position,!0),this._beginProcessed=!0,this.iterateMultiPath=!0,this.iteratePath=!0);break;case n.$2.JustBegin:e=this._atExtremities(t,this._position,!0);break;case n.$2.JustEnd:e=this._atExtremities(t,this._position,!1);case n.$2.None:}return e}_atExtremities(t,e,i){if(this._placePerPart||(i?t.seekPath(0):t.seekPath(t.totalSize-1)),i||t.seekPathEnd(),i?t.nextPoint():t.prevPoint()){let r=0,[s,n]=[0,0],[o,a]=[t.x,t.y];for(;i?t.nextPoint():t.prevPoint();){s=o,n=a,o=t.x,a=t.y;const i=this._curveHelper.getLength(s,n,o,a);if(r+i>e){const t=(e-r)/i,[l,h]=this._curveHelper.getAngleCS(s,n,o,a,t),c=this._curveHelper.getCoord2D(s,n,o,a,t);return this.internalPlacement.setTranslate(c[0]-this._offset*h,c[1]+this._offset*l),this._angleToLine&&this.internalPlacement.setRotateCS(-l,-h),this.internalPlacement}r+=i}}return null}}},19511:function(t,e,i){i.d(e,{S:function(){return n}});var r=i(23454),s=i(65661);class n{static local(){return null===n.instance&&(n.instance=new n),n.instance}execute(t,e,i,r,s){return new o(t,e,i)}}n.instance=null;class o extends r.pC{constructor(t,e,i){super(t),this._walker=new s.Z1,this._walker.updateTolerance(i),this._angleToLine=void 0===e.angleToLine||e.angleToLine,this._offset=void 0!==e.offset?e.offset*i:0,this._beginGap=void 0!==e.beginPosition?e.beginPosition*i:0,this._endGap=void 0!==e.endPosition?e.endPosition*i:0,this._flipFirst=void 0===e.flipFirst||e.flipFirst,this._pattern=new s.VA,this._pattern.init(e.positionArray,!1,!1),this._subPathLen=0,this._posCount=this._pattern.size(),this._isFirst=!0,this._prevPos=0}processPath(t){if(this._pattern.isEmpty())return null;let e;if(this.iteratePath){const t=this._pattern.nextValue()*this._subPathLen,i=this._beginGap+t;e=i-this._prevPos,this._prevPos=i}else{if(this._posCount=this._pattern.size(),this._isFirst=!0,this._prevPos=0,this._subPathLen=t.pathLength()-this._beginGap-this._endGap,this._subPathLen<0)return this.iteratePath=!1,null;if(!this._walker.init(t,this._pattern,!1))return null;this._pattern.reset();const i=this._pattern.nextValue()*this._subPathLen,r=this._beginGap+i;e=r-this._prevPos,this._prevPos=r,this.iteratePath=!0}const i=new s.ps;if(!this._walker.nextPointAndAngle(e,i,s.YQ.END))return this.iteratePath=!1,null;this.internalPlacement.setTranslate(i.pt[0]-this._offset*i.sa,i.pt[1]+this._offset*i.ca);const r=this._isFirst&&this._flipFirst;let n,o;return this._angleToLine?(n=i.ca,o=i.sa):(n=1,o=0),r&&(n=-n,o=-o),this.internalPlacement.setRotateCS(n,o),this._isFirst=!1,this._posCount--,0===this._posCount&&(this.iteratePath=!1),this.internalPlacement}}},20305:function(t,e,i){i.d(e,{M:function(){return h}});var r=i(13798),s=i(29076),n=i(33389);const o=512,a=24,l=1e-6;class h{static local(){return null===h.instance&&(h.instance=new h),h.instance}execute(t,e,i,r,s){return new c(t,e,i,r,s)}}h.instance=null;class c{constructor(t,e,i,a,l){if(this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,this._currentX=0,this._currentY=0,this._accelerationMap=null,this._testInsidePolygon=!1,this._verticalSubdivision=!0,this._stepX=Math.abs(e.stepX??16)*i,this._stepY=Math.abs(e.stepY??16)*i,this._stepX=Math.round(128*this._stepX)/128,this._stepY=Math.round(128*this._stepY)/128,0!==this._stepX&&0!==this._stepY){if(this._gridType=e.gridType??n.Q1.Fixed,this._gridType===n.Q1.Random){const t=e.seed??13,i=1;this._randomLCG=new r.A(t*i),this._randomness=(e.randomness??100)/100,this._gridAngle=0,this._shiftOddRows=!1,this._cosAngle=1,this._sinAngle=0,this._offsetX=0,this._offsetY=0,this._buildRandomValues()}else{if(this._randomness=0,this._gridAngle=e.gridAngle??0,this._shiftOddRows=e.shiftOddRows??!1,this._offsetX=(e.offsetX??0)*i,this._offsetY=(e.offsetY??0)*i,this._cosAngle=Math.cos(this._gridAngle/180*Math.PI),this._sinAngle=-Math.sin(this._gridAngle/180*Math.PI),this._stepX)if(this._offsetX<0)for(;this._offsetX<-.5*this._stepX;)this._offsetX+=this._stepX;else for(;this._offsetX>=.5*this._stepX;)this._offsetX-=this._stepX;if(this._stepY)if(this._offsetY<0)for(;this._offsetY<-.5*this._stepY;)this._offsetY+=this._stepY;else for(;this._offsetY>=.5*this._stepY;)this._offsetY-=this._stepY}if(this._graphicOriginX=0,this._graphicOriginY=0,null!=a){const[t,e,i,r]=a.split("/"),s=parseFloat(t),n=parseFloat(e),l=parseFloat(i),h=parseFloat(r);this._graphicOriginX=-(h*2**s+l)*o,this._graphicOriginY=n*o,this._testInsidePolygon=!0}this._internalPlacement=new s.W,this._calculateMinMax(t),this._geometryCursor=t}}next(){return this._geometryCursor?this._nextInside():null}_buildRandomValues(){if(!c._randValues){c._randValues=[];for(let t=0;t<a;t++)for(let t=0;t<a;t++)c._randValues.push(this._randomLCG.getFloat()),c._randValues.push(this._randomLCG.getFloat())}}_calculateMinMax(t){let e,i,r,s,n,a,l,h,c,u,d,f,p,m;this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,l=h=p=d=Number.MAX_VALUE,c=u=m=f=-Number.MAX_VALUE;const g=1!==this._cosAngle;for(t.reset();t.nextPath();)for(;t.nextPoint();)a=t.x,n=t.y,e=a-this._graphicOriginX-this._offsetX,i=n-this._graphicOriginY-this._offsetY,g?(r=this._cosAngle*e-this._sinAngle*i,s=this._sinAngle*e+this._cosAngle*i):(r=e,s=i),l=Math.min(l,r),c=Math.max(c,r),h=Math.min(h,s),u=Math.max(u,s),d=Math.min(d,n),f=Math.max(f,n),p=Math.min(p,a),m=Math.max(m,a);d=d!==Number.MAX_VALUE?d:-o-this._stepY,f=f!==-Number.MAX_VALUE?f:this._stepY,p=p!==Number.MAX_VALUE?p:-this._stepX,m=m!==-Number.MAX_VALUE?m:o+this._stepX;const _=f-d,y=m-p;if(this._verticalSubdivision=_>=y,this._polygonMin=this._verticalSubdivision?d:p,this._testInsidePolygon){let t=0-this._graphicOriginX-this._offsetX-this._stepX,e=o-this._graphicOriginX-this._offsetX+this._stepX,i=-o-this._graphicOriginY-this._offsetY-this._stepY,r=0-this._graphicOriginY-this._offsetY+this._stepY;if(g){const s=[[t,i],[t,r],[e,i],[e,r]];t=i=Number.MAX_VALUE,e=r=-Number.MAX_VALUE;for(const n of s){const s=this._cosAngle*n[0]-this._sinAngle*n[1],o=this._sinAngle*n[0]+this._cosAngle*n[1];t=Math.min(t,s),e=Math.max(e,s),i=Math.min(i,o),r=Math.max(r,o)}}l=l!==Number.MAX_VALUE?Math.max(l,t):t,h=h!==Number.MAX_VALUE?Math.max(h,i):i,c=c!==-Number.MAX_VALUE?Math.min(c,e):e,u=u!==-Number.MAX_VALUE?Math.min(u,r):r}this._xMin=Math.round(l/this._stepX),this._xMax=Math.round(c/this._stepX),this._yMin=Math.round(h/this._stepY),this._yMax=Math.round(u/this._stepY),this._currentX=this._xMax+1,this._currentY=this._yMin-1,this._buildAccelerationMap(t,p,m,d,f)}_buildAccelerationMap(t,e,i,r,s){t.reset();const n=new Map,a=this._verticalSubdivision,l=a?s-r:i-e;let h=Math.ceil(l/10);if(h<=1)return;const c=Math.floor(l/h);let d,f,p,m,g,_,y,v,x,b,w;for(h++,this._delta=c,a?(x=-o-2*this._stepY,b=2*this._stepY,w=r):(x=-2*this._stepX,b=o+2*this._stepX,w=e);t.nextPath();)if(!(t.pathSize<2)&&t.nextPoint())for(d=t.x,f=t.y;t.nextPoint();d=p,f=m){if(p=t.x,m=t.y,a){if(f===m||f<x&&m<x||f>b&&m>b)continue;g=Math.min(f,m),_=Math.max(f,m)}else{if(d===p||d<x&&p<x||d>b&&p>b)continue;g=Math.min(d,p),_=Math.max(d,p)}for(;g<_;)y=Math.floor((g-w)/c),u(y,d,f,p,m,n),g+=c;v=Math.floor((_-w)/c),v>y&&u(v,d,f,p,m,n)}this._accelerationMap=n}_nextInside(){for(;;){if(this._currentX>this._xMax){if(this._currentY++,this._currentY>this._yMax)return null;this._currentX=this._xMin,this._shiftOddRows&&this._currentY%2&&this._currentX--}let t=this._currentX*this._stepX+this._offsetX;this._shiftOddRows&&this._currentY%2&&(t+=.5*this._stepX);const e=this._currentY*this._stepY+this._offsetY;let i,r;if(this._currentX++,this._gridType===n.Q1.Random){const s=(this._currentX%a+a)%a,n=(this._currentY%a+a)%a;i=this._graphicOriginX+t+this._stepX*this._randomness*(.5-c._randValues[n*a+s])*2/3,r=this._graphicOriginY+e+this._stepY*this._randomness*(.5-c._randValues[n*a+s+1])*2/3}else i=this._graphicOriginX+this._cosAngle*t+this._sinAngle*e,r=this._graphicOriginY-this._sinAngle*t+this._cosAngle*e;if(!this._testInsidePolygon||this._isInsidePolygon(i,r,this._geometryCursor))return this._internalPlacement.setTranslate(i,r),this._internalPlacement}}_isInsidePolygon(t,e,i){if(null==this._accelerationMap)return function(t,e,i){let r,s,n,o,a=0;for(t+=l,e+=l,i.reset();i.nextPath();)if(i.nextPoint())for(r=i.x,s=i.y;i.nextPoint();r=n,s=o)n=i.x,o=i.y,s>e!=o>e&&((n-r)*(e-s)-(o-s)*(t-r)>0?a++:a--);return 0!==a}(t,e,i);t+=l,e+=l;const r=this._verticalSubdivision,s=r?e:t,n=Math.floor((s-this._polygonMin)/this._delta),o=this._accelerationMap.get(n);if(!o)return!1;let a,h,c,u=0;for(const i of o){if(a=i[0],h=i[1],r){if(a[1]>e==h[1]>e)continue;c=(h[0]-a[0])*(e-a[1])-(h[1]-a[1])*(t-a[0])}else{if(a[0]>t==h[0]>t)continue;c=(h[1]-a[1])*(t-a[0])-(h[0]-a[0])*(e-a[1])}c>0?u++:u--}return 0!==u}}function u(t,e,i,r,s,n){let o=n.get(t);o||(o=[],n.set(t,o)),o.push([[e,i],[r,s]])}},58892:function(t,e,i){i.d(e,{R:function(){return o}});var r=i(23454),s=i(93996),n=i(33389);class o{static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(t,e,i,r,s){return new a(t,e,i)}}o.instance=null;class a extends r.pC{constructor(t,e,i){super(t),this._curveHelper=new s.I,this._angleToLine=void 0===e.angleToLine||e.angleToLine,this._offset=void 0!==e.offset?e.offset*i:0,this._relativeTo=e.relativeTo,this._position=void 0!==e.startPointOffset?e.startPointOffset*i:0,this._epsilon=.001*i}processPath(t){const e=this._position;if(this._relativeTo===n.ip.SegmentMidpoint){if(this.iteratePath||(this.iteratePath=!0),t.nextPoint()){let[e,i]=[t.x,t.y],[r,s]=[0,0];for(;t.nextPoint();){r=t.x,s=t.y;const n=this._curveHelper.getLength(e,i,r,s);if(n<this._epsilon){e=r,i=s;continue}const o=.5+this._position/n,[a,l]=this._curveHelper.getAngleCS(e,i,r,s,o),h=this._curveHelper.getCoord2D(e,i,r,s,o);return this.internalPlacement.setTranslate(h[0]-this._offset*l,h[1]+this._offset*a),this._angleToLine&&this.internalPlacement.setRotateCS(a,l),this.internalPlacement}}return this.iteratePath=!1,null}const i=this._relativeTo===n.ip.LineEnd;return this.onLine(t,e,i)}onLine(t,e,i){let r,s=!1;switch(this._relativeTo){case n.ip.LineMiddle:default:t.seekPathStart(),r=t.pathLength()/2+e;break;case n.ip.LineBeginning:r=e;break;case n.ip.LineEnd:r=e,s=!0}i?t.seekPathEnd():t.seekPathStart();let o=0;if(i?t.prevPoint():t.nextPoint()){let[e,n]=[t.x,t.y],[a,l]=[0,0];for(;i?t.prevPoint():t.nextPoint();){a=t.x,l=t.y;const i=this._curveHelper.getLength(e,n,a,l);if(o+i>r){const t=(r-o)/i,[h,c]=this._curveHelper.getAngleCS(e,n,a,l,t),u=this._curveHelper.getCoord2D(e,n,a,l,t),d=s?-this._offset:this._offset;return this.internalPlacement.setTranslate(u[0]-d*c,u[1]+d*h),this._angleToLine&&(s?this.internalPlacement.setRotateCS(-h,-c):this.internalPlacement.setRotateCS(h,c)),this.internalPlacement}e=a,n=l,o+=i}}return null}}},80585:function(t,e,i){i.d(e,{A:function(){return n}});var r=i(23454),s=i(93996);class n{static local(){return null===n.instance&&(n.instance=new n),n.instance}execute(t,e,i,r,s){return new o(t,e,i)}}n.instance=null;class o extends r.pC{constructor(t,e,i){super(t),this._curveHelper=new s.I,this._angleToLine=void 0===e.angleToLine||e.angleToLine,this._offset=void 0!==e.offset?e.offset*i:0,this._endPoints=void 0===e.placeOnEndPoints||e.placeOnEndPoints,this._controlPoints=void 0===e.placeOnControlPoints||e.placeOnControlPoints,this._regularVertices=void 0===e.placeOnRegularVertices||e.placeOnRegularVertices,this._tags=[],this._tagIterator=0}processPath(t){if(this.iteratePath||(this._preparePath(t),this.iteratePath=!0),this._tagIterator>=this._tags.length)return this._tags.length=0,this._tagIterator=0,this.iteratePath=!1,null;const e=this._tags[this._tagIterator];this._angleToLine&&this.internalPlacement.setRotate(e[2]);let i=e[0],r=e[1];if(0!==this._offset){const t=Math.cos(e[2]),s=Math.sin(e[2]);i-=this._offset*s,r+=this._offset*t}return this.internalPlacement.setTranslate(i,r),this._tagIterator++,this.internalPlacement}_preparePath(t){this._tags.length=0,this._tagIterator=0,t.seekPathStart();const e=t.isClosed();let i=0,r=!1,s=0,n=0;if(t.seekPathStart(),t.nextPoint()){let o=t.x,l=t.y,h=t.getControlPoint(),c=!0,u=t.nextPoint();for(;u;){const d=t.x,f=t.y,p=t.getControlPoint();(this._angleToLine||0!==this._offset)&&(s=this._curveHelper.getAngle(o,l,d,f,0)),c?(c=!1,e?(i=s,r=h):(this._endPoints||this._controlPoints&&h)&&this._tags.push([o,l,s])):h?this._controlPoints&&this._tags.push([o,l,a(n,s)]):this._regularVertices&&this._tags.push([o,l,a(n,s)]),(this._angleToLine||0!==this._offset)&&(n=this._curveHelper.getAngle(o,l,d,f,1)),u=t.nextPoint(),u||(e?p||r?this._controlPoints&&this._tags.push([d,f,a(n,i)]):this._regularVertices&&this._tags.push([d,f,a(n,i)]):(this._endPoints||this._controlPoints&&p)&&this._tags.push([d,f,n])),o=d,l=f,h=p}}this._tagIterator=0}}function a(t,e){const i=Math.PI;for(;Math.abs(e-t)>i+2e-15;)e-t>i?e-=2*i:e+=2*i;return(t+e)/2}},58676:function(t,e,i){i.d(e,{L:function(){return l}});var r=i(35068),s=i(72228),n=i(30804),o=i(29076),a=i(33389);class l{static local(){return null===l.instance&&(l.instance=new l),l.instance}execute(t,e,i,r,s){return new h(t,e,i)}}l.instance=null;class h{constructor(t,e,i){this._geometryCursor=t,this._offsetX=void 0!==e.offsetX?e.offsetX*i:0,this._offsetY=void 0!==e.offsetY?e.offsetY*i:0,this._method=void 0!==e.method?e.method:a.YI.OnPolygon,this._placementPerPart=void 0!==e.placePerPart&&e.placePerPart,this._internalPlacement=new o.W}next(){const t=this._geometryCursor;if(!t)return null;if(!this._placementPerPart)return this._geometryCursor=null,this._polygonCenter(t);for(;t.nextPath();)if(!(t.getCurrentRingArea()<0))return this._polygonCenter(t.getCurrentPath());return this._geometryCursor=null,null}_polygonCenter(t){let e=!1;switch(this._method){case a.YI.CenterOfMass:{const i=(0,s.TP)(t);i&&(this._internalPlacement.setTranslate(i[0]+this._offsetX,i[1]+this._offsetY),e=!0)}break;case a.YI.BoundingBoxCenter:{const i=(0,r.z8)(t);i&&(this._internalPlacement.setTranslate((i[2]+i[0])/2+this._offsetX,(i[3]+i[1])/2+this._offsetY),e=!0)}break;case a.YI.OnPolygon:default:{const i=(0,n.d)(t);null!==i&&(this._internalPlacement.setTranslate(i[0]+this._offsetX,i[1]+this._offsetY),e=!0)}}return e?this._internalPlacement:null}}},77927:function(t,e,i){i.d(e,{Fe:function(){return u},Km:function(){return n},Nk:function(){return l}});var r=i(52874),s=i(7590);function n(t,e,i,r){if(t)if("CIMTextSymbol"!==t.type){if(i&&t.effects)for(const i of t.effects)a(i,e);if(t.symbolLayers)for(const i of t.symbolLayers)switch(i.type){case"CIMPictureMarker":case"CIMVectorMarker":o(i,e,r);break;case"CIMPictureStroke":case"CIMSolidStroke":!r?.preserveOutlineWidth&&i.width&&(i.width*=e);break;case"CIMPictureFill":i.height&&(i.height*=e),i.offsetX&&(i.offsetX*=e),i.offsetY&&(i.offsetY*=e);break;case"CIMHatchFill":n(i.lineSymbol,e,!0,{...r,preserveOutlineWidth:!1}),i.offsetX&&(i.offsetX*=e),i.offsetY&&(i.offsetY*=e),i.separation&&(i.separation*=e)}}else null!=t.height&&(t.height*=e)}function o(t,e,i){if(t&&(t.markerPlacement&&function(t,e){switch((0,s.zr)(t)&&t.offset&&(t.offset*=e),t.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(t.customEndingOffset&&(t.customEndingOffset*=e),t.offsetAlongLine&&(t.offsetAlongLine*=e),t.placementTemplate&&t.placementTemplate.length){const i=t.placementTemplate.map((t=>t*e));t.placementTemplate=i}break;case"CIMMarkerPlacementAlongLineVariableSize":if(t.maxRandomOffset&&(t.maxRandomOffset*=e),t.placementTemplate&&t.placementTemplate.length){const i=t.placementTemplate.map((t=>t*e));t.placementTemplate=i}break;case"CIMMarkerPlacementOnLine":t.startPointOffset&&(t.startPointOffset*=e);break;case"CIMMarkerPlacementAtExtremities":t.offsetAlongLine&&(t.offsetAlongLine*=e);break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":t.beginPosition&&(t.beginPosition*=e),t.endPosition&&(t.endPosition*=e);break;case"CIMMarkerPlacementPolygonCenter":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e);break;case"CIMMarkerPlacementInsidePolygon":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e),t.stepX&&(t.stepX*=e),t.stepY&&(t.stepY*=e)}}(t.markerPlacement,e),t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e),t.anchorPoint&&"Absolute"===t.anchorPointUnits&&(t.anchorPoint={x:t.anchorPoint.x*e,y:t.anchorPoint.y*e}),t.size=null!=t.size?t.size*e:0,"CIMVectorMarker"===t.type&&t.markerGraphics))for(const r of t.markerGraphics)t.scaleSymbolsProportionally||n(r.symbol,e,!0,i)}function a(t,e){switch(t.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":t.width&&(t.width*=e);break;case"CIMGeometricEffectBuffer":t.size&&(t.size*=e);break;case"CIMGeometricEffectCut":t.beginCut&&(t.beginCut*=e),t.endCut&&(t.endCut*=e),t.middleCut&&(t.middleCut*=e);break;case"CIMGeometricEffectDashes":if(t.customEndingOffset&&(t.customEndingOffset*=e),t.offsetAlongLine&&(t.offsetAlongLine*=e),t.dashTemplate&&t.dashTemplate.length){const i=t.dashTemplate.map((t=>t*e));t.dashTemplate=i}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":t.length&&(t.length*=e);break;case"CIMGeometricEffectMove":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e);break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":t.offset&&(t.offset*=e);break;case"CIMGeometricEffectRegularPolygon":t.radius&&(t.radius*=e);break;case"CIMGeometricEffectTaperedPolygon":t.fromWidth&&(t.fromWidth*=e),t.length&&(t.length*=e),t.toWidth&&(t.toWidth*=e);break;case"CIMGeometricEffectWave":t.amplitude&&(t.amplitude*=e),t.period&&(t.period*=e)}}function l(t){const e=[];return h((0,s.lW)(t),e),e.length?new r.A((0,s.e6)(e[0])):null}function h(t,e){if(!t)return;let i;i="CIMTextSymbol"===t.type?t.symbol:t;const r="CIMPolygonSymbol"===t.type;if(i?.symbolLayers)for(const t of i.symbolLayers)if(!(t.colorLocked||r&&((0,s.mA)(t)||(0,s.MM)(t)&&t.markerPlacement&&(0,s.zr)(t.markerPlacement))))switch(t.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":t.tintColor&&c(e,t.tintColor);break;case"CIMVectorMarker":t.markerGraphics?.forEach((t=>{h(t.symbol,e)}));break;case"CIMSolidStroke":case"CIMSolidFill":c(e,t.color);break;case"CIMHatchFill":h(t.lineSymbol,e)}}function c(t,e){for(const i of t)if(i.join(".")===e.join("."))return;t.push(e)}function u(t,e,i){e instanceof r.A||(e=new r.A(e));const n=(0,s.lW)(t);n&&d(n,e,i)}function d(t,e,i){if(!t)return;let r;r="CIMTextSymbol"===t.type?t.symbol:t;const n="CIMPolygonSymbol"===r?.type;if(r?.symbolLayers)for(const t of r.symbolLayers){if(t.colorLocked)continue;if(n)if(i){const{layersToColor:e}=i;if(((0,s.mA)(t)||(0,s.MM)(t)&&t.markerPlacement&&(0,s.zr)(t.markerPlacement))&&"fill"===e||(0,s.jn)(t)&&"outline"===e)continue}else if((0,s.mA)(t)||(0,s.MM)(t)&&t.markerPlacement&&(0,s.zr)(t.markerPlacement))continue;const r=e.toArray();switch(t.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":t.tintColor=r;break;case"CIMVectorMarker":t.markerGraphics?.forEach((t=>{d(t.symbol,e,i)}));break;case"CIMSolidStroke":case"CIMSolidFill":t.color=r;break;case"CIMHatchFill":d(t.lineSymbol,e,i)}}}},31827:function(t,e,i){i.d(e,{$4:function(){return v},O0:function(){return x},O1:function(){return b},Sw:function(){return w},eH:function(){return _},rc:function(){return y}});var r=i(53216),s=i(52874),n=i(93040),o=i(99680),a=i(13520),l=i(77927);const h="picture-fill",c="simple-fill",u="simple-line",d="simple-marker",f="text",p="cim",m=new Map([["dash",[4,3]],["dashdot",[4,3,1,3]],["dot",[1,3]],["longdash",[8,3]],["longdashdot",[8,3,1,3]],["longdashdotdot",[8,3,1,3,1,3]],["shortdash",[4,1]],["shortdashdot",[4,1,1,1]],["shortdashdotdot",[4,1,1,1,1,1]],["shortdot",[1,1]],["solid",[]]]),g=new o.q(1e3);function _(t){const e=t.style;let i=null;if(t)switch(t.type){case d:"cross"!==e&&"x"!==e&&(i=t.color);break;case c:e&&"solid"!==e?"none"!==e&&(i={type:"pattern",x:0,y:0,src:(0,r.s)(`esri/symbols/patterns/${e}.png`),width:5,height:5}):i=t.color;break;case h:i={type:"pattern",src:t.url,width:(0,a.Lz)(t.width)*t.xscale,height:(0,a.Lz)(t.height)*t.yscale,x:(0,a.Lz)(t.xoffset),y:(0,a.Lz)(t.yoffset)};break;case f:i=t.color;break;case p:i=(0,l.Nk)(t)}return i}function y(t,e){const i=t+"-"+e;return void 0!==g.get(i)?Promise.resolve(g.get(i)):(0,n.A)(t,{responseType:"image"}).then((t=>{const r=t.data,s=r.naturalWidth,n=r.naturalHeight,o=document.createElement("canvas");o.width=s,o.height=n;const a=o.getContext("2d");a.fillStyle=e,a.fillRect(0,0,s,n),a.globalCompositeOperation="destination-in",a.drawImage(r,0,0);const l=o.toDataURL();return g.put(i,l),l}))}function v(t){if(!t)return null;let e=null;switch(t.type){case c:case h:case d:e=v(t.outline);break;case u:{const i=(0,a.Lz)(t.width);null!=t.style&&"none"!==t.style&&0!==i&&(e={color:t.color,style:b(t.style),width:i,cap:t.cap,join:"miter"===t.join?(0,a.Lz)(t.miterLimit):t.join},e.dashArray=x(e).join(",")||"none");break}default:e=null}return e}function x(t){if(!t?.style)return[];const{dashArray:e,style:i,width:r}=t;if("string"==typeof e&&"none"!==e)return e.split(",").map((t=>Number(t)));const s=r??0,n=m.has(i)?m.get(i).map((t=>t*s)):[];if("butt"!==t.cap)for(const[t,e]of n.entries())n[t]=t%2==1?e+s:Math.max(e-s,1);return n}const b=(()=>{const t={};return e=>{if(t[e])return t[e];const i=e.replaceAll("-","");return t[e]=i,i}})(),w=new s.A([128,128,128])},89814:function(t,e,i){i.d(e,{$d:function(){return p},GG:function(){return P},N7:function(){return m},Sx:function(){return g},UQ:function(){return w},di:function(){return S},dt:function(){return y},f3:function(){return C},k_:function(){return f},yG:function(){return T}});var r=i(52874),s=i(10748),n=i(77472),o=(i(58941),i(13520)),a=i(32501),l=i(60318),h=i(77927),c=i(31827),u=i(13109);const d=new r.A("white");function f(t){if(!t)return 0;if((0,s.wk)(t)){const e=function(t){const e=t.symbolLayers?.at(-1);if(e&&"outline"in e)return e?.outline?.size}(t);return null!=e?e:0}return(0,o.PN)((0,c.$4)(t)?.width)}function p(t){if(null==t||!("symbolLayers"in t)||null==t.symbolLayers)return!1;switch(t.type){case"point-3d":return t.symbolLayers.some((t=>"object"===t.type));case"line-3d":return t.symbolLayers.some((t=>"path"===t.type));case"polygon-3d":return t.symbolLayers.some((t=>"object"===t.type||"extrude"===t.type));default:return!1}}function m(t){return t.resource?.href??""}function g(t,e){if(!t)return null;let i=null;return(0,s.wk)(t)?i=function(t){const e=t.symbolLayers;if(!e)return null;let i=null;return e.forEach((t=>{"object"===t.type&&t.resource?.href||(i="water"===t.type?t.color:t.material?t.material.color:null)})),i?new r.A(i):null}(t):(0,s.$y)(t)&&(i="cim"===t.type?(0,h.Nk)(t):t.color?new r.A(t.color):null),i?_(i,e):null}function _(t,e){if(null==e||null==t)return t;const i=t.toRgba();return i[3]=i[3]*e,new r.A(i)}function y(t,e,i){var n,o,a;t&&(e||null!=i)&&(e&&(e=new r.A(e)),(0,s.wk)(t)?function(t,e,i){const r=t.symbolLayers;if(!r)return;const s=t=>_(e=e??t??(null!=i?d:null),i);r.forEach((t=>{if("object"!==t.type||!t.resource?.href||e)if("water"===t.type)t.color=s(t.color);else{const e=null!=t.material?t.material.color:null,r=s(e);null==t.material?t.material=new u.N({color:r}):t.material.color=r,null!=i&&"outline"in t&&null!=t.outline?.color&&(t.outline.color=_(t.outline.color,i))}}))}(t,e,i):(0,s.$y)(t)&&(n=t,a=i,(o=(o=e)??n.color)&&(n.color=_(o,a)),null!=a&&"outline"in n&&n.outline?.color&&(n.outline.color=_(n.outline.color,a))))}function v(t){for(const e of t)if("number"==typeof e)return e;return null}function x(t,e,i){for(let r=0;r<3;r++){const s=t[r];switch(s){case"symbol-value":{const t=i[r];return null!=t?t/e[r]:1}case"proportional":break;default:if(s&&e[r])return s/e[r]}}return 1}function b(t,e,i,r){switch(t){case"proportional":return i*r;case"symbol-value":return null!=e?e:i;default:return t}}async function w(t,e){if(t&&e)return(0,s.wk)(t)?async function(t,e){const r=t.symbolLayers;r&&await(0,n.jJ)(r,(async t=>async function(t,e){switch(t.type){case"extrude":!function(t,e){t.size="number"==typeof e[2]?e[2]:0}(t,e);break;case"icon":case"line":case"text":!function(t,e){const i=v(e);null!=i&&(t.size=i)}(t,e);break;case"path":!function(t,e){const i=x(e,a.Un,[t.width,void 0,t.height]);t.width=b(e[0],t.width,1,i),t.height=b(e[2],t.height,1,i)}(t,e);break;case"object":await async function(t,e){const{resourceSize:r,symbolSize:s}=await async function(t){const{computeObjectLayerResourceSize:e}=await i.e(7269).then(i.bind(i,9141)),r=await e(t,10),{width:s,height:n,depth:o}=t,a=[s,o,n];let l=1;for(let t=0;t<3;t++){const e=a[t];if(null!=e){l=e/r[t];break}}for(let t=0;t<3;t++)null==a[t]&&(a[t]=r[t]*l);return{resourceSize:r,symbolSize:a}}(t),n=x(e,r,s);t.width=b(e[0],s[0],r[0],n),t.depth=b(e[1],s[1],r[1],n),t.height=b(e[2],s[2],r[2],n)}(t,e)}}(t,e)))}(t,e):void((0,s.$y)(t)&&function(t,e){const i=v(e);if(null!=i)switch(t.type){case"simple-marker":t.size=i;break;case"picture-marker":{const e=t.width/t.height;e>1?(t.width=i,t.height=i*e):(t.width=i*e,t.height=i);break}case"simple-line":t.width=i;break;case"text":t.font.size=i}}(t,e))}function P(t,e,i){if(t&&null!=e)if((0,s.wk)(t)){const r=t.symbolLayers;r&&r.forEach((t=>{if("object"===t.type)switch(i){case"tilt":t.tilt=(t.tilt??0)+e;break;case"roll":t.roll=(t.roll??0)+e;break;default:t.heading=(t.heading??0)+e}"icon"===t.type&&(t.angle+=e)}))}else(0,s.$y)(t)&&("simple-marker"!==t.type&&"picture-marker"!==t.type&&"text"!==t.type||(t.angle+=e))}function S(t){if(!t)return null;const e=t.effects.filter((t=>"bloom"!==t.type)).map((t=>t.toJSON()));return(0,l.zu)(e)}function C(t){return null!=t&&"polygon-3d"===t.type&&t.symbolLayers.some((t=>"extrude"===t.type))}async function T(t,e){return await t.fetchSymbol(e)||t.fetchCIMSymbol(e)}},27923:function(t,e,i){i.d(e,{I:function(){return m},p:function(){return p},resolveWebStyleSymbol:function(){return f}});var r=i(10748),s=i(14520),n=i(39819),o=i(90683),a=i(51432),l=i(60534),h=i(8404),c=i(48812),u=i(58916),d=i(11355);function f(t,e,i,r){const s=t.name;return null==s?Promise.reject(new n.A("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference")):"Esri2DPointSymbolsStyle"===t.styleName?function(t,e,i){const r=u.jg.replaceAll(/\{SymbolName\}/gi,t),s=null!=e.portal?e.portal:a.A.getDefault();return(0,u.yA)(r,i).then((t=>{const e=(0,u.bo)(t.data);return(0,h.rS)(e,{portal:s,url:(0,o.An)((0,o.nM)(r)),origin:"portal-item"})}))}(s,e,r):(0,u.cF)(t,e,r).then((t=>m(t,s,e,i,u.o5,r)))}function p(t,e){return e.items.find((e=>e.name===t))}function m(t,e,i,f,m,g){const _=null!=i?.portal?i.portal:a.A.getDefault(),y={portal:_,url:(0,o.An)(t.baseUrl),origin:"portal-item"},v=p(e,t.data);if(!v){const t=`The symbol name '${e}' could not be found`;return Promise.reject(new n.A("symbolstyleutils:symbol-name-not-found",t,{symbolName:e}))}let x=(0,l.f)(m(v,f),y),b=v.thumbnail?.href??null;const w=v.thumbnail?.imageData;(0,s.b5)()&&(x=(0,s.EM)(x)??"",b=(0,s.EM)(b));const P={portal:_,url:(0,o.An)((0,o.nM)(x)),origin:"portal-item"};return(0,u.yA)(x,g).then((s=>{const n="cimRef"===f?(0,u.bo)(s.data):s.data,o=(0,h.rS)(n,P);if(o&&(0,r.wk)(o)){if(b){const t=(0,l.f)(b,y);o.thumbnail=new d.V({url:t})}else w&&(o.thumbnail=new d.V({url:`data:image/png;base64,${w}`}));t.styleUrl?o.styleOrigin=new c.A({portal:i.portal,styleUrl:t.styleUrl,name:e}):t.styleName&&(o.styleOrigin=new c.A({portal:i.portal,styleName:t.styleName,name:e}))}return o}))}},16043:function(t,e,i){function r(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function s(){const t=r("svg");return t.setAttribute("style","position: absolute;"),t.setAttribute("width","0"),t.setAttribute("height","0"),t.setAttribute("aria-hidden","true"),t.setAttribute("role","presentation"),document.body.appendChild(t),t}function n(t){return null!=t&&document.body.removeChild(t),null}i.d(e,{FJ:function(){return r},p:function(){return s},pK:function(){return n}})},7056:function(t,e,i){i.d(e,{GW:function(){return g},IU:function(){return x},Jo:function(){return o},MG:function(){return n},Wh:function(){return d},cP:function(){return S},os:function(){return c},p6:function(){return m},pJ:function(){return a},ru:function(){return w},s3:function(){return b},w4:function(){return P},wV:function(){return p},yM:function(){return C},z0:function(){return f}});var r=i(38441),s=i(72139);const n=Number.POSITIVE_INFINITY,o=Math.PI,a=2*o,l=128/o,h=256/360,c=o/180,u=1/Math.LN2;function d(t,e){return(t%=e)>=0?t:t+e}function f(t){return d(t*l,256)}function p(t){return d(t*h,256)}function m(t){return Math.log(t)*u}function g(t,e,i){return t*(1-i)+e*i}const _=8,y=14,v=16;function x(t){return _+Math.max((t-y)*v,0)}function b(t,e,i){let r,s,n,o=0;for(const a of i){r=a.length;for(let i=1;i<r;++i)s=a[i-1],n=a[i],s.y>e!=n.y>e&&((n.x-s.x)*(e-s.y)-(n.y-s.y)*(t-s.x)>0?o++:o--)}return 0!==o}function w(t,e,i,s){let n,o,a,l;const h=s*s;for(const s of i){const i=s.length;if(!(i<2)){n=s[0].x,o=s[0].y;for(let c=1;c<i;++c){if(a=s[c].x,l=s[c].y,(0,r.Ng)(t,e,n,o,a,l)<h)return!0;n=a,o=l}}}return!1}function P(t,e,i,r,s,n,o){const a=Math.max(r,Math.min(e,n))-e,l=Math.max(s,Math.min(i,o))-i;return a*a+l*l<=t*t}function S(t,e){if(0===e||Number.isNaN(e))return t;const i=[],r=new s.bR(0,0),n=new s.bR(0,0),o=new s.bR(0,0);for(let a=0;a<t.length;a++){const l=t[a],h=[];for(let t=0;t<l.length;t++){const i=l[t-1],a=l[t],c=l[t+1];0===t?r.setCoords(0,0):r.assignSub(a,i).normalize().rightPerpendicular(),t===l.length-1?n.setCoords(0,0):n.assignSub(c,a).normalize().rightPerpendicular(),o.assignAdd(r,n).normalize();const u=o.x*n.x+o.y*n.y;0!==u&&o.scale(1/u),h.push(s.bR.add(a,o.scale(e)))}i.push(h)}return i}function C(t,e,i,r){const n=new s.bR(t[0],t[1]);if(n.scale(r),"viewport"===e){const t=-i*(Math.PI/180),e=Math.cos(t),r=Math.sin(t);n.rotate(e,r)}return n}},54904:function(t,e,i){i.d(e,{A:function(){return r}});class r{constructor(t=0,e=0,i=0,r=0){this.x=t,this.y=e,this.width=i,this.height=r}get isEmpty(){return this.width<=0||this.height<=0}union(t){this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.width=Math.max(this.width,t.width),this.height=Math.max(this.height,t.height)}}},96564:function(t,e,i){i.d(e,{Dy:function(){return d},UD:function(){return h},fO:function(){return c},gy:function(){return o},iT:function(){return u},xy:function(){return l}});var r=i(40633);const s=()=>r.A.getLogger("esri.views.2d.engine.webgl.alignmentUtils");var n,o,a;function l(t){if(!t)return n.Center;switch(t){case"Left":case"left":return n.Left;case"Right":case"right":return n.Right;case"Justify":return s().warnOnce("Horizontal alignment 'justify' is not implemented. Falling back to 'center'."),n.Center;case"Center":case"center":return n.Center}}function h(t){if(!t)return o.Center;switch(t){case"Top":case"top":return o.Top;case"Center":case"middle":return o.Center;case"Baseline":case"baseline":return o.Baseline;case"Bottom":case"bottom":return o.Bottom}}function c(t){switch(t){case"above-left":case"esriServerPointLabelPlacementAboveLeft":return["right","bottom"];case"above-center":case"above-along":case"esriServerPointLabelPlacementAboveCenter":case"esriServerLinePlacementAboveAlong":return["center","bottom"];case"above-right":case"esriServerPointLabelPlacementAboveRight":return["left","bottom"];case"center-left":case"esriServerPointLabelPlacementCenterLeft":return["right","middle"];case"center-center":case"center-along":case"esriServerPointLabelPlacementCenterCenter":case"esriServerLinePlacementCenterAlong":case"always-horizontal":case"esriServerPolygonPlacementAlwaysHorizontal":return["center","middle"];case"center-right":case"esriServerPointLabelPlacementCenterRight":return["left","middle"];case"below-left":case"esriServerPointLabelPlacementBelowLeft":return["right","top"];case"below-center":case"below-along":case"esriServerPointLabelPlacementBelowCenter":case"esriServerLinePlacementBelowAlong":return["center","top"];case"below-right":case"esriServerPointLabelPlacementBelowRight":return["left","top"];default:return console.debug(`Found invalid placement type ${t}`),["center","middle"]}}function u(t){switch(t){case n.Right:case"right":return-1;case n.Center:case"center":return 0;case n.Left:case"left":return 1;default:return console.debug(`Found invalid horizontal alignment ${t}`),0}}function d(t){switch(t){case o.Top:case"top":return 1;case o.Center:case"middle":return 0;case o.Bottom:case o.Baseline:case"baseline":case"bottom":return-1;default:return console.debug(`Found invalid vertical alignment ${t}`),0}}(a=n||(n={}))[a.Left=-1]="Left",a[a.Center=0]="Center",a[a.Right=1]="Right",function(t){t[t.Top=1]="Top",t[t.Center=0]="Center",t[t.Bottom=-1]="Bottom",t[t.Baseline=2]="Baseline"}(o||(o={}))},87573:function(t,e,i){i.d(e,{A:function(){return s}});var r=i(14583);class s{constructor(t,e,i,s){this.transformedX=0,this.transformedY=0,this.center=(0,r.fA)(t,e),this.centerT=(0,r.vt)(),this.halfWidth=i/2,this.halfHeight=s/2,this.width=i,this.height=s}get x(){return this.center[0]}get y(){return this.center[1]}get blX(){return this.center[0]+this.halfWidth}get blY(){return this.center[1]+this.halfHeight}get trX(){return this.center[0]-this.halfWidth}get trY(){return this.center[1]-this.halfHeight}get xmin(){return this.x-this.halfWidth}get xmax(){return this.x+this.halfWidth}get ymin(){return this.y-this.halfHeight}get ymax(){return this.y+this.halfHeight}set x(t){this.center[0]=t}set y(t){this.center[1]=t}clone(){return new s(this.x,this.y,this.width,this.height)}serialize(t){return t.writeF32(this.center[0]),t.writeF32(this.center[1]),t.push(this.width),t.push(this.height),t}findCollisionDelta(t,e=4){const i=Math.abs(t.centerT[0]-this.centerT[0]),r=Math.abs(t.centerT[1]-this.centerT[1]),s=(t.halfWidth+this.halfWidth+e)/i,n=(t.halfHeight+this.halfHeight+e)/r,o=Math.min(s,n);return Math.log2(o)}extend(t){const e=Math.min(this.xmin,t.xmin),i=Math.min(this.ymin,t.ymin),r=Math.max(this.xmax,t.xmax)-e,s=Math.max(this.ymax,t.ymax)-i,n=e+r/2,o=i+s/2;this.width=r,this.height=s,this.halfWidth=r/2,this.halfHeight=s/2,this.x=n,this.y=o}static deserialize(t){const e=t.readF32(),i=t.readF32(),r=t.readInt32(),n=t.readInt32();return new s(e,i,r,n)}}},39686:function(t,e,i){i.d(e,{$U:function(){return z},C2:function(){return h},CQ:function(){return s},CR:function(){return w},C_:function(){return F},Cp:function(){return P},DY:function(){return a},GR:function(){return K},Gh:function(){return O},LY:function(){return A},O5:function(){return Z},Pq:function(){return c},Qb:function(){return j},Qs:function(){return et},Sr:function(){return v},TB:function(){return J},U5:function(){return M},V3:function(){return E},Vl:function(){return Q},Xh:function(){return X},YS:function(){return d},YV:function(){return n},_M:function(){return L},_x:function(){return q},cp:function(){return tt},dV:function(){return C},eG:function(){return l},eI:function(){return Y},fq:function(){return H},fy:function(){return I},g0:function(){return R},hM:function(){return k},ie:function(){return D},ju:function(){return o},lL:function(){return g},mg:function(){return N},n9:function(){return y},nM:function(){return m},nW:function(){return U},oj:function(){return G},p:function(){return V},qM:function(){return r},r1:function(){return $},sn:function(){return _},tP:function(){return it},uM:function(){return f},ue:function(){return u},vN:function(){return S},vd:function(){return b},yA:function(){return B},yv:function(){return W},z2:function(){return p},zt:function(){return x}});const r=1e-30,s=512,n=16777216,o=8,a=29,l=24,h=4,c=0,u=0,d=0,f=1,p=2,m=3,g=4,_=5,y=6,v=12,x=13,b=5,w=6,P=5,S=6;var C,T;(T=C||(C={}))[T.FilterFlags=0]="FilterFlags",T[T.Animation=1]="Animation",T[T.GPGPU=2]="GPGPU",T[T.VV=3]="VV",T[T.DD0=4]="DD0",T[T.DD1=5]="DD1",T[T.DD2=6]="DD2",T[T.LocalTimeOrigin=7]="LocalTimeOrigin";const M=6,A=1<<M,R=A<<1,O=1.05,I=3,E=1,L=3,D=3,z=5,N=6,F=1.15,k=2,V=128,B=256-2*k,U=2,G=128,H=10,W=1024,j=128,$=4,Z=1,q=1<<20,Y=.75,X=10,Q=.75,J=256,K=32,tt=512,et=0,it=1},17469:function(t,e,i){i.d(e,{Tl:function(){return S}});var r=i(67348),s=i(10793),n=i(13786),o=i(14583),a=i(96564),l=i(54904),h=i(87573);const c=22,u=4,d=c+u,f=c-6,p=3,m=Math.PI/180;class g{constructor(t,e,i,r){this._rotationT=(0,s.vt)(),this._xBounds=0,this._yBounds=0,this.minZoom=0,this.maxZoom=255,this._bounds=null;const n=i.rect,o=new Float32Array(8);t*=r,e*=r;const a=i.code?n.width*r:i.metrics.width,l=i.code?n.height*r:i.metrics.height;this.width=a,this.height=l,o[0]=t,o[1]=e,o[2]=t+a,o[3]=e,o[4]=t,o[5]=e+l,o[6]=t+a,o[7]=e+l,this._data=o,this._setTextureCoords(n),this._scale=r,this._mosaic=i,this.x=t,this.y=e,this.maxOffset=Math.max(t+a,e+l)}get mosaic(){return this._mosaic}set angle(t){this._angle=t,(0,r.$0)(this._rotationT,-t),this._setOffsets()}get angle(){return this._angle}get xTopLeft(){return this._data[0]}get yTopLeft(){return this._data[1]}get xBottomRight(){return this._data[6]}get yBottomRight(){return this._data[7]}get texcoords(){return this._texcoords}get textureBinding(){return this._mosaic.textureBinding}get offsets(){return this._offsets||this._setOffsets(),this._offsets}get char(){return String.fromCharCode(this._mosaic.code)}get code(){return this._mosaic.code}get bounds(){if(!this._bounds){const{height:t,width:e}=this._mosaic.metrics,i=e*this._scale,n=Math.abs(t)*this._scale,o=new Float32Array(8);o[0]=this.x,o[1]=this.y,o[2]=this.x+i,o[3]=this.y,o[4]=this.x,o[5]=this.y+n,o[6]=this.x+i,o[7]=this.y+n;const a=(0,r.lw)((0,s.vt)(),this._rotationT,this._transform);(0,s.gb)(o,o,a);let l=1/0,c=1/0,u=-1/0,d=-1/0;for(let t=0;t<4;t++){const e=o[2*t],i=o[2*t+1];l=Math.min(l,e),c=Math.min(c,i),u=Math.max(u,e),d=Math.max(d,i)}const f=u-l,p=d-c,m=l+f/2,g=c+p/2;this._bounds=new h.A(m,g,f,p)}return this._bounds}setTransform(t){this._transform=t,this._offsets=null}_setOffsets(){this._offsets||(this._offsets={topLeft:[0,0],topRight:[0,0],bottomLeft:[0,0],bottomRight:[0,0]});const t=(0,r.lw)((0,s.vt)(),this._rotationT,this._transform);this._offsets.topLeft[0]=this._data[0],this._offsets.topLeft[1]=this._data[1],this._offsets.topRight[0]=this._data[2],this._offsets.topRight[1]=this._data[3],this._offsets.bottomLeft[0]=this._data[4],this._offsets.bottomLeft[1]=this._data[5],this._offsets.bottomRight[0]=this._data[6],this._offsets.bottomRight[1]=this._data[7],(0,n.l0)(this._offsets.topLeft,this._offsets.topLeft,t),(0,n.l0)(this._offsets.topRight,this._offsets.topRight,t),(0,n.l0)(this._offsets.bottomLeft,this._offsets.bottomLeft,t),(0,n.l0)(this._offsets.bottomRight,this._offsets.bottomRight,t)}_setTextureCoords({x:t,y:e,width:i,height:r}){this._texcoords={topLeft:[t,e],topRight:[t+i,e],bottomLeft:[t,e+r],bottomRight:[t+i,e+r]}}}const _=(t,e)=>({code:0,page:0,sdf:!0,rect:new l.A(0,0,11,8),textureBinding:e,metrics:{advance:0,height:4,width:t,left:0,top:0}});function y(t,e){return t.forEach((t=>(0,n.l0)(t,t,e))),{topLeft:t[0],topRight:t[1],bottomLeft:t[2],bottomRight:t[3]}}class v{constructor(t,e,i){this._rotation=0,this._decorate(t,e,i),this.glyphs=t,this.bounds=this._createBounds(t),this.isMultiline=e.length>1,this._hasRotation=0!==i.angle,this._transform=this._createGlyphTransform(this.bounds,i),this._borderLineSizePx=i.borderLineSizePx,(i.borderLineSizePx||i.hasBackground)&&([this.bounds,this.textBox]=this.shapeBackground(this._transform));for(const e of t)e.setTransform(this._transform)}setRotation(t){if(0===t&&0===this._rotation)return;this._rotation=t;const e=this._transform,i=(0,r.$0)((0,s.vt)(),t);(0,r.lw)(e,i,e);for(const t of this.glyphs)t.setTransform(this._transform)}_decorate(t,e,i){if(!i.decoration||"none"===i.decoration||!t.length)return;const r=i.scale,s="underline"===i.decoration?d:f,n=t[0].textureBinding;for(const i of e){const e=i.startX*r,o=i.startY*r,a=(i.width+i.glyphWidthEnd)*r;t.push(new g(e,o+s*r,_(a,n),1))}}shapeBackground(t){const e=(1.5+(this._borderLineSizePx||0))/2,i=this._borderLineSizePx?e:0,{xmin:r,ymin:s,xmax:n,ymax:o,x:a,y:l,width:c,height:u}=this.bounds,d=[r-8,s-8],f=[n+8,s-8],p=[r-8,o+8],m=[n+8,o+8],g=y([[d[0]-e,d[1]-e],[f[0]+e,f[1]-e],[d[0]+i,d[1]+i],[f[0]-i,f[1]+i]],t),_=y([[p[0]+i,p[1]-i],[m[0]-i,m[1]-i],[p[0]-e,p[1]+e],[m[0]+e,m[1]+e]],t),v=y([[d[0]-e,d[1]-e],[d[0]+i,d[1]+i],[p[0]-e,p[1]+e],[p[0]+i,p[1]-i]],t),x=y([[f[0]-i,f[1]+i],[f[0]+e,f[1]-e],[m[0]-i,m[1]-i],[m[0]+e,m[1]+e]],t),b={main:y([d,f,p,m],t),top:g,bot:_,left:v,right:x};return[new h.A(a,l,c+2*e,u+2*e),b]}get boundsT(){const t=this.bounds,e=(0,n.hZ)((0,o.vt)(),t.x,t.y);if((0,n.l0)(e,e,this._transform),this._hasRotation){const i=Math.max(t.width,t.height);return new h.A(e[0],e[1],i,i)}return new h.A(e[0],e[1],t.width,t.height)}_createBounds(t){let e=1/0,i=1/0,r=0,s=0;for(const n of t)e=Math.min(e,n.xTopLeft),i=Math.min(i,n.yTopLeft),r=Math.max(r,n.xBottomRight),s=Math.max(s,n.yBottomRight);const n=r-e,o=s-i;return new h.A(e+n/2,i+o/2,n,o)}_createGlyphTransform(t,e){const i=m*e.angle,a=(0,s.vt)(),l=(0,o.vt)();return(0,r.Tl)(a,a,(0,n.hZ)(l,e.xOffset,-e.yOffset)),e.useCIMAngleBehavior?(0,r.e$)(a,a,i):((0,r.Tl)(a,a,(0,n.hZ)(l,t.x,t.y)),(0,r.e$)(a,a,i),(0,r.Tl)(a,a,(0,n.hZ)(l,-t.x,-t.y))),a}}class x{constructor(t,e,i,r,s,n){this.glyphWidthEnd=0,this.startX=0,this.startY=0,this.start=Math.max(0,Math.min(e,i)),this.end=Math.max(0,Math.max(e,i)),this.end<t.length&&(this.glyphWidthEnd=t[this.end].metrics.width),this.width=r,this.yMin=s,this.yMax=n}}const b=t=>10===t,w=t=>32===t;function P(t,e){let i=0;for(let e=0;e<t.length;e++){const{width:r}=t[e];i=Math.max(r,i)}const r="underline"===e.decoration?u:0,s=t[0].yMin;return{x:0,y:s,height:t[t.length-1].yMax+e.lineHeight*(t.length-1)+r-s,width:i}}function S(t,e){const i=e.scale,r=new Array,{glyphs:s,isRightToLeft:n}=t,o=function(t,e,i){const r=new Array,s=1/i.scale,n=i.maxLineWidth*s,o=e?t.length-1:0,a=e?-1:t.length,l=e?-1:1;let h=o,c=0,u=0,d=h,f=d,p=0,m=1/0,g=0;for(;h!==a;){const{code:e,metrics:i}=t[h],s=Math.abs(i.top);if(b(e)||w(e)||(m=Math.min(m,s),g=Math.max(g,s+i.height)),b(e))h!==o&&(r.push(new x(t,d,h-l,c,m===1/0?0:m,g)),m=1/0,g=0),c=0,d=h+l,f=h+l,u=0;else if(w(e))f=h+l,u=0,p=i.advance,c+=i.advance;else if(c>n){if(f!==d){const e=f-2*l;c-=p,r.push(new x(t,d,e,c-u,m,g)),m=1/0,g=0,d=f,c=u}else r.push(new x(t,d,h-l,c,m,g)),m=1/0,g=0,d=h,f=h,c=0;c+=i.advance,u+=i.advance}else c+=i.advance,u+=i.advance;h+=l}const _=new x(t,d,h-l,c,m,g);return _.start>=0&&_.end<t.length&&r.push(_),r}(s,n,e),l=o.length?P(o,e):{x:0,y:0,height:0,width:0},h=(0,a.xy)(e.horizontalAlignment),u=(0,a.UD)(e.verticalAlignment),d=u===a.gy.Baseline?1:0,f=d?0:u-1,m=(1-d)*-l.y+f*(l.height/2)+(d?1:0)*-c;for(let n=0;n<o.length;n++){const{start:a,end:l,width:c}=o[n];let u=-1*(h+1)*(c/2)-p;const d=(t.isRightToLeft?o.length-1-n:n)*e.lineHeight+m-p;o[n].startX=u,o[n].startY=d;for(let t=a;t<=l;t++){const e=s[t];if(b(e.code))continue;const n=new g(u+e.metrics.left,d-e.metrics.top,e,i);u+=e.metrics.advance,r.push(n)}}return new v(r,o,e)}},96700:function(t,e,i){i.d(e,{DF:function(){return a},Lu:function(){return h},RA:function(){return o},hV:function(){return l}});var r=i(13520),s=i(44740),n=(i(87416),i(57652),i(39686));const o=50;function a(t){if(!t)return null;const{xmin:e,ymin:i,xmax:r,ymax:n,spatialReference:o}=t;return new s.A({rings:[[[e,i],[e,n],[r,n],[r,i],[e,i]]],spatialReference:o})}function l(t){return(0,r.PN)(Math.round((0,r.Lz)(t)))}function h(t){const e=(0,r.PN)(n.GR),i=(0,r.PN)(n.cp);return Math.max(e,Math.min(t||i,i))}},1616:function(t,e,i){var r,s;function n(t){return null!=t&&!t.running}i.d(e,{c:function(){return s},pi:function(){return n},tf:function(){return r}}),function(t){t[t.Idle=0]="Idle",t[t.Rendering=1]="Rendering",t[t.Ready=2]="Ready",t[t.Fading=3]="Fading"}(r||(r={})),function(t){t[t.RG=0]="RG",t[t.BA=1]="BA",t[t.COUNT=2]="COUNT"}(s||(s={}))},75256:function(t,e,i){i.d(e,{c:function(){return r},n:function(){return g}});var r,s,n=i(82547),o=i(15774),a=i(85445),l=i(73364),h=i(39714),c=i(20551),u=i(32501),d=i(26133),f=i(43587),p=i(1616),m=i(58192);class g{constructor(){this.startTime=0,this._data=(0,a.v)(null),this._readChannels=p.c.RG,this.parallax=new _,this.parallaxNew=new _,this._anchorPoint=(0,u.vt)(),this._fadeState=(0,a.v)(r.HIDE),this._fadeFactor=(0,a.v)(1)}get data(){return this._data.value}set data(t){this._data.value=t}get readChannels(){return this._readChannels}get fadeState(){return this._fadeState.value}get fadeFactor(){return this._fadeFactor.value}get opacity(){switch(this.fadeState){case r.HIDE:return 0;case r.FADE_OUT:return 1-this.fadeFactor;case r.FADE_IN:return this.fadeFactor;case r.SHOW:case r.CROSS_FADE:return 1}}fade(t,e,i){this.isFading&&this.fadeFactor<1&&(this._fadeFactor.value=i?(0,o.qE)((e-this.startTime)/(b*i),0,1):1,1===this.fadeFactor&&this._endFade()),this._evaluateState(t,e),this._updateParallax(t)}_evaluateState(t,e){const i=t.relativeElevation,s=this._updateAnchorPoint(t);(i>1.7*m.zF||i<-m.zF||s>P)&&this.opacity>0?this._startFade(r.HIDE,e):this.isFading||(i>m.zF||i<-.35*m.zF||s>w*P?this.opacity>0&&this._startFade(r.FADE_OUT,e):(0,p.pi)(this.data)&&(0===this.opacity?this._startFade(r.FADE_IN,e):this.data.state===p.tf.Ready&&(this.fadeState===r.SHOW?this._startFade(r.CROSS_FADE,e):this._startFade(r.SHOW,e))))}_updateParallax(t){const e=(0,c.k)(t.eye);this.parallax.radiusCurvatureCorrection=.84*Math.sqrt(Math.max(e-f.$O.radius*f.$O.radius,0))/Math.sqrt(e),(0,d.Cr)(y,this.parallax.anchorPoint,v),(0,l.e$)(this.parallax.transform,h.zK,v[3],(0,d.yo)(v)),(0,d.Cr)(y,this.parallaxNew.anchorPoint,v),(0,l.e$)(this.parallaxNew.transform,h.zK,v[3],(0,d.yo)(v))}_updateAnchorPoint(t){return(0,c.n)(this._anchorPoint,t.eye),(0,c.h)(this._anchorPoint,this._anchorPoint,f.$O.radius),this.fadeState===r.HIDE&&this.data?.state===p.tf.Ready?((0,c.c)(this.parallax.anchorPoint,this._anchorPoint),0):(0,c.l)((0,c.d)(x,this.parallax.anchorPoint,this._anchorPoint))}requestFade(){this._fadeFactor.value=0}_startFade(t,e){switch(this._fadeState.value=t,this.startTime=e,t){case r.CROSS_FADE:this.requestFade(),this._switchReadChannels(),(0,c.c)(this.parallaxNew.anchorPoint,this._anchorPoint);break;case r.FADE_IN:this.requestFade(),this._switchReadChannels(),(0,c.c)(this.parallax.anchorPoint,this._anchorPoint),(0,c.c)(this.parallaxNew.anchorPoint,this._anchorPoint);break;case r.FADE_OUT:this.requestFade();break;case r.SHOW:this._switchReadChannels(),(0,c.c)(this.parallax.anchorPoint,this._anchorPoint),(0,c.c)(this.parallaxNew.anchorPoint,this._anchorPoint),this._endFade();break;case r.HIDE:this._endFade()}}_endFade(){switch(this._fadeFactor.value=1,this.data&&this.data.state!==p.tf.Ready&&(this.data.state=p.tf.Idle),this.fadeState){case r.CROSS_FADE:(0,c.c)(this.parallax.anchorPoint,this.parallaxNew.anchorPoint),this._fadeState.value=r.SHOW;break;case r.FADE_IN:this._fadeState.value=r.SHOW;break;case r.FADE_OUT:this._fadeState.value=r.HIDE;break;case r.SHOW:case r.HIDE:break;default:(0,n.Xb)(this.fadeState)}}_switchReadChannels(){this.data?.state===p.tf.Ready&&(this._readChannels=1-this._readChannels,this.data.state=p.tf.Fading)}get isFading(){return this.fadeState===r.FADE_OUT||this.fadeState===r.FADE_IN||this.fadeState===r.CROSS_FADE}}(s=r||(r={}))[s.HIDE=0]="HIDE",s[s.FADE_IN=1]="FADE_IN",s[s.SHOW=2]="SHOW",s[s.CROSS_FADE=3]="CROSS_FADE",s[s.FADE_OUT=4]="FADE_OUT";class _{constructor(){this.anchorPoint=(0,u.vt)(),this.radiusCurvatureCorrection=0,this.transform=(0,h.vt)()}}const y=(0,u.fA)(0,0,1),v=(0,d.vt)(),x=(0,u.vt)(),b=1.25,w=.5,P=2e5},58192:function(t,e,i){i.d(e,{k9:function(){return S},zF:function(){return P}});var r,s=i(53804),n=i(30905),o=i(23502),a=(i(58941),i(40633),i(13798),i(74376)),l=i(65953);let h=r=class extends n.oY{constructor(t){super(t),this.type="cloudy",this.cloudCover=.5}clone(){return new r({cloudCover:this.cloudCover})}};(0,s._)([(0,a.e)({cloudy:"cloudy"})],h.prototype,"type",void 0),(0,s._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],h.prototype,"cloudCover",void 0),h=r=(0,s._)([(0,l.$)("esri.views.3d.environment.CloudyWeather")],h);const c=h;var u;let d=u=class extends n.oY{constructor(t){super(t),this.type="foggy",this.fogStrength=.5}clone(){return new u({fogStrength:this.fogStrength})}};(0,s._)([(0,a.e)({foggy:"foggy"})],d.prototype,"type",void 0),(0,s._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],d.prototype,"fogStrength",void 0),d=u=(0,s._)([(0,l.$)("esri.views.3d.environment.FoggyWeather")],d);const f=d;var p;let m=p=class extends n.oY{constructor(t){super(t),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new p({cloudCover:this.cloudCover,precipitation:this.precipitation})}};(0,s._)([(0,a.e)({rainy:"rainy"})],m.prototype,"type",void 0),(0,s._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],m.prototype,"cloudCover",void 0),(0,s._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],m.prototype,"precipitation",void 0),m=p=(0,s._)([(0,l.$)("esri.views.3d.environment.RainyWeather")],m);const g=m;var _;let y=_=class extends n.oY{constructor(t){super(t),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new _({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};(0,s._)([(0,a.e)({snowy:"snowy"})],y.prototype,"type",void 0),(0,s._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],y.prototype,"cloudCover",void 0),(0,s._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],y.prototype,"precipitation",void 0),(0,s._)([(0,o.MZ)({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],y.prototype,"snowCover",void 0),y=_=(0,s._)([(0,l.$)("esri.views.3d.environment.SnowyWeather")],y);const v=y;var x;let b=x=class extends n.oY{constructor(t){super(t),this.type="sunny",this.cloudCover=.5}clone(){return new x({cloudCover:this.cloudCover})}};(0,s._)([(0,a.e)({sunny:"sunny"})],b.prototype,"type",void 0),(0,s._)([(0,o.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],b.prototype,"cloudCover",void 0),b=x=(0,s._)([(0,l.$)("esri.views.3d.environment.SunnyWeather")],b);const w={key:"type",base:b,typeMap:{sunny:b,cloudy:c,rainy:g,snowy:v,foggy:f}};Object.keys(w.typeMap);const P=1e4,S=1e5},44432:function(t,e,i){i.d(e,{R:function(){return l}});var r=i(93040),s=i(77472),n=i(39819),o=i(60539),a=i(90683);class l{constructor(t){this._streamDataRequester=t}async loadJSON(t,e){return this._load("json",t,e)}async loadBinary(t,e){return(0,a.DB)(t)?((0,o.Te)(e),(0,a.lJ)(t)):this._load("binary",t,e)}async loadImage(t,e){return this._load("image",t,e)}async _load(t,e,i){if(null==this._streamDataRequester)return(await(0,r.A)(e,{responseType:h[t]})).data;const a=await(0,s.Ke)(this._streamDataRequester.request(e,t,i));if(!0===a.ok)return a.value;throw(0,o.QP)(a.error),new n.A("glt-loader-request-error",`Request for resource failed: ${a.error}`)}}const h={image:"image",binary:"array-buffer",json:"json","image+type":void 0}},54200:function(t,e,i){i.d(e,{G:function(){return o}});var r=i(87725),s=i(14583),n=i(44705);function o(t){if(null==t)return null;const e=null!=t.offset?t.offset:s.uY,i=null!=t.rotation?t.rotation:0,o=null!=t.scale?t.scale:s.Un,a=(0,r.fA)(1,0,0,0,1,0,e[0],e[1],1),l=(0,r.fA)(Math.cos(i),-Math.sin(i),0,Math.sin(i),Math.cos(i),0,0,0,1),h=(0,r.fA)(o[0],0,0,0,o[1],0,0,0,1),c=(0,r.vt)();return(0,n.lw)(c,l,h),(0,n.lw)(c,a,c),c}},33913:function(t,e,i){i.d(e,{x:function(){return o}});var r=i(24540),s=i(37819),n=i(85456);function o(t,e){switch(e){case n.WR.TRIANGLES:return"number"==typeof(i=t)?(0,s.tM)(i):(0,r.mg)(i)?new Uint16Array(i):i;case n.WR.TRIANGLE_STRIP:return function(t){const e="number"==typeof t?t:t.length;if(e<3)return[];const i=e-2,r=(0,s.my)(3*i);if("number"==typeof t){let t=0;for(let e=0;e<i;e+=1)e%2==0?(r[t++]=e,r[t++]=e+1,r[t++]=e+2):(r[t++]=e+1,r[t++]=e,r[t++]=e+2)}else{let e=0;for(let s=0;s<i;s+=1)s%2==0?(r[e++]=t[s],r[e++]=t[s+1],r[e++]=t[s+2]):(r[e++]=t[s+1],r[e++]=t[s],r[e++]=t[s+2])}return r}(t);case n.WR.TRIANGLE_FAN:return function(t){const e="number"==typeof t?t:t.length;if(e<3)return new Uint16Array(0);const i=e-2,r=i<=65536?new Uint16Array(3*i):new Uint32Array(3*i);if("number"==typeof t){let t=0;for(let e=0;e<i;++e)r[t++]=0,r[t++]=e+1,r[t++]=e+2;return r}const s=t[0];let n=t[1],o=0;for(let e=0;e<i;++e){const i=t[e+2];r[o++]=s,r[o++]=n,r[o++]=i,n=i}return r}(t)}var i}},43:function(t,e,i){i.d(e,{KB:function(){return a},Xi:function(){return n},pn:function(){return l},x3:function(){return o}});var r=i(58941),s=i(54407);class n{constructor(t){this.data=t,this.type="encoded-mesh-texture",this.encoding=s.JS.KTX2_ENCODING}}function o(t){return"encoded-mesh-texture"===t?.type}async function a(t){const e=new Blob([t]),i=await e.text();return JSON.parse(i)}async function l(t,e){if(e===s.JS.KTX2_ENCODING)return new n(t);const i=new Blob([t],{type:e}),o=URL.createObjectURL(i),a=new Image;if((0,r.A)("esri-iPhone"))return new Promise(((t,e)=>{const i=()=>{s(),t(a)},r=t=>{s(),e(t)},s=()=>{URL.revokeObjectURL(o),a.removeEventListener("load",i),a.removeEventListener("error",r)};a.addEventListener("load",i),a.addEventListener("error",r),a.src=o}));try{a.src=o,await a.decode()}catch(t){console.warn("Failed decoding HTMLImageElement")}return URL.revokeObjectURL(o),a}},6071:function(t,e,i){i.d(e,{make:function(){return ja}});var r=i(40633),s=i(58941),n=i(39819),o=i(21609),a=i(62938),l=i(59122),h=i(44705),c=i(87725),u=i(73364),d=i(39714),f=i(20551),p=i(32501),m=i(7456),g=i(24761),_=i(50240),y=i(37819),v=i(62693),x=i(51376),b=i(15089),w=i(65420),P=i(49618),S=i(63728),C=i(57064),T=i(75302),M=i(25923),A=(i(50917),i(72485)),R=i(6527),O=i(14905),I=i(40359),E=i(89769),L=i(65839),D=i(91484),z=i(44740);function N(t,e,i){const r=(e.length>0?e[0]:t.length/3)-1,s=(0,R.S)(t,r,i);if(s!==A._.Z){t=t.slice();for(let e=0;e<t.length;e+=3)t[e+s]=t[e+2]}return(0,l.e)(t,e,3)}function F(t){const e=[[L.r.POSITION,new O.n(t.attributeData.position,t.indices,3,!0)]],i=(0,y.EH)(t.indices.length);return null!=t.attributeData.colorFeature?e.push([L.r.COLORFEATUREATTRIBUTE,new O.n([t.attributeData.colorFeature],i,1,!0)]):t.attributeData.color&&e.push([L.r.COLOR,new O.n(t.attributeData.color,i,4,!0)]),t.attributeData.uvMapSpace&&e.push([L.r.UVMAPSPACE,new O.n(t.attributeData.uvMapSpace,t.indices,4,!0)]),t.attributeData.boundingRect&&e.push([L.r.BOUNDINGRECT,new O.n(t.attributeData.boundingRect,t.indices,9,!0)]),new E.V(t.material,e,t.mapPositions,I.X.Mesh,t.attributeData.objectAndLayerIdColor)}function k(t,e=null){const i=[[L.r.POSITION,new O.n(t.attributeData.position,t.indices,3,!0)],[L.r.UV0,new O.n(t.attributeData.uv0,t.indices,2,!0)]];return new E.V(t.material,i,t.mapPositions,I.X.Mesh,e)}function V(t){switch(t.type){case"extent":if(t instanceof D.default)return z.A.fromExtent(t);break;case"polygon":return t}return null}class B{constructor(t,e,i){this.renderData=t,this.layerUid=e,this.graphicUid=i,this.outGeometries=new Array}}var U=i(26586),G=i(70974),H=i(60516),W=i(57617),j=i(82588),$=i(58704);function Z(t,e,i,r){const s=(0,j.oR)(t.rings,!!t.hasZ&&"on-the-ground"!==r.mode,j.Wq.CCW_IS_HOLE,t.spatialReference),n=(0,_.jh)(s.position.length),o=(0,P.au)(s.position,t.spatialReference,0,n,0,s.position,0,s.position.length/3,e,i,r),a=null!=o;return new et(s.position,n,X(s.polygons,s.position,n),Y(s.outlines,s.position,n),a,o)}function q(t,e){const i=(0,j.oR)(t.rings,!1,j.Wq.CCW_IS_HOLE),r=(0,W.projectBuffer)(i.position,t.spatialReference,0,i.position,e,0);for(let t=2;t<i.position.length;t+=3)i.position[t]=$.bi;return{position:i.position,polygons:X(i.polygons,i.position),outlines:Y(i.outlines,i.position),projectionSuccess:r}}function Y(t,e,i=null){return t.filter((({count:t})=>t>1)).map((({index:t,count:r})=>{const s=3*t,n=3*r;return null!=i?new J(t,r,(0,_.l5)(e,s,n),(0,_.l5)(i,s,n)):new Q(t,r,(0,_.l5)(e,s,n))}))}function X(t,e,i=null){const r=new Array;for(const{index:s,count:n,holeIndices:o,pathLengths:a}of t){if(n<=1)continue;const t=3*s,l=3*n,h=o.map((t=>t-s)),c=null!=i?new K(s,n,(0,_.l5)(e,3*s,3*n),(0,_.l5)(i,t,l),h,a):new tt(s,n,(0,_.l5)(e,3*s,3*n),h,a);r.push(c)}return r}class Q{constructor(t,e,i){this.index=t,this.count=e,this.position=i}}class J extends Q{constructor(t,e,i,r){super(t,e,i),this.mapPositions=r}}class K extends J{constructor(t,e,i,r,s,n){super(t,e,i,r),this.holeIndices=s,this.pathLengths=n}}class tt extends Q{constructor(t,e,i,r,s){super(t,e,i),this.holeIndices=r,this.pathLengths=s}}class et{constructor(t,e,i,r,s,n){this.position=t,this.mapPositions=e,this.polygons=i,this.outlines=r,this.projectionSuccess=s,this.sampledElevation=n}}var it=i(11377),rt=i(54407),st=i(56995),nt=i(13641),ot=i(10713),at=i(42674);const lt=["polygon","extent"];class ht extends C.U{constructor(t,e,i,r){super(t,e,i,r),this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const t=(0,T.Hj)(this._getSymbolSize());if(t)throw new n.A("graphics3dextrudesymbollayer:invalid-size",t)}const t=this.symbolLayer?.material?.color,e=this._getCombinedOpacityAndColor(t),i=(0,p.ci)(e),r=e[3],s=r<1||this.needsDrivenTransparentPass,o=this.symbolLayer?.material?.emissiveFactor,a=o?(0,f.L)((0,p.o8)(o)):p.uY,l={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:i,ambient:i,opacity:r,transparent:s,cullFace:s?rt.s2.None:rt.s2.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,emissiveFactor:a,offsetTransparentBackfaces:!0,normalType:it.W.Compressed};this._materials[Lt.Main]=new at.$U(l,this._context),this._materials[Lt.Bottom]=new at.$U({...l,cullFace:rt.s2.Back},this._context),this._context.stage.addMany(this._materials)}destroy(){super.destroy(),this._context.stage.removeMany(this._materials),this._materials.length=0}createGraphics3DGraphic(t){const e=t.graphic;if(!this._validateGeometry(e.geometry,lt,this.symbolLayer.type))return null;const i=this._getVertexOpacityAndColor(t.renderingInfo,255),r=this.setGraphicElevationContext(e);return this._createAs3DShape(e,t.renderingInfo,i,r,e.uid)}layerOpacityChanged(t,e){const i=this.symbolLayer?.material?.color,r=this._getCombinedOpacity(i),s=r<1||this.needsDrivenTransparentPass;this._materials[Lt.Main]?.setParameters({opacity:r,transparent:s}),this._materials[Lt.Bottom]?.setParameters({opacity:r,transparent:s});const n=this._getLayerOpacity();t.forEach((t=>e(t)?.layerOpacityChanged(n,this._context.isAsync)))}layerElevationInfoChanged(t,e){return this.updateGraphics3DGraphicElevationInfo(t,e,P.Kf)}slicePlaneEnabledChanged(t,e){return this._materials[Lt.Main]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._materials[Lt.Bottom]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),t.forEach((t=>{const i=e(t);null!=i&&i.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)})),!0}physicalBasedRenderingChanged(){const t={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0};return this._materials[Lt.Main]?.setParameters(t),this._materials[Lt.Bottom]?.setParameters(t),!0}_getExtrusionSize(t){let e;return e=t.size&&this._drivenProperties.size?(0,b.kg)(t.size,2)??0:this._getSymbolSize(),e/=this._context.renderCoordsHelper.unitInMeters,e}applyRendererDiff(t,e){return this._drivenPropertiesChanged(e)?M.w.RecreateSymbol:M.w.RecreateGraphics}async queryForSnapping(t,e,i,r){const s=this._getExtrusionSize(i)*this._context.renderCoordsHelper.unitInMeters/(0,a.G9)(e),{objectId:n,target:l}=t,h=(0,o.o8)(l);switch(h.z=(h.z??0)+s,t.type){case"edge":{const{start:e,end:i}=t,r=(0,o.o8)(e),a=(0,o.o8)(i);return r.z=(r.z??0)+s,a.z=(a.z??0)+s,[(0,x.P)(n,h,1/0,r,a)]}case"vertex":return[(0,x.k)(n,h,1/0),(0,x.P)(n,l,1/0,l,h)];default:return[]}}_getSymbolSize(){return this.symbolLayer.size??1}_createAs3DShape(t,e,i,r,s){const n=V(t.geometry);if(null==n)return null;if(0===n.rings.length||!n.rings.some((t=>t.length>0)))return this._logGeometryValidationWarnings(n.rings,"rings","ExtrudeSymbol3DLayer"),null;const o=Z(n,this._context.elevationProvider,this._context.renderCoordsHelper,r);this._logGeometryCreationWarnings(o,n.rings,"rings","ExtrudeSymbol3DLayer");const a=(0,T.W$)(n);if(null==a)return null;const x=new Array,b=new Array,C=(0,g.vt)(),M=(0,d.vt)(),A=(0,p.vt)(),R=this._context.renderCoordsHelper.viewingMode===w.RT.Global;R||this._context.renderCoordsHelper.worldUpAtPosition(null,A),(0,m.l)(n.spatialReference,[a.x,a.y,0],M,this._context.renderCoordsHelper.spatialReference);const O=(0,d.vt)();(0,u.B8)(O,M);const I=(0,c.vt)();(0,h.Ge)(I,O);const{polygons:E,mapPositions:D,position:z}=o,N=new Map,F=this._materials[Lt.Main];for(const t of E){const r=t.count;if(this._context.clippingExtent&&((0,g.vY)(t.mapPositions,C),!(0,g.KG)(C,this._context.clippingExtent)))continue;const n=(0,l.e)(t.mapPositions,t.holeIndices,3);if(0===n.length)continue;const o=n.length,a=6*r,h=(0,y.my)(a+o),c=(0,y.my)(o),u=(0,_.jh)(3*a),d=(0,_.jh)(3*a),f=(0,_.jh)(3*a),p=(0,_.jh)(a);ut(z,D,n,t,u,f,d,p,h,c,this._getExtrusionSize(e),A,R),(0,v.t)(u,u,O);const m=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:s,layerUid:this._context.layer.uid}),w=new Dt(u,f,(0,nt.fA)(d),p),P=ct(F,h,h.length-c.length,w,i,m),S=r,T=r,I=2*t.count,E=new zt(S,T,I,o/3);wt(P,E,M),N.set(P,E),x.push(P,ct(this._materials[Lt.Bottom],c,0,w,i,m)),b.push(w.heights)}if(0===x.length)return null;const k=new ot.B({geometries:x,layerUid:this._context.layer.uid,graphicUid:s,isElevationSource:!0});k.transformation=M;const B=(0,U.Cc)(this.symbolLayer,{opacity:this._getLayerOpacity()}),W=B?new S.H(this._materials[Lt.Main],B,this._context.slicePlaneEnabled):null,j=new S.Y(this,k,x,null,null,((t,e,i,r,s)=>function(t,e,i,r,s,n,o){const a=t.stageObject,l=a.geometries,h=l.length,c="absolute-height"!==e.mode;let p=0;const m=a.transformation,g=(0,u.Qw)((0,d.vt)(),m);for(let t=0;t<h;t+=2){const e=l[t];if(!(0,st.p)(e))continue;const h=e.getMutableAttribute(L.r.POSITION).data,u=n[t/2],d=new H.aY(e.mapPositions),_=h.length/3;let y=!1,v=0;{let t=0;for(let e=0;e<_;e++){bt[0]=h[t],bt[1]=h[t+1],bt[2]=h[t+2],r(d,Ct),c&&(v+=Ct.sampledElevation),G.b.TESTS_DISABLE_OPTIMIZATIONS?((0,f.i)(Pt,d.array[d.offset],d.array[d.offset+1],Ct.z+u[t/3]),null!=i&&s.toRenderCoords(Pt,i,Pt),(0,f.t)(Pt,Pt,g)):((0,f.i)(Pt,h[t],h[t+1],h[t+2]),(0,f.t)(Pt,Pt,m),s.setAltitude(Pt,Ct.z+u[t/3]),(0,f.t)(Pt,Pt,g)),h[t]=Pt[0],h[t+1]=Pt[1],h[t+2]=Pt[2];const e=At/s.unitInMeters;(Math.abs(bt[0]-h[t])>=e||Math.abs(bt[1]-h[t+1])>=e||Math.abs(bt[2]-h[t+2])>=e)&&(y=!0),d.offset+=3,t+=3}}if(y){const i=o.get(e);i&&wt(e,i,m),a.geometryVertexAttributeUpdated(l[t],L.r.NORMALCOMPRESSED),e.invalidateBoundingInfo(),a.geometryVertexAttributeUpdated(l[t],L.r.POSITION),l[t+1].invalidateBoundingInfo(),a.geometryVertexAttributeUpdated(l[t+1],L.r.POSITION)}p+=v/_}return p/h}(t,e,i,r,s,b,N)),r,W);return j.alignedSampledElevation=o.sampledElevation,j.needsElevationUpdates=(0,P.Kf)(r.mode),j}}function ct(t,e,i,r,s,n){const o=(0,y.EH)(e.length),a=[[L.r.POSITION,new O.n(r.positions,e,3,!0)],[L.r.NORMALCOMPRESSED,new O.n(r.normals,e,2,!0)],[L.r.COLOR,new O.n(s,o,4,!0)]];return new E.V(t,a,r.elevation,I.X.Mesh,n,i)}function ut(t,e,i,r,s,n,o,a,l,h,c,u,d){{const p=i.length/3,m=2*r.count;!function(t,e,i,r,s,n,o,a,l,h,c,u,d,p,m,g,_){(0,f.c)(St,g);{const s=m>0?1:-1;let n=3*i,o=0,u=3*o,d=r,p=3*d;for(let i=0;i<r;++i){const i=t[n],r=t[n+1],g=t[n+2];_&&(St[0]=i,St[1]=r,St[2]=g,(0,f.n)(St,St)),a[u+0]=i,a[u+1]=r,a[u+2]=g;const y=e[n+0],v=e[n+1],x=e[n+2];l[u+0]=y,l[u+1]=v,l[u+2]=x,h[u+0]=-s*St[0],h[u+1]=-s*St[1],h[u+2]=-s*St[2],c[o]=0,a[p+0]=i+m*St[0],a[p+1]=r+m*St[1],a[p+2]=g+m*St[2],l[p+0]=y,l[p+1]=v,l[p+2]=x,c[d]=m,u+=3,p+=3,n+=3,o+=1,d+=1}}{let t=0,e=0,i=3*p;const n=m<0?Mt:Tt,a=m<0?Tt:Mt;for(let l=0;l<o;++l)d[e]=s[t+n[0]],d[e+1]=s[t+n[1]],d[e+2]=s[t+n[2]],u[i]=s[t+a[0]]+r,u[i+1]=s[t+a[1]]+r,u[i+2]=s[t+a[2]]+r,e+=3,i+=3,t+=3}}(t,e,r.index,r.count,i,0,p,s,n,o,a,l,h,m,c,u,d)}{let t=0,e=2*r.count,i=0;const h=r.pathLengths[0];pt(s,n,a,o,t,h,r.count,e,l,i,c),e+=4*h,i+=2*h,t+=h;for(let h=1;h<r.pathLengths.length;++h){const u=r.pathLengths[h];pt(s,n,a,o,t,u,r.count,e,l,i,c),e+=4*u,i+=2*u,t+=u}}}function dt(t,e,i,r,s,n,o){r[n]=r[o],o*=3,t[n*=3]=t[o],t[n+1]=t[o+1],t[n+2]=t[o+2],e[n]=e[o],e[n+1]=e[o+1],e[n+2]=e[o+2],i[n]=s[0],i[n+1]=s[1],i[n+2]=s[2]}const ft=(0,p.vt)();function pt(t,e,i,r,s,n,o,a,l,h,c){let u=s,d=s+1,f=s+o,p=s+o+1,m=a,g=a+1,_=a+2*n,y=a+2*n+1;c<0&&(u=s+o+1,p=s);let v=3*h;for(let a=0;a<n;++a)a===n-1&&(d=s,c>0?p=s+o:u=s+o),xt(t,u,d,f,ft),dt(t,e,r,i,ft,m,u),dt(t,e,r,i,ft,g,d),dt(t,e,r,i,ft,_,f),dt(t,e,r,i,ft,y,p),l[v]=m,l[v+1]=_,l[v+2]=y,l[v+3]=m,l[v+4]=y,l[v+5]=g,v+=6,u++,d++,f++,p++,m+=2,g+=2,_+=2,y+=2}const mt=(0,p.vt)(),gt=(0,p.vt)(),_t=(0,p.vt)(),yt=(0,p.vt)(),vt=(0,p.vt)();function xt(t,e,i,r,s){e*=3,i*=3,r*=3,(0,f.i)(mt,t[e++],t[e++],t[e++]),(0,f.i)(gt,t[i++],t[i++],t[i++]),(0,f.i)(_t,t[r++],t[r++],t[r++]),(0,f.d)(yt,gt,mt),(0,f.d)(vt,_t,mt),(0,f.e)(s,vt,yt),(0,f.n)(s,s)}const bt=(0,p.vt)();function wt(t,e,i){const r=t.getMutableAttribute(L.r.POSITION),s=t.getMutableAttribute(L.r.NORMALCOMPRESSED).data,{topVertexStart:n,topVertexCount:o,topFaceStart:a,topFaceCount:l}=e,h=r.data,c=o,u=t.attributes.get(L.r.POSITION).indices,d=a+l,p=n+o,m=(0,_.jh)(3*c);for(let t=0;t<c;++t){const e=3*t;m[e+0]=0,m[e+1]=0,m[e+2]=0}const g=Rt,y=Ot,v=It,x=Et,b=St;for(let t=a;t<d;++t){const e=3*t;for(let t=0;t<3;++t){const r=u[e+t];x[t]=r;const s=3*r;(0,f.i)(Pt,h[s+0],h[s+1],h[s+2]),(0,f.t)(g[t],Pt,i)}(0,f.a)(y,g[1],g[0]),(0,f.a)(v,g[2],g[0]),(0,f.e)(b,y,v),(0,f.n)(b,b);for(let t=0;t<3;++t){const e=3*(x[t]-n);m[e+0]+=b[0],m[e+1]+=b[1],m[e+2]+=b[2]}}for(let t=n;t<p;++t){const e=3*(t-n),i=m[e+0],r=m[e+1],o=m[e+2],a=Math.sqrt(i*i+r*r+o*o);(0,nt.aT)(s,t,i/a,r/a,o/a)}}const Pt=(0,p.vt)(),St=(0,p.vt)(),Ct=new P.Uk,Tt=[0,2,1],Mt=[0,1,2],At=.01,Rt=[(0,p.vt)(),(0,p.vt)(),(0,p.vt)()],Ot=(0,p.vt)(),It=(0,p.vt)(),Et=[0,0,0];var Lt;!function(t){t[t.Main=0]="Main",t[t.Bottom=1]="Bottom"}(Lt||(Lt={}));class Dt{constructor(t,e,i,r){this.positions=t,this.elevation=e,this.normals=i,this.heights=r}}class zt{constructor(t,e,i,r){this.topVertexStart=t,this.topVertexCount=e,this.topFaceStart=i,this.topFaceCount=r}}var Nt=i(52874),Ft=i(77472),kt=i(95929),Vt=i(60539),Bt=i(13520),Ut=i(50944),Gt=i(90683),Ht=i(1932),Wt=i(41546),jt=i(56763),$t=i(54547),Zt=i(57176),qt=i(67895),Yt=i(7590),Xt=i(77927),Qt=i(28896),Jt=i(85848),Kt=i(89814),te=i(16088),ee=i(24170),ie=i(90699),re=i(87416),se=i(96253);class ne{constructor(t,e,i,r){this.graphics3DSymbolLayer=t,this.renderGeometries=e,this.boundingBox=i,this._drapeSourceRenderer=r,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this.isElevationSource=!1}initialize(t){this.stage=t.stage}setVisibility(t){if(null!=this.stage&&this._visible!==t){if(this._visible=t,t&&!this._addedToStage)return this._addedToStage=!0,void this._drapeSourceRenderer.addGeometries(this.renderGeometries,se.q.ADD);if(t||this._addedToStage){for(const t of this.renderGeometries)t.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,se.k.VISIBILITY)}}}destroy(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,se.q.REMOVE),this._addedToStage=!1,this._visible=!1,this.stage=null}getCenterObjectSpace(t=(0,p.vt)()){return(0,f.i)(t,0,0,0)}getBoundingBoxObjectSpace(t=(0,g.vt)()){return(0,g.Ie)(t)}addObjectState(t){t.stateType===rt.Mg.Highlight&&(this.renderGeometries.forEach((e=>{const i=e.geometry.allocateIdAndHighlight(t.highlightGroupName);t.addRenderGeometry(e,i,this)})),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,se.k.HIGHLIGHT))}removeObjectState(t){this.renderGeometries.forEach((e=>t.removeByObject(e)))}removeRenderGeometryObjectState(t,e){e.channel===rt.Mg.Highlight&&(t.geometry.removeHighlight(e),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries([t],se.k.HIGHLIGHT))}computeAttachmentOrigin(t){for(const e of this.renderGeometries)e.geometry.computeAttachmentOrigin(le)&&(t.draped.origin[0]+=le[0],t.draped.origin[1]+=le[1],t.draped.num++)}async getProjectedBoundingBox(t,e,i,r,s){(0,g.Ie)(s);for(let e=0;e<this.renderGeometries.length;e++){const r=this.renderGeometries[e];this._getRenderGeometryProjectedBoundingRect(r,t,oe,i),(0,g.DC)(s,oe)}if(e){let t;(0,g.gX)(s,le);const i=(0,T.vY)(s,e.service.spatialReference,e);try{t=await e.service.queryElevation(le[0],le[1],r,i,"ground")}catch(t){}null!=t&&(s[2]=Math.min(s[2],t),s[5]=Math.max(s[5],t))}return s}_getRenderGeometryProjectedBoundingRect(t,e,i,r){if(this.boundingBox)(0,g.hZ)(ae,this.boundingBox);else{const e=t.boundingSphere,i=e[3];ae[0]=e[0]-i,ae[1]=e[1]-i,ae[2]=e[2]-i,ae[3]=e[0]+i,ae[4]=e[1]+i,ae[5]=e[2]+i}return e(ae,0,2),this.calculateRelativeScreenBounds&&r.push({location:(0,g.gX)(ae),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),(0,g.ES)(ae,i)}}const oe=(0,re.vt)(),ae=(0,g.vt)(),le=(0,p.vt)();var he=i(3107),ce=i(98860),ue=i(24129),de=i(98323),fe=i(8470),pe=i(15389),me=i(59552),ge=i(6955);const _e=(0,p.fA)(0,0,1),ye=de.CN,ve=[ye/2,ye/2,1-ye/2,1-ye/2],xe=[de.Q_*ye,de.Q_*ye];class be extends C.U{getCachedSize(){return{size:this._getIconSize()}}constructor(t,e,i,r){super(t,e,i,r),this._cimSymbolMaterials=new Map,this._cimSymbolTextures=new Map,this._cimMaterialParametersInfo=null,this._size=null,this._symbolTextureRatio=1,this._outlineSize=0,this._patchTask=null,this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}async doLoad(t){this._validateOrThrow();const e=this._prepareMaterialParameters(),i=this._getPrimitive();if(null!=i)this._prepareResourcesPrimitive(e,i);else{const i=(0,Kt.N7)(this.symbolLayer),r=Pe(i);null!=r?await this._prepareResourcesCIM(e,JSON.parse(r),t):await this._prepareResourcesHref(e,i,t)}}_validateOrThrow(){if(this._drivenProperties.size)return;const t=(0,T.Hj)(this._getIconSize());if(t)throw new n.A("graphics3diconsymbollayer:invalid-size",t)}_getIconSize(){const t=this.symbolLayer,e=Math.round(null!=t.size?(0,Bt.Lz)(t.size):16);return this._drivenProperties.size?Math.max(e,64):e}_generateTextureCIM(t){let e=this._cimData;if(e&&e.symbol||this.logger.error("Can't create texture, CIM data is undefined"),e.primitiveOverrides){e=(0,o.o8)(e);const i=e.primitiveOverrides;qt.$.evaluateOverrides(i,t,this._arcadeInfo.geometryType,null,null),qt.$.applyOverrides(e.symbol,i)}const i=(0,Ut.Wm)(JSON.stringify(e));let r=this._cimSymbolTextures.get(i);if(r)return r;const s=this._context.sharedResources.cimSymbolRasterizer,n=this._context.renderer&&"dictionary"===this._context.renderer.type?this._context.renderer.fieldMap:null;n&&qt.$.applyDictionaryTextOverrides(e.symbol,t,n,null);const a=null!=this._cimScaleFactorOrFunction?(0,Yt.s4)(this._cimScaleFactorOrFunction,t):1;1!==a&&e.symbol&&(0,Xt.Km)(e.symbol,a,!0);const l=Zt.wp.getEnvelope(e,null,s.resourceManager);if(l?.width&&l.height){const t=l.x+l.width/2,i=l.y+l.height/2,n=s.rasterize({type:"cim",data:e},l.width,l.height,t,i,1,"esriGeometryPoint"),o=new Jt.Q({x:-l.x/l.width-.5,y:(l.height+l.y)/l.height-.5});this._cimMaterialParametersInfo.anchorPosition=Se("relative",o),r=new me.g(n,{width:n?.width??1,height:n?.height??1,reloadable:!0})}else r=new me.g(new ImageData(1,1),{width:1,height:1,reloadable:!0});return this._cimSymbolTextures.set(i,r),this._context.stage.add(r),r}_prepareMaterialParameters(){const t={anchorPosition:Se(this.symbolLayer.anchor,this.symbolLayer.anchorPosition),rotation:this.symbolLayer.angle},e=this.symbol;if(function(t){return t&&"point-3d"===t.type&&t.hasVisibleVerticalOffset()}(e)){const{screenLength:i,minWorldLength:r,maxWorldLength:s}=e.verticalOffset;t.verticalOffset={screenLength:(0,Bt.Lz)(i),minWorldLength:r||0,maxWorldLength:null!=s?s:1/0}}this._context.screenSizePerspectiveEnabled&&(t.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),(0!==t.rotation||this._drivenProperties.rotation)&&(t.hasRotation=!0);const i=!!(0,s.A)("enable-feature:non-occluded-hud");return t.occlusionTest=!i,t.occludedFragmentFade=i,t.horizonCullingEnabled=i,t.hasSlicePlane=this._context.slicePlaneEnabled,t}_prepareResourcesPrimitive(t,e){const i=this._getOutlineSize();if(we(e)&&0===i)throw new Error("Nothing to render");if(this._outlineSize=i,t.color=this._getFillColor(),t.outlineColor=this._getOutlineColor(),t.outlineSize=this._outlineSize,null!=this._context.sharedResources.textures){const i=this._context.sharedResources.textures.fromData(`${e}-icon`,(()=>(0,de.sZ)(e)));this._textureHandle=i,t.textureId=i.texture.id}t.textureIsSignedDistanceField=!0,t.sampleSignedDistanceFieldTexelCenter=(0,de.ny)(e),t.distanceFieldBoundingBox=ve;const r=this._getIconSize();this._size=[r,r],this._symbolTextureRatio=1/ye,this._createMaterialAndAddToStage(t,this._context.stage)}async _prepareResourcesHref(t,e,i){this._outlineSize=this._getOutlineSize(),t.color=this._getFillColor(),t.outlineColor=this._getOutlineColor(),t.outlineSize=this._outlineSize,t.textureIsSignedDistanceField=!1;const r=this._getIconSize(),s=r*this._context.graphicsCoreOwner.view.state.rasterPixelRatio;if(null!=this._context.sharedResources.textures){const o=await(0,Ft.Ke)(this._context.sharedResources.textures.fromUrl(e,s,{signal:i}));if(!1===o.ok)throw(0,Vt.QP)(o.error),new n.A("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${e})`);this._textureHandle=o.value;const a=o.value.texture;this._size=Ce(a,r),t.textureId=a.id}this._createMaterialAndAddToStage(t,this._context.stage)}async _prepareResourcesCIM(t,e,r){if(this._cimData=e,!this._context.sharedResources.cimSymbolRasterizer){const t=(await i.e(5461).then(i.bind(i,74185))).CIMSymbolRasterizer;(0,Vt.Te)(r),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new t(this._context.renderCoordsHelper.spatialReference))}const s=this._context.sharedResources.cimSymbolRasterizer,n=[],o=e,a=o?.symbol;Zt.wp.fetchResources(a,s.resourceManager,n,r),Zt.wp.fetchFonts(a,s.resourceManager,n);const l=this._context.layer.fields?this._context.layer.fields.map((t=>t.toJSON())):[],h=this._context.renderCoordsHelper.spatialReference;if(this._arcadeInfo={spatialReference:h,fields:l,geometryType:"esriGeometryPoint"},o?.primitiveOverrides&&n.push(qt.$.createRenderExpressions(o.primitiveOverrides,this._arcadeInfo)),n.length>0&&(await Promise.all(n),(0,Vt.Te)(r)),this._context.renderer&&"dictionary"===this._context.renderer.type&&this._context.renderer.scaleExpression){const t=this._context.renderer;if(t.scaleExpression){const e=t.scaleExpression,i=await(0,$t.Ad)(e,this._context.layer.spatialReference,l);this._cimScaleFactorOrFunction=(t,e,r)=>{const s=(0,te.A)(i,t,{$view:r},"esriGeometryPoint",e);return null!==s?s:1}}}(0,Vt.Te)(r),this._cimMaterialParametersInfo=t,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1}_getPrimitive(){return this.symbolLayer.resource?.href?null:this.symbolLayer.resource?.primitive??Qt.r}_getOutlineSize(){let t=0;const e=this.symbolLayer;return null!=e.outline?.size?Math.max((0,Bt.Lz)(e.outline.size),0):(t=we(this._getPrimitive())?1.5:0,Math.max(t,0))}_getOutlineColor(){const t=this._getLayerOpacity(),e=this.symbolLayer,i=e?.outline?.color;if(null!=i){const e=Nt.A.toUnitRGB(i),r=i.a*t;return[e[0],e[1],e[2],r]}return[0,0,0,0]}_getFillColor(){if(we(this._getPrimitive()))return ee.r4;const t=null==this._getPrimitive(),e=this.symbolLayer?.material?.color;return this._getCombinedOpacityAndColor(e,{hasIntrinsicColor:t})}_createMaterialAndAddToStage(t,e){const i=this._context.spherical;if(this._cimData){this._fastUpdates=null;let r=t.textureId?this._cimSymbolMaterials.get(t.textureId):null;return r||(r=new ge.R(t,i),this._cimSymbolMaterials.set(t.textureId??0,r),e.add(r)),r}return this._fastUpdates=(0,ue.s_)(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates&&(t={...t,...this._fastUpdates.materialParameters}),this._materials[0]=new ge.R(t,i),e.add(this._materials[0]),this._materials[0]}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial((t=>{t.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,draped:this.draped})})),this.layerOpacityChanged())}destroy(){super.destroy(),this._patchTask=(0,kt.DC)(this._patchTask),this._forEachMaterial((t=>this._context.stage.remove(t))),this._materials.length=0,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach((t=>this._context.stage.remove(t))),this._cimSymbolTextures.clear(),this._textureHandle=(0,kt.Gz)(this._textureHandle)}_getScaleFactor(t,e){if(this._drivenProperties.size&&t.size){for(let e=0;e<3;e++){const i=t.size[e];i&&"symbol-value"!==i&&"proportional"!==i&&(t.size[e]=(0,Bt.Lz)(i))}if("symbol-value"===t.size[0])return 1;if(isFinite(+t.size[0]))return+t.size[0]/e;if(isFinite(+t.size[2]))return+t.size[2]/e}return 1}_getDrivenRotation(t){return this._drivenProperties.rotation?t.heading??0:0}createGraphics3DGraphic(t){const e=t.graphic;if(!this._validateGeometry(e.geometry))return null;let i,r=[0,0];if(this._cimData){if(!this._cimData.symbol)return null;const t=this._generateTextureCIM(e),s={textureId:t.id,...this._cimMaterialParametersInfo};i=this._createMaterialAndAddToStage(s,this._context.stage);const n=window.devicePixelRatio||1;r=[t.parameters.width/n,t.parameters.height/n]}else r=this._size,i=this._materials[0];const s=(0,ce.ZX)(e.geometry);if(null==s)return this.logger.warn(`unsupported geometry type for icon symbol: ${e.geometry.type}`),null;const n=t.renderingInfo,o=this._getVertexOpacityAndColor(n),a=this._getDrivenRotation(n);let l=1;if(!this._fastUpdates?.visualVariables.size){const t=r[0]>r[1]?r[0]:r[1];l=this._getScaleFactor(n,t)}l*=this._symbolTextureRatio;const h=(0,Ht.fA)(r[0]*l,r[1]*l),c=this.setGraphicElevationContext(e);return this.ensureDrapedStatus("on-the-ground"===c.mode)&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(e,s,i,o,a,h,t.layer.uid):this._createAs3DShape(e,s,i,o,a,h,c,e.uid)}layerOpacityChanged(){const t=this._getFillColor(),e=this._getOutlineColor();this._forEachMaterial((i=>{i.setParameters({color:t}),i.setParameters({outlineColor:e})}))}updateGeometry(t,e){if(this.draped||!this._validateGeometry(e))return!1;const{elevationContext:i,stageObject:r}=t;if(i.mode!==this.getGeometryElevationMode(e))return!1;const s=(0,ce.ZX)(e);if(!s)return!1;const n=(0,ce.hS)(r,this._context,s,i);if(null==n)return!1;const o=(0,ce.R$)(this._context,s);return r.geometries[0].localOrigin===o&&(t.alignedSampledElevation=n,(0,ce.d2)(t,s,this._context.elevationProvider),!0)}layerElevationInfoChanged(t,e,i){const r=this._elevationContext.mode,s=(0,P.I2)(be.elevationModeChangeTypes,i,r);if(s!==P.uw.UPDATE)return s;const n=(0,P.nu)(r)||"absolute-height"===r;return this.updateGraphics3DGraphicElevationInfo(t,e,(()=>n))}slicePlaneEnabledChanged(){return this.draped||this._forEachMaterial((t=>{t.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})})),!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return null!=this._getPrimitive()}applyRendererDiff(t,e){for(const i in t.diff){if("visualVariables"!==i)return M.w.RecreateSymbol;if(!(0,ue.J_)(this._fastUpdates,e,this._fastVisualVariableConvertOptions()))return M.w.RecreateSymbol;this._materials[0]?.setParameters(this._fastUpdates.materialParameters)}return M.w.FastUpdate}prepareSymbolLayerPatch(t){if(this._patchTask?.abort(),"partial"!==t.diff.type)return;const e=t.diff.diff;this._preparePatchResource(t,e),this._preparePatchRotation(t,e)}_preparePatchResource(t,e){if(!e.resource||"partial"!==e.resource.type)return;const i=e.resource.diff;if("complete"!==i?.href?.type)return;const r=i.href.newValue,{textures:s}=this._context.sharedResources;if(null==r||null==s||null!=Pe(r))return;const o=this._getIconSize(),a=o*this._context.graphicsCoreOwner.view.state.pixelRatio;t.symbolLayerStatePatches.push((()=>{this._patchTask=(0,kt.DC)(this._patchTask),this._patchTask=(0,Ft.UT)((t=>this._context.schedule((async(t,e)=>{const i=await(0,Ft.Ke)(s.fromUrl(r,a,{signal:e}));(0,Vt.Te)(e);const l=!i.ok;if(l&&(0,Vt.QP)(i.error),this._textureHandle=(0,kt.Gz)(this._textureHandle),this._patchTask=null,l){this._forEachMaterial((t=>{t.visible=!1,t.setParameters({textureId:null})}));const t=`Failed to load (Request for icon resource failed: ${r})`;return void this.logger.error(new n.A("graphics3diconsymbollayer:request-failed",t))}this._textureHandle=i.value;const h=i.value.texture;this._size=Ce(h,o),this._forEachMaterial((t=>{t.setParameters({textureId:h.id}),t.visible=!0}))}),t)))})),delete i.href}_preparePatchRotation(t,e){if(!e.angle||"complete"!==e.angle.type)return;const i=e.angle.newValue??0,r=0!==i||this._drivenProperties.rotation;t.symbolLayerStatePatches.push((()=>{this._forEachMaterial((t=>t.setParameters({rotation:i,hasRotation:r})))})),delete e.angle}_defaultElevationInfoNoZ(){return Te}_createAs3DShape(t,e,i,r,s,n,o,a){const l=this.getFastUpdateAttrValues(t),h=this._context.layer.uid,c=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:h}),u=(0,fe.DJ)(i,_e,null,r,s,n,Me,null,l,c),d=(0,ce.SZ)(this._context,e,u,o,a);if(null==d)return null;const f=new S.Y(this,d.object,[u],null,null,ie.G8,o);return f.alignedSampledElevation=d.sampledElevation,f.needsElevationUpdates=(0,P.nu)(o.mode)||"absolute-height"===o.mode,f.getScreenSize=this._createScreenSizeGetter(n,l),f.calculateRelativeScreenBounds=t=>i.calculateRelativeScreenBounds(f.getScreenSize(),1,t),(0,ce.d2)(f,e,this._context.elevationProvider),f}_createAsOverlay(t,e,i,r,s,n,o){i.renderPriority=this._renderPriority;const a=(0,p.vt)();(0,jt.g)(e,a,this._context.overlaySR),a[2]=$.bi;const l=this._context.clippingExtent;if(null!=l&&!(0,g.Uc)(l,a))return null;const h=this.getFastUpdateAttrValues(t),c=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:t.uid,layerUid:this._context.layer.uid}),u=(0,fe.DJ)(i,_e,a,r,s,n,null,null,h,c),d=new pe.$(u,{layerUid:o,graphicUid:t.uid}),f=new ne(this,[d],null,this._context.drapeSourceRenderer);return f.getScreenSize=this._createScreenSizeGetter(n,h),f.calculateRelativeScreenBounds=t=>i.calculateRelativeScreenBounds(f.getScreenSize(),1,t),f}_createScreenSizeGetter(t,e){const i=this._outlineSize+2;if(this._fastUpdates&&e){const r=t[0]/this._symbolTextureRatio,s=t[1]/this._symbolTextureRatio;return(t=(0,Ht.vt)())=>{const[n,o]=(0,ue.VC)(Ae,this._fastUpdates.materialParameters,e);return t[0]=n*r+i,t[1]=o*s+i,t}}const r=t[0]/this._symbolTextureRatio+i,s=t[1]/this._symbolTextureRatio+i;return(t=(0,Ht.vt)())=>(t[0]=r,t[1]=s,t)}_fastVisualVariableConvertOptions(){const t=Math.max(this._size[0],this._size[1]),e=(0,p.fA)(t,t,t),i=(0,Bt.PN)(1),r=t*i,s=(0,p.fA)(r,r,r);return new ue.wI({size:!0,color:!0,rotation:!0,opacity:!1},e,s,i)}_forEachMaterial(t){this._materials.forEach(t),this._cimSymbolMaterials.forEach(t)}test(){return{...super.test(),material:this._materials[0]}}}function we(t){return null!=t&&("cross"===t||"x"===t)}function Pe(t){const e=(0,Gt.r$)(t);return"application/json"===e?.mediaType?e.data:void 0}function Se(t,e){return"relative"===t?(0,Ht.fA)((e.x||0)+.5,.5-(e.y||0)):t in he.Zd?he.Zd[t]:he.Zd.center}function Ce({parameters:t},e){const i=(t.width??1)/(t.height??1);return i>1?[e,Math.round(e/i)]:[Math.round(e*i),e]}be.PRIMITIVE_SIZE=xe,be.elevationModeChangeTypes={definedChanged:P.uw.UPDATE,staysOnTheGround:P.uw.NONE,onTheGroundChanged:P.uw.RECREATE};const Te={mode:"relative-to-ground",offset:0},Me=(0,Wt.fA)(0,0,0,1),Ae=(0,p.vt)();var Re=i(95736);function Oe(t){switch(t){case"butt":return Re.x.BUTT;case"square":return Re.x.SQUARE;case"round":return Re.x.ROUND;default:return null}}function Ie(t){return"diamond"===t?"kite":t}var Ee=i(79366),Le=i(29800),De=i(65856),ze=i(27264),Ne=i(28686),Fe=i(36634),ke=i(24100),Ve=i(29165),Be=i(77971),Ue=i(34615),Ge=i(82273),He=i(46921),We=i(6200),je=i(88630),$e=i(50678),Ze=i(85456),qe=i(57087);class Ye extends Ge.w{constructor(t,e,r){super(t,e,new Ue.$(je.L,(()=>i.e(5599).then(i.bind(i,83014)))),r,Xe)}_makePipelineState(t,e){const{output:i,oitPass:r,space:s,hasOccludees:n}=t;return(0,qe.Ey)({blending:i===ze.V.Color?(0,He.Yf)(r):null,depthTest:s===$e.lM.Draped?null:{func:(0,He.K_)(r)},depthWrite:(0,He.z5)(t),drawBuffers:i===ze.V.Depth?{buffers:[Ze.Hr.NONE]}:(0,He.m6)(r,i),colorWrite:qe.kn,stencilWrite:n?We.v0:null,stencilTest:n?e?We.a9:We.qh:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(t){return t.occluder?(this._occluderPipelineTransparent=(0,qe.Ey)({blending:qe.Ky,depthTest:We.sf,depthWrite:null,colorWrite:qe.kn,stencilWrite:null,stencilTest:We.mK}),this._occluderPipelineOpaque=(0,qe.Ey)({blending:qe.Ky,depthTest:We.sf,depthWrite:null,colorWrite:qe.kn,stencilWrite:We.r8,stencilTest:We.I$}),this._occluderPipelineMaskWrite=(0,qe.Ey)({blending:null,depthTest:We.m,depthWrite:null,colorWrite:null,stencilWrite:We.v0,stencilTest:We.a9})):this._occluderPipelineTransparent=this._occluderPipelineOpaque=this._occluderPipelineMaskWrite=null,this._occludeePipelineState=this._makePipelineState(t,!0),this._makePipelineState(t,!1)}getPipeline(t,e){return t?this._occludeePipelineState:e===Ve.N.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent??super.getPipeline():e===Ve.N.OCCLUDER_MATERIAL?this._occluderPipelineOpaque??super.getPipeline():this._occluderPipelineMaskWrite??super.getPipeline()}}const Xe=new Map([[L.r.POSITION,0],[L.r.PREVPOSITION,1],[L.r.UV0,2],[L.r.NORMAL,3],[L.r.COLOR,4],[L.r.COLORFEATUREATTRIBUTE,4],[L.r.SIZE,5],[L.r.SIZEFEATUREATTRIBUTE,5],[L.r.OPACITYFEATUREATTRIBUTE,6]]);class Qe extends ke.im{constructor(t){super(t,Ke),this._configuration=new $e.Dt,this.vertexAttributeLocations=Xe,this.produces=new Map([[Ve.N.OPAQUE_MATERIAL,t=>t===ze.V.Highlight||(0,ze._o)(t)&&this.parameters.renderOccluded===ke.m$.OccludeAndTransparentStencil],[Ve.N.OPAQUE_MATERIAL_WITHOUT_NORMALS,t=>(0,ze.eh)(t)],[Ve.N.OCCLUDER_MATERIAL,t=>(0,ze.aD)(t)&&this.parameters.renderOccluded===ke.m$.OccludeAndTransparentStencil],[Ve.N.TRANSPARENT_OCCLUDER_MATERIAL,t=>(0,ze.aD)(t)&&this.parameters.renderOccluded===ke.m$.OccludeAndTransparentStencil],[Ve.N.TRANSPARENT_MATERIAL,t=>(0,ze._o)(t)&&this.parameters.writeDepth],[Ve.N.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,t=>(0,ze._o)(t)&&!this.parameters.writeDepth],[Ve.N.DRAPED_MATERIAL,t=>t===ze.V.Color||t===ze.V.Highlight]]),this._layout=this.createLayout()}getConfiguration(t,e){return this._configuration.output=t,this._configuration.space=e.slot===Ve.N.DRAPED_MATERIAL?$e.lM.Draped:this.parameters.worldSpace?$e.lM.World:$e.lM.Screen,this._configuration.hideOnShortSegments=this.parameters.hideOnShortSegments,this._configuration.hasCap=this.parameters.cap!==Re.x.BUTT,this._configuration.anchor=this.parameters.anchor,this._configuration.hasTip=this.parameters.hasTip,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=e.hasOccludees,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.occluder=this.parameters.renderOccluded===ke.m$.OccludeAndTransparentStencil,this._configuration.oitPass=e.oitPass,this._configuration.terrainDepthTest=e.terrainDepthTest,this._configuration.cullAboveTerrain=e.cullAboveTerrain,this._configuration}get visible(){return this.parameters.color[3]>=Ne.Q}intersect(){}createLayout(){const t=(0,De.BP)().vec3f(L.r.POSITION).vec3f(L.r.PREVPOSITION).vec2f(L.r.UV0);return this.parameters.worldSpace&&t.vec3f(L.r.NORMAL),this.parameters.vvSize?t.f32(L.r.SIZEFEATUREATTRIBUTE):t.f32(L.r.SIZE),this.parameters.vvColor?t.f32(L.r.COLORFEATUREATTRIBUTE):t.vec4f(L.r.COLOR),this.parameters.vvOpacity&&t.f32(L.r.OPACITYFEATUREATTRIBUTE),t}createBufferWriter(){return new ti(this._layout,this.parameters)}createGLMaterial(t){return new Je(t)}}class Je extends Fe.m8{constructor(){super(...arguments),this._markerPrimitive=null}dispose(){super.dispose(),this._markerTextures.release(this._markerPrimitive),this._markerPrimitive=null}beginSlot(t){const e=this._material.parameters.markerPrimitive;return e!==this._markerPrimitive&&(this._material.setParameters({markerTexture:this._markerTextures.swap(e,this._markerPrimitive)}),this._markerPrimitive=e),this._material.setParameters(this.textureBindParameters),this.acquireTechnique(Ye,t)}}class Ke extends Be.S{constructor(){super(...arguments),this.width=0,this.color=[1,1,1,1],this.markerPrimitive="arrow",this.placement="end",this.cap=Re.x.BUTT,this.anchor=$e.kJ.Center,this.hasTip=!1,this.worldSpace=!1,this.hideOnShortSegments=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.markerTexture=null}}class ti{constructor(t,e){this.vertexBufferLayout=t,this._parameters=e}elementCount(){return"begin-end"===this._parameters.placement?12:6}write(t,e,i,r,s,n){const o=i.get(L.r.POSITION).data,a=o.length/3;let l=[1,0,0];const h=i.get(L.r.NORMAL);this._parameters.worldSpace&&null!=h&&(l=h.data);let c=1,u=0;this._parameters.vvSize?u=i.get(L.r.SIZEFEATUREATTRIBUTE).data[0]:i.has(L.r.SIZE)&&(c=i.get(L.r.SIZE).data[0]);let d=[1,1,1,1],p=0;this._parameters.vvColor?p=i.get(L.r.COLORFEATUREATTRIBUTE).data[0]:i.has(L.r.COLOR)&&(d=i.get(L.r.COLOR).data);let m=0;this._parameters.vvOpacity&&(m=i.get(L.r.OPACITYFEATUREATTRIBUTE).data[0]);const g=new Float32Array(s.buffer);let _=n*(this.vertexBufferLayout.stride/4);const y=(t,e,i,r)=>{if(g[_++]=t[0],g[_++]=t[1],g[_++]=t[2],g[_++]=e[0],g[_++]=e[1],g[_++]=e[2],g[_++]=i[0],g[_++]=i[1],this._parameters.worldSpace&&(g[_++]=l[0],g[_++]=l[1],g[_++]=l[2]),this._parameters.vvSize?g[_++]=u:g[_++]=c,this._parameters.vvColor)g[_++]=p;else{const t=Math.min(4*r,d.length-4);g[_++]=d[t],g[_++]=d[t+1],g[_++]=d[t+2],g[_++]=d[t+3]}this._parameters.vvOpacity&&(g[_++]=m)};let v;var x;(x=v||(v={}))[x.ASCENDING=1]="ASCENDING",x[x.DESCENDING=-1]="DESCENDING";const b=(e,i)=>{const r=(0,f.i)(ei,o[3*e],o[3*e+1],o[3*e+2]),s=ii;let n=e+i;do{(0,f.i)(s,o[3*n],o[3*n+1],o[3*n+2]),n+=i}while((0,f.H)(r,s)&&n>=0&&n<a);t&&((0,f.t)(r,r,t),(0,f.t)(s,s,t)),y(r,s,[-1,-1],e),y(r,s,[1,-1],e),y(r,s,[1,1],e),y(r,s,[-1,-1],e),y(r,s,[1,1],e),y(r,s,[-1,1],e)},w=this._parameters.placement;"begin"!==w&&"begin-end"!==w||b(0,v.ASCENDING),"end"!==w&&"begin-end"!==w||b(a-1,v.DESCENDING)}}const ei=(0,p.vt)(),ii=(0,p.vt)();var ri=i(20794),si=i(65352);const ni=["polyline","polygon","extent"],oi=new ue.wI({size:!0,color:!0,rotation:!1,opacity:!0});class ai extends C.U{constructor(t,e,i,r){super(t,e,i,r)}async doLoad(){if(this._fastUpdates=(0,ue.s_)(this._context.renderer,oi),!this._drivenProperties.size&&(null!=this.symbolLayer.size?this.symbolLayer.size:(0,Bt.PN)(1))<0)throw new n.A("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values")}_getMaterialParameters(t,e=!1){const i=this._getCombinedOpacityAndColor(e&&this._markerColor||this._materialColor);this._patternHidesLine&&!e&&(i[3]=0);const r={width:this._computeMaterialWidth(this.symbolLayer?.size),color:i,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:Oe(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:t,stipplePattern:(0,ri.Xq)(this.symbolLayer.pattern)};return this._fastUpdates?.visualVariables?{...r,...this._fastUpdates.materialParameters}:r}get _materialColor(){return this.symbolLayer.material?.color}get _markerColor(){return this.symbolLayer.marker?.color}get _lineMaterial(){return null==this._materials[ui.Line]&&(this._materials[ui.Line]=new si.W(this._getMaterialParameters(!1)),this._context.stage.add(this._materials[ui.Line])),this._materials[ui.Line]}get _ringMaterial(){return null==this._materials[ui.Ring]&&(this._materials[ui.Ring]=new si.W(this._getMaterialParameters(!0)),this._context.stage.add(this._materials[ui.Ring])),this._materials[ui.Ring]}get _wireframeLineMaterial(){return null==this._materials[ui.LineWireframe]&&(this._materials[ui.LineWireframe]=new si.W({...this._getMaterialParameters(!1),wireframe:!0}),this._context.stage.add(this._materials[ui.LineWireframe])),this._materials[ui.LineWireframe]}get _wireframeRingMaterial(){return null==this._materials[ui.RingWireframe]&&(this._materials[ui.RingWireframe]=new si.W({...this._getMaterialParameters(!0),wireframe:!0}),this._context.stage.add(this._materials[ui.RingWireframe])),this._materials[ui.RingWireframe]}get _markerMaterial(){return null==this._materials[ui.Marker]&&null!=this.symbolLayer.marker&&(this._materials[ui.Marker]=new Qe({...this._getMaterialParameters(!1,!0),placement:this.symbolLayer.marker.placement,markerPrimitive:Ie(this.symbolLayer.marker.style)}),this._context.stage.add(this._materials[ui.Marker])),this._materials[ui.Marker]}destroy(){super.destroy(),this._forEachMaterial((t=>this._context.stage.remove(t))),this._materials.length=0}_getDrivenSize(t){return this._drivenProperties.size&&t.size?(0,Bt.Lz)((0,b.or)(t.size)):1}_getDrivenColor(t){const e=(0,Wt.fA)(1,1,1,1);return this._drivenProperties.color&&t.color&&(e[0]=t.color[0],e[1]=t.color[1],e[2]=t.color[2],t.color.length>0&&(e[3]=t.color[3])),this._drivenProperties.opacity&&t.opacity&&(e[3]=t.opacity),e}createGraphics3DGraphic(t){const e=t.graphic;if(!this._validateGeometry(e.geometry,ni,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(e);return this.ensureDrapedStatus("on-the-ground"===i.mode),this.draped?this._createAsOverlay(t,this._context.layer.uid):this._createAs3DShape(t,i,e.uid)}applyRendererDiff(t,e){for(const i in t.diff){if("visualVariables"!==i)return M.w.RecreateSymbol;{const t=this._fastUpdates;if(!(0,ue.J_)(t,e,oi))return M.w.RecreateSymbol;this._forEachMaterial((e=>e?.setParameters(t.materialParameters)))}}return M.w.FastUpdate}prepareSymbolLayerPatch(t){if("partial"!==t.diff.type)return;const e=t.diff.diff,i={};"complete"===e.size?.type&&(i.width=this._computeMaterialWidth(e.size.newValue),delete e.size),"complete"===e.cap?.type&&(i.cap=Oe(e.cap.newValue??"butt"),delete e.cap);const r=this._prepareMarkerPatch(t,e);this._prepareMaterialPatch(t,e,r),t.symbolLayerStatePatches.push((()=>this._forEachMaterial((t=>t?.setParameters(i)))))}layerOpacityChanged(){this._forEachMaterial(((t,e)=>this._updateMaterialLayerOpacity(t,e===ui.Marker)))}_forEachMaterial(t){this._materials.forEach(t)}_updateMaterialLayerOpacity(t,e=!1){if(null==t)return;const i=t.parameters.color,r=this.symbolLayer?.material?.color,s=this._patternHidesLine&&!e?0:this._getCombinedOpacity(r),n=(0,Wt.fA)(i[0],i[1],i[2],s);t.setParameters({color:n})}layerElevationInfoChanged(t,e,i){const r=this._elevationContext.mode,s=(0,P.I2)(ai.elevationModeChangeTypes,i,r);if(s!==P.uw.UPDATE)return s;const n=(0,P.nu)(r);return this.updateGraphics3DGraphicElevationInfo(t,e,(()=>n))}slicePlaneEnabledChanged(){const t={hasSlicePlane:this._context.slicePlaneEnabled};return this._forEachMaterial((e=>e?.setParameters(t))),!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(t,e,i){const r=li(t.graphic.geometry),s="polygon"===r.type?r.rings:r.paths,n=new Array,o=(0,g.vt)(),a=(0,Le.C)(r,this._context.elevationProvider,this._context.renderCoordsHelper,e),l="polygon"===r.type?"rings":"paths";this._logGeometryCreationWarnings(a,s,l,"LineSymbol3DLayer");for(let e=0;e<a.lines.length;e++){const s=a.lines[e],l=s.position,h=s.mapPositions;if(null!=this._context.clippingExtent&&((0,g.vY)(h,o),!(0,g.KG)(o,this._context.clippingExtent)))continue;const c=this._createGeometry("polygon"===r.type?this._ringMaterial:this._lineMaterial,t,l,h,r.type,ci.ELEVATED,i);n.push(c),G.b.LINE_WIREFRAMES&&n.push(c.instantiate({material:"polygon"===r.type?this._wireframeRingMaterial:this._wireframeLineMaterial})),null!=this._markerMaterial&&n.push(c.instantiate({material:this._markerMaterial}))}if(0===n.length)return null;const h=new ot.B({geometries:n,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:i}),c=new S.Y(this,h,n,null,null,ie.Zd,e);return c.alignedSampledElevation=a.sampledElevation,c.needsElevationUpdates=(0,P.nu)(e.mode),c}_createGeometry(t,e,i,r,s,n,o){const a=n===ci.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,l="polygon"===s,h=this._fastUpdates?.visualVariables.color,c=this._fastUpdates?.visualVariables.size,u=this._fastUpdates?.visualVariables.opacity,d=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:o,layerUid:this._context.layer.uid}),f={position:i,size:c?null:this._getDrivenSize(e.renderingInfo),color:h?null:this._getDrivenColor(e.renderingInfo),sizeFeature:c?(0,ue.ul)(c.field,e.graphic):null,colorFeature:h?(0,ue.ul)(h.field,e.graphic):null,opacityFeature:u?(0,ue.ul)(u.field,e.graphic):null};return(0,Ee.t)(t,{overlayInfo:a,removeDuplicateStartEnd:l,mapPositions:r,attributeData:f},d)}_createAsOverlay(t,e){const i=t.graphic,r=li(i.geometry),s="polygon"===r.type?r.rings:r.paths,n="polygon"===r.type?this._ringMaterial:this._lineMaterial;n.renderPriority=this._renderPriority;const o=G.b.LINE_WIREFRAMES?"polygon"===r.type?this._wireframeRingMaterial:this._wireframeLineMaterial:null,a=this._markerMaterial;null!=o&&(o.renderPriority=this._renderPriority-.001),null!=a&&(a.renderPriority=this._renderPriority-.002);const l=new Array,h=(0,g.vt)(),c=(0,g.Ie)(),u=(0,Le.A)(r,this._context.overlaySR),d="polygon"===r.type?"rings":"paths";this._logGeometryCreationWarnings(u,s,d,"LineSymbol3DLayer");for(const s of u.lines){if((0,g.vY)(s.position,h),!(0,g.KG)(h,this._context.clippingExtent))continue;(0,g.RF)(c,h);const u=n=>{const o=this._createGeometry(n,t,s.position,void 0,r.type,ci.DRAPED,i.uid),a=new pe.$(o,{layerUid:e,graphicUid:i.uid});l.push(a)};if(null!=a){u(a);const t=this.symbolLayer.marker.placement;"begin"!==t&&"begin-end"!==t||(0,g.Hq)(h,s.position,0,1),"end"!==t&&"begin-end"!==t||(0,g.Hq)(h,s.position,s.position.length-3,1)}u(n),G.b.LINE_WIREFRAMES&&u(o)}return new ne(this,l,c,this._context.drapeSourceRenderer)}get _patternHidesLine(){const t=this.symbolLayer.pattern;return null!=t&&"style"===t.type&&"none"===t.style}_computeMaterialWidth(t){return t=t??(0,Bt.PN)(1),this._drivenProperties.size?this._fastUpdates?.visualVariables.size?(0,Bt.Lz)(1):1:(0,Bt.Lz)(t)}_prepareMaterialPatch(t,e,i){const r=e.material;if(null==r)return void(i.changed&&i.useMaterialColor&&hi(this._getCombinedOpacityAndColor(this._materialColor),this._materials[ui.Marker],t));if("collection"===r.type)return;const s="complete"===r.type?r.newValue?.color:"complete"===r.diff.color?.type?r.diff.color.newValue:null,n=this._getCombinedOpacityAndColor(s);i.useMaterialColor&&hi((0,Wt.o8)(n),this._materials[ui.Marker],t),this._patternHidesLine&&(n[3]=0),hi(n,this._materials[ui.Line],t),delete e.material}_prepareMarkerPatch(t,e){const i=e.marker,r=this._markerMaterial;if(null==i||"partial"!==i.type||null==i.diff||null!=i.diff.placement||null!=i.diff.style&&"complete"!==i.diff.style.type||null!=i.diff.color&&"complete"!==i.diff.color.type||null==r)return{changed:!1,useMaterialColor:null==this._markerColor};const s=i.diff.color,n=null!=s,o=n?s.newValue:null,a=null==o&&null==this._markerColor;o&&hi(this._getCombinedOpacityAndColor(o),r,t);const l=i.diff.style?.newValue;return l&&t.symbolLayerStatePatches.push((()=>r.setParameters({markerPrimitive:Ie(l)}))),delete e.marker,{changed:n,useMaterialColor:a}}}function li(t){switch(t.type){case"extent":if(t instanceof D.default)return z.A.fromExtent(t);break;case"polygon":case"polyline":return t}return null}function hi(t,e,i){null!=e&&i.symbolLayerStatePatches.push((()=>e.setParameters({color:t})))}var ci,ui,di;ai.elevationModeChangeTypes={definedChanged:P.uw.RECREATE,staysOnTheGround:P.uw.NONE,onTheGroundChanged:P.uw.RECREATE},(di=ci||(ci={}))[di.DRAPED=0]="DRAPED",di[di.ELEVATED=1]="ELEVATED",function(t){t[t.Line=0]="Line",t[t.Ring=1]="Ring",t[t.LineWireframe=2]="LineWireframe",t[t.RingWireframe=3]="RingWireframe",t[t.Marker=4]="Marker"}(ui||(ui={}));var fi=i(15774),pi=i(46157),mi=i(56919),gi=i(5047),_i=i(54466),yi=i(95123),vi=i(16824),xi=i(67376),bi=i(57652),wi=i(83614),Pi=i(47797),Si=i(46460),Ci=i(14921),Ti=i(43),Mi=i(54200),Ai=i(68546);class Ri extends S.Y{constructor(){super(...arguments),this.fastTransformUpdatesAllowed=!1,this._originalGeometries=[],this._fastTransformUpdatesEnabled=!1,this._autoDisableFastUpdatesTimeoutId=0}get fastTransformUpdatesEnabled(){return this._fastTransformUpdatesEnabled}destroy(){super.destroy(),this._cancelAutoDisableFastUpdates()}enableFastTransformUpdates(t,e){if(!this.fastTransformUpdatesAllowed||this._fastTransformUpdatesEnabled)return;this._cancelAutoDisableFastUpdates(),this._fastTransformUpdatesEnabled=!0;const{stageObject:i}=this,r=i.geometries.slice();i.removeAllGeometries();const s=(0,u.sC)(Oi,i.transformation),n=e.getOrigin(s);for(const e of r){const r=t(e.material),s=e.instantiate({material:r});s.localOrigin=n,i.addGeometry(s)}this._originalGeometries=r}autoDisableFastTransformUpdates(t){this._cancelAutoDisableFastUpdates(),this._autoDisableFastUpdatesTimeoutId=setTimeout((()=>{this._autoDisableFastUpdatesTimeoutId=0,t()}),2e3)}updateAutoDisableFastTransformUpdates(t){this._autoDisableFastUpdatesTimeoutId&&this.autoDisableFastTransformUpdates(t)}_cancelAutoDisableFastUpdates(){clearTimeout(this._autoDisableFastUpdatesTimeoutId),this._autoDisableFastUpdatesTimeoutId=0}disableFastTransformUpdates(t){if(!this._fastTransformUpdatesEnabled)return;this._cancelAutoDisableFastUpdates(),this._fastTransformUpdatesEnabled=!1;const{stageObject:e}=this,i=e.geometries.map((e=>t(e.material)));e.removeAllGeometries();for(let t=0;t<this._originalGeometries.length;t++){const r=this._originalGeometries[t],s=i[t];s.setParameters({modelTransformation:null}),s===r.material?e.addGeometry(r):e.addGeometry(r.instantiate({material:s}))}this._originalGeometries.length=0}updateFastLocalOrigin(t,e,i){if(!this._fastTransformUpdatesEnabled)return;const{stageObject:r}=this;if(0===r.geometries.length)return;const s=r.geometries[0].localOrigin,n=(0,u.sC)(Oi,t),o=i.getOrigin(n);if(o===s)return;const a=e?.localMatrix??d.zK;r.shaderTransformation=null,r.transformation=t,r.geometries.forEach((t=>{t.transformation=a,t.localOrigin=o}))}updateTransform(t,e,i){const{stageObject:r}=this,s=e?.localMatrix??d.zK;if(!this._fastTransformUpdatesEnabled)return r.shaderTransformation=null,r.transformation=t,r.geometries.forEach((t=>t.transformation=s)),void this._updateEdgeTransform(i);const n=r.transformation,o=r.geometries[0].transformation,a=t,l=s,h=(0,u.lw)(Ii,n,o),c=(0,u.lw)(Ei,a,l),f=(0,u.lw)(Di,c,(0,u.B8)(Di,o));r.shaderTransformation=f,this._setFastMaterialTransformation({matA:h,matB:c}),this._updateEdgeTransform(i)}alignWithElevation(t,e,i,r){if(!this._fastTransformUpdatesEnabled)return void super.alignWithElevation(t,e,i,r);null!=i&&(0,Ai.gf)(this.elevationContext.featureExpressionInfoContext,i);const{stageObject:s}=this;if(!s.geometries[0].material.parameters.modelTransformation)return;const n=s.transformation,o=s.geometries[0].transformation,a=(0,u.lw)(Ii,n,o),l=s.effectiveTransformation,h=(0,u.C)(Li,l);this.alignedSampledElevation=(0,ie.G8)(this,this.elevationContext,t.spatialReference,((i,r)=>(0,P.sE)(i,t,this.elevationContext,e,r)),e,h),s.shaderTransformation=h;const c=s.geometries[0].transformation,d=(0,u.lw)(Ei,h,c);this._setFastMaterialTransformation({matA:a,matB:d}),this._updateEdgeTransform(r)}_setFastMaterialTransformation({matA:t,matB:e}){const{stageObject:i}=this;if(0===i.geometries.length)return;const r=i.geometries[0].localOrigin,s=(0,u.kN)(Fi,(0,f.h)(Oi,r.vec3,-1)),n=(0,u.lw)(zi,s,t),o=(0,u.lw)(Ni,s,e),a=(0,u.B8)(zi,n),l=(0,u.lw)(Ni,o,a);for(const t of i.geometries)t.material.setParameters({modelTransformation:l})}_updateEdgeTransform(t){const{stageObject:e,_stageLayer:i}=this;i.stage.renderer.withEdgeView((i=>{i.fastUpdateObject3DEdgesTransform(e)||this.resetEdgeObject(t)}))}}const Oi=(0,p.vt)(),Ii=(0,d.vt)(),Ei=(0,d.vt)(),Li=(0,d.vt)(),Di=(0,d.vt)(),zi=(0,d.vt)(),Ni=(0,d.vt)(),Fi=(0,d.vt)();class ki{constructor(){this._fastTransformOriginalMaterials=new Map,this._fastTransformClonedMaterials=new Map,this._graphicReferenceCount=0}enable(t,e,i){t.enableFastTransformUpdates((t=>{if(this._graphicReferenceCount<=1){if(this._fastTransformOriginalMaterials.has(t))return t;const i=e.byMaterial(t);return this._fastTransformOriginalMaterials.set(t,i),e.delete(t),t}const r=new at.$U(t.parameters,i);return i.stage.add(r),this._fastTransformClonedMaterials.set(r,t),r}),i.localOriginFactory)}disable(t,e,i){const r=new Set,s=new Set;t.disableFastTransformUpdates((t=>{if(!this._fastTransformClonedMaterials.has(t)){const i=t,n=this._fastTransformOriginalMaterials.get(i);return e.has(n.uid)?(r.add(i),e.byUid(n.uid).material):(s.add(i),n.material)}const n=t,o=this._fastTransformClonedMaterials.get(n);return this._fastTransformClonedMaterials.delete(n),i.stage.remove(n),o}));for(const t of r)this._fastTransformOriginalMaterials.delete(t),i.stage.remove(t);for(const t of s){const i=this._fastTransformOriginalMaterials.get(t);this._fastTransformOriginalMaterials.delete(t),e.set(i.uid,i)}}onAddGraphic(){this._graphicReferenceCount++}onRemoveGraphic(t,e,i){this._graphicReferenceCount--,this.disable(t,e,i)}forEachMaterialInfo(t){this._fastTransformOriginalMaterials.forEach(t)}forEachClonedMaterial(t){this._fastTransformClonedMaterials.forEach(t)}destroy(t){t.removeMany(Array.from(this._fastTransformClonedMaterials.keys())),t.removeMany(Array.from(this._fastTransformOriginalMaterials.values(),(({material:t})=>t))),this._fastTransformClonedMaterials.clear(),this._fastTransformOriginalMaterials.clear()}}class Vi{constructor(){this._byUid=new Map,this._byMaterial=new Map}get materials(){return Array.from(this._byUid.values(),(t=>t.material))}byUid(t){return this._byUid.get(t)}byMaterial(t){return this._byMaterial.get(t)}set(t,e){this._byUid.set(t,e),this._byMaterial.set(e.material,e)}delete(t){const e=this._byMaterial.get(t)?.uid;e&&(this._byUid.delete(e),this._byMaterial.delete(t))}has(t){return this._byUid.has(t)}forEachMaterialInfo(t){this._byUid.forEach(t)}clear(){this._byUid.clear(),this._byMaterial.clear()}}var Bi=i(9933),Ui=i(13786),Gi=i(69508),Hi=i(73313),Wi=i(5596),ji=i(4875),$i=i(90553),Zi=i(84264),qi=i(73318),Yi=i(59121);class Xi extends Ge.w{constructor(t,e,r){super(t,e,new Ue.$(Yi.N,(()=>i.e(9538).then(i.bind(i,69505)))),r),this.primitiveType=Ze.WR.LINES}initializePipeline(t){const{hasOccludees:e,output:i,transparent:r}=t,s=(t,i=null,r=null)=>(0,qe.Ey)({blending:i,depthTest:We.m,depthWrite:r,colorWrite:qe.kn,stencilWrite:e?We.v0:null,stencilTest:e?t?We.a9:We.qh:null});return i===ze.V.Color?(this._occludeePipeline=s(!0,r?qe.Ky:null,qe.Uy),s(!1,r?qe.Ky:null,qe.Uy)):s(!1)}getPipeline(t){return t?this._occludeePipeline:super.getPipeline()}}var Qi=i(53804),Ji=i(65875),Ki=i(22095);class tr extends Ki.E{constructor(){super(...arguments),this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.hasOccludees=!1}}(0,Qi._)([(0,Ji.W)()],tr.prototype,"hasSlicePlane",void 0),(0,Qi._)([(0,Ji.W)()],tr.prototype,"hasVertexColors",void 0),(0,Qi._)([(0,Ji.W)()],tr.prototype,"transparent",void 0),(0,Qi._)([(0,Ji.W)()],tr.prototype,"hasOccludees",void 0);class er extends ke.im{constructor(t){super(t,rr),this._configuration=new tr,this.produces=new Map([[Ve.N.OPAQUE_MATERIAL,t=>(0,ze.dX)(t)]])}getConfiguration(t,e){return this._configuration.output=t,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._configuration.hasOccludees=e.hasOccludees,this._configuration}get visible(){return this.parameters.color[3]>=Ne.Q}intersect(t,e,i,s,n,o){if(!i.options.selectionMode||!t.visible)return;if(!(0,$i.zH)(e))return void r.A.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial").error("intersection assumes a translation-only matrix");const a=t.attributes.get(L.r.POSITION).data,l=i.camera,h=pr;(0,Ui.C)(h,i.point),(0,f.i)(mr[0],h[0]-2,h[1]+2,0),(0,f.i)(mr[1],h[0]+2,h[1]+2,0),(0,f.i)(mr[2],h[0]+2,h[1]-2,0),(0,f.i)(mr[3],h[0]-2,h[1]-2,0);for(let t=0;t<4;t++)if(!l.unprojectFromRenderScreen(mr[t],gr[t]))return;(0,Wi.Cr)(l.eye,gr[0],gr[1],_r),(0,Wi.Cr)(l.eye,gr[1],gr[2],yr),(0,Wi.Cr)(l.eye,gr[2],gr[3],vr),(0,Wi.Cr)(l.eye,gr[3],gr[0],xr);let c=Number.MAX_VALUE,u=0;for(let t=0;t<a.length-5;t+=3){if(sr[0]=a[t]+e[12],sr[1]=a[t+1]+e[13],sr[2]=a[t+2]+e[14],nr[0]=a[t+3]+e[12],nr[1]=a[t+4]+e[13],nr[2]=a[t+5]+e[14],(0,Wi.mN)(_r,sr)<0&&(0,Wi.mN)(_r,nr)<0||(0,Wi.mN)(yr,sr)<0&&(0,Wi.mN)(yr,nr)<0||(0,Wi.mN)(vr,sr)<0&&(0,Wi.mN)(vr,nr)<0||(0,Wi.mN)(xr,sr)<0&&(0,Wi.mN)(xr,nr)<0)continue;if(l.projectToRenderScreen(sr,lr),l.projectToRenderScreen(nr,hr),lr[2]<0&&hr[2]>0){(0,f.d)(or,sr,nr);const t=l.frustum,e=-(0,Wi.mN)(t[Gi.FB.NEAR],sr)/(0,f.f)(or,(0,Wi.Qj)(t[Gi.FB.NEAR]));(0,f.h)(or,or,e),(0,f.g)(sr,sr,or),l.projectToRenderScreen(sr,lr)}else if(lr[2]>0&&hr[2]<0){(0,f.d)(or,nr,sr);const t=l.frustum,e=-(0,Wi.mN)(t[Gi.FB.NEAR],nr)/(0,f.f)(or,(0,Wi.Qj)(t[Gi.FB.NEAR]));(0,f.h)(or,or,e),(0,f.g)(nr,nr,or),l.projectToRenderScreen(nr,hr)}else if(lr[2]<0&&hr[2]<0)continue;lr[2]=0,hr[2]=0;const i=(0,Hi.kb)((0,Hi.Cr)(lr,hr,dr),h);i<c&&(c=i,(0,f.c)(cr,sr),(0,f.c)(ur,nr),u=t/3)}const d=i.rayBegin,p=i.rayEnd;if(c<4){let t=Number.MAX_VALUE;if((0,Hi.ld)((0,Hi.Cr)(cr,ur,dr),(0,Hi.Cr)(d,p,fr),ar)){(0,f.d)(ar,ar,d);const e=(0,f.l)(ar);(0,f.h)(ar,ar,1/e),t=e/(0,f.j)(d,p)}o(t,ar,u,!1)}}intersectDraped(t,e,i,r,s,n){if(!i.options.selectionMode)return;const o=t.attributes.get(L.r.POSITION).data,a=t.attributes.get(L.r.SIZE),l=a?a.data[0]:0,h=r[0],c=r[1],u=((l+1)/2+4)*t.screenToWorldRatio;let d=Number.MAX_VALUE,f=0;for(let t=0;t<o.length-5;t+=3){const e=o[t],i=o[t+1],r=h-e,s=c-i,n=o[t+3]-e,a=o[t+4]-i,l=(0,fi.qE)((n*r+a*s)/(n*n+a*a),0,1),u=n*l-r,p=a*l-s,m=u*u+p*p;m<d&&(d=m,f=t/3)}d<u*u&&s(n.dist,n.normal,f,!1)}createGLMaterial(t){return new ir(t)}createBufferWriter(){const t=this.parameters.hasVertexColors?qi.dB:qi.Ci;return new Zi.Z(t)}}class ir extends ji.A{beginSlot(t){return this.acquireTechnique(Xi,t)}}class rr extends ke.qA{constructor(){super(...arguments),this.color=Wt.Un,this.hasVertexColors=!1,this.hasSlicePlane=!1,this.width=1}}const sr=(0,p.vt)(),nr=(0,p.vt)(),or=(0,p.vt)(),ar=(0,p.vt)(),lr=(0,Bt.r_)(),hr=(0,Bt.r_)(),cr=(0,p.vt)(),ur=(0,p.vt)(),dr=(0,Hi.vt)(),fr=(0,Hi.vt)(),pr=(0,p.vt)(),mr=[(0,Bt.r_)(),(0,Bt.r_)(),(0,Bt.r_)(),(0,Bt.r_)()],gr=[(0,p.vt)(),(0,p.vt)(),(0,p.vt)(),(0,p.vt)()],_r=(0,Wi.vt)(),yr=(0,Wi.vt)(),vr=(0,Wi.vt)(),xr=(0,Wi.vt)();var br=i(27539);const wr=["mesh"];class Pr extends C.U{constructor(t,e,i,r){super(t,e,i,r),this._materialInfoCache=new Vi,this._fastUpdateProcessor=new ki,this._textures=new Map,this.ensureDrapedStatus(!1)}async doLoad(){G.b.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new er({color:[1,0,1,1]}),this._debugTangentNormalMaterial=new er({color:[1,.5,0,1]}),this._debugFaceNormalMaterial=new er({color:[0,1,1,1]}))}destroy(){super.destroy(),this._textures.forEach((t=>t.unload())),this._context.stage.removeMany(this._materialInfoCache.materials),this._context.stage.removeMany(Array.from(this._textures.values())),this._materialInfoCache.clear(),this._textures.clear(),this._fastUpdateProcessor.destroy(this._context.stage)}get materials(){return this._materialInfoCache.materials}createGraphics3DGraphic(t){const e=t.graphic;if(!this._validateGeometry(e.geometry,wr,"fill on mesh-3d"))return null;const i=this.setGraphicElevationContext(e),r=t.renderingInfo;return this._createAs3DShape(e,r,i,e.uid)}onRemoveGraphic(t){this._fastUpdateProcessor.onRemoveGraphic(t,this._materialInfoCache,this._context)}layerOpacityChanged(t,e){const i=this._getLayerOpacity();this._updateMaterialParameters((t=>{t.material.setParameters({layerOpacity:i});const e=t.material.parameters;this._setMaterialTransparentParameter(e,t),t.material.setParameters({transparent:e.transparent})})),t.forEach((t=>e(t)?.layerOpacityChanged(i,this._context.isAsync)))}layerElevationInfoChanged(t,e){return this.updateGraphics3DGraphicElevationInfo(t,e,P.Kf)}slicePlaneEnabledChanged(t,e){return this._updateMaterialParameters((({material:t})=>{t.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})})),t.forEach((t=>e(t)?.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync))),!0}physicalBasedRenderingChanged(){const t=this._usePBR();return this._updateMaterialParameters((({material:e})=>e.setParameters({usePBR:t}))),!0}updateTransform(t,e,i,r){if(!t.fastTransformUpdatesAllowed)return!1;const s=t.fastTransformUpdatesEnabled;switch(r){case Ci.$.EnableFastUpdates:if(s)return!0;break;case Ci.$.DisableFastUpdates:if(!s)return!0;break;default:if(!s)return!!this.updateTransform(t,e,i,Ci.$.EnableFastUpdates)&&(t.autoDisableFastTransformUpdates((()=>this.updateTransform(t,e,i,Ci.$.DisableFastUpdates))),!0)}const n=this._context.renderCoordsHelper.spatialReference,o=Gr,{origin:a,transform:l}=i;if(!(0,m.l)(e,(0,f.i)(Fr,a.x,a.y,a.z??0),o,n))return!1;switch(r){case Ci.$.EnableFastUpdates:this._fastUpdateProcessor.enable(t,this._materialInfoCache,this._context);break;case Ci.$.DisableFastUpdates:this._fastUpdateProcessor.disable(t,this._materialInfoCache,this._context);break;case Ci.$.UpdateFastLocalOrigin:t.updateFastLocalOrigin(o,l,this._context.localOriginFactory)}const{elevationContext:h}=t;h.centerPointInElevationSR=this._getCenterPointInElevationSR(o);const{elevationProvider:c,renderCoordsHelper:u}=this._context;return t.alignedSampledElevation=(0,ie.G8)(t,h,c.spatialReference,((t,e)=>(0,P.sE)(t,c,h,u,e)),u,o),t.updateTransform(o,l,this._context.isAsync),t.updateAutoDisableFastTransformUpdates((()=>this.updateTransform(t,e,i,Ci.$.DisableFastUpdates))),!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_materialPropertiesDefault(t,e){const i=this._requiresSymbolVertexColors(),r=!!t.vertexAttributes.color,s=!!t.vertexAttributes.tangent;return{hasSymbolVertexColors:i,hasVertexColors:r,hasVertexTangents:s,uid:`vc:${r},vt:${s},vct${e},svc:${i}`}}_materialProperties(t,e,i){const r=this._materialPropertiesDefault(t,i);if(!e.material)return r;const{color:s,colorTexture:n,colorTextureTransform:o,normalTexture:a,normalTextureTransform:l,doubleSided:h,alphaCutoff:c,alphaMode:u}=e.material,d=Lr(s),f=Lr(n),p=Dr(o),m=Lr(a),g=Dr(l);if(r.color=s,r.colorTexture=n,r.normalTexture=a,r.uid=`${r.uid},cmuid:${d},ctmuid:${f},cttuid:${p},ntmuid:${m},nttuid:${g},ds:${h},ac:${c},am:${u}`,e.material instanceof yi.A){const{metallic:t,roughness:i,metallicRoughnessTexture:s,metallicRoughnessTextureTransform:n,emissiveColor:a,emissiveTexture:h,emissiveTextureTransform:c,occlusionTexture:u,occlusionTextureTransform:d}=e.material,f=Lr(s),p=Dr(n),m=Lr(a),g=Lr(h),_=Dr(c),y=Lr(u),v=Dr(d);r.metallic=t,r.roughness=i,r.metallicRoughnessTexture=s,r.emissiveColor=a,r.emissiveTexture=h,r.occlusionTexture=u,r.colorTextureTransform=Or(o),r.normalTextureTransform=Or(l),r.emissiveTextureTransform=Or(c),r.occlusionTextureTransform=Or(d),r.metallicRoughnessTextureTransform=Or(n),r.uid=`${r.uid},mrm:${t},mrr:${i},mrt:${f},mrtt:${p},emuid:${m},etmuid:${g},ett:${_},otmuid:${y},ott:${v}`}return r}_getInternalTextureId(t){const e=this._getInternalTexture(t,rt.sf.Opaque);return e?.id}_getInternalTexture(t,e){const i=function(t){return t.data??t.url}(t);if(!i)return null;const r=`${t.contentHash}/${e}`;let s=this._textures.get(r);if(!s){let n=null;const o=this._context.stage.renderView.renderingContext.parameters.maxMaxAnisotropy,a={wrap:Ir(t.wrap),noUnpackFlip:!0,maxAnisotropy:o,mipmap:o>1};(0,Ti.x3)(i)?(n=i.data,a.preMultiplyAlpha=!1,a.encoding=i.encoding):(n=i,a.preMultiplyAlpha=e!==rt.sf.Opaque,a.downsampleUncompressed=this._context.graphicsCoreOwner.view.qualitySettings.graphics3D.uncompressedTextureDownsamplingEnabled),s=new me.g(n,a),this._textures.set(r,s),s.load(this._context.stage.renderView.renderingContext),this._context.stage.add(s),s.events.on("unloaded",(()=>{this._textures.delete(r)}))}return s}_setInternalMaterialTextureParameters(t,e){if(null!=t.colorTexture){const i=this._getInternalTexture(t.colorTexture,e.textureAlphaMode);i?(e.textureId=i.id,e.textureAlphaPremultiplied=!!i.parameters.preMultiplyAlpha):e.textureId=void 0}t.normalTexture&&(e.normalTextureId=this._getInternalTextureId(t.normalTexture)),t.emissiveColor&&(e.emissiveFactor=Nt.A.toUnitRGB(t.emissiveColor)),t.emissiveTexture&&(e.emissiveTextureId=this._getInternalTextureId(t.emissiveTexture)),t.occlusionTexture&&(e.occlusionTextureId=this._getInternalTextureId(t.occlusionTexture)),t.metallicRoughnessTexture&&(e.metallicRoughnessTextureId=this._getInternalTextureId(t.metallicRoughnessTexture))}_setInternalMaterialParameters(t,e){null!=t.color&&function(t,e){e.diffuse=Nt.A.toUnitRGB(t),e.opacity=t.a}(t.color,e),this._setInternalMaterialTextureParameters(t,e),e.colorTextureTransformMatrix=(0,Mi.G)(t.colorTextureTransform),e.normalTextureTransformMatrix=(0,Mi.G)(t.normalTextureTransform);const i=null!=t.normalTextureTransform?.scale?t.normalTextureTransform?.scale:Ht.Un;e.scale=[i[0],i[1]],e.occlusionTextureTransformMatrix=(0,Mi.G)(t.occlusionTextureTransform),e.emissiveTextureTransformMatrix=(0,Mi.G)(t.emissiveTextureTransform),e.metallicRoughnessTextureTransformMatrix=(0,Mi.G)(t.metallicRoughnessTextureTransform)}_setExternalMaterialParameters(t){const e=this._drivenProperties.color;let i=this.symbolLayer.material?.colorMixMode??null;if(e)t.externalColor=Wt.Un;else{const e=this.symbolLayer.material?.color??null;e?t.externalColor=Nt.A.toUnitRGBA(e):(i=null,t.externalColor=Wt.Un)}i&&(t.colorMixMode=i),t.castShadows=!!this.symbolLayer.castShadows}_getOrCreateMaterial(t,e){const i=e.material?.color,r=e.material?.colorTexture,s=e.material?.alphaMode,n="blend"===s,o=!("opaque"===s)&&(function(t){const e=t.vertexAttributes.color;if(null==e)return!1;for(let t=3;t<e.length;t+=4)if(255!==e[t])return!0;return!1}(t)||null!=i&&i.a<1||r?.transparent||n),a=this._materialProperties(t,e,o),l=this._materialInfoCache.byUid(a.uid);if(l)return this._setInternalMaterialTextureParameters(a,l.material.parameters),l.material;const h={uid:a.uid,material:null,isComponentTransparent:o,alphaMode:e.material?e.material.alphaMode:"opaque"},c=(0,br.Jr)({normalTexture:a.normalTexture,metallicRoughnessTexture:a.metallicRoughnessTexture,metallicFactor:a.metallic,roughnessFactor:a.roughness,emissiveTexture:a.emissiveTexture,emissiveFactor:Nt.A.toUnitRGB(a.emissiveColor),occlusionTexture:a.occlusionTexture}),u={usePBR:this._usePBR(),isSchematic:c,hasVertexColors:a.hasVertexColors,hasSymbolColors:a.hasSymbolVertexColors,hasVertexTangents:a.hasVertexTangents,ambient:p.uY,diffuse:p.Un,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:rt.s2.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};u.mrrFactors=c?br.Bt:[a.metallic,a.roughness,br.mb[2]],e.material&&(u.doubleSided=e.material.doubleSided,u.cullFace=e.material.doubleSided?rt.s2.None:rt.s2.Back,u.textureAlphaCutoff=e.material.alphaCutoff),this._setExternalMaterialParameters(u),this._setMaterialTransparentParameter(u,h),this._setInternalMaterialParameters(a,u);const d=new at.$U(u,this._context);return h.material=d,this._materialInfoCache.set(a.uid,h),this._context.stage.add(d),d}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(t,e){t.transparent=this.needsDrivenTransparentPass||e.isComponentTransparent||t.layerOpacity<1||t.opacity<1||t.externalColor&&t.externalColor[3]<1,"auto"===e.alphaMode?t.textureAlphaMode=t.transparent?rt.sf.MaskBlend:rt.sf.Opaque:t.textureAlphaMode="opaque"===e.alphaMode?rt.sf.Opaque:"mask"===e.alphaMode?rt.sf.Mask:rt.sf.Blend}_createFaceDebugNormals(t,e){const i=e.length,r=t.spatialReference.isGeographic?20015077/180:1,s=.1*Math.max(t.extent.width*r,t.extent.height*r,t.extent.zmax-t.extent.zmin),n=[],o=[],a=e[0].transformation,l=(0,h.Ge)((0,c.vt)(),a);for(let t=0;t<i;t++){const i=e[t].attributes.get(L.r.POSITION);if(!i)continue;const r=i.data,h=i.indices;for(let t=0;t<h.length;t+=3)Rr(r,h,t,Br),Ar(r,h,t,Fr,kr,Vr),(0,f.g)(Fr,Fr,kr),(0,f.g)(Fr,Fr,Vr),(0,f.h)(Fr,Fr,1/3),(0,f.t)(Fr,Fr,a),n.push(...Fr),(0,f.q)(Br,Br,l),(0,f.n)(Br,Br),(0,f.b)(Fr,Fr,Br,s),n.push(...Fr),o.push(o.length),o.push(o.length)}return n.length?new E.V(this._debugFaceNormalMaterial,[[L.r.POSITION,new O.n(n,o,3,!0)]],null,I.X.Line):null}_createPerVertexDebugVectors(t,e,i,r,s){const n=e.length,o=t.spatialReference.isGeographic?20015077/180:1,a=.1*s*Math.max(t.extent.width*o,t.extent.height*o,t.extent.zmax-t.extent.zmin),l=[],u=[],d=e[0].transformation,p=(0,h.Ge)((0,c.vt)(),d);i===L.r.TANGENT&&(0,h.z0)(p,d);for(let t=0;t<n;t++){const r=e[t],s=r.attributes.get(L.r.POSITION),n=r.attributes.get(i);if(!s||!n)continue;const o=s.data,h=s.indices,c=n.data,m=n.indices;for(let t=0;t<h.length;t++){const e=3*h[t],i=m[t]*n.stride;(0,f.i)(Fr,o[e+0],o[e+1],o[e+2]),(0,f.t)(Fr,Fr,d),l.push(...Fr),(0,f.i)(kr,c[i+0],c[i+1],c[i+2]),(0,f.q)(kr,kr,p),(0,f.n)(kr,kr),(0,f.b)(Fr,Fr,kr,a),l.push(...Fr),u.push(u.length),u.push(u.length)}}return l.length?new E.V(r,[[L.r.POSITION,new O.n(l,u,3,!0)]],null,I.X.Line):null}_createAs3DShape(t,e,i,r){const s=t.geometry;if("mesh"!==s.type)return null;const n=this._createGeometryInfo(s,e,r);if(null==n)return null;const{geometries:o,objectTransformation:a}=n;if(G.b.DRAW_MESH_GEOMETRY_NORMALS){const t=this._createPerVertexDebugVectors(s,o,L.r.NORMAL,this._debugVertexNormalMaterial,1),e=this._createPerVertexDebugVectors(s,o,L.r.TANGENT,this._debugTangentNormalMaterial,.5),i=this._createFaceDebugNormals(s,o);t&&o.push(t),e&&o.push(e),i&&o.push(i)}const l=new ot.B({geometries:o,layerUid:this._context.layer.uid,graphicUid:r,isElevationSource:!0});l.transformation=a;const h=(0,U.Cc)(this.symbolLayer,{opacity:this._getLayerOpacity()}),c=h?new S.H(o[0].material,h,this._context.slicePlaneEnabled):null,u=new Ri(this,l,o,null,null,ie.G8,i,c);this._fastUpdateProcessor.onAddGraphic(),u.needsElevationUpdates=(0,P.Kf)(i.mode),u.useObjectOriginAsAttachmentOrigin=!0,u.fastTransformUpdatesAllowed=this._fastTransformUpdatesAllowed(s),i.centerPointInElevationSR=this._getCenterPointInElevationSR(l.transformation);const{elevationProvider:d,renderCoordsHelper:f}=this._context;return u.alignedSampledElevation=(0,ie.G8)(u,i,d.spatialReference,((t,e)=>(0,P.sE)(t,d,i,f,e)),f),u}_fastTransformUpdatesAllowed(t){const{vertexSpace:e,spatialReference:i}=t;if(!(0,xi.Hq)(e))return!1;const{type:r}=e,{view:s}=this._context.graphicsCoreOwner,{viewingMode:n}=s.state,o=s.spatialReference;return n===w.RT.Global&&"local"===r||n===w.RT.Local&&(0,bi.aI)(o,i)&&"georeferenced"===r&&!i.isGeographic}_getCenterPointInElevationSR(t){const e=(0,Si.T)(0,0,0,null!=this._context.elevationProvider.spatialReference?this._context.elevationProvider.spatialReference:null);return(0,mi.E)([t[12],t[13],t[14]],this._context.renderCoordsHelper.spatialReference,e),e}_passthroughReprojectionInfo(t){return t.reprojection===jr.NONE&&!!t.objectTransformation}_createPositionBuffer(t,e){const i=t.vertexAttributes.position;let r=i,s=null;if(e.reprojection===jr.NONE)return{position:r,georeferencedPositionBuffer:s};const n=e.reprojection===jr.RENDER?e.transformBeforeProject:null;n&&(r=(0,v.t)(new Float64Array(r.length),r,n));const{normal:o,tangent:a}=t.vertexAttributes;this._passthroughReprojectionInfo(e)||!o&&!a||(s=r);const l=r===i||r===s?new Float64Array(r.length):r;return(0,W.projectBuffer)(r,t.spatialReference,0,l,this._context.renderCoordsHelper.spatialReference,0),{position:l,georeferencedPositionBuffer:s}}_createNormalBuffer(t,e,i,r){const s=t.vertexAttributes.normal;if(null==s)return null;let n=s;const o=r.reprojection===jr.RENDER?r.transformBeforeProject:null;o&&(n=(0,wi.qs)(n,new Float32Array(n.length),o));const a=this._context.graphicsCoreOwner.view.viewingMode;if(r.reprojection===jr.NONE)return n;if("local"===a){if(!(0,bi.r1)(this._context.renderCoordsHelper.spatialReference))return n;if(null==i)return null;if(t.spatialReference.isGeographic){const t=n===s?new Float32Array(n.length):n;return(0,wi.gZ)(n,wi.OD.NORMAL,i,t)}if(t.spatialReference.isWebMercator){const t=n===s?new Float32Array(n.length):n;return(0,wi.GN)(n,wi.OD.NORMAL,i,t)}return n}if(null==i)return null;const l=n===s?new Float32Array(n.length):n,h=this._context.renderCoordsHelper.spatialReference;return(0,wi.X4)(n,i,t.spatialReference,e,h,l)}_createTangentBuffer(t,e,i,r){const s=t.vertexAttributes.tangent;if(null==s)return null;let n=s;const o=r.reprojection===jr.RENDER?r.transformBeforeProject:null;o&&(n=(0,wi.KM)(n,new Float32Array(n.length),o));const a=this._context.graphicsCoreOwner.view.viewingMode;if(r.reprojection===jr.NONE)return n;if("local"===a){if(!(0,bi.r1)(this._context.renderCoordsHelper.spatialReference))return n;if(null==i)return null;if(t.spatialReference.isGeographic){const t=n===s?new Float32Array(n.length):n;return(0,wi.gZ)(n,wi.OD.TANGENT,i,t)}if(t.spatialReference.isWebMercator){const t=n===s?new Float32Array(n.length):n;return(0,wi.GN)(n,wi.OD.TANGENT,i,t)}return n}if(null==i)return null;const l=n===s?new Float32Array(n.length):n,h=this._context.renderCoordsHelper.spatialReference;return(0,wi.xA)(n,i,t.spatialReference,e,h,l)}_createSymbolColorBuffer(t){if(this._requiresSymbolVertexColors()){const e=this._getVertexOpacityAndColor(t),i=(0,Bi.Eb)(this.symbolLayer?.material?.colorMixMode),r=new Uint8Array(4);return(0,Bi._j)(e,i,r),r}return null}_createBuffers(t,e){const i=t.vertexAttributes&&t.vertexAttributes.position;if(!i)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;const r=t.vertexAttributes.normal,s=t.vertexAttributes.uv,n=t.vertexAttributes.tangent;if(r&&r.length!==i.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(n&&n.length/4!=i.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(s&&s.length/2!=i.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;const o=this._computeReprojectionInfo(t),{position:a,georeferencedPositionBuffer:l}=this._createPositionBuffer(t,o),h=function(t){return t.vertexAttributes.color}(t),c=this._createSymbolColorBuffer(e),u=this._createNormalBuffer(t,a,l,o),f=this._createTangentBuffer(t,a,l,o),p=s,{transformation:m,position:g,normal:_,tangent:y}=this._passthroughReprojectionInfo(o)?{transformation:o.objectTransformation,position:a,normal:u,tangent:f}:this._transformOriginLocal(t,a,u,f);return{positionBuffer:g,normalBuffer:_,tangentBuffer:y,uvBuffer:p,colorBuffer:h,symbolColorBuffer:c,objectTransformation:m,geometryTransformation:o.reprojection===jr.NONE&&o.geometryTransformation?o.geometryTransformation:(0,d.vt)()}}_computeReprojectionInfo(t){const{vertexSpace:e}=t,i="georeferenced"===e.type?(0,bi.aI)(this._context.renderCoordsHelper.spatialReference,t.spatialReference)?jr.NONE:jr.RENDER:jr.NONE;if((0,xi.E9)(e))return{reprojection:i};const r=e.origin,s=(0,d.vt)(),n=t.transform?.localMatrix??d.zK;if(i===jr.NONE)return(0,m.l)(t.spatialReference,r,s,this._context.renderCoordsHelper.spatialReference),{reprojection:i,objectTransformation:s,geometryTransformation:(0,d.o8)(n)};const o=(0,u.kN)((0,d.vt)(),r);return(0,u.lw)(o,o,n),{reprojection:i,transformBeforeProject:o}}_transformOriginLocal(t,e,i,r){const s=this._context.renderCoordsHelper.spatialReference,n=t.origin;Nr[0]=n.x,Nr[1]=n.y,Nr[2]=n.z??0;const o=(0,d.vt)();(0,m.l)(t.spatialReference,Nr,o,s),(0,u.B8)(Ur,o);const{position:a,normal:l,tangent:h}=t.vertexAttributes,c=e===a?new Float64Array(e.length):e;(0,v.t)(c,e,Ur);const f=i?i===l?new Float32Array(i.length):i:null,p=r?r===h?new Float32Array(r.length):r:null;return i&&f&&(0,wi.qs)(i,f,Ur),r&&p&&(0,wi.KM)(r,p,Ur),{transformation:o,position:c,normal:f,tangent:p}}_validateFaces(t,e){const i=t.vertexAttributes.position.length/3,r=e.faces;if(r){let t=-1;for(let e=0;e<r.length;e++){const i=r[e];i>t&&(t=i)}if(i<=t)return this.logger.warn(`Vertex index ${t} is out of bounds of the mesh position buffer`),!1}else if(i%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}_isOutsideClippingArea(t){if(!this._context.clippingExtent)return!1;const e=t.vertexAttributes?.position;if(!e)return!1;const i=this._context.elevationProvider.spatialReference,r=(0,Pi.projectMeshVertexPositions)(t,i??t.spatialReference);return!!r&&((0,g.vY)(r,Hr),!(0,g.KG)(Hr,this._context.clippingExtent))}_createGeometryInfo(t,e,i){if(!(0,pi.canProjectWithoutEngine)(t.spatialReference,this._context.renderCoordsHelper.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(!this._validateVertexSpace(t))return null;if(this._isOutsideClippingArea(t))return null;const r=this._createBuffers(t,e);if(null==r)return null;const{positionBuffer:s,uvBuffer:n,colorBuffer:o,symbolColorBuffer:a,normalBuffer:l,tangentBuffer:h,objectTransformation:c,geometryTransformation:d}=r,f=function(t){return t.components??Wr}(t),p=new Array;let m=!1;const g=(0,u.sC)(Fr,c),_=this._context.localOriginFactory.getOrigin(g);for(const e of f){if(!this._validateFaces(t,e))return null;const r=Cr(t,e);if(0===r.length)continue;const c=Tr(s,l,e,r);c.didFlipNormals&&(m=!0);const u=[[L.r.POSITION,new O.n(s,r,3,!0)],[L.r.NORMAL,new O.n(c.normals,c.indices,3,!0)]];o&&u.push([L.r.COLOR,new O.n(o,r,4,!0)]),a&&u.push([L.r.SYMBOLCOLOR,new O.n(a,(0,y.EH)(r.length),4,!0)]),n&&u.push([L.r.UV0,new O.n(n,r,2,!0)]),h&&u.push([L.r.TANGENT,new O.n(h,r,4,!0)]);const f=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:i,layerUid:this._context.layer.uid}),g=this._getOrCreateMaterial(t,e),v=new E.V(g,u,null,I.X.Mesh,f);v.transformation=d,v.localOrigin=_,p.push(v)}return m&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:p,objectTransformation:c}}_updateMaterialParameters(t){this._materialInfoCache.forEachMaterialInfo(t),this._fastUpdateProcessor.forEachMaterialInfo(t),this._fastUpdateProcessor.forEachClonedMaterial(((t,e)=>{e.setParameters(t.parameters)}))}_validateVertexSpace(t){const{_context:{graphicsCoreOwner:{view:{state:{viewingMode:e}}}}}=this,{vertexSpace:i}=t;return e!==w.RT.Local||"local"!==i.type||(this.logger.warn("Displaying a mesh with a local vertex space in a view in local viewing mode is not supported."),!1)}test(){return{...super.test(),materials:this._materialInfoCache.materials}}}class Sr{constructor(t,e,i){this.normals=t,this.indices=e,this.didFlipNormals=i}}function Cr(t,e){return e.faces??(0,y.tM)(t.vertexAttributes.position.length/3)}function Tr(t,e,i,r){switch(i.shading||"flat"){default:case"source":return function(t,e,i,r){if(null==e)return Mr(t,r);let s=!1;if(!i.trustSourceNormals)for(let i=0;i<r.length;i+=3){Rr(t,r,i,Br);for(let t=0;t<3;t++){const n=3*r[i+t];Fr[0]=e[n],Fr[1]=e[n+1],Fr[2]=e[n+2],(0,f.f)(Br,Fr)<0&&(e[n]=-e[n],e[n+1]=-e[n+1],e[n+2]=-e[n+2],s=!0)}}return new Sr(e,r,s)}(t,e,i,r);case"flat":return Mr(t,r);case"smooth":return function(t,e){const i={};for(let r=0;r<e.length;r+=3){const s=Rr(t,e,r,Br);for(let t=0;t<3;t++){const n=e[r+t];let o=i[n];o||(o={normal:(0,p.vt)(),count:0},i[n]=o),(0,f.g)(o.normal,o.normal,s),o.count++}}const r=(0,gi.oe)(3*e.length),s=new Array(3*e.length);for(let t=0;t<e.length;t++){const n=i[e[t]];1!==n.count&&((0,f.n)(n.normal,n.normal),n.count=1);for(let e=0;e<3;e++)r[3*t+e]=n.normal[e];s[t]=t}return new Sr(r,s,!1)}(t,r)}}function Mr(t,e){const i=(0,gi.oe)(e.length),r=new Array(3*e.length);for(let s=0;s<e.length;s+=3){const n=Rr(t,e,s,Br);for(let t=0;t<3;t++)i[s+t]=n[t],r[s+t]=s/3}return new Sr(i,r,!1)}function Ar(t,e,i,r,s,n){const o=3*e[i],a=3*e[i+1],l=3*e[i+2];r[0]=t[o],r[1]=t[o+1],r[2]=t[o+2],s[0]=t[a],s[1]=t[a+1],s[2]=t[a+2],n[0]=t[l],n[1]=t[l+1],n[2]=t[l+2]}function Rr(t,e,i,r){return Ar(t,e,i,Fr,kr,Vr),(0,f.d)(kr,kr,Fr),(0,f.d)(Vr,Vr,Fr),(0,f.e)(Fr,kr,Vr),(0,f.n)(r,Fr),r}function Or(t){if(!t)return null;const{scale:e,offset:i,rotation:r}=t;return{scale:e,offset:i,rotation:(0,fi.kU)(r)}}function Ir(t="repeat"){if("string"==typeof t){const e=Er(t);return{s:e,t:e}}return{s:Er(t.horizontal),t:Er(t.vertical)}}function Er(t){switch(t){case"clamp":return Ze.pF.CLAMP_TO_EDGE;case"mirror":return Ze.pF.MIRRORED_REPEAT;default:return Ze.pF.REPEAT}}function Lr(t){return null==t?"-":t instanceof Nt.A?t.toHex():t.contentHash}function Dr(t){const{offset:e,scale:i,rotation:r}=t??zr;return`${e[0]},${e[1]},${r},${i[0]},${i[1]}`}const zr=new vi.A,Nr=(0,p.vt)(),Fr=(0,p.vt)(),kr=(0,p.vt)(),Vr=(0,p.vt)(),Br=(0,p.vt)(),Ur=(0,d.vt)(),Gr=(0,d.vt)(),Hr=(0,g.vt)(),Wr=[new _i.A];var jr;!function(t){t[t.NONE=0]="NONE",t[t.RENDER=1]="RENDER"}(jr||(jr={}));var $r=i(24540),Zr=i(93854),qr=i(55726),Yr=i(75354),Xr=i(84321);class Qr{constructor(t,e,i,r){this.graphics3DSymbolLayer=t,this.instanceIndex=e,this.elevationAligner=i,this.elevationContext=r,this.type="lod-instance",this._highlights=new Set,this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1}initialize(){}setVisibility(t){const{instanceData:e}=this;t!==e.getVisible(this.instanceIndex)&&e.setVisible(this.instanceIndex,t)}destroy(){null!=this.instanceIndex&&(this.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(t,e,i){if(this.elevationAligner){(0,Ai.gf)(this.elevationContext.featureExpressionInfoContext,i);const r=(i,r)=>(0,P.sE)(i,t,this.elevationContext,e,r),s=this.elevationAligner(this,this.elevationContext,t.spatialReference,r,e);null!=s&&(this.alignedSampledElevation=s)}}getCenterObjectSpace(t=(0,p.vt)()){return this.instanceData.getCombinedLocalTransform(this.instanceIndex,is),(0,f.t)(t,this._lodRenderer.baseBoundingSphere.center,is)}getBoundingBoxObjectSpace(t=(0,g.vt)()){this.instanceData.getCombinedLocalTransform(this.instanceIndex,is);const e=this._lodRenderer.baseBoundingBox;(0,g.Ie)(t);for(let i=0;i<8;++i)(0,f.i)(Kr,1&i?e[3]:e[0],2&i?e[4]:e[1],4&i?e[5]:e[2]),(0,f.t)(Kr,Kr,is),(0,g.iT)(t,Kr);return t}computeAttachmentOrigin(t){this.instanceData.getGlobalTransform(this.instanceIndex,is),t.render.origin[0]+=is[12],t.render.origin[1]+=is[13],t.render.origin[2]+=is[14],t.render.num++}async getProjectedBoundingBox(t,e,i,r,s){const n=this.getBoundingBoxObjectSpace(s),o=es,a=(0,g.fT)(n)?1:o.length;this.instanceData.getGlobalTransform(this.instanceIndex,is);for(let t=0;t<a;t++){const e=o[t];Kr[0]=n[e[0]],Kr[1]=n[e[1]],Kr[2]=n[e[2]],(0,f.t)(Kr,Kr,is),Jr[3*t]=Kr[0],Jr[3*t+1]=Kr[1],Jr[3*t+2]=Kr[2]}if(!t(Jr,0,a))return null;(0,g.Ie)(n);let l=null;this.calculateRelativeScreenBounds&&(l=this.calculateRelativeScreenBounds());for(let t=0;t<3*a;t+=3){for(let e=0;e<3;e++)n[e]=Math.min(n[e],Jr[t+e]),n[e+3]=Math.max(n[e+3],Jr[t+e]);l&&i.push({location:Jr.slice(t,t+3),screenSpaceBoundingRect:l})}if(e&&((0,g.gX)(n,ts),"absolute-height"!==this.elevationContext.mode)){let t;const i=(0,T.vY)(n,e.service.spatialReference,e);try{t=await e.service.queryElevation(ts[0],ts[1],r,i,"ground")}catch(t){}null!=t&&(0,g.cY)(n,0,0,-this.alignedSampledElevation+t)}return n}addObjectState(t){t.stateType===rt.Mg.Highlight&&this.addObjectHighlightState(t)}addObjectHighlightState(t){const e=new Xr.h(t.highlightGroupName);this._addHighlightId(e),t.addExternal((t=>{this._removeHighlightId(t)}),e)}removeObjectState(t){this._highlights.forEach((e=>t.remove(e)))}_addHighlightId(t){this._highlights.add(t),this.instanceData.setHighlight(this.instanceIndex,!0,t.highlightGroupName)}_removeHighlightId(t){this._highlights.delete(t),this.instanceData.setHighlight(this.instanceIndex,this._highlights.size>0,t.highlightGroupName)}get _lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}get instanceData(){return this._lodRenderer.instanceData}}const Jr=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Kr=(0,p.vt)(),ts=(0,p.vt)(),es=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],is=(0,d.vt)();var rs=i(14975),ss=i(68335);function ns(t){return new ss.Fe(t.map(((t,e)=>function(t,e){const i=t.stageResources.geometries.map((e=>new ss.iC(e,t.stageResources.textures))),r=null==t.lodThreshold||0===t.lodThreshold&&e>0?function(t){const e=t.reduce(((t,e)=>t+e.numTriangles),0);return Math.sqrt(e*os/Math.PI)}(i):t.lodThreshold;return new ss.hr(i,r,t.pivotOffset)}(t,e))))}const os=20;var as=i(45869),ls=i(28828),hs=i(99039),cs=i(58916),us=i(27923),ds=i(39534),fs=i(64543);class ps{constructor(t,e,i,r,s,n,o,a,l,h,c,u){this.lodResources=t,this.lodRenderer=e,this.stageResources=i,this.originalMaterialParameters=r,this.resourceSize=s,this.isEsriSymbolResource=n,this.isWosr=o,this.resourceBoundingBox=a,this.symbolSize=l,this.extentPadding=h,this.physicalBasedRenderingEnabled=c,this.pivotOffset=u}}class ms extends C.U{getCachedSize(){const[t,e,i]=null!=this._resources?this._resources.symbolSize:[1,1,1];return{width:t,depth:e,height:i}}constructor(t,e,i,r){super(t,e,i,r),this._resources=null,this._optionalFields=new Array,this._instanceIndexToGraphicUid=new Map,this._hasLoadedPBRTextures=!1,this._disposeResourceHandles=new Array,this.skipHighSymbolLodsChanged=!1,this.ensureDrapedStatus(!1),this._hasLoadedPBRTextures=i.physicalBasedRenderingEnabled}async doLoad(t){if(!this._drivenProperties.size){const t=(0,T.Hj)(this.symbolLayer);if(t)throw new Error(t)}if(this._isPrimitive){const e=this.symbolLayer.resource,i=e&&(0,ls.k)(e?.primitive)?e.primitive:Zr.r;this._resources=await this._createResourcesForPrimitive(i,t)}else{const e=await async function(t){if(null===t||null==t.styleName&&null==t.styleUrl)return null;const e=t.name;if(null==e)throw new n.A("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference");const i={portal:t.portal},r=await(0,cs.cF)(t,i).catch((()=>null));if(null===r)return null;const s=(0,us.p)(e,r.data);if(s&&!s.formatInfos?.some((t=>"gltf_basisu"===t.type)))return null;const o=await(0,us.I)(r,e,i,"webRef",((t,e)=>(0,cs.o5)(t,e,["gltf_basisu","gltf"]))).catch((()=>null));if(null===o||"point-3d"!==o.type)return null;const a=o.symbolLayers.items[0];return"object"===a.type?a.resource:null}(this.symbol.styleOrigin),i=e?.href??this.symbolLayer.resource?.href;this._resources=await this._createResourcesForUrl(i,t)}this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity()}get extentPadding(){return null!=this._resources?this._resources.extentPadding:0}get _isPrimitive(){return!this.symbolLayer.resource?.href}get lodRenderer(){return this._resources?.lodRenderer}get materials(){return this._resources?.stageResources.materials??[]}_setMaterialTransparencyParameters(t,e=this.symbolLayer?.material?.color){const i=this._getCombinedOpacity(e),r=i<1||this.needsDrivenTransparentPass;return t.transparent=r,t.opacity=i,t.cullFace=r?rt.s2.None:rt.s2.Back,t}async _createResourcesForPrimitive(t,e){const i=this.symbolLayer,r=(0,g.vt)((0,qr.Fq)(t)),s=(0,p.ci)((0,g.Ej)(r)),n=(0,p.ci)((0,qr.Bb)(s,i)),o=(0,f.l)(n),a=this.symbolLayer?.material?.emissiveFactor,l=a?(0,f.L)((0,p.o8)(a)):p.uY,h={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,mrrFactors:br.Bt,ambient:p.Un,diffuse:p.Un,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,emissiveFactor:l,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},c=!!h.usePBR;this._setMaterialTransparencyParameters(h);const u=this.symbol;if("point-3d"===u.type&&u.verticalOffset){const{screenLength:t,minWorldLength:e,maxWorldLength:i}=u.verticalOffset;h.verticalOffset={screenLength:(0,Bt.Lz)(t),minWorldLength:e||0,maxWorldLength:null!=i?i:1/0},h.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(h.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color)h.externalColor=Wt.Un;else{const t=null!=i.material?i.material.color:null,e=null!=t?Nt.A.toUnitRGBA(t):Wt.Un;h.externalColor=e}this._fastUpdates=(0,ue.s_)(this._context.renderer,this._fastVisualVariableConvertOptions(r,n,s,null)),h.isInstanced=!0,this._fastUpdates?(Object.assign(h,this._fastUpdates.materialParameters),this._optionalFields.push(L.r.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(h.hasInstancedColor=!0,this._optionalFields.push(L.r.COLOR)),(0,ds.E)()&&this._optionalFields.push(L.r.OBJECTANDLAYERIDCOLOR);const d=new at.$U(h,this._context),m=(0,ls._)(t,d);if(!m)throw new Error(`Unknown object symbol primitive: ${t}`);const _=(0,ss.lS)(m).map((t=>({opacity:1,transparent:t.parameters.transparent}))),y=await this._createStageResources(m,c,e),v=await this._createLodRenderer(m,e);return new ps(m,v,y,_,s,!1,!1,r,n,o,c,null)}async _createResourcesForUrl(t,e){const i={isInstanced:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},r={spherical:this._context.spherical,doublePrecisionRequiresObfuscation:this._context.doublePrecisionRequiresObfuscation,materialParameters:i,streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=(0,ue.s_)(this._context.renderer,this._fastVisualVariableConvertOptions(null,null,null,null)),this._fastUpdates?(Object.assign(r.materialParameters,this._fastUpdates.materialParameters),this._optionalFields.push(L.r.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(r.materialParameters.hasInstancedColor=!0,this._optionalFields.push(L.r.COLOR)),(0,ds.E)()&&this._optionalFields.push(L.r.OBJECTANDLAYERIDCOLOR);const s=this.symbol;if("point-3d"===s.type&&s.verticalOffset){const{screenLength:t,minWorldLength:e,maxWorldLength:i}=s.verticalOffset;r.materialParameters.verticalOffset={screenLength:(0,Bt.Lz)(t),minWorldLength:e||0,maxWorldLength:null!=i?i:1/0},r.materialParameters.castShadows=!1}const n=this._context.physicalBasedRenderingEnabled;r.signal=e,r.usePBR=n,r.skipHighLods=this._context.skipHighSymbolLods;const o=await(0,as.fetch)(t,r),a=o.isEsriSymbolResource,l=o.isWosr,h=ns(o.lods),c=this._context,u=this.symbolLayer.material,d=this._getExternalColorParameters(u),m=this.symbolLayer?.material?.color,_=this._getCombinedOpacity(m,{hasIntrinsicColor:!0}),y=this.needsDrivenTransparentPass,v=(0,ss.lS)(h),x=(0,ss.lS)(h).map((t=>({opacity:t.parameters.opacity||1,transparent:t.parameters.transparent})));v.forEach((t=>{const e=t.parameters;t.setParameters(d);const i=e.opacity*_,r=i<1||y||e.transparent;t.setParameters({opacity:i,transparent:r}),c.screenSizePerspectiveEnabled&&t.setParameters({screenSizePerspective:c.sharedResources.screenSizePerspectiveSettings})}));const b=o.referenceBoundingBox,w=(0,p.ci)((0,g.Ej)(b)),P=(0,p.ci)(h.levels[0].pivotOffset),S=(0,p.ci)((0,qr.Bb)(w,this.symbolLayer)),C=(0,f.l)(S),T=this._fastUpdates;(0,ue.J_)(T,this._context.renderer,this._fastVisualVariableConvertOptions(b,S,w,P))&&v.forEach((t=>t.setParameters(T.materialParameters)));const M=await this._createStageResources(h,n,e),A=await this._createLodRenderer(h,e);return new ps(h,A,M,x,w,a,l,b,S,C,n,P)}_addDisposeResource(t){this._disposeResourceHandles.push(t)}async _createStageResources(t,e,i){const r=this._context.stage,s=(0,ss.lS)(t);e!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),r.addMany(s),this._addDisposeResource((()=>r.removeMany(s)));const n=(0,ss.n3)(t);r.addMany(n),this._addDisposeResource((()=>{n.forEach((t=>t.unload())),r.removeMany(n)})),await Promise.all(n.map((t=>this._context.stage.schedule((()=>t.load(r.renderView.renderingContext)),i)))),(0,Vt.Te)(i);const o=(0,ss.XT)(t);return r.addMany(o),this._addDisposeResource((()=>r.removeMany(o))),{materials:s,textures:n,geometries:o}}async _createLodRenderer(t,e){const i=this._context.stage,r={layerUid:this._context.layer.uid,graphicUid:t=>this._instanceIndexToGraphicUid.get(t),notifyGraphicGeometryChanged:t=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(t)),notifyGraphicVisibilityChanged:t=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(t))},s=this._fastUpdates,n=s?{applyTransform:(t,e,i)=>{t.getFeatureAttribute(e,bs),(0,u.C)(i,(0,ue.b3)(s.materialParameters,bs,i))},scaleFactor:(t,e,i)=>{e.getFeatureAttribute(i,bs),(0,ue.VC)(t,s.materialParameters,bs)}}:null,o=new fs.L({symbol:t,optionalFields:this._optionalFields,metadata:r,shaderTransformation:n},this._context.scheduler);return o.slicePlaneEnabled=this._context.slicePlaneEnabled,this._addDisposeResource((()=>{i.removeRenderPlugin(o),o.destroy()})),await i.addRenderPlugin(o,e),o}_getExternalColorParameters(t){const e={};return this._drivenProperties.color?e.externalColor=Wt.Un:null!=t?.color?e.externalColor=Nt.A.toUnitRGBA(t.color):(e.externalColor=Wt.Un,e.colorMixMode="ignore"),e}destroy(){super.destroy(),this._cleanupResources()}_cleanupResources(){this._disposeResourceHandles.forEach((t=>t())),this._disposeResourceHandles.length=0,this._resources=null}createGraphics3DGraphic(t){const e=t.graphic;if(!this._validateGeometry(e.geometry))return null;const i=(0,ce.ZX)(e.geometry);if(null==i)return this.logger.warn(`unsupported geometry type for object symbol: ${e.geometry.type}`),null;const r=this.setGraphicElevationContext(e),s=t.renderingInfo;return this._createAs3DShape(e,i,s,r,e.uid,t.layer.uid)}notifyDestroyGraphicLayer(t){this._instanceIndexToGraphicUid.delete(t.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){if(null==this._resources)return;const t=this._drivenProperties.opacity,e=!this._isPrimitive,i=this._resources.stageResources.materials,r=this._resources.originalMaterialParameters;for(let s=0;s<i.length;s++){const n=i[s],o=this.symbolLayer?.material?.color,a=r[s],l=this._getCombinedOpacity(o,{hasIntrinsicColor:e})*a.opacity,h=l<1||t||a.transparent;n.setParameters({opacity:l,transparent:h}),this._isPrimitive&&n.setParameters({cullFace:h?rt.s2.None:rt.s2.Back})}}layerElevationInfoChanged(t,e){return this.updateGraphics3DGraphicElevationInfo(t,e,P.Kf)}slicePlaneEnabledChanged(){if(null==this._resources)return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const t of this._resources.stageResources.materials)t.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if(null==this._resources)return!0;const{stageResources:t,isWosr:e}=this._resources;for(const i of t.materials)this._isPrimitive?i.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):e||i.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return!1!==this._hasLoadedPBRTextures||!0!==this._context.physicalBasedRenderingEnabled||(this._hasLoadedPBRTextures=!0,!1)}applyRendererDiff(t,e){if(null==this._resources)return M.w.RecreateSymbol;const{stageResources:{materials:i},lodRenderer:r,resourceBoundingBox:s,symbolSize:n,resourceSize:o,pivotOffset:a}=this._resources;for(const l in t.diff){if("visualVariables"!==l)return M.w.RecreateSymbol;if(!(0,ue.J_)(this._fastUpdates,e,this._fastVisualVariableConvertOptions(s,n,o,a)))return M.w.RecreateSymbol;for(const t of i)t.setParameters(this._fastUpdates.materialParameters);r.notifyShaderTransformationChanged()}return M.w.FastUpdate}computeComplexity(){if(null==this._resources)return super.computeComplexity();const t=this._resources.lodResources,e=(0,Yr.pg)(t.levels),i=(0,ss.XT)(t).reduce(((t,e)=>t+(t=>Array.from(t.attributes.values()).reduce(((t,e)=>t+(0,$r.Ek)(e.data,e.indices)),0))(e)),0),r=(0,ss.n3)(t).reduce(((t,e)=>t+e.memoryEstimate),0)+i,s={...(0,Yr.GI)(this.symbol,this.symbolLayer),resourceBytes:r};return new hs.rz({verticesPerFeature:e,memory:s})}_hasLodRenderer(){return null!=this._resources}_createAs3DShape(t,e,i,r,s,n){if(!this._hasLodRenderer()||null==this._resources)return null;const o=this.getFastUpdateAttrValues(t),a=this._context.clippingExtent;if((0,jt.g)(e,ys,this._context.elevationProvider.spatialReference),null!=a&&!(0,g.Uc)(a,ys))return null;const l=_s(r),h=this._computeGlobalTransform(e,r,xs,ws),c=this._computeLocalTransform(this._resources,this.symbolLayer,i,vs),u=this._resources.lodRenderer.instanceData,d=u.addInstance();this._instanceIndexToGraphicUid.set(d,s),u.setLocalTransform(d,c,!1),u.setGlobalTransform(d,h),o&&u.setFeatureAttribute(d,o),null==this._fastUpdates&&this._hasPerInstanceColor()&&u.setColor(d,(0,T.$C)(i.color,i.opacity,255));const f=this._context.stage.renderView.olidRenderHelper;f&&u.setObjectAndLayerIdColor(d,f.getObjectAndLayerIdColor({graphicUid:s,layerUid:n}));const p=new Qr(this,d,ie.Jf,r);return l&&(p.alignedSampledElevation=ws.sampledElevation),p.needsElevationUpdates=(0,P.Kf)(r.mode),(0,ce.d2)(p,e,this._context.elevationProvider),p}_computeGlobalTransform(t,e,i,r){return(0,P.sE)(t,this._context.elevationProvider,e,this._context.renderCoordsHelper,r),ys[0]=t.x,ys[1]=t.y,ys[2]=r.z,(0,m.l)(t.spatialReference,ys,i,this._context.renderCoordsHelper.spatialReference),i}_computeLocalTransform(t,e,i,r){return(0,u.D_)(r),this._applyObjectRotation(i,!1,r),this._applyObjectRotation(e,!0,r),this._applyObjectScale(t,i,r),this._applyAnchor(t,e,r),r}_applyObjectScale(t,e,i){if(this._fastUpdates?.requiresShaderTransformation)return;const r=this._drivenProperties.size&&e.size?e.size:t.symbolSize,s=(0,T.pW)(r,t.symbolSize,t.resourceSize,this._context.renderCoordsHelper.unitInMeters);1===s[0]&&1===s[1]&&1===s[2]||(0,u.hs)(i,i,s)}prepareSymbolLayerPatch(t){if("partial"!==t.diff.type)return;const e=t.diff.diff;this._preparePatchTransform(t,e),this._preparePatchColor(t,e)}updateGeometry(t,e){if(null==this._resources)return!0;const i=e&&(0,ce.ZX)(e);if(null==i)return!1;const r=this.getGeometryElevationMode(e);return t.elevationContext.mode===r&&(this._computeGlobalTransform(i,t.elevationContext,xs,ws),_s(t.elevationContext)&&(t.alignedSampledElevation=ws.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(t.instanceIndex,xs,!0),(0,ce.d2)(t,i,this._context.elevationProvider),!0)}_preparePatchTransform(t,e){if(!(e.heading||e.tilt||e.roll||e.width||e.height||e.depth||e.anchor||e.anchorPosition))return;if(null==this._resources)return;const i=(t,e,i)=>(null!=t&&"complete"===t.type?t.newValue:e)??i,r=i(e.heading,this.symbolLayer.heading,0),s=i(e.tilt,this.symbolLayer.tilt,0),n=i(e.roll,this.symbolLayer.roll,0),o=i(e.width,this.symbolLayer.width,void 0),a=i(e.height,this.symbolLayer.height,void 0),l=i(e.depth,this.symbolLayer.depth,void 0),h=i(e.anchor,this.symbolLayer.anchor,void 0),c=i(e.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete e.heading,delete e.tilt,delete e.roll,delete e.width,delete e.height,delete e.depth,delete e.anchor,delete e.anchorPosition;const u={heading:r,tilt:s,roll:n,anchor:h,anchorPosition:c},d=this._resources;this.loadStatus===rs.P.LOADED&&t.symbolLayerStatePatches.push((()=>{d.symbolSize=(0,p.ci)((0,qr.Bb)(d.resourceSize,{width:o,height:a,depth:l,isPrimitive:this.symbolLayer.isPrimitive}))})),t.graphics3DGraphicPatches.push(((t,e)=>{const i=this._computeLocalTransform(d,u,e,vs),r=t.instanceIndex;d.lodRenderer.instanceData.setLocalTransform(r,i,!0)}))}_preparePatchColor(t,e){if(!e.material||"partial"!==e.material.type)return;const i=e.material.diff;if(!i.color||"complete"!==i.color.type||null==i.color.newValue||null==i.color.oldValue)return;const r=i.color.newValue,s=null!=r?Nt.A.toUnitRGBA(r):Wt.Un;delete i.color;const n=this._resources;null!=n&&t.graphics3DGraphicPatches.push((t=>{let e;this._hasPerInstanceColor()?(n.lodRenderer.instanceData.setColor(t.instanceIndex,s),e=this._setMaterialTransparencyParameters({},r)):e=this._setMaterialTransparencyParameters({externalColor:s},r);for(const t of n.stageResources.materials)t.setParameters(e)}))}_applyObjectRotation(t,e,i){if(!this._fastUpdates?.requiresShaderTransformation||!e)return(0,T.$2)(t.heading,t.tilt,t.roll,i)}_applyAnchor(t,e,i){if(this._fastUpdates?.requiresShaderTransformation)return;const r=gs(t.resourceBoundingBox,t.pivotOffset,e);r&&(0,u.Tl)(i,i,r)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(t,e,i,r){const s=null!=t?(0,p.ci)((0,g.Ej)(t)):p.Un,n=null!=t?gs(t,r,this.symbolLayer):p.uY,o=this._context.renderCoordsHelper.unitInMeters,a=(0,T.pW)(null!=e?e:void 0,e,i,o),l=(0,p.fA)(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return new ue.wI({size:!0,color:!0,rotation:!0,opacity:!1},s,e??p.Un,o,n,a,l)}}function gs(t,e,i){const r=(0,p.vt)();switch(i.anchor){case"center":(0,f.c)(r,(0,g.gX)(t)),(0,f.v)(r,r);break;case"top":{const e=(0,g.gX)(t);(0,f.i)(r,-e[0],-e[1],-t[5]);break}case"bottom":{const e=(0,g.gX)(t);(0,f.i)(r,-e[0],-e[1],-t[2]);break}case"relative":{const e=(0,g.gX)(t),s=(0,g.Ej)(t),n=i.anchorPosition,o=n?(0,p.fA)(n.x,n.y,n.z):p.uY;(0,f.C)(r,s,o),(0,f.g)(r,r,e),(0,f.v)(r,r);break}default:null!=e?(0,f.v)(r,e):(0,f.c)(r,p.uY)}return r}function _s(t){return"absolute-height"!==t.mode}const ys=(0,p.vt)(),vs=(0,d.vt)(),xs=(0,d.vt)(),bs=(0,Wt.vt)(),ws=new P.Uk;var Ps=i(62880);class Ss{constructor(t,e,i,r){this.vertices=t,this.positionsES=e,this.offset=r;const s=t.length,n=Math.floor(s/2),o=this.offset+3*n,a=i[o],l=i[o+1],h=i[o+2];this.origin=(0,p.fA)(a,l,h),this.positions=(0,gi.oe)(3*s);const c=this.offset+3*s;for(let t=this.offset;t<c;t+=3)this.positions[t]=i[t]-a,this.positions[t+1]=i[t+1]-l,this.positions[t+2]=i[t+2]-h;this.updatePathVertexInformation()}get usedMemory(){return(0,$r.Ek)(this.positions)}updatePathVertexInformation(){const t=this.vertices.length,e=this.vertices[0];let i=this.offset;const r=this.positions;e.vRight[0]=r[i+3]-r[i],e.vRight[1]=r[i+4]-r[i+1],e.vRight[2]=r[i+5]-r[i+2],i+=3;let s=(0,f.l)(e.vRight);e.vMinSiblingLength=s,(0,f.n)(e.vRight,e.vRight);let n=e;for(let e=1;e<t;++e){const o=this.vertices[e];if(o.vLeft=n.vRight,e<t-1){o.vRight[0]=r[i+3]-r[i],o.vRight[1]=r[i+4]-r[i+1],o.vRight[2]=r[i+5]-r[i+2];const t=(0,f.l)(o.vRight);o.vMinSiblingLength=Math.min(s,t),s=t,(0,f.n)(o.vRight,o.vRight)}else(0,f.c)(o.vRight,o.vLeft),o.vMinSiblingLength=s;n=o,i+=3}}}class Cs{constructor(t,e,i,r,s,n={}){this.path=t,this.profile=e,this.extruder=i,this.startCap=r,this.endCap=s,this.options=n,this._extrusionVertexCount=0;const o=this.path.vertices.length-2;this.numExtrusionProfiles=i.numProfilesPerJoin()*o+2,this.numVerticesTotal=e.vertices.length*this.numExtrusionProfiles,this.startCap.vertexBufferStart=this.numVerticesTotal;const a=this.startCap.numVertices;this.numVerticesTotal+=a,this.endCap.vertexBufferStart=this.numVerticesTotal;const l=this.endCap.numVertices;this.numVerticesTotal+=l,this.pathVertexData=(0,y.JH)(1*this.numVerticesTotal),this.profileRightAxes=(0,gi.oe)(4*this.numVerticesTotal),this.profileUpAxes=(0,gi.oe)(4*this.numVerticesTotal),this.profileVertexAndNormals=(0,gi.oe)(4*this.numVerticesTotal),this.positions=(0,gi.AK)(t.positions,t.offset,3*t.vertices.length),this._rebuildGeometry(),this.buildTopology()}get usedMemory(){return(0,$r.Ek)(this.pathVertexData,this.profileRightAxes,this.profileUpAxes,this.profileVertexAndNormals)+this.path.usedMemory+this.profile.usedMemory}emitVertex(t,e,i,r,s){const n=4*this._extrusionVertexCount;if(this.profileRightAxes[n]=e.right[0],this.profileRightAxes[n+1]=e.right[1],this.profileRightAxes[n+2]=e.right[2],this.profileUpAxes[n]=e.up[0],this.profileUpAxes[n+1]=e.up[1],this.profileUpAxes[n+2]=e.up[2],this.profileVertexAndNormals[n]=i[0],this.profileVertexAndNormals[n+1]=i[1],this.profileVertexAndNormals[n+2]=r[0],this.profileVertexAndNormals[n+3]=r[1],this.pathVertexData[this._extrusionVertexCount]=t,s){const e=this.path.vertices[t],i=e.maxStretchDistance;this.profileRightAxes[n+3]=e.rotationRight[0]*i,this.profileUpAxes[n+3]=e.rotationRight[1]*i}else this.profileRightAxes[n+3]=0,this.profileUpAxes[n+3]=0;++this._extrusionVertexCount}emitCapVertex(t,e,i,r,s,n){const o=4*this._extrusionVertexCount;this.profileRightAxes[o]=e.right[0],this.profileRightAxes[o+1]=e.right[1],this.profileRightAxes[o+2]=e.right[2],this.profileRightAxes[o+3]=s,this.profileUpAxes[o]=e.up[0],this.profileUpAxes[o+1]=e.up[1],this.profileUpAxes[o+2]=e.up[2],this.profileUpAxes[o+3]=n,this.profileVertexAndNormals[o]=i[0],this.profileVertexAndNormals[o+1]=i[1],this.profileVertexAndNormals[o+2]=r[0],this.profileVertexAndNormals[o+3]=r[1],this.pathVertexData[this._extrusionVertexCount]=t,++this._extrusionVertexCount}_rebuildGeometry(){this._extrusionVertexCount=0;const{positions:t,offset:e,vertices:i}=this.path;this.positions=(0,gi.AK)(t,e,3*i.length);let r=0;const s=(t,e,i,s,n)=>this.emitCapVertex(r,t,e,i,s,n),n=(t,e,i,s)=>this.emitVertex(r,t,e,i,s);for(this.startCap.rebuildConnectingProfileGeometry(i[r],this.profile,s),r=1;r<i.length-1;++r)this.extruder.extrude(i[r],this.profile,n);this.endCap.rebuildConnectingProfileGeometry(i[r],this.profile,s),r=0,this.startCap.rebuildCapGeometry(i[r],s),r=i.length-1,this.endCap.rebuildCapGeometry(i[r],s)}buildTopology(){const t=this.profile.vertices.length,e=this.profile.numSegments,i=this.numExtrusionProfiles-1;let r=e*i*2*3;this.startCap.indexBufferStart=r,this.startCap.firstProfileVertexIndex=0,r+=this.startCap.numIndices,this.endCap.indexBufferStart=r,this.endCap.firstProfileVertexIndex=t*(this.numExtrusionProfiles-1);const s=new Array,n=new Array,o=new Array,a=(t,e,i)=>{s.push(t),s.push(e),s.push(i),n.push(t),n.push(e),n.push(i),o.push(this.pathVertexData[t]),o.push(this.pathVertexData[e]),o.push(this.pathVertexData[i])};for(let r=0;r<e;++r){const e=this.profile.indices[2*r],s=this.profile.indices[2*r+1];for(let r=0;r<i;++r){const i=r*t+e,n=(r+1)*t+s,o=r*t+s;a(i,(r+1)*t+e,n),a(i,n,o)}}this.startCap.buildTopology(this.path.vertices[0],a),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],a),this.vertexIndices=(0,y.Dg)(s),this.normalIndices=(0,y.Dg)(n),this.pathVertexIndices=(0,y.Dg)(o)}onPathChanged(){this._rebuildGeometry()}}class Ts{rebuildConnectingProfileGeometry(t,e,i){for(let r=0;r<e.vertices.length;++r)i(t.frame,e.vertices[r],e.normals[r],0,0)}}class Ms extends Ts{constructor(){super(),this.numVertices=0,this.numIndices=0}rebuildCapGeometry(){}buildTopology(){}}class As extends Ts{constructor(t,e=0,i=!1){super(),this.profile=t,this.profilePlaneOffset=e,this.flip=i}get numVertices(){return this.profile.vertices.length}get numIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(t,e,i){const r=this.profilePlaneOffset;for(let s=0;s<e.vertices.length;++s)i(t.frame,e.vertices[s],e.normals[s],r,0)}rebuildCapGeometry(t,e){const i=this.profile,r=this.flip?1:-1,s=this.profilePlaneOffset,n=Is;(0,Ui.hZ)(n,0,0);for(let o=0;o<i.vertices.length;++o)e(t.frame,i.vertices[o],n,s,r)}buildTopology(t,e){const i=this.profile,r=this.vertexBufferStart+i.indices[0];for(let t=1;t<i.numSegments;++t){const s=i.indices[2*t],n=i.indices[2*t+1],o=this.vertexBufferStart+s,a=this.vertexBufferStart+n;this.flip?e(a,o,r):e(r,o,a)}}}class Rs extends Ts{constructor(t){super(),this.flip=!1,this.sign=0,this.breakNormals=!1,this.numSegments=3,this.profile=t.profile,this.flip=t.flip,this.sign=this.flip?1:-1,this.breakNormals=t.breakNormals,this.numSegments=t.subdivisions}get numVertices(){let t=this.profile.vertices.length*(this.numSegments-1)+this.profile.poles.length;return this.breakNormals&&(t+=this.profile.vertices.length),t}get numIndices(){let t=0;const e=this.profile;t+=2*e.numSegments*(this.numSegments-1);for(let i=0;i<e.numSegments;++i){const r=e.indices[2*i],s=e.indices[2*i+1];e.poleIndices[r]===e.poleIndices[s]?t+=1:t+=2}return 3*t}rebuildCapGeometry(t,e){const i=this.profile,r=t.frame,s=.5*this.sign,n=Os,o=Is;(0,Ui.hZ)(o,0,0);for(const t of i.poles)t.normal?e(r,t.position,t.normal,s,0):e(r,t.position,o,s,this.sign);if(this.breakNormals)for(let t=0;t<i.vertices.length;++t)e(r,i.vertices[t],i.normals[t],0,0);for(let t=0;t<this.numSegments-1;++t){const a=(1-(t+1)/this.numSegments)*Math.PI*.5,l=Math.sin(a),h=Math.cos(a);for(let t=0;t<i.vertices.length;++t){const a=i.poles[i.poleIndices[t]];(0,Ui.Re)(n,i.vertices[t],a.position),(0,Ui.hs)(n,n,l),a.normal?((0,Ui.WQ)(n,n,a.position),e(r,n,a.normal,s*h,0)):((0,Ui.S8)(o,n),(0,Ui.hs)(o,o,l),(0,Ui.WQ)(n,n,a.position),e(r,n,o,s*h,this.sign*h))}}}buildTopology(t,e){const i=this.profile,r=this.breakNormals?this.vertexBufferStart+i.poles.length:this.firstProfileVertexIndex,s=this.breakNormals?this.vertexBufferStart+i.poles.length+i.vertices.length:this.vertexBufferStart+i.poles.length;for(let t=0;t<i.numSegments;++t){const n=i.indices[2*t],o=i.indices[2*t+1],a=this.vertexBufferStart+i.poleIndices[n],l=this.vertexBufferStart+i.poleIndices[o];let h=r+n,c=r+o;for(let t=0;t<this.numSegments-1;++t){const r=s+t*i.vertices.length+n,a=s+t*i.vertices.length+o;this.flip?(e(r,c,h),e(c,r,a)):(e(h,c,r),e(a,r,c)),h=r,c=a}this.flip?(e(a,c,h),a!==l&&e(a,l,c)):(e(h,c,a),a!==l&&e(c,l,a))}}}const Os=(0,Ht.vt)(),Is=(0,Ht.vt)();class Es{numProfilesPerJoin(){return 1}extrude(t,e,i){for(let r=0;r<e.vertices.length;++r)i(t.frame,e.vertices[r],e.normals[r],!1)}}class Ls{constructor(t,e){this.cutoffAngle=t,this.numBendSubdivisions=e}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(t,e,i){const r=ks,{rotationAngle:s,rotationRight:n,frame:o}=t;if(Math.abs(s)>=this.cutoffAngle){const a=t.rotationFrameUp;for(let l=0;l<this.numBendSubdivisions+1;++l){(0,u.$0)(Fs,.5*-s+l*s/this.numBendSubdivisions,a),zs(r,o,Fs);for(let a=0;a<e.vertices.length;++a)(0,Ui.Om)(e.vertices[a],n)*s>=0?i(r,e.vertices[a],e.normals[a],!1):i(o,t.applyMiterStretch(Ns,e.vertices[a]),e.normals[a],!0)}}else for(let r=0;r<this.numBendSubdivisions+1;++r)for(let r=0;r<e.vertices.length;++r){const a=(0,Ui.Om)(e.vertices[r],n)*s>=0;i(o,t.applyMiterStretch(Ns,e.vertices[r]),e.normals[r],!a)}}}class Ds{constructor(){this.up=(0,p.vt)(),this.right=(0,p.vt)()}}function zs(t,e,i){(0,f.t)(t.up,e.up,i),(0,f.t)(t.right,e.right,i)}const Ns=(0,Ht.vt)(),Fs=(0,d.vt)(),ks=new Ds;class Vs extends E.V{constructor(t,e,i,r,s,n){super(t,e,null,I.X.Mesh,n),this.path=i,this.geometrySR=r,this.stencilWidth=s}}var Bs;function Us(t){return"path"in t}!function(t){t[t.World=0]="World",t[t.Path=1]="Path"}(Bs||(Bs={}));var Gs=i(45079);class Hs{constructor(t){this.builder=t}onPathChanged(t){this.builder.onPathChanged()}}class Ws extends Hs{constructor(t){super(t),this.vertexAttributeColor=(0,Wt.fA)(255,255,255,255),this.size=new Array,this.vertexAttributePosition=(0,gi.oe)(3*this.builder.numVerticesTotal),this.vertexAttributeNormal=new Int16Array(2*this.builder.numVerticesTotal)}bakeVertexColors(t){this.vertexAttributeColor[0]=255*t[0],this.vertexAttributeColor[1]=255*t[1],this.vertexAttributeColor[2]=255*t[2],this.vertexAttributeColor[3]=255*(t.length>3?t[3]:1)}bake(t){this.size=t;const{numVerticesTotal:e,pathVertexData:i,path:r,positions:s,profileRightAxes:n,profileUpAxes:o,profileVertexAndNormals:a}=this.builder;for(let l=0;l<e;++l){let e=i[l];const h=0===e||e===r.vertices.length-1;e*=3;const c=Xs;let u=0,d=0;const p=4*l,m=(0,f.i)(Qs,n[p],n[p+1],n[p+2]),g=(0,f.i)(Js,o[p],o[p+1],o[p+2]),_=(0,Ui.hZ)($s,a[p]*t[0],a[p+1]*t[1]);if(h)(0,f.e)(c,g,m),u=n[p+3]*t[0],d=o[p+3];else{const t=Zs,e=qs;(0,Ui.hZ)(t,n[p+3],o[p+3]);const i=(0,Ui.Bw)(t);(0,Ui.S8)(t,t);const r=(0,Ui.Om)(_,t);if(Math.abs(r)>i){(0,Ui.hZ)(e,-t[1],t[0]);const s=(0,Ui.Om)(_,e);(0,Ui.hs)(t,t,i*Math.sign(r)),(0,Ui.hs)(e,e,s),(0,Ui.WQ)(_,t,e)}(0,f.i)(c,0,0,0)}const y=(0,f.i)(Ys,m[0]*_[0]+g[0]*_[1],m[1]*_[0]+g[1]*_[1],m[2]*_[0]+g[2]*_[1]),v=3*l;this.vertexAttributePosition[v]=s[e]+y[0]+c[0]*u,this.vertexAttributePosition[v+1]=s[e+1]+y[1]+c[1]*u,this.vertexAttributePosition[v+2]=s[e+2]+y[2]+c[2]*u;const x=(0,Ui.hZ)($s,a[p+2],a[p+3]);(0,nt.aT)(this.vertexAttributeNormal,l,m[0]*x[0]+g[0]*x[1]+c[0]*d,m[1]*x[0]+g[1]*x[1]+c[1]*d,m[2]*x[0]+g[2]*x[1]+c[2]*d)}}createGeometryData(){const t=this.builder.vertexIndices.length,{normalIndices:e,vertexIndices:i}=this.builder;return[[L.r.POSITION,new O.n(this.vertexAttributePosition,i,3,!0)],[L.r.NORMALCOMPRESSED,new O.n(this.vertexAttributeNormal,e,2,!0)],[L.r.COLOR,new O.n(this.vertexAttributeColor,(0,y.EH)(t),4)]]}onPathChanged(t){super.onPathChanged(t),this.bake(this.size)}intersect(t,e,i,r){const s=this.builder.vertexIndices,n=new O.K(this.vertexAttributePosition,3),o=s.length/3;(0,Gs.Z$)(t,e,0,o,s,n,void 0,i,((t,e,i)=>r(t,i,e,!1)))}}class js extends Hs{constructor(t,e,i,r){super(t),this.sizeAttributeValue=e,this.colorAttributeValue=i,this.opacityAttributeValue=r,this.vvData=null,this.baked=new Ws(t),this.vvData=(0,gi.oe)(4*this.builder.path.vertices.length);for(let t=0;t<this.builder.path.vertices.length;++t){this.vvData[4*t]=e,this.vvData[4*t+1]=i,this.vvData[4*t+2]=r;const s=0===t||t===this.builder.path.vertices.length-1;this.vvData[4*t+3]=s?1:0}}createGeometryData(){const{positions:t,profileRightAxes:e,profileUpAxes:i,profileVertexAndNormals:r,pathVertexIndices:s,vertexIndices:n}=this.builder;return[[L.r.POSITION,new O.n(t,s,3,!0)],[L.r.PROFILERIGHT,new O.n(e,n,4,!0)],[L.r.PROFILEUP,new O.n(i,n,4,!0)],[L.r.PROFILEVERTEXANDNORMAL,new O.n(r,n,4,!0)],[L.r.FEATUREVALUE,new O.n(this.vvData,s,4,!0)]]}onPathChanged(t){super.onPathChanged(t);const e=t.getMutableAttribute(L.r.POSITION);e&&(e.data=this.builder.positions)}}const $s=(0,Ht.vt)(),Zs=(0,Ht.vt)(),qs=(0,Ht.vt)(),Ys=(0,p.vt)(),Xs=(0,p.vt)(),Qs=(0,p.vt)(),Js=(0,p.vt)();var Ks=i(79578);const tn=(0,p.vt)();class en{constructor(){this.vertices=new Array,this.normals=new Array,this.indices=new Array,this.poles=new Array,this.poleIndices=new Array}addVertex(t,e){return this.vertices.push((0,Ht.o8)(t)),this.normals.push((0,Ht.o8)(e)),this.vertices.length-1}addPole(t,e=null){return this.poles.push({position:(0,Ht.o8)(t),normal:e?(0,Ht.o8)(e):null}),this.poles.length-1}addSegment(t,e=null){this.indices.push(t.v0),this.indices.push(t.v1),e&&(this.poleIndices.push(e.v0),this.poleIndices.push(e.v1))}get numSegments(){return this.indices.length/2}translate(t,e){for(const i of this.vertices)i[0]+=t,i[1]+=e;for(const i of this.poles)i.position[0]+=t,i.position[1]+=e}get usedMemory(){return this.vertices.length*(0,$r.Ek)(this.vertices[0])*2+(0,$r.Ek)(this.indices)}}const rn={top:[0,-.5],bottom:[0,.5]};function sn(t){const e=Ps.ZC,i=new en,r={v0:0,v1:0};i.addPole((0,Ht.fA)(0,0));for(let t=0;t<e;++t){const r=2*t*Math.PI/e,s=Math.cos(r),n=Math.sin(r),o=(0,Ht.fA)(.5*s,.5*n),a=(0,Ht.fA)(s,n);i.addVertex(o,a)}for(let t=0;t<e-1;++t){const e={v0:t,v1:t+1};i.addSegment(e,r)}const s={v0:e-1,v1:0};if(i.addSegment(s,r),"center"!==t){const e=rn[t];i.translate(e[0],e[1])}return i}const nn={center:sn("center"),top:sn("top"),bottom:sn("bottom")},on={center:an("center"),top:an("top"),bottom:an("bottom")};function an(t){const e=new en,i=(0,Ht.fA)(-.5,-.5),r=(0,Ht.fA)(.5,-.5),s=(0,Ht.fA)(.5,.5),n=(0,Ht.fA)(-.5,.5),o=(0,Ht.fA)(0,-1),a=(0,Ht.fA)(1,0),l=(0,Ht.fA)(0,1),h=(0,Ht.fA)(-1,0);if(e.addPole((0,Ht.fA)(0,.5),l),e.addPole((0,Ht.fA)(0,.5)),e.addPole((0,Ht.fA)(0,-.5)),e.addPole((0,Ht.fA)(0,-.5),o),e.addVertex(i,o),e.addVertex(r,o),e.addSegment({v0:0,v1:1},{v0:3,v1:3}),e.addVertex(r,a),e.addVertex(s,a),e.addSegment({v0:2,v1:3},{v0:2,v1:1}),e.addVertex(s,l),e.addVertex(n,l),e.addSegment({v0:4,v1:5},{v0:0,v1:0}),e.addVertex(n,h),e.addVertex(i,h),e.addSegment({v0:6,v1:7},{v0:1,v1:2}),"center"!==t){const i=rn[t];e.translate(i[0],i[1])}return e}var ln=i(8527);function hn(t,e,i,r,s){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t}function cn(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=i[0],l=i[1],h=i[2],c=i[3];return t[0]=r*a+n*l,t[1]=s*a+o*l,t[2]=r*h+n*c,t[3]=s*h+o*c,t}function un(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}const dn=cn,fn=un;Object.freeze(Object.defineProperty({__proto__:null,LDU:function(t,e,i,r){return t[2]=r[2]/r[0],i[0]=r[0],i[1]=r[1],i[3]=r[3]-t[2]*i[1],[t,e,i]},add:function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},adjoint:function(t,e){const i=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=i,t},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},determinant:function(t){return t[0]*t[3]-t[2]*t[1]},equals:function(t,e){const i=t[0],r=t[1],s=t[2],n=t[3],o=e[0],a=e[1],l=e[2],h=e[3],c=(0,ln.FD)();return Math.abs(i-o)<=c*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-a)<=c*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(s-l)<=c*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-h)<=c*Math.max(1,Math.abs(n),Math.abs(h))},exactEquals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},frob:function(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2)},fromRotation:function(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=-i,t[3]=r,t},fromScaling:function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},invert:function(t,e){const i=e[0],r=e[1],s=e[2],n=e[3];let o=i*n-s*r;return o?(o=1/o,t[0]=n*o,t[1]=-r*o,t[2]=-s*o,t[3]=i*o,t):null},mul:dn,multiply:cn,multiplyScalar:function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},multiplyScalarAndAdd:function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t},rotate:function(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l+n*a,t[1]=s*l+o*a,t[2]=r*-a+n*l,t[3]=s*-a+o*l,t},scale:function(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=i[0],l=i[1];return t[0]=r*a,t[1]=s*a,t[2]=n*l,t[3]=o*l,t},set:hn,str:function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},sub:fn,subtract:un,transpose:function(t,e){if(t===e){const i=e[1];t[1]=e[2],t[2]=i}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t}},Symbol.toStringTag,{value:"Module"})),Object.freeze(Object.defineProperty({__proto__:null,clone:function(t){return[t[0],t[1],t[2],t[3]]},create:function(){return[1,0,0,1]},createView:function(t,e){return new Float64Array(t,e,4)},fromValues:function(t,e,i,r){return[t,e,i,r]}},Symbol.toStringTag,{value:"Module"}));class pn{constructor(){this.vLeft=(0,p.vt)(),this.vRight=(0,p.vt)(),this.vMinSiblingLength=0,this.frame=new Ds}setFrameFromUpVector(t){(0,f.c)(this.frame.up,t),(0,f.g)(Tn,this.vLeft,this.vRight),(0,f.n)(Tn,Tn),(0,f.h)(Cn,this.frame.up,(0,f.f)(Tn,this.frame.up)),(0,f.d)(Mn,Tn,Cn),(0,f.n)(Mn,Mn),(0,f.e)(this.frame.right,Mn,this.frame.up)}get foldingAngle(){return Math.PI-this.rotationAngle}}class mn extends pn{get rotationFrameUp(){return this.frame.up}get rotationRight(){return Ht.Cw}get rotationAngle(){return(0,f.h)(Pn,this.frame.up,(0,f.f)(this.frame.up,this.vLeft)),(0,f.d)(Pn,this.vLeft,Pn),(0,f.v)(Pn,Pn),(0,f.n)(Pn,Pn),(0,f.h)(Sn,this.frame.up,(0,f.f)(this.frame.up,this.vRight)),(0,f.d)(Sn,this.vRight,Sn),(0,f.n)(Sn,Sn),(0,f.e)(wn,this.rotationFrameUp,this.vLeft),Math.sign((0,f.f)(wn,this.vRight))*(Math.PI-(0,fi.XM)((0,f.f)(Pn,Sn)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength/Math.cos(.5*this.foldingAngle))}applyMiterStretch(t,e){const i=this.rotationAngle;if(Math.abs(i)<=0)return e;const r=(0,fi.J_)(Math.cos(.5*i));return(0,Ui.hZ)(t,(r-1+1)*e[0],e[1])}}class gn extends pn{get rotationFrameUp(){const t=Math.sign((0,f.f)(this.frame.right,this.vRight));return(0,f.e)(yn,this.vRight,this.vLeft),(0,f.h)(yn,yn,t),(0,f.n)(yn,yn)}get rotationRight(){const t=this.rotationFrameUp,e=(0,f.f)(t,this.frame.up),i=(0,f.f)(t,this.frame.right);return(0,f.h)(xn,this.frame.up,-i),(0,f.h)(bn,this.frame.right,e),(0,f.g)(xn,xn,bn),(0,f.n)(xn,xn),function(t,e,i){(0,Ui.hZ)(t,(0,f.f)(i,e.right),(0,f.f)(i,e.up))}(vn,this.frame,xn),vn}get rotationAngle(){const t=Math.sign((0,f.f)(this.frame.right,this.vRight));return(0,f.v)(wn,this.vLeft),-t*(Math.PI-(0,fi.XM)((0,f.f)(wn,this.vRight)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength*(0,fi.J_)(Math.cos(.5*this.foldingAngle)))}applyMiterStretch(t,e){const i=this.rotationAngle;if(0===Math.abs(i))return e;const r=(0,fi.J_)(Math.cos(.5*i)),s=this.rotationRight,n=hn(An,1+(r-1)*s[0]*s[0],(r-1)*s[0]*s[1],(r-1)*s[0]*s[1],1+(r-1)*s[1]*s[1]);return(0,Ui.ZF)(t,e,n)}}function _n(t){switch(t){case Bs.World:return new mn;case Bs.Path:return new gn}}const yn=(0,p.vt)(),vn=(0,Ht.vt)(),xn=(0,p.vt)(),bn=(0,p.vt)(),wn=(0,p.vt)(),Pn=(0,p.vt)(),Sn=(0,p.vt)(),Cn=(0,p.vt)(),Tn=(0,p.vt)(),Mn=(0,p.vt)(),An=[1,0,0,1];var Rn=i(38130),On=i(50865),In=i(11520),En=i(26762),Ln=i(54840),Dn=i(39387);class zn extends En.W{constructor(){super(...arguments),this.ambient=(0,p.CN)(.2,.2,.2),this.diffuse=(0,p.CN)(.8,.8,.8),this.specular=(0,p.CN)(0,0,0),this.opacity=1,this.origin=(0,p.vt)(),this.modelTransformation=null,this.mrrFactors=br.mb,this.emissiveFactor=p.uY,this.texture=null,this.textureNormal=null,this.textureEmissive=null,this.textureOcclusion=null,this.textureMetallicRoughness=null}}class Nn extends Ge.w{constructor(t,e,r){super(t,e,new Ue.$(Dn.P,(()=>i.e(2641).then(i.bind(i,17003)))),r,Fn)}initializePipeline(t){const{output:e,transparent:i,hasSlicePlane:r,doubleSidedMode:s,hasOccludees:n,oitPass:o}=t,a=o===Ln.Y.NONE,l=o===Ln.Y.FrontFace;return(0,qe.Ey)({blending:(0,ze.RN)(e)&&i?(0,He.Yf)(o):null,culling:r&&!i&&s!==On.W.None?qe.hG:null,depthTest:{func:(0,He.K_)(o)},depthWrite:a||l?qe.Uy:null,drawBuffers:e===ze.V.Depth?{buffers:[Ze.Hr.NONE]}:(0,He.m6)(o,e),colorWrite:qe.kn,stencilWrite:n?We.v0:null,stencilTest:n?We.qh:null,polygonOffset:a||l?null:He.SE})}}const Fn=new Map([[L.r.POSITION,0],[L.r.PROFILERIGHT,1],[L.r.PROFILEUP,2],[L.r.PROFILEVERTEXANDNORMAL,3],[L.r.FEATUREVALUE,4],[L.r.OBJECTANDLAYERIDCOLOR,5]]);var kn=i(2457);class Vn extends Ki.E{constructor(t,e){super(),this.spherical=t,this.doublePrecisionRequiresObfuscation=e,this.pbrMode=In.A9.Disabled,this.doubleSidedMode=On.W.None,this.emissionSource=Rn.ZX.None,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.textureCoordinateType=kn.I.None,this.occlusionPass=!1,this.hasVvInstancing=!0,this.useCustomDTRExponentForWater=!1,this.useFillLights=!1,this.hasColorTexture=!1,this.objectAndLayerIdColorInstanced=!1,this.hasMetallicRoughnessTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1}get discardInvisibleFragments(){return this.transparent}}(0,Qi._)([(0,Ji.W)({count:In.A9.COUNT})],Vn.prototype,"pbrMode",void 0),(0,Qi._)([(0,Ji.W)({count:On.W.COUNT})],Vn.prototype,"doubleSidedMode",void 0),(0,Qi._)([(0,Ji.W)({count:Rn.ZX.COUNT})],Vn.prototype,"emissionSource",void 0),(0,Qi._)([(0,Ji.W)()],Vn.prototype,"receiveShadows",void 0),(0,Qi._)([(0,Ji.W)()],Vn.prototype,"receiveAmbientOcclusion",void 0),(0,Qi._)([(0,Ji.W)()],Vn.prototype,"vvSize",void 0),(0,Qi._)([(0,Ji.W)()],Vn.prototype,"vvColor",void 0),(0,Qi._)([(0,Ji.W)()],Vn.prototype,"vvOpacity",void 0),(0,Qi._)([(0,Ji.W)()],Vn.prototype,"hasSlicePlane",void 0),(0,Qi._)([(0,Ji.W)()],Vn.prototype,"transparent",void 0),(0,Qi._)([(0,Ji.W)()],Vn.prototype,"hasOccludees",void 0),(0,Qi._)([(0,Ji.W)()],Vn.prototype,"terrainDepthTest",void 0),(0,Qi._)([(0,Ji.W)()],Vn.prototype,"cullAboveTerrain",void 0);class Bn extends ke.im{constructor(t,e){super(t,Hn),this._vertexBufferLayout=function(){const t=(0,De.BP)().vec3f(L.r.POSITION).vec4f(L.r.PROFILERIGHT).vec4f(L.r.PROFILEUP).vec4f(L.r.PROFILEVERTEXANDNORMAL).vec4f(L.r.FEATUREVALUE);return(0,ds.E)()&&t.vec4u8(L.r.OBJECTANDLAYERIDCOLOR),t}(),this.vertexAttributeLocations=Fn,this.supportsEdges=!0,this.produces=new Map([[Ve.N.OPAQUE_MATERIAL,t=>(this.parameters.castShadows&&(0,ze.PJ)(t)||(0,ze.iq)(t))&&!this.parameters.transparent],[Ve.N.TRANSPARENT_MATERIAL,t=>(this.parameters.castShadows&&(0,ze.PJ)(t)||(0,ze.iq)(t))&&this.parameters.transparent]]),this._configuration=new Vn(e.spherical,e.doublePrecisionRequiresObfuscation)}get hasEmissions(){return!(0,f.p)(this.parameters.emissiveFactor,p.uY)}getConfiguration(t,e){return this._configuration.output=t,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasOccludees=e.hasOccludees,(0,ze.RN)(t)&&(this._configuration.doubleSidedMode=this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?On.W.View:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?On.W.WindingOrder:On.W.None,this._configuration.receiveShadows=e.shadowMap.enabled,this._configuration.receiveAmbientOcclusion=null!=e.ssao),this._configuration.pbrMode=this.parameters.usePBR?In.A9.Schematic:In.A9.Disabled,this._configuration.emissionSource=this.parameters.usePBR?Rn.ZX.Value:Rn.ZX.None,this._configuration.oitPass=e.oitPass,this._configuration.terrainDepthTest=e.terrainDepthTest,this._configuration.cullAboveTerrain=e.cullAboveTerrain,this._configuration}isVisibleForOutput(t){return t!==ze.V.Shadow&&t!==ze.V.ShadowExcludeHighlight&&t!==ze.V.ShadowHighlight||this.parameters.castShadows}get visible(){return this.parameters.opacity>=Ne.Q}intersect(t,e,i,r,s,n){const o=t;if(!Us(o))return;const a=o.path,l=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSize){const{offset:t,factor:e,minSize:i,maxSize:r}=this.parameters.vvSize,s=a.sizeAttributeValue;l[0]*=(0,fi.qE)(t[0]+s*e[0],i[0],r[0]),l[1]*=(0,fi.qE)(t[2]+s*e[2],i[2],r[2])}const h=new Gs.JG(!1,i.options.normalRequired),c=Math.max(l[0],l[1]),u=t.boundingInfo;if(null==u)return void Gn(a,l,r,s,h,n);const d=(0,g.fA)(u.bbMin[0]-c,u.bbMin[1]-c,u.bbMin[2]-c,u.bbMax[0]+c,u.bbMax[1]+c,u.bbMax[2]+c),f=[s[0]-r[0],s[1]-r[1],s[2]-r[2]],p=Math.sqrt(f[0]*f[0]+f[1]*f[1]+f[2]*f[2]),m=[p/f[0],p/f[1],p/f[2]];(0,Gs.Wb)(d,r,m,i.tolerance)&&Gn(a,l,r,s,h,n)}createBufferWriter(){return new Zi.Z(this._vertexBufferLayout)}createGLMaterial(t){return new Un(t)}}class Un extends ji.A{beginSlot(t){return this.acquireTechnique(Nn,t)}}function Gn(t,e,i,r,s,n){t.baked.size&&t.baked.size[0]===e[0]&&t.baked.size[1]===e[1]||t.baked.bake(e),t.baked.intersect(i,r,s,n)}class Hn extends zn{constructor(){super(...arguments),this.doubleSided=!1,this.doubleSidedType="normal",this.castShadows=!0,this.hasSlicePlane=!1,this.transparent=!1,this.usePBR=!1}}const Wn=["polyline"];class jn extends C.U{constructor(t,e,i,r){super(t,e,i,r),this._intrinsicSize=(0,Ht.fA)(1,1),this._upVectorAlignment=Bs.Path,this._stencilWidth=.1,this.usedMemory=0,this.ensureDrapedStatus(!1)}async doLoad(){const t=null!=this.symbolLayer.width?this.symbolLayer.width:this.symbolLayer.height,e=null!=this.symbolLayer.height?this.symbolLayer.height:t;this._vvConvertOptions=new ue.wI({size:!0,color:!0,rotation:!1,opacity:!0},[1,1,1],[t,1,e],this._context.renderCoordsHelper.unitInMeters);const i=this._context.renderer?.visualVariables;this._fastUpdates=i?.length?(0,ue.s_)(this._context.renderer,this._vvConvertOptions):null;const r=this.symbolLayer.anchor||"center";this._upVectorAlignment="heading"===this.symbolLayer.profileRotation?Bs.World:Bs.Path;const s=this.symbolLayer.profile||"circle";switch(s){default:case"circle":this._profile=nn[r];break;case"quad":this._profile=on[r]}switch(this.symbolLayer.join){case"round":this._extruder=new Ls(0,Ps.kf);break;case"bevel":this._extruder=new Ls(0,1);break;case"miter":this._extruder=new Ls(.8*Math.PI,1);break;default:this._extruder=new Es}const o=this.symbolLayer.cap||"butt";switch(o){case"none":this._startCap=new Ms,this._endCap=new Ms;break;case"butt":default:this._startCap=new As(this._profile,0),this._endCap=new As(this._profile,0,!0);break;case"square":this._startCap=new As(this._profile,-.5),this._endCap=new As(this._profile,.5,!0);break;case"round":{const t="quad"===s;this._startCap=new Rs({profile:this._profile,flip:!1,breakNormals:t,subdivisions:Ps.RL}),this._endCap=new Rs({profile:this._profile,flip:!0,breakNormals:t,subdivisions:Ps.RL});break}}const a=this.symbolLayer?.material?.emissiveFactor,l=a?(0,f.L)((0,p.o8)(a)):p.uY,h=this.symbolLayer?.material?.color,c=this._getCombinedOpacityAndColor(h),u=(0,p.ci)(c),d=c[3],m=d<1||this.needsDrivenTransparentPass,g={diffuse:u,ambient:u,emissiveFactor:l,opacity:d,transparent:m,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:m||"none"===o?rt.s2.None:rt.s2.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&((0,Ui.hZ)(this._intrinsicSize,t,e),!(0,T.Mh)(this._intrinsicSize[0])||!(0,T.Mh)(this._intrinsicSize[1])))throw new n.A("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");if(this._fastUpdates?.visualVariables.size||(0,Ui.hs)(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters),this._fastUpdates){const t={...g,...this._fastUpdates.materialParameters,size:(0,Ht.ci)(this._intrinsicSize)};this._materials[0]=new Bn(t,this._context)}else g.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,g.normalType=it.W.Compressed,this._materials[0]=new at.$U(g,this._context);this._materials[0].setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._context.stage.add(this._materials[0])}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials.length=0}createGraphics3DGraphic(t){const e=t.graphic;if(!this._validateGeometry(e.geometry,Wn,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(e),r=t.renderingInfo;return this._createAs3DShape(e,r,i,e.uid)}layerOpacityChanged(){const t=this.symbolLayer?.material?.color,e=this._getCombinedOpacity(t),i=e<1||this.needsDrivenTransparentPass;this._materials[0]?.setParameters({opacity:e,transparent:i})}layerElevationInfoChanged(t,e){return this.updateGraphics3DGraphicElevationInfo(t,e,P.Kf)}slicePlaneEnabledChanged(){return this._materials[0]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return this._materials[0]?.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}applyRendererDiff(t,e){for(const i in t.diff){if("visualVariables"!==i)return M.w.RecreateSymbol;if(!(0,ue.J_)(this._fastUpdates,e,this._vvConvertOptions))return M.w.RecreateSymbol;this._materials[0]?.setParameters(this._fastUpdates.materialParameters)}return M.w.FastUpdate}_getVertexData(t){let e=0;const i=t.paths,r=[],s=t.spatialReference,n=this._context.elevationProvider.spatialReference,o=this._context.renderCoordsHelper.spatialReference;for(const t of i)e+=t.length;const a=(0,_.jh)(3*e);let l,h=0;for(const e of i){r.push({offset:h,numVertices:e.length});for(const i of e)a[h++]=i[0],a[h++]=i[1],a[h++]=t.hasZ?i[2]:0}return null==n||s.equals(n)||(0,W.projectBuffer)(a,s,0,a,n,0,e)?(null==n||n.equals(o)?l=(0,_.xm)(a):(l=(0,_.jh)(3*e),(0,W.projectBuffer)(a,n,0,l,o,0,e)),{pathVertexDataInfos:r,vertexDataES:a,vertexDataRS:l}):null}_createAs3DShape(t,e,i,r){this.usedMemory=0;const s=t.geometry,n=this._getVertexData(s);if(null==n)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(0===n.pathVertexDataInfos.length)return 0!==s.paths.length&&s.paths.some((t=>t.length>0))||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)"),null;const o=new Array,a=s.spatialReference,l=(0,g.vt)(),h=this._context.renderCoordsHelper,c=new H.aY(n.vertexDataES);for(const s of n.pathVertexDataInfos){const p=s.numVertices;if(p<2)continue;const m=s.offset;if(null!=this._context.clippingExtent&&((0,g.Rz)(n.vertexDataES,m,p,l),!(0,g.KG)(l,this._context.clippingExtent)))continue;const _=new Array,y=m+3*p;for(let t=m;t<y;t+=3){c.offset=t;const e=(0,P.nG)(c,this._context.elevationProvider,i,h);(0,f.i)(Yn,n.vertexDataRS[t],n.vertexDataRS[t+1],n.vertexDataRS[t+2]),h.setAltitude(Yn,e),n.vertexDataRS[t]=Yn[0],n.vertexDataRS[t+1]=Yn[1],n.vertexDataRS[t+2]=Yn[2],_.push(_n(this._upVectorAlignment))}const v=new Ss(_,n.vertexDataES,n.vertexDataRS,m);$n(v,this._upVectorAlignment,this._context.renderCoordsHelper);const x=new Cs(v,this._profile,this._extruder,this._startCap,this._endCap);let b=null;if(this._fastUpdates){const e=this._fastUpdates.visualVariables,i=(0,ue.ul)(e.size?.field,t)??0,r=(0,ue.ul)(e.color?.field,t)??0,s=(0,ue.ul)(e.opacity?.field,t)??0;b=new js(x,i,r,s)}else{const t=[this._intrinsicSize[0],this._intrinsicSize[1]];if(this._drivenProperties.size){const i=e.size;t[0]*=Zn(i[0],"symbol-value"===i[2]?this.symbolLayer.height||0:i[2],this.symbolLayer.width||0),t[1]*=Zn(i[2],"symbol-value"===i[0]?this.symbolLayer.width||0:i[0],this.symbolLayer.height||0)}let i;this._drivenProperties.color&&(i=e.color),this._drivenProperties.opacity&&null!=e.opacity&&(i=i?[i[0],i[1],i[2],e.opacity]:[1,1,1,e.opacity]);const r=new Ws(x);r.bake(t),i&&r.bakeVertexColors(i),b=r}const w=b.createGeometryData(),S=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:r,layerUid:this._context.layer.uid}),C=new Vs(this._materials[0],w,b,a,this._stencilWidth,S);C.transformation=(0,u.Tl)((0,d.vt)(),d.zK,x.path.origin),o.push(C),this.usedMemory+=x.usedMemory}if(0===o.length)return null;const p=new ot.B({geometries:o,layerUid:this._context.layer.uid,graphicUid:r}),m=new S.Y(this,p,o,null,null,((t,e,i,r,s)=>function(t,e,i,r,s){const n=t.stageObject,o=n.geometries;let a=0;for(const t of o){if(!Us(t))continue;const e=t.path,o=e.builder.path;a+=qn(o,0,i,r),s!==Bs.World&&$n(o,s,r),e.onPathChanged(t),t.invalidateBoundingInfo(),n.geometryVertexAttributeUpdated(t,L.r.POSITION)}return a/o.length}(t,0,r,s,this._upVectorAlignment)),i);return m.alignedSampledElevation=0,m.needsElevationUpdates=(0,P.Kf)(i.mode),m}}function $n(t,e,i){const{origin:r,positions:s}=t;let n=t.offset;switch(e){default:case Bs.World:for(const e of t.vertices)Yn[0]=s[n++]+r[0],Yn[1]=s[n++]+r[1],Yn[2]=s[n++]+r[2],i.worldUpAtPosition(Yn,Yn),e.setFrameFromUpVector(Yn);break;case Bs.Path:Yn[0]=s[n]+r[0],Yn[1]=s[n+1]+r[1],Yn[2]=s[n+2]+r[2],i.worldUpAtPosition(Yn,Yn),function(t,e){let i=null;const r=t.vertices.length,s=.99619469809,n=(0,p.vt)(),o=(0,p.vt)(),a=(0,p.vt)(),l=(0,p.vt)(),h=(0,p.vt)(),c=(0,p.vt)(),u=(0,Wi.vt)();let d=t.vertices[0];(0,f.c)(o,e),(0,f.i)(n,0,1,0),(0,fe.Xl)(d.vRight,o,n,n,a,o,s),(0,f.c)(d.frame.up,o),(0,f.c)(d.frame.right,a);const m=t.positions;let g=t.offset;i=d;for(let e=1;e<r;++e){d=t.vertices[e],(0,f.g)(h,d.vLeft,d.vRight);let r=(0,f.l)(h);r>0?(r=1/Math.sqrt(r),h[0]=h[0]*r,h[1]=h[1]*r,h[2]=h[2]*r):(h[0]=d.vRight[0],h[1]=d.vRight[1],h[2]=d.vRight[2]),c[0]=m[g]+i.frame.up[0],c[1]=m[g+1]+i.frame.up[1],c[2]=m[g+2]+i.frame.up[2],g+=3;const p=(0,f.i)(tn,m[g],m[g+1],m[g+2]);(0,Wi.O_)(p,h,u),(0,Wi.Ui)(u,(0,Ks.LV)(c,d.vLeft),l)?(l[0]-=m[g],l[1]-=m[g+1],l[2]-=m[g+2],(0,f.n)(o,l),(0,f.e)(a,h,o),(0,f.n)(a,a)):(0,fe.Xl)(h,i.frame.up,i.frame.right,n,a,o,s),(0,f.c)(d.frame.up,o),(0,f.c)(d.frame.right,a),i=d}}(t,Yn)}}function Zn(t,e,i){switch(t){case"symbol-value":return i;case"proportional":return e;default:return t}}function qn(t,e,i,r){let s=0;const{origin:n,vertices:o,positions:a,positionsES:l}=t,h=t.offset+3*o.length;for(let e=t.offset;e<h;e+=3)(0,f.i)(Yn,l[e],l[e+1],l[e+2]),i(Yn,Xn),s+=Xn.sampledElevation,Yn[0]=a[e]+n[0],Yn[1]=a[e+1]+n[1],Yn[2]=a[e+2]+n[2],r.setAltitude(Yn,Xn.z),a[e]=Yn[0]-n[0],a[e+1]=Yn[1]-n[1],a[e+2]=Yn[2]-n[2];return t.updatePathVertexInformation(),s/o.length}const Yn=(0,p.vt)(),Xn=new P.Uk;var Qn=i(61714),Jn=i(61441);function Kn(t,e,i,r,s=1){(0,f.i)(ro,1,0,0),(0,f.i)(so,0,1,0),(0,f.i)(no,0,0,1),function(t,e){(0,f.i)(go,0,0,0);for(let t=0;t<e.length-3;t+=3)go[0]+=e[t],go[1]+=e[t+1],go[2]+=e[t+2];(0,f.h)(t,go,1/(e.length/3-1))}(to,i),(0,Wi.ci)(io,i)&&function(t,e,i,r,s,n){null!=s?(s.basisMatrixAtPosition(n,uo),(0,f.i)(fo,uo[0],uo[1],uo[2]),(0,f.i)(po,uo[4],uo[5],uo[6]),(0,f.i)(mo,uo[8],uo[9],uo[10])):((0,f.i)(fo,1,0,0),(0,f.i)(po,0,1,0),(0,f.i)(mo,0,0,1));const o=(0,Wi.Qj)(t);(0,f.f)(o,mo)<0&&(0,f.h)(o,o,-1),(0,f.c)(r,o);const a=(0,f.f)(o,po),l=(0,f.f)(o,fo);Math.abs(a)>Math.abs(l)?((0,f.b)(e,fo,o,-l),(0,f.n)(e,e),(0,f.e)(i,e,o),(0,f.n)(i,i),(0,f.h)(i,i,-1)):((0,f.b)(i,po,o,-a),(0,f.n)(i,i),(0,f.e)(e,i,o),(0,f.n)(e,e))}(io,ro,so,no,r,to),(0,Ui.hZ)(oo,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),(0,Ui.hZ)(ao,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let t=0;t<i.length;t+=3){(0,f.i)(eo,i[t],i[t+1],i[t+2]);const e=(0,f.f)(ro,eo),r=(0,f.f)(so,eo);oo[0]=Math.min(oo[0],e),oo[1]=Math.min(oo[1],r),ao[0]=Math.max(ao[0],e),ao[1]=Math.max(ao[1],r)}const n=(0,f.f)(no,to);_o(lo,oo[0],oo[1],n,ro,so,no),_o(ho,ao[0],oo[1],n,ro,so,no),_o(co,oo[0],ao[1],n,ro,so,no),(0,f.d)(ho,ho,lo),(0,f.h)(ho,ho,.5),(0,f.d)(co,co,lo),(0,f.h)(co,co,.5),(0,f.g)(lo,lo,ho),(0,f.g)(lo,lo,co);const o=oo[0]%s,a=oo[1]%s,l=oo[0]-o,h=oo[1]-a;for(let r=0;r<i.length;r+=3){(0,f.i)(eo,i[r],i[r+1],i[r+2]);const n=r/3,o=4*n;t[o]=((0,f.f)(ro,eo)-l)/s,t[o+1]=((0,f.f)(so,eo)-h)/s,t[o+2]=l/s,t[o+3]=h/s;const a=9*n;for(let t=0;t<3;t++)e[a+t]=lo[t],e[a+t+3]=ho[t],e[a+t+6]=co[t]}}const to=(0,p.vt)(),eo=(0,p.vt)(),io=(0,Wi.vt)(),ro=(0,p.vt)(),so=(0,p.vt)(),no=(0,p.vt)(),oo=(0,Ht.vt)(),ao=(0,Ht.vt)(),lo=(0,p.vt)(),ho=(0,p.vt)(),co=(0,p.vt)(),uo=(0,d.vt)(),fo=(0,p.vt)(),po=(0,p.vt)(),mo=(0,p.vt)(),go=(0,p.vt)();function _o(t,e,i,r,s,n,o){(0,f.i)(t,e*s[0]+i*n[0]+r*o[0],e*s[1]+i*n[1]+r*o[1],e*s[2]+i*n[2]+r*o[2])}var yo=i(48042),vo=i(92754),xo=i(67721),bo=i(27291),wo=i(93678),Po=i(25770);class So extends Ge.w{constructor(t,e,r){super(t,e,new Ue.$(Po.P,(()=>i.e(8067).then(i.bind(i,27386)))),r,(0,ds.E)()?Mo:To)}_setPipelineState(t,e){const{oitPass:i,output:r,cullFace:s,draped:n,hasOccludees:o,polygonOffset:a,enableOffset:l}=t,h=i===Ln.Y.NONE,c=i===Ln.Y.FrontFace;return(0,qe.Ey)({blending:r===ze.V.Color?(0,He.Yf)(i):null,culling:(0,qe.Xt)(s),depthTest:n?null:{func:(0,He.K_)(i)},depthWrite:(0,He.z5)(t),drawBuffers:r===ze.V.Depth?{buffers:[Ze.Hr.NONE]}:(0,He.m6)(i,r),colorWrite:qe.kn,stencilWrite:o?We.v0:null,stencilTest:o?e?We.a9:We.qh:null,polygonOffset:h||c?a?Co:null:(0,He.aB)(l)})}initializePipeline(t){return this._occludeePipelineState=this._setPipelineState(t,!0),this._setPipelineState(t,!1)}getPipeline(t){return t?this._occludeePipelineState:super.getPipeline()}}const Co={factor:1,units:1},To=new Map([[L.r.POSITION,0],[L.r.COLOR,3],[L.r.UVMAPSPACE,4],[L.r.COLORFEATUREATTRIBUTE,5],[L.r.BOUNDINGRECT,6]]),Mo=new Map([[L.r.POSITION,0],[L.r.COLOR,3],[L.r.UVMAPSPACE,4],[L.r.COLORFEATUREATTRIBUTE,5],[L.r.BOUNDINGRECT,6],[L.r.OBJECTANDLAYERIDCOLOR,9]]);class Ao extends Ki.E{constructor(){super(...arguments),this.cullFace=rt.s2.None,this.style=xo.O.Horizontal,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasOccludees=!1,this.enableOffset=!0,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.vvColor=!1,this.draped=!1,this.textureCoordinateType=kn.I.None,this.emissionSource=Rn.ZX.None,this.discardInvisibleFragments=!0,this.writeDepth=!0,this.occlusionPass=!1,this.hasVvInstancing=!1,this.vvSize=!1,this.vvOpacity=!1,this.objectAndLayerIdColorInstanced=!1}}(0,Qi._)([(0,Ji.W)({count:rt.s2.COUNT})],Ao.prototype,"cullFace",void 0),(0,Qi._)([(0,Ji.W)({count:xo.O.COUNT})],Ao.prototype,"style",void 0),(0,Qi._)([(0,Ji.W)()],Ao.prototype,"hasSlicePlane",void 0),(0,Qi._)([(0,Ji.W)()],Ao.prototype,"hasVertexColors",void 0),(0,Qi._)([(0,Ji.W)()],Ao.prototype,"polygonOffset",void 0),(0,Qi._)([(0,Ji.W)()],Ao.prototype,"hasOccludees",void 0),(0,Qi._)([(0,Ji.W)()],Ao.prototype,"enableOffset",void 0),(0,Qi._)([(0,Ji.W)()],Ao.prototype,"terrainDepthTest",void 0),(0,Qi._)([(0,Ji.W)()],Ao.prototype,"cullAboveTerrain",void 0),(0,Qi._)([(0,Ji.W)()],Ao.prototype,"vvColor",void 0),(0,Qi._)([(0,Ji.W)()],Ao.prototype,"draped",void 0);class Ro extends bo.W{constructor(t){super(t,Lo),this._configuration=new Ao,this.vertexAttributeLocations=(0,ds.E)()?Mo:To,this.supportsEdges=!0,this.produces=new Map([[Ve.N.OPAQUE_MATERIAL,t=>(0,ze.CL)(t)],[Ve.N.TRANSPARENT_MATERIAL,t=>(0,ze._o)(t)],[Ve.N.TRANSPARENT_MATERIAL_WITHOUT_NORMALS,t=>(0,ze.eh)(t)],[Ve.N.DRAPED_MATERIAL,t=>this.parameters.draped&&(0,ze.dX)(t)]])}getConfiguration(t,e){return this._configuration.output=t,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.style=this.parameters.style,this._configuration.draped=this.parameters.draped,this._configuration.oitPass=e.oitPass,this._configuration.enableOffset=e.camera.relativeElevation<He.xt,this._configuration.terrainDepthTest=e.terrainDepthTest,this._configuration.cullAboveTerrain=e.cullAboveTerrain,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration}get visible(){return this.parameters.color[3]>=Ne.Q}createGLMaterial(t){return new Oo(t)}createBufferWriter(){const t=(0,De.BP)().vec3f(L.r.POSITION).vec4f(L.r.UVMAPSPACE);return this.parameters.draped||t.mat3f(L.r.BOUNDINGRECT),this.parameters.vvColor?t.f32(L.r.COLORFEATUREATTRIBUTE):t.vec4u8(L.r.COLOR),(0,ds.E)()&&t.vec4u8(L.r.OBJECTANDLAYERIDCOLOR),new Io(t)}}class Oo extends ji.A{beginSlot(t){return this.acquireTechnique(So,t)}}class Io extends Zi.Z{write(t,e,i,r,s,n){(0,wo.SA)(i,r,this.vertexBufferLayout,t,e,s,n);for(const e of this.vertexBufferLayout.fields.keys()){const r=i.get(e),o=r?.indices;if(r&&o)switch(e){case L.r.UVMAPSPACE:{(0,$i.vA)(4===r.size);const t=s.getField(e,vo.Eq);t&&(0,wo.Ut)(r,t,n);break}case L.r.BOUNDINGRECT:{(0,$i.vA)(9===r.size);const i=s.getField(e,vo.jZ);i&&Eo(r,t,i,n);break}}}}}function Eo(t,e,i,r){const{data:s,indices:n}=t,o=e,a=i.typedBuffer,l=i.typedBufferStride,h=n.length;r*=l;for(let t=0;t<h;++t){const e=9*n[t],i=s[e],h=s[e+1],c=s[e+2];a[r]=o[0]*i+o[4]*h+o[8]*c+o[12],a[r+1]=o[1]*i+o[5]*h+o[9]*c+o[13],a[r+2]=o[2]*i+o[6]*h+o[10]*c+o[14];for(let t=3;t<9;++t)a[r+t]=s[e+t];r+=l}}class Lo extends Be.S{constructor(){super(...arguments),this.color=(0,Wt.fA)(1,1,1,1),this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=rt.s2.None,this.hasOccludees=!1,this.style=xo.O.Cross,this.draped=!0}}function Do(t,e){if(function(t){return t.material instanceof Ro&&!t.material.parameters.draped}(t)){const i=t.attributes.get(L.r.POSITION).data;Kn(t.getMutableAttribute(L.r.UVMAPSPACE).data,t.getMutableAttribute(L.r.BOUNDINGRECT).data,i,e)}}function zo(t,e,i,r,s){const n=(0,ie.B6)(t,e,i,r,s),o=t.stageObject.geometries;for(const t of o)Do(t,s);return n}const No=["polyline","polygon","extent"],Fo=new ue.wI({size:!1,color:!0,rotation:!1,opacity:!1});class ko extends C.U{constructor(t,e,i,r){super(t,e,i,r),this._needsUV=!1}async doLoad(){this._fastUpdates=(0,ue.s_)(this._context.renderer,Fo)}_createMaterials(){if(this._materials.length>0)return;const t=this.symbolLayer?.material?.color,e=this._getCombinedOpacityAndColor(t);this._materials[Go.Fill]=function(t,e){const i=t?.pattern;return null==i?new yo.v(e):"none"===i.style||"solid"===i.style?("none"===i.style&&(e.color=(0,Wt.fA)(0,0,0,0),e.forceTransparentMode=!0),new yo.v(e)):(e.style=function(t){switch(t){case"horizontal":return xo.O.Horizontal;case"vertical":return xo.O.Vertical;case"cross":return xo.O.Cross;case"forward-diagonal":return xo.O.ForwardDiagonal;case"backward-diagonal":return xo.O.BackwardDiagonal;case"diagonal-cross":return xo.O.DiagonalCross;default:return}}(i.style),new Ro(e))}(this.symbolLayer,{color:e,forceTransparentMode:this.needsDrivenTransparentPass,discardInvisibleFragments:!0,polygonOffset:!1,hasVertexColors:!0,draped:this.draped,hasSlicePlane:this._context.slicePlaneEnabled,...this._fastUpdates?.materialParameters}),this._needsUV=this._materials[Go.Fill]instanceof Ro;const i=this.symbolLayer.outline;if(function(t){return null!=t?.size&&t.size>0&&null!=t.color&&(null==t.pattern||"style"!==t.pattern.type||"none"!==t.pattern.style)}(i)){const t=(0,ri.Xq)(i.pattern);this._materials[Go.Outline]=new si.W({width:(0,Bt.Lz)(i.size),color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:t,cap:Oe(i.patternCap||"butt")})}this._context.stage.addMany(this._materials)}destroy(){super.destroy(),this._context.stage.removeMany(this._materials),this._materials.length=0}createGraphics3DGraphic(t){const e=t.graphic;if(!this._validateGeometry(e.geometry,No,this.symbolLayer.type))return null;const i=this._getVertexOpacityAndColor(t.renderingInfo,255),r=this.setGraphicElevationContext(e);return this.ensureDrapedStatus("on-the-ground"===r.mode),this._createMaterials(),this.draped?this._createAsOverlay(e,i):this._createAs3DShape(e,i,r)}applyRendererDiff(t,e){for(const i in t.diff){if("visualVariables"!==i)return M.w.RecreateSymbol;if(!(0,ue.J_)(this._fastUpdates,e,Fo))return M.w.RecreateSymbol;this._materials[Go.Fill]?.setParameters(this._fastUpdates.materialParameters)}return M.w.FastUpdate}layerOpacityChanged(){if(null!=this._materials[Go.Fill]){const t=this._materials[Go.Fill].parameters.color,e=this.symbolLayer?.material?.color,i=this._getCombinedOpacity(e);this._materials[Go.Fill].setParameters({color:[t[0],t[1],t[2],i],forceTransparentMode:this.needsDrivenTransparentPass})}if(null!=this._materials[Go.Outline]){const t=this._materials[Go.Outline].parameters.color;this._materials[Go.Outline].setParameters({color:[t[0],t[1],t[2],this._getOutlineOpacity()]})}}layerElevationInfoChanged(t,e,i){const r=this._elevationContext.mode,s=(0,P.I2)(ko.elevationModeChangeTypes,i,r);if(s!==P.uw.UPDATE)return s;const n=(0,P.nu)(r);return this.updateGraphics3DGraphicElevationInfo(t,e,(()=>n))}slicePlaneEnabledChanged(){if(this._materials[Go.Fill]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._materials[Go.Outline]){const t={hasSlicePlane:this._context.slicePlaneEnabled};this._materials[Go.Outline].setParameters(t)}return!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(t,e,i){const r=V(t.geometry);if(!r)return null;const s=Z(r,this._context.elevationProvider,this._context.renderCoordsHelper,i),n=new Bo(s,e,this._context.layer.uid,t.uid),o=n.renderData.position.length/3;if(this._needsUV&&(n.uvMapSpace=(0,gi.oe)(4*o,!0),n.boundingRect=(0,_.jh)(9*o,!0),Kn(n.uvMapSpace,n.boundingRect,n.renderData.position,this._context.renderCoordsHelper)),n.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(n),this._createAs3DShapeFill(t,n),this._materials[Go.Outline]&&this._createAs3DShapeOutline(n),this._logGeometryCreationWarnings(n.renderData,r.rings,"rings","FillSymbol3DLayer"),0===n.outGeometries.length)return null;const a=new ot.B({geometries:n.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:t.uid}),l=new S.Y(this,a,n.outGeometries,null,null,zo,i);return l.alignedSampledElevation=n.renderData.sampledElevation,l.needsElevationUpdates=(0,P.nu)(i.mode),l}_createAs3DShapeFill(t,e){const i=e.renderData.polygons;for(const{position:r,mapPositions:s,holeIndices:n,index:o,count:a}of i){if(null!=this._context.clippingExtent&&((0,g.vY)(s,Vo),!(0,g.KG)(Vo,this._context.clippingExtent)))continue;const i=N(s,n,this._context.elevationProvider.spatialReference);if(0===i.length)continue;const l=this._fastUpdates?.visualVariables.color,h=F({material:this._materials[Go.Fill],indices:i,mapPositions:s,attributeData:{position:r,color:l?null:e.color,colorFeature:l?(0,ue.ul)(l.field,t):null,uvMapSpace:this._needsUV?(0,gi.AK)(e.uvMapSpace,4*o,4*a):null,boundingRect:this._needsUV?(0,_.l5)(e.boundingRect,9*o,9*a):null,objectAndLayerIdColor:e.objectAndLayerIdColor}});e.outGeometries.push(h)}}_createAs3DShapeOutline(t){if(null==this._materials[Go.Outline])return;const e=t.renderData.outlines;for(const{mapPositions:i,position:r}of e){if(null!=this._context.clippingExtent&&((0,g.vY)(i,Vo),!(0,g.KG)(Vo,this._context.clippingExtent)))continue;const e=(0,Ee.t)(this._materials[Go.Outline],{overlayInfo:null,removeDuplicateStartEnd:!0,mapPositions:i,attributeData:{position:r}},t.objectAndLayerIdColor);t.outGeometries.push(e)}}_createAsOverlay(t,e){const i=V(t.geometry);if(null==i)return null;this._materials[Go.Fill].renderPriority=this._renderPriority+this._renderPriorityStep/2,null!=this._materials[Go.Outline]&&(this._materials[Go.Outline].renderPriority=this._renderPriority);const r=q(i,this._context.overlaySR),s=new Uo(r,e,this._context.layer.uid,t.uid),n=s.renderData.position.length/3;return this._needsUV&&(s.uvMapSpace=(0,gi.oe)(4*n,!0),function(t,e,i,r,s=1){if(i.isGeographic&&r===w.RT.Global){const t=(0,_.jh)(e.length),r=e.length,s=(0,Qn.tO)(i);for(let i=0;i<r;i+=3)(0,Jn.RC)(e,i,t,i,s);e=t}(0,Ui.hZ)(oo,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let t=0;t<e.length;t+=3)oo[0]=Math.min(oo[0],e[t]),oo[1]=Math.min(oo[1],e[t+1]);const n=oo[0]%s,o=oo[1]%s,a=oo[0]-n,l=oo[1]-o;for(let i=0;i<e.length;i+=3){const r=i/3*4;t[r]=(e[i]-a)/s,t[r+1]=(e[i+1]-l)/s,t[r+2]=a/s,t[r+3]=l/s}}(s.uvMapSpace,s.renderData.position,this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode)),s.outBoundingBox=(0,g.Ie)(),s.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(s),this._createAsOverlayFill(t,s),this._materials[Go.Outline]&&this._createAsOverlayOutline(s),this._logGeometryCreationWarnings(s.renderData,i.rings,"rings","FillSymbol3DLayer"),0===s.outGeometries.length?null:new ne(this,s.outGeometries,s.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayFill(t,e){const i=e.renderData.polygons;for(const{position:r,holeIndices:s,index:n,count:o}of i){const i=(0,g.vY)(r,Vo);if(!(0,g.KG)(i,this._context.clippingExtent))continue;const a=(0,l.e)(r,s,3);if(0===a.length)continue;(0,g.RF)(e.outBoundingBox,i);const h=this._fastUpdates?.visualVariables.color,c=F({material:this._materials[Go.Fill],indices:a,attributeData:{position:r,color:h?null:e.color,colorFeature:h?(0,ue.ul)(h.field,t):null,uvMapSpace:this._needsUV?(0,gi.AK)(e.uvMapSpace,4*n,4*o):null,objectAndLayerIdColor:e.objectAndLayerIdColor}});e.outGeometries.push(new pe.$(c,e))}}_createAsOverlayOutline(t){if(null==this._materials[Go.Outline])return;const e=t.renderData.outlines;for(let i=0;i<e.length;++i){const{position:r}=e[i];if((0,g.vY)(r,Vo),!(0,g.KG)(Vo,this._context.clippingExtent))continue;(0,g.RF)(t.outBoundingBox,Vo);const s=(0,Ee.t)(this._materials[Go.Outline],{overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:!0,attributeData:{position:r}},t.objectAndLayerIdColor);t.outGeometries.push(new pe.$(s,t))}}_getOutlineOpacity(){const t=this.symbolLayer?.outline?.color;return(this.draped?1:this._getLayerOpacity())*(null!=t?t.a:0)}_getOutlineColor(){const t=this.symbolLayer?.outline?.color,e=this._getOutlineOpacity();return(0,T.$C)(null!=t?Nt.A.toUnitRGB(t):null,e)}test(){return{...super.test(),createAsOverlay:(t,e)=>this._createAsOverlay(t,e),createAs3DShape:(t,e,i)=>this._createAs3DShape(t,e,i)}}}ko.elevationModeChangeTypes={definedChanged:P.uw.RECREATE,staysOnTheGround:P.uw.NONE,onTheGroundChanged:P.uw.RECREATE};const Vo=(0,g.vt)();class Bo extends B{constructor(t,e,i,r){super(t,i,r),this.color=e}}class Uo extends B{constructor(t,e,i,r){super(t,i,r),this.color=e}}var Go;!function(t){t[t.Fill=0]="Fill",t[t.Outline=1]="Outline"}(Go||(Go={}));var Ho=i(58608),Wo=i(76589),jo=i(67535);class $o{constructor(t,e="center",i=!1,r=(0,Ht.vt)(),s=(0,Wt.fA)(0,0,0,-1),n="world",o=(0,p.vt)(),a=0){this.verticalOffset=t,this.anchor=e,this.hasLabelVerticalOffset=i,this.screenOffset=r,this.centerOffset=s,this.centerOffsetUnits=n,this.translation=o,this.elevationOffset=a}}class Zo{constructor(t,e="center",i="center",r=null,s=(0,Ht.vt)()){this.placement=t,this.horizontalPlacement=e,this.verticalPlacement=i,this.text=r,this.displaySize=s}}var qo=i(88075),Yo=i(80683);class Xo{constructor(t){this.definition=t,this.key=JSON.stringify(t),this.haloSize=Math.round(t.halo.size),this.textStyle=Qo(t.color),this.haloStyle=function(t){return`rgb(${t.slice(0,3).map((t=>Math.floor(255*t))).toString()})`}(t.halo.color),this.backgroundStyle=0!==t.background.color[3]?Qo(t.background.color):null}fontString(t){const e=this.definition.font;return`${e.style} ${e.weight} ${t}px ${e.family}, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji`}setFontProperties(t,e){t.font=this.fontString(e),t.textAlign="left",t.textBaseline="alphabetic"}static async fromSymbol(t,e){const i=t?.material?.color,s=Nt.A.toUnitRGBA(i)??Wt.uY,n=null!=t.size?(0,Bt.Lz)(t.size):12,o=t.lineHeight,a=null!=t.background?Nt.A.toUnitRGBA(t.background.color):Wt.uY,l={family:t.font?.family??"sans-serif",decoration:t.font?.decoration??"none",weight:t.font?.weight??"normal",style:t.font?.style??"normal"},h=t.halo,c=null!=h?.color&&h.size>0?{size:(0,Bt.Lz)(h.size),color:Nt.A.toUnitRGBA(h.color)}:{size:0,color:Wt.uY},u=new Xo({color:s,size:n,background:{color:a,padding:null!=t.background?[.65*n,.5*n]:[0,0],borderRadius:null!=t.background?n*(6/16):0},lineSpacingFactor:o,font:l,halo:c,pixelRatio:e});if(t.font){let e=!1;const i=u.fontString(n);try{e=(await document.fonts.load(i)).some((t=>!(0,Yo.NZ)(t)))}catch(t){r.A.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${i}'. Some text symbology may be rendered using the default browser font.`)}if(!e&&!Jo.has(t.font.family))try{await(0,Yo.Al)(t.font)}catch(t){}}return u}}function Qo(t){return`rgba(${t.slice(0,3).map((t=>Math.floor(255*t))).toString()},${t[3]})`}const Jo=new Set(["Arial","Times New Roman","Courier New","serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]);var Ko=i(28950),ta=i(36029),ea=i(83525),ia=i(48996),ra=i(11231),sa=i(23502),na=(i(13798),i(65953)),oa=i(33400),aa=i(10228),la=i(12569),ha=i(48961),ca=i(55213),ua=i(12285),da=i(10956);const fa=4096;let pa=class extends ea.A{constructor(t){super(t),this.type=I.X.Texture,this.id=(0,ra.c)(),this.events=new ia.A,this._glTexture=null,this._atlas=new ya(256,256),this._needsRepack=!1,this._canRepack=!0,this._elementsToRender=new Map,this._elements=new Map,this._uvCallbacks=new Map,this.updating=!1}initialize(){this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id","textAtlasCanvas"),this._canvas.setAttribute("style","display:none"),this._ctx=this._canvas.getContext("2d"),this._stage=this.view._stage,this._stage.add(this),this._updateCanvasElementSize(this._atlas),this._reset()}unload(){this._glTexture=(0,kt.WD)(this._glTexture),this._frameWorker=(0,kt.xt)(this._frameWorker),this.updating=!1,this.events.emit("unloaded")}get glTexture(){return this._glTexture}static get maxSize(){return xa=aa.G.stableRendering?ma:0,[fa-ma-xa,fa-ma-xa-ga]}load(t){if(this._glTexture)return this._glTexture;const e=new da.R;return e.wrapMode=Ze.pF.CLAMP_TO_EDGE,e.samplingMode=Ze.Cj.LINEAR_MIPMAP_LINEAR,e.hasMipmap=!0,e.preMultiplyAlpha=!0,e.maxAnisotropy=t.parameters.maxMaxAnisotropy,this._glTexture=new ua.g(t,e,this._canvas),this._frameWorker=this.view.resourceController.scheduler.registerTask(ha.W6.TEXT_TEXTURE_ATLAS,this),this.setDirty(),this._glTexture}dispose(){this._elements.clear(),this._elementsToRender.clear(),this._frameWorker=(0,kt.xt)(this._frameWorker),this._glTexture&&(this._stage.remove(this),this._glTexture=(0,kt.WD)(this._glTexture)),this._canvas.width=0,this._canvas.height=0,this._canvas=null,this._ctx=null}_updateCanvasElementSize(t){this._canvas.width=t.width,this._canvas.height=t.height}_resizeAtlas(t,e){const{width:i,height:r}=this._atlas;i===t&&r===e||(this._atlas.width=t,this._atlas.height=e,this._glTexture?.resize(t,e),this._glTexture?.updateData(0,0,0,i,r,this._canvas),this._updateCanvasElementSize(this._atlas),this._elements.forEach((t=>this._uvCallbacks.get(t.textRenderer.key)?.forEach((e=>e(t.uv))))),this._reset())}_reset(){this._elementsToRender.clear(),this._atlas.reset(),this._needsRepack=!0,this.setDirty()}_addAtlasElement(t,e,i,r){const s=this._atlas;if(s.width<i||s.height<r)return!1;let n=s.cursors.get(r);if(!n){if(s.height<s.nextY+r)return!1;n=[new va(s.nextY)],s.cursors.set(r,n),s.nextY+=r}let o=n.find((t=>s.width>=t.x+i));if(null==o){if(s.height<s.nextY+r)return!1;o=new va(s.nextY),s.nextY+=r,n.push(o)}return t.setNewPosition(o),this._elements.set(e,t),this._elementsToRender.set(e,t),o.x+=i,!0}_ensureCallbacks(t){const e=this._uvCallbacks.get(t);if(e)return e;const i=new Set;return this._uvCallbacks.set(t,i),i}_addCallback(t,e){this._ensureCallbacks(t).add(e)}_removeCallback(t,e){const i=this._uvCallbacks.get(t);return!(!i?.delete(e)||0!==i.size||(this._uvCallbacks.delete(t),0))}_processAddition(t){const e=t.textRenderer.key;if(this._needsRepack)return void this._elements.set(e,t);const i=this._atlas,r=t.textRenderer.renderedWidth,s=t.textRenderer.renderedHeight,n=r+ma,o=s+ma+ga;if(!this._addAtlasElement(t,e,n,o)){if(this._canRepack)this._reset();else if(i.width<n){const t=Math.min((0,la.Mv)(Math.max(n,1.5*i.width)),fa);this._resizeAtlas(t,i.height)}else{const t=i.nextY+o,e=Math.min((0,la.Mv)(Math.max(t,1.5*i.height)),fa);if(e>i.height)this._resizeAtlas(i.width,e);else if(i.width<fa){const t=Math.min((0,la.Mv)(1.5*i.width),fa);this._resizeAtlas(t,i.height)}}this._elements.set(e,t)}}_renderElement(t){const e=t.commitNewPosition(),i=t.textRenderer;this._ctx.clearRect(e[0]-ma,e[1]-ma,i.renderedWidth+2*ma,i.renderedHeight+2*ma),i.render(this._ctx,e[0],e[1]),this._uvCallbacks.get(i.key)?.forEach((e=>e(t.uv)))}get running(){return this.updating}runTask(t){if(null==this._glTexture)return ca.G;for(;this._needsRepack&&(this._canRepack||this._atlas.height<fa&&this._atlas.height<fa);){this._canRepack=this._needsRepack=!1;const e=this._elements;this._elements=new Map,e.forEach((t=>this._processAddition(t))),t.madeProgress()}if(this._elementsToRender.size>0){for(const[e,i]of this._elementsToRender){if(t.done)break;this._renderElement(i),this._elementsToRender.delete(e),t.madeProgress()}this._glTexture.setData(this._canvas)}this.updating=this._elementsToRender.size>0}addText(t,e){const i=t.key;this._addCallback(i,e);let r=this._elements.get(i);return r?(0,oa.a)(r.uv,Wt.uY)||e(r.uv):(r=new _a(this._atlas,t),this._processAddition(r),this.setDirty()),{remove:()=>this._removeText(t,e)}}_removeText(t,e){const i=t.key;this._elements.get(i)&&this._removeCallback(i,e)&&(this._elements.delete(i),this._elementsToRender.delete(i),this._canRepack=!0)}setDirty(){this._glTexture&&(this.updating=!0)}get test(){}};(0,Qi._)([(0,sa.MZ)({constructOnly:!0})],pa.prototype,"view",void 0),(0,Qi._)([(0,sa.MZ)({type:Boolean})],pa.prototype,"updating",void 0),pa=(0,Qi._)([(0,na.$)("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],pa);const ma=2,ga=2;class _a{constructor(t,e){this._atlas=t,this.textRenderer=e,this._uv=(0,Wt.vt)(),this._newPosition=[0,0]}get uv(){if(null==this._xOffset||null==this._yOffset)return Wt.uY;const{renderedWidth:t,renderedHeight:e}=this.textRenderer;return(0,oa.s)(this._uv,this._xOffset/this._atlas.width,(this._yOffset+e)/this._atlas.height,(this._xOffset+t)/this._atlas.width,this._yOffset/this._atlas.height)}setNewPosition(t){this._newPosition[0]=t.x,this._newPosition[1]=t.y}commitNewPosition(){return this._xOffset=this._newPosition[0],this._yOffset=this._newPosition[1],this._newPosition}get xOffset(){return this._xOffset}get yOffset(){return this._yOffset}}class ya{constructor(t,e){this.width=t,this.height=e,this.cursors=new Map,this.nextY=0}reset(){this.cursors.clear(),this.nextY=xa}}class va{constructor(t){this.y=t,this.x=xa}}let xa=0;class ba{constructor(t,e,i){this._renderer=new ta.Js(t,e,i,pa.maxSize)}get key(){return this._renderer.key}get baselineAnchorY(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}create(){const t=(0,Ko.y)(wa,this._renderer.renderedWidth,this._renderer.renderedHeight),e=t.getContext("2d");return e.save(),this._renderer.render(e,0,0),e.restore(),new me.g(t,{wrap:{s:Ze.pF.CLAMP_TO_EDGE,t:Ze.pF.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0})}}const wa={canvas:null},Pa=(0,p.CN)(0,0,1);class Sa extends C.U{constructor(t,e,i,r){super(t,e,i,r),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const t=(0,T.Hj)(this.symbolLayer.size);if(t)throw new n.A("graphics3dtextsymbollayer:invalid-size",t)}await this._createTextRenderParameters()}async _createTextRenderParameters(){const t=this._context.graphicsCoreOwner.view.state.rasterPixelRatio;this._textRenderParameters=await Xo.fromSymbol(this.symbolLayer,t)}destroy(){super.destroy()}createGraphics3DGraphic(t){const e=t.graphic,i=(0,ce.ZX)(e.geometry);if(null==i)return this.logger.warn(`unsupported geometry type for text symbol: ${e.geometry.type}`),null;const r=this.symbolLayer.text;if(null==r||""===r)return null;const s=(0,Ho.YX)(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(null!=s&&!(0,Ho.Ie)(this.symbolLayer))return this.logger.errorOncePerTick(`Callouts and vertical offset on text symbols are currently only supported with 'center' horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;const{verticalAlignment:n}=this.symbolLayer,o=new $o(s);(0,he.xU)(n,o.screenOffset);const a=new Zo(o,this.symbolLayer.horizontalAlignment,(0,he.RH)(n));return this._createAs3DShape(e,i,r,a)}createLabel(t,e,i,r,s){const n=t.graphic,o=(0,ce.ZX)(n.geometry);if(null==o)return this.logger.warn(`unsupported geometry type for label: ${n.geometry.type}`),null;const a=e.text;return!a||/^\s+$/.test(a)?null:this._createAs3DShape(n,o,a,e,i,r,s)}setGraphicElevationContext(t,e,i=0){return super.setGraphicElevationContext(t,e),e.addOffsetRenderUnits(i),e}layerOpacityChanged(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}layerElevationInfoChanged(t,e){return Ca(t,e,((t,e)=>{this.updateGraphicElevationContext(e,t)})),P.uw.UPDATE}slicePlaneEnabledChanged(t,e){return Ca(t,e,(t=>{for(const e of t.stageObject.geometries)e.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})})),!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return!1}updateGraphicElevationContext(t,e){const i=e.elevationContext;this.setGraphicElevationContext(t,i,null!=e.metadata?e.metadata.elevationOffset:0),e.needsElevationUpdates=(0,P.nu)(i.mode)||"absolute-height"===i.mode}updateGeometry(t,e){if(this.draped||!this._validateGeometry(e))return!1;const{elevationContext:i,stageObject:r}=t;if(i.mode!==this.getGeometryElevationMode(e))return!1;const s=(0,ce.ZX)(e);if(!s)return!1;const n=(0,ce.hS)(r,this._context,s,i);if(null==n)return!1;const o=(0,ce.R$)(this._context,s);return r.geometries[0].localOrigin===o&&(t.alignedSampledElevation=n,(0,ce.d2)(t,s,this._context.elevationProvider),!0)}_defaultElevationInfoNoZ(){return Ta}_createAs3DShape(t,e,i,r,n=null,o=null,a=()=>r.placement.elevationOffset){const l=this.setGraphicElevationContext(t,new Wo.F,r.placement.elevationOffset),h="polyline"===t.geometry?.type,c=t.uid;let u=null,d=null;if(null==o){const t=(0,he.QE)(r.horizontalPlacement);u=new ba(i,t,this._textRenderParameters);let e=null;if(null!=this._context.sharedResources.textures){d=this._context.sharedResources.textures.fromData(u.key,(()=>u.create())),d.texture.events.on("unloaded",(()=>e=(0,kt.Gz)(e)));const t=this._context.stage.renderView.textures.acquire(d.texture.id);if(null==t||(0,Vt.$X)(t))return d.release(),null;e=t}}const f=!!(0,s.A)("enable-feature:non-occluded-hud"),p=function(t,e){if("baseline"===e.verticalPlacement){const i=he.cN[e.horizontalPlacement],r=null!=t?t.baselineAnchorY:0;return(0,Ht.fA)(i,r)}const i=(0,he.Ir)(e.horizontalPlacement,e.verticalPlacement);return he.Zd[i]}(u,r),m={occlusionTest:!f,occludedFragmentFade:f,horizonCullingEnabled:f,screenOffset:r.placement.screenOffset,anchorPosition:p,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:r.placement.centerOffsetUnits,depthEnabled:!1,drawInSecondSlot:!0,isLabel:!0};if(h&&(m.shaderPolygonOffset=1e-4),o?m.textureId=o.id:d&&(m.textureId=d.texture.id),null!=r.placement.verticalOffset){const{screenLength:t,minWorldLength:e,maxWorldLength:i}=r.placement.verticalOffset;m.verticalOffset={screenLength:(0,Bt.Lz)(t),minWorldLength:e||0,maxWorldLength:null!=i?i:1/0}}const g={screenOffset:m.screenOffset,anchorPosition:p,centerOffsetUnits:m.centerOffsetUnits,verticalOffset:m.verticalOffset,shaderPolygonOffset:m.shaderPolygonOffset,occlusionTest:m.occlusionTest};if(this._context.screenSizePerspectiveEnabled){const{screenSizePerspectiveSettings:t,screenSizePerspectiveSettingsLabels:e}=this._context.sharedResources,i=(0,qo.z)(this._textRenderParameters);m.screenSizePerspective=e.overrideFontHeight(i.maxHeight),m.screenSizePerspectiveAlignment=t,g.fontHeight=i.maxHeight}m.hasSlicePlane=this._context.slicePlaneEnabled;const _=this._context.spherical,y=n?JSON.stringify(g):"";let v=n?.get(y);null==v&&(v=new ge.R(m,_),n?.add(y,v));const x=r.placement.translation,b=u?(0,Ht.fA)(u.displayWidth,u.displayHeight):Ht.uY,w=r.placement.centerOffset,C=Pa,T=o?(0,Wt.fA)(0,0,0,0):null,M=(0,fe.DJ)(v,C,x,null,null,b,w,T,null),A=(0,ce.SZ)(this._context,e,M,l,c);if(null==A)return null;const R=new S.Y(this,A.object,[M],null==n?[v]:null,d,((e,i,s,n,o,l)=>{const h=a()||r.placement.elevationOffset,c=this.setGraphicElevationContext(t,i,h);return(0,ie.G8)(e,c,s,n,o,l)}),l);R.alignedSampledElevation=A.sampledElevation,R.needsElevationUpdates=(0,P.nu)(l.mode)||"absolute-height"===l.mode,R.getScreenSize=(t=(0,Ht.vt)())=>(t[0]=u?u.displayWidth:r.displaySize[0],t[1]=u?u.displayHeight:r.displaySize[1],t);const O=new jo.Z(r.placement.elevationOffset,i);return R.metadata=O,(0,ce.d2)(R,e,this._context.elevationProvider),R}}function Ca(t,e,i){t&&t.forEach((t=>{const r=e(t);null!=r&&i(r,t.graphic)}))}const Ta={mode:"relative-to-ground",offset:0};var Ma=i(38504),Aa=(i(15985),i(52352));class Ra extends Ge.w{constructor(t,e,r){super(t,e,new Ue.$(Aa.W,(()=>i.e(6628).then(i.bind(i,24240)))),r)}initializePipeline(t){const{oitPass:e,output:i,transparent:r,draped:s,enableOffset:n}=t,o=e===Ln.Y.NONE,a=e===Ln.Y.FrontFace;return(0,qe.Ey)({blending:i!==ze.V.Normal&&i!==ze.V.Highlight&&i!==ze.V.ObjectAndLayerIdColor&&r?(0,He.Yf)(e):null,depthTest:s?null:{func:(0,He.K_)(e)},depthWrite:(0,He.z5)(t),drawBuffers:(0,He.m6)(e,i),colorWrite:qe.kn,polygonOffset:o||a?null:(0,He.aB)(n)})}}class Oa extends ji.A{ensureResources(t){return this._techniques.context.waterTextures.ensureResources(t)}beginSlot(t){const e=this._techniques.context.waterTextures.passParameters;return this._material.setParameters({wavePerturbation:e.wavePerturbation,waveNormal:e.waveNormal}),this.acquireTechnique(Ra,t)}}class Ia extends Ki.E{constructor(t,e){super(),this.spherical=t,this.doublePrecisionRequiresObfuscation=e,this.receiveShadows=!1,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.screenSpaceReflections=!1,this.cloudReflections=!1,this.objectAndLayerIdColorInstanced=!1,this.draped=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.textureCoordinateType=kn.I.None,this.emissionSource=Rn.ZX.None,this.pbrMode=In.A9.Water,this.occlusionPass=!1,this.useCustomDTRExponentForWater=!0,this.highStepCount=!0,this.useFillLights=!1}get discardInvisibleFragments(){return this.transparent&&this.writeDepth}}(0,Qi._)([(0,Ji.W)()],Ia.prototype,"receiveShadows",void 0),(0,Qi._)([(0,Ji.W)()],Ia.prototype,"hasSlicePlane",void 0),(0,Qi._)([(0,Ji.W)()],Ia.prototype,"transparent",void 0),(0,Qi._)([(0,Ji.W)()],Ia.prototype,"enableOffset",void 0),(0,Qi._)([(0,Ji.W)()],Ia.prototype,"writeDepth",void 0),(0,Qi._)([(0,Ji.W)()],Ia.prototype,"screenSpaceReflections",void 0),(0,Qi._)([(0,Ji.W)()],Ia.prototype,"cloudReflections",void 0),(0,Qi._)([(0,Ji.W)()],Ia.prototype,"objectAndLayerIdColorInstanced",void 0),(0,Qi._)([(0,Ji.W)()],Ia.prototype,"draped",void 0),(0,Qi._)([(0,Ji.W)()],Ia.prototype,"terrainDepthTest",void 0),(0,Qi._)([(0,Ji.W)()],Ia.prototype,"cullAboveTerrain",void 0);class Ea extends bo.W{constructor(t,e){super(t,La),this.produces=new Map([[Ve.N.OPAQUE_MATERIAL,t=>(0,ze._o)(t)&&!this.parameters.transparent||(0,ze.CL)(t)],[Ve.N.TRANSPARENT_MATERIAL,t=>(0,ze._o)(t)&&this.parameters.transparent||(0,ze.CL)(t)],[Ve.N.DRAPED_MATERIAL,t=>this.parameters.draped&&t===ze.V.Color||(0,ze.CL)(t)],[Ve.N.DRAPED_WATER,t=>t===ze.V.Normal]]),this._configuration=new Ia(e.spherical,e.doublePrecisionRequiresObfuscation)}getConfiguration(t,e){return this._configuration.output=t,this._configuration.writeDepth=!0,this._configuration.receiveShadows=e.shadowMap.enabled,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.screenSpaceReflections=null!=e.ssr.lastFrameColor,this._configuration.cloudReflections=null!=e.clouds.data,this._configuration.draped=this.parameters.draped,this._configuration.oitPass=e.oitPass,this._configuration.enableOffset=e.camera.relativeElevation<He.xt,this._configuration.terrainDepthTest=e.terrainDepthTest,this._configuration.cullAboveTerrain=e.cullAboveTerrain,this._configuration}get visible(){return!0}update(t){return this.setParameters({timeElapsed:(0,Ma.y)(t.time)*this.parameters.animationSpeed},!1),this._animationEnabled(t.camera)&&t.dt>0}_animationEnabled(t){const e=Math.min(t.relativeElevation,t.distance);return Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*e<Da}createGLMaterial(t){return new Oa(t)}createBufferWriter(){return new Zi.Z((0,ds.E)()?qi.Dq:qi.zK)}get test(){}}class La extends ke.qA{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=(0,Ht.fA)(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=(0,Wt.fA)(0,0,0,0),this.transparent=!0,this.hasSlicePlane=!1,this.draped=!1,this.origin=(0,p.vt)(),this.modelTransformation=null}}const Da=35e3,za={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}},Na=["polyline","polygon","extent"];class Fa extends C.U{constructor(t,e,i,r){super(t,e,i,r)}async doLoad(){}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials.length=0}createGraphics3DGraphic(t){const e=t.graphic;if(!this._validateGeometry(e.geometry,Na,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(e);return this.ensureDrapedStatus("on-the-ground"===i.mode),this.ensureMaterial(),this.draped?this._createAsOverlay(e):this._createAs3DShape(e,i,e.uid)}ensureMaterial(){if(this._materials[0])return;const t=new La,e=this.symbolLayer.color;null!=e&&(t.color=Nt.A.toUnitRGBA(e));const i=this._getCombinedOpacity(e,{hasIntrinsicColor:!0});t.color=[t.color[0],t.color[1],t.color[2],i],t.transparent=i<1||this.needsDrivenTransparentPass,t.waveDirection=null!=this.symbolLayer.waveDirection?function(t){const e=(0,Ht.vt)(),i=(0,ln.DF)(t);return e[0]=Math.sin(i),e[1]=Math.cos(i),e}(this.symbolLayer.waveDirection):(0,Ht.fA)(0,0);const r=this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize,s=za[r];t.waveStrength=s.waveStrength,t.waveTextureRepeat=s.textureRepeat,t.waveVelocity=s.waveVelocity,t.flowStrength=s.perturbationStrength,t.hasSlicePlane=this._context.slicePlaneEnabled,t.draped=this.draped,this._materials[0]=new Ea(t,this._context),this._context.stage.add(this._materials[0])}layerOpacityChanged(){if(null==this._materials[0])return;const t=this._materials[0].parameters.color,e=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),i=e<1||this.needsDrivenTransparentPass;this._materials[0].setParameters({color:[t[0],t[1],t[2],e],transparent:i})}layerElevationInfoChanged(t,e,i){const r=this._elevationContext.mode,s=(0,P.I2)(Fa.elevationModeChangeTypes,i,r);if(s!==P.uw.UPDATE)return s;const n=(0,P.nu)(r);return this.updateGraphics3DGraphicElevationInfo(t,e,(()=>n))}slicePlaneEnabledChanged(){return this._materials[0]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(t,e,i){const r=V(t.geometry);if(null==r)return null;const s=Z(r,this._context.elevationProvider,this._context.renderCoordsHelper,e),n=s.position.length/3,o=(0,_.jh)(2*n);ka(o,s.mapPositions,n,this._context.elevationProvider.spatialReference);const a=new Ha(s,o,this._context.layer.uid,t.uid);if(a.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(a),this._create3DShapeGeometries(a),this._logGeometryCreationWarnings(a.renderData,r.rings,"rings","WaterSymbol3DLayer"),0===a.outGeometries.length)return null;const l=new ot.B({geometries:a.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:i}),h=new S.Y(this,l,a.outGeometries,null,null,ie.B6,e);return h.alignedSampledElevation=a.renderData.sampledElevation,h.needsElevationUpdates=(0,P.nu)(e.mode),h}_create3DShapeGeometries(t){const e=t.renderData.polygons,i=t.uvCoords;for(const{count:r,index:s,position:n,mapPositions:o,holeIndices:a}of e){if(null!=this._context.clippingExtent&&((0,g.vY)(o,Ga),!(0,g.KG)(Ga,this._context.clippingExtent)))continue;const e=(0,l.e)(o,a,3);if(0===e.length)continue;const h=(0,_.l5)(i,2*s,2*r),c=k({material:this._materials[0],indices:e,mapPositions:o,attributeData:{position:n,uv0:h}},t.objectAndLayerIdColor);t.outGeometries.push(c)}}_createAsOverlay(t){const e=V(t.geometry);if(null==e)return null;this._materials[0].renderPriority=this._renderPriority;const i=q(e,this._context.overlaySR),r=i.position.length/3,s=(0,_.jh)(2*r);ka(s,i.position,r,this._context.overlaySR);const n=new Wa(i,s,this._context.layer.uid,t.uid);return n.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(n),n.outBoundingBox=(0,g.Ie)(),this._createAsOverlayWater(n),this._logGeometryCreationWarnings(n.renderData,e.rings,"rings","WaterSymbol3DLayer"),0===n.outGeometries.length?null:new ne(this,n.outGeometries,n.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayWater(t){const e=t.uvCoords,i=t.renderData.polygons;for(const{position:r,holeIndices:s,index:n,count:o}of i){if((0,g.vY)(r,Ga),!(0,g.KG)(Ga,this._context.clippingExtent))continue;(0,g.RF)(t.outBoundingBox,Ga);const i=(0,l.e)(r,s,3);if(0===i.length)continue;const a=(0,_.l5)(e,2*n,2*o),h=k({material:this._materials[0],indices:i,attributeData:{position:r,uv0:a}},t.objectAndLayerIdColor);t.outGeometries.push(new pe.$(h,t))}}test(){return{...super.test(),create3DShape:t=>this._createAs3DShape(t.graphic,t.elevationContext,t.graphicUid),ensureMaterial:()=>this.ensureMaterial()}}}function ka(t,e,i,r){const s=(0,a.GA)(r);(0,re.Ie)(Ba);for(let t=0;t<i;t++)(0,Ui.hZ)(Ua,e[3*t],e[3*t+1]),(0,re.tK)(Ba,Ua);(0,oa.d)(Ba,Ba,s);const n=Ba[0]%Fa.unitSizeOfTexture,o=Ba[1]%Fa.unitSizeOfTexture;Va[0]=Ba[0]-n,Va[1]=Ba[1]-o;for(let r=0;r<i;r++)t[2*r]=(e[3*r]*s-Va[0])/Fa.unitSizeOfTexture,t[2*r+1]=(e[3*r+1]*s-Va[1])/Fa.unitSizeOfTexture}Fa.unitSizeOfTexture=100,Fa.elevationModeChangeTypes={definedChanged:P.uw.RECREATE,staysOnTheGround:P.uw.NONE,onTheGroundChanged:P.uw.RECREATE};const Va=(0,Ht.vt)(),Ba=(0,re.vt)(),Ua=(0,Ht.vt)(),Ga=(0,g.vt)();class Ha extends B{constructor(t,e,i,r){super(t,i,r),this.uvCoords=e}}class Wa extends B{constructor(t,e,i,r){super(t,i,r),this.uvCoords=e}}function ja(t,e,i,s){const n=Za[t.type]?.[e.type]||$a[e.type];return n?new n(t,e,i,s):(r.A.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory").error("GraphicsLayerFactory#make",`unknown symbol type ${e.type}`),null)}const $a={icon:be,object:ms,line:ai,path:jn,fill:ko,extrude:ht,text:Sa,water:Fa},Za={"mesh-3d":{fill:Pr}}},45869:function(t,e,i){i.d(e,{fetch:function(){return K}});var r=i(14520),s=i(15774),n=i(44705),o=i(87725),a=i(73364),l=i(39714),h=i(1932),c=i(20551),u=i(32501),d=i(24761),f=i(5047),p=i(92754),m=i(62693),g=i(32003),_=i(78598),y=i(96400),v=i(84111),x=i(44432),b=i(33913),w=i(43),P=i(54200);class S{constructor(){this.geometries=new Array,this.materials=new Array,this.textures=new Array}}class C{constructor(t,e,i){this.name=t,this.lodThreshold=e,this.pivotOffset=i,this.stageResources=new S,this.numberOfVertices=0}}var T=i(93040),M=i(77472),A=i(63952),R=i(39819),O=i(40633),I=i(7970),E=i(60539),L=i(58009),D=i(37819),z=i(9030),N=i(14905),F=i(54407),k=i(89769),V=i(59552),B=i(65839),U=i(42674),G=i(85456);const H=()=>O.A.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");function W(t){throw new R.A("",`Request for object resource failed: ${t}`)}function j(t){const e=t.params,i=e.topology;let r=!0;switch(e.vertexAttributes||(H().warn("Geometry must specify vertex attributes"),r=!1),e.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const t=e.faces;if(t){if(e.vertexAttributes)for(const i in e.vertexAttributes){const e=t[i];e?.values?(null!=e.valueType&&"UInt32"!==e.valueType&&(H().warn(`Unsupported indexed geometry indices type '${e.valueType}', only UInt32 is currently supported`),r=!1),null!=e.valuesPerElement&&1!==e.valuesPerElement&&(H().warn(`Unsupported indexed geometry values per element '${e.valuesPerElement}', only 1 is currently supported`),r=!1)):(H().warn(`Indexed geometry does not specify face indices for '${i}' attribute`),r=!1)}}else H().warn("Indexed geometries must specify faces"),r=!1;break}default:H().warn(`Unsupported topology '${i}'`),r=!1}t.params.material||(H().warn("Geometry requires material"),r=!1);const s=t.params.vertexAttributes;for(const t in s)s[t].values||(H().warn("Geometries with externally defined attributes are not yet supported"),r=!1);return r}function $(t){const e=(0,d.Ie)();return t.forEach((t=>{const i=t.boundingInfo;null!=i&&((0,d.iT)(e,i.bbMin),(0,d.iT)(e,i.bbMax))})),e}function Z(t){switch(t){case"mask":return F.sf.Mask;case"maskAndTransparency":return F.sf.MaskBlend;case"none":return F.sf.Opaque;default:return F.sf.Blend}}function q(t){const e=t.params;return{id:1,material:e.material,texture:e.texture,region:e.texture}}const Y=new L.R(1,2,"wosr");var X=i(11377),Q=i(12474),J=i(27539);async function K(t,e){const o=function(t){const e=t.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return e?{fileType:"gltf",url:e[1],specifiedLodIndex:null!=e[4]?Number(e[4]):null}:t.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:t,specifiedLodIndex:null}:{fileType:"unknown",url:t,specifiedLodIndex:null}}((0,r.EM)(t));if("wosr"===o.fileType){const t=await(e.cache?e.cache.loadWOSR(o.url,e):async function(t,e){const i=await async function(t,e){const i=e?.streamDataRequester;if(i)return async function(t,e,i){const r=await(0,M.Ke)(e.request(t,"json",i));if(!0===r.ok)return r.value;(0,E.QP)(r.error),W(r.error.details.url)}(t,i,e);const r=await(0,M.Ke)((0,T.A)(t,e));if(!0===r.ok)return r.value.data;(0,E.QP)(r.error),W(r.error)}(t,e),r=await async function(t,e){const i=new Array;for(const r in t){const s=t[r],n=s.images[0].data;if(!n){H().warn("Externally referenced texture data is not yet supported");continue}const o=s.encoding+";base64,"+n,a="/textureDefinitions/"+r,l="rgba"===s.channels?s.alphaChannelUsage||"transparency":"none",h={noUnpackFlip:!0,wrap:{s:G.pF.REPEAT,t:G.pF.REPEAT},preMultiplyAlpha:Z(l)!==F.sf.Opaque},c=e?.disableTextures?Promise.resolve(null):(0,z.D)(o,e);i.push(c.then((t=>({refId:a,image:t,parameters:h,alphaChannelUsage:l}))))}const r=await Promise.all(i),s={};for(const t of r)s[t.refId]=t;return s}(i.textureDefinitions??{},e);let s=0;for(const t in r)if(r.hasOwnProperty(t)){const e=r[t];s+=e?.image?e.image.width*e.image.height*4:0}return{resource:i,textures:r,size:s+(0,A.iL)(i)}}(o.url,e)),{engineResources:i,referenceBoundingBox:r}=function(t,e){const i=new Array,r=new Array,s=new Array,n=new I.O,o=t.resource,a=L.R.parse(o.version||"1.0","wosr");Y.validate(a);const l=o.model.name,h=o.model.geometries,c=o.materialDefinitions??{},d=t.textures;let f=0;const p=new Map;for(let t=0;t<h.length;t++){const o=h[t];if(!j(o))continue;const a=q(o),l=o.params.vertexAttributes,m=[],g=t=>{if("PerAttributeArray"===o.params.topology)return null;const e=o.params.faces;for(const i in e)if(i===t)return e[i].values;return null},_=l[B.r.POSITION],y=_.values.length/_.valuesPerElement;for(const t in l){const e=l[t],i=e.values,r=g(t)??(0,D.tM)(y);m.push([t,new N.n(i,r,e.valuesPerElement,!0)])}const v=a.texture,x=d&&d[v];if(x&&!p.has(v)){const{image:t,parameters:e}=x,i=new V.g(t,e);r.push(i),p.set(v,i)}const b=p.get(v),w=b?b.id:void 0,P=a.material;let S=n.get(P,v);if(null==S){const t=c[P.slice(P.lastIndexOf("/")+1)].params;1===t.transparency&&(t.transparency=0);const i=x&&x.alphaChannelUsage,r=t.transparency>0||"transparency"===i||"maskAndTransparency"===i,s=x?Z(x.alphaChannelUsage):void 0,o={ambient:(0,u.ci)(t.diffuse),diffuse:(0,u.ci)(t.diffuse),opacity:1-(t.transparency||0),transparent:r,textureAlphaMode:s,textureAlphaCutoff:.33,textureId:w,initTextureTransparent:!0,doubleSided:!0,cullFace:F.s2.None,colorMixMode:t.externalColorMixMode||"tint",textureAlphaPremultiplied:x?.parameters.preMultiplyAlpha??!1};e?.materialParameters&&Object.assign(o,e.materialParameters),S=new U.$U(o,e),n.set(P,v,S)}s.push(S);const C=new k.V(S,m);f+=m.find((t=>t[0]===B.r.POSITION))?.[1]?.indices.length??0,i.push(C)}return{engineResources:[{name:l,stageResources:{textures:r,materials:s,geometries:i},pivotOffset:o.model.pivotOffset,numberOfVertices:f,lodThreshold:null}],referenceBoundingBox:$(i)}}(t,e);return{lods:i,referenceBoundingBox:r,isEsriSymbolResource:!1,isWosr:!0}}let S;if(e.cache)S=await e.cache.loadGLTF(o.url,e,!!e.usePBR);else{const{loadGLTF:t}=await i.e(1380).then(i.bind(i,32680));S=await t(new x.R(e.streamDataRequester),o.url,e,e.usePBR)}const R=S.model.meta?.ESRI_proxyEllipsoid,O=S.meta.isEsriSymbolResource&&null!=R&&"EsriRealisticTreesStyle"===S.meta.ESRI_webstyle;O&&!S.customMeta.esriTreeRendering&&(S.customMeta.esriTreeRendering=!0,function(t,e){for(let i=0;i<t.model.lods.length;++i){const r=t.model.lods[i];for(const s of r.parts){const r=s.attributes.normal;if(null==r)return;const n=s.attributes.position,o=n.count,h=(0,u.vt)(),d=(0,u.vt)(),f=(0,u.vt)(),m=new Uint8Array(4*o),g=new Float64Array(3*o),_=(0,a.B8)((0,l.vt)(),s.transform);let y=0,v=0;for(let a=0;a<o;a++){n.getVec(a,d),r.getVec(a,h),(0,c.t)(d,d,s.transform),(0,c.d)(f,d,e.center),(0,c.E)(f,f,e.radius);const o=f[2],l=(0,c.l)(f),u=Math.min(.45+.55*l*l,1);(0,c.E)(f,f,e.radius),null!==_&&(0,c.t)(f,f,_),(0,c.n)(f,f),i+1!==t.model.lods.length&&t.model.lods.length>1&&(0,c.m)(f,f,h,o>-1?.2:Math.min(-4*o-3.8,1)),g[y]=f[0],g[y+1]=f[1],g[y+2]=f[2],y+=3,m[v]=255*u,m[v+1]=255*u,m[v+2]=255*u,m[v+3]=255,v+=4}s.attributes.normal=new p.xs(g),s.attributes.color=new p.XP(m)}}}(S,R));const K=!!e.usePBR,et=S.meta.isEsriSymbolResource?{usePBR:K,isSchematic:!1,treeRendering:O,mrrFactors:J.SY}:{usePBR:K,isSchematic:!1,treeRendering:!1,mrrFactors:J.mb},it={...e.materialParameters,treeRendering:O},{engineResources:rt,referenceBoundingBox:st}=function(t,e,i,r,o){const a=t.model,l=new Array,c=new Map,u=new Map,x=a.lods.length,S=(0,d.Ie)();return a.lods.forEach(((t,T)=>{const M=!0===r.skipHighLods&&(x>1&&0===T||x>3&&1===T)||!1===r.skipHighLods&&null!=o&&T!==o;if(M&&0!==T)return;const A=new C(t.name,t.lodThreshold,[0,0,0]);t.parts.forEach((t=>{const o=M?new U.$U({},r):function(t,e,i,r,s,n,o,a){const l=e.material+(e.attributes.normal?"_normal":"")+(e.attributes.color?"_color":"")+(e.attributes.texCoord0?"_texCoord0":"")+(e.attributes.tangent?"_tangent":""),c=t.materials.get(e.material),u=null!=e.attributes.texCoord0,d=null!=e.attributes.normal;if(null==c)return null;const f=function(t){switch(t){case"BLEND":return F.sf.Blend;case"MASK":return F.sf.Mask;case"OPAQUE":case null:case void 0:return F.sf.Opaque}}(c.alphaMode);if(!n.has(l)){if(u){const e=(e,i=!1)=>{if(null!=e&&!o.has(e)){const r=t.textures.get(e);if(null!=r){const t=r.data;o.set(e,new V.g((0,w.x3)(t)?t.data:t,{...r.parameters,preMultiplyAlpha:!(0,w.x3)(t)&&i,encoding:(0,w.x3)(t)&&null!=t.encoding?t.encoding:void 0}))}}};e(c.textureColor,f!==F.sf.Opaque),e(c.textureNormal),e(c.textureOcclusion),e(c.textureEmissive),e(c.textureMetallicRoughness)}const i=c.color[0]**(1/Q.T),p=c.color[1]**(1/Q.T),m=c.color[2]**(1/Q.T),g=c.emissiveFactor[0]**(1/Q.T),_=c.emissiveFactor[1]**(1/Q.T),y=c.emissiveFactor[2]**(1/Q.T),v=null!=c.textureColor&&u?o.get(c.textureColor):null,x=(0,J.Jr)({normalTexture:c.textureNormal,metallicRoughnessTexture:c.textureMetallicRoughness,metallicFactor:c.metallicFactor,roughnessFactor:c.roughnessFactor,emissiveTexture:c.textureEmissive,emissiveFactor:c.emissiveFactor,occlusionTexture:c.textureOcclusion}),b=null!=c.normalTextureTransform?.scale?c.normalTextureTransform?.scale:h.Un;n.set(l,new U.$U({...r,transparent:f===F.sf.Blend,customDepthTest:F.it.Lequal,textureAlphaMode:f,textureAlphaCutoff:c.alphaCutoff,diffuse:[i,p,m],ambient:[i,p,m],opacity:c.opacity,doubleSided:c.doubleSided,doubleSidedType:"winding-order",cullFace:c.doubleSided?F.s2.None:F.s2.Back,hasVertexColors:!!e.attributes.color,hasVertexTangents:!!e.attributes.tangent,normalType:d?X.W.Attribute:X.W.ScreenDerivative,castShadows:!0,receiveShadows:c.receiveShadows,receiveAmbientOcclusion:c.receiveAmbientOcclustion,textureId:null!=v?v.id:void 0,colorMixMode:c.colorMixMode,normalTextureId:null!=c.textureNormal&&u?o.get(c.textureNormal).id:void 0,textureAlphaPremultiplied:null!=v&&!!v.parameters.preMultiplyAlpha,occlusionTextureId:null!=c.textureOcclusion&&u?o.get(c.textureOcclusion).id:void 0,emissiveTextureId:null!=c.textureEmissive&&u?o.get(c.textureEmissive).id:void 0,metallicRoughnessTextureId:null!=c.textureMetallicRoughness&&u?o.get(c.textureMetallicRoughness).id:void 0,emissiveFactor:[g,_,y],mrrFactors:x?J.Bt:[c.metallicFactor,c.roughnessFactor,r.mrrFactors[2]],isSchematic:x,colorTextureTransformMatrix:(0,P.G)(c.colorTextureTransform),normalTextureTransformMatrix:(0,P.G)(c.normalTextureTransform),scale:[b[0],b[1]],occlusionTextureTransformMatrix:(0,P.G)(c.occlusionTextureTransform),emissiveTextureTransformMatrix:(0,P.G)(c.emissiveTextureTransform),metallicRoughnessTextureTransformMatrix:(0,P.G)(c.metallicRoughnessTextureTransform),...s},a))}const p=n.get(l);if(i.stageResources.materials.push(p),u){const t=t=>{null!=t&&i.stageResources.textures.push(o.get(t))};t(c.textureColor),t(c.textureNormal),t(c.textureOcclusion),t(c.textureEmissive),t(c.textureMetallicRoughness)}return p}(a,t,A,e,i,c,u,r),{geometry:l,vertexCount:x}=function(t,e){const i=t.attributes.position.count,r=(0,b.x)(t.indices||i,t.primitiveType),o=(0,f.oe)(3*i),{typedBuffer:a,typedBufferStride:l}=t.attributes.position;(0,m.t)(o,a,t.transform,3,l);const h=[[B.r.POSITION,new N.n(o,r,3,!0)]];if(null!=t.attributes.normal){const e=(0,f.oe)(3*i),{typedBuffer:o,typedBufferStride:a}=t.attributes.normal;(0,n.Ge)(tt,t.transform),(0,m.b)(e,o,tt,3,a),(0,s.or)(tt)&&(0,m.n)(e,e),h.push([B.r.NORMAL,new N.n(e,r,3,!0)])}if(null!=t.attributes.tangent){const e=(0,f.oe)(4*i),{typedBuffer:o,typedBufferStride:a}=t.attributes.tangent;(0,n.z0)(tt,t.transform),(0,g.t)(e,o,tt,4,a),(0,s.or)(tt)&&(0,m.n)(e,e,4),h.push([B.r.TANGENT,new N.n(e,r,4,!0)])}if(null!=t.attributes.texCoord0){const e=(0,f.oe)(2*i),{typedBuffer:s,typedBufferStride:n}=t.attributes.texCoord0;(0,_.a)(e,s,2,n),h.push([B.r.UV0,new N.n(e,r,2,!0)])}const c=t.attributes.color;if(null!=c){const e=new Uint8Array(4*i);4===c.elementCount?c instanceof p.Eq?(0,g.b)(e,c,255):c instanceof p.XP?(0,v.a)(e,c):c instanceof p.Uz&&(0,g.b)(e,c,1/256):(e.fill(255),c instanceof p.xs?(0,m.f)(e,c.typedBuffer,255,4,c.typedBufferStride):t.attributes.color instanceof p.eI?(0,y.c)(e,c.typedBuffer,4,t.attributes.color.typedBufferStride):t.attributes.color instanceof p.nS&&(0,m.f)(e,c.typedBuffer,1/256,4,c.typedBufferStride)),h.push([B.r.COLOR,new N.n(e,r,4,!0)])}return{geometry:new k.V(e,h),vertexCount:i}}(t,o??new U.$U({},r)),C=l.boundingInfo;null!=C&&0===T&&((0,d.iT)(S,C.bbMin),(0,d.iT)(S,C.bbMax)),null!=o&&(A.stageResources.geometries.push(l),A.numberOfVertices+=x)})),M||l.push(A)})),{engineResources:l,referenceBoundingBox:S}}(S,et,it,e,o.specifiedLodIndex);return{lods:rt,referenceBoundingBox:st,isEsriSymbolResource:S.meta.isEsriSymbolResource,isWosr:!1}}const tt=(0,o.vt)()},3107:function(t,e,i){i.d(e,{Ir:function(){return h},QE:function(){return l},RH:function(){return c},Zd:function(){return a},cN:function(){return o},xU:function(){return u}});var r=i(13786),s=i(1932),n=i(36029);const o=Object.freeze({left:0,center:.5,right:1}),a=Object.freeze({"bottom-left":(0,s.fA)(0,0),bottom:(0,s.fA)(.5,0),"bottom-right":(0,s.fA)(1,0),left:(0,s.fA)(0,.5),center:(0,s.fA)(.5,.5),right:(0,s.fA)(1,.5),"top-left":(0,s.fA)(0,1),top:(0,s.fA)(.5,1),"top-right":(0,s.fA)(1,1)});function l(t){switch(t){case"left":return n.lV.Left;case"right":return n.lV.Right;default:return n.lV.Center}}function h(t,e){switch(e){case"bottom":return"left"===t?"bottom-left":"right"===t?"bottom-right":"bottom";case"center":return t;case"top":return"left"===t?"top-left":"right"===t?"top-right":"top"}}function c(t){return"middle"===t?"center":t}function u(t,e){switch(t){case"top":return(0,r.hZ)(e,0,n.Xd);case"bottom":return(0,r.hZ)(e,0,-n.Xd);default:return(0,r.C)(e,s.uY)}}},69550:function(t,e,i){i.d(e,{U:function(){return n}});var r=i(85456),s=i(3817);function n(t,e=0){const i=t.stride;return Array.from(t.fields.keys()).map((r=>{const n=t.fields.get(r),a=n.constructor.ElementCount,l=o(n.constructor.ElementType),h=n.offset,c=n.optional?.glNormalized??!1;return new s._(r,a,l,h,i,c,e)}))}function o(t){const e=a[t];if(e)return e;throw new Error("BufferType not supported in WebGL")}const a={u8:r.pe.UNSIGNED_BYTE,u16:r.pe.UNSIGNED_SHORT,u32:r.pe.UNSIGNED_INT,i8:r.pe.BYTE,i16:r.pe.SHORT,i32:r.pe.INT,f32:r.pe.FLOAT}},79366:function(t,e,i){i.d(e,{t:function(){return g},z:function(){return v}});var r=i(13786),s=i(1932),n=i(41546),o=i(61714),a=i(61441),l=i(50240),h=i(5047),c=i(37819),u=i(65420),d=i(14905),f=i(40359),p=i(89769),m=i(65839);function g(t,e,i=null){const s=[],g=e.mapPositions;!function(t,e){const{attributeData:{position:i},removeDuplicateStartEnd:r}=t,s=function(t){const e=t.length;return t[0]===t[e-3]&&t[1]===t[e-2]&&t[2]===t[e-1]}(i)&&r,n=i.length/3-(s?1:0),o=new Array(2*(n-1)),a=s?i.slice(0,-3):i;let l=0;for(let t=0;t<n-1;t++)o[l++]=t,o[l++]=t+1;e.push([m.r.POSITION,new d.n(a,o,3,s)])}(e,s);const v=s[0][1].data,x=s[0][1].indices.length,b=(0,c.EH)(x);return function(t,e,i){if(null!=t.attributeData.colorFeature)return;const r=t.attributeData.color;e.push([m.r.COLOR,new d.n(r??n.Un,i,4)])}(e,s,b),function(t,e,i){null==t.attributeData.sizeFeature&&e.push([m.r.SIZE,new d.n([t.attributeData.size??1],i,1,!0)])}(e,s,b),function(t,e,i){t.attributeData.normal&&e.push([m.r.NORMAL,new d.n(t.attributeData.normal,i,3)])}(e,s,b),function(t,e,i){null!=t.attributeData.colorFeature&&e.push([m.r.COLORFEATUREATTRIBUTE,new d.n([t.attributeData.colorFeature],i,1,!0)])}(e,s,b),function(t,e,i){null!=t.attributeData.sizeFeature&&e.push([m.r.SIZEFEATUREATTRIBUTE,new d.n([t.attributeData.sizeFeature],i,1,!0)])}(e,s,b),function(t,e,i){null!=t.attributeData.opacityFeature&&e.push([m.r.OPACITYFEATUREATTRIBUTE,new d.n([t.attributeData.opacityFeature],i,1,!0)])}(e,s,b),function(t,e,i){if(null==t.overlayInfo||t.overlayInfo.renderCoordsHelper.viewingMode!==u.RT.Global||!t.overlayInfo.spatialReference.isGeographic)return;const s=(0,l.jh)(i.length),n=(0,o.tO)(t.overlayInfo.spatialReference);for(let t=0;t<s.length;t+=3)(0,a.RC)(i,t,s,t,n);const c=i.length/3,f=(0,h.oe)(c+1);let p=_,g=y,v=0,x=0;(0,r.hZ)(p,s[x++],s[x++]),x++,f[0]=0;for(let t=1;t<c+1;++t)t===c&&(x=0),(0,r.hZ)(g,s[x++],s[x++]),x++,v+=(0,r.xg)(p,g),f[t]=v,[p,g]=[g,p];e.push([m.r.DISTANCETOSTART,new d.n(f,e[0][1].indices,1,!0)])}(e,s,v),new p.V(t,s,g,f.X.Line,i)}const _=(0,s.vt)(),y=(0,s.vt)();function v(t,e){if(null==t||0===t.length)return[];const i=[];return t.forEach((t=>{const r=t.length,s=(0,l.jh)(3*r);t.forEach(((t,e)=>{s[3*e]=t[0],s[3*e+1]=t[1],s[3*e+2]=t[2]}));const n={attributeData:{position:s,normal:e},removeDuplicateStartEnd:!1};i.push(n)})),i}},29800:function(t,e,i){i.d(e,{A:function(){return h},C:function(){return l}});var r=i(57617),s=i(50240),n=i(82588),o=i(49618),a=i(58704);function l(t,e,i,r){const a="polygon"===t.type?n.Wq.CCW_IS_HOLE:n.Wq.NONE,l="polygon"===t.type?t.rings:t.paths,{position:h,outlines:u}=(0,n.oR)(l,!!t.hasZ,a,t.spatialReference),d=(0,s.jh)(h.length),f=(0,o.au)(h,t.spatialReference,0,d,0,h,0,h.length/3,e,i,r),p=null!=f;return{lines:p?c(u,h,d):[],projectionSuccess:p,sampledElevation:f}}function h(t,e){const i="polygon"===t.type?n.Wq.CCW_IS_HOLE:n.Wq.NONE,s="polygon"===t.type?t.rings:t.paths,{position:o,outlines:l}=(0,n.oR)(s,!1,i),h=(0,r.projectBuffer)(o,t.spatialReference,0,o,e,0);for(let t=2;t<o.length;t+=3)o[t]=a.bi;return{lines:h?c(l,o):[],projectionSuccess:h}}function c(t,e,i=null){const r=new Array;for(const{index:n,count:o}of t){if(o<=1)continue;const t=3*n,a=3*o;r.push({position:(0,s.l5)(e,3*n,3*o),mapPositions:null!=i?(0,s.l5)(i,t,a):void 0})}return r}},89756:function(t,e,i){i.d(e,{MQ:function(){return s}}),i(38177);var r=i(50456);i(59356);class s extends r.R6{constructor(t,e,i){super(t,e),this.triangleNr=i}}},58704:function(t,e,i){i.d(e,{bi:function(){return Xe}});var r,s,n=i(53804),o=i(48996),a=i(58941),l=i(25738),h=i(95929),c=i(7187),u=i(28181),d=i(17660),f=i(23502),p=i(40633),m=(i(13798),i(65953)),g=i(73364),_=i(20551),y=i(32501),v=i(46949),x=i(70974),b=i(86398),w=i(87416),P=i(79068);class S{constructor(){this._extent=(0,w.vt)(),this.resolution=0,this.renderLocalOrigin=(0,P.f)(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new C}get extent(){return this._extent}setupGeometryViewsCyclical(t){this.setupGeometryView();const e=.001*t.range;if(this._extent[0]-e<=t.min){const e=this.canvasGeometries.extents[this.canvasGeometries.numViews++];(0,w.cY)(this._extent,t.range,0,e)}if(this._extent[2]+e>=t.max){const e=this.canvasGeometries.extents[this.canvasGeometries.numViews++];(0,w.cY)(this._extent,-t.range,0,e)}}setupGeometryView(){this.canvasGeometries.numViews=1,(0,w.C)(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let t=0;t<this.canvasGeometries.numViews;t++){const e=this.canvasGeometries.extents[t];if(e[0]!==e[2]&&e[1]!==e[3])return!0}return!1}}class C{constructor(){this.extents=[(0,w.vt)(),(0,w.vt)(),(0,w.vt)()],this.numViews=0}}(s=r||(r={}))[s.Color=0]="Color",s[s.ColorNoRasterImage=1]="ColorNoRasterImage",s[s.Highlight=2]="Highlight",s[s.WaterNormal=3]="WaterNormal",s[s.Occluded=4]="Occluded",s[s.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor";class T{constructor(t,e,i){this._fbos=t,this._format=e,this._name=i}get valid(){return null!=this._handle?.getTexture()}dispose(){this._handle=(0,h.Gz)(this._handle)}get texture(){return this._handle?.getTexture()}bind(t,e,i){this._handle&&this._handle.fbo?.width===e&&this._handle.fbo?.height===i||(this._handle?.release(),this._handle=this._fbos.acquire(e,i,this._name,this._format)),t.bindFramebuffer(this._handle?.fbo)}generateMipMap(){this._handle?.getTexture()?.descriptor?.hasMipmap&&this._handle?.getTexture()?.generateMipmap()}}var M=i(98680),A=i(27264),R=i(39534);class O{constructor(t,e,i,r,s=M.N.RGBA_MIPMAP){this.output=i,this.content=r,this.fbo=new T(t,s,e)}get valid(){return this.fbo.valid}}class I{constructor(t){this.targets=[new O(t,"overlay color",A.V.Color,r.Color),new O(t,"overlay IM color",A.V.Color,r.ColorNoRasterImage),new O(t,"overlay highlight",A.V.Highlight,r.Highlight,M.N.RG),new O(t,"overlay water",A.V.Normal,r.WaterNormal),new O(t,"overlay occluded",A.V.Color,r.Occluded)],(0,R.E)()&&this.targets.push(new O(t,"overlay olid",A.V.ObjectAndLayerIdColor,r.ObjectAndLayerIdColor,M.N.RGBA))}getTexture(t){return this.targets[t]?.fbo.texture}dispose(){for(const t of this.targets)t.fbo.dispose()}computeValidity(){return this.targets.reduce(((t,e,i)=>e.valid?t|=1<<i:t),0)}}var E,L,D=i(65631),z=i(41546);i(94211).Zo,(L=E||(E={}))[L.Material=0]="Material",L[L.ShadowMap=1]="ShadowMap",L[L.Highlight=2]="Highlight",L[L.ViewshedShadowMap=3]="ViewshedShadowMap",i(42426),i(11520),i(5830),i(41356),i(14543);var N,F,k=i(39506),V=(i(39838),i(65312));(F=N||(N={}))[F.Disabled=0]="Disabled",F[F.Enabled=1]="Enabled",F[F.EnabledWithWater=2]="EnabledWithWater",F[F.COUNT=3]="COUNT",(0,z.vt)(),V.n;var B=i(55747),U=i(67521),G=i(13786),H=i(46671),W=i(74174),j=i(34615),$=i(82273),Z=i(82186),q=i(57087);class Y extends $.w{constructor(t,e,r){super(t,e,new j.$(Z.H,(()=>i.e(4746).then(i.bind(i,50906)))),r)}initializePipeline(){return(0,q.Ey)({blending:q.Ky,colorWrite:q.kn})}}var X=i(40434);class Q extends $.w{constructor(t,e,r){super(t,e,new j.$(X.a,(()=>i.e(5536).then(i.bind(i,5858)))),r)}initializePipeline(){return(0,q.Ey)({colorWrite:q.kn})}}var J=i(82854);class K extends k.Y{constructor(){super(...arguments),this.occludedFactor=J.cD,this.maxHighlightLevel=1,this.verticalCellCount=0,this.horizontalCellCount=0,this.highlightLevel=0,this.pixelRatio=1}}var tt=i(46655);class et extends $.w{constructor(t,e,r){super(t,e,new j.$(tt.H,(()=>i.e(2803).then(i.bind(i,7471)))),r)}initializePipeline(){return(0,q.Ey)({colorWrite:q.kn})}}var it=i(966);class rt extends $.w{constructor(t,e,r){super(t,e,new j.$(it.S,(()=>i.e(9086).then(i.bind(i,69718)))),r)}initializePipeline(){return(0,q.Ey)({blending:q.Ky,colorWrite:q.kn})}}var st=i(2963);class nt extends $.w{constructor(t,e,r){super(t,e,new j.$(st.a,(()=>i.e(8643).then(i.bind(i,92227)))),r)}initializePipeline(){return(0,q.Ey)({colorWrite:q.kn})}}var ot=i(54407),at=i(40502),lt=i(65839),ht=i(85456),ct=i(3817);const ut=[];new ct._(lt.r.POSITION,3,ht.pe.FLOAT,0,12),new ct._(lt.r.POSITION,2,ht.pe.FLOAT,0,8),new ct._(lt.r.POSITION,2,ht.pe.FLOAT,0,16),new ct._(lt.r.UV0,2,ht.pe.FLOAT,8,16);var dt=i(69445),ft=i(86305),pt=i(12285),mt=i(10956);let gt=class extends W.A{constructor(t){super(t),this.produces=H.OG.HIGHLIGHTS,this.consumes={required:[H.OG.HIGHLIGHTS,"highlights"]},this.useMultipleHighlights=!!(0,a.A)("enable-feature:multiple-highlights"),this._optionsTexture=null,this._downsampleDrawParameters=new X.H,this._passParameters=new K,this._singleHighlightBlurDrawParameters=new st.S,this._grid=new _t,t.techniques.precompile(Q),this.useMultipleHighlights?t.techniques.precompile(Y):(t.techniques.precompile(et),t.techniques.precompile(nt),t.techniques.precompile(rt))}initialize(){this.addHandles([(0,u.watch)((()=>wt(this.view.highlights)),(()=>{this._optionsTexture=(0,h.WD)(this._optionsTexture),this.requestRender(ot.C7.UPDATE)}),u.Vh)])}destroy(){this._passParameters&&(this._passParameters.highlightOptionsTexture=null),this._grid.coverage=(0,h.Gz)(this._grid.coverage),this._grid.vao=(0,h.WD)(this._grid.vao),this._optionsTexture=(0,h.Gz)(this._optionsTexture)}_updateOptionsTexture(t){const e=this.renderingContext;let i=this._optionsTexture;if(null==i){const t=new mt.R(16,2);t.internalFormat=ht.Ab.RGBA,t.samplingMode=ht.Cj.NEAREST,i=new pt.g(e,t,null),this._optionsTexture=i}i.setData(t),this._passParameters.highlightOptionsTexture=i}render(t){const e=t.find((({name:t})=>t===H.OG.HIGHLIGHTS)),{techniques:i,bindParameters:r,_passParameters:s,renderingContext:n}=this;if(!r.decorations)return e;const o=i.acquire(Q);if(!o.compiled)return o.release(),this.requestRender(ot.C7.UPDATE),e;const a=t.find((({name:t})=>"highlights"===t)).getTexture(),l=()=>{const{highlights:t}=this.view;this._optionsTexture||this._updateOptionsTexture(function(t){const e=new Uint8Array(128),i=(t,i)=>{e[t]=i};return xt(t,((t,e)=>{((t,e)=>{const r=4*t,s=4*t+64,{color:n}=e,o=e.haloColor??n;i(r+0,n.r),i(r+1,n.g),i(r+2,n.b),i(r+3,e.fillOpacity*n.a*255),i(s+0,o.r),i(s+1,o.g),i(s+2,o.b),i(s+3,e.haloOpacity*o.a*255)})(e,t.options)})),e}(t)),s.highlightOptionsTexture=this._optionsTexture,this._gridUpdateResources(a);const e=this._gridComputeCoverage(o,a,r);o.release();const{horizontalCellCount:i,verticalCellCount:n}=e;return s.horizontalCellCount=i,s.verticalCellCount=n,s.coverageTexture=e.coverage?.getTexture(),e},h=t=>{const e=t.verticalCellCount*t.horizontalCellCount;n.bindVAO(t.vao),n.drawElementsInstanced(ht.WR.TRIANGLES,6,ht.pe.UNSIGNED_BYTE,0,e)},{camera:c}=r,u=()=>{n.bindFramebuffer(e.fbo),n.setViewport4fv(c.fullViewport)};return this.useMultipleHighlights?this._renderMultiple(a,l,h,u):this._renderSingle(a,l,h,u),s.highlightTexture=null,s.coverageTexture=null,e}_renderMultiple(t,e,i,r){const{techniques:s,bindParameters:n,_passParameters:o,renderingContext:a}=this,l=s.acquire(Y);if(!l.compiled)return l.release(),void this.requestRender(ot.C7.UPDATE);const h=e();o.highlightTexture=t,o.pixelRatio=n.camera.pixelRatio,o.maxHighlightLevel=St(this.view.highlights)-1,a.bindTechnique(l,n,o),r(),i(h),l.release()}_renderSingle(t,e,i,r){const{fboCache:s,techniques:n,bindParameters:o,_passParameters:a,renderingContext:l}=this,h=n.acquire(et),c=n.acquire(nt),u=n.acquire(rt);if(!u.compiled||!c.compiled||!h.compiled)return u.release(),c.release(),h.release(),void this.requestRender(ot.C7.UPDATE);const d=e(),{width:f,height:p}=t.descriptor;a.maxHighlightLevel=St(this.view.highlights)-1,a.highlightTexture=t;const{camera:m}=o,{fullWidth:g,fullHeight:_,pixelRatio:y}=m,v=Math.ceil(g/y),x=Math.ceil(_/y),{_singleHighlightBlurDrawParameters:b}=this;for(let t=0;t<=a.maxHighlightLevel;++t){a.highlightLevel=t,l.setClearColor(0,0,0,0);const e=s.acquire(f,p,"single highlight",M.N.RG);l.bindFramebuffer(e.fbo),l.setViewport(0,0,f,p),l.clear(ht.NV.COLOR),l.bindTechnique(h,o,a),i(d),b.blurInput=e.getTexture(),(0,G.hZ)(b.blurSize,1/v,0);const n=s.acquire(v,x,"single highlight blur h",M.N.RG);l.unbindTexture(n.fbo?.colorTexture),l.bindFramebuffer(n.fbo),l.setViewport(0,0,v,x),l.clear(ht.NV.COLOR),b.blurInput=e.getTexture(),(0,G.hZ)(b.blurSize,1/v,0),l.bindTechnique(c,o,a,b),i(d),e.release(),(0,G.hZ)(b.blurSize,0,1/x),a.singleHighlightBlurTexture=n.getTexture(),r(),l.bindTechnique(u,o,a,b),i(d),n.release()}h.release(),c.release(),u.release()}_gridUpdateResources(t){const e=this.renderingContext,i=this._grid,{width:r,height:s}=t.descriptor;if(i.horizontalCellCount=Math.ceil(r/X.g),i.verticalCellCount=Math.ceil(s/X.g),i.vao)return;const n=ft.g.createIndex(e,ht._U.STATIC_DRAW,Pt);i.vao=new dt.Z(e,at.D,new Map([["geometry",ut]]),new Map([["geometry",ft.g.createVertex(e,ht._U.STATIC_DRAW)]]),n)}_gridComputeCoverage(t,e,i){const r=this.renderingContext,s=this._grid,n=e.descriptor,o=Math.ceil(n.width/X.g),a=Math.ceil(n.height/X.g);this._downsampleDrawParameters.input=e,s.coverage?.release();const l=this.fboCache.acquire(o,a,"highlight coverage",M.N.RG);return s.coverage=l,r.bindFramebuffer(l.fbo),r.bindTechnique(t,i,this._passParameters,this._downsampleDrawParameters),r.setViewport(0,0,o,a),r.screen.draw(),s}get test(){}};(0,n._)([(0,f.MZ)()],gt.prototype,"produces",void 0),(0,n._)([(0,f.MZ)()],gt.prototype,"consumes",void 0),(0,n._)([(0,f.MZ)({constructOnly:!0})],gt.prototype,"techniques",void 0),gt=(0,n._)([(0,m.$)("esri.views.3d.webgl-engine.effects.highlight.Highlight")],gt);class _t{constructor(){this.coverage=null,this.vao=null,this.verticalCellCount=0,this.horizontalCellCount=0,this.viewportWidth=0,this.viewportHeight=0}}const yt=new Array(J.cz),vt=new Array(J.cz);function xt(t,e){const i=Math.min(t.length,J.cz);let r=J.cz;for(let e=i-1;e>=0;--e){const i=t.at(e);if(i){const t=i.name;yt.includes(t,r)||(--r,yt[r]=t,vt[r]=e)}}const s=J.cz-r;for(let i=0;i<s;++i){const r=vt[J.cz-s+i];e(t.at(r),i)}}let bt=0;function wt(t){let e=0;const i=Math.min(J.cz,t.length);for(let r=0;r<i;++r){const i=t.at(r);if(i){const{name:t,options:r}=i;e+=t.length;const{color:s,fillOpacity:n,haloColor:o,haloOpacity:a}=r;e+=s.r+(o?.r??1)+n+a}}{const i=t.at(0);if(i){const{shadowOpacity:t,shadowDifference:r,shadowColor:s}=i.options;e+=t+r+s.r}}return bt+++(e>=0?0:1)}const Pt=new Uint8Array([0,1,2,2,1,3]);function St(t){const e=new Set;for(let i=0;i<J.cz;++i){const r=t.at(i)?.name;r&&e.add(r)}return e.size}var Ct=i(7970),Tt=i(90553);class Mt{constructor(t,e,i,r){this._textures=t,this._techniques=e,this.materialChanged=i,this.requestRender=r,this._id2glMaterialRef=new Ct.O}dispose(){this._textures.destroy()}acquire(t,e,i){this._ownMaterial(t);const r=t.produces.get(e);if(!r?.(i))return null;let s=this._id2glMaterialRef.get(i,t.id);if(null==s){const e=t.createGLMaterial({material:t,techniques:this._techniques,textures:this._textures,output:i});s=new At(e),this._id2glMaterialRef.set(i,t.id,s)}return s.ref(),s.glMaterial}release(t,e){const i=this._id2glMaterialRef.get(e,t.id);null!=i&&(i.unref(),i.referenced||((0,h.WD)(i.glMaterial),this._id2glMaterialRef.delete(e,t.id)))}_ownMaterial(t){t.repository&&t.repository!==this&&p.A.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),t.repository=this}}class At{constructor(t){this.glMaterial=t,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,(0,Tt.vA)(this._refCnt>=0)}get referenced(){return this._refCnt>0}}var Rt,Ot=i(19860),It=i(24100),Et=i(54840),Lt=(i(38504),i(39714)),Dt=i(1932),zt=i(75256),Nt=i(60808),Ft=i(29165);!function(t){t[t.Immediate=0]="Immediate",t[t.FadeWithWeather=1]="FadeWithWeather"}(Rt||(Rt={}));var kt=i(95629);class Vt{constructor(t){this.shadowMap=t,this.slot=Ft.N.OPAQUE_MATERIAL,this.slicePlane=null,this.hasOccludees=!1,this.enableFillLights=!0,this.oitPass=Et.Y.NONE,this.alignPixelEnabled=!1,this.decorations=!0,this.overlayStretch=1,this.viewshedEnabled=!1,this._camera=new D.A,this._inverseViewport=(0,Dt.vt)(),this._oldLighting=new kt.TA,this._newLighting=new kt.TA,this._fadedLighting=new kt.TA,this._lighting=this._newLighting,this.ssr=new Bt,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.highlightMixTexture=null,this.highlightGroupName=null,this.highlightGroupIndices=new Map,this.highlightLevel=0,this.highlightMixOrigin=(0,Dt.vt)(),this.hudRenderStyle=Nt.D.Occluded,this.clouds=new zt.n,this.shadowHighlightsVisible=!1}get camera(){return this._camera}set camera(t){this._camera=t,this._inverseViewport[0]=1/t.fullViewport[2],this._inverseViewport[1]=1/t.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}fadeLighting(){switch(this.clouds.fadeFactor){case 0:this._lighting=this._oldLighting;break;default:this._fadedLighting.lerpLighting(this._oldLighting,this._newLighting,this.clouds.fadeFactor),this._lighting=this._fadedLighting;break;case 1:this._lighting=this._newLighting,this._oldLighting.copyFrom(this._newLighting)}}updateLighting(t,e,i,r){this._oldLighting.copyFrom(this.lighting),this._newLighting.noonFactor=e,this._newLighting.globalFactor=i,this._newLighting.set(t),r===Rt.FadeWithWeather&&this.clouds.requestFade(),this.fadeLighting()}}class Bt{constructor(){this.fadeFactor=1,this.reprojectionMatrix=(0,Lt.vt)()}}class Ut{constructor(t,e){this.rctx=t,this.lastFrameCamera=new D.A,this.output=A.V.Color,this.renderOccludedMask=Gt,this.bind=new Vt(e),this.bind.alignPixelEnabled=!0}}const Gt=It.m$.Occlude|It.m$.OccludeAndTransparent|It.m$.OccludeAndTransparentStencil;var Ht=i(15774),Wt=i(87725),jt=i(33400),$t=i(65420);let Zt=class extends D.A{constructor(){super(...arguments),this._projectionMatrix=(0,Lt.vt)()}get projectionMatrix(){return this._projectionMatrix}};(0,n._)([(0,f.MZ)()],Zt.prototype,"_projectionMatrix",void 0),(0,n._)([(0,f.MZ)({readOnly:!0})],Zt.prototype,"projectionMatrix",null),Zt=(0,n._)([(0,m.$)("esri.views.3d.webgl-engine.lib.CascadeCamera")],Zt);var qt,Yt,Xt=i(12569);(Yt=qt||(qt={}))[Yt.Highlight=0]="Highlight",Yt[Yt.ExcludeHighlight=1]="ExcludeHighlight";class Qt{constructor(){this.camera=new Zt,this.lightMat=(0,Lt.vt)()}}class Jt{constructor(){this.maxNumCascadesHighQuality=4,this.maxNumCascadesLowQuality=4,this.textureSizeModHighQuality=1.3,this.textureSizeModLowQuality=.9,this.splitSchemeLambda=0}}class Kt{constructor(t,e){this._fbos=t,this._viewingMode=e,this._enabled=!1,this._snapshots=new Array,this._textureHeight=0,this._numCascades=1,this.settings=new Jt,this._projectionView=(0,Lt.vt)(),this._projectionViewInverse=(0,Lt.vt)(),this._modelViewLight=(0,Lt.vt)(),this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=(0,z.vt)(),this._cascades=[new Qt,new Qt,new Qt,new Qt],this._lastOrigin=null,this._maxTextureWidth=Math.min((0,a.A)("esri-mobile")?4096:16384,t.rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}get depthTexture(){return this._handle?.getTexture()}get _textureWidth(){return this._textureHeight*this._numCascades}get numCascades(){return this._numCascades}get cascadeDistances(){return(0,jt.s)(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}disposeOffscreenBuffers(){this._handle=(0,h.Gz)(this._handle),this._discardSnapshots()}set maxCascades(t){this.settings.maxNumCascadesHighQuality=(0,Ht.qE)(Math.floor(t),1,4)}get maxCascades(){return this.settings.maxNumCascadesHighQuality}set enabled(t){this._enabled=t,t||this.disposeOffscreenBuffers()}get enabled(){return this._enabled}get ready(){return this._enabled&&null!=this.depthTexture}get cascades(){for(let t=0;t<this._numCascades;++t)he[t]=this._cascades[t];return he.length=this._numCascades,he}start(t,e,i,r,s){(0,Tt.vA)(this.enabled);const{near:n,far:o}=function(t){let{near:e,far:i}=t;return e<2&&(e=2),i<2&&(i=2),e>=i&&(e=2,i=4),{near:e,far:i}}(i);this._computeCascadeDistances(n,o,r),this._textureHeight=this._computeTextureHeight(t,s,r),this._setupMatrices(t,e);const{viewMatrix:a,projectionMatrix:l}=t;for(let t=0;t<this._numCascades;++t)this._constructCascade(t,l,a,e);this._lastOrigin=null,this.clear()}finish(){(0,Tt.vA)(this.enabled),this._handle?.detachDepth()}getShadowMapMatrices(t){if(!this._lastOrigin||!(0,_.p)(t,this._lastOrigin)){this._lastOrigin=this._lastOrigin||(0,y.vt)(),(0,_.c)(this._lastOrigin,t);for(let e=0;e<this._numCascades;++e){(0,g.Tl)(ce,this._cascades[e].lightMat,t);for(let t=0;t<16;++t)ue[16*e+t]=ce[t]}}return ue}moveSnapshot(t){(0,Tt.vA)(this.enabled),this._handle?.detachDepth(),this._snapshots[t]?.release(),this._snapshots[t]=this._handle,this._handle=null,this.clear()}copySnapshot(t){const e=this._handle?.getTexture()?.descriptor;if(!this.enabled||!e)return;this._snapshots[t]?.release();const{width:i,height:r}=e,s=t===qt.Highlight?"shadow highlight snapshot":"shadow no highlight snapshot";this._snapshots[t]=this._fbos.acquire(i,r,s,M.N.RGBA4);const n=this._fbos.rctx;this._bindFbo();const o=n.bindTexture(this._snapshots[t]?.getTexture(),pt.g.TEXTURE_UNIT_FOR_UPDATES);n.gl.copyTexSubImage2D(ht.Ap.TEXTURE_2D,0,0,0,0,0,i,r),n.bindTexture(o,pt.g.TEXTURE_UNIT_FOR_UPDATES)}getSnapshot(t){return this.enabled?this._snapshots[t]?.getTexture():null}clear(){const t=this._fbos.rctx;this._ensureFbo(),this._bindFbo(),t.setClearColor(1,1,1,1),t.clear(ht.NV.COLOR|ht.NV.DEPTH)}_computeTextureHeight(t,e,i){const r=Math.min(window.devicePixelRatio,e)/t.pixelRatio,s=i?this.settings.textureSizeModHighQuality:this.settings.textureSizeModLowQuality,n=(0,Xt.Mv)(Math.floor(Math.max(t.fullWidth,t.fullHeight)*r*s)),o=Math.min(this._maxTextureWidth,this._numCascades*n);return(0,Xt.uT)(o/this._numCascades)}_ensureFbo(){this._handle?.fbo?.width===this._textureWidth&&this._handle?.fbo.height===this._textureHeight||(this._handle?.release(),this._handle=this._fbos.acquire(this._textureWidth,this._textureHeight,"shadow map",M.N.RGBA4)),this._handle?.acquireDepth(M.z.DEPTH16_BUFFER)}_discardSnapshot(t){this._snapshots[t]=(0,h.Gz)(this._snapshots[t])}_discardSnapshots(){for(let t=0;t<this._snapshots.length;++t)this._discardSnapshot(t);this._snapshots.length=0}_bindFbo(){this._fbos.rctx.bindFramebuffer(this._handle?.fbo)}_constructCascade(t,e,i,r){const s=this._cascades[t],n=-this._cascadeDistances[t],o=-this._cascadeDistances[t+1],a=(e[10]*n+e[14])/Math.abs(e[11]*n+e[15]),l=(e[10]*o+e[14])/Math.abs(e[11]*o+e[15]);(0,Tt.vA)(a<l);for(let t=0;t<8;++t){(0,jt.s)(ee,t%4==0||t%4==3?-1:1,t%4==0||t%4==1?-1:1,t<4?a:l,1);const e=ie[t];(0,jt.t)(e,ee,this._projectionViewInverse),e[0]/=e[3],e[1]/=e[3],e[2]/=e[3]}(0,_.v)(le,ie[0]),s.camera.viewMatrix=(0,g.Tl)(te,this._modelViewLight,le);for(let t=0;t<8;++t)(0,_.t)(ie[t],ie[t],s.camera.viewMatrix);let h=ie[0][2],c=ie[0][2];for(let t=1;t<8;++t)h=Math.min(h,ie[t][2]),c=Math.max(c,ie[t][2]);h-=200,c+=200,s.camera.near=-c,s.camera.far=-h,function(t,e,i,r,s){const n=1/ie[0][3],o=1/ie[4][3];(0,Tt.vA)(n<o);let a=n+Math.sqrt(n*o);const l=Math.sin((0,Ht.XM)(t[2]*e[0]+t[6]*e[1]+t[10]*e[2]));a/=l,function(t,e,i,r,s,n,o,a){(0,G.hZ)(de,0,0);for(let e=0;e<4;++e)(0,G.WQ)(de,de,t[e]);(0,G.hs)(de,de,.25),(0,G.hZ)(fe,0,0);for(let e=4;e<8;++e)(0,G.WQ)(fe,fe,t[e]);(0,G.hs)(fe,fe,.25),(0,G.Cc)(pe[0],t[4],t[5],.5),(0,G.Cc)(pe[1],t[5],t[6],.5),(0,G.Cc)(pe[2],t[6],t[7],.5),(0,G.Cc)(pe[3],t[7],t[4],.5);let l=0,h=(0,G.hG)(pe[0],de);for(let t=1;t<4;++t){const e=(0,G.hG)(pe[t],de);e<h&&(h=e,l=t)}(0,G.Re)(me,pe[l],t[l+4]);const c=me[0];let u,d;me[0]=-me[1],me[1]=c,(0,G.Re)(ge,fe,de),(0,G.Om)(ge,me)<0&&(0,G.ze)(me,me),(0,G.Cc)(me,me,ge,i),(0,G.S8)(me,me),u=d=(0,G.Om)((0,G.Re)(_e,t[0],de),me);for(let e=1;e<8;++e){const i=(0,G.Om)((0,G.Re)(_e,t[e],de),me);i<u?u=i:i>d&&(d=i)}(0,G.C)(r,de),(0,G.hs)(_e,me,u-e),(0,G.WQ)(r,r,_e);let f=-1,p=1,m=0,g=0;for(let e=0;e<8;++e){(0,G.Re)(ye,t[e],r),(0,G.S8)(ye,ye);const i=me[0]*ye[1]-me[1]*ye[0];i>0?i>f&&(f=i,m=e):i<p&&(p=i,g=e)}(0,Tt.MX)(f>0,"leftArea"),(0,Tt.MX)(p<0,"rightArea"),(0,G.hs)(ve,me,u),(0,G.WQ)(ve,ve,de),(0,G.hs)(xe,me,d),(0,G.WQ)(xe,xe,de),be[0]=-me[1],be[1]=me[0];const _=(0,Tt.L)(r,t[g],xe,(0,G.WQ)(_e,xe,be),1,s),y=(0,Tt.L)(r,t[m],xe,_e,1,n),v=(0,Tt.L)(r,t[m],ve,(0,G.WQ)(_e,ve,be),1,o),x=(0,Tt.L)(r,t[g],ve,_e,1,a);(0,Tt.MX)(_,"rayRay"),(0,Tt.MX)(y,"rayRay"),(0,Tt.MX)(v,"rayRay"),(0,Tt.MX)(x,"rayRay")}(ie,a,l,re,se,ne,oe,ae),function(t,e,i,r,s){(0,G.Re)(Ce,i,r),(0,G.hs)(Ce,Ce,.5),Te[0]=Ce[0],Te[1]=Ce[1],Te[2]=0,Te[3]=Ce[1],Te[4]=-Ce[0],Te[5]=0,Te[6]=Ce[0]*Ce[0]+Ce[1]*Ce[1],Te[7]=Ce[0]*Ce[1]-Ce[1]*Ce[0],Te[8]=1,Te[we(0,2)]=-(0,G.Om)(Se(Te,0),t),Te[we(1,2)]=-(0,G.Om)(Se(Te,1),t);let n=(0,G.Om)(Se(Te,0),i)+Te[we(0,2)],o=(0,G.Om)(Se(Te,1),i)+Te[we(1,2)],a=(0,G.Om)(Se(Te,0),r)+Te[we(0,2)],l=(0,G.Om)(Se(Te,1),r)+Te[we(1,2)];n=-(n+a)/(o+l),Te[we(0,0)]+=Te[we(1,0)]*n,Te[we(0,1)]+=Te[we(1,1)]*n,Te[we(0,2)]+=Te[we(1,2)]*n,n=1/((0,G.Om)(Se(Te,0),i)+Te[we(0,2)]),o=1/((0,G.Om)(Se(Te,1),i)+Te[we(1,2)]),Te[we(0,0)]*=n,Te[we(0,1)]*=n,Te[we(0,2)]*=n,Te[we(1,0)]*=o,Te[we(1,1)]*=o,Te[we(1,2)]*=o,Te[we(2,0)]=Te[we(1,0)],Te[we(2,1)]=Te[we(1,1)],Te[we(2,2)]=Te[we(1,2)],Te[we(1,2)]+=1,n=(0,G.Om)(Se(Te,1),e)+Te[we(1,2)],o=(0,G.Om)(Se(Te,2),e)+Te[we(2,2)],a=(0,G.Om)(Se(Te,1),i)+Te[we(1,2)],l=(0,G.Om)(Se(Te,2),i)+Te[we(2,2)],n=-.5*(n/o+a/l),Te[we(1,0)]+=Te[we(2,0)]*n,Te[we(1,1)]+=Te[we(2,1)]*n,Te[we(1,2)]+=Te[we(2,2)]*n,n=(0,G.Om)(Se(Te,1),e)+Te[we(1,2)],o=(0,G.Om)(Se(Te,2),e)+Te[we(2,2)],a=-o/n,Te[we(1,0)]*=a,Te[we(1,1)]*=a,Te[we(1,2)]*=a,s[0]=Te[0],s[1]=Te[1],s[2]=0,s[3]=Te[2],s[4]=Te[3],s[5]=Te[4],s[6]=0,s[7]=Te[5],s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=Te[6],s[13]=Te[7],s[14]=0,s[15]=Te[8]}(re,se,oe,ae,s.projectionMatrix),s.projectionMatrix[10]=2/(i-r),s.projectionMatrix[14]=-(i+r)/(i-r)}(i,r,h,c,s.camera),(0,g.lw)(s.lightMat,s.camera.projectionMatrix,s.camera.viewMatrix);const u=this._textureHeight;s.camera.viewport=[t*u,0,u,u]}_setupMatrices(t,e){(0,g.lw)(this._projectionView,t.projectionMatrix,t.viewMatrix),(0,g.B8)(this._projectionViewInverse,this._projectionView);const i=this._viewingMode===$t.RT.Global?t.eye:(0,_.i)(le,0,0,1);(0,g.t5)(this._modelViewLight,[0,0,0],[-e[0],-e[1],-e[2]],i)}_computeCascadeDistances(t,e,i){const r=i?this.settings.maxNumCascadesHighQuality:this.settings.maxNumCascadesLowQuality;this._numCascades=Math.min(1+Math.floor((0,Tt.kL)(e/t,4)),r);const s=(e-t)/this._numCascades,n=(e/t)**(1/this._numCascades);let o=t,a=t;for(let t=0;t<this._numCascades+1;++t)this._cascadeDistances[t]=(0,Ht.Cc)(o,a,this.settings.splitSchemeLambda),o*=n,a+=s}get test(){}}const te=(0,Lt.vt)(),ee=(0,z.vt)(),ie=[];for(let t=0;t<8;++t)ie.push((0,z.vt)());const re=(0,Dt.vt)(),se=(0,Dt.vt)(),ne=(0,Dt.vt)(),oe=(0,Dt.vt)(),ae=(0,Dt.vt)(),le=(0,y.vt)(),he=[],ce=(0,Lt.vt)(),ue=Lt.zK.concat(Lt.zK,Lt.zK,Lt.zK,Lt.zK),de=(0,Dt.vt)(),fe=(0,Dt.vt)(),pe=[(0,Dt.vt)(),(0,Dt.vt)(),(0,Dt.vt)(),(0,Dt.vt)()],me=(0,Dt.vt)(),ge=(0,Dt.vt)(),_e=(0,Dt.vt)(),ye=(0,Dt.vt)(),ve=(0,Dt.vt)(),xe=(0,Dt.vt)(),be=(0,Dt.vt)();function we(t,e){return 3*e+t}const Pe=(0,Dt.vt)();function Se(t,e){return(0,G.hZ)(Pe,t[e],t[e+3]),Pe}const Ce=(0,Dt.vt)(),Te=(0,Wt.vt)();var Me=i(83525),Ae=i(13794),Re=i(89756),Oe=i(23545),Ie=i(49845),Ee=i(38177),Le=i(96253),De=i(57701),ze=i(26347);let Ne=class extends Me.A{constructor(t){super(t),this._pending=new Fe,this._changes=new Oe.VR,this._renderers=new Map,this._sortedRenderers=new c.A,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._renderers.forEach((t=>t.destroy())),this._renderers.clear(),this._sortedRenderers.clear(),this._geometries.clear(),this._pending.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materials(){return this.rendererContext.materials}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccludedDraped(){for(const t of this._renderers.values())if(0!==t.numGeometries&&!t.queryRenderOccludedState(It.m$.Occlude))return!0;return!1}get isEmpty(){return!this.updating&&0===this._renderers.size&&0===this._geometries.size}getMaterialRenderer(t){return this._renderers.get(t)}get sortedRenderers(){return this._sortedRenderers}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const t=(0,De.$T)(this._changes);let e=!1;return t.forEach(((t,i)=>{let r=this._renderers.get(i);!r&&t.adds.length>0&&(r=new ze.y({material:i}),r.initializeRenderContext(this.rendererContext.pluginContext,this._materials),this._renderers.set(i,r),e=!0),r&&(r.modify(t),0===r.numGeometries&&(this._renderers.delete(i),r.destroy(),e=!0))})),this._changes.clear(),e&&this._updateSortedMaterialRenderers(),this._hasHighlights=(0,l.Bs)(this._renderers,(t=>{const e=t.produces.get(Ft.N.DRAPED_MATERIAL);return!!e&&e(A.V.Highlight)})),this._hasWater=(0,l.Bs)(this._renderers,(t=>{const e=t.produces.get(Ft.N.DRAPED_WATER);return!!e&&e(A.V.Normal)})),this.notifyChange("updating"),!0}addGeometries(t,e){if(0===t.length)return;const i=this._validateRenderGeometries(t);for(const t of i)this._geometries.set(t.id,t);const r=this._pending.empty;for(const t of i)this._pending.adds.add(t);r&&this.notifyChange("updating"),e===Le.q.UPDATE&&this._notifyGraphicGeometryChanged(t)}removeGeometries(t,e){const i=this._pending.empty,r=this._pending.adds;for(const e of t)r.has(e)?(this._pending.removed.add(e),r.delete(e)):this._pending.removed.has(e)||this._pending.removes.add(e),this._geometries.delete(e.id);i&&!this._pending.empty&&this.notifyChange("updating"),e===Le.q.UPDATE&&this._notifyGraphicGeometryChanged(t)}modifyGeometries(t,e){const i=0===this._changes.updates.length;for(const i of t){const t=this._changes.updates.pushNew();t.renderGeometry=this._validateRenderGeometry(i),t.updateType=e}switch(i&&this._changes.updates.length>0&&this.notifyChange("updating"),e){case Le.k.TRANSFORMATION:case Le.k.GEOMETRY:return this._notifyGraphicGeometryChanged(t);case Le.k.VISIBILITY:return this._notifyGraphicVisibilityChanged(t)}}updateAnimation(t){let e=!1;return this._sortedRenderers.forAll((i=>e=!!i.updateAnimation&&i.updateAnimation(t)||e)),e}precompile(t){return this._sortedRenderers.reduce(((e,i)=>i.precompile(t)||e),!1)}render(t){this._sortedRenderers.forAll((e=>{const i=e.acquireTechniques(t);i&&(e.render(t,i),(0,U.VM)(i))}))}intersect(t,e,i,r,s){for(const n of this._geometries.values()){if(!r(n))continue;this._intersectRenderGeometry(n,i,e,0,t,s);const o=this.rendererContext.longitudeCyclical;o&&(n.boundingSphere[0]-n.boundingSphere[3]<o.min&&this._intersectRenderGeometry(n,i,e,o.range,t,s),n.boundingSphere[0]+n.boundingSphere[3]>o.max&&this._intersectRenderGeometry(n,i,e,-o.range,t,s)),s++}return s}_updateSortedMaterialRenderers(){this._sortedRenderers.clear();let t=0;for(const e of this._renderers.values())e.drapedPriority=t++,this._sortedRenderers.push(e);this._sortedRenderers.sort(((t,e)=>e.material?.renderPriority===t.material?.renderPriority?t.drapedPriority-e.drapedPriority:(e.material?.renderPriority||0)-(t.material?.renderPriority||0)))}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes)),this._changes.updates.filterInPlace((({renderGeometry:t})=>!this._pending.has(t))),this._pending.clear()}_intersectRenderGeometry(t,e,i,r,s,n){if(!t.visible||!t.material.visible)return;let o=0;r+=t.transformation[12],o=t.transformation[13],ke[0]=i[0]-r,ke[1]=i[1]-o,t.screenToWorldRatio=this.rendererContext.screenToWorldRatio,t.material.intersectDraped(t,null,s,ke,((i,r,o)=>{!function(t,e,i,r,s,n,o){const a=new Re.MQ(n,o,e),l=e=>{e.set(Ee.dz.OVERLAY,a,t.dist,t.normal,t.transformation,i,r)};if((null==s.results.min.drapedLayerOrder||i>=s.results.min.drapedLayerOrder)&&(null==s.results.min.dist||s.results.ground.dist<=s.results.min.dist)&&l(s.results.min),s.options.store!==Ee.oH.MIN&&(null==s.results.max.drapedLayerOrder||i<s.results.max.drapedLayerOrder)&&(null==s.results.max.dist||s.results.ground.dist>s.results.max.dist)&&l(s.results.max),s.options.store===Ee.oH.ALL){const t=(0,Ie.G7)(s.ray);l(t),s.results.all.push(t)}}(e,o,n,t.material.renderPriority,s,t.layerUid,t.graphicUid)}),e)}_notifyGraphicGeometryChanged(t){if(null==this.drapeSource.notifyGraphicGeometryChanged)return;let e;for(const{graphicUid:i}of t)null!=i&&i!==e&&(this.drapeSource.notifyGraphicGeometryChanged(i),e=i)}_notifyGraphicVisibilityChanged(t){if(null==this.drapeSource.notifyGraphicVisibilityChanged)return;let e;for(const{graphicUid:i}of t)null!=i&&i!==e&&(this.drapeSource.notifyGraphicVisibilityChanged(i),e=i)}_validateRenderGeometries(t){for(const e of t)this._validateRenderGeometry(e);return t}_validateRenderGeometry(t){return null==t.localOrigin&&(t.localOrigin=this._localOriginFactory.getOrigin((0,Ae.a)(t.boundingSphere))),t}get test(){}};(0,n._)([(0,f.MZ)()],Ne.prototype,"drapeSource",void 0),(0,n._)([(0,f.MZ)()],Ne.prototype,"updating",null),(0,n._)([(0,f.MZ)()],Ne.prototype,"rctx",null),(0,n._)([(0,f.MZ)({constructOnly:!0})],Ne.prototype,"rendererContext",void 0),(0,n._)([(0,f.MZ)()],Ne.prototype,"_materials",null),(0,n._)([(0,f.MZ)()],Ne.prototype,"_localOriginFactory",null),(0,n._)([(0,f.MZ)({readOnly:!0})],Ne.prototype,"isEmpty",null),(0,n._)([(0,f.MZ)()],Ne.prototype,"_renderers",void 0),(0,n._)([(0,f.MZ)()],Ne.prototype,"_geometries",void 0),Ne=(0,n._)([(0,m.$)("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],Ne);class Fe{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return 0===this.adds.size&&0===this.removes.size&&0===this.removed.size}has(t){return this.adds.has(t)||this.removes.has(t)||this.removed.has(t)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}}const ke=(0,Dt.vt)();class Ve extends $.w{constructor(t,e,r){super(t,e,new j.$(B.a,(()=>i.e(6404).then(i.bind(i,41722)))),r)}initializePipeline(t){return t.hasAlpha?(0,q.Ey)({blending:q.Ky,colorWrite:q.kn}):(0,q.Ey)({colorWrite:q.kn})}}var Be=i(65875);class Ue extends Be.K{constructor(){super(...arguments),this.hasAlpha=!1}}(0,n._)([(0,Be.W)()],Ue.prototype,"hasAlpha",void 0);var Ge=i(91998),He=i(35910),We=i(94010);class je extends $.w{constructor(t,e,r){super(t,e,new j.$(We.a,(()=>i.e(5835).then(i.bind(i,49706)))),r)}}var $e=i(48961);let Ze=class extends U.RW{constructor(t){super(t),this._overlays=null,this._renderTargets=null,this._overlayParameters=new We.O,this.hasHighlights=!1,this._hasWater=!1,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new c.A,this._passParameters=new B.T,this._materials=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._camera=new D.A,this.worldToPCSRatio=1,this.events=new o.A,this.longitudeCyclical=null,this.produces=new Map([[Ft.N.DRAPED_MATERIAL,t=>t!==A.V.Highlight||this.hasHighlights],[Ft.N.DRAPED_WATER,()=>this._hasWater]]),this._hasTargetWithoutRasterImage=!1,this._hasDrapedFeatureSource=!1,this._hasDrapedRasterSource=!1}initialize(){const{view:t}=this,{_stage:e}=t,i=e.renderer.fboCache,r=e.renderView,{waterTextures:s,textures:n}=r;this._renderContext=new Ut(this._rctx,new Kt(i,t.state.viewingMode)),this.addHandles([(0,u.watch)((()=>s.updating),(()=>this.events.emit("content-changed")),u.pc),(0,u.watch)((()=>this.spatialReference),(t=>this._localOriginFactory=new Ot.g(t)),u.pc),(0,u.on)((()=>this.view.allLayerViews),"after-changes",(()=>this._sortedDrapeSourceRenderersDirty=!0)),(0,u.watch)((()=>wt(this.view.highlights)),(()=>this._sortedDrapeSourceRenderersDirty=!0),u.pc)]),this._materials=new Mt(n,this._techniques,(()=>{this.notifyChange("rendersOccludedDraped"),this.events.emit("content-changed"),this.notifyChange("updating"),this.notifyChange("isEmpty")}),(()=>this.events.emit("content-changed")));const{_bindParameters:o,_camera:a}=this;o.slot=Ft.N.DRAPED_MATERIAL,o.mainDepth=null,a.near=1,a.far=1e4,a.relativeElevation=null,o.camera=this._camera,o.oitPass=Et.Y.NONE,o.updateLighting([new He.$p((0,y.S)())],0,0,Rt.Immediate),this.addHandles(this.view.resourceController.scheduler.registerTask($e.W6.STAGE,this))}destroy(){this._renderers.forEach((t=>t.destroy())),this._renderers.clear(),this._passParameters.texture=(0,h.WD)(this._passParameters.texture),this.disposeOverlays()}get _bindParameters(){return this._renderContext.bind}get _rctx(){return this.view._stage.renderView.renderingContext}get _techniques(){return this.view._stage.renderView.techniques}get rctx(){return this._rctx}get materials(){return this._materials}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}get pluginContext(){return this._pluginContext}initializeRenderContext(t){this._pluginContext=t,this._techniques.precompile(je)}uninitializeRenderContext(){}acquireTechniques(){return[]}render(){}get updating(){return this._sortedDrapeSourceRenderersDirty||(0,l.Bs)(this._renderers,(t=>t.updating))}get hasOverlays(){return null!=this._overlays&&null!=this._renderTargets}getMaterialRenderer(t){for(const e of this._renderers.values()){const i=e.getMaterialRenderer(t);if(i)return i}return null}get layers(){return this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers(),this._sortedRenderers.map((t=>t.drapeSource.layer)).filter((t=>!!t))}createGeometryDrapeSourceRenderer(t){return this.createDrapeSourceRenderer(t,Ne)}createDrapeSourceRenderer(t,e,i){const r=this._renderers.get(t);null!=r&&r.destroy();const s=new e({...i,rendererContext:this,drapeSource:t});return this._renderers.set(t,s),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in t&&this.addHandles((0,u.watch)((()=>t.fullOpacity),(()=>this.events.emit("content-changed"))),t),s}removeDrapeSourceRenderer(t){if(null==t)return;const e=this._renderers.get(t);null!=e&&(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(t),this.removeHandles(t),e.destroy())}computeValidity(){return this._renderTargets?.computeValidity()??0}releaseRenderTargets(){this._renderTargets?.dispose()}get overlays(){return this._overlays??[]}ensureDrapeTargets(t){this._hasTargetWithoutRasterImage=!!this._overlays&&(0,d.bw)(t,(t=>t.drapeTargetType===v.sv.WithoutRasterImage))}ensureDrapeSources(t){this._overlays?(this._hasDrapedFeatureSource=(0,d.bw)(t,(t=>t.drapeSourceType===v.Om.Features)),this._hasDrapedRasterSource=(0,d.bw)(t,(t=>t.drapeSourceType===v.Om.RasterImage))):this._hasDrapedFeatureSource=this._hasDrapedRasterSource=!1}get _needsColorWithoutRasterImage(){return this._hasDrapedRasterSource&&this._hasDrapedFeatureSource&&this._hasTargetWithoutRasterImage}ensureOverlays(t,e,i=this._bindParameters.overlayStretch){null==this._overlays&&(this._renderTargets=new I(this.view._stage.renderer.fboCache),this._overlays=[new S,new S]),this.ensureDrapeTargets(t),this.ensureDrapeSources(e),this._bindParameters.overlayStretch=i}disposeOverlays(){this._overlays=null,this._renderTargets=(0,h.WD)(this._renderTargets),this.events.emit("textures-disposed")}getTexture(t){if(null!=t)return t===r.ColorNoRasterImage&&!this._needsColorWithoutRasterImage&&this._hasDrapedFeatureSource?this._renderTargets?.getTexture(r.Color):this._renderTargets?.getTexture(t)}get running(){return this.updating}runTask(t){this._processDrapeSources(t,(()=>!0))}_processDrapeSources(t,e){let i=!1;for(const[r,s]of this._renderers){if(t.done)break;(r.destroyed||e(r))&&s.commitChanges()&&(i=!0,t.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,i=!0,this._updateSortedDrapeSourceRenderers()),i&&(null!=this._overlays&&0===this._renderers.size&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this.hasHighlights=(0,l.Bs)(this._renderers,(t=>t.hasHighlights)),this.notifyChange("rendersOccludedDraped"),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources($e.Bb,(t=>t.updatePolicy===Ge.q.SYNC))}get isEmpty(){return!x.b.OVERLAY_DRAW_DEBUG_TEXTURE&&!(0,l.Bs)(this._renderers,(t=>!t.isEmpty))}get hasWater(){return this._hasWater}get rendersOccludedDraped(){const t=this._renderContext.renderOccludedMask;this._renderContext.renderOccludedMask=Qe,++this._techniques.precompiling;const e=this._sortedRenderers.some((({renderer:t})=>t.precompile(this._renderContext)));return--this._techniques.precompiling,this._renderContext.renderOccludedMask=t,e}renders(t){if(x.b.OVERLAY_DRAW_DEBUG_TEXTURE&&t!==r.Occluded&&t!==r.Highlight)return!0;++this._techniques.precompiling;const e=this._sortedRenderers.some((({renderer:t})=>t.precompile(this._renderContext)));return--this._techniques.precompiling,e}get mode(){return this.isEmpty?N.Disabled:this._renderTargets?.getTexture(r.WaterNormal)?N.EnabledWithWater:this._renderTargets?.getTexture(r.Color)?N.Enabled:N.Disabled}updateAnimation(t){let e=!1;return this._renderers.forEach((i=>e=i.updateAnimation(t)||e)),e}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}precompileShaders(t){if(this._renderTargets){this._bindParameters.alignPixelEnabled=t.alignPixelEnabled,this._bindParameters.highlightGroupName=null,++this._techniques.precompiling;for(const t of this._renderTargets.targets){if(t.content===r.ColorNoRasterImage&&!this._needsColorWithoutRasterImage)continue;const e=t.output;this._renderContext.output=e,this._bindParameters.slot=e===A.V.Normal?Ft.N.DRAPED_WATER:Ft.N.DRAPED_MATERIAL,t.content===r.Occluded&&(this._renderContext.renderOccludedMask=Qe),this._sortedRenderers.forAll((({drapeSource:e,renderer:i})=>{t.content===r.ColorNoRasterImage&&e.drapeSourceType===v.Om.RasterImage||i.precompile(this._renderContext)})),this._renderContext.renderOccludedMask=Gt}--this._techniques.precompiling}}drawOverlays(t){if(this._overlays&&this._renderTargets){for(const t of this._overlays)this.longitudeCyclical?t.setupGeometryViewsCyclical(this.longitudeCyclical):t.setupGeometryView();this._bindParameters.alignPixelEnabled=t.alignPixelEnabled;for(const e of this._renderTargets.targets){if(e.content===r.ColorNoRasterImage&&!this._needsColorWithoutRasterImage)continue;const i=this._drawTarget(b.vr.INNER,e,t),s=this._drawTarget(b.vr.OUTER,e,t);(i||s)&&e.fbo.generateMipMap()}}}_drawTarget(t,e,i){const s=this._overlays[t],n=s.canvasGeometries;if(0===n.numViews)return!1;const{contentPixelRatio:o}=i;this._screenToWorldRatio=o*s.mapUnitsPerPixel/this._bindParameters.overlayStretch;const a=e.output;if(this.isEmpty||a===A.V.Normal&&!this.hasWater||!s.hasSomeSizedView())return!1;const{_rctx:l,_bindParameters:h}=this;if(this._camera.pixelRatio=s.pixelRatio*o,this._renderContext.output=a,h.screenToWorldRatio=this._screenToWorldRatio,h.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,h.slot=a===A.V.Normal?Ft.N.DRAPED_WATER:Ft.N.DRAPED_MATERIAL,e.content===r.Occluded&&(this._renderContext.renderOccludedMask=Qe),h.highlightGroupName=null,!this.renders(e.content))return this._renderContext.renderOccludedMask=Gt,!1;const{resolution:c}=s,u=t===b.vr.INNER?0:c;if(l.setViewport(u,0,c,c),this._bindTargetFBO(e),t===b.vr.INNER&&(l.setClearColor(0,0,0,0),l.clear(ht.NV.COLOR)),x.b.OVERLAY_DRAW_DEBUG_TEXTURE&&e.content!==r.Occluded&&e.content!==r.Highlight){this._techniques.precompile(Ve,Je);const e=this._techniques.acquire(Ve,Je);for(let i=0;i<n.numViews;i++)this._setViewParameters(n.extents[i],s),this._ensureDebugPatternResources(s.resolution,Ye[t]),l.bindTechnique(e,h,this._passParameters),l.screen.draw();e.release()}if(e.output===A.V.Highlight){const{fboCache:i}=this.view._stage.renderer,r=this._resolution;!function(t,e,i,r,s,n,o=0,a){const{highlightGroupIndices:l}=s;l.clear();const h=[];xt(r,(t=>{const{name:e}=t;l.set(e,h.length),h.push(e)}));const c=l.size,{gl:u}=t;(0,G.hZ)(s.highlightMixOrigin,o,0);let d=null;c>1&&(d=e.acquire(i.width,i.height,"highlight mix",M.N.RG),t.bindFramebuffer(d.fbo),t.clearFramebuffer(z.uY));const f=d?.getTexture()??null;s.highlightMixTexture=f,a();for(let e=0;e<c;++e)e>0&&(t.bindTexture(f,0),u.copyTexSubImage2D(ht.Ap.TEXTURE_2D,0,0,0,o,0,i.width,i.height),t.bindTexture(null,0)),t.clear(ht.NV.DEPTH),s.highlightLevel=e,s.highlightGroupName=h[e],n();d?.release()}(l,i,{width:r,height:r},this.view.highlights,h,(()=>this._renderAllGeometry(t,e)),u,(()=>this._bindTargetFBO(e)))}else this._renderAllGeometry(t,e);return l.bindFramebuffer(null),this._renderContext.renderOccludedMask=Gt,!0}_renderAllGeometry(t,e){const i=this._overlays[t],s=i.canvasGeometries;this._sortedRenderers.forAll((({drapeSource:n,renderer:o})=>{if(e.content===r.ColorNoRasterImage&&n.drapeSourceType===v.Om.RasterImage)return;const{fullOpacity:a}=n,l=null!=a&&a<1&&e.output===A.V.Color&&this._bindTemporaryFBO();for(let t=0;t<s.numViews;t++)this._setViewParameters(s.extents[t],i),o.render(this._renderContext);if(l){this._bindTargetFBO(e),this._overlayParameters.texture=l.getTexture(),this._overlayParameters.opacity=a,this._overlayParameters.overlayIndex=t;const i=this._techniques.acquire(je);this._rctx.bindTechnique(i,this._bindParameters,this._overlayParameters),this._rctx.screen.draw(),i.release(),l.release()}}))}_bindTargetFBO(t){const e=this._resolution,i=2*e;t.fbo.bind(this._rctx,i,e)}_bindTemporaryFBO(){const t=this._resolution,e=2*t,i=this.view._stage.renderer.fboCache,r=i.acquire(e,t,"overlay tmp");return i.rctx.bindFramebuffer(r.fbo),i.rctx.clear(ht.NV.COLOR),r}get _resolution(){return this._overlays?.[b.vr.INNER].resolution??0}notifyContentChanged(){this.events.emit("content-changed")}intersect(t,e,i,r){this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers();let s=0;for(const{renderer:n}of this._sortedRenderers)s=n.intersect?.(t,e,i,r,s)??s}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),0===this._renderers.size)return;const t=this.view.map.allLayers,e=t.length;this._renderers.forEach(((i,r)=>{const s=t.indexOf(r.layer),n=s>=0,o=r.renderGroup??(n?v.O7.MapLayer:v.O7.ViewLayer),a=e*o+(n?s:0);this._sortedRenderers.push(new qe(r,i,a))})),this._sortedRenderers.sort(((t,e)=>t.index-e.index))}_setViewParameters(t,e){const i=this._camera;i.viewport=[0,0,e.resolution,e.resolution],(0,g.v3)(i.projectionMatrix,0,t[2]-t[0],0,t[3]-t[1],i.near,i.far),(0,g.kN)(i.viewMatrix,[-t[0],-t[1],0])}_updateHasWater(){const t=(0,l.Bs)(this._renderers,(t=>t.hasWater));t!==this._hasWater&&(this._hasWater=t,this.events.emit("has-water"))}_ensureDebugPatternResources(t,e){if((0,_.i)(this._passParameters.color,e[0],e[1],e[2]),this._passParameters.texture)return;const i=new Uint8Array(t*t*4);let r=0;for(let e=0;e<t;e++)for(let s=0;s<t;s++){const n=Math.floor(s/10),o=Math.floor(e/10);n<2||o<2||10*n>t-20||10*o>t-20?(i[r++]=255,i[r++]=255,i[r++]=255,i[r++]=255):(i[r++]=255,i[r++]=255,i[r++]=255,i[r++]=1&n&&1&o?1&s^1&e?0:255:1&n^1&o?0:128)}const s=new mt.R(t);s.samplingMode=ht.Cj.NEAREST,this._passParameters.texture=new pt.g(this._rctx,s,i)}get test(){}};(0,n._)([(0,f.MZ)()],Ze.prototype,"hasHighlights",void 0),(0,n._)([(0,f.MZ)()],Ze.prototype,"_sortedDrapeSourceRenderersDirty",void 0),(0,n._)([(0,f.MZ)({constructOnly:!0})],Ze.prototype,"view",void 0),(0,n._)([(0,f.MZ)({readOnly:!0})],Ze.prototype,"_techniques",null),(0,n._)([(0,f.MZ)()],Ze.prototype,"worldToPCSRatio",void 0),(0,n._)([(0,f.MZ)()],Ze.prototype,"spatialReference",void 0),(0,n._)([(0,f.MZ)({type:Boolean,readOnly:!0})],Ze.prototype,"updating",null),(0,n._)([(0,f.MZ)()],Ze.prototype,"isEmpty",null),(0,n._)([(0,f.MZ)({readOnly:!0})],Ze.prototype,"rendersOccludedDraped",null),Ze=(0,n._)([(0,m.$)("esri.views.3d.terrain.OverlayRenderer")],Ze);class qe{constructor(t,e,i){this.drapeSource=t,this.renderer=e,this.index=i}}const Ye=[[1,.5,.5],[.5,.5,1]],Xe=-2,Qe=It.m$.OccludeAndTransparent,Je=new Ue;Je.hasAlpha=!0},86398:function(t,e,i){var r,s,n;i.d(e,{vr:function(){return r}}),function(t){t[t.INNER=0]="INNER",t[t.OUTER=1]="OUTER"}(r||(r={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",t[t.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",t[t.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(s||(s={})),function(t){t[t.FADING=0]="FADING",t[t.IMMEDIATE=1]="IMMEDIATE",t[t.UNFADED=2]="UNFADED"}(n||(n={}))},28721:function(t,e,i){i.d(e,{Q:function(){return a}});var r=i(12511),s=i(39506),n=i(39838),o=i(40434);function a(t){const{vertex:e}=t;e.uniforms.add(new n.N("coverageTexture",(t=>t.coverageTexture)),new r.g("highlightRenderCellCount",(t=>[t.horizontalCellCount,t.verticalCellCount])),new r.g("highlightTextureResolution",(t=>[t.highlightTexture.descriptor.width,t.highlightTexture.descriptor.height]))),e.constants.add("cellSize","int",o.g),t.varyings.add("sUV","vec2"),t.varyings.add("vOutlinePossible","float"),e.code.add(s.H`const ivec2 cellVertices[4] = ivec2[4](ivec2(0,0), ivec2(1,0), ivec2(0,1), ivec2(1,1));`),e.main.add(s.H`int cellIndex = gl_InstanceID;
int cellX = cellIndex % highlightRenderCellCount[0];
int cellY = (cellIndex - cellX) / highlightRenderCellCount[0];
ivec2 cellPos = ivec2(cellX, cellY);
vec4 cov = texelFetch(coverageTexture, cellPos, 0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
vOutlinePossible = cov.g;
ivec2 iPosInCell = cellVertices[gl_VertexID];
vec2 sPos = vec2(cellPos * cellSize + iPosInCell * (cellSize));
vec2 vPos = sPos / vec2(highlightTextureResolution);
sUV = vPos;
gl_Position = vec4(2.0 * vPos - vec2(1.0), 0.0, 1.0);`)}},74571:function(t,e,i){i.d(e,{y:function(){return s}});var r=i(39506);function s(t){const{fragment:e}=t;e.code.add(r.H`uint readChannelBits(uint channel, int highlightLevel) {
int llc = (highlightLevel & 3) << 1;
return (channel >> llc) & 3u;
}
uint readChannel(vec2 texel, int highlightLevel) {
int lic = (highlightLevel >> 2) & 1;
return uint(texel[lic] * 255.0);
}
uint readLevelBits(vec2 texel, int highlightLevel) {
return readChannelBits(readChannel(texel, highlightLevel), highlightLevel);
}`)}},26762:function(t,e,i){i.d(e,{H:function(){return f},W:function(){return p}});var r=i(1932),s=i(91765),n=i(11687),o=i(82598),a=i(30636),l=i(454),h=i(39506),c=i(65839),u=i(77971);const d=8;function f(t,e){const i=c.r.FEATUREVALUE;t.attributes.add(i,"vec4");const r=t.vertex;r.code.add(h.H`
  bool isCapVertex() {
    return ${i}.w == 1.0;
  }
  `),r.uniforms.add(new n.G("size",(t=>t.size))),e.vvSize?(r.uniforms.add(new o.t("vvSizeMinSize",(t=>t.vvSize.minSize)),new o.t("vvSizeMaxSize",(t=>t.vvSize.maxSize)),new o.t("vvSizeOffset",(t=>t.vvSize.offset)),new o.t("vvSizeFactor",(t=>t.vvSize.factor))),r.code.add(h.H`
    vec2 getSize() {
      return size * clamp(vvSizeOffset + ${i}.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
    }
    `)):r.code.add(h.H`vec2 getSize(){
return size;
}`),e.vvOpacity?(r.constants.add("vvOpacityNumber","int",d),r.uniforms.add(new l.x("vvOpacityValues",(t=>t.vvOpacity.values),d),new l.x("vvOpacityOpacities",(t=>t.vvOpacity.opacityValues),d)),r.code.add(h.H`
    vec4 applyOpacity(vec4 color) {
      float value = ${i}.z;
      if (value <= vvOpacityValues[0]) {
        return vec4( color.xyz, vvOpacityOpacities[0]);
      }

      for (int i = 1; i < vvOpacityNumber; ++i) {
        if (vvOpacityValues[i] >= value) {
          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
          return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
        }
      }

      return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
    }
    `)):r.code.add(h.H`vec4 applyOpacity(vec4 color){
return color;
}`),e.vvColor?(r.constants.add("vvColorNumber","int",u.p),r.uniforms.add(new l.x("vvColorValues",(t=>t.vvColor.values),u.p),new a.F("vvColorColors",(t=>t.vvColor.colors),u.p)),r.code.add(h.H`
    vec4 getColor() {
      float value = ${i}.y;
      if (value <= vvColorValues[0]) {
        return applyOpacity(vvColorColors[0]);
      }

      for (int i = 1; i < vvColorNumber; ++i) {
        if (vvColorValues[i] >= value) {
          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
          return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
        }
      }

      return applyOpacity(vvColorColors[vvColorNumber - 1]);
    }
    `)):r.code.add(h.H`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`),t.include(s.I),t.attributes.add(c.r.PROFILERIGHT,"vec4"),t.attributes.add(c.r.PROFILEUP,"vec4"),t.attributes.add(c.r.PROFILEVERTEXANDNORMAL,"vec4"),r.code.add(h.H`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`),r.code.add(h.H`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`),r.code.add(h.H`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`),r.code.add(h.H`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)}class p extends u.S{constructor(){super(...arguments),this.size=(0,r.fA)(1,1)}}},50399:function(t,e,i){i.d(e,{I:function(){return o}});var r=i(10155),s=i(77771),n=i(39506);function o(t,e){const{vertex:i,fragment:o}=t;t.include(s.Z,e),i.include(r.K),e.terrainDepthTest&&t.varyings.add("depth","float"),i.main.add(n.H`
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${e.terrainDepthTest?n.H`depth = projectAux.posView.z;`:""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  `),o.main.add(n.H`fragColor = vec4(1);
if(terrainDepthTest(depth)) {
fragColor.g = 0.5;
}`)}},2120:function(t,e,i){i.d(e,{v:function(){return n},z:function(){return s}});var r=i(39506);function s(t){t.fragment.code.add(r.H`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function n(t){t.fragment.code.add(r.H`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}},69701:function(t,e,i){i.d(e,{n:function(){return s}});var r=i(39506);function s(t,e){e.spherical?t.vertex.code.add(r.H`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):t.vertex.code.add(r.H`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),e.spherical?t.vertex.code.add(r.H`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):t.vertex.code.add(r.H`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}},5830:function(t,e,i){i.d(e,{E:function(){return A}});var r=i(2120),s=i(39506);function n(t){t.fragment.code.add(s.H`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}var o=i(51942),a=i(3088),l=i(23397),h=i(11687),c=i(14543),u=i(70340),d=i(39838);function f(t,e){if(!e.screenSpaceReflections)return;const i=t.fragment;i.include(l.E),i.uniforms.add(new h.G("nearFar",((t,e)=>e.camera.nearFar)),new d.N("depthMap",((t,e)=>e.depth?.attachment)),new u.X("proj",((t,e)=>e.camera.projectionMatrix)),new c.m("invResolutionHeight",((t,e)=>1/e.camera.height)),new u.X("reprojectionMatrix",((t,e)=>e.ssr.reprojectionMatrix))).code.add(s.H`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${e.highStepCount?"150":"75"};

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P = clamp(P + dP, vec2(0.0), vec2(0.999));
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}var p=i(32501),m=i(43587),g=i(1616),_=i(75256),y=i(58192),v=i(42426),x=i(45937),b=i(82598),w=i(65312),P=i(54516);class S extends w.n{constructor(t,e){super(t,"samplerCube",P.c.Pass,((i,r,s)=>i.bindTexture(t,e(r,s))))}}function C(t){const e=t.fragment;e.constants.add("radiusCloudsSquared","float",T).code.add(s.H`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos) {
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusCloudsSquared;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
return (cameraPosition + dir * pointIntDist) - spherePos;
}`),e.uniforms.add(new c.m("radiusCurvatureCorrection",((t,e)=>e.clouds.parallax.radiusCurvatureCorrection))).code.add(s.H`vec3 correctForPlanetCurvature(vec3 dir) {
dir.z = dir.z * (1.0 - radiusCurvatureCorrection) + radiusCurvatureCorrection;
return dir;
}`),e.code.add(s.H`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec) {
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),(0,v.Gc)(e),(0,v.O4)(e);const i=(0,p.fA)(.28,.175,.035);e.constants.add("RIM_COLOR","vec3",i),e.code.add(s.H`
    vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds) {
      float upDotLight = dot(cameraPosition, mainLightDirection);
      float dirDotLight = max(dot(worldSpaceRay, mainLightDirection), 0.0);
      float sunsetTransition = clamp(pow(max(upDotLight, 0.0), ${s.H.float(.3)}), 0.0, 1.0);

      // Base color of the clouds that depends on lighting of the sun and sky
      vec3 ambientLight = calculateAmbientIrradiance(cameraPosition,  0.0);
      vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
      vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));

      // Rim light around the edge of the clouds simulating scattering of the direct lun light
      float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
      float rimLightIntensity = 0.5 + 0.5 * pow(max(upDotLight, 0.0), 0.35);
      vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, ${s.H.float(140)})) * scatteringMod;

      // Brighten the clouds around the sun at the sunsets
      float additionalLight = ${s.H.float(.2)} * pow(dirDotLight, ${s.H.float(10)}) * (1. - pow(sunsetTransition, ${s.H.float(.3)})) ;

      return vec3(baseCloudColor * (1.0 + additionalLight) + directSunScattering);
    }
  `),e.uniforms.add(new x.e("readChannelsRG",((t,e)=>e.clouds.readChannels===g.c.RG)),new S("cubeMap",((t,e)=>e.clouds.data?.cubeMap?.colorTexture??null))).code.add(s.H`vec4 sampleCloud(vec3 rayDir, bool readOtherChannel) {
vec4 s = texture(cubeMap, rayDir);
bool readRG = readChannelsRG ^^ readOtherChannel;
s = readRG ? vec4(vec3(s.r), s.g) : vec4(vec3(s.b), s.a);
return length(s) == 0.0 ? vec4(s.rgb, 1.0) : s;
}`),e.uniforms.add(new b.t("anchorPoint",((t,e)=>e.clouds.parallax.anchorPoint)),new b.t("anchorPointNew",((t,e)=>e.clouds.parallaxNew.anchorPoint)),new u.X("rotationClouds",((t,e)=>e.clouds.parallax.transform)),new u.X("rotationCloudsNew",((t,e)=>e.clouds.parallaxNew.transform)),new c.m("cloudsOpacity",((t,e)=>e.clouds.opacity)),new c.m("fadeFactor",((t,e)=>e.clouds.fadeFactor)),new x.e("crossFade",((t,e)=>e.clouds.fadeState===_.c.CROSS_FADE))).code.add(s.H`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition) {
vec3 intersectionPoint = intersectWithCloudLayer(worldRay, cameraPosition, anchorPoint);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = sampleCloud(worldRayRotatedCorrected, crossFade);
vec3 cameraPositionN = normalize(cameraPosition);
vec4 cloudColor = vec4(calculateCloudColor(cameraPositionN, worldRay, cloudData), cloudData.a);
if(crossFade) {
intersectionPoint = intersectWithCloudLayer(worldRay, cameraPosition, anchorPointNew);
worldRayRotated = rotateDirectionToAnchorPoint(rotationCloudsNew, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = sampleCloud(worldRayRotatedCorrected, false);
vec4 cloudColorNew = vec4(calculateCloudColor(cameraPositionN, worldRay, cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorNew, fadeFactor);
}
float totalTransmittance = length(cloudColor.rgb) == 0.0 ?
1.0 :
clamp(cloudColor.a * cloudsOpacity + (1.0 - cloudsOpacity), 0.0 , 1.0);
return vec4(cloudColor.rgb, totalTransmittance);
}`)}const T=(m.$O.radius+y.k9)**2;function M(t){t.code.add(s.H`vec3 tonemapACES(vec3 x) {
return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
}`)}function A(t,e){t.include(o.f,e),t.include(n),t.include(r.v),e.cloudReflections&&t.include(C),t.include(f,e);const i=t.fragment;i.include(M),i.constants.add("fresnelSky","vec3",[.02,1,15]),i.constants.add("fresnelMaterial","vec2",[.02,.1]),i.constants.add("roughness","float",.015),i.constants.add("foamIntensityExternal","float",1.7),i.constants.add("ssrIntensity","float",.65),i.constants.add("ssrHeightFadeStart","float",a.O),i.constants.add("ssrHeightFadeEnd","float",a.b),i.constants.add("waterDiffusion","float",.92),i.constants.add("waterSeaColorMod","float",.8),i.constants.add("correctionViewingPowerFactor","float",.4),i.constants.add("skyZenitColor","vec3",[.52,.68,.9]),i.constants.add("skyColor","vec3",[.67,.79,.9]),i.constants.add("cloudFresnelModifier","vec2",[1.2,.01]),i.code.add(s.H`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),i.uniforms.add(new c.m("lightingSpecularStrength",((t,e)=>e.lighting.mainLight.specularStrength)),new c.m("lightingEnvironmentStrength",((t,e)=>e.lighting.mainLight.environmentStrength))),i.code.add(s.H`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
float NdotL = clamp(dot(n, l), 0.0, 1.0);
specular = lightingSpecularStrength * NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),e.cloudReflections&&i.uniforms.add(new c.m("cloudsOpacity",((t,e)=>e.clouds.opacity))).code.add(s.H`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y * cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * cloudsOpacity;`),e.screenSpaceReflections?i.uniforms.add(new u.X("view",((t,e)=>e.camera.viewMatrix)),new d.N("lastFrameColorTexture",((t,e)=>e.ssr.lastFrameColor?.getTexture())),new c.m("fadeFactorSSR",((t,e)=>e.ssr.fadeFactor))).code.add(s.H`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view * vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view * vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactorSSR;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture(lastFrameColorTexture, reprojectedCoordinate).xyz) *
reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +
reflSea * seaColorMod + specular + foam);`):i.code.add(s.H`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),e.cloudReflections?e.screenSpaceReflections?i.code.add(s.H`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):i.code.add(s.H`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):i.code.add(s.H`return waterRenderedColor;
}`)}},15985:function(t,e,i){i.d(e,{V:function(){return d}});var r=i(13786),s=i(1932),n=i(33400),o=i(41546),a=i(2120),l=(i(56574),i(11687)),h=i(38917),c=i(39506),u=i(39838);function d(t){t.fragment.uniforms.add(new u.N("texWaveNormal",(t=>t.waveNormal)),new u.N("texWavePerturbation",(t=>t.wavePerturbation)),new h.E("waveParams",(t=>(0,n.s)(f,t.waveStrength,t.waveTextureRepeat,t.flowStrength,t.flowOffset))),new l.G("waveDirection",(t=>(0,r.hZ)(p,t.waveDirection[0]*t.waveVelocity,t.waveDirection[1]*t.waveVelocity)))),t.include(a.z),t.fragment.code.add(c.H`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}const f=(0,o.vt)(),p=(0,s.vt)()},67521:function(t,e,i){i.d(e,{Cc:function(){return l},RW:function(){return a},VM:function(){return h}});var r=i(83525),s=i(27264);const n={required:[]};s.V.Depth;class o extends r.A{precompile(t){const e=this.acquireTechniques(t);return h(e),null!=e}consumes(){return n}get usedMemory(){return 0}get isDecoration(){return!1}get running(){return!1}modify(t){}get numGeometries(){return 0}get hasOccludees(){return!1}get hasEmissions(){return!1}forEachGeometry(t){}queryRenderOccludedState(t){return!1}}class a extends o{}class l extends o{}function h(t){Array.isArray(t)?t.forEach((t=>t?.release())):t?.release()}},23545:function(t,e,i){i.d(e,{VR:function(){return s},a0:function(){return o}});var r=i(7187);class s{constructor(){this.adds=new r.A,this.removes=new r.A,this.updates=new r.A({allocator:t=>t||new n,deallocator:t=>(t.renderGeometry=null,t)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}get empty(){return 0===this.adds.length&&0===this.removes.length&&0===this.updates.length}}class n{}class o{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}}},88075:function(t,e,i){i.d(e,{z:function(){return s}});var r=i(28950);function s(t){const{size:e}=t.definition,i=t.fontString(e);let s=n.get(i);if(!s){const h=(0,r.y)(a,0,0).getContext("2d");t.setFontProperties(h,e);const c=h.measureText(l);s=new o(c.actualBoundingBoxAscent,c.actualBoundingBoxDescent),n.set(i,s)}return s}const n=new Map;class o{get maxHeight(){return this.maxAscent+this.maxDescent}constructor(t,e){this.maxAscent=t,this.maxDescent=e}}const a={canvas:null},l=(()=>{let t="";for(let e=32;e<127;e++)t+=String.fromCharCode(e);return t})()},52798:function(t,e,i){i.d(e,{c:function(){return s}});var r=i(54407);class s{constructor(t,e){this._material=t,this._repository=e,this._map=new Map}dispose(){this._map.forEach(((t,e)=>{null!=t&&this._repository.release(this._material,e)}))}load(t,e,i){const s=this._material.produces.get(e);if(!s?.(i))return null;this._map.has(i)||this._map.set(i,this._repository.acquire(this._material,e,i));const n=this._map.get(i);if(null!=n){if(n.ensureResources(t)===r.Am.LOADED)return n;this._repository.requestRender()}return null}}},96253:function(t,e,i){var r,s;i.d(e,{k:function(){return s},q:function(){return r}}),function(t){t[t.ADD=0]="ADD",t[t.UPDATE=1]="UPDATE",t[t.REMOVE=2]="REMOVE"}(r||(r={})),function(t){t[t.NONE=0]="NONE",t[t.VISIBILITY=1]="VISIBILITY",t[t.GEOMETRY=2]="GEOMETRY",t[t.TRANSFORMATION=4]="TRANSFORMATION",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.OCCLUDEE=16]="OCCLUDEE"}(s||(s={}))},13641:function(t,e,i){i.d(e,{aT:function(){return s},fA:function(){return n}});var r=i(15774);function s(t,e,i,r,s,n=2){const a=1/(Math.abs(i)+Math.abs(r)+Math.abs(s)),l=i*a,h=r*a,c=s<=0?(l>=0?1:-1)*(1-Math.abs(h)):l,u=s<=0?(h>=0?1:-1)*(1-Math.abs(l)):h,d=e*n;t[d]=o(c),t[d+1]=o(u)}function n(t){const e=t.length/3,i=new Int16Array(2*e);let r=0;for(let n=0;n<e;++n)s(i,n,t[r++],t[r++],t[r++]);return i}function o(t){return(0,r.qE)(Math.round(32767*t),-32767,32767)}i(20551),i(32501),i(5047)},15389:function(t,e,i){i.d(e,{$:function(){return h}});var r=i(11231),s=i(73364),n=i(39714),o=i(20551),a=i(13794),l=i(76185);class h{constructor(t,e={}){this.geometry=t,this.screenToWorldRatio=1,this._transformation=(0,n.vt)(),this._shaderTransformation=null,this._boundingSphere=null,this.id=(0,r.c)(),this.layerUid=e.layerUid,this.graphicUid=e.graphicUid,this.castShadow=e.castShadow??!1,e.objectShaderTransformation&&this.objectShaderTransformationChanged(e.objectShaderTransformation)}get transformation(){return this._transformation}set transformation(t){(0,s.C)(this._transformation,t),this._boundingSphere=null}get boundingInfo(){return this.geometry.boundingInfo}objectShaderTransformationChanged(t){null==t?this._shaderTransformation=null:(this._shaderTransformation??=(0,n.vt)(),(0,s.lw)(this._shaderTransformation,t,this.geometry.transformation)),this._boundingSphere=null}get boundingSphere(){return this.boundingInfo?(null==this._boundingSphere&&(this._boundingSphere??=(0,a.c)(),(0,o.t)((0,a.a)(this._boundingSphere),this.boundingInfo.center,this.shaderTransformation),this._boundingSphere[3]=this.boundingInfo.radius*(0,l.hG)(this.shaderTransformation)),this._boundingSphere):a.N}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return this._shaderTransformation??this.transformation}get attributes(){return this.geometry.attributes}get highlight(){return this.geometry.highlights}foreachHighlightGroup(t){this.geometry.foreachHighlightGroup(t)}get hasHighlights(){return this.geometry.hasHighlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(t){this.geometry.visible=t}}},28950:function(t,e,i){function r(t,e,i){return t.canvas||(t.canvas=document.createElement("canvas")),t.canvas.width=e,t.canvas.height=i,t.canvas}i.d(e,{y:function(){return r}})},36029:function(t,e,i){i.d(e,{Js:function(){return l},Xd:function(){return a},lV:function(){return c}});var r=i(15774),s=i(70974),n=i(88075),o=i(28950);const a=1;class l{constructor(t,e,i,r){this.text=t,this._alignment=e,this._parameters=i,this._maxSize=r,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._metricsCached=null,this.key=`${t}--${this._parameters.key}-${this._alignment}`,this._lines=t.replaceAll(" ","").split(/\r?\n/)}get displayWidth(){return Math.ceil(this._displayWidth+2*this._horizontalPadding)}get displayHeight(){let t=this._metrics.firstLineAscent;for(let e=0;e<this._lines.length-1;e++)t+=this._lineSpacing;return t+=this._metrics.lastLineDescent,Math.ceil(t+2*this._haloSize+2*this._verticalPadding)}get renderedWidth(){return this._toRoundedRenderUnit(this.displayWidth)}get renderedHeight(){return this._toRoundedRenderUnit(this.displayHeight)}get firstRenderedBaselinePosition(){return this._toRenderUnit(this._firstLineYOffset+this._metrics.firstLineAscent)}get _firstLineYOffset(){return this._verticalPadding+this._haloSize}get _metrics(){if(null==this._metricsCached){const t=(0,o.y)(d,p,p).getContext("2d"),e=this._parameters.definition.pixelRatio,i=this._fontSize*e;this._parameters.setFontProperties(t,i);let r=2*this._haloSize;const s=this._parameters.definition.font;"italic"!==s.style&&"oblique"!==s.style&&"bold"!==s.weight&&"bolder"!==s.weight||(r+=.3*t.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let a=0,l=0,h=0,c=0,u=0;this._lines.forEach(((i,s)=>{const n=t.measureText(i),o=n.width/e,d=o+r;this._textWidths.push(o),this._lineWidths.push(d),a=Math.max(a,d),c=Math.max(c,n.actualBoundingBoxAscent/e),u=Math.max(u,n.actualBoundingBoxDescent/e),0===s&&(l=n.actualBoundingBoxAscent/e),s===this._lines.length-1&&(h=n.actualBoundingBoxDescent/e)}));const f=(0,n.z)(this._parameters),m=Math.max(c,f.maxAscent),_=Math.max(u,f.maxDescent),y=l,v="underline"===this._parameters.definition.font.decoration?_:h,x=a;this._metricsCached=new g(y,v,m,_,x)}return this._metricsCached}get _lineSpacing(){return(this._midLineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}get _midLineHeight(){return this._metrics.midLineHeight}get _linePadding(){return this._midLineHeight*f}get _midLineAscent(){return this._metrics.maxLineAscent}get _renderedFontSize(){return this._toRenderUnit(this._fontSize)}get _fontSize(){return this._parameters.definition.size}get _renderedHaloSize(){return this._toRenderUnit(this._haloSize)}get _haloSize(){return this._parameters.haloSize}get _horizontalPadding(){return this._hasBackground?this._parameters.definition.background.padding[0]:0}get _verticalPadding(){return Math.max(this._hasBackground?this._parameters.definition.background.padding[1]:0,a)}get _hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(null==this._renderPixelRatio){const t=this._parameters.definition.pixelRatio;this._renderPixelRatio=Math.min(t,Math.min(this._maxSize[0]/this.displayWidth,this._maxSize[1]/this.displayHeight))}return this._renderPixelRatio}_getLineXOffset(t){switch(this._alignment){case c.Left:return this._horizontalPadding;case c.Center:return(this.displayWidth-this._lineWidths[t])/2;case c.Right:return this.displayWidth-this._horizontalPadding-this._lineWidths[t]}}render(t,e,i){t.save();const r=e/=this.renderPixelRatio,n=i/=this.renderPixelRatio,o=this._haloSize,a=this._firstLineYOffset+this._metrics.firstLineAscent;e+=o,i+=a;const l=this._haloSize>0;l&&this._renderHalo(t,r,n,o,a),this._parameters.setFontProperties(t,this._renderedFontSize);for(let r=0;r<this._lines.length;++r){const s=this._lines[r],n=this._getLineXOffset(r);l&&(t.globalCompositeOperation="destination-out",t.fillStyle="rgb(0, 0, 0)",this._fillText(t,s,e+n,i),this._renderLineDecoration(t,e+n,i,this._textWidths[r])),t.globalCompositeOperation="source-over",t.fillStyle=this._parameters.textStyle,this._fillText(t,s,e+this._getLineXOffset(r),i),this._renderLineDecoration(t,e+n,i,this._textWidths[r]),i+=this._lineSpacing}if(s.b.TEXT_SHOW_BASELINE){t.strokeStyle=m,t.setLineDash([2,2]),t.lineWidth=1;let e=n+a;for(let i=0;i<this._lines.length;++i)this._drawLine(t,[r,e],[r+this.displayWidth,e]),e+=this._lineSpacing}if(s.b.TEXT_SHOW_BORDER&&(t.strokeStyle=m,t.setLineDash([]),t.lineWidth=1,this._drawBox(t,[r,n],[this.displayWidth,this.displayHeight])),this._hasBackground){const e=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(t,r,n,e),t.globalCompositeOperation="destination-over",t.fillStyle=this._parameters.backgroundStyle,t.fill()}t.restore()}_renderLineDecoration(t,e,i,r,s=!1){if("none"===this._parameters.definition.font.decoration||0===r)return;const n=Math.max(this._parameters.definition.size/16,1);switch(this._parameters.definition.font.decoration){case"underline":i+=2*n;break;case"line-through":i-=.33*this._midLineAscent}const o=s?this._haloSize:0;t.strokeStyle=s?this._parameters.haloStyle:this._parameters.textStyle,t.lineWidth=this._toRenderUnit(n+2*o),t.beginPath(),t.moveTo(this._toRenderUnit(e-o),this._toRenderUnit(i)),t.lineTo(this._toRenderUnit(e+r+o),this._toRenderUnit(i)),t.stroke()}_roundedRect(t,e,i,s){e=this._toRenderUnit(e),i=this._toRenderUnit(i);const n=this.renderedWidth,o=this.renderedHeight;0!==s?(s=(0,r.qE)(s,0,Math.floor(o/2)),t.beginPath(),t.moveTo(e,i+s),t.arcTo(e,i,e+s,i,s),t.lineTo(e+n-s,i),t.arcTo(e+n,i,e+n,i+s,s),t.lineTo(e+n,i+o-s),t.arcTo(e+n,i+o,e+n-s,i+o,s),t.lineTo(e+s,i+o),t.arcTo(e,i+o,e,i+o-s,s),t.closePath()):t.rect(e,i,n,o)}_renderHalo(t,e,i,r,s){const n=this.renderedWidth,a=this.renderedHeight,l=(0,o.y)(d,Math.max(n,p),Math.max(a,p)),h=l.getContext("2d");h.clearRect(0,0,n,a),this._parameters.setFontProperties(h,this._renderedFontSize),h.fillStyle=this._parameters.haloStyle,h.strokeStyle=this._parameters.haloStyle;const c=this._renderedHaloSize<3;h.lineJoin=c?"miter":"round",c?this._renderHaloEmulated(h,r,s):this._renderHaloNative(h,r,s);let u=s;for(let t=0;t<this._lines.length;++t){const e=this._getLineXOffset(t);this._renderLineDecoration(h,r+e,u,this._textWidths[t],!0),u+=this._lineSpacing}t.globalAlpha=this._parameters.definition.halo.color[3],t.drawImage(l,0,0,n,a,this._toRenderUnit(e),this._toRenderUnit(i),n,a),t.globalAlpha=1}_renderHaloEmulated(t,e,i){for(let r=0;r<this._lines.length;++r){const s=this._lines[r],n=this._getLineXOffset(r);for(const[r,o]of h)this._fillText(t,s,e+n+this._haloSize*r,i+this._haloSize*o);i+=this._lineSpacing}}_renderHaloNative(t,e,i){const r=2*this._haloSize;for(let s=0;s<this._lines.length;++s){const n=this._lines[s],o=this._getLineXOffset(s),a=5,l=.1;for(let s=0;s<a;s++){const h=1-(a-1)*l+s*l;t.lineWidth=this._toRenderUnit(h*r),this._strokeText(t,n,e+o,i)}i+=this._lineSpacing}}get _displayWidth(){return this._metrics.displayWidth}_toRenderUnit(t){return t*this.renderPixelRatio}_toRoundedRenderUnit(t){return Math.round(t*this.renderPixelRatio)}_fillText(t,e,i,r){t.fillText(e,this._toRenderUnit(i),this._toRenderUnit(r))}_strokeText(t,e,i,r){t.strokeText(e,this._toRenderUnit(i),this._toRenderUnit(r))}_drawLine(t,e,i){t.beginPath(),t.moveTo(this._toRoundedRenderUnit(e[0])+.5,this._toRoundedRenderUnit(e[1])+.5),t.lineTo(this._toRoundedRenderUnit(i[0])+.5,this._toRoundedRenderUnit(i[1])+.5),t.stroke()}_drawBox(t,e,i){const r=this._toRenderUnit(e[0]),s=this._toRenderUnit(e[1]),n=this._toRenderUnit(i[0]),o=this._toRenderUnit(i[1]),a=Math.floor(r)+.5,l=Math.ceil(r+n)-.5,h=Math.floor(s)+.5,c=Math.ceil(s+o)-.5;t.beginPath(),t.moveTo(a,h),t.lineTo(l,h),t.lineTo(l,c),t.lineTo(a,c),t.lineTo(a,h),t.stroke()}}const h=[];{const t=16;for(let e=0;e<360;e+=360/t)h.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)])}var c,u;(u=c||(c={}))[u.Left=0]="Left",u[u.Center=1]="Center",u[u.Right=2]="Right";const d={canvas:null},f=.2,p=512,m="rgb(255, 0, 255, 0.5)";class g{get firstLineHeight(){return this.firstLineAscent+this.maxLineDescent}get midLineHeight(){return this.maxLineAscent+this.maxLineDescent}get lastLineHeight(){return this.maxLineAscent+this.lastLineDescent}constructor(t,e,i,r,s){this.firstLineAscent=t,this.lastLineDescent=e,this.maxLineAscent=i,this.maxLineDescent=r,this.displayWidth=s}}},69445:function(t,e,i){i.d(e,{Z:function(){return s}});var r=i(81438);class s extends r.Z{}},84363:function(t,e,i){i.d(e,{h:function(){return s}}),i(38177);var r=i(50456);i(59356);class s extends r.R6{constructor(t,e,i,r,s,n){super(t,e),this.layerUid=t,this.graphicUid=e,this.geometryId=i,this.triangleNr=r,this.baseBoundingSphere=s,this.numLodLevels=n}}},64543:function(t,e,i){i.d(e,{L:function(){return ct}});var r=i(53804),s=i(50659),n=i(39819),o=i(25738),a=i(95929),l=i(60539),h=i(23502),c=(i(58941),i(40633),i(65953)),u=i(39714),d=i(20551),f=i(32501),p=i(41546),m=i(70974),g=i(69550),_=i(65856),y=i(65631),v=i(27264),x=i(67521),b=i(40502),w=i(38177),P=i(35363),S=i(29165),C=i(90553),T=i(65839),M=i(83525),A=i(48996),R=i(44705),O=i(87725),I=i(73364),E=i(92754),L=i(76185),D=i(86305),z=i(85456);class N{constructor(t,e,i){this._elementSize=e,this._buffer=D.g.createVertex(t,z._U.STATIC_DRAW),this.resize(i)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get usedMemory(){return this._array.byteLength+this._buffer.usedMemory}copyRange(t,e,i,r=0){const s=new Uint8Array(this.array,t*this.elementSize,(e-t)*this.elementSize);new Uint8Array(i.array,r*this.elementSize).set(s)}transferAll(){this._buffer.setData(this._array)}transferRange(t,e){const i=t*this._elementSize,r=e*this._elementSize;this._buffer.setSubData(new Uint8Array(this._array),i,i,r)}resize(t){const e=t*this._elementSize,i=new ArrayBuffer(e);this._array&&(t>=this._capacity?new Uint8Array(i).set(new Uint8Array(this._array)):new Uint8Array(i).set(new Uint8Array(this._array).subarray(0,t*this._elementSize))),this._array=i,this._buffer.setSize(e),this._capacity=t}}class F{constructor(t){this.modelOriginHi=t.getField(T.r.INSTANCEMODELORIGINHI,E.xs),this.modelOriginLo=t.getField(T.r.INSTANCEMODELORIGINLO,E.xs),this.model=t.getField(T.r.INSTANCEMODEL,E.jZ),this.modelNormal=t.getField(T.r.INSTANCEMODELNORMAL,E.jZ),this.featureAttribute=t.getField(T.r.INSTANCEFEATUREATTRIBUTE,E.Eq),this.color=t.getField(T.r.INSTANCECOLOR,E.XP),this.objectAndLayerIdColor=t.getField(T.r.INSTANCEOBJECTANDLAYERIDCOLOR,E.XP)}}class k{constructor(t,e){this._rctx=t,this._instanceBufferLayout=e,this._headIndex=0,this._tailIndex=0,this._firstIndex=null,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const t=this._headIndex,e=this._tailIndex;return t>=e?t-e:t+this._capacity-e}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get usedMemory(){return this._buffer?.usedMemory??0}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCycle(){this._captureFirstIndex=!0}beginUpdate(){(0,C.vA)(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){(0,C.vA)(this._updating,"not updating"),this.size<s.$U*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){(0,C.vA)(this._updating,"not updating"),this.isFull&&this._grow();const t=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=t,this._captureFirstIndex=!1),this._incrementHead(),(0,C.vA)(this._headIndex!==this._tailIndex,"invalid pointers"),t}freeTail(){(0,C.vA)(this._updating,"not updating"),(0,C.vA)(this.size>0,"invalid size");const t=this._tailIndex===this._firstIndex;this._incrementTail(),t&&(this._firstIndex=this._tailIndex)}_grow(){const t=Math.max(V,Math.floor(this._capacity*s.Ji));this._resize(t)}_shrink(){const t=Math.max(V,Math.floor(this._capacity*s.He));this._resize(t)}_resize(t){if((0,C.vA)(this._updating,"not updating"),t===this._capacity)return;const e=new N(this._rctx,this._instanceBufferLayout.stride,t);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const t=this.size,i=this._compactInstances(e);(0,C.vA)(i===t,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=i,this._prevHeadIndex=0}this._resized=!0,this._capacity=t,this._buffer=e,this._view=new F(this._instanceBufferLayout.createView(this._buffer.array))}_compactInstances(t){const e=this._headIndex,i=this._tailIndex;return i<e?(this._buffer.copyRange(i,e,t),e-i):i>e?(this._buffer.copyRange(i,this._capacity,t),e>0&&this._buffer.copyRange(0,e,t,this._capacity-i),e+(this._capacity-i)):0}_incrementHead(t=1){this._headIndex=(this._headIndex+t)%this._capacity}_incrementTail(t=1){this._tailIndex=(this._tailIndex+t)%this._capacity}_transferRange(t,e){t<e?this._buffer.transferRange(t,e):t>e&&(e>0&&this._buffer.transferRange(0,e),this._buffer.transferRange(t,this._capacity))}}const V=64;var B,U;(U=B||(B={}))[U.ALLOCATED=1]="ALLOCATED",U[U.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",U[U.VISIBLE=4]="VISIBLE",U[U.HIGHLIGHT=8]="HIGHLIGHT",U[U.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",U[U.REMOVE=32]="REMOVE",U[U.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",U[U.ACTIVE=18]="ACTIVE";class G{constructor(t){this.localTransform=t.getField(T.r.LOCALTRANSFORM,E.E$),this.globalTransform=t.getField(T.r.GLOBALTRANSFORM,E.E$),this.modelOrigin=t.getField(T.r.MODELORIGIN,E.Xm),this.model=t.getField(T.r.INSTANCEMODEL,E.jZ),this.modelNormal=t.getField(T.r.INSTANCEMODELNORMAL,E.jZ),this.modelScaleFactors=t.getField(T.r.MODELSCALEFACTORS,E.gH),this.boundingSphere=t.getField(T.r.BOUNDINGSPHERE,E.Aj),this.featureAttribute=t.getField(T.r.FEATUREATTRIBUTE,E.Eq),this.color=t.getField(T.r.COLOR,E.XP),this.objectAndLayerIdColor=t.getField(T.r.OBJECTANDLAYERIDCOLOR,E.XP),this.state=t.getField(T.r.STATE,E.SL),this.lodLevel=t.getField(T.r.LODLEVEL,E.SL)}}let H=class extends M.A{constructor(t,e){super(t),this.events=new A.A,this._capacity=0,this._size=0,this._next=0,this._highlightGroupMap=new Map,this._highlightGroupMapPrev=new Map,this._layout=function(t){let e=(0,_.BP)().mat4f64(T.r.LOCALTRANSFORM).mat4f64(T.r.GLOBALTRANSFORM).vec4f64(T.r.BOUNDINGSPHERE).vec3f64(T.r.MODELORIGIN).mat3f(T.r.INSTANCEMODEL).mat3f(T.r.INSTANCEMODELNORMAL).vec2f(T.r.MODELSCALEFACTORS);return t.includes(T.r.FEATUREATTRIBUTE)&&(e=e.vec4f(T.r.FEATUREATTRIBUTE)),t.includes(T.r.COLOR)&&(e=e.vec4u8(T.r.COLOR)),t.includes(T.r.OBJECTANDLAYERIDCOLOR)&&(e=e.vec4u8(T.r.OBJECTANDLAYERIDCOLOR)),e=e.u8(T.r.STATE).u8(T.r.LODLEVEL),e}(e),this._capacity=V,this._buffer=this._layout.createBuffer(this._capacity),this._view=new G(this._buffer)}get capacity(){return this._capacity}get size(){return this._size}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const t=this._findSlot();return this._view.state.set(t,B.ALLOCATED),this._size++,this.events.emit("instances-changed"),t}removeInstance(t){const e=this._view.state;(0,C.vA)(t>=0&&t<this._capacity&&!!(e.get(t)&B.ALLOCATED),"invalid instance handle"),this._getStateFlag(t,B.ACTIVE)?this._setStateFlags(t,B.REMOVE):this.freeInstance(t),this.events.emit("instances-changed")}freeInstance(t){const e=this._view.state;(0,C.vA)(t>=0&&t<this._capacity&&!!(e.get(t)&B.ALLOCATED),"invalid instance handle"),e.set(t,0),this._size--}setLocalTransform(t,e,i=!0){this._view.localTransform.setMat(t,e),i&&this.updateModelTransform(t)}getLocalTransform(t,e){this._view.localTransform.getMat(t,e)}setGlobalTransform(t,e,i=!0){this._view.globalTransform.setMat(t,e),i&&this.updateModelTransform(t)}getGlobalTransform(t,e){this._view.globalTransform.getMat(t,e)}updateModelTransform(t){const e=this._view,i=W,r=j;e.localTransform.getMat(t,$),e.globalTransform.getMat(t,Z);const s=(0,I.lw)(Z,Z,$);(0,d.i)(i,s[12],s[13],s[14]),e.modelOrigin.setVec(t,i),(0,R.z0)(r,s),e.model.setMat(t,r);const n=(0,L.wp)(W,s);n.sort(),e.modelScaleFactors.set(t,0,n[1]),e.modelScaleFactors.set(t,1,n[2]),(0,R.B8)(r,r),(0,R.mg)(r,r),e.modelNormal.setMat(t,r),this._setStateFlags(t,B.TRANSFORM_CHANGED),this.events.emit("instance-transform-changed",{index:t})}getModelTransform(t,e){const i=this._view;i.model.getMat(t,j),i.modelOrigin.getVec(t,W),e[0]=j[0],e[1]=j[1],e[2]=j[2],e[3]=0,e[4]=j[3],e[5]=j[4],e[6]=j[5],e[7]=0,e[8]=j[6],e[9]=j[7],e[10]=j[8],e[11]=0,e[12]=W[0],e[13]=W[1],e[14]=W[2],e[15]=1}applyShaderTransformation(t,e){null!=this.shaderTransformation&&this.shaderTransformation.applyTransform(this,t,e)}getCombinedModelTransform(t,e){return this.getModelTransform(t,e),null!=this.shaderTransformation&&this.shaderTransformation.applyTransform(this,t,e),e}getCombinedLocalTransform(t,e){this._view.localTransform.getMat(t,e),null!=this.shaderTransformation&&this.shaderTransformation.applyTransform(this,t,e)}getCombinedMaxScaleFactor(t){let e=this._view.modelScaleFactors.get(t,1);return null!=this.shaderTransformation&&(this.shaderTransformation.scaleFactor(W,this,t),e*=Math.max(W[0],W[1],W[2])),e}getCombinedMedianScaleFactor(t){let e=this._view.modelScaleFactors.get(t,0);return null!=this.shaderTransformation&&(this.shaderTransformation.scaleFactor(W,this,t),e*=function(t,e,i){return Math.max(Math.min(t,e),Math.min(Math.max(t,e),i))}(W[0],W[1],W[2])),e}getModel(t,e){this._view.model.getMat(t,e)}setFeatureAttribute(t,e){this._view.featureAttribute.setVec(t,e)}getFeatureAttribute(t,e){this._view.featureAttribute.getVec(t,e)}setColor(t,e){this._view.color.setVec(t,e)}setObjectAndLayerIdColor(t,e){this._view.objectAndLayerIdColor.setVec(t,e)}setVisible(t,e){e!==this.getVisible(t)&&(this._setStateFlag(t,B.VISIBLE,e),this.events.emit("instance-visibility-changed",{index:t}))}getVisible(t){return this._getStateFlag(t,B.VISIBLE)}setHighlight(t,e,i){let r=this._highlightGroupMap.get(t);e?(r||(r=new Set,this._highlightGroupMap.set(t,r)),r.add(i)&&(this._setStateFlag(t,B.HIGHLIGHT,!0),this.events.emit("instance-highlight-changed"))):r?.delete(i)&&(0===r.size&&(this._highlightGroupMap.delete(t),this._setStateFlag(t,B.HIGHLIGHT,!1)),this.events.emit("instance-highlight-changed"))}getHighlight(t){return this._getStateFlag(t,B.HIGHLIGHT)}foreachHighlightGroupPrev(t,e){this._highlightGroupMapPrev.get(t)?.forEach(e),this._highlightGroupMapPrev.delete(t)}foreachHighlightGroup(t,e){const i=this._highlightGroupMap.get(t);i?.forEach(e),i?this._highlightGroupMapPrev.set(t,new Set(i)):this._highlightGroupMapPrev.delete(t)}getState(t){return this._view.state.get(t)}getLodLevel(t){return this._view.lodLevel.get(t)}countFlags(t){let e=0;for(let i=0;i<this._capacity;++i)this.getState(i)&t&&++e;return e}_setStateFlags(t,e){const i=this._view.state;e=i.get(t)|e,i.set(t,e)}_clearStateFlags(t,e){const i=this._view.state;e=i.get(t)&~e,i.set(t,e)}_setStateFlag(t,e,i){i?this._setStateFlags(t,e):this._clearStateFlags(t,e)}_getStateFlag(t,e){return!!(this._view.state.get(t)&e)}_grow(){this._capacity=Math.max(V,Math.floor(this._capacity*s.Ji)),this._buffer=this._layout.createBuffer(this._capacity).copyFrom(this._buffer),this._view=new G(this._buffer)}_findSlot(){const t=this._view.state;let e=this._next;for(;t.get(e)&B.ALLOCATED;)e=e+1===this._capacity?0:e+1;return this._next=e+1===this._capacity?0:e+1,e}};(0,r._)([(0,h.MZ)({constructOnly:!0})],H.prototype,"shaderTransformation",void 0),(0,r._)([(0,h.MZ)()],H.prototype,"_size",void 0),(0,r._)([(0,h.MZ)({readOnly:!0})],H.prototype,"size",null),H=(0,r._)([(0,c.$)("esri.views.3d.webgl-engine.lib.lodRendering.InstanceData")],H);const W=(0,f.vt)(),j=(0,O.vt)(),$=(0,u.vt)(),Z=(0,u.vt)();var q=i(13794);class Y extends P.A{constructor(t,e){super((t=>(0,q.w)(this._instanceData.view.boundingSphere.getVec(t,this._tmpSphere))),{maximumDepth:25}),this._instanceData=t,this._boundingSphere=e,this._tmpSphere=(0,q.c)(),this._tmpMat4=(0,u.vt)()}addInstance(t){const e=this._instanceData.view.boundingSphere,i=this._instanceData.getCombinedModelTransform(t,this._tmpMat4);(0,d.t)((0,q.a)(this._tmpSphere),this._boundingSphere.center,i),this._tmpSphere[3]=this._boundingSphere.radius*(0,L.hG)(i),e.setVec(t,this._tmpSphere),this.add([t])}removeInstance(t){this.remove([t])}}class X{constructor(t,e){this._worldSpaceRadius=t,this._minScreenSpaceRadii=e}selectLevel(t,e,i){const r=i.computeScreenPixelSizeAt(t),s=this._worldSpaceRadius*e/r;let n=0;for(let t=1;t<this._minScreenSpaceRadii.length;++t)s>=this._minScreenSpaceRadii[t]&&(n=t);return n}}var Q=i(24761),J=i(48015),K=i(52798),tt=i(49845),et=i(69445),it=i(84363);class rt{constructor(t,e){const i=t.renderContext.rctx,r=e.geometry;let s=null;s=r instanceof J.J?function(t,e,i,r=null){const s=t.createBufferWriter(),n=s.vertexBufferLayout,o=s.elementCount(e),a=n.createBuffer(o);return s.write(null,null,e,r,a,0),{material:t,vertexBufferLayout:n,buffer:a.buffer,elementCount:o,boundingInfo:i}}(r.material,r.attributes,r.boundingInfo):r;const n=s.material;this._materials=t.materials,n.setParameters({instancedDoublePrecision:!0}),this.geometry=r,this.material=n,this.glMaterials=new K.c(n,this._materials),this.vertexBufferLayout=s.vertexBufferLayout,this.vbo=D.g.createVertex(i,z._U.STATIC_DRAW,s.buffer),this.vao=new et.Z(i,b.D,new Map([["geometry",(0,g.U)(s.vertexBufferLayout)]]),new Map([["geometry",this.vbo]])),this.vertexCount=s.elementCount}destroy(){this.glMaterials.dispose(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(t,e,i,r,s,n,o,a){if(!(this.geometry instanceof J.J))return;const l=this.geometry.id;this.material.intersect(this.geometry,t.transform.transform,t,i,r,((i,r,h,c,u)=>{if(i>=0){if(null!=e&&!e(t.rayBegin,t.rayEnd,i))return;const c=new it.h(n.layerUid,n.graphicUid(s),l,h,o,a);if((null==t.results.min.drapedLayerOrder||u>=t.results.min.drapedLayerOrder)&&(null==t.results.min.dist||i<t.results.min.dist)&&t.results.min.set(w.dz.LOD,c,i,r,t.transform.transform,u),t.options.store!==w.oH.MIN&&(null==t.results.max.drapedLayerOrder||u>=t.results.max.drapedLayerOrder)&&(null==t.results.max.dist||i>t.results.max.dist)&&t.results.max.set(w.dz.LOD,c,i,r,t.transform.transform,u),t.options.store===w.oH.ALL){const e=(0,tt.G7)(t.results.min.ray);e.set(w.dz.LOD,c,i,r,t.transform.transform,u),t.results.all.push(e)}}}))}}class st{static async create(t,e,i){const r=await Promise.allSettled(e.components.map((e=>t.controller.schedule((()=>new rt(t,e)),i)))),n=r.map((t=>"fulfilled"===t.status?t.value:null)).filter(s.Ru);if((0,l.G4)(i)||n.length!==r.length){n.forEach((t=>t.destroy())),(0,l.Te)(i);for(const t of r)if("rejected"===t.status)throw t.reason}return new st(e.minScreenSpaceRadius,n)}constructor(t,e){this.minScreenSpaceRadius=t,this.components=e}destroy(){this.components.forEach((t=>t.destroy()))}intersect(t,e,i,r,s,n,o){this.components.forEach((a=>a.intersect(t,e,i,r,s,n,this.boundingSphere,o)))}get boundingBox(){if(null==this._boundingBox){const t=(0,Q.Ie)();this.components.forEach((e=>{null!=e.boundingInfo&&((0,Q.iT)(t,e.boundingInfo.bbMin),(0,Q.iT)(t,e.boundingInfo.bbMax))})),this._boundingBox=t}return this._boundingBox}get boundingSphere(){if(null==this._boundingSphere){const t=this.boundingBox,e=(0,f.vt)();(0,Q.gX)(t,e),this._boundingSphere={center:e,radius:.5*(0,Q._F)(t)}}return this._boundingSphere}get triangleCount(){return this.components.reduce(((t,e)=>t+e.triangleCount),0)}}var nt=i(84887),ot=i(84738),at=i(77032),lt=i(48961),ht=i(93380);let ct=class extends x.Cc{constructor(t,e){super(t),this.type=w.dz.LOD,this.isGround=!1,this._levels=[],this._defaultRenderInstanceData=new Array,this._highlightRenderInstanceDataMap=new Map,this._instanceIndex=0,this._cycleStartIndex=0,this._slicePlane=!1,this._camera=new y.A,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.produces=new Map([[S.N.OPAQUE_MATERIAL,t=>this._produces(t)],[S.N.TRANSPARENT_MATERIAL,t=>!!this._hasTransparentLevels()&&this._produces(t)]]),this._instanceData=new H({shaderTransformation:t.shaderTransformation},t.optionalFields),this.addHandles(e.registerTask(lt.W6.LOD_RENDERER,this))}initialize(){this._instanceBufferLayout=function(t){let e=(0,_.BP)().vec3f(T.r.INSTANCEMODELORIGINHI).vec3f(T.r.INSTANCEMODELORIGINLO).mat3f(T.r.INSTANCEMODEL).mat3f(T.r.INSTANCEMODELNORMAL);return null!=t&&t.includes("featureAttribute")&&(e=e.vec4f(T.r.INSTANCEFEATUREATTRIBUTE)),null!=t&&t.includes("color")&&(e=e.vec4u8(T.r.INSTANCECOLOR)),null!=t&&t.includes("objectAndLayerIdColor")&&(e=e.vec4u8(T.r.INSTANCEOBJECTANDLAYERIDCOLOR)),e}(this.optionalFields),this._glInstanceBufferLayout=(0,g.U)(this._instanceBufferLayout,1),this.addHandles([this._instanceData.events.on("instances-changed",(()=>this._requestUpdateCycle())),this._instanceData.events.on("instance-transform-changed",(({index:t})=>{this._requestUpdateCycle(),this.metadata.notifyGraphicGeometryChanged(t)})),this._instanceData.events.on("instance-visibility-changed",(({index:t})=>{this._requestUpdateCycle(!0),this.metadata.notifyGraphicVisibilityChanged(t)})),this._instanceData.events.on("instance-highlight-changed",(()=>this._requestUpdateCycle(!0)))])}get _allRenderInstanceData(){const t=[this._defaultRenderInstanceData];for(const e of this._highlightRenderInstanceDataMap)t.push(e[1]);return t}get _enableLevelSelection(){return this.symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(t){this._slicePlane=t}get layerUid(){return this.metadata.layerUid}get instanceData(){return this._instanceData}get hasEmissions(){return this.baseMaterial.hasEmissions}get usedMemory(){return this._allRenderInstanceData.reduce(((t,e)=>e.reduce(((t,e)=>t+e.usedMemory),t)),0)}get renderStats(){const t=this._instanceData.size,e=[];return this._levels.forEach(((t,i)=>{const r=this._allRenderInstanceData[0][i].size+this._allRenderInstanceData[1][i].size,s=t.triangleCount;e.push({renderedInstances:r,renderedTriangles:r*s,trianglesPerInstance:s})})),{totalInstances:t,renderedInstances:e.reduce(((t,e)=>t+e.renderedInstances),0),renderedTriangles:e.reduce(((t,e)=>t+e.renderedTriangles),0),levels:e}}_createRenderInstanceDataArray(t=[]){const{rctx:e}=this._context.renderContext;return this.symbol.levels.map((i=>{t.push(new k(e,this._instanceBufferLayout))})),t}async initializeRenderContext(t,e){this._context=t,this._createRenderInstanceDataArray(this._defaultRenderInstanceData);const i=await Promise.allSettled(this.symbol.levels.map((i=>st.create(t,i,e)))),r=i.map((t=>"fulfilled"===t.status?t.value:null)).filter(s.Ru);if((0,l.G4)(e)||r.length!==i.length){r.forEach((t=>t.destroy())),(0,l.Te)(e);for(const t of i)if("rejected"===t.status)throw t.reason}this._levels=r,this._levelSelector=(t=>{const e=t.baseBoundingSphere.radius,i=t.levels.map((t=>t.minScreenSpaceRadius));return new X(e,i)})(this)}uninitializeRenderContext(){this._invalidateOctree(),this._levels.forEach((t=>t.destroy())),this._defaultRenderInstanceData.forEach((t=>t.destroy())),this._highlightRenderInstanceDataMap.forEach((t=>t.forEach((t=>t.destroy()))))}_hasTransparentLevels(){return this._levels.some((t=>t.components.some((t=>{const e=t.material.produces.get(S.N.TRANSPARENT_MATERIAL);return e?.(v.V.Color)}))))}hasHighlights(){return(0,o.Bs)(this._highlightRenderInstanceDataMap,(t=>t.some((t=>t.size>0))))}_produces(t){return t!==v.V.Highlight&&t!==v.V.ShadowHighlight||this.hasHighlights()}prepareRender(t){if(!m.b.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){const e=t.bind.contentCamera.equals(this._camera);this._camera.copyFrom(t.bind.contentCamera),e||this._requestUpdateCycle()}this._needFullCycle&&(this.runTask(lt.Bb),this._needFullCycle=!1)}}acquireTechniques(t){if(!this.baseMaterial.visible||!this.baseMaterial.isVisibleForOutput(t.output))return null;const e=this._getInstanceDatas(t);if(!e)return null;const i=new Array,r=this.levels;return e.forEach((e=>r.forEach((({components:r},s)=>r.forEach((r=>i.push(this._beginComponent(t,e[s],r)))))))),i}render(t,e){const i=this._getInstanceDatas(t);if(!i||null==e)return;let r=0;t.rctx.bindVAO();const s=this.levels;i.forEach((i=>s.forEach((({components:s},n)=>s.forEach((s=>this._renderComponent(t,e[r++],i[n],s,n)))))))}_getInstanceDatas(t){const{output:e,bind:i}=t,r=e===v.V.Highlight,s=!r&&e!==v.V.ShadowHighlight,n=e!==v.V.ShadowExcludeHighlight;if(s)return n?this._allRenderInstanceData:[this._defaultRenderInstanceData];if(n){if(r){const{highlightGroupName:t}=i;if(!t)return null;const e=this._highlightRenderInstanceDataMap.get(t);return e?[e]:null}const t=[];for(const e of this._highlightRenderInstanceDataMap)t.push(e[1]);return t}return null}intersect(t,e,i,r){if(!this.baseMaterial.visible||null==this._octree)return;const s=(0,f.vt)();(0,d.d)(s,r,i);const n=s=>{this._instanceData.getCombinedModelTransform(s,pt),t.transform.set(pt),(0,d.t)(mt,i,t.transform.inverse),(0,d.t)(gt,r,t.transform.inverse);const n=this._instanceData.getState(s),o=this._instanceData.getLodLevel(s),a=this._levels.length;(0,C.vA)(!!(n&B.ACTIVE),"invalid instance state"),(0,C.vA)(o>=0&&o<a,"invaid lod level"),this._levels[o].intersect(t,e,mt,gt,s,this.metadata,a)};this.baseMaterial.parameters.verticalOffset?this._octree.forEach(n):this._octree.forEachAlongRay(i,s,n)}notifyShaderTransformationChanged(){this._invalidateOctree(),this._requestUpdateCycle()}get _octree(){if(null==this._octreeCached){const t=this._instanceData,e=t.view?.state;if(!e)return null;this._octreeCached=new Y(t,this.baseBoundingSphere);for(let i=0;i<t.capacity;++i)e.get(i)&B.ACTIVE&&this._octreeCached.addInstance(i)}return this._octreeCached}_invalidateOctree(){this._octreeCached=(0,a.pR)(this._octreeCached)}queryDepthRange(t){if(null==this._octree)return{near:1/0,far:-1/0};const e=t.viewForward,i=this._octree.findClosest(e,P.A.DepthOrder.FRONT_TO_BACK,t.frustum),r=this._octree.findClosest(e,P.A.DepthOrder.BACK_TO_FRONT,t.frustum);if(null==i||null==r)return{near:1/0,far:-1/0};const s=t.eye,n=this._instanceData.view;n.boundingSphere.getVec(i,ft),(0,d.d)(ft,ft,s);const o=(0,d.f)(ft,e)-ft[3];n.boundingSphere.getVec(r,ft),(0,d.d)(ft,ft,s);const a=(0,d.f)(ft,e)+ft[3];return{near:Math.max(t.near,o),far:Math.min(t.far,a)}}_requestUpdateCycle(t=!1){this._updateCyclesWithStaticCamera=-1,this._cycleStartIndex=this._instanceIndex,t&&(this._needFullCycle=!0,this._context.requestRender())}_startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._allRenderInstanceData.forEach((t=>t.forEach((t=>t.startUpdateCycle()))))}get running(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}runTask(t){const{_enableLevelSelection:e,_camera:i,_levelSelector:r}=this;this._allRenderInstanceData.forEach((t=>t.forEach((t=>t.beginUpdate()))));const s=this._instanceData,o=s.view;let a=s.size;const l=s.capacity;let h=this._instanceIndex;const c=Math.ceil(l/500);for(let u=0;u<a&&!t.done;++u){h===this._cycleStartIndex&&this._startUpdateCycle();const u=o.state.get(h);let d=0;if(!(u&B.ALLOCATED)){h=h+1===l?0:h+1,a++;continue}const f=o.lodLevel.get(h);if(u&B.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[f].freeTail(),u&B.HIGHLIGHT_ACTIVE&&s.foreachHighlightGroupPrev(h,(t=>{const e=this._highlightRenderInstanceDataMap.get(t);if(!e)throw new n.A("Internal error in lodRenderer");e[f].freeTail()})),u&B.REMOVE)s.freeInstance(h);else if(u&B.VISIBLE){let t=0;e&&(o.modelOrigin.getVec(h,dt),t=r.selectLevel(dt,s.getCombinedMedianScaleFactor(h),i)),d=u&~(B.ACTIVE|B.TRANSFORM_CHANGED),t>=0&&(u&B.HIGHLIGHT?(s.foreachHighlightGroup(h,(e=>{let i=this._highlightRenderInstanceDataMap.get(e);if(i||(i=this._createRenderInstanceDataArray(),i.forEach((t=>t.beginUpdate())),this._highlightRenderInstanceDataMap.set(e,i)),t>=i.length)throw new n.A(`LodRenderer internal error - missing lodLevel ${t}`);ut(i[t],o,h)})),d|=B.HIGHLIGHT_ACTIVE):(ut(this._defaultRenderInstanceData[t],o,h),d|=B.DEFAULT_ACTIVE)),o.state.set(h,d),o.lodLevel.set(h,t)}else d=u&~(B.ACTIVE|B.TRANSFORM_CHANGED),o.state.set(h,d);if(null!=this._octreeCached){const t=!!(u&B.ACTIVE),e=!!(d&B.ACTIVE);!t&&e?this._octreeCached.addInstance(h):t&&!e?this._octreeCached.removeInstance(h):t&&e&&u&B.TRANSFORM_CHANGED&&(this._octreeCached.removeInstance(h),this._octreeCached.addInstance(h))}h=h+1===l?0:h+1,h%c==0&&t.madeProgress()}this._instanceIndex=h,this._allRenderInstanceData.forEach((t=>t.forEach((t=>t.endUpdate())))),this._context.requestRender()}_beginComponent(t,e,i){if(0===e.size)return null;const r=i.glMaterials.load(t.rctx,t.bind.slot,t.output);return r?.beginSlot(t.bind)}_renderComponent(t,e,i,r,s){if(!e)return;const{bind:n,rctx:o}=t;o.runAppleAmdDriverHelper();const a=o.bindTechnique(e,n,r.material.parameters,yt);o.bindVAO(r.vao),e.ensureAttributeLocations(r.vao),m.b.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&t.output===v.V.Color&&(a.setUniform4fv("externalColor",_t[Math.min(s,_t.length-1)]),a.setUniform1i("colorMixMode",nt.Um.replace));const l=i.capacity,h=i.headIndex,c=i.tailIndex,u=i.firstIndex,d=this._glInstanceBufferLayout,f=(t,s)=>{(0,ht.yu)(o,b.D,i.buffer,d,t),o.drawArraysInstanced(e.primitiveType,0,r.vertexCount,s-t),(0,ht.Hi)(o,b.D,i.buffer,d)};r.material.parameters.transparent&&null!=u?h>c?((0,C.vA)(u>=c&&u<=h,"invalid firstIndex"),f(u,h),f(c,u)):h<c&&(u<=h?((0,C.vA)(u>=0&&u<=h,"invalid firstIndex"),f(u,h),f(c,l),f(0,u)):((0,C.vA)(u>=c&&u<=l,"invalid firstIndex"),f(u,l),f(0,h),f(c,u))):h>c?f(c,h):h<c&&(f(0,h),f(c,l)),o.bindVAO(null)}};function ut(t,e,i){const r=t.allocateHead();!function(t,e,i,r){(0,ot.Vk)(t.modelOrigin,e,i.modelOriginHi,i.modelOriginLo,r),i.model.copyFrom(r,t.model,e),i.modelNormal.copyFrom(r,t.modelNormal,e),t.color&&i.color&&i.color.copyFrom(r,t.color,e),t.objectAndLayerIdColor&&i.objectAndLayerIdColor&&i.objectAndLayerIdColor.copyFrom(r,t.objectAndLayerIdColor,e),t.featureAttribute&&i.featureAttribute&&i.featureAttribute.copyFrom(r,t.featureAttribute,e)}(e,i,t.view,r)}(0,r._)([(0,h.MZ)({constructOnly:!0})],ct.prototype,"symbol",void 0),(0,r._)([(0,h.MZ)({constructOnly:!0})],ct.prototype,"optionalFields",void 0),(0,r._)([(0,h.MZ)({constructOnly:!0})],ct.prototype,"metadata",void 0),(0,r._)([(0,h.MZ)({constructOnly:!0})],ct.prototype,"shaderTransformation",void 0),(0,r._)([(0,h.MZ)()],ct.prototype,"_instanceData",void 0),(0,r._)([(0,h.MZ)()],ct.prototype,"_cycleStartIndex",void 0),(0,r._)([(0,h.MZ)({readOnly:!0})],ct.prototype,"_enableLevelSelection",null),(0,r._)([(0,h.MZ)()],ct.prototype,"_updateCyclesWithStaticCamera",void 0),(0,r._)([(0,h.MZ)({readOnly:!0})],ct.prototype,"running",null),ct=(0,r._)([(0,c.$)("esri.views.3d.webgl-engine.lib.lodRendering.LodRenderer")],ct);const dt=(0,f.vt)(),ft=(0,p.vt)(),pt=(0,u.vt)(),mt=(0,f.vt)(),gt=(0,f.vt)(),_t=[(0,p.fA)(1,0,1,1),(0,p.fA)(0,0,1,1),(0,p.fA)(0,1,0,1),(0,p.fA)(1,1,0,1),(0,p.fA)(1,0,0,1)],yt=new at.V},57701:function(t,e,i){i.d(e,{$T:function(){return a},zj:function(){return s}});var r,s,n,o=i(23545);function a(t){const e=new Map,i=t=>{let i=e.get(t);return i||(i=new o.a0,e.set(t,i)),i};return t.removes.forAll((t=>{l(t)&&i(t.material).removes.push(t)})),t.adds.forAll((t=>{l(t)&&i(t.material).adds.push(t)})),t.updates.forAll((t=>{l(t.renderGeometry)&&i(t.renderGeometry.material).updates.push(t)})),e}function l(t){return t.geometry.indexCount>=1}(n=r||(r={}))[n.Default=0]="Default",n[n.Screenshot=1]="Screenshot",n[n.ObjectAndLayerID=2]="ObjectAndLayerID",function(t){t[t.TOP=0]="TOP",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.LEFT=3]="LEFT"}(s||(s={}))},48042:function(t,e,i){i.d(e,{v:function(){return I}});var r=i(41546),s=i(65856),n=i(27264),o=i(28686),a=i(39534),l=i(54407),h=i(4875),c=i(46921),u=i(29165),d=i(65839),f=i(84264),p=i(27291),m=i(77971),g=i(34615),_=i(82273),y=i(54840),v=i(6200),x=i(38474),b=i(85456),w=i(57087);m.S;class P extends _.w{constructor(t,e,r){super(t,e,new g.$(x.C,(()=>i.e(2523).then(i.bind(i,62970)))),r)}_createPipeline(t,e){const{oitPass:i,output:r,transparent:s,cullFace:o,draped:a,hasOccludees:l,polygonOffset:h,enableOffset:u}=t,d=i===y.Y.NONE,f=i===y.Y.FrontFace;return(0,w.Ey)({blending:r===n.V.Color&&s?(0,c.Yf)(i):null,culling:(0,w.Xt)(o),depthTest:a?null:{func:(0,c.K_)(i)},depthWrite:(0,c.z5)(t),drawBuffers:r===n.V.Depth?{buffers:[b.Hr.NONE]}:(0,c.m6)(i,r),colorWrite:w.kn,stencilWrite:l?v.v0:null,stencilTest:l?e?v.a9:v.qh:null,polygonOffset:d||f?h?S:null:(0,c.aB)(u)})}initializePipeline(t){return this._occludeePipelineState=this._createPipeline(t,!0),this._createPipeline(t,!1)}getPipeline(t){return t?this._occludeePipelineState:super.getPipeline()}}const S={factor:1,units:1};var C=i(53804),T=i(2457),M=i(38130),A=i(65875),R=i(22095);class O extends R.E{constructor(){super(...arguments),this.cullFace=l.s2.None,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.discardInvisibleFragments=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.objectAndLayerIdColorInstanced=!1,this.vvColor=!1,this.draped=!1,this.textureCoordinateType=T.I.None,this.emissionSource=M.ZX.None,this.occlusionPass=!1,this.hasVvInstancing=!0,this.vvSize=!1,this.vvOpacity=!1}}(0,C._)([(0,A.W)({count:l.s2.COUNT})],O.prototype,"cullFace",void 0),(0,C._)([(0,A.W)()],O.prototype,"hasSlicePlane",void 0),(0,C._)([(0,A.W)()],O.prototype,"hasVertexColors",void 0),(0,C._)([(0,A.W)()],O.prototype,"transparent",void 0),(0,C._)([(0,A.W)()],O.prototype,"discardInvisibleFragments",void 0),(0,C._)([(0,A.W)()],O.prototype,"polygonOffset",void 0),(0,C._)([(0,A.W)()],O.prototype,"enableOffset",void 0),(0,C._)([(0,A.W)()],O.prototype,"writeDepth",void 0),(0,C._)([(0,A.W)()],O.prototype,"hasOccludees",void 0),(0,C._)([(0,A.W)()],O.prototype,"terrainDepthTest",void 0),(0,C._)([(0,A.W)()],O.prototype,"cullAboveTerrain",void 0),(0,C._)([(0,A.W)()],O.prototype,"objectAndLayerIdColorInstanced",void 0),(0,C._)([(0,A.W)()],O.prototype,"vvColor",void 0),(0,C._)([(0,A.W)()],O.prototype,"draped",void 0);class I extends p.W{constructor(t){super(t,L),this._configuration=new O,this.supportsEdges=!0,this.produces=new Map([[u.N.OPAQUE_MATERIAL,t=>this._isOpaqueMaterialPass(t)],[u.N.OPAQUE_MATERIAL_WITHOUT_NORMALS,t=>this._isOpaqueNoSSAODepthPass(t)],[u.N.TRANSPARENT_MATERIAL,t=>(0,n.zW)(t)&&this._transparent&&this.parameters.writeDepth],[u.N.TRANSPARENT_MATERIAL_WITHOUT_NORMALS,t=>(0,n.eh)(t)&&this._transparent&&this.parameters.writeDepth],[u.N.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,t=>(0,n.zW)(t)&&this._transparent&&!this.parameters.writeDepth],[u.N.DRAPED_MATERIAL,t=>(0,n.i3)(t)]])}getConfiguration(t,e){return this._configuration.output=t,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this._transparent,this._configuration.discardInvisibleFragments=this._transparent&&!this._isOpaquePass(t)&&this.parameters.discardInvisibleFragments,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=e.hasOccludees,this._configuration.oitPass=e.oitPass,this._configuration.enableOffset=e.camera.relativeElevation<c.xt,this._configuration.terrainDepthTest=e.terrainDepthTest,this._configuration.cullAboveTerrain=e.cullAboveTerrain,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.draped=this.parameters.draped,this._configuration}get visible(){return this.parameters.color[3]>=o.Q}get _transparent(){return this.parameters.color[3]<1||this.parameters.forceTransparentMode}_isOpaquePass(t){return this._isOpaqueMaterialPass(t)||this._isOpaqueNoSSAODepthPass(t)}_isOpaqueMaterialPass(t){return t===n.V.Highlight||(0,n.zW)(t)&&!this._transparent}_isOpaqueNoSSAODepthPass(t){return(0,n.eh)(t)&&this.parameters.writeDepth&&!this._transparent}createGLMaterial(t){return new E(t)}createBufferWriter(){const t=(0,s.BP)().vec3f(d.r.POSITION);return(0,a.E)()&&t.vec4u8(d.r.OBJECTANDLAYERIDCOLOR),this.parameters.vvColor?t.f32(d.r.COLORFEATUREATTRIBUTE):t.vec4u8(d.r.COLOR),new f.Z(t)}}class E extends h.A{beginSlot(t){return this.acquireTechnique(P,t)}}class L extends m.S{constructor(){super(...arguments),this.color=r.uY,this.forceTransparentMode=!1,this.writeDepth=!0,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=l.s2.None,this.draped=!1,this.discardInvisibleFragments=!1}}},73318:function(t,e,i){i.d(e,{Ci:function(){return n},Dq:function(){return l},dB:function(){return a},zK:function(){return o}});var r=i(65856),s=i(65839);const n=(0,r.BP)().vec3f(s.r.POSITION),o=(0,r.BP)().vec3f(s.r.POSITION).vec2f(s.r.UV0),a=(0,r.BP)().vec3f(s.r.POSITION).vec4u8(s.r.COLOR),l=(0,r.BP)().vec3f(s.r.POSITION).vec2f(s.r.UV0).vec4u8(s.r.OBJECTANDLAYERIDCOLOR)},12474:function(t,e,i){i.d(e,{T:function(){return r}});const r=2.1},51564:function(t,e,i){i.d(e,{P:function(){return n}});var r=i(32501),s=i(94211);class n extends s.gy{constructor(t=(0,r.vt)()){super(),this.origin=t}get slicePlaneLocalOrigin(){return this.origin}}},6955:function(t,e,i){i.d(e,{R:function(){return $}});var r=i(15774),s=i(44705),n=i(87725),o=i(73364),a=i(39714),l=i(13786),h=i(1932),c=i(20551),u=i(32501),d=i(41546);var f=i(87416),p=i(92754),m=i(24129),g=i(70974),_=i(65856),y=i(27264),v=i(1143),x=i(28686),b=i(39534),w=i(36634),P=i(24100),S=i(29165),C=i(54035),T=i(90553),M=i(65839);class A{constructor(){this.scale=0,this.factor=0,this.minScaleFactor=0}}var R=i(93678),O=i(84887),I=i(88008),E=i(34615),L=i(82273),D=i(54840),z=i(46921),N=i(85456),F=i(57087);class k extends L.w{constructor(t,e,r){super(t,e,new E.$(I.H,(()=>i.e(8121).then(i.bind(i,47416)))),r),this.primitiveType=e.occlusionPass?N.WR.POINTS:N.WR.TRIANGLES}initializePipeline(t){const{oitPass:e,hasPolygonOffset:i,draped:r,output:s,depthTestEnabled:n}=t,o=e===D.Y.NONE,a=i?V:null,l=e===D.Y.ColorAlpha,h=r||!n||l||s===y.V.Highlight?null:F.Uy;return(0,F.Ey)({blending:s===y.V.Color?o?F.Os:(0,z.ez)(e):null,depthTest:n&&!r?{func:N.MT.LEQUAL}:null,depthWrite:h,drawBuffers:(0,z.m6)(e,s),colorWrite:F.kn,polygonOffset:a})}}const V={factor:0,units:-4};var B=i(53804),U=i(2457),G=i(38130),H=i(65875),W=i(22095);class j extends W.E{constructor(t){super(),this.spherical=t,this.screenCenterOffsetUnitsEnabled=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.hasRotation=!1,this.debugDrawLabelBorder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthTestEnabled=!0,this.pixelSnappingEnabled=!0,this.draped=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.occlusionPass=!1,this.occludedFragmentFade=!1,this.objectAndLayerIdColorInstanced=!1,this.horizonCullingEnabled=!0,this.textureCoordinateType=U.I.None,this.emissionSource=G.ZX.None,this.discardInvisibleFragments=!0,this.hasSliceInVertexProgram=!0,this.hasVvInstancing=!1}}(0,B._)([(0,H.W)()],j.prototype,"screenCenterOffsetUnitsEnabled",void 0),(0,B._)([(0,H.W)()],j.prototype,"occlusionTestEnabled",void 0),(0,B._)([(0,H.W)()],j.prototype,"signedDistanceFieldEnabled",void 0),(0,B._)([(0,H.W)()],j.prototype,"sampleSignedDistanceFieldTexelCenter",void 0),(0,B._)([(0,H.W)()],j.prototype,"vvSize",void 0),(0,B._)([(0,H.W)()],j.prototype,"vvColor",void 0),(0,B._)([(0,H.W)()],j.prototype,"hasVerticalOffset",void 0),(0,B._)([(0,H.W)()],j.prototype,"hasScreenSizePerspective",void 0),(0,B._)([(0,H.W)()],j.prototype,"hasRotation",void 0),(0,B._)([(0,H.W)()],j.prototype,"debugDrawLabelBorder",void 0),(0,B._)([(0,H.W)()],j.prototype,"hasSlicePlane",void 0),(0,B._)([(0,H.W)()],j.prototype,"hasPolygonOffset",void 0),(0,B._)([(0,H.W)()],j.prototype,"depthTestEnabled",void 0),(0,B._)([(0,H.W)()],j.prototype,"pixelSnappingEnabled",void 0),(0,B._)([(0,H.W)()],j.prototype,"draped",void 0),(0,B._)([(0,H.W)()],j.prototype,"terrainDepthTest",void 0),(0,B._)([(0,H.W)()],j.prototype,"cullAboveTerrain",void 0),(0,B._)([(0,H.W)()],j.prototype,"occlusionPass",void 0),(0,B._)([(0,H.W)()],j.prototype,"occludedFragmentFade",void 0),(0,B._)([(0,H.W)()],j.prototype,"objectAndLayerIdColorInstanced",void 0),(0,B._)([(0,H.W)()],j.prototype,"horizonCullingEnabled",void 0);class $ extends P.im{constructor(t,e){super(t,mt),this.produces=new Map([[S.N.HUD_MATERIAL,t=>(0,y.dX)(t)&&!this.parameters.drawInSecondSlot],[S.N.LABEL_MATERIAL,t=>(0,y.dX)(t)&&this.parameters.drawInSecondSlot],[S.N.OCCLUSION_PIXELS,()=>this.parameters.occlusionTest],[S.N.DRAPED_MATERIAL,t=>this.parameters.draped&&(0,y.dX)(t)]]),this._visible=!0,this._configuration=new j(e)}getConfiguration(t,e){return this._configuration.output=t,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits,this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.draped=this.parameters.draped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.sampleSignedDistanceFieldTexelCenter=this.parameters.sampleSignedDistanceFieldTexelCenter,this._configuration.hasRotation=this.parameters.hasRotation,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.occlusionPass=e.slot===S.N.OCCLUSION_PIXELS,this._configuration.occludedFragmentFade=this.parameters.occludedFragmentFade,this._configuration.horizonCullingEnabled=this.parameters.horizonCullingEnabled,this._configuration.depthTestEnabled=this.parameters.depthEnabled||e.slot===S.N.OCCLUSION_PIXELS,t===y.V.Color&&(this._configuration.debugDrawLabelBorder=!!g.b.LABELS_SHOW_BORDER),this._configuration.oitPass=e.oitPass,this._configuration.terrainDepthTest=e.terrainDepthTest,this._configuration.cullAboveTerrain=e.cullAboveTerrain,this._configuration}intersect(t,e,i,r,n,a){const{options:{selectionMode:l,hud:h,excludeLabels:d},point:f,camera:p}=i,{parameters:m}=this;if(!l||!h||d&&m.isLabel||!t.visible||!f)return;const{scaleX:g,scaleY:_}=this._getScreenScale(t,p.pixelRatio);(0,s.z0)(st,e),t.attributes.has(M.r.FEATUREATTRIBUTE)&&function(t){const e=t[0],i=t[1],r=t[2],s=t[3],n=t[4],o=t[5],a=t[6],l=t[7],h=t[8],c=1/Math.sqrt(e*e+i*i+r*r),u=1/Math.sqrt(s*s+n*n+o*o),d=1/Math.sqrt(a*a+l*l+h*h);t[0]=e*c,t[1]=i*c,t[2]=r*c,t[3]=s*u,t[4]=n*u,t[5]=o*u,t[6]=a*d,t[7]=l*d,t[8]=h*d}(st);const y=t.attributes.get(M.r.POSITION),v=t.attributes.get(M.r.SIZE),x=t.attributes.get(M.r.NORMAL),b=t.attributes.get(M.r.ROTATION),w=t.attributes.get(M.r.CENTEROFFSETANDDISTANCE);(0,T.vA)(y.size>=3);const P=(0,I.c)(m),S="screen"===this.parameters.centerOffsetUnits;for(let t=0;t<y.data.length/y.size;t++){const r=t*y.size;(0,c.i)(Q,y.data[r],y.data[r+1],y.data[r+2]),(0,c.t)(Q,Q,e),(0,c.t)(Q,Q,p.viewMatrix);const s=t*w.size;if((0,c.i)(at,w.data[s],w.data[s+1],w.data[s+2]),!S&&(Q[0]+=at[0],Q[1]+=at[1],0!==at[2])){const t=at[2];(0,c.n)(at,Q),(0,c.d)(Q,Q,(0,c.h)(at,at,t))}const n=t*x.size;if((0,c.i)(J,x.data[n],x.data[n+1],x.data[n+2]),q(J,st,p,ct),this._applyVerticalOffsetTransformationView(Q,ct,p,X),p.applyProjection(Q,K),K[0]>-1){S&&(at[0]||at[1])&&(K[0]+=at[0]*p.pixelRatio,0!==at[1]&&(K[1]+=(0,C.m0)(at[1],X.factorAlignment)*p.pixelRatio),p.unapplyProjection(K,Q)),K[0]+=this.parameters.screenOffset[0]*p.pixelRatio,K[1]+=this.parameters.screenOffset[1]*p.pixelRatio,K[0]=Math.floor(K[0]),K[1]=Math.floor(K[1]);const e=t*v.size;ft[0]=v.data[e],ft[1]=v.data[e+1],(0,C.MD)(ft,X.factor,ft);const r=ut*p.pixelRatio;let s=0;m.textureIsSignedDistanceField&&(s=Math.min(m.outlineSize,.5*ft[0])*p.pixelRatio/2),ft[0]*=g,ft[1]*=_;const n=t*b.size,l=m.rotation+b.data[n];if(Y(f,K[0],K[1],ft,r,s,l,m,P)){const t=i.ray;if((0,c.t)(et,Q,(0,o.B8)(ot,p.viewMatrix)),K[0]=f[0],K[1]=f[1],p.unprojectFromRenderScreen(K,Q)){const e=(0,u.vt)();(0,c.c)(e,t.direction);const i=1/(0,c.l)(e);(0,c.h)(e,e,i),a((0,c.j)(t.origin,Q)*i,e,-1,!0,1,et)}}}}}intersectDraped(t,e,i,r,s,n){const o=t.attributes.get(M.r.POSITION),a=t.attributes.get(M.r.SIZE),l=t.attributes.get(M.r.ROTATION),h=this.parameters,c=(0,I.c)(h),{scaleX:u,scaleY:d}=this._getScreenScale(t,t.screenToWorldRatio),f=dt*t.screenToWorldRatio;for(let e=0;e<o.data.length/o.size;e++){const i=e*o.size,p=o.data[i],m=o.data[i+1],g=e*a.size;ft[0]=a.data[g],ft[1]=a.data[g+1];let _=0;h.textureIsSignedDistanceField&&(_=Math.min(h.outlineSize,.5*ft[0])*t.screenToWorldRatio/2),ft[0]*=u,ft[1]*=d;const y=e*l.size,v=h.rotation+l.data[y];Y(r,p,m,ft,f,_,v,h,c)&&s(n.dist,n.normal,-1,!1)}}createBufferWriter(){return new yt}_updateScaleInfo(t,e,i){const r=this.parameters;null!=r.screenSizePerspective?(0,C.cJ)(i,e,r.screenSizePerspective,t.factor):(t.factor.scale=1,t.factor.factor=0,t.factor.minScaleFactor=0),null!=r.screenSizePerspectiveAlignment?(0,C.cJ)(i,e,r.screenSizePerspectiveAlignment,t.factorAlignment):(t.factorAlignment.factor=t.factor.factor,t.factorAlignment.scale=t.factor.scale,t.factorAlignment.minScaleFactor=t.factor.minScaleFactor)}applyShaderOffsetsView(t,e,i,r,s,n,o){const a=q(e,i,s,ct);return this._applyVerticalGroundOffsetView(t,a,s,o),this._applyVerticalOffsetTransformationView(o,a,s,n),this._applyPolygonOffsetView(o,a,r[3],s,o),this._applyCenterOffsetView(o,r,o),o}applyShaderOffsetsNDC(t,e,i,r,s){return this._applyCenterOffsetNDC(t,e,i,r),null!=s&&(0,c.c)(s,r),this._applyPolygonOffsetNDC(r,e,i,r),r}_applyPolygonOffsetView(t,e,i,s,n){const o=s.aboveGround?1:-1;let a=Math.sign(i);0===a&&(a=o);const l=o*a;if(this.parameters.shaderPolygonOffset<=0)return(0,c.c)(n,t);const h=(0,r.qE)(Math.abs(e.cosAngle),.01,1),u=1-Math.sqrt(1-h*h)/h/s.viewport[2];return(0,c.h)(n,t,l>0?u:1/u),n}_applyVerticalGroundOffsetView(t,e,i,r){const s=(0,c.l)(t),n=i.aboveGround?1:-1,o=i.computeRenderPixelSizeAtDist(s)*v.R,a=(0,c.h)(Q,e.normal,n*o);return(0,c.g)(r,t,a),r}_applyVerticalOffsetTransformationView(t,e,i,r){const s=this.parameters;if(!s.verticalOffset?.screenLength){if(s.screenSizePerspective||s.screenSizePerspectiveAlignment){const i=(0,c.l)(t);this._updateScaleInfo(r,i,e.cosAngle)}else r.factor.scale=1,r.factorAlignment.scale=1;return t}const n=(0,c.l)(t),o=s.screenSizePerspectiveAlignment??s.screenSizePerspective,a=(0,O.kE)(i,n,s.verticalOffset,e.cosAngle,o);return this._updateScaleInfo(r,n,e.cosAngle),(0,c.h)(e.normal,e.normal,a),(0,c.g)(t,t,e.normal)}_applyCenterOffsetView(t,e,i){const r="screen"!==this.parameters.centerOffsetUnits;return i!==t&&(0,c.c)(i,t),r&&(i[0]+=e[0],i[1]+=e[1],e[2]&&((0,c.n)(J,i),(0,c.g)(i,i,(0,c.h)(J,J,e[2])))),i}_applyCenterOffsetNDC(t,e,i,r){const s="screen"!==this.parameters.centerOffsetUnits;return r!==t&&(0,c.c)(r,t),s||(r[0]+=e[0]/i.fullWidth*2,r[1]+=e[1]/i.fullHeight*2),r}_applyPolygonOffsetNDC(t,e,i,r){const s=this.parameters.shaderPolygonOffset;if(t!==r&&(0,c.c)(r,t),s){const t=i.aboveGround?1:-1,n=t*Math.sign(e[3]);r[2]-=(n||t)*s}return r}set visible(t){this._visible=t}get visible(){const{color:t,outlineSize:e,outlineColor:i}=this.parameters,r=t[3]>=x.Q||e>=x.Q&&i[3]>=x.Q;return this._visible&&r}createGLMaterial(t){return new Z(t)}calculateRelativeScreenBounds(t,e,i=(0,f.vt)()){return function(t,e,i,r){r[0]=t.anchorPosition[0]*-e[0]+t.screenOffset[0]*i,r[1]=t.anchorPosition[1]*-e[1]+t.screenOffset[1]*i}(this.parameters,t,e,i),i[2]=i[0]+t[0],i[3]=i[1]+t[1],i}_getScreenScale(t,e){const i=t.attributes.get(M.r.FEATUREATTRIBUTE);if(null==i)return{scaleX:e,scaleY:e};const r=(0,d.ci)(i.data,ht);return(0,m.VC)(lt,this.parameters,r),{scaleX:lt[0]*e,scaleY:lt[1]*e}}}class Z extends w.m8{constructor(t){super({...t,...t.material.parameters})}beginSlot(t){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.acquireTechnique(k,t)}}function q(t,e,i,r){return function(t){return(e=t)instanceof Float32Array&&e.length>=16||function(t){return Array.isArray(t)&&t.length>=16}(t);var e}(e)&&(e=(0,s.z0)(nt,e)),(0,c.q)(r.normal,t,e),(0,c.t)(r.normal,r.normal,i.viewInverseTransposeMatrix),r.cosAngle=(0,c.f)(tt,pt),r}function Y(t,e,i,s,n,o,a,h,c){let u=e-n-s[0]*c[0],d=u+s[0]+2*n,f=i-n-s[1]*c[1],p=f+s[1]+2*n;const m=h.distanceFieldBoundingBox;return h.textureIsSignedDistanceField&&null!=m&&(u+=s[0]*m[0],f+=s[1]*m[1],d-=s[0]*(1-m[2]),p-=s[1]*(1-m[3]),u-=o,d+=o,f-=o,p+=o),(0,l.hZ)(rt,e,i),(0,l.e$)(it,t,rt,(0,r.kU)(a)),it[0]>u&&it[0]<d&&it[1]>f&&it[1]<p}const X=new class{constructor(){this.factor=new A,this.factorAlignment=new A}},Q=(0,u.vt)(),J=(0,u.vt)(),K=(0,d.vt)(),tt=(0,u.vt)(),et=(0,u.vt)(),it=(0,h.vt)(),rt=(0,h.vt)(),st=(0,n.vt)(),nt=(0,n.vt)(),ot=(0,a.vt)(),at=(0,u.vt)(),lt=(0,u.vt)(),ht=(0,d.vt)(),ct={normal:tt,cosAngle:0},ut=1,dt=2,ft=[0,0],pt=(0,u.fA)(0,0,1);class mt extends w.NV{constructor(){super(...arguments),this.renderOccluded=P.m$.Occlude,this.isDecoration=!1,this.color=(0,d.CN)(1,1,1,1),this.polygonOffset=!1,this.anchorPosition=(0,h.fA)(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.outlineColor=(0,d.CN)(1,1,1,1),this.outlineSize=0,this.rotation=0,this.hasRotation=!1,this.vvSizeEnabled=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.occludedFragmentFade=!1,this.horizonCullingEnabled=!1,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.draped=!1,this.isLabel=!1}}const gt=(0,_.BP)().vec3f(M.r.POSITION).vec3f(M.r.NORMAL).vec2f(M.r.UV0).vec4u8(M.r.COLOR).vec2f(M.r.SIZE).f32(M.r.ROTATION).vec4f(M.r.CENTEROFFSETANDDISTANCE).vec4f(M.r.FEATUREATTRIBUTE),_t=gt.clone().vec4u8(M.r.OBJECTANDLAYERIDCOLOR);class yt{constructor(){this.vertexBufferLayout=(0,b.E)()?_t:gt}elementCount(t){return 6*t.get(M.r.POSITION).indices.length}write(t,e,i,r,s,n){(0,R.Hk)(i.get(M.r.POSITION),t,s.position,n,6),(0,R.p1)(i.get(M.r.NORMAL),e,s.normal,n,6);const o=i.get(M.r.UV0)?.data;let a=0,l=0,h=1,c=1;o&&o.length>=4&&(a=o[0],l=o[1],h=o[2],c=o[3]),h=Math.min(1.99999,h+1),c=Math.min(1.99999,c+1);let u=i.get(M.r.POSITION).indices.length,d=n;const f=s.uv0;for(let t=0;t<u;++t)f.set(d,0,a),f.set(d,1,l),d++,f.set(d,0,h),f.set(d,1,l),d++,f.set(d,0,h),f.set(d,1,c),d++,f.set(d,0,h),f.set(d,1,c),d++,f.set(d,0,a),f.set(d,1,c),d++,f.set(d,0,a),f.set(d,1,l),d++;(0,R.tb)(i.get(M.r.COLOR),4,s.color,n,6);const{data:m,indices:g}=i.get(M.r.SIZE);u=g.length;const _=s.size;d=n;for(let t=0;t<u;++t){const e=m[2*g[t]],i=m[2*g[t]+1];for(let t=0;t<6;++t)_.set(d,0,e),_.set(d,1,i),d++}if((0,R.uO)(i.get(M.r.ROTATION),s.rotation,n,6),i.get(M.r.CENTEROFFSETANDDISTANCE)?(0,R.Ut)(i.get(M.r.CENTEROFFSETANDDISTANCE),s.centerOffsetAndDistance,n,6):(0,R.Pq)(s.centerOffsetAndDistance,n,6*u),i.get(M.r.FEATUREATTRIBUTE)?(0,R.Ut)(i.get(M.r.FEATUREATTRIBUTE),s.featureAttribute,n,6):(0,R.Pq)(s.featureAttribute,n,6*u),null!=r){const t=i.get(M.r.POSITION)?.indices;if(t){const e=t.length,i=s.getField(M.r.OBJECTANDLAYERIDCOLOR,p.XP);(0,R.tH)(r,i,e,n,6)}}}}},67721:function(t,e,i){var r;i.d(e,{O:function(){return r}}),function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical",t[t.Cross=2]="Cross",t[t.ForwardDiagonal=3]="ForwardDiagonal",t[t.BackwardDiagonal=4]="BackwardDiagonal",t[t.DiagonalCross=5]="DiagonalCross",t[t.COUNT=6]="COUNT"}(r||(r={}))},27291:function(t,e,i){i.d(e,{W:function(){return n}});var r=i(24100),s=i(45079);class n extends r.im{intersect(t,e,i,r,n,o){return(0,s.Uy)(t,i,r,n,void 0,o)}}},20794:function(t,e,i){i.d(e,{Xq:function(){return a},wk:function(){return o}});const r={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},s={dash:r.dash,"dash-dot":[...r.dash,...r.dot],dot:r.dot,"long-dash":r["long-dash"],"long-dash-dot":[...r["long-dash"],...r.dot],"long-dash-dot-dot":[...r["long-dash"],...r.dot,...r.dot],none:null,"short-dash":r["short-dash"],"short-dash-dot":[...r["short-dash"],...r["short-dot"]],"short-dash-dot-dot":[...r["short-dash"],...r["short-dot"],...r["short-dot"]],"short-dot":r["short-dot"],solid:null},n=8;function o(t){return{pattern:[t,t],pixelRatio:2}}function a(t){return"style"===t?.type?function(t){return null!=t?function(t,e){return null==t?t:{pattern:t.slice(),pixelRatio:e}}(s[t],n):null}(t.style):null}},26347:function(t,e,i){i.d(e,{y:function(){return O},N:function(){return H}});var r=i(53804),s=i(50659),n=(i(58941),i(15774)),o=i(95929),a=i(7970),l=i(7187),h=i(17660),c=i(23502),u=(i(40633),i(65953)),d=i(73364),f=i(39714),p=i(69550),m=i(27264),g=i(67521),_=i(52798),y=i(96253),v=i(29165),x=i(90553),b=i(51564);class w{constructor(t=0,e=0){this.from=t,this.to=e}get numElements(){return this.to-this.from}}function P(t){const e=new Map;t.forAll((t=>e.set(t.from,t)));let i=!0;for(;i;){i=!1;for(let r=0;r<t.length;++r){const s=t.data[r],n=e.get(s.to);if(!n)return;s.to=n.to,e.delete(n.from),t.removeUnordered(n),i=!0}}}class S extends w{constructor(t,e,i){super(e,i),this.geometry=t}get isVisible(){return this.geometry.visible}get hasHighlights(){return this.isVisible&&this.geometry.hasHighlights}foreachHighlightGroup(t){this.isVisible&&this.geometry.foreachHighlightGroup(t)}get hasOccludees(){return null!=this.geometry.occludees}}class C{constructor(){this.first=0,this.count=0}}class T{constructor(){this._numElements=0,this._instances=new Map,this.holes=new l.A({allocator:t=>t||new w,deallocator:null}),this.hasHiddenInstances=!1,this.hasOccludees=!1,this.drawCommandsDirty=!0,this.highlightGroups=new Set,this.drawCommandsDefault=M(),this.drawCommandsHighlights=new Map,this.drawCommandsOccludees=M(),this.drawCommandsShadowHighlightRest=M()}get numElements(){return this._numElements}get instances(){return this._instances}get hasHighlights(){return this.highlightGroups.size>0}resetInstanceSummary(){this.hasHiddenInstances=!1,this.hasOccludees=!1,this.highlightGroups.clear()}updateIfDrawCommandsDirty(t){if(this.drawCommandsDirty){this.resetInstanceSummary();for(const t of this.instances.values())this.updateDrawState(t);this.updateDrawCommands(t)}}addInstance(t,e){this.deleteInstance(t),this._instances.set(t,e),this._numElements+=e.numElements}deleteInstance(t){const e=this._instances.get(t);e&&(this._numElements-=e.numElements,this._instances.delete(t))}updateInstance(t,e,i){const r=this._instances.get(t);r&&(this._numElements-=r.numElements,r.from=e,r.to=i,this._numElements+=r.numElements)}updateDrawState(t){t.isVisible?(t.foreachHighlightGroup((t=>this.highlightGroups.add(t))),t.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0}updateDrawCommands(t){if(this.drawCommandsDefault.clear(),this.drawCommandsHighlights.clear(),this.drawCommandsOccludees.clear(),this.drawCommandsShadowHighlightRest.clear(),this.drawCommandsDirty=!1,0===this._instances.size)return;if(!this.needsMultipleCommands()){const e=this.drawCommandsDefault.pushNew(),i=this.holes.front();return null!=this.vao&&1===this.holes.length&&i.to===Math.floor(this.vao.byteSize/t)?(e.first=0,void(e.count=i.from)):(e.first=1/0,e.count=0,this._instances.forEach((t=>{e.first=Math.min(e.first,t.from),e.count=Math.max(e.count,t.to)})),void(e.count-=e.first))}const e=Array.from(this._instances.values()).sort(((t,e)=>t.from===e.from?t.to-e.to:t.from-e.from)),{drawCommandsHighlights:i}=this;for(const t of e)t.isVisible&&(A(t.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,t),t.hasHighlights?t.foreachHighlightGroup((e=>{let r=i.get(e);r||(r=M(),i.set(e,r)),A(r,t)})):A(this.drawCommandsShadowHighlightRest,t))}needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}}function M(){return new l.A({allocator:t=>t||new C,deallocator:t=>t})}function A(t,e){const i=t.back();if(null==i){const i=t.pushNew();return i.first=e.from,void(i.count=e.numElements)}if(function(t,e){return t.first+t.count>=e.from}(i,e)){const t=e.from-i.first+e.numElements;i.count=t}else{const i=t.pushNew();i.first=e.from,i.count=e.numElements}}class R{constructor(t){this.origin=t,this.buffers=new Array}dispose(){this.buffers.forEach((t=>t.vao.dispose())),this.buffers.length=0}findBuffer(t){return this.buffers.find((e=>e.instances.has(t)))}}let O=class extends g.RW{get _hasAnyHighlight(){return this._highlightGroups.size>0}constructor(t){super(t),this._dataByOrigin=new Map,this._drawParameters=new b.P,this._highlightGroups=new Set,this.drapedPriority=0,this._produces=new Map,this._hasOccludees=!1}destroy(){this._glMaterials=(0,o.WD)(this._glMaterials),this._dataByOrigin.forEach((t=>t.dispose())),this._dataByOrigin.clear(),this._vaoCache=null}initialize(){this.material.produces.forEach(((t,e)=>{this._produces.set(e,(e=>!(0===this._dataByOrigin.size||!(e!==m.V.Highlight&&e!==m.V.ShadowHighlight||this._hasAnyHighlight))&&t(e)))}))}initializeRenderContext(t,e){this._glMaterials=new _.c(this.material,e??t.materials),this._bufferWriter=this.material.createBufferWriter(),this._vaoCache=t.renderContext.rctx.getVaoCache(this.material.vertexAttributeLocations,(0,p.U)(this._bufferWriter.vertexBufferLayout))}uninitializeRenderContext(){}get produces(){return this._produces}get hasOccludees(){return this._hasOccludees}get hasEmissions(){return this.material.hasEmissions}get isDecoration(){return this.material.parameters.isDecoration}queryRenderOccludedState(t){return this.material.queryRenderOccludedState(t)}get numGeometries(){let t=0;return this._dataByOrigin.forEach((e=>t+=e.buffers.reduce(((t,e)=>t+e.instances.size),0))),t}get usedMemory(){let t=0;return this._dataByOrigin.forEach((e=>t+=e.buffers.reduce(((t,e)=>t+e.vao.usedMemory),0))),t}forEachGeometry(t){this._dataByOrigin.forEach((e=>e.buffers.forEach((e=>e.instances.forEach((({geometry:e})=>t(e)))))))}modify(t){this._updateGeometries(t.updates),this._addAndRemoveGeometries(t.adds,t.removes),this._updateDrawCommands()}_updateGeometries(t){const e=this._bufferWriter;if(null==e)return;const i=e.vertexBufferLayout.stride/4;for(const r of t){const t=r.renderGeometry,s=this._dataByOrigin.get(t.localOrigin.id),n=s?.findBuffer(t.id);if(null==n)return;const o=n.instances.get(t.id);if(r.updateType&(y.k.GEOMETRY|y.k.TRANSFORMATION)){const r=G(e.elementCount(o.geometry.geometry.attributes)*i),s=e.vertexBufferLayout.createView(r.buffer);this._writeGeometry(t,s,0),n.vao.vertexBuffers.get("geometry").setSubData(r,o.from*i,0,o.numElements*i)}r.updateType&(y.k.HIGHLIGHT|y.k.OCCLUDEE|y.k.VISIBILITY)&&(n.drawCommandsDirty=!0)}}_computeDeltas(t,e){const i=new a.O;for(const e of t){const t=e.localOrigin;if(null==t)continue;let r=i.get(t.id,null);null==r&&(r=new I(t.vec3),i.set(t.id,null,r)),r.changes.push(e)}for(const t of e){const e=t.localOrigin;if(null==e)continue;const r=this._dataByOrigin.get(e.id),s=r?.findBuffer(t.id);if(null==s)continue;let n=i.get(e.id,s);null==n&&(n=new I(e.vec3),i.set(e.id,s,n)),n.changes.push(t)}return i}_addAndRemoveGeometries(t,e){if(null==this._bufferWriter||null==this._vaoCache)return;const{_bufferWriter:i,_dataByOrigin:r}=this,n=i.vertexBufferLayout.stride/4,o=this._computeDeltas(t,e);o.forEach(((t,e)=>{const a=t.get(null),l=a?.changes??[];o.delete(e,null);let h=r.get(e);if(t.forEach(((t,a)=>{if(o.delete(e,a),null==a)return void(0,x.vA)(!1,"No VAO for removed geometries");if(a.instances.size===t.changes.length)return this._vaoCache.deleteVao(a.vao),(0,s.Xy)(h.buffers,a),void(0===h.buffers.length&&0===l.length&&r.delete(e));const c=a.numElements,u=a.vao.byteSize/4,d=l.reduce(((t,e)=>t+i.elementCount(e.geometry.attributes)),0),f=t.changes.reduce(((t,e)=>t+i.elementCount(e.geometry.attributes)),0),p=Math.min((c+d-f)*n,B),m=p>u;p>N&&p<u/2?(t.changes.forEach((({id:t})=>a.deleteInstance(t))),a.instances.forEach((({geometry:t})=>l.push(t))),this._vaoCache.deleteVao(a.vao),(0,s.Xy)(h.buffers,a)):m?this._applyAndRebuild(a,l,t):this._applyRemoves(a,t)})),l.length>0)for(null==h&&(h=new R(a.origin),r.set(e,h)),h.buffers.forEach((t=>this._applyAdds(t,l)));l.length>0;)h.buffers.push(this._applyAndRebuild(new T,l,null))}))}_updateDrawCommands(){this._highlightGroups.clear(),this._hasOccludees=!1,this._dataByOrigin.forEach((t=>{t.buffers.forEach((t=>{t.updateIfDrawCommandsDirty(this._bufferWriter.vertexBufferLayout.stride),t.hasHighlights&&(0,h.FB)(this._highlightGroups,t.highlightGroups),this._hasOccludees=this._hasOccludees||t.hasOccludees}))}))}_applyAndRebuild(t,e,i){if(i)for(const e of i.changes)t.deleteInstance(e.id);const r=this._bufferWriter,s=r.vertexBufferLayout.stride,n=s/4,o=Math.floor(B/n);let a=t.numElements;for(;e.length>0;){const i=e.pop(),s=r.elementCount(i.geometry.attributes);if(a+s>o&&a>0){e.push(i);break}a+=s;const n=new S(i,0,0);(0,x.vA)(null==t.instances.get(i.id)),t.addInstance(i.id,n)}const l=a*n,h=G(l),c=r.vertexBufferLayout.createView(h.buffer);let u=0;t.resetInstanceSummary(),t.instances.forEach(((e,i)=>{this._writeGeometry(e.geometry,c,u);const s=u;u+=r.elementCount(e.geometry.geometry.attributes),t.updateInstance(i,s,u),t.updateDrawState(e)})),this._vaoCache.deleteVao(t.vao),t.vao=this._vaoCache.newVao(H(l)),t.vao.vertexBuffers.get("geometry").setSubData(h,0,0,u*n),t.holes.clear();const d=t.holes.pushNew();return d.from=u,d.to=Math.floor(t.vao.byteSize/s),t.updateDrawCommands(s),t}_applyRemoves(t,e){if(0===e.changes.length||null==this._bufferWriter)return;for(const i of e.changes){const e=i.id,r=t.instances.get(e);if(!r)continue;t.deleteInstance(e);const s=z.back();if(s){if(s.to===r.from){s.to=r.to;continue}if(s.from===r.to){s.from=r.from;continue}}const n=z.pushNew();n.from=r.from,n.to=r.to}P(z);const i=this._bufferWriter.vertexBufferLayout.stride/4,r=z.reduce(((t,e)=>Math.max(t,e.numElements)),0)*i,s=G(r);s.fill(0,0,r);const n=t.vao.vertexBuffers.get("geometry");z.forAll((t=>n.setSubData(s,t.from*i,0,t.numElements*i))),t.holes.pushArray(z.data,z.length),z.forAll(((t,e)=>z.data[e]=null)),z.clear(),t.drawCommandsDirty=!0}_applyAdds(t,e){if(0===e.length||null==this._bufferWriter)return;if(!function(t){return null!=t.vao}(t))return void this._applyAndRebuild(t,e,null);const i=this._bufferWriter,r=i.vertexBufferLayout.stride/4,n=t.numElements,o=e.reduce(((t,e)=>t+i.elementCount(e.geometry.attributes)),0),a=Math.min((n+o)*r,B),l=4*a;if(t.vao.byteSize<H(B-N)&&l>t.vao.byteSize)return void this._applyAndRebuild(t,e,null);P(t.holes);const h=new Array;for(const r of e){const e=i.elementCount(r.geometry.attributes),s=E(t.holes,e);h.push(s)}const c=t.vao.vertexBuffers.get("geometry");let u=0,d=0,f=0;const p=G(a),m=i.vertexBufferLayout.createView(p.buffer);e.forEach(((e,s)=>{const n=h[s];if(null==n)return;if(f!==n){const t=f-d;t>0&&c.setSubData(p,d*r,0,t*r),d=n,u=0}const o=i.elementCount(e.geometry.attributes);this._writeGeometry(e,m,u),u+=o,f=n+o;const a=new S(e,n,n+o);(0,x.vA)(null==t.instances.get(e.id)),t.addInstance(e.id,a),t.drawCommandsDirty=!0}));const g=f-d;g>0&&c.setSubData(p,d*r,0,g*r),(0,s.$i)(e,((t,e)=>null==h[e]))}_writeGeometry(t,e,i){null!=this._bufferWriter&&((0,d.C)(L,t.transformation),L[12]-=t.localOrigin.vec3[0],L[13]-=t.localOrigin.vec3[1],L[14]-=t.localOrigin.vec3[2],(0,d.B8)(D,L),(0,d.mg)(D,D),this._bufferWriter.write(L,D,t.geometry.attributes,t.geometry.objectAndLayerIdColor,e,i))}updateAnimation(t){return this.material.update(t)}acquireTechniques(t){if(!this.material.shouldRender(t))return null;const{output:e,bind:i}=t,r=this.material.produces.get(i.slot);if(!r?.(e))return null;const{highlightGroupName:s,slot:n}=i,o=e===m.V.ShadowHighlight,a=e===m.V.Highlight,l=a||o,h=t=>l&&(0===this._highlightGroups.size||a&&!!s&&!t.has(s));if(h(this._highlightGroups))return null;const c=e===m.V.ShadowExcludeHighlight,u=!(l||c);for(const{buffers:r}of this._dataByOrigin.values())for(const a of r){if(h(a.highlightGroups))continue;const r=o?a.drawCommandsHighlights.size>0:l?s?a.drawCommandsHighlights.get(s):a.drawCommandsHighlights.size>0:((c&&a.needsMultipleCommands()?a.drawCommandsShadowHighlightRest:a.drawCommandsDefault)||null)?.length??!1,d=u&&a.drawCommandsOccludees||null;if(r||d?.length){const r=this._glMaterials.load(t.rctx,n,e),s=r?.beginSlot(i);if(s)return s}}return null}render(t,e){const{output:i,bind:r}=t,{slot:s,highlightGroupName:n}=r,o=i===m.V.Highlight;if(o&&!n)return;const a=i===m.V.ShadowHighlight,l=o||a,h=i===m.V.ShadowExcludeHighlight,c=!(l||h),u=s===v.N.OCCLUDER_MATERIAL||s===v.N.TRANSPARENT_OCCLUDER_MATERIAL?s:null,{rctx:d}=t;d.runAppleAmdDriverHelper();const f=d.bindTechnique(e,r,this.material.parameters);for(const t of this._dataByOrigin.values())for(const i of t.buffers){if(o&&(!i.hasHighlights||!i.drawCommandsHighlights.has(n)))continue;if(a&&!i.hasHighlights)continue;const s=()=>{const t=[];for(const e of i.drawCommandsHighlights.values())t.push(e);return t},p=l&&!a?i.drawCommandsHighlights.get(n)??null:null,m=a?s():l?p?[p]:W:(h&&i.needsMultipleCommands()?[i.drawCommandsShadowHighlightRest]:[i.drawCommandsDefault])||W,g=m.some((t=>t.length>0)),_=c&&i.drawCommandsOccludees||null;if(g||_?.length){if(this._drawParameters.origin=t.origin,f.bindDraw(r,this.material.parameters,this._drawParameters),e.ensureAttributeLocations(i.vao),d.bindVAO(i.vao),g)for(const t of m)d.setPipelineState(e.getPipeline(!1,u)),t.forAll((t=>d.drawArrays(e.primitiveType,t.first,t.count)));_?.length&&(d.setPipelineState(e.getPipeline(!0,u)),_.forAll((t=>d.drawArrays(e.primitiveType,t.first,t.count))))}}}get test(){}};(0,r._)([(0,c.MZ)({constructOnly:!0})],O.prototype,"material",void 0),O=(0,r._)([(0,u.$)("esri.views.3d.webgl-engine.materials.renderers.MergedRenderer")],O);class I{constructor(t){this.origin=t,this.changes=new Array}}function E(t,e){const i=t.find((t=>t.numElements>=e));if(null==i)return null;const r=i.from;return i.from+=e,i.from>=i.to&&t.removeUnordered(i),r}const L=(0,f.vt)(),D=(0,f.vt)(),z=new l.A({allocator:t=>t||new w,deallocator:null}),N=65536,F=4*N,k=1024,V=16777216,B=V/4;let U=new Float32Array(N);function G(t){return U.length<t&&(U=new Float32Array(t)),U}function H(t){const e=4*t;return e<=k?k:e<F?(0,n.cU)(e):Math.max(Math.min(Math.ceil(1.5*e/F)*F,V),e)}const W=[]},65631:function(t,e,i){i.d(e,{A:function(){return C}});var r,s=i(53804),n=i(83525),o=i(40633),a=i(15774),l=i(13520),h=i(23502),c=(i(58941),i(13798),i(65953)),u=i(73364),d=i(39714),f=i(13786),p=i(1932),m=i(20551),g=i(32501),_=i(33400),y=i(41546),v=i(69508),x=i(79578),b=i(29531),w=i(65420),P=i(57701);let S=r=class extends n.A{constructor(t){super(t),this._ray=(0,x.vt)(),this._viewport=(0,y.fA)(0,0,1,1),this._padding=(0,y.fA)(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=(0,p.fA)(1,1e3),this._viewDirty=!0,this._viewMatrix=(0,d.vt)(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=(0,d.vt)(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=(0,d.vt)(),this._frustumDirty=!0,this._frustum=(0,v.vt)(),this._fullViewport=(0,y.vt)(),this._pixelRatio=1,this.row=0,this.column=0,this._rows=1,this._columns=1,this._center=(0,g.vt)(),this._up=(0,g.vt)(),this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(t){this._pixelRatio=t>0?t:1}get rows(){return this._rows}set rows(t){this._rows=Math.max(1,t)}get columns(){return this._columns}set columns(t){this._columns=Math.max(1,t)}get eye(){return this._ray.origin}set eye(t){this._compareAndSetView(t,this._ray.origin)}get center(){return this._center}set center(t){this._compareAndSetView(t,this._center,"_center")}get ray(){return(0,m.d)(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(t){this._compareAndSetView(t,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(t){(0,u.C)(this._viewMatrix,t),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),(0,m.i)((0,g.vt)(),-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10])}get viewUp(){return this._ensureViewClean(),(0,m.i)((0,g.vt)(),this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9])}get viewRight(){return this._ensureViewClean(),(0,m.i)((0,g.vt)(),this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8])}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(t){this._nearFar[0]!==t&&(this._nearFar[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(t){this._nearFar[1]!==t&&(this._nearFar[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]}get screenViewport(){if(1===this.pixelRatio)return this._viewport;const t=(0,_.d)((0,y.vt)(),this._viewport,1/this.pixelRatio),e=this._get("screenViewport");return e&&(0,_.e)(t,e)?e:t}get screenPadding(){if(1===this.pixelRatio)return this._padding;const t=(0,_.d)((0,y.vt)(),this._padding,1/this.pixelRatio),e=this._get("screenPadding");return e&&(0,_.e)(t,e)?e:t}get x(){return this._viewport[0]}set x(t){t+=this._padding[P.zj.LEFT],this._viewport[0]!==t&&(this._viewport[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(t){t+=this._padding[P.zj.BOTTOM],this._viewport[1]!==t&&(this._viewport[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(t){this._viewport[2]!==t&&(this._viewport[2]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(t){this._viewport[3]!==t&&(this._viewport[3]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[P.zj.RIGHT]+this._padding[P.zj.LEFT]}set fullWidth(t){this.width=t-(this._padding[P.zj.RIGHT]+this._padding[P.zj.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[P.zj.TOP]+this._padding[P.zj.BOTTOM]}set fullHeight(t){this.height=t-(this._padding[P.zj.TOP]+this._padding[P.zj.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[P.zj.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[P.zj.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(t){(0,_.a)(this._padding,t)||(this._viewport[0]+=t[P.zj.LEFT]-this._padding[P.zj.LEFT],this._viewport[1]+=t[P.zj.BOTTOM]-this._padding[P.zj.BOTTOM],this._viewport[2]-=t[P.zj.RIGHT]+t[P.zj.LEFT]-(this._padding[P.zj.RIGHT]+this._padding[P.zj.LEFT]),this._viewport[3]-=t[P.zj.TOP]+t[P.zj.BOTTOM]-(this._padding[P.zj.TOP]+this._padding[P.zj.BOTTOM]),(0,_.c)(this._padding,t),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&((0,u.lw)(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){return this._projectionMatrixInternal}get inverseProjectionMatrix(){return(0,u.B8)((0,d.vt)(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||(0,d.vt)()}get fov(){return this._fov}set fov(t){this._fov=t,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return t=this._fov,e=this.width,i=this.height,2*Math.atan(e*Math.tan(.5*t)/Math.sqrt(e*e+i*i));var t,e,i}set fovX(t){this._fov=function(t,e,i){return 2*Math.atan(Math.sqrt(e*e+i*i)*Math.tan(.5*t)/e)}(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return t=this._fov,e=this.width,i=this.height,2*Math.atan(i*Math.tan(.5*t)/Math.sqrt(e*e+i*i));var t,e,i}set fovY(t){this._fov=function(t,e,i){return 2*Math.atan(Math.sqrt(e*e+i*i)*Math.tan(.5*t)/i)}(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return(0,m.j)(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&((0,u.B8)(this._viewInverseTransposeMatrix,this.viewMatrix),(0,u.mg)(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(t){const e=2*t-1;return 2*this.near*this.far/(this.far+this.near-e*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return null!=this.relativeElevation&&this.relativeElevation>=0}get _projectionMatrixInternal(){const t=this.width,e=this.height,i=this.near*Math.tan(this.fovY/2)*2,r=i*this._aspect,s=i/this.rows,n=r/this.columns,o=-r/2+this.column*n,a=o+n,l=-i/2+this.row*s,h=l+s,c=(0,u.$h)((0,d.vt)(),o*(1+2*this._padding[P.zj.LEFT]/t),a*(1+2*this._padding[P.zj.RIGHT]/t),l*(1+2*this._padding[P.zj.BOTTOM]/e),h*(1+2*this._padding[P.zj.TOP]/e),this.near,this.far),f=this._get("projectionMatrix");return f&&(0,u.aI)(f,c)?f:c}copyFrom(t){(0,m.c)(this._ray.origin,t.eye),this.center=t.center,this.up=t.up,(0,_.c)(this._viewport,t.viewport),this.notifyChange("_viewport"),(0,_.c)(this._padding,t.padding),this.notifyChange("_padding"),(0,f.C)(this._nearFar,t.nearFar),this.notifyChange("_nearFar"),this._fov=t.fov,this.row=t.row,this.column=t.column,this.rows=t.rows,this.columns=t.columns,this.relativeElevation=t.relativeElevation;const e=t;return this._viewDirty=e._viewDirty,this._viewDirty||((0,u.C)(this._viewMatrix,t.viewMatrix),this.notifyChange("_viewMatrix")),this._viewProjectionDirty=!0,this._frustumDirty=e._frustumDirty,this._frustumDirty||((0,v.C)(this._frustum,t.frustum),this._frustumDirty=!1),e._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:((0,u.C)(this._viewInverseTransposeMatrix,t.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),(0,_.c)(this._fullViewport,t.fullViewport),this.pixelRatio=t.pixelRatio,this}copyViewFrom(t){this.eye=t.eye,this.center=t.center,this.up=t.up,this.fov=t.fov}clone(){return(new r).copyFrom(this)}equals(t){return(0,m.p)(this.eye,t.eye)&&(0,m.p)(this.center,t.center)&&(0,m.p)(this.up,t.up)&&(0,_.a)(this._viewport,t.viewport)&&(0,_.a)(this._padding,t.padding)&&(0,f.t2)(this.nearFar,t.nearFar)&&this._fov===t.fov&&this.pixelRatio===t.pixelRatio&&this.relativeElevation===t.relativeElevation&&this.row===t.row&&this.column===t.column&&this.rows===t.rows&&this.columns===t.columns}almostEquals(t){const e=Math.max(1,1/this.pixelRatio,1/t.pixelRatio);if(Math.abs(t.fov-this._fov)>=.001||(0,_.f)(t.screenPadding,this.screenPadding)>=e||(0,_.f)(this.screenViewport,t.screenViewport)>=e||this.row!==t.row||this.column!==t.column||this.rows!==t.rows||this.columns!==t.columns)return!1;(0,m.a)(A,t.eye,t.center),(0,m.a)(R,this.eye,this.center);const i=(0,m.f)(A,R),r=(0,m.z)(A),s=(0,m.z)(R),n=5e-4;return i*i>=(1-1e-10)*r*s&&(0,m.y)(t.eye,this.eye)<Math.max(r,s)*n*n}computeRenderPixelSizeAt(t){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(t))}computeRenderPixelSizeAtDist(t){return t*this.perRenderPixelRatio}computeScreenPixelSizeAt(t){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(t))}_viewDirectionDistance(t){return Math.abs((0,b.gr)(this.viewForward,(0,m.d)(A,t,this.eye)))}computeScreenPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeDistanceFromRadius(t,e){return t/Math.tan(Math.min(this.fovX,this.fovY)/(2*(e||1)))}getScreenCenter(t=(0,l.gs)()){return t[0]=(this.padding[P.zj.LEFT]+this.width/2)/this.pixelRatio,t[1]=(this.padding[P.zj.TOP]+this.height/2)/this.pixelRatio,t}getRenderCenter(t,e=.5,i=.5){return t[0]=this.padding[P.zj.LEFT]+this.width*e,t[1]=this.padding[P.zj.BOTTOM]+this.height*i,t[2]=.5,t}setGLViewport(t){const e=this.viewport,i=this.padding;t.setViewport(e[0]-i[3],e[1]-i[2],e[2]+i[1]+i[3],e[3]+i[0]+i[2])}applyProjection(t,e){t!==T&&(0,m.c)(T,t),T[3]=1,(0,_.t)(T,T,this.projectionMatrix);const i=Math.abs(T[3]);(0,m.h)(T,T,1/i);const r=this.fullViewport;e[0]=(0,a.Cc)(0,r[0]+r[2],.5+.5*T[0]),e[1]=(0,a.Cc)(0,r[1]+r[3],.5+.5*T[1]),e[2]=.5*(T[2]+1),e[3]=i}unapplyProjection(t,e){const i=this.fullViewport;T[0]=(t[0]/(i[0]+i[2])*2-1)*t[3],T[1]=(t[1]/(i[1]+i[3])*2-1)*t[3],T[2]=(2*t[2]-1)*t[3],T[3]=t[3],null!=this.inverseProjectionMatrix&&((0,_.t)(T,T,this.inverseProjectionMatrix),e[0]=T[0],e[1]=T[1],e[2]=T[2])}projectToScreen(t,e){return this.projectToRenderScreen(t,O),this.renderToScreen(O,e),e}projectToRenderScreen(t,e){if(T[0]=t[0],T[1]=t[1],T[2]=t[2],T[3]=1,(0,_.t)(T,T,this.viewProjectionMatrix),0===T[3])return null;const i=T;(0,m.h)(i,i,1/Math.abs(T[3]));const r=this.fullViewport,s=(0,a.Cc)(0,r[0]+r[2],.5+.5*i[0]),n=(0,a.Cc)(0,r[1]+r[3],.5+.5*i[1]);return"x"in e?(e.x=s,e.y=n):(e[0]=s,e[1]=n,e.length>2&&(e[2]=.5*(i[2]+1))),e}unprojectFromScreen(t,e){return this.unprojectFromRenderScreen(this.screenToRender(t,O),e)}unprojectFromRenderScreen(t,e){if((0,u.lw)(M,this.projectionMatrix,this.viewMatrix),!(0,u.B8)(M,M))return null;const i=this.fullViewport;return T[0]=2*(t[0]-i[0])/i[2]-1,T[1]=2*(t[1]-i[1])/i[3]-1,T[2]=2*t[2]-1,T[3]=1,(0,_.t)(T,T,M),0===T[3]?null:(e[0]=T[0]/T[3],e[1]=T[1]/T[3],e[2]=T[2]/T[3],e)}constrainWindowSize(t,e,i,r){const s=t*this.pixelRatio,n=e*this.pixelRatio,o=Math.max(s-i/2,0),a=Math.max(this.fullHeight-n-r/2,0),l=-Math.min(s-i/2,0),h=-Math.min(this.fullHeight-n-r/2,0),c=i-l- -Math.min(this.fullWidth-s-i/2,0),u=r-h- -Math.min(n-r/2,0);return[Math.round(o),Math.round(a),Math.round(c),Math.round(u)]}computeUp(t){t===w.RT.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(t,e){const i=t[0]*this.pixelRatio,r=this.fullHeight-t[1]*this.pixelRatio;return e[0]=i,e[1]=r,e}renderToScreen(t,e){const i=t[0]/this.pixelRatio,r=(this.fullHeight-t[1])/this.pixelRatio;e[0]=i,e[1]=r}_computeUpGlobal(){(0,m.d)(A,this.center,this.eye);const t=(0,m.l)(this.center);t<1?((0,m.i)(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs((0,m.f)(A,this.center))>.9999*(0,m.l)(A)*t||((0,m.e)(this._up,A,this.center),(0,m.e)(this._up,this._up,A),(0,m.n)(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){(0,m.o)(A,this.eye,this.center),Math.abs(A[2])<=.9999&&((0,m.h)(A,A,A[2]),(0,m.i)(this._up,-A[0],-A[1],1-A[2]),(0,m.n)(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(t,e,i=""){"number"==typeof t[0]&&isFinite(t[0])&&"number"==typeof t[1]&&isFinite(t[1])&&"number"==typeof t[2]&&isFinite(t[2])?(0,m.p)(t,e)||((0,m.c)(e,t),this._markViewDirty(),i.length&&this.notifyChange(i)):o.A.getLogger("esri.views.3d.webgl-engine.lib.RenderCamera").warn("RenderCamera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&((0,v.ui)(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&((0,u.t5)(this._viewMatrix,this.eye,this.center,this.up),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};(0,s._)([(0,h.MZ)()],S.prototype,"_viewport",void 0),(0,s._)([(0,h.MZ)()],S.prototype,"_padding",void 0),(0,s._)([(0,h.MZ)()],S.prototype,"_fov",void 0),(0,s._)([(0,h.MZ)()],S.prototype,"_nearFar",void 0),(0,s._)([(0,h.MZ)()],S.prototype,"_viewDirty",void 0),(0,s._)([(0,h.MZ)()],S.prototype,"_viewMatrix",void 0),(0,s._)([(0,h.MZ)()],S.prototype,"_pixelRatio",void 0),(0,s._)([(0,h.MZ)()],S.prototype,"pixelRatio",null),(0,s._)([(0,h.MZ)()],S.prototype,"row",void 0),(0,s._)([(0,h.MZ)()],S.prototype,"column",void 0),(0,s._)([(0,h.MZ)()],S.prototype,"_rows",void 0),(0,s._)([(0,h.MZ)()],S.prototype,"rows",null),(0,s._)([(0,h.MZ)()],S.prototype,"_columns",void 0),(0,s._)([(0,h.MZ)()],S.prototype,"columns",null),(0,s._)([(0,h.MZ)()],S.prototype,"eye",null),(0,s._)([(0,h.MZ)()],S.prototype,"center",null),(0,s._)([(0,h.MZ)()],S.prototype,"_center",void 0),(0,s._)([(0,h.MZ)()],S.prototype,"up",null),(0,s._)([(0,h.MZ)()],S.prototype,"_up",void 0),(0,s._)([(0,h.MZ)()],S.prototype,"viewMatrix",null),(0,s._)([(0,h.MZ)({readOnly:!0})],S.prototype,"viewForward",null),(0,s._)([(0,h.MZ)({readOnly:!0})],S.prototype,"viewUp",null),(0,s._)([(0,h.MZ)({readOnly:!0})],S.prototype,"viewRight",null),(0,s._)([(0,h.MZ)({readOnly:!0})],S.prototype,"nearFar",null),(0,s._)([(0,h.MZ)()],S.prototype,"near",null),(0,s._)([(0,h.MZ)()],S.prototype,"far",null),(0,s._)([(0,h.MZ)()],S.prototype,"viewport",null),(0,s._)([(0,h.MZ)({readOnly:!0})],S.prototype,"screenViewport",null),(0,s._)([(0,h.MZ)({readOnly:!0})],S.prototype,"screenPadding",null),(0,s._)([(0,h.MZ)()],S.prototype,"x",null),(0,s._)([(0,h.MZ)()],S.prototype,"y",null),(0,s._)([(0,h.MZ)()],S.prototype,"width",null),(0,s._)([(0,h.MZ)()],S.prototype,"height",null),(0,s._)([(0,h.MZ)()],S.prototype,"fullWidth",null),(0,s._)([(0,h.MZ)()],S.prototype,"fullHeight",null),(0,s._)([(0,h.MZ)({readOnly:!0})],S.prototype,"_aspect",null),(0,s._)([(0,h.MZ)()],S.prototype,"padding",null),(0,s._)([(0,h.MZ)({readOnly:!0})],S.prototype,"projectionMatrix",null),(0,s._)([(0,h.MZ)({readOnly:!0})],S.prototype,"inverseProjectionMatrix",null),(0,s._)([(0,h.MZ)()],S.prototype,"fov",null),(0,s._)([(0,h.MZ)()],S.prototype,"fovX",null),(0,s._)([(0,h.MZ)()],S.prototype,"fovY",null),(0,s._)([(0,h.MZ)()],S.prototype,"viewInverseTransposeMatrix",null),(0,s._)([(0,h.MZ)({readOnly:!0})],S.prototype,"_projectionMatrixInternal",null),(0,s._)([(0,h.MZ)()],S.prototype,"relativeElevation",void 0),S=r=(0,s._)([(0,c.$)("esri.views.3d.webgl.RenderCamera")],S);const C=S,T=(0,y.vt)(),M=(0,d.vt)(),A=(0,g.vt)(),R=(0,g.vt)(),O=(0,l.r_)()},86305:function(t,e,i){i.d(e,{g:function(){return h}});var r=i(50659),s=(i(58941),i(40633)),n=i(24540),o=i(41835),a=i(85456);const l=()=>s.A.getLogger("esri.views.webgl.BufferObject");class h{static createIndex(t,e,i){return new h(t,a.NZ.ELEMENT_ARRAY_BUFFER,e,i)}static createVertex(t,e,i){return new h(t,a.NZ.ARRAY_BUFFER,e,i)}static createUniform(t,e,i){return new h(t,a.NZ.UNIFORM_BUFFER,e,i)}static createPixelPack(t,e=a._U.STREAM_READ,i){const r=new h(t,a.NZ.PIXEL_PACK_BUFFER,e);return i&&r.setSize(i),r}static createPixelUnpack(t,e=a._U.STREAM_DRAW,i){return new h(t,a.NZ.PIXEL_UNPACK_BUFFER,e,i)}static createTransformFeedback(t,e=a._U.STATIC_DRAW,i){const r=new h(t,a.NZ.TRANSFORM_FEEDBACK_BUFFER,e);return r.setSize(i),r}constructor(t,e,i,r){this._context=t,this.bufferType=e,this.usage=i,this._glName=null,this._size=-1,this._indexType=void 0,t.instanceCounter.increment(a.vt.BufferObject,this),this._glName=this._context.gl.createBuffer(),(0,o.Y2)(this._context.gl),r&&this.setData(r)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get usedMemory(){if(this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER){if(this._indexType===a.pe.UNSIGNED_INT)return 4*this._size;if(this._indexType===a.pe.UNSIGNED_SHORT)return 2*this._size}return this._size}get _isVAOAware(){return this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER||this.bufferType===a.NZ.ARRAY_BUFFER}dispose(){this._context?.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(a.vt.BufferObject,this),this._context=null):this._glName&&l().warn("Leaked WebGL buffer object")}setSize(t,e=null){if(this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER&&null!=e)switch(this._indexType=e,e){case a.pe.UNSIGNED_SHORT:t*=2;break;case a.pe.UNSIGNED_INT:t*=4}this._setBufferData(t)}setData(t){if(!t)return;let e=t.byteLength;this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER&&((0,n.mg)(t)?this._indexType=a.pe.UNSIGNED_BYTE:(0,n.jq)(t)?(e/=2,this._indexType=a.pe.UNSIGNED_SHORT):(0,n.XJ)(t)&&(e/=4,this._indexType=a.pe.UNSIGNED_INT)),this._setBufferData(e,t)}_setBufferData(t,e=null){this._size=t;const i=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const r=this._context.gl;null!=e?r.bufferData(this.bufferType,e,this.usage):r.bufferData(this.bufferType,t,this.usage),(0,o.Y2)(r),this._isVAOAware&&this._context.bindVAO(i)}setSubData(t,e,i,r){if(!t)return;const s=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const{gl:n}=this._context;n.bufferSubData(this.bufferType,e*t.BYTES_PER_ELEMENT,t,i,r-i),(0,o.Y2)(n),this._isVAOAware&&this._context.bindVAO(s)}getSubData(t,e=0,i,s){if(i<0||s<0)return;const n=function(t){return(0,r.Xj)(t)}(t)?t.BYTES_PER_ELEMENT:1;if(n*((i??0)+(s??0))>t.byteLength)return;e+n*(s??0)>this.usedMemory&&l().warn("Potential problem getting subdata: requested data exceeds buffer size!");const o=this._context.gl;this.bufferType===a.NZ.TRANSFORM_FEEDBACK_BUFFER?(this._context.bindBuffer(this,a.NZ.TRANSFORM_FEEDBACK_BUFFER),o.getBufferSubData(a.NZ.TRANSFORM_FEEDBACK_BUFFER,e,t,i,s),this._context.unbindBuffer(a.NZ.TRANSFORM_FEEDBACK_BUFFER)):(this._context.bindBuffer(this,a.NZ.COPY_READ_BUFFER),o.getBufferSubData(a.NZ.COPY_READ_BUFFER,e,t,i,s),this._context.unbindBuffer(a.NZ.COPY_READ_BUFFER))}async getSubDataAsync(t,e=0,i,r){await this._context.clientWaitAsync(),this.getSubData(t,e,i,r)}}},81438:function(t,e,i){i.d(e,{Z:function(){return h}});var r=i(40633),s=i(95929),n=i(24540),o=i(85456),a=i(93380);const l=()=>r.A.getLogger("esri.views.webgl.VertexArrayObject");let h=class{constructor(t,e,i,r,s=null){this._context=t,this._locations=e,this._layout=i,this._buffers=r,this._indexBuffer=s,this._glName=null,this._initialized=!1}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get byteSize(){return Array.from(this._buffers.values()).reduce(((t,e)=>t+e.usedMemory),null!=this._indexBuffer?this._indexBuffer.usedMemory:0)}get layout(){return this._layout}get locations(){return this._locations}get usedMemory(){return this.byteSize+(Object.keys(this._buffers).length+(this._indexBuffer?1:0))*n.zQ}dispose(){this._context?(this._context.getBoundVAO()===this&&this._context.bindVAO(null),this._buffers.forEach((t=>t.dispose())),this._buffers.clear(),this._indexBuffer=(0,s.WD)(this._indexBuffer),this.disposeVAOOnly()):(this._glName||Object.getOwnPropertyNames(this._buffers).length>0)&&l().warn("Leaked WebGL VAO")}disposeVAOOnly(){this._glName&&(this._context.gl.deleteVertexArray(this._glName),this._glName=null,this._context.instanceCounter.decrement(o.vt.VertexArrayObject,this)),this._context=null}initialize(){if(this._initialized)return;const{gl:t}=this._context,e=t.createVertexArray();t.bindVertexArray(e),this._bindLayout(),t.bindVertexArray(null),this._glName=e,this._context.instanceCounter.increment(o.vt.VertexArrayObject,this),this._initialized=!0}bind(){this.initialize(),this._context.gl.bindVertexArray(this.glName)}_bindLayout(){const{_buffers:t,_layout:e,_indexBuffer:i}=this;t||l().error("Vertex buffer dictionary is empty!");const r=this._context.gl;this._buffers.forEach(((t,i)=>{const r=e.get(i);r?(0,a.yu)(this._context,this._locations,t,r):l().error("Vertex element descriptor is empty!")})),null!=i&&r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,i.glName)}unbind(){this.initialize(),this._context.gl.bindVertexArray(null)}}},3817:function(t,e,i){i.d(e,{_:function(){return r}});class r{constructor(t,e,i,r,s,n=!1,o=0){this.name=t,this.count=e,this.type=i,this.offset=r,this.stride=s,this.normalized=n,this.divisor=o}}}}]);
//# sourceMappingURL=Graphics3DSymbolLayerFactory.js.map