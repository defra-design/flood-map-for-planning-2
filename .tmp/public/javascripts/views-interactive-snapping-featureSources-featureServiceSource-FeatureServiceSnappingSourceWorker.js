"use strict";(self.webpackChunkdefra=self.webpackChunkdefra||[]).push([[2416,4292,6314,8246],{74756:function(e,t,r){r.r(t),r.d(t,{default:function(){return C}});var n=r(53804),i=r(93040),s=r(78879),a=r(61500),o=r(30905),l=r(21609),u=r(31609),c=r(75218),d=r(40633),h=r(95929),p=r(60539),f=r(90683),m=r(23502),y=(r(58941),r(65953)),g=r(81392),v=r(57165),_=r(51432),w=r(43173),b=r(11876),T=r(83525),S=(r(13798),r(22739));const I=new Set(["ar","bs","ca","hr","cs","da","nl","en","et","fi","fr","de","el","he","hu","id","it","ja","ko","lv","lt","nb","pl","ro","ru","sr","es","sv","th","tr","uk","vi"]);let x=class extends T.A{constructor(e){super(e),this.apiKey=null,this.id=null,this.language=null,this.places=null,this.serviceUrl="https://basemapstyles-api.arcgis.com/arcgis/rest/services/styles/v2/webmaps",this.worldview=null}getLanguageParamValue(){if(this.language)return this.language;const e=(0,S.JK)().toLowerCase();switch(e){case"pt-br":return"pt-BR";case"pt-pt":return"pt-PT";case"zh-cn":return"zh-CN";case"zh-hk":return"zh-HK";case"zh-tw":return"zh-TW"}const t=(0,S.Z0)(e);return"pt"===t?"pt-BR":t&&I.has(t)?t:"global"}};(0,n._)([(0,m.MZ)()],x.prototype,"apiKey",void 0),(0,n._)([(0,m.MZ)()],x.prototype,"id",void 0),(0,n._)([(0,m.MZ)()],x.prototype,"language",void 0),(0,n._)([(0,m.MZ)()],x.prototype,"places",void 0),(0,n._)([(0,m.MZ)()],x.prototype,"serviceUrl",void 0),(0,n._)([(0,m.MZ)()],x.prototype,"worldview",void 0),x=(0,n._)([(0,y.$)("esri.support.BasemapStyle")],x);const M=x;var F,L=r(84624);let E=0,A=F=class extends((0,o.Te)(u.A)){constructor(e){super(e),this.id=null,this.portalItem=null,this.spatialReference=null,this.style=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+E++,this.baseLayers=new s.A,this.referenceLayers=new s.A;const t=e=>{e.parent&&e.parent!==this&&"remove"in e.parent&&e.parent.remove(e),e.parent=this,"elevation"===e.type&&d.A.getLogger(this).error(`Layer '${e.title}, id:${e.id}' of type '${e.type}' is not supported as a basemap layer and will therefore be ignored.`)},r=e=>{e.parent=null};this.addHandles([this.baseLayers.on("after-add",(e=>t(e.item))),this.referenceLayers.on("after-add",(e=>t(e.item))),this.baseLayers.on("after-remove",(e=>r(e.item))),this.referenceLayers.on("after-remove",(e=>r(e.item)))])}initialize(){this.when().catch((e=>{d.A.getLogger(this).error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,e)})),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const e=this.baseLayers.toArray();for(const t of e)t.destroy();const t=this.referenceLayers.toArray();for(const e of t)e.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),this.portalItem=(0,h.pR)(this.portalItem)}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e={...e}).resourceInfo),e}set baseLayers(e){this._set("baseLayers",(0,a.V)(e,this._get("baseLayers")))}_writeBaseLayers(e,t,r){const n=[];e?(r={...r,layerContainerType:"basemap"},this.baseLayers.forEach((e=>{const t=(0,L.CJ)(e,r.webmap?r.webmap.getLayerJSONFromResourceInfo(e):null,r);null!=t&&n.push(t)})),this.referenceLayers.forEach((e=>{const t=(0,L.CJ)(e,r.webmap?r.webmap.getLayerJSONFromResourceInfo(e):null,r);null!=t&&("scene"!==e.type&&(t.isReference=!0),n.push(t))})),t.baseMapLayers=n):t.baseMapLayers=n}set referenceLayers(e){this._set("referenceLayers",(0,a.V)(e,this._get("referenceLayers")))}writeTitle(e,t){t.title=e||"Basemap"}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return(0,c.g)(this,(e=>{e(this.baseLayers,this.referenceLayers)}))}clone(){const e={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.map((e=>(0,l.Nb)(e)?e.clone():e)),referenceLayers:this.referenceLayers.map((e=>(0,l.Nb)(e)?e.clone():e))};return this.loaded&&(e.loadStatus="loaded"),new F({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}write(e,t){return e=e||{},t?.origin||(t={origin:"web-map",...t}),super.write(e,t),!this.loaded&&this.resourceInfo?.data.baseMapLayers&&(e.baseMapLayers=this.resourceInfo.data.baseMapLayers.map((e=>{const t=(0,l.o8)(e);return t.url&&(0,f.BQ)(t.url)&&(t.url=`https:${t.url}`),t.templateUrl&&(0,f.BQ)(t.templateUrl)&&(t.templateUrl=`https:${t.templateUrl}`),t}))),e}async _loadFromSource(e){const{resourceInfo:t,portalItem:r,style:n}=this;(0,p.Te)(e);const i=[];if(t){const r=t.context?t.context.url:null;if(i.push(this._loadLayersFromJSON(t.data,r,e)),t.data.id&&!t.data.title){const e=t.data.id;i.push((0,b.q)(e).then((e=>{e&&this.read({title:e},t.context)})))}}else r?i.push(this._loadFromItem(r,e)):n&&i.push(this._loadFromStylesService(n,e));await Promise.all(i)}async _loadLayersFromJSON(e,t,n){const i=this.resourceInfo?.context,s=this.portalItem?.portal||i?.portal||null,a=N[i?.origin||""]??"web-map",{populateOperationalLayers:o}=await r.e(3538).then(r.bind(r,80669)),l=[];if((0,p.Te)(n),e.baseMapLayers&&Array.isArray(e.baseMapLayers)){const r={context:{...i,origin:a,url:t,portal:s,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},n=e=>"web-scene"===a&&"ArcGISSceneServiceLayer"===e.layerType||e.isReference,u=o(this.baseLayers,e.baseMapLayers.filter((e=>!n(e))),r);l.push(u);const c=o(this.referenceLayers,e.baseMapLayers.filter(n),r);l.push(c)}await Promise.allSettled(l)}async _loadFromItem(e,t){const r=await e.load(t),n=await r.fetchData("json",t),i=(0,f.An)(e.itemUrl??"");return this._set("resourceInfo",{data:n.baseMap??{},context:{origin:R[e.type||""]??"web-map",portal:e.portal||_.A.getDefault(),url:i}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:n.spatialReference},this.resourceInfo.context),this.read({title:e.title,thumbnailUrl:e.thumbnailUrl},{origin:"portal-item",portal:e.portal||_.A.getDefault(),url:i}),this._loadLayersFromJSON(this.resourceInfo.data,i,t)}async _loadFromStylesService(e,t){const r=`${e.serviceUrl}/${e.id}`,n=(await(0,i.A)(r,{query:{language:e.getLanguageParamValue(),places:e.places,worldview:e.worldview,token:e.apiKey},signal:t?.signal})).data,s=(0,f.An)(r);if(this._set("resourceInfo",{data:n.baseMap??{},context:{origin:"web-map",url:s}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:n.spatialReference},this.resourceInfo.context),await this._loadLayersFromJSON(this.resourceInfo.data,s,t),e.apiKey)for(const t of[...this.baseLayers,...this.referenceLayers])"apiKey"in t&&(t.apiKey=e.apiKey)}static fromId(e){const t=b.H[e];return t?t.itemId?new F({portalItem:{id:t.itemId,portal:{url:"https://www.arcgis.com"}}}):F.fromJSON(t,{origin:t.is3d?"web-scene":"web-map"}):null}};(0,n._)([(0,m.MZ)({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(e,t,r,n){this._writeBaseLayers(e,t,n)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:s.A}},writer(e,t,r,n){this._writeBaseLayers(e,t,n)}}}}}})],A.prototype,"baseLayers",null),(0,n._)([(0,m.MZ)({type:String,json:{origins:{"web-scene":{write:!0}}}})],A.prototype,"id",void 0),(0,n._)([(0,m.MZ)({type:w.default})],A.prototype,"portalItem",void 0),(0,n._)([(0,m.MZ)()],A.prototype,"referenceLayers",null),(0,n._)([(0,m.MZ)({readOnly:!0})],A.prototype,"resourceInfo",void 0),(0,n._)([(0,m.MZ)({type:v.A})],A.prototype,"spatialReference",void 0),(0,n._)([(0,m.MZ)({type:M})],A.prototype,"style",void 0),(0,n._)([(0,m.MZ)()],A.prototype,"thumbnailUrl",void 0),(0,n._)([(0,m.MZ)({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],A.prototype,"title",void 0),(0,n._)([(0,g.K)("title")],A.prototype,"writeTitle",null),A=F=(0,n._)([(0,y.$)("esri.Basemap")],A);const R={"Web Scene":"web-scene","Web Map":"web-map","Link Chart":"link-chart"},N={"web-scene":"web-scene","web-map":"web-map","link-chart":"link-chart"},C=A},9688:function(e,t,r){r.d(t,{lY:function(){return d},mT:function(){return h}});var n,i=r(50944),s=r(92955),a=r(96285);(n||(n={})).TimeZoneNotRecognized="TimeZoneNotRecognized";const o={[n.TimeZoneNotRecognized]:"Timezone identifier has not been recognized."};class l extends Error{constructor(e,t){super((0,i.HC)(o[e],t)),this.declaredRootClass="esri.arcade.arcadedate.dateerror",Error.captureStackTrace&&Error.captureStackTrace(this,l)}}function u(e,t,r){return e<t?e-t:e>r?e-r:0}function c(e,t,r){return e<t?t:e>r?r:e}class d{constructor(e){this._date=e,this.declaredRootClass="esri.arcade.arcadedate"}static fromParts(e=0,t=1,r=1,n=0,i=0,s=0,o=0,l){if(isNaN(e)||isNaN(t)||isNaN(r)||isNaN(n)||isNaN(i)||isNaN(s)||isNaN(o))return null;const p=a.c9.local(e,t).daysInMonth;let f=a.c9.fromObject({day:c(r,1,p),year:e,month:c(t,1,12),hour:c(n,0,23),minute:c(i,0,59),second:c(s,0,59),millisecond:c(o,0,999)},{zone:h(l)});return f=f.plus({months:u(t,1,12),days:u(r,1,p),hours:u(n,0,23),minutes:u(i,0,59),seconds:u(s,0,59),milliseconds:u(o,0,999)}),new d(f)}static get systemTimeZoneCanonicalName(){return Intl.DateTimeFormat().resolvedOptions().timeZone??"system"}static arcadeDateAndZoneToArcadeDate(e,t){const r=h(t);return e.isUnknownTimeZone||r===s.GB.instance?d.fromParts(e.year,e.monthJS+1,e.day,e.hour,e.minute,e.second,e.millisecond,r):new d(e._date.setZone(r))}static dateJSToArcadeDate(e){return new d(a.c9.fromJSDate(e,{zone:"system"}))}static dateJSAndZoneToArcadeDate(e,t="system"){const r=h(t);return new d(a.c9.fromJSDate(e,{zone:r}))}static unknownEpochToArcadeDate(e){return new d(a.c9.fromMillis(e,{zone:s.GB.instance}))}static unknownDateJSToArcadeDate(e){return new d(a.c9.fromMillis(e.getTime(),{zone:s.GB.instance}))}static epochToArcadeDate(e,t="system"){const r=h(t);return new d(a.c9.fromMillis(e,{zone:r}))}static dateTimeToArcadeDate(e){return new d(e)}clone(){return new d(this._date)}changeTimeZone(e){const t=h(e);return d.dateTimeToArcadeDate(this._date.setZone(t))}static dateTimeAndZoneToArcadeDate(e,t){const r=h(t);return e.zone===s.GB.instance||r===s.GB.instance?d.fromParts(e.year,e.month,e.day,e.hour,e.minute,e.second,e.millisecond,r):new d(e.setZone(r))}static nowToArcadeDate(e){const t=h(e);return new d(a.c9.fromJSDate(new Date,{zone:t}))}static nowUTCToArcadeDate(){return new d(a.c9.utc())}get isSystem(){return"system"===this.timeZone||this.timeZone===d.systemTimeZoneCanonicalName}equals(e){return this.isSystem&&e.isSystem?this.toNumber()===e.toNumber():this.isUnknownTimeZone===e.isUnknownTimeZone&&this._date.equals(e._date)}get isUnknownTimeZone(){return this._date.zone===s.GB.instance}get isValid(){return this._date.isValid}get hour(){return this._date.hour}get second(){return this._date.second}get day(){return this._date.day}get dayOfWeekISO(){return this._date.weekday}get dayOfWeekJS(){let e=this._date.weekday;return e>6&&(e=0),e}get millisecond(){return this._date.millisecond}get monthISO(){return this._date.month}get weekISO(){return this._date.weekNumber}get yearISO(){return this._date.weekYear}get monthJS(){return this._date.month-1}get year(){return this._date.year}get minute(){return this._date.minute}get zone(){return this._date.zone}get timeZoneOffset(){return this.isUnknownTimeZone?0:this._date.offset}get timeZone(){if(this.isUnknownTimeZone)return"unknown";if("system"===this._date.zone.type)return"system";const e=this.zone;return"fixed"===e.type?0===e.fixed?"UTC":e.formatOffset(0,"short"):e.name}stringify(){return JSON.stringify(this.toJSDate())}plus(e){return new d(this._date.plus(e))}diff(e,t="milliseconds"){return this._date.diff(e._date,t)[t]}toISODate(){return this._date.toISODate()}toISOString(e){return e?this._date.toISO({suppressMilliseconds:!0,includeOffset:!this.isUnknownTimeZone}):this._date.toISO({includeOffset:!this.isUnknownTimeZone})}toISOTime(e,t){return this._date.toISOTime({suppressMilliseconds:e,includeOffset:t&&!this.isUnknownTimeZone})}toFormat(e,t){return this.isUnknownTimeZone&&(e=e.replaceAll("Z","")),this._date.toFormat(e,t)}toJSDate(){return this._date.toJSDate()}toSQLValue(){return this._date.toFormat("yyyy-LL-dd HH:mm:ss")}toSQLWithKeyword(){return`timestamp '${this.toSQLValue()}'`}toDateTime(){return this._date}toNumber(){return this._date.toMillis()}getTime(){return this._date.toMillis()}toUTC(){return new d(this._date.toUTC())}toLocal(){return new d(this._date.toLocal())}toString(){return this.toISOString(!0)}static fromReaderAsTimeStampOffset(e){if(!e)return null;const t=a.c9.fromISO(e,{setZone:!0});return new d(t)}}function h(e,t=!0){if(e instanceof a.bo)return e;if("system"===e.toLowerCase())return"system";if("utc"===e.toLowerCase())return"UTC";if("unknown"===e.toLowerCase())return s.GB.instance;if(/^[+-]?[0-9]{1,2}([:][0-9]{2})?$/.test(e)){const t=a.mQ.parseSpecifier("UTC"+(e.startsWith("+")||e.startsWith("-")?"":"+")+e);if(t)return t}const r=a.oh.create(e);if(!r.isValid){if(t)throw new l(n.TimeZoneNotRecognized);return null}return r}},80749:function(e,t,r){r.d(t,{Fq:function(){return l},SQ:function(){return a},Yc:function(){return s},Yq:function(){return o},uf:function(){return i}});var n=r(91484);function i(e){if(null==e)return null;if("number"==typeof e)return e;let t=e.toLowerCase();switch(t=t.replaceAll(/\s/g,""),t=t.replaceAll("-",""),t){case"meters":case"meter":case"m":case"squaremeters":case"squaremeter":return 109404;case"miles":case"mile":case"squaremile":case"squaremiles":return 109439;case"kilometers":case"kilometer":case"squarekilometers":case"squarekilometer":case"km":return 109414;case"acres":case"acre":case"ac":return 109402;case"hectares":case"hectare":case"ha":return 109401;case"yard":case"yd":case"yards":case"squareyards":case"squareyard":return 109442;case"feet":case"ft":case"foot":case"squarefeet":case"squarefoot":return 109405;case"nmi":case"nauticalmile":case"nauticalmiles":case"squarenauticalmile":case"squarenauticalmiles":return 109409}return null}function s(e){if(null==e)return null;switch(e.type){case"polygon":case"multipoint":case"polyline":return e.extent;case"point":return new n.default({xmin:e.x,ymin:e.y,xmax:e.x,ymax:e.y,spatialReference:e.spatialReference});case"extent":return e}return null}function a(e){if(null==e)return null;if("number"==typeof e)return e;let t=e.toLowerCase();switch(t=t.replaceAll(/\s/g,""),t=t.replaceAll("-",""),t){case"meters":case"meter":case"m":case"squaremeters":case"squaremeter":return 9001;case"miles":case"mile":case"squaremile":case"squaremiles":return 9093;case"kilometers":case"kilometer":case"squarekilometers":case"squarekilometer":case"km":return 9036;case"yard":case"yd":case"yards":case"squareyards":case"squareyard":return 9096;case"feet":case"ft":case"foot":case"squarefeet":case"squarefoot":return 9002;case"nmi":case"nauticalmile":case"nauticalmiles":case"squarenauticalmile":case"squarenauticalmiles":return 9030}return null}function o(e){if(null==e)return null;const t=e.clone();return void 0!==e.cache._geVersion&&(t.cache._geVersion=e.cache._geVersion),t}function l(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}},88923:function(e,t,r){function n(e,t,r,n,s){i(e,t,r||0,n||e.length-1,s||a)}function i(e,t,r,n,a){for(;n>r;){if(n-r>600){var o=n-r+1,l=t-r+1,u=Math.log(o),c=.5*Math.exp(2*u/3),d=.5*Math.sqrt(u*c*(o-c)/o)*(l-o/2<0?-1:1);i(e,t,Math.max(r,Math.floor(t-l*c/o+d)),Math.min(n,Math.floor(t+(o-l)*c/o+d)),a)}var h=e[t],p=r,f=n;for(s(e,r,t),a(e[n],h)>0&&s(e,r,n);p<f;){for(s(e,p,f),p++,f--;a(e[p],h)<0;)p++;for(;a(e[f],h)>0;)f--}0===a(e[r],h)?s(e,r,f):s(e,++f,n),f<=t&&(r=f+1),t<=f&&(n=f-1)}}function s(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function a(e,t){return e<t?-1:e>t?1:0}r.d(t,{q:function(){return n}})},69296:function(e,t,r){var n;r.d(t,{u:function(){return n}}),function(e){e[e.KILOBYTES=1024]="KILOBYTES",e[e.MEGABYTES=1048576]="MEGABYTES",e[e.GIGABYTES=1073741824]="GIGABYTES"}(n||(n={}))},99680:function(e,t,r){r.d(t,{q:function(){return i}});var n=r(85408);class i{constructor(e,t){this._storage=new n.F,this.id="",this.name="",this.size=0,this._storage.maxSize=e,this._storage.register(this),t&&this._storage.registerRemoveFunc("",t)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(e,t,r=1){this._storage.put(this,e,t,r,1)}pop(e){return this._storage.pop(this,e)}get(e){return this._storage.get(this,e)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}resetHitRate(){}}},85408:function(e,t,r){r.d(t,{F:function(){return l},Ti:function(){return i}});var n=r(7187);const i=-3,s=i-1;var a,o;(o=a||(a={}))[o.ALL=0]="ALL",o[o.SOME=1]="SOME";class l{get size(){return this._size}constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new n.A,this._users=new n.A}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(e){this._users.push(e)}deregister(e){this._users.removeUnordered(e)}registerRemoveFunc(e,t){this._removeFuncs.push([e,t])}deregisterRemoveFunc(e){this._removeFuncs.filterInPlace((t=>t[0]!==e))}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,-1),this._checkSize()}getSize(e,t){const r=this._db.get(e.id+t);return r?.size??0}put(e,t,r,n,o){t=e.id+t;const l=this._db.get(t);if(l&&(this._size-=l.size,e.size-=l.size,this._db.delete(t),l.entry!==r&&this._notifyRemove(t,l.entry,l.size,a.ALL)),n>this._maxSize)return void this._notifyRemove(t,r,n,a.ALL);if(void 0===r)return void console.warn("Refusing to cache undefined entry ");if(!n||n<0)return console.warn(`Refusing to cache entry with size ${n} for key ${t}`),void this._notifyRemove(t,r,0,a.ALL);const c=1+Math.max(o,s)-i;this._db.set(t,new u(r,n,c)),this._size+=n,e.size+=n,this._checkSize()}updateSize(e,t,r,n){t=e.id+t;const i=this._db.get(t);if(i&&i.entry===r){for(this._size-=i.size,e.size-=i.size;n>this._maxSize;){const e=this._notifyRemove(t,r,n,a.SOME);if(!(null!=e&&e>0))return void this._db.delete(t);n=e}i.size=n,this._size+=n,e.size+=n,this._checkSize()}}pop(e,t){t=e.id+t;const r=this._db.get(t);if(r)return this._size-=r.size,e.size-=r.size,this._db.delete(t),++this._hit,r.entry;++this._miss}get(e,t){t=e.id+t;const r=this._db.get(t);if(void 0!==r)return this._db.delete(t),r.lives=r.lifetime,this._db.set(t,r),++this._hit,r.entry;++this._miss}peek(e,t){const r=this._db.get(e.id+t);return r?++this._hit:++this._miss,r?.entry}get performanceInfo(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},t={},r=new Array;this._db.forEach(((e,n)=>{const i=e.lifetime;r[i]=(r[i]||0)+e.size,this._users.forAll((r=>{const{id:i,name:s}=r;if(n.startsWith(i)){const r=t[s]||0;t[s]=r+e.size}}))}));const n={};this._users.forAll((e=>{const r=e.name;if("hitRate"in e&&"number"==typeof e.hitRate&&!isNaN(e.hitRate)&&e.hitRate>0){const i=t[r]||0;t[r]=i,n[r]=Math.round(100*e.hitRate)+"%"}else n[r]="0%"}));const s=Object.keys(t);s.sort(((e,r)=>t[r]-t[e])),s.forEach((r=>e[r]=Math.round(t[r]/2**20)+"MB / "+n[r]));for(let t=r.length-1;t>=0;--t){const n=r[t];n&&(e["Priority "+(t+i-1)]=Math.round(n/this._size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forAll((e=>e.resetHitRate()))}clear(e){const t=e.id;this._db.forEach(((e,r)=>{r.startsWith(t)&&(this._size-=e.size,this._db.delete(r),this._notifyRemove(r,e.entry,e.size,a.ALL))})),e.size=0}clearAll(){this._db.forEach(((e,t)=>this._notifyRemove(t,e.entry,e.size,a.ALL))),this._users.forAll((e=>e.size=0)),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,t,r,n){let i;return this._removeFuncs.some((s=>{if(e.startsWith(s[0])){const e=s[1](t,n,r);return"number"==typeof e&&(i=e),!0}return!1})),i}_checkSize(){this._users.forAll((e=>this._checkSizeLimits(e))),this._checkSizeLimits()}_checkSizeLimits(e){const t=e??this;if(t.maxSize<0||t.size<=t.maxSize)return;const r=e?.id;let n=!0;for(;n;){n=!1;for(const[i,s]of this._db)if(0===s.lifetime&&(!r||i.startsWith(r))){if(this._purgeItem(i,s,e),t.size<=.9*t.maxSize)return;n||=this._db.has(i)}}for(const[n,i]of this._db)if((!r||n.startsWith(r))&&(this._purgeItem(n,i,e),t.size<=.9*t.maxSize))return}_purgeItem(e,t,r=this._users.find((t=>e.startsWith(t.id)))){if(this._db.delete(e),t.lives<=1){this._size-=t.size,r&&(r.size-=t.size);const n=this._notifyRemove(e,t.entry,t.size,a.SOME);null!=n&&n>0&&(this._size+=n,r&&(r.size+=n),t.lives=t.lifetime,t.size=n,this._db.set(e,t))}else--t.lives,this._db.set(e,t)}}class u{constructor(e,t,r){this.entry=e,this.size=t,this.lifetime=r,this.lives=r}}},50612:function(e,t,r){r.d(t,{E:function(){return I},w:function(){return a}});var n=r(50659),i=(r(58941),r(7187)),s=r(88923);class a{constructor(e=9,t){this._compareMinX=d,this._compareMinY=h,this._toBBox=e=>e,this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&("function"==typeof t?this._toBBox=t:this._initFormat(t)),this.clear()}destroy(){this.clear(),w.prune(),b.prune(),T.prune(),S.prune()}all(e){o(this._data,e)}search(e,t){let r=this._data;const n=this._toBBox;if(v(e,r))for(w.clear();r;){for(let i=0,s=r.children.length;i<s;i++){const s=r.children[i],a=r.leaf?n(s):s;v(e,a)&&(r.leaf?t(s):g(e,a)?o(s,t):w.push(s))}r=w.pop()}}collides(e){let t=this._data;const r=this._toBBox;if(!v(e,t))return!1;for(w.clear();t;){for(let n=0,i=t.children.length;n<i;n++){const i=t.children[n],s=t.leaf?r(i):i;if(v(e,s)){if(t.leaf||g(e,s))return!0;w.push(i)}}t=w.pop()}return!1}load(e){if(!e.length)return this;if(e.length<this._minEntries){for(let t=0,r=e.length;t<r;t++)this.insert(e[t]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(this._data.children.length)if(this._data.height===t.height)this._splitRoot(this._data,t);else{if(this._data.height<t.height){const e=this._data;this._data=t,t=e}this._insert(t,this._data.height-t.height-1,!0)}else this._data=t;return this}insert(e){return e&&this._insert(e,this._data.height-1),this}clear(){return this._data=new M([]),this}remove(e){if(!e)return this;let t,r=this._data,i=null,s=0,a=!1;const o=this._toBBox(e);for(T.clear(),S.clear();r||T.length>0;){if(r||(r=T.pop(),i=T.data[T.length-1],s=S.pop()??0,a=!0),r.leaf&&(t=(0,n.qh)(r.children,e,r.children.length,r.indexHint),-1!==t))return r.children.splice(t,1),T.push(r),this._condense(T),this;a||r.leaf||!g(r,o)?i?(s++,r=i.children[s],a=!1):r=null:(T.push(r),S.push(s),s=0,i=r,r=r.children[0])}return this}toJSON(){return this._data}fromJSON(e){return this._data=e,this}_build(e,t,r,n){const i=r-t+1;let s=this._maxEntries;if(i<=s){const n=new M(e.slice(t,r+1));return l(n,this._toBBox),n}n||(n=Math.ceil(Math.log(i)/Math.log(s)),s=Math.ceil(i/s**(n-1)));const a=new F([]);a.height=n;const o=Math.ceil(i/s),u=o*Math.ceil(Math.sqrt(s));_(e,t,r,u,this._compareMinX);for(let i=t;i<=r;i+=u){const t=Math.min(i+u-1,r);_(e,i,t,o,this._compareMinY);for(let r=i;r<=t;r+=o){const i=Math.min(r+o-1,t);a.children.push(this._build(e,r,i,n-1))}}return l(a,this._toBBox),a}_insert(e,t,r){const n=this._toBBox,i=r?e:n(e);T.clear();const s=function(e,t,r,n){for(;n.push(t),!0!==t.leaf&&n.length-1!==r;){let r,n=1/0,i=1/0;for(let s=0,a=t.children.length;s<a;s++){const a=t.children[s],o=p(a),l=m(e,a)-o;l<i?(i=l,n=o<n?o:n,r=a):l===i&&o<n&&(n=o,r=a)}t=r||t.children[0]}return t}(i,this._data,t,T);for(s.children.push(e),c(s,i);t>=0&&T.data[t].children.length>this._maxEntries;)this._split(T,t),t--;!function(e,t,r){for(let n=r;n>=0;n--)c(t.data[n],e)}(i,T,t)}_split(e,t){const r=e.data[t],n=r.children.length,i=this._minEntries;this._chooseSplitAxis(r,i,n);const s=this._chooseSplitIndex(r,i,n);if(!s)return;const a=r.children.splice(s,r.children.length-s),o=r.leaf?new M(a):new F(a);o.height=r.height,l(r,this._toBBox),l(o,this._toBBox),t?e.data[t-1].children.push(o):this._splitRoot(r,o)}_splitRoot(e,t){this._data=new F([e,t]),this._data.height=e.height+1,l(this._data,this._toBBox)}_chooseSplitIndex(e,t,r){let n,i,s;n=i=1/0;for(let a=t;a<=r-t;a++){const t=u(e,0,a,this._toBBox),o=u(e,a,r,this._toBBox),l=y(t,o),c=p(t)+p(o);l<n?(n=l,s=a,i=c<i?c:i):l===n&&c<i&&(i=c,s=a)}return s}_chooseSplitAxis(e,t,r){const n=e.leaf?this._compareMinX:d,i=e.leaf?this._compareMinY:h;this._allDistMargin(e,t,r,n)<this._allDistMargin(e,t,r,i)&&e.children.sort(n)}_allDistMargin(e,t,r,n){e.children.sort(n);const i=this._toBBox,s=u(e,0,t,i),a=u(e,r-t,r,i);let o=f(s)+f(a);for(let n=t;n<r-t;n++){const t=e.children[n];c(s,e.leaf?i(t):t),o+=f(s)}for(let n=r-t-1;n>=t;n--){const t=e.children[n];c(a,e.leaf?i(t):t),o+=f(a)}return o}_condense(e){for(let t=e.length-1;t>=0;t--){const r=e.data[t];if(0===r.children.length)if(t>0){const i=e.data[t-1],s=i.children;s.splice((0,n.qh)(s,r,s.length,i.indexHint),1)}else this.clear();else l(r,this._toBBox)}}_initFormat(e){const t=["return a"," - b",";"];this._compareMinX=new Function("a","b",t.join(e[0])),this._compareMinY=new Function("a","b",t.join(e[1])),this._toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}}function o(e,t){let r=e;for(b.clear();r;){if(!0===r.leaf)for(const e of r.children)t(e);else b.pushArray(r.children);r=b.pop()??null}}function l(e,t){u(e,0,e.children.length,t,e)}function u(e,t,r,n,i){i||(i=new M([])),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(let s,a=t;a<r;a++)s=e.children[a],c(i,e.leaf?n(s):s);return i}function c(e,t){e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY)}function d(e,t){return e.minX-t.minX}function h(e,t){return e.minY-t.minY}function p(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function f(e){return e.maxX-e.minX+(e.maxY-e.minY)}function m(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function y(e,t){const r=Math.max(e.minX,t.minX),n=Math.max(e.minY,t.minY),i=Math.min(e.maxX,t.maxX),s=Math.min(e.maxY,t.maxY);return Math.max(0,i-r)*Math.max(0,s-n)}function g(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function v(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function _(e,t,r,n,i){const a=[t,r];for(;a.length;){const t=a.pop(),r=a.pop();if(t-r<=n)continue;const o=r+Math.ceil((t-r)/n/2)*n;(0,s.q)(e,o,r,t,i),a.push(r,o,o,t)}}const w=new i.A,b=new i.A,T=new i.A,S=new i.A({deallocator:void 0});class I{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}}class x extends I{constructor(){super(...arguments),this.height=1,this.indexHint=new n.vW}}class M extends x{constructor(e){super(),this.children=e,this.leaf=!0}}class F extends x{constructor(e){super(),this.children=e,this.leaf=!1}}},75218:function(e,t,r){r.d(t,{L:function(){return o},g:function(){return a}});var n=r(77472),i=r(78879),s=r(31609);async function a(e,t){return await e.load(),o(e,t)}async function o(e,t){const r=[],a=(...e)=>{for(const t of e)null!=t&&(Array.isArray(t)?a(...t):i.A.isCollection(t)?t.forEach((e=>a(e))):s.A.isLoadable(t)&&r.push(t))};t(a);let o=null;if(await(0,n.Tj)(r,(async e=>{const t=await(0,n.Ke)(function(e){return"loadAll"in e&&"function"==typeof e.loadAll}(e)?e.loadAll():e.load());!1!==t.ok||o||(o=t)})),o)throw o.error;return e}},68225:function(e,t,r){r.d(t,{A:function(){return c}});var n,i,s=r(58941),a=r(56996);(i=n||(n={}))[i.varint=0]="varint",i[i.fixed64=1]="fixed64",i[i.delimited=2]="delimited",i[i.fixed32=5]="fixed32",i[i.unknown=99]="unknown";const o=4294967296,l=new TextDecoder("utf-8"),u=(0,s.A)("safari")||(0,s.A)("ios")?6:(0,s.A)("ff")?12:32;class c{constructor(e,t,r=0,i=(e?e.byteLength:0)){this._tag=0,this._dataType=n.unknown,this._init(e,t,r,i)}_init(e,t,r,n){this._data=e,this._dataView=t,this._pos=r,this._end=n}asUnsafe(){return this}clone(){return new c(this._data,this._dataView,this._pos,this._end)}pos(){return this._pos}move(e){this._pos=e}nextTag(e){for(;;){if(this._pos===this._end)return!1;const t=this._decodeVarint();if(this._tag=t>>3,this._dataType=7&t,!e||e===this._tag)break;this.skip()}return!0}next(){if(this._pos===this._end)return!1;const e=this._decodeVarint();return this._tag=e>>3,this._dataType=7&e,!0}empty(){return this._pos>=this._end}tag(){return this._tag}getInt32(){return this._decodeVarint()}getInt64(){return this._decodeVarint()}getUInt32(){let e=4294967295;if(e=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128)return e;if(e=(e|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128)return e;if(e=(e|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128)return e;if(e=(e|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128)return e;if(e=(e|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128)return e;throw new Error("Varint overflow")}getUInt64(){return this._decodeVarint()}getSInt32(){const e=this.getUInt32();return e>>>1^-(1&e)}getSInt64(){return this._decodeSVarint()}getBool(){const e=0!==this._data[this._pos];return this._skip(1),e}getEnum(){return this._decodeVarint()}getFixed64(){const e=this._dataView,t=this._pos,r=e.getUint32(t,!0)+e.getUint32(t+4,!0)*o;return this._skip(8),r}getSFixed64(){const e=this._dataView,t=this._pos,r=e.getUint32(t,!0)+e.getInt32(t+4,!0)*o;return this._skip(8),r}getDouble(){const e=this._dataView.getFloat64(this._pos,!0);return this._skip(8),e}getFixed32(){const e=this._dataView.getUint32(this._pos,!0);return this._skip(4),e}getSFixed32(){const e=this._dataView.getInt32(this._pos,!0);return this._skip(4),e}getFloat(){const e=this._dataView.getFloat32(this._pos,!0);return this._skip(4),e}getString(){const e=this._getLength(),t=this._pos,r=this._toString(this._data,t,t+e);return this._skip(e),r}getBytes(){const e=this._getLength(),t=this._pos,r=this._toBytes(this._data,t,t+e);return this._skip(e),r}getLength(){return this._getLengthUnsafe()}processMessageWithArgs(e,t,r,n){const i=this.getMessage(),s=e(i,t,r,n);return i.release(),s}processMessage(e){const t=this.getMessage(),r=e(t);return t.release(),r}getMessage(){const e=this._getLength(),t=c.pool.acquire();return t._init(this._data,this._dataView,this._pos,this._pos+e),this._skip(e),t}release(){c.pool.release(this)}dataType(){return this._dataType}skip(){switch(this._dataType){case n.varint:this._decodeVarint();break;case n.fixed64:this._skip(8);break;case n.delimited:this._skip(this._getLength());break;case n.fixed32:this._skip(4);break;default:throw new Error("Invalid data type!")}}skipLen(e){this._skip(e)}_skip(e){if(this._pos+e>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=e}_decodeVarint(){const e=this._data;let t=this._pos,r=0,n=0;if(this._end-t>=10)do{if(n=e[t++],r|=127&n,!(128&n))break;if(n=e[t++],r|=(127&n)<<7,!(128&n))break;if(n=e[t++],r|=(127&n)<<14,!(128&n))break;if(n=e[t++],r|=(127&n)<<21,!(128&n))break;if(n=e[t++],r+=268435456*(127&n),!(128&n))break;if(n=e[t++],r+=34359738368*(127&n),!(128&n))break;if(n=e[t++],r+=4398046511104*(127&n),!(128&n))break;if(n=e[t++],r+=562949953421312*(127&n),!(128&n))break;if(n=e[t++],r+=72057594037927940*(127&n),!(128&n))break;if(n=e[t++],r+=0x8000000000000000*(127&n),!(128&n))break;throw new Error("Varint too long!")}while(0);else{let i=1;for(;t!==this._end&&(n=e[t],128&n);)++t,r+=(127&n)*i,i*=128;if(t===this._end)throw new Error("Varint overrun!");++t,r+=n*i}return this._pos=t,r}_decodeSVarint(){const e=this._data;let t,r=0,n=0;const i=1&e[this._pos];if(n=e[this._pos++],r|=127&n,!(128&n))return i?-(r+1)/2:r/2;if(n=e[this._pos++],r|=(127&n)<<7,!(128&n))return i?-(r+1)/2:r/2;if(n=e[this._pos++],r|=(127&n)<<14,!(128&n))return i?-(r+1)/2:r/2;if(n=e[this._pos++],r|=(127&n)<<21,!(128&n))return i?-(r+1)/2:r/2;if(n=e[this._pos++],r+=268435456*(127&n),!(128&n))return i?-(r+1)/2:r/2;if(n=e[this._pos++],r+=34359738368*(127&n),!(128&n))return i?-(r+1)/2:r/2;if(n=e[this._pos++],r+=4398046511104*(127&n),!(128&n))return i?-(r+1)/2:r/2;if(t=BigInt(r),n=e[this._pos++],t+=0x2000000000000n*BigInt(127&n),!(128&n))return Number(i?-(t+1n)/2n:t/2n);if(n=e[this._pos++],t+=0x100000000000000n*BigInt(127&n),!(128&n))return Number(i?-(t+1n)/2n:t/2n);if(n=e[this._pos++],t+=0x8000000000000000n*BigInt(127&n),!(128&n))return Number(i?-(t+1n)/2n:t/2n);throw new Error("Varint too long!")}_getLength(){if(this._dataType!==n.delimited)throw new Error("Not a delimited data type!");return this._decodeVarint()}_getLengthUnsafe(){return this.getUInt32()}_toString(e,t,r){if((r=Math.min(this._end,r))-t>u){const n=e.subarray(t,r);return l.decode(n)}let n="",i="";for(let s=t;s<r;++s){const t=e[s];128&t?i+="%"+t.toString(16):(n+=decodeURIComponent(i)+String.fromCharCode(t),i="")}return i.length&&(n+=decodeURIComponent(i)),n}_toBytes(e,t,r){return r=Math.min(this._end,r),new Uint8Array(e.buffer,t,r-t)}}c.pool=new a.A(c,void 0,(e=>{e._data=null,e._dataView=null}))},83324:function(e,t,r){r.d(t,{M:function(){return u},s:function(){return l}});var n=r(42042),i=r(93393),s=r(359),a=r(70891),o=r(96285);function l(e,t){const r=c[e.toLowerCase()];if(null==r)throw new i.L8(i.Z7.FunctionNotRecognized);if(t.length<r.minParams||t.length>r.maxParams)throw new i.L8(i.Z7.InvalidParameterCount,{name:e.toUpperCase()});return r.evaluate(t)}function u(e,t){const r=c[e.toLowerCase()];return null!=r&&t>=r.minParams&&t<=r.maxParams}const c={min:{minParams:1,maxParams:1,evaluate:e=>p(e[0],"min")},max:{minParams:1,maxParams:1,evaluate:e=>p(e[0],"max")},avg:{minParams:1,maxParams:1,evaluate:e=>d(e[0])},sum:{minParams:1,maxParams:1,evaluate:e=>function(e){if(null===e)return null;let t=0;for(let r=0;r<e.length;r++){const n=e[r];if(null!==n){if(!h(n))throw new i.L8(i.Z7.InvalidValueForAggregateFunction);t+=n}}return t}(e[0])},stddev:{minParams:1,maxParams:1,evaluate:e=>function(e){if(null===e)return null;const t=f(e);return null===t?null:Math.sqrt(t)}(e[0])},count:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:e[0].length},var:{minParams:1,maxParams:1,evaluate:e=>f(e[0])}};function d(e){if(null===e)return null;let t=0,r=0;for(let n=0;n<e.length;n++){const s=e[n];if(null!==s){if(!h(s))throw new i.L8(i.Z7.InvalidValueForAggregateFunction);r++,t+=s}}return 0===r?null:t/e.length}function h(e){return"number"==typeof e}function p(e,t){if(null===e)return null;let r=null,i=null;for(const l of e){let e=l;e=l instanceof n.n||l instanceof a.k?l.toNumber():l instanceof o.c9?l.toMillis():l instanceof s.g?l.toMilliseconds():l,(null===r||"max"===t&&null!==i&&null!==e&&i<=e||"min"===t&&null!==i&&null!==e&&i>=e)&&(r=l,i=e)}return r}function f(e){if(null===e)return null;if(0===(e=e.filter((e=>null!==e))).length)return null;const t=d(e);if(null===t)return null;let r=0;for(const n of e){if(!h(n))throw new i.L8(i.Z7.InvalidValueForAggregateFunction);r+=(t-n)**2}return r/(e.length-1)}},42042:function(e,t,r){r.d(t,{n:function(){return o}});var n=r(9688),i=r(22739),s=r(96285);function a(e){e=e.replaceAll(/LTS|LT|L{1,4}|l{1,4}/g,"[$&]");let t="";const r=/(\[[^[]*\])|(\\)?([Hh]mm(ss)?|Mo|M{1,4}|Do|DDDo|D{1,4}|d{2,4}|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;for(const n of e.match(r)||[])switch(n){case"D":t+="d";break;case"DD":t+="dd";break;case"DDD":t+="o";break;case"d":t+="c";break;case"ddd":t+="ccc";break;case"dddd":t+="cccc";break;case"M":t+="L";break;case"MM":t+="LL";break;case"MMM":t+="LLL";break;case"MMMM":t+="LLLL";break;case"YY":t+="yy";break;case"Y":case"YYYY":t+="yyyy";break;case"Q":t+="q";break;case"X":case"x":t+=n;break;default:n.length>=2&&"["===n.slice(0,1)&&"]"===n.slice(-1)?t+=`'${n.slice(1,-1)}'`:t+=`'${n}'`}return t}class o{constructor(e,t,r){this._year=e,this._month=t,this._day=r,this.declaredRootClass="esri.core.sql.dateonly"}get month(){return this._month}get monthJS(){return this._month-1}get year(){return this._year}get day(){return this._day}get isValid(){return this.toDateTime("unknown").isValid}equals(e){return e instanceof o&&e.day===this.day&&e.month===this.month&&e.year===this.year}clone(){return new o(this._year,this._month,this._day)}toDateTime(e){return s.c9.fromObject({day:this.day,month:this.month,year:this.year},{zone:(0,n.mT)(e)})}toDateTimeLuxon(e){return s.c9.fromObject({day:this.day,month:this.month,year:this.year},{zone:(0,n.mT)(e)})}toString(){return`${this.year.toString().padStart(4,"0")}-${this.month.toString().padStart(2,"0")}-${this.day.toString().padStart(2,"0")}`}toFormat(e=null,t=!0){if(null===e||""===e)return this.toString();if(t&&(e=a(e)),!e)return"";const r=this.toDateTime("unknown");return n.lY.dateTimeToArcadeDate(r).toFormat(e,{locale:(0,i.JK)(),numberingSystem:"latn"})}toArcadeDate(){const e=this.toDateTime("unknown");return n.lY.dateTimeToArcadeDate(e)}toNumber(){return this.toDateTime("unknown").toMillis()}toJSDate(){return this.toDateTime("unknown").toJSDate()}toStorageFormat(){return this.toFormat("yyyy-LL-dd",!1)}toSQLValue(){return this.toFormat("yyyy-LL-dd",!1)}toSQLWithKeyword(){return"date '"+this.toFormat("yyyy-LL-dd",!1)+"'"}plus(e,t){return o.fromDateTime(this.toUTCDateTime().plus({[e]:t}))}toUTCDateTime(){return s.c9.utc(this.year,this.month,this.day,0,0,0,0)}difference(e,t){switch(t.toLowerCase()){case"days":case"day":case"d":return this.toUTCDateTime().diff(e.toUTCDateTime(),"days").days;case"months":case"month":return this.toUTCDateTime().diff(e.toUTCDateTime(),"months").months;case"minutes":case"minute":case"m":return"M"===t?this.toUTCDateTime().diff(e.toUTCDateTime(),"months").months:this.toUTCDateTime().diff(e.toUTCDateTime(),"minutes").minutes;case"seconds":case"second":case"s":return this.toUTCDateTime().diff(e.toUTCDateTime(),"seconds").seconds;case"milliseconds":case"millisecond":case"ms":default:return this.toUTCDateTime().diff(e.toUTCDateTime(),"milliseconds").milliseconds;case"hours":case"hour":case"h":return this.toUTCDateTime().diff(e.toUTCDateTime(),"hours").hours;case"years":case"year":case"y":return this.toUTCDateTime().diff(e.toUTCDateTime(),"years").years}}static fromMilliseconds(e){const t=s.c9.fromMillis(e,{zone:s.mQ.utcInstance});return t.isValid?o.fromParts(t.year,t.month,t.day):null}static fromSeconds(e){const t=s.c9.fromSeconds(e,{zone:s.mQ.utcInstance});return t.isValid?o.fromParts(t.year,t.month,t.day):null}static fromReader(e){if(!e)return null;const t=e.split("-");return 3!==t.length?null:new o(parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2],10))}static fromParts(e,t,r){const n=new o(e,t,r);return!1===n.isValid?null:n}static fromDateJS(e){return o.fromParts(e.getFullYear(),e.getMonth()+1,e.getDay())}static fromDateTime(e){return o.fromParts(e.year,e.month,e.day)}static fromSqlTimeStampOffset(e){return this.fromDateTime(e.toDateTime())}static fromString(e,t=null){if(""===e)return null;if(null===e)return null;const r=[];if(t)(t=a(t))&&r.push(t);else if(null===t||""===t){const t=s.c9.fromISO(e,{setZone:!0});return t.isValid?o.fromParts(t.year,t.month,t.day):null}for(const n of r){const r=s.c9.fromFormat(e,t??n);if(r.isValid)return new o(r.year,r.month,r.day)}return null}static fromNow(e="system"){const t=s.c9.fromJSDate(new Date).setZone((0,n.mT)(e));return new o(t.year,t.month,t.day)}}},359:function(e,t,r){r.d(t,{g:function(){return s}});var n=r(96285);function i(e){return Number.isNaN(e)||0===e?e:Math.trunc(e)}class s{constructor(e){this._timeStampOffset=e,this._date=null}toDateTime(){return this._date??=n.c9.fromISO(this._timeStampOffset,{setZone:!0}),this._date}get isValid(){return this.toDateTime().isValid}get timezoneOffsetHour(){return i(this.toDateTime().offset/60)}get timezoneOffsetMinutes(){return i(this.toDateTime().offset%60)}toMilliseconds(){return this.toDateTime().toMillis()}get hour(){return this.toDateTime().hour}get minute(){return this.toDateTime().minute}get second(){return this.toDateTime().second}get day(){return this.toDateTime().day}get month(){return this.toDateTime().month}get year(){return this.toDateTime().year}startOfDay(){return s.fromDateTime(this.toDateTime().startOf("day"))}static fromJSDate(e){return new s(n.c9.fromJSDate(e).toISO({includeOffset:!0}))}static fromDateTime(e){return new s(e.toISO({includeOffset:!0}))}static fromParts(e,t,r=0,n=0,i=0,a=0,o=0,l=!1,u=0,c=0){const d=`${e.toString().padStart(4,"0")}-${t.toString().padStart(2,"0")}-${r.toString().padStart(2,"0")}`;let h="";a<10&&(h="0");let p=`${n.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}:${h+a.toString()}`;0!==o&&(p+="."+o.toString().padStart(3,"0"));const f=`${l?"-":"+"}${u.toString().padStart(2,"0")}:${c.toString().padStart(2,"0")}`;return new s(d+"T"+p+f)}toStorageFormat(){return this._timeStampOffset}toString(){return this._timeStampOffset}toSQLValue(){let e=this.toDateTime().toSQL({includeOffset:!0,includeOffsetSpace:!0});return e&&(e=e.replace(".000","")),e}toSQLWithKeyword(){return`timestamp '${this.toSQLValue()}'`}addMilliseconds(e){const t=this.toDateTime().plus(e);return s.fromDateTime(t)}}},70891:function(e,t,r){r.d(t,{k:function(){return o}});var n=r(80749),i=r(22739),s=r(96285);function a(e){if(!e)return"";const t=/(a|A|hh?|HH?|mm?|ss?|SSS|S|.)/g;let r="";for(const n of e.match(t)||[])switch(n){case"SSS":case"m":case"mm":case"h":case"hh":case"H":case"HH":case"s":case"ss":r+=n;break;case"A":case"a":r+="a";break;default:r+=`'${n}'`}return r}class o{constructor(e,t,r,n){this._hour=e,this._minute=t,this._second=r,this._millisecond=n,this.declaredRootClass="esri.core.sql.timeonly"}get hour(){return this._hour}get minute(){return this._minute}get second(){return this._second}get millisecond(){return this._millisecond}equals(e){return e instanceof o&&e.hour===this.hour&&e.minute===this.minute&&e.second===this.second&&e.millisecond===this.millisecond}clone(){return new o(this.hour,this.minute,this.second,this.millisecond)}isValid(){return(0,n.Fq)(this.hour)&&(0,n.Fq)(this.minute)&&(0,n.Fq)(this.second)&&(0,n.Fq)(this.millisecond)&&this.hour>=0&&this.hour<24&&this.minute>=0&&this.minute<60&&this.second>=0&&this.second<60&&this.millisecond>=0&&this.millisecond<1e3}toString(){return`${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}`+(this.millisecond>0?"."+this.millisecond.toString().padStart(3,"0"):"")}toSQLValue(){return this.toString()}toSQLWithKeyword(){return`time '${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}${this.millisecond>0?"."+this.millisecond.toString().padStart(3,"0"):""}'`}toStorageString(){return`${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}`}toFormat(e=null){return null===e||""===e?this.toString():(e=a(e))?s.c9.local(1970,1,1,this._hour,this._minute,this._second,this._millisecond).toFormat(e,{locale:(0,i.JK)(),numberingSystem:"latn"}):""}toNumber(){return this.millisecond+1e3*this.second+1e3*this.minute*60+60*this.hour*60*1e3}static fromParts(e,t,r,n){const i=new o(e,t,r,n);return i.isValid()?i:null}static fromReader(e){if(!e)return null;const t=e.split(":");return 3!==t.length?null:new o(parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2],10),0)}static fromMilliseconds(e){if(e>864e5||e<0)return null;const t=Math.floor(e/1e3%60),r=Math.floor(e/6e4%60),n=Math.floor(e/36e5%24),i=Math.floor(e%1e3);return new o(n,r,t,i)}static fromDateJS(e){return new o(e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds())}static fromDateTime(e){return new o(e.hour,e.minute,e.second,e.millisecond)}static fromSqlTimeStampOffset(e){return this.fromDateTime(e.toDateTime())}static fromString(e,t=null){if(""===e)return null;if(null===e)return null;const r=[];t?(t=a(t))&&r.push(t):null!==t&&""!==t||(r.push("HH:mm:ss"),r.push("HH:mm:ss.SSS"),r.push("hh:mm:ss a"),r.push("hh:mm:ss.SSS a"),r.push("HH:mm"),r.push("hh:mm a"),r.push("H:mm"),r.push("h:mm a"),r.push("H:mm:ss"),r.push("h:mm:ss a"),r.push("H:mm:ss.SSS"),r.push("h:mm:ss.SSS a"));for(const t of r){const r=s.c9.fromFormat(e,t);if(r.isValid)return new o(r.hour,r.minute,r.second,r.millisecond)}return null}plus(e,t){switch(e){case"days":case"years":case"months":return this.clone();case"hours":case"minutes":case"seconds":case"milliseconds":return o.fromDateTime(this.toUTCDateTime().plus({[e]:t}))}return null}toUTCDateTime(){return s.c9.utc(1970,1,1,this.hour,this.minute,this.second,this.millisecond)}difference(e,t){switch(t.toLowerCase()){case"days":case"day":case"d":return this.toUTCDateTime().diff(e.toUTCDateTime(),"days").days;case"months":case"month":return this.toUTCDateTime().diff(e.toUTCDateTime(),"months").months;case"minutes":case"minute":case"m":return"M"===t?this.toUTCDateTime().diff(e.toUTCDateTime(),"months").months:this.toUTCDateTime().diff(e.toUTCDateTime(),"minutes").minutes;case"seconds":case"second":case"s":return this.toUTCDateTime().diff(e.toUTCDateTime(),"seconds").seconds;case"milliseconds":case"millisecond":case"ms":default:return this.toUTCDateTime().diff(e.toUTCDateTime(),"milliseconds").milliseconds;case"hours":case"hour":case"h":return this.toUTCDateTime().diff(e.toUTCDateTime(),"hours").hours;case"years":case"year":case"y":return this.toUTCDateTime().diff(e.toUTCDateTime(),"years").years}}}},92955:function(e,t,r){r.d(t,{GB:function(){return i},Qo:function(){return a},Y4:function(){return s}});var n=r(96285);class i{}function s(e){return e instanceof n.bo?e===i.instance:"unknown"===e?.toString().toLowerCase()}function a(e){return s(e)?i.instance:e}i.instance=new n.oh("Etc/UTC")},16177:function(e,t,r){r.r(t),r.d(t,{WhereClause:function(){return te},defaultAttributeAdapter:function(){return he}});var n=r(9688),i=r(58941),s=r(83324),a=r(42042),o=r(93393);class l{constructor(){this.op="+",this.day=0,this.second=0,this.hour=0,this.month=0,this.year=0,this.minute=0,this.millis=0}static _fixDefaults(e){if(null!==e.precision||null!==e.secondary)throw new o.L8(o.Z7.PrimarySecondaryQualifiers)}static _parseSecondsComponent(e,t){if(t.includes(".")){const r=t.split(".");e.second=parseFloat(r[0]),e.millis=parseInt(r[1],10)}else e.second=parseFloat(t)}static createFromMilliseconds(e){const t=new l;return t.second=e/1e3,t}static createFromValueAndQualifier(e,t,r){let n=null;const i=new l;if(i.op="-"===r?"-":"+","interval-period"===t.type){l._fixDefaults(t);const r=new RegExp("^[0-9]{1,}$");if("year"===t.period||"month"===t.period)throw new o.L8(o.Z7.YearMonthIntervals);if("second"===t.period){if(!/^[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/.test(e))throw new o.L8(o.Z7.IllegalInterval);l._parseSecondsComponent(i,e)}else{if(!r.test(e))throw new o.L8(o.Z7.IllegalInterval);i[t.period]=parseFloat(e)}}else{if(l._fixDefaults(t.start),l._fixDefaults(t.end),"year"===t.start.period||"month"===t.start.period||"year"===t.end.period||"month"===t.end.period)throw new o.L8(o.Z7.YearMonthIntervals);switch(t.start.period){case"day":switch(t.end.period){case"hour":if(n=new RegExp("^[0-9]{1,} [0-9]{1,}$"),!n.test(e))throw new o.L8(o.Z7.IllegalInterval);i[t.start.period]=parseFloat(e.split(" ")[0]),i[t.end.period]=parseFloat(e.split(" ")[1]);break;case"minute":if(n=new RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,}$"),!n.test(e))throw new o.L8(o.Z7.IllegalInterval);{i[t.start.period]=parseFloat(e.split(" ")[0]);const r=e.split(" ")[1].split(":");i.hour=parseFloat(r[0]),i.minute=parseFloat(r[1])}break;case"second":if(n=new RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$"),!n.test(e))throw new o.L8(o.Z7.IllegalInterval);{i[t.start.period]=parseFloat(e.split(" ")[0]);const r=e.split(" ")[1].split(":");i.hour=parseFloat(r[0]),i.minute=parseFloat(r[1]),l._parseSecondsComponent(i,r[2])}break;default:throw new o.L8(o.Z7.IllegalInterval)}break;case"hour":switch(t.end.period){case"minute":if(n=new RegExp("^[0-9]{1,}:[0-9]{1,}$"),!n.test(e))throw new o.L8(o.Z7.IllegalInterval);i.hour=parseFloat(e.split(":")[0]),i.minute=parseFloat(e.split(":")[1]);break;case"second":if(n=new RegExp("^[0-9]{1,}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$"),!n.test(e))throw new o.L8(o.Z7.IllegalInterval);{const t=e.split(":");i.hour=parseFloat(t[0]),i.minute=parseFloat(t[1]),l._parseSecondsComponent(i,t[2])}break;default:throw new o.L8(o.Z7.IllegalInterval)}break;case"minute":if("second"!==t.end.period)throw new o.L8(o.Z7.IllegalInterval);if(n=new RegExp("^[0-9]{1,}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$"),!n.test(e))throw new o.L8(o.Z7.IllegalInterval);{const t=e.split(":");i.minute=parseFloat(t[0]),l._parseSecondsComponent(i,t[1])}break;default:throw new o.L8(o.Z7.IllegalInterval)}}return i}valueInMilliseconds(){return("-"===this.op?-1:1)*(this.millis+1e3*this.second+60*this.minute*1e3+60*this.hour*60*1e3+24*this.day*60*60*1e3+this.month*(365/12)*24*60*60*1e3+365*this.year*24*60*60*1e3)}}var u=r(359),c=r(70891),d=r(92955),h=r(96285);const p=/^(\d{1,2}):(\d{1,2}):(\d{1,2})$/,f=/^(\d{1,2}):(\d{1,2})$/,m=/^(\d{1,2}):(\d{1,2}):(\d{1,2}).([0-9]+)$/,y=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,g=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?$/,v=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?[ ]{0,1}(\+|-)(\d{1,2}):(\d{1,2})$/,_=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})?[ ]{0,1}(\+|-)(\d{1,2}):(\d{1,2})$/,w=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/;function b(e,t){if(t instanceof h.bo)return t===d.GB.instance?h.c9.fromMillis(e.getTime(),{zone:d.GB.instance}):h.c9.fromJSDate(e,{zone:t});switch(t){case"system":case"local":case null:return h.c9.fromJSDate(e);default:return"unknown"===t?.toLowerCase()?h.c9.fromMillis(e.getTime(),{zone:d.GB.instance}):h.c9.fromJSDate(e,{zone:t})}}function T(e){return"number"==typeof e}function S(e){return"string"==typeof e||e instanceof String}function I(e){return e instanceof l}function x(e){return e instanceof Date}function M(e){return e instanceof h.c9}function F(e){return e instanceof a.n}function L(e){return e instanceof c.k}function E(e){return e instanceof u.g}function A(e){let t=p.exec(e);if(null!==t){const[,e,r,n]=t,i=c.k.fromParts(parseInt(e,10),parseInt(r,10),parseInt(n,10),0);if(null!==i)return i;throw new o.L8(o.Z7.InvalidTime)}if(t=f.exec(e),null!==t){const[,e,r]=t,n=c.k.fromParts(parseInt(e,10),parseInt(r,10),0,0);if(null!==n)return n;throw new o.L8(o.Z7.InvalidTime)}if(t=m.exec(e),null!==t){const[,e,r,n,i]=t,s=c.k.fromParts(parseInt(e,10),parseInt(r,10),parseInt(n,10),parseInt(i,10));if(null!==s)return s;throw new o.L8(o.Z7.InvalidTime)}throw new o.L8(o.Z7.InvalidTime)}function R(e,t,r=!1){let n=g.exec(e);if(null!==n){const[,e,r,i,s,a,l,u]=n,c=h.c9.fromObject({year:parseInt(e,10),month:parseInt(r,10),day:parseInt(i,10),hour:parseInt(s,10),minute:parseInt(a,10),second:parseInt(l,10),millisecond:u?parseInt(u.replace(".",""),10):0},{zone:(0,d.Qo)(t)});if(!1===c.isValid)throw new o.L8(o.Z7.InvalidTimeStamp);return c}if(n=v.exec(e),null!==n){const[,e,t,r,i,s,a,l,c,d,h]=n,p=u.g.fromParts(parseInt(e,10),parseInt(t,10),parseInt(r,10),parseInt(i,10),parseInt(s,10),parseInt(a,10),l?parseInt(l.replace(".",""),10):0,"-"===c,parseInt(d,10),parseInt(h,10));if(!1===p.isValid)throw new o.L8(o.Z7.InvalidTimeStamp);return p}if(n=_.exec(e),null!==n){const[,e,t,r,i,s,a,l,c]=n,d=u.g.fromParts(parseInt(e,10),parseInt(t,10),parseInt(r,10),parseInt(i,10),parseInt(s,10),0,0,"-"===a,parseInt(l,10),parseInt(c,10));if(!1===d.isValid)throw new o.L8(o.Z7.InvalidTimeStamp);return d}if(n=w.exec(e),null!==n){const[,e,r,i,s,a]=n,l=h.c9.fromObject({year:parseInt(e,10),month:parseInt(r,10),day:parseInt(i,10),hour:parseInt(s,10),minute:parseInt(a,10),second:0},{zone:(0,d.Qo)(t)});if(!1===l.isValid)throw new o.L8(o.Z7.InvalidTimeStamp);return l}if(n=y.exec(e),null!==n){const[,e,r,i]=n,s=h.c9.fromObject({year:parseInt(e,10),month:parseInt(r,10),day:parseInt(i,10),hour:0,minute:0,second:0},{zone:(0,d.Qo)(t)});if(!1===s.isValid)throw new o.L8(o.Z7.InvalidTimeStamp);return s}throw new o.L8(o.Z7.InvalidTimeStamp)}function N(e,t){const r=y.exec(e);if(null===r)try{return R(e,t)}catch{throw new o.L8(o.Z7.InvalidDate)}const[,n,i,s]=r,l=a.n.fromParts(parseInt(n,10),parseInt(i,10),parseInt(s,10));if(null===l)throw new o.L8(o.Z7.InvalidDate);return l}var C=r(15774),O=r(50944);function k(e){return!!M(e)||!!E(e)}function D(e){return!!(M(e)||F(e)||E(e)||L(e))}function P(e){if(M(e))return e.toMillis();if(F(e))return e.toNumber();if(E(e))return e.toMilliseconds();throw new o.L8(o.Z7.InvalidDataType)}function U(e,t,r,n){if(null==e||null==t)return null;if(T(e)){if(T(t))return Z(e,t,r);if(S(t))return function(e,t,r){const n=parseFloat(t);if(!isNaN(n))return Z(e,n,r);const i=e.toString();switch(r){case"<>":return i!==t;case"=":return i===t;case">":return i>t;case"<":return i<t;case">=":return i>=t;case"<=":return i<=t}}(e,t,r);if(D(t))throw new o.L8(o.Z7.InvalidOperator);if(F(t))throw new o.L8(o.Z7.InvalidOperator)}else if(S(e)){if(T(t))return function(e,t,r){const n=parseFloat(e);if(!isNaN(n))return Z(n,t,r);const i=t.toString();switch(r){case"<>":return e!==i;case"=":return e===i;case">":return e>i;case"<":return e<i;case">=":return e>=i;case"<=":return e<=i}}(e,t,r);if(S(t))return function(e,t,r){switch(r){case"<>":return e!==t;case"=":return e===t;case">":return e>t;case"<":return e<t;case">=":return e>=t;case"<=":return e<=t}}(e,t,r);if(M(t))throw new o.L8(o.Z7.InvalidOperator);if(F(t))throw new o.L8(o.Z7.InvalidOperator);if(L(t))throw new o.L8(o.Z7.InvalidOperator);if(E(t))throw new o.L8(o.Z7.InvalidOperator)}else if(M(e)){if(k(t)){if(e instanceof h.c9&&(0,d.Y4)(e.zone)){if(t instanceof h.c9&&!1===(0,d.Y4)(t.zone))return z(e,t,r);if(t instanceof u.g)return z(e,t,r)}else if(t instanceof h.c9&&(0,d.Y4)(t.zone)){if(e instanceof h.c9&&!1===(0,d.Y4)(e.zone))return z(e,t,r);if(e instanceof u.g)return z(e,t,r)}return Z(P(e),P(t),r)}if(S(t))throw new o.L8(o.Z7.InvalidOperator);if(F(t))return function(e,t,r){const n=t.toDateTimeLuxon(e.zone);return Z((e=e.startOf("day")).toMillis(),n.toMillis(),r)}(e,t,r);if(L(t))throw new o.L8(o.Z7.InvalidOperator);if(T(t))throw new o.L8(o.Z7.InvalidOperator)}else if(F(e)){if(E(t))return function(e,t,r){const n=e.toDateTimeLuxon(t.toDateTime().zone);return t=t.startOfDay(),Z(n.toMillis(),t.toMilliseconds(),r)}(e,t,r);if(M(t))return function(e,t,r){const n=e.toDateTimeLuxon(t.zone);return t=t.startOf("day"),Z(n.toMillis(),t.toMillis(),r)}(e,t,r);if(S(t))throw new o.L8(o.Z7.InvalidOperator);if(F(t))return Z(e.toNumber(),t.toNumber(),r);if(L(t))throw new o.L8(o.Z7.InvalidOperator);if(T(t))throw new o.L8(o.Z7.InvalidOperator)}else if(L(e)){if(L(t))return Z(e.toNumber(),t.toNumber(),r);if(S(t))throw new o.L8(o.Z7.InvalidOperator);if(T(t))throw new o.L8(o.Z7.InvalidOperator);if(F(t))throw new o.L8(o.Z7.InvalidOperator);if(k(t))throw new o.L8(o.Z7.InvalidOperator)}else if(E(e)){if(k(t))return t instanceof h.c9&&(0,d.Y4)(t.zone)?z(e,t,r):Z(P(e),P(t),r);if(S(t))throw new o.L8(o.Z7.InvalidOperator);if(F(t))return function(e,t,r){const n=t.toDateTimeLuxon(e.toDateTime().zone);return Z((e=e.startOfDay()).toMilliseconds(),n.toMillis(),r)}(e,t,r);if(L(t))throw new o.L8(o.Z7.InvalidOperator);if(T(t))throw new o.L8(o.Z7.InvalidOperator)}switch(r){case"<>":return e!==t;case"=":return e===t;case">":return e>t;case"<":return e<t;case">=":return e>=t;case"<=":return e<=t}}function Z(e,t,r){switch(r){case"<>":return e!==t;case"=":return e===t;case">":return e>t;case"<":return e<t;case">=":return e>=t;case"<=":return e<=t}}function z(e,t,r){e instanceof u.g&&(e=e.toDateTime()),t instanceof u.g&&(t=t.toDateTime());const n=V(e),i=V(t);switch(r){case"<>":return n!==i;case"=":return n===i;case">":return n>i;case"<":return n<i;case">=":return n>=i;case"<=":return n<=i}}function V(e){return 321408e5*e.year+26784e5*e.month+864e5*e.day+36e5*e.hour+6e4*e.minute+1e3*e.second+e.millisecond}function G(e,t,r){const n=H[e.toLowerCase()];if(null==n)throw new o.L8(o.Z7.FunctionNotRecognized);if(t.length<n.minParams||t.length>n.maxParams)throw new o.L8(o.Z7.InvalidParameterCount,{name:e.toUpperCase()});return n.evaluate(t,r)}function q(e){return"string"==typeof e||e instanceof String}function B(e){return!(x(e)||F(e)||M(e)||L(e)||E(e))}function j(e){return F(e)||L(e)?e.toString():E(e)?e.toSQLValue():M(e)?0===e.millisecond?e.toFormat("yyyy-LL-dd HH:mm:ss"):e.toSQL({includeOffset:!1}):x(e)?j(h.c9.fromJSDate(e)):e.toString()}const H={extract:{minParams:2,maxParams:2,evaluate:([e,t])=>{if(null==t)return null;if(x(t))switch(e.toUpperCase()){case"SECOND":return t.getSeconds();case"MINUTE":return t.getMinutes();case"HOUR":return t.getHours();case"DAY":return t.getDate();case"MONTH":return t.getMonth()+1;case"YEAR":return t.getFullYear();case"TIMEZONE_HOUR":case"TIMEZONE_MINUTE":return 0}else if(M(t))switch(e.toUpperCase()){case"SECOND":return t.second;case"MINUTE":return t.minute;case"HOUR":return t.hour;case"DAY":return t.day;case"MONTH":return t.month;case"YEAR":return t.year;case"TIMEZONE_HOUR":case"TIMEZONE_MINUTE":throw new o.L8(o.Z7.InvalidFunctionParameters,{function:"EXTRACT"})}else if(F(t))switch(e.toUpperCase()){case"DAY":return t.day;case"MONTH":return t.month;case"YEAR":return t.year;case"TIMEZONE_HOUR":case"TIMEZONE_MINUTE":throw new o.L8(o.Z7.InvalidFunctionParameters,{function:"EXTRACT"})}else if(L(t))switch(e.toUpperCase()){case"SECOND":return t.second;case"MINUTE":return t.minute;case"HOUR":return t.hour}else if(E(t))switch(e.toUpperCase()){case"SECOND":return t.second;case"MINUTE":return t.minute;case"HOUR":return t.hour;case"DAY":return t.day;case"MONTH":return t.month;case"YEAR":return t.year;case"TIMEZONE_HOUR":return t.timezoneOffsetHour;case"TIMEZONE_MINUTE":return t.timezoneOffsetMinutes}throw new o.L8(o.Z7.InvalidFunctionParameters,{function:"EXTRACT"})}},substring:{minParams:2,maxParams:3,evaluate:e=>{if(2===e.length){const[t,r]=e;return null==t||null==r?null:t.toString().substring(r-1)}if(3===e.length){const[t,r,n]=e;return null==t||null==r||null==n?null:n<=0?"":t.toString().substring(r-1,r+n-1)}}},position:{minParams:2,maxParams:2,evaluate:([e,t])=>null==e||null==t?null:t.indexOf(e)+1},trim:{minParams:2,maxParams:3,evaluate:e=>{const t=3===e.length,r=t?e[1]:" ",n=t?e[2]:e[1];if(null==r||null==n)return null;const i=`(${(0,O.Cj)(r)})`;switch(e[0]){case"BOTH":return n.replaceAll(new RegExp(`^${i}*|${i}*$`,"g"),"");case"LEADING":return n.replaceAll(new RegExp(`^${i}*`,"g"),"");case"TRAILING":return n.replaceAll(new RegExp(`${i}*$`,"g"),"")}throw new o.L8(o.Z7.InvalidFunctionParameters,{function:"TRIM"})}},abs:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.abs(e[0])},ceiling:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.ceil(e[0])},floor:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.floor(e[0])},log:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.log(e[0])},log10:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.log(e[0])*Math.LOG10E},sin:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.sin(e[0])},cos:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.cos(e[0])},tan:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.tan(e[0])},asin:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.asin(e[0])},acos:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.acos(e[0])},atan:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.atan(e[0])},sign:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:e[0]>0?1:e[0]<0?-1:0},power:{minParams:2,maxParams:2,evaluate:e=>null==e[0]||null==e[1]?null:e[0]**e[1]},mod:{minParams:2,maxParams:2,evaluate:e=>null==e[0]||null==e[1]?null:e[0]%e[1]},round:{minParams:1,maxParams:2,evaluate:e=>{const t=e[0],r=2===e.length?10**e[1]:1;return null==t?null:Math.round(t*r)/r}},truncate:{minParams:1,maxParams:2,evaluate:e=>null==e[0]?null:1===e.length||0===e[1]?Math.trunc(e[0]):(0,C.pF)("trunc",e[0],-Number(e[1]))},char_length:{minParams:1,maxParams:1,evaluate:e=>q(e[0])?e[0].length:0},concat:{minParams:1,maxParams:1/0,evaluate:e=>{let t="";for(let r=0;r<e.length;r++){if(null==e[r])return null;t+=e[r].toString()}return t}},lower:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:e[0].toString().toLowerCase()},upper:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:e[0].toString().toUpperCase()},coalesce:{minParams:1,maxParams:1/0,evaluate:e=>{for(const t of e)if(null!==t)return t;return null}},cosh:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.cosh(e[0])},sinh:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.sinh(e[0])},tanh:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.tanh(e[0])},nullif:{minParams:2,maxParams:2,evaluate:(e,t)=>U(e[0],e[1],"=")?null:e[0]},cast:{minParams:2,maxParams:2,evaluate:(e,t)=>{const r=e[0],n=e[1];if(null===r)return null;switch(n.type){case"integer":{if(!B(r))throw new o.L8(o.Z7.CannotCastValue);const e=parseInt(r,10);if(isNaN(e))throw new o.L8(o.Z7.CannotCastValue);return e}case"smallint":{if(!B(r))throw new o.L8(o.Z7.CannotCastValue);const e=parseInt(r,10);if(isNaN(e))throw new o.L8(o.Z7.CannotCastValue);if(e>32767||e<-32767)throw new o.L8(o.Z7.CannotCastValue);return e}case"float":case"real":{if(!B(r))throw new o.L8(o.Z7.CannotCastValue);const e=parseFloat(r);if(isNaN(e))throw new o.L8(o.Z7.CannotCastValue);return e}case"time":return function(e){if(x(e))return c.k.fromDateJS(e);if(M(e))return c.k.fromDateTime(e);if(F(e))throw new o.L8(o.Z7.CannotCastValue);if(L(e))return e;if(E(e))return c.k.fromSqlTimeStampOffset(e);if(q(e))return A(e);throw new o.L8(o.Z7.CannotCastValue)}(r);case"date":return function(e){if(x(e))return a.n.fromDateJS(e);if(M(e))return a.n.fromParts(e.year,e.month,e.day);if(F(e))return e;if(L(e))throw new o.L8(o.Z7.CannotCastValue);if(E(e)&&null===a.n.fromParts(e.year,e.month,e.day))throw new o.L8(o.Z7.CannotCastValue);if(q(e)){const t=a.n.fromReader(e);if(null!==t&&t.isValid)return t}throw new o.L8(o.Z7.CannotCastValue)}(r);case"timestamp":return function(e,t,r){if(x(e))return b(e,t);if(M(e))return e;if(F(e))return e.toDateTimeLuxon("unknown");if(L(e))throw new o.L8(o.Z7.CannotCastValue);if(E(e))return e;if(q(e))return R(e,"unknown",r);throw new o.L8(o.Z7.CannotCastValue)}(r,t,!0===n.withtimezone);case"varchar":{const e=j(r);if(e.length>n.size)throw new o.L8(o.Z7.CannotCastValue);return e}default:throw new o.L8(o.Z7.InvalidDataType)}}}};function $(e,t,r,n){if("||"===e)return G("concat",[t,r],n);if(null===t||null===r)return null;if(T(t)){if(T(r))return J(t,r,e);if(I(r))return function(e,t,r){switch(r){case"+":return l.createFromMilliseconds(e+t.valueInMilliseconds());case"-":return l.createFromMilliseconds(e-t.valueInMilliseconds());case"*":return l.createFromMilliseconds(e*t.valueInMilliseconds());case"/":return l.createFromMilliseconds(e/t.valueInMilliseconds())}throw new o.L8(o.Z7.InvalidOperator)}(t,r,e);if(L(r))return function(){throw new o.L8(o.Z7.InvalidOperator)}();if(F(r))return function(){throw new o.L8(o.Z7.InvalidOperator)}();if(E(r))return function(){throw new o.L8(o.Z7.InvalidOperator)}();if(M(r))return function(){throw new o.L8(o.Z7.InvalidOperator)}();if(S(r))return function(e,t,r){const n=parseFloat(t);if(isNaN(n))throw new o.L8(o.Z7.InvalidOperator);return J(e,n,r)}(t,r,e);throw new o.L8(o.Z7.InvalidOperator)}if(F(t)){if(T(r))return function(e,t,r){const n=1e3*t*24*60*60;switch(r){case"+":return e.plus("milliseconds",n);case"-":return e.plus("milliseconds",-1*n)}throw new o.L8(o.Z7.InvalidOperator)}(t,r,e);if(I(r))return function(e,t,r){switch(r){case"+":return e.plus("milliseconds",t.valueInMilliseconds());case"-":return e.plus("milliseconds",-1*t.valueInMilliseconds())}throw new o.L8(o.Z7.InvalidOperator)}(t,r,e);if(L(r))return function(){throw new o.L8(o.Z7.InvalidOperator)}();if(F(r))return function(e,t,r){if("-"===r)return e.toDateTimeLuxon("UTC").diff(t.toDateTimeLuxon("UTC")).as("days");throw new o.L8(o.Z7.InvalidOperator)}(t,r,e);if(E(r))return function(e,t,r){if("-"===r)return e.toDateTimeLuxon(t.toDateTime().zone).diff(t.toDateTime()).as("days");throw new o.L8(o.Z7.InvalidOperator)}(t,r,e);if(M(r))return function(e,t,r){if("-"===r)return e.toDateTimeLuxon(t.zone).diff(t).as("days");throw new o.L8(o.Z7.InvalidOperator)}(t,r,e);if(S(r))return function(){throw new o.L8(o.Z7.InvalidOperator)}();throw new o.L8(o.Z7.InvalidOperator)}if(L(t)){if(T(r))return function(e,t,r){const n=1e3*t*24*60*60;switch(r){case"+":return e.plus("milliseconds",n);case"-":return e.plus("milliseconds",-1*n)}throw new o.L8(o.Z7.InvalidOperator)}(t,r,e);if(I(r))return function(e,t,r){switch(r){case"+":return e.plus("milliseconds",t.valueInMilliseconds());case"-":return e.plus("milliseconds",-1*t.valueInMilliseconds())}throw new o.L8(o.Z7.InvalidOperator)}(t,r,e);if(L(r))return function(){throw new o.L8(o.Z7.InvalidOperator)}();if(F(r))return function(){throw new o.L8(o.Z7.InvalidOperator)}();if(E(r))return function(){throw new o.L8(o.Z7.InvalidOperator)}();if(M(r))return function(){throw new o.L8(o.Z7.InvalidOperator)}();if(S(r))return function(){throw new o.L8(o.Z7.InvalidOperator)}();throw new o.L8(o.Z7.InvalidOperator)}if(I(t)){if(T(r))return function(e,t,r){switch(r){case"+":return l.createFromMilliseconds(e.valueInMilliseconds()+t);case"-":return l.createFromMilliseconds(e.valueInMilliseconds()-t);case"*":return l.createFromMilliseconds(e.valueInMilliseconds()*t);case"/":return l.createFromMilliseconds(e.valueInMilliseconds()/t)}throw new o.L8(o.Z7.InvalidOperator)}(t,r,e);if(I(r))return function(e,t,r){switch(r){case"+":return l.createFromMilliseconds(e.valueInMilliseconds()+t.valueInMilliseconds());case"-":return l.createFromMilliseconds(e.valueInMilliseconds()-t.valueInMilliseconds());case"*":return l.createFromMilliseconds(e.valueInMilliseconds()*t.valueInMilliseconds());case"/":return l.createFromMilliseconds(e.valueInMilliseconds()/t.valueInMilliseconds())}throw new o.L8(o.Z7.InvalidOperator)}(t,r,e);if(L(r))return function(e,t,r){if("+"===r)return t.plus("milliseconds",e.valueInMilliseconds());throw new o.L8(o.Z7.InvalidOperator)}(t,r,e);if(F(r))return function(e,t,r){if("+"===r)return t.plus("milliseconds",e.valueInMilliseconds());throw new o.L8(o.Z7.InvalidOperator)}(t,r,e);if(E(r))return function(e,t,r){if("+"===r)return t.addMilliseconds(e.valueInMilliseconds());throw new o.L8(o.Z7.InvalidOperator)}(t,r,e);if(M(r))return function(e,t,r){switch(r){case"+":return t.plus({milliseconds:e.valueInMilliseconds()});case"-":return e.valueInMilliseconds()-t.toMillis()}throw new o.L8(o.Z7.InvalidOperator)}(t,r,e);if(S(r))return function(){throw new o.L8(o.Z7.InvalidOperator)}();throw new o.L8(o.Z7.InvalidOperator)}if(M(t)){if(T(r))return function(e,t,r){const n=1e3*t*24*60*60;switch(r){case"+":return e.plus({milliseconds:n});case"-":return e.minus({milliseconds:n})}throw new o.L8(o.Z7.InvalidOperator)}(t,r,e);if(I(r))return function(e,t,r){switch(r){case"+":return e.plus({milliseconds:t.valueInMilliseconds()});case"-":return e.minus({milliseconds:t.valueInMilliseconds()})}throw new o.L8(o.Z7.InvalidOperator)}(t,r,e);if(L(r))return function(){throw new o.L8(o.Z7.InvalidOperator)}();if(F(r))return function(e,t,r){if("-"===r)return e.diff(t.toDateTimeLuxon(e.zone)).as("days");throw new o.L8(o.Z7.InvalidOperator)}(t,r,e);if(E(r))return function(e,t,r){if("-"===r)return e.diff(t.toDateTime()).as("days");throw new o.L8(o.Z7.InvalidOperator)}(t,r,e);if(M(r))return function(e,t,r){if("-"===r)return e.diff(t).as("days");throw new o.L8(o.Z7.InvalidOperator)}(t,r,e);if(S(r))return function(){throw new o.L8(o.Z7.InvalidOperator)}();throw new o.L8(o.Z7.InvalidOperator)}if(E(t)){if(T(r))return function(e,t,r){const n=1e3*t*24*60*60;switch(r){case"+":return e.addMilliseconds(n);case"-":return e.addMilliseconds(-1*n)}throw new o.L8(o.Z7.InvalidOperator)}(t,r,e);if(I(r))return function(e,t,r){switch(r){case"+":return e.addMilliseconds(t.valueInMilliseconds());case"-":return e.addMilliseconds(-1*t.valueInMilliseconds())}throw new o.L8(o.Z7.InvalidOperator)}(t,r,e);if(L(r))return function(){throw new o.L8(o.Z7.InvalidOperator)}();if(F(r))return function(e,t,r){if("-"===r)return e.toDateTime().diff(t.toDateTimeLuxon(e.toDateTime().zone)).as("days");throw new o.L8(o.Z7.InvalidOperator)}(t,r,e);if(E(r))return function(e,t,r){if("-"===r)return e.toDateTime().diff(t.toDateTime()).as("days");throw new o.L8(o.Z7.InvalidOperator)}(t,r,e);if(M(r))return function(e,t,r){if("-"===r)return e.toDateTime().diff(t).as("days");throw new o.L8(o.Z7.InvalidOperator)}(t,r,e);if(S(r))return function(){throw new o.L8(o.Z7.InvalidOperator)}();throw new o.L8(o.Z7.InvalidOperator)}if(S(t)){if(T(r))return function(e,t,r){const n=parseFloat(e);if(isNaN(n))throw new o.L8(o.Z7.InvalidOperator);return J(n,t,r)}(t,r,e);if(I(r))return function(){throw new o.L8(o.Z7.InvalidOperator)}();if(L(r))return function(){throw new o.L8(o.Z7.InvalidOperator)}();if(F(r))return function(){throw new o.L8(o.Z7.InvalidOperator)}();if(E(r))return function(){throw new o.L8(o.Z7.InvalidOperator)}();if(M(r))return function(){throw new o.L8(o.Z7.InvalidOperator)}();if(S(r))return function(e,t,r){if("+"===r)return e+t;throw new o.L8(o.Z7.InvalidOperator)}(t,r,e);throw new o.L8(o.Z7.InvalidOperator)}throw new o.L8(o.Z7.InvalidOperator)}function J(e,t,r){switch(r){case"+":return e+t;case"-":return e-t;case"*":return e*t;case"/":return e/t}throw new o.L8(o.Z7.InvalidOperator)}function Y(e,t,r,n){var i=Error.call(this,e);return Object.setPrototypeOf&&Object.setPrototypeOf(i,Y.prototype),i.expected=t,i.found=r,i.location=n,i.name="SyntaxError",i}function W(e,t,r){return r=r||" ",e.length>t?e:(t-=e.length,e+(r+=r.repeat(t)).slice(0,t))}(function(e,t){function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r})(Y,Error),Y.prototype.format=function(e){var t="Error: "+this.message;if(this.location){var r,n=null;for(r=0;r<e.length;r++)if(e[r].source===this.location.source){n=e[r].text.split(/\r\n|\n|\r/g);break}var i=this.location.start,s=this.location.source&&"function"==typeof this.location.source.offset?this.location.source.offset(i):i,a=this.location.source+":"+s.line+":"+s.column;if(n){var o=this.location.end,l=W("",s.line.toString().length," "),u=n[i.line-1],c=(i.line===o.line?o.column:u.length+1)-i.column||1;t+="\n --\x3e "+a+"\n"+l+" |\n"+s.line+" | "+u+"\n"+l+" | "+W("",i.column-1," ")+W("",c,"^")}else t+="\n at "+a}return t},Y.buildMessage=function(e,t){var r={literal:function(e){return'"'+i(e.text)+'"'},class:function(e){var t=e.parts.map((function(e){return Array.isArray(e)?s(e[0])+"-"+s(e[1]):s(e)}));return"["+(e.inverted?"^":"")+t.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(e){return e.description}};function n(e){return e.charCodeAt(0).toString(16).toUpperCase()}function i(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+n(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+n(e)}))}function s(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+n(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+n(e)}))}function a(e){return r[e.type](e)}return"Expected "+function(e){var t,r,n=e.map(a);if(n.sort(),n.length>0){for(t=1,r=1;t<n.length;t++)n[t-1]!==n[t]&&(n[r]=n[t],r++);n.length=r}switch(n.length){case 1:return n[0];case 2:return n[0]+" or "+n[1];default:return n.slice(0,-1).join(", ")+", or "+n[n.length-1]}}(e)+" but "+function(e){return e?'"'+i(e)+'"':"end of input"}(t)+" found."};class Q{static parse(e){return function(e,t){var r,n={},i=(t=void 0!==t?t:{}).grammarSource,s={start:rs},a=rs,o="!",l="=",u=">=",c=">",d="<=",h="<>",p="!=",f="||",m="@",y="'",g="N'",v="''",_=".",w="null",b="true",T="false",S="in",I="is",x="like",M="escape",F="not",L="and",E="or",A="between",R="from",N="for",C="substring",O="extract",k="trim",D="position",P="timestamp",U="date",Z="time",z="leading",V="trailing",G="both",q="cast",B="as",j="integer",H="int",$="smallint",J="float",W="real",Q="varchar",X="to",K="interval",ee="year",te="timezone_hour",re="timezone_minute",ne="month",ie="day",se="hour",ae="minute",oe="second",le="case",ue="end",ce="when",de="then",he="else",pe=",",fe="(",me=")",ye="`",ge=/^[<-=]/,ve=/^[+\-]/,_e=/^[*\/]/,we=/^[A-Za-z_\x80-\uFFFF]/,be=/^[A-Za-z0-9_]/,Te=/^[A-Za-z0-9_.\x80-\uFFFF]/,Se=/^["]/,Ie=/^[^']/,xe=/^[0-9]/,Me=/^[eE]/,Fe=/^[ \t\n\r]/,Le=/^[^`]/,Ee=Wi("!",!1),Ae=Wi("=",!1),Re=Wi(">=",!1),Ne=Wi(">",!1),Ce=Wi("<=",!1),Oe=Wi("<>",!1),ke=Qi([["<","="]],!1,!1),De=Wi("!=",!1),Pe=Qi(["+","-"],!1,!1),Ue=Wi("||",!1),Ze=Qi(["*","/"],!1,!1),ze=Qi([["A","Z"],["a","z"],"_",["","￿"]],!1,!1),Ve=Qi([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),Ge=Qi([["A","Z"],["a","z"],["0","9"],"_",".",["","￿"]],!1,!1),qe=Qi(['"'],!1,!1),Be=Wi("@",!1),je=Wi("'",!1),He=Wi("N'",!1),$e=Wi("''",!1),Je=Qi(["'"],!0,!1),Ye=Wi(".",!1),We=Qi([["0","9"]],!1,!1),Qe=Qi(["e","E"],!1,!1),Xe=Wi("NULL",!0),Ke=Wi("TRUE",!0),et=Wi("FALSE",!0),tt=Wi("IN",!0),rt=Wi("IS",!0),nt=Wi("LIKE",!0),it=Wi("ESCAPE",!0),st=Wi("NOT",!0),at=Wi("AND",!0),ot=Wi("OR",!0),lt=Wi("BETWEEN",!0),ut=Wi("FROM",!0),ct=Wi("FOR",!0),dt=Wi("SUBSTRING",!0),ht=Wi("EXTRACT",!0),pt=Wi("TRIM",!0),ft=Wi("POSITION",!0),mt=Wi("TIMESTAMP",!0),yt=Wi("DATE",!0),gt=Wi("TIME",!0),vt=Wi("LEADING",!0),_t=Wi("TRAILING",!0),wt=Wi("BOTH",!0),bt=Wi("CAST",!0),Tt=Wi("AS",!0),St=Wi("INTEGER",!0),It=Wi("INT",!0),xt=Wi("SMALLINT",!0),Mt=Wi("FLOAT",!0),Ft=Wi("REAL",!0),Lt=Wi("VARCHAR",!0),Et=Wi("TO",!0),At=Wi("INTERVAL",!0),Rt=Wi("YEAR",!0),Nt=Wi("TIMEZONE_HOUR",!0),Ct=Wi("TIMEZONE_MINUTE",!0),Ot=Wi("MONTH",!0),kt=Wi("DAY",!0),Dt=Wi("HOUR",!0),Pt=Wi("MINUTE",!0),Ut=Wi("SECOND",!0),Zt=Wi("CASE",!0),zt=Wi("END",!0),Vt=Wi("WHEN",!0),Gt=Wi("THEN",!0),qt=Wi("ELSE",!0),Bt=Wi(",",!1),jt=Wi("(",!1),Ht=Wi(")",!1),$t=Qi([" ","\t","\n","\r"],!1,!1),Jt=Wi("`",!1),Yt=Qi(["`"],!0,!1),Wt=function(e){return e},Qt=function(e){return Va(Ji(),...e)},Xt=function(e,t,r){return{op:t,expr:r,location:Ji()}},Kt=function(e,t){return Ga(e,t)},er=function(e,t,r){return{op:t,expr:r,location:Ji()}},tr=function(e,t){return Ga(e,t)},rr=function(e){return function(e,t,r){return{type:"unary-expression",location:r,operator:"NOT",expr:t}}(0,e,Ji())},nr=function(e,t){return""==t||null==t||null==t?e:"arithmetic"==t.type?Ga(e,t.tail):za(t.op,e,t.right,t.escape,Ji())},ir=function(e,t){return{op:e,expr:t,location:Ji()}},sr=function(e){return{type:"arithmetic",tail:e}},ar=function(e,t){return{op:e+"NOT",right:t}},or=function(e,t){return{op:e,right:t}},lr=function(e,t,r){return Va(Ji(),t,r)},ur=function(e,t){return{op:"NOT"+e,right:t}},cr=function(e,t,r){return Va(Ji(),t,r)},dr=function(e,t){return{op:e,right:t}},hr=function(e){return e[0]+" "+e[2]},pr=function(e){return e[0]+" "+e[2]},fr=function(e,t,r){return{op:e,right:t,escape:r.value}},mr=function(e,t){return{op:e,right:t,escape:""}},yr=function(e,t){return{op:e,right:t}},gr=function(e,t){return{op:e,right:t}},vr=function(e,t,r){return{op:t,expr:r,location:Ji()}},_r=function(e,t){return Ga(e,t)},wr=function(e,t,r){return{op:t,expr:r,location:Ji()}},br=function(e,t){return Ga(e,t)},Tr=function(e){return e.paren=!0,e},Sr=function(e){return/^CURRENT_DATE$/i.test(e)?{type:"current-time",location:Ji(),mode:"date"}:/^CURRENT_TIMESTAMP$/i.test(e)?{type:"current-time",location:Ji(),mode:"timestamp"}:/^CURRENT_TIME$/i.test(e)?{type:"current-time",location:Ji(),mode:"time"}:/^CURRENT_USER$/i.test(e)?{type:"current-user",location:Ji()}:{type:"column-reference",location:Ji(),table:"",column:e}},Ir=function(e){return{type:"column-reference",location:Ji(),table:"",column:e,delimited:!0}},xr=function(e){return e},Mr=function(e,t){return e+t.join("")},Fr=function(e,t){return e+t.join("")},Lr=function(e){return e},Er=function(e){return e.join("")},Ar=function(){return'"'},Rr=function(e){return{type:"parameter",location:Ji(),value:e[1]}},Nr=function(e,t){return Va(Ji(),e,t)},Cr=function(e,t){return Va(Ji(),e,t)},Or=function(e){return{type:"function",location:Ji(),name:"extract",args:e}},kr=function(e,t,r){return Va(Ji(),e,t,...r?[r]:[])},Dr=function(e,t,r){return Va(Ji(),e,t,r)},Pr=function(e){return{type:"function",location:Ji(),name:"substring",args:e}},Ur=function(e,t){return Va(Ji(),e,t)},Zr=function(e,t){return Va(Ji(),e,t)},zr=function(e){return{type:"function",location:Ji(),name:"cast",args:e}},Vr=function(){return{type:"data-type",location:Ji(),value:{type:"integer"}}},Gr=function(){return{type:"data-type",location:Ji(),value:{type:"smallint"}}},qr=function(){return{type:"data-type",location:Ji(),value:{type:"float"}}},Br=function(){return{type:"data-type",location:Ji(),value:{type:"real"}}},jr=function(){return{type:"data-type",location:Ji(),value:{type:"date"}}},Hr=function(){return{type:"data-type",location:Ji(),value:{type:"timestamp"}}},$r=function(){return{type:"data-type",location:Ji(),value:{type:"time"}}},Jr=function(e){return{type:"data-type",location:Ji(),value:{type:"varchar",size:parseInt(e)}}},Yr=function(e,t,r){return Va(Ji(),e,t,r)},Wr=function(e,t){return Va(Ji(),e,t)},Qr=function(e){return{type:"function",location:Ji(),name:"trim",args:e}},Xr=function(e){return{type:"string",location:Ji(),value:e??"BOTH"}},Kr=function(e,t){return Va(Ji(),e,t)},en=function(e,t){return Va(Ji(),e,t)},tn=function(e){return{type:"function",location:Ji(),name:"position",args:e}},rn=function(e,t){return{type:"function",location:Ji(),name:e,args:t}},nn=function(e){return{type:"string",location:Ji(),value:e}},sn=function(e){return"string"===e.type&&function(e){!0!==/^(\d{4})-(\d{1,2})-(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/.test(e)&&Yi("Timestamp literal is invalid")}(e.value),{type:"timestamp",location:Ji(),value:e.value}},an=function(e){return"string"===e.type&&function(e){!0!==/^(\d{1,2}):(\d{1,2}):(\d{1,2})$|^(\d{1,2}):(\d{1,2})$|^(\d{1,2}):(\d{1,2}):(\d{1,2}).([0-9]+)$/.test(e)&&Yi("Time literal is invalid")}(e.value),{type:"time",location:Ji(),value:e.value}},on=function(e,t,r){return{type:"interval",location:Ji(),value:t,qualifier:r,op:e}},ln=function(e,t){return{type:"interval",location:Ji(),value:e,qualifier:t,op:""}},un=function(e,t){return{type:"interval-qualifier",location:Ji(),start:e,end:t}},cn=function(e,t){return{type:"interval-period",location:Ji(),period:e.value,precision:t,secondary:null}},dn=function(e){return{type:"interval-period",location:Ji(),period:e.value,precision:null,secondary:null}},hn=function(e){return{type:"interval-period",location:Ji(),period:e.value,precision:null,secondary:null}},pn=function(e,t){return{type:"interval-period",location:Ji(),period:"second",precision:e,secondary:t}},fn=function(e){return{type:"interval-period",location:Ji(),period:"second",precision:e,secondary:null}},mn=function(){return{type:"interval-period",location:Ji(),period:"second",precision:null,secondary:null}},yn=function(e,t){return{type:"interval-period",location:Ji(),period:e.value,precision:t,secondary:null}},gn=function(e){return{type:"interval-period",location:Ji(),period:e.value,precision:null,secondary:null}},vn=function(e,t){return{type:"interval-period",location:Ji(),period:"second",precision:e,secondary:t}},_n=function(e){return{type:"interval-period",location:Ji(),period:"second",precision:e,secondary:null}},wn=function(){return{type:"interval-period",location:Ji(),period:"second",precision:null,secondary:null}},bn=function(){return{type:"string",location:Ji(),value:"day"}},Tn=function(){return{type:"string",location:Ji(),value:"hour"}},Sn=function(){return{type:"string",location:Ji(),value:"minute"}},In=function(){return{type:"string",location:Ji(),value:"month"}},xn=function(){return{type:"string",location:Ji(),value:"year"}},Mn=function(e){return parseFloat(e)},Fn=function(e){return parseFloat(e)},Ln=function(e){return"string"===e.type&&function(e){!0!==/^(\d{4})-(\d{1,2})-(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/.test(e)&&Yi("Date literal is invalid")}(e.value),{type:"date",location:Ji(),value:e.value}},En=function(){return{type:"null",location:Ji(),value:null}},An=function(){return{type:"boolean",location:Ji(),value:!0}},Rn=function(){return{type:"boolean",location:Ji(),value:!1}},Nn=function(){return"'"},Cn=function(e){return{type:"string",location:Ji(),value:e.join("")}},On=function(e,t){return{type:"case-expression",location:Ji(),format:"simple",operand:e,clauses:t,else:null,elseLocation:null}},kn=function(e,t,r){return{type:"case-expression",location:Ji(),format:"simple",operand:e,clauses:t,else:r.value,elseLocation:r.location}},Dn=function(e){return{type:"case-expression",location:Ji(),format:"searched",clauses:e,else:null,elseLocation:null}},Pn=function(e,t){return{type:"case-expression",location:Ji(),format:"searched",clauses:e,else:t.value,elseLocation:t.location}},Un=function(e,t){return{type:"when-clause",location:Ji(),operand:e,value:t}},Zn=function(e,t){return{type:"when-clause",location:Ji(),operand:e,value:t}},zn=function(e){return{type:"else-clause",location:Ji(),value:e}},Vn=function(e){return{type:"number",location:Ji(),value:e}},Gn=function(e,t,r){return parseFloat(e+t+r)},qn=function(e,t){return parseFloat(e+t)},Bn=function(e,t){return parseFloat(e+t)},jn=function(e){return parseFloat(e)},Hn=function(e,t){return e[0]+t},$n=function(e){return"."+(null!=e?e:"")},Jn=function(e,t){return e+t},Yn=function(e){return e.join("")},Wn=function(e,t){return"e"+(null===t?"":t)},Qn=function(){return"IN"},Xn=function(){return"IS"},Kn=function(){return"LIKE"},ei=function(){return"ESCAPE"},ti=function(){return"NOT"},ri=function(){return"AND"},ni=function(){return"OR"},ii=function(){return"BETWEEN"},si=function(){return"FROM"},ai=function(){return"FOR"},oi=function(){return"SUBSTRING"},li=function(){return"EXTRACT"},ui=function(){return"TRIM"},ci=function(){return"POSITION"},di=function(){return"TIMESTAMP"},hi=function(){return"DATE"},pi=function(){return"TIME"},fi=function(){return"LEADING"},mi=function(){return"TRAILING"},yi=function(){return"BOTH"},gi=function(){return"CAST"},vi=function(){return"AS"},_i=function(){return"INTEGER"},wi=function(){return"INT"},bi=function(){return"SMALLINT"},Ti=function(){return"FLOAT"},Si=function(){return"REAL"},Ii=function(){return"VARCHAR"},xi=function(){return"TO"},Mi=function(){return"INTERVAL"},Fi=function(){return"YEAR"},Li=function(){return"TIMEZONE_HOUR"},Ei=function(){return"TIMEZONE_MINUTE"},Ai=function(){return"MONTH"},Ri=function(){return"DAY"},Ni=function(){return"HOUR"},Ci=function(){return"MINUTE"},Oi=function(){return"SECOND"},ki=function(){return"CASE"},Di=function(){return"END"},Pi=function(){return"WHEN"},Ui=function(){return"THEN"},Zi=function(){return"ELSE"},zi=function(e){return e},Vi=function(e){return e.join("")},Gi=0|t.peg$currPos,qi=Gi,Bi=[{line:1,column:1}],ji=Gi,Hi=t.peg$maxFailExpected||[],$i=0|t.peg$silentFails;if(t.startRule){if(!(t.startRule in s))throw new Error("Can't start parsing from rule \""+t.startRule+'".');a=s[t.startRule]}function Ji(){return Ki(qi,Gi)}function Yi(e,t){throw ts(e,t=void 0!==t?t:Ki(qi,Gi))}function Wi(e,t){return{type:"literal",text:e,ignoreCase:t}}function Qi(e,t,r){return{type:"class",parts:e,inverted:t,ignoreCase:r}}function Xi(t){var r,n=Bi[t];if(n)return n;if(t>=Bi.length)r=Bi.length-1;else for(r=t;!Bi[--r];);for(n={line:(n=Bi[r]).line,column:n.column};r<t;)10===e.charCodeAt(r)?(n.line++,n.column=1):n.column++,r++;return Bi[t]=n,n}function Ki(e,t,r){var n=Xi(e),s=Xi(t);return{source:i,start:{offset:e,line:n.line,column:n.column},end:{offset:t,line:s.line,column:s.column}}}function es(e){Gi<ji||(Gi>ji&&(ji=Gi,Hi=[]),Hi.push(e))}function ts(e,t){return new Y(e,null,null,t)}function rs(){var e,t;return e=Gi,Pa(),(t=is())!==n?(Pa(),qi=e,e=Wt(t)):(Gi=e,e=n),e}function ns(){var e,t,r,i,s,a;if(e=Gi,ka()!==n){for(Pa(),t=[],r=is();r!==n;)t.push(r),r=Gi,i=Gi,s=Pa(),(a=Oa())!==n?i=s=[s,a,Pa()]:(Gi=i,i=n),i!==n&&(i=is())===n?(Gi=r,r=n):r=i;r=Pa(),(i=Da())!==n?(qi=e,e=Qt(t)):(Gi=e,e=n)}else Gi=e,e=n;return e}function is(){var e,t,r,i,s,a;if(e=Gi,(t=ss())!==n){for(r=[],i=Gi,Pa(),(s=Qs())!==n?(Pa(),(a=ss())!==n?(qi=i,i=Xt(t,s,a)):(Gi=i,i=n)):(Gi=i,i=n);i!==n;)r.push(i),i=Gi,Pa(),(s=Qs())!==n?(Pa(),(a=ss())!==n?(qi=i,i=Xt(t,s,a)):(Gi=i,i=n)):(Gi=i,i=n);qi=e,e=Kt(t,r)}else Gi=e,e=n;return e}function ss(){var e,t,r,i,s,a;if(e=Gi,(t=as())!==n){for(r=[],i=Gi,Pa(),(s=Ws())!==n?(Pa(),(a=as())!==n?(qi=i,i=er(t,s,a)):(Gi=i,i=n)):(Gi=i,i=n);i!==n;)r.push(i),i=Gi,Pa(),(s=Ws())!==n?(Pa(),(a=as())!==n?(qi=i,i=er(t,s,a)):(Gi=i,i=n)):(Gi=i,i=n);qi=e,e=tr(t,r)}else Gi=e,e=n;return e}function as(){var t,r,i,s,a;return t=Gi,(r=Ys())===n&&(r=Gi,33===e.charCodeAt(Gi)?(i=o,Gi++):(i=n,0===$i&&es(Ee)),i!==n?(s=Gi,$i++,61===e.charCodeAt(Gi)?(a=l,Gi++):(a=n,0===$i&&es(Ae)),$i--,a===n?s=void 0:(Gi=s,s=n),s!==n?r=i=[i,s]:(Gi=r,r=n)):(Gi=r,r=n)),r!==n?(i=Pa(),(s=as())!==n?(qi=t,t=rr(s)):(Gi=t,t=n)):(Gi=t,t=n),t===n&&(t=function(){var e,t,r,i;return e=Gi,(t=cs())!==n?(r=Gi,Pa(),(i=function(){var e;return(e=function(){var e,t,r,i,s;if(e=Gi,t=[],r=Gi,Pa(),(i=os())!==n?(Pa(),(s=cs())!==n?(qi=r,r=ir(i,s)):(Gi=r,r=n)):(Gi=r,r=n),r!==n)for(;r!==n;)t.push(r),r=Gi,Pa(),(i=os())!==n?(Pa(),(s=cs())!==n?(qi=r,r=ir(i,s)):(Gi=r,r=n)):(Gi=r,r=n);else t=n;return t!==n&&(qi=e,t=sr(t)),t}())===n&&(e=function(){var e,t,r;return e=Gi,(t=us())!==n?(Pa(),(r=ns())!==n?(qi=e,e=yr(t,r)):(Gi=e,e=n)):(Gi=e,e=n),e===n&&(e=Gi,(t=us())!==n?(Pa(),(r=Ts())!==n?(qi=e,e=gr(t,r)):(Gi=e,e=n)):(Gi=e,e=n)),e}())===n&&(e=function(){var e,t,r,i,s,a,o,l;return e=Gi,(t=Ys())!==n?(Pa(),(r=Xs())!==n?(i=Pa(),s=Gi,(a=cs())!==n?(Pa(),(o=Ws())!==n?(Pa(),(l=cs())!==n?(qi=s,s=lr(r,a,l)):(Gi=s,s=n)):(Gi=s,s=n)):(Gi=s,s=n),s!==n?(qi=e,e=ur(r,s)):(Gi=e,e=n)):(Gi=e,e=n)):(Gi=e,e=n),e===n&&(e=Gi,(t=Xs())!==n?(Pa(),r=Gi,(i=cs())!==n?(s=Pa(),(a=Ws())!==n?(Pa(),(o=cs())!==n?(qi=r,r=cr(t,i,o)):(Gi=r,r=n)):(Gi=r,r=n)):(Gi=r,r=n),r!==n?(qi=e,e=dr(t,r)):(Gi=e,e=n)):(Gi=e,e=n)),e}())===n&&(e=function(){var e,t,r,i;return e=Gi,(t=Hs())!==n?(Pa(),(r=Ys())!==n?(Pa(),(i=cs())!==n?(qi=e,e=ar(t,i)):(Gi=e,e=n)):(Gi=e,e=n)):(Gi=e,e=n),e===n&&(e=Gi,(t=Hs())!==n?(Pa(),(r=cs())!==n?(qi=e,e=or(t,r)):(Gi=e,e=n)):(Gi=e,e=n)),e}())===n&&(e=function(){var e,t,r,i;return e=Gi,(t=ls())!==n?(Pa(),(r=Rs())!==n?(Pa(),Js()!==n?(Pa(),(i=Ns())!==n?(qi=e,e=fr(t,r,i)):(Gi=e,e=n)):(Gi=e,e=n)):(Gi=e,e=n)):(Gi=e,e=n),e===n&&(e=Gi,(t=ls())!==n?(Pa(),(r=Rs())!==n?(qi=e,e=mr(t,r)):(Gi=e,e=n)):(Gi=e,e=n)),e}()),e}())!==n?r=i:(Gi=r,r=n),r===n&&(r=null),qi=e,e=nr(t,r)):(Gi=e,e=n),e}()),t}function os(){var t;return e.substr(Gi,2)===u?(t=u,Gi+=2):(t=n,0===$i&&es(Re)),t===n&&(62===e.charCodeAt(Gi)?(t=c,Gi++):(t=n,0===$i&&es(Ne)),t===n&&(e.substr(Gi,2)===d?(t=d,Gi+=2):(t=n,0===$i&&es(Ce)),t===n&&(e.substr(Gi,2)===h?(t=h,Gi+=2):(t=n,0===$i&&es(Oe)),t===n&&(t=e.charAt(Gi),ge.test(t)?Gi++:(t=n,0===$i&&es(ke)),t===n&&(e.substr(Gi,2)===p?(t=p,Gi+=2):(t=n,0===$i&&es(De))))))),t}function ls(){var e,t,r,i,s;return e=Gi,t=Gi,(r=Ys())!==n?(i=Pa(),(s=$s())!==n?t=r=[r,i,s]:(Gi=t,t=n)):(Gi=t,t=n),t!==n&&(qi=e,t=hr(t)),(e=t)===n&&(e=$s()),e}function us(){var e,t,r,i,s;return e=Gi,t=Gi,(r=Ys())!==n?(i=Pa(),(s=js())!==n?t=r=[r,i,s]:(Gi=t,t=n)):(Gi=t,t=n),t!==n&&(qi=e,t=pr(t)),(e=t)===n&&(e=js()),e}function cs(){var e,t,r,i,s,a;if(e=Gi,(t=hs())!==n){for(r=[],i=Gi,Pa(),(s=ds())!==n?(Pa(),(a=hs())!==n?(qi=i,i=vr(t,s,a)):(Gi=i,i=n)):(Gi=i,i=n);i!==n;)r.push(i),i=Gi,Pa(),(s=ds())!==n?(Pa(),(a=hs())!==n?(qi=i,i=vr(t,s,a)):(Gi=i,i=n)):(Gi=i,i=n);qi=e,e=_r(t,r)}else Gi=e,e=n;return e}function ds(){var t;return t=e.charAt(Gi),ve.test(t)?Gi++:(t=n,0===$i&&es(Pe)),t===n&&(e.substr(Gi,2)===f?(t=f,Gi+=2):(t=n,0===$i&&es(Ue))),t}function hs(){var e,t,r,i,s,a;if(e=Gi,(t=fs())!==n){for(r=[],i=Gi,Pa(),(s=ps())!==n?(Pa(),(a=fs())!==n?(qi=i,i=wr(t,s,a)):(Gi=i,i=n)):(Gi=i,i=n);i!==n;)r.push(i),i=Gi,Pa(),(s=ps())!==n?(Pa(),(a=fs())!==n?(qi=i,i=wr(t,s,a)):(Gi=i,i=n)):(Gi=i,i=n);qi=e,e=br(t,r)}else Gi=e,e=n;return e}function ps(){var t;return t=e.charAt(Gi),_e.test(t)?Gi++:(t=n,0===$i&&es(Ze)),t}function fs(){var e,t;return(e=function(){var e;return(e=Ns())===n&&(e=function(){var e,t,r,i;return e=Gi,(t=function(){var e,t,r,i;return e=Gi,(t=Ds())!==n&&(r=Ps())!==n&&(i=Us())!==n?(qi=e,e=Gn(t,r,i)):(Gi=e,e=n),e===n&&(e=Gi,(t=Ds())!==n&&(r=Ps())!==n?(qi=e,e=qn(t,r)):(Gi=e,e=n),e===n&&(e=Gi,(t=Ds())!==n&&(r=Us())!==n?(qi=e,e=Bn(t,r)):(Gi=e,e=n),e===n&&(e=Gi,(t=Ds())!==n&&(qi=e,t=jn(t)),e=t))),e}())!==n?(r=Gi,$i++,i=ys(),$i--,i===n?r=void 0:(Gi=r,r=n),r!==n?(qi=e,e=Vn(t)):(Gi=e,e=n)):(Gi=e,e=n),e}())===n&&(e=function(){var e,t;return e=Gi,(t=qs())!==n&&(qi=e,t=An()),(e=t)===n&&(e=Gi,(t=Bs())!==n&&(qi=e,t=Rn()),e=t),e}())===n&&(e=function(){var e,t;return e=Gi,(t=Gs())!==n&&(qi=e,t=En()),t}())===n&&(e=function(){var e,t;return e=Gi,aa()!==n?(Pa(),(t=Rs())!==n?(qi=e,e=Ln(t)):(Gi=e,e=n)):(Gi=e,e=n),e}())===n&&(e=function(){var e,t;return e=Gi,sa()!==n?(Pa(),(t=Rs())!==n?(qi=e,e=sn(t)):(Gi=e,e=n)):(Gi=e,e=n),e}())===n&&(e=Ms())===n&&(e=function(){var e,t;return e=Gi,oa()!==n?(Pa(),(t=Rs())!==n?(qi=e,e=an(t)):(Gi=e,e=n)):(Gi=e,e=n),e}()),e}())===n&&(e=function(){var e,t,r,i;return e=Gi,ra()!==n?(Pa(),t=Gi,ka()!==n?(Pa(),(r=xs())!==n?(Pa(),Ks()!==n?(Pa(),(i=is())!==n?(Pa(),Da()!==n?(qi=t,t=Nr(r,i)):(Gi=t,t=n)):(Gi=t,t=n)):(Gi=t,t=n)):(Gi=t,t=n)):(Gi=t,t=n),t===n&&(t=Gi,ka()!==n?(Pa(),(r=xs())!==n?(Pa(),Oa()!==n?(Pa(),(i=is())!==n?(Pa(),Da()!==n?(qi=t,t=Cr(r,i)):(Gi=t,t=n)):(Gi=t,t=n)):(Gi=t,t=n)):(Gi=t,t=n)):(Gi=t,t=n)),t!==n?(qi=e,e=Or(t)):(Gi=e,e=n)):(Gi=e,e=n),e}())===n&&(e=function(){var e,t,r,i,s,a,o;return e=Gi,ta()!==n?(Pa(),t=Gi,ka()!==n?(Pa(),(r=is())!==n?(Pa(),Ks()!==n?(Pa(),(i=is())!==n?(Pa(),s=Gi,ea()!==n?(a=Pa(),(o=is())!==n?(Pa(),s=o):(Gi=s,s=n)):(Gi=s,s=n),s===n&&(s=null),Da()!==n?(qi=t,t=kr(r,i,s)):(Gi=t,t=n)):(Gi=t,t=n)):(Gi=t,t=n)):(Gi=t,t=n)):(Gi=t,t=n),t===n&&(t=Gi,ka()!==n?(Pa(),(r=is())!==n?(Pa(),Oa()!==n?(Pa(),(i=is())!==n?(Pa(),(s=Oa())!==n?(Pa(),(a=is())!==n&&(o=Da())!==n?(qi=t,t=Dr(r,i,a)):(Gi=t,t=n)):(Gi=t,t=n)):(Gi=t,t=n)):(Gi=t,t=n)):(Gi=t,t=n)):(Gi=t,t=n)),t!==n?(qi=e,e=Pr(t)):(Gi=e,e=n)):(Gi=e,e=n),e}())===n&&(e=function(){var e,t,r,i,s;return e=Gi,na()!==n?(Pa(),t=Gi,ka()!==n?(Pa(),r=Is(),Pa(),(i=is())!==n?(Pa(),Ks()!==n?(Pa(),(s=is())!==n?(Pa(),Da()!==n?(qi=t,t=Yr(r,i,s)):(Gi=t,t=n)):(Gi=t,t=n)):(Gi=t,t=n)):(Gi=t,t=n)):(Gi=t,t=n),t===n&&(t=Gi,ka()!==n?(Pa(),r=Is(),Pa(),(i=is())!==n?(Pa(),Da()!==n?(qi=t,t=Wr(r,i)):(Gi=t,t=n)):(Gi=t,t=n)):(Gi=t,t=n)),t!==n?(qi=e,e=Qr(t)):(Gi=e,e=n)):(Gi=e,e=n),e}())===n&&(e=function(){var e,t,r,i;return e=Gi,ia()!==n?(Pa(),t=Gi,ka()!==n?(Pa(),(r=is())!==n?(Pa(),js()!==n?(Pa(),(i=is())!==n?(Pa(),Da()!==n?(qi=t,t=Kr(r,i)):(Gi=t,t=n)):(Gi=t,t=n)):(Gi=t,t=n)):(Gi=t,t=n)):(Gi=t,t=n),t===n&&(t=Gi,ka()!==n?(Pa(),(r=is())!==n?(Pa(),Oa()!==n?(Pa(),(i=is())!==n?(Pa(),Da()!==n?(qi=t,t=en(r,i)):(Gi=t,t=n)):(Gi=t,t=n)):(Gi=t,t=n)):(Gi=t,t=n)):(Gi=t,t=n)),t!==n?(qi=e,e=tn(t)):(Gi=e,e=n)):(Gi=e,e=n),e}())===n&&(e=function(){var e,t,r,i;return e=Gi,da()!==n?(Pa(),t=Gi,ka()!==n?(Pa(),(r=is())!==n?(Pa(),ha()!==n?(Pa(),(i=Ss())!==n?(Pa(),Da()!==n?(qi=t,t=Ur(r,i)):(Gi=t,t=n)):(Gi=t,t=n)):(Gi=t,t=n)):(Gi=t,t=n)):(Gi=t,t=n),t===n&&(t=Gi,ka()!==n?(Pa(),(r=is())!==n?(Pa(),Oa()!==n?(Pa(),(i=Ss())!==n?(Pa(),Da()!==n?(qi=t,t=Zr(r,i)):(Gi=t,t=n)):(Gi=t,t=n)):(Gi=t,t=n)):(Gi=t,t=n)):(Gi=t,t=n)),t!==n?(qi=e,e=zr(t)):(Gi=e,e=n)):(Gi=e,e=n),e}())===n&&(e=function(){var e,t,r,i;return e=Gi,t=Gi,$i++,r=ra(),$i--,r===n?t=void 0:(Gi=t,t=n),t!==n&&(r=Za())!==n?(Pa(),(i=ns())!==n?(qi=e,e=rn(r,i)):(Gi=e,e=n)):(Gi=e,e=n),e}())===n&&(e=function(){var e;return(e=function(){var e,t,r,i,s;if(e=Gi,Ea()!==n)if(Pa(),(t=is())!==n){for(Pa(),r=[],i=Gi,(s=Os())!==n?(Pa(),i=s):(Gi=i,i=n);i!==n;)r.push(i),i=Gi,(s=Os())!==n?(Pa(),i=s):(Gi=i,i=n);(i=Aa())!==n?(qi=e,e=On(t,r)):(Gi=e,e=n)}else Gi=e,e=n;else Gi=e,e=n;if(e===n)if(e=Gi,Ea()!==n)if(Pa(),(t=is())!==n){for(Pa(),r=[],i=Gi,(s=Os())!==n?(Pa(),i=s):(Gi=i,i=n);i!==n;)r.push(i),i=Gi,(s=Os())!==n?(Pa(),i=s):(Gi=i,i=n);(i=ks())!==n?(s=Pa(),Aa()!==n?(qi=e,e=kn(t,r,i)):(Gi=e,e=n)):(Gi=e,e=n)}else Gi=e,e=n;else Gi=e,e=n;return e}())===n&&(e=function(){var e,t,r,i;if(e=Gi,Ea()!==n){for(Pa(),t=[],r=Gi,(i=Cs())!==n?(Pa(),r=i):(Gi=r,r=n);r!==n;)t.push(r),r=Gi,(i=Cs())!==n?(Pa(),r=i):(Gi=r,r=n);(r=Aa())!==n?(qi=e,e=Dn(t)):(Gi=e,e=n)}else Gi=e,e=n;if(e===n)if(e=Gi,Ea()!==n){for(Pa(),t=[],r=Gi,(i=Cs())!==n?(Pa(),r=i):(Gi=r,r=n);r!==n;)t.push(r),r=Gi,(i=Cs())!==n?(Pa(),r=i):(Gi=r,r=n);(r=ks())!==n?(i=Pa(),Aa()!==n?(qi=e,e=Pn(t,r)):(Gi=e,e=n)):(Gi=e,e=n)}else Gi=e,e=n;return e}()),e}())===n&&(e=function(){var e,t;return e=Gi,(t=function(){var e,t;return e=Gi,(t=function(){var e,t,r,i;if(e=Gi,(t=ys())!==n){for(r=[],i=vs();i!==n;)r.push(i),i=vs();qi=e,e=Mr(t,r)}else Gi=e,e=n;return e}())!==n&&(qi=e,t=xr(t)),t}())!==n&&(qi=e,t=Sr(t)),(e=t)===n&&(e=Gi,(t=function(){var e,t;return e=Gi,bs()!==n?(t=function(){var e,t,r;for(e=Gi,t=[],r=_s();r!==n;)t.push(r),r=_s();return qi=e,Er(t)}(),bs()!==n?(qi=e,e=Lr(t)):(Gi=e,e=n)):(Gi=e,e=n),e}())!==n&&(qi=e,t=Ir(t)),e=t),e}())===n&&(e=Ts())===n&&(e=Gi,ka()!==n?(Pa(),(t=is())!==n?(Pa(),Da()!==n?(qi=e,e=Tr(t)):(Gi=e,e=n)):(Gi=e,e=n)):(Gi=e,e=n)),e}function ms(){var e,t,r,i;if(e=Gi,(t=ys())!==n){for(r=[],i=gs();i!==n;)r.push(i),i=gs();qi=e,e=Fr(t,r)}else Gi=e,e=n;return e}function ys(){var t;return t=e.charAt(Gi),we.test(t)?Gi++:(t=n,0===$i&&es(ze)),t}function gs(){var t;return t=e.charAt(Gi),be.test(t)?Gi++:(t=n,0===$i&&es(Ve)),t}function vs(){var t;return t=e.charAt(Gi),Te.test(t)?Gi++:(t=n,0===$i&&es(Ge)),t}function _s(){var e;return(e=ws())===n&&(e=function(){var e;return e=Gi,bs()!==n&&bs()!==n?(qi=e,e=Ar()):(Gi=e,e=n),e}()),e}function ws(){var t;return t=e.charAt(Gi),Te.test(t)?Gi++:(t=n,0===$i&&es(Ge)),t}function bs(){var t;return t=e.charAt(Gi),Se.test(t)?Gi++:(t=n,0===$i&&es(qe)),t}function Ts(){var t,r,i,s;return t=Gi,r=Gi,64===e.charCodeAt(Gi)?(i=m,Gi++):(i=n,0===$i&&es(Be)),i!==n&&(s=ms())!==n?r=i=[i,s]:(Gi=r,r=n),r!==n&&(qi=t,r=Rr(r)),r}function Ss(){var e,t,r;return e=Gi,(t=pa())===n&&(t=fa()),t!==n&&(qi=e,t=Vr()),(e=t)===n&&(e=Gi,(t=ma())!==n&&(qi=e,t=Gr()),(e=t)===n&&(e=Gi,(t=ya())!==n&&(qi=e,t=qr()),(e=t)===n&&(e=Gi,(t=ga())!==n&&(qi=e,t=Br()),(e=t)===n&&(e=Gi,(t=aa())!==n&&(qi=e,t=jr()),(e=t)===n&&(e=Gi,(t=sa())!==n&&(qi=e,t=Hr()),(e=t)===n&&(e=Gi,(t=oa())!==n&&(qi=e,t=$r()),(e=t)===n&&(e=Gi,(t=va())!==n?(Pa(),ka()!==n?(Pa(),(r=Zs())!==n?(Pa(),Da()!==n?(qi=e,e=Jr(r)):(Gi=e,e=n)):(Gi=e,e=n)):(Gi=e,e=n)):(Gi=e,e=n)))))))),e}function Is(){var e,t;return e=Gi,(t=la())===n&&(t=ua())===n&&(t=ca()),t===n&&(t=null),qi=e,Xr(t)}function xs(){var e,t;return e=Gi,(t=ba())===n&&(t=Ia())===n&&(t=xa())===n&&(t=Ma())===n&&(t=Fa())===n&&(t=La())===n&&(t=Ta())===n&&(t=Sa()),t!==n&&(qi=e,t=nn(t)),t}function Ms(){var t,r,i,s;return t=Gi,wa()!==n?(Pa(),r=e.charAt(Gi),ve.test(r)?Gi++:(r=n,0===$i&&es(Pe)),r!==n?(Pa(),(i=Rs())!==n?(Pa(),(s=Fs())!==n?(qi=t,t=on(r,i,s)):(Gi=t,t=n)):(Gi=t,t=n)):(Gi=t,t=n)):(Gi=t,t=n),t===n&&(t=Gi,wa()!==n?(Pa(),(r=Rs())!==n?(Pa(),(i=Fs())!==n?(qi=t,t=ln(r,i)):(Gi=t,t=n)):(Gi=t,t=n)):(Gi=t,t=n)),t}function Fs(){var e,t,r;return e=Gi,(t=function(){var e,t,r;return e=Gi,(t=Ls())!==n?(Pa(),ka()!==n?(Pa(),(r=As())!==n?(Pa(),Da()!==n?(qi=e,e=cn(t,r)):(Gi=e,e=n)):(Gi=e,e=n)):(Gi=e,e=n)):(Gi=e,e=n),e===n&&(e=Gi,(t=Ls())!==n&&(qi=e,t=dn(t)),e=t),e}())!==n?(Pa(),_a()!==n?(Pa(),(r=function(){var e,t,r,i;return e=Gi,(t=Ls())!==n&&(qi=e,t=hn(t)),(e=t)===n&&(e=Gi,(t=La())!==n?(Pa(),ka()!==n?(Pa(),(r=As())!==n?(Pa(),Oa()!==n?(Pa(),(i=Es())!==n?(Pa(),Da()!==n?(qi=e,e=pn(r,i)):(Gi=e,e=n)):(Gi=e,e=n)):(Gi=e,e=n)):(Gi=e,e=n)):(Gi=e,e=n)):(Gi=e,e=n),e===n&&(e=Gi,(t=La())!==n?(Pa(),ka()!==n?(Pa(),(r=As())!==n?(Pa(),Da()!==n?(qi=e,e=fn(r)):(Gi=e,e=n)):(Gi=e,e=n)):(Gi=e,e=n)):(Gi=e,e=n),e===n&&(e=Gi,(t=La())!==n&&(qi=e,t=mn()),e=t))),e}())!==n?(qi=e,e=un(t,r)):(Gi=e,e=n)):(Gi=e,e=n)):(Gi=e,e=n),e===n&&(e=function(){var e,t,r,i;return e=Gi,(t=Ls())!==n?(Pa(),ka()!==n?(Pa(),(r=Es())!==n?(Pa(),Da()!==n?(qi=e,e=yn(t,r)):(Gi=e,e=n)):(Gi=e,e=n)):(Gi=e,e=n)):(Gi=e,e=n),e===n&&(e=Gi,(t=Ls())!==n&&(qi=e,t=gn(t)),(e=t)===n&&(e=Gi,(t=La())!==n?(Pa(),ka()!==n?(Pa(),(r=As())!==n?(Pa(),Oa()!==n?(Pa(),(i=Es())!==n?(Pa(),Da()!==n?(qi=e,e=vn(r,i)):(Gi=e,e=n)):(Gi=e,e=n)):(Gi=e,e=n)):(Gi=e,e=n)):(Gi=e,e=n)):(Gi=e,e=n),e===n&&(e=Gi,(t=La())!==n?(Pa(),ka()!==n?(Pa(),(r=Es())!==n?(Pa(),Da()!==n?(qi=e,e=_n(r)):(Gi=e,e=n)):(Gi=e,e=n)):(Gi=e,e=n)):(Gi=e,e=n),e===n&&(e=Gi,(t=La())!==n&&(qi=e,t=wn()),e=t)))),e}()),e}function Ls(){var e,t;return e=Gi,(t=xa())!==n&&(qi=e,t=bn()),(e=t)===n&&(e=Gi,(t=Ma())!==n&&(qi=e,t=Tn()),(e=t)===n&&(e=Gi,(t=Fa())!==n&&(qi=e,t=Sn()),(e=t)===n&&(e=Gi,(t=Ia())!==n&&(qi=e,t=In()),(e=t)===n&&(e=Gi,(t=ba())!==n&&(qi=e,t=xn()),e=t)))),e}function Es(){var e,t;return e=Gi,(t=Zs())!==n&&(qi=e,t=Mn(t)),t}function As(){var e,t;return e=Gi,(t=Zs())!==n&&(qi=e,t=Fn(t)),t}function Rs(){var e;return(e=Ns())===n&&(e=Ts()),e}function Ns(){var t,r,i,s,a;if(t=Gi,39===e.charCodeAt(Gi)?(r=y,Gi++):(r=n,0===$i&&es(je)),r===n&&(e.substr(Gi,2)===g?(r=g,Gi+=2):(r=n,0===$i&&es(He))),r!==n){for(i=[],s=Gi,e.substr(Gi,2)===v?(a=v,Gi+=2):(a=n,0===$i&&es($e)),a!==n&&(qi=s,a=Nn()),(s=a)===n&&(s=e.charAt(Gi),Ie.test(s)?Gi++:(s=n,0===$i&&es(Je)));s!==n;)i.push(s),s=Gi,e.substr(Gi,2)===v?(a=v,Gi+=2):(a=n,0===$i&&es($e)),a!==n&&(qi=s,a=Nn()),(s=a)===n&&(s=e.charAt(Gi),Ie.test(s)?Gi++:(s=n,0===$i&&es(Je)));39===e.charCodeAt(Gi)?(s=y,Gi++):(s=n,0===$i&&es(je)),s!==n?(qi=t,t=Cn(i)):(Gi=t,t=n)}else Gi=t,t=n;return t}function Cs(){var e,t,r;return e=Gi,Ra()!==n?(Pa(),(t=is())!==n?(Pa(),Na()!==n?(Pa(),(r=is())!==n?(qi=e,e=Un(t,r)):(Gi=e,e=n)):(Gi=e,e=n)):(Gi=e,e=n)):(Gi=e,e=n),e}function Os(){var e,t,r;return e=Gi,Ra()!==n?(Pa(),(t=is())!==n?(Pa(),Na()!==n?(Pa(),(r=is())!==n?(qi=e,e=Zn(t,r)):(Gi=e,e=n)):(Gi=e,e=n)):(Gi=e,e=n)):(Gi=e,e=n),e}function ks(){var e,t;return e=Gi,Ca()!==n?(Pa(),(t=is())!==n?(qi=e,e=zn(t)):(Gi=e,e=n)):(Gi=e,e=n),e}function Ds(){var t,r,i;return(t=Zs())===n&&(t=Gi,r=e.charAt(Gi),ve.test(r)?Gi++:(r=n,0===$i&&es(Pe)),r!==n&&(i=Zs())!==n?(qi=t,t=Hn(r,i)):(Gi=t,t=n)),t}function Ps(){var t,r,i;return t=Gi,46===e.charCodeAt(Gi)?(r=_,Gi++):(r=n,0===$i&&es(Ye)),r!==n?((i=Zs())===n&&(i=null),qi=t,t=$n(i)):(Gi=t,t=n),t}function Us(){var e,t,r;return e=Gi,(t=Vs())!==n&&(r=Zs())!==n?(qi=e,e=Jn(t,r)):(Gi=e,e=n),e}function Zs(){var e,t,r;if(e=Gi,t=[],(r=zs())!==n)for(;r!==n;)t.push(r),r=zs();else t=n;return t!==n&&(qi=e,t=Yn(t)),t}function zs(){var t;return t=e.charAt(Gi),xe.test(t)?Gi++:(t=n,0===$i&&es(We)),t}function Vs(){var t,r,i;return t=Gi,r=e.charAt(Gi),Me.test(r)?Gi++:(r=n,0===$i&&es(Qe)),r!==n?(i=e.charAt(Gi),ve.test(i)?Gi++:(i=n,0===$i&&es(Pe)),i===n&&(i=null),qi=t,t=Wn(r,i)):(Gi=t,t=n),t}function Gs(){var t,r,i,s;return t=Gi,(r=e.substr(Gi,4)).toLowerCase()===w?Gi+=4:(r=n,0===$i&&es(Xe)),r!==n?(i=Gi,$i++,s=gs(),$i--,s===n?i=void 0:(Gi=i,i=n),i!==n?t=r=[r,i]:(Gi=t,t=n)):(Gi=t,t=n),t}function qs(){var t,r,i,s;return t=Gi,(r=e.substr(Gi,4)).toLowerCase()===b?Gi+=4:(r=n,0===$i&&es(Ke)),r!==n?(i=Gi,$i++,s=gs(),$i--,s===n?i=void 0:(Gi=i,i=n),i!==n?t=r=[r,i]:(Gi=t,t=n)):(Gi=t,t=n),t}function Bs(){var t,r,i,s;return t=Gi,(r=e.substr(Gi,5)).toLowerCase()===T?Gi+=5:(r=n,0===$i&&es(et)),r!==n?(i=Gi,$i++,s=gs(),$i--,s===n?i=void 0:(Gi=i,i=n),i!==n?t=r=[r,i]:(Gi=t,t=n)):(Gi=t,t=n),t}function js(){var t,r,i,s;return t=Gi,(r=e.substr(Gi,2)).toLowerCase()===S?Gi+=2:(r=n,0===$i&&es(tt)),r!==n?(i=Gi,$i++,s=gs(),$i--,s===n?i=void 0:(Gi=i,i=n),i!==n?(qi=t,t=Qn()):(Gi=t,t=n)):(Gi=t,t=n),t}function Hs(){var t,r,i,s;return t=Gi,(r=e.substr(Gi,2)).toLowerCase()===I?Gi+=2:(r=n,0===$i&&es(rt)),r!==n?(i=Gi,$i++,s=gs(),$i--,s===n?i=void 0:(Gi=i,i=n),i!==n?(qi=t,t=Xn()):(Gi=t,t=n)):(Gi=t,t=n),t}function $s(){var t,r,i,s;return t=Gi,(r=e.substr(Gi,4)).toLowerCase()===x?Gi+=4:(r=n,0===$i&&es(nt)),r!==n?(i=Gi,$i++,s=gs(),$i--,s===n?i=void 0:(Gi=i,i=n),i!==n?(qi=t,t=Kn()):(Gi=t,t=n)):(Gi=t,t=n),t}function Js(){var t,r,i,s;return t=Gi,(r=e.substr(Gi,6)).toLowerCase()===M?Gi+=6:(r=n,0===$i&&es(it)),r!==n?(i=Gi,$i++,s=gs(),$i--,s===n?i=void 0:(Gi=i,i=n),i!==n?(qi=t,t=ei()):(Gi=t,t=n)):(Gi=t,t=n),t}function Ys(){var t,r,i,s;return t=Gi,(r=e.substr(Gi,3)).toLowerCase()===F?Gi+=3:(r=n,0===$i&&es(st)),r!==n?(i=Gi,$i++,s=gs(),$i--,s===n?i=void 0:(Gi=i,i=n),i!==n?(qi=t,t=ti()):(Gi=t,t=n)):(Gi=t,t=n),t}function Ws(){var t,r,i,s;return t=Gi,(r=e.substr(Gi,3)).toLowerCase()===L?Gi+=3:(r=n,0===$i&&es(at)),r!==n?(i=Gi,$i++,s=gs(),$i--,s===n?i=void 0:(Gi=i,i=n),i!==n?(qi=t,t=ri()):(Gi=t,t=n)):(Gi=t,t=n),t}function Qs(){var t,r,i,s;return t=Gi,(r=e.substr(Gi,2)).toLowerCase()===E?Gi+=2:(r=n,0===$i&&es(ot)),r!==n?(i=Gi,$i++,s=gs(),$i--,s===n?i=void 0:(Gi=i,i=n),i!==n?(qi=t,t=ni()):(Gi=t,t=n)):(Gi=t,t=n),t}function Xs(){var t,r,i,s;return t=Gi,(r=e.substr(Gi,7)).toLowerCase()===A?Gi+=7:(r=n,0===$i&&es(lt)),r!==n?(i=Gi,$i++,s=gs(),$i--,s===n?i=void 0:(Gi=i,i=n),i!==n?(qi=t,t=ii()):(Gi=t,t=n)):(Gi=t,t=n),t}function Ks(){var t,r,i,s;return t=Gi,(r=e.substr(Gi,4)).toLowerCase()===R?Gi+=4:(r=n,0===$i&&es(ut)),r!==n?(i=Gi,$i++,s=gs(),$i--,s===n?i=void 0:(Gi=i,i=n),i!==n?(qi=t,t=si()):(Gi=t,t=n)):(Gi=t,t=n),t}function ea(){var t,r,i,s;return t=Gi,(r=e.substr(Gi,3)).toLowerCase()===N?Gi+=3:(r=n,0===$i&&es(ct)),r!==n?(i=Gi,$i++,s=gs(),$i--,s===n?i=void 0:(Gi=i,i=n),i!==n?(qi=t,t=ai()):(Gi=t,t=n)):(Gi=t,t=n),t}function ta(){var t,r,i,s;return t=Gi,(r=e.substr(Gi,9)).toLowerCase()===C?Gi+=9:(r=n,0===$i&&es(dt)),r!==n?(i=Gi,$i++,s=gs(),$i--,s===n?i=void 0:(Gi=i,i=n),i!==n?(qi=t,t=oi()):(Gi=t,t=n)):(Gi=t,t=n),t}function ra(){var t,r,i,s;return t=Gi,(r=e.substr(Gi,7)).toLowerCase()===O?Gi+=7:(r=n,0===$i&&es(ht)),r!==n?(i=Gi,$i++,s=gs(),$i--,s===n?i=void 0:(Gi=i,i=n),i!==n?(qi=t,t=li()):(Gi=t,t=n)):(Gi=t,t=n),t}function na(){var t,r,i,s;return t=Gi,(r=e.substr(Gi,4)).toLowerCase()===k?Gi+=4:(r=n,0===$i&&es(pt)),r!==n?(i=Gi,$i++,s=gs(),$i--,s===n?i=void 0:(Gi=i,i=n),i!==n?(qi=t,t=ui()):(Gi=t,t=n)):(Gi=t,t=n),t}function ia(){var t,r,i,s;return t=Gi,(r=e.substr(Gi,8)).toLowerCase()===D?Gi+=8:(r=n,0===$i&&es(ft)),r!==n?(i=Gi,$i++,s=gs(),$i--,s===n?i=void 0:(Gi=i,i=n),i!==n?(qi=t,t=ci()):(Gi=t,t=n)):(Gi=t,t=n),t}function sa(){var t,r,i,s;return t=Gi,(r=e.substr(Gi,9)).toLowerCase()===P?Gi+=9:(r=n,0===$i&&es(mt)),r!==n?(i=Gi,$i++,s=gs(),$i--,s===n?i=void 0:(Gi=i,i=n),i!==n?(qi=t,t=di()):(Gi=t,t=n)):(Gi=t,t=n),t}function aa(){var t,r,i,s;return t=Gi,(r=e.substr(Gi,4)).toLowerCase()===U?Gi+=4:(r=n,0===$i&&es(yt)),r!==n?(i=Gi,$i++,s=gs(),$i--,s===n?i=void 0:(Gi=i,i=n),i!==n?(qi=t,t=hi()):(Gi=t,t=n)):(Gi=t,t=n),t}function oa(){var t,r,i,s;return t=Gi,(r=e.substr(Gi,4)).toLowerCase()===Z?Gi+=4:(r=n,0===$i&&es(gt)),r!==n?(i=Gi,$i++,s=gs(),$i--,s===n?i=void 0:(Gi=i,i=n),i!==n?(qi=t,t=pi()):(Gi=t,t=n)):(Gi=t,t=n),t}function la(){var t,r,i,s;return t=Gi,(r=e.substr(Gi,7)).toLowerCase()===z?Gi+=7:(r=n,0===$i&&es(vt)),r!==n?(i=Gi,$i++,s=gs(),$i--,s===n?i=void 0:(Gi=i,i=n),i!==n?(qi=t,t=fi()):(Gi=t,t=n)):(Gi=t,t=n),t}function ua(){var t,r,i,s;return t=Gi,(r=e.substr(Gi,8)).toLowerCase()===V?Gi+=8:(r=n,0===$i&&es(_t)),r!==n?(i=Gi,$i++,s=gs(),$i--,s===n?i=void 0:(Gi=i,i=n),i!==n?(qi=t,t=mi()):(Gi=t,t=n)):(Gi=t,t=n),t}function ca(){var t,r,i,s;return t=Gi,(r=e.substr(Gi,4)).toLowerCase()===G?Gi+=4:(r=n,0===$i&&es(wt)),r!==n?(i=Gi,$i++,s=gs(),$i--,s===n?i=void 0:(Gi=i,i=n),i!==n?(qi=t,t=yi()):(Gi=t,t=n)):(Gi=t,t=n),t}function da(){var t,r,i,s;return t=Gi,(r=e.substr(Gi,4)).toLowerCase()===q?Gi+=4:(r=n,0===$i&&es(bt)),r!==n?(i=Gi,$i++,s=gs(),$i--,s===n?i=void 0:(Gi=i,i=n),i!==n?(qi=t,t=gi()):(Gi=t,t=n)):(Gi=t,t=n),t}function ha(){var t,r,i,s;return t=Gi,(r=e.substr(Gi,2)).toLowerCase()===B?Gi+=2:(r=n,0===$i&&es(Tt)),r!==n?(i=Gi,$i++,s=gs(),$i--,s===n?i=void 0:(Gi=i,i=n),i!==n?(qi=t,t=vi()):(Gi=t,t=n)):(Gi=t,t=n),t}function pa(){var t,r,i,s;return t=Gi,(r=e.substr(Gi,7)).toLowerCase()===j?Gi+=7:(r=n,0===$i&&es(St)),r!==n?(i=Gi,$i++,s=gs(),$i--,s===n?i=void 0:(Gi=i,i=n),i!==n?(qi=t,t=_i()):(Gi=t,t=n)):(Gi=t,t=n),t}function fa(){var t,r,i,s;return t=Gi,(r=e.substr(Gi,3)).toLowerCase()===H?Gi+=3:(r=n,0===$i&&es(It)),r!==n?(i=Gi,$i++,s=gs(),$i--,s===n?i=void 0:(Gi=i,i=n),i!==n?(qi=t,t=wi()):(Gi=t,t=n)):(Gi=t,t=n),t}function ma(){var t,r,i,s;return t=Gi,(r=e.substr(Gi,8)).toLowerCase()===$?Gi+=8:(r=n,0===$i&&es(xt)),r!==n?(i=Gi,$i++,s=gs(),$i--,s===n?i=void 0:(Gi=i,i=n),i!==n?(qi=t,t=bi()):(Gi=t,t=n)):(Gi=t,t=n),t}function ya(){var t,r,i,s;return t=Gi,(r=e.substr(Gi,5)).toLowerCase()===J?Gi+=5:(r=n,0===$i&&es(Mt)),r!==n?(i=Gi,$i++,s=gs(),$i--,s===n?i=void 0:(Gi=i,i=n),i!==n?(qi=t,t=Ti()):(Gi=t,t=n)):(Gi=t,t=n),t}function ga(){var t,r,i,s;return t=Gi,(r=e.substr(Gi,4)).toLowerCase()===W?Gi+=4:(r=n,0===$i&&es(Ft)),r!==n?(i=Gi,$i++,s=gs(),$i--,s===n?i=void 0:(Gi=i,i=n),i!==n?(qi=t,t=Si()):(Gi=t,t=n)):(Gi=t,t=n),t}function va(){var t,r,i,s;return t=Gi,(r=e.substr(Gi,7)).toLowerCase()===Q?Gi+=7:(r=n,0===$i&&es(Lt)),r!==n?(i=Gi,$i++,s=gs(),$i--,s===n?i=void 0:(Gi=i,i=n),i!==n?(qi=t,t=Ii()):(Gi=t,t=n)):(Gi=t,t=n),t}function _a(){var t,r,i,s;return t=Gi,(r=e.substr(Gi,2)).toLowerCase()===X?Gi+=2:(r=n,0===$i&&es(Et)),r!==n?(i=Gi,$i++,s=gs(),$i--,s===n?i=void 0:(Gi=i,i=n),i!==n?(qi=t,t=xi()):(Gi=t,t=n)):(Gi=t,t=n),t}function wa(){var t,r,i,s;return t=Gi,(r=e.substr(Gi,8)).toLowerCase()===K?Gi+=8:(r=n,0===$i&&es(At)),r!==n?(i=Gi,$i++,s=gs(),$i--,s===n?i=void 0:(Gi=i,i=n),i!==n?(qi=t,t=Mi()):(Gi=t,t=n)):(Gi=t,t=n),t}function ba(){var t,r,i,s;return t=Gi,(r=e.substr(Gi,4)).toLowerCase()===ee?Gi+=4:(r=n,0===$i&&es(Rt)),r!==n?(i=Gi,$i++,s=gs(),$i--,s===n?i=void 0:(Gi=i,i=n),i!==n?(qi=t,t=Fi()):(Gi=t,t=n)):(Gi=t,t=n),t}function Ta(){var t,r,i,s;return t=Gi,(r=e.substr(Gi,13)).toLowerCase()===te?Gi+=13:(r=n,0===$i&&es(Nt)),r!==n?(i=Gi,$i++,s=gs(),$i--,s===n?i=void 0:(Gi=i,i=n),i!==n?(qi=t,t=Li()):(Gi=t,t=n)):(Gi=t,t=n),t}function Sa(){var t,r,i,s;return t=Gi,(r=e.substr(Gi,15)).toLowerCase()===re?Gi+=15:(r=n,0===$i&&es(Ct)),r!==n?(i=Gi,$i++,s=gs(),$i--,s===n?i=void 0:(Gi=i,i=n),i!==n?(qi=t,t=Ei()):(Gi=t,t=n)):(Gi=t,t=n),t}function Ia(){var t,r,i,s;return t=Gi,(r=e.substr(Gi,5)).toLowerCase()===ne?Gi+=5:(r=n,0===$i&&es(Ot)),r!==n?(i=Gi,$i++,s=gs(),$i--,s===n?i=void 0:(Gi=i,i=n),i!==n?(qi=t,t=Ai()):(Gi=t,t=n)):(Gi=t,t=n),t}function xa(){var t,r,i,s;return t=Gi,(r=e.substr(Gi,3)).toLowerCase()===ie?Gi+=3:(r=n,0===$i&&es(kt)),r!==n?(i=Gi,$i++,s=gs(),$i--,s===n?i=void 0:(Gi=i,i=n),i!==n?(qi=t,t=Ri()):(Gi=t,t=n)):(Gi=t,t=n),t}function Ma(){var t,r,i,s;return t=Gi,(r=e.substr(Gi,4)).toLowerCase()===se?Gi+=4:(r=n,0===$i&&es(Dt)),r!==n?(i=Gi,$i++,s=gs(),$i--,s===n?i=void 0:(Gi=i,i=n),i!==n?(qi=t,t=Ni()):(Gi=t,t=n)):(Gi=t,t=n),t}function Fa(){var t,r,i,s;return t=Gi,(r=e.substr(Gi,6)).toLowerCase()===ae?Gi+=6:(r=n,0===$i&&es(Pt)),r!==n?(i=Gi,$i++,s=gs(),$i--,s===n?i=void 0:(Gi=i,i=n),i!==n?(qi=t,t=Ci()):(Gi=t,t=n)):(Gi=t,t=n),t}function La(){var t,r,i,s;return t=Gi,(r=e.substr(Gi,6)).toLowerCase()===oe?Gi+=6:(r=n,0===$i&&es(Ut)),r!==n?(i=Gi,$i++,s=gs(),$i--,s===n?i=void 0:(Gi=i,i=n),i!==n?(qi=t,t=Oi()):(Gi=t,t=n)):(Gi=t,t=n),t}function Ea(){var t,r,i,s;return t=Gi,(r=e.substr(Gi,4)).toLowerCase()===le?Gi+=4:(r=n,0===$i&&es(Zt)),r!==n?(i=Gi,$i++,s=gs(),$i--,s===n?i=void 0:(Gi=i,i=n),i!==n?(qi=t,t=ki()):(Gi=t,t=n)):(Gi=t,t=n),t}function Aa(){var t,r,i,s;return t=Gi,(r=e.substr(Gi,3)).toLowerCase()===ue?Gi+=3:(r=n,0===$i&&es(zt)),r!==n?(i=Gi,$i++,s=gs(),$i--,s===n?i=void 0:(Gi=i,i=n),i!==n?(qi=t,t=Di()):(Gi=t,t=n)):(Gi=t,t=n),t}function Ra(){var t,r,i,s;return t=Gi,(r=e.substr(Gi,4)).toLowerCase()===ce?Gi+=4:(r=n,0===$i&&es(Vt)),r!==n?(i=Gi,$i++,s=gs(),$i--,s===n?i=void 0:(Gi=i,i=n),i!==n?(qi=t,t=Pi()):(Gi=t,t=n)):(Gi=t,t=n),t}function Na(){var t,r,i,s;return t=Gi,(r=e.substr(Gi,4)).toLowerCase()===de?Gi+=4:(r=n,0===$i&&es(Gt)),r!==n?(i=Gi,$i++,s=gs(),$i--,s===n?i=void 0:(Gi=i,i=n),i!==n?(qi=t,t=Ui()):(Gi=t,t=n)):(Gi=t,t=n),t}function Ca(){var t,r,i,s;return t=Gi,(r=e.substr(Gi,4)).toLowerCase()===he?Gi+=4:(r=n,0===$i&&es(qt)),r!==n?(i=Gi,$i++,s=gs(),$i--,s===n?i=void 0:(Gi=i,i=n),i!==n?(qi=t,t=Zi()):(Gi=t,t=n)):(Gi=t,t=n),t}function Oa(){var t;return 44===e.charCodeAt(Gi)?(t=pe,Gi++):(t=n,0===$i&&es(Bt)),t}function ka(){var t;return 40===e.charCodeAt(Gi)?(t=fe,Gi++):(t=n,0===$i&&es(jt)),t}function Da(){var t;return 41===e.charCodeAt(Gi)?(t=me,Gi++):(t=n,0===$i&&es(Ht)),t}function Pa(){var e,t;for(e=[],t=Ua();t!==n;)e.push(t),t=Ua();return e}function Ua(){var t;return t=e.charAt(Gi),Fe.test(t)?Gi++:(t=n,0===$i&&es($t)),t}function Za(){var t,r,i,s;if(t=Gi,(r=ms())!==n&&(qi=t,r=zi(r)),(t=r)===n)if(t=Gi,96===e.charCodeAt(Gi)?(r=ye,Gi++):(r=n,0===$i&&es(Jt)),r!==n){if(i=[],s=e.charAt(Gi),Le.test(s)?Gi++:(s=n,0===$i&&es(Yt)),s!==n)for(;s!==n;)i.push(s),s=e.charAt(Gi),Le.test(s)?Gi++:(s=n,0===$i&&es(Yt));else i=n;i!==n?(96===e.charCodeAt(Gi)?(s=ye,Gi++):(s=n,0===$i&&es(Jt)),s!==n?(qi=t,t=Vi(i)):(Gi=t,t=n)):(Gi=t,t=n)}else Gi=t,t=n;return t}function za(e,t,r,n,i){const s={type:"binary-expression",location:i,operator:e,left:t,right:r};return void 0!==n&&(s.escape=n),s}function Va(e,...t){return{type:"expression-list",location:e,value:t}}function Ga(e,t){let r=e;for(const{op:e,expr:n,location:{end:i}}of t)r=za(e,r,n,void 0,{...r.location,end:i});return r}if(r=a(),t.peg$library)return{peg$result:r,peg$currPos:Gi,peg$FAILED:n,peg$maxFailExpected:Hi,peg$maxFailPos:ji};if(r!==n&&Gi===e.length)return r;throw r!==n&&Gi<e.length&&es({type:"end"}),function(e,t,r){return new Y(Y.buildMessage(e,t),e,t,r)}(Hi,ji<e.length?e.charAt(ji):null,ji<e.length?Ki(ji,ji+1):Ki(ji,ji))}(e)}}function X(e,t){if(null!=e)switch(t(e),e.type){case"when-clause":X(e.operand,t),X(e.value,t);break;case"case-expression":for(const r of e.clauses)X(r,t);"simple"===e.format&&X(e.operand,t),null!==e.else&&X(e.else,t);break;case"expression-list":for(const r of e.value)X(r,t);break;case"unary-expression":X(e.expr,t);break;case"binary-expression":X(e.left,t),X(e.right,t);break;case"function":X(e.args,t);break;case"interval":X(e.value,t),X(e.qualifier,t);break;case"interval-qualifier":X(e.start,t),X(e.end,t)}}const K=new Set(["current_timestamp","current_date","current_time"]);class ee{static makeBool(e){return re(e)}static featureValue(e,t,r,n){return de(e,t,r,n)}static equalsNull(e){return null===e}static applyLike(e,t,r){return ce(e,t,r)}static ensureArray(e){return ne(e)}static applyIn(e,t,r){return oe(e,t)}static currentTimestamp(e){return b(new Date,e)}static currentDate(e){return a.n.fromNow(e)}static currentTime(e){const t=b(new Date,e);return c.k.fromDateTime(t)}static makeSqlInterval(e,t,r){return l.createFromValueAndQualifier(e,t,r)}static convertInterval(e){return e instanceof l?e.valueInMilliseconds():e}static compare(e,t,r,n){return U(t,r,e)}static calculate(e,t,r,n){return $(e,t,r,n)}static evaluateTime(e){return A(e)}static evaluateTimestamp(e,t,r){return R(e,t,r)}static evaluateDate(e,t){return N(e,t)}static evaluateFunction(e,t,r){return G(e,t,r)}static lookup(e,t){const r=t[e];return void 0===r?null:r}static between(e,t,r){return null==e||null==t[0]||null==t[1]?null:U(e,t[0],">=")&&U(e,t[1],"<=")}static notbetween(e,t,r){return null==e||null==t[0]||null==t[1]?null:U(e,t[0],"<")||U(e,t[1],">")}static ternaryNot(e){return ie(e)}static ternaryAnd(e,t){return se(e,t)}static ternaryOr(e,t){return ae(e,t)}}class te{constructor(e,t,r="UTC",n=null){this.fieldsIndex=t,this.timeZone=r,this.currentUser=n,this.parameters={},this._hasDateFunctions=void 0,this.parseTree=Q.parse(e);const{isStandardized:i,isAggregate:s,currentUserRequired:a,referencedFieldNames:o}=this._extractExpressionInfo(t);this._referencedFieldNames=o,this.isStandardized=i,this.isAggregate=s,this.currentUserRequired=a}static convertValueToStorageFormat(e,t=null){if(null===t)return x(e)?e.getTime():M(e)?e.toMillis():E(e)?e.toStorageFormat():L(e)?e.toStorageString():F(e)?e.toStorageFormat():e;switch(t){case"date":return x(e)?e.getTime():M(e)?e.toMillis():E(e)?e.toMilliseconds():F(e)?e.toNumber():e;case"date-only":return x(e)?a.n.fromDateJS(e).toString():E(e)?a.n.fromSqlTimeStampOffset(e).toString():M(e)?a.n.fromDateTime(e).toString():e;case"time-only":return x(e)?c.k.fromDateJS(e).toStorageString():M(e)?c.k.fromDateTime(e).toStorageString():E(e)?c.k.fromSqlTimeStampOffset(e).toStorageString():L(e)?e.toStorageString():e;case"timestamp-offset":if(x(e))return u.g.fromJSDate(e).toStorageFormat();if(M(e))return u.g.fromDateTime(e).toStorageFormat();if(E(e))return e.toStorageFormat()}return e}static create(e,t={}){return new te(e,t.fieldsIndex,t.timeZone??void 0,t.currentUser)}get fieldNames(){return this._referencedFieldNames}testSet(e,t=he,r=this.currentUser){return!!this._evaluateNode(this.parseTree,null,t,e,r)}calculateValue(e,t=he,r=this.currentUser){const n=this._evaluateNode(this.parseTree,e,t,null,r);return n instanceof l?n.valueInMilliseconds()/864e5:n}calculateValueCompiled(e,t=he,r=this.currentUser){return null!=this.parseTree._compiledVersion?this.parseTree._compiledVersion(e,this.parameters,t,this.fieldsIndex,this.timeZone,r??null):(0,i.A)("esri-csp-restrictions")?this.calculateValue(e,t):(this._compileMe(),this.parseTree._compiledVersion(e,this.parameters,t,this.fieldsIndex,this.timeZone,r??null))}testFeature(e,t=he,r=this.currentUser){return!!this._evaluateNode(this.parseTree,e,t,null,r)}testFeatureCompiled(e,t=he,r=this.currentUser){return null!=this.parseTree._compiledVersion?!!this.parseTree._compiledVersion(e,this.parameters,t,this.fieldsIndex,this.timeZone,r??null):(0,i.A)("esri-csp-restrictions")?this.testFeature(e,t):(this._compileMe(),!!this.parseTree._compiledVersion(e,this.parameters,t,this.fieldsIndex,this.timeZone,r??null))}get hasDateFunctions(){return null!=this._hasDateFunctions||(this._hasDateFunctions=!1,X(this.parseTree,(e=>{"current-time"===e.type?this._hasDateFunctions=!0:"function"===e.type&&(this._hasDateFunctions=this._hasDateFunctions||K.has(e.name.toLowerCase()))}))),this._hasDateFunctions}getFunctions(){const e=new Set;return X(this.parseTree,(t=>{"function"===t.type&&e.add(t.name.toLowerCase())})),Array.from(e)}getExpressions(){const e=new Map;return X(this.parseTree,(t=>{if("function"===t.type){const r=t.name.toLowerCase(),n=t.args.value[0];if("column-reference"===n.type){const t=n.column,i=`${r}-${t}`;e.has(i)||e.set(i,{aggregateType:r,field:t})}}})),[...e.values()]}getVariables(){const e=new Set;return X(this.parseTree,(t=>{"parameter"===t.type&&e.add(t.value.toLowerCase())})),Array.from(e)}_compileMe(){const e="return this.convertInterval("+this.evaluateNodeToJavaScript(this.parseTree)+")";this.parseTree._compiledVersion=new Function("feature","lookups","attributeAdapter","fieldsIndex","timeZone","currentUser",e).bind(ee)}_extractExpressionInfo(e){const t=[],r=new Set;let n=!0,i=!1,a=!1;return X(this.parseTree,(o=>{switch(o.type){case"column-reference":{const n=e?.get(o.column);let i,s;n?i=s=n.name??"":(s=o.column,i=s.toLowerCase()),r.has(i)||(r.add(i),t.push(s)),o.column=s;break}case"current-user":a=!0;break;case"function":{const{name:e,args:t}=o,r=t.value.length;n&&(n=function(e,t){const r=H[e.toLowerCase()];return null!=r&&t>=r.minParams&&t<=r.maxParams}(e,r)),!1===i&&(i=(0,s.M)(e,r));break}}})),{referencedFieldNames:Array.from(t),isStandardized:n,isAggregate:i,currentUserRequired:a}}evaluateNodeToJavaScript(e){switch(e.type){case"interval":return"this.makeSqlInterval("+this.evaluateNodeToJavaScript(e.value)+", "+JSON.stringify(e.qualifier)+","+JSON.stringify(e.op)+")";case"case-expression":{let t="";if("simple"===e.format){const r=this.evaluateNodeToJavaScript(e.operand);t="( ";for(let n=0;n<e.clauses.length;n++)t+=" (this.compare('=',"+r+","+this.evaluateNodeToJavaScript(e.clauses[n].operand)+") ? ("+this.evaluateNodeToJavaScript(e.clauses[n].value)+") : ";null!==e.else?t+=this.evaluateNodeToJavaScript(e.else):t+="null",t+=" )"}else{t="( ";for(let r=0;r<e.clauses.length;r++)t+=" this.makeBool("+this.evaluateNodeToJavaScript(e.clauses[r].operand)+")===true ? ("+this.evaluateNodeToJavaScript(e.clauses[r].value)+") : ";null!==e.else?t+=this.evaluateNodeToJavaScript(e.else):t+="null",t+=" )"}return t}case"parameter":return"this.lookup("+JSON.stringify(e.value.toLowerCase())+",lookups)";case"expression-list":{let t="[";for(const r of e.value)"["!==t&&(t+=","),t+=this.evaluateNodeToJavaScript(r);return t+="]",t}case"unary-expression":return"this.ternaryNot("+this.evaluateNodeToJavaScript(e.expr)+")";case"binary-expression":switch(e.operator){case"AND":return"this.ternaryAnd("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+" )";case"OR":return"this.ternaryOr("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+" )";case"IS":if("null"!==e.right.type)throw new o.L8(o.Z7.UnsupportedIsRhs);return"this.equalsNull("+this.evaluateNodeToJavaScript(e.left)+")";case"ISNOT":if("null"!==e.right.type)throw new o.L8(o.Z7.UnsupportedIsRhs);return"(!(this.equalsNull("+this.evaluateNodeToJavaScript(e.left)+")))";case"IN":return"this.applyIn("+this.evaluateNodeToJavaScript(e.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(e.right)+"), timeZone)";case"NOT IN":return"this.ternaryNot(this.applyIn("+this.evaluateNodeToJavaScript(e.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(e.right)+"), timeZone))";case"BETWEEN":return"this.between("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+", timeZone)";case"NOTBETWEEN":return"this.notbetween("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+", timeZone)";case"LIKE":return"this.applyLike("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+","+JSON.stringify(e.escape)+")";case"NOT LIKE":return"this.ternaryNot(this.applyLike("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+","+JSON.stringify(e.escape)+"))";case"<>":case"<":case">":case">=":case"<=":case"=":return"this.compare("+JSON.stringify(e.operator)+","+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+", timeZone)";case"*":case"-":case"+":case"/":case"||":return"this.calculate("+JSON.stringify(e.operator)+","+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+", timeZone)";default:throw new o.L8(o.Z7.UnsupportedOperator,{operator:e.operator})}case"null":case"boolean":case"string":case"number":return JSON.stringify(e.value);case"time":return"this.evaluateTime("+JSON.stringify(e.value)+")";case"date":return"this.evaluateDate("+JSON.stringify(e.value)+", 'unknown')";case"timestamp":return"this.evaluateTimestamp("+JSON.stringify(e.value)+", 'unknown')";case"current-time":return"date"===e.mode?"this.currentDate(timeZone)":"time"===e.mode?"this.currentTime(timeZone)":"this.currentTimestamp(timeZone)";case"current-user":return"currentUser";case"column-reference":return"this.featureValue(feature,"+JSON.stringify(e.column)+",fieldsIndex,attributeAdapter)";case"function":return"this.evaluateFunction("+JSON.stringify(e.name)+","+this.evaluateNodeToJavaScript(e.args)+", timeZone)"}throw new o.L8(o.Z7.UnsupportedSyntax,{node:e.type})}_evaluateNode(e,t,r,i,a){let u;switch(e.type){case"interval":{const n=this._evaluateNode(e.value,t,r,i,a);return l.createFromValueAndQualifier(n,e.qualifier,e.op)}case"case-expression":if("simple"===e.format){const n=this._evaluateNode(e.operand,t,r,i,a);for(let s=0;s<e.clauses.length;s++)if(U(n,this._evaluateNode(e.clauses[s].operand,t,r,i,a),"=",this.timeZone))return this._evaluateNode(e.clauses[s].value,t,r,i,a);if(null!==e.else)return this._evaluateNode(e.else,t,r,i,a)}else{for(let n=0;n<e.clauses.length;n++)if(re(this._evaluateNode(e.clauses[n].operand,t,r,i,a)))return this._evaluateNode(e.clauses[n].value,t,r,i,a);if(null!==e.else)return this._evaluateNode(e.else,t,r,i,a)}return null;case"parameter":return u=this.parameters[e.value.toLowerCase()],x(u)?h.c9.fromJSDate(u):u instanceof n.lY?u.toDateTime():u;case"expression-list":{const n=[];for(const s of e.value)n.push(this._evaluateNode(s,t,r,i,a));return n}case"unary-expression":return ie(this._evaluateNode(e.expr,t,r,i,a));case"binary-expression":switch(e.operator){case"AND":return se(this._evaluateNode(e.left,t,r,i,a),this._evaluateNode(e.right,t,r,i,a));case"OR":return ae(this._evaluateNode(e.left,t,r,i,a),this._evaluateNode(e.right,t,r,i,a));case"IS":if("null"!==e.right.type)throw new o.L8(o.Z7.UnsupportedIsRhs);return null===this._evaluateNode(e.left,t,r,i,a);case"ISNOT":if("null"!==e.right.type)throw new o.L8(o.Z7.UnsupportedIsRhs);return null!==this._evaluateNode(e.left,t,r,i,a);case"IN":{const n=ne(this._evaluateNode(e.right,t,r,i,a));return oe(this._evaluateNode(e.left,t,r,i,a),n,this.timeZone)}case"NOT IN":{const n=ne(this._evaluateNode(e.right,t,r,i,a));return ie(oe(this._evaluateNode(e.left,t,r,i,a),n,this.timeZone))}case"BETWEEN":{const n=this._evaluateNode(e.left,t,r,i,a),s=this._evaluateNode(e.right,t,r,i,a);return null==n||null==s[0]||null==s[1]?null:U(n,s[0],">=",this.timeZone)&&U(n,s[1],"<=",this.timeZone)}case"NOTBETWEEN":{const n=this._evaluateNode(e.left,t,r,i,a),s=this._evaluateNode(e.right,t,r,i,a);return null==n||null==s[0]||null==s[1]?null:U(n,s[0],"<",this.timeZone)||U(n,s[1],">",this.timeZone)}case"LIKE":return ce(this._evaluateNode(e.left,t,r,i,a),this._evaluateNode(e.right,t,r,i,a),e.escape);case"NOT LIKE":return ie(ce(this._evaluateNode(e.left,t,r,i,a),this._evaluateNode(e.right,t,r,i,a),e.escape));case"<>":case"<":case">":case">=":case"<=":case"=":return U(this._evaluateNode(e.left,t,r,i,a),this._evaluateNode(e.right,t,r,i,a),e.operator,this.timeZone);case"-":case"+":case"*":case"/":case"||":return $(e.operator,this._evaluateNode(e.left,t,r,i,a),this._evaluateNode(e.right,t,r,i,a),this.timeZone)}case"null":case"boolean":case"string":case"number":return e.value;case"date":return e.parsedValue??=N(e.value,"unknown"),e.parsedValue;case"timestamp":return e.parsedValue??=R(e.value,"unknown"),e.parsedValue;case"time":return A(e.value);case"current-time":return"date"===e.mode?ee.currentDate(this.timeZone):"time"===e.mode?ee.currentTime(this.timeZone):ee.currentTimestamp(this.timeZone);case"current-user":return a??null;case"column-reference":return de(t,e.column,this.fieldsIndex,r);case"data-type":return e.value;case"function":{if(this.isAggregate&&(0,s.M)(e.name,e.args.value.length)){const t=[];for(const n of e.args?.value||[]){const e=[];for(const t of i||[])e.push(this._evaluateNode(n,t,r,null,a));t.push(e)}return(0,s.s)(e.name,t)}const n=this._evaluateNode(e.args,t,r,i,a);return G(e.name,n,this.timeZone)}}throw new o.L8(o.Z7.UnsupportedSyntax,{node:e.type})}}function re(e){return!0===e}function ne(e){return Array.isArray(e)?e:[e]}function ie(e){return null!==e?!0!==e:null}function se(e,t){return null!=e&&null!=t?!0===e&&!0===t:!1!==e&&!1!==t&&null}function ae(e,t){return null!=e&&null!=t?!0===e||!0===t:!0===e||!0===t||null}function oe(e,t,r){if(null==e)return null;let n=!1;for(const r of t)if(null==r)n=null;else{if(e===r){n=!0;break}if(D(e)&&D(r)&&(n=U(e,r,"="),n))break}return n}const le="-[]/{}()*+?.\\^$|";var ue;function ce(e,t,r){return null==e?null:function(e,t){const r=t;let n="",i=ue.Normal;for(let t=0;t<e.length;t++){const s=e.charAt(t);switch(i){case ue.Normal:s===r?i=ue.Escaped:le.includes(s)?n+="\\"+s:n+="%"===s?".*":"_"===s?".":s;break;case ue.Escaped:le.includes(s)?n+="\\"+s:n+=s,i=ue.Normal}}return new RegExp("^"+n+"$","m")}(t,r).test(e)}function de(e,t,r,n){const i=n.getAttribute(e,t),s=r?.get(t);return null==i||"esriFieldTypeDate"!==s?.type&&"date"!==s?.type?null==i||"esriFieldTypeDateOnly"!==s?.type&&"date-only"!==s?.type?null==i||"esriFieldTypeTimeOnly"!==s?.type&&"time-only"!==s?.type?null==i||"esriFieldTypeTimestampOffset"!==s?.type&&"timestamp-offset"!==s?.type?i:new u.g(i):c.k.fromReader(i):a.n.fromReader(i):b(new Date(i),r?.getLuxonTimeZone(s.name)??h.mQ.utcInstance)}!function(e){e[e.Normal=0]="Normal",e[e.Escaped=1]="Escaped"}(ue||(ue={}));const he={getAttribute:(e,t)=>(function(e){return e&&"object"==typeof e.attributes}(e)?e.attributes:e)[t]}},93393:function(e,t,r){r.d(t,{L8:function(){return o},Z7:function(){return n}});var n,i,s=r(50944);(i=n||(n={})).InvalidFunctionParameters="InvalidFunctionParameters",i.InvalidValueForAggregateFunction="InvalidValueForAggregateFunction",i.UnsupportedSqlFunction="UnsupportedSqlFunction",i.UnsupportedOperator="UnsupportedOperator",i.UnsupportedSyntax="UnsupportedSyntax",i.UnsupportedIsRhs="UnsupportedIsRhs",i.UnsupportedIsLhs="UnsupportedIsLhs",i.InvalidDataType="InvalidDataType",i.CannotCastValue="CannotCastValue",i.FunctionNotRecognized="FunctionNotRecognized",i.InvalidTime="InvalidTime",i.InvalidParameterCount="InvalidParameterCount",i.InvalidTimeStamp="InvalidTimeStamp",i.InvalidDate="InvalidDate",i.InvalidOperator="InvalidOperator",i.IllegalInterval="IllegalInterval",i.YearMonthIntervals="YearMonthIntervals",i.PrimarySecondaryQualifiers="PrimarySecondaryQualifiers",i.MissingStatisticParameters="MissingStatisticParameters";const a={[n.InvalidValueForAggregateFunction]:"Invalid value used in aggregate function",[n.MissingStatisticParameters]:"Statistic does not have 1 or 0 Parameters",[n.InvalidFunctionParameters]:"Invalid parameters for call to {function}",[n.UnsupportedIsLhs]:"Unsupported left hand expression in is statement",[n.UnsupportedIsRhs]:"Unsupported right hand expression in is statement",[n.UnsupportedOperator]:"Unsupported operator - {operator}",[n.UnsupportedSyntax]:"Unsupported syntax - {node}",[n.UnsupportedSqlFunction]:"Sql function not found = {function}",[n.InvalidDataType]:"Invalid sql data type",[n.InvalidDate]:"Invalid date encountered",[n.InvalidOperator]:"Invalid operator encountered",[n.InvalidTime]:"Invalid time encountered",[n.IllegalInterval]:"Illegal interval",[n.FunctionNotRecognized]:"Function not recognized",[n.InvalidTimeStamp]:"Invalid timestamp encountered",[n.InvalidParameterCount]:"Invalid parameter count for call to {name}",[n.PrimarySecondaryQualifiers]:"Primary and Secondary SqlInterval qualifiers not supported",[n.YearMonthIntervals]:"Year-Month Intervals not supported",[n.CannotCastValue]:"Cannot cast value to the required data type"};class o extends Error{constructor(e,t){super((0,s.HC)(a[e],t)),this.declaredRootClass="esri.arcade.featureset.support.sqlerror",Error.captureStackTrace&&Error.captureStackTrace(this,o)}}},20248:function(e,t,r){r.d(t,{U:function(){return c}});var n=r(53804),i=r(83525),s=r(61226),a=r(28181),o=r(74087),l=r(23502),u=r(65953);let c=class extends i.A{constructor(){super(...arguments),this.updating=!1,this._handleId=0,this._scheduleHandleId=0,this._pendingPromises=new Set}destroy(){this.removeAll()}add(e,t,r={}){return this._installWatch(e,t,r,a.watch)}addWhen(e,t,r={}){return this._installWatch(e,t,r,a.when)}addOnCollectionChange(e,t,{initial:r=!1,final:n=!1}={}){const i=++this._handleId;return this.addHandles([(0,a.on)(e,"after-changes",this._createSyncUpdatingCallback(),a.OH),(0,a.on)(e,"change",t,{onListenerAdd:r?e=>t({added:e.toArray(),removed:[]}):void 0,onListenerRemove:n?e=>t({added:[],removed:e.toArray()}):void 0})],i),(0,s.hA)((()=>this.removeHandles(i)))}addPromise(e){if(null==e)return e;const t=++this._handleId;this.addHandles((0,s.hA)((()=>{this._pendingPromises.delete(e)&&(0!==this._pendingPromises.size||this.hasHandles(d)||this._set("updating",!1))})),t),this._pendingPromises.add(e),this._set("updating",!0);const r=()=>this.removeHandles(t);return e.then(r,r),e}removeAll(){this._pendingPromises.clear(),this.removeAllHandles(),this._set("updating",!1)}_installWatch(e,t,r={},n){const i=++this._handleId;r.sync||this._installSyncUpdatingWatch(e,i);const a=n(e,t,r);return this.addHandles(a,i),(0,s.hA)((()=>this.removeHandles(i)))}_installSyncUpdatingWatch(e,t){const r=this._createSyncUpdatingCallback(),n=(0,a.watch)(e,r,{sync:!0,equals:()=>!1});return this.addHandles(n,t),n}_createSyncUpdatingCallback(){return()=>{this.removeHandles(d),++this._scheduleHandleId;const e=this._scheduleHandleId;this._get("updating")||this._set("updating",!0),this.addHandles((0,o._)((()=>{e===this._scheduleHandleId&&(this._set("updating",this._pendingPromises.size>0),this.removeHandles(d))})),d)}}};(0,n._)([(0,l.MZ)({readOnly:!0})],c.prototype,"updating",void 0),c=(0,n._)([(0,u.$)("esri.core.support.UpdatingHandles")],c);const d=-42},66110:function(e,t,r){r.d(t,{AG:function(){return o},lk:function(){return i},vD:function(){return a},yS:function(){return s}});const n="randomUUID"in crypto;function i(){if(n)return crypto.randomUUID();const e=crypto.getRandomValues(new Uint16Array(8));e[3]=4095&e[3]|16384,e[4]=16383&e[4]|32768;const t=t=>e[t].toString(16).padStart(4,"0");return t(0)+t(1)+"-"+t(2)+"-"+t(3)+"-"+t(4)+"-"+t(5)+t(6)+t(7)}function s(){return`{${i().toUpperCase()}}`}function a(){return`{${i()}}`}function o(e){const t=e.toUpperCase();return"{"!==e[0]?`{${t}}`:t}},86029:function(e,t,r){r.d(t,{g:function(){return n}});const n={convertToGEGeometry:function(e,t){return null==t?null:e.convertJSONToGeometry(t)},exportPoint:function(e,t,r){const n=new i(e.getPointX(t),e.getPointY(t),r),s=e.hasZ(t),a=e.hasM(t);return s&&(n.z=e.getPointZ(t)),a&&(n.m=e.getPointM(t)),n},exportPolygon:function(e,t,r){return new s(e.exportPaths(t),r,e.hasZ(t),e.hasM(t))},exportPolyline:function(e,t,r){return new a(e.exportPaths(t),r,e.hasZ(t),e.hasM(t))},exportMultipoint:function(e,t,r){return new o(e.exportPoints(t),r,e.hasZ(t),e.hasM(t))},exportExtent:function(e,t,r){const n=e.hasZ(t),i=e.hasM(t),s=new l(e.getXMin(t),e.getYMin(t),e.getXMax(t),e.getYMax(t),r);if(n){const r=e.getZExtent(t);s.zmin=r.vmin,s.zmax=r.vmax}if(i){const r=e.getMExtent(t);s.mmin=r.vmin,s.mmax=r.vmax}return s}};class i{constructor(e,t,r){this.x=e,this.y=t,this.spatialReference=r,this.z=void 0,this.m=void 0}}class s{constructor(e,t,r,n){this.rings=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,r&&(this.hasZ=r),n&&(this.hasM=n)}}class a{constructor(e,t,r,n){this.paths=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,r&&(this.hasZ=r),n&&(this.hasM=n)}}class o{constructor(e,t,r,n){this.points=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,r&&(this.hasZ=r),n&&(this.hasM=n)}}class l{constructor(e,t,r,n,i){this.xmin=e,this.ymin=t,this.xmax=r,this.ymax=n,this.spatialReference=i,this.zmin=void 0,this.zmax=void 0,this.mmin=void 0,this.mmax=void 0}}},65298:function(e,t,r){r.d(t,{O7:function(){return M},Hr:function(){return x},el:function(){return I},mT:function(){return F},XX:function(){return w}});var n=r(25591),i=r(39819),s=r(40633),a=r(44740),o=r(91508),l=r(65417),u=r(57652),c=r(1644),d=(r(50917),r(93040)),h=r(74697),p=r(39397),f=r(90683),m=r(26765);const y=()=>s.A.getLogger("esri.geometry.support.normalizeUtils");function g(e){return"polygon"===e[0].type}function v(e){return"polyline"===e[0].type}function _(e){const t=[];let r=0,n=0;for(let i=0;i<e.length;i++){const s=e[i];let a=null;for(let e=0;e<s.length;e++)a=s[e],t.push(a),0===e?(r=a[0],n=r):(r=Math.min(r,a[0]),n=Math.max(n,a[0]));a&&t.push([(r+n)/2,0])}return t}function w(e,t){if(!(e instanceof o.A||e instanceof a.A)){const e="straightLineDensify: the input geometry is neither polyline nor polygon";throw y().error(e),new i.A(e)}const r=(0,l.r8)(e),n=[];for(const e of r){const r=[];n.push(r),r.push([e[0][0],e[0][1]]);for(let n=0;n<e.length-1;n++){const i=e[n][0],s=e[n][1],a=e[n+1][0],o=e[n+1][1],l=Math.sqrt((a-i)*(a-i)+(o-s)*(o-s)),u=(o-s)/l,c=(a-i)/l,d=l/t;if(d>1){for(let e=1;e<=d-1;e++){const n=e*t,a=c*n+i,o=u*n+s;r.push([a,o])}const e=(l+Math.floor(d-1)*t)/2,n=c*e+i,a=u*e+s;r.push([n,a])}r.push([a,o])}}return function(e){return"polygon"===e.type}(e)?new a.A({rings:n,spatialReference:e.spatialReference}):new o.A({paths:n,spatialReference:e.spatialReference})}function b(e,t,r){if(t){const t=w(e,1e6);e=(0,c.ci)(t,!0)}return r&&(e=(0,l.kS)(e,r)),e}function T(e,t,r){if(Array.isArray(e)){const n=e[0];if(n>t){const r=(0,l.kd)(n,t);e[0]=n+r*(-2*t)}else if(n<r){const t=(0,l.kd)(n,r);e[0]=n+t*(-2*r)}}else{const n=e.x;if(n>t){const r=(0,l.kd)(n,t);e=e.clone().offset(r*(-2*t),0)}else if(n<r){const t=(0,l.kd)(n,r);e=e.clone().offset(t*(-2*r),0)}}return e}function S(e,t){let r=-1;for(let n=0;n<t.cutIndexes.length;n++){const i=t.cutIndexes[n],s=t.geometries[n],a=(0,l.r8)(s);for(let e=0;e<a.length;e++){const t=a[e];t.some((r=>{if(r[0]<180)return!0;{let r=0;for(let e=0;e<t.length;e++){const n=t[e][0];r=n>r?n:r}r=Number(r.toFixed(9));const n=-360*(0,l.kd)(r,180);for(let r=0;r<t.length;r++){const t=s.getPoint(e,r);s.setPoint(e,r,t.clone().offset(n,0))}return!0}}))}if(i===r){if(g(e))for(const t of(0,l.r8)(s))e[i]=e[i].addRing(t);else if(v(e))for(const t of(0,l.r8)(s))e[i]=e[i].addPath(t)}else r=i,e[i]=s}return e}async function I(e,t,r){if(!Array.isArray(e))return I([e],t);t&&"string"!=typeof t&&y().warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");const i="string"==typeof t?t:t?.url??n.default.geometryServiceUrl;let s,g,v,_,w,x,M,F,L=0;const E=[],A=[];for(const t of e)if(null!=t)if(s||(s=t.spatialReference,g=(0,u.Vp)(s),v=s.isWebMercator,x=v?102100:4326,_=l.j7[x].maxX,w=l.j7[x].minX,M=l.j7[x].plus180Line,F=l.j7[x].minus180Line),g)if("mesh"===t.type)A.push(t);else if("point"===t.type)A.push(T(t.clone(),_,w));else if("multipoint"===t.type){const e=t.clone();e.points=e.points.map((e=>T(e,_,w))),A.push(e)}else if("extent"===t.type){const e=t.clone()._normalize(!1,!1,g);A.push(e.rings?new a.A(e):e)}else if(t.extent){const e=t.extent,r=(0,l.kd)(e.xmin,w)*(2*_);let n=0===r?t.clone():(0,l.kS)(t.clone(),r);e.offset(r,0);let{xmin:i,xmax:s}=e;i=Number(i.toFixed(9)),s=Number(s.toFixed(9)),e.intersects(M)&&s!==_?(L=s>L?s:L,n=b(n,v),E.push(n),A.push("cut")):e.intersects(F)&&i!==w?(L=s*(2*_)>L?s*(2*_):L,n=b(n,v,360),E.push(n),A.push("cut")):A.push(n)}else A.push(t.clone());else A.push(t);else A.push(t);let R=(0,l.kd)(L,_),N=-90;const C=R,O=new o.A;for(;R>0;){const e=360*R-180;O.addPath([[e,N],[e,-1*N]]),N*=-1,R--}if(E.length>0&&C>0){const t=S(E,await async function(e,t,r,n){const i=(0,p.Dl)(e),s=t[0].spatialReference,a={...n,responseType:"json",query:{...i.query,f:"json",sr:(0,u.YX)(s),target:JSON.stringify({geometryType:(0,h.$B)(t[0]),geometries:t}),cutter:JSON.stringify(r)}},o=await(0,d.A)(i.path+"/cut",a),{cutIndexes:l,geometries:c=[]}=o.data;return{cutIndexes:l,geometries:c.map((e=>{const t=(0,h.rS)(e);return t.spatialReference=s,t}))}}(i,E,O,r)),n=[],s=[];for(let r=0;r<A.length;r++){const i=A[r];if("cut"!==i)s.push(i);else{const i=t.shift(),a=e[r];null!=a&&"polygon"===a.type&&a.rings&&a.rings.length>1&&i.rings.length>=a.rings.length?(n.push(i),s.push("simplify")):s.push(v?(0,c.Gh)(i):i)}}if(!n.length)return s;const a=await async function(e,t,r){const n="string"==typeof e?(0,f.An)(e):e,i=t[0].spatialReference,s=(0,h.$B)(t[0]),a={...r,query:{...n.query,f:"json",sr:(0,u.YX)(i),geometries:JSON.stringify((0,m.X)(t))}},{data:o}=await(0,d.A)(n.path+"/simplify",a);return(0,m.V)(o.geometries,s,i)}(i,n,r),o=[];for(let e=0;e<s.length;e++){const t=s[e];"simplify"!==t?o.push(t):o.push(v?(0,c.Gh)(a.shift()):a.shift())}return o}const k=[];for(let e=0;e<A.length;e++){const t=A[e];if("cut"!==t)k.push(t);else{const e=E.shift();k.push(!0===v?(0,c.Gh)(e):e)}}return k}function x(e){if(!e)return null;const t=e.extent;if(!t)return null;const r=e.spatialReference&&(0,u.Vp)(e.spatialReference);if(!r)return t;const[n,i]=r.valid,s=2*i,{width:a}=t;let o,{xmin:l,xmax:c}=t;if([l,c]=[c,l],"extent"===e.type||0===a||a<=i||a>s||l<n||c>i)return t;switch(e.type){case"polygon":if(!(e.rings.length>1))return t;o=_(e.rings);break;case"polyline":if(!(e.paths.length>1))return t;o=_(e.paths);break;case"multipoint":o=e.points}const d=t.clone();for(let e=0;e<o.length;e++){let t=o[e][0];t<0?(t+=i,c=Math.max(t,c)):(t-=i,l=Math.min(t,l))}return d.xmin=l,d.xmax=c,d.width<a?(d.xmin-=i,d.xmax-=i,d):t}function M(e,t,r){const n=(0,u.Vp)(r);if(null==n)return e;const[i,s]=n.valid,a=2*s;let o=0,l=0;t>s?o=Math.ceil(Math.abs(t-s)/a):t<i&&(o=-Math.ceil(Math.abs(t-i)/a)),e>s?l=Math.ceil(Math.abs(e-s)/a):e<i&&(l=-Math.ceil(Math.abs(e-i)/a));let c=e+(o-l)*a;const d=c-t;return d>s?c-=a:d<i&&(c+=a),c}function F(e,t){const r=(0,u.Vp)(t);if(r){const[t,n]=r.valid,i=n-t;if(e<t)for(;e<t;)e+=i;if(e>n)for(;e>n;)e-=i}return e}},65417:function(e,t,r){r.d(t,{j7:function(){return a},kS:function(){return l},kd:function(){return o},r8:function(){return u}});var n=r(91508),i=r(57165),s=r(74697);const a={102100:{maxX:20037508.342788905,minX:-20037508.342788905,plus180Line:new n.A({paths:[[[20037508.342788905,-20037508.342788905],[20037508.342788905,20037508.342788905]]],spatialReference:i.A.WebMercator}),minus180Line:new n.A({paths:[[[-20037508.342788905,-20037508.342788905],[-20037508.342788905,20037508.342788905]]],spatialReference:i.A.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new n.A({paths:[[[180,-180],[180,180]]],spatialReference:i.A.WGS84}),minus180Line:new n.A({paths:[[[-180,-180],[-180,180]]],spatialReference:i.A.WGS84})}};function o(e,t){return Math.ceil((e-t)/(2*t))}function l(e,t){const r=u(e);for(const e of r)for(const r of e)r[0]+=t;return e}function u(e){return(0,s.Bi)(e)?e.rings:e.paths}},87280:function(e,t,r){function n(e){return e?{originPosition:"upper-left"===e.originPosition?"upperLeft":"lower-left"===e.originPosition?"lowerLeft":e.originPosition,scale:e.tolerance?[e.tolerance,e.tolerance,1,1]:[1,1,1,1],translate:null!=e.extent?[e.extent.xmin,e.extent.ymax,e.extent.zmin??0,e.extent.mmin??0]:[0,0,0,0]}:null}function i(e){if(function(e){return"lowerLeft"===e.originPosition&&4===e.scale.length&&4===e.translate.length}(e))return e;const{originPosition:t,scale:r,translate:n}=e,i=r[0]??1,s=r[1]??1;return{originPosition:"lowerLeft",scale:[i,"lowerLeft"===t?s:-s,r[2]??1,r[3]??1],translate:[n[0]??0,n[1]??0,n[2]??0,n[3]??0]}}function s({scale:e,translate:t},r){return r*e[0]+t[0]}function a({scale:e,translate:t},r){return r*e[1]+t[1]}function o({scale:e,translate:t},r){return(r??0)*e[2]+t[2]}function l({scale:e,translate:t},r){return r?r*e[3]+t[3]:0}function u(e,t){return e&&t?p:e&&!t?d:!e&&t?h:c}r.d(t,{$X:function(){return v},Gy:function(){return m},P5:function(){return _},Q1:function(){return i},SW:function(){return y},Tr:function(){return g},VV:function(){return n}}),r(74697);const c=(e,t)=>{const r=new Array(t.length);if(!t.length)return r;const n=t[0];let i=s(e,n[0]),o=a(e,n[1]);r[0]=[i,o];const{scale:l,originPosition:u}=e,c=l[0],d="lowerLeft"===u?l[1]:-l[1];for(let e=1;e<t.length;e++){const[n,s]=t[e];i+=c*n,o+=d*s,r[e]=[i,o]}return r},d=(e,t)=>{const r=new Array(t.length);if(!t.length)return r;const n=t[0];let i=s(e,n[0]),l=a(e,n[1]);r[0]=[i,l,o(e,n[2])];const{scale:u,originPosition:c}=e,d=u[0],h="lowerLeft"===c?u[1]:-u[1];for(let n=1;n<t.length;n++){const[s,a,u]=t[n];i+=d*s,l+=h*a,r[n]=[i,l,o(e,u)]}return r},h=(e,t)=>{const r=new Array(t.length);if(!t.length)return r;const n=t[0];let i=s(e,n[0]),o=a(e,n[1]);r[0]=[i,o,l(e,n[2])];const{scale:u,originPosition:c}=e,d=u[0],h="lowerLeft"===c?u[1]:-u[1];for(let n=1;n<t.length;n++){const[s,a,u]=t[n];i+=d*s,o+=h*a,r[n]=[i,o,l(e,u)]}return r},p=(e,t)=>{const r=new Array(t.length);if(!t.length)return r;const n=t[0];let i=s(e,n[0]),u=a(e,n[1]);r[0]=[i,u,o(e,n[2]),l(e,n[3])];const{scale:c,originPosition:d}=e,h=c[0],p="lowerLeft"===d?c[1]:-c[1];for(let n=1;n<t.length;n++){const[s,a,c,d]=t[n];i+=h*s,u+=p*a,r[n]=[i,u,o(e,c),l(e,d)]}return r};function f(e,t,r){const n=new Array(r.length);for(let i=0;i<r.length;i++)n[i]=t(e,r[i]);return n}function m(e,t,r){const n=i(e);return t.x=function({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}(n,r.x),t.y=function({scale:e,translate:t},r){return Math.round((r-t[1])/e[1])}(n,r.y),null!=r.z&&(t.z=function({scale:e,translate:t},r){return Math.round(((r??0)-t[2])/e[2])}(n,r.z)),null!=r.m&&(t.m=function({scale:e,translate:t},r){return r?Math.round((r-t[3])/e[3]):0}(n,r.m)),t}function y(e,t,r,n=r?.hasZ??!1,s=r?.hasM??!1){if(null!=r){const a=i(e);t.points=u(n,s)(a,r.points),t.hasZ=n,t.hasM=s}return t}function g(e,t,r,n=null!=r?.z,u=null!=r?.m){if(null==r)return t;const c=i(e);return t.x=s(c,r.x),t.y=a(c,r.y),n&&(t.z=o(c,r.z)),u&&(t.m=l(c,r.m)),t}function v(e,t,r,n=r?.hasZ??!1,s=r?.hasM??!1){if(null!=r){const a=i(e);t.rings=f(a,u(n,s),r.rings),t.hasZ=n,t.hasM=s}return t}function _(e,t,r,n=r?.hasZ??!1,s=r?.hasM??!1){if(null!=r){const a=i(e);t.paths=f(a,u(n,s),r.paths),t.hasZ=n,t.hasM=s}return t}},65215:function(e,t,r){r.d(t,{N3:function(){return s},Om:function(){return i}});var n=r(76613);class i{constructor(e=null,t={},r,n){this.geometry=e,this.attributes=t,this.centroid=r,this.objectId=n,this.displayId=0,this.geohashX=0,this.geohashY=0}static fromJSON(e,t){const r=e.geometry?n.A.fromJSON(e.geometry):null,s=e.centroid?n.A.fromJSON(e.centroid):null,a=e.attributes[t];return new i(r,e.attributes,s,a)}weakClone(){const e=new i(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e.geohashX=this.geohashX,e.geohashY=this.geohashY,e}clone(){const e=this.geometry?.clone(),t=new i(e,{...this.attributes},this.centroid?.clone(),this.objectId);return t.displayId=this.displayId,t.geohashX=this.geohashX,t.geohashY=this.geohashY,t}}function s(e){return!!e.geometry?.coords?.length}},72887:function(e,t,r){r.d(t,{A:function(){return n}});class n{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const e=new n;return e.objectIdFieldName=this.objectIdFieldName,e.globalIdFieldName=this.globalIdFieldName,e.geohashFieldName=this.geohashFieldName,e.geometryProperties=this.geometryProperties,e.geometryType=this.geometryType,e.spatialReference=this.spatialReference,e.hasZ=this.hasZ,e.hasM=this.hasM,e.features=this.features,e.fields=this.fields,e.transform=this.transform,e.exceededTransferLimit=this.exceededTransferLimit,e.uniqueIdField=this.uniqueIdField,e.queryGeometry=this.queryGeometry,e.queryGeometryType=this.queryGeometryType,e}}},76613:function(e,t,r){r.d(t,{A:function(){return n}});class n{constructor(e=[],t=[]){this.lengths=e??[],this.coords=t??[]}static fromJSON(e){return new n(e.lengths,e.coords)}static fromRect(e){const[t,r,i,s]=e,a=i-t,o=s-r;return new n([5],[t,r,a,0,0,o,-a,0,0,-o])}get isPoint(){return 0===this.lengths.length&&this.coords.length>=2}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce(((e,t)=>e+t))}forEachVertex(e){let t=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let r=0;r<this.lengths.length;r++){const n=this.lengths[r];for(let r=0;r<n;r++)e(this.coords[2*(r+t)],this.coords[2*(r+t)+1]);t+=n}}deltaDecode(){const e=this.clone(),{coords:t,lengths:r}=e;let n=0;for(const e of r){for(let r=1;r<e;r++)t[2*(n+r)]+=t[2*(n+r)-2],t[2*(n+r)+1]+=t[2*(n+r)-1];n+=e}return e}clone(e){if(0===this.lengths.length)return new n([],[this.coords[0],this.coords[1]]);const t=2*(0===this.lengths.length?1:this.lengths.reduce(((e,t)=>e+t))),r=this.coords.slice(0,t);return e?(e.set(r),new n(this.lengths,e)):new n(Array.from(this.lengths),Array.from(r))}}},40302:function(e,t,r){function n(e,t){return e?t?4:3:t?3:2}function i(e,t,r,i){if(!t?.lengths.length)return null;e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0);const o=e.coords,l=[],u=r?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:c,coords:d}=t,h=n(r,i);let p=0;for(const e of c){const t=s(u,d,p,e,r,i);t&&l.push(t),p+=e*h}if(l.sort(((e,t)=>{let n=e[2]-t[2];return 0===n&&r&&(n=e[4]-t[4]),n})),l.length){let e=6*l[0][2];o[0]=l[0][0]/e,o[1]=l[0][1]/e,r&&(e=6*l[0][4],o[2]=0!==e?l[0][3]/e:0),(o[0]<u[0]||o[0]>u[1]||o[1]<u[2]||o[1]>u[3]||r&&(o[2]<u[4]||o[2]>u[5]))&&(o.length=0)}if(!o.length){const e=t.lengths[0]?a(d,0,c[0],r,i):null;if(!e)return null;o[0]=e[0],o[1]=e[1],r&&e.length>2&&(o[2]=e[2])}return e}function s(e,t,r,i,s,a){const o=n(s,a);let l=r,u=r+o,c=0,d=0,h=0,p=0,f=0;for(let r=0,n=i-1;r<n;r++,l+=o,u+=o){const r=t[l],n=t[l+1],i=t[l+2],a=t[u],o=t[u+1],m=t[u+2];let y=r*o-a*n;p+=y,c+=(r+a)*y,d+=(n+o)*y,s&&(y=r*m-a*i,h+=(i+m)*y,f+=y),r<e[0]&&(e[0]=r),r>e[1]&&(e[1]=r),n<e[2]&&(e[2]=n),n>e[3]&&(e[3]=n),s&&(i<e[4]&&(e[4]=i),i>e[5]&&(e[5]=i))}if(p>0&&(p*=-1),f>0&&(f*=-1),!p)return null;const m=[c,d,.5*p];return s&&(m[3]=h,m[4]=.5*f),m}function a(e,t,r,i,s){const a=n(i,s);let d=t,h=t+a,p=0,f=0,m=0,y=0;for(let t=0,n=r-1;t<n;t++,d+=a,h+=a){const t=e[d],r=e[d+1],n=e[d+2],s=e[h],a=e[h+1],g=e[h+2],v=i?l(t,r,n,s,a,g):o(t,r,s,a);if(v)if(p+=v,i){const e=c(t,r,n,s,a,g);f+=v*e[0],m+=v*e[1],y+=v*e[2]}else{const e=u(t,r,s,a);f+=v*e[0],m+=v*e[1]}}return p>0?i?[f/p,m/p,y/p]:[f/p,m/p]:r>0?i?[e[t],e[t+1],e[t+2]]:[e[t],e[t+1]]:null}function o(e,t,r,n){const i=r-e,s=n-t;return Math.sqrt(i*i+s*s)}function l(e,t,r,n,i,s){const a=n-e,o=i-t,l=s-r;return Math.sqrt(a*a+o*o+l*l)}function u(e,t,r,n){return[e+.5*(r-e),t+.5*(n-t)]}function c(e,t,r,n,i,s){return[e+.5*(n-e),t+.5*(i-t),r+.5*(s-r)]}r.d(t,{Q:function(){return i}})},75623:function(e,t,r){r.d(t,{F:function(){return o}});var n=r(58941),i=r(50612),s=r(87416);const a={minX:0,minY:0,maxX:0,maxY:0};class o{constructor(){this._indexInvalid=!1,this._boundsToLoad=[],this._boundsById=new Map,this._idByBounds=new Map,this._index=new i.w(9,(0,n.A)("esri-csp-restrictions")?e=>({minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}):["[0]","[1]","[2]","[3]"]),this._loadIndex=()=>{if(this._indexInvalid){const e=new Array(this._idByBounds.size);let t=0;this._idByBounds.forEach(((r,n)=>{e[t++]=n})),this._indexInvalid=!1,this._index.clear(),this._index.load(e)}else this._boundsToLoad.length&&(this._index.load(Array.from(new Set(this._boundsToLoad.filter((e=>this._idByBounds.has(e)))))),this._boundsToLoad.length=0)}}get fullBounds(){if(!this._boundsById.size)return null;const e=(0,s.Ie)();for(const t of this._boundsById.values())t&&(e[0]=Math.min(t[0],e[0]),e[1]=Math.min(t[1],e[1]),e[2]=Math.max(t[2],e[2]),e[3]=Math.max(t[3],e[3]));return e}get valid(){return!this._indexInvalid}clear(){this._indexInvalid=!1,this._boundsToLoad.length=0,this._boundsById.clear(),this._idByBounds.clear(),this._index.clear()}delete(e){const t=this._boundsById.get(e);this._boundsById.delete(e),t&&(this._idByBounds.delete(t),this._indexInvalid||this._index.remove(t))}forEachInBounds(e,t){this._loadIndex(),function(e,t,r){(function(e){a.minX=e[0],a.minY=e[1],a.maxX=e[2],a.maxY=e[3]})(t),e.search(a,r)}(this._index,e,(e=>t(this._idByBounds.get(e))))}get(e){return this._boundsById.get(e)}has(e){return this._boundsById.has(e)}invalidateIndex(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)}set(e,t){if(!this._indexInvalid){const t=this._boundsById.get(e);t&&(this._index.remove(t),this._idByBounds.delete(t))}this._boundsById.set(e,t),t&&(this._idByBounds.set(t,e),this._indexInvalid||(this._boundsToLoad.push(t),this._boundsToLoad.length>5e4&&this._loadIndex()))}}},34794:function(e,t,r){r.d(t,{A:function(){return f}});var n=r(50659),i=r(39819),s=r(48996),a=r(40633),o=r(24761),l=r(87416),u=r(58081),c=r(75623),d=r(78956),h=r(46805);const p=(0,o.vt)();class f{constructor(e){this.geometryInfo=e,this._boundsStore=new c.F,this._featuresById=new Map,this.events=new s.A,this.featureAdapter=h.T}get geometryType(){return this.geometryInfo.geometryType}get hasM(){return this.geometryInfo.hasM}get hasZ(){return this.geometryInfo.hasZ}get numFeatures(){return this._featuresById.size}get fullBounds(){return this._boundsStore.fullBounds}get storeStatistics(){let e=0;return this._featuresById.forEach((t=>{null!=t.geometry&&t.geometry.coords&&(e+=t.geometry.coords.length)})),{featureCount:this._featuresById.size,vertexCount:e/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}}getFullExtent(e){if(null==this.fullBounds)return null;const[t,r,n,i]=this.fullBounds;return{xmin:t,ymin:r,xmax:n,ymax:i,spatialReference:(0,d.ag)(e)}}add(e){this._add(e),this._emitChanged()}addMany(e){for(const t of e)this._add(t);this._emitChanged()}upsertMany(e){const t=e.map((e=>this._upsert(e)));return this._emitChanged(),t.filter(n.Ru)}clear(){this._featuresById.clear(),this._boundsStore.clear(),this._emitChanged()}removeById(e){const t=this._featuresById.get(e);return t?(this._remove(t),this._emitChanged(),t):null}removeManyById(e){this._boundsStore.invalidateIndex();for(const t of e){const e=this._featuresById.get(t);e&&this._remove(e)}this._emitChanged()}forEachBounds(e,t){for(const r of e){const e=this._boundsStore.get(r.objectId);e&&t((0,o.Jt)(p,e))}}getFeature(e){return this._featuresById.get(e)}has(e){return this._featuresById.has(e)}forEach(e){this._featuresById.forEach((t=>e(t)))}forEachInBounds(e,t){this._boundsStore.forEachInBounds(e,(e=>{t(this._featuresById.get(e))}))}_emitChanged(){this.events.emit("changed",void 0)}_add(e){if(!e)return;const t=e.objectId;if(null==t)return void a.A.getLogger("esri.layers.graphics.data.FeatureStore").error(new i.A("featurestore:invalid-feature","feature id is missing",{feature:e}));const r=this._featuresById.get(t);let n;if(r?(e.displayId=r.displayId,n=this._boundsStore.get(t),this._boundsStore.delete(t)):null!=this.onFeatureAdd&&this.onFeatureAdd(e),!e.geometry?.coords?.length)return this._boundsStore.set(t,null),void this._featuresById.set(t,e);n=(0,u.jQ)(null!=n?n:(0,l.vt)(),e.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),null!=n&&this._boundsStore.set(t,n),this._featuresById.set(t,e)}_upsert(e){const t=e?.objectId;if(null==t)return a.A.getLogger("esri.layers.graphics.data.FeatureStore").error(new i.A("featurestore:invalid-feature","feature id is missing",{feature:e})),null;const r=this._featuresById.get(t);if(!r)return this._add(e),e;const{geometry:n,attributes:s}=e;for(const e in s)r.attributes[e]=s[e];return n&&(r.geometry=n,this._boundsStore.set(t,(0,u.jQ)((0,l.vt)(),n,this.geometryInfo.hasZ,this.geometryInfo.hasM)??null)),r}_remove(e){null!=this.onFeatureRemove&&this.onFeatureRemove(e);const t=e.objectId;return this._boundsStore.delete(t),this._featuresById.delete(t),e}}},75707:function(e,t,r){r.d(t,{d:function(){return ue}});var n=r(50659),i=r(39819),s=r(30905),a=r(21609),o=r(95929),l=r(60539),u=r(62938),c=r(46157),d=r(24761),h=r(87416),p=r(35068),f=r(74697),m=r(65298),y=r(57652),g=r(58081),v=r(99680),_=r(16177),w=r(55644);const b=new class{constructor(e,t){this._cache=new v.q(e),this._invalidCache=new v.q(t)}get(e,t){const r=`${t.uid}:${e}`,n=this._cache.get(r);if(n)return n;if(null!=this._invalidCache.get(r))return null;try{const n=_.WhereClause.create(e,{fieldsIndex:t});return this._cache.put(r,n),n}catch(e){return this._invalidCache.put(r,e),null}}getError(e,t){const r=`${t.uid}:${e}`;return this._invalidCache.get(r)??null}}(50,500),T="unsupported-query",S=" as ",I=new Set(["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeBigInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong"]),x=new Set(["esriFieldTypeDate","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]),M=new Set(["esriFieldTypeString","esriFieldTypeGUID","esriFieldTypeGlobalID",...I,...x]);function F(e,t,r={}){const n=E(t,e);if(!n){const r=b.getError(t,e);throw new i.A(T,"invalid SQL expression",{expression:t,error:r})}const s=r.expressionName||"expression";if(r.validateStandardized&&!n.isStandardized)throw new i.A(T,`${s} is not standard`,{expression:t});if(r.validateAggregate&&!n.isAggregate)throw new i.A(T,`${s} does not contain a valid aggregate function`,{expression:t});return n.fieldNames}function L(e,t,r,n,s){if(!r)return!0;const a="having clause",o=F(e,r,{validateAggregate:!0,expressionName:a});N(e,t,o,{expressionName:a,query:s});const l=E(r,e),u=l?.getExpressions().every((t=>{const{aggregateType:r,field:i}=t,s=e.get(i)?.name;return n.some((t=>{const{onStatisticField:n,statisticType:i}=t,a=e.get(n)?.name;return a===s&&i.toLowerCase().trim()===r}))}));if(!u)throw new i.A(T,"expressions in having clause should also exist in outStatistics",{having:r});return!0}function E(e,t){return e?b.get(e,t):null}function A(e){return/\((.*?)\)/.test(e)?e:e.split(S)[0]}function R(e){return e.split(S)[1]}function N(e,t,r,n={}){const s=new Map;if(function(e,t,r,n,i){const s=i.includes("*")?[...r,...i.filter((e=>"*"!==e))]:i;for(const i of s)if(t.get(i))C(e,t,r,n,i);else try{const s=F(t,A(i),{validateStandardized:!0});for(const i of s)C(e,t,r,n,i)}catch(t){e.set(i,{type:"expression-error",expression:i,error:t})}}(s,e,t,n.allowedFieldTypes??M,r),s.size){const e=n.expressionName??"expression";throw new i.A(T,`${e} contains invalid or missing fields`,{errors:Array.from(s.values()),query:n.query})}}function C(e,t,r,n,i){const s=t.get(i);s?r.has(s.name)?"all"!==n&&!1===n?.has(s.type)&&e.set(i,{type:"invalid-type",fieldName:s.name,fieldType:w.m.fromJSON(s.type),allowedFieldTypes:Array.from(n,(e=>w.m.fromJSON(e)))}):e.set(i,{type:"missing-field",fieldName:s.name}):e.set(i,{type:"invalid-field",fieldName:i})}var O=r(78956),k=r(74841);class D{constructor(){this._storage=new Map,this._purgeInterval=5,this._sweep=()=>{if(this._timer=void 0,!this._storage)return;const e=1e3*this._purgeInterval,t=performance.now()-e;for(const[r,n]of this._storage){if(!(n.time<t))return void(this._storage.size>0&&(this._timer=setTimeout(this._sweep,e)));this._storage.delete(r)}}}destroy(){this._storage?.clear(),this._storage=null,clearTimeout(this._timer)}get size(){return this._storage?.size??0}put(e,t){this._storage?.set(e,new U(t)),this._scheduleSweep()}get(e){if(!this._storage)return;const t=this._storage?.get(e);return t?(this._storage?.delete(e),t.time=performance.now(),this._storage?.set(e,t),t.items):void 0}clear(){this._storage?.clear()}_scheduleSweep(){this._storage&&(this._timer??=setTimeout(this._sweep,1e3*this._purgeInterval))}}let P=0;class U{constructor(e){this.items=e,this.time=performance.now(),this.id=P++}}var Z=r(7121),z=r(72228),V=r(38503),G=r(87280),q=r(53743),B=r(92586),j=r(66164),H=r(54547);class ${constructor(e,t,r){this._fieldDataCache=new Map,this._returnDistinctMap=new Map,this.returnDistinctValues=e.returnDistinctValues??!1,this.fieldsIndex=r,this.featureAdapter=t;const n=e.outFields;if(n&&!n.includes("*")){this.outFields=n;let e=0;for(const t of n){const n=A(t),i=this.fieldsIndex.get(n),s=i?null:E(n,r),a=i?i.name:R(t)||"FIELD_EXP_"+e++;this._fieldDataCache.set(t,{alias:a,clause:s})}}}countDistinctValues(e){return this.returnDistinctValues?(e.forEach((e=>this.getAttributes(e))),this._returnDistinctMap.size):e.length}getAttributes(e){const t=this._processAttributesForOutFields(e);return this._processAttributesForDistinctValues(t)}getFieldValue(e,t,r){const n=r?r.name:t;let i=null;return this._fieldDataCache.has(n)?i=this._fieldDataCache.get(n)?.clause:r||(i=E(t,this.fieldsIndex),this._fieldDataCache.set(n,{alias:n,clause:i})),r?this.featureAdapter.getAttribute(e,n):i?.calculateValue(e,this.featureAdapter)}getDataValues(e,t,r=!0){const n=t.normalizationType,i=t.normalizationTotal,s=this.fieldsIndex.get(t.field),a=(0,q.zD)(s)||(0,q.Ah)(s),o=(0,q.OH)(s);return e.map((e=>{let s=t.field&&this.getFieldValue(e,t.field,this.fieldsIndex.get(t.field));if(t.field2?(s=`${(0,j.gJ)(s)}${t.fieldDelimiter}${(0,j.gJ)(this.getFieldValue(e,t.field2,this.fieldsIndex.get(t.field2)))}`,t.field3&&(s=`${s}${t.fieldDelimiter}${(0,j.gJ)(this.getFieldValue(e,t.field3,this.fieldsIndex.get(t.field3)))}`)):"string"==typeof s&&r&&(a?s=s?new Date(s).getTime():null:o&&(s=s?(0,B.rb)(s):null)),n&&Number.isFinite(s)){const r="field"===n&&t.normalizationField?this.getFieldValue(e,t.normalizationField,this.fieldsIndex.get(t.normalizationField)):null;s=(0,j.zS)(s,n,r,i)}return s}))}async getExpressionValues(e,t,r,n,i){const{arcadeUtils:s}=await(0,H.lw)(),a=s.hasGeometryOperations(t);a&&await s.enableGeometryOperations();const o=s.createFunction(t),l=s.getViewInfo(r),u={fields:this.fieldsIndex.fields};return e.map((e=>{const t={attributes:this.featureAdapter.getAttributes(e),layer:u,geometry:a?{...(0,O.pL)(n.geometryType,n.hasZ,n.hasM,this.featureAdapter.getGeometry(e)),spatialReference:r?.spatialReference}:null},c=s.createExecContext(t,l,i);return s.executeFunction(o,c)}))}validateItem(e,t){return this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:E(t,this.fieldsIndex)}),this._fieldDataCache.get(t)?.clause?.testFeature(e,this.featureAdapter)??!1}validateItems(e,t){return this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:E(t,this.fieldsIndex)}),this._fieldDataCache.get(t)?.clause?.testSet(e,this.featureAdapter)??!1}_processAttributesForOutFields(e){const t=this.outFields;if(!t?.length)return this.featureAdapter.getAttributes(e);const r={};for(const n of t){const{alias:t,clause:i}=this._fieldDataCache.get(n);r[t]=i?i.calculateValue(e,this.featureAdapter):this.featureAdapter.getAttribute(e,t)}return r}_processAttributesForDistinctValues(e){if(null==e||!this.returnDistinctValues)return e;const t=this.outFields,r=[];if(t)for(const n of t){const{alias:t}=this._fieldDataCache.get(n);r.push(e[t])}else for(const t in e)r.push(e[t]);const n=`${(t||["*"]).join(",")}=${r.join(",")}`;let i=this._returnDistinctMap.get(n)||0;return this._returnDistinctMap.set(n,++i),i>1?null:e}}var J=r(51376);class Y{constructor(e,t,r){this.items=e,this.query=t,this.geometryType=r.geometryType,this.hasM=r.hasM,this.hasZ=r.hasZ,this.fieldsIndex=r.fieldsIndex,this.objectIdField=r.objectIdField,this.spatialReference=r.spatialReference,this.featureAdapter=r.featureAdapter}get size(){return this.items.length}createQueryResponseForCount(){const e=new $(this.query,this.featureAdapter,this.fieldsIndex);if(!this.query.outStatistics)return e.countDistinctValues(this.items);const{groupByFieldsForStatistics:t,having:r,outStatistics:n}=this.query,i=t?.length;if(!i)return 1;const s=new Map,a=new Map,o=new Set;for(const i of n){const{statisticType:n}=i,l="exceedslimit"!==n?i.onStatisticField:void 0;if(!a.has(l)){const r=[];for(const n of t){const t=this._getAttributeValues(e,n,s);r.push(t)}a.set(l,this._calculateUniqueValues(r,e.returnDistinctValues))}const u=a.get(l);for(const t in u){const{data:n,items:i}=u[t],s=n.join(",");r&&!e.validateItems(i,r)||o.add(s)}}return o.size}async createQueryResponse(){let e;if(e=this.query.outStatistics?this.query.outStatistics.some((e=>"exceedslimit"===e.statisticType))?this._createExceedsLimitQueryResponse(this.query):await this._createStatisticsQueryResponse(this.query):this._createFeatureQueryResponse(this.query),this.query.returnQueryGeometry){const t=this.query.geometry;(0,y.fn)(this.query.outSR)&&!(0,y.aI)(t.spatialReference,this.query.outSR)?e.queryGeometry=(0,O.ag)({spatialReference:this.query.outSR,...(0,k.Cv)(t,t.spatialReference,this.query.outSR)}):e.queryGeometry=(0,O.ag)({spatialReference:this.query.outSR,...t})}return e}createSnappingResponse(e,t){const r=this.featureAdapter,n=Q(this.hasZ,this.hasM),{point:i,mode:s}=e,a="number"==typeof e.distance?e.distance:e.distance.x,o="number"==typeof e.distance?e.distance:e.distance.y,l={candidates:[]},u="esriGeometryPolygon"===this.geometryType,c=this._getPointCreator(s,this.spatialReference,t),d=new X(null,0),h=new X(null,0),p={x:0,y:0,z:0};for(const t of this.items){const s=r.getGeometry(t);if(null==s)continue;const{coords:f,lengths:m}=s;if(d.coords=f,h.coords=f,e.returnEdge){let e=0;for(let s=0;s<m.length;s++){const u=m[s];for(let s=0;s<u;s++,e+=n){const f=d;if(f.coordsIndex=e,s!==u-1){const s=h;s.coordsIndex=e+n;const u=p;W(p,i,f,s);const d=(i.x-u.x)/a,m=(i.y-u.y)/o,y=d*d+m*m;y<=1&&l.candidates.push((0,J.P)(r.getObjectId(t),c(u),Math.sqrt(y),c(f),c(s)))}}}}if("none"!==e.vertexMode){const s=u?f.length-n:f.length;if("all"===e.vertexMode)for(let e=0;e<s;e+=n){const n=d;n.coordsIndex=e;const s=(i.x-n.x)/a,u=(i.y-n.y)/o,h=s*s+u*u;h<=1&&l.candidates.push((0,J.k)(r.getObjectId(t),c(n),Math.sqrt(h)))}else if("ends"===e.vertexMode){const e=[0];u||e.push(f.length-n);for(const n of e){const e=d;e.coordsIndex=n;const s=(i.x-e.x)/a,u=(i.y-e.y)/o,h=s*s+u*u;h<=1&&l.candidates.push((0,J.k)(r.getObjectId(t),c(e),Math.sqrt(h)))}}}}return l.candidates.sort(((e,t)=>e.distance-t.distance)),l}_getPointCreator(e,t,r){const n=null==r||(0,y.aI)(t,r)?e=>e:e=>(0,k.Cv)(e,t,r),{hasZ:i}=this;return"3d"===e?i?({x:e,y:t,z:r})=>n({x:e,y:t,z:r}):({x:e,y:t})=>n({x:e,y:t,z:0}):({x:e,y:t})=>n({x:e,y:t})}async createSummaryStatisticsResponse(e){const{field:t,valueExpression:r,normalizationField:n,normalizationType:i,normalizationTotal:s,minValue:a,maxValue:o,scale:l,timeZone:u,outStatisticTypes:c}=e,d=this.fieldsIndex.get(t),h=(0,q.vE)(d)||(0,q.zD)(d)||(0,q.Ah)(d),p=await this._getDataValues({field:t,valueExpression:r,normalizationField:n,normalizationType:i,normalizationTotal:s,scale:l,timeZone:u}),f=(0,j.Vb)({normalizationType:i,normalizationField:n,minValue:a,maxValue:o}),m={value:.5,fieldType:d?.type},y=(0,q.yM)(d)?(0,j.z9)({values:p,supportsNullCount:f,percentileParams:m,outStatisticTypes:c}):(0,j.G_)({values:p,minValue:a,maxValue:o,useSampleStdDev:!i,supportsNullCount:f,percentileParams:m,outStatisticTypes:c});return(0,j.oZ)(y,c,h)}async createUniqueValuesResponse(e){const{field:t,valueExpression:r,domains:n,returnAllCodedValues:i,scale:s,timeZone:a}=e,o=await this._getDataValues({field:t,field2:e.field2,field3:e.field3,fieldDelimiter:e.fieldDelimiter,valueExpression:r,scale:s,timeZone:a},!1),l=(0,j.b3)(o);return(0,j.lv)(l,n,i,e.fieldDelimiter)}async createClassBreaksResponse(e){const{field:t,valueExpression:r,normalizationField:n,normalizationType:i,normalizationTotal:s,classificationMethod:a,standardDeviationInterval:o,minValue:l,maxValue:u,numClasses:c,scale:d,timeZone:h}=e,p=await this._getDataValues({field:t,valueExpression:r,normalizationField:n,normalizationType:i,normalizationTotal:s,scale:d,timeZone:h}),f=(0,j.Rw)(p,{field:t,normalizationField:n,normalizationType:i,normalizationTotal:s,classificationMethod:a,standardDeviationInterval:o,minValue:l,maxValue:u,numClasses:c});return(0,j.jM)(f,a)}async createHistogramResponse(e){const{field:t,valueExpression:r,normalizationField:n,normalizationType:i,normalizationTotal:s,classificationMethod:a,standardDeviationInterval:o,minValue:l,maxValue:u,numBins:c,scale:d,timeZone:h}=e,p=await this._getDataValues({field:t,valueExpression:r,normalizationField:n,normalizationType:i,normalizationTotal:s,scale:d,timeZone:h});return(0,j.$y)(p,{field:t,normalizationField:n,normalizationType:i,normalizationTotal:s,classificationMethod:a,standardDeviationInterval:o,minValue:l,maxValue:u,numBins:c})}_sortFeatures(e,t,r){if(e.length>1&&t?.length)for(const n of t.reverse()){const t=n.split(" "),i=t[0],s=this.fieldsIndex.get(i),a=!!t[1]&&"desc"===t[1].toLowerCase(),o=(0,j.FM)(s?.type,a);e.sort(((e,t)=>{const n=r(e,i,s),a=r(t,i,s);return o(n,a)}))}}_createFeatureQueryResponse(e){const t=this.items,{geometryType:r,hasM:n,hasZ:i,objectIdField:s,spatialReference:a}=this,{outFields:o,outSR:l,quantizationParameters:u,resultRecordCount:c,resultOffset:d,returnZ:h,returnM:p}=e,f=null!=c&&t.length>(d||0)+c,m=o&&(o.includes("*")?[...this.fieldsIndex.fields]:o.map((e=>this.fieldsIndex.get(e))));return{exceededTransferLimit:f,features:this._createFeatures(e,t),fields:m,geometryType:r,hasM:n&&p,hasZ:i&&h,objectIdFieldName:s,spatialReference:(0,O.ag)(l||a),transform:u&&(0,G.VV)(u)||null}}_createFeatures(e,t){const r=new $(e,this.featureAdapter,this.fieldsIndex),{hasM:n,hasZ:i}=this,{orderByFields:s,quantizationParameters:a,returnGeometry:o,returnCentroid:l,maxAllowableOffset:u,resultOffset:c,resultRecordCount:d,returnZ:h=!1,returnM:p=!1}=e,f=i&&h,m=n&&p;let y=[],g=0;const v=[...t];if(this._sortFeatures(v,s,((e,t,n)=>r.getFieldValue(e,t,n))),this.geometryType&&(o||l)){const e=(0,G.VV)(a)??void 0,t="esriGeometryPolygon"===this.geometryType||"esriGeometryPolyline"===this.geometryType;if(o&&!l)for(const n of v){const i=this.featureAdapter.getGeometry(n),s={attributes:r.getAttributes(n),geometry:(0,O.pL)(this.geometryType,this.hasZ,this.hasM,i,u,e,f,m)};t&&i&&!s.geometry&&(s.centroid=(0,O.LQ)(this,this.featureAdapter.getCentroid(n,this),e)),y[g++]=s}else if(!o&&l)for(const t of v)y[g++]={attributes:r.getAttributes(t),centroid:(0,O.LQ)(this,this.featureAdapter.getCentroid(t,this),e)};else for(const t of v)y[g++]={attributes:r.getAttributes(t),centroid:(0,O.LQ)(this,this.featureAdapter.getCentroid(t,this),e),geometry:(0,O.pL)(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(t),u,e,f,m)}}else for(const e of v){const t=r.getAttributes(e);t&&(y[g++]={attributes:t})}const _=c||0;if(null!=d){const e=_+d;y=y.slice(_,Math.min(y.length,e))}return y}_createExceedsLimitQueryResponse(e){let t=!1,r=Number.POSITIVE_INFINITY,n=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY;for(const t of e.outStatistics??[])if("exceedslimit"===t.statisticType){r=null!=t.maxPointCount?t.maxPointCount:Number.POSITIVE_INFINITY,n=null!=t.maxRecordCount?t.maxRecordCount:Number.POSITIVE_INFINITY,i=null!=t.maxVertexCount?t.maxVertexCount:Number.POSITIVE_INFINITY;break}if("esriGeometryPoint"===this.geometryType)t=this.items.length>r;else if(this.items.length>n)t=!0;else{const e=Q(this.hasZ,this.hasM),r=this.featureAdapter;t=this.items.reduce(((e,t)=>{const n=r.getGeometry(t);return e+(null!=n&&n.coords.length||0)}),0)/e>i}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(t)}}]}}async _createStatisticsQueryResponse(e){const t={attributes:{}},r=[],n=new Map,i=new Map,s=new Map,a=new Map,o=new $(e,this.featureAdapter,this.fieldsIndex),l=e.outStatistics,{groupByFieldsForStatistics:u,having:c,orderByFields:d,resultRecordCount:h}=e,p=u?.length,f=!!p,m=f?u[0]:null,y=f&&!this.fieldsIndex.get(m);for(const e of l??[]){const{outStatisticFieldName:l,statisticType:d}=e,h=e,g="exceedslimit"!==d?e.onStatisticField:void 0,v="percentile_disc"===d||"percentile_cont"===d,_="EnvelopeAggregate"===d||"CentroidAggregate"===d||"ConvexHullAggregate"===d,w=f&&1===p&&(g===m||y)&&"count"===d;if(f){if(!s.has(g)){const e=[];for(const t of u){const r=this._getAttributeValues(o,t,n);e.push(r)}s.set(g,this._calculateUniqueValues(e,!_&&o.returnDistinctValues))}const e=s.get(g);if(!e)continue;const t=Object.keys(e);for(const r of t){const{count:t,data:i,items:s,itemPositions:d}=e[r],p=i.join(",");if(!c||o.validateItems(s,c)){const e=a.get(p)||{attributes:{}};if(_){e.aggregateGeometries||(e.aggregateGeometries={});const{aggregateGeometries:t,outStatisticFieldName:r}=await this._getAggregateGeometry(h,s);e.aggregateGeometries[r]=t}else{let r=null;if(w)r=t;else{const e=this._getAttributeValues(o,g,n),t=d.map((t=>e[t]));r=v&&"statisticParameters"in h?this._getPercentileValue(h,t):this._getStatisticValue(h,t,null,o.returnDistinctValues)}e.attributes[l]=r}let r=0;u.forEach(((t,n)=>e.attributes[this.fieldsIndex.get(t)?t:"EXPR_"+ ++r]=i[n])),a.set(p,e)}}}else if(_){t.aggregateGeometries||(t.aggregateGeometries={});const{aggregateGeometries:e,outStatisticFieldName:r}=await this._getAggregateGeometry(h,this.items);t.aggregateGeometries[r]=e}else{const e=this._getAttributeValues(o,g,n);t.attributes[l]=v&&"statisticParameters"in h?this._getPercentileValue(h,e):this._getStatisticValue(h,e,i,o.returnDistinctValues)}const b="min"!==d&&"max"!==d||!(0,q.yM)(this.fieldsIndex.get(g))&&!this._isAnyDateField(g)?null:this.fieldsIndex.get(g)?.type;r.push({name:l,alias:l,type:b||"esriFieldTypeDouble"})}const g=f?Array.from(a.values()):[t];return this._sortFeatures(g,d,((e,t)=>e.attributes[t])),h&&(g.length=Math.min(h,g.length)),{fields:r,features:g}}_isAnyDateField(e){const t=this.fieldsIndex.get(e);return(0,q.vE)(t)||(0,q.zD)(t)||(0,q.Ah)(t)||(0,q.OH)(t)}async _getAggregateGeometry(e,t){const{convexHull:n,union:i}=await r.e(4696).then(r.bind(r,28356)),{statisticType:s,outStatisticFieldName:a}=e,{featureAdapter:o,spatialReference:l,geometryType:u,hasZ:c,hasM:d}=this,h=t.map((e=>(0,O.pL)(u,c,d,o.getGeometry(e)))),p=n(l,h,!0)[0],f={aggregateGeometries:null,outStatisticFieldName:null};if("EnvelopeAggregate"===s){const e=p?(0,V.v)(p):(0,V.HA)(i(l,h));f.aggregateGeometries={...e,spatialReference:l},f.outStatisticFieldName=a||"extent"}else if("CentroidAggregate"===s){const e=p?(0,z.l8)(p):(0,z.Z4)((0,V.HA)(i(l,h)));f.aggregateGeometries={x:e[0],y:e[1],spatialReference:l},f.outStatisticFieldName=a||"centroid"}else"ConvexHullAggregate"===s&&(f.aggregateGeometries=p,f.outStatisticFieldName=a||"convexHull");return f}_getStatisticValue(e,t,r,n){const{onStatisticField:i,statisticType:s}=e;let a=null;return a=r?.has(i)?r.get(i):(0,q.yM)(this.fieldsIndex.get(i))||this._isAnyDateField(i)?(0,j.z9)({values:t,returnDistinct:n}):(0,j.G_)({values:n?[...new Set(t)]:t,minValue:null,maxValue:null,useSampleStdDev:!0}),r&&r.set(i,a),a["var"===s?"variance":s]}_getPercentileValue(e,t){const{onStatisticField:r,statisticParameters:n,statisticType:i}=e,{value:s,orderBy:a}=n,o=this.fieldsIndex.get(r);return(0,j.qg)(t,{value:s,orderBy:a,fieldType:o?.type,isDiscrete:"percentile_disc"===i})}_getAttributeValues(e,t,r){if(r.has(t))return r.get(t);const n=this.fieldsIndex.get(t),i=this.items.map((r=>e.getFieldValue(r,t,n)));return r.set(t,i),i}_calculateUniqueValues(e,t){const r={},n=this.items,i=n.length;for(let s=0;s<i;s++){const i=n[s],a=[];for(const t of e)a.push(t[s]);const o=a.join(",");null==r[o]?r[o]={count:1,data:a,items:[i],itemPositions:[s]}:(t||r[o].count++,r[o].items.push(i),r[o].itemPositions.push(s))}return r}async _getDataValues(e,t=!0){const r=new $(this.query,this.featureAdapter,this.fieldsIndex),{valueExpression:n,scale:i,timeZone:s}=e;return n?r.getExpressionValues(this.items,n,{viewingMode:"map",scale:i,spatialReference:this.query.outSR||this.spatialReference},{geometryType:this.geometryType,hasZ:this.hasZ,hasM:this.hasM},s):r.getDataValues(this.items,(0,a.o8)(e),t)}}function W(e,t,r,n){const i=n.x-r.x,s=n.y-r.y,a=i*i+s*s,o=(t.x-r.x)*i+(t.y-r.y)*s,l=Math.min(1,Math.max(0,o/a));e.x=r.x+i*l,e.y=r.y+s*l}function Q(e,t){return e?t?4:3:t?3:2}class X{constructor(e,t){this.coords=e,this.coordsIndex=t}get x(){return this.coords[this.coordsIndex]}get y(){return this.coords[this.coordsIndex+1]}get z(){return this.coords[this.coordsIndex+2]}}var K=r(20932),ee=r(62512);const te="unsupported-query";async function re(e,{fieldsIndex:t,geometryType:r,spatialReference:n,availableFields:s}){if((e.distance??0)<0||null!=e.geometryPrecision||e.multipatchOption&&"xyFootprint"!==e.multipatchOption||e.pixelSize||e.relationParam||e.text)throw new i.A(te,"Unsupported query options",{query:e});return ne(t,s,e),function(e,t,r){const{outStatistics:n,groupByFieldsForStatistics:s,having:a}=r,o=s?.length,l=n?.length;if(a){if(!o||!l)throw new i.A(te,"outStatistics and groupByFieldsForStatistics should be specified with having",{query:r});L(e,t,a,n,r)}if(l){if(null==(u=n)||!u.every((e=>"exceedslimit"!==e.statisticType)))return;const a=n.map((e=>e.onStatisticField)).filter(Boolean);N(e,t,a,{expressionName:"onStatisticFields",query:r}),o&&N(e,t,s,{expressionName:"groupByFieldsForStatistics",query:r});for(const s of n){const{onStatisticField:n,statisticType:a}=s;if("percentile_disc"!==a&&"percentile_cont"!==a||!("statisticParameters"in s))e.get(n)&&"count"!==a&&"min"!==a&&"max"!==a&&N(e,t,[n],{expressionName:`outStatistics with '${a}' statistic type`,allowedFieldTypes:ie,query:r});else{const{statisticParameters:e}=s;if(!e)throw new i.A(te,"statisticParameters should be set for percentile type",{definition:s,query:r})}}}var u}(t,s,e),Promise.all([(0,ee.c0)(e,r,n),(0,k.Nk)(n,e.outSR)]).then((()=>e))}function ne(e,t,r){const{outFields:n,orderByFields:s,returnDistinctValues:a,outStatistics:o}=r,l=o?o.map((e=>e.outStatisticFieldName&&e.outStatisticFieldName.toLowerCase())).filter(Boolean):[];if(s&&s.length>0){const n=" asc",i=" desc",a=s.map((e=>{const t=e.toLowerCase();return t.includes(n)?t.split(n)[0]:t.includes(i)?t.split(i)[0]:e})).filter((e=>!l.includes(e)));N(e,t,a,{expressionName:"orderByFields",query:r})}if(n&&n.length>0)N(e,t,n,{expressionName:"outFields",query:r,allowedFieldTypes:"all"});else if(a)throw new i.A(te,"outFields should be specified for returnDistinctValues",{query:r});!function(e,t,r,n){if(!r)return!0;const i="where clause";N(e,t,F(e,r,{validateStandardized:!0,expressionName:i}),{expressionName:i,query:n})}(e,t,r.where,r)}const ie=new Set([...I,...x]);async function se(e,t,r,n){let s=[];if(r.valueExpression){const{arcadeUtils:e}=await(0,H.lw)();s=e.extractFieldNames(r.valueExpression)}if(r.field&&s.push(r.field),r.field2&&s.push(r.field2),r.field3&&s.push(r.field3),r.normalizationField&&s.push(r.normalizationField),!s.length&&!r.valueExpression)throw new i.A(te,"field or valueExpression is required",{params:r});N(e,t,s,{expressionName:"statistics",query:n})}var ae=r(20973),oe=r(7103),le=r(48961);class ue{constructor(e){this._cache=new D,this._changeHandle=null,this.capabilities={query:Z.F},this.geometryType=e.geometryType,this.hasM=!!e.hasM,this.hasZ=!!e.hasZ,this.objectIdField=e.objectIdField,this.spatialReference=e.spatialReference,this.definitionExpression=e.definitionExpression,this.featureStore=e.featureStore,this.aggregateAdapter=e.aggregateAdapter,this._changeHandle=this.featureStore.events.on("changed",(()=>this.clearCache())),this.timeInfo=e.timeInfo,this.fieldsIndex=(0,s.Wj)(e.fieldsIndex)?e.fieldsIndex:oe.A.fromJSON(e.fieldsIndex),!e.availableFields||1===e.availableFields.length&&"*"===e.availableFields[0]?this.availableFields=new Set(this.fieldsIndex.fields.map((e=>e.name))):this.availableFields=new Set(e.availableFields.map((e=>this.fieldsIndex.get(e)?.name)).filter((e=>null!=e))),e.scheduler&&e.priority&&(this._frameTask=e.scheduler.registerTask(e.priority))}destroy(){this._frameTask=(0,o.xt)(this._frameTask),this.clearCache(),(0,o.pR)(this._cache),this._changeHandle=(0,o.xt)(this._changeHandle)}get featureAdapter(){return this.featureStore.featureAdapter}clearCache(){this._cache.clear(),this._allFeaturesPromise=null,this._timeExtentPromise=null,this._fullExtentPromise=null}async executeQuery(e,t){const r=(0,l.Mq)(t);try{const t=await this._executeQuery(e,{},r);return await t.createQueryResponse()}catch(t){if(t!==K.v8)throw t;return new Y([],e,this).createQueryResponse()}}async executeQueryForCount(e={},t){const r=(0,l.Mq)(t);try{return(await this._executeQuery(e,{returnGeometry:!1,returnCentroid:!1,outSR:null},r)).createQueryResponseForCount()}catch(e){if(e!==K.v8)throw e;return 0}}async executeQueryForExtent(e,t){const r=(0,l.Mq)(t),n=e.outSR;try{const t=await this._executeQuery(e,{returnGeometry:!0,returnCentroid:!1,outSR:null},r),i=t.size;return i?{count:i,extent:await this._getBounds(t.items,t.spatialReference,n||this.spatialReference)}:{count:0,extent:null}}catch(e){if(e===K.v8)return{count:0,extent:null};throw e}}async executeQueryForIds(e,t){return this.executeQueryForIdSet(e,t).then((e=>Array.from(e)))}async executeQueryForIdSet(e,t){const r=(0,l.Mq)(t);try{const t=await this._executeQuery(e,{returnGeometry:!0,returnCentroid:!1,outSR:null},r),n=t.items,i=new Set;return await this._reschedule((()=>{for(const e of n)i.add(t.featureAdapter.getObjectId(e))}),r),i}catch(e){if(e===K.v8)return new Set;throw e}}async executeQueryForSnapping(e,t){const r=(0,l.Mq)(t),{point:n,distance:i,returnEdge:s,vertexMode:o}=e;if(!s&&"none"===o)return{candidates:[]};let u=(0,a.o8)(e.query);u=await this._schedule((()=>(0,K.T2)(u,this.definitionExpression,this.spatialReference)),r),u=await this._reschedule((()=>re(u,{availableFields:this.availableFields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,spatialReference:this.spatialReference})),r);const c=!(0,y.aI)(n.spatialReference,this.spatialReference);c&&await(0,k.Nk)(n.spatialReference,this.spatialReference);const d="number"==typeof i?i:i.x,h="number"==typeof i?i:i.y,p={xmin:n.x-d,xmax:n.x+d,ymin:n.y-h,ymax:n.y+h,spatialReference:n.spatialReference},g=c?(0,k.Cv)(p,this.spatialReference):p;if(!g)return{candidates:[]};const v=(await(0,m.el)((0,f.rS)(n),null,{signal:r}))[0],_=(await(0,m.el)((0,f.rS)(g),null,{signal:r}))[0];if(null==v||null==_)return{candidates:[]};const w=new Y(await this._reschedule((()=>this._searchFeatures(ce(_.toJSON()))),r),u,this);await this._reschedule((()=>this._executeObjectIdsQuery(w)),r),await this._reschedule((()=>this._executeTimeQuery(w)),r),await this._reschedule((()=>this._executeAttributesQuery(w)),r),await this._reschedule((()=>this._executeGeometryQueryForSnapping(w,r)),r);const b=v.toJSON(),T=c?(0,k.Cv)(b,this.spatialReference):b,S=c?Math.max(g.xmax-g.xmin,g.ymax-g.ymin)/2:i;return w.createSnappingResponse({...e,point:T,distance:S},n.spatialReference)}async executeQueryForLatestObservations(e,t){const r=(0,l.Mq)(t);if(!this.timeInfo?.trackIdField)throw new i.A("unsupported-query","Missing timeInfo or timeInfo.trackIdField",{query:e,timeInfo:this.timeInfo});try{const t=await this._executeQuery(e,{},r);return await this._reschedule((()=>this._filterLatest(t)),r),await t.createQueryResponse()}catch(t){if(t!==K.v8)throw t;return new Y([],e,this).createQueryResponse()}}async executeQueryForSummaryStatistics(e={},t,r){const n=(0,l.Mq)(r),{field:i,normalizationField:s,valueExpression:a}=t;return(await this._executeQueryForStatistics(e,{field:i,normalizationField:s,valueExpression:a},n)).createSummaryStatisticsResponse(t)}async executeQueryForUniqueValues(e={},t,r){const n=(0,l.Mq)(r),{field:i,field2:s,field3:a,valueExpression:o}=t;return(await this._executeQueryForStatistics(e,{field:i,field2:s,field3:a,valueExpression:o},n)).createUniqueValuesResponse(t)}async executeQueryForClassBreaks(e={},t,r){const n=(0,l.Mq)(r),{field:i,normalizationField:s,valueExpression:a}=t;return(await this._executeQueryForStatistics(e,{field:i,normalizationField:s,valueExpression:a},n)).createClassBreaksResponse(t)}async executeQueryForHistogram(e={},t,r){const n=(0,l.Mq)(r),{field:i,normalizationField:s,valueExpression:a}=t;return(await this._executeQueryForStatistics(e,{field:i,normalizationField:s,valueExpression:a},n)).createHistogramResponse(t)}async fetchRecomputedExtents(e){const t=(0,l.Mq)(e);this._timeExtentPromise||=(0,ae.W)(this.timeInfo,this.featureStore);const[r,n]=await Promise.all([this._getFullExtent(),this._timeExtentPromise]);return(0,l.Te)(t),{fullExtent:r,timeExtent:n}}async _getBounds(e,t,r){const n=(0,d.hZ)((0,d.vt)(),d.qv);await this.featureStore.forEachBounds(e,(e=>(0,d.RF)(n,e)));const i={xmin:n[0],ymin:n[1],xmax:n[3],ymax:n[4],spatialReference:(0,O.ag)(this.spatialReference)};this.hasZ&&isFinite(n[2])&&isFinite(n[5])&&(i.zmin=n[2],i.zmax=n[5],i.hasZ=!0);const s=(0,k.Cv)(i,t,r);if(s.spatialReference=(0,O.ag)(r),s.xmax-s.xmin==0){const e=(0,u.GA)(s.spatialReference);s.xmin-=e,s.xmax+=e}if(s.ymax-s.ymin==0){const e=(0,u.GA)(s.spatialReference);s.ymin-=e,s.ymax+=e}if(this.hasZ&&null!=s.zmin&&null!=s.zmax&&s.zmax-s.zmin==0){const e=(0,u.GA)(s.spatialReference);s.zmin-=e,s.zmax+=e}return s}_getFullExtent(){return this._fullExtentPromise||="getFullExtent"in this.featureStore&&this.featureStore.getFullExtent?Promise.resolve(this.featureStore.getFullExtent(this.spatialReference)):this._getAllFeatures().then((e=>this._getBounds(e,this.spatialReference,this.spatialReference))),this._fullExtentPromise}async _schedule(e,t){return null!=this._frameTask?this._frameTask.schedule(e,t):e(le.Bb)}async _reschedule(e,t){return null!=this._frameTask?this._frameTask.reschedule(e,t):e(le.Bb)}async _getAllFeaturesQueryEngineResult(e){return new Y(await this._getAllFeatures(),e,this)}async _getAllFeatures(){if(null==this._allFeaturesPromise){const e=[];this._allFeaturesPromise=(async()=>{await this.featureStore.forEach((t=>e.push(t)))})().then((()=>e))}const e=this._allFeaturesPromise,t=await e;return e===this._allFeaturesPromise?t.slice():this._getAllFeatures()}async _executeQuery(e,t,r){e=(0,a.o8)(e),e=await this._schedule((()=>(0,K.GC)(e,this.definitionExpression,this.spatialReference)),r),e=await this._reschedule((()=>re(e,{availableFields:this.availableFields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,spatialReference:this.spatialReference})),r),e={...e,...t};const n=await this._reschedule((()=>this._executeSceneFilterQuery(e,r)),r),i=await this._reschedule((()=>this._executeGeometryQuery(e,n,r)),r);return await this._reschedule((()=>this._executeAggregateIdsQuery(i)),r),await this._reschedule((()=>this._executeObjectIdsQuery(i)),r),await this._reschedule((()=>this._executeTimeQuery(i)),r),await this._reschedule((()=>this._executeAttributesQuery(i)),r),i}async _executeSceneFilterQuery(e,t){if(null==e.sceneFilter)return null;const{outSR:r,returnGeometry:n,returnCentroid:i}=e,s=this.featureStore.featureSpatialReference,a=e.sceneFilter.geometry,o=null==s||(0,y.aI)(s,a.spatialReference)?a:(0,k.Cv)(a,s);if(!o)return null;const l=n||i,u=(0,y.fn)(r)&&!(0,y.aI)(this.spatialReference,r)&&l?async e=>this._project(e,r):e=>e,c=this.featureAdapter,d=await this._reschedule((()=>this._searchFeatures(ce(o))),t);if("disjoint"===e.sceneFilter.spatialRelationship){if(!d.length)return null;const r=new Set;for(const e of d)r.add(c.getObjectId(e));const n=await this._reschedule((()=>this._getAllFeatures()),t),i=await this._reschedule((async()=>{const i=await(0,ee.xt)("esriSpatialRelDisjoint",o,this.geometryType,this.hasZ,this.hasM),s=await this._runSpatialFilter(n,(e=>!r.has(c.getObjectId(e))||i(c.getGeometry(e))),t);return new Y(s,e,this)}),t);return u(i)}if(!d.length)return new Y([],e,this);if(this._canExecuteSinglePass(o,e))return u(new Y(d,e,this));const h=await(0,ee.xt)("esriSpatialRelContains",o,this.geometryType,this.hasZ,this.hasM),p=await this._runSpatialFilter(d,(e=>h(c.getGeometry(e))),t);return u(new Y(p,e,this))}async _executeGeometryQuery(e,t,r){if(null!=t&&0===t.items.length)return t;e=null!=t?t.query:e;const{geometry:i,outSR:s,spatialRel:a,returnGeometry:o,returnCentroid:l}=e,u=this.featureStore.featureSpatialReference,c=!i||null==u||(0,y.aI)(u,i.spatialReference)?i:(0,k.Cv)(i,u),d=o||l,h=(0,y.fn)(s)&&!(0,y.aI)(this.spatialReference,s),p=null==t?this._getCacheKey(e):null,f=p?this._cache.get(p):null;if(null!=f)return new Y(f,e,this);const m=async e=>(h&&d&&await this._project(e,s),p&&this._cache.put(p,e.items),e);if(!c)return m(null!=t?t:await this._getAllFeaturesQueryEngineResult(e));const g=this.featureAdapter;let v=await this._reschedule((()=>this._searchFeatures(ce(i))),r);if("esriSpatialRelDisjoint"===a){if(!v.length)return m(null!=t?t:await this._getAllFeaturesQueryEngineResult(e));const n=new Set;for(const e of v)n.add(g.getObjectId(e));const i=null!=t?t.items:await this._reschedule((()=>this._getAllFeatures()),r),s=await this._reschedule((async()=>{const t=await(0,ee.xt)(a,c,this.geometryType,this.hasZ,this.hasM),s=await this._runSpatialFilter(i,(e=>!n.has(g.getObjectId(e))||t(g.getGeometry(e))),r);return new Y(s,e,this)}),r);return m(s)}if(null!=t){const e=new n.vW;v=v.filter((r=>(0,n.qh)(t.items,r,t.items.length,e)>=0))}if(!v.length){const t=new Y([],e,this);return p&&this._cache.put(p,t.items),t}if(this._canExecuteSinglePass(c,e))return m(new Y(v,e,this));const _=await(0,ee.xt)(a,c,this.geometryType,this.hasZ,this.hasM),w=await this._runSpatialFilter(v,(e=>_(g.getGeometry(e))),r);return m(new Y(w,e,this))}async _executeGeometryQueryForSnapping(e,t){const{query:r}=e,{spatialRel:n}=r;if(!e?.items?.length||!r.geometry||!n)return;const i=await(0,ee.xt)(n,r.geometry,this.geometryType,this.hasZ,this.hasM),s=await this._runSpatialFilter(e.items,(e=>i(e.geometry)),t);e.items=s}_executeAggregateIdsQuery(e){if(0===e.items.length||!e.query.aggregateIds?.length||null==this.aggregateAdapter)return;const t=new Set;for(const r of e.query.aggregateIds)this.aggregateAdapter.getFeatureObjectIds(r).forEach((e=>t.add(e)));const r=this.featureAdapter.getObjectId;e.items=e.items.filter((e=>t.has(r(e))))}_executeObjectIdsQuery(e){if(0===e.items.length||!e.query.objectIds?.length)return;const t=new Set(e.query.objectIds),r=this.featureAdapter.getObjectId;e.items=e.items.filter((e=>t.has(r(e))))}_executeTimeQuery(e){if(0===e.items.length)return;const t=(0,ae.I)(this.timeInfo,e.query.timeExtent,this.featureAdapter);null!=t&&(e.items=e.items.filter(t))}_executeAttributesQuery(e){if(0===e.items.length)return;const t=E(e.query.where,this.fieldsIndex);if(t){if(!t.isStandardized)throw new TypeError("Where clause is not standardized");e.items=e.items.filter((e=>t.testFeature(e,this.featureAdapter)))}}async _runSpatialFilter(e,t,r){if(!t)return e;if(null==this._frameTask)return e.filter((e=>t(e)));let n=0;const i=new Array,s=async a=>{for(;n<e.length;){const o=e[n++];t(o)&&(i.push(o),a.madeProgress()),a.done&&await this._reschedule((e=>s(e)),r)}};return this._reschedule((e=>s(e)),r).then((()=>i))}_filterLatest(e){const{trackIdField:t,startTimeField:r,endTimeField:n}=this.timeInfo,i=n||r,s=new Map,a=this.featureAdapter.getAttribute;for(const r of e.items){const e=a(r,t),n=a(r,i),o=s.get(e);(!o||n>a(o,i))&&s.set(e,r)}e.items=Array.from(s.values())}_getCacheKey(e){const{geometry:t,spatialRel:r,returnGeometry:n,returnCentroid:i,outSR:s,resultType:a,cacheHint:o}=e;if("tile"!==a&&!o)return null;const l=n||i;return(0,y.fn)(s)&&!(0,y.aI)(this.spatialReference,s)&&l?JSON.stringify([t,r,s]):JSON.stringify([t,r])}_canExecuteSinglePass(e,t){const{spatialRel:r}=t;return(0,ee.tC)(e)&&("esriSpatialRelEnvelopeIntersects"===r||"esriGeometryPoint"===this.geometryType&&("esriSpatialRelIntersects"===r||"esriSpatialRelContains"===r))}async _project(e,t){if(!t||(0,y.aI)(this.spatialReference,t))return e;const r=this.featureAdapter;let n;try{const e=await this._getFullExtent();n=(0,c.getTransformation)(this.spatialReference,t,e)}catch{}const i=await(0,k.lK)(e.items.map((e=>(0,O.pL)(this.geometryType,this.hasZ,this.hasM,r.getGeometry(e)))),this.spatialReference,t,n);return e.items=i.map(((t,n)=>r.cloneWithGeometry(e.items[n],(0,g.Ux)(t,this.hasZ,this.hasM)))),e}async _searchFeatures(e){const t=new Set;await Promise.all(e.map((e=>this.featureStore.forEachInBounds(e,(e=>t.add(e))))));const r=Array.from(t.values());return t.clear(),r}async _executeQueryForStatistics(e,t,r){e=(0,a.o8)(e);try{e=await this._schedule((()=>(0,K.GC)(e,this.definitionExpression,this.spatialReference)),r),e=await this._reschedule((()=>async function(e,t,{fieldsIndex:r,geometryType:n,spatialReference:s,availableFields:a}){if((e.distance??0)<0||null!=e.geometryPrecision||e.multipatchOption||e.pixelSize||e.relationParam||e.text||e.outStatistics||e.groupByFieldsForStatistics||e.having||e.orderByFields)throw new i.A(te,"Unsupported query options",{query:e});return ne(r,a,e),Promise.all([se(r,a,t,e),(0,ee.c0)(e,n,s),(0,k.Nk)(s,e.outSR)]).then((()=>e))}(e,t,{availableFields:this.availableFields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,spatialReference:this.spatialReference})),r);const n=await this._reschedule((()=>this._executeSceneFilterQuery(e,r)),r),s=await this._reschedule((()=>this._executeGeometryQuery(e,n,r)),r);return await this._reschedule((()=>this._executeAggregateIdsQuery(s)),r),await this._reschedule((()=>this._executeObjectIdsQuery(s)),r),await this._reschedule((()=>this._executeTimeQuery(s)),r),await this._reschedule((()=>this._executeAttributesQuery(s)),r),s}catch(t){if(t!==K.v8)throw t;return new Y([],e,this)}}}function ce(e){if((0,ee.tC)(e)){if((0,f.ZC)(e))return[(0,h.fA)(Math.min(e.xmin,e.xmax),Math.min(e.ymin,e.ymax),Math.max(e.xmin,e.xmax),Math.max(e.ymin,e.ymax))];if((0,f.Bi)(e))return e.rings.map((e=>(0,h.fA)(Math.min(e[0][0],e[2][0]),Math.min(e[0][1],e[2][1]),Math.max(e[0][0],e[2][0]),Math.max(e[0][1],e[2][1]))))}return[(0,p.Rg)((0,h.vt)(),e)]}},7121:function(e,t,r){r.d(t,{F:function(){return n}});const n={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsCentroid:!0,supportsCacheHint:!0,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!0,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsTopFeaturesQuery:!1,supportsQueryByAnonymous:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsCompactGeometry:!1,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}},51376:function(e,t,r){function n(e,t,r){return{objectId:e,target:t,distance:r,type:"vertex"}}function i(e,t,r,n,i,s=!1){return{objectId:e,target:t,distance:r,type:"edge",start:n,end:i,draped:s}}r.d(t,{P:function(){return i},k:function(){return n}})},78956:function(e,t,r){r.d(t,{LQ:function(){return u},ag:function(){return d},pL:function(){return c}});var n=r(58081),i=r(76613);const s=new i.A,a=new i.A,o=new i.A,l={esriGeometryPoint:n.DF,esriGeometryPolyline:n.BW,esriGeometryPolygon:n.z5,esriGeometryMultipoint:n.qK};function u(e,t,r,i=e.hasZ,s=e.hasM){if(null==t)return null;const a=e.hasZ&&i,l=e.hasM&&s;if(r){const u=(0,n.Nl)(o,t,e.hasZ,e.hasM,"esriGeometryPoint",r,i,s);return(0,n.DF)(u,a,l)}return(0,n.DF)(t,a,l)}function c(e,t,r,i,u,c,d=t,h=r){const p=t&&d,f=r&&h,m=null!=i?"coords"in i?i:i.geometry:null;if(null==m)return null;if(u){let i=(0,n.kz)(a,m,t,r,e,u,d,h);return c&&(i=(0,n.Nl)(o,i,p,f,e,c)),l[e]?.(i,p,f)??null}if(c){const i=(0,n.Nl)(o,m,t,r,e,c,d,h);return l[e]?.(i,p,f)??null}return(0,n.Q4)(s,m,t,r,d,h),l[e]?.(s,p,f)??null}function d(e){return e&&h in e?JSON.parse(JSON.stringify(e,p)):e}const h="_geVersion",p=(e,t)=>e!==h?t:void 0},46805:function(e,t,r){r.d(t,{T:function(){return a}});var n=r(40302),i=r(65215),s=r(76613);const a={getObjectId:e=>e.objectId,getAttributes:e=>e.attributes,getAttribute:(e,t)=>e.attributes[t],cloneWithGeometry:(e,t)=>new i.Om(t,e.attributes,null,e.objectId),getGeometry:e=>e.geometry,getCentroid:(e,t)=>(null==e.centroid&&(e.centroid=(0,n.Q)(new s.A,e.geometry,t.hasZ,t.hasM)),e.centroid)}},74841:function(e,t,r){r.d(t,{Cv:function(){return y},Nk:function(){return p},lK:function(){return v}});var n=r(50659),i=r(60539),s=r(46157),a=r(86029),o=r(57652),l=r(1644);const u=[0,0];function c(e,t){if(!t)return null;if("x"in t){const r={x:0,y:0};return[r.x,r.y]=e(t.x,t.y,u),null!=t.z&&(r.z=t.z),null!=t.m&&(r.m=t.m),r}if("xmin"in t){const r={xmin:0,ymin:0,xmax:0,ymax:0};return[r.xmin,r.ymin]=e(t.xmin,t.ymin,u),[r.xmax,r.ymax]=e(t.xmax,t.ymax,u),t.hasZ&&(r.zmin=t.zmin,r.zmax=t.zmax,r.hasZ=!0),t.hasM&&(r.mmin=t.mmin,r.mmax=t.mmax,r.hasM=!0),r}return"rings"in t?{rings:d(t.rings,e),hasM:t.hasM,hasZ:t.hasZ}:"paths"in t?{paths:d(t.paths,e),hasM:t.hasM,hasZ:t.hasZ}:"points"in t?{points:h(t.points,e),hasM:t.hasM,hasZ:t.hasZ}:null}function d(e,t){const r=[];for(const n of e)r.push(h(n,t));return r}function h(e,t){const r=[];for(const n of e){const e=t(n[0],n[1],[0,0]);r.push(e),n.length>2&&e.push(n[2]),n.length>3&&e.push(n[3])}return r}async function p(e,t){if(!e||!t)return;const r=Array.isArray(e)?e.map((e=>null!=e.geometry?e.geometry.spatialReference:null)).filter(n.Ru):[e];await(0,s.initializeProjection)(r.map((e=>({source:e,dest:t}))))}const f=c.bind(null,l.je),m=c.bind(null,l.tD);function y(e,t,r,n){if(!e)return e;if(r||(r=t,t=e.spatialReference),!(0,o.fn)(t)||!(0,o.fn)(r)||(0,o.aI)(t,r))return e;if((0,l.y7)(t,r)){const t=(0,o.K8)(r)?f(e):m(e);return t.spatialReference=r,t}return(0,s.projectMany)(a.g,[e],t,r,null,n)[0]}const g=new class{constructor(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}async push(e,t,r,n){if(!e?.length||!t||!r||(0,o.aI)(t,r))return e;const s={geometries:e,inSpatialReference:t,outSpatialReference:r,geographicTransformation:n,resolve:(0,i.Tw)()};return this._jobs.push(s),this._timer??=setTimeout(this._process,10),s.resolve.promise}_process(){this._timer=null;const e=this._jobs.shift();if(!e)return;const{geometries:t,inSpatialReference:r,outSpatialReference:n,resolve:i,geographicTransformation:u}=e;(0,l.y7)(r,n)?(0,o.K8)(n)?i(t.map(f)):i(t.map(m)):i((0,s.projectMany)(a.g,t,r,n,u,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}};function v(e,t,r,n){return g.push(e,t,r,n)}},20932:function(e,t,r){r.d(t,{GC:function(){return p},T2:function(){return f},VY:function(){return d},v8:function(){return h}});var n=r(73037),i=r(62938),s=r(46157),a=r(38503),o=r(74697),l=r(65298),u=r(57652),c=r(74841);const d=new n.J({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),h=Object.freeze({});async function p(e,t,r){const{outFields:n,orderByFields:i,groupByFieldsForStatistics:s,outStatistics:a}=e;if(n)for(let e=0;e<n.length;e++)n[e]=n[e].trim();if(i)for(let e=0;e<i.length;e++)i[e]=i[e].trim();if(s)for(let e=0;e<s.length;e++)s[e]=s[e].trim();if(a)for(let e=0;e<a.length;e++)a[e].onStatisticField&&(a[e].onStatisticField=a[e].onStatisticField.trim());return e.geometry&&!e.outSR&&(e.outSR=e.geometry.spatialReference),f(e,t,r)}async function f(e,t,n){if(!e)return null;let{where:s}=e;if(e.where=s=s?.trim(),(!s||/^1 *= *1$/.test(s)||t&&t===s)&&(e.where=null),!e.geometry)return e;let p=await async function(e){const{distance:t,units:n}=e,s=e.geometry;if(null==t||"vertexAttributes"in s)return s;const a=s.spatialReference,o=n?d.fromJSON(n):(0,i.Ij)(a),l=a&&((0,u.EA)(a)||(0,u.K8)(a))?s:await(0,c.Nk)(a,u.KK).then((()=>(0,c.Cv)(s,u.KK)));return(await async function(){return(await r.e(4696).then(r.bind(r,28356))).geodesicBuffer}())(l.spatialReference,l,t,o)}(e);if(e.distance=0,e.units=null,"esriSpatialRelEnvelopeIntersects"===e.spatialRel){const{spatialReference:t}=e.geometry;p=(0,a.HA)(p),p.spatialReference=t}if(p){await(0,c.Nk)(p.spatialReference,n),p=function(e,t){const r=e.spatialReference;return m(e,t)&&(0,o.ZC)(e)?{spatialReference:r,rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]}:e}(p,n);const t=(await(0,l.el)((0,o.rS)(p)))[0];if(null==t)throw h;const r="quantizationParameters"in e&&e.quantizationParameters?.tolerance||"maxAllowableOffset"in e&&e.maxAllowableOffset||0,i=r&&m(p,n)?{densificationStep:8*r}:void 0,s=t.toJSON(),a=(0,c.Cv)(s,s.spatialReference,n,i);if(!a)throw h;a.spatialReference=n,e.geometry=a}return e}function m(e,t){if(!e)return!1;const r=e.spatialReference;return((0,o.ZC)(e)||(0,o.Bi)(e)||(0,o.Rg)(e))&&!(0,u.aI)(r,t)&&!(0,s.canProjectWithoutEngine)(r,t)}},62512:function(e,t,r){r.d(t,{tC:function(){return b},c0:function(){return w},xt:function(){return _}});var n=r(39819),i=r(61273),s=r(96127),a=r(74697),o=r(57652);function l(e,t){return e?t?4:3:t?3:2}function u(e,t,r,n,i,s){const a=l(i,s),{coords:o,lengths:u}=n;if(!u)return!1;for(let n=0,i=0;n<u.length;n++,i+=a)if(!c(e,t,r,o[i],o[i+1]))return!1;return!0}function c(e,t,r,n,i){if(!e)return!1;const s=l(t,r),{coords:a,lengths:o}=e;let u=!1,c=0;for(const e of o)u=d(u,a,s,c,e,n,i),c+=e*s;return u}function d(e,t,r,n,i,s,a){let o=e,l=n;for(let e=n,u=n+i*r;e<u;e+=r){l=e+r,l===u&&(l=n);const i=t[e],c=t[e+1],d=t[l],h=t[l+1];(c<a&&h>=a||h<a&&c>=a)&&i+(a-c)/(h-c)*(d-i)<s&&(o=!o)}return o}var h=r(58081),p=r(76613),f=r(78956),m=r(74841);const y="unsupported-query",g={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},v={spatialRelationship:{esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},queryGeometry:{esriGeometryPoint:!0,esriGeometryMultiPatch:!1,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},layerGeometry:{esriGeometryPoint:!0,esriGeometryMultiPatch:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1}};function _(e,t,n,o,l){if((0,a.Bi)(t)&&"esriGeometryPoint"===n&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e)){const e=(0,h.Ye)(new p.A,t,!1,!1);return Promise.resolve((t=>function(e,t,r,n){return c(e,!1,!1,n.coords[0],n.coords[1])}(e,0,0,t)))}if((0,a.Bi)(t)&&"esriGeometryMultipoint"===n){const r=(0,h.Ye)(new p.A,t,!1,!1);if("esriSpatialRelContains"===e)return Promise.resolve((e=>u(r,!1,!1,e,o,l)))}if((0,a.ZC)(t)&&"esriGeometryPoint"===n&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e))return Promise.resolve((e=>(0,i.qz)(t,(0,f.pL)(n,o,l,e))));if((0,a.ZC)(t)&&"esriGeometryMultipoint"===n&&"esriSpatialRelContains"===e)return Promise.resolve((e=>(0,i.rL)(t,(0,f.pL)(n,o,l,e))));if((0,a.ZC)(t)&&"esriSpatialRelIntersects"===e){const e="mesh"===(d=n)?s.xB:(0,s.xK)(d);return Promise.resolve((r=>e(t,(0,f.pL)(n,o,l,r))))}var d;return r.e(4696).then(r.bind(r,28356)).then((r=>{const i=r[g[e]].bind(null,t.spatialReference,t);return e=>i((0,f.pL)(n,o,l,e))}))}async function w(e,t,r){const{spatialRel:i,geometry:s}=e;if(s){if(!function(e){return null!=e&&!0===v.spatialRelationship[e]}(i))throw new n.A(y,"Unsupported query spatial relationship",{query:e});if((0,o.fn)(s.spatialReference)&&(0,o.fn)(r)){if(!function(e){return null!=e&&!0===v.queryGeometry[(0,a.$B)(e)]}(s))throw new n.A(y,"Unsupported query geometry type",{query:e});if(!function(e){return null!=e&&!0===v.layerGeometry[e]}(t))throw new n.A(y,"Unsupported layer geometry type",{query:e});if(e.outSR)return(0,m.Nk)(e.geometry?.spatialReference,e.outSR)}}}function b(e){if((0,a.ZC)(e))return!0;if((0,a.Bi)(e)){for(const t of e.rings){if(5!==t.length)return!1;if(t[0][0]!==t[1][0]||t[0][0]!==t[4][0]||t[2][0]!==t[3][0]||t[0][1]!==t[3][1]||t[0][1]!==t[4][1]||t[1][1]!==t[2][1])return!1}return!0}return!1}},20973:function(e,t,r){async function n(e,t){if(!e)return null;const r=t.featureAdapter,{startTimeField:n,endTimeField:i}=e;let s=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY;if(n&&i)await t.forEach((e=>{const t=r.getAttribute(e,n),o=r.getAttribute(e,i);null==t||isNaN(t)||(s=Math.min(s,t)),null==o||isNaN(o)||(a=Math.max(a,o))}));else{const e=n||i;await t.forEach((t=>{const n=r.getAttribute(t,e);null==n||isNaN(n)||(s=Math.min(s,n),a=Math.max(a,n))}))}return{start:s,end:a}}function i(e,t,r){if(!t||!e)return null;const{startTimeField:n,endTimeField:i}=e;if(!n&&!i)return null;const{start:s,end:a}=t;if(null===s&&null===a)return null;if(void 0===s&&void 0===a)return()=>!1;const o=r.getAttributeAsTimestamp?.bind(r)??r.getAttribute.bind(r);return n&&i?function(e,t,r,n,i){return null!=n&&null!=i?s=>{const a=e(s,t),o=e(s,r);return(null==a||a<=i)&&(null==o||o>=n)}:null!=n?t=>{const i=e(t,r);return null==i||i>=n}:null!=i?r=>{const n=e(r,t);return null==n||n<=i}:void 0}(o,n,i,s,a):function(e,t,r,n){return null!=r&&null!=n&&r===n?n=>e(n,t)===r:null!=r&&null!=n?i=>{const s=e(i,t);return null!=s&&s>=r&&s<=n}:null!=r?n=>{const i=e(n,t);return null!=i&&i>=r}:null!=n?r=>{const i=e(r,t);return null!=i&&i<=n}:void 0}(o,n||i,s,a)}r.d(t,{I:function(){return i},W:function(){return n}})},58081:function(e,t,r){r.d(t,{B2:function(){return b},BW:function(){return D},Ch:function(){return ie},DF:function(){return S},Di:function(){return B},E2:function(){return q},IE:function(){return w},Nl:function(){return K},Q4:function(){return se},Rk:function(){return oe},Ux:function(){return H},Ye:function(){return Z},ZF:function(){return Y},eU:function(){return z},eY:function(){return Q},jH:function(){return X},jQ:function(){return ne},kz:function(){return ee},oN:function(){return j},q3:function(){return W},qK:function(){return O},qN:function(){return C},z5:function(){return U},zv:function(){return $}});var n=r(39819),i=r(40633),s=r(95929),a=r(24761),o=r(87416),l=r(74697),u=r(65215),c=r(72887),d=r(76613);function h(e,t){return e?t?4:3:t?3:2}const p=()=>i.A.getLogger("esri.layers.graphics.featureConversionUtils"),f={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryMultiPatch:3,esriGeometryEnvelope:0},m=(e,t,r,n,i,s)=>{e[r]=i,e[r+1]=s},y=(e,t,r,n,i,s)=>{e[r]=i,e[r+1]=s,e[r+2]=t[n+2]},g=(e,t,r,n,i,s)=>{e[r]=i,e[r+1]=s,e[r+2]=t[n+3]},v=(e,t,r,n,i,s)=>{e[r]=i,e[r+1]=s,e[r+2]=t[n+2],e[r+3]=t[n+3]};function _(e,t,r,n){if(e){if(r)return t&&n?v:y;if(t&&n)return g}else if(t&&n)return y;return m}function w({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}function b({scale:e,translate:t},r){return Math.round((t[1]-r)/e[1])}function T({scale:e,translate:t},r,n){return r*e[n]+t[n]}function S(e,t,r){return e?t?r?A(e):M(e):r?L(e):I(e):null}function I(e){const t=e.coords;return{x:t[0],y:t[1]}}function x(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e}function M(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2]}}function F(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e}function L(e){const t=e.coords;return{x:t[0],y:t[1],m:t[2]}}function E(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.m,e}function A(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2],m:t[3]}}function R(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e.coords[3]=t.m,e}function N(e,t){return e&&t?R:e?F:t?E:x}function C(e,t,r=N(null!=t.z,null!=t.m)){return r(e,t)}function O(e,t,r){if(null==e)return null;const n=h(t,r),i=[];for(let t=0;t<e.coords.length;t+=n){const r=[];for(let i=0;i<n;i++)r.push(e.coords[t+i]);i.push(r)}return t?r?{points:i,hasZ:t,hasM:r}:{points:i,hasZ:t}:r?{points:i,hasM:r}:{points:i}}function k(e,t,r=h(t.hasZ,t.hasM)){e.lengths[0]=t.points.length;const n=e.coords;let i=0;for(const e of t.points)for(let t=0;t<r;t++)n[i++]=e[t];return e}function D(e,t,r){if(!e)return null;const n=h(t,r),{coords:i,lengths:s}=e,a=[];let o=0;for(const e of s){const t=[];for(let r=0;r<e;r++){const e=[];for(let t=0;t<n;t++)e.push(i[o++]);t.push(e)}a.push(t)}return t?r?{paths:a,hasZ:t,hasM:r}:{paths:a,hasZ:t}:r?{paths:a,hasM:r}:{paths:a}}function P(e,t,r=h(t.hasZ,t.hasM)){const{lengths:n,coords:i}=e;let s=0;for(const e of t.paths){for(const t of e)for(let e=0;e<r;e++)i[s++]=t[e];n.push(e.length)}return e}function U(e,t,r){if(!e)return null;const n=h(t,r),{coords:i,lengths:s}=e,a=[];let o=0;for(const e of s){const t=[];for(let r=0;r<e;r++){const e=[];for(let t=0;t<n;t++)e.push(i[o++]);t.push(e)}a.push(t)}return t?r?{rings:a,hasZ:t,hasM:r}:{rings:a,hasZ:t}:r?{rings:a,hasM:r}:{rings:a}}function Z(e,t,r=t.hasZ,n=t.hasM){return z(e,t.rings,r,n)}function z(e,t,r,n){const i=h(r,n),{lengths:s,coords:a}=e;let o=0;le(e);for(const e of t){for(const t of e)for(let e=0;e<i;e++)a[o++]=t[e];s.push(e.length)}return e}const V=[],G=[];function q(e,t,r,n,i){V[0]=e;const[s]=B(G,V,t,r,n,i);return ue(V),ue(G),s}function B(e,t,r,i,s,a){if(ue(e),!r){for(const r of t){const t=a?r.attributes[a]:void 0;e.push(new u.Om(null,r.attributes,null,t))}return e}switch(r){case"esriGeometryPoint":return function(e,t,r,n,i){const s=N(r,n);for(const{geometry:r,attributes:n}of t){const t=null!=r?s(new d.A,r):null;e.push(new u.Om(t,n,null,i?n[i]:void 0))}return e}(e,t,i,s,a);case"esriGeometryMultipoint":return function(e,t,r,n,i){const s=h(r,n);for(const{geometry:r,attributes:n}of t){const t=null!=r?k(new d.A,r,s):null;e.push(new u.Om(t,n,null,i?n[i]:void 0))}return e}(e,t,i,s,a);case"esriGeometryPolyline":return function(e,t,r,n,i){const s=h(r,n);for(const{geometry:r,attributes:n,centroid:a}of t){const t=null!=r?P(new d.A,r,s):null,o=null!=a?C(new d.A,a):null;e.push(new u.Om(t,n,o,i?n[i]:void 0))}return e}(e,t,i,s,a);case"esriGeometryPolygon":case"esriGeometryMultiPatch":return function(e,t,r,n,i){for(const{geometry:s,centroid:a,attributes:o}of t){const t=null!=s?Z(new d.A,s,r,n):null,l=i?o[i]:void 0;null!=a?e.push(new u.Om(t,o,x(new d.A,a),l)):e.push(new u.Om(t,o,null,l))}return e}(e,t,i,s,a);default:p().error("convertToFeatureSet:unknown-geometry",new n.A(`Unable to parse unknown geometry type '${r}'`)),ue(e)}return e}function j(e,t,r,n){G[0]=e,J(V,G,t,r,n);const i=V[0];return ue(V),ue(G),i}function H(e,t,r){if(null==e)return null;const i=new d.A;return"hasZ"in e&&null==t&&(t=e.hasZ),"hasM"in e&&null==r&&(r=e.hasM),(0,l.fT)(e)?N(null!=t?t:null!=e.z,null!=r?r:null!=e.m)(i,e):(0,l.Bi)(e)?Z(i,e,t,r):(0,l.Rg)(e)?P(i,e,h(t,r)):(0,l.U9)(e)?k(i,e,h(t,r)):void p().error("convertFromGeometry:unknown-geometry",new n.A(`Unable to parse unknown geometry type '${e}'`))}function $(e,t,r,i){const s=e&&("coords"in e?e:e.geometry);if(null==s)return null;switch(t){case"esriGeometryPoint":{let e=I;return r&&i?e=A:r?e=M:i&&(e=L),e(s)}case"esriGeometryMultipoint":return O(s,r,i);case"esriGeometryPolyline":return D(s,r,i);case"esriGeometryPolygon":return U(s,r,i);default:return p().error("convertToGeometry:unknown-geometry",new n.A(`Unable to parse unknown geometry type '${t}'`)),null}}function J(e,t,r,i,s){if(ue(e),null==r)return function(e,t){for(const r of t)e.push({attributes:r.attributes});return e}(e,t);switch(r){case"esriGeometryPoint":return function(e,t,r,n){let i=I;r&&n?i=A:r?i=M:n&&(i=L);for(const r of t){const{geometry:t,attributes:n}=r,s=null!=t?i(t):null;e.push({attributes:n,geometry:s})}return e}(e,t,i,s);case"esriGeometryMultipoint":return function(e,t,r,n){for(const{geometry:i,attributes:s}of t)e.push({attributes:s,geometry:null!=i?O(i,r,n):null});return e}(e,t,i,s);case"esriGeometryPolyline":return function(e,t,r,n){for(const{geometry:i,attributes:s}of t)e.push({attributes:s,geometry:null!=i?D(i,r,n):null});return e}(e,t,i,s);case"esriGeometryPolygon":return function(e,t,r,n){for(const{geometry:i,attributes:s,centroid:a}of t){const t=null!=i?U(i,r,n):null;if(null!=a){const r=I(a);e.push({attributes:s,centroid:r,geometry:t})}else e.push({attributes:s,geometry:t})}return e}(e,t,i,s);default:p().error("convertToFeatureSet:unknown-geometry",new n.A(`Unable to parse unknown geometry type '${r}'`))}return e}function Y(e){const{objectIdFieldName:t,spatialReference:r,transform:n,fields:i,hasM:s,hasZ:a,features:o,geometryType:l,exceededTransferLimit:u,uniqueIdField:c,queryGeometry:d,queryGeometryType:h}=e,p={features:J([],o,l,a,s),fields:i,geometryType:l,objectIdFieldName:t,spatialReference:r,uniqueIdField:c,queryGeometry:$(d,h,!1,!1)};return n&&(p.transform=n),u&&(p.exceededTransferLimit=u),s&&(p.hasM=s),a&&(p.hasZ=a),p}function W(e,t){const r=new c.A,{hasM:i,hasZ:s,features:a,objectIdFieldName:o,spatialReference:l,geometryType:u,exceededTransferLimit:d,transform:h,fields:f}=e;return f&&(r.fields=f),r.geometryType=u??null,r.objectIdFieldName=o??t??null,r.spatialReference=l??null,r.objectIdFieldName?(a&&B(r.features,a,u,s,i,r.objectIdFieldName),d&&(r.exceededTransferLimit=d),i&&(r.hasM=i),s&&(r.hasZ=s),h&&(r.transform=h),r):(p().error(new n.A("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),r)}function Q(e){const{transform:t,features:r,hasM:n,hasZ:i}=e;if(!t)return e;for(const e of r)null!=e.geometry&&ie(e.geometry,e.geometry,n,i,t),null!=e.centroid&&ie(e.centroid,e.centroid,n,i,t);return e.transform=null,e}function X(e,t){const{geometryType:r,features:n,hasM:i,hasZ:s}=t;if(!e)return t;for(let t=0;t<n.length;t++){const a=n[t],o=a.weakClone();o.geometry=new d.A,K(o.geometry,a.geometry,i,s,r,e),a.centroid&&(o.centroid=new d.A,K(o.centroid,a.centroid,i,s,"esriGeometryPoint",e)),n[t]=o}return t.transform=e,t}function K(e,t,r,n,i,s,a=r,o=n){if(le(e),!t?.coords.length)return null;const l=f[i],{coords:u,lengths:c}=t,d=h(r,n),p=h(r&&a,n&&o),m=_(r,n,a,o);if(!c.length)return m(e.coords,u,0,0,w(s,u[0]),b(s,u[1])),le(e,d,0),e;let y,g,v,T,S=0,I=0,x=I;for(const t of c){if(t<l)continue;let r=0;I=x,v=y=w(s,u[S]),T=g=b(s,u[S+1]),m(e.coords,u,I,S,v,T),r++,S+=d,I+=p;for(let n=1;n<t;n++,S+=d)v=w(s,u[S]),T=b(s,u[S+1]),v===y&&T===g||(m(e.coords,u,I,S,v-y,T-g),I+=p,r++,y=v,g=T);r>=l&&(e.lengths.push(r),x=I)}return ue(e.coords,x),e.coords.length?e:null}function ee(e,t,r,n,i,s,a=r,o=n){if(le(e),!t?.coords.length)return null;const l=f[i],{coords:u,lengths:c}=t,d=h(r,n),p=h(r&&a,n&&o),m=_(r,n,a,o);if(!c.length)return m(e.coords,u,0,0,u[0],u[1]),le(e,d,0),e;let y=0;const g=s*s;for(const t of c){if(t<l){y+=t*d;continue}const r=e.coords.length/p,n=y,i=y+(t-1)*d;m(e.coords,u,e.coords.length,n,u[n],u[n+1]),re(e.coords,u,d,g,m,n,i),m(e.coords,u,e.coords.length,i,u[i],u[i+1]);const s=e.coords.length/p-r;s>=l?e.lengths.push(s):ue(e.coords,r*p),y+=t*d}return e.coords.length?e:null}function te(e,t,r,n){const i=e[t],s=e[t+1],a=e[r],o=e[r+1],l=e[n],u=e[n+1];let c=a,d=o,h=l-c,p=u-d;if(0!==h||0!==p){const e=((i-c)*h+(s-d)*p)/(h*h+p*p);e>1?(c=l,d=u):e>0&&(c+=h*e,d+=p*e)}return h=i-c,p=s-d,h*h+p*p}function re(e,t,r,n,i,s,a){let o,l=n,u=0;for(let e=s+r;e<a;e+=r)o=te(t,e,s,a),o>l&&(u=e,l=o);l>n&&(u-s>r&&re(e,t,r,n,i,s,u),i(e,t,e.length,u,t[u],t[u+1]),a-u>r&&re(e,t,r,n,i,u,a))}function ne(e,t,r,n){if(!t?.coords?.length)return null;const i=h(r,n);let s=Number.POSITIVE_INFINITY,l=Number.POSITIVE_INFINITY,u=Number.NEGATIVE_INFINITY,c=Number.NEGATIVE_INFINITY;if(t&&t.coords){const e=t.coords;for(let t=0;t<e.length;t+=i){const r=e[t],n=e[t+1];s=Math.min(s,r),u=Math.max(u,r),l=Math.min(l,n),c=Math.max(c,n)}}return(0,a.is)(e)?(0,a.BI)(e,s,l,u,c):(0,o.fA)(s,l,u,c,e),e}function ie(e,t,r,n,i){const{coords:a,lengths:o}=t,l=h(r,n);if(!a.length)return e!==t&&le(e),e;(0,s.Lw)(i);const{originPosition:u,scale:c,translate:d}=i,p=ce;p.originPosition=u;const f=p.scale;f[0]=c[0]??1,f[1]=-(c[1]??1),f[2]=c[2]??1,f[3]=c[3]??1;const m=p.translate;if(m[0]=d[0]??0,m[1]=d[1]??0,m[2]=d[2]??0,m[3]=d[3]??0,!o.length){for(let t=0;t<l;++t)e.coords[t]=T(p,a[t],t);return e!==t&&le(e,l,0),e}let y=0;for(let t=0;t<o.length;t++){const r=o[t];e.lengths[t]=r;for(let t=0;t<l;++t)e.coords[y+t]=T(p,a[y+t],t);let n=e.coords[y],i=e.coords[y+1];y+=l;for(let t=1;t<r;t++,y+=l){n+=a[y]*f[0],i+=a[y+1]*f[1],e.coords[y]=n,e.coords[y+1]=i;for(let t=2;t<l;++t)e.coords[y+t]=T(p,a[y+t],t)}}return e!==t&&le(e,a.length,o.length),e}function se(e,t,r,n,i,s){if(le(e),e.lengths.push(...t.lengths),r===i&&n===s)for(let r=0;r<t.coords.length;r++)e.coords.push(t.coords[r]);else{const a=h(r,n),o=_(r,n,i,s),l=t.coords;for(let t=0;t<l.length;t+=a)o(e.coords,l,e.coords.length,t,l[t],l[t+1])}return e}function ae(e,t,r,n){let i=0,s=e[n*t],a=e[n*(t+1)];for(let o=1;o<r;o++){const r=s+e[n*(t+o)],l=a+e[n*(t+o)+1],u=(r-s)*(l+a);s=r,a=l,i+=u}return.5*i}function oe(e,t){const{coords:r,lengths:n}=e;let i=0,s=0;for(let e=0;e<n.length;e++){const a=n[e];s+=ae(r,i,a,t),i+=a}return Math.abs(s)}function le(e,t=0,r=0){ue(e.lengths,r),ue(e.coords,t)}function ue(e,t=0){e.length!==t&&(e.length=t)}const ce={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]}},7103:function(e,t,r){r.d(t,{A:function(){return h}});var n=r(39819),i=r(30905),s=r(40633),a=r(25738),o=r(92955),l=r(53743),u=r(21168),c=r(96285);const d=new Map;class h{static fromJSON(e){return new h(e.fields,e.timeZoneByFieldName)}static fromLayer(e){return new h(e.fields??[],y(e))}static fromLayerJSON(e){return new h(e.fields??[],y(e))}constructor(e=[],t){this._fieldsMap=new Map,this._normalizedFieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this._requiredFields=null,this.dateFields=[],this.numericFields=[],this.fields=e||[],this._timeZoneByFieldName=t?new Map(t):null;const r=[];for(const e of this.fields){const t=e?.name,n=f(t);if(t&&n){const i=p(t);this._fieldsMap.set(t,e),this._fieldsMap.set(i,e),this._normalizedFieldsMap.set(n,e),r.push(`${i}:${e.type}:${this._timeZoneByFieldName?.get(t)}`),(0,l.vE)(e)?(this.dateFields.push(e),this._dateFieldsSet.add(e)):(0,l.WA)(e)&&(this._numericFieldsSet.add(e),this.numericFields.push(e)),(0,l.te)(e)||(0,l.Xz)(e)||(e.editable=null==e.editable||!!e.editable,e.nullable=null==e.nullable||!!e.nullable)}}r.sort(),this.uid=r.join()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const e of this.fields)(0,l.te)(e)||(0,l.Xz)(e)||e.nullable||void 0!==(0,l.lD)(e)||this._requiredFields.push(e)}return this._requiredFields}equals(e){return this.uid===e?.uid}has(e){return null!=this.get(e)}get(e){if(!e)return;let t=this._fieldsMap.get(e);return t||(t=this._fieldsMap.get(p(e))??this._normalizedFieldsMap.get(f(e)),t&&this._fieldsMap.set(e,t),t)}getTimeZone(e){const t=this.get(e&&"string"!=typeof e?e.name:e);return t?this._timeZoneByFieldName?this._timeZoneByFieldName.get(t.name):"date"===t.type||"esriFieldTypeDate"===t.type?(s.A.getLogger("esri.layers.support.FieldsIndex").error(new n.A("getTimeZone:no-timezone-information",`no time zone information for field '${t.name}'`)),u.n$):m.has(t.type)?u.L5:null:null}getLuxonTimeZone(e){const t=this.getTimeZone(e);return t?t===u.L5?o.GB.instance:t===u.n$?c.mQ.utcInstance:(0,a.tE)(d,t,(()=>c.oh.create(t))):null}isDateField(e){return this._dateFieldsSet.has(this.get(e))}isTimeOnlyField(e){return(0,l.OH)(this.get(e))}isNumericField(e){return this._numericFieldsSet.has(this.get(e))}normalizeFieldName(e){return this.get(e)?.name??void 0}toJSON(){return{fields:this.fields.map((e=>(0,i.Wj)(e)?e.toJSON():e)),timeZoneByFieldName:this._timeZoneByFieldName?Array.from(this._timeZoneByFieldName.entries()):null}}}function p(e){return e.trim().toLowerCase()}function f(e){return(0,l.rS)(e)?.toLowerCase()??""}const m=new Set(["time-only","date-only","timestamp-offset","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]);function y(e){const t=new Map;if(!e.fields)return t;const r=!0===e.datesInUnknownTimezone,{timeInfo:n,editFieldsInfo:i}=e,s=(n?"startField"in n?n.startField:n.startTimeField:"")??"",a=(n?"endField"in n?n.endField:n.endTimeField:"")??"",o=function(e){return"dateFieldsTimeZone"in e}(e)?e.dateFieldsTimeZone??null:e.dateFieldsTimeReference?(0,u.ZS)(e.dateFieldsTimeReference):null,l=i?function(e){return"timeZone"in e}(i)?i.timeZone??o:i.dateFieldsTimeReference?(0,u.ZS)(i.dateFieldsTimeReference):o??u.n$:null,c=n?function(e){return"timeZone"in e}(n)?n.timeZone??o:n.timeReference?(0,u.ZS)(n.timeReference):o:null,d=new Map([[p(i?.creationDateField??""),l],[p(i?.editDateField??""),l],[p(s),c],[p(a),c]]);for(const{name:n,type:i}of e.fields)if(m.has(i))t.set(n,u.L5);else if("date"!==i&&"esriFieldTypeDate"!==i)t.set(n,null);else if(r)t.set(n,u.L5);else{const e=d.get(p(n??""))??o;t.set(n,e)}return t}},44431:function(e,t,r){r.d(t,{A:function(){return c}});var n,i=r(53804),s=r(30905),a=r(23502),o=r(67888),l=(r(13798),r(58941),r(65953));let u=n=class extends s.oY{constructor(e){super(e),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new n({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};(0,i._)([(0,a.MZ)({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],u.prototype,"cols",void 0),(0,i._)([(0,a.MZ)({type:o.jz,json:{write:!0}})],u.prototype,"level",void 0),(0,i._)([(0,a.MZ)({type:String,json:{write:!0}})],u.prototype,"levelValue",void 0),(0,i._)([(0,a.MZ)({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],u.prototype,"origin",void 0),(0,i._)([(0,a.MZ)({type:Number,json:{write:!0}})],u.prototype,"resolution",void 0),(0,i._)([(0,a.MZ)({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],u.prototype,"rows",void 0),(0,i._)([(0,a.MZ)({type:Number,json:{write:!0}})],u.prototype,"scale",void 0),u=n=(0,i._)([(0,l.$)("esri.layers.support.LOD")],u);const c=u},47558:function(e,t,r){r.d(t,{T:function(){return a}});var n=r(60539),i=r(85445),s=r(55213);class a{constructor(){this._tasks=new Array,this._runningTasks=(0,i.v)(0)}get length(){return this._tasks.length}get running(){return this._runningTasks.value>0}destroy(){this.cancelAll()}runTask(e){if(0===this.length)return s.G;for(;!e.done&&this._process(e);)e.madeProgress()}push(e,t,r){return++this._runningTasks.value,new Promise(((n,i)=>this._tasks.push(new o(n,i,e,t,r)))).finally((()=>--this._runningTasks.value))}unshift(e,t,r){return++this._runningTasks.value,new Promise(((n,i)=>this._tasks.unshift(new o(n,i,e,t,r)))).finally((()=>--this._runningTasks.value))}_process(e){if(0===this._tasks.length)return!1;const t=this._tasks.shift();try{const r=(0,n.G4)(t.signal);if(r&&!t.abortCallback)t.reject((0,n.NK)());else{const i=r?t.abortCallback?.((0,n.NK)()):t.callback(e);(0,n.$X)(i)?i.then(t.resolve,t.reject):t.resolve(i)}}catch(e){t.reject(e)}return!0}cancelAll(){const e=(0,n.NK)();for(const t of this._tasks)if(t.abortCallback){const r=t.abortCallback(e);t.resolve(r)}else t.reject(e);this._tasks.length=0}}class o{constructor(e,t,r,n=void 0,i=void 0){this.resolve=e,this.reject=t,this.callback=r,this.signal=n,this.abortCallback=i}}},76226:function(e,t,r){r.r(t),r.d(t,{default:function(){return I}});var n,i=r(53804),s=r(73037),a=r(30905),o=r(62938),l=r(23502),u=r(67888),c=(r(13798),r(58941),r(47332)),d=r(65953),h=r(81392),p=r(45532),f=r(57165),m=r(87416),y=r(57652),g=r(1644),v=r(44431),_=r(29679);const w=new s.J({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let b=n=class extends a.oY{static create(e={}){const{resolutionFactor:t=1,scales:r,size:i=256,spatialReference:s=f.A.WebMercator,numLODs:a=24}=e;if(!(0,y.fn)(s)){const e=[];if(r)for(let t=0;t<r.length;t++){const n=r[t];e.push(new v.A({level:t,scale:n,resolution:n}))}else{let t=5e-4;for(let r=a-1;r>=0;r--)e.unshift(new v.A({level:r,scale:t,resolution:t})),t*=2}return new n({dpi:96,lods:e,origin:new p.default(0,0,s),size:[i,i],spatialReference:s})}const l=(0,y.Vp)(s),u=e.origin?new p.default({x:e.origin.x,y:e.origin.y,spatialReference:s}):new p.default(l?{x:l.origin[0],y:l.origin[1],spatialReference:s}:{x:0,y:0,spatialReference:s}),c=1/(39.37*(0,o.GA)(s)*96),d=[];if(r)for(let e=0;e<r.length;e++){const t=r[e],n=t*c;d.push(new v.A({level:e,scale:t,resolution:n}))}else{let e=(0,y.EA)(s)?512/i*591657527.5917094:256/i*591657527.591555;const r=Math.ceil(a/t);d.push(new v.A({level:0,scale:e,resolution:e*c}));for(let n=1;n<r;n++){const r=e/2**t,i=r*c;d.push(new v.A({level:n,scale:r,resolution:i})),e=r}}return new n({dpi:96,lods:d,origin:u,size:[i,i],spatialReference:s})}constructor(e){super(e),this.dpi=96,this.format=null,this.origin=null,this.size=null,this.spatialReference=null}get isWrappable(){const{spatialReference:e,origin:t}=this;if(e&&t){const r=(0,y.Vp)(e);return e.isWrappable&&!!r&&Math.abs(r.origin[0]-t.x)<=r.dx}return!1}readOrigin(e,t){return p.default.fromJSON({spatialReference:t.spatialReference,...e})}set lods(e){let t=0,r=0;const n=[],i=this._levelToLOD={};e&&(t=-1/0,r=1/0,e.forEach((e=>{n.push(e.scale),t=e.scale>t?e.scale:t,r=e.scale<r?e.scale:r,i[e.level]=e}))),this._set("scales",n),this._set("lods",e),this._initializeUpsampleLevels()}readSize(e,t){return[t.cols,t.rows]}writeSize(e,t){t.cols=e[0],t.rows=e[1]}zoomToScale(e){const t=this.scales;if(e<=0)return t[0];if(e>=t.length-1)return t[t.length-1];const r=Math.floor(e),n=r+1;return t[r]/(t[r]/t[n])**(e-r)}scaleToZoom(e){const t=this.scales,r=t.length-1;let n=0;for(;n<r;n++){const r=t[n],i=t[n+1];if(r<=e)return n;if(i===e)return n+1;if(r>e&&i<e)return n+Math.log(r/e)/Math.log(r/i)}return n}tileAt(e,t,r,n){const i=this.lodAt(e);if(!i)return null;let s,a;if("number"==typeof t)s=t,a=r;else if((0,y.aI)(t.spatialReference,this.spatialReference))s=t.x,a=t.y,n=r;else{const e=(0,g.Cv)(t,this.spatialReference);if(null==e)return null;s=e.x,a=e.y,n=r}const o=i.resolution*this.size[0],l=i.resolution*this.size[1];return n||(n=new _.U(null,0,0,0,(0,m.vt)())),n.level=e,n.row=Math.floor((this.origin.y-a)/l+.001),n.col=Math.floor((s-this.origin.x)/o+.001),this.updateTileInfo(n),n}updateTileInfo(e,t=n.ExtrapolateOptions.NONE){let r=this.lodAt(e.level);if(!r&&t===n.ExtrapolateOptions.POWER_OF_TWO){const t=this.lods[this.lods.length-1];t.level<e.level&&(r=t)}if(!r)return;const i=e.level-r.level,s=r.resolution*this.size[0]/2**i,a=r.resolution*this.size[1]/2**i;e.id=`${e.level}/${e.row}/${e.col}`,e.extent||(e.extent=(0,m.vt)()),e.extent[0]=this.origin.x+e.col*s,e.extent[1]=this.origin.y-(e.row+1)*a,e.extent[2]=e.extent[0]+s,e.extent[3]=e.extent[1]+a}upsampleTile(e){const t=this._upsampleLevels[e.level];return!(!t||-1===t.parentLevel||(e.level=t.parentLevel,e.row=Math.floor(e.row/t.factor+.001),e.col=Math.floor(e.col/t.factor+.001),this.updateTileInfo(e),0))}getTileBounds(e,t){const r=this.lodAt(t.level);if(null==r)return null;const{resolution:n}=r,i=n*this.size[0],s=n*this.size[1];return e[0]=this.origin.x+t.col*i,e[1]=this.origin.y-(t.row+1)*s,e[2]=e[0]+i,e[3]=e[1]+s,e}lodAt(e){return this._levelToLOD?.[e]??null}clone(){return n.fromJSON(this.write({}))}getCompatibleForVTL(e){if(this.size[0]!==this.size[1]||256===this.size[0]&&512===e)return null;const t=(512===this.size[0]&&256===e?-1:0)+(this.spatialReference.isGeographic?1:0);if(this.size[0]===e&&0===t)return this;const r=[],i=this.lods.length-t;for(let e=0;e<i;e++){const n=e+t,{scale:i,resolution:s}=n>=0?this.lods[n]:{scale:2*this.lods[0].scale,resolution:2*this.lods[0].resolution};r.push(new v.A({level:e,scale:i,resolution:s}))}return new n({size:[e,e],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:r})}_initializeUpsampleLevels(){const e=this.lods;this._upsampleLevels=[];let t=null;for(let r=0;r<e.length;r++){const n=e[r];this._upsampleLevels[n.level]={parentLevel:t?t.level:-1,factor:t?t.resolution/n.resolution:0},t=n}}};var T,S;(0,i._)([(0,l.MZ)({type:Number,json:{write:!0}})],b.prototype,"compressionQuality",void 0),(0,i._)([(0,l.MZ)({type:Number,json:{write:!0}})],b.prototype,"dpi",void 0),(0,i._)([(0,l.MZ)({type:String,json:{read:w.read,write:w.write,origins:{"web-scene":{read:!1,write:!1}}}})],b.prototype,"format",void 0),(0,i._)([(0,l.MZ)({readOnly:!0})],b.prototype,"isWrappable",null),(0,i._)([(0,l.MZ)({type:p.default,json:{write:!0}})],b.prototype,"origin",void 0),(0,i._)([(0,c.w)("origin")],b.prototype,"readOrigin",null),(0,i._)([(0,l.MZ)({type:[v.A],value:null,json:{write:!0}})],b.prototype,"lods",null),(0,i._)([(0,l.MZ)({readOnly:!0})],b.prototype,"scales",void 0),(0,i._)([(0,l.MZ)({cast:e=>Array.isArray(e)?e:"number"==typeof e?[e,e]:[256,256]})],b.prototype,"size",void 0),(0,i._)([(0,c.w)("size",["rows","cols"])],b.prototype,"readSize",null),(0,i._)([(0,h.K)("size",{cols:{type:u.jz},rows:{type:u.jz}})],b.prototype,"writeSize",null),(0,i._)([(0,l.MZ)({type:f.A,json:{write:!0}})],b.prototype,"spatialReference",void 0),b=n=(0,i._)([(0,d.$)("esri.layers.support.TileInfo")],b),T=b||(b={}),(S=T.ExtrapolateOptions||(T.ExtrapolateOptions={}))[S.NONE=0]="NONE",S[S.POWER_OF_TWO=1]="POWER_OF_TWO";const I=b},29679:function(e,t,r){r.d(t,{U:function(){return n}});class n{constructor(e,t,r,n,i=void 0){this.id=e,this.level=t,this.row=r,this.col=n,this.extent=i}}},93389:function(e,t,r){r.d(t,{Fi:function(){return c},HZ:function(){return g},Jf:function(){return y},LS:function(){return v},Wo:function(){return m},bd:function(){return _},cr:function(){return p},iz:function(){return h},qg:function(){return d},yG:function(){return f}});var n=r(90683),i=r(60534);const s={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",knowledgegraphserver:"KnowledgeGraphServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer","3dtilesserver":"3DTilesServer",videoserver:"VideoServer"},a=Object.values(s),o=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${a.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),l=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^/\\n]+)\\/(${a.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),u=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function c(e){return o.test(e)}function d(e){if(null==e)return null;const t=(0,n.An)(e),r=t?.path.match(o)||t?.path.match(l);if(!r)return null;const[,i,a,u,c]=r,d=a.indexOf("/");return{title:p(-1!==d?a.slice(d+1):a),serverType:s[u.toLowerCase()],sublayer:null!=c&&""!==c?parseInt(c,10):null,url:{path:i}}}function h(e){const t=(0,n.An)(e).path.match(u);return t?{serviceUrl:t[1],sublayerId:Number(t[2])}:null}function p(e){return(e=e.replaceAll(/\s*[/_]+\s*/g," "))[0].toUpperCase()+e.slice(1)}function f(e,t){const r=[];if(e){const t=d(e);null!=t&&t.title&&r.push(t.title)}if(t){const e=p(t);r.push(e)}if(2===r.length){if(r[0].toLowerCase().includes(r[1].toLowerCase()))return r[0];if(r[1].toLowerCase().includes(r[0].toLowerCase()))return r[1]}return r.join(" - ")}function m(e){let t=(0,n.$z)(e,!0);return!!t&&(t=t.toLowerCase(),t.endsWith(".arcgis.com")&&(t.startsWith("services")||t.startsWith("tiles")||t.startsWith("features")))}function y(e,t){return e?(0,n.UC)((0,n.zi)(e,t)):e}function g(e){let{url:t}=e;if(!t)return{url:t};t=(0,n.zi)(t,e.logger);const r=(0,n.An)(t),i=d(r.path);let s;if(null!=i)null!=i.sublayer&&null==e.layer.layerId&&(s=i.sublayer),t=i.url.path;else if(e.nonStandardUrlAllowed){const e=h(r.path);null!=e&&(t=e.serviceUrl,s=e.sublayerId)}return{url:(0,n.UC)(t),layerId:s}}function v(e,t,r,s,a){(0,i.w)(t,s,"url",a),s.url&&null!=e.layerId&&(s.url=(0,n.fj)(s.url,r,e.layerId.toString()))}function _(e){if(!e)return!1;const t=e.toLowerCase(),r=t.includes("/services/"),n=t.includes("/mapserver/wmsserver"),i=t.includes("/imageserver/wmsserver"),s=t.includes("/wmsserver");return r&&(n||i||s)}},43173:function(e,t,r){r.r(t),r.d(t,{default:function(){return E}});var n=r(53804),i=r(53216),s=r(39819),a=r(30905),o=r(21609),l=r(31609),u=r(90683),c=r(23502),d=r(67888),h=r(47332),p=r(65953),f=r(91484),m=r(51432),y=r(83525),g=r(40633),v=r(77560);r(13798),r(58941);let _=class extends y.A{constructor(e){super(e),this.portalItem=null}normalizeCtorArgs(e){return e?.portalItem&&e.path?{...e,path:w(e.path,e.portalItem)}:e}set path(e){null!=e&&(0,u.oP)(e)?g.A.getLogger(this).error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",e)}_castPath(e){return w(e,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get cdnUrl(){return this.portalItem&&this.path?`${this.portalItem.itemCdnUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(e="json",t){const r=this.cdnUrl;if(null==r)throw new s.A("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal.request(r,{responseType:e,query:{token:this.portalItem.apiKey,_ts:t?.cacheBust?Date.now():null},signal:t?.signal})}async update(e,t){const{addOrUpdateResources:n}=await r.e(4460).then(r.bind(r,55597));return await n(this.portalItem,[{resource:this,content:e,compress:t?.compress,access:t?.access}],"update",t),this}hasPath(){return null!=this.path}};function w(e,t){return null==e?e:(e=e.replace(/^\/+/,""),null!=t&&(0,u.oP)(e)&&(e=(0,u.V1)(e,t.itemUrl)),e?.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}(0,n._)([(0,c.MZ)()],_.prototype,"portalItem",void 0),(0,n._)([(0,c.MZ)({type:String,value:null})],_.prototype,"path",null),(0,n._)([(0,v.w)("path")],_.prototype,"_castPath",null),(0,n._)([(0,c.MZ)({type:String,readOnly:!0})],_.prototype,"url",null),(0,n._)([(0,c.MZ)({type:String,readOnly:!0})],_.prototype,"cdnUrl",null),(0,n._)([(0,c.MZ)({type:String,readOnly:!0})],_.prototype,"itemRelativeUrl",null),_=(0,n._)([(0,p.$)("esri.portal.PortalItemResource")],_);const b=_;let T=class extends y.A{constructor(e){super(e),this.created=null,this.rating=null}};(0,n._)([(0,c.MZ)()],T.prototype,"created",void 0),(0,n._)([(0,c.MZ)()],T.prototype,"rating",void 0),T=(0,n._)([(0,p.$)("esri.portal.PortalRating")],T);const S=T;var I,x=r(60534);const M=new Set(["3DTiles Service","CSV","Feature Collection","Feature Service","Feed","GeoJson","Group Layer","Image Service","KML","Map Service","Media Layer","Scene Service","Stream Service","Vector Tile Service","WFS","WMS","WMTS"]),F=new Set(["KML","GeoJson","CSV"]);let L=I=class extends((0,a.Te)(l.A)){static from(e){return(0,d.PZ)(I,e)}constructor(e){super(e),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.classification=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.isOrgItem=!1,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.sourceUrl=null,this.spatialReference=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}destroy(){this.portal=null}get displayName(){const e=this.type,t=this.typeKeywords||[];let r=e;return"Feature Service"===e||"Feature Collection"===e?r=t.includes("Table")?"Table":t.includes("Route Layer")?"Route Layer":t.includes("Markup")?"Markup":"Feature Layer":"Image Service"===e?r=t.includes("Elevation 3D Layer")?"Elevation Layer":t.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":"Scene Service"===e?r="Scene Layer":"Video Service"===e?r="Video Layer":"Scene Package"===e?r="Scene Layer Package":"Stream Service"===e?r="Feature Layer":"Geoprocessing Service"===e?r=t.includes("Web Tool")?"Tool":"Geoprocessing Service":"Geoenrichment Service"===e?r="GeoEnrichment Service":"Geocoding Service"===e?r="Locator":"Microsoft Powerpoint"===e?r="Microsoft PowerPoint":"GeoJson"===e?r="GeoJSON":"Globe Service"===e?r="Globe Layer":"Vector Tile Service"===e?r="Tile Layer":"netCDF"===e?r="NetCDF":"Map Service"===e?r=t.includes("Spatiotemporal")||!t.includes("Hosted Service")&&!t.includes("Tiled")||t.includes("Relational")?"Map Image Layer":"Tile Layer":e?.toLowerCase().includes("add in")?r=e.replaceAll(/(add in)/gi,"Add-In"):"datastore catalog service"===e?r="Big Data File Share":"Compact Tile Package"===e?r="Tile Package (tpkx)":"Raster function template"===e?r="Raster Function Template":"OGCFeatureServer"===e?r="OGC Feature Layer":"web mapping application"===e&&t.includes("configurableApp")?r="Instant App":"Insights Page"===e?r="Insights Report":"Excalibur Imagery Project"===e?r="Excalibur Project":"3DTiles Service"===e?r="3D tiles layer":"3DTiles Package"===e&&(r="3D tiles package"),r}readExtent(e){return e&&e.length?new f.default(e[0][0],e[0][1],e[1][0],e[1][1]):null}get iconUrl(){const e=this.type?.toLowerCase()||"",t=this.typeKeywords||[];let r,n=!1,s=!1,a=!1,o=!1,l=!1,u=!1,c=!1,d=!1;return e.indexOf("service")>0||"feature collection"===e||"kml"===e||"wms"===e||"wmts"===e||"wfs"===e?(n=t.includes("Hosted Service"),"feature service"===e||"feature collection"===e||"kml"===e||"wfs"===e?(s=t.includes("Table"),a=t.includes("Route Layer"),o=t.includes("Markup"),l=t.includes("Spatiotemporal"),u=t.includes("UtilityNetwork"),r=l&&s?"spatiotemporaltable":s?"table":a?"routelayer":o?"markup":l?"spatiotemporal":u?"utilitynetwork":n?"featureshosted":"features"):"map service"===e||"wms"===e||"wmts"===e?(l=t.includes("Spatiotemporal"),c=t.includes("Relational"),r=l||c?"mapimages":n||t.includes("Tiled")||"wmts"===e?"maptiles":"mapimages"):r="scene service"===e?t.includes("Line")?"sceneweblayerline":t.includes("3DObject")?"sceneweblayermultipatch":t.includes("Point")?"sceneweblayerpoint":t.includes("IntegratedMesh")?"sceneweblayermesh":t.includes("PointCloud")?"sceneweblayerpointcloud":t.includes("Polygon")?"sceneweblayerpolygon":t.includes("Building")?"sceneweblayerbuilding":t.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":"image service"===e?t.includes("Elevation 3D Layer")?"elevationlayer":t.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":"stream service"===e?"streamlayer":"vector tile service"===e?"vectortile":"datastore catalog service"===e?"datastorecollection":"geocoding service"===e?"geocodeservice":"video service"===e?t.includes("Live Stream")?"livestreamvideolayer":"videolayer":"geoprocessing service"===e?t.includes("Web Tool")?"tool":"layers":"geodata service"===e?"geodataservice":"3dtiles service"===e?t.includes("3DObject")?"3dobjecttileslayer":t.includes("IntegratedMesh")?"integratedmeshtileslayer":"3dtileslayer":"layers"):"web map"===e||"cityengine web scene"===e?r="maps":"web scene"===e?r=t.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":"web mapping application"===e&&t.includes("configurableApp")?r="instantapps":"web mapping application"===e||"mobile application"===e||"application"===e||"operation view"===e||"desktop application"===e?r="apps":"map document"===e||"map package"===e||"published map"===e||"scene document"===e||"globe document"===e||"basemap package"===e||"mobile basemap package"===e||"mobile map package"===e||"project package"===e||"project template"===e||"pro map"===e||"layout"===e||"layer"===e&&t.includes("ArcGIS Pro")||"explorer map"===e&&t.indexOf("Explorer Document")?r="mapsgray":"service definition"===e||"shapefile"===e||"cad drawing"===e||"geojson"===e||"netcdf"===e||"administrative report"===e?r="datafiles":"360 vr experience"===e?r="360vr":"explorer add in"===e||"desktop add in"===e||"windows viewer add in"===e||"windows viewer configuration"===e?r="appsgray":"arcgis pro add in"===e||"arcgis pro configuration"===e?r="addindesktop":"pdf"===e?r="pdf":"microsoft word"===e?r="word":"microsoft excel"===e?r="excel":"microsoft powerpoint"===e?r="ppt":"rule package"===e||"file geodatabase"===e||"sqlite geodatabase"===e||"csv collection"===e||"kml collection"===e||"windows mobile package"===e||"map template"===e||"desktop application template"===e||"gml"===e||"arcpad package"===e||"code sample"===e||"document link"===e||"earth configuration"===e||"operations dashboard add in"===e||"rules package"===e||"workflow manager package"===e||"explorer map"===e&&t.includes("Explorer Mapping Application")||t.includes("Document")?r="datafilesgray":"network analysis service"===e||"geoprocessing service"===e||"geodata service"===e||"geometry service"===e||"geoprocessing package"===e||"locator package"===e||"geoprocessing sample"===e||"workflow manager service"===e?r="toolsgray":"layer"===e||"layer package"===e||"explorer layer"===e?r="layersgray":"analysis model"===e?r="analysismodel":"scene package"===e?r="scenepackage":"3dtiles package"===e?r="3dtileslayerpackage":"3dtiles service"===e?r="3dtileslayer":"mobile scene package"===e?r="mobilescenepackage":"tile package"===e||"compact tile package"===e?r="tilepackage":"task file"===e?r="taskfile":"report template"===e?r="report-template":"statistical data collection"===e?r="statisticaldatacollection":"insights workbook"===e?r="workbook":"insights model"===e?r="insightsmodel":"insights page"===e?r="insightspage":"insights theme"===e?r="insightstheme":"hub initiative"===e?r="hubinitiative":"hub page"===e?r="hubpage":"hub site application"===e?r="hubsite":"hub event"===e?r="hubevent":"hub project"===e?r="hubproject":"relational database connection"===e?r="relationaldatabaseconnection":"big data file share"===e?r="datastorecollection":"image collection"===e?r="imagecollection":"desktop style"===e?r="desktopstyle":"style"===e?r=t.includes("Dictionary")?"dictionarystyle":"style":"dashboard"===e?r="dashboard":"raster function template"===e?r="rasterprocessingtemplate":"vector tile package"===e?r="vectortilepackage":"ortho mapping project"===e?r="orthomappingproject":"ortho mapping template"===e?r="orthomappingtemplate":"solution"===e?r="solutions":"geopackage"===e?r="geopackage":"deep learning package"===e?r="deeplearningpackage":"real time analytic"===e?r="realtimeanalytics":"reality mapping project"===e?r="realitymappingproject":"big data analytic"===e?r="bigdataanalytics":"feed"===e?r="feed":"excalibur imagery project"===e?r="excaliburimageryproject":"notebook"===e?r="notebook":"storymap"===e?r="storymap":"survey123 add in"===e?r="survey123addin":"mission"===e?r="mission":"mission report"===e?r="missionreport":"mission template"===e?r="missiontemplate":"quickcapture project"===e?r="quickcaptureproject":"pro report"===e?r="proreport":"pro report template"===e?r="proreporttemplate":"urban model"===e?r="urbanmodel":"urban project"===e?r="urbanproject":"web experience"===e?r="experiencebuilder":"web experience template"===e?r="webexperiencetemplate":"experience builder widget"===e?r="experiencebuilderwidget":"experience builder widget package"===e?r="experiencebuilderwidgetpackage":"workflow"===e?r="workflow":"kernel gateway connection"===e?r="kernelgatewayconnection":"insights script"===e?r="insightsscript":"hub initiative template"===e?r="hubinitiativetemplate":"storymap theme"===e?r="storymaptheme":"knowledge graph"===e?r="knowledgegraph":"knowledge graph layer"===e?r="knowledgegraphlayer":"knowledge studio project"===e?r="knowledgestudio":"native application"===e?r="nativeapp":"native application installer"===e?r="nativeappinstaller":"web link chart"===e?r="linkchart":"knowledge graph web investigation"===e?r="investigation":"ogcfeatureserver"===e?r="features":"pro presentation"===e?r="propresentation":"pro project"===e?r="proproject":"insights workbook package"===e?r="insightsworkbookpackage":"apache parquet"===e?r="apacheparquet":"notebook code snippet library"===e?r="notebookcodesnippets":"suitability model"===e?r="suitabilitymodel":"esri classifier definition"===e?r="classifierdefinition":"esri classification schema"===e?r="classificationschema":"insights data engineering workbook"===e?r="dataengineeringworkbook":"insights data engineering model"===e?r="dataengineeringmodel":"deep learning studio project"===e?r="deeplearningproject":"discussion"===e?r="discussion":"allsource project"===e?r="allsourceproject":"api key"===e?r="apikey":"data pipeline"===e?r="datapipelines":"group layer"===e?(d=t.includes("Map"),r=d?"layergroup2d":"layergroup"):r="media layer"===e?"onlinemedialayer":"form"===e?t.includes("Survey123")?"survey":"datafilesgray":"csv"===e?"csv":"image"===e?"image":"maps",r?(0,i.s)("esri/images/portal/"+r+"16.png"):null}get isLayer(){return null!=this.type&&M.has(this.type)}get itemCdnUrl(){return(0,x.a)(this.itemUrl)}get itemPageUrl(){const e=this.portal?.itemPageUrl;return e&&this.id?`${e}?id=${this.id}`:null}get itemUrl(){const e=this.portal?.restUrl;return e&&this.id?`${e}/content/items/${this.id}`:null}get thumbnailUrl(){const e=this.itemUrl,t=this.thumbnail;return e&&t?this.portal?.normalizeUrl(`${e}/info/${t}?f=json`)??null:null}get userItemUrl(){const e=this.portal?.restUrl;if(!e)return null;const t=this.owner||this.portal?.user?.username;return t?`${e}/content/users/${this.ownerFolder?`${t}/${this.ownerFolder}`:t}/items/${this.id}`:null}load(e){const t=this.portal??(this.portal=m.A.getDefault()),r=t.load(e).then((()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?t.request(this.itemUrl,{signal:null!=e?e.signal:null,query:{token:this.apiKey}}):{})).then((e=>{this.sourceJSON=e,this.read(e)}));return this.addResolvingPromise(r),Promise.resolve(this)}async addRating(e){const t={method:"post",query:{}};return e instanceof S&&(e=e.rating),null==e||isNaN(e)||"number"!=typeof e||(t.query.rating=e),this.portal?(await this.portal.request(this.itemUrl+"/addRating",t),new S({rating:e,created:new Date})):null}clone(){const e={access:this.access,accessInformation:this.accessInformation,applicationProxies:(0,o.o8)(this.applicationProxies),avgRating:this.avgRating,categories:(0,o.o8)(this.categories),classification:(0,o.o8)(this.classification),created:(0,o.o8)(this.created),culture:this.culture,description:this.description,extent:(0,o.o8)(this.extent),groupCategories:(0,o.o8)(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:(0,o.o8)(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:(0,o.o8)(this.screenshots),size:this.size,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:(0,o.o8)(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:(0,o.o8)(this.typeKeywords),url:this.url};this.loaded&&(e.loadStatus="loaded");const t=new I({sourceJSON:this.sourceJSON}).set(e);return t._set("isOrgItem",this.isOrgItem),t}createPostQuery(){const e=this.toJSON();for(const t of["tags","typeKeywords","categories"])e[t]=e[t]?.join(", ");for(const t of["extent","classification"]){const r=e[t];r&&(e[t]=JSON.stringify(r))}return e}async deleteRating(){await this.portal.request(this.itemUrl+"/deleteRating",{method:"post"})}fetchData(e="json",t){return this.portal.request(this.itemUrl+"/data",{responseType:e,...t,query:{token:this.apiKey}})}async fetchRating(e){const t=await this.portal.request(this.itemUrl+"/rating",{query:{token:this.apiKey},...e});return null!=t.rating?(t.created=new Date(t.created),new S(t)):null}fetchRelatedItems(e,t){return this.portal.requestToTypedArray(this.itemUrl+"/relatedItems",{query:{...e,token:this.apiKey},...t},I)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}reload(){return this.portal.request(this.itemUrl??"",{cacheBust:!0,query:{token:this.apiKey}}).then((e=>(this.applicationProxies&&!Object.hasOwn(e,"appProxies")&&(this.applicationProxies=null),this.sourceJSON=e,this.read(e),this)))}update(e){return this.id?this.load().then((()=>this.portal.signIn())).then((()=>{const t=e?.data,r={method:"post"};r.query=this.createPostQuery();for(const e in r.query)null===r.query[e]&&(r.query[e]="");return r.query.clearEmptyFields=!0,null!=t&&("string"==typeof t?r.query.text=t:"object"==typeof t&&(r.query.text=JSON.stringify(t))),this.portal.request(`${this.userItemUrl}/update`,r).then((()=>this.reload()))})):Promise.reject(new s.A("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async copy(e){if(!this.id)throw new s.A("portal:item-does-not-exist","The item does not exist yet");await this.load();const{portal:t,itemUrl:r}=this;await t.signIn();const{copyResources:n,folder:i,tags:a,title:o}=e||{},l={method:"post",query:{copyPrivateResources:"all"===n,folder:"string"==typeof i?i:i?.id,includeResources:!!n,tags:a?.join(","),title:o}},{itemId:u}=await t.request(`${r}/copy`,l);return new I({id:u,portal:t})}updateThumbnail(e){return this.id?this.load().then((()=>this.portal.signIn())).then((()=>{const t=e.thumbnail,r=e.filename,n={method:"post"};if("string"==typeof t)(0,u.DB)(t)?n.query={data:t}:n.query={url:(0,u.s2)(t)},null!=r&&(n.query.filename=r);else{const e=new FormData;null!=r?e.append("file",t,r):e.append("file",t),n.body=e}return this.portal.request(`${this.userItemUrl}/updateThumbnail`,n).then((()=>this.reload()))})):Promise.reject(new s.A("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(e={},t){const{fetchResources:n}=await r.e(4460).then(r.bind(r,55597));return n(this,e,t)}async addResource(e,t,n){const{addOrUpdateResources:i}=await r.e(4460).then(r.bind(r,55597));return e.portalItem=this,await i(this,[{resource:e,content:t,compress:n?.compress,access:n?.access}],"add",n),e}async removeResource(e,t){const{removeResource:n}=await r.e(4460).then(r.bind(r,55597));if(e.portalItem&&e.portalItem.itemUrl!==this.itemUrl)throw new s.A("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return n(this,e,t)}async removeAllResources(e){const{removeAllResources:t}=await r.e(4460).then(r.bind(r,55597));return t(this,e)}resourceFromPath(e){return new b({portalItem:this,path:e})}toJSON(){const e=this.extent,t={accessInformation:this.accessInformation,categories:(0,o.o8)(this.categories),classification:(0,o.o8)(this.classification),created:this.created?.getTime(),description:this.description,extent:e&&[[e.xmin,e.ymin],[e.xmax,e.ymax]],id:this.id,isOrgItem:this.isOrgItem,licenseInfo:this.licenseInfo,modified:this.modified?.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:(0,o.o8)(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:(0,o.o8)(this.typeKeywords),url:this.url};return(0,o.oy)(t)}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");return new I({sourceJSON:e})}_getPostQuery(){const e=this.toJSON();for(const t in e)"tags"===t&&null!==e[t]&&(e[t]=e[t].join(", ")),"typeKeywords"===t&&null!==e[t]&&(e[t]=e[t].join(", ")),"extent"===t&&e[t]&&(e[t]=JSON.stringify(e[t]));return e}};(0,n._)([(0,c.MZ)({type:["private","shared","org","public"]})],L.prototype,"access",void 0),(0,n._)([(0,c.MZ)()],L.prototype,"accessInformation",void 0),(0,n._)([(0,c.MZ)({type:String})],L.prototype,"apiKey",void 0),(0,n._)([(0,c.MZ)({json:{read:{source:"appProxies"}}})],L.prototype,"applicationProxies",void 0),(0,n._)([(0,c.MZ)()],L.prototype,"avgRating",void 0),(0,n._)([(0,c.MZ)()],L.prototype,"categories",void 0),(0,n._)([(0,c.MZ)()],L.prototype,"classification",void 0),(0,n._)([(0,c.MZ)({type:Date})],L.prototype,"created",void 0),(0,n._)([(0,c.MZ)()],L.prototype,"culture",void 0),(0,n._)([(0,c.MZ)()],L.prototype,"description",void 0),(0,n._)([(0,c.MZ)({readOnly:!0})],L.prototype,"displayName",null),(0,n._)([(0,c.MZ)({type:f.default})],L.prototype,"extent",void 0),(0,n._)([(0,h.w)("extent")],L.prototype,"readExtent",null),(0,n._)([(0,c.MZ)()],L.prototype,"groupCategories",void 0),(0,n._)([(0,c.MZ)({readOnly:!0})],L.prototype,"iconUrl",null),(0,n._)([(0,c.MZ)()],L.prototype,"id",void 0),(0,n._)([(0,c.MZ)({readOnly:!0})],L.prototype,"isLayer",null),(0,n._)([(0,c.MZ)({type:Boolean,readOnly:!0})],L.prototype,"isOrgItem",void 0),(0,n._)([(0,c.MZ)()],L.prototype,"itemControl",void 0),(0,n._)([(0,c.MZ)({readOnly:!0})],L.prototype,"itemPageUrl",null),(0,n._)([(0,c.MZ)({readOnly:!0})],L.prototype,"itemUrl",null),(0,n._)([(0,c.MZ)()],L.prototype,"licenseInfo",void 0),(0,n._)([(0,c.MZ)({type:Date})],L.prototype,"modified",void 0),(0,n._)([(0,c.MZ)()],L.prototype,"name",void 0),(0,n._)([(0,c.MZ)()],L.prototype,"numComments",void 0),(0,n._)([(0,c.MZ)()],L.prototype,"numRatings",void 0),(0,n._)([(0,c.MZ)()],L.prototype,"numViews",void 0),(0,n._)([(0,c.MZ)()],L.prototype,"owner",void 0),(0,n._)([(0,c.MZ)()],L.prototype,"ownerFolder",void 0),(0,n._)([(0,c.MZ)({type:m.A})],L.prototype,"portal",void 0),(0,n._)([(0,c.MZ)()],L.prototype,"screenshots",void 0),(0,n._)([(0,c.MZ)()],L.prototype,"size",void 0),(0,n._)([(0,c.MZ)()],L.prototype,"snippet",void 0),(0,n._)([(0,c.MZ)()],L.prototype,"sourceJSON",void 0),(0,n._)([(0,c.MZ)({type:String})],L.prototype,"sourceUrl",void 0),(0,n._)([(0,c.MZ)({type:String})],L.prototype,"spatialReference",void 0),(0,n._)([(0,c.MZ)()],L.prototype,"tags",void 0),(0,n._)([(0,c.MZ)()],L.prototype,"thumbnail",void 0),(0,n._)([(0,c.MZ)({readOnly:!0})],L.prototype,"thumbnailUrl",null),(0,n._)([(0,c.MZ)()],L.prototype,"title",void 0),(0,n._)([(0,c.MZ)()],L.prototype,"type",void 0),(0,n._)([(0,c.MZ)()],L.prototype,"typeKeywords",void 0),(0,n._)([(0,c.MZ)({type:String,json:{read(e,t){if(F.has(t.type)){const t=this.portal?.restUrl;e||=t&&this.id?`${t}/content/items/${this.id}/data`:null}return e}}})],L.prototype,"url",void 0),(0,n._)([(0,c.MZ)({readOnly:!0})],L.prototype,"userItemUrl",null),L=I=(0,n._)([(0,p.$)("esri.portal.PortalItem")],L);const E=L},70181:function(e,t,r){r.d(t,{O3:function(){return d},PU:function(){return u},YW:function(){return p},ex:function(){return o},hv:function(){return h},zp:function(){return l}});var n=r(15774),i=r(13520),s=r(33400),a=r(41546);const o=2.4;function l(e){return(0,i.PN)(e*o)}function u(e){return(0,i.Lz)(e)/o}function c(e,t,r,i){let{color:a,ratio:o}=t,{color:l,ratio:u}=r;if(u===o){const e=1e-6;1===u?o-=e:u+=e}const c=(0,n.qE)((i-o)/(u-o),0,1);(0,s.l)(e,a.toArray(),l.toArray(),c)}function d(e){const t=new Uint8ClampedArray(2048);if((e=e.filter((({ratio:e})=>e>=0&&e<=1)).sort(((e,t)=>e.ratio-t.ratio)).map((({color:e,ratio:t})=>({color:e,ratio:Math.max(t,.001)})))).length<1)return t;let r=e[0],n=e[0],i=1;const s=(0,a.vt)();for(let a=0;a<512;a++){const o=(a+.5)/512;for(;o>n.ratio&&i<e.length;)r=n,n=e[i++];c(s,r,n,o),t.set(s,4*a)}return t}function h(e,t,r){const n=Math.sqrt(e**2+t**2)/r;return n>1?0:3/(Math.PI*r**2)*(1-n**2)**2}function p(e){return"function"==typeof e?e:e?t=>+t[e]:()=>1}},26765:function(e,t,r){r.d(t,{V:function(){return s},X:function(){return i}});var n=r(74697);function i(e){return{geometryType:(0,n.$B)(e[0]),geometries:e.map((e=>e.toJSON()))}}function s(e,t,r){const i=(0,n.xD)(t);return e.map((e=>{const t=i.fromJSON(e);return t.spatialReference=r,t}))}},12873:function(e,t,r){function n(e){const t={};for(const r in e){if("declaredClass"===r)continue;const i=e[r];if(null!=i&&"function"!=typeof i)if(Array.isArray(i)){t[r]=[];for(let e=0;e<i.length;e++)t[r][e]=n(i[e])}else"object"==typeof i?i.toJSON&&(t[r]=JSON.stringify(i)):t[r]=i}return t}r.d(t,{z:function(){return n}})},45608:function(e,t,r){r.d(t,{SH:function(){return L},ae:function(){return S},cn:function(){return v}});var n=r(39819),i=r(68225),s=r(76613),a=r(38519);const o=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML","esriFieldTypeBigInteger","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"],l=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],u=["upperLeft","lowerLeft"];function c(e){return e>=o.length?null:o[e]}function d(e){return e>=l.length?null:l[e]}function h(e){return e>=u.length?null:u[e]}function p(e,t){return t>=e.geometryTypes.length?null:e.geometryTypes[t]}function f(e,t,r){const n=e.asUnsafe(),i=t.createPointGeometry(r);for(;n.next();)switch(n.tag()){case 3:{const e=n.getUInt32(),r=n.pos()+e;let s=0;for(;n.pos()<r;)t.addCoordinatePoint(i,n.getSInt64(),s++);break}default:n.skip()}return i}function m(e,t,r){const n=e.asUnsafe(),i=t.createGeometry(r),s=2+(r.hasZ?1:0)+(r.hasM?1:0);for(;n.next();)switch(n.tag()){case 2:{const e=n.getUInt32(),r=n.pos()+e;let s=0;for(;n.pos()<r;)t.addLength(i,n.getUInt32(),s++);break}case 3:{const e=n.getUInt32(),r=n.pos()+e;let a=0;for(t.allocateCoordinates(i);n.pos()<r;)t.addCoordinate(i,n.getSInt64(),a),a++,a===s&&(a=0);break}default:n.skip()}return i}function y(e){const t=e.asUnsafe(),r=new s.A;let n="esriGeometryPoint";for(;t.next();)switch(t.tag()){case 2:{const e=t.getUInt32(),n=t.pos()+e;for(;t.pos()<n;)r.lengths.push(t.getUInt32());break}case 3:{const e=t.getUInt32(),n=t.pos()+e;for(;t.pos()<n;)r.coords.push(t.getSInt64());break}case 1:n=a.z[t.getEnum()];break;default:t.skip()}return{queryGeometry:r,queryGeometryType:n}}function g(e){const t=e.asUnsafe();for(;t.next();)switch(t.tag()){case 1:return t.getString();case 2:return t.getFloat();case 3:return t.getDouble();case 4:return t.getSInt32();case 5:return t.getUInt32();case 6:return t.getInt64();case 7:return t.getUInt64();case 8:return t.getSInt64();case 9:return t.getBool();default:return t.skip(),null}return null}function v(e){const t=e.asUnsafe(),r={type:c(0)};for(;t.next();)switch(t.tag()){case 1:r.name=t.getString();break;case 2:r.type=c(t.getEnum());break;case 3:r.alias=t.getString();break;case 4:r.sqlType=d(t.getEnum());break;case 5:default:t.skip();break;case 6:r.defaultValue=t.getString()}return r}function _(e){const t={},r=e.asUnsafe();for(;r.next();)switch(r.tag()){case 1:t.name=r.getString();break;case 2:t.isSystemMaintained=r.getBool();break;default:r.skip()}return t}function w(e,t,r,n){const i=t.createFeature(r);let s=0;for(;e.next();)switch(e.tag()){case 1:{const t=n[s++].name;i.attributes[t]=e.processMessage(g);break}case 2:i.geometry=e.processMessageWithArgs(m,t,r);break;case 4:i.centroid=e.processMessageWithArgs(f,t,r);break;default:e.skip()}return i}function b(e){const t=[1,1,1,1],r=e.asUnsafe();for(;r.next();)switch(r.tag()){case 1:t[0]=r.getDouble();break;case 2:t[1]=r.getDouble();break;case 4:t[2]=r.getDouble();break;case 3:t[3]=r.getDouble();break;default:r.skip()}return t}function T(e){const t=[0,0,0,0],r=e.asUnsafe();for(;r.next();)switch(r.tag()){case 1:t[0]=r.getDouble();break;case 2:t[1]=r.getDouble();break;case 4:t[2]=r.getDouble();break;case 3:t[3]=r.getDouble();break;default:r.skip()}return t}function S(e){const t={originPosition:h(0)},r=e.asUnsafe();for(;r.next();)switch(r.tag()){case 1:t.originPosition=h(r.getEnum());break;case 2:t.scale=r.processMessage(b);break;case 3:t.translate=r.processMessage(T);break;default:r.skip()}return t}function I(e){const t={},r=e.asUnsafe();for(;r.next();)switch(r.tag()){case 1:t.shapeAreaFieldName=r.getString();break;case 2:t.shapeLengthFieldName=r.getString();break;case 3:t.units=r.getString();break;default:r.skip()}return t}function x(e,t){const r=t.createSpatialReference();for(;e.next();)switch(e.tag()){case 1:r.wkid=e.getUInt32();break;case 5:r.wkt=e.getString();break;case 2:r.latestWkid=e.getUInt32();break;case 3:r.vcsWkid=e.getUInt32();break;case 4:r.latestVcsWkid=e.getUInt32();break;default:e.skip()}return r}function M(e,t){const r=t.createFeatureResult(),n=e.asUnsafe();r.geometryType=p(t,0);let i=!1;for(;n.next();)switch(n.tag()){case 1:r.objectIdFieldName=n.getString();break;case 3:r.globalIdFieldName=n.getString();break;case 4:r.geohashFieldName=n.getString();break;case 5:r.geometryProperties=n.processMessage(I);break;case 7:r.geometryType=p(t,n.getEnum());break;case 8:r.spatialReference=n.processMessageWithArgs(x,t);break;case 10:r.hasZ=n.getBool();break;case 11:r.hasM=n.getBool();break;case 12:r.transform=n.processMessage(S);break;case 9:r.exceededTransferLimit=n.getBool();break;case 13:t.addField(r,n.processMessage(v));break;case 15:i||(t.prepareFeatures(r),i=!0),t.addFeature(r,n.processMessageWithArgs(w,t,r,r.fields));break;case 2:r.uniqueIdField=n.processMessage(_);break;default:n.skip()}return t.finishFeatureResult(r),r}function F(e,t){const r={};let n=null;for(;e.next();)switch(e.tag()){case 4:n=e.processMessageWithArgs(y);break;case 1:r.featureResult=e.processMessageWithArgs(M,t);break;default:e.skip()}return null!=n&&r.featureResult&&t.addQueryGeometry(r,n),r}function L(e,t){try{const r=2,n=new i.A(new Uint8Array(e),new DataView(e)),s={};for(;n.next();)n.tag()===r?s.queryResult=n.processMessageWithArgs(F,t):n.skip();return s}catch(e){throw new n.A("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:e})}}},38519:function(e,t,r){r.d(t,{S:function(){return u},z:function(){return l}});var n=r(62938),i=r(57652),s=r(65215),a=r(72887),o=r(76613);const l=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"];class u{constructor(e){this._options=e,this.geometryTypes=l,this._coordinatePtr=0,this._vertexDimension=0}createFeatureResult(){return new a.A}prepareFeatures(e){this._vertexDimension=2,e.hasZ&&this._vertexDimension++,e.hasM&&this._vertexDimension++}finishFeatureResult(e){if(!e?.features||!e.hasZ||!this._options.sourceSpatialReference||!e.spatialReference||(0,i.aI)(e.spatialReference,this._options.sourceSpatialReference)||e.spatialReference.vcsWkid)return;const t=(0,n.G9)(this._options.sourceSpatialReference)/(0,n.G9)(e.spatialReference);if(1!==t)for(const r of e.features){if(!(0,s.N3)(r))continue;const e=r.geometry.coords;for(let r=2;r<e.length;r+=3)e[r]*=t}}addFeature(e,t){e.features.push(t)}createFeature(){return new s.Om}createSpatialReference(){return{wkid:0}}createGeometry(){return new o.A}addField(e,t){e.fields.push(t)}allocateCoordinates(e){e.coords.length=e.lengths.reduce(((e,t)=>e+t),0)*this._vertexDimension,this._coordinatePtr=0}addCoordinate(e,t){e.coords[this._coordinatePtr++]=t}addCoordinatePoint(e,t){e.coords.push(t)}addLength(e,t){e.lengths.push(t)}addQueryGeometry(e,t){e.queryGeometry=t.queryGeometry,e.queryGeometryType=t.queryGeometryType}createPointGeometry(){return new o.A}}},55723:function(e,t,r){r.d(t,{m:function(){return i}});var n=r(45608);function i(e,t){const r=(0,n.SH)(e,t),i=r.queryResult.featureResult,s=r.queryResult.queryGeometry,a=r.queryResult.queryGeometryType;if(i&&i.features&&i.features.length&&i.objectIdFieldName){const e=i.objectIdFieldName;for(const t of i.features)t.attributes&&(t.objectId=t.attributes[e])}return i&&(i.queryGeometry=s,i.queryGeometryType=a),i}},90066:function(e,t,r){r.d(t,{IJ:function(){return f},Jf:function(){return v},Pk:function(){return y},eW:function(){return p},gW:function(){return g},kS:function(){return m}});var n=r(93040),i=r(90683),s=r(74697),a=r(65298),o=r(57652),l=r(12873),u=r(55723),c=r(45406);const d="Layer does not support extent calculation.";function h(e,t){const r=e.geometry,n=e.toJSON();delete n.compactGeometryEnabled,delete n.defaultSpatialReferenceEnabled;const i=n;let a,l,u;if(null!=r&&(l=r.spatialReference,u=(0,o.YX)(l),i.geometryType=(0,s.$B)(r),i.geometry=function(e,t){if(t&&"extent"===e.type)return`${e.xmin},${e.ymin},${e.xmax},${e.ymax}`;if(t&&"point"===e.type)return`${e.x},${e.y}`;const r=e.toJSON();return delete r.spatialReference,JSON.stringify(r)}(r,e.compactGeometryEnabled),i.inSR=u),n.groupByFieldsForStatistics&&(i.groupByFieldsForStatistics=n.groupByFieldsForStatistics.join(",")),n.objectIds&&(i.objectIds=n.objectIds.join(",")),n.orderByFields&&(i.orderByFields=n.orderByFields.join(",")),!n.outFields||!n.returnDistinctValues&&(t?.returnCountOnly||t?.returnExtentOnly||t?.returnIdsOnly)?delete i.outFields:n.outFields.includes("*")?i.outFields="*":i.outFields=n.outFields.join(","),n.outSR?(i.outSR=(0,o.YX)(n.outSR),a=e.outSpatialReference):r&&(n.returnGeometry||n.returnCentroid)&&(i.outSR=i.inSR,a=l),n.returnGeometry&&delete n.returnGeometry,n.outStatistics&&(i.outStatistics=JSON.stringify(n.outStatistics)),n.fullText&&(i.fullText=JSON.stringify(n.fullText)),n.pixelSize&&(i.pixelSize=JSON.stringify(n.pixelSize)),n.quantizationParameters&&(e.defaultSpatialReferenceEnabled&&null!=l&&null!=e.quantizationParameters?.extent&&l.equals(e.quantizationParameters.extent.spatialReference)&&delete n.quantizationParameters.extent.spatialReference,i.quantizationParameters=JSON.stringify(n.quantizationParameters)),n.parameterValues&&(i.parameterValues=JSON.stringify(n.parameterValues)),n.rangeValues&&(i.rangeValues=JSON.stringify(n.rangeValues)),n.dynamicDataSource&&(i.layer=JSON.stringify({source:n.dynamicDataSource}),delete n.dynamicDataSource),n.timeExtent){const e=n.timeExtent,{start:t,end:r}=e;null==t&&null==r||(i.time=t===r?t:`${t??"null"},${r??"null"}`),delete n.timeExtent}return e.defaultSpatialReferenceEnabled&&null!=l&&null!=a&&l.equals(a)&&(i.defaultSR=i.inSR,delete i.inSR,delete i.outSR),i}async function p(e,t,r,n){const i=null!=t.timeExtent&&t.timeExtent.isEmpty?{data:{features:[]}}:await _(e,t,"json",n);return(0,c.q)(t,r,i.data),i}async function f(e,t,r,n){if(null!=t.timeExtent&&t.timeExtent.isEmpty)return{data:r.createFeatureResult()};const i=await m(e,t,n),s=i;return s.data=(0,u.m)(i.data,r),s}function m(e,t,r){return _(e,t,"pbf",r)}function y(e,t,r){return null!=t.timeExtent&&t.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):_(e,t,"json",r,{returnIdsOnly:!0})}function g(e,t,r){return null!=t.timeExtent&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):_(e,t,"json",r,{returnIdsOnly:!0,returnCountOnly:!0})}async function v(e,t,r){if(null!=t.timeExtent&&t.timeExtent.isEmpty)return{data:{count:0,extent:null}};const n=await _(e,t,"json",r,{returnExtentOnly:!0,returnCountOnly:!0}),i=n.data;if(i.hasOwnProperty("extent"))return n;if(i.features)throw new Error(d);if(i.hasOwnProperty("count"))throw new Error(d);return n}async function _(e,t,r,s={},o={}){const u="string"==typeof e?(0,i.An)(e):e,c=t.geometry?[t.geometry]:[],d=await(0,a.el)(c,null,{signal:s.signal}),p=d?.[0];null!=p&&((t=t.clone()).geometry=p);const f=(0,l.z)({...u.query,f:r,...o,...h(t,o)});return(0,n.A)((0,i.fj)(u.path,(m=o,null==t.formatOf3DObjects||m.returnCountOnly||m.returnExtentOnly||m.returnIdsOnly?"query":"query3d")),{...s,responseType:"pbf"===r?"array-buffer":"json",query:{...f,...s.query}});var m}},45406:function(e,t,r){r.d(t,{q:function(){return i}});var n=r(6996);function i(e,t,r){if(!r?.features||!r.hasZ)return;const i=(0,n.N)(r.geometryType,t,e.outSpatialReference);if(null!=i)for(const e of r.features)i(e.geometry)}},74373:function(e,t,r){r.d(t,{A:function(){return h}});var n=r(53804),i=r(73037),s=r(30905),a=r(23502),o=(r(58941),r(40633),r(13798),r(74376)),l=r(65953);const u=new i.J({esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation",esriClassifyDefinedInterval:"defined-interval"}),c=new i.J({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:"percent-of-total",esriNormalizeByField:"field"});let d=class extends s.oY{constructor(e){super(e),this.type="class-breaks-definition",this.breakCount=null,this.classificationField=null,this.classificationMethod=null,this.normalizationField=null,this.normalizationType=null}set standardDeviationInterval(e){"standard-deviation"===this.classificationMethod&&this._set("standardDeviationInterval",e)}set definedInterval(e){"defined-interval"===this.classificationMethod&&this._set("definedInterval",e)}};(0,n._)([(0,o.e)({classBreaksDef:"class-breaks-definition"})],d.prototype,"type",void 0),(0,n._)([(0,a.MZ)({json:{write:!0}})],d.prototype,"breakCount",void 0),(0,n._)([(0,a.MZ)({json:{write:!0}})],d.prototype,"classificationField",void 0),(0,n._)([(0,a.MZ)({type:String,json:{read:u.read,write:u.write}})],d.prototype,"classificationMethod",void 0),(0,n._)([(0,a.MZ)({json:{write:!0}})],d.prototype,"normalizationField",void 0),(0,n._)([(0,a.MZ)({json:{read:c.read,write:c.write}})],d.prototype,"normalizationType",void 0),(0,n._)([(0,a.MZ)({value:null,json:{write:!0}})],d.prototype,"standardDeviationInterval",null),(0,n._)([(0,a.MZ)({value:null,json:{write:!0}})],d.prototype,"definedInterval",null),d=(0,n._)([(0,l.$)("esri.rest.support.ClassBreaksDefinition")],d);const h=d},49241:function(e,t,r){r.d(t,{t:function(){return a}});var n=r(40633);const i=()=>n.A.getLogger("esri.rest.support.generateRendererUtils");function s(e,t){return Number(e.toFixed(t))}function a(e){const{normalizationTotal:t}=e;return{classBreaks:o(e),normalizationTotal:t}}function o(e){const t=e.definition,{classificationMethod:r,normalizationType:n,definedInterval:i}=t,a=t.breakCount??1,o=[];let c=e.values;if(0===c.length)return[];c=c.sort(((e,t)=>e-t));const d=c[0],h=c[c.length-1];if("equal-interval"===r)if(c.length>=a){const e=(h-d)/a;let t=d;for(let r=1;r<a;r++){const i=s(d+r*e,6);o.push({minValue:t,maxValue:i,label:l(t,i,n)}),t=i}o.push({minValue:t,maxValue:h,label:l(t,h,n)})}else c.forEach((e=>{o.push({minValue:e,maxValue:e,label:l(e,e,n)})}));else if("natural-breaks"===r){const t=function(e){const t=[],r=[];let n=Number.MIN_VALUE,i=1,s=-1;for(let a=0;a<e.length;a++){const o=e[a];o===n?(i++,r[s]=i):null!==o&&(t.push(o),n=o,i=1,r.push(i),s++)}return{uniqueValues:t,valueFrequency:r}}(c),r=e.valueFrequency||t.valueFrequency,i=u(t.uniqueValues,r,a);let p=d;for(let e=1;e<a;e++)if(t.uniqueValues.length>e){const r=s(t.uniqueValues[i[e]],6);o.push({minValue:p,maxValue:r,label:l(p,r,n)}),p=r}o.push({minValue:p,maxValue:h,label:l(p,h,n)})}else if("quantile"===r)if(c.length>=a&&d!==h){let e=d,t=Math.ceil(c.length/a),r=0;for(let i=1;i<a;i++){let s=t+r-1;s>c.length&&(s=c.length-1),s<0&&(s=0),o.push({minValue:e,maxValue:c[s],label:l(e,c[s],n)}),e=c[s],r+=t,t=Math.ceil((c.length-r)/(a-i))}o.push({minValue:e,maxValue:h,label:l(e,h,n)})}else{let e=-1;for(let t=0;t<c.length;t++){const r=c[t];r!==e&&(e=r,o.push({minValue:e,maxValue:r,label:l(e,r,n)}),e=r)}}else if("standard-deviation"===r){const e=function(e){let t=0;for(let r=0;r<e.length;r++)t+=e[r];return t/=e.length,t}(c),t=function(e,t){let r=0;for(let n=0;n<e.length;n++){const i=e[n];r+=(i-t)*(i-t)}return r/=e.length,Math.sqrt(r)}(c,e);if(0===t)o.push({minValue:c[0],maxValue:c[0],label:l(c[0],c[0],n)});else{const r=function(e,t,r,n,i){let s=Math.max(n-e,t-n)/i/r;return s=s>=1?1:s>=.5?.5:.25,s}(d,h,a,e,t)*t;let i=0,u=d;for(let t=a;t>=1;t--){const a=s(e-(t-.5)*r,6);o.push({minValue:u,maxValue:a,label:l(u,a,n)}),u=a,i++}let c=s(e+.5*r,6);o.push({minValue:u,maxValue:c,label:l(u,c,n)}),u=c,i++;for(let t=1;t<=a;t++)c=i===2*a?h:s(e+(t+.5)*r,6),o.push({minValue:u,maxValue:c,label:l(u,c,n)}),u=c,i++}}else if("defined-interval"===r){if(!i)return o;const e=c[0],t=c[c.length-1],r=Math.ceil((t-e)/i);let a=e;for(let t=1;t<r;t++){const r=s(e+t*i,6);o.push({minValue:a,maxValue:r,label:l(a,r,n)}),a=r}o.push({minValue:a,maxValue:t,label:l(a,t,n)})}return o}function l(e,t,r){let n=null;return n=e===t?r&&"percent-of-total"===r?e+"%":e.toString():r&&"percent-of-total"===r?e+"% - "+t+"%":e+" - "+t,n}function u(e,t,r){const n=e.length,i=[];r>n&&(r=n);for(let e=0;e<r;e++)i.push(Math.round(e*n/r-1));i.push(n-1);let s=c(i,e,t,r);return function(e,t,r,n,i,s){let a=0,o=0,l=0,u=0,c=!0;for(let h=0;h<2&&c;h++){0===h&&(c=!1);for(let h=0;h<s-1;h++)for(;r[h+1]+1!==r[h+2];){r[h+1]=r[h+1]+1;const s=d(h,r,n,i);l=s.sbMean,a=s.sbSdcm;const p=d(h+1,r,n,i);if(u=p.sbMean,o=p.sbSdcm,!(a+o<t[h]+t[h+1])){r[h+1]=r[h+1]-1;break}t[h]=a,t[h+1]=o,e[h]=l,e[h+1]=u,c=!0}for(let h=s-1;h>0;h--)for(;r[h]!==r[h-1]+1;){r[h]=r[h]-1;const s=d(h-1,r,n,i);l=s.sbMean,a=s.sbSdcm;const p=d(h,r,n,i);if(u=p.sbMean,o=p.sbSdcm,!(a+o<t[h-1]+t[h])){r[h]=r[h]+1;break}t[h-1]=a,t[h]=o,e[h-1]=l,e[h]=u,c=!0}}return c}(s.mean,s.sdcm,i,e,t,r)&&(s=c(i,e,t,r)),i}function c(e,t,r,n){let i=[],s=[],a=[],o=0;const l=[],u=[];for(let i=0;i<n;i++){const n=d(i,e,t,r);l.push(n.sbMean),u.push(n.sbSdcm),o+=u[i]}let c,h=o,p=!0;for(;p||o<h;){p=!1,i=[];for(let t=0;t<n;t++)i.push(e[t]);for(let r=0;r<n;r++)for(let i=e[r]+1;i<=e[r+1];i++)if(c=t[i],r>0&&i!==e[r+1]&&Math.abs(c-l[r])>Math.abs(c-l[r-1]))e[r]=i;else if(r<n-1&&e[r]!==i-1&&Math.abs(c-l[r])>Math.abs(c-l[r+1])){e[r+1]=i-1;break}h=o,o=0,s=[],a=[];for(let i=0;i<n;i++){s.push(l[i]),a.push(u[i]);const n=d(i,e,t,r);l[i]=n.sbMean,u[i]=n.sbSdcm,o+=u[i]}}if(o>h){for(let t=0;t<n;t++)e[t]=i[t],l[t]=s[t],u[t]=a[t];o=h}return{mean:l,sdcm:u}}function d(e,t,r,n){let s=0,a=0;for(let i=t[e]+1;i<=t[e+1];i++){const e=n[i];s+=r[i]*e,a+=e}a<=0&&i().warn("Exception in Natural Breaks calculation");const o=s/a;let l=0;for(let i=t[e]+1;i<=t[e+1];i++)l+=n[i]*(r[i]-o)**2;return{sbMean:o,sbSdcm:l}}},39397:function(e,t,r){r.d(t,{Dl:function(){return a},jV:function(){return s},lF:function(){return o}}),r(25591),r(7156);var n=r(21609),i=r(90683);function s(e,t){return t?{...t,query:{...e??{},...t.query}}:{query:e}}function a(e){return"string"==typeof e?(0,i.An)(e):(0,n.o8)(e)}function o(e,t,r){const n={};for(const i in e){if("declaredClass"===i)continue;const s=e[i];if(null!=s&&"function"!=typeof s)if(Array.isArray(s))n[i]=s.map((e=>o(e)));else if("object"==typeof s)if(s.toJSON){const e=s.toJSON(r?.[i]);n[i]=t?e:JSON.stringify(e)}else n[i]=t?s:JSON.stringify(s);else n[i]=s}return n}r(48893)},92586:function(e,t,r){r.d(t,{$r:function(){return y},Jc:function(){return _},gV:function(){return g},rb:function(){return v}}),r(50917),r(39819);var n=r(13520),i=r(45139),s=r(57165),a=r(87280),o=r(57652),l=r(53743),u=r(70181),c=r(33118),d=r(66164),h=r(54547),p=r(45532);let f=null;const m=/^(?<hh>([0-1][0-9])|([2][0-3])):(?<mm>[0-5][0-9])(:(?<ss>[0-5][0-9]))?([.](?<ms>\d+))?$/;function y(e,t,r,n){const i=(0,o.d9)(r)?(0,o.Vp)(r):null,s=i?Math.round((i.valid[1]-i.valid[0])/t.scale[0]):null;return e.map((e=>{const r=new p.default(e.geometry);return(0,a.Gy)(t,r,r),e.geometry=i?function(e,t,r){return e.x<0?e.x+=t:e.x>r&&(e.x-=t),e}(r,s??0,n[0]):r,e}))}function g(e,t=18,r,i,s){const a=new Float64Array(i*s);t=Math.round((0,n.Lz)(t));let o=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY;const c=(0,u.YW)(r);for(const{geometry:r,attributes:n}of e){const{x:e,y:d}=r,h=Math.max(0,e-t),p=Math.max(0,d-t),f=Math.min(s,d+t),m=Math.min(i,e+t),y=+c(n);for(let r=p;r<f;r++)for(let n=h;n<m;n++){const s=r*i+n,c=(0,u.hv)(n-e,r-d,t)*y,h=a[s]+=c;o=Math.min(o,h),l=Math.max(l,h)}}return{min:o,max:l}}function v(e){const t=m.exec(e);if(!t)return null;const{hh:r,mm:n,ss:s,ms:a}=t.groups;return Number(r)*i.vf.hours+Number(n)*i.vf.minutes+Number(s)*i.vf.seconds+Number(a||0)}async function _(e,t,r=!0){if(!t)return[];const{field:n,field2:i,field3:a,fieldDelimiter:o,fieldInfos:u,timeZone:p}=e,m=n&&u?.find((e=>e.name.toLowerCase()===n.toLowerCase())),y=!!m&&(0,l.OH)(m),g=!!m&&(0,c.fs)(m),_=e.valueExpression,w=e.normalizationType,b=e.normalizationField,T=e.normalizationTotal,S=[],I=e.viewInfoParams;let x=null,M=null;if(_){if(!f){const{arcadeUtils:e}=await(0,h.lw)();f=e}f.hasGeometryOperations(_)&&await f.enableGeometryOperations(),x=f.createFunction(_),M=I?f.getViewInfo({viewingMode:I.viewingMode,scale:I.scale,spatialReference:new s.A(I.spatialReference)}):null}const F=e.fieldInfos,L=t[0]&&"declaredClass"in t[0]&&"esri.Graphic"===t[0].declaredClass||!F?null:{fields:F};return t.forEach((e=>{const t=e.attributes;let s;if(_){const t=L?{...e,layer:L}:e,r=f.createExecContext(t,M,p);s=f.executeFunction(x,r)}else t&&(s=t[n],i?(s=`${(0,d.gJ)(s)}${o}${(0,d.gJ)(t[i])}`,a&&(s=`${s}${o}${(0,d.gJ)(t[a])}`)):"string"==typeof s&&r&&(g?s=s?new Date(s).getTime():null:y&&(s=s?v(s):null)));if(w&&"number"==typeof s&&isFinite(s)){const e=t&&parseFloat(t[b]);s=(0,d.zS)(s,w,e,T)}S.push(s)})),S}},33118:function(e,t,r){r.d(t,{fs:function(){return a},i0:function(){return o}});var n=r(8289),i=r(53743),s=(r(54547),r(51107),r(21168));function a(e){return(0,i.vE)(e)||(0,i.zD)(e)||(0,i.Ah)(e)}function o(e,t){const{format:r,timeZoneOptions:i,fieldType:a}=t??{};let o,l;if(i&&({timeZone:o,timeZoneName:l}=(0,s.hv)(i.layerTimeZone,i.datesInUnknownTimezone,i.viewTimeZone,(0,n.J2)(r||"short-date-short-time"),a)),"string"==typeof e&&isNaN(Date.parse("time-only"===a?`1970-01-01T${e}Z`:e)))return e;switch(a){case"date-only":{const t=(0,n.J2)(r||"short-date");return"string"==typeof e?(0,n.iS)(e,{...t}):(0,n.Yq)(e,{...t,timeZone:s.n$})}case"time-only":{const t=(0,n.J2)(r||"short-time");return"string"==typeof e?(0,n.F8)(e,t):(0,n.Yq)(e,{...t,timeZone:s.n$})}case"timestamp-offset":{if(!o&&"string"==typeof e&&new Date(e).toISOString()!==e)return e;const t=r||i?(0,n.J2)(r||"short-date-short-time"):void 0,s=t?{...t,timeZone:o,timeZoneName:l}:void 0;return"string"==typeof e?(0,n.Ey)(e,s):(0,n.Yq)(e,s)}default:{const t=r||i?(0,n.J2)(r||"short-date-short-time"):void 0;return(0,n.Yq)("string"==typeof e?new Date(e):e,t?{...t,timeZone:o,timeZoneName:l}:void 0)}}}new Set(["integer","small-integer"])},66164:function(e,t,r){r.d(t,{$y:function(){return z},FM:function(){return _},G_:function(){return g},Rw:function(){return P},Vb:function(){return m},b3:function(){return C},gJ:function(){return f},jM:function(){return Z},lv:function(){return k},oZ:function(){return N},qg:function(){return v},z9:function(){return y},zS:function(){return D}});var n=r(74373),i=r(49241);const s="<Null>",a="equal-interval",o=1,l=5,u=10,c=/\s*(\+|-)?((\d+(\.\d+)?)|(\.\d+))\s*/gi,d=new Set(["esriFieldTypeDate","esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong","esriFieldTypeOID","esriFieldTypeBigInteger"]),h=new Set(["esriFieldTypeTimeOnly","esriFieldTypeDateOnly"]),p=["min","max","avg","stddev","count","sum","variance","nullcount","median"];function f(e){return null==e||"string"==typeof e&&!e?s:e}function m(e){const t=null!=e.normalizationField||null!=e.normalizationType,r=null!=e.minValue||null!=e.maxValue,n=!!e.sqlExpression&&e.supportsSQLExpression;return!t&&!r&&!n}function y(e){const{outStatisticTypes:t}=e,r=e.returnDistinct?[...new Set(e.values)]:e.values,n=r.filter((e=>null!=e)).sort(),i=n.length,s={count:i,min:n[0],max:n[i-1]};return e.supportsNullCount&&(s.nullcount=r.length-i),!e.percentileParams||t?.include?.length&&!t.include.includes("median")||t?.exclude?.length&&t.exclude.includes("median")||(s.median=v(r,e.percentileParams)),s}function g(e){const{values:t,useSampleStdDev:r,supportsNullCount:n,outStatisticTypes:i}=e;let s=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,o=null,l=null,u=null,c=null,d=0;const h=null==e.minValue?-1/0:e.minValue,p=null==e.maxValue?1/0:e.maxValue;for(const e of t)Number.isFinite(e)?e>=h&&e<=p&&(o=null===o?e:o+e,s=Math.min(s,e),a=Math.max(a,e),d++):"string"==typeof e&&d++;if(d&&null!=o){l=o/d;let e=0;for(const r of t)Number.isFinite(r)&&r>=h&&r<=p&&(e+=(r-l)**2);c=r?d>1?e/(d-1):0:d>0?e/d:0,u=Math.sqrt(c)}else s=null,a=null;const f={avg:l,count:d,max:a,min:s,stddev:u,sum:o,variance:c};return n&&(f.nullcount=t.length-d),!e.percentileParams||i?.include?.length&&!i.include.includes("median")||i?.exclude?.length&&i.exclude.includes("median")||(f.median=v(t,e.percentileParams)),f}function v(e,t){const{fieldType:r,value:n,orderBy:i,isDiscrete:s}=t,a=_(r,"desc"===i);if(0===(e=[...e].filter((e=>null!=e)).sort(((e,t)=>a(e,t)))).length)return null;if(n<=0)return e[0];if(n>=1)return e[e.length-1];const o=(e.length-1)*n,l=Math.floor(o),u=l+1,c=o%1,d=e[l],h=e[u];return u>=e.length||s||"string"==typeof d||"string"==typeof h?d:d*(1-c)+h*c}function _(e,t){if(e){if(d.has(e))return A(t);if(h.has(e))return F(t,!1);if("esriFieldTypeTimestampOffset"===e)return function(e){return e?I:S}(t);const r=F(t,!0);if("esriFieldTypeString"===e)return r;if("esriFieldTypeGUID"===e||"esriFieldTypeGlobalID"===e)return(e,t)=>r(R(e),R(t))}const r=t?1:-1,n=A(t),i=F(t,!0),s=T(t);return(e,t)=>"number"==typeof e&&"number"==typeof t?n(e,t):"string"==typeof e&&"string"==typeof t?i(e,t):s(e,t)??r}const w=(e,t)=>null==e?null==t?0:1:null==t?-1:null,b=(e,t)=>null==e?null==t?0:-1:null==t?1:null;function T(e){return e?w:b}const S=(e,t)=>b(e,t)??(e===t?0:new Date(e).getTime()-new Date(t).getTime()),I=(e,t)=>w(e,t)??(e===t?0:new Date(t).getTime()-new Date(e).getTime()),x=(e,t)=>b(e,t)??(e===t?0:e<t?-1:1),M=(e,t)=>w(e,t)??(e===t?0:e<t?1:-1);function F(e,t){if(!t)return e?M:x;const r=T(e);return e?(e,t)=>{const n=r(e,t);return null!=n?n:(e=e.toUpperCase())>(t=t.toUpperCase())?-1:e<t?1:0}:(e,t)=>{const n=r(e,t);return null!=n?n:(e=e.toUpperCase())<(t=t.toUpperCase())?-1:e>t?1:0}}const L=(e,t)=>w(e,t)??t-e,E=(e,t)=>b(e,t)??e-t;function A(e){return e?L:E}function R(e){return e.slice(24,36)+e.slice(19,23)+e.slice(16,18)+e.slice(14,16)+e.slice(11,13)+e.slice(9,11)+e.slice(6,8)+e.slice(4,6)+e.slice(2,4)+e.slice(0,2)}function N(e,t,r){let n;for(n in e)t?.include?.length&&!t.include.includes(n)||t?.exclude?.length&&t.exclude.includes(n)?delete e[n]:p.includes(n)&&(Number.isFinite(e[n])||(e[n]=null));return r?(["avg","stddev","variance"].forEach((t=>{null!=e[t]&&(e[t]=Math.ceil(e[t]??0))})),e):e}function C(e){const t={};for(let r of e)(null==r||"string"==typeof r&&""===r.trim())&&(r=null),null==t[r]?t[r]={count:1,data:r}:t[r].count++;return{count:t}}function O(e){return"coded-value"!==e?.type?[]:e.codedValues.map((e=>e.code))}function k(e,t,r,n){const i=e.count,s=[];if(r&&t){const e=[],r=O(t[0]);for(const i of r)if(t[1]){const r=O(t[1]);for(const s of r)if(t[2]){const r=O(t[2]);for(const t of r)e.push(`${f(i)}${n}${f(s)}${n}${f(t)}`)}else e.push(`${f(i)}${n}${f(s)}`)}else e.push(i);for(const t of e)i.hasOwnProperty(t)||(i[t]={data:t,count:0})}for(const e in i){const t=i[e];s.push({value:t.data,count:t.count,label:t.label})}return{uniqueValueInfos:s}}function D(e,t,r,n){let i=null;switch(t){case"log":0!==e&&(i=Math.log(e)*Math.LOG10E);break;case"percent-of-total":Number.isFinite(n)&&0!==n&&(i=e/n*100);break;case"field":Number.isFinite(r)&&0!==r&&(i=e/r);break;case"natural-log":e>0&&(i=Math.log(e));break;case"square-root":e>0&&(i=e**.5)}return i}function P(e,t){const r=U({field:t.field,normalizationType:t.normalizationType,normalizationField:t.normalizationField,classificationMethod:t.classificationMethod,standardDeviationInterval:t.standardDeviationInterval,breakCount:t.numClasses||l});return e=function(e,t,r){const n=t??-1/0,i=r??1/0;return e.filter((e=>Number.isFinite(e)&&e>=n&&e<=i))}(e,t.minValue,t.maxValue),(0,i.t)({definition:r,values:e,normalizationTotal:t.normalizationTotal})}function U(e){const{breakCount:t,field:r,normalizationField:i,normalizationType:s}=e,l=e.classificationMethod||a,u="standard-deviation"===l?e.standardDeviationInterval||o:void 0,c="defined-interval"===l?e.definedInterval:void 0;return new n.A({breakCount:t,classificationField:r,classificationMethod:l,normalizationField:"field"===s?i:void 0,normalizationType:s,standardDeviationInterval:u,definedInterval:c})}function Z(e,t){let r=e.classBreaks;const n=r.length,i=r[0]?.minValue,s=r[n-1]?.maxValue,a="standard-deviation"===t,o=c;return r=r.map((e=>{const t=e.label,r={minValue:e.minValue,maxValue:e.maxValue,label:t};if(a&&t){const e=t.match(o),n=e?.map((e=>+e.trim()))??[];2===n.length?(r.minStdDev=n[0],r.maxStdDev=n[1],n[0]<0&&n[1]>0&&(r.hasAvg=!0)):1===n.length&&(t.includes("<")?(r.minStdDev=null,r.maxStdDev=n[0]):t.includes(">")&&(r.minStdDev=n[0],r.maxStdDev=null))}return r})),{minValue:i,maxValue:s,classBreakInfos:r,normalizationTotal:e.normalizationTotal}}function z(e,t){const r=V(e,t);if(null==r.min&&null==r.max)return{bins:[],minValue:r.min,maxValue:r.max,normalizationTotal:t.normalizationTotal};const n=r.intervals,i=r.min??0,s=r.max??0,a=n.map(((e,t)=>({minValue:n[t][0],maxValue:n[t][1],count:0})));for(const t of e)if(null!=t&&t>=i&&t<=s){const e=G(n,t);e>-1&&a[e].count++}return{bins:a,minValue:i,maxValue:s,normalizationTotal:t.normalizationTotal}}function V(e,t){const{field:r,classificationMethod:n,standardDeviationInterval:i,normalizationType:s,normalizationField:a,normalizationTotal:o,minValue:l,maxValue:c}=t,d=t.numBins||u;let h=null,p=null,f=null;if(n&&"equal-interval"!==n||s){const{classBreaks:t}=P(e,{field:r,normalizationType:s,normalizationField:a,normalizationTotal:o,classificationMethod:n,standardDeviationInterval:i,minValue:l,maxValue:c,numClasses:d});h=t[0].minValue,p=t[t.length-1].maxValue,f=t.map((e=>[e.minValue,e.maxValue]))}else{if(null!=l&&null!=c)h=l,p=c;else{const t=g({values:e,minValue:l,maxValue:c,useSampleStdDev:!s,supportsNullCount:m({normalizationType:s,normalizationField:a,minValue:l,maxValue:c})});h=t.min??null,p=t.max??null}f=function(e,t,r){const n=(t-e)/r,i=[];let s,a=e;for(let e=1;e<=r;e++)s=a+n,s=Number(s.toFixed(16)),i.push([a,e===r?t:s]),a=s;return i}(h??0,p??0,d)}return{min:h,max:p,intervals:f}}function G(e,t){let r=-1;for(let n=e.length-1;n>=0;n--)if(t>=e[n][0]){r=n;break}return r}},11876:function(e,t,r){r.d(t,{H:function(){return a},q:function(){return s}});var n=r(53216),i=r(38225);async function s(e){if(!e)return;const t=e.includes("-vector")?e.slice(0,e.indexOf("-vector")):e.includes("-3d")?e.slice(0,e.indexOf("-3d")):e,r=await(0,i.ud)("esri/t9n/basemaps");return r[e]||r[t]}const a={satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return(0,n.s)("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return(0,n.s)("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return(0,n.s)("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return(0,n.s)("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return(0,n.s)("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return(0,n.s)("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get"dark-gray"(){return{...this["dark-gray-vector"],id:"dark-gray"}},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return(0,n.s)("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get gray(){return{...this["gray-vector"],id:"gray"}},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return(0,n.s)("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},get streets(){return{...this["streets-vector"],id:"streets"}},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return(0,n.s)("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},get topo(){return{...this["topo-vector"],id:"topo"}},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return(0,n.s)("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return(0,n.s)("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return(0,n.s)("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"topo-3d":{id:"topo-3d",is3d:!0,get thumbnailUrl(){return(0,n.s)("esri/images/basemap/topo-3d.png")},baseMapLayers:[{id:"topo-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/1e7d1784d1ef4b79ba6764d0bd6c3150/resources/styles/root.json",layerType:"VectorTileLayer",title:"Topographic",visibility:!0,opacity:1},{id:"topo-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-3d":{id:"navigation-3d",is3d:!0,get thumbnailUrl(){return(0,n.s)("esri/images/basemap/navigation-3d.jpg")},baseMapLayers:[{id:"navigation-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/ccc904ff872b4144b94934e55e32784b/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation",visibility:!0,opacity:1},{id:"navigation-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"streets-3d":{id:"streets-3d",is3d:!0,get thumbnailUrl(){return(0,n.s)("esri/images/basemap/streets-3d.png")},baseMapLayers:[{id:"streets-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/198298c4c64c4cb19de5b46aa00c198d/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"streets-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"streets-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"osm-3d":{id:"osm-3d",is3d:!0,get thumbnailUrl(){return(0,n.s)("esri/images/basemap/osm-3d.png")},baseMapLayers:[{id:"osm-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/8628d259c9d14bdc848771c23c513940/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap",visibility:!0,opacity:1},{id:"osm-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"gray-3d":{id:"gray-3d",is3d:!0,get thumbnailUrl(){return(0,n.s)("esri/images/basemap/gray-3d.png")},baseMapLayers:[{id:"gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/01a14b466345455ba4176d2e6390db92/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-dark-3d":{id:"navigation-dark-3d",itemId:"5a1365328b4943f09a54cf5fd1205707",is3d:!0,baseMapLayers:[{id:"navigation-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/451a1777ab3f4bf095fae24a117439d9/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation Dark"},{id:"navigation-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"streets-dark-3d":{id:"streets-dark-3d",itemId:"8a4efa2c20484ec9b4557895e65736ff",is3d:!0,baseMapLayers:[{id:"streets-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/bc599b6d741a4ac084b7eea7bf8c5938/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Streets Night (for 3D)"},{id:"streets-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"streets-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"dark-gray-3d":{id:"dark-gray-3d",itemId:"a8b7322a5fe94002bb0f5e0eeb0c5c18",is3d:!0,baseMapLayers:[{id:"dark-gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/4178f71acb934fb89f169e7d667c20c6/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Dark Gray Canvas (for 3D)"},{id:"dark-gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"dark-gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"arcgis-imagery":{get thumbnailUrl(){return(0,n.s)("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return(0,n.s)("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return(0,n.s)("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return(0,n.s)("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return(0,n.s)("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return(0,n.s)("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return(0,n.s)("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return(0,n.s)("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},"arcgis-topographic":{get thumbnailUrl(){return(0,n.s)("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return(0,n.s)("esri/images/basemap/oceans.jpg")},title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]},"arcgis-human-geography":{title:"Human Geography",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Base",title:"Human Geography Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Detail",title:"Human Geography Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Label",title:"Human Geography Label",isReference:!0}]},"arcgis-human-geography-dark":{title:"Human Geography (Dark)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Base",title:"Human Geography Dark Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Detail",title:"Human Geography Dark Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Label",title:"Human Geography Dark Label",isReference:!0}]}}},51107:function(e,t,r){r.d(t,{VC:function(){return c},dp:function(){return h},jj:function(){return d},ns:function(){return p}});var n=r(74756),i=r(25591),s=(r(78879),r(40633)),a=r(95929),o=(r(90683),r(67888)),l=(r(25128),r(11876));const u=()=>s.A.getLogger("esri.support.basemapUtils");function c(){return{}}function d(e){for(const t in e){const r=e[t];(0,a.pR)(r),delete e[t]}}function h(e,t){let r;if("string"==typeof e){const s=e in l.H,a=!s&&e.includes("/");if(!s&&!a){if(i.default.apiKey)u().warn(`Unable to find basemap definition for: ${e}. See available styles at https://developers.arcgis.com/rest/basemap-styles/`);else{const t=Object.entries(l.H).filter((([e,t])=>t.classic||t.is3d)).map((([e])=>`"${e}"`)).sort().join(", ");u().warn(`Unable to find basemap definition for: ${e}. Try one of these: ${t}`)}return null}t&&(r=t[e]),r||(r=s?n.default.fromId(e):new n.default({style:{id:e}}),t&&(t[e]=r))}else r=(0,o.dp)(n.default,e);return r?.destroyed&&(u().warn("The provided basemap is already destroyed",{basemap:r}),r=null),r}function p(e,t){return e.basemap?.referenceLayers?.some((e=>e.uid===t))||e.basemap?.baseLayers?.some((e=>e.uid===t))}},66038:function(e,t,r){r.r(t),r.d(t,{default:function(){return te}});var n,i=r(53804),s=(r(50917),r(48996)),a=r(60539),o=r(28181),l=r(23502),u=(r(58941),r(40633)),c=(r(13798),r(65953)),d=r(20248),h=r(57165),p=r(34794),f=r(75707),m=r(76226),y=r(7926),g=r(6422),v=r(71308),_=r(94139),w=r(22878),b=r(83525),T=r(50659),S=r(77472),I=r(17660),x=r(66110),M=r(91484),F=r(87416),L=r(58081),E=r(93389),A=r(38519),R=r(90066);class N{constructor(e,t){this.data=e,this.resolution=t,this.state={type:n.CREATED},this.alive=!0}process(e){switch(this.state.type){case n.CREATED:return this.state=this._gotoFetchCount(this.state,e),this.state.task.promise.then(e.resume,e.resume);case n.FETCH_COUNT:break;case n.FETCHED_COUNT:return this.state=this._gotoFetchFeatures(this.state,e),this.state.task.promise.then(e.resume,e.resume);case n.FETCH_FEATURES:break;case n.FETCHED_FEATURES:this.state=this._goToDone(this.state,e);case n.DONE:}return null}get debugInfo(){return{data:this.data,featureCount:this._featureCount,state:this._stateToString}}get _featureCount(){switch(this.state.type){case n.CREATED:case n.FETCH_COUNT:return 0;case n.FETCHED_COUNT:return this.state.featureCount;case n.FETCH_FEATURES:return this.state.previous.featureCount;case n.FETCHED_FEATURES:return this.state.features.length;case n.DONE:return this.state.previous.features.length}}get _stateToString(){switch(this.state.type){case n.CREATED:return"created";case n.FETCH_COUNT:return"fetch-count";case n.FETCHED_COUNT:return"fetched-count";case n.FETCH_FEATURES:return"fetch-features";case n.FETCHED_FEATURES:return"fetched-features";case n.DONE:return"done"}}_gotoFetchCount(e,t){return{type:n.FETCH_COUNT,previous:e,task:(0,S.UT)((async e=>{const r=await(0,S.DZ)(t.fetchCount(this,e));this.state.type===n.FETCH_COUNT&&(this.state=function(e,t){return{type:n.FETCHED_COUNT,featureCount:t,previous:e}}(this.state,r.ok?r.value:1/0))}))}}_gotoFetchFeatures(e,t){return{type:n.FETCH_FEATURES,previous:e,task:(0,S.UT)((async r=>{const i=await(0,S.DZ)(t.fetchFeatures(this,e.featureCount,r));this.state.type===n.FETCH_FEATURES&&(this.state=function(e,t){return{type:n.FETCHED_FEATURES,previous:e,features:t}}(this.state,i.ok?i.value:[]))}))}}_goToDone(e,t){return t.finish(this,e.features),{type:n.DONE,previous:e}}reset(){const e=this.state;switch(this.state={type:n.CREATED},e.type){case n.CREATED:case n.FETCHED_COUNT:case n.FETCHED_FEATURES:case n.DONE:break;case n.FETCH_COUNT:case n.FETCH_FEATURES:e.task.abort()}}intersects(e){return null==e||!this.data.extent||((0,F.VY)(e,C),(0,F.HY)(this.data.extent,C))}}!function(e){e[e.CREATED=0]="CREATED",e[e.FETCH_COUNT=1]="FETCH_COUNT",e[e.FETCHED_COUNT=2]="FETCHED_COUNT",e[e.FETCH_FEATURES=3]="FETCH_FEATURES",e[e.FETCHED_FEATURES=4]="FETCHED_FEATURES",e[e.DONE=5]="DONE"}(n||(n={}));const C=(0,F.vt)();let O=class extends b.A{get _minimumVerticesPerFeature(){switch(this.store?.featureStore.geometryType){case"esriGeometryPoint":case"esriGeometryMultipoint":return 1;case"esriGeometryPolygon":return 4;case"esriGeometryPolyline":return 2}}get _mandatoryOutFields(){const e=new Set;return this.objectIdField&&e.add(this.objectIdField),this.globalIdField&&e.add(this.globalIdField),e}set outFields(e){const t=this._get("outFields"),r=(0,I.KC)(e,this._mandatoryOutFields);(0,I.aI)(r,t)||(this._set("outFields",r),(0,I.Yy)(r,t)||this.refresh())}get outFields(){return this._get("outFields")??this._mandatoryOutFields}set filter(e){const t=this._get("filter"),r=this._filterProperties(e);JSON.stringify(t)!==JSON.stringify(r)&&this._set("filter",r)}set customParameters(e){const t=this._get("customParameters");JSON.stringify(t)!==JSON.stringify(e)&&this._set("customParameters",e)}get _configuration(){return{filter:this.filter,customParameters:this.customParameters,tileInfo:this.tileInfo,tileSize:this.tileSize}}set tileInfo(e){const t=this._get("tileInfo");t!==e&&(null!=e&&null!=t&&JSON.stringify(e)===JSON.stringify(t)||(this._set("tileInfo",e),this.store.tileInfo=e))}set tileSize(e){this._get("tileSize")!==e&&this._set("tileSize",e)}get updating(){return this._updatingHandles.updating}get hasZ(){return this.store.featureStore.hasZ}constructor(e){super(e),this.suspended=!0,this._historicMoment=null,this.tilesOfInterest=[],this.availability=0,this._pendingTiles=new Map,this._updatingHandles=new d.U}initialize(){this._initializeFetchExtent(),this._updatingHandles.add((()=>this._configuration),(()=>this.refresh())),this._updatingHandles.add((()=>this.tilesOfInterest),((e,t)=>{(0,T.aI)(e,t,(({id:e},{id:t})=>e===t))||this._process()}),o.OH),this.addHandles((0,o.when)((()=>!this.suspended),(()=>this._process())))}destroy(){this._pendingTiles.forEach((e=>this._deletePendingTile(e))),this._pendingTiles.clear(),this.store.destroy(),this.tilesOfInterest.length=0,this._updatingHandles.destroy()}refresh(){this.store.refresh(),this._pendingTiles.forEach((e=>this._deletePendingTile(e))),this._process()}async handleEdits(e){if(e.historicMoment&&(this._historicMoment=e.historicMoment),!e.addedFeatures.length&&!e.updatedFeatures.length&&!e.deletedFeatures.length)return;for(const e of this._pendingTiles.values())e.reset();const t={...e,deletedFeatures:e.deletedFeatures.map((({objectId:e,globalId:t})=>e&&-1!==e?e:this._lookupObjectIdByGlobalId(t)))},r=(0,S.UT)((async e=>{try{await this.store.processEdits(t,((e,t)=>this._queryFeaturesById(e,t)),e),this._processPendingTiles()}catch(e){(0,a.QP)(e),u.A.getLogger(this).warn("Failed to apply edits",e)}}));this.addHandles(r),await this._updatingHandles.addPromise(r.promise)}setHistoricMoment(e){e?.getTime()!==this._historicMoment?.getTime()&&(this._historicMoment=e,this.refresh())}_initializeFetchExtent(){if(!this.capabilities.query.supportsExtent||!(0,E.Wo)(this.url))return;const e=(0,S.UT)((async e=>{try{const t=await(0,R.Jf)(this.url,new y.A({where:"1=1",outSpatialReference:this.spatialReference,cacheHint:this.capabilities.query.supportsCacheHint??void 0}),{query:this._configuration.customParameters,signal:e});this.store.extent=M.default.fromJSON(t.data?.extent)}catch(e){(0,a.QP)(e),u.A.getLogger(this).warn("Failed to fetch data extent",e)}}));this._updatingHandles.addPromise(e.promise.then((()=>this._process()))),this.addHandles(e)}get debugInfo(){return{numberOfFeatures:this.store.featureStore.numFeatures,tilesOfInterest:this.tilesOfInterest,pendingTiles:Array.from(this._pendingTiles.values()).map((e=>e.debugInfo)),storedTiles:this.store.debugInfo}}_process(){this._markTilesNotAlive(),this._createPendingTiles(),this._deletePendingTiles(),this._processPendingTiles()}_markTilesNotAlive(){for(const e of this._pendingTiles.values())e.alive=!1}_createPendingTiles(){if(this.suspended)return;const e=this._collectMissingTilesInfo();if(this._setAvailability(null==e?1:e.coveredArea/e.fullArea),null!=e)for(const{data:t,resolution:r}of e.missingTiles){const e=this._pendingTiles.get(t.id);e?(e.resolution=r,e.alive=!0):this._createPendingTile(t,r)}}_collectMissingTilesInfo(){let e=null;for(let t=this.tilesOfInterest.length-1;t>=0;t--){const r=this.tilesOfInterest[t],n=this.store.process(r,((e,t)=>this._verifyTileComplexity(e,t)),this.outFields);null==e?e=n:e.prepend(n)}return e}_deletePendingTiles(){for(const e of this._pendingTiles.values())e.alive||this._deletePendingTile(e)}_processPendingTiles(){const e={fetchCount:(e,t)=>this._fetchCount(e,t),fetchFeatures:(e,t,r)=>this._fetchFeatures(e,t,r),finish:(e,t)=>this._finishPendingTile(e,t),resume:()=>this._processPendingTiles()};if(this._ensureFetchAllCounts(e))for(const t of this._pendingTiles.values())this._verifyTileComplexity(this.store.getFeatureCount(t.data),t.resolution)&&this._updatingHandles.addPromise(t.process(e))}_verifyTileComplexity(e,t){return this._verifyVertexComplexity(e)&&this._verifyFeatureDensity(e,t)}_verifyVertexComplexity(e){return e*this._minimumVerticesPerFeature<P}_verifyFeatureDensity(e,t){if(null==this.tileInfo)return!1;const r=this.tileSize*t;return e*(U/(r*r))<Z}_ensureFetchAllCounts(e){let t=!0;for(const r of this._pendingTiles.values())r.state.type<n.FETCHED_COUNT&&this._updatingHandles.addPromise(r.process(e)),r.state.type<=n.FETCH_COUNT&&(t=!1);return t}_finishPendingTile(e,t){this.store.add(e.data,t),this._deletePendingTile(e),this._updateAvailability()}_updateAvailability(){const e=this._collectMissingTilesInfo();this._setAvailability(null==e?1:e.coveredArea/e.fullArea)}_setAvailability(e){this._set("availability",e)}_createPendingTile(e,t){const r=new N(e,t);return this._pendingTiles.set(e.id,r),r}_deletePendingTile(e){e.reset(),this._pendingTiles.delete(e.data.id)}async _fetchCount(e,t){return this.store.fetchCount(e.data,this.url,this._createCountQuery(e),{query:this.customParameters,timeout:D,signal:t})}async _fetchFeatures(e,t,r){let n=0;const i=[];let s=0,a=t;for(;;){const o=this._createFeaturesQuery(e),l=this._setPagingParameters(o,n,a),{features:u,exceededTransferLimit:c}=await this._queryFeatures(o,r);l&&(n+=o.num),s+=u.length;for(const e of u)i.push(e);if(a=t-s,!l||!c||a<=0)return i}}_filterProperties(e){return null==e?{where:"1=1",gdbVersion:void 0,timeExtent:void 0}:{where:e.where||"1=1",timeExtent:e.timeExtent,gdbVersion:e.gdbVersion}}_lookupObjectIdByGlobalId(e){const t=this.globalIdField,r=this.objectIdField;if(null==t)throw new Error("Expected globalIdField to be defined");let n=null;const i=e?(0,x.AG)(e):e;if(this.store.featureStore.forEach((e=>{i===(0,x.AG)(e.attributes[t])&&(n=e.objectId??e.attributes[r])})),null==n)throw new Error(`Expected to find a feature with globalId ${e}`);return n}_queryFeaturesById(e,t){const r=this._createFeaturesQuery();return r.objectIds=e,this._queryFeatures(r,t)}_queryFeatures(e,t){return this.capabilities.query.supportsFormatPBF?this._queryFeaturesPBF(e,t):this._queryFeaturesJSON(e,t)}async _queryFeaturesPBF(e,t){const{sourceSpatialReference:r}=this,{data:n}=await(0,R.IJ)(this.url,e,new A.S({sourceSpatialReference:r}),{query:this._configuration.customParameters,timeout:D,signal:t});return(0,L.eY)(n)}async _queryFeaturesJSON(e,t){const{sourceSpatialReference:r}=this,{data:n}=await(0,R.eW)(this.url,e,r,{query:this._configuration.customParameters,timeout:D,signal:t});return(0,L.q3)(n,this.objectIdField)}_createCountQuery(e){const t=this._createBaseQuery(e);return this.capabilities.query.supportsCacheHint&&(t.cacheHint=!0),t}_createFeaturesQuery(e=null){const t=this._createBaseQuery(e),r=null!=e?.data?this.store.getAttributesForTile(e?.data?.id):null,n=(0,I.KC)((0,I.iv)(this.outFields,r??new Set),this._mandatoryOutFields);return t.outFields=Array.from(n),t.returnGeometry=!0,null!=e&&(this.capabilities.query.supportsResultType?t.resultType="tile":this.capabilities.query.supportsCacheHint&&(t.cacheHint=!0)),t}_createBaseQuery(e){const t=new y.A({returnZ:this.hasZ,returnM:!1,historicMoment:this._historicMoment,geometry:null!=this.tileInfo&&null!=e?(0,F.w1)(e.data.extent,this.tileInfo.spatialReference):void 0}),r=this._configuration.filter;return null!=r&&(t.where=r.where,t.gdbVersion=r.gdbVersion,t.timeExtent=r.timeExtent),t.outSpatialReference=this.spatialReference,t}_setPagingParameters(e,t,r){if(!this.capabilities.query.supportsPagination)return!1;const{supportsMaxRecordCountFactor:n,supportsCacheHint:i,tileMaxRecordCount:s,maxRecordCount:a,supportsResultType:o}=this.capabilities.query,l=n?y.A.MAX_MAX_RECORD_COUNT_FACTOR:1,u=l*((o||i)&&s?s:a||k);return e.start=t,n?(e.maxRecordCountFactor=Math.min(l,Math.ceil(r/u)),e.num=Math.min(r,e.maxRecordCountFactor*u)):e.num=Math.min(r,u),!0}};(0,i._)([(0,l.MZ)({constructOnly:!0})],O.prototype,"url",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0})],O.prototype,"objectIdField",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0})],O.prototype,"globalIdField",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0})],O.prototype,"capabilities",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0})],O.prototype,"sourceSpatialReference",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0})],O.prototype,"spatialReference",void 0),(0,i._)([(0,l.MZ)({constructOnly:!0})],O.prototype,"store",void 0),(0,i._)([(0,l.MZ)({readOnly:!0})],O.prototype,"_minimumVerticesPerFeature",null),(0,i._)([(0,l.MZ)()],O.prototype,"_mandatoryOutFields",null),(0,i._)([(0,l.MZ)()],O.prototype,"outFields",null),(0,i._)([(0,l.MZ)()],O.prototype,"suspended",void 0),(0,i._)([(0,l.MZ)()],O.prototype,"_historicMoment",void 0),(0,i._)([(0,l.MZ)()],O.prototype,"filter",null),(0,i._)([(0,l.MZ)()],O.prototype,"customParameters",null),(0,i._)([(0,l.MZ)({readOnly:!0})],O.prototype,"_configuration",null),(0,i._)([(0,l.MZ)()],O.prototype,"tileInfo",null),(0,i._)([(0,l.MZ)()],O.prototype,"tileSize",null),(0,i._)([(0,l.MZ)()],O.prototype,"tilesOfInterest",void 0),(0,i._)([(0,l.MZ)({readOnly:!0})],O.prototype,"updating",null),(0,i._)([(0,l.MZ)({readOnly:!0})],O.prototype,"availability",void 0),(0,i._)([(0,l.MZ)()],O.prototype,"hasZ",null),O=(0,i._)([(0,c.$)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTiledFetcher")],O);const k=2e3,D=6e5,P=1e6,U=25,Z=1;var z=r(63952),V=r(69296),G=r(75623),q=r(29679);class B{constructor(){this._store=new Map,this._byteSize=0}set(e,t){this.delete(e),this._store.set(e,t),this._byteSize+=t.byteSize}delete(e){const t=this._store.get(e);return!!this._store.delete(e)&&(null!=t&&(this._byteSize-=t.byteSize),!0)}get(e){return this._used(e),this._store.get(e)}has(e){return this._used(e),this._store.has(e)}clear(){this._store.clear()}applyByteSizeLimit(e,t){for(const[r,n]of this._store){if(this._byteSize<=e)break;this.delete(r),t(n)}}values(){return this._store.values()}[Symbol.iterator](){return this._store[Symbol.iterator]()}_used(e){const t=this._store.get(e);t&&(this._store.delete(e),this._store.set(e,t))}}let j=class extends b.A{constructor(e){super(e),this.tileInfo=null,this.extent=null,this.maximumByteSize=10*V.u.MEGABYTES,this._tileBounds=new G.F,this._tiles=new B,this._refCounts=new Map,this._tileFeatureCounts=new Map,this._tmpBoundingRect=(0,F.vt)()}add(e,t){for(const e of t)this._referenceFeature(e.objectId);const r=this.featureStore.upsertMany(t),n=r.map((e=>new Set(Object.keys(e.attributes)))).reduce(((e,t)=>(0,I.E$)(e,t)),new Set(Object.keys(r[0]?.attributes??[])));this._addTileStorage(e,new Set(r.map((e=>e.objectId))),function(e){return e.reduce(((e,t)=>e+function(e){return 32+function(e){if(null==e)return 0;const t=(0,z.zd)(e.lengths,4);return 32+(0,z.zd)(e.coords,8)+t}(e.geometry)+(0,z.eY)(e.attributes)}(t)),0)}(r),n),this._tiles.applyByteSizeLimit(this.maximumByteSize,(e=>this._removeTileStorage(e)))}getAttributesForTile(e){return e?this._tiles.get(e)?.attributeKeys:null}destroy(){this.clear(),this._tileFeatureCounts.clear()}clear(){this.featureStore.clear(),this._tileBounds.clear(),this._tiles.clear(),this._refCounts.clear()}refresh(){this.clear(),this._tileFeatureCounts.clear()}processEdits(e,t,r){return this._processEditsDelete(e.deletedFeatures.concat(e.updatedFeatures)),this._processEditsRefetch(e.addedFeatures.concat(e.updatedFeatures),t,r)}_addTileStorage(e,t,r,n){const i=e.id;this._tiles.set(i,new H(e,t,r,n)),this._tileBounds.set(i,e.extent),this._tileFeatureCounts.set(i,t.size)}_remove({id:e}){const t=this._tiles.get(e);t&&this._removeTileStorage(t)}_removeTileStorage(e){const t=[];for(const r of e.objectIds)this._unreferenceFeature(r)===Q.REMOVED&&t.push(r);this.featureStore.removeManyById(t);const r=e.data.id;this._tiles.delete(r),this._tileBounds.delete(r)}_processEditsDelete(e){this.featureStore.removeManyById(e);for(const t of this._tiles.values()){for(const r of e)t.objectIds.delete(r);this._tileFeatureCounts.set(t.data.id,t.objectIds.size)}for(const t of e)this._refCounts.delete(t)}async _processEditsRefetch(e,t,r){if(!e.length)return;const n=(await t(e,r)).features,{hasZ:i,hasM:s}=this.featureStore;for(const e of n){const t=(0,L.jQ)(this._tmpBoundingRect,e.geometry,i,s);null!=t&&this._tileBounds.forEachInBounds(t,(t=>{const r=this._tiles.get(t);this.featureStore.add(e);const n=e.objectId;r.objectIds.has(n)||(r.objectIds.add(n),this._referenceFeature(n),this._tileFeatureCounts.set(r.data.id,r.objectIds.size))}))}}process(e,t=()=>!0,r){if(null==this.tileInfo||!e.extent||null!=this.extent&&!(0,F.HY)((0,F.VY)(this.extent,this._tmpBoundingRect),e.extent))return new J(e);const n=this.getAttributesForTile(e.id);if((0,I.Yy)(r,n))return new J(e);const i=this._createTileTree(e,this.tileInfo);return this._simplify(i,t,null,0,1),this._collectMissingTiles(e,i,this.tileInfo,r)}get debugInfo(){return Array.from(this._tiles.values()).map((({data:e})=>({data:e,featureCount:this._tileFeatureCounts.get(e.id)||0})))}getFeatureCount(e){return this._tileFeatureCounts.get(e.id)??0}async fetchCount(e,t,r,n){const i=this._tileFeatureCounts.get(e.id);if(null!=i)return i;const s=await(0,R.gW)(t,r,n);return this._tileFeatureCounts.set(e.id,s.data.count),s.data.count}_createTileTree(e,t){const r=new $(e.level,e.row,e.col);return t.updateTileInfo(r,m.default.ExtrapolateOptions.POWER_OF_TWO),this._tileBounds.forEachInBounds(e.extent,(n=>{const i=this._tiles.get(n)?.data;i&&function(e,t){if(!e||!t)return!1;if(e.level===t.level)return e.row===t.row&&e.col===t.col;const r=e.level<t.level,n=r?e:t,i=r?t:e,s=1<<i.level-n.level;return Math.floor(i.row/s)===n.row&&Math.floor(i.col/s)===n.col}(e,i)&&this._populateChildren(r,i,t,this._tileFeatureCounts.get(i.id)||0)})),r}_populateChildren(e,t,r,n){const i=t.level-e.level-1;if(i<0)return void(e.isLeaf=!0);const s=t.row>>i,a=t.col>>i,o=e.row<<1,l=a-(e.col<<1)+(s-o<<1),u=e.children[l];if(null!=u)this._populateChildren(u,t,r,n);else{const i=new $(e.level+1,s,a);r.updateTileInfo(i,m.default.ExtrapolateOptions.POWER_OF_TWO),e.children[l]=i,this._populateChildren(i,t,r,n)}}_simplify(e,t,r,n,i){const s=i*i;if(e.isLeaf)return t(this.getFeatureCount(e),i)?0:(this._remove(e),null!=r&&(r.children[n]=null),s);const a=i/2,o=a*a;let l=0;for(let r=0;r<e.children.length;r++){const n=e.children[r];l+=null!=n?this._simplify(n,t,e,r,a):o}return 0===l?this._mergeChildren(e):1-l/s<W&&(this._purge(e),null!=r&&(r.children[n]=null),l=s),l}_mergeChildren(e){const t=new Set;let r,n=0;this._forEachLeaf(e,(e=>{const i=this._tiles.get(e.id);if(i){r=r?(0,I.E$)(r,i.attributeKeys):new Set(i.attributeKeys),n+=i.byteSize;for(const e of i.objectIds)t.has(e)||(t.add(e),this._referenceFeature(e));this._remove(e)}})),this._addTileStorage(e,t,n,r??new Set),e.isLeaf=!0,e.children[0]=e.children[1]=e.children[2]=e.children[3]=null,this._tileFeatureCounts.set(e.id,t.size)}_forEachLeaf(e,t){for(const r of e.children)null!=r&&(r.isLeaf?t(r):this._forEachLeaf(r,t))}_purge(e){if(null!=e)if(e.isLeaf)this._remove(e);else for(let t=0;t<e.children.length;t++){const r=e.children[t];this._purge(r),e.children[t]=null}}_collectMissingTiles(e,t,r,n){const i=new Y(r,e,this.extent);return this._collectMissingTilesRecurse(t,i,1,n),i.info}_collectMissingTilesRecurse(e,t,r,n){const i=this.getAttributesForTile(e.id),s=i&&!(0,I.Yy)(n,i);if(s&&t.addMissing(e.level,e.row,e.col,r),e.isLeaf)return;if(!e.hasChildren)return void(s||t.addMissing(e.level,e.row,e.col,r));const a=r/2;for(let r=0;r<e.children.length;r++){const i=e.children[r];null==i?t.addMissing(e.level+1,(e.row<<1)+((2&r)>>1),(e.col<<1)+(1&r),a):this._collectMissingTilesRecurse(i,t,a,n)}}_referenceFeature(e){const t=(this._refCounts.get(e)||0)+1;return this._refCounts.set(e,t),1===t?Q.ADDED:Q.UNCHANGED}_unreferenceFeature(e){const t=(this._refCounts.get(e)||0)-1;return 0===t?(this._refCounts.delete(e),Q.REMOVED):(t>0&&this._refCounts.set(e,t),Q.UNCHANGED)}get test(){}};(0,i._)([(0,l.MZ)({constructOnly:!0})],j.prototype,"featureStore",void 0),(0,i._)([(0,l.MZ)()],j.prototype,"tileInfo",void 0),(0,i._)([(0,l.MZ)()],j.prototype,"extent",void 0),(0,i._)([(0,l.MZ)()],j.prototype,"maximumByteSize",void 0),j=(0,i._)([(0,c.$)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTileStore")],j);class H{constructor(e,t,r,n){this.data=e,this.objectIds=t,this.byteSize=r,this.attributeKeys=n}}class ${constructor(e,t,r){this.level=e,this.row=t,this.col=r,this.isLeaf=!1,this.extent=null,this.children=[null,null,null,null]}get hasChildren(){return!this.isLeaf&&(null!=this.children[0]||null!=this.children[1]||null!=this.children[2]||null!=this.children[3])}}class J{constructor(e,t=[]){this.missingTiles=t,this.fullArea=0,this.coveredArea=0,this.fullArea=(0,F.Wc)(e.extent),this.coveredArea=this.fullArea}prepend(e){this.missingTiles=e.missingTiles.concat(this.missingTiles),this.coveredArea+=e.coveredArea,this.fullArea+=e.fullArea}}class Y{constructor(e,t,r){this._tileInfo=e,this._extent=null,this.info=new J(t),null!=r&&(this._extent=(0,F.VY)(r))}addMissing(e,t,r,n){const i=new q.U(null,e,t,r);this._tileInfo.updateTileInfo(i,m.default.ExtrapolateOptions.POWER_OF_TWO),null==i.extent||null!=this._extent&&!(0,F.HY)(this._extent,i.extent)||(this.info.missingTiles.push({data:i,resolution:n}),this.info.coveredArea-=(0,F.Wc)(i.extent))}}const W=.18751;var Q,X;(X=Q||(Q={}))[X.ADDED=0]="ADDED",X[X.REMOVED=1]="REMOVED",X[X.UNCHANGED=2]="UNCHANGED";var K=r(74697);let ee=class extends s.A.EventedAccessor{constructor(){super(...arguments),this._isInitializing=!0,this.remoteClient=null,this._whenSetup=(0,a.Tw)(),this._elevationAligner=(0,v.n)(),this._elevationFilter=(0,_.z)(),this._symbologyCandidatesFetcher=(0,w.H)(),this._updatingHandles=new d.U,this._alignPointsInFeatures=async(e,t)=>{const r={query:e},n=await this.remoteClient.invoke("alignElevation",r,{signal:t});return(0,a.Te)(t),n},this._getSymbologyCandidates=async(e,t)=>{const r={candidates:e,spatialReference:this._spatialReference.toJSON()},n=await this.remoteClient.invoke("getSymbologyCandidates",r,{signal:t});return(0,a.Te)(t),n}}get updating(){return this._isInitializing||this._updatingHandles.updating||this._featureFetcher.updating}destroy(){this._featureFetcher?.destroy(),this._queryEngine?.destroy(),this._featureStore?.clear()}async setup(e){if(this.destroyed)return{result:{}};const{geometryType:t,objectIdField:r,timeInfo:n,fieldsIndex:i}=e.serviceInfo,{hasZ:s}=e,a=h.A.fromJSON(e.spatialReference);this._spatialReference=a,this._featureStore=new p.A({...e.serviceInfo,hasZ:s,hasM:!1}),this._queryEngine=new f.d({spatialReference:e.spatialReference,featureStore:this._featureStore,geometryType:t,fieldsIndex:i,hasZ:s,hasM:!1,objectIdField:r,timeInfo:n}),this._featureFetcher=new O({store:new j({featureStore:this._featureStore}),url:e.serviceInfo.url,objectIdField:e.serviceInfo.objectIdField,globalIdField:e.serviceInfo.globalIdField,capabilities:e.serviceInfo.capabilities,spatialReference:a,sourceSpatialReference:h.A.fromJSON(e.serviceInfo.spatialReference),customParameters:e.configuration.customParameters});const l="3d"===e.configuration.viewType;return this._elevationAligner=(0,v.n)(l,{elevationInfo:null!=e.elevationInfo?g.A.fromJSON(e.elevationInfo):null,alignPointsInFeatures:this._alignPointsInFeatures}),this._elevationFilter=(0,_.z)(l),this.addHandles([(0,o.watch)((()=>this._featureFetcher.availability),(e=>this.emit("notify-availability",{availability:e})),o.OH),(0,o.watch)((()=>this.updating),(()=>this._notifyUpdating()))]),this._whenSetup.resolve(),this._isInitializing=!1,this.configure(e.configuration)}async configure(e){return await this._updatingHandles.addPromise(this._whenSetup.promise),this._updateFeatureFetcherConfiguration(e),re}async setSuspended(e,t){return await this._updatingHandles.addPromise(this._whenSetup.promise),(0,a.Te)(t),this._featureFetcher.suspended=e,re}async updateOutFields(e,t){return await this._updatingHandles.addPromise(this._whenSetup.promise),(0,a.Te)(t),this._featureFetcher.outFields=new Set(e??[]),re}async fetchCandidates(e,t){await this._whenSetup.promise,(0,a.Te)(t);const r=function(e){if(!e.filter)return{...e,query:{where:"1=1"}};const{distance:t,units:r,spatialRel:n,where:i,timeExtent:s,objectIds:a}=e.filter,o={geometry:e.filter.geometry?(0,K.rS)(e.filter.geometry):void 0,distance:t,units:r,spatialRel:n,timeExtent:s,objectIds:a,where:i??"1=1"};return{...e,query:o}}(e),n=t?.signal,i=await this._queryEngine.executeQueryForSnapping(r,n);(0,a.Te)(n);const s=await this._elevationAligner.alignCandidates(i.candidates,h.A.fromJSON(e.point.spatialReference)??h.A.WGS84,n);(0,a.Te)(n);const o=await this._symbologyCandidatesFetcher.fetch(s,n);(0,a.Te)(n);const l=0===o.length?s:s.concat(o);return{result:{candidates:this._elevationFilter.filter(r,l)}}}async updateTiles(e,t){return await this._updatingHandles.addPromise(this._whenSetup.promise),(0,a.Te)(t),this._featureFetcher.tileSize=e.tileSize,this._featureFetcher.tilesOfInterest=e.tiles,this._featureFetcher.tileInfo=null!=e.tileInfo?m.default.fromJSON(e.tileInfo):null,re}async refresh(e,t){return await this._updatingHandles.addPromise(this._whenSetup.promise),(0,a.Te)(t),this._featureFetcher.refresh(),re}async whenNotUpdating(e,t){return await this._updatingHandles.addPromise(this._whenSetup.promise),(0,a.Te)(t),await(0,o.C_)((()=>!this.updating),t),(0,a.Te)(t),re}async getDebugInfo(e,t){return(0,a.Te)(t),{result:this._featureFetcher.debugInfo}}async handleEdits(e,t){return await this._updatingHandles.addPromise(this._whenSetup.promise),(0,a.Te)(t),await this._updatingHandles.addPromise(this._featureFetcher.handleEdits(e)),(0,a.Te)(t),re}async setHistoricMoment(e,t){return this._featureFetcher.setHistoricMoment(e.moment),re}async notifyElevationSourceChange(e,t){return this._elevationAligner.notifyElevationSourceChange(),re}async notifySymbologyChange(e,t){return this._symbologyCandidatesFetcher.notifySymbologyChange(),re}async setSymbologySnappingSupported(e){return this._symbologyCandidatesFetcher=(0,w.H)(e,this._getSymbologyCandidates),re}_updateFeatureFetcherConfiguration(e){this._featureFetcher.filter=null!=e.filter?y.A.fromJSON(e.filter):null,this._featureFetcher.customParameters=e.customParameters}_notifyUpdating(){this.emit("notify-updating",{updating:this.updating})}};(0,i._)([(0,l.MZ)({readOnly:!0})],ee.prototype,"updating",null),(0,i._)([(0,l.MZ)()],ee.prototype,"_isInitializing",void 0),ee=(0,i._)([(0,c.$)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceSnappingSourceWorker")],ee);const te=ee,re={result:{}}},71308:function(e,t,r){r.d(t,{n:function(){return l}}),r(58941);var n=r(99680),i=r(25738),s=r(60539),a=r(62938),o=r(32e3);function l(e=!1,t){if(e){const{elevationInfo:e,alignPointsInFeatures:r}=t;return new c(e,r)}return new u}class u{async alignCandidates(e,t,r){return e}notifyElevationSourceChange(){}}class c{constructor(e,t){this._elevationInfo=e,this._alignPointsInFeatures=t,this._alignmentsCache=new n.q(1024),this._cacheVersion=0}async alignCandidates(e,t,r){const n=this._elevationInfo;return null==n||"absolute-height"!==n.mode||n.featureExpressionInfo?this._alignComputedElevationCandidates(e,t,r):(function(e,t,r){const{offset:n,unit:i}=r;if(null==n)return;const s=(0,a.G9)(t),l=n*((0,o.Ao)(i??"meters")/s);for(const t of e)switch(t.type){case"edge":t.start.z+=l,t.end.z+=l;continue;case"vertex":t.target.z+=l;continue}}(e,t,n),e)}notifyElevationSourceChange(){this._alignmentsCache.clear(),this._cacheVersion++}async _alignComputedElevationCandidates(e,t,r){const n=new Map;for(const t of e)(0,i.tE)(n,t.objectId,p).push(t);const[a,o,l]=this._prepareQuery(n,t),u=await this._alignPointsInFeatures(a,r);if((0,s.Te)(r),l!==this._cacheVersion)return this._alignComputedElevationCandidates(e,t,r);this._applyCacheAndResponse(a,u,o);const{drapedObjectIds:c,failedObjectIds:d}=u,h=[];for(const t of e){const{objectId:e}=t;c.has(e)&&"edge"===t.type&&(t.draped=!0),d.has(e)||h.push(t)}return h}_prepareQuery(e,t){const r=[],n=[];for(const[t,i]of e){const e=[];for(const r of i)this._addToQueriesOrCachedResult(t,r.target,e,n),"edge"===r.type&&(this._addToQueriesOrCachedResult(t,r.start,e,n),this._addToQueriesOrCachedResult(t,r.end,e,n));0!==e.length&&r.push({objectId:t,points:e})}return[{spatialReference:t.toJSON(),pointsInFeatures:r},n,this._cacheVersion]}_addToQueriesOrCachedResult(e,t,r,n){const i=h(e,t),s=this._alignmentsCache.get(i);null==s?r.push(t):n.push(new d(t,s))}_applyCacheAndResponse(e,{elevations:t,drapedObjectIds:r,failedObjectIds:n},i){for(const e of i)e.apply();let s=0;const a=this._alignmentsCache;for(const{objectId:i,points:o}of e.pointsInFeatures){if(n.has(i)){s+=o.length;continue}const e=!r.has(i);for(const r of o){const n=h(i,r),o=t[s++];r.z=o,e&&a.put(n,o,1)}}}}class d{constructor(e,t){this.point=e,this.z=t}apply(){this.point.z=this.z}}function h(e,{x:t,y:r,z:n,spatialReference:i}){return`${e}-${t}-${r}-${n??0}}-wkid:${i?.wkid}`}function p(){return[]}},94139:function(e,t,r){r.d(t,{z:function(){return a}}),r(58941);class n{filter(e,t){return t}notifyElevationSourceChange(){}}class i{filter(e,t){const{point:r,distance:n}=e,{z:i}=r;if(null==i)return t;if(0===t.length)return t;const a=function(e){return"number"==typeof e?{x:e,y:e,z:e}:e}(n),o=this._updateCandidatesTo3D(t,r,a).filter(s);return o.sort(u),o}_updateCandidatesTo3D(e,t,r){for(const n of e)switch(n.type){case"edge":o(n,t,r);continue;case"vertex":l(n,t,r);continue}return e}}function s(e){return e.distance<=1}function a(e=!1){return e?new i:new n}function o(e,t,{x:r,y:n,z:i}){const{start:s,end:a,target:o}=e;e.draped||function(e,t,r,n){const i=n.x-r.x,s=n.y-r.y,a=n.z-r.z,o=i*i+s*s+a*a,l=(t.x-r.x)*i+(t.y-r.y)*s+a*(t.z-r.z),u=Math.min(1,Math.max(0,l/o)),c=r.x+i*u,d=r.y+s*u,h=r.z+a*u;e.x=c,e.y=d,e.z=h}(o,t,s,a);const l=(t.x-o.x)/r,u=(t.y-o.y)/n,c=(t.z-o.z)/i;e.distance=Math.sqrt(l*l+u*u+c*c)}function l(e,t,{x:r,y:n,z:i}){const{target:s}=e,a=(t.x-s.x)/r,o=(t.y-s.y)/n,l=(t.z-s.z)/i,u=Math.sqrt(a*a+o*o+l*l);e.distance=u}function u(e,t){return e.distance-t.distance}},22878:function(e,t,r){r.d(t,{H:function(){return o}}),r(58941);var n=r(21609),i=r(99680),s=r(60539),a=r(50944);function o(e=!1,t){return e?new u(t):new l}class l{async fetch(){return[]}notifySymbologyChange(){}}class u{constructor(e){this._getSymbologyCandidates=e,this._candidatesCache=new i.q(1024),this._cacheVersion=0}async fetch(e,t){if(0===e.length)return[];const r=[],i=[],a=this._candidatesCache;for(const t of e){const e=c(t),s=a.get(e);if(s)for(const e of s)i.push((0,n.o8)(e));else r.push(t),a.put(e,[],1)}if(0===r.length)return i;const o=this._cacheVersion,{candidates:l,sourceCandidateIndices:u}=await this._getSymbologyCandidates(r,t);if((0,s.Te)(t),o!==this._cacheVersion)return this.fetch(e,t);const d=[],{length:h}=l;for(let e=0;e<h;++e){const t=l[e],i=c(r[u[e]]),s=a.get(i);s.push(t),a.put(i,s,s.length),d.push((0,n.o8)(t))}return i.concat(d)}notifySymbologyChange(){this._candidatesCache.clear(),this._cacheVersion++}}function c(e){switch(e.type){case"vertex":{const{objectId:t,target:r}=e,n=`${t}-vertex-${r.x}-${r.y}-${r.z??0}`;return(0,a.Wm)(n).toString()}case"edge":{const{objectId:t,start:r,end:n}=e,i=`${t}-edge-${r.x}-${r.y}-${r.z??0}-to-${n.x}-${n.y}-${n.z??0}`;return(0,a.Wm)(i).toString()}default:return""}}},81197:function(e,t,r){var n;r.d(t,{M:function(){return n}}),function(e){e[e.ANIMATING=0]="ANIMATING",e[e.INTERACTING=1]="INTERACTING",e[e.IDLE=2]="IDLE"}(n||(n={}))},48961:function(e,t,r){r.d(t,{Bb:function(){return L},W6:function(){return n},mj:function(){return v},nu:function(){return E}});var n,i,s=r(14606),a=(r(58941),r(40633)),o=r(95929),l=r(69739),u=r(7187),c=r(60539),d=r(28181),h=r(85445),p=r(38504),f=r(47558),m=r(16164),y=r(81197),g=r(55213);function v(){return new M.Scheduler}(i=n||(n={})).RESOURCE_CONTROLLER_IMMEDIATE="immediate",i.RESOURCE_CONTROLLER="schedule",i.SLIDE="slide",i.STREAM_DATA_LOADER="stream loader",i.ELEVATION_QUERY="elevation query",i.TERRAIN_SURFACE="terrain",i.SURFACE_GEOMETRY_UPDATES="surface geometry updates",i.LOD_RENDERER="LoD renderer",i.GRAPHICS_CORE="Graphics3D",i.I3S_CONTROLLER="I3S",i.POINT_CLOUD_LAYER="point cloud",i.FEATURE_TILE_FETCHER="feature fetcher",i.OVERLAY="overlay",i.STAGE="stage",i.GRAPHICS_DECONFLICTOR="graphics deconflictor",i.FILTER_VISIBILITY="Graphics3D filter visibility",i.SCALE_VISIBILITY="Graphics3D scale visibility",i.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",i.POINT_OF_INTEREST_FREQUENT="POI frequent",i.POINT_OF_INTEREST_INFREQUENT="POI infrequent",i.LABELER="labeler",i.FEATURE_QUERY_ENGINE="feature query",i.FEATURE_TILE_TREE="feature tile tree",i.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",i.ELEVATION_ALIGNMENT="elevation alignment",i.ELEVATION_ALIGNMENT_SCENE="elevation alignment scene",i.TEXT_TEXTURE_ATLAS="text texture atlas",i.TEXTURE_UNLOAD="texture unload",i.LINE_OF_SIGHT_TOOL="line of sight tool",i.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",i.ELEVATION_PROFILE="elevation profile",i.SNAPPING="snapping",i.SHADOW_ACCUMULATOR="shadow accumulator",i.CLOUDS_GENERATOR="clouds generator",i.MAPVIEW_FETCH_QUEUE="mapview fetch queue",i.MAPVIEW_LAYERVIEW_UPDATE="mapview layerview update",i.MAPVIEW_VECTOR_TILE_PARSING_QUEUE="mapview vector tile parsing queue",i[i.NONE=0]="NONE",i[i.TEST_PRIO=1]="TEST_PRIO";const _=new Map([[n.RESOURCE_CONTROLLER_IMMEDIATE,0],[n.RESOURCE_CONTROLLER,4],[n.SLIDE,0],[n.STREAM_DATA_LOADER,0],[n.ELEVATION_QUERY,0],[n.TERRAIN_SURFACE,1],[n.SURFACE_GEOMETRY_UPDATES,1],[n.LOD_RENDERER,2],[n.GRAPHICS_CORE,2],[n.I3S_CONTROLLER,2],[n.POINT_CLOUD_LAYER,2],[n.FEATURE_TILE_FETCHER,2],[n.CLOUDS_GENERATOR,2],[n.OVERLAY,4],[n.STAGE,4],[n.GRAPHICS_DECONFLICTOR,4],[n.FILTER_VISIBILITY,4],[n.SCALE_VISIBILITY,4],[n.FRUSTUM_VISIBILITY,4],[n.POINT_OF_INTEREST_FREQUENT,6],[n.POINT_OF_INTEREST_INFREQUENT,30],[n.LABELER,8],[n.FEATURE_QUERY_ENGINE,8],[n.FEATURE_TILE_TREE,16],[n.FEATURE_TILE_TREE_ACTIVE,0],[n.ELEVATION_ALIGNMENT,12],[n.ELEVATION_ALIGNMENT_SCENE,14],[n.TEXT_TEXTURE_ATLAS,12],[n.TEXTURE_UNLOAD,12],[n.LINE_OF_SIGHT_TOOL,16],[n.LINE_OF_SIGHT_TOOL_INTERACTIVE,0],[n.SNAPPING,0],[n.SHADOW_ACCUMULATOR,30],[n.MAPVIEW_FETCH_QUEUE,0],[n.MAPVIEW_LAYERVIEW_UPDATE,2],[n.MAPVIEW_VECTOR_TILE_PARSING_QUEUE,0]]);function w(e){return _.has(e)?_.get(e):"number"==typeof e?e:1}const b=(0,p.l5)(6.5),T=(0,p.l5)(1),S=(0,p.l5)(30),I=(0,p.l5)(1e3/30),x=(0,p.l5)(100);var M,F;!function(e){e.Scheduler=class{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some((e=>e.needsUpdate))}constructor(){this._updating=(0,h.v)(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new l.A("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new r,this._state=y.M.INTERACTING,this._tasks=new u.A,this._runQueue=new u.A,this._load=0,this._idleStateCallbacks=new u.A,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=(0,d.watch)((()=>m.A.SCHEDULER_LOG_SLOW_TASKS),(e=>this._debug=e),d.Vh);for(const e of Object.keys(n))this.performanceInfo.tasks.set(n[e],new l.A(n[e]))}destroy(){this._tasks.toArray().forEach((e=>e.remove())),this._tasks.clear(),(0,o.xt)(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(e){this._updatingChanged(),e&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask((()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this.frame())})))}registerTask(e,r){const n=new t(this,e,r);return this._tasks.push(n),this._updatingChanged(),this.performanceInfo.tasks.has(e)||this.performanceInfo.tasks.set(e,new l.A(e)),n}registerIdleStateCallbacks(e,t){const r={idleBegin:e,idleEnd:t};this._idleStateCallbacks.push(r),this.state===y.M.IDLE&&this._idleUpdatesStartFired&&r.idleBegin();const n=this;return{remove:()=>this._removeIdleStateCallbacks(r),set idleBegin(e){n._idleUpdatesStartFired&&(r.idleEnd(),n._state===y.M.IDLE&&e()),r.idleBegin=e},set idleEnd(e){r.idleEnd=e}}}get load(){return this._load}set state(e){this._state!==e&&(this._state=e,this.state!==y.M.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll((e=>e.idleEnd()))))}get state(){return this._state}updateBudget(e){this._test&&(this._test.usedBudget=0),++this._frameNumber;let t=b,r=e.frameDuration,n=T;switch(this.state){case y.M.IDLE:t=(0,p.l5)(0),r=(0,p.l5)(Math.max(x,e.frameDuration)),n=S;break;case y.M.INTERACTING:r=(0,p.l5)(Math.max(I,e.frameDuration));case y.M.ANIMATING:}return r=(0,p.l5)(r-e.elapsedFrameTime-t),this.state!==y.M.IDLE&&r<T&&!this._forceTask?(this._forceTask=!0,!1):(r=(0,p.l5)(Math.max(r,n)),this._budget.reset(r,this.state),this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case y.M.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll((e=>e.idleBegin()))),this._runIdle();break;case y.M.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test&&(this._test.usedBudget=this._budget.elapsed)}stopFrame(){this._budget.reset((0,p.l5)(0),this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(e){this._idleUpdatesStartFired&&e.idleEnd(),this._idleStateCallbacks.removeUnordered(e)}removeTask(e){this._tasks.removeUnordered(e),this._runQueue.removeUnordered(e),this._updatingChanged()}_updateTask(e){this._tasks.forAll((t=>{t.name===e&&t.setPriority(e)}))}_getState(e){if(this._runQueue.some((t=>t.name===e)))return F.SCHEDULED;let t=F.IDLE;return this._tasks.forAll((r=>{r.name===e&&r.needsUpdate&&(r.schedulePriority<=1?t=F.READY:t!==F.READY&&(t=F.WAITING))})),t}_getRuntime(e){let t=0;return this._tasks.forAll((r=>{r.name===e&&(t+=r.runtime)})),t}_resetRuntimes(){this._tasks.forAll((e=>e.runtime=0))}_getRunning(){const e=new Map;if(this._tasks.forAll((t=>{t.needsUpdate&&e.set(t.name,(e.get(t.name)||0)+1)})),0===e.size)return null;let t="";return e.forEach(((e,r)=>{t+=e>1?` ${e}x ${r}`:` ${r}`})),t}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const e=this._tasks.reduce(((e,t)=>t.needsUpdate?++e:e),0);this._load=.9*this._load+e*(1-.9)}_schedule(){for(this._runQueue.filterInPlace((e=>!!e.needsUpdate||(e.schedulePriority=e.basePriority,!1))),this._tasks.forAll((e=>{0===e.basePriority&&e.needsUpdate&&!this._runQueue.includes(e)&&e.blockFrame!==this._frameNumber&&this._runQueue.unshift(e)}));0===this._runQueue.length;){let e=!1,t=0;if(this._tasks.forAll((r=>{r.needsUpdate&&0!==r.schedulePriority&&0!==r.basePriority&&r.blockFrame!==this._frameNumber&&(e=!0,t=Math.max(t,r.basePriority),1===r.schedulePriority?(r.schedulePriority=0,this._runQueue.push(r)):--r.schedulePriority)})),!e)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){const e=this._budget.now();this._startFrameTaskTimes();do{for(;this._runQueue.length>0;){const t=this._budget.now(),r=this._runQueue.pop();this._budget.resetProgress();try{r.task.runTask(this._budget)===g.G&&(r.blockFrame=this._frameNumber)}catch(e){a.A.getLogger("esri.views.support.Scheduler").error(`Exception in task "${r.name}"`,e),r.blockFrame=this._frameNumber}!this._budget.hasProgressed&&r.blockFrame!==this._frameNumber&&r.needsUpdate&&(r.name,n.I3S_CONTROLLER,r.blockFrame=this._frameNumber),r.schedulePriority=r.basePriority;const i=this._budget.now()-t;if(r.runtime+=i,this._frameTaskTimes.set(r.priority,this._frameTaskTimes.get(r.priority)+i),this._budget.remaining<=0)return this._updatingChanged(),void this._recordFrameTaskTimes(this._budget.now()-e)}}while(this._schedule());this._updatingChanged(),this._recordFrameTaskTimes(this._budget.now()-e)}_startFrameTaskTimes(){for(const e of Object.keys(n))this._frameTaskTimes.set(n[e],0)}_recordFrameTaskTimes(e){this._frameTaskTimes.forEach(((e,t)=>this.performanceInfo.tasks.get(t).push(e))),this.performanceInfo.total.push(e)}get test(){return this._test}};class t{get task(){return this._task.value}get updating(){return this._queue.running}constructor(e,t,r){this._scheduler=e,this.name=t,this.blockFrame=0,this.runtime=0,this._queue=new f.T,this._handles=new s.A,this._basePriority=w(t),this.schedulePriority=this._basePriority,this._task=(0,h.v)(null!=r?r:this._queue),this._handles.add((0,d.when)((()=>this.task.running),(t=>e.taskRunningChanged(t))))}remove(){this.processQueue(L),this._scheduler.removeTask(this),this.schedule=E.schedule,this.reschedule=E.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(e){if(this.name===e)return;this.name=e;const t=w(e);0!==this._basePriority&&0===this.schedulePriority||(this.schedulePriority=t),this._basePriority=t}get priority(){return this.name}set priority(e){this.setPriority(e)}get needsUpdate(){return this.updating||this.task.running}schedule(e,t,r){return this._queue.push(e,t,r)}reschedule(e,t,r){return this._queue.unshift(e,t,r)}processQueue(e){return this._queue.runTask(e)}}class r{constructor(){this._begin="undefined"!=typeof performance?performance.now():0,this._budget=0,this._state=y.M.IDLE,this._done=!1,this._progressed=!1,this._enabled=!0}run(e){return!this.done&&(!0===e()&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get state(){return this._state}get enabled(){return this._enabled}set enabled(e){this._enabled=e}reset(e,t){this._begin=this.now(),this._budget=e,this._state=t,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return this.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}e.Budget=r}(M||(M={})),function(e){e.SCHEDULED="s",e.READY="r",e.WAITING="w",e.IDLE="i"}(F||(F={}));const L=(()=>{const e=new M.Budget;return e.enabled=!1,e})(),E=new class{remove(){}processQueue(){}schedule(e,t,r){try{if((0,c.G4)(t)){const e=(0,c.NK)();return r?Promise.resolve(r(e)):Promise.reject(e)}return(0,c.z7)(e(L))}catch(e){return Promise.reject(e)}}reschedule(e,t,r){return this.schedule(e,t,r)}}},55213:function(e,t,r){r.d(t,{G:function(){return n}});const n=Symbol("Yield")},16164:function(e,t,r){r.d(t,{A:function(){return l}});var n=r(53804),i=r(83525),s=r(23502),a=(r(58941),r(40633),r(13798),r(65953));let o=class extends i.A{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};(0,n._)([(0,s.MZ)()],o.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),(0,n._)([(0,s.MZ)()],o.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),o=(0,n._)([(0,a.$)("esri.views.support.debugFlags")],o);const l=new o},84624:function(e,t,r){r.d(t,{CJ:function(){return h}});var n=r(39819),i=r(21609),s=r(34194),a=r(47527),o=r(11432);const l=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wms","wmts"]),u=new Set(["catalog","csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","knowledge-graph","map-image","map-notes","media","ogc-feature","oriented-imagery","route","stream","subtype-group","tile","unknown","unsupported","vector-tile","web-tile","wfs","wms","wmts"]);function c(e,t){if(t.restrictedWebMapWriting){const r=function(e){return"basemap"===e.layerContainerType?l:"operational-layers"===e.layerContainerType?u:null}(t);return null==r||r.has(e.type)&&!(0,o.Ov)(e)}return!0}function d(e,t){"maxScale"in e&&(t.maxScale=(0,a.B)(e.maxScale)??void 0),"minScale"in e&&(t.minScale=(0,a.B)(e.minScale)??void 0)}function h(e,t,r){if(!e.persistenceEnabled)return null;if(!("write"in e)||!e.write)return r?.messages&&r.messages.push(new n.A("layer:unsupported",`Layers (${e.title}, ${e.id}) of type '${e.declaredClass}' cannot be persisted`,{layer:e})),null;if((0,o.Ov)(e)&&!e.isTable)t=e.resourceInfo;else if(c(e,r)){const t={};return e.write(t,r)?t:null}return null!=t&&function(e,t){if(function(e,t){if(t)if((0,o.Ov)(e)){const r=(0,s.wc)("featureCollection.layers",t),n=r?.[0]?.layerDefinition;n&&d(e,n)}else"group"!==e.type&&d(e,t)}(e,t),t&&(t.id=e.id,"blendMode"in e&&(t.blendMode=e.blendMode,"normal"===t.blendMode&&delete t.blendMode),t.opacity=(0,a.B)(e.opacity)??void 0,t.title=e.title||"Layer",t.visibility=e.visible,"legendEnabled"in e&&"wmts"!==e.type))if((0,o.Ov)(e)){const r=t.featureCollection;r&&(r.showLegend=e.legendEnabled)}else t.showLegend=e.legendEnabled}(e,t=(0,i.o8)(t)),t}}}]);
//# sourceMappingURL=views-interactive-snapping-featureSources-featureServiceSource-FeatureServiceSnappingSourceWorker.js.map