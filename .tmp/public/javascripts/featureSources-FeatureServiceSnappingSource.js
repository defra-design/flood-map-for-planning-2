"use strict";(self.webpackChunkdefra=self.webpackChunkdefra||[]).push([[6840],{2075:function(e,t,n){n.d(t,{a:function(){return v},b:function(){return U},c:function(){return b},f:function(){return w},g:function(){return S},h:function(){return N},u:function(){return m}}),n(58941);var r=n(40633),s=n(15774),i=n(89736),o=n(73364),a=n(39714),l=n(20551),c=n(32501),u=n(87416),d=n(72485),h=n(73313),p=n(5596),f=n(79578),g=n(29531),_=n(50973);const y=()=>r.A.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");function v(e=F){return{plane:(0,p.vt)(e.plane),origin:(0,c.o8)(e.origin),basis1:(0,c.o8)(e.basis1),basis2:(0,c.o8)(e.basis2)}}function b(e,t=v()){return w(e.origin,e.basis1,e.basis2,t)}function w(e,t,n,r=v()){return(0,l.c)(r.origin,e),(0,l.c)(r.basis1,t),(0,l.c)(r.basis2,n),m(r),function(e,t){Math.abs((0,l.f)(e.basis1,e.basis2)/((0,l.l)(e.basis1)*(0,l.l)(e.basis2)))>1e-6&&y().warn(t,"Provided basis vectors are not perpendicular"),Math.abs((0,l.f)(e.basis1,T(e)))>1e-6&&y().warn(t,"Basis vectors and plane normal are not perpendicular"),Math.abs(-(0,l.f)(T(e),e.origin)-e.plane[3])>1e-6&&y().warn(t,"Plane offset is not consistent with plane origin")}(r,"fromValues()"),r}function m(e){(0,p.mR)(e.basis2,e.basis1,e.origin,e.plane)}function k(e,t,n){e!==n&&b(e,n);const r=(0,l.h)(_.rq.get(),T(e),t);return(0,l.g)(n.origin,n.origin,r),n.plane[3]-=t,n}function S(e,t=v()){const n=(e[2]-e[0])/2,r=(e[3]-e[1])/2;return(0,l.i)(t.origin,e[0]+n,e[1]+r,0),(0,l.i)(t.basis1,n,0,0),(0,l.i)(t.basis2,0,r,0),(0,p.fA)(0,0,1,0,t.plane),t}function I(e,t,n){return!!(0,p.Ui)(e.plane,t,n)&&C(e,n)}function M(e,t,n){const r=x.get();R(e,t,r,x.get());let i=Number.POSITIVE_INFINITY;for(const o of W){const a=L(e,o,Z.get()),c=_.rq.get();if((0,p.T7)(r,a,c)){const e=(0,l.o)(_.rq.get(),t.origin,c),r=Math.abs((0,s.XM)((0,l.f)(t.direction,e)));r<i&&(i=r,(0,l.c)(n,c))}}return i===Number.POSITIVE_INFINITY?O(e,t,n):n}function O(e,t,n){if(I(e,t,n))return n;const r=x.get(),s=x.get();R(e,t,r,s);let i=Number.POSITIVE_INFINITY;for(const o of W){const a=L(e,o,Z.get()),c=_.rq.get();if((0,p.gv)(r,a,c)){const e=(0,f.kb)(t,c);if(!(0,p.Tj)(s,c))continue;e<i&&(i=e,(0,l.c)(n,c))}}return P(e,t.origin)<i&&E(e,t.origin,n),n}function E(e,t,n){const r=(0,p._I)(e.plane,t,_.rq.get()),s=(0,h.H6)(j(e,e.basis1),r,-1,1,_.rq.get()),i=(0,h.H6)(j(e,e.basis2),r,-1,1,_.rq.get());return(0,l.d)(n,(0,l.g)(_.rq.get(),s,i),e.origin),n}function A(e,t,n){const{origin:r,basis1:s,basis2:i}=e,o=(0,l.d)(_.rq.get(),t,r),a=(0,g.gr)(s,o),c=(0,g.gr)(i,o),u=(0,g.gr)(T(e),o);return(0,l.i)(n,a,c,u)}function P(e,t){const n=A(e,t,_.rq.get()),{basis1:r,basis2:s}=e,i=(0,l.l)(r),o=(0,l.l)(s),a=Math.max(Math.abs(n[0])-i,0),c=Math.max(Math.abs(n[1])-o,0),u=n[2];return a*a+c*c+u*u}function N(e,t){return Math.sqrt(P(e,t))}function H(e,t){const n=-e.plane[3];return(0,g.gr)(T(e),t)-n}function T(e){return(0,p.Qj)(e.plane)}function C(e,t){const n=(0,l.d)(_.rq.get(),t,e.origin),r=(0,l.k)(e.basis1),s=(0,l.k)(e.basis2),i=(0,l.f)(e.basis1,n),o=(0,l.f)(e.basis2,n);return-i-r<0&&i-r<0&&-o-s<0&&o-s<0}function j(e,t){const n=Z.get();return(0,l.c)(n.origin,e.origin),(0,l.c)(n.vector,t),n}function L(e,t,n){const{basis1:r,basis2:s,origin:i}=e,o=(0,l.h)(_.rq.get(),r,t.origin[0]),a=(0,l.h)(_.rq.get(),s,t.origin[1]);(0,l.g)(n.origin,o,a),(0,l.g)(n.origin,n.origin,i);const c=(0,l.h)(_.rq.get(),r,t.direction[0]),u=(0,l.h)(_.rq.get(),s,t.direction[1]);return(0,l.h)(n.vector,(0,l.g)(c,c,u),2),n}function R(e,t,n,r){const s=T(e);(0,p.mR)(s,t.direction,t.origin,n),(0,p.mR)((0,p.Qj)(n),s,t.origin,r)}const F={plane:(0,p.vt)(),origin:(0,c.fA)(0,0,0),basis1:(0,c.fA)(1,0,0),basis2:(0,c.fA)(0,1,0)},x=new i.I(p.vt),Z=new i.I(h.vt),z=(0,c.vt)(),J=new i.I((()=>v())),W=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],V=(0,a.vt)(),q=(0,a.vt)(),U=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:class{constructor(){this.plane=(0,p.vt)(),this.origin=(0,c.vt)(),this.basis1=(0,c.vt)(),this.basis2=(0,c.vt)()}},altitudeAt:H,axisAt:function(e,t,n,r){return function(e,t,n){switch(t){case d._.X:(0,l.c)(n,e.basis1),(0,l.n)(n,n);break;case d._.Y:(0,l.c)(n,e.basis2),(0,l.n)(n,n);break;case d._.Z:(0,l.c)(n,T(e))}return n}(e,n,r)},cameraFrustumCoverage:function(e,t){return(t-e)/t},closestPoint:O,closestPointOnSilhouette:M,copy:b,copyWithoutVerify:function(e,t){(0,l.c)(t.origin,e.origin),(0,l.c)(t.basis1,e.basis1),(0,l.c)(t.basis2,e.basis2),(0,p.C)(t.plane,e.plane)},create:v,distance:N,distance2:P,distanceToSilhouette:function(e,t){let n=Number.NEGATIVE_INFINITY;for(const r of W){const s=L(e,r,Z.get()),i=(0,h.kb)(s,t);i>n&&(n=i)}return Math.sqrt(n)},elevate:k,equals:function(e,t){return(0,l.p)(e.basis1,t.basis1)&&(0,l.p)(e.basis2,t.basis2)&&(0,l.p)(e.origin,t.origin)},extrusionContainsPoint:function(e,t){return(0,p.Tj)(e.plane,t)&&C(e,t)},fromAABoundingRect:S,fromValues:w,getExtent:function(e,t){const n=e.basis1[0],r=e.basis2[1],[s,i]=e.origin;return(0,u.fA)(s-n,i-r,s+n,i+r,t)},intersectRay:I,intersectRayClosestSilhouette:function(e,t,n){if(I(e,t,n))return n;const r=M(e,t,_.rq.get());return(0,l.g)(n,t.origin,(0,l.h)(_.rq.get(),t.direction,(0,l.j)(t.origin,r)/(0,l.l)(t.direction))),n},normal:T,projectPoint:E,projectPointLocal:A,rotate:function(e,t,n,r){return e!==r&&b(e,r),(0,o.$0)(q,t,n),(0,l.t)(r.basis1,e.basis1,q),(0,l.t)(r.basis2,e.basis2,q),m(r),r},setAltitudeAt:function(e,t,n,r){const s=H(e,t),i=(0,l.h)(z,T(e),n-s);return(0,l.g)(r,t,i),r},setExtent:function(e,t,n){return S(t,n),k(n,H(e,e.origin),n),n},transform:function(e,t,n){return e!==n&&b(e,n),(0,o.B8)(V,t),(0,o.mg)(V,V),(0,l.t)(n.basis1,e.basis1,V),(0,l.t)(n.basis2,e.basis2,V),(0,l.t)((0,p.Qj)(n.plane),(0,p.Qj)(e.plane),V),(0,l.t)(n.origin,e.origin,t),(0,p.mP)(n.plane,n.plane,n.origin),n},up:F,updateUnboundedPlane:m,wrap:function(e,t,n){const r=J.get();return r.origin=e,r.basis1=t,r.basis2=n,r.plane=(0,p.LV)(0,0,0,0),m(r),r}},Symbol.toStringTag,{value:"Module"}))},7213:function(e,t,n){function r(e){let t,n,r=[],s=!1;return function(...i){return s&&t===this&&function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(i,r)||(n=e.apply(this,i),t=this,r=i,s=!0),n}}n.d(t,{B:function(){return r}})},37797:function(e,t,n){n.d(t,{A:function(){return c}});var r=n(61226),s=(n(58941),n(60539)),i=n(51846),o=n(13370),a=n(90465),l=n(50193);class c{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new i.A}destroy(){this.close()}get closed(){return!this._clients?.length}open(e,t){return new Promise(((n,r)=>{let i=!0;const o=e=>{(0,s.Te)(t.signal),i&&(i=!1,e())};this._clients.length=e.length,this._clientPromises.length=e.length,this._inUseClients.length=e.length;for(let i=0;i<e.length;++i){const a=e[i];(0,s.$X)(a)?this._clientPromises[i]=a.then((e=>(this._clients[i]=new l.A(e,t,this._ongoingJobsQueue),o(n),this._clients[i])),(()=>(o(r),null))):(this._clients[i]=new l.A(a,t,this._ongoingJobsQueue),this._clientPromises[i]=Promise.resolve(this._clients[i]),o(n))}}))}broadcast(e,t,n){const r=new Array(this._clientPromises.length);for(let s=0;s<this._clientPromises.length;++s){const i=this._clientPromises[s];r[s]=i.then((r=>r?.invoke(e,t,n)))}return r}close(){let e;for(;e=this._ongoingJobsQueue.pop();)e.resolver.reject((0,s.NK)(`Worker closing, aborting job calling '${e.methodName}'`));for(const e of this._clientPromises)e.then((e=>e?.close()));this._clients.length=0,this._clientPromises.length=0,this._inUseClients.length=0,(0,o.h)(this)}invoke(e,t,n){return this.apply(e,[t],n)}apply(e,t,n){const r=(0,s.Tw)();this._ongoingJobsQueue.push({methodName:e,data:t,invokeOptions:n,resolver:r});for(let e=0;e<this._clientPromises.length;e++){const t=this._clients[e];t?t.jobAdded():this._clientPromises[e].then((e=>e?.jobAdded()))}return r.promise}createInvokeProxy(e){return(0,a.L)(this,e)}on(e,t){return Promise.all(this._clientPromises).then((()=>(0,r.vE)(this._clients.map((n=>n.on(e,t))))))}openPorts(){return new Promise((e=>{const t=new Array(this._clientPromises.length);let n=t.length;for(let r=0;r<this._clientPromises.length;++r)this._clientPromises[r].then((s=>{s&&(t[r]=s.openPort()),0==--n&&e(t)}))}))}get test(){}}},90465:function(e,t,n){function r(e,t){return new Proxy({},{get:(n,r,s)=>(...n)=>{let s,i;const o=n[n.length-1];return function(e){return"object"==typeof e&&!Array.isArray(e)&&null!=e&&("signal"in e||"transferList"in e||0===Object.keys(e).length)}(o)&&(s=o.signal,i=o.transferList,n.pop()),e.apply(t?`${t}.${r.toString()}`:r.toString(),n,{transferList:i,signal:s})}})}n.d(t,{L:function(){return r}})},50193:function(e,t,n){n.d(t,{A:function(){return w}});var r=n(7156),s=n(39819),i=n(40212),o=n(61226),a=n(95929),l=n(60539),c=n(90465);const u={statsWorker:()=>n.e(1838).then(n.bind(n,27966)),geometryEngineWorker:()=>n.e(2384).then(n.bind(n,9568)),CSVSourceWorker:()=>n.e(2600).then(n.bind(n,80172)),EdgeProcessingWorker:()=>n.e(2933).then(n.bind(n,92273)),ElevationSamplerWorker:()=>n.e(5120).then(n.bind(n,55412)),FeatureServiceSnappingSourceWorker:()=>n.e(8246).then(n.bind(n,66038)),GeoJSONSourceWorker:()=>n.e(7253).then(n.bind(n,4389)),LercWorker:()=>n.e(6594).then(n.bind(n,67024)),MemorySourceWorker:()=>n.e(807).then(n.bind(n,8489)),PBFDecoderWorker:()=>n.e(8950).then(n.bind(n,19939)),FeaturePipelineWorker:()=>n.e(3806).then(n.bind(n,25423)),PointCloudWorker:()=>n.e(9722).then(n.bind(n,33764)),RasterWorker:()=>n.e(6221).then(n.bind(n,85563)),SceneLayerSnappingSourceWorker:()=>n.e(5974).then(n.bind(n,28820)),SceneLayerWorker:()=>n.e(5404).then(n.bind(n,90525)),WFSSourceWorker:()=>n.e(4900).then(n.bind(n,6412)),WorkerTileHandler:()=>n.e(3295).then(n.bind(n,27787)),Lyr3DWorker:()=>n.e(3213).then(n.bind(n,6883)),Feature3DPipelineWorker:()=>n.e(3929).then(n.bind(n,38518))};var d=n(64272),h=n(23532);const{CLOSE:p,ABORT:f,INVOKE:g,RESPONSE:_,OPEN_PORT:y,ON:v}=d.Go;class b{constructor(e){this._invoke=e,this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._timer=null,this._process=this._process.bind(this)}push(e){e.type===d.Go.ABORT?this._cancelledJobIds.add(e.jobId):(this._invokeMessages.push(e),null===this._timer&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const e of this._invokeMessages)this._cancelledJobIds.has(e.jobId)||this._invoke(e);this._cancelledJobIds.clear(),this._invokeMessages.length=0}}class w{static connect(e,t){const n=new MessageChannel;let r;r="function"==typeof e?new e:"default"in e&&"function"==typeof e.default?new e.default:e;const s=new w(n.port1,{channel:n,client:r,schedule:t});return"object"==typeof r&&"remoteClient"in r&&(r.remoteClient=s),w.clients.set(s,r),n.port2}static loadWorker(e){const t=u[e];return t?t():Promise.resolve(null)}constructor(e,t,n){this._port=e,this._jobQueue=n,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new b((e=>this._onInvokeMessage(e))),this._client=t.client,this._onMessage=this._onMessage.bind(this),this._channel=t.channel,this._schedule=t.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}close(){this._post({type:p}),this._close()}isBusy(){return this._outJobs.size>0}invoke(e,t,n){return this.apply(e,[t],n)}apply(e,t,n){const r=n?.signal,i=n?.transferList;if(!this._port)return Promise.reject(new s.A(d.T,`Cannot call invoke('${e}'), port is closed`,{methodName:e,data:t}));const o=(0,d.Jc)();return new Promise(((n,s)=>{if((0,l.G4)(r))return this._processWork(),void s((0,l.NK)());const c=(0,l.u7)(r,(()=>{const e=this._outJobs.get(o);e&&(this._outJobs.delete(o),this._processWork(),(0,a.xt)(e.abortHandle),this._post({type:f,jobId:o}),s((0,l.NK)()))})),u={resolve:n,reject:s,abortHandle:c,debugInfo:e};this._outJobs.set(o,u),this._post({type:g,jobId:o,methodName:e,abortable:null!=r},t,i)}))}createInvokeProxy(e){return(0,c.L)(this,e)}on(e,t){const n=new MessageChannel;function r(e){t(e.data)}return this._port.postMessage({type:d.Go.ON,eventType:e,port:n.port2},[n.port2]),n.port1.addEventListener("message",r),n.port1.start(),(0,o.hA)((()=>{n.port1.postMessage({type:d.Go.CLOSE}),n.port1.close(),n.port1.removeEventListener("message",r)}))}jobAdded(){this._processWork()}openPort(){const e=new MessageChannel;return this._post({type:y,port:e.port2}),e.port1}_processWork(){if(this._outJobs.size>=2)return;const e=this._jobQueue?.pop();if(!e)return;const{methodName:t,data:n,invokeOptions:r,resolver:s}=e;this.apply(t,n,r).then((e=>s.resolve(e))).catch((e=>s.reject(e)))}_close(){this._channel&&(this._channel=void 0),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach((e=>{(0,a.xt)(e.abortHandle),e.reject((0,l.NK)(`Worker closing, aborting job calling '${e.debugInfo}'`))})),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=null,this._client=null,this._schedule=null}_onMessage(e){null!=this._schedule?this._schedule((()=>this._processMessage(e,!0))):this._processMessage(e,!1)}_processMessage(e,t){const n=(0,d.VI)(e);if(n)switch(n.type){case _:this._onResponseMessage(n);break;case g:t?this._onInvokeMessage(n):this._invokeQueue.push(n);break;case f:this._onAbortMessage(n);break;case p:this._onCloseMessage();break;case y:this._onOpenPortMessage(n);break;case v:this._onOnMessage(n)}}_onAbortMessage(e){const t=this._inJobs,n=e.jobId,r=t.get(n);this._invokeQueue.push(e),r&&(r.controller&&r.controller.abort(),t.delete(n))}_onCloseMessage(){const e=this._client;this._close(),e&&"destroy"in e&&w.clients.get(this)===e&&e.destroy(),w.clients.delete(this),e?.remoteClient&&(e.remoteClient=null)}_onInvokeMessage(e){const{methodName:t,jobId:n,data:r=[],abortable:s}=e,i=s?new AbortController:null,o=this._inJobs;let a,c=this._client,u=c[t];try{if(!u&&t&&t.includes(".")){const e=t.split(".");for(let t=0;t<e.length-1;t++)c=c[e[t]],u=c[e[t+1]]}if("function"!=typeof u)throw new TypeError(`${t} is not a function`);r.push({client:this,signal:i?i.signal:null}),a=u.apply(c,r)}catch(e){return void this._post({type:_,jobId:n,error:(0,d.mF)(e)})}(0,l.$X)(a)?(o.set(n,{controller:i,promise:a}),a.then((e=>{o.has(n)&&(o.delete(n),this._post({type:_,jobId:n},e))}),(e=>{o.has(n)&&(o.delete(n),(0,l.zf)(e)||this._post({type:_,jobId:n,error:(0,d.mF)(e||{message:`Error encountered at method ${t}`})}))}))):this._post({type:_,jobId:n},a)}_onOpenPortMessage(e){new w(e.port,{client:this._client})}_onOnMessage(e){const{port:t}=e,n=this._client.on(e.eventType,(e=>{t.postMessage(e)})),r=(0,i.on)(e.port,"message",(e=>{const s=(0,d.VI)(e);s?.type===d.Go.CLOSE&&(r.remove(),n.remove(),t.close())}))}_onResponseMessage(e){const{jobId:t,error:n,data:r}=e,i=this._outJobs;if(!i.has(t))return;const o=i.get(t);i.delete(t),this._processWork(),(0,a.xt)(o.abortHandle),n?o.reject(s.A.fromJSON(JSON.parse(n))):o.resolve(r)}_post(e,t,n){return(0,d.u1)(this._port,e,t,n)}}w.kernelInfo={buildDate:h.$,fullVersion:r.ol,revision:h.u},w.clients=new Map},5113:function(e,t,n){n.d(t,{B:function(){return l}});var r=n(50659),s=n(61226),i=n(40633),o=n(60539),a=n(86027);class l{constructor(e,t,n,r,s={}){this._mainMethod=t,this._transferLists=n,this._listeners=[],this._promise=(0,a.ho)(e,{...s,schedule:r}).then((e=>{if(void 0===this._thread){this._thread=e,this._promise=null,s.hasInitialize&&this.broadcast({},"initialize");for(const e of this._listeners)this._connectListener(e)}else e.close()})),this._promise.catch((t=>i.A.getLogger("esri.core.workers.WorkerHandle").error(`Failed to initialize ${e} worker: ${t}`)))}on(e,t){const n={removed:!1,eventName:e,callback:t,threadHandle:null};return this._listeners.push(n),this._connectListener(n),(0,s.hA)((()=>{n.removed=!0,(0,r.TF)(this._listeners,n),this._thread&&null!=n.threadHandle&&n.threadHandle.remove()}))}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null,this._listeners.length=0,this._transferLists={}}invoke(e,t){return this.invokeMethod(this._mainMethod,e,t)}invokeMethod(e,t,n){if(this._thread){const r=this._transferLists[e],s=r?r(t):[];return this._thread.invoke(e,t,{transferList:s,signal:n})}return this._promise?this._promise.then((()=>((0,o.Te)(n),this.invokeMethod(e,t,n)))):Promise.reject(null)}broadcast(e,t){return this._thread?Promise.all(this._thread.broadcast(t,e)).then((()=>{})):this._promise?this._promise.then((()=>this.broadcast(e,t))):Promise.reject()}get promise(){return this._promise}_connectListener(e){this._thread&&this._thread.on(e.eventName,e.callback).then((t=>{e.removed||(e.threadHandle=t)}))}}},13370:function(e,t,n){n.d(t,{h:function(){return i},k:function(){return s}});const r=new FinalizationRegistry((e=>{e.close()}));function s(e,t){r.register(e,t,t)}function i(e){r.unregister(e)}},64272:function(e,t,n){n.d(t,{Go:function(){return o},Jc:function(){return c},T:function(){return i},VI:function(){return h},mF:function(){return u},oV:function(){return f},u1:function(){return d}});var r=n(58941),s=n(60539);const i="worker:port-closed";var o,a;(a=o||(o={}))[a.HANDSHAKE=0]="HANDSHAKE",a[a.OPEN=1]="OPEN",a[a.OPENED=2]="OPENED",a[a.RESPONSE=3]="RESPONSE",a[a.INVOKE=4]="INVOKE",a[a.ABORT=5]="ABORT",a[a.CLOSE=6]="CLOSE",a[a.OPEN_PORT=7]="OPEN_PORT",a[a.ON=8]="ON";let l=0;function c(){return l++}function u(e){return e?"string"==typeof e?JSON.stringify({name:"message",message:e}):e.toJSON?JSON.stringify(e):JSON.stringify({name:e.name,message:e.message,details:e.details||{stack:e.stack}}):null}function d(e,t,n,s){if(t.type===o.OPEN_PORT)return void e.postMessage(t,[t.port]);if(t.type!==o.INVOKE&&t.type!==o.RESPONSE)return void e.postMessage(t);let i;if(function(e){return e&&"object"==typeof e&&("result"in e||"transferList"in e)}(n)?(i=p(n.transferList),t.data=n.result):(i=p(s),t.data=n),i){if((0,r.A)("ff"))for(const n of i)if("byteLength"in n&&n.byteLength>267386880){const n="Worker call with large ArrayBuffer would crash Firefox";switch(t.type){case o.INVOKE:throw n;case o.RESPONSE:return void d(e,{type:o.RESPONSE,jobId:t.jobId,error:u(n)})}}e.postMessage(t,i)}else e.postMessage(t)}function h(e){if(!e)return null;const t=e.data;return t?"string"==typeof t?JSON.parse(t):t:null}function p(e){if(!e?.length)return null;if((0,r.A)("esri-workers-arraybuffer-transfer"))return e;const t=e.filter((e=>!function(e){return e instanceof ArrayBuffer||"ArrayBuffer"===e?.constructor?.name}(e)));return t.length?t:null}async function f(e){try{return await e}catch(e){const t=e?.name===i;if(!(0,s.zf)(e)&&!t)throw e;return}}},86027:function(e,t,n){n.d(t,{n_:function(){return J},ho:function(){return V}});var r=n(39819),s=n(58941),i=n(60539),o=n(37797),a=n(13370),l=n(50193),c=n(40633),u=n(95929),d=n(93040),h=n(90683);const p={async request(e,t){const n=e.options,r=n.responseType;n.signal=t?.signal,n.responseType="native"===r||"native-request-init"===r?"native-request-init":r&&["blob","json","text"].includes(r)&&(0,h.sC)(e.url)?.after?r:"array-buffer";const s=await(0,d.A)(e.url,n),i={data:s.data,httpStatus:s.httpStatus,ssl:s.ssl};switch(s.requestOptions?.responseType){case"native-request-init":return delete i.data.signal,i;case"blob":i.data=await i.data.arrayBuffer();break;case"json":i.data=(new TextEncoder).encode(JSON.stringify(i.data)).buffer;break;case"text":i.data=(new TextEncoder).encode(i.data).buffer}return{result:i,transferList:[i.data]}}};var f=n(64272),g=n(53216),_=n(25591),y=(n(64122),n(7156));const v={};var b=n(29601);class w{constructor(){const e=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach((t=>{this[t]=(...n)=>e[t](...n)}))}}class m{constructor(){this._dispatcher=new w,this._workerPostMessage({type:f.Go.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=e,e&&this.addEventListener("message",e)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(e){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=e,e&&this.addEventListener("messageerror",e)}get onerror(){return this._onerrorHandler}set onerror(e){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=e,e&&this.addEventListener("error",e)}postMessage(e){(0,b.d)((()=>{this._workerMessageHandler(new MessageEvent("message",{data:e}))}))}dispatchEvent(e){return this._dispatcher.dispatchEvent(e)}addEventListener(e,t,n){this._dispatcher.addEventListener(e,t,n)}removeEventListener(e,t,n){this._dispatcher.removeEventListener(e,t,n)}_workerPostMessage(e){(0,b.d)((()=>{this.dispatchEvent(new MessageEvent("message",{data:e}))}))}async _workerMessageHandler(e){const t=(0,f.VI)(e);if(t&&t.type===f.Go.OPEN){const{modulePath:e,jobId:n}=t;let r=await l.A.loadWorker(e);r||(r=await import(e));const s=l.A.connect(r);this._workerPostMessage({type:f.Go.OPENED,jobId:n,data:s})}}}var k=n(22739),S=n(23532);const I=()=>c.A.getLogger("esri.core.workers.workerFactory"),{HANDSHAKE:M}=f.Go;let O,E;const A="Failed to create Worker. Fallback to execute module in main thread";async function P(e){return new Promise((t=>{function n(s){const i=(0,f.VI)(s);i&&i.type===M&&(e.removeEventListener("message",n),e.removeEventListener("error",r),t(e))}function r(t){t.preventDefault(),e.removeEventListener("message",n),e.removeEventListener("error",r),I().warn("Failed to create Worker. Fallback to execute module in main thread",t),(e=new m).addEventListener("message",n),e.addEventListener("error",r)}e.addEventListener("message",n),e.addEventListener("error",r)}))}let N=0;const{ABORT:H,INVOKE:T,OPEN:C,OPENED:j,RESPONSE:L}=f.Go;class R{static async create(e){const t=await async function(){if(!(0,s.A)("esri-workers"))return P(new m);if(!O&&!E)try{const e='let globalId=0;const outgoing=new Map,configuration={CONFIGURATION};self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;let s=null;return new Promise(((r,i)=>{if(t){if(t.aborted)return i(createAbortError());s=()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:5,jobId:n}),i(createAbortError()))},t.addEventListener("abort",s)}outgoing.set(n,{resolve:r,reject:i}),self.postMessage({type:4,jobId:n,methodName:e,abortable:null!=t,data:o})})).finally((()=>{t&&t.removeEventListener("abort",s)}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,fullVersion:r}=configuration.kernelInfo,{revision:t,fullVersion:n,version:s}=e.kernelInfo;esriConfig.assetsPath!==esriConfig.defaultAssetsPath&&o!==t&&console.warn(`Version mismatch detected between ArcGIS Maps SDK for JavaScript modules and assets. For more information visit https://bit.ly/3QnsuSo.\nModules version: ${r}\nAssets version: ${n??s}\nAssets path: ${esriConfig.assetsPath}`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case 1:let n;function t(e){const o=n.connect(e);self.postMessage({type:2,jobId:r,data:o},[o])}"function"==typeof define&&define.amd?require([workerPath],(e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((e=>(n=e.default,checkWorkerRevision(n),n.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),n=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(n),n.loadWorker(o.modulePath).then(t));break;case 3:if(outgoing.has(r)){const s=outgoing.get(r);outgoing.delete(r),o.error?s.reject(JSON.parse(o.error)):s.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});'.split("{CONFIGURATION}").join(function(){let e;if(null!=_.default.default){const t={..._.default};delete t.default,e=JSON.parse(JSON.stringify(t))}else e=JSON.parse(JSON.stringify(_.default));e.assetsPath=(0,h.s2)(e.assetsPath),e.defaultAssetsPath=e.defaultAssetsPath?(0,h.s2)(e.defaultAssetsPath):void 0,e.request.interceptors=[],e.log.interceptors=[],e.locale=(0,k.JK)(),e.has={"esri-csp-restrictions":(0,s.A)("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":(0,s.A)("esri-2d-update-debug"),"esri-2d-log-updating":(0,s.A)("esri-2d-log-updating"),"featurelayer-pbf":(0,s.A)("featurelayer-pbf"),"featurelayer-fast-triangulation-enabled":(0,s.A)("featurelayer-fast-triangulation-enabled"),"featurelayer-simplify-thresholds":(0,s.A)("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":(0,s.A)("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":(0,s.A)("featurelayer-simplify-mobile-factor"),"featurelayer-query-max-depth":(0,s.A)("featurelayer-query-max-depth"),"featurelayer-query-pausing-enabled":(0,s.A)("featurelayer-query-pausing-enabled"),"featurelayer-snapshot-enabled":(0,s.A)("featurelayer-snapshot-enabled"),"esri-atomics":(0,s.A)("esri-atomics"),"esri-shared-array-buffer":(0,s.A)("esri-shared-array-buffer"),"esri-tiles-debug":(0,s.A)("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":(0,s.A)("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":(0,s.A)("feature-polyline-generalization-factor"),"host-webworker":1},e.workers.loaderUrl&&(e.workers.loaderUrl=(0,h.s2)(e.workers.loaderUrl)),e.workers.workerPath?e.workers.workerPath=(0,h.s2)(e.workers.workerPath):e.workers.workerPath=(0,h.s2)((0,g.s)("esri/core/workers/RemoteClient.js")),e.workers.useDynamicImport=!1;const t=_.default.workers.loaderConfig,n=function(e){const t={async:e.async,isDebug:e.isDebug,locale:e.locale,baseUrl:e.baseUrl,has:{...e.has},map:{...e.map},packages:e.packages?.slice()||[],paths:{...v.paths,...e.paths}};return e.hasOwnProperty("async")||(t.async=!0),e.hasOwnProperty("isDebug")||(t.isDebug=!1),e.baseUrl||(t.baseUrl=v.baseUrl),t}({baseUrl:t?.baseUrl,locale:(0,k.JK)(),has:{"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1,...t?.has},map:{...t?.map},paths:{...t?.paths},packages:t?.packages||[]}),r={buildDate:S.$,fullVersion:y.ol,revision:S.u};return JSON.stringify({esriConfig:e,loaderConfig:n,kernelInfo:r})}());O=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))}catch(e){E=e||{}}let e;if(O)try{e=new Worker(O,{name:"esri-worker-"+N++})}catch(t){I().warn(A,E),e=new m}else I().warn(A,E),e=new m;return P(e)}();return new R(t,e)}constructor(e,t){this._outJobs=new Map,this._inJobs=new Map,this.worker=e,this.id=t,e.addEventListener("message",this._onMessage.bind(this)),e.addEventListener("error",(e=>{e.preventDefault(),c.A.getLogger("esri.core.workers.WorkerOwner").error(e)}))}terminate(){this.worker.terminate()}async open(e,t={}){const{signal:n}=t,r=(0,f.Jc)();return new Promise(((t,s)=>{const o={resolve:t,reject:s,abortHandle:(0,i.NY)(n,(()=>{this._outJobs.delete(r),this._post({type:H,jobId:r})}))};this._outJobs.set(r,o),this._post({type:C,jobId:r,modulePath:e})}))}_onMessage(e){const t=(0,f.VI)(e);if(t)switch(t.type){case j:this._onOpenedMessage(t);break;case L:this._onResponseMessage(t);break;case H:this._onAbortMessage(t);break;case T:this._onInvokeMessage(t)}}_onAbortMessage(e){const t=this._inJobs,n=e.jobId,r=t.get(n);r&&(r.controller&&r.controller.abort(),t.delete(n))}_onInvokeMessage(e){const{methodName:t,jobId:n,data:r,abortable:s}=e,o=s?new AbortController:null,a=this._inJobs,l=p[t];let c;try{if("function"!=typeof l)throw new TypeError(`${t} is not a function`);c=l.call(null,r,{signal:o?o.signal:null})}catch(e){return void this._post({type:L,jobId:n,error:(0,f.mF)(e)})}(0,i.$X)(c)?(a.set(n,{controller:o,promise:c}),c.then((e=>{a.has(n)&&(a.delete(n),this._post({type:L,jobId:n},e))}),(e=>{a.has(n)&&(a.delete(n),e||(e={message:"Error encountered at method"+t}),(0,i.zf)(e)||this._post({type:L,jobId:n,error:(0,f.mF)(e||{message:`Error encountered at method ${t}`})}))}))):this._post({type:L,jobId:n},c)}_onOpenedMessage(e){const{jobId:t,data:n}=e,r=this._outJobs.get(t);r&&(this._outJobs.delete(t),(0,u.xt)(r.abortHandle),r.resolve(n))}_onResponseMessage(e){const{jobId:t,error:n,data:s}=e,i=this._outJobs.get(t);i&&(this._outJobs.delete(t),(0,u.xt)(i.abortHandle),n?i.reject(r.A.fromJSON(JSON.parse(n))):i.resolve(s))}_post(e,t,n){return(0,f.u1)(this.worker,e,t,n)}}const F=(0,s.A)("host-browser")?Math.min(navigator.hardwareConcurrency-1,(0,s.A)("workers-pool-size")??8):0;let x=(0,s.A)("esri-mobile")?Math.min(F,3):F;x||(x=(0,s.A)("safari")&&(0,s.A)("mac")?7:2);let Z=0;const z=[];function J(){D()}async function W(e,t){const n=new o.A,{registryTarget:r,...s}=t;return await n.open(e,s),r&&(0,a.k)(r,n),n}async function V(e,t={}){if("string"!=typeof e)throw new r.A("workers:undefined-module","modulePath is missing");let n=t.strategy||"distributed";if((0,s.A)("host-webworker")&&!(0,s.A)("esri-workers")&&(n="local"),"local"===n){let n=await l.A.loadWorker(e);n||(n=await import(e)),(0,i.Te)(t.signal);const r=t.client||n;return W([l.A.connect(n,t.schedule)],{...t,client:r})}if(await D(),(0,i.Te)(t.signal),"dedicated"===n){const n=Z++%x;return W([await z[n].open(e,t)],t)}if(t.maxNumWorkers&&t.maxNumWorkers>0){const n=Math.min(t.maxNumWorkers,x);if(n<x){const r=new Array(n);for(let s=0;s<n;++s){const n=Z++%x;r[s]=z[n].open(e,t)}return W(r,t)}}return W(z.map((n=>n.open(e,t))),t)}let q,U=null;async function D(){if(U)return U;q=new AbortController;const e=[];for(let t=0;t<x;t++){const n=R.create(t).then((e=>(z[t]=e,e)));e.push(n)}return U=Promise.all(e),U}},73313:function(e,t,n){n.d(t,{C:function(){return c},Cr:function(){return d},H6:function(){return g},_I:function(){return p},dz:function(){return _},fA:function(){return u},kb:function(){return h},ld:function(){return y},sd:function(){return f},vt:function(){return l}});var r=n(15774),s=n(89736),i=n(20551),o=n(32501),a=n(50973);function l(e){return e?{origin:(0,o.o8)(e.origin),vector:(0,o.o8)(e.vector)}:{origin:(0,o.vt)(),vector:(0,o.vt)()}}function c(e,t=l()){return u(e.origin,e.vector,t)}function u(e,t,n=l()){return(0,i.c)(n.origin,e),(0,i.c)(n.vector,t),n}function d(e,t,n=l()){return(0,i.c)(n.origin,e),(0,i.d)(n.vector,t,e),n}function h(e,t){const n=(0,i.d)(a.rq.get(),t,e.origin),s=(0,i.f)(e.vector,n),o=(0,i.f)(e.vector,e.vector),l=(0,r.qE)(s/o,0,1),c=(0,i.d)(a.rq.get(),(0,i.h)(a.rq.get(),e.vector,l),n);return(0,i.f)(c,c)}function p(e,t,n){return g(e,t,0,1,n)}function f(e,t,n){return(0,i.g)(n,e.origin,(0,i.h)(n,e.vector,t))}function g(e,t,n,s,o){const{vector:l,origin:c}=e,u=(0,i.d)(a.rq.get(),t,c),d=(0,i.f)(l,u)/(0,i.k)(l);return(0,i.h)(o,l,(0,r.qE)(d,n,s)),(0,i.g)(o,o,e.origin)}function _(e,t){if(v(e,function(e,t){const n=w.get();return n.origin=e,n.vector=t,n}(t.origin,t.direction),!1,b)){const{tA:t,pB:n,distance2:r}=b;if(t>=0&&t<=1)return r;if(t<0)return(0,i.s)(e.origin,n);if(t>1)return(0,i.s)((0,i.g)(a.rq.get(),e.origin,e.vector),n)}return null}function y(e,t,n){return!!v(e,t,!0,b)&&((0,i.c)(n,b.pA),!0)}function v(e,t,n,s){const o=1e-6,l=e.origin,c=(0,i.g)(a.rq.get(),l,e.vector),u=t.origin,d=(0,i.g)(a.rq.get(),u,t.vector),h=a.rq.get(),p=a.rq.get();if(h[0]=l[0]-u[0],h[1]=l[1]-u[1],h[2]=l[2]-u[2],p[0]=d[0]-u[0],p[1]=d[1]-u[1],p[2]=d[2]-u[2],Math.abs(p[0])<o&&Math.abs(p[1])<o&&Math.abs(p[2])<o)return!1;const f=a.rq.get();if(f[0]=c[0]-l[0],f[1]=c[1]-l[1],f[2]=c[2]-l[2],Math.abs(f[0])<o&&Math.abs(f[1])<o&&Math.abs(f[2])<o)return!1;const g=h[0]*p[0]+h[1]*p[1]+h[2]*p[2],_=p[0]*f[0]+p[1]*f[1]+p[2]*f[2],y=h[0]*f[0]+h[1]*f[1]+h[2]*f[2],v=p[0]*p[0]+p[1]*p[1]+p[2]*p[2],b=(f[0]*f[0]+f[1]*f[1]+f[2]*f[2])*v-_*_;if(Math.abs(b)<o)return!1;let w=(g*_-y*v)/b,m=(g+_*w)/v;n&&(w=(0,r.qE)(w,0,1),m=(0,r.qE)(m,0,1));const k=a.rq.get(),S=a.rq.get();return k[0]=l[0]+w*f[0],k[1]=l[1]+w*f[1],k[2]=l[2]+w*f[2],S[0]=u[0]+m*p[0],S[1]=u[1]+m*p[1],S[2]=u[2]+m*p[2],s.tA=w,s.tB=m,s.pA=k,s.pB=S,s.distance2=(0,i.s)(k,S),!0}const b={tA:0,tB:0,pA:(0,o.vt)(),pB:(0,o.vt)(),distance2:0},w=new s.I((()=>l()))},44431:function(e,t,n){n.d(t,{A:function(){return u}});var r,s=n(53804),i=n(30905),o=n(23502),a=n(67888),l=(n(13798),n(58941),n(65953));let c=r=class extends i.oY{constructor(e){super(e),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new r({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};(0,s._)([(0,o.MZ)({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],c.prototype,"cols",void 0),(0,s._)([(0,o.MZ)({type:a.jz,json:{write:!0}})],c.prototype,"level",void 0),(0,s._)([(0,o.MZ)({type:String,json:{write:!0}})],c.prototype,"levelValue",void 0),(0,s._)([(0,o.MZ)({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],c.prototype,"origin",void 0),(0,s._)([(0,o.MZ)({type:Number,json:{write:!0}})],c.prototype,"resolution",void 0),(0,s._)([(0,o.MZ)({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],c.prototype,"rows",void 0),(0,s._)([(0,o.MZ)({type:Number,json:{write:!0}})],c.prototype,"scale",void 0),c=r=(0,s._)([(0,l.$)("esri.layers.support.LOD")],c);const u=c},76226:function(e,t,n){n.r(t),n.d(t,{default:function(){return I}});var r,s=n(53804),i=n(73037),o=n(30905),a=n(62938),l=n(23502),c=n(67888),u=(n(13798),n(58941),n(47332)),d=n(65953),h=n(81392),p=n(45532),f=n(57165),g=n(87416),_=n(57652),y=n(1644),v=n(44431),b=n(29679);const w=new i.J({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let m=r=class extends o.oY{static create(e={}){const{resolutionFactor:t=1,scales:n,size:s=256,spatialReference:i=f.A.WebMercator,numLODs:o=24}=e;if(!(0,_.fn)(i)){const e=[];if(n)for(let t=0;t<n.length;t++){const r=n[t];e.push(new v.A({level:t,scale:r,resolution:r}))}else{let t=5e-4;for(let n=o-1;n>=0;n--)e.unshift(new v.A({level:n,scale:t,resolution:t})),t*=2}return new r({dpi:96,lods:e,origin:new p.default(0,0,i),size:[s,s],spatialReference:i})}const l=(0,_.Vp)(i),c=e.origin?new p.default({x:e.origin.x,y:e.origin.y,spatialReference:i}):new p.default(l?{x:l.origin[0],y:l.origin[1],spatialReference:i}:{x:0,y:0,spatialReference:i}),u=1/(39.37*(0,a.GA)(i)*96),d=[];if(n)for(let e=0;e<n.length;e++){const t=n[e],r=t*u;d.push(new v.A({level:e,scale:t,resolution:r}))}else{let e=(0,_.EA)(i)?512/s*591657527.5917094:256/s*591657527.591555;const n=Math.ceil(o/t);d.push(new v.A({level:0,scale:e,resolution:e*u}));for(let r=1;r<n;r++){const n=e/2**t,s=n*u;d.push(new v.A({level:r,scale:n,resolution:s})),e=n}}return new r({dpi:96,lods:d,origin:c,size:[s,s],spatialReference:i})}constructor(e){super(e),this.dpi=96,this.format=null,this.origin=null,this.size=null,this.spatialReference=null}get isWrappable(){const{spatialReference:e,origin:t}=this;if(e&&t){const n=(0,_.Vp)(e);return e.isWrappable&&!!n&&Math.abs(n.origin[0]-t.x)<=n.dx}return!1}readOrigin(e,t){return p.default.fromJSON({spatialReference:t.spatialReference,...e})}set lods(e){let t=0,n=0;const r=[],s=this._levelToLOD={};e&&(t=-1/0,n=1/0,e.forEach((e=>{r.push(e.scale),t=e.scale>t?e.scale:t,n=e.scale<n?e.scale:n,s[e.level]=e}))),this._set("scales",r),this._set("lods",e),this._initializeUpsampleLevels()}readSize(e,t){return[t.cols,t.rows]}writeSize(e,t){t.cols=e[0],t.rows=e[1]}zoomToScale(e){const t=this.scales;if(e<=0)return t[0];if(e>=t.length-1)return t[t.length-1];const n=Math.floor(e),r=n+1;return t[n]/(t[n]/t[r])**(e-n)}scaleToZoom(e){const t=this.scales,n=t.length-1;let r=0;for(;r<n;r++){const n=t[r],s=t[r+1];if(n<=e)return r;if(s===e)return r+1;if(n>e&&s<e)return r+Math.log(n/e)/Math.log(n/s)}return r}tileAt(e,t,n,r){const s=this.lodAt(e);if(!s)return null;let i,o;if("number"==typeof t)i=t,o=n;else if((0,_.aI)(t.spatialReference,this.spatialReference))i=t.x,o=t.y,r=n;else{const e=(0,y.Cv)(t,this.spatialReference);if(null==e)return null;i=e.x,o=e.y,r=n}const a=s.resolution*this.size[0],l=s.resolution*this.size[1];return r||(r=new b.U(null,0,0,0,(0,g.vt)())),r.level=e,r.row=Math.floor((this.origin.y-o)/l+.001),r.col=Math.floor((i-this.origin.x)/a+.001),this.updateTileInfo(r),r}updateTileInfo(e,t=r.ExtrapolateOptions.NONE){let n=this.lodAt(e.level);if(!n&&t===r.ExtrapolateOptions.POWER_OF_TWO){const t=this.lods[this.lods.length-1];t.level<e.level&&(n=t)}if(!n)return;const s=e.level-n.level,i=n.resolution*this.size[0]/2**s,o=n.resolution*this.size[1]/2**s;e.id=`${e.level}/${e.row}/${e.col}`,e.extent||(e.extent=(0,g.vt)()),e.extent[0]=this.origin.x+e.col*i,e.extent[1]=this.origin.y-(e.row+1)*o,e.extent[2]=e.extent[0]+i,e.extent[3]=e.extent[1]+o}upsampleTile(e){const t=this._upsampleLevels[e.level];return!(!t||-1===t.parentLevel||(e.level=t.parentLevel,e.row=Math.floor(e.row/t.factor+.001),e.col=Math.floor(e.col/t.factor+.001),this.updateTileInfo(e),0))}getTileBounds(e,t){const n=this.lodAt(t.level);if(null==n)return null;const{resolution:r}=n,s=r*this.size[0],i=r*this.size[1];return e[0]=this.origin.x+t.col*s,e[1]=this.origin.y-(t.row+1)*i,e[2]=e[0]+s,e[3]=e[1]+i,e}lodAt(e){return this._levelToLOD?.[e]??null}clone(){return r.fromJSON(this.write({}))}getCompatibleForVTL(e){if(this.size[0]!==this.size[1]||256===this.size[0]&&512===e)return null;const t=(512===this.size[0]&&256===e?-1:0)+(this.spatialReference.isGeographic?1:0);if(this.size[0]===e&&0===t)return this;const n=[],s=this.lods.length-t;for(let e=0;e<s;e++){const r=e+t,{scale:s,resolution:i}=r>=0?this.lods[r]:{scale:2*this.lods[0].scale,resolution:2*this.lods[0].resolution};n.push(new v.A({level:e,scale:s,resolution:i}))}return new r({size:[e,e],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:n})}_initializeUpsampleLevels(){const e=this.lods;this._upsampleLevels=[];let t=null;for(let n=0;n<e.length;n++){const r=e[n];this._upsampleLevels[r.level]={parentLevel:t?t.level:-1,factor:t?t.resolution/r.resolution:0},t=r}}};var k,S;(0,s._)([(0,l.MZ)({type:Number,json:{write:!0}})],m.prototype,"compressionQuality",void 0),(0,s._)([(0,l.MZ)({type:Number,json:{write:!0}})],m.prototype,"dpi",void 0),(0,s._)([(0,l.MZ)({type:String,json:{read:w.read,write:w.write,origins:{"web-scene":{read:!1,write:!1}}}})],m.prototype,"format",void 0),(0,s._)([(0,l.MZ)({readOnly:!0})],m.prototype,"isWrappable",null),(0,s._)([(0,l.MZ)({type:p.default,json:{write:!0}})],m.prototype,"origin",void 0),(0,s._)([(0,u.w)("origin")],m.prototype,"readOrigin",null),(0,s._)([(0,l.MZ)({type:[v.A],value:null,json:{write:!0}})],m.prototype,"lods",null),(0,s._)([(0,l.MZ)({readOnly:!0})],m.prototype,"scales",void 0),(0,s._)([(0,l.MZ)({cast:e=>Array.isArray(e)?e:"number"==typeof e?[e,e]:[256,256]})],m.prototype,"size",void 0),(0,s._)([(0,u.w)("size",["rows","cols"])],m.prototype,"readSize",null),(0,s._)([(0,h.K)("size",{cols:{type:c.jz},rows:{type:c.jz}})],m.prototype,"writeSize",null),(0,s._)([(0,l.MZ)({type:f.A,json:{write:!0}})],m.prototype,"spatialReference",void 0),m=r=(0,s._)([(0,d.$)("esri.layers.support.TileInfo")],m),(S=(k=m||(m={})).ExtrapolateOptions||(k.ExtrapolateOptions={}))[S.NONE=0]="NONE",S[S.POWER_OF_TWO=1]="POWER_OF_TWO";const I=m},29679:function(e,t,n){n.d(t,{U:function(){return r}});class r{constructor(e,t,n,r,s=void 0){this.id=e,this.level=t,this.row=n,this.col=r,this.extent=s}}},23532:function(e,t,n){n.d(t,{$:function(){return r},u:function(){return s}});const r="20241122",s="f6f7099a0e79cf518abdcf87c5aa8b6f24ecdcd8"},31392:function(e,t,n){n.d(t,{C:function(){return o}});var r=n(92100),s=n(29936),i=n(96942);class o extends s.w{constructor(e){super({...e,constraint:new r.i7(e.targetPoint)})}get hints(){return[new i._(this.targetPoint,this.isDraped,this.domain)]}}},92963:function(e,t,n){n.r(t),n.d(t,{FeatureServiceSnappingSource:function(){return se}});var r=n(53804),s=n(83525),i=n(77472),o=n(61226),a=n(7213),l=n(60539),c=n(28181),u=n(23502),d=(n(58941),n(40633),n(13798),n(65953)),h=n(20248),p=n(11432),f=n(68945),g=n(29679),_=n(20551),y=n(32501),v=n(2075);function b(e,t){return(0,v.g)(t.extent,w),(0,v.h)(w,(0,_.i)(m,e.x,e.y,0))}const w=(0,v.a)(),m=(0,y.vt)();var k=n(39715);let S=class extends s.A{get tiles(){const e=this.tilesCoveringView,t=null!=this.pointOfInterest?this.pointOfInterest:this.view.center;return e.sort(((e,n)=>b(t,e)-b(t,n))),e}_scaleEnabled(){return(0,k.JU)(this.view.scale,this.layer.minScale||0,this.layer.maxScale||0)}get tilesCoveringView(){if(!this.view.ready||!this.view.featuresTilingScheme||!this.view.state||null==this.tileInfo)return[];if(!this._scaleEnabled)return[];const{spans:e,lodInfo:t}=this.view.featuresTilingScheme.getTileCoverage(this.view.state,0),{level:n}=t,r=[];for(const{row:s,colFrom:i,colTo:o}of e)for(let e=i;e<=o;e++){const i=t.normalizeCol(e),o=new g.U(null,n,s,i);this.tileInfo.updateTileInfo(o),r.push(o)}return r}get tileInfo(){return this.view.featuresTilingScheme?.tileInfo??null}get tileSize(){return null!=this.tileInfo?this.tileInfo.size[0]:256}constructor(e){super(e),this.pointOfInterest=null}initialize(){this.addHandles((0,c.watch)((()=>this.view?.state?.viewpoint),(()=>this.notifyChange("tilesCoveringView")),c.OH))}};(0,r._)([(0,u.MZ)({readOnly:!0})],S.prototype,"tiles",null),(0,r._)([(0,u.MZ)({readOnly:!0})],S.prototype,"_scaleEnabled",null),(0,r._)([(0,u.MZ)({readOnly:!0})],S.prototype,"tilesCoveringView",null),(0,r._)([(0,u.MZ)({readOnly:!0})],S.prototype,"tileInfo",null),(0,r._)([(0,u.MZ)({readOnly:!0})],S.prototype,"tileSize",null),(0,r._)([(0,u.MZ)({constructOnly:!0})],S.prototype,"view",void 0),(0,r._)([(0,u.MZ)({constructOnly:!0})],S.prototype,"layer",void 0),(0,r._)([(0,u.MZ)()],S.prototype,"pointOfInterest",void 0),S=(0,r._)([(0,d.$)("esri.views.2d.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTiles2D")],S);let I=class extends s.A{get tiles(){const e=this.tilesCoveringView,t=this._effectivePointOfInterest;if(null!=t){const n=e.map((e=>b(t,e)));for(let r=1;r<n.length;r++)if(n[r-1]>n[r])return e.sort(((e,n)=>b(t,e)-b(t,n))),e.slice()}return e}get tilesCoveringView(){return(this.view.featureTiles?.tiles?.toArray()??[]).map(M)}get tileInfo(){return this.view.featureTiles?.tilingScheme?.toTileInfo()??null}get tileSize(){return this.view.featureTiles?.tileSize??256}get _effectivePointOfInterest(){const e=this.pointOfInterest;return null!=e?e:this.view.pointsOfInterest?.focus.location}constructor(e){super(e),this.pointOfInterest=null}initialize(){this.addHandles((0,c.watch)((()=>this.view.featureTiles),(e=>{this.removeHandles(O),e&&this.addHandles(e.addClient(),O)}),c.Vh))}};function M({lij:[e,t,n],extent:r}){return new g.U(`${e}/${t}/${n}`,e,t,n,r)}(0,r._)([(0,u.MZ)({readOnly:!0})],I.prototype,"tiles",null),(0,r._)([(0,u.MZ)({readOnly:!0})],I.prototype,"tilesCoveringView",null),(0,r._)([(0,u.MZ)({readOnly:!0})],I.prototype,"tileInfo",null),(0,r._)([(0,u.MZ)({readOnly:!0})],I.prototype,"tileSize",null),(0,r._)([(0,u.MZ)({constructOnly:!0})],I.prototype,"view",void 0),(0,r._)([(0,u.MZ)()],I.prototype,"pointOfInterest",void 0),(0,r._)([(0,u.MZ)()],I.prototype,"_effectivePointOfInterest",null),I=(0,r._)([(0,d.$)("esri.views.3d.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTiles3D")],I);const O="feature-tiles";var E=n(44425),A=n(94750),P=n(44740),N=n(87416),H=n(52874),T=n(59469),C=(n(10748),n(78879)),j=n(15774),L=n(78018),R=n(8740),F=n(90972),x=n(84998),Z=n(69613),z=n(39412),J=n(6322);const W=[[0,179,255],[117,62,128],[0,104,255],[215,189,166],[32,0,193],[98,162,206],[102,112,129],[52,125,0],[142,118,246],[138,83,0],[92,122,255],[122,55,83],[0,142,255],[81,40,179],[0,200,244],[13,24,127],[0,170,147],[19,58,241],[22,44,35]];let V=class extends s.A{constructor(e){super(e),this.updating=!1,this.enablePolygons=!0,this.enableLabels=!0,this._polygons=new Map,this._labels=new Map,this._enabled=!0}initialize(){this._symbols=W.map((e=>new R.A({color:[e[0],e[1],e[2],.6],outline:{color:"black",width:1}}))),this.update()}destroy(){this._enabled=!1,this.clear()}get enabled(){return this._enabled}set enabled(e){this._enabled!==e&&(this._enabled=e,this.update())}update(){if(!this._enabled)return void this.clear();const e=this.getTiles(),t=new Array,n=new Set((this._labels.size,this._labels.keys()));e.forEach(((r,s)=>{const i=r.lij.toString();n.delete(i);const o=r.measures?.effectiveLevelForLod??r.lij[0],a=r.geometry;if(this.enablePolygons&&!this._polygons.has(i)){const e=new T.default({geometry:a,symbol:this._symbols[o%this._symbols.length]});this._polygons.set(i,e),t.push(e)}if(this.enableLabels){const n=(e=>{if(null!=e.label)return e.label;let t=e.lij.toString();return null!=e.loadPriority&&(t+=` (${e.loadPriority})`),e.measures&&(t+=`[${e.measures.effectiveLevelForLod}]`),t})(r),o=s/(e.length-1),l=(0,j.Cc)(0,200,o),c=(0,j.Cc)(20,6,o)/.75,u=null!=r.loadPriority&&r.loadPriority>=e.length,d=new H.A([l,u?0:l,u?0:l]),h="3d"===this.view.type?()=>new L.A({verticalOffset:new Z.A({screenLength:40/.75}),callout:new z.A({color:new H.A("white"),border:new J.A({color:new H.A("black")})}),symbolLayers:new C.A([new x.A({text:n,halo:{color:"white",size:1/.75},material:{color:d},size:c})])}):()=>new F.A({text:n,haloColor:"white",haloSize:1/.75,color:d,size:c}),p=this._labels.get(i);if(p){const e=h();null!=p.symbol&&JSON.stringify(e)===JSON.stringify(p.symbol)||(p.symbol=e)}else{const e=new T.default({geometry:a.extent.center,symbol:h()});this._labels.set(i,e),t.push(e)}}}));const r=new Array;n.forEach((e=>{const t=this._polygons.get(e);null!=t&&(r.push(t),this._polygons.delete(e));const n=this._labels.get(e);null!=n&&(r.push(n),this._labels.delete(e))})),this.view.graphics.removeMany(r),this.view.graphics.addMany(t)}clear(){this.view.graphics.removeMany(Array.from(this._polygons.values())),this.view.graphics.removeMany(Array.from(this._labels.values())),this._polygons.clear(),this._labels.clear()}};(0,r._)([(0,u.MZ)({constructOnly:!0})],V.prototype,"view",void 0),(0,r._)([(0,u.MZ)({readOnly:!0})],V.prototype,"updating",void 0),(0,r._)([(0,u.MZ)()],V.prototype,"enabled",null),V=(0,r._)([(0,d.$)("esri.views.support.TileTreeDebugger")],V);let q=class extends V{constructor(e){super(e)}initialize(){const e=setInterval((()=>this._fetchDebugInfo()),2e3);this.addHandles((0,o.hA)((()=>clearInterval(e))))}getTiles(){if(!this._debugInfo)return[];const e=new Map,t=new Map;this._debugInfo.storedTiles.forEach((t=>{e.set(t.data.id,t.featureCount)})),this._debugInfo.pendingTiles.forEach((n=>{e.set(n.data.id,n.featureCount),t.set(n.data.id,n.state)}));const n=n=>{const r=t.get(n),s=e.get(n)??"?";return r?`${r}:${s}\n${n}`:`store:${s}\n${n}`},r=new Map;return this._debugInfo.storedTiles.forEach((e=>{r.set(e.data.id,e.data)})),this._debugInfo.pendingTiles.forEach((e=>{r.set(e.data.id,e.data)})),Array.from(r.values()).map((e=>({lij:[e.level,e.row,e.col],geometry:P.A.fromExtent((0,N.w1)(e.extent,this.view.spatialReference)),label:n(e.id)})))}_fetchDebugInfo(){this.handle.getDebugInfo(null).then((e=>{this._debugInfo=e,this.update()}))}};(0,r._)([(0,u.MZ)({constructOnly:!0})],q.prototype,"handle",void 0),q=(0,r._)([(0,d.$)("esri.views.interactive.snapping.featureSources.WorkerTileTreeDebugger")],q);var U=n(50659),D=n(95929),$=n(5113),G=n(63319),Q=n(46460);let B=class extends s.A{get updating(){return this._updatingHandles.updating||this._workerHandleUpdating}constructor(e){super(e),this._updatingHandles=new h.U,this._suspendController=null,this.schedule=null,this.hasZ=!1,this.elevationAlignPointsInFeatures=async e=>{const t=[];for(const{points:n}of e.pointsInFeatures)for(const{z:e}of n)t.push(e);return{elevations:t,drapedObjectIds:new Set,failedObjectIds:new Set}},this.queryForSymbologySnapping=async()=>({candidates:[],sourceCandidateIndices:[]}),this.availability=0,this._workerHandleUpdating=!0,this.updateOutFields=(0,l.sg)((async(e,t)=>{await this._updatingHandles.addPromise(this._workerHandle.invokeMethod("updateOutFields",[...e],t)),this._updatingHandles.addPromise(this._workerHandle.invokeMethod("whenNotUpdating",{},t))}))}destroy(){this._suspendController=(0,D.DC)(this._suspendController),this._workerHandle.destroy(),this._updatingHandles.destroy()}initialize(){this._workerHandle=new Y(this.schedule,{alignElevation:async(e,{signal:t})=>({result:await this.elevationAlignPointsInFeatures(e.query,t)}),getSymbologyCandidates:async(e,{signal:t})=>({result:await this.queryForSymbologySnapping(e,t)})}),this.addHandles([this._workerHandle.on("notify-updating",(({updating:e})=>this._workerHandleUpdating=e)),this._workerHandle.on("notify-availability",(({availability:e})=>this._set("availability",e)))])}async setup(e,t){const n=function(e){return"multipatch"===e.geometryType||"mesh"===e.geometryType?null:{url:e.parsedUrl?.path??"",fieldsIndex:e.fieldsIndex.toJSON(),geometryType:G.g.toJSON(e.geometryType),capabilities:e.capabilities,objectIdField:e.objectIdField,globalIdField:e.globalIdField,spatialReference:e.spatialReference.toJSON(),timeInfo:e.timeInfo?.toJSON()}}(e.layer);if(null==n)return;const r={configuration:K(e.configuration),serviceInfo:n,spatialReference:e.spatialReference.toJSON(),hasZ:this.hasZ,elevationInfo:e.layer.elevationInfo?.toJSON()};await this._updatingHandles.addPromise(this._workerHandle.invokeMethod("setup",r,t)),this._updatingHandles.addPromise(this._workerHandle.invokeMethod("whenNotUpdating",{},t))}async configure(e,t){const n=K(e);await this._updatingHandles.addPromise(this._workerHandle.invokeMethod("configure",n,t)),this._updatingHandles.addPromise(this._workerHandle.invokeMethod("whenNotUpdating",{},t))}async refresh(e){await this._updatingHandles.addPromise(this._workerHandle.invokeMethod("refresh",{},e)),this._updatingHandles.addPromise(this._workerHandle.invokeMethod("whenNotUpdating",{},e))}async fetchCandidates(e,t){const{point:n,filter:r,coordinateHelper:s}=e,i={...e,point:(0,Q.T)(n[0],n[1],n[2],s.spatialReference.toJSON()),filter:r?.toJSON()};return this._workerHandle.invoke(i,t)}async updateTiles(e,t){const n={tiles:e.tiles,tileInfo:null!=e.tileInfo?e.tileInfo.toJSON():null,tileSize:e.tileSize};await this._updatingHandles.addPromise(this._workerHandle.invokeMethod("updateTiles",n,t)),this._updatingHandles.addPromise(this._workerHandle.invokeMethod("whenNotUpdating",{},t))}async handleEdits({historicMoment:e,addedFeatures:t,deletedFeatures:n,updatedFeatures:r},s){const i={historicMoment:e,addedFeatures:t?.map((({objectId:e})=>e)).filter(U.Ru)??[],deletedFeatures:n?.map((({objectId:e,globalId:t})=>({objectId:e,globalId:t})))??[],updatedFeatures:r?.map((({objectId:e})=>e)).filter(U.Ru)??[]};await this._updatingHandles.addPromise(this._workerHandle.invokeMethod("handleEdits",i,s)),this._updatingHandles.addPromise(this._workerHandle.invokeMethod("whenNotUpdating",{},s))}async setHistoricMoment(e,t){await this._updatingHandles.addPromise(this._workerHandle.invokeMethod("setHistoricMoment",{moment:e},t))}getDebugInfo(e){return this._workerHandle.invokeMethod("getDebugInfo",{},e)}async notifyElevationSourceChange(){await this._workerHandle.invokeMethod("notifyElevationSourceChange",{})}async notifySymbologyChange(){await this._workerHandle.invokeMethod("notifySymbologyChange",{})}async setSymbologySnappingSupported(e){await this._workerHandle.invokeMethod("setSymbologySnappingSupported",e)}async setSuspended(e){this._suspendController?.abort(),this._suspendController=new AbortController,await this._workerHandle.invokeMethod("setSuspended",e,this._suspendController.signal)}};function K(e){return{filter:null!=e.filter?e.filter.toJSON():null,customParameters:e.customParameters,viewType:e.viewType}}(0,r._)([(0,u.MZ)({constructOnly:!0})],B.prototype,"schedule",void 0),(0,r._)([(0,u.MZ)({constructOnly:!0})],B.prototype,"hasZ",void 0),(0,r._)([(0,u.MZ)({constructOnly:!0})],B.prototype,"elevationAlignPointsInFeatures",void 0),(0,r._)([(0,u.MZ)({constructOnly:!0})],B.prototype,"queryForSymbologySnapping",void 0),(0,r._)([(0,u.MZ)({readOnly:!0})],B.prototype,"updating",null),(0,r._)([(0,u.MZ)({readOnly:!0})],B.prototype,"availability",void 0),(0,r._)([(0,u.MZ)()],B.prototype,"_workerHandleUpdating",void 0),B=(0,r._)([(0,d.$)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceSnappingSourceWorkerHandle")],B);class Y extends $.B{constructor(e,t){super("FeatureServiceSnappingSourceWorker","fetchCandidates",{},e,{strategy:"dedicated",client:t})}}var X=n(45532),ee=n(44431),te=n(76226);let ne=class extends s.A{get tiles(){return[new g.U("0/0/0",0,0,0,(0,N.fA)(-1e8,-1e8,1e8,1e8))]}get tileInfo(){return new te.default({origin:new X.default({x:-1e8,y:1e8,spatialReference:this.layer.spatialReference}),size:[512,512],lods:[new ee.A({level:0,scale:1,resolution:390625})],spatialReference:this.layer.spatialReference})}get tileSize(){return this.tileInfo.size[0]}constructor(e){super(e),this.pointOfInterest=null}};(0,r._)([(0,u.MZ)({readOnly:!0})],ne.prototype,"tiles",null),(0,r._)([(0,u.MZ)({readOnly:!0})],ne.prototype,"tileInfo",null),(0,r._)([(0,u.MZ)({readOnly:!0})],ne.prototype,"tileSize",null),(0,r._)([(0,u.MZ)({constructOnly:!0})],ne.prototype,"layer",void 0),(0,r._)([(0,u.MZ)()],ne.prototype,"pointOfInterest",void 0),ne=(0,r._)([(0,d.$)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTilesSimple")],ne);var re=n(16164);let se=class extends s.A{get _updateTilesParameters(){return{tiles:this._tilesOfInterest.tiles,tileInfo:this._tilesOfInterest.tileInfo,tileSize:this._tilesOfInterest.tileSize}}get _layerView(){return this.view?.allLayerViews.find((e=>e.layer===this._layer))}get _isSuspended(){return!(!(0,p.F2)(this._layer)||this.layerSource.sublayerSources.some((e=>e.enabled&&e.layer.visible)))||!(!this.view||!1===this._layerView?.suspended&&this.layerSource.enabled)}get updating(){return this._workerHandle?.updating||this._updatingHandles.updating}get _outFields(){const{view:e,_layerView:t,layerSource:n}=this,{layer:r}=n,{fieldsIndex:s,timeInfo:i,floorInfo:o,subtypeField:a}=r,l=t&&"filter"in t?t.filter:null,c=l?.where&&"1=1"!==l.where?this._getOrLoadWhereFields(l.where,s):[];if(l?.timeExtent&&i){const{startField:e,endField:t}=i,n=s.get(e)?.name??e,r=s.get(t)?.name??t;n&&c.push(n),r&&c.push(r)}if(e?.map&&(0,E.Tu)(e.map)&&e.map.utilityNetworks?.find((e=>e.isUtilityLayer(r)))){const e=r.fieldsIndex.get("assetGroup")?.name,t=r.fieldsIndex.get("assetType")?.name;e&&t&&(c.push(e),c.push(t))}if(r&&o?.floorField&&e?.floors?.length){const e=s.get(o.floorField)?.name??o.floorField;e&&c.push(e)}if(a){const e=s.get(a)?.name??a;e&&c.push(e)}return new Set(c)}get configuration(){const{view:e}=this,{apiKey:t,customParameters:n}=this._layer,r=null!=e?e.type:"2d";return{filter:this._layer.createQuery(),customParameters:t?{...n,token:t}:n,viewType:r}}get availability(){return this._workerHandle?.availability??0}get _layer(){return this.layerSource.layer}constructor(e){super(e),this._updatingHandles=new h.U,this._workerHandle=null,this._debug=null,this._memoizedMakeGetGroundElevation=(0,a.B)(A.p)}initialize(){let e;const t=this.view;if(null==t||t.destroyed)this._tilesOfInterest=new ne({layer:this._layer}),e=this._workerHandle=new B;else switch(t.type){case"2d":this._tilesOfInterest=new S({view:t,layer:this._layer}),e=this._workerHandle=new B;break;case"3d":{const{resourceController:n}=t,r=this._layer;this._tilesOfInterest=new I({view:t}),e=this._workerHandle=new B({schedule:e=>n.immediate.schedule(e),hasZ:this._layer.hasZ&&(this._layer.returnZ??!0),elevationAlignPointsInFeatures:async(e,n)=>{const s=await t.whenLayerView(r);return(0,l.Te)(n),s.elevationAlignPointsInFeatures(e,n)},queryForSymbologySnapping:async(e,n)=>{const s=await t.whenLayerView(r);return(0,l.Te)(n),s.queryForSymbologySnapping(e,n)}}),this.addHandles([t.elevationProvider.on("elevation-change",(({context:t})=>{const{elevationInfo:n}=r;(0,f.Up)(t,n)&&(0,l.QZ)(e.notifyElevationSourceChange())})),(0,c.watch)((()=>r.elevationInfo),(()=>(0,l.QZ)(e.notifyElevationSourceChange())),c.Vh),(0,c.watch)((()=>this._layerView?.layer?.renderer),(()=>(0,l.QZ)(e.notifySymbologyChange())),c.Vh),(0,c.watch)((()=>this._layerView?.symbologySnappingSupported??!1),(t=>(0,l.QZ)(e.setSymbologySnappingSupported(t))),c.Vh),(0,c.on)((()=>this._layerView?.layer),["edits","apply-edits","graphic-update"],(()=>e.notifySymbologyChange()))]);break}}this.addHandles([(0,o.DQ)(e)]),(0,l.QZ)(e.setup({layer:this._layer,spatialReference:this.spatialReference,configuration:this.configuration},null)),this._updatingHandles.add((()=>this._updateTilesParameters),(()=>(0,l.QZ)(e.updateTiles(this._updateTilesParameters,null))),c.Vh),this.addHandles([(0,c.watch)((()=>this.configuration),(t=>(0,l.QZ)(e.configure(t,null))),c.OH),(0,c.watch)((()=>this._layer.historicMoment),(t=>(0,l.QZ)(e.setHistoricMoment(t))),c.pc),(0,c.watch)((()=>this._outFields),(t=>(0,l.QZ)(e.updateOutFields(t))),c.Vh),(0,c.watch)((()=>this._isSuspended),(t=>(0,l.QZ)(e.setSuspended(t))),c.pc)]),null!=t&&this.addHandles((0,c.watch)((()=>re.A.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES),(n=>{n&&!this._debug?(this._debug=new q({view:t,handle:e}),this.addHandles((0,o.DQ)(this._debug),"debug")):!n&&this._debug&&this.removeHandles("debug")}),c.Vh)),this.addHandles([this.layerSource.layer.on("edits",(t=>(0,l.QZ)(e.handleEdits(t,null)))),this.layerSource.layer.on("apply-edits",(e=>this._updatingHandles.addPromise(e.result)))])}destroy(){this._updatingHandles.destroy()}refresh(){this._workerHandle?.refresh(null)}async fetchCandidates(e,t){const{coordinateHelper:n,point:r}=e;this._tilesOfInterest.pointOfInterest=n.arrayToPoint(r);const s=this._memoizedMakeGetGroundElevation(this.view,n.spatialReference);return(await this._workerHandle.fetchCandidates({...e},t)).candidates.map((e=>(0,A.$)(e,s)))}getDebugInfo(e){return this._workerHandle.getDebugInfo(e)}_getOrLoadWhereFields(e,t){const{_whereModule:r}=this;if(!this._loadWhereModuleTask&&!r){const e=(0,i.UT)((async()=>{const e=await n.e(2416).then(n.bind(n,16177));return this._whereModule=e.WhereClause,this._whereModule}));return this._loadWhereModuleTask=e,this._updatingHandles.addPromise(e.promise),[]}if(!r)return[];try{return r.create(e,{fieldsIndex:t}).fieldNames}catch(e){return[]}}};(0,r._)([(0,u.MZ)({constructOnly:!0})],se.prototype,"spatialReference",void 0),(0,r._)([(0,u.MZ)({constructOnly:!0})],se.prototype,"layerSource",void 0),(0,r._)([(0,u.MZ)({constructOnly:!0})],se.prototype,"view",void 0),(0,r._)([(0,u.MZ)()],se.prototype,"_tilesOfInterest",void 0),(0,r._)([(0,u.MZ)({readOnly:!0})],se.prototype,"_updateTilesParameters",null),(0,r._)([(0,u.MZ)()],se.prototype,"_layerView",null),(0,r._)([(0,u.MZ)()],se.prototype,"_isSuspended",null),(0,r._)([(0,u.MZ)({readOnly:!0})],se.prototype,"updating",null),(0,r._)([(0,u.MZ)()],se.prototype,"_outFields",null),(0,r._)([(0,u.MZ)({readOnly:!0})],se.prototype,"configuration",null),(0,r._)([(0,u.MZ)({readOnly:!0})],se.prototype,"availability",null),(0,r._)([(0,u.MZ)()],se.prototype,"_loadWhereModuleTask",void 0),(0,r._)([(0,u.MZ)()],se.prototype,"_whereModule",void 0),se=(0,r._)([(0,d.$)("esri.views.interactive.snapping.featureSources.FeatureServiceSnappingSource")],se)},94750:function(e,t,n){n.d(t,{$:function(){return l},p:function(){return c}});var r=n(28397),s=n(52511),i=n(42937),o=n(31392);function a({x:e,y:t,z:n}){return(0,r.fA)(e,t,n??0)}function l(e,t){switch(e.type){case"edge":return e.draped?new s.X({edgeStart:a(e.start),edgeEnd:a(e.end),targetPoint:(0,r.de)(a(e.target)),objectId:e.objectId,getGroundElevation:t}):new i.z({edgeStart:a(e.start),edgeEnd:a(e.end),targetPoint:(0,r.de)(a(e.target)),objectId:e.objectId,isDraped:!1});case"vertex":return new o.C({targetPoint:(0,r.de)(a(e.target)),objectId:e.objectId,isDraped:!1})}}function c(e,t){return null!=e&&"3d"===e.type?(n,r)=>e.elevationProvider.getElevation(n,r,0,t,"ground"):()=>null}},96942:function(e,t,n){n.d(t,{_:function(){return i}});var r=n(20551),s=n(94612);class i extends s.m{constructor(e,t,n){super(t,n),this.point=e}equals(e){return e instanceof i&&(0,r.p)(this.point,e.point)}}},16164:function(e,t,n){n.d(t,{A:function(){return l}});var r=n(53804),s=n(83525),i=n(23502),o=(n(58941),n(40633),n(13798),n(65953));let a=class extends s.A{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};(0,r._)([(0,i.MZ)()],a.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),(0,r._)([(0,i.MZ)()],a.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),a=(0,r._)([(0,o.$)("esri.views.support.debugFlags")],a);const l=new a}}]);
//# sourceMappingURL=featureSources-FeatureServiceSnappingSource.js.map