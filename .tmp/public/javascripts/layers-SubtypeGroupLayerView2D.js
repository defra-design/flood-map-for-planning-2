"use strict";(self.webpackChunkdefra=self.webpackChunkdefra||[]).push([[5749,6498],{59122:function(e,t,i){function n(e,t,i){i=i||2;var n,s,a,l,u,c,d,f=t&&t.length,p=f?t[0]*i:e.length,m=r(e,0,p,i,!0),_=[];if(!m||m.next===m.prev)return _;if(f&&(m=h(e,t,m,i)),e.length>80*i){n=a=e[0],s=l=e[1];for(var g=i;g<p;g+=i)(u=e[g])<n&&(n=u),(c=e[g+1])<s&&(s=c),u>a&&(a=u),c>l&&(l=c);d=0!==(d=Math.max(a-n,l-s))?1/d:0}return o(m,_,i,n,s,d),_}function r(e,t,i,n,r){var s,o;if(r===R(e,t,i,n)>0)for(s=t;s<i;s+=n)o=A(s,e[s],e[s+1],o);else for(s=i-n;s>=t;s-=n)o=A(s,e[s],e[s+1],o);if(o&&S(o,o.next)){var a=o.next;C(o),o=a}return o}function s(e,t){if(!e)return e;t||(t=e);var i,n=e;do{if(i=!1,n.steiner||!S(n,n.next)&&0!==b(n.prev,n,n.next))n=n.next;else{var r=n.prev;if(C(n),(n=t=r)===n.next)break;i=!0}}while(i||n!==t);return t}function o(e,t,i,n,r,h,d){if(e){!d&&h&&_(e,n,r,h);for(var f,p,m=e;e.prev!==e.next;)if(f=e.prev,p=e.next,h?l(e,n,r,h):a(e))t.push(f.i/i),t.push(e.i/i),t.push(p.i/i),C(e),e=p.next,m=p.next;else if((e=p)===m){d?1===d?o(e=u(s(e),t,i),t,i,n,r,h,2):2===d&&c(e,t,i,n,r,h):o(s(e),t,i,n,r,h,1);break}}}function a(e){var t=e.prev,i=e,n=e.next;if(b(t,i,n)>=0)return!1;for(var r=e.next.next;r!==e.prev;){if(v(t.x,t.y,i.x,i.y,n.x,n.y,r.x,r.y)&&b(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function l(e,t,i,n){var r=e.prev,s=e,o=e.next;if(b(r,s,o)>=0)return!1;for(var a=r.x<s.x?r.x<o.x?r.x:o.x:s.x<o.x?s.x:o.x,l=r.y<s.y?r.y<o.y?r.y:o.y:s.y<o.y?s.y:o.y,u=r.x>s.x?r.x>o.x?r.x:o.x:s.x>o.x?s.x:o.x,c=r.y>s.y?r.y>o.y?r.y:o.y:s.y>o.y?s.y:o.y,h=g(a,l,t,i,n),d=g(u,c,t,i,n),f=e.prevZ,p=e.nextZ;f&&f.z>=h&&p&&p.z<=d;){if(f!==e.prev&&f!==e.next&&v(r.x,r.y,s.x,s.y,o.x,o.y,f.x,f.y)&&b(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,p!==e.prev&&p!==e.next&&v(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&b(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;f&&f.z>=h;){if(f!==e.prev&&f!==e.next&&v(r.x,r.y,s.x,s.y,o.x,o.y,f.x,f.y)&&b(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;p&&p.z<=d;){if(p!==e.prev&&p!==e.next&&v(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&b(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function u(e,t,i){var n=e;do{var r=n.prev,o=n.next.next;!S(r,o)&&w(r,n,n.next,o)&&I(r,o)&&I(o,r)&&(t.push(r.i/i),t.push(n.i/i),t.push(o.i/i),C(n),C(n.next),n=e=o),n=n.next}while(n!==e);return s(n)}function c(e,t,i,n,r,a){var l=e;do{for(var u=l.next.next;u!==l.prev;){if(l.i!==u.i&&x(l,u)){var c=M(l,u);return l=s(l,l.next),c=s(c,c.next),o(l,t,i,n,r,a),void o(c,t,i,n,r,a)}u=u.next}l=l.next}while(l!==e)}function h(e,t,i,n){var o,a,l,u=[];for(o=0,a=t.length;o<a;o++)(l=r(e,t[o]*n,o<a-1?t[o+1]*n:e.length,n,!1))===l.next&&(l.steiner=!0),u.push(y(l));for(u.sort(d),o=0;o<u.length;o++)i=s(i=p(u[o],i),i.next);return i}function d(e,t){return e.x-t.x}function f(e){if(e.next.prev===e)return e;let t=e;for(;;){const i=t.next;if(i.prev===t||i===t||i===e)break;t=i}return t}function p(e,t){var i=function(e,t){var i,n=t,r=e.x,s=e.y,o=-1/0;do{if(s<=n.y&&s>=n.next.y&&n.next.y!==n.y){var a=n.x+(s-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=r&&a>o){if(o=a,a===r){if(s===n.y)return n;if(s===n.next.y)return n.next}i=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!i)return null;if(r===o)return i;var l,u=i,c=i.x,h=i.y,d=1/0;n=i;do{r>=n.x&&n.x>=c&&r!==n.x&&v(s<h?r:o,s,c,h,s<h?o:r,s,n.x,n.y)&&(l=Math.abs(s-n.y)/(r-n.x),I(n,e)&&(l<d||l===d&&(n.x>i.x||n.x===i.x&&m(i,n)))&&(i=n,d=l)),n=n.next}while(n!==u);return i}(e,t);if(!i)return t;var n=M(i,e),r=s(i,i.next);let o=f(n);return s(o,o.next),r=f(r),f(t===i?r:t)}function m(e,t){return b(e.prev,e,t.prev)<0&&b(t.next,e,e.next)<0}function _(e,t,i,n){var r=e;do{null===r.z&&(r.z=g(r.x,r.y,t,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){var t,i,n,r,s,o,a,l,u=1;do{for(i=e,e=null,s=null,o=0;i;){for(o++,n=i,a=0,t=0;t<u&&(a++,n=n.nextZ);t++);for(l=u;a>0||l>0&&n;)0!==a&&(0===l||!n||i.z<=n.z)?(r=i,i=i.nextZ,a--):(r=n,n=n.nextZ,l--),s?s.nextZ=r:e=r,r.prevZ=s,s=r;i=n}s.nextZ=null,u*=2}while(o>1)}(r)}function g(e,t,i,n,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*r)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*r)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function y(e){var t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function v(e,t,i,n,r,s,o,a){return(r-o)*(t-a)-(e-o)*(s-a)>=0&&(e-o)*(n-a)-(i-o)*(t-a)>=0&&(i-o)*(s-a)-(r-o)*(n-a)>=0}function x(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&w(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&(I(e,t)&&I(t,e)&&function(e,t){var i=e,n=!1,r=(e.x+t.x)/2,s=(e.y+t.y)/2;do{i.y>s!=i.next.y>s&&i.next.y!==i.y&&r<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==e);return n}(e,t)&&(b(e.prev,e,t.prev)||b(e,t.prev,t))||S(e,t)&&b(e.prev,e,e.next)>0&&b(t.prev,t,t.next)>0)}function b(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function S(e,t){return e.x===t.x&&e.y===t.y}function w(e,t,i,n){var r=P(b(e,t,i)),s=P(b(e,t,n)),o=P(b(i,n,e)),a=P(b(i,n,t));return r!==s&&o!==a||!(0!==r||!T(e,i,t))||!(0!==s||!T(e,n,t))||!(0!==o||!T(i,e,n))||!(0!==a||!T(i,t,n))}function T(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function P(e){return e>0?1:e<0?-1:0}function I(e,t){return b(e.prev,e,e.next)<0?b(e,t,e.next)>=0&&b(e,e.prev,t)>=0:b(e,t,e.prev)<0||b(e,e.next,t)<0}function M(e,t){var i=new E(e.i,e.x,e.y),n=new E(t.i,t.x,t.y),r=e.next,s=t.prev;return e.next=t,t.prev=e,i.next=r,r.prev=i,n.next=i,i.prev=n,s.next=n,n.prev=s,n}function A(e,t,i,n){var r=new E(e,t,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function C(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function E(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function R(e,t,i,n){for(var r=0,s=t,o=i-n;s<i;s+=n)r+=(e[o]-e[s])*(e[s+1]+e[o+1]),o=s;return r}i.d(t,{e:function(){return n}}),n.deviation=function(e,t,i,n){var r=t&&t.length,s=r?t[0]*i:e.length,o=Math.abs(R(e,0,s,i));if(r)for(var a=0,l=t.length;a<l;a++){var u=t[a]*i,c=a<l-1?t[a+1]*i:e.length;o-=Math.abs(R(e,u,c,i))}var h=0;for(a=0;a<n.length;a+=3){var d=n[a]*i,f=n[a+1]*i,p=n[a+2]*i;h+=Math.abs((e[d]-e[p])*(e[f+1]-e[d+1])-(e[d]-e[f])*(e[p+1]-e[d+1]))}return 0===o&&0===h?0:Math.abs((h-o)/o)},n.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},n=0,r=0;r<e.length;r++){for(var s=0;s<e[r].length;s++)for(var o=0;o<t;o++)i.vertices.push(e[r][s][o]);r>0&&(n+=e[r-1].length,i.holes.push(n))}return i}},67750:function(e,t,i){i.d(t,{A:function(){return P}});const n=[["(",")"],[")","("],["<",">"],[">","<"],["[","]"],["]","["],["{","}"],["}","{"],["«","»"],["»","«"],["‹","›"],["›","‹"],["⁽","⁾"],["⁾","⁽"],["₍","₎"],["₎","₍"],["≤","≥"],["≥","≤"],["〈","〉"],["〉","〈"],["﹙","﹚"],["﹚","﹙"],["﹛","﹜"],["﹜","﹛"],["﹝","﹞"],["﹞","﹝"],["﹤","﹥"],["﹥","﹤"]],r=["آ","أ","إ","ا"],s=["ﻵ","ﻷ","ﻹ","ﻻ"],o=["ﻶ","ﻸ","ﻺ","ﻼ"],a=["ا","ب","ت","ث","ج","ح","خ","د","ذ","ر","ز","س","ش","ص","ض","ط","ظ","ع","غ","ف","ق","ك","ل","م","ن","ه","و","ي","إ","أ","آ","ة","ى","ل","م","ن","ه","و","ي","إ","أ","آ","ة","ى","ی","ئ","ؤ"],l=["ﺍ","ﺏ","ﺕ","ﺙ","ﺝ","ﺡ","ﺥ","ﺩ","ﺫ","ﺭ","ﺯ","ﺱ","ﺵ","ﺹ","ﺽ","ﻁ","ﻅ","ﻉ","ﻍ","ﻑ","ﻕ","ﻙ","ﻝ","ﻡ","ﻥ","ﻩ","ﻭ","ﻱ","ﺇ","ﺃ","ﺁ","ﺓ","ﻯ","ﯼ","ﺉ","ﺅ","ﹰ","ﹲ","ﹴ","ﹶ","ﹸ","ﹺ","ﹼ","ﹾ","ﺀ","ﺉ","ﺅ"],u=["ﺎ","ﺐ","ﺖ","ﺚ","ﺞ","ﺢ","ﺦ","ﺪ","ﺬ","ﺮ","ﺰ","ﺲ","ﺶ","ﺺ","ﺾ","ﻂ","ﻆ","ﻊ","ﻎ","ﻒ","ﻖ","ﻚ","ﻞ","ﻢ","ﻦ","ﻪ","ﻮ","ﻲ","ﺈ","ﺄ","ﺂ","ﺔ","ﻰ","ﯽ","ﺊ","ﺆ","ﹰ","ﹲ","ﹴ","ﹶ","ﹸ","ﹺ","ﹼ","ﹾ","ﺀ","ﺊ","ﺆ"],c=["ﺎ","ﺒ","ﺘ","ﺜ","ﺠ","ﺤ","ﺨ","ﺪ","ﺬ","ﺮ","ﺰ","ﺴ","ﺸ","ﺼ","ﻀ","ﻄ","ﻈ","ﻌ","ﻐ","ﻔ","ﻘ","ﻜ","ﻠ","ﻤ","ﻨ","ﻬ","ﻮ","ﻴ","ﺈ","ﺄ","ﺂ","ﺔ","ﻰ","ﯿ","ﺌ","ﺆ","ﹱ","ﹲ","ﹴ","ﹷ","ﹹ","ﹻ","ﹽ","ﹿ","ﺀ","ﺌ","ﺆ"],h=["ﺍ","ﺑ","ﺗ","ﺛ","ﺟ","ﺣ","ﺧ","ﺩ","ﺫ","ﺭ","ﺯ","ﺳ","ﺷ","ﺻ","ﺿ","ﻃ","ﻇ","ﻋ","ﻏ","ﻓ","ﻗ","ﻛ","ﻟ","ﻣ","ﻧ","ﻫ","ﻭ","ﻳ","ﺇ","ﺃ","ﺁ","ﺓ","ﻯ","ﯾ","ﺋ","ﺅ","ﹰ","ﹲ","ﹴ","ﹶ","ﹸ","ﹺ","ﹼ","ﹾ","ﺀ","ﺋ","ﺅ"],d=["ء","آ","أ","ؤ","إ","ا","ة","د","ذ","ر","ز","و","ى"],f=["ً","ً","ٌ","؟","ٍ","؟","َ","َ","ُ","ُ","ِ","ِ","ّ","ّ","ْ","ْ","ء","آ","آ","أ","أ","ؤ","ؤ","إ","إ","ئ","ئ","ئ","ئ","ا","ا","ب","ب","ب","ب","ة","ة","ت","ت","ت","ت","ث","ث","ث","ث","ج","ج","ج","ج","ح","ح","ح","ح","خ","خ","خ","خ","د","د","ذ","ذ","ر","ر","ز","ز","س","س","س","س","ش","ش","ش","ش","ص","ص","ص","ص","ض","ض","ض","ض","ط","ط","ط","ط","ظ","ظ","ظ","ظ","ع","ع","ع","ع","غ","غ","غ","غ","ف","ف","ف","ف","ق","ق","ق","ق","ك","ك","ك","ك","ل","ل","ل","ل","م","م","م","م","ن","ن","ن","ن","ه","ه","ه","ه","و","و","ى","ى","ي","ي","ي","ي","ﻵ","ﻶ","ﻷ","ﻸ","ﻹ","ﻺ","ﻻ","ﻼ","؟","؟","؟"],p=["ء","ف"],m=["غ","ي"],_=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],g=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],y=10,v=11,x=12,b=18,S=["UBAT_L","UBAT_R","UBAT_EN","UBAT_AN","UBAT_ON","UBAT_B","UBAT_S","UBAT_AL","UBAT_WS","UBAT_CS","UBAT_ES","UBAT_ET","UBAT_NSM","UBAT_LRE","UBAT_RLE","UBAT_PDF","UBAT_LRO","UBAT_RLO","UBAT_BN"],w=[100,0,0,0,0,101,102,103,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,104,4,4,4,0,4,0,4,0,4,4,4,0,0,4,4,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,4,4,0,0,4,4,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,0,105,7,7,106,107],T=[[b,b,b,b,b,b,b,b,b,6,5,6,8,5,b,b,b,b,b,b,b,b,b,b,b,b,b,b,5,5,5,6,8,4,4,v,v,v,4,4,4,4,4,y,9,y,9,9,2,2,2,2,2,2,2,2,2,2,9,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,b,b,b,b,b,b,5,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,9,4,v,v,v,v,4,4,4,4,0,4,4,b,4,4,v,v,2,2,4,0,4,4,4,2,0,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,4,4,4,4,4,4,4,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,1,x,1,x,x,1,x,x,1,x,4,4,4,4,4,4,4,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4,4,4,4,4,1,1,1,1,1,4,4,4,4,4,4,4,4,4,4,4],[3,3,3,3,4,4,4,4,7,v,v,7,9,7,4,4,x,x,x,x,x,x,x,x,x,x,x,7,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,3,3,3,3,3,3,3,3,3,3,v,3,3,7,7,7,x,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,x,x,x,x,x,x,x,3,4,x,x,x,x,x,x,7,7,x,x,4,x,x,x,x,7,7,2,2,2,2,2,2,2,2,2,2,7,7,7,7,7,7],[7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,7,7,x,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,x,x,x,x,x,x,x,x,x,x,x,7,4,4,4,4,4,4,4,4,4,4,4,4,4,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,x,x,x,x,x,x,x,x,x,1,1,4,4,4,4,1,4,4,4,4,4],[8,8,8,8,8,8,8,8,8,8,8,b,b,b,0,1,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,8,5,13,14,15,16,17,9,v,v,v,v,v,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,9,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,8,b,b,b,b,b,4,4,4,4,4,b,b,b,b,b,b,2,0,4,4,2,2,2,2,2,2,y,y,4,4,4,0,2,2,2,2,2,2,2,2,2,2,y,y,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,v,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,4,4,4,4,4,1,x,1,1,1,1,1,1,1,1,1,1,y,1,1,1,1,1,1,1,1,1,1,1,1,1,4,1,1,1,1,1,4,1,4,1,1,4,1,1,4,1,1,1,1,1,1,1,1,1,1,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],[x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,x,x,x,x,x,x,x,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,9,4,9,4,4,9,4,4,4,4,4,4,4,4,4,v,4,4,y,y,4,4,4,4,4,v,v,4,4,4,4,4,7,7,7,7,7,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,4,b],[4,4,4,v,v,v,4,4,4,4,4,y,9,y,9,9,2,2,2,2,2,2,2,2,2,2,9,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,0,0,0,0,0,0,4,4,0,0,0,0,0,0,4,4,0,0,0,0,0,0,4,4,0,0,0,4,4,4,v,v,4,4,4,v,v,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4]];class P{constructor(){this.inputFormat="ILYNN",this.outputFormat="VLNNN",this.sourceToTarget=[],this.targetToSource=[],this.levels=[]}bidiTransform(e,t,i){if(this.sourceToTarget=[],this.targetToSource=[],!e)return"";if(function(e,t,i){$=[],j=[];for(let n=0;n<i;n++)e[n]=n,t[n]=n,$[n]=n}(this.sourceToTarget,this.targetToSource,e.length),!this.checkParameters(t,i))return e;t=this.inputFormat,i=this.outputFormat;let n=e;const a=X,c=H(t.charAt(1)),d=H(i.charAt(1)),p=("I"===t.charAt(0)?"L":t.charAt(0))+c,m=("I"===i.charAt(0)?"L":i.charAt(0))+d,_=t.charAt(2)+i.charAt(2);a.defInFormat=p,a.defOutFormat=m,a.defSwap=_;const g=I(e,p,m,_,a);let y=!1;return"R"===i.charAt(1)?y=!0:"C"!==i.charAt(1)&&"D"!==i.charAt(1)||(y="rtl"===this.checkContextual(g)),this.sourceToTarget=$,this.targetToSource=function(e){const t=new Array(e.length);for(let i=0;i<e.length;i++)t[e[i]]=i;return t}(this.sourceToTarget),W=this.targetToSource,n=t.charAt(3)===i.charAt(3)?g:"S"===i.charAt(3)?function(e,t){if(0===t.length)return"";void 0===e&&(e=!0);const i=(t=String(t)).split("");let n=0,r=1,a=i.length;e||(n=i.length-1,r=-1,a=1);const c=function(e,t,i,n){let r=0;const a=[];let c=0;for(let d=t;d*i<n;d+=i)if(z(e[d])||G(e[d])){if("ل"===e[d]&&V(e,d+i,i,n)){e[d]=Z(e[d+i],0===r?s:o),d+=i,Y(e,d,i,n),a[c]=d,c++,r=0;continue}const t=e[d];1===r?e[d]=F(e,d+i,i,n)?B(e[d]):U(e[d],u):!0===F(e,d+i,i,n)?e[d]=U(e[d],h):e[d]=U(e[d],l),G(t)||(r=1),!0===k(t)&&(r=0)}else r=0;return a}(i,n,r,a);let d="";for(let t=0;t<i.length;t++)O(c,c.length,t)>-1?(q(W,t,!e,-1),$.splice(t,1)):d+=i[t];return d}(y,g):function(e,t){if(0===e.length)return"";void 0===t&&(t=!0);let i="";const n=(e=String(e)).split("");for(let s=0;s<e.length;s++){let o=!1;if(n[s]>="ﹰ"&&n[s]<"\ufeff"){const a=e.charCodeAt(s);n[s]>="ﻵ"&&n[s]<="ﻼ"?(t?(s>0&&" "===n[s-1]?i=i.slice(0,-1)+"ل":(i+="ل",o=!0),i+=r[(a-65269)/2]):(i+=r[(a-65269)/2],i+="ل",s+1<e.length&&" "===n[s+1]?s++:o=!0),o&&(q(W,s,!0,1),$.splice(s,0,$[s]))):i+=f[a-65136]}else i+=n[s]}return i}(g,y),this.sourceToTarget=$,this.targetToSource=W,this.levels=j,n}_inputFormatSetter(e){if(!te.test(e))throw new Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.inputFormat=e}_outputFormatSetter(e){if(!te.test(e))throw new Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.outputFormat=e}checkParameters(e,t){return e?this._inputFormatSetter(e):e=this.inputFormat,t?this._outputFormatSetter(t):t=this.outputFormat,e!==t}checkContextual(e){let t=M(e);if("ltr"!==t&&"rtl"!==t){try{t=document.dir.toLowerCase()}catch(e){}"ltr"!==t&&"rtl"!==t&&(t="ltr")}return t}hasBidiChar(e){return ie.test(e)}}function I(e,t,i,n,r){const s=function(e,t,i){if(void 0===t.inFormat&&(t.inFormat=i.defInFormat),void 0===t.outFormat&&(t.outFormat=i.defOutFormat),void 0===t.swap&&(t.swap=i.defSwap),t.inFormat===t.outFormat)return t;const n=t.inFormat.slice(0,1),r=t.outFormat.slice(0,1);let s,o=t.inFormat.slice(1,4),a=t.outFormat.slice(1,4);return"C"===o.charAt(0)&&(s=M(e),o="ltr"===s||"rtl"===s?s.toUpperCase():"L"===t.inFormat.charAt(2)?"LTR":"RTL",t.inFormat=n+o),"C"===a.charAt(0)&&(s=M(e),"rtl"===s?a="RTL":"ltr"===s?(s=function(e){const t=e.split("");return t.reverse(),M(t.join(""))}(e),a=s.toUpperCase()):a="L"===t.outFormat.charAt(2)?"LTR":"RTL",t.outFormat=r+a),t}(e,{inFormat:t,outFormat:i,swap:n},r);if(s.inFormat===s.outFormat)return e;t=s.inFormat,i=s.outFormat,n=s.swap;const o=t.slice(0,1),a=t.slice(1,4),l=i.slice(0,1),u=i.slice(1,4);if(r.inFormat=t,r.outFormat=i,r.swap=n,"L"===o&&"VLTR"===i){if("LTR"===a)return r.dir=J,A(e,r);if("RTL"===a)return r.dir=ee,A(e,r)}if("V"===o&&"V"===l)return r.dir="RTL"===a?ee:J,R(e,r);if("L"===o&&"VRTL"===i)return"LTR"===a?(r.dir=J,e=A(e,r)):(r.dir=ee,e=A(e,r)),R(e);if("VLTR"===t&&"LLTR"===i)return r.dir=J,A(e,r);if("V"===o&&"L"===l&&a!==u)return e=R(e),"RTL"===a?I(e,"LLTR","VLTR",n,r):I(e,"LRTL","VRTL",n,r);if("VRTL"===t&&"LRTL"===i)return I(e,"LRTL","VRTL",n,r);if("L"===o&&"L"===l){const t=r.swap;return r.swap=t.slice(0,1)+"N","RTL"===a?(r.dir=ee,e=A(e,r),r.swap="N"+t.slice(1,3),r.dir=J,e=A(e,r)):(r.dir=J,e=A(e,r),r.swap="N"+t.slice(1,3),e=I(e,"VLTR","LRTL",r.swap,r)),e}return e}function M(e){const t=/[A-Za-z\u05d0-\u065f\u066a-\u06ef\u06fa-\u07ff\ufb1d-\ufdff\ufe70-\ufefc]/.exec(e);return t?t[0]<="z"?"ltr":"rtl":""}function A(e,t){const i=e.split(""),n=[];return C(i,n,t),function(e,t,i){if(0!==i.hiLevel&&i.swap[0]!==i.swap[1])for(let i=0;i<e.length;i++)1===t[i]&&(e[i]=N(e[i]))}(i,n,t),L(2,i,n,t),L(1,i,n,t),j=n,i.join("")}function C(e,t,i){const n=e.length,r=i.dir?g:_;let s=0,o=-1;const a=[],l=[];i.hiLevel=i.dir,i.lastArabic=!1,i.hasUbatAl=!1,i.hasUbatB=!1,i.hasUbatS=!1;for(let t=0;t<n;t++)a[t]=E(e[t]);for(let u=0;u<n;u++){const n=s,c=D(e,a,l,u,i);l[u]=c,s=r[n][c];const h=240&s;s&=15;const d=r[s][K];if(t[u]=d,h>0)if(16===h){for(let e=o;e<u;e++)t[e]=1;o=-1}else o=-1;if(r[s][Q])-1===o&&(o=u);else if(o>-1){for(let e=o;e<u;e++)t[e]=d;o=-1}5===a[u]&&(t[u]=0),i.hiLevel|=d}i.hasUbatS&&function(e,t,i,n){for(let r=0;r<i;r++)if(6===e[r]){t[r]=n.dir;for(let i=r-1;i>=0&&8===e[i];i--)t[i]=n.dir}}(a,t,n,i)}function E(e){const t=e.charCodeAt(0),i=w[t>>8];return i<100?i:T[i-100][255&t]}function R(e,t){const i=e.split("");if(t){const e=[];C(i,e,t),j=e}return i.reverse(),$.reverse(),i.join("")}function O(e,t,i){for(let n=0;n<t;n++)if(e[n]===i)return n;return-1}function z(e){for(let t=0;t<p.length;t++)if(e>=p[t]&&e<=m[t])return!0;return!1}function F(e,t,i,n){for(;t*i<n&&G(e[t]);)t+=i;return!!(t*i<n&&z(e[t]))}function V(e,t,i,n){for(;t*i<n&&G(e[t]);)t+=i;let s=" ";if(!(t*i<n))return!1;s=e[t];for(let e=0;e<r.length;e++)if(r[e]===s)return!0;return!1}function L(e,t,i,n){if(n.hiLevel<e)return;if(1===e&&n.dir===ee&&!n.hasUbatB)return t.reverse(),void $.reverse();const r=t.length;let s,o,a,l,u,c=0;for(;c<r;){if(i[c]>=e){for(s=c+1;s<r&&i[s]>=e;)s++;for(o=c,a=s-1;o<a;o++,a--)l=t[o],t[o]=t[a],t[a]=l,u=$[o],$[o]=$[a],$[a]=u;c=s}c++}}function D(e,t,i,n,r){const s=t[n];return{UBAT_L:()=>(r.lastArabic=!1,0),UBAT_R:()=>(r.lastArabic=!1,1),UBAT_ON:()=>4,UBAT_AN:()=>3,UBAT_EN:()=>r.lastArabic?3:2,UBAT_AL:()=>(r.lastArabic=!0,r.hasUbatAl=!0,1),UBAT_WS:()=>4,UBAT_CS:()=>{let e,s;return n<1||n+1>=t.length||2!==(e=i[n-1])&&3!==e||2!==(s=t[n+1])&&3!==s?4:(r.lastArabic&&(s=3),s===e?s:4)},UBAT_ES:()=>2===(n>0?i[n-1]:5)&&n+1<t.length&&2===t[n+1]?2:4,UBAT_ET:()=>{if(n>0&&2===i[n-1])return 2;if(r.lastArabic)return 4;let e=n+1;const s=t.length;for(;e<s&&t[e]===v;)e++;return e<s&&2===t[e]?2:4},UBAT_NSM:()=>{if("VLTR"===r.inFormat){const i=t.length;let r=n+1;for(;r<i&&t[r]===x;)r++;if(r<i){const i=e[n].charCodeAt(0),s=i>=1425&&i<=2303||64286===i,o=t[r];if(s&&(1===o||7===o))return 1}}return n<1||5===t[n-1]?4:i[n-1]},UBAT_B:()=>(r.lastArabic=!0,r.hasUbatB=!0,r.dir),UBAT_S:()=>(r.hasUbatS=!0,4),UBAT_LRE:()=>(r.lastArabic=!1,4),UBAT_RLE:()=>(r.lastArabic=!1,4),UBAT_LRO:()=>(r.lastArabic=!1,4),UBAT_RLO:()=>(r.lastArabic=!1,4),UBAT_PDF:()=>(r.lastArabic=!1,4),UBAT_BN:()=>4}[S[s]]()}function N(e){let t,i=0,r=n.length-1;for(;i<=r;)if(t=Math.floor((i+r)/2),e<n[t][0])r=t-1;else{if(!(e>n[t][0]))return n[t][1];i=t+1}return e}function k(e){for(let t=0;t<d.length;t++)if(d[t]===e)return!0;return!1}function B(e){for(let t=0;t<a.length;t++)if(e===a[t])return c[t];return e}function U(e,t){for(let i=0;i<a.length;i++)if(e===a[i])return t[i];return e}function G(e){return e>="ً"&&e<="ٕ"}function H(e){return"L"===e?"LTR":"R"===e?"RTL":"C"===e?"CLR":"D"===e?"CRL":""}function Y(e,t,i,n){for(;t*i<n&&G(e[t]);)t+=i;return t*i<n&&(e[t]=" ",!0)}function Z(e,t){for(let i=0;i<r.length;i++)if(e===r[i])return t[i];return e}function q(e,t,i,n){for(let r=0;r<e.length;r++)(e[r]>t||!i&&e[r]===t)&&(e[r]+=n)}let $=[],W=[],j=[];const X={dir:0,defInFormat:"LLTR",defoutFormat:"VLTR",defSwap:"YN",inFormat:"LLTR",outFormat:"VLTR",swap:"YN",hiLevel:0,lastArabic:!1,hasUbatAl:!1,hasBlockSep:!1,hasSegSep:!1,defOutFormat:""},K=5,Q=6,J=0,ee=1,te=/^[(I|V)][(L|R|C|D)][(Y|N)][(S|N)][N]$/,ie=/[\u0591-\u06ff\ufb1d-\ufefc]/},90152:function(e,t,i){i.d(t,{y:function(){return r}});const n=new(i(67750).A);function r(e){if(null==e)return["",!1];if(!n.hasBidiChar(e))return[e,!1];let t;return t="rtl"===n.checkContextual(e)?"IDNNN":"ICNNN",[n.bidiTransform(e,t,"VLYSN"),!0]}},42827:function(e,t,i){i.d(t,{A:function(){return n}});class n{constructor(e){this.size=0,this._start=0,this.maxSize=e,this._buffer=new Array(e)}get entries(){return this._buffer}enqueue(e){if(this.size===this.maxSize){const t=this._buffer[this._start];return this._buffer[this._start]=e,this._start=(this._start+1)%this.maxSize,t}return this._buffer[(this._start+this.size++)%this.maxSize]=e,null}dequeue(){if(0===this.size)return null;const e=this._buffer[this._start];return this._buffer[this._start]=null,this.size--,this._start=(this._start+1)%this.maxSize,e}peek(){return 0===this.size?null:this._buffer[this._start]}peekLast(){return 0===this.size?null:this._buffer[(this._start+(this.size-1))%this.maxSize]}find(e){if(0===this.size)return null;for(const t of this._buffer)if(null!=t&&e(t))return t;return null}clear(e){let t=this.dequeue();for(;null!=t;)e&&e(t),t=this.dequeue()}}},5161:function(e,t,i){i.d(t,{T:function(){return s},U:function(){return r}});var n=i(15774);function r(e,t,i=0){const r=(0,n.qE)(e,0,l);for(let e=0;e<4;e++)t[i+e]=Math.floor(256*u(r*o[e]))}function s(e,t=0){let i=0;for(let n=0;n<4;n++)i+=e[t+n]*a[n];return i}const o=[1,256,65536,16777216],a=[1/256,1/65536,1/16777216,1/4294967296],l=s(new Uint8ClampedArray([255,255,255,255]));function u(e){return e-Math.floor(e)}},80683:function(e,t,i){i.d(t,{Al:function(){return u},NZ:function(){return c},Vb:function(){return r},af:function(){return h},rK:function(){return d}});var n=i(25591);const r="arial-unicode-ms",s="woff2",o=new Map,a=new Set;class l{constructor(e,t){this.fontFace=e,this.promise=t}}async function u(e){const t=f(e),i=d(e),r=o.get(t);if(r)return r.promise;const u=new FontFace(e.family,`url('${n.default.fontsUrl}/woff2/${i}.${s}') format('${s}')`,{style:e.style,weight:e.weight}),c=document.fonts;if(c.has(u)&&"loading"===u.status)return u.loaded;const h=u.load().then((()=>(c.add(u),u)));return o.set(t,new l(u,h)),a.add(u),h}function c(e){return a.has(e)}function h(e){if(!e)return r;const t=e.toLowerCase().split(" ").join("-");switch(t){case"serif":return"noto-serif";case"sans-serif":return"arial-unicode-ms";case"monospace":return"ubuntu-mono";case"fantasy":return"cabin-sketch";case"cursive":return"redressed";default:return t}}function d(e){const t=p(e)+m(e);return h(e.family)+(t.length>0?t:"-regular")}function f(e){const t=p(e)+m(e);return(e.family||r)+(t.length>0?t:"-regular")}function p(e){if(!e.weight)return"";switch(e.weight.toLowerCase()){case"bold":case"bolder":return"-bold"}return""}function m(e){if(!e.style)return"";switch(e.style.toLowerCase()){case"italic":case"oblique":return"-italic"}return""}},43274:function(e,t,i){function n(){return new Float32Array(3)}function r(e){const t=new Float32Array(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function s(e,t,i){const n=new Float32Array(3);return n[0]=e,n[1]=t,n[2]=i,n}function o(){return n()}function a(){return s(1,1,1)}function l(){return s(1,0,0)}function u(){return s(0,1,0)}function c(){return s(0,0,1)}i.d(t,{fA:function(){return s},o8:function(){return r},vt:function(){return n}});const h=o(),d=a(),f=l(),p=u(),m=c();Object.freeze(Object.defineProperty({__proto__:null,ONES:d,UNIT_X:f,UNIT_Y:p,UNIT_Z:m,ZEROS:h,clone:r,create:n,createView:function(e,t){return new Float32Array(e,t,3)},fromValues:s,ones:a,unitX:l,unitY:u,unitZ:c,zeros:o},Symbol.toStringTag,{value:"Module"}))},43745:function(e,t,i){function n(){return new Float32Array(4)}function r(e,t,i,n){const r=new Float32Array(4);return r[0]=e,r[1]=t,r[2]=i,r[3]=n,r}function s(){return n()}function o(){return r(1,1,1,1)}function a(){return r(1,0,0,0)}function l(){return r(0,1,0,0)}function u(){return r(0,0,1,0)}function c(){return r(0,0,0,1)}i.d(t,{fA:function(){return r}});const h=s(),d=o(),f=a(),p=l(),m=u(),_=c();Object.freeze(Object.defineProperty({__proto__:null,ONES:d,UNIT_W:_,UNIT_X:f,UNIT_Y:p,UNIT_Z:m,ZEROS:h,clone:function(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},create:n,createView:function(e,t){return new Float32Array(e,t,4)},fromValues:r,ones:o,unitW:c,unitX:a,unitY:l,unitZ:u,zeros:s},Symbol.toStringTag,{value:"Module"}))},33134:function(e,t,i){i.d(t,{z:function(){return a}});var n=i(21609),r=i(49077),s=i(74697),o=i(76613);class a{static fromOptimized(e,t,i=!1,n=!1,r=1){return(new l).initialize(e,t,i,n,r)}static fromJSON(e,t=!1,i=!1){const[n,r]=c(e);return(new h).initialize(n,r,t,i,1)}static fromOptimizedCIM(e,t,i=!1,n=!1,r=1){return(new d).initialize(e,t,i,n,r)}static fromJSONCIM(e,t=!1,i=!1,n=1){const[r,s]=c(e);return(new f).initialize(r,s,t,i,n)}static fromFeatureSetReader(e){const t=e.readGeometryForDisplay(),i=e.geometryType;return t&&i?this.fromOptimized(t,i):null}static fromFeatureSetReaderCIM(e){const t=e.readGeometryForDisplay(),i=e.geometryType;return t&&i?this.fromOptimizedCIM(t,i):null}static createEmptyOptimized(e,t=!1,i=!1,n=1){return(new l).initialize(new o.A,e,t,i,n)}static createEmptyJSON(e,t=!1,i=!1){return(new h).initialize([],e,t,i,1)}static createEmptyOptimizedCIM(e,t=!1,i=!1,n=1){return(new d).initialize(new o.A,e,t,i,n)}static createEmptyJSONCIM(e,t=!1,i=!1,n=1){return(new f).initialize([],e,t,i,n)}asJSON(){const e=(0,r.x)(this);return"esriGeometryEnvelope"===this.geometryType?{xmin:e[0][0][0],ymin:e[0][0][1],xmax:e[0][2][0],ymax:e[0][2][1]}:"esriGeometryMultipoint"===this.geometryType?{points:e.flat()}:"esriGeometryPoint"===this.geometryType?{x:e[0][0][0],y:e[0][0][1]}:"esriGeometryPolygon"===this.geometryType?{rings:e}:{paths:e}}getCurrentRingArea(){if(this.pathSize<3)return 0;let e,t,i=0;if(this.seekPathStart(),!this.nextPoint())return 0;e=this.x,t=this.y;const n=e,r=t;for(;this.nextPoint();)i+=(e-this.x)*(t+this.y),e=this.x,t=this.y;return i+=(e-n)*(t+r),-.5*i}invertY(){this.yFactor*=-1}}class l extends a{constructor(){super(...arguments),this._end=-1}initialize(e,t,i,n,r){return this.hasZ=i,this.hasM=n,this.geometryType=t,this._stride=2+Number(i)+Number(n),this._geometry=e,this._pathIndex=-1,this._pathOffset=0,this._pointOffset=-this._stride,this._end=-1,this.yFactor=r,this}reset(){this.initialize(this._geometry,this.geometryType,this.hasZ,this.hasM,this.yFactor)}seekPath(e){if(e>=0&&e<this.totalSize){if(this._pathIndex<e)for(;this._pathIndex<e&&this.nextPath(););else if(this._pathIndex>e)for(;this._pathIndex>e&&this.prevPath(););return!0}return!1}seekPathStart(){this._pointOffset=this._pathOffset-this._stride}seekPathEnd(){this._pointOffset=this._end}seekInPath(e){const t=this._pathOffset+e*this._stride;return t>=0&&t<this._end&&(this._pointOffset=t,!0)}nextPoint(){return(this._pointOffset+=this._stride)<this._end}prevPoint(){return(this._pointOffset-=this._stride)>=this._pathOffset}nextPath(){return!(this.pathIndex>=this.totalSize-1||(this._pathIndex>=0&&(this._pathOffset+=this._stride*this.pathSize),this._pathIndex++,this._pointOffset=this._pathOffset-this._stride,this._end=this._pointOffset+this._stride+this._stride*this.pathSize,0))}prevPath(){return!(this.pathIndex<=0||(this._pathIndex--,this._end=this._pathOffset,this._pathOffset-=this._stride*this.pathSize,this._pointOffset=this._pathOffset-this._stride,0))}getCurrentPath(){const e=this._end,t=this._geometry.coords,i=this._pathOffset;return(new l).initialize(new o.A([this.pathSize],t.slice(i,e)),this.geometryType,this.hasZ,this.hasM,this.yFactor)}pathLength(){const e=this._end,t=this._stride,i=this._geometry.coords;let n=0;for(let r=this._pathOffset+t;r<e;r+=t){const e=i[r-t],s=i[r-t+1],o=i[r]-e,a=i[r+1]-s;n+=Math.sqrt(o*o+a*a)}return n}startPath(){this._geometry.lengths.push(0)}pushPath(e){this.startPath(),this.pushPoints(e)}pushPoint(e){for(let t=0;t<this._stride;++t)this._geometry.coords.push(e[t]);this._geometry.lengths[this.totalSize-1]++}pushXY(e,t){this._geometry.coords.push(e,t),this._geometry.lengths[this.totalSize-1]++}pushPoints(e){for(const t of e)for(let e=0;e<this._stride;++e)this._geometry.coords.push(t[e]);this._geometry.lengths[this.totalSize-1]+=e.length}pushCursor(e){const t=e.asOptimized();this._geometry.coords.push(...t.coords),this._geometry.lengths.push(...t.lengths)}asOptimized(){const e=this._geometry.clone();if(1!==this.yFactor)for(let t=1;t<e.coords.length;t+=this._stride)e.coords[t]*=this.yFactor;return"esriGeometryPoint"===this.geometryType&&(e.lengths.length=0),e}isClosed(){const e=this._geometry.coords,t=this._pathOffset,i=this._end-this._stride;for(let n=0;n<this._stride;n++)if(e[t+n]!==e[i+n])return!1;return!0}clone(){return(new l).initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._geometry.isPoint?1:this._geometry.lengths.reduce(((e,t)=>e+t))}get pathSize(){const{lengths:e}=this._geometry;return this._geometry.isPoint?1:this._pathIndex<0||this._pathIndex>e.length-1?0:e[this._pathIndex]}get totalSize(){return this._geometry.isPoint?1:this._geometry.lengths.length}get x(){return this._geometry.coords[this._pointOffset]}set x(e){this._geometry.coords[this._pointOffset]=e}get y(){return this.yFactor*this._geometry.coords[this._pointOffset+1]}set y(e){this._geometry.coords[this._pointOffset+1]=this.yFactor*e}get z(){return this._geometry.coords[this._pointOffset+2]}set z(e){this._geometry.coords[this._pointOffset+2]=e}get m(){const e=this.hasZ?3:2;return this._geometry.coords[this._pointOffset+e]}set m(e){this._geometry.coords[this._pointOffset+3]=e}get pathIndex(){return this._pathIndex}get _coordIndex(){return this._pointOffset/this._stride}}function u(e){const t=[e.x,e.y];return e.z&&t.push(e.z),e.m&&t.push(e.m),t}function c(e){return(0,s.Bi)(e)?[e.rings,"esriGeometryPolygon"]:(0,s.Rg)(e)?[e.paths,"esriGeometryPolyline"]:(0,s.U9)(e)?[[e.points],"esriGeometryMultipoint"]:(0,s.ZC)(e)?[[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]],"esriGeometryEnvelope"]:(0,s.fT)(e)?[[[u(e)]],"esriGeometryPoint"]:[[],"esriGeometryPolyline"]}class h extends a{initialize(e,t,i,n,r){return this._paths=e,this.geometryType=t,this.hasZ=i,this.hasM=n,this._pathIndex=this._pointIndex=-1,this.yFactor=r,this._mIndex=this.hasZ?3:2,this}reset(){this._pathIndex=this._pointIndex=-1}seekPath(e){return this._pathIndex=e,this._pointIndex=-1,e>=0&&e<this.totalSize&&(this._currentPath=this._paths[e],!0)}seekPathStart(){this._pointIndex=-1}seekPathEnd(){this._pointIndex=this._currentPath.length}seekInPath(e){return e>=0&&e<this._currentPath.length&&(this._pointIndex=e,this._currentPoint=this._currentPath[this._pointIndex],!0)}nextPoint(){return this._currentPoint=this._currentPath[++this._pointIndex],this._pointIndex<this._currentPath.length}prevPoint(){return this._currentPoint=this._currentPath[--this._pointIndex],this._pointIndex>=0}nextPath(){return this._pointIndex=-1,this._currentPath=this._paths[++this._pathIndex],this._pathIndex<this.totalSize}prevPath(){return this.pathIndex>0&&(this._pointIndex=-1,this._pathIndex--,this._currentPath=this._paths[this._pathIndex],!0)}pathLength(){const e=this._currentPath.length,t=this._currentPath;let i=0;for(let n=1;n<e;n++){const e=t[n-1],r=t[n],s=e[0],o=e[1],a=r[0]-s,l=r[1]-o;i+=Math.sqrt(a*a+l*l)}return i}startPath(){this._paths.push([])}getCurrentPath(){return(new h).initialize([this._currentPath],this.geometryType,this.hasZ,this.hasM,this.yFactor)}pushPath(e){this._paths.push(e)}pushPoint(e){this._paths[this.totalSize-1].push(e)}pushXY(e,t){this._paths[this.totalSize-1].push([e,t])}pushPoints(e){this._paths[this.totalSize-1].push(...e)}pushCursor(e){const t=(0,r.x)(e);for(const e of t)this.pushPath(e)}asOptimized(){const e=new o.A;if("esriGeometryPoint"===this.geometryType)e.coords.push(...this._paths[0][0]),e.lengths.length=0;else for(const t of this._paths){for(const i of t)e.coords.push(i[0]),e.coords.push(i[1]*this.yFactor),this.hasZ&&e.coords.push(i[2]),this.hasM&&e.coords.push(i[this._mIndex]);e.lengths.push(t.length)}return e}isClosed(){const e=this._currentPath[0],t=this._currentPath[this._currentPath.length-1];for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}clone(){return(new h).initialize((0,n.o8)(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._paths.map((e=>e.length)).reduce(((e,t)=>e+t))}get pathSize(){return this._pathIndex<0||this._pathIndex>this.totalSize-1?-1:this._paths[this._pathIndex].length}get totalSize(){return this._paths.length}get x(){return this._currentPoint[0]}set x(e){this._currentPoint[0]=e}get y(){return this.yFactor*this._currentPoint[1]}set y(e){this._currentPoint[1]=this.yFactor*e}get z(){return this._currentPoint[2]}set z(e){this._currentPoint[2]=e}get m(){return this._currentPoint[this._mIndex]}set m(e){this._currentPoint[this._mIndex]=e}get pathIndex(){return this._pathIndex}}class d extends l{initialize(e,t,i,n,r){return super.initialize(e,t,i,n,r),this._controlPoints||(this._controlPoints=this._controlPoints=new Array(this.totalSize).fill(void 0).map((e=>new Set))),this}startPath(){super.startPath(),this._controlPoints.push(new Set)}clone(){const e=(new d).initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor);return e._controlPoints=this._controlPoints,e}setControlPoint(){this._controlPoints[this.pathIndex].add(this._coordIndex)}getControlPoint(){return this._controlPoints[this.pathIndex].has(this._coordIndex)}setControlPointAt(e){this._controlPoints[this.pathIndex].add(e)}getControlPointAt(e){return this._controlPoints[this.pathIndex].has(e)}}class f extends h{initialize(e,t,i,n,r){return super.initialize(e,t,i,n,r)}clone(){return(new f).initialize((0,n.o8)(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}setControlPoint(){this._paths[this.pathIndex][this._pointIndex][4]=1}getControlPoint(){return 1===this._paths[this.pathIndex][this._pointIndex][4]}setControlPointAt(e){this._paths[this.pathIndex][e][4]=1}getControlPointAt(e){return 1===this._paths[this.pathIndex][e][4]}}},30804:function(e,t,i){i.d(t,{d:function(){return u}});var n=i(87416),r=i(35068),s=i(72228),o=i(38441),a=i(96127);const l=222045e-19;function u(e){if(0===e.totalSize)return null;const t=(0,r.z8)(e);if(!t)return null;const i=4*(Math.abs(t[0])+Math.abs(t[2])+Math.abs(t[1])+Math.abs(t[3])+1)*l;let o=0,a=0;e.reset();for(let t=0;e.nextPath();t++){const i=e.getCurrentRingArea();i>a&&(a=i,o=t)}if(e.seekPath(o),0===e.pathSize)return null;e.seekPathStart();const u=(0,r.B$)(e);if(Math.abs(a)<=2*i*i)return[(u[0]+u[2])/2,(u[1]+u[3])/2];e.seekPathStart();const f=(0,s.w2)(e,(0,n.vt)());if(null===f)return null;if(e.totalPoints<4)return f;const p=[[NaN,NaN],[NaN,NaN],[NaN,NaN],[NaN,NaN]],m=[NaN,NaN,NaN,NaN],_=[NaN,NaN,NaN,NaN];let g=!1,y=h(f,e,!0);0===y.distance&&(g=!0,p[0][0]=f[0],p[0][1]=f[1],y=h(f,e,!1)),m[0]=y.distance,_[0]=0;const v=[NaN,NaN];let w=!1,T=.25,P=-1,I=NaN;do{if(I=NaN,p[1]=d(e,x(u[0],u[2],T),0,t),isNaN(p[1][0])||isNaN(p[1][1])||(y=h(p[1],e,!1),I=y.distance),!isNaN(I)&&I>i&&c(p[1],e))w=!0,m[1]=I,_[1]=b(p[1],f);else if(!isNaN(I)&&I>P&&(P=I,v[0]=p[1][0],v[1]=p[1][1]),T-=.01,T<.1){if(!(P>=0))break;w=!0,m[1]=P,p[1][0]=v[0],p[1][1]=v[1],_[1]=b(p[1],f)}}while(!w);w=!1,T=.5,P=-1;let M=.01,A=1;do{if(I=NaN,p[2]=d(e,x(u[0],u[2],T),0,t),isNaN(p[2][0])||isNaN(p[2][1])||(y=h(p[2],e,!1),I=y.distance),!isNaN(I)&&I>i&&c(p[2],e))w=!0,m[2]=I,_[2]=b(p[2],f);else if(!isNaN(I)&&I>P)P=I,v[0]=p[2][0],v[1]=p[2][1];else if(I>P&&(P=I,v[0]=p[2][0],v[1]=p[2][1]),T=.5+M*A,M+=.01,A*=-1,T<.3||T>.7){if(!(P>=0))break;w=!0,m[2]=P,p[2][0]=v[0],p[2][1]=v[1],_[2]=b(p[2],f)}}while(!w);w=!1,T=.75,P=-1;do{if(I=NaN,p[3]=d(e,x(u[0],u[2],T),0,t),isNaN(p[3][0])||isNaN(p[3][1])||(y=h(p[3],e,!1),I=y.distance),!isNaN(I)&&I>i&&c(p[3],e))w=!0,m[3]=I,_[3]=b(p[3],f);else if(I>P&&(P=I,v[0]=p[3][0],v[1]=p[3][1]),T+=.01,T>.9){if(!(P>=0))break;w=!0,m[3]=P,p[3][0]=v[0],p[3][1]=v[1],_[3]=b(p[3],f)}}while(!w);const C=[0,1,2,3],E=g?0:1;let R;for(let e=E;e<4;e++)for(let e=E;e<3;e++){const t=_[e],i=_[e+1];S(t,i)>0&&(R=C[e],C[e]=C[e+1],C[e+1]=R,_[e]=i,_[e+1]=t)}let O=E,z=0,F=0;for(let e=E;e<4;e++){switch(e){case 0:F=2*m[C[e]];break;case 1:F=1.66666666*m[C[e]];break;case 2:F=1.33333333*m[C[e]];break;case 3:F=m[C[e]]}F>z&&(z=F,O=C[e])}return p[O]}function c(e,t){let i,n,r,s,o=0;for(t.reset();t.nextPath()&&t.nextPoint();)for(i=t.x,n=t.y;t.nextPoint();i=r,n=s)r=t.x,s=t.y,n>e[1]!=s>e[1]&&((r-i)*(e[1]-n)-(s-n)*(e[0]-i)>0?o++:o--);return 0!==o}function h(e,t,i){if(i&&c(e,t))return{coord:e,distance:0};let n=1/0,r=0,s=0,a=[0,0],l=[0,0];const u=[0,0];for(t.reset();t.nextPath()&&t.nextPoint();)if(!(t.pathSize<2))for(a[0]=t.x,a[1]=t.y;t.nextPoint();a=l){l=[t.x,t.y],(0,o.gR)(u,e,a,l);const i=b(e,u);i<n&&(n=i,r=u[0],s=u[1])}return{coord:[r,s],distance:Math.sqrt(n)}}function d(e,t,i,r){const s=[t,0];let o=1/0,l=1/0,u=!1,c=!1;const h=[[t,r[1]-1],[t,r[3]+1]],d=[0,0],p=[0,0],m=[0,0],_=[[0,0],[0,0]],g=(0,n.vt)();for(e.reset();e.nextPath()&&e.nextPoint();)if(!(e.pathSize<2))for(_[0][0]=e.x,_[0][1]=e.y;e.nextPoint();_[0][0]=_[1][0],_[0][1]=_[1][1]){if(_[1][0]=e.x,_[1][1]=e.y,null===f(g,_))continue;if(p[0]=h[0][0],p[1]=h[0][1],m[0]=h[1][0],m[1]=h[1][1],0===y(g,p,m))continue;if(!(0,a.Ql)(h[0],h[1],_[0],_[1],d))continue;const t=d[1];o>l?t<o&&(o=t,u=!0):t<l&&(l=t,c=!0)}return u&&c?s[1]=(o+l)/2:s[0]=s[1]=NaN,s}function f(e,t){if(t.length<2)return null;e||(e=(0,n.vt)());const[i,r]=t[0],[s,o]=t[1];return e[0]=Math.min(i,s),e[1]=Math.min(r,o),e[2]=Math.max(i,s),e[3]=Math.max(r,o),e}const p=1,m=4,_=3,g=12;function y(e,t,i){let n=v(t,e),r=v(i,e);const s=e[0],o=e[1],a=e[2],l=e[3];if(n&r)return 0;if(!(n|r))return 4;const u=(n?1:0)|(r?2:0);do{const u=i[0]-t[0],c=i[1]-t[1];if(u>c)n&_?(n&p?(t[1]+=c*(s-t[0])/u,t[0]=s):(t[1]+=c*(a-t[0])/u,t[0]=a),n=v(t,e)):r&_?(r&p?(i[1]+=c*(s-i[0])/u,i[0]=s):(i[1]+=c*(a-i[0])/u,i[0]=a),r=v(i,e)):n?(n&m?(t[0]+=u*(o-t[1])/c,t[1]=o):(t[0]+=u*(l-t[1])/c,t[1]=l),n=v(t,e)):(r&m?(i[0]+=u*(o-i[1])/c,i[1]=o):(i[0]+=u*(l-i[1])/c,i[1]=l),r=v(i,e));else if(n&g?(n&m?(t[0]+=u*(o-t[1])/c,t[1]=o):(t[0]+=u*(l-t[1])/c,t[1]=l),n=v(t,e)):r&g?(r&m?(i[0]+=u*(o-i[1])/c,i[1]=o):(i[0]+=u*(l-i[1])/c,i[1]=l),r=v(i,e)):n?(n&p?(t[1]+=c*(s-t[0])/u,t[0]=s):(t[1]+=c*(a-t[0])/u,t[0]=a),n=v(t,e)):(r&p?(i[1]+=c*(s-i[0])/u,i[0]=s):(i[1]+=c*(a-i[0])/u,i[0]=a),r=v(i,e)),n&r)return 0}while(n|r);return u}function v(e,t){return(e[0]<t[0]?1:0)|(e[0]>t[2]?1:0)<<1|(e[1]<t[1]?1:0)<<2|(e[1]>t[3]?1:0)<<3}function x(e,t,i){return e+(t-e)*i}function b(e,t){return(e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])}function S(e,t){if(e<t)return-1;if(e>t)return 1;if(e===t)return 0;const i=isNaN(e),n=isNaN(t);return i<n?-1:i>n?1:0}},36729:function(e,t,i){i.d(t,{$B:function(){return d}});var n=i(53804),r=i(83525),s=i(58941),o=i(21609),a=i(40633),l=i(23502),u=i(65953),c=i(70994),h=i(25128);let d=class extends r.A{constructor(e){super(e),this._from=null,this._to=null,this._final=null,this._current=[],this._time=0,this.duration=(0,s.A)("mapview-transitions-duration"),this.effects=[]}set effect(e){if(this._get("effect")!==(e=e||"")){this._set("effect",e);try{this._transitionTo(f(e))}catch(t){this._transitionTo([]),a.A.getLogger(this).warn("Invalid Effect",{effect:e,error:t})}}}get final(){return this._final}get hasEffects(){return this.transitioning||!!this.effects.length}set scale(e){this._updateForScale(e)}get transitioning(){return null!==this._to}canTransitionTo(e){try{return this.scale>0&&p(this._current,f(e),this.scale)}catch{return!1}}transitionStep(e,t){this._applyTimeTransition(e),this._updateForScale(t)}endTransition(){this._applyTimeTransition(this.duration)}_transitionTo(e){this.scale>0&&p(this._current,e,this.scale)?(this._final=e,this._to=(0,o.o8)(e),function(e,t,i){const n=e.length>t.length?e:t,r=e.length>t.length?t:e,s=r[r.length-1],o=s?.scale??i,a=s?.effects??[];for(let e=r.length;e<n.length;e++)r.push({scale:o,effects:[...a]});for(let e=0;e<n.length;e++)r[e].scale=-1===r[e].scale?i:r[e].scale,n[e].scale=-1===n[e].scale?i:n[e].scale,(0,h.O9)(r[e].effects,n[e].effects)}(this._current,this._to,this.scale),this._from=(0,o.o8)(this._current),this._time=0):(this._from=this._to=this._final=null,this._current=e),this._set("effects",this._current[0]?(0,o.o8)(this._current[0].effects):[])}_applyTimeTransition(e){if(!(this._to&&this._from&&this._current&&this._final))return;this._time+=e;const t=Math.min(1,this._time/this.duration);for(let e=0;e<this._current.length;e++){const i=this._current[e],n=this._from[e],r=this._to[e];i.scale=m(n.scale,r.scale,t);for(let e=0;e<i.effects.length;e++){const s=i.effects[e],o=n.effects[e],a=r.effects[e];s.interpolate(o,a,t)}}1===t&&(this._current=this._final,this._set("effects",this._current[0]?(0,o.o8)(this._current[0].effects):[]),this._from=this._to=this._final=null)}_updateForScale(e){if(this._set("scale",e),0===this._current.length)return;const t=this._current,i=this._current.length-1;let n,r,s=1;if(1===t.length||e>=t[0].scale)r=n=t[0].effects;else if(e<=t[i].scale)r=n=t[i].effects;else for(let o=0;o<i;o++){const i=t[o],a=t[o+1];if(i.scale>=e&&a.scale<=e){s=(e-i.scale)/(a.scale-i.scale),n=i.effects,r=a.effects;break}}for(let e=0;e<this.effects.length;e++)this.effects[e].interpolate(n[e],r[e],s)}};function f(e){const t=(0,c.q)(e)||[];return function(e){const t=e[0];return!!t&&"type"in t}(t)?[{scale:-1,effects:t}]:t}function p(e,t,i){return!e[0]?.effects||!t[0]?.effects||!((-1===e[0]?.scale||-1===t[0]?.scale)&&(e.length>1||t.length>1)&&i<=0)&&(0,h.mj)(e[0].effects,t[0].effects)}function m(e,t,i){return e+(t-e)*i}(0,n._)([(0,l.MZ)()],d.prototype,"_to",void 0),(0,n._)([(0,l.MZ)()],d.prototype,"duration",void 0),(0,n._)([(0,l.MZ)({value:""})],d.prototype,"effect",null),(0,n._)([(0,l.MZ)({readOnly:!0})],d.prototype,"effects",void 0),(0,n._)([(0,l.MZ)({readOnly:!0})],d.prototype,"final",null),(0,n._)([(0,l.MZ)({readOnly:!0})],d.prototype,"hasEffects",null),(0,n._)([(0,l.MZ)({value:0})],d.prototype,"scale",null),(0,n._)([(0,l.MZ)({readOnly:!0})],d.prototype,"transitioning",null),d=(0,n._)([(0,u.$)("esri.layers.effects.EffectView")],d)},65215:function(e,t,i){i.d(t,{N3:function(){return s},Om:function(){return r}});var n=i(76613);class r{constructor(e=null,t={},i,n){this.geometry=e,this.attributes=t,this.centroid=i,this.objectId=n,this.displayId=0,this.geohashX=0,this.geohashY=0}static fromJSON(e,t){const i=e.geometry?n.A.fromJSON(e.geometry):null,s=e.centroid?n.A.fromJSON(e.centroid):null,o=e.attributes[t];return new r(i,e.attributes,s,o)}weakClone(){const e=new r(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e.geohashX=this.geohashX,e.geohashY=this.geohashY,e}clone(){const e=this.geometry?.clone(),t=new r(e,{...this.attributes},this.centroid?.clone(),this.objectId);return t.displayId=this.displayId,t.geohashX=this.geohashX,t.geohashY=this.geohashY,t}}function s(e){return!!e.geometry?.coords?.length}},72887:function(e,t,i){i.d(t,{A:function(){return n}});class n{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const e=new n;return e.objectIdFieldName=this.objectIdFieldName,e.globalIdFieldName=this.globalIdFieldName,e.geohashFieldName=this.geohashFieldName,e.geometryProperties=this.geometryProperties,e.geometryType=this.geometryType,e.spatialReference=this.spatialReference,e.hasZ=this.hasZ,e.hasM=this.hasM,e.features=this.features,e.fields=this.fields,e.transform=this.transform,e.exceededTransferLimit=this.exceededTransferLimit,e.uniqueIdField=this.uniqueIdField,e.queryGeometry=this.queryGeometry,e.queryGeometryType=this.queryGeometryType,e}}},76613:function(e,t,i){i.d(t,{A:function(){return n}});class n{constructor(e=[],t=[]){this.lengths=e??[],this.coords=t??[]}static fromJSON(e){return new n(e.lengths,e.coords)}static fromRect(e){const[t,i,r,s]=e,o=r-t,a=s-i;return new n([5],[t,i,o,0,0,a,-o,0,0,-a])}get isPoint(){return 0===this.lengths.length&&this.coords.length>=2}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce(((e,t)=>e+t))}forEachVertex(e){let t=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let i=0;i<this.lengths.length;i++){const n=this.lengths[i];for(let i=0;i<n;i++)e(this.coords[2*(i+t)],this.coords[2*(i+t)+1]);t+=n}}deltaDecode(){const e=this.clone(),{coords:t,lengths:i}=e;let n=0;for(const e of i){for(let i=1;i<e;i++)t[2*(n+i)]+=t[2*(n+i)-2],t[2*(n+i)+1]+=t[2*(n+i)-1];n+=e}return e}clone(e){if(0===this.lengths.length)return new n([],[this.coords[0],this.coords[1]]);const t=2*(0===this.lengths.length?1:this.lengths.reduce(((e,t)=>e+t))),i=this.coords.slice(0,t);return e?(e.set(i),new n(this.lengths,e)):new n(Array.from(this.lengths),Array.from(i))}}},58081:function(e,t,i){i.d(t,{B2:function(){return b},BW:function(){return L},Ch:function(){return re},DF:function(){return w},Di:function(){return Y},E2:function(){return H},IE:function(){return x},Nl:function(){return J},Q4:function(){return se},Rk:function(){return ae},Ux:function(){return q},Ye:function(){return k},ZF:function(){return j},eU:function(){return B},eY:function(){return K},jH:function(){return Q},jQ:function(){return ne},kz:function(){return ee},oN:function(){return Z},q3:function(){return X},qK:function(){return F},qN:function(){return z},z5:function(){return N},zv:function(){return $}});var n=i(39819),r=i(40633),s=i(95929),o=i(24761),a=i(87416),l=i(74697),u=i(65215),c=i(72887),h=i(76613);function d(e,t){return e?t?4:3:t?3:2}const f=()=>r.A.getLogger("esri.layers.graphics.featureConversionUtils"),p={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryMultiPatch:3,esriGeometryEnvelope:0},m=(e,t,i,n,r,s)=>{e[i]=r,e[i+1]=s},_=(e,t,i,n,r,s)=>{e[i]=r,e[i+1]=s,e[i+2]=t[n+2]},g=(e,t,i,n,r,s)=>{e[i]=r,e[i+1]=s,e[i+2]=t[n+3]},y=(e,t,i,n,r,s)=>{e[i]=r,e[i+1]=s,e[i+2]=t[n+2],e[i+3]=t[n+3]};function v(e,t,i,n){if(e){if(i)return t&&n?y:_;if(t&&n)return g}else if(t&&n)return _;return m}function x({scale:e,translate:t},i){return Math.round((i-t[0])/e[0])}function b({scale:e,translate:t},i){return Math.round((t[1]-i)/e[1])}function S({scale:e,translate:t},i,n){return i*e[n]+t[n]}function w(e,t,i){return e?t?i?E(e):I(e):i?A(e):T(e):null}function T(e){const t=e.coords;return{x:t[0],y:t[1]}}function P(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e}function I(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2]}}function M(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e}function A(e){const t=e.coords;return{x:t[0],y:t[1],m:t[2]}}function C(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.m,e}function E(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2],m:t[3]}}function R(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e.coords[3]=t.m,e}function O(e,t){return e&&t?R:e?M:t?C:P}function z(e,t,i=O(null!=t.z,null!=t.m)){return i(e,t)}function F(e,t,i){if(null==e)return null;const n=d(t,i),r=[];for(let t=0;t<e.coords.length;t+=n){const i=[];for(let r=0;r<n;r++)i.push(e.coords[t+r]);r.push(i)}return t?i?{points:r,hasZ:t,hasM:i}:{points:r,hasZ:t}:i?{points:r,hasM:i}:{points:r}}function V(e,t,i=d(t.hasZ,t.hasM)){e.lengths[0]=t.points.length;const n=e.coords;let r=0;for(const e of t.points)for(let t=0;t<i;t++)n[r++]=e[t];return e}function L(e,t,i){if(!e)return null;const n=d(t,i),{coords:r,lengths:s}=e,o=[];let a=0;for(const e of s){const t=[];for(let i=0;i<e;i++){const e=[];for(let t=0;t<n;t++)e.push(r[a++]);t.push(e)}o.push(t)}return t?i?{paths:o,hasZ:t,hasM:i}:{paths:o,hasZ:t}:i?{paths:o,hasM:i}:{paths:o}}function D(e,t,i=d(t.hasZ,t.hasM)){const{lengths:n,coords:r}=e;let s=0;for(const e of t.paths){for(const t of e)for(let e=0;e<i;e++)r[s++]=t[e];n.push(e.length)}return e}function N(e,t,i){if(!e)return null;const n=d(t,i),{coords:r,lengths:s}=e,o=[];let a=0;for(const e of s){const t=[];for(let i=0;i<e;i++){const e=[];for(let t=0;t<n;t++)e.push(r[a++]);t.push(e)}o.push(t)}return t?i?{rings:o,hasZ:t,hasM:i}:{rings:o,hasZ:t}:i?{rings:o,hasM:i}:{rings:o}}function k(e,t,i=t.hasZ,n=t.hasM){return B(e,t.rings,i,n)}function B(e,t,i,n){const r=d(i,n),{lengths:s,coords:o}=e;let a=0;le(e);for(const e of t){for(const t of e)for(let e=0;e<r;e++)o[a++]=t[e];s.push(e.length)}return e}const U=[],G=[];function H(e,t,i,n,r){U[0]=e;const[s]=Y(G,U,t,i,n,r);return ue(U),ue(G),s}function Y(e,t,i,r,s,o){if(ue(e),!i){for(const i of t){const t=o?i.attributes[o]:void 0;e.push(new u.Om(null,i.attributes,null,t))}return e}switch(i){case"esriGeometryPoint":return function(e,t,i,n,r){const s=O(i,n);for(const{geometry:i,attributes:n}of t){const t=null!=i?s(new h.A,i):null;e.push(new u.Om(t,n,null,r?n[r]:void 0))}return e}(e,t,r,s,o);case"esriGeometryMultipoint":return function(e,t,i,n,r){const s=d(i,n);for(const{geometry:i,attributes:n}of t){const t=null!=i?V(new h.A,i,s):null;e.push(new u.Om(t,n,null,r?n[r]:void 0))}return e}(e,t,r,s,o);case"esriGeometryPolyline":return function(e,t,i,n,r){const s=d(i,n);for(const{geometry:i,attributes:n,centroid:o}of t){const t=null!=i?D(new h.A,i,s):null,a=null!=o?z(new h.A,o):null;e.push(new u.Om(t,n,a,r?n[r]:void 0))}return e}(e,t,r,s,o);case"esriGeometryPolygon":case"esriGeometryMultiPatch":return function(e,t,i,n,r){for(const{geometry:s,centroid:o,attributes:a}of t){const t=null!=s?k(new h.A,s,i,n):null,l=r?a[r]:void 0;null!=o?e.push(new u.Om(t,a,P(new h.A,o),l)):e.push(new u.Om(t,a,null,l))}return e}(e,t,r,s,o);default:f().error("convertToFeatureSet:unknown-geometry",new n.A(`Unable to parse unknown geometry type '${i}'`)),ue(e)}return e}function Z(e,t,i,n){G[0]=e,W(U,G,t,i,n);const r=U[0];return ue(U),ue(G),r}function q(e,t,i){if(null==e)return null;const r=new h.A;return"hasZ"in e&&null==t&&(t=e.hasZ),"hasM"in e&&null==i&&(i=e.hasM),(0,l.fT)(e)?O(null!=t?t:null!=e.z,null!=i?i:null!=e.m)(r,e):(0,l.Bi)(e)?k(r,e,t,i):(0,l.Rg)(e)?D(r,e,d(t,i)):(0,l.U9)(e)?V(r,e,d(t,i)):void f().error("convertFromGeometry:unknown-geometry",new n.A(`Unable to parse unknown geometry type '${e}'`))}function $(e,t,i,r){const s=e&&("coords"in e?e:e.geometry);if(null==s)return null;switch(t){case"esriGeometryPoint":{let e=T;return i&&r?e=E:i?e=I:r&&(e=A),e(s)}case"esriGeometryMultipoint":return F(s,i,r);case"esriGeometryPolyline":return L(s,i,r);case"esriGeometryPolygon":return N(s,i,r);default:return f().error("convertToGeometry:unknown-geometry",new n.A(`Unable to parse unknown geometry type '${t}'`)),null}}function W(e,t,i,r,s){if(ue(e),null==i)return function(e,t){for(const i of t)e.push({attributes:i.attributes});return e}(e,t);switch(i){case"esriGeometryPoint":return function(e,t,i,n){let r=T;i&&n?r=E:i?r=I:n&&(r=A);for(const i of t){const{geometry:t,attributes:n}=i,s=null!=t?r(t):null;e.push({attributes:n,geometry:s})}return e}(e,t,r,s);case"esriGeometryMultipoint":return function(e,t,i,n){for(const{geometry:r,attributes:s}of t)e.push({attributes:s,geometry:null!=r?F(r,i,n):null});return e}(e,t,r,s);case"esriGeometryPolyline":return function(e,t,i,n){for(const{geometry:r,attributes:s}of t)e.push({attributes:s,geometry:null!=r?L(r,i,n):null});return e}(e,t,r,s);case"esriGeometryPolygon":return function(e,t,i,n){for(const{geometry:r,attributes:s,centroid:o}of t){const t=null!=r?N(r,i,n):null;if(null!=o){const i=T(o);e.push({attributes:s,centroid:i,geometry:t})}else e.push({attributes:s,geometry:t})}return e}(e,t,r,s);default:f().error("convertToFeatureSet:unknown-geometry",new n.A(`Unable to parse unknown geometry type '${i}'`))}return e}function j(e){const{objectIdFieldName:t,spatialReference:i,transform:n,fields:r,hasM:s,hasZ:o,features:a,geometryType:l,exceededTransferLimit:u,uniqueIdField:c,queryGeometry:h,queryGeometryType:d}=e,f={features:W([],a,l,o,s),fields:r,geometryType:l,objectIdFieldName:t,spatialReference:i,uniqueIdField:c,queryGeometry:$(h,d,!1,!1)};return n&&(f.transform=n),u&&(f.exceededTransferLimit=u),s&&(f.hasM=s),o&&(f.hasZ=o),f}function X(e,t){const i=new c.A,{hasM:r,hasZ:s,features:o,objectIdFieldName:a,spatialReference:l,geometryType:u,exceededTransferLimit:h,transform:d,fields:p}=e;return p&&(i.fields=p),i.geometryType=u??null,i.objectIdFieldName=a??t??null,i.spatialReference=l??null,i.objectIdFieldName?(o&&Y(i.features,o,u,s,r,i.objectIdFieldName),h&&(i.exceededTransferLimit=h),r&&(i.hasM=r),s&&(i.hasZ=s),d&&(i.transform=d),i):(f().error(new n.A("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),i)}function K(e){const{transform:t,features:i,hasM:n,hasZ:r}=e;if(!t)return e;for(const e of i)null!=e.geometry&&re(e.geometry,e.geometry,n,r,t),null!=e.centroid&&re(e.centroid,e.centroid,n,r,t);return e.transform=null,e}function Q(e,t){const{geometryType:i,features:n,hasM:r,hasZ:s}=t;if(!e)return t;for(let t=0;t<n.length;t++){const o=n[t],a=o.weakClone();a.geometry=new h.A,J(a.geometry,o.geometry,r,s,i,e),o.centroid&&(a.centroid=new h.A,J(a.centroid,o.centroid,r,s,"esriGeometryPoint",e)),n[t]=a}return t.transform=e,t}function J(e,t,i,n,r,s,o=i,a=n){if(le(e),!t?.coords.length)return null;const l=p[r],{coords:u,lengths:c}=t,h=d(i,n),f=d(i&&o,n&&a),m=v(i,n,o,a);if(!c.length)return m(e.coords,u,0,0,x(s,u[0]),b(s,u[1])),le(e,h,0),e;let _,g,y,S,w=0,T=0,P=T;for(const t of c){if(t<l)continue;let i=0;T=P,y=_=x(s,u[w]),S=g=b(s,u[w+1]),m(e.coords,u,T,w,y,S),i++,w+=h,T+=f;for(let n=1;n<t;n++,w+=h)y=x(s,u[w]),S=b(s,u[w+1]),y===_&&S===g||(m(e.coords,u,T,w,y-_,S-g),T+=f,i++,_=y,g=S);i>=l&&(e.lengths.push(i),P=T)}return ue(e.coords,P),e.coords.length?e:null}function ee(e,t,i,n,r,s,o=i,a=n){if(le(e),!t?.coords.length)return null;const l=p[r],{coords:u,lengths:c}=t,h=d(i,n),f=d(i&&o,n&&a),m=v(i,n,o,a);if(!c.length)return m(e.coords,u,0,0,u[0],u[1]),le(e,h,0),e;let _=0;const g=s*s;for(const t of c){if(t<l){_+=t*h;continue}const i=e.coords.length/f,n=_,r=_+(t-1)*h;m(e.coords,u,e.coords.length,n,u[n],u[n+1]),ie(e.coords,u,h,g,m,n,r),m(e.coords,u,e.coords.length,r,u[r],u[r+1]);const s=e.coords.length/f-i;s>=l?e.lengths.push(s):ue(e.coords,i*f),_+=t*h}return e.coords.length?e:null}function te(e,t,i,n){const r=e[t],s=e[t+1],o=e[i],a=e[i+1],l=e[n],u=e[n+1];let c=o,h=a,d=l-c,f=u-h;if(0!==d||0!==f){const e=((r-c)*d+(s-h)*f)/(d*d+f*f);e>1?(c=l,h=u):e>0&&(c+=d*e,h+=f*e)}return d=r-c,f=s-h,d*d+f*f}function ie(e,t,i,n,r,s,o){let a,l=n,u=0;for(let e=s+i;e<o;e+=i)a=te(t,e,s,o),a>l&&(u=e,l=a);l>n&&(u-s>i&&ie(e,t,i,n,r,s,u),r(e,t,e.length,u,t[u],t[u+1]),o-u>i&&ie(e,t,i,n,r,u,o))}function ne(e,t,i,n){if(!t?.coords?.length)return null;const r=d(i,n);let s=Number.POSITIVE_INFINITY,l=Number.POSITIVE_INFINITY,u=Number.NEGATIVE_INFINITY,c=Number.NEGATIVE_INFINITY;if(t&&t.coords){const e=t.coords;for(let t=0;t<e.length;t+=r){const i=e[t],n=e[t+1];s=Math.min(s,i),u=Math.max(u,i),l=Math.min(l,n),c=Math.max(c,n)}}return(0,o.is)(e)?(0,o.BI)(e,s,l,u,c):(0,a.fA)(s,l,u,c,e),e}function re(e,t,i,n,r){const{coords:o,lengths:a}=t,l=d(i,n);if(!o.length)return e!==t&&le(e),e;(0,s.Lw)(r);const{originPosition:u,scale:c,translate:h}=r,f=ce;f.originPosition=u;const p=f.scale;p[0]=c[0]??1,p[1]=-(c[1]??1),p[2]=c[2]??1,p[3]=c[3]??1;const m=f.translate;if(m[0]=h[0]??0,m[1]=h[1]??0,m[2]=h[2]??0,m[3]=h[3]??0,!a.length){for(let t=0;t<l;++t)e.coords[t]=S(f,o[t],t);return e!==t&&le(e,l,0),e}let _=0;for(let t=0;t<a.length;t++){const i=a[t];e.lengths[t]=i;for(let t=0;t<l;++t)e.coords[_+t]=S(f,o[_+t],t);let n=e.coords[_],r=e.coords[_+1];_+=l;for(let t=1;t<i;t++,_+=l){n+=o[_]*p[0],r+=o[_+1]*p[1],e.coords[_]=n,e.coords[_+1]=r;for(let t=2;t<l;++t)e.coords[_+t]=S(f,o[_+t],t)}}return e!==t&&le(e,o.length,a.length),e}function se(e,t,i,n,r,s){if(le(e),e.lengths.push(...t.lengths),i===r&&n===s)for(let i=0;i<t.coords.length;i++)e.coords.push(t.coords[i]);else{const o=d(i,n),a=v(i,n,r,s),l=t.coords;for(let t=0;t<l.length;t+=o)a(e.coords,l,e.coords.length,t,l[t],l[t+1])}return e}function oe(e,t,i,n){let r=0,s=e[n*t],o=e[n*(t+1)];for(let a=1;a<i;a++){const i=s+e[n*(t+a)],l=o+e[n*(t+a)+1],u=(i-s)*(l+o);s=i,o=l,r+=u}return.5*r}function ae(e,t){const{coords:i,lengths:n}=e;let r=0,s=0;for(let e=0;e<n.length;e++){const o=n[e];s+=oe(i,r,o,t),r+=o}return Math.abs(s)}function le(e,t=0,i=0){ue(e.lengths,i),ue(e.coords,t)}function ue(e,t=0){e.length!==t&&(e.length=t)}const ce={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]}},45991:function(e,t,i){function n(e){const t=e.layer;return"floorInfo"in t&&t.floorInfo?.floorField&&"floors"in e.view?s(e.view.floors,t.floorInfo.floorField):null}function r(e,t){return"floorInfo"in t&&t.floorInfo?.floorField?s(e,t.floorInfo.floorField):null}function s(e,t){if(!e?.length)return null;const i=e.filter((e=>""!==e)).map((e=>`'${e}'`));return i.push("''"),`${t} IN (${i.join(",")}) OR ${t} IS NULL`}i.d(t,{E:function(){return n},f:function(){return r}})},97357:function(e,t,i){i.d(t,{F:function(){return s}}),i(50659),i(88022),i(21609),i(40633);var n=i(45139),r=i(52038);function s(e,t,i){if(null==e?.timeInfo)return null;const{datesInUnknownTimezone:s=!1,timeOffset:o,useViewTime:a}=e;let l=e.timeExtent;s&&(l=function(e){if(!e)return e;const{start:t,end:i}=e;return new r.A({start:null!=t?(0,n.S1)(t,t.getTimezoneOffset(),"minutes"):t,end:null!=i?(0,n.S1)(i,i.getTimezoneOffset(),"minutes"):i})}(l));let u=a?t&&l?t.intersection(l):t||l:l;return!u||u.isEmpty||u.isAllTime?u:(o&&(u=u.offset(-o.value,o.unit)),s&&(u=function(e){if(!e)return e;const{start:t,end:i}=e;return new r.A({start:null!=t?(0,n.S1)(t,-t.getTimezoneOffset(),"minutes"):t,end:null!=i?(0,n.S1)(i,-i.getTimezoneOffset(),"minutes"):i})}(u)),u.equals(i)?i:u)}i(51928),i(91820)},91820:function(e,t,i){i.d(t,{X:function(){return n}});const n=Symbol("WebScene")},23454:function(e,t,i){i.d(t,{Aq:function(){return r},pC:function(){return s},rx:function(){return o}});var n=i(29076);function r(e,t){e[4]=t}class s{constructor(e,t=!0,i=!0,r=0){this.isClosed=!1,this.geometryCursor=null,this.geometryCursor=!t&&"esriGeometryPolygon"===e.geometryType||!i&&"esriGeometryPolyline"===e.geometryType?null:e,this.geomUnitsPerPoint=r,this.iterateMultiPath=!1,this.iteratePath=!1,this.internalPlacement=new n.W}next(){if(!this.geometryCursor)return null;const e=this.processMultiPath(this.geometryCursor);return this.iterateMultiPath&&e||(this.geometryCursor=null),e}processMultiPath(e){for(;this.iteratePath||e.pathIndex<e.totalSize-1;){this.iteratePath||e.nextPath(),this.iterateMultiPath=!0;const t=this.processPath(e);if(t)return t}return this.iterateMultiPath=!1,null}}class o{constructor(e,t,i,n=0){this.isClosed=!1,this.inputGeometries=e,this.acceptPolygon=t,this.acceptPolyline=i,this.geomUnitsPerPoint=n,this.iteratePath=!1,this.multiPathCursor=null}next(){for(;;){if(!this.multiPathCursor){let e=this.inputGeometries.next();for(;e&&(this.isClosed=this.acceptPolygon&&"esriGeometryPolygon"===e.geometryType||"esriGeometryEnvelope"===e.geometryType,this.multiPathCursor=e,!this.multiPathCursor);)e=this.inputGeometries.next();if(!this.multiPathCursor)return null}for(;this.iteratePath||this.multiPathCursor.nextPath();){this.multiPathCursor.seekPathStart();const e=this.processPath(this.multiPathCursor);if(e)return e}this.multiPathCursor=null}}}},62096:function(e,t,i){i.d(t,{k:function(){return a},q:function(){return l}});var n=i(33134),r=i(72139);const s=512;let o;class a{constructor(e){this._geometry=e}next(){const e=this._geometry;return this._geometry=null,e}}function l(e,t){o||(o=new r.O3(0,0,0,1));const i="esriGeometryPolygon"===e.geometryType,a=i?r.dC.Polygon:r.dC.LineString,l=i?3:2;let u,c;for(o.reset(a),o.setPixelMargin(t+1),o.setExtent(s);e.nextPath();)if(!(e.pathSize<l)){for(e.nextPoint(),u=e.x,c=-e.y,o.moveTo(u,c);e.nextPoint();)u=e.x,c=-e.y,o.lineTo(u,c);i&&o.close()}const h=o.result(!1);if(h){const t=n.z.createEmptyOptimizedCIM(e.geometryType);for(const e of h){t.startPath();for(const i of e)t.pushXY(i.x,-i.y)}return t.reset(),t}return null}},9635:function(e,t,i){i.d(t,{A:function(){return T},c:function(){return P}});var n=i(63514),r=i(82112),s=i(20391),o=i(11672),a=i(12281),l=i(2969),u=i(7889),c=i(48645),h=i(7088),d=i(17706),f=i(10183),p=i(1646),m=i(79323),_=i(34476),g=i(31771),y=i(15987),v=i(19511),x=i(20305),b=i(58892),S=i(80585),w=i(58676);function T(e){if(!e)return null;switch(e.type){case"CIMGeometricEffectAddControlPoints":return n.N.local();case"CIMGeometricEffectArrow":return r.B.local();case"CIMGeometricEffectBuffer":return s.s.local();case"CIMGeometricEffectControlMeasureLine":return o.v.local();case"CIMGeometricEffectCut":return a.y.local();case"CIMGeometricEffectDashes":return l.I.local();case"CIMGeometricEffectDonut":return u.O.local();case"CIMGeometricEffectJog":return c.U.local();case"CIMGeometricEffectMove":return h.V.local();case"CIMGeometricEffectOffset":return d.V.local();case"CIMGeometricEffectReverse":return f.C.local();case"CIMGeometricEffectRotate":return p.v.local();case"CIMGeometricEffectScale":return m.W.local();case"CIMGeometricEffectWave":return _.l.local()}return null}function P(e){if(!e)return null;switch(e.type){case"CIMMarkerPlacementAlongLineSameSize":return g.e.local();case"CIMMarkerPlacementAtExtremities":return y.y.local();case"CIMMarkerPlacementAtRatioPositions":return v.S.local();case"CIMMarkerPlacementInsidePolygon":return x.M.local();case"CIMMarkerPlacementOnLine":return b.R.local();case"CIMMarkerPlacementOnVertices":return S.A.local();case"CIMMarkerPlacementPolygonCenter":return w.L.local()}return null}},29076:function(e,t,i){i.d(t,{W:function(){return n}});class n{constructor(){this.setIdentity()}getAngle(){return(null==this.rz||0===this.rz&&1!==this.rzCos&&0!==this.rzSin)&&(this.rz=Math.atan2(this.rzSin,this.rzCos)),this.rz}setIdentity(){this.tx=0,this.ty=0,this.tz=0,this.s=1,this.rx=0,this.ry=0,this.rz=0,this.rzCos=1,this.rzSin=0}setTranslate(e,t){this.tx=e,this.ty=t}setTranslateZ(e){this.tz=e}setRotateCS(e,t){this.rz=void 0,this.rzCos=e,this.rzSin=t}setRotate(e){this.rz=e,this.rzCos=void 0,this.rzSin=void 0}setRotateY(e){this.ry=e}setScale(e){this.s=e}setMeasure(e){this.m=e}}},14817:function(e,t,i){i.d(t,{Rj:function(){return L},mx:function(){return F},CK:function(){return V},IT:function(){return O},QF:function(){return B}});var n=i(80683),r=i(58941),s=i(21609),o=i(40633),a=i(56996),l=i(13520),u=i(33134),c=i(87416),h=i(35068),d=i(72228),f=i(74697),p=i(62096);class m{applyColorSubstitution(e,t){if(!t)return e;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const{width:i,height:n}=e,r=this._rasterizationCanvas,s=r.getContext("2d",{willReadFrequently:!0});e!==r&&(r.width=i,r.height=n,s.drawImage(e,0,0,i,n));const o=s.getImageData(0,0,i,n).data;if(t)for(const e of t)if(e&&e.oldColor&&4===e.oldColor.length&&e.newColor&&4===e.newColor.length){const[t,i,n,r]=e.oldColor,[s,a,l,u]=e.newColor;if(t===s&&i===a&&n===l&&r===u)continue;for(let e=0;e<o.length;e+=4)t===o[e]&&i===o[e+1]&&n===o[e+2]&&r===o[e+3]&&(o[e]=s,o[e+1]=a,o[e+2]=l,o[e+3]=u)}const a=new ImageData(o,i,n);return s.putImageData(a,0,0),r}tintImageData(e,t){if(!t||t.length<4)return e;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const{width:i,height:n}=e,r=this._rasterizationCanvas,s=r.getContext("2d",{willReadFrequently:!0});e!==r&&(r.width=i,r.height=n,s.drawImage(e,0,0,i,n));const o=s.getImageData(0,0,i,n),a=new Uint8Array(o.data),l=[t[0]/255,t[1]/255,t[2]/255,t[3]/255];for(let e=0;e<a.length;e+=4)a[e]*=l[0],a[e+1]*=l[1],a[e+2]*=l[2],a[e+3]*=l[3];const u=new ImageData(new Uint8ClampedArray(a.buffer),i,n);return s.putImageData(u,0,0),r}}var _=i(9635),g=i(29076),y=i(38821),v=i(33389);function x(e){const t=e.getFrame(0);if(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement)return t;const i=document.createElement("canvas");i.width=e.width,i.height=e.height;const n=i.getContext("2d");return t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0),i}var b=i(82497),S=i(64303);function w(e){return`rgba(${e.slice(0,3).toString()},${e[3]})`}class T{constructor(e){e&&(this._textRasterizationCanvas=e)}rasterizeText(e,t){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const i=this._textRasterizationCanvas,n=i.getContext("2d",{willReadFrequently:!0});P(n,t),this._parameters=t,this._textLines=e.split(/\r?\n/),this._lineHeight=this._computeLineHeight();const{decoration:r,weight:s}=t.font;this._lineThroughWidthOffset=r&&"line-through"===r?.1*this._lineHeight:0;const o=null!=t.backgroundColor||null!=t.borderLine,a=o?S.y7:0,l=this._computeTextWidth(n,t)+2*a,u=this._lineHeight*this._textLines.length+2*a;if(i.width=l+2*this._lineThroughWidthOffset,i.height=u,0===i.width||0===i.height)return i.width=i.height=1,{size:[0,0],image:new Uint32Array(0),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0,canvas:i};this._renderedLineHeight=Math.round(this._lineHeight),this._renderedOutlineSize=(t.outline.size||0)*t.pixelRatio,this._renderedHaloSize=(t.halo.size||0)*t.pixelRatio,this._renderedWidth=l,this._renderedHeight=u,this._lineThroughWidthOffset*=t.pixelRatio;const c=(t.outline&&t.outline.color)??[0,0,0,0],h=t.color??[0,0,0,0],d=t.halo&&t.halo.color?t.halo.color:[0,0,0,0];this._fillStyle=w(h),this._outlineStyle=w(c),this._haloStyle=function(e){return`rgb(${e.slice(0,3).toString()})`}(d);const f=this._renderedLineHeight,p=this._renderedOutlineSize,m=this._renderedHaloSize;n.save(),n.clearRect(0,0,i.width,i.height),P(n,t);const _=a*t.pixelRatio,g=function(e,t,i){return"center"===e?.5*t:"right"===e?t-i:i}(n.textAlign,this._renderedWidth-2*_,this._renderedHaloSize+this._renderedOutlineSize)+_,y=m+p+_,v=m>0;let x=this._lineThroughWidthOffset,b=0;if(o){n.save();const e=t.backgroundColor??[0,0,0,0],r=t.borderLine?.color??[0,0,0,0],s=2*(t.borderLine?.size??0);n.fillStyle=w(e),n.strokeStyle=w(r),n.lineWidth=s,n.fillRect(0,0,i.width,i.height),n.strokeRect(0,0,i.width,i.height),n.restore()}v&&this._renderHalo(n,g,y,x,b,t),p>0&&this._renderOutline(n,g,y,x,b,t),b+=y,x+=g;for(const e of this._textLines)v?(n.globalCompositeOperation="destination-out",n.fillStyle="rgb(0, 0, 0)",n.fillText(e,x,b),n.globalCompositeOperation="source-over",n.fillStyle=this._fillStyle,n.fillText(e,x,b)):(n.fillStyle=this._fillStyle,n.fillText(e,x,b)),r&&"none"!==r&&this._renderDecoration(n,x,b,r,s),b+=f;n.restore();const T=this._renderedWidth+2*this._lineThroughWidthOffset,I=this._renderedHeight,M=n.getImageData(0,0,T,I),A=new Uint8Array(M.data);if(t.premultiplyColors){let e;for(let t=0;t<A.length;t+=4)e=A[t+3]/255,A[t]=A[t]*e,A[t+1]=A[t+1]*e,A[t+2]=A[t+2]*e}let C,E;switch(t.horizontalAlignment){case"left":C=-.5;break;case"right":C=.5;break;default:C=0}switch(t.verticalAlignment){case"bottom":E=-.5;break;case"top":E=.5;break;case"baseline":E=-1/6;break;default:E=0}return{size:[T,I],image:new Uint32Array(A.buffer),sdf:!1,simplePattern:!1,anchorX:C,anchorY:E,canvas:i}}_renderHalo(e,t,i,n,r,s){const o=this._renderedWidth,a=this._renderedHeight;this._outlineRasterizationCanvas||(this._outlineRasterizationCanvas=document.createElement("canvas")),this._outlineRasterizationCanvas.width=o,this._outlineRasterizationCanvas.height=a;const l=this._outlineRasterizationCanvas,u=l.getContext("2d");u.clearRect(0,0,o,a),P(u,s);const{decoration:c,weight:h}=s.font;u.fillStyle=this._haloStyle,u.strokeStyle=this._haloStyle,u.lineJoin="round",this._renderOutlineNative(u,t,i,c,h,this._renderedHaloSize+this._renderedOutlineSize),e.globalAlpha=this._parameters.halo.color[3],e.drawImage(l,0,0,o,a,n,r,o,a),e.globalAlpha=1}_renderOutline(e,t,i,n,r,s){const o=this._renderedWidth,a=this._renderedHeight;this._outlineRasterizationCanvas||(this._outlineRasterizationCanvas=document.createElement("canvas")),this._outlineRasterizationCanvas.width=o,this._outlineRasterizationCanvas.height=a;const l=this._outlineRasterizationCanvas,u=l.getContext("2d");u.clearRect(0,0,o,a),P(u,s);const{decoration:c,weight:h}=s.font;u.fillStyle=this._outlineStyle,u.strokeStyle=this._outlineStyle,u.lineJoin="round",this._renderOutlineNative(u,t,i,c,h,this._renderedOutlineSize),e.globalAlpha=this._parameters.outline.color[3],e.drawImage(l,0,0,o,a,n,r,o,a),e.globalAlpha=1}_renderOutlineNative(e,t,i,n,r,s){const o=this._renderedLineHeight;for(const a of this._textLines){const l=2*s,u=5,c=.1;for(let s=0;s<u;s++){const o=(1-(u-1)*c+s*c)*l;e.lineWidth=o,e.strokeText(a,t,i),n&&"none"!==n&&this._renderDecoration(e,t,i,n,r,o)}i+=o}}computeTextSize(e,t){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const i=this._textRasterizationCanvas,n=i.getContext("2d");P(n,t),this._parameters=t,this._textLines=e.split(/\r?\n/),this._lineHeight=this._computeLineHeight();const r=this._computeTextWidth(n,t),s=this._lineHeight*this._textLines.length;return i.width=r,i.height=s,[r*t.pixelRatio,s*t.pixelRatio]}_computeTextWidth(e,t){let i=0;for(const t of this._textLines)i=Math.max(i,e.measureText(t).width);const n=t.font;return("italic"===n.style||"oblique"===n.style||"string"==typeof n.weight&&("bold"===n.weight||"bolder"===n.weight)||"number"==typeof n.weight&&n.weight>600)&&(i+=.3*e.measureText("w").width),i+=2*(0,l.Lz)(this._parameters.halo.size),Math.round(i)}_computeLineHeightBase(){return 1.275*this._parameters.size}_computeLineHeight(){let e=this._computeLineHeightBase();const t=this._parameters.font.decoration;return t&&"underline"===t&&(e*=1.3),Math.round(e+2*(0,l.Lz)(this._parameters.halo.size))}_renderDecoration(e,t,i,n,r,s){let o=.9*this._lineHeight;const a="bold"===r?.06:"bolder"===r?.09:.04;switch(e.textAlign){case"center":t-=this._renderedWidth/2;break;case"right":t-=this._renderedWidth}const l=e.textBaseline;if("underline"===n)switch(o=.9*this._computeLineHeightBase(),l){case"top":i+=o;break;case"middle":i+=o/2}else if("line-through"===n)switch(l){case"top":i+=o/1.5;break;case"middle":i+=o/3}const u=s?1.5*s:Math.ceil(o*a);e.save(),e.beginPath(),e.strokeStyle=e.fillStyle,e.lineWidth=u,e.moveTo(t-this._lineThroughWidthOffset,i),e.lineTo(t+this._renderedWidth+2*this._lineThroughWidthOffset,i),e.stroke(),e.restore()}}function P(e,t){const i=Math.max(t.size,.5),n=t.font,r=`${n.style} ${n.weight} ${(0,l.Lz)(i).toFixed(1)}px ${n.family}, sans-serif`;let s;switch(e.font=r,e.textBaseline="top",t.horizontalAlignment){case"left":default:s="left";break;case"right":s="right";break;case"center":s="center"}e.textAlign=s}var I=i(7590),M=i(16043),A=i(39686),C=i(17469),E=i(96700);const R=Math.PI/180;class O{constructor(e){this._t=e}static createIdentity(){return new O([1,0,0,0,1,0])}clone(){const e=this._t;return new O(e.slice())}transform(e){const t=this._t;return[t[0]*e[0]+t[1]*e[1]+t[2],t[3]*e[0]+t[4]*e[1]+t[5]]}static createScale(e,t){return new O([e,0,0,0,t,0])}scale(e,t){const i=this._t;return i[0]*=e,i[1]*=e,i[2]*=e,i[3]*=t,i[4]*=t,i[5]*=t,this}scaleRatio(){return Math.sqrt(this._t[0]*this._t[0]+this._t[1]*this._t[1])}static createTranslate(e,t){return new O([0,0,e,0,0,t])}translate(e,t){const i=this._t;return i[2]+=e,i[5]+=t,this}static createRotate(e){const t=Math.cos(e),i=Math.sin(e);return new O([t,-i,0,i,t,0])}rotate(e){return O.multiply(this,O.createRotate(e),this)}angle(){const e=this._t[0],t=this._t[3],i=Math.sqrt(e*e+t*t);return[e/i,t/i]}static multiply(e,t,i){const n=e._t,r=t._t,s=n[0]*r[0]+n[3]*r[1],o=n[1]*r[0]+n[4]*r[1],a=n[2]*r[0]+n[5]*r[1]+r[2],l=n[0]*r[3]+n[3]*r[4],u=n[1]*r[3]+n[4]*r[4],c=n[2]*r[3]+n[5]*r[4]+r[5],h=i._t;return h[0]=s,h[1]=o,h[2]=a,h[3]=l,h[4]=u,h[5]=c,i}invert(){const e=this._t;let t=e[0]*e[4]-e[1]*e[3];if(0===t)return new O([0,0,0,0,0,0]);t=1/t;const i=(e[1]*e[5]-e[2]*e[4])*t,n=(e[2]*e[3]-e[0]*e[5])*t,r=e[4]*t,s=-e[1]*t,o=-e[3]*t,a=e[0]*t;return new O([r,s,i,o,a,n])}}class z{constructor(e,t){this._resourceManager=e,this._transfos=[],this._sizeTransfos=[],this._geomUnitsPerPoint=1,this._placementPool=new a.A(g.W,void 0,void 0,100),this._earlyReturn=!1,this._mapRotation=0,this._transfos.push(t||O.createIdentity()),this._sizeTransfos.push(t?t.scaleRatio():1)}setTransform(e,t){this._transfos=[e||O.createIdentity()],this._sizeTransfos=[t||(e?e.scaleRatio():1)]}setGeomUnitsPerPoint(e){this._geomUnitsPerPoint=e}transformPt(e){return this._transfos[this._transfos.length-1].transform(e)}transformSize(e){return e*this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformPt(e){return this._transfos[this._transfos.length-1].invert().transform(e)}reverseTransformSize(e){return e/this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformScalar(e){return e/this._transfos[this._transfos.length-1].scaleRatio()}getTransformAngle(){return this._transfos[this._transfos.length-1].angle()}geomUnitsPerPoint(){return this.isEmbedded()?1:this._geomUnitsPerPoint}prevGeomUnitsPerPoint(){return this._transfos.length>2?1:this._geomUnitsPerPoint}isEmbedded(){return this._transfos.length>1}back(){return this._transfos[this._transfos.length-1]}push(e,t){const i=t?e.scaleRatio():1;O.multiply(e,this.back(),e),this._transfos.push(e),this._sizeTransfos.push(this._sizeTransfos[this._sizeTransfos.length-1]*i)}pop(){this._transfos.splice(-1,1),this._sizeTransfos.splice(-1,1)}drawSymbol(e,t,i){if(e)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":this.drawMultiLayerSymbol(e,t);break;case"CIMTextSymbol":this.drawTextSymbol(e,t,i)}}drawMultiLayerSymbol(e,t){if(!e||!t)return;const i=e.symbolLayers;if(!i)return;const n=e.effects;if(n&&n.length>0){const e=this.executeEffects(n,t);if(e){let t=e.next();for(;t;)this.drawSymbolLayers(i,t.asJSON()),t=e.next()}}else this.drawSymbolLayers(i,t)}executeEffects(e,t){const i=this._resourceManager.geometryEngine;let n=new p.k(u.z.fromJSONCIM(t));for(const t of e){const e=(0,_.A)(t);e&&(n=e.execute(n,t,this.geomUnitsPerPoint(),null,i))}return n}drawSymbolLayers(e,t){let i=e.length;for(;i--;){const n=e[i];if(!n||!1===n.enable)continue;const r=n.effects;if(r&&r.length>0){const e=this.executeEffects(r,t);if(e){let t=null;for(;(t=e.next())&&(this.drawSymbolLayer(n,t.asJSON()),!this._earlyReturn););}}else this.drawSymbolLayer(n,t);if(this._earlyReturn)return}}drawSymbolLayer(e,t){switch(e.type){case"CIMSolidFill":this.drawSolidFill(t,e.color,e.path);break;case"CIMHatchFill":this.drawHatchFill(t,e);break;case"CIMPictureFill":this.drawPictureFill(t,e);break;case"CIMGradientFill":this.drawGradientFill(t,e);break;case"CIMSolidStroke":this.drawSolidStroke(t,e.color,e.width,e.capStyle,e.joinStyle,e.miterLimit,e.path);break;case"CIMPictureStroke":this.drawPictureStroke(t,e);break;case"CIMGradientStroke":this.drawGradientStroke(t,e);break;case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":this.drawMarkerLayer(e,t)}}drawHatchFill(e,t){const i=function(e,t,i){let n=(0,I.$w)(e.separation,y.D.CIMHatchFill.separation)*i,r=(0,I.$w)(e.rotation);if(0===n)return null;n<0&&(n=-n);let s=0;const o=.5*n;for(;s>o;)s-=n;for(;s<-o;)s+=n;const a=(0,c.vt)();(0,h.Rg)(a,t),a[0]-=o,a[1]-=o,a[2]+=o,a[3]+=o;const l=[[a[0],a[1]],[a[0],a[3]],[a[2],a[3]],[a[2],a[1]]];for(;r>180;)r-=180;for(;r<0;)r+=180;const u=Math.cos(r*R),d=Math.sin(r*R),f=-n*d,p=n*u;let m,_,g,v;s=(0,I.$w)(e.offsetX)*i*d-(0,I.$w)(e.offsetY)*i*u,m=g=Number.MAX_VALUE,_=v=-Number.MAX_VALUE;for(const e of l){const t=e[0],i=e[1],n=u*t+d*i,r=-d*t+u*i;m=Math.min(m,n),g=Math.min(g,r),_=Math.max(_,n),v=Math.max(v,r)}g=Math.floor(g/n)*n;let x=u*m-d*g-f*s/n,b=d*m+u*g-p*s/n,S=u*_-d*g-f*s/n,w=d*_+u*g-p*s/n;const T=1+Math.round((v-g)/n),P=[];for(let e=0;e<T;e++)x+=f,b+=p,S+=f,w+=p,P.push([[x,b],[S,w]]);return{paths:P}}(t,e,this.geomUnitsPerPoint());i&&(this.pushClipPath(e),this.drawMultiLayerSymbol(t.lineSymbol,i),this.popClipPath())}drawPictureFill(e,t){}drawGradientFill(e,t){}drawPictureStroke(e,t){}drawGradientStroke(e,t){}drawMarkerLayer(e,t){const i=e.markerPlacement;if(i){const n=(0,_.c)(i);if(n){const r="CIMMarkerPlacementInsidePolygon"===i.type||"CIMMarkerPlacementPolygonCenter"===i.type&&i.clipAtBoundary;r&&this.pushClipPath(t);const s=n.execute(u.z.fromJSONCIM(t),i,this.geomUnitsPerPoint(),null,this._resourceManager.geometryEngine);if(s){let t=null;for(;(t=s.next())&&(this.drawMarker(e,t),!this._earlyReturn););}r&&this.popClipPath()}}else{const i=this._placementPool.acquire();if((0,f.fT)(t))i.tx=t.x,i.ty=t.y,this.drawMarker(e,i);else if((0,f.Bi)(t)){const n=(0,d.l8)(t);n&&([i.tx,i.ty]=n,this.drawMarker(e,i))}else for(const n of t.points)if(i.tx=n[0],i.ty=n[1],this.drawMarker(e,i),this._earlyReturn)break;this._placementPool.release(i)}}drawMarker(e,t){switch(e.type){case"CIMCharacterMarker":case"CIMPictureMarker":this.drawPictureMarker(e,t);break;case"CIMVectorMarker":this.drawVectorMarker(e,t)}}drawPictureMarker(e,t){if(!e)return;const i=this._resourceManager.getResource(e.url),n=(0,I.$w)(e.size,y.D.CIMPictureMarker.size);if(null==i||n<=0)return;const r=i.width,s=i.height;if(!r||!s)return;const o=r/s,a=(0,I.$w)(e.scaleX,1),l=O.createIdentity(),u=e.anchorPoint;if(u){let t=u.x,i=u.y;"Absolute"!==e.anchorPointUnits&&(t*=n*o*a,i*=n),l.translate(-t,-i)}let c=(0,I.$w)(e.rotation);e.rotateClockwise&&(c=-c),this._mapRotation&&(c+=this._mapRotation),c&&l.rotate(c*R);let h=(0,I.$w)(e.offsetX),d=(0,I.$w)(e.offsetY);if(h||d){if(this._mapRotation){const e=R*this._mapRotation,t=Math.cos(e),i=Math.sin(e),n=h*i+d*t;h=h*t-d*i,d=n}l.translate(h,d)}const f=this.geomUnitsPerPoint();1!==f&&l.scale(f,f);const p=t.getAngle();p&&l.rotate(p),l.translate(t.tx,t.ty),this.push(l,!1),this.drawImage(e,n),this.pop()}drawVectorMarker(e,t){if(!e)return;const i=e.markerGraphics;if(!i)return;const n=(0,I.$w)(e.size,y.D.CIMVectorMarker.size),r=e.frame,s=r?r.ymax-r.ymin:0,a=n&&s?n/s:1,l=O.createIdentity();r&&l.translate(.5*-(r.xmax+r.xmin),.5*-(r.ymax+r.ymin));const u=e.anchorPoint;if(u){let t=u.x,i=u.y;"Absolute"!==e.anchorPointUnits?r&&(t*=r.xmax-r.xmin,i*=r.ymax-r.ymin):(t/=a,i/=a),l.translate(-t,-i)}1!==a&&l.scale(a,a);let c=(0,I.$w)(e.rotation);e.rotateClockwise&&(c=-c),this._mapRotation&&(c+=this._mapRotation),c&&l.rotate(c*R);let h=(0,I.$w)(e.offsetX),d=(0,I.$w)(e.offsetY);if(h||d){if(this._mapRotation){const e=R*this._mapRotation,t=Math.cos(e),i=Math.sin(e),n=h*i+d*t;h=h*t-d*i,d=n}l.translate(h,d)}const f=this.geomUnitsPerPoint();1!==f&&l.scale(f,f);const p=t.getAngle();p&&l.rotate(p),l.translate(t.tx,t.ty),this.push(l,e.scaleSymbolsProportionally);for(const e of i){e?.symbol&&e.geometry||o.A.getLogger("esri.symbols.cim.CIMSymbolDrawHelper").error("Invalid marker graphic",e);let t=e.textString;if("number"==typeof t&&(t=t.toString()),this.drawSymbol(e.symbol,e.geometry,t),this._earlyReturn)break}this.pop()}drawTextSymbol(e,t,i){if(!e)return;if(!(0,f.fT)(t))return;if((0,I.$w)(e.height,y.D.CIMTextSymbol.height)<=0)return;const n=O.createIdentity();let r=(0,I.$w)(e.angle);r=-r,r&&n.rotate(r*R);const s=(0,I.$w)(e.offsetX),o=(0,I.$w)(e.offsetY);(s||o)&&n.translate(s,o);const a=this.geomUnitsPerPoint();1!==a&&n.scale(a,a),n.translate(t.x,t.y),this.push(n,!1),this.drawText(e,i),this.pop()}}class F extends z{constructor(e,t){super(e,t),this.reset()}reset(){this._xmin=this._ymin=1/0,this._xmax=this._ymax=-1/0,this._clipCount=0}envelope(){return new b.A(this._xmin,this._ymin,this._xmax-this._xmin,this._ymax-this._ymin)}bounds(){return(0,c.fA)(this._xmin,this._ymin,this._xmax,this._ymax)}drawSolidFill(e){if(e&&!(this._clipCount>0))if((0,f.Bi)(e))this._processPath(e.rings,0);else if((0,f.Rg)(e))this._processPath(e.paths,0);else if((0,f.ZC)(e)){const t=k(e);t&&this._processPath(t.rings,0)}else console.error("drawSolidFill Unexpected geometry type!")}drawSolidStroke(e,t,i){if(!e||this._clipCount>0||null==i||i<=0)return;const n=Math.max(.5*this.transformSize((0,I.$w)(i,y.D.CIMSolidStroke.width)),.25);if((0,f.Bi)(e))this._processPath(e.rings,n);else if((0,f.Rg)(e))this._processPath(e.paths,n);else if((0,f.ZC)(e)){const t=k(e);t&&this._processPath(t.rings,n)}else console.error("drawSolidStroke unexpected geometry type!")}drawMarkerLayer(e,t){(0,f.Bi)(t)&&e.markerPlacement&&("CIMMarkerPlacementInsidePolygon"===e.markerPlacement.type||"CIMMarkerPlacementPolygonCenter"===e.markerPlacement.type&&e.markerPlacement.clipAtBoundary)?this._processPath(t.rings,0):super.drawMarkerLayer(e,t)}drawHatchFill(e,t){this.drawSolidFill(e)}drawPictureFill(e,t){this.drawSolidFill(e)}drawGradientFill(e,t){this.drawSolidFill(e)}drawPictureStroke(e,t){this.drawSolidStroke(e,null,t.width)}drawGradientStroke(e,t){this.drawSolidStroke(e,null,t.width)}pushClipPath(e){this.drawSolidFill(e),this._clipCount++}popClipPath(){this._clipCount--}drawImage(e,t){const{url:i}=e,n=(0,I.$w)(e.scaleX,1);let r=n*t,s=t;const o=this._resourceManager.getResource(i);if(null!=o){const e=o.height/o.width;r=n*(t?e>1?t:t/e:o.width),s=t?e>1?t*e:t:o.height}this._merge(this.transformPt([-r/2,-s/2]),0),this._merge(this.transformPt([-r/2,s/2]),0),this._merge(this.transformPt([r/2,-s/2]),0),this._merge(this.transformPt([r/2,s/2]),0)}drawText(e,t){if(!t||0===t.length)return;this._textRasterizer||(this._textRasterizer=new T);const i=U(e);let[n,r]=this._textRasterizer.computeTextSize(t,i);n=(0,l.PN)(n),r=(0,l.PN)(r);const s=this.transformSize(1)*this.reverseTransformScalar(1);n*=s,r*=s;let o=0;switch(e.horizontalAlignment){case"Left":o=n/2;break;case"Right":o=-n/2}let a=0;switch(e.verticalAlignment){case"Bottom":a=r/2;break;case"Top":a=-r/2;break;case"Baseline":a=r/6}this._merge(this.transformPt([-n/2+o,-r/2+a]),0),this._merge(this.transformPt([-n/2+o,r/2+a]),0),this._merge(this.transformPt([n/2+o,-r/2+a]),0),this._merge(this.transformPt([n/2+o,r/2+a]),0)}_processPath(e,t){if(e)for(const i of e){const e=i?i.length:0;if(e>1){this._merge(this.transformPt(i[0]),t);for(let n=1;n<e;n++)this._merge(this.transformPt(i[n]),t)}}}_merge(e,t){e[0]-t<this._xmin&&(this._xmin=e[0]-t),e[0]+t>this._xmax&&(this._xmax=e[0]+t),e[1]-t<this._ymin&&(this._ymin=e[1]-t),e[1]+t>this._ymax&&(this._ymax=e[1]+t)}}class V extends z{constructor(){super(...arguments),this._searchPoint=[0,0],this._searchDistPoint=0,this._textInfo=null,this._svg=null,this._path=null,this._canvas=null}destroy(){this._svg=(0,M.pK)(this._svg),this._path=null,this._canvas=null}hitTest(e,t,i,n,s,o){const a=o*(0,l.Lz)(1);this.setTransform(),this.setGeomUnitsPerPoint(a),this._searchPoint=[(e[0]+e[2])/2,(e[1]+e[3])/2],this._searchDistPoint=(e[2]-e[0])/2/a,this._textInfo=n;const u=t&&("CIMPointSymbol"===t.type&&"Map"!==t.angleAlignment||"CIMTextSymbol"===t.type);if(this._mapRotation=u?s:0,!(0,r.A)("esri-mobile")){const e=(0,l.PN)(A._M*window.devicePixelRatio),i=(0,l.PN)(A.ie);("CIMLineSymbol"!==t?.type&&"CIMPolygonSymbol"!==t?.type||!t.symbolLayers?.some(I.jn))&&"CIMMeshSymbol"!==t?.type&&((0,I.YC)(t)??0)<i&&(this._searchDistPoint=e)}return this._earlyReturn=!1,this.drawSymbol(t,i),this._earlyReturn}executeEffects(e,t){return"CIMGeometricEffectDashes"===e.at(-1)?.type&&(e=e.slice(0,-1)),super.executeEffects(e,t)}drawSolidFill(e,t,i){null!=i?this._hittestSvgPath(e,i,!0):this._hitTestFill(e)}drawHatchFill(e,t){this._hitTestFill(e)}drawPictureFill(e,t){this._hitTestFill(e)}drawGradientFill(e,t){this._hitTestFill(e)}drawSolidStroke(e,t,i,n,r,s,o){null!=o?this._hittestSvgPath(e,o,!1,i):this._hitTestStroke(e,i)}drawPictureStroke(e,t){this._hitTestStroke(e,t.width)}drawGradientStroke(e,t){this._hitTestStroke(e,t.width)}drawMarkerLayer(e,t){e.markerPlacement&&("CIMMarkerPlacementInsidePolygon"===e.markerPlacement.type||"CIMMarkerPlacementPolygonCenter"===e.markerPlacement.type&&e.markerPlacement.clipAtBoundary)?this._hitTestFill(t):super.drawMarkerLayer(e,t)}pushClipPath(e){}popClipPath(){}drawImage(e,t){const{url:i}=e,n=(0,I.$w)(e.scaleX,1),r=this._resourceManager.getResource(i);if(null==r||0===r.height||0===t)return;const s=t*this.geomUnitsPerPoint(),o=s*n*(r.width/r.height),a=this.reverseTransformPt(this._searchPoint),l=this._searchDistPoint;Math.abs(a[0])<o/2+l&&Math.abs(a[1])<s/2+l&&(this._earlyReturn=!0)}drawText(e,t){const i=this._textInfo;if(!i)return;const n=i.get(e);if(!n)return;if(!n.glyphMosaicItems.glyphs.length)return;const r=(0,E.hV)((0,I.$w)(e.height,y.D.CIMTextSymbol.height)),{lineGapType:s,lineGap:o}=e,a=s?B(s,(0,I.$w)(o),r):0,l="CIMBackgroundCallout"===e.callout?.type,u=(0,C.Tl)(n.glyphMosaicItems,{scale:r/A.eG,angle:0,xOffset:0,yOffset:0,horizontalAlignment:e.horizontalAlignment,verticalAlignment:e.verticalAlignment,maxLineWidth:(0,E.Lu)(e.lineWidth),lineHeight:A.DY*Math.max(.25,Math.min(a||1,4)),decoration:e.font.decoration||"none",useCIMAngleBehavior:!0,hasBackground:l}),c=this.reverseTransformPt(this._searchPoint),h=c[0],d=c[1];for(const e of u.glyphs)if(h>e.xTopLeft&&h<e.xBottomRight&&d>-e.yBottomRight&&d<-e.yTopLeft){this._earlyReturn=!0;break}}_hitTestFill(e){let t=null;if((0,f.ZC)(e)){const i=e;t=[[[i.xmin,i.ymin],[i.xmin,i.ymax],[i.xmax,i.ymax],[i.xmax,i.ymin],[i.xmin,i.ymin]]]}else if((0,f.Bi)(e))t=e.rings;else{if(!(0,f.Rg)(e))return;t=e.paths}const i=this.reverseTransformPt(this._searchPoint);(function(e,t){let i=0;for(const n of t){const t=n.length;for(let r=1;r<t;r++){const t=n[r-1],s=n[r];t[1]>e[1]!=s[1]>e[1]&&((s[0]-t[0])*(e[1]-t[1])-(s[1]-t[1])*(e[0]-t[0])>0?i++:i--)}}return 0!==i})(i,t)&&(this._earlyReturn=!0),this._earlyReturn||D(i,t,this.reverseTransformScalar(this._searchDistPoint)*this.prevGeomUnitsPerPoint())&&(this._earlyReturn=!0)}_getSvgPath(){return null!=this._svg&&null!=this._path||(this._svg??=(0,M.p)(),this._path??=(0,M.FJ)("path"),this._svg.appendChild(this._path)),this._path}_getCanvas(){return this._canvas??=document.createElement("canvas"),this._canvas}_hittestSvgPath(e,t,i,n){const r=(0,c.vt)();(0,h.Rg)(r,e);const s=r[0],o=r[1],a=r[2]-r[0],l=r[3]-r[1],u=this._getSvgPath();u.setAttribute("d",t);const d=u.getBBox(),f=d.width/a,p=d.height/l,m=this._getCanvas();m.width=d.width,m.height=d.height;const _=m.getContext("2d",{willReadFrequently:!0});_.setTransform(1,0,0,1,d.x,-d.y);const g=new Path2D(t);i?_.fill(g):(_.lineWidth=n*f,_.stroke(g));const y=this.reverseTransformScalar(this._searchDistPoint)*this.prevGeomUnitsPerPoint(),v=this.reverseTransformPt(this._searchPoint),x=(v[0]-s-y)*f,b=(l-(v[1]-o)-y)*p,S=2*y*f,w=2*y*p,T=_.getImageData(x,b,S,w).data;for(let e=3;e<T.length;e+=4)if(T[e]>127.5)return void(this._earlyReturn=!0)}_hitTestStroke(e,t){let i=null;if((0,f.ZC)(e)){const t=e;i=[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]}else if((0,f.Bi)(e))i=e.rings;else{if(!(0,f.Rg)(e))return;i=e.paths}D(this.reverseTransformPt(this._searchPoint),i,(0,I.$w)(t,y.D.CIMSolidStroke.width)*this.geomUnitsPerPoint()/2+this.reverseTransformScalar(this._searchDistPoint)*this.prevGeomUnitsPerPoint())&&(this._earlyReturn=!0)}}class L extends z{constructor(e,t,i,n){super(t,i),this._applyAdditionalRenderProps=n,this._colorSubstitutionHelper=new m,this._ctx=e}drawSolidFill(e,t){if(!e)return;if((0,f.Bi)(e))this._buildPath(e.rings,!0);else if((0,f.Rg)(e))this._buildPath(e.paths,!0);else if((0,f.ZC)(e))this._buildPath(k(e).rings,!0);else{if(!(0,f.U9)(e))return;console.log("CanvasDrawHelper.drawSolidFill - No implementation!")}const i=this._ctx;i.fillStyle="string"==typeof t?t:"rgba("+Math.round(t[0])+","+Math.round(t[1])+","+Math.round(t[2])+","+(t[3]??255)/255+")",i.fill("evenodd")}drawSolidStroke(e,t,i,n,r,s){if(!e||!t||0===i)return;if((0,f.Bi)(e))this._buildPath(e.rings,!0);else if((0,f.Rg)(e))this._buildPath(e.paths,!1);else{if(!(0,f.ZC)(e))return void console.log("CanvasDrawHelper.drawSolidStroke isn't implemented!");this._buildPath(k(e).rings,!0)}const o=this._ctx;o.strokeStyle="string"==typeof t?t:"rgba("+Math.round(t[0])+","+Math.round(t[1])+","+Math.round(t[2])+","+(t[3]??255)/255+")",o.lineWidth=Math.max(this.transformSize(i),.5),this._setCapStyle(n),this._setJoinStyle(r),o.miterLimit=s,o.stroke()}pushClipPath(e){if(this._ctx.save(),(0,f.Bi)(e))this._buildPath(e.rings,!0);else if((0,f.Rg)(e))this._buildPath(e.paths,!0);else{if(!(0,f.ZC)(e))return;this._buildPath(k(e).rings,!0)}this._ctx.clip("evenodd")}popClipPath(){this._ctx.restore()}drawImage(e,t){const{colorSubstitutions:i,url:n,tintColor:r}=e,s=(0,I.$w)(e.scaleX,1),o=this._resourceManager.getResource(n);if(null==o)return;let a=t*(o.width/o.height),l=t;t||(a=o.width,l=o.height);const u=(0,I.UE)(n)||"src"in o&&(0,I.UE)(o.src);let c="getFrame"in o?x(o):o;i&&(c=this._colorSubstitutionHelper.applyColorSubstitution(c,i)),this._applyAdditionalRenderProps&&!u&&r&&(c=this._colorSubstitutionHelper.tintImageData(c,r));const h=this.transformPt([0,0]),[d,f]=this.getTransformAngle(),p=this.transformSize(1),m=this._ctx;m.save(),m.setTransform({m11:s*p*d,m12:s*p*f,m21:-p*f,m22:p*d,m41:h[0],m42:h[1]}),m.drawImage(c,-a/2,-l/2,a,l),m.restore()}drawText(e,t){if(!t||0===t.length)return;this._textRasterizer||(this._textRasterizer=new T);const i=U(e,this.transformSize((0,l.PN)(1))),n=this._textRasterizer.rasterizeText(t,i);if(!n)return;const{size:r,anchorX:s,anchorY:o,canvas:a}=n,u=r[0]*(s+.5),c=r[1]*(o-.5),h=this._ctx,d=this.transformPt([0,0]),[f,p]=this.getTransformAngle();h.save(),h.setTransform({m11:1*f,m12:1*p,m21:-1*p,m22:1*f,m41:d[0]-1*u,m42:d[1]+1*c}),h.drawImage(a,0,0),h.restore()}drawPictureFill(e,t){if(!e)return;let{colorSubstitutions:i,height:n,offsetX:r,offsetY:s,rotation:o,scaleX:a,tintColor:l,url:u}=t;const c=this._resourceManager.getResource(u);if(null==c)return;if((0,f.Bi)(e))this._buildPath(e.rings,!0);else if((0,f.Rg)(e))this._buildPath(e.paths,!0);else if((0,f.ZC)(e))this._buildPath(k(e).rings,!0);else{if(!(0,f.U9)(e))return;console.log("CanvasDrawHelper.drawPictureFill - No implementation!")}const h=this._ctx,d=(0,I.UE)(u)||"src"in c&&(0,I.UE)(c.src);let p,m="getFrame"in c?x(c):c;if(i&&(m=this._colorSubstitutionHelper.applyColorSubstitution(m,i)),this._applyAdditionalRenderProps){d||l&&(m=this._colorSubstitutionHelper.tintImageData(m,l)),p=h.createPattern(m,"repeat");const e=this.transformSize(1);o||(o=0),r?r*=e:r=0,s?s*=e:s=0,n&&(n*=e);const t=n?n/c.height:1,i=a&&n?a*n/c.width:1;if(0!==o||1!==t||1!==i||0!==r||0!==s){const e=new DOMMatrix;e.rotateSelf(0,0,-o).translateSelf(r,s).scaleSelf(i,t,1),p.setTransform(e)}}else p=h.createPattern(m,"repeat");h.save(),h.fillStyle=p,h.fill("evenodd"),h.restore()}drawPictureStroke(e,t){if(!e)return;let{colorSubstitutions:i,capStyle:n,joinStyle:r,miterLimit:o,tintColor:a,url:u,width:c}=t;const h=this._resourceManager.getResource(u);if(null==h)return;let d;if((0,f.Bi)(e))d=e.rings;else if((0,f.Rg)(e))d=e.paths;else{if(!(0,f.ZC)(e))return(0,f.U9)(e)?void console.log("CanvasDrawHelper.drawPictureStroke - No implementation!"):void 0;d=k(e).rings}c||(c=h.width);const p=(0,I.UE)(u)||"src"in h&&(0,I.UE)(h.src);let m="getFrame"in h?x(h):h;i&&(m=this._colorSubstitutionHelper.applyColorSubstitution(m,i)),this._applyAdditionalRenderProps&&(p||a&&(m=this._colorSubstitutionHelper.tintImageData(m,a)));const _=Math.max(this.transformSize((0,l.Lz)(c)),.5),g=_/m.width,y=this._ctx,v=y.createPattern(m,"repeat-y");let b,S;y.save(),this._setCapStyle(n),this._setJoinStyle(r),void 0!==o&&(y.miterLimit=o),y.lineWidth=_;for(let e of d)if(e=(0,s.o8)(e),H(e),e&&!(e.length<=1)){b=this.transformPt(e[0]);for(let t=1;t<e.length;t++){S=this.transformPt(e[t]);const i=N(b,S),n=new DOMMatrix;n.translateSelf(0,b[1]-_/2).scaleSelf(g,g,1).rotateSelf(0,0,90-i),v.setTransform(n),y.strokeStyle=v,y.beginPath(),y.moveTo(b[0],b[1]),y.lineTo(S[0],S[1]),y.stroke(),b=S}}y.restore()}_buildPath(e,t){const i=this._ctx;if(i.beginPath(),e)for(const n of e){const e=n?n.length:0;if(e>1){let r=this.transformPt(n[0]);i.moveTo(r[0],r[1]);for(let t=1;t<e;t++)r=this.transformPt(n[t]),i.lineTo(r[0],r[1]);t&&i.closePath()}}}_setCapStyle(e){switch(e){case v.uT.Butt:this._ctx.lineCap="butt";break;case v.uT.Round:this._ctx.lineCap="round";break;case v.uT.Square:this._ctx.lineCap="square"}}_setJoinStyle(e){switch(e){case v.wd.Bevel:this._ctx.lineJoin="bevel";break;case v.wd.Round:this._ctx.lineJoin="round";break;case v.wd.Miter:this._ctx.lineJoin="miter"}}}function D(e,t,i){for(const n of t){const t=n.length;for(let r=1;r<t;r++){const t=n[r-1],s=n[r];let o=(s[0]-t[0])*(s[0]-t[0])+(s[1]-t[1])*(s[1]-t[1]);if(0===o)continue;o=Math.sqrt(o);const a=((s[0]-t[0])*(e[1]-t[1])-(s[1]-t[1])*(e[0]-t[0]))/o;if(Math.abs(a)<i){const n=((s[0]-t[0])*(e[0]-t[0])+(s[1]-t[1])*(e[1]-t[1]))/o;if(n>-i&&n<o+i)return!0}}}return!1}function N(e,t){const i=t[0]-e[0],n=t[1]-e[1];return 180/Math.PI*Math.atan2(n,i)}const k=e=>e?{spatialReference:e.spatialReference,rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]}:null,B=(e,t,i)=>{switch(e){case"ExtraLeading":return 1+t/i;case"Multiple":return t;case"Exact":return t/i}};function U(e,t=1){const i=(0,I.DW)(e),r=(0,I._d)(e.fontStyleName),s=e.fontFamilyName??n.Vb,{weight:o,style:a}=r,l=t*(e.height||5),u=(0,I.Bu)(e.horizontalAlignment),c=(0,I.Nl)(e.verticalAlignment),h=(0,I.pM)(e),d=(0,I.pM)(e.haloSymbol),f=null!=d?t*(e.haloSize??0):0,p=(0,I._1)(e.symbol),m=t*((0,I.xo)(e.symbol)||0),_="CIMBackgroundCallout"===e.callout?.type?e.callout.backgroundSymbol:null,g=(0,I.pM)(_),y=(0,I.xo)(_),v=(0,I._1)(_);return{color:h,size:l,horizontalAlignment:u,verticalAlignment:c,font:{family:s,style:(0,I.pV)(a),weight:(0,I.Kn)(o),decoration:i},outline:{size:m||0,color:p},halo:{size:f||0,color:d,style:a},backgroundColor:g,borderLine:null!=y&&null!=v?{size:y,color:v}:null,pixelRatio:1,premultiplyColors:!0}}const G=1e-4;function H(e){let t,i,n,r,s,o=e[0],a=1;for(;a<e.length;)t=e[a][0]-o[0],i=e[a][1]-o[1],r=0!==t?i/t:Math.PI/2,void 0!==n&&r-n<=G?(e.splice(a-1,1),o=s):(s=o,o=e[a],a++),n=r}},57176:function(e,t,i){i.d(t,{BW:function(){return H},Sc:function(){return O},Vb:function(){return M},ll:function(){return R},wp:function(){return z}});var n=i(90152),r=i(58941),s=i(21609),o=i(40633),a=i(13798),l=i(13520),u=i(87416),c=i(35068),h=i(90046),d=i(29076),f=i(14817),p=i(38821),m=i(33389),_=i(7590),g=i(74661),y=i(7056),v=i(39686),x=i(17469),b=i(96700);const S=Math.PI,w=S/2,T=Math.PI/180,P=96/72,I=()=>o.A.getLogger("esri.symbols.cim.CIMSymbolHelper");function M(e){let t;switch(e.type){case"cim":return e.data;case"web-style":return e;case"simple-marker":{const i=z.fromSimpleMarker(e);if(!i)throw new Error("InternalError: Cannot convert symbol to CIM");t=i;break}case"picture-marker":t=z.fromPictureMarker(e);break;case"simple-line":t=z.fromSimpleLineSymbol(e);break;case"simple-fill":t=z.fromSimpleFillSymbol(e);break;case"picture-fill":t=z.fromPictureFillSymbol(e);break;case"text":t=z.fromTextSymbol(e)}return{type:"CIMSymbolReference",symbol:t}}function A(e,t,i){switch(t.type){case"CIMSymbolReference":return A(e,t.symbol,i);case"CIMPointSymbol":null==i&&(i={x:0,y:0}),e.drawSymbol(t,i);break;case"CIMLineSymbol":null==i&&(i={paths:[[[0,0],[10,0]]]}),e.drawSymbol(t,i);break;case"CIMPolygonSymbol":null==i&&(i={rings:[[[0,0],[0,10],[10,10],[10,0],[0,0]]]}),e.drawSymbol(t,i);break;case"CIMTextSymbol":{const i={x:0,y:0};e.drawSymbol(t,i);break}case"CIMVectorMarker":{const i=new d.W;e.drawMarker(t,i);break}}return e.envelope()}function C(e){if(!e)return 0;switch(e.type){case"CIMMarkerPlacementAlongLineSameSize":case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAtExtremities":case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementAtRatioPositions":case"CIMMarkerPlacementOnLine":case"CIMMarkerPlacementOnVertices":return Math.abs(e.offset);default:return 0}}function E(e){if(!e)return 0;switch(e.type){case"CIMGeometricEffectArrow":return Math.abs(.5*e.width);case"CIMGeometricEffectBuffer":return Math.abs(e.size);case"CIMGeometricEffectControlMeasureLine":return 500;case"CIMGeometricEffectExtension":case"CIMGeometricEffectRadial":return Math.abs(e.length);case"CIMGeometricEffectJog":return Math.abs(.5*e.length);case"CIMGeometricEffectMove":return Math.max(Math.abs((0,_.$w)(e.offsetX)),Math.abs((0,_.$w)(e.offsetY)));case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":return Math.abs(e.offset);case"CIMGeometricEffectRegularPolygon":return Math.abs(e.radius);case"CIMGeometricEffectRotate":case"CIMGeometricEffectScale":default:return 0;case"CIMGeometricEffectTaperedPolygon":return.5*Math.max(Math.abs(e.fromWidth),Math.abs(e.toWidth));case"CIMGeometricEffectWave":return Math.abs(e.amplitude);case"CIMGeometricEffectDonut":return Math.abs(e.width)}}function R(e){if(!e)return 0;let t=0;for(const i of e)t+=E(i);return t}class O{static getSymbolInflateSize(e,t,i,n,r){return e||(e=[0,0,0,0]),t?this._getInflateSize(e,t,i,n,r):e}static safeSize(e){const t=Math.max(Math.abs(e[0]),Math.abs(e[2])),i=Math.max(Math.abs(e[1]),Math.abs(e[3]));return Math.sqrt(t*t+i*i)}static _vectorMarkerBounds(e,t,i,n){let r=!0;const s=(0,u.vt)();if(t?.markerGraphics)for(const o of t.markerGraphics){const t=[0,0,0,0];o.geometry&&((0,c.Rg)(s,o.geometry),t[0]=0,t[1]=0,t[2]=0,t[3]=0,this.getSymbolInflateSize(t,o.symbol,i,0,n),s[0]+=t[0],s[1]+=t[1],s[2]+=t[2],s[3]+=t[3],r?(e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],r=!1):(e[0]=Math.min(e[0],s[0]),e[1]=Math.min(e[1],s[1]),e[2]=Math.max(e[2],s[2]),e[3]=Math.max(e[3],s[3])))}return e}static _getInflateSize(e,t,i,n,r){if(function(e){return void 0!==e.symbolLayers}(t)){const s=this._getLayersInflateSize(e,t.symbolLayers,i,n,r),o=R(t.effects);return o>0&&(s[0]-=o,s[1]-=o,s[2]+=o,s[3]+=o),s}return this._getTextInflatedSize(e,t,r)}static _getLayersInflateSize(e,t,i,n,r){let s=!0;if(!t)return e;for(const o of t){if(!o)continue;let t=[0,0,0,0];switch(o.type){case"CIMSolidFill":case"CIMPictureFill":case"CIMHatchFill":case"CIMGradientFill":break;case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":{const e=o;let i=e.width;null!=i&&(e.capStyle===m.uT.Square||e.joinStyle===m.wd.Miter?i/=1.4142135623730951:i/=2,t[0]=-i,t[1]=-i,t[2]=i,t[3]=i);break}case"CIMCharacterMarker":case"CIMVectorMarker":case"CIMPictureMarker":{const e=o;if("CIMVectorMarker"===o.type){const e=o;if(t=this._vectorMarkerBounds(t,e,i,r),e.frame){const i=(e.frame.xmin+e.frame.xmax)/2,n=(e.frame.ymin+e.frame.ymax)/2;if(t[0]-=i,t[1]-=n,t[2]-=i,t[3]-=n,null!=e.size){const i=e.size/(e.frame.ymax-e.frame.ymin);t[0]*=i,t[1]*=i,t[2]*=i,t[3]*=i}}}else if("CIMPictureMarker"===o.type){const n=o,r=i.getResource(n.url);let s=1;if(null!=r&&r.height&&(s=r.width/r.height),null!=e.size){const i=e.size/2,r=e.size*s*n.scaleX/2;t=[-r,-i,r,i]}}else if(null!=e.size){const i=e.size/2;t=[-i,-i,i,i]}if(e.anchorPoint){let i,n;"Absolute"===e.anchorPointUnits?(i=e.anchorPoint.x,n=e.anchorPoint.y):(i=e.anchorPoint.x*(t[2]-t[0]),n=e.anchorPoint.y*(t[3]-t[1]));const r=1.25*Math.sqrt(i*i+n*n);t[0]-=r,t[1]-=r,t[2]+=r,t[3]+=r}let s=(0,_.$w)(e.rotation);if(e.rotateClockwise&&(s=-s),n&&(s-=n),s){const e=T*s,i=Math.cos(e),n=Math.sin(e),r=(0,u.vt)([y.MG,y.MG,-y.MG,-y.MG]);(0,u.tK)(r,[t[0]*i-t[1]*n,t[0]*n+t[1]*i]),(0,u.tK)(r,[t[0]*i-t[3]*n,t[0]*n+t[3]*i]),(0,u.tK)(r,[t[2]*i-t[1]*n,t[2]*n+t[1]*i]),(0,u.tK)(r,[t[2]*i-t[3]*n,t[2]*n+t[3]*i]),t=r}let a=(0,_.$w)(e.offsetX),l=(0,_.$w)(e.offsetY);if(n){const e=T*n,t=Math.cos(e),i=Math.sin(e),r=a*i+l*t;a=a*t-l*i,l=r}t[0]+=a,t[1]+=l,t[2]+=a,t[3]+=l;const c=C(e.markerPlacement);c>0&&(t[0]-=c,t[1]-=c,t[2]+=c,t[3]+=c);break}}const a=R(o.effects);a>0&&(t[0]-=a,t[1]-=a,t[2]+=a,t[3]+=a),s?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],s=!1):(e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[2]),e[3]=Math.max(e[3],t[3]))}return e}static _getTextInflatedSize(e,t,i){const n=(0,b.hV)(t.height??p.D.CIMTextSymbol.height);if(e[0]=-n/2,e[1]=-n/2,e[2]=n/2,e[3]=n/2,!i)return e;const r=i.get(t);if(!r)return e;if(!r.glyphMosaicItems.glyphs.length)return e;const{lineGapType:s,lineGap:o}=t,a=s?(0,f.QF)(s,o??0,n):0,l="CIMBackgroundCallout"===t.callout?.type,u=(0,x.Tl)(r.glyphMosaicItems,{scale:n/v.eG,angle:(0,_.$w)(t.angle),xOffset:(0,_.$w)(t.offsetX),yOffset:(0,_.$w)(t.offsetY),horizontalAlignment:t.horizontalAlignment,verticalAlignment:t.verticalAlignment,maxLineWidth:(0,b.Lu)(t.lineWidth),lineHeight:v.DY*Math.max(.25,Math.min(a||1,4)),decoration:t.font.decoration||"none",useCIMAngleBehavior:!0,hasBackground:l}).boundsT,c=Math.sqrt(u.width*u.width+u.height*u.height);return e[0]-=u.x+c,e[1]-=u.y-c,e[2]+=u.x+c,e[3]+=-u.y+c,e}}class z{static getEnvelope(e,t,i){if(!e)return null;const n=new f.mx(i);if(Array.isArray(e)){let i;for(const r of e)i?i.union(A(n,r,t)):i=A(n,r,t);return i}return A(n,e,t)}static getTextureAnchor(e,t){const i=this.getEnvelope(e,null,t);if(!i)return[0,0,0];const n=(i.x+.5*i.width)*P,r=(i.y+.5*i.height)*P,s=i.width*P+2,o=i.height*P+2;return[-n/s,-r/o,o]}static rasterize(e,t,i,n,r=!0,s){const o=i||this.getEnvelope(t,null,n);if(!o)return[null,0,0,0,0];const a=Math.max(o.width,o.height)*P;let l=null!=s?Math.max(s/a,1):1;l*=P;const u=(o.x+.5*o.width)*l,c=(o.y+.5*o.height)*l;e.width=o.width*l,e.height=o.height*l,i||(e.width+=2,e.height+=2);const h=e.getContext("2d",{willReadFrequently:!0}),p=f.IT.createScale(l,-l);p.translate(.5*e.width-u,.5*e.height+c);const m=new f.Rj(h,n,p);switch(t.type){case"CIMPointSymbol":{const e={type:"point",x:0,y:0};m.drawSymbol(t,e);break}case"CIMVectorMarker":{const e=new d.W;m.drawMarker(t,e);break}}const _=h.getImageData(0,0,e.width,e.height),g=new Uint8Array(_.data);if(r){let e;for(let t=0;t<g.length;t+=4)e=g[t+3]/255,g[t]=g[t]*e,g[t+1]=g[t+1]*e,g[t+2]=g[t+2]*e}return[g,e.width,e.height,-u/e.width,-c/e.height]}static fromTextSymbol(e){const{text:t}=e;return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPointUnits:"Relative",dominantSizeAxis3D:"Y",size:10,billboardMode3D:"FaceNearPlane",frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{x:0,y:0},symbol:z.createCIMTextSymbolfromTextSymbol(e),textString:t}],scaleSymbolsProportionally:!0,respectFrame:!0}],scaleX:1,angleAlignment:"Display"}}static fromPictureFillSymbol(e){const{height:t,outline:i,width:n,xoffset:r,xscale:s,yoffset:o,yscale:a}=e,l=[],u={type:"CIMPolygonSymbol",symbolLayers:l};if(i){const e=q(i);e&&l.push(e)}let c=e.url;"esriPFS"===e.type&&e.imageData&&(c=e.imageData);const h="angle"in e?e.angle??0:0,d=(n??0)*(s||1),f=(t??0)*(a||1);return l.push({type:"CIMPictureFill",invertBackfaceTexture:!1,scaleX:1,textureFilter:m.O$.Picture,tintColor:null,url:c,height:f,width:d,offsetX:(0,_.$w)(r),offsetY:(0,_.$w)(o),rotation:(0,_.$w)(-h),colorSubstitutions:null}),u}static fromSimpleFillSymbol(e){const{color:t,style:i,outline:n}=e,r=[],o={type:"CIMPolygonSymbol",symbolLayers:r};if(n){const e=q(n);e&&r.push(e)}if(i&&"solid"!==i&&"none"!==i&&"esriSFSSolid"!==i&&"esriSFSNull"!==i){const e={type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",color:k(t),capStyle:m.uT.Butt,joinStyle:m.wd.Miter,width:.75}]};let n=0;const o=(0,l.PN)(Z(i)?8:10);switch(i){case"vertical":case"esriSFSVertical":n=90;break;case"forward-diagonal":case"esriSFSForwardDiagonal":case"diagonal-cross":case"esriSFSDiagonalCross":n=-45;break;case"backward-diagonal":case"esriSFSBackwardDiagonal":n=45;break;case"cross":case"esriSFSCross":n=0}r.push({type:"CIMHatchFill",lineSymbol:e,offsetX:0,offsetY:0,rotation:n,separation:o}),"cross"===i||"esriSFSCross"===i?r.push({type:"CIMHatchFill",lineSymbol:(0,s.o8)(e),offsetX:0,offsetY:0,rotation:90,separation:o}):"diagonal-cross"!==i&&"esriSFSDiagonalCross"!==i||r.push({type:"CIMHatchFill",lineSymbol:(0,s.o8)(e),offsetX:0,offsetY:0,rotation:45,separation:o})}else!i||"solid"!==i&&"esriSFSSolid"!==i||r.push({type:"CIMSolidFill",enable:!0,color:k(t)});return o}static fromSimpleLineSymbol(e){const{cap:t,color:i,join:n,marker:r,miterLimit:s,style:o,width:a}=e;let l=null;"solid"!==o&&"none"!==o&&"esriSLSSolid"!==o&&"esriSLSNull"!==o&&(l=[{type:"CIMGeometricEffectDashes",dashTemplate:H(o,t),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]);const u=[];if(r){let e;switch(r.placement){case"begin-end":e=m.$2.Both;break;case"begin":e=m.$2.JustBegin;break;case"end":e=m.$2.JustEnd;break;default:e=m.$2.None}const t=z.fromSimpleMarker(r,a,i).symbolLayers[0];t.markerPlacement={type:"CIMMarkerPlacementAtExtremities",placePerPart:!1,angleToLine:!0,offset:0,extremityPlacement:e,offsetAlongLine:0},u.push(t)}return u.push({type:"CIMSolidStroke",color:"none"!==o&&"esriSLSNull"!==o?k(i):[0,0,0,0],capStyle:V(t),joinStyle:L(n),miterLimit:s,width:a,effects:l}),{type:"CIMLineSymbol",symbolLayers:u}}static fromPictureMarker(e){const{angle:t,height:i,width:n,xoffset:r,yoffset:s}=e;let o=e.url;return"esriPMS"===e.type&&e.imageData&&(o=e.imageData),{type:"CIMPointSymbol",symbolLayers:[{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:m.O$.Picture,tintColor:null,url:o,size:i,width:n,offsetX:(0,_.$w)(r),offsetY:(0,_.$w)(s),rotation:(0,_.$w)(-t)}]}}static createCIMTextSymbolfromTextSymbol(e){const{angle:t,color:i,font:r,haloColor:s,haloSize:o,horizontalAlignment:a,kerning:l,lineWidth:u,text:c,verticalAlignment:h,xoffset:d,yoffset:f,backgroundColor:p,borderLineColor:g,borderLineSize:y}=e;let v,x,b,S,w,T;r&&(v=r.family,x=r.style,b=r.weight,S=r.size,w=r.decoration);let P=!1;return c&&(P=(0,n.y)(c)[1]),(p||y)&&(T={type:"CIMBackgroundCallout",margin:null,backgroundSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",color:k(p)},{type:"CIMSolidStroke",color:k(g),width:y}]},accentBarSymbol:null,gap:null,leaderLineSymbol:null,lineStyle:null}),{type:"CIMTextSymbol",angle:t,blockProgression:m.TZ.BTT,depth3D:1,extrapolateBaselines:!0,fontEffects:m.Y.Normal,fontEncoding:m.bj.Unicode,fontFamilyName:v||"Arial",fontStyleName:B(x,b),fontType:m.g7.Unspecified,haloSize:o,height:S,hinting:m.mU.Default,horizontalAlignment:D(a??"center"),kerning:l,letterWidth:100,ligatures:!0,lineGapType:"Multiple",lineWidth:u,offsetX:(0,_.$w)(d),offsetY:(0,_.$w)(f),strikethrough:"line-through"===w,underline:"underline"===w,symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:k(i)}]},haloSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:k(s)}]},shadowColor:[0,0,0,255],shadowOffsetX:1,shadowOffsetY:1,textCase:"Normal",textDirection:P?m.f0.RTL:m.f0.LTR,verticalAlignment:N(h??"baseline"),verticalGlyphOrientation:m.vG.Right,wordSpacing:100,billboardMode3D:m.xn.FaceNearPlane,callout:T}}static createPictureMarkerRasterizationParam(e){const{angle:t,height:i,width:n,xoffset:r,yoffset:s}=e,o=e.url??e.source?.url??e.source?.imageData;return o?{type:"sprite-rasterization-param",overrides:[],resource:{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:m.O$.Picture,tintColor:null,url:o,size:i,width:n,offsetX:(0,_.$w)(r),offsetY:(0,_.$w)(s),rotation:(0,_.$w)(-t)}}:null}static createPictureFillRasterizationParam(e){const{width:t,height:i,xoffset:n,yoffset:r,url:s}=e;return s?{type:"sprite-rasterization-param",overrides:[],resource:{type:"CIMPictureFill",scaleX:1,textureFilter:m.O$.Picture,tintColor:null,url:s,width:t,height:i,offsetX:(0,_.$w)(n),offsetY:(0,_.$w)(r),rotation:0}}:null}static fromSimpleMarker(e,t,i){const{style:n}=e,r=e.color??i;if("path"===n||"esriSMSPath"===n){const t=[];if("outline"in e&&e.outline){const i=e.outline;t.push({type:"CIMSolidStroke",enable:!0,width:i.width,color:k(i.color),path:e.path})}t.push({type:"CIMSolidFill",enable:!0,color:k(r),path:e.path});const[i,n]=Y("square");return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:-(0,_.$w)(e.angle),size:(0,_.$w)(e.size||6),offsetX:(0,_.$w)(e.xoffset),offsetY:(0,_.$w)(e.yoffset),scaleSymbolsProportionally:!1,frame:i,markerGraphics:[{type:"CIMMarkerGraphic",geometry:n,symbol:{type:"CIMPolygonSymbol",symbolLayers:t}}]}]}}const s=[];let o,a,l=e.size;if("outline"in e&&e.outline&&"none"!==e.outline.style&&"esriSLSNull"!==e.outline.style){const t=e.outline,i="solid"!==t.style&&"esriSLSSolid"!==t.style;[o,a]=i?Y(n,e.size):Y(n);const r=t.width??g.A7.width;if(i){const t=r/e.size,i=(o.xmax-o.xmin)*t/2,n=(o.ymax-o.ymin)*t/2;o.xmin-=i,o.xmax+=i,o.ymin-=n,o.ymax+=n,l&&(l+=r)}const u="cross"!==e.style&&"x"!==e.style||"dot"===e?.outline.style||"short-dot"===e?.outline.style?m.yS.HalfGap:m.yS.FullPattern,c=i?[{type:"CIMGeometricEffectAddControlPoints"},{type:"CIMGeometricEffectDashes",dashTemplate:H(t.style,null).map((e=>t.width&&t.width>0?e*t.width:e)),lineDashEnding:u,controlPointEnding:m.yS.FullPattern}]:void 0;s.push({type:"CIMSolidStroke",capStyle:i?m.uT.Round:m.uT.Butt,enable:!0,width:r,color:k(t.color),effects:c})}else!t||"line-marker"!==e.type||"cross"!==e.style&&"x"!==e.style?[o,a]=Y(n):([o,a]=Y(n),s.push({type:"CIMSolidStroke",enable:!0,width:t,color:k(r)}));s.push({type:"CIMSolidFill",enable:!0,color:k(r)});const u={type:"CIMPolygonSymbol",symbolLayers:s};return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:(0,_.$w)(-e.angle),size:(0,_.$w)(l||6*t),offsetX:(0,_.$w)(e.xoffset),offsetY:(0,_.$w)(e.yoffset),scaleSymbolsProportionally:!1,frame:o,markerGraphics:[{type:"CIMMarkerGraphic",geometry:a,symbol:u}]}]}}static fromCIMHatchFill(e,t){const i=t*(e.separation??p.D.CIMHatchFill.separation),n=i/2,r=(0,s.o8)(e.lineSymbol);r.symbolLayers?.forEach((e=>{switch(e.type){case"CIMSolidStroke":null!=e.width&&(e.width*=t),e.effects?.forEach((e=>{if("CIMGeometricEffectDashes"===e.type){const i=e.dashTemplate;e.dashTemplate=i?.map((e=>e*t))}}));break;case"CIMVectorMarker":{null!=e.size&&(e.size*=t);const i=e.markerPlacement;null!=i&&"placementTemplate"in i&&(i.placementTemplate=i.placementTemplate.map((e=>e*t)));break}}}));let o=this._getLineSymbolPeriod(r)||4;for(;o<4;)o*=2;const a=o/2;return{type:"CIMVectorMarker",frame:{xmin:-a,xmax:a,ymin:-n,ymax:n},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[-a,0],[a,0]]]},symbol:r}],size:i}}static fetchResources(e,t,i,n=null){return e&&t?(F(e,(e=>{(function(e,t,i){e.effects&&null==t.geometryEngine&&(t.geometryEnginePromise?i.push(t.geometryEnginePromise):(0,_.yH)(e.effects)&&(t.geometryEnginePromise=(0,_._H)(),i.push(t.geometryEnginePromise),t.geometryEnginePromise.then((e=>t.geometryEngine=e))))})(e,t,i),"url"in e&&e.url&&i.push(t.fetchResource(e.url,{signal:n}))})),i):i}static fetchFonts(e,t,i){if(e&&t)if("symbolLayers"in e&&e.symbolLayers){for(const n of e.symbolLayers)if("CIMVectorMarker"===n.type&&n.markerGraphics)for(const e of n.markerGraphics)e?.symbol&&z.fetchFonts(e.symbol,t,i)}else if("CIMTextSymbol"===e.type){const{fontFamilyName:n,fontStyleName:r}=e;if(!n||"calcitewebcoreicons"===n.toLowerCase())return;const{style:s,weight:o}=(0,_._d)(r),a=(0,_.DW)(e),l=new h.A({family:n,style:s,weight:o,decoration:a});i.push(t.loadFont(l).catch((()=>{I().error(`Unsupported font ${n} in CIM symbol`)})))}}static _getLineSymbolPeriod(e){if(e){const t=this._getEffectsRepeat(e.effects);if(t)return t;if(e.symbolLayers)for(const t of e.symbolLayers)if(t){const e=this._getEffectsRepeat(t.effects);if(e)return e;switch(t.type){case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":{const e=this._getPlacementRepeat(t.markerPlacement);if(e)return e}}}}return 0}static _getEffectsRepeat(e){if(e)for(const t of e)if(t)switch(t.type){case"CIMGeometricEffectDashes":{const e=t.dashTemplate;if(e&&e.length){let t=0;for(const i of e)t+=i;return 1&e.length&&(t*=2),t}break}case"CIMGeometricEffectWave":return t.period;default:I().error(`unsupported geometric effect type ${t.type}`)}return 0}static _getPlacementRepeat(e){if(e)switch(e.type){case"CIMMarkerPlacementAlongLineSameSize":case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineVariableSize":{const t=e.placementTemplate;if(t&&t.length){let e=0;for(const i of t)e+=+i;return 1&t.length&&(e*=2),e}break}}return 0}static fromCIMInsidePolygon(e){const t=e.markerPlacement,i={...e};i.markerPlacement=null,i.anchorPoint=null;const n=Math.abs(t.stepX),r=Math.abs(t.stepY),s=(t.randomness??100)/100;let o,u,c,h;if("Random"===t.gridType){const e=(0,l.PN)(v.yv),i=Math.max(Math.floor(e/n),1),d=Math.max(Math.floor(e/r),1);o=i*n/2,u=d*r/2,c=2*u;const f=new a.A(t.seed),p=s*n/1.5,m=s*r/1.5;h=[];for(let e=0;e<i;e++)for(let t=0;t<d;t++){const i=e*n-o+p*(.5-f.getFloat()),s=t*r-u+m*(.5-f.getFloat());h.push({x:i,y:s}),0===e&&h.push({x:i+2*o,y:s}),0===t&&h.push({x:i,y:s+2*u})}}else!0===t.shiftOddRows?(o=n/2,u=r,c=2*r,h=[{x:-o,y:0},{x:o,y:0},{x:0,y:u},{x:0,y:-u}]):(o=n/2,u=r/2,c=r,h=[{x:-n,y:0},{x:0,y:-r},{x:-n,y:-r},{x:0,y:0},{x:n,y:0},{x:0,y:r},{x:n,y:r},{x:-n,y:r},{x:n,y:-r}]);return{type:"CIMVectorMarker",frame:{xmin:-o,xmax:o,ymin:-u,ymax:u},markerGraphics:h.map((e=>({type:"CIMMarkerGraphic",geometry:e,symbol:{type:"CIMPointSymbol",symbolLayers:[i]}}))),size:c}}}function F(e,t){if(e)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const i=e.symbolLayers;if(!i)return;for(const e of i)if(t(e),"CIMVectorMarker"===e.type){const i=e.markerGraphics;if(!i)continue;for(const e of i)if(e){const i=e.symbol;i&&F(i,t)}}break}}}const V=e=>{if(!e)return m.uT.Butt;switch(e){case"butt":return m.uT.Butt;case"square":return m.uT.Square;case"round":return m.uT.Round}},L=e=>{if(!e)return m.wd.Miter;switch(e){case"miter":return m.wd.Miter;case"round":return m.wd.Round;case"bevel":return m.wd.Bevel}},D=e=>{if(null==e)return"Center";switch(e){case"left":return"Left";case"right":return"Right";case"center":return"Center"}},N=e=>{if(null==e)return"Center";switch(e){case"baseline":return"Baseline";case"top":return"Top";case"middle":return"Center";case"bottom":return"Bottom"}},k=e=>{if(!e)return[0,0,0,0];const{r:t,g:i,b:n,a:r}=e;return[t,i,n,255*r]},B=(e,t)=>{const i=U(t),n=G(e);return i&&n?`${i}-${n}`:`${i}${n}`},U=e=>{if(!e)return"";switch(e.toLowerCase()){case"bold":case"bolder":return"bold"}return""},G=e=>{if(!e)return"";switch(e.toLowerCase()){case"italic":case"oblique":return"italic"}return""},H=(e,t)=>{const i=(0,r.A)("safari")?.001:0,n="butt"===t;switch(e){case"dash":case"esriSLSDash":return n?[4,3]:[3,4];case"dash-dot":case"esriSLSDashDot":return n?[4,3,1,3]:[3,4,i,4];case"dot":case"esriSLSDot":return n?[1,3]:[i,4];case"long-dash":case"esriSLSLongDash":return n?[8,3]:[7,4];case"long-dash-dot":case"esriSLSLongDashDot":return n?[8,3,1,3]:[7,4,i,4];case"long-dash-dot-dot":case"esriSLSDashDotDot":return n?[8,3,1,3,1,3]:[7,4,i,4,i,4];case"short-dash":case"esriSLSShortDash":return n?[4,1]:[3,2];case"short-dash-dot":case"esriSLSShortDashDot":return n?[4,1,1,1]:[3,2,i,2];case"short-dash-dot-dot":case"esriSLSShortDashDotDot":return n?[4,1,1,1,1,1]:[3,2,i,2,i,2];case"short-dot":case"esriSLSShortDot":return n?[1,1]:[i,2];case"solid":case"esriSLSSolid":case"none":return I().error("Unexpected: style does not require rasterization"),[0,0];default:return I().error(`Tried to rasterize SLS, but found an unexpected style: ${e}!`),[0,0]}},Y=(e,t=100)=>{const i=t/2;let n,r;const s=e;if("circle"===s||"esriSMSCircle"===s){const e=.25;let t=Math.acos(1-e/i),s=Math.ceil(S/t/4);0===s&&(s=1),t=w/s,s*=4;const o=[];o.push([i,0]);for(let e=1;e<s;e++)o.push([i*Math.cos(e*t),-i*Math.sin(e*t)]);o.push([i,0]),n={rings:[o]},r={xmin:-i,ymin:-i,xmax:i,ymax:i}}else if("cross"===s||"esriSMSCross"===s){const e=0;n={paths:[[[e,i],[e,-i]],[[i,e],[-i,e]]]},r={xmin:-i,ymin:-i,xmax:i,ymax:i}}else if("diamond"===s||"esriSMSDiamond"===s)n={rings:[[[-i,0],[0,i],[i,0],[0,-i],[-i,0]]]},r={xmin:-i,ymin:-i,xmax:i,ymax:i};else if("square"===s||"esriSMSSquare"===s)n={rings:[[[-i,-i],[-i,i],[i,i],[i,-i],[-i,-i]]]},r={xmin:-i,ymin:-i,xmax:i,ymax:i};else if("x"===s||"esriSMSX"===s)n={paths:[[[i,i],[-i,-i]],[[i,-i],[-i,i]]]},r={xmin:-i,ymin:-i,xmax:i,ymax:i};else if("triangle"===s||"esriSMSTriangle"===s){const e=.5773502691896257*t,i=-e,s=2/3*t,o=s-t;n={rings:[[[i,o],[0,s],[e,o],[i,o]]]},r={xmin:i,ymin:o,xmax:e,ymax:s}}else"arrow"===s&&(n={rings:[[[-50,50],[50,0],[-50,-50],[-33,-20],[-33,20],[-50,50]]]},r={xmin:-i,ymin:-i,xmax:i,ymax:i});return[r,n]},Z=e=>"vertical"===e||"horizontal"===e||"cross"===e||"esriSFSCross"===e||"esriSFSVertical"===e||"esriSFSHorizontal"===e;function q(e){if(!e)return null;let t=null;const{cap:i,color:n,join:r,miterLimit:s,style:o,width:a}=e;return"solid"!==o&&"none"!==o&&"esriSLSSolid"!==o&&"esriSLSNull"!==o&&(t=[{type:"CIMGeometricEffectDashes",dashTemplate:H(o,i),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]),{type:"CIMSolidStroke",color:"esriSLSNull"!==o&&"none"!==o?k(n):[0,0,0,0],capStyle:V(i),joinStyle:L(r),miterLimit:s,width:a,effects:t}}},93996:function(e,t,i){i.d(t,{I:function(){return o},U:function(){return s}});var n=i(33134),r=i(33389);const s=.03;class o{constructor(e=0,t=!1){}isEmpty(e){if(!e.nextPoint())return!0;let t,i,n,r;for(t=e.x,i=e.y;e.nextPoint();t=i,i=r)if(n=e.x,r=e.y,n!==t||r!==i)return e.seekPathStart(),!1;return e.seekPathStart(),!0}normalize(e){const t=Math.sqrt(e[0]*e[0]+e[1]*e[1]);0!==t&&(e[0]/=t,e[1]/=t)}getLength(e,t,i,n){const r=i-e,s=n-t;return Math.sqrt(r*r+s*s)}getSegLength(e){const[[t,i],[n,r]]=e;return this.getLength(t,i,n,r)}getCoord2D(e,t,i,n,r){return[e+(i-e)*r,t+(n-t)*r]}getSegCoord2D(e,t){const[[i,n],[r,s]]=e;return this.getCoord2D(i,n,r,s,t)}getAngle(e,t,i,n,r){const s=i-e,o=n-t;return Math.atan2(o,s)}getAngleCS(e,t,i,n,r){const s=i-e,o=n-t,a=Math.sqrt(s*s+o*o);return a>0?[s/a,o/a]:[1,0]}getSegAngleCS(e,t){const[[i,n],[r,s]]=e;return this.getAngleCS(i,n,r,s,t)}cut(e,t,i,n,r,s){return[r<=0?[e,t]:this.getCoord2D(e,t,i,n,r),s>=1?[i,n]:this.getCoord2D(e,t,i,n,s)]}getSubCurve(e,t,i){const r=n.z.createEmptyOptimizedCIM("esriGeometryPolyline");return this.appendSubCurve(r,e,t,i)?r:null}appendSubCurve(e,t,i,n){e.startPath(),t.seekPathStart();let r=0,s=!0;if(!t.nextPoint())return!1;let o=t.x,a=t.y;for(;t.nextPoint();){const l=this.getLength(o,a,t.x,t.y);if(0!==l){if(s){if(r+l>i){const u=(i-r)/l;let c=1,h=!1;r+l>=n&&(c=(n-r)/l,h=!0);const d=this.cut(o,a,t.x,t.y,u,c);if(d&&e.pushPoints(d),h)break;s=!1}}else{if(r+l>n){const i=this.cut(o,a,t.x,t.y,0,(n-r)/l);i&&e.pushPoint(i[1]);break}e.pushXY(t.x,t.y)}r+=l,o=t.x,a=t.y}else o=t.x,a=t.y}return!0}getCIMPointAlong(e,t){if(!e.nextPoint())return null;let i,n,r,s,o=0;for(i=e.x,n=e.y;e.nextPoint();i=r,n=s){r=e.x,s=e.y;const a=this.getLength(i,n,r,s);if(0!==a){if(o+a>t){const e=(t-o)/a;return this.getCoord2D(i,n,r,s,e)}o+=a}}return null}offset(e,t,i,n,s){if(!e||e.length<2)return null;let o=0,a=e[o++],l=o;for(;o<e.length;){const t=e[o];t[0]===a[0]&&t[1]===a[1]||(o!==l&&(e[l]=e[o]),a=e[l++]),o++}const u=e[0][0]===e[l-1][0]&&e[0][1]===e[l-1][1];if(u&&--l,l<(u?3:2))return null;const c=[];a=u?e[l-1]:null;let h=e[0];for(let s=0;s<l;s++){const o=s===l-1?u?e[0]:null:e[s+1];if(a)if(o){const e=[o[0]-h[0],o[1]-h[1]];this.normalize(e);const s=[h[0]-a[0],h[1]-a[1]];this.normalize(s);const l=s[0]*e[1]-s[1]*e[0],u=s[0]*e[0]+s[1]*e[1];if(0===l&&1===u){h=o;continue}if(l>=0==t<=0){if(u<1){const i=[e[0]-s[0],e[1]-s[1]];this.normalize(i);const r=Math.sqrt((1+u)/2);if(r>1/n){const e=-Math.abs(t)/r;c.push([h[0]-i[0]*e,h[1]-i[1]*e])}}}else switch(i){case r.xw.Mitered:{const i=Math.sqrt((1+u)/2);if(i>0&&1/i<n){const n=[e[0]-s[0],e[1]-s[1]];this.normalize(n);const r=Math.abs(t)/i;c.push([h[0]-n[0]*r,h[1]-n[1]*r]);break}}case r.xw.Bevelled:c.push([h[0]+s[1]*t,h[1]-s[0]*t]),c.push([h[0]+e[1]*t,h[1]-e[0]*t]);break;case r.xw.Rounded:if(u<1){c.push([h[0]+s[1]*t,h[1]-s[0]*t]);const i=Math.floor(2.5*(1-u));if(i>0){const n=1/i;let r=n;for(let o=1;o<i;o++,r+=n){const i=[s[1]*(1-r)+e[1]*r,-s[0]*(1-r)-e[0]*r];this.normalize(i),c.push([h[0]+i[0]*t,h[1]+i[1]*t])}}c.push([h[0]+e[1]*t,h[1]-e[0]*t])}break;case r.xw.Square:default:if(l<0)c.push([h[0]+(s[1]+s[0])*t,h[1]+(s[1]-s[0])*t]),c.push([h[0]+(e[1]-e[0])*t,h[1]-(e[0]+e[1])*t]);else{const i=Math.sqrt((1+Math.abs(u))/2),n=[e[0]-s[0],e[1]-s[1]];this.normalize(n);const r=t/i;c.push([h[0]-n[0]*r,h[1]-n[1]*r])}}}else{const e=[h[0]-a[0],h[1]-a[1]];this.normalize(e),c.push([h[0]+e[1]*t,h[1]-e[0]*t])}else{const e=[o[0]-h[0],o[1]-h[1]];this.normalize(e),c.push([h[0]+e[1]*t,h[1]-e[0]*t])}a=h,h=o}return c.length<(u?3:2)?null:(u&&c.push([c[0][0],c[0][1]]),c)}}},65661:function(e,t,i){i.d(t,{VA:function(){return a},YQ:function(){return n},Z1:function(){return c},ps:function(){return l}});var n,r,s=i(33134),o=i(93996);class a{constructor(){this._values=[],this.extPtGap=0,this.ctrlPtGap=0,this._length=0,this._currentValue=0}isEmpty(){return 0===this._values.length}size(){return this._values.length}init(e,t,i=!0){if(this._setEmpty(),!e||0===e.length)return!1;for(let t=0;t<e.length;t++){let n=Math.abs(e[t]);i&&n<1e-7&&(n=1e-7),this._values.push(n),this._length+=n}return t&&1&e.length&&(this._length*=2),0!==this._length&&(this.ctrlPtGap=this.extPtGap=0,this._currentValue=-1,!0)}scale(e){const t=this._values?this._values.length:0;for(let i=0;i<t;++i)this._values[i]*=e;this._length*=e,this.extPtGap*=e,this.ctrlPtGap*=e}addValue(e){this._length+=e,this._values.push(e)}firstValue(){return this._values[0]}lastValue(){return this._values[this._values.length-1]}nextValue(){return this._currentValue++,this._currentValue===this._values.length&&(this._currentValue=0),this._values[this._currentValue]}reset(){this._currentValue=-1}length(){return this._length}_setEmpty(){this.extPtGap=this.ctrlPtGap=this._length=0,this._currentValue=-1,this._values.length=0}}class l{constructor(){this.pt=null,this.ca=0,this.sa=0}}(r=n||(n={}))[r.FAIL=0]="FAIL",r[r.END=1]="END",r[r.CONTINUE=2]="CONTINUE";class u{constructor(){this.reset()}reset(){this.segment=null,this.segmentLength=0,this.abscissa=0,this.isPathEnd=!1,this.isPartEnd=!1}isValid(){return null!==this.segment}copyTo(e){e.segment=this.segment,e.segmentLength=this.segmentLength,e.abscissa=this.abscissa,e.isPathEnd=this.isPathEnd,e.isPartEnd=this.isPartEnd}}class c extends o.I{constructor(e=0,t=!1){super(e,t),this._tolerance=o.U,this._currentPosition=new u}updateTolerance(e){this._tolerance=o.U*e}init(e,t,i=!0){return i?(this._patternLength=t.length(),this._partExtPtGap=t.extPtGap,this._partCtrlPtGap=t.ctrlPtGap):(this._patternLength=0,this._partExtPtGap=0,this._partCtrlPtGap=0),this._currentPosition.reset(),this._partSegCount=0,this._pathCursor=e,this._seg=-1,this._setPosAtNextPart()}curPositionIsValid(){return this._currentPosition.isValid()}nextPosition(e,t=n.FAIL){const i=new u;return!!this._nextPosition(e,i,null,t)&&(i.copyTo(this._currentPosition),!0)}curPointAndAngle(e){e.pt=this._getPoint(this._currentPosition);const[t,i]=this._getAngleCS(this._currentPosition);e.ca=t,e.sa=i}nextPointAndAngle(e,t,i=n.FAIL){const r=new u;if(!this._nextPosition(e,r,null,i))return!1;r.copyTo(this._currentPosition),t.pt=this._getPoint(r);const[s,o]=this._getAngleCS(r);return t.ca=s,t.sa=o,!0}nextCurve(e){if(0===e)return null;const t=s.z.createEmptyOptimizedCIM("esriGeometryPolyline");t.startPath(),t.nextPath();const i=new u;return this._nextPosition(e,i,t,n.END)?(i.copyTo(this._currentPosition),t):null}isPathEnd(){return this._currentPosition.isPathEnd}getPathEnd(){return this._currentPosition.segment[1]}getPt(e){return this._pathCursor.seekInPath(e),[this._pathCursor.x,this._pathCursor.y]}getSeg(e){return[this.getPt(e),this.getPt(e+1)]}_nextPosition(e,t,i,r){if(this._currentPosition.isPathEnd)return!1;let s=this._currentPosition.abscissa;for(this._currentPosition.segmentLength>0&&(s/=this._currentPosition.segmentLength),this._currentPosition.copyTo(t);t.abscissa+e*this._partLengthRatio>t.segmentLength+this._tolerance;){if(i){if(0===i.pathSize)if(0===s){const e=t.segment[0];i.pushXY(e[0],e[1])}else i.pushPoint(this.getSegCoord2D(t.segment,s));const e=t.segment[1];i.pushXY(e[0],e[1])}if(s=0,e-=(t.segmentLength-t.abscissa)/this._partLengthRatio,this._partSegCount)t.segment=this._nextSegment(),t.segmentLength=this.getSegLength(t.segment),t.abscissa=0,this._partSegCount--;else{if(!this._setPosAtNextPart())return r!==n.FAIL&&(t.segmentLength=this.getSegLength(t.segment),t.isPartEnd=!0,r===n.END?(t.abscissa=t.segmentLength,t.isPathEnd=!0):t.abscissa=t.segmentLength+e,!0);this._currentPosition.copyTo(t)}}if(t.abscissa+=e*this._partLengthRatio,i){0===i.pathSize&&(0===s?i.pushPoint(t.segment[0]):i.pushPoint(this.getSegCoord2D(t.segment,s)));const e=t.abscissa/t.segmentLength;1===e?i.pushPoint(t.segment[1]):i.pushPoint(this.getSegCoord2D(t.segment,e))}return this._partSegCount||Math.abs(t.abscissa-t.segmentLength)<this._tolerance&&(t.isPathEnd=this._partIsLast,t.isPartEnd=!0),!0}_getPoint(e){const t=e.segmentLength<=0?0:e.abscissa/e.segmentLength;return this.getSegCoord2D(this._currentPosition.segment,t)}_getAngleCS(e){const t=e.segmentLength<=0?0:e.abscissa/e.segmentLength;return this.getSegAngleCS(this._currentPosition.segment,t)}_setPosAtNextPart(){for(;this._partSegCount;)this._hasNextSegment()&&this._nextSegment(),this._partSegCount--;if(!this._hasNextSegment())return!1;for(this._partLength=0,this._partIsLast=!0,this._partSegCount=0;this._hasNextSegment();)if(this._partLength+=this.getSegLength(this._nextSegment()),this._partSegCount++,this._pathCursor.getControlPointAt(this._getEndPointIndex())){this._partIsLast=!this._hasNextSegment();break}let e=this._partSegCount;for(;e;)this._previousSegment(),--e;this._currentPosition.segment=this._nextSegment(),this._currentPosition.segmentLength=this.getSegLength(this._currentPosition.segment),this._currentPosition.abscissa=0,this._currentPosition.isPathEnd=this._currentPosition.isPartEnd=!1,--this._partSegCount;const t=this._getStartPointIndex();this._ctrlPtBegin=this._pathCursor.getControlPointAt(t);let i=t+this._partSegCount+1;if(i>=this._pathCursor.pathSize&&(i=0),this._ctrlPtEnd=this._pathCursor.getControlPointAt(i),this._patternLength>0){const e=this._ctrlPtBegin?this._partCtrlPtGap:this._partExtPtGap,t=this._ctrlPtEnd?this._partCtrlPtGap:this._partExtPtGap;let i=Math.round((this._partLength-(e+t))/this._patternLength);i<=0&&(i=e+t>0?0:1),this._partLengthRatio=this._partLength/(e+t+i*this._patternLength),this._partLengthRatio<.01&&(this._partLengthRatio=1)}else this._partLengthRatio=1;return!0}_hasNextSegment(){return this._seg<this._pathCursor.pathSize-2}_previousSegment(){return this.getSeg(--this._seg)}_nextSegment(){return this.getSeg(++this._seg)}_getStartPointIndex(){return this._seg}_getEndPointIndex(){return this._seg+1}}},82497:function(e,t,i){i.d(t,{A:function(){return n}});class n{constructor(e=0,t=0,i=0,n=0){this.x=e,this.y=t,this.width=i,this.height=n}static fromExtent(e){return new n(e.xmin,-e.ymax,e.xmax-e.xmin,e.ymax-e.ymin)}get isEmpty(){return this.width<=0||this.height<=0}union(e){this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.width=Math.max(this.width,e.width),this.height=Math.max(this.height,e.height)}}},44508:function(e,t,i){i.d(t,{Fj:function(){return d},Z7:function(){return c},ce:function(){return f},eR:function(){return l},xt:function(){return h}});var n=i(5161),r=i(74697),s=i(82497),o=i(39686);const a=.45;function l(e,t=.5){switch(e.type){case"CIMPointSymbol":{const t=e.symbolLayers;if(!t||1!==t.length)return null;const i=t[0];return"CIMVectorMarker"!==i.type?null:l(i)}case"CIMVectorMarker":{const i=e.markerGraphics;if(!i||1!==i.length)return null;const n=i[0];if(!n)return null;const r=n.geometry;if(!r)return null;const s=n.symbol;return!s||"CIMPolygonSymbol"!==s.type&&"CIMLineSymbol"!==s.type||s.symbolLayers?.some((e=>!!e.effects))?null:{type:"sdf",geom:r,sdfPaddingRatio:t,asFill:"CIMPolygonSymbol"===s.type}}}}function u(e){let t=1/0,i=-1/0,n=1/0,r=-1/0;for(const s of e)for(const e of s)e[0]<t&&(t=e[0]),e[0]>i&&(i=e[0]),e[1]<n&&(n=e[1]),e[1]>r&&(r=e[1]);return[t,n,i,r]}function c(e){return e?e.rings?u(e.rings):e.paths?u(e.paths):(0,r.ZC)(e)?[e.xmin,e.ymin,e.xmax,e.ymax]:null:null}function h(e,t){const[i,n,r,s]=c(e),a=r-i,l=s-n,u=o.p,h=o.hM,d=Math.floor(.5*(u*t-h)),f=(u-2*(d+h))/Math.max(a,l),p=Math.round(a*f),m=Math.round(l*f);return{pixelDimensions:[a,l],texelDimensions:[Math.round((p+2*d)/f),Math.round((m+2*d)/f)]}}function d(e,t,i,n,r,s,l){const[u,c,h,d]=e;if(h<u||d<c)return{frameSizeRatio:0,anchorX:0,anchorY:0,widthRatio:1,sdfPaddingRatio:.5};const f=h-u,p=d-c,m=Math.max(f,p);let _=.5;if(null!=s&&null!=i){l||null==t||(s*=(t.ymax-t.ymin)/i);const e=s/(s+m),n=.1;e>a&&e<1&&(_=Math.min(e+n,.99))}const g=o.p,y=o.hM,v=Math.floor(.5*(g*_-y)),x=(g-2*(v+y))/m,b=Math.round(f*x)+2*v,S=Math.round(p*x)+2*v;let w=1;t&&(w=S*(1-_)/((t.ymax-t.ymin)*x));let T=0,P=0,I=1;n&&(r?t&&i&&t.ymax-t.ymin>0&&(I=(t.xmax-t.xmin)/(t.ymax-t.ymin),T=n.x/(i*I),P=n.y/i):(T=n.x,P=n.y)),t&&(T=.5*(t.xmax+t.xmin)+T*(t.xmax-t.xmin),P=.5*(t.ymax+t.ymin)+P*(t.ymax-t.ymin)),T-=u,P-=c,T*=x,P*=x,T+=v,P+=v;let M=T/b-.5,A=P/S-.5;return r&&i&&(M*=i*I,A*=i),{frameSizeRatio:w,anchorX:M,anchorY:A,widthRatio:I,sdfPaddingRatio:_}}function f(e){const t=function(e){return e?e.rings?e.rings:e.paths?e.paths:void 0!==e.xmin&&void 0!==e.ymin&&void 0!==e.xmax&&void 0!==e.ymax?[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]:null:null}(e.geom),i=function(e){let t=1/0,i=-1/0,n=1/0,r=-1/0;for(const s of e)for(const e of s)e[0]<t&&(t=e[0]),e[0]>i&&(i=e[0]),e[1]<n&&(n=e[1]),e[1]>r&&(r=e[1]);return new s.A(t,n,i-t,r-n)}(t),n=o.p,r=o.hM,a=Math.floor(.5*(n*e.sdfPaddingRatio-r)),l=n-2*(a+r),u=l/Math.max(i.width,i.height),c=Math.round(i.width*u)+2*a,h=Math.round(i.height*u)+2*a,d=[];for(const n of t)if(n&&n.length>1){const t=[];for(const r of n){let[n,s]=r;n-=i.x,s-=i.y,n*=u,s*=u,n+=a-.5,s+=a-.5,e.asFill?t.push([n,s]):t.push([Math.round(n),Math.round(s)])}if(e.asFill){const e=t.length-1;t[0][0]===t[e][0]&&t[0][1]===t[e][1]||t.push(t[0])}d.push(t)}const f=function(e,t,i,n){const r=t*i,s=new Array(r),o=n*n+1;for(let e=0;e<r;++e)s[e]=o;for(const r of e){const e=r.length;for(let o=1;o<e;++o){const e=r[o-1],a=r[o];let l,u,c,h;e[0]<a[0]?(l=e[0],u=a[0]):(l=a[0],u=e[0]),e[1]<a[1]?(c=e[1],h=a[1]):(c=a[1],h=e[1]);let d=Math.floor(l)-n,f=Math.floor(u)+n,p=Math.floor(c)-n,m=Math.floor(h)+n;d<0&&(d=0),f>t&&(f=t),p<0&&(p=0),m>i&&(m=i);const _=a[0]-e[0],g=a[1]-e[1],y=_*_+g*g;for(let n=d;n<f;n++)for(let r=p;r<m;r++){const o=n+.5,l=r+.5;let u,c,h=(o-e[0])*_+(l-e[1])*g;h<0?(u=e[0],c=e[1]):h>y?(u=a[0],c=a[1]):(h/=y,u=e[0]+h*_,c=e[1]+h*g);const d=(o-u)*(o-u)+(l-c)*(l-c),f=(i-r-1)*t+n;d<s[f]&&(s[f]=d)}}}for(let e=0;e<r;++e)s[e]=Math.sqrt(s[e]);return s}(d,c,h,a);return e.asFill&&function(e,t,i,n,r){for(const s of e){const e=s.length;for(let o=1;o<e;++o){const e=s[o-1],a=s[o];let l,u,c,h;e[0]<a[0]?(l=e[0],u=a[0]):(l=a[0],u=e[0]),e[1]<a[1]?(c=e[1],h=a[1]):(c=a[1],h=e[1]);let d=Math.floor(l),f=Math.floor(u)+1,p=Math.floor(c),m=Math.floor(h)+1;d<n&&(d=n),f>t-n&&(f=t-n),p<n&&(p=n),m>i-n&&(m=i-n);for(let s=p;s<m;++s){if(e[1]>s==a[1]>s)continue;const o=s+.5,l=(i-s-1)*t;for(let t=d;t<f;++t)t+.5<(a[0]-e[0])*(o-e[1])/(a[1]-e[1])+e[0]&&(r[l+t]=-r[l+t]);for(let e=n;e<d;++e)r[l+e]=-r[l+e]}}}}(d,c,h,a,f),{data:p(f,a),width:c,height:h,sdfPaddingRatio:e.sdfPaddingRatio,sdfDecodeCoeff:2*a/l}}function p(e,t){const i=2*t,r=e.length,s=new Uint8Array(4*r);for(let t=0;t<r;++t){const r=.5-e[t]/i;(0,n.U)(r,s,4*t)}return s}},3247:function(e,t,i){i.d(t,{H:function(){return r}});var n=i(58941);const r=new class{get forceStaticPath(){return"disabled"===(0,n.A)("esri-cim-animations-enable-status")}get forceAnimatedPath(){return"forced"===(0,n.A)("esri-cim-animations-enable-status")}get freezeGlobalTime(){return(0,n.A)("esri-cim-animations-freeze-time")??!1}get spotlightAnimatedSymbols(){return!!(0,n.A)("esri-cim-animations-spotlight")}get forceGlobalTimeOrigin(){return!1!==(0,n.A)("esri-cim-animations-freeze-time")}}},2014:function(e,t,i){i.d(t,{$o:function(){return n},$u:function(){return o},gR:function(){return s},zA:function(){return r}});const n=15.5,r=4,s=64,o=1024},63514:function(e,t,i){i.d(t,{N:function(){return n}});class n{static local(){return null===n.instance&&(n.instance=new n),n.instance}execute(e,t,i,n,s){return new r(e,t,i)}}n.instance=null;class r{constructor(e,t,i){this._inputGeometries=e,this._angleTolerance=void 0!==t.angleTolerance?t.angleTolerance:120,this._maxCosAngle=Math.cos((1-Math.abs(this._angleTolerance)/180)*Math.PI)}next(){let e=this._inputGeometries.next();for(;e;){if("esriGeometryPolygon"===e.geometryType)this._isClosed=!0;else if("esriGeometryPolyline"===e.geometryType)this._isClosed=!1;else{if("esriGeometryEnvelope"!==e.geometryType){e=this._inputGeometries.next();continue}if(this._maxCosAngle)return e;this._isClosed=!0}for(;e.nextPath();)this._processPath(e);return e.reset(),e}return null}_processPath(e){if(e.nextPoint()){const t=e.x,i=e.y;let n=t,r=i,s=e.pathSize,o=0,a=0,l=0,u=0,c=0,h=0;this._isClosed&&++s;for(let d=1;e.nextPoint()||d<s;++d){let f,p;this._isClosed&&d===s-1?(f=t,p=i):(f=e.x,p=e.y);const m=f-n,_=p-r,g=Math.sqrt(m*m+_*_);d>1&&g>0&&l>0&&(o*m+a*_)/g/l<=this._maxCosAngle&&e.setControlPointAt(d-1),1===d&&(u=m,c=_,h=g),g>0&&(n=f,r=p,o=m,a=_,l=g)}this._isClosed&&l>0&&h>0&&(o*u+a*c)/h/l<=this._maxCosAngle&&e.setControlPointAt(0)}}}},82112:function(e,t,i){i.d(t,{B:function(){return c}});var n=i(33134),r=i(49077),s=i(23454),o=i(93996),a=i(33389);const l=1.7320508075688772,u=a.oF.OpenEnded;class c{static local(){return null===c.instance&&(c.instance=new c),c.instance}execute(e,t,i,n,r){return new h(e,t,i)}}c.instance=null;class h extends s.rx{constructor(e,t,i){super(e,!1,!0),this._curveHelper=new o.I,this._width=(void 0!==t.width?t.width:5)*i,this._arrowType=void 0!==t.geometricEffectArrowType?t.geometricEffectArrowType:void 0!==t.arrowType?t.arrowType:u,this._offsetFlattenError=o.U*i}processPath(e){const t=n.z.createEmptyOptimizedCIM(e.geometryType);switch(this._arrowType){case a.oF.OpenEnded:default:this._constructSimpleArrow(t,e,!0);break;case a.oF.Block:this._constructSimpleArrow(t,e,!1);break;case a.oF.Crossed:this._constructCrossedArrow(t,e)}return t}_constructSimpleArrow(e,t,i){const n=t.pathLength();let s=this._width;n<2*s&&(s=n/2);const o=this._curveHelper.getSubCurve(t,0,n-s);if(!o||!o.nextPath())return;o.seekPathStart();const a=s/2;if(this._curveHelper.isEmpty(o))return;const l=(0,r.A)(o),u=this._constructOffset(l,-a);if(!u)return;const c=this._constructOffset(l,a);if(!c)return;const h=this._constructArrowBasePoint(u,-a/2);if(!h)return;const d=this._constructArrowBasePoint(c,a/2);if(!d)return;t.seekInPath(t.pathSize-1);const f=[t.x,t.y];e.pushPath(c),e.nextPath(),e.nextPoint(),e.setControlPoint(),e.pushPoint(d),e.nextPoint(),e.setControlPoint(),e.pushPoint(f),e.nextPoint(),e.setControlPoint(),e.pushPoint(h),e.nextPoint(),e.setControlPoint(),e.pushPoints(u.reverse()),e.setControlPoint(),i||(e.setControlPointAt(0),e.setControlPointAt(e.pathSize-1),e.pushPoint(c[0])),e.reset()}_constructCrossedArrow(e,t){const i=t.pathLength();let n=this._width;i<n*(1+l+1)&&(n=i/(1+l+1)),t.seekPathStart();const s=this._curveHelper.getSubCurve(t,0,i-n*(1+l));if(!s)return;s.nextPath();const o=n/2;if(this._curveHelper.isEmpty(s))return;const a=(0,r.A)(s),u=this._constructOffset(a,o);if(!u)return;const c=this._constructOffset(a,-o);if(!c)return;const h=this._curveHelper.getSubCurve(t,0,i-n);if(!h)return;if(h.nextPath(),this._curveHelper.isEmpty(h))return;const d=(0,r.A)(h),f=this._constructOffset(d,o);if(!f)return;const p=this._constructOffset(d,-o);if(!p)return;const m=f[f.length-1],_=this._constructArrowBasePoint(f,o/2);if(!_)return;const g=p[p.length-1],y=this._constructArrowBasePoint(p,-o/2);if(!y)return;t.seekInPath(t.pathSize-1);const v=[t.x,t.y];e.pushPath(u),e.nextPath(),e.nextPoint(),e.setControlPoint(),e.pushPoint(g),e.nextPoint(),e.setControlPoint(),e.pushPoint(y),e.nextPoint(),e.setControlPoint(),e.pushPoint(v),e.nextPoint(),e.setControlPoint(),e.pushPoint(_),e.nextPoint(),e.setControlPoint(),e.pushPoint(m),e.nextPoint(),e.setControlPoint(),e.pushPoints(c.reverse()),e.nextPoint(),e.setControlPoint(),e.reset()}_constructOffset(e,t){return this._curveHelper.offset(e,t,a.xw.Rounded,4,this._offsetFlattenError)}_constructArrowBasePoint(e,t){if(!e||e.length<2)return null;const i=e[e.length-2],n=e[e.length-1],r=[n[0]-i[0],n[1]-i[1]];return this._curveHelper.normalize(r),[n[0]+r[1]*t,n[1]-r[0]*t]}}},20391:function(e,t,i){i.d(t,{s:function(){return u}}),i(50917);var n=i(33134),r=i(49077),s=i(62096),o=i(93996),a=i(33389),l=i(57165);class u{static local(){return null===u.instance&&(u.instance=new u),u.instance}execute(e,t,i,n,r,s){return new c(e,t,i,n,r,s)}}u.instance=null;class c{constructor(e,t,i,n,r,s){this._inputGeometries=e,this._tileKey=n,this._geometryEngine=r,this._curveHelper=new o.I,this._size=(void 0!==t.size?t.size:1)*i,this._maxInflateSize=s*i,this._offsetFlattenError=o.U*i}next(){let e;for(;e=this._inputGeometries.next();){if(0===this._size)return e;if("esriGeometryEnvelope"===e.geometryType)if(this._size>0){const t=n.z.createEmptyOptimizedCIM(e.geometryType),i=(0,r.x)(e)[0],s=this._curveHelper.offset(i,this._size,a.xw.Rounded,4,this._offsetFlattenError);if(s)return t.pushPath(s),t}else if(this._size<0){const t=e.asJSON();if(Math.min(t.xmax-t.xmin,t.ymax-t.ymin)+2*this._size>0)return n.z.fromJSONCIM({xmin:t.xmin-this._size,xmax:t.xmax+this._size,ymin:t.ymin-this._size,ymax:t.ymax+this._size})}const t=this._geometryEngine;if(null==t)return null;const i=this._tileKey?(0,s.q)(e,this._maxInflateSize):e;if(!i)continue;const o=t.buffer(l.A.WebMercator,i.asJSON(),this._size,1);return o?n.z.fromJSONCIM(o):null}return null}}},11672:function(e,t,i){i.d(t,{v:function(){return l}});var n=i(33134),r=i(49077),s=i(38441),o=i(23454),a=i(33389);class l{static local(){return null===l.instance&&(l.instance=new l),l.instance}execute(e,t,i,n,r){return new u(e,t,i)}}l.instance=null;class u{constructor(e,t,i){this._defaultPointSize=20,this._inputGeometries=e,this._geomUnitsPerPoint=i,this._rule=t.rule??a.uQ.FullGeometry,this._defaultSize=this._defaultPointSize*i}next(){let e;for(;e=this._inputGeometries.next();){const t=this._processGeom((0,r.x)(e));if(t?.length)return n.z.fromJSONCIM({paths:t})}return null}_clone(e){return[e[0],e[1]]}_mid(e,t){return[(e[0]+t[0])/2,(e[1]+t[1])/2]}_mix(e,t,i,n){return[e[0]*t+i[0]*n,e[1]*t+i[1]*n]}_add(e,t){return[e[0]+t[0],e[1]+t[1]]}_add2(e,t,i){return[e[0]+t,e[1]+i]}_sub(e,t){return[e[0]-t[0],e[1]-t[1]]}_dist(e,t){return Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1]))}_norm(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}_normalize(e,t=1){const i=t/this._norm(e);e[0]*=i,e[1]*=i}_leftPerpendicular(e){const t=-e[1],i=e[0];e[0]=t,e[1]=i}_leftPerp(e){return[-e[1],e[0]]}_rightPerpendicular(e){const t=e[1],i=-e[0];e[0]=t,e[1]=i}_rightPerp(e){return[e[1],-e[0]]}_dotProduct(e,t){return e[0]*t[0]+e[1]*t[1]}_crossProduct(e,t){return e[0]*t[1]-e[1]*t[0]}_rotateDirect(e,t,i){const n=e[0]*t-e[1]*i,r=e[0]*i+e[1]*t;e[0]=n,e[1]=r}_makeCtrlPt(e){const t=[e[0],e[1]];return(0,o.Aq)(t,1),t}_addAngledTicks(e,t,i,n){const r=this._sub(i,t);this._normalize(r);const s=this._crossProduct(r,this._sub(n,t));let o;o=s>0?this._rightPerp(r):this._leftPerp(r);const a=Math.abs(s)/2,l=[];l.push([t[0]+(o[0]-r[0])*a,t[1]+(o[1]-r[1])*a]),l.push(t),l.push(i),l.push([i[0]+(o[0]+r[0])*a,i[1]+(o[1]+r[1])*a]),e.push(l)}_addBezier2(e,t,i,n,r){if(0==r--)return void e.push(n);const s=this._mid(t,i),o=this._mid(i,n),a=this._mid(s,o);this._addBezier2(e,t,s,a,r),this._addBezier2(e,a,o,n,r)}_addBezier3(e,t,i,n,r,s){if(0==s--)return void e.push(r);const o=this._mid(t,i),a=this._mid(i,n),l=this._mid(n,r),u=this._mid(o,a),c=this._mid(a,l),h=this._mid(u,c);this._addBezier3(e,t,o,u,h,s),this._addBezier3(e,h,c,l,r,s)}_add90DegArc(e,t,i,n,r){const s=r??this._crossProduct(this._sub(i,t),this._sub(n,t))>0,o=this._mid(t,i),a=this._sub(o,t);s?this._leftPerpendicular(a):this._rightPerpendicular(a),o[0]+=a[0],o[1]+=a[1],this._addBezier3(e,t,this._mix(t,.33333,o,.66667),this._mix(i,.33333,o,.66667),i,4)}_addArrow(e,t,i){const n=t[0],r=t[1],s=t[t.length-1],o=this._sub(n,r),a=this._norm(o);this._normalize(o);const l=Math.abs(this._crossProduct(o,this._sub(s,r)));let u=this._dotProduct(o,this._sub(s,r));u<.05*a?u=.05*a:u>.95*a&&(u=.95*a);const c=.5*l,h=this._leftPerp(o),d=[r[0]+o[0]*u,r[1]+o[1]*u],f=t.length-1,p=[];p.push(i?[-h[0],-h[1]]:h);let m=[-o[0],-o[1]];for(let e=1;e<f-1;e++){const i=this._sub(t[e+1],t[e]);this._normalize(i);const n=this._dotProduct(i,m),r=this._crossProduct(i,m),s=Math.sqrt((1+n)/2),o=this._sub(i,m);this._normalize(o),o[0]/=s,o[1]/=s,p.push(r<0?[-o[0],-o[1]]:o),m=i}p.push(this._rightPerp(m));for(let i=p.length-1;i>0;i--)e.push([t[i][0]+p[i][0]*c,t[i][1]+p[i][1]*c]);e.push([d[0]+p[0][0]*c,d[1]+p[0][1]*c]),e.push([d[0]+p[0][0]*l,d[1]+p[0][1]*l]),e.push(n),e.push([d[0]-p[0][0]*l,d[1]-p[0][1]*l]),e.push([d[0]-p[0][0]*c,d[1]-p[0][1]*c]);for(let i=1;i<p.length;i++)e.push([t[i][0]-p[i][0]*c,t[i][1]-p[i][1]*c])}_addDash(e,t,i){const n=this._norm(i)/7;this._normalize(i);let r=[];for(let s=0;s<=7;s++)r.push([t[0]+i[0]*s*n,t[1]+i[1]*s*n]),1&s&&(e.push(r),r=[])}_cp2(e,t,i){return e.length>=2?e[1]:this._add2(e[0],t*this._defaultSize,i*this._defaultSize)}_cp3(e,t,i,n){if(e.length>=3)return e[2];const r=this._mix(e[0],1-i,t,i),s=this._sub(t,e[0]);return this._normalize(s),this._rightPerpendicular(s),[r[0]+s[0]*n*this._defaultSize,r[1]+s[1]*n*this._defaultSize]}_arrowPath(e){if(e.length>2)return e;const t=e[0],i=this._cp2(e,-4,0),n=this._sub(t,i);this._normalize(n);const r=this._rightPerp(n);return[t,i,[t[0]+(r[0]-n[0])*this._defaultSize,t[1]+(r[1]-n[1])*this._defaultSize]]}_arrowLastSeg(e){const t=e[0],i=this._cp2(e,-4,0);let n;if(e.length>=3)n=e[e.length-1];else{const e=this._sub(t,i);this._normalize(e);const r=this._rightPerp(e);n=[t[0]+(r[0]-e[0])*this._defaultSize,t[1]+(r[1]-e[1])*this._defaultSize]}return[i,n]}_processGeom(e){if(!e)return null;const t=[];for(const i of e){const e=i.length>1&&(0,s.Yl)(i)<this._defaultSize;if(!i||0===i.length||e)continue;const n=i.length;let r=i[0];switch(this._rule){case a.uQ.PerpendicularFromFirstSegment:{const e=this._cp2(i,0,-1),n=this._cp3(i,e,.5,4),s=[];s.push(n),s.push(this._mid(r,e)),t.push(s);break}case a.uQ.ReversedFirstSegment:{const e=this._cp2(i,0,-1);t.push([e,r]);break}case a.uQ.PerpendicularToSecondSegment:{if(i.length<3)return[];const e=this._cp2(i,-4,1),n=this._cp3(i,e,.882353,-1.94),s=[];s.push(this._mid(e,n)),s.push(r),t.push(s);break}case a.uQ.SecondSegmentWithTicks:{if(i.length<3)return[];const e=this._cp2(i,-4,1),n=this._cp3(i,e,.882353,-1.94),s=this._sub(n,e);let o;o=this._crossProduct(s,this._sub(r,e))>0?this._rightPerp(s):this._leftPerp(s);const a=[];a.push([e[0]+(o[0]-s[0])/3,e[1]+(o[1]-s[1])/3]),a.push(e),a.push(n),a.push([n[0]+(o[0]+s[0])/3,n[1]+(o[1]+s[1])/3]),t.push(a);break}case a.uQ.DoublePerpendicular:{const e=this._cp2(i,0,-1),n=this._cp3(i,e,.5,3),s=this._mid(r,e),o=this._sub(s,n);this._normalize(o);const a=this._crossProduct(o,this._sub(r,n));this._leftPerpendicular(o);const l=[];l.push(r),l.push([n[0]+o[0]*a,n[1]+o[1]*a]),t.push(l);const u=[];u.push([n[0]-o[0]*a,n[1]-o[1]*a]),u.push(e),t.push(u);break}case a.uQ.OppositeToFirstSegment:{const e=this._cp2(i,0,-1),n=this._cp3(i,e,.5,3),s=this._mid(r,e),o=this._sub(s,n);this._normalize(o);const a=this._crossProduct(o,this._sub(r,n));this._leftPerpendicular(o);const l=[];l.push([n[0]+o[0]*a,n[1]+o[1]*a]),l.push([n[0]-o[0]*a,n[1]-o[1]*a]),t.push(l);break}case a.uQ.TriplePerpendicular:{const e=this._cp2(i,0,-1),n=this._cp3(i,e,.5,4),s=this._mid(r,e),o=this._sub(s,n);this._normalize(o);const a=this._crossProduct(o,this._sub(r,n));this._leftPerpendicular(o);const l=[];l.push([n[0]+o[0]*a*.8,n[1]+o[1]*a*.8]),l.push([s[0]+.8*(r[0]-s[0]),s[1]+.8*(r[1]-s[1])]),t.push(l),t.push([n,s]);const u=[];u.push([n[0]-o[0]*a*.8,n[1]-o[1]*a*.8]),u.push([s[0]+.8*(e[0]-s[0]),s[1]+.8*(e[1]-s[1])]),t.push(u);break}case a.uQ.HalfCircleFirstSegment:{const e=this._cp2(i,0,-1),n=this._cp3(i,e,.5,4),s=this._mid(r,e);let o=this._sub(e,r);const a=Math.cos(Math.PI/18),l=Math.sin(Math.PI/18),u=Math.sqrt((1+a)/2),c=Math.sqrt((1-a)/2),h=[];let d;this._crossProduct(o,this._sub(n,r))>0?(h.push(r),o=this._sub(r,s),d=e):(h.push(e),o=this._sub(e,s),d=r),this._rotateDirect(o,u,c),o[0]/=u,o[1]/=u;for(let e=1;e<=18;e++)h.push(this._add(s,o)),this._rotateDirect(o,a,l);h.push(d),t.push(h);break}case a.uQ.HalfCircleSecondSegment:{const e=this._cp2(i,0,-1),n=this._cp3(i,e,1,-1);let s=this._sub(r,e);this._normalize(s);const o=this._crossProduct(s,this._sub(n,e))/2;this._leftPerpendicular(s);const a=[e[0]+s[0]*o,e[1]+s[1]*o];s=this._sub(e,a);const l=Math.cos(Math.PI/18);let u=Math.sin(Math.PI/18);o>0&&(u=-u);const c=[e];for(let e=1;e<=18;e++)this._rotateDirect(s,l,u),c.push(this._add(a,s));t.push(c);break}case a.uQ.HalfCircleExtended:{const e=this._cp2(i,0,-2),s=this._cp3(i,e,1,-1);let o;if(n>=4)o=i[3];else{const t=this._sub(r,e);o=this._add(s,t)}const a=this._dist(e,s)/2/.75,l=this._sub(e,r);this._normalize(l,a);const u=this._sub(s,o);this._normalize(u,a);const c=[o,s];t.push(c);const h=[this._clone(s)];this._addBezier3(h,s,this._add(s,u),this._add(e,l),e,4),h.push(r),t.push(h);break}case a.uQ.OpenCircle:{const e=this._cp2(i,-2,0),n=this._sub(e,r),s=Math.cos(Math.PI/18),o=-Math.sin(Math.PI/18),a=[e];for(let e=1;e<=33;e++)this._rotateDirect(n,s,o),a.push(this._add(r,n));t.push(a);break}case a.uQ.CoverageEdgesWithTicks:{const e=this._cp2(i,0,-1);let s,o;if(n>=3)s=i[2];else{const t=this._sub(e,r),i=this._leftPerp(t);s=[r[0]+i[0]-.25*t[0],r[1]+i[1]-.25*t[1]]}if(n>=4)o=i[3];else{const t=this._mid(r,e),i=this._sub(r,e);this._normalize(i),this._leftPerpendicular(i);const n=this._crossProduct(i,this._sub(s,t));this._rightPerpendicular(i),o=[s[0]+i[0]*n*2,s[1]+i[1]*n*2]}const a=this._sub(e,r);let l,u;l=this._crossProduct(a,this._sub(s,r))>0?this._rightPerp(a):this._leftPerp(a),u=[],u.push(s),u.push(r),u.push([r[0]+(l[0]-a[0])/3,r[1]+(l[1]-a[1])/3]),t.push(u),l=this._crossProduct(a,this._sub(o,e))>0?this._rightPerp(a):this._leftPerp(a),u=[],u.push([e[0]+(l[0]+a[0])/3,e[1]+(l[1]+a[1])/3]),u.push(e),u.push(o),t.push(u);break}case a.uQ.GapExtentWithDoubleTicks:{const e=this._cp2(i,0,2),s=this._cp3(i,e,0,1);let o;if(n>=4)o=i[3];else{const t=this._sub(e,r);o=this._add(s,t)}this._addAngledTicks(t,r,e,this._mid(s,o)),this._addAngledTicks(t,s,o,this._mid(r,e));break}case a.uQ.GapExtentMidline:{const e=this._cp2(i,2,0),s=this._cp3(i,e,0,1);let o;if(n>=4)o=i[3];else{const t=this._sub(e,r);o=this._add(s,t)}const a=[];a.push(this._mid(r,s)),a.push(this._mid(e,o)),t.push(a);break}case a.uQ.Chevron:{const e=this._cp2(i,-1,-1);let s;if(n>=3)s=i[2];else{const t=this._sub(e,r);this._leftPerpendicular(t),s=this._add(r,t)}t.push([e,this._makeCtrlPt(r),s]);break}case a.uQ.PerpendicularWithArc:{const e=this._cp2(i,0,-2),s=this._cp3(i,e,.5,-1),o=this._sub(e,r),a=this._norm(o);o[0]/=a,o[1]/=a;const l=this._crossProduct(o,this._sub(s,r));let u=this._dotProduct(o,this._sub(s,r));u<.05*a?u=.05*a:u>.95*a&&(u=.95*a);const c=[r[0]+o[0]*u,r[1]+o[1]*u];let h=this._leftPerp(o),d=[];if(d.push([c[0]-h[0]*l,c[1]-h[1]*l]),d.push([c[0]+h[0]*l,c[1]+h[1]*l]),t.push(d),n>=4){const e=i[3];let n=this._dotProduct(o,this._sub(e,r));n<.1*a?n=.1*a:n>.9*a&&(n=.9*a);const s=[r[0]+o[0]*n,r[1]+o[1]*n],l=this._crossProduct(o,this._sub(e,r)),u=[];u.push([s[0]-h[0]*l,s[1]-h[1]*l]),u.push([s[0]+h[0]*l,s[1]+h[1]*l]),t.push(u)}const f=[e[0]+h[0]*l,e[1]+h[1]*l];h=this._sub(e,f);const p=Math.cos(Math.PI/18);let m=Math.sin(Math.PI/18);l<0&&(m=-m),d=[r,e];for(let e=1;e<=9;e++)this._rotateDirect(h,p,m),d.push(this._add(f,h));t.push(d);break}case a.uQ.ClosedHalfCircle:{const e=this._cp2(i,2,0),n=this._mid(r,e),s=this._sub(e,n),o=Math.cos(Math.PI/18),a=Math.sin(Math.PI/18),l=[r,e];for(let e=1;e<=18;e++)this._rotateDirect(s,o,a),l.push(this._add(n,s));t.push(l);break}case a.uQ.TripleParallelExtended:{const e=this._cp2(i,0,-2),n=this._cp3(i,e,1,-2),s=this._mid(r,e),a=this._sub(n,e);this._normalize(a);const l=Math.abs(this._crossProduct(a,this._sub(s,e)))/2,u=this._dist(e,n),c=[e,r];c.push([r[0]+a[0]*u*.5,r[1]+a[1]*u*.5]),t.push(c);const h=[];h.push([s[0]-a[0]*l,s[1]-a[1]*l]),h.push([s[0]+a[0]*u*.375,s[1]+a[1]*u*.375]),(0,o.Aq)(h[h.length-1],1),h.push([s[0]+a[0]*u*.75,s[1]+a[1]*u*.75]),t.push(h);const d=[e,n];t.push(d);break}case a.uQ.ParallelWithTicks:{const e=this._cp2(i,3,0),n=this._cp3(i,e,.5,-1),s=this._sub(n,e);this._normalize(s);const o=this._crossProduct(s,this._sub(n,r));this._leftPerpendicular(s),this._addAngledTicks(t,r,e,n),this._addAngledTicks(t,this._mix(r,1,s,o),this._mix(e,1,s,o),this._mid(r,e));break}case a.uQ.Parallel:{const e=this._cp2(i,3,0),n=this._cp3(i,e,.5,-1),s=this._sub(e,r);this._normalize(s);const o=this._leftPerp(s),a=this._crossProduct(s,this._sub(n,r));let l=[r,e];t.push(l),l=[],l.push([r[0]+o[0]*a,r[1]+o[1]*a]),l.push([e[0]+o[0]*a,e[1]+o[1]*a]),t.push(l);break}case a.uQ.PerpendicularToFirstSegment:{const e=this._cp2(i,3,0),n=this._cp3(i,e,.5,-1),s=this._mid(r,e),o=this._sub(e,r);this._normalize(o);const a=this._crossProduct(o,this._sub(n,r));this._leftPerpendicular(o);const l=[];l.push([s[0]-o[0]*a*.25,s[1]-o[1]*a*.25]),l.push([s[0]+o[0]*a*1.25,s[1]+o[1]*a*1.25]),t.push(l);break}case a.uQ.ParallelOffset:{const e=this._cp2(i,3,0),n=this._cp3(i,e,.5,-1),s=this._sub(e,r);this._normalize(s);const o=this._crossProduct(s,this._sub(n,r));this._leftPerpendicular(s);const a=[];a.push([r[0]-s[0]*o,r[1]-s[1]*o]),a.push([e[0]-s[0]*o,e[1]-s[1]*o]),t.push(a);const l=[];l.push([r[0]+s[0]*o,r[1]+s[1]*o]),l.push([e[0]+s[0]*o,e[1]+s[1]*o]),t.push(l);break}case a.uQ.OffsetOpposite:{const e=this._cp2(i,3,0),n=this._cp3(i,e,.5,-1),s=this._sub(e,r);this._normalize(s);const o=this._crossProduct(s,this._sub(n,r));this._leftPerpendicular(s);const a=[];a.push([r[0]-s[0]*o,r[1]-s[1]*o]),a.push([e[0]-s[0]*o,e[1]-s[1]*o]),t.push(a);break}case a.uQ.OffsetSame:{const e=this._cp2(i,3,0),n=this._cp3(i,e,.5,-1),s=this._sub(e,r);this._normalize(s);const o=this._crossProduct(s,this._sub(n,r));this._leftPerpendicular(s);const a=[];a.push([r[0]+s[0]*o,r[1]+s[1]*o]),a.push([e[0]+s[0]*o,e[1]+s[1]*o]),t.push(a);break}case a.uQ.CircleWithArc:{let e=this._cp2(i,3,0);const s=this._cp3(i,e,.5,-1);let a,l;if(n>=4)a=i[3],l=this._crossProduct(this._sub(a,e),this._sub(s,e))>0;else{a=e,l=this._crossProduct(this._sub(a,r),this._sub(s,r))>0;const t=24*this._geomUnitsPerPoint,i=this._sub(a,r);this._normalize(i,t);const n=Math.sqrt(2)/2;this._rotateDirect(i,n,l?n:-n),e=this._add(r,i)}const u=this._sub(e,r),c=Math.cos(Math.PI/18),h=Math.sin(Math.PI/18),d=[e];for(let e=1;e<=36;e++)this._rotateDirect(u,c,h),d.push(this._add(r,u));this._add90DegArc(d,e,a,s,l),(0,o.Aq)(d[d.length-8],1),t.push(d);break}case a.uQ.DoubleJog:{let e,s=this._cp2(i,-3,1),o=this._cp3(i,s,-1,-.5);if(n>=4)e=i[3];else{const t=r;r=s,e=o;const i=this._dist(r,t),n=this._dist(e,t);let a=30*this._geomUnitsPerPoint;.5*i<a&&(a=.5*i),.5*n<a&&(a=.5*n),s=this._mix(r,a/i,t,(i-a)/i),o=this._mix(e,a/n,t,(n-a)/n)}const a=this._mid(r,s),l=this._mid(e,o),u=this._dist(r,s),c=this._dist(o,e);let h=Math.min(u,c)/8;h=Math.min(h,24*this._geomUnitsPerPoint);const d=Math.cos(Math.PI/4);let f=this._sub(r,s);this._normalize(f,h),this._crossProduct(f,this._sub(e,s))>0?this._rotateDirect(f,d,-d):this._rotateDirect(f,d,d);let p=[];p.push(s),p.push(this._add(a,f)),p.push(this._sub(a,f)),p.push(r),t.push(p),f=this._sub(e,o),this._normalize(f,h),this._crossProduct(f,this._sub(r,o))<0?this._rotateDirect(f,d,d):this._rotateDirect(f,d,-d),p=[],p.push(o),p.push(this._add(l,f)),p.push(this._sub(l,f)),p.push(e),t.push(p);break}case a.uQ.PerpendicularOffset:{const e=this._cp2(i,-4,1),n=this._cp3(i,e,.882353,-1.94),s=this._sub(n,e);this._crossProduct(s,this._sub(r,e))>0?this._rightPerpendicular(s):this._leftPerpendicular(s);const o=[s[0]/8,s[1]/8],a=this._sub(this._mid(e,n),o);t.push([a,r]);break}case a.uQ.LineExcludingLastSegment:{const e=this._arrowPath(i),n=[];let r=e.length-2;for(;r--;)n.push(e[r]);t.push(n);break}case a.uQ.MultivertexArrow:{const e=this._arrowPath(i),n=[];this._addArrow(n,e,!1),t.push(n);break}case a.uQ.CrossedArrow:{const e=this._arrowPath(i),n=[];this._addArrow(n,e,!0),t.push(n);break}case a.uQ.ChevronArrow:{const[e,n]=this._arrowLastSeg(i),s=10*this._geomUnitsPerPoint,o=this._sub(r,e),a=this._norm(o);this._normalize(o);const l=this._crossProduct(o,this._sub(n,e));let u=this._dotProduct(o,this._sub(n,e));u<.05*a?u=.05*a:u>.95*a-s&&(u=.95*a-s);const c=[e[0]+o[0]*u,e[1]+o[1]*u],h=this._leftPerp(o),d=[];d.push([c[0]+h[0]*l+o[0]*s,c[1]+h[1]*l+o[1]*s]),d.push(r),d.push([c[0]-h[0]*l+o[0]*s,c[1]-h[1]*l+o[1]*s]),t.push(d);break}case a.uQ.ChevronArrowOffset:{const[e,n]=this._arrowLastSeg(i),s=this._sub(r,e),o=this._norm(s);this._normalize(s);const a=this._crossProduct(s,this._sub(n,e));let l=this._dotProduct(s,this._sub(n,e));l<.05*o?l=.05*o:l>.95*o&&(l=.95*o);const u=[e[0]+s[0]*l,e[1]+s[1]*l];this._leftPerpendicular(s);const c=[];c.push([u[0]+s[0]*a*.5,u[1]+s[1]*a*.5]),c.push(this._mid(u,r)),c.push([u[0]-s[0]*a*.5,u[1]-s[1]*a*.5]),t.push(c);break}case a.uQ.PartialFirstSegment:{const[e,n]=this._arrowLastSeg(i),s=this._sub(r,e),o=this._norm(s);this._normalize(s);let a=this._dotProduct(s,this._sub(n,e));a<.05*o?a=.05*o:a>.95*o&&(a=.95*o);const l=[e[0]+s[0]*a,e[1]+s[1]*a];t.push([e,l]);break}case a.uQ.Arch:{const e=this._cp2(i,0,-1),n=this._cp3(i,e,.5,1),s=this._sub(r,e),o=this._mix(n,1,s,.55),a=this._mix(n,1,s,-.55),l=[r];this._addBezier2(l,r,o,n,4),this._addBezier2(l,n,a,e,4),t.push(l);break}case a.uQ.CurvedParallelTicks:{const e=this._cp2(i,-4,1),n=this._cp3(i,e,.882353,-1.94),s=this._sub(n,e);this._crossProduct(s,this._sub(r,e))>0?this._rightPerpendicular(s):this._leftPerpendicular(s);const o=[s[0]/8,s[1]/8],a=this._sub(this._mid(e,n),o),l=this._sub(this._mix(e,.75,n,.25),o),u=this._sub(this._mix(e,.25,n,.75),o),c=[e];this._addBezier2(c,e,l,a,3),this._addBezier2(c,a,u,n,3),t.push(c);for(let e=0;e<8;e++){const i=c[2*e+1],n=[this._clone(i)];n.push(this._add(i,[s[0]/4,s[1]/4])),t.push(n)}break}case a.uQ.Arc90Degrees:{const e=this._cp2(i,0,-1),n=this._cp3(i,e,.5,1),s=[e];this._add90DegArc(s,e,r,n),t.push(s);break}case a.uQ.TipWithPerpendicularAndTicks:{const[e,n]=this._arrowLastSeg(i),s=10*this._geomUnitsPerPoint,o=this._sub(r,e),a=this._norm(o);this._normalize(o);let l=this._crossProduct(o,this._sub(n,e)),u=this._dotProduct(o,this._sub(n,e));u<.05*a?u=.05*a:u>.95*a-s&&(u=.95*a-s);const c=this._leftPerp(o),h=[r[0]-o[0]*s,r[1]-o[1]*s],d=.5*Math.max(a-u-s,s);l=Math.abs(l);const f=[];f.push([h[0]+c[0]*(l+d)-o[0]*d,h[1]+c[1]*(l+d)-o[1]*d]),f.push([h[0]+c[0]*l,h[1]+c[1]*l]),f.push([h[0]-c[0]*l,h[1]-c[1]*l]),f.push([h[0]-c[0]*(l+d)-o[0]*d,h[1]-c[1]*(l+d)-o[1]*d]),t.push(f),t.push([h,r]);break}case a.uQ.ConcentricCircles:{const e=this._cp2(i,1,0),s=this._cp3(i,e,2,0),a=Math.cos(Math.PI/18),l=Math.sin(Math.PI/18);let u=this._dist(e,r),c=[u,0],h=[];for(let e=0;e<=36;e++)h.push(this._add(r,c)),this._rotateDirect(c,a,l);if(t.push(h),n>=4){h=[];const e=i[3];u=this._dist(e,r),c=[u,0];for(let e=0;e<=36;e++)h.push(this._add(r,c)),0===e&&(h.push(this._add(r,c)),(0,o.Aq)(h[1],1)),this._rotateDirect(c,a,l);t.push(h)}h=[],u=this._dist(s,r),c=[u,0];for(let e=0;e<=36;e++)h.push(this._add(r,c)),this._rotateDirect(c,a,l);t.push(h);break}case a.uQ.DoubleJogArrow:{r=this._arrowPath(i)[0];const[e,n]=this._arrowLastSeg(i),s=this._sub(r,e),o=this._norm(s);this._normalize(s);const a=Math.abs(this._crossProduct(s,this._sub(n,r)));let l=Math.abs(this._dotProduct(s,this._sub(n,r)));l<.05*o?l=.05*o:l>.95*o&&(l=.95*o);const u=Math.max(a,l),c=this._leftPerp(s);let h=[];const d=[r[0]-s[0]*l*.5+c[0]*a*.5,r[1]-s[1]*l*.5+c[1]*a*.5];h.push([d[0],d[1]]),d[0]+=s[0]*u*.5+c[0]*u*.4,d[1]+=s[1]*u*.5+c[1]*u*.4,h.push([d[0],d[1]]),d[0]-=c[0]*u*.25,d[1]-=c[1]*u*.25,h.push([d[0],d[1]]),d[0]+=s[0]*u*.5+c[0]*u*.4,d[1]+=s[1]*u*.5+c[1]*u*.4,h.push([d[0],d[1]]),t.push(h),h=[],d[0]=r[0]-s[0]*l*.5-c[0]*a*.5,d[1]=r[1]-s[1]*l*.5-c[1]*a*.5,h.push([d[0],d[1]]),d[0]+=s[0]*u*.5-c[0]*u*.4,d[1]+=s[1]*u*.5-c[1]*u*.4,h.push([d[0],d[1]]),d[0]+=c[0]*u*.25,d[1]+=c[1]*u*.25,h.push([d[0],d[1]]),d[0]+=s[0]*u*.5-c[0]*u*.4,d[1]+=s[1]*u*.5-c[1]*u*.4,h.push([d[0],d[1]]),t.push(h);break}case a.uQ.LinkedChevrons:{const e=this._cp2(i,-5,0),n=this._cp3(i,e,-.2,1),s=this._sub(r,e);this._normalize(s);const o=this._leftPerp(s),a=Math.abs(this._crossProduct(s,this._sub(n,e)));t.push([e,r]);const l=[];l.push([r[0]-s[0]*a+o[0]*a,r[1]-s[1]*a+o[1]*a]),l.push(r),l.push([r[0]-s[0]*a-o[0]*a,r[1]-s[1]*a-o[1]*a]),t.push(l),this._addDash(t,e,[-s[0]*a+o[0]*a,-s[1]*a+o[1]*a]),this._addDash(t,e,[-s[0]*a-o[0]*a,-s[1]*a-o[1]*a]);break}case a.uQ.SegmentThenHalfCircle:{const e=this._cp2(i,2,0),s=this._cp3(i,e,1.5,0);let o;o=n>=4?i[3]:this._cp3(i,e,1.25,-.5);const a=this._sub(e,r);this._normalize(a);const l=.5*this._dist(e,s),u=this._crossProduct(a,this._sub(o,r))>0,c=Math.cos(Math.PI/18);let h=Math.sin(Math.PI/18);u&&(h=-h);const d=[r,e];a[0]*=l,a[1]*=l;const f=this._add(e,a);a[0]=-a[0],a[1]=-a[1];for(let e=1;e<=18;e++)this._rotateDirect(a,c,h),d.push(this._add(f,a));t.push(d);break}case a.uQ.LineWithStraightTicks:{const e=this._cp2(i,-2,1),n=this._cp3(i,e,-1,-.5),s=this._sub(n,e);this._normalize(s);const o=this._dotProduct(s,this._sub(e,r)),a=this._dotProduct(s,this._sub(n,r));let l=[r];l.push([r[0]+s[0]*o,r[1]+s[1]*o]),l.push(e),t.push(l),l=[r],l.push([r[0]+s[0]*a,r[1]+s[1]*a]),l.push(n),t.push(l);break}case a.uQ.DoubleCurve:{const e=this._cp2(i,-5,-1),n=this._cp3(i,e,2,0),s=Math.atan2(1,5),a=Math.cos(s),l=Math.sin(s),u=this._sub(e,r),c=this._dist(r,e);this._normalize(u),this._rotateDirect(u,a,-l);const h=[r];h.push([r[0]+u[0]*c*.5,r[1]+u[1]*c*.5]),(0,o.Aq)(h[1],1),h.push([r[0]+u[0]*c*.8,r[1]+u[1]*c*.8]),this._addBezier2(h,h[2],[r[0]+u[0]*c,r[1]+u[1]*c],e,3);const d=this._sub(n,e),f=this._dist(e,n);this._normalize(d),this._rotateDirect(d,a,-l),this._addBezier2(h,e,[n[0]-d[0]*f,n[1]-d[1]*f],[n[0]-d[0]*f*.8,n[1]-d[1]*f*.8],3),h.push(n),t.push(h);break}case a.uQ.ParallelWithTicksByWidth:{const e=this._cp2(i,0,-1),n=this._cp3(i,e,.5,3),s=this._sub(e,r);this._normalize(s);const o=this._crossProduct(s,this._sub(n,r));this._leftPerpendicular(s),o>0?(this._addAngledTicks(t,r,[r[0]+s[0]*o,r[1]+s[1]*o],e),this._addAngledTicks(t,e,[e[0]+s[0]*o,e[1]+s[1]*o],r)):(this._addAngledTicks(t,[r[0]+s[0]*o,r[1]+s[1]*o],r,e),this._addAngledTicks(t,[e[0]+s[0]*o,e[1]+s[1]*o],r,e));break}case a.uQ.EnclosingRoundedRectangle:{const e=this._cp2(i,3,-2),t=[Math.min(r[0],e[0]),Math.max(r[1],e[1])],n=[Math.max(r[0],e[0]),Math.min(r[1],e[1])],s=n[0]-t[0],o=t[1]-n[1],a=Math.min(s,o)/10,l=[];l.push([t[0]+a+.75*(s-2*a),t[1]]),l.push([n[0]-a,t[1]]),this._add90DegArc(l,[n[0]-a,t[1]],[n[0],t[1]-a],[n[0],t[1]]),l.push([n[0],n[1]+a]),this._add90DegArc(l,[n[0],n[1]+a],[n[0]-a,n[1]],n),l.push([t[0]+a,n[1]]),this._add90DegArc(l,[t[0]+a,n[1]],[t[0],n[1]+a],[t[0],n[1]]),l.push([t[0],t[1]-a]),this._add90DegArc(l,[t[0],t[1]-a],[t[0]+a,t[1]],t),l.push([t[0]+a+.75*(s-2*a),t[1]]);break}case a.uQ.FullGeometry:default:t.push(i)}}return t}}},12281:function(e,t,i){i.d(t,{y:function(){return o}});var n=i(33134),r=i(23454),s=i(93996);class o{static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(e,t,i,n,r){return new a(e,t,i)}}o.instance=null;class a extends r.rx{constructor(e,t,i){super(e,!0,!0),this._curveHelper=new s.I,this._beginCut=(void 0!==t.beginCut?t.beginCut:1)*i,this._endCut=(void 0!==t.endCut?t.endCut:1)*i,this._middleCut=(void 0!==t.middleCut?t.middleCut:0)*i,this._invert=void 0!==t.invert&&t.invert,this._beginCut<0&&(this._beginCut=0),this._endCut<0&&(this._endCut=0),this._middleCut<0&&(this._middleCut=0)}processPath(e){const{_beginCut:t,_endCut:i,_middleCut:r}=this,s=e.pathLength(),o=n.z.createEmptyOptimizedCIM("esriGeometryPolyline");if(this._invert){if(0!==t||0!==i||0!==r)if(t+i+r>=s)for(o.startPath();e.nextPoint();)o.pushXY(e.x,e.y);else this._curveHelper.appendSubCurve(o,e,0,t),this._curveHelper.appendSubCurve(o,e,.5*(s-r),.5*(s+r)),this._curveHelper.appendSubCurve(o,e,s-i,i)}else if(0===t&&0===i&&0===r)for(o.startPath();e.nextPoint();)o.pushXY(e.x,e.y);else t+i+r<s&&(0===r?this._curveHelper.appendSubCurve(o,e,t,s-i):(this._curveHelper.appendSubCurve(o,e,t,.5*(s-r)),this._curveHelper.appendSubCurve(o,e,.5*(s+r),s-i)));return 0===o.totalSize?null:o}}},2969:function(e,t,i){i.d(t,{I:function(){return u}});var n=i(33134),r=i(49077),s=i(23454),o=i(33389),a=i(65661),l=i(7590);class u{static local(){return null===u.instance&&(u.instance=new u),u.instance}execute(e,t,i,n,r){return new c(e,t,i)}}u.instance=null;class c extends s.rx{constructor(e,t,i){super(e,!0,!0),this._firstCurve=null,this._walker=new a.Z1,this._walker.updateTolerance(i),this._endings=t.lineDashEnding,this._customDashPos=-(t.offsetAlongLine??0)*i,this._offsetAtEnd=(t.customEndingOffset??0)*i;let n=(0,l.FH)(t).dashTemplate;null==n&&(n=[]),n.length%2&&(n=[...n,...n]),this._pattern=new a.VA,this._pattern.init(n,!0),this._pattern.scale(i)}processPath(e){if(0===this._pattern.length()){this.iteratePath=!1;const t=(0,r.A)(e);return n.z.fromJSONCIM({paths:[t]})}if(!this.iteratePath){let t=!0;switch(this._endings){case o.yS.HalfPattern:case o.yS.HalfGap:default:this._pattern.extPtGap=0;break;case o.yS.FullPattern:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.firstValue());break;case o.yS.FullGap:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.lastValue());break;case o.yS.NoConstraint:this.isClosed||(t=!1);break;case o.yS.Custom:this.isClosed||(this._pattern.extPtGap=.5*this._offsetAtEnd)}const i=e.pathLength();if(this._pattern.isEmpty()||i<.1*this._pattern.length()){const t=(0,r.A)(e);return n.z.fromJSONCIM({paths:[t]})}if(!this._walker.init(e,this._pattern,t)){const t=(0,r.A)(e);return n.z.fromJSONCIM({paths:[t]})}}let t;if(this.iteratePath)t=this._pattern.nextValue();else{let e;switch(this._endings){case o.yS.HalfPattern:default:e=.5*this._pattern.firstValue();break;case o.yS.HalfGap:e=.5*-this._pattern.lastValue();break;case o.yS.FullGap:e=-this._pattern.lastValue();break;case o.yS.FullPattern:e=0;break;case o.yS.NoConstraint:case o.yS.Custom:e=-this._customDashPos}let i=e/this._pattern.length();i-=Math.floor(i),e=i*this._pattern.length(),this._pattern.reset(),t=this._pattern.nextValue();let n=!1;for(;e>=t;)e-=t,t=this._pattern.nextValue(),n=!n;t-=e,n?(this._walker.nextPosition(t),t=this._pattern.nextValue()):this.isClosed&&(this._firstCurve=this._walker.nextCurve(t),t=this._pattern.nextValue(),this._walker.nextPosition(t),t=this._pattern.nextValue())}let i=this._walker.nextCurve(t);if(i)if(this._walker.isPathEnd()){if(this.iteratePath=!1,this._firstCurve){for(this._firstCurve.nextPath();this._firstCurve.nextPoint();)i.pushXY(this._firstCurve.x,this._firstCurve.y);this._firstCurve=null}}else t=this._pattern.nextValue(),!this._walker.nextPosition(t)||this._walker.isPathEnd()?(this.iteratePath=!1,this._firstCurve&&(i.pushCursor(this._firstCurve),this._firstCurve=null)):this.iteratePath=!0;else this.iteratePath=!1,i=this._firstCurve,this._firstCurve=null;return i?.reset(),i}}},7889:function(e,t,i){i.d(t,{O:function(){return a}}),i(50917);var n=i(33134),r=i(62096),s=i(33389),o=i(57165);class a{static local(){return null===a.instance&&(a.instance=new a),a.instance}execute(e,t,i,n,r,s){return new l(e,t,i,n,r,s)}}a.instance=null;class l{constructor(e,t,i,n,r,o){switch(this._inputGeometries=e,this._tileKey=n,this._geometryEngine=r,this._maxInflateSize=o*i,this._width=(void 0!==t.width?t.width:2)*i,t.method){case s.M1.Mitered:case s.M1.Bevelled:case s.M1.Rounded:case s.M1.TrueBuffer:case s.M1.Square:}this._option=t.option}next(){let e;for(;e=this._inputGeometries.next();){if("esriGeometryEnvelope"===e.geometryType&&this._width>0){const t=e.asJSON();return Math.min(t.xmax-t.xmin,t.ymax-t.ymin)-2*this._width<0?e:n.z.fromJSONCIM({paths:[[[t.xmin+this._width,t.ymin+this._width],[t.xmax-this._width,t.ymin+this._width],[t.xmax-this._width,t.ymax-this._width],[t.xmin+this._width,t.ymax-this._width],[t.xmin+this._width,t.ymin+this._width]],[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]})}if("esriGeometryPolygon"===e.geometryType){if(0===this._width)return e.clone();const t=this._geometryEngine;if(null==t)return null;const i=this._tileKey?(0,r.q)(e,this._maxInflateSize):e.clone();if(!i)continue;const n=t.buffer(o.A.WebMercator,i.asJSON(),-this._width,1);if(n)for(const e of n.rings)if(e){i.startPath();for(const t of e.reverse())i.pushXY(t[0],i.yFactor*t[1])}return i}}return null}}},48645:function(e,t,i){i.d(t,{U:function(){return o}});var n=i(33134),r=i(23454),s=i(93996);class o{static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(e,t,i,n,r){return new a(e,t,i)}}o.instance=null;class a extends r.rx{constructor(e,t,i){super(e,!1,!0),this._curveHelper=new s.I,this._length=(void 0!==t.length?t.length:20)*i,this._angle=void 0!==t.angle?t.angle:225,this._position=void 0!==t.position?t.position:50,this._length<0&&(this._length=-this._length),this._position<20&&(this._position=20),this._position>80&&(this._position=80),this._mirror=!1}processPath(e){const t=n.z.createEmptyOptimizedCIM("esriGeometryPolyline");if(this._curveHelper.isEmpty(e))return null;e.seekInPath(0);const i=e.x,r=e.y;e.seekInPath(e.pathSize-1);const s=e.x,o=e.y,a=[s-i,o-r];this._curveHelper.normalize(a);const l=i+(s-i)*this._position/100,u=r+(o-r)*this._position/100,c=Math.cos((90-this._angle)/180*Math.PI);let h=Math.sin((90-this._angle)/180*Math.PI);this._mirror&&(h=-h),this._mirror=!this._mirror;const d=[l-this._length/2*c,u-this._length/2*h],f=[l+this._length/2*c,u+this._length/2*h];return t.pushPath([[i,r],d,f,[s,o]]),t}}},7088:function(e,t,i){i.d(t,{V:function(){return n}});class n{static local(){return null===n.instance&&(n.instance=new n),n.instance}execute(e,t,i,n,s){return new r(e,t,i)}}n.instance=null;class r{constructor(e,t,i){this._inputGeometries=e,this._offsetX=void 0!==t.offsetX?t.offsetX*i:0,this._offsetY=void 0!==t.offsetY?t.offsetY*i:0}next(){let e=this._inputGeometries.next();for(;e;){if(e.totalSize>0)return this._move(e.clone(),this._offsetX,this._offsetY);e=this._inputGeometries.next()}return null}_move(e,t,i){for(;e.nextPath();)for(;e.nextPoint();)e.x=e.x+t,e.y=e.y+i;return e.reset(),e}}},17706:function(e,t,i){i.d(t,{V:function(){return c}}),i(50917);var n=i(33134),r=i(49077),s=i(74697),o=i(62096),a=i(93996),l=i(33389),u=i(57165);class c{static local(){return null===c.instance&&(c.instance=new c),c.instance}execute(e,t,i,n,r,s){return new h(e,t,i,n,r,s)}}c.instance=null;class h{constructor(e,t,i,n,r,s){this._inputGeometries=e,this._tileKey=n,this._geometryEngine=r,this._curveHelper=new a.I,this._offset=(t.offset??1)*i,this._method=t.method,this._maxInflateSize=Math.max(Math.abs(s*i),10),this._option=t.option,this._offsetFlattenError=a.U*i}next(){let e;for(;e=this._inputGeometries.next();){if(0===this._offset)return e.clone();if("esriGeometryEnvelope"===e.geometryType){if(this._method===l.xw.Rounded&&this._offset>0){const t=(0,r.A)(e),i=this._curveHelper.offset(t,-this._offset,this._method,4,this._offsetFlattenError);if(i){const t=n.z.createEmptyOptimizedCIM(e.geometryType);return t.pushPath(i),t}return null}const t=e.asJSON();if((0,s.ZC)(t)&&Math.min(t.xmax-t.xmin,t.ymax-t.ymin)+2*this._offset>0)return n.z.fromJSONCIM({xmin:t.xmin-this._offset,xmax:t.xmax+this._offset,ymin:t.ymin-this._offset,ymax:t.ymax+this._offset})}const t=this._geometryEngine;if(null==t)continue;const i=this._tileKey?(0,o.q)(e,this._maxInflateSize):e.clone();if(!i)continue;const a=t.offset(u.A.WebMercator,i.asJSON(),-this._offset,1,this._method,4,this._offsetFlattenError);return a?n.z.fromJSONCIM(a):null}return null}}},10183:function(e,t,i){i.d(t,{C:function(){return n}});class n{static local(){return null===n.instance&&(n.instance=new n),n.instance}execute(e,t,i,n,s){return new r(e,t,i)}}n.instance=null;class r{constructor(e,t,i){this._inputGeometries=e,this._reverse=void 0===t.reverse||t.reverse}next(){let e=this._inputGeometries.next();for(;e;){if(!this._reverse)return e;if("esriGeometryPolyline"===e.geometryType)return s(e.clone());e=this._inputGeometries.next()}return null}}function s(e){for(;e.nextPath();)for(let t=0;t<e.pathSize/2;t++){e.seekInPath(t);const i=e.x,n=e.y;e.seekInPath(e.pathSize-t-1);const r=e.x,s=e.y;e.x=i,e.y=n,e.seekInPath(t),e.x=r,e.y=s}return e.reset(),e}},1646:function(e,t,i){i.d(t,{v:function(){return r}});var n=i(35068);class r{static local(){return null===r.instance&&(r.instance=new r),r.instance}execute(e,t,i,n,r){return new s(e,t,i)}}r.instance=null;class s{constructor(e,t,i){this._inputGeometries=e,this._rotateAngle=void 0!==t.angle?t.angle*Math.PI/180:0}next(){let e=this._inputGeometries.next();for(;e;){if(0===this._rotateAngle||"esriGeometryPoint"===e.geometryType)return e;if(e.totalSize>0){const t=(0,n.z8)(e),i=(t[2]+t[0])/2,r=(t[3]+t[1])/2;return e.reset(),this._rotate(e.clone(),i,r)}e=this._inputGeometries.next()}return null}_rotate(e,t,i){const n=Math.cos(this._rotateAngle),r=Math.sin(this._rotateAngle);for(;e.nextPath();)for(;e.nextPoint();){const s=e.x-t,o=e.y-i;e.x=t+s*n-o*r,e.y=i+s*r+o*n}return e.reset(),e}}},79323:function(e,t,i){i.d(t,{W:function(){return r}});var n=i(35068);class r{static local(){return null===r.instance&&(r.instance=new r),r.instance}execute(e,t,i,n,r){return new s(e,t,i)}}r.instance=null;class s{constructor(e,t,i){this._inputGeometries=e,this._xFactor=void 0!==t.xScaleFactor?t.xScaleFactor:1.15,this._yFactor=void 0!==t.yScaleFactor?t.yScaleFactor:1.15}next(){const e=this._inputGeometries.next();if(e){if(1===this._xFactor&&1===this._yFactor)return e;if("esriGeometryPoint"===e.geometryType)return e;if(e.totalSize>0){const t=(0,n.z8)(e),i=(t[2]+t[0])/2,r=(t[3]+t[1])/2;return e.reset(),this._scaleCursor(e.clone(),i,r)}}return null}_scaleCursor(e,t,i){for(;e.nextPath();)for(;e.nextPoint();)e.x=t+(e.x-t)*this._xFactor,e.y=i+(e.y-i)*this._yFactor;return e.reset(),e}}},34476:function(e,t,i){i.d(t,{l:function(){return o}});var n=i(33134),r=i(33389),s=i(65661);class o{static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(e,t,i,n,r){return new a(e,t,i)}}o.instance=null;class a{constructor(e,t,i){this._inputGeometries=e,this._height=(void 0!==t.amplitude?t.amplitude:2)*i,this._period=(void 0!==t.period?t.period:3)*i,this._style=t.waveform,this._height<=0&&(this._height=Math.abs(this._height)),this._period<=0&&(this._period=Math.abs(this._period)),this._pattern=new s.VA,this._pattern.addValue(this._period),this._pattern.addValue(this._period),this._walker=new s.Z1,this._walker.updateTolerance(i)}next(){let e=this._inputGeometries.next();for(;e;){if(0===this._height||0===this._period)return e;const t=this._processGeom(e);if(t)return t;e=this._inputGeometries.next()}return null}_processGeom(e){const t=n.z.createEmptyOptimizedCIM(e.geometryType);for(;e.nextPath();){t.startPath();const i=e.pathLength();if(this._walker.init(e,this._pattern))switch(this._style){case r.WE.Sinus:default:this._constructCurve(t,i,!1);break;case r.WE.Square:this._constructSquare(t,i);break;case r.WE.Triangle:this._constructTriangle(t,i);break;case r.WE.Random:this._constructCurve(t,i,!0)}else for(;e.nextPoint();)t.pushXY(e.x,e.y)}return t}_constructCurve(e,t,i){let n=Math.round(t/this._period);0===n&&(n=1);const r=16*n+1,o=t/n,a=this._period/16,l=1/r,u=2*Math.PI*t/o,c=2*Math.PI*Math.random(),h=2*Math.PI*Math.random(),d=2*Math.PI*Math.random(),f=.75-Math.random()/2,p=.75-Math.random()/2,m=new s.ps;this._walker.curPointAndAngle(m),e.pushPoint(m.pt);let _=0;for(;;){if(!this._walker.nextPointAndAngle(a,m)){e.pushPoint(this._walker.getPathEnd());break}{const t=_;let n;if(_+=l,i){const e=this._height/2*(1+.3*Math.sin(f*u*t+c));n=e*Math.sin(u*t+h),n+=e*Math.sin(p*u*t+d),n/=2}else n=.5*this._height*Math.sin(.5*u*t);e.pushXY(m.pt[0]-n*m.sa,m.pt[1]+n*m.ca)}}}_constructSquare(e,t){Math.round(t/this._period);let i=!0;for(;;){let t=!1;if(this._walker.curPositionIsValid()){const n=new s.ps;this._walker.curPointAndAngle(n);const r=new s.ps;if(this._walker.nextPointAndAngle(this._period,r)){const o=new s.ps;this._walker.nextPointAndAngle(this._period,o)&&(i?(e.pushPoint(n.pt),i=!1):e.pushPoint(n.pt),e.pushXY(n.pt[0]-this._height/2*n.sa,n.pt[1]+this._height/2*n.ca),e.pushXY(r.pt[0]-this._height/2*r.sa,r.pt[1]+this._height/2*r.ca),e.pushXY(r.pt[0]+this._height/2*r.sa,r.pt[1]-this._height/2*r.ca),e.pushXY(o.pt[0]+this._height/2*o.sa,o.pt[1]-this._height/2*o.ca),t=!0)}}if(!t){e.pushPoint(this._walker.getPathEnd());break}}}_constructTriangle(e,t){Math.round(t/this._period);let i=!0;for(;;){let t=!1;if(this._walker.curPositionIsValid()){const n=new s.ps;this._walker.curPointAndAngle(n);const r=new s.ps;if(this._walker.nextPointAndAngle(this._period/2,r)){const o=new s.ps;this._walker.nextPointAndAngle(this._period,o)&&(this._walker.nextPosition(this._period/2)&&(i?(e.pushPoint(n.pt),i=!1):e.pushPoint(n.pt),e.pushXY(r.pt[0]-this._height/2*r.sa,r.pt[1]+this._height/2*r.ca),e.pushXY(o.pt[0]+this._height/2*o.sa,o.pt[1]-this._height/2*o.ca)),t=!0)}}if(!t){e.pushPoint(this._walker.getPathEnd());break}}}}},31771:function(e,t,i){i.d(t,{e:function(){return o}});var n=i(23454),r=i(33389),s=i(65661);class o{static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(e,t,i,n,r){return new a(e,t,i)}}o.instance=null;class a extends n.pC{constructor(e,t,i){super(e),this._geometryWalker=new s.Z1,this._geometryWalker.updateTolerance(i),this._angleToLine=t.angleToLine??!0,this._offset=(t.offset?t.offset:0)*i,this._originalEndings=t.endings,this._offsetAtEnd=(t.customEndingOffset?t.customEndingOffset:0)*i,this._position=-(t.offsetAlongLine?t.offsetAlongLine:0)*i,this._pattern=new s.VA,this._pattern.init(t.placementTemplate,!1),this._pattern.scale(i),this._endings=this._originalEndings}processPath(e){if(this._pattern.isEmpty())return null;let t;if(this.iteratePath)t=this._pattern.nextValue();else{this._originalEndings===r.e_.WithFullGap&&this.isClosed?this._endings=r.e_.WithMarkers:this._endings=this._originalEndings,this._pattern.extPtGap=0;let i,n=!0;switch(this._endings){case r.e_.NoConstraint:i=-this._position,i=this._adjustPosition(i),n=!1;break;case r.e_.WithHalfGap:default:i=-this._pattern.lastValue()/2;break;case r.e_.WithFullGap:i=-this._pattern.lastValue(),this._pattern.extPtGap=this._pattern.lastValue();break;case r.e_.WithMarkers:i=0;break;case r.e_.Custom:i=-this._position,i=this._adjustPosition(i),this._pattern.extPtGap=.5*this._offsetAtEnd}if(!this._geometryWalker.init(e,this._pattern,n))return null;this._pattern.reset();let s=0;for(;i>s;)i-=s,s=this._pattern.nextValue();s-=i,t=s,this.iteratePath=!0}const i=new s.ps;return this._geometryWalker.nextPointAndAngle(t,i)?this._endings===r.e_.WithFullGap&&this._geometryWalker.isPathEnd()?(this.iteratePath=!1,null):this._endings===r.e_.WithMarkers&&this._geometryWalker.isPathEnd()&&(this.iteratePath=!1,this.isClosed)?null:(this.internalPlacement.setTranslate(i.pt[0]-this._offset*i.sa,i.pt[1]+this._offset*i.ca),this._angleToLine&&this.internalPlacement.setRotateCS(i.ca,i.sa),this.internalPlacement):(this.iteratePath=!1,null)}_adjustPosition(e){let t=e/this._pattern.length();return t-=Math.floor(t),t*this._pattern.length()}}},15987:function(e,t,i){i.d(t,{y:function(){return o}});var n=i(23454),r=i(93996),s=i(33389);class o{static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(e,t,i,n,r){return new a(e,t,i)}}o.instance=null;class a extends n.pC{constructor(e,t,i){super(e,!1,!0),this._curveHelper=new r.I,this._placePerPart=t.placePerPart??!1,this._angleToLine=void 0===t.angleToLine||t.angleToLine,this._offset=void 0!==t.offset?t.offset*i:0,this._type=t.extremityPlacement,this._position=void 0!==t.offsetAlongLine?t.offsetAlongLine*i:0,this._beginProcessed=!1}processMultiPath(e){return this._placePerPart?super.processMultiPath(e):this.processPath(e)}processPath(e){let t;switch(this._type){case s.$2.Both:default:this._beginProcessed?(t=this._atExtremities(e,this._position,!1),this._beginProcessed=!1,this.iterateMultiPath=!1,this.iteratePath=!1):(t=this._atExtremities(e,this._position,!0),this._beginProcessed=!0,this.iterateMultiPath=!0,this.iteratePath=!0);break;case s.$2.JustBegin:t=this._atExtremities(e,this._position,!0);break;case s.$2.JustEnd:t=this._atExtremities(e,this._position,!1);case s.$2.None:}return t}_atExtremities(e,t,i){if(this._placePerPart||(i?e.seekPath(0):e.seekPath(e.totalSize-1)),i||e.seekPathEnd(),i?e.nextPoint():e.prevPoint()){let n=0,[r,s]=[0,0],[o,a]=[e.x,e.y];for(;i?e.nextPoint():e.prevPoint();){r=o,s=a,o=e.x,a=e.y;const i=this._curveHelper.getLength(r,s,o,a);if(n+i>t){const e=(t-n)/i,[l,u]=this._curveHelper.getAngleCS(r,s,o,a,e),c=this._curveHelper.getCoord2D(r,s,o,a,e);return this.internalPlacement.setTranslate(c[0]-this._offset*u,c[1]+this._offset*l),this._angleToLine&&this.internalPlacement.setRotateCS(-l,-u),this.internalPlacement}n+=i}}return null}}},19511:function(e,t,i){i.d(t,{S:function(){return s}});var n=i(23454),r=i(65661);class s{static local(){return null===s.instance&&(s.instance=new s),s.instance}execute(e,t,i,n,r){return new o(e,t,i)}}s.instance=null;class o extends n.pC{constructor(e,t,i){super(e),this._walker=new r.Z1,this._walker.updateTolerance(i),this._angleToLine=void 0===t.angleToLine||t.angleToLine,this._offset=void 0!==t.offset?t.offset*i:0,this._beginGap=void 0!==t.beginPosition?t.beginPosition*i:0,this._endGap=void 0!==t.endPosition?t.endPosition*i:0,this._flipFirst=void 0===t.flipFirst||t.flipFirst,this._pattern=new r.VA,this._pattern.init(t.positionArray,!1,!1),this._subPathLen=0,this._posCount=this._pattern.size(),this._isFirst=!0,this._prevPos=0}processPath(e){if(this._pattern.isEmpty())return null;let t;if(this.iteratePath){const e=this._pattern.nextValue()*this._subPathLen,i=this._beginGap+e;t=i-this._prevPos,this._prevPos=i}else{if(this._posCount=this._pattern.size(),this._isFirst=!0,this._prevPos=0,this._subPathLen=e.pathLength()-this._beginGap-this._endGap,this._subPathLen<0)return this.iteratePath=!1,null;if(!this._walker.init(e,this._pattern,!1))return null;this._pattern.reset();const i=this._pattern.nextValue()*this._subPathLen,n=this._beginGap+i;t=n-this._prevPos,this._prevPos=n,this.iteratePath=!0}const i=new r.ps;if(!this._walker.nextPointAndAngle(t,i,r.YQ.END))return this.iteratePath=!1,null;this.internalPlacement.setTranslate(i.pt[0]-this._offset*i.sa,i.pt[1]+this._offset*i.ca);const n=this._isFirst&&this._flipFirst;let s,o;return this._angleToLine?(s=i.ca,o=i.sa):(s=1,o=0),n&&(s=-s,o=-o),this.internalPlacement.setRotateCS(s,o),this._isFirst=!1,this._posCount--,0===this._posCount&&(this.iteratePath=!1),this.internalPlacement}}},20305:function(e,t,i){i.d(t,{M:function(){return u}});var n=i(13798),r=i(29076),s=i(33389);const o=512,a=24,l=1e-6;class u{static local(){return null===u.instance&&(u.instance=new u),u.instance}execute(e,t,i,n,r){return new c(e,t,i,n,r)}}u.instance=null;class c{constructor(e,t,i,a,l){if(this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,this._currentX=0,this._currentY=0,this._accelerationMap=null,this._testInsidePolygon=!1,this._verticalSubdivision=!0,this._stepX=Math.abs(t.stepX??16)*i,this._stepY=Math.abs(t.stepY??16)*i,this._stepX=Math.round(128*this._stepX)/128,this._stepY=Math.round(128*this._stepY)/128,0!==this._stepX&&0!==this._stepY){if(this._gridType=t.gridType??s.Q1.Fixed,this._gridType===s.Q1.Random){const e=t.seed??13,i=1;this._randomLCG=new n.A(e*i),this._randomness=(t.randomness??100)/100,this._gridAngle=0,this._shiftOddRows=!1,this._cosAngle=1,this._sinAngle=0,this._offsetX=0,this._offsetY=0,this._buildRandomValues()}else{if(this._randomness=0,this._gridAngle=t.gridAngle??0,this._shiftOddRows=t.shiftOddRows??!1,this._offsetX=(t.offsetX??0)*i,this._offsetY=(t.offsetY??0)*i,this._cosAngle=Math.cos(this._gridAngle/180*Math.PI),this._sinAngle=-Math.sin(this._gridAngle/180*Math.PI),this._stepX)if(this._offsetX<0)for(;this._offsetX<-.5*this._stepX;)this._offsetX+=this._stepX;else for(;this._offsetX>=.5*this._stepX;)this._offsetX-=this._stepX;if(this._stepY)if(this._offsetY<0)for(;this._offsetY<-.5*this._stepY;)this._offsetY+=this._stepY;else for(;this._offsetY>=.5*this._stepY;)this._offsetY-=this._stepY}if(this._graphicOriginX=0,this._graphicOriginY=0,null!=a){const[e,t,i,n]=a.split("/"),r=parseFloat(e),s=parseFloat(t),l=parseFloat(i),u=parseFloat(n);this._graphicOriginX=-(u*2**r+l)*o,this._graphicOriginY=s*o,this._testInsidePolygon=!0}this._internalPlacement=new r.W,this._calculateMinMax(e),this._geometryCursor=e}}next(){return this._geometryCursor?this._nextInside():null}_buildRandomValues(){if(!c._randValues){c._randValues=[];for(let e=0;e<a;e++)for(let e=0;e<a;e++)c._randValues.push(this._randomLCG.getFloat()),c._randValues.push(this._randomLCG.getFloat())}}_calculateMinMax(e){let t,i,n,r,s,a,l,u,c,h,d,f,p,m;this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,l=u=p=d=Number.MAX_VALUE,c=h=m=f=-Number.MAX_VALUE;const _=1!==this._cosAngle;for(e.reset();e.nextPath();)for(;e.nextPoint();)a=e.x,s=e.y,t=a-this._graphicOriginX-this._offsetX,i=s-this._graphicOriginY-this._offsetY,_?(n=this._cosAngle*t-this._sinAngle*i,r=this._sinAngle*t+this._cosAngle*i):(n=t,r=i),l=Math.min(l,n),c=Math.max(c,n),u=Math.min(u,r),h=Math.max(h,r),d=Math.min(d,s),f=Math.max(f,s),p=Math.min(p,a),m=Math.max(m,a);d=d!==Number.MAX_VALUE?d:-o-this._stepY,f=f!==-Number.MAX_VALUE?f:this._stepY,p=p!==Number.MAX_VALUE?p:-this._stepX,m=m!==-Number.MAX_VALUE?m:o+this._stepX;const g=f-d,y=m-p;if(this._verticalSubdivision=g>=y,this._polygonMin=this._verticalSubdivision?d:p,this._testInsidePolygon){let e=0-this._graphicOriginX-this._offsetX-this._stepX,t=o-this._graphicOriginX-this._offsetX+this._stepX,i=-o-this._graphicOriginY-this._offsetY-this._stepY,n=0-this._graphicOriginY-this._offsetY+this._stepY;if(_){const r=[[e,i],[e,n],[t,i],[t,n]];e=i=Number.MAX_VALUE,t=n=-Number.MAX_VALUE;for(const s of r){const r=this._cosAngle*s[0]-this._sinAngle*s[1],o=this._sinAngle*s[0]+this._cosAngle*s[1];e=Math.min(e,r),t=Math.max(t,r),i=Math.min(i,o),n=Math.max(n,o)}}l=l!==Number.MAX_VALUE?Math.max(l,e):e,u=u!==Number.MAX_VALUE?Math.max(u,i):i,c=c!==-Number.MAX_VALUE?Math.min(c,t):t,h=h!==-Number.MAX_VALUE?Math.min(h,n):n}this._xMin=Math.round(l/this._stepX),this._xMax=Math.round(c/this._stepX),this._yMin=Math.round(u/this._stepY),this._yMax=Math.round(h/this._stepY),this._currentX=this._xMax+1,this._currentY=this._yMin-1,this._buildAccelerationMap(e,p,m,d,f)}_buildAccelerationMap(e,t,i,n,r){e.reset();const s=new Map,a=this._verticalSubdivision,l=a?r-n:i-t;let u=Math.ceil(l/10);if(u<=1)return;const c=Math.floor(l/u);let d,f,p,m,_,g,y,v,x,b,S;for(u++,this._delta=c,a?(x=-o-2*this._stepY,b=2*this._stepY,S=n):(x=-2*this._stepX,b=o+2*this._stepX,S=t);e.nextPath();)if(!(e.pathSize<2)&&e.nextPoint())for(d=e.x,f=e.y;e.nextPoint();d=p,f=m){if(p=e.x,m=e.y,a){if(f===m||f<x&&m<x||f>b&&m>b)continue;_=Math.min(f,m),g=Math.max(f,m)}else{if(d===p||d<x&&p<x||d>b&&p>b)continue;_=Math.min(d,p),g=Math.max(d,p)}for(;_<g;)y=Math.floor((_-S)/c),h(y,d,f,p,m,s),_+=c;v=Math.floor((g-S)/c),v>y&&h(v,d,f,p,m,s)}this._accelerationMap=s}_nextInside(){for(;;){if(this._currentX>this._xMax){if(this._currentY++,this._currentY>this._yMax)return null;this._currentX=this._xMin,this._shiftOddRows&&this._currentY%2&&this._currentX--}let e=this._currentX*this._stepX+this._offsetX;this._shiftOddRows&&this._currentY%2&&(e+=.5*this._stepX);const t=this._currentY*this._stepY+this._offsetY;let i,n;if(this._currentX++,this._gridType===s.Q1.Random){const r=(this._currentX%a+a)%a,s=(this._currentY%a+a)%a;i=this._graphicOriginX+e+this._stepX*this._randomness*(.5-c._randValues[s*a+r])*2/3,n=this._graphicOriginY+t+this._stepY*this._randomness*(.5-c._randValues[s*a+r+1])*2/3}else i=this._graphicOriginX+this._cosAngle*e+this._sinAngle*t,n=this._graphicOriginY-this._sinAngle*e+this._cosAngle*t;if(!this._testInsidePolygon||this._isInsidePolygon(i,n,this._geometryCursor))return this._internalPlacement.setTranslate(i,n),this._internalPlacement}}_isInsidePolygon(e,t,i){if(null==this._accelerationMap)return function(e,t,i){let n,r,s,o,a=0;for(e+=l,t+=l,i.reset();i.nextPath();)if(i.nextPoint())for(n=i.x,r=i.y;i.nextPoint();n=s,r=o)s=i.x,o=i.y,r>t!=o>t&&((s-n)*(t-r)-(o-r)*(e-n)>0?a++:a--);return 0!==a}(e,t,i);e+=l,t+=l;const n=this._verticalSubdivision,r=n?t:e,s=Math.floor((r-this._polygonMin)/this._delta),o=this._accelerationMap.get(s);if(!o)return!1;let a,u,c,h=0;for(const i of o){if(a=i[0],u=i[1],n){if(a[1]>t==u[1]>t)continue;c=(u[0]-a[0])*(t-a[1])-(u[1]-a[1])*(e-a[0])}else{if(a[0]>e==u[0]>e)continue;c=(u[1]-a[1])*(e-a[0])-(u[0]-a[0])*(t-a[1])}c>0?h++:h--}return 0!==h}}function h(e,t,i,n,r,s){let o=s.get(e);o||(o=[],s.set(e,o)),o.push([[t,i],[n,r]])}},58892:function(e,t,i){i.d(t,{R:function(){return o}});var n=i(23454),r=i(93996),s=i(33389);class o{static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(e,t,i,n,r){return new a(e,t,i)}}o.instance=null;class a extends n.pC{constructor(e,t,i){super(e),this._curveHelper=new r.I,this._angleToLine=void 0===t.angleToLine||t.angleToLine,this._offset=void 0!==t.offset?t.offset*i:0,this._relativeTo=t.relativeTo,this._position=void 0!==t.startPointOffset?t.startPointOffset*i:0,this._epsilon=.001*i}processPath(e){const t=this._position;if(this._relativeTo===s.ip.SegmentMidpoint){if(this.iteratePath||(this.iteratePath=!0),e.nextPoint()){let[t,i]=[e.x,e.y],[n,r]=[0,0];for(;e.nextPoint();){n=e.x,r=e.y;const s=this._curveHelper.getLength(t,i,n,r);if(s<this._epsilon){t=n,i=r;continue}const o=.5+this._position/s,[a,l]=this._curveHelper.getAngleCS(t,i,n,r,o),u=this._curveHelper.getCoord2D(t,i,n,r,o);return this.internalPlacement.setTranslate(u[0]-this._offset*l,u[1]+this._offset*a),this._angleToLine&&this.internalPlacement.setRotateCS(a,l),this.internalPlacement}}return this.iteratePath=!1,null}const i=this._relativeTo===s.ip.LineEnd;return this.onLine(e,t,i)}onLine(e,t,i){let n,r=!1;switch(this._relativeTo){case s.ip.LineMiddle:default:e.seekPathStart(),n=e.pathLength()/2+t;break;case s.ip.LineBeginning:n=t;break;case s.ip.LineEnd:n=t,r=!0}i?e.seekPathEnd():e.seekPathStart();let o=0;if(i?e.prevPoint():e.nextPoint()){let[t,s]=[e.x,e.y],[a,l]=[0,0];for(;i?e.prevPoint():e.nextPoint();){a=e.x,l=e.y;const i=this._curveHelper.getLength(t,s,a,l);if(o+i>n){const e=(n-o)/i,[u,c]=this._curveHelper.getAngleCS(t,s,a,l,e),h=this._curveHelper.getCoord2D(t,s,a,l,e),d=r?-this._offset:this._offset;return this.internalPlacement.setTranslate(h[0]-d*c,h[1]+d*u),this._angleToLine&&(r?this.internalPlacement.setRotateCS(-u,-c):this.internalPlacement.setRotateCS(u,c)),this.internalPlacement}t=a,s=l,o+=i}}return null}}},80585:function(e,t,i){i.d(t,{A:function(){return s}});var n=i(23454),r=i(93996);class s{static local(){return null===s.instance&&(s.instance=new s),s.instance}execute(e,t,i,n,r){return new o(e,t,i)}}s.instance=null;class o extends n.pC{constructor(e,t,i){super(e),this._curveHelper=new r.I,this._angleToLine=void 0===t.angleToLine||t.angleToLine,this._offset=void 0!==t.offset?t.offset*i:0,this._endPoints=void 0===t.placeOnEndPoints||t.placeOnEndPoints,this._controlPoints=void 0===t.placeOnControlPoints||t.placeOnControlPoints,this._regularVertices=void 0===t.placeOnRegularVertices||t.placeOnRegularVertices,this._tags=[],this._tagIterator=0}processPath(e){if(this.iteratePath||(this._preparePath(e),this.iteratePath=!0),this._tagIterator>=this._tags.length)return this._tags.length=0,this._tagIterator=0,this.iteratePath=!1,null;const t=this._tags[this._tagIterator];this._angleToLine&&this.internalPlacement.setRotate(t[2]);let i=t[0],n=t[1];if(0!==this._offset){const e=Math.cos(t[2]),r=Math.sin(t[2]);i-=this._offset*r,n+=this._offset*e}return this.internalPlacement.setTranslate(i,n),this._tagIterator++,this.internalPlacement}_preparePath(e){this._tags.length=0,this._tagIterator=0,e.seekPathStart();const t=e.isClosed();let i=0,n=!1,r=0,s=0;if(e.seekPathStart(),e.nextPoint()){let o=e.x,l=e.y,u=e.getControlPoint(),c=!0,h=e.nextPoint();for(;h;){const d=e.x,f=e.y,p=e.getControlPoint();(this._angleToLine||0!==this._offset)&&(r=this._curveHelper.getAngle(o,l,d,f,0)),c?(c=!1,t?(i=r,n=u):(this._endPoints||this._controlPoints&&u)&&this._tags.push([o,l,r])):u?this._controlPoints&&this._tags.push([o,l,a(s,r)]):this._regularVertices&&this._tags.push([o,l,a(s,r)]),(this._angleToLine||0!==this._offset)&&(s=this._curveHelper.getAngle(o,l,d,f,1)),h=e.nextPoint(),h||(t?p||n?this._controlPoints&&this._tags.push([d,f,a(s,i)]):this._regularVertices&&this._tags.push([d,f,a(s,i)]):(this._endPoints||this._controlPoints&&p)&&this._tags.push([d,f,s])),o=d,l=f,u=p}}this._tagIterator=0}}function a(e,t){const i=Math.PI;for(;Math.abs(t-e)>i+2e-15;)t-e>i?t-=2*i:t+=2*i;return(e+t)/2}},58676:function(e,t,i){i.d(t,{L:function(){return l}});var n=i(35068),r=i(72228),s=i(30804),o=i(29076),a=i(33389);class l{static local(){return null===l.instance&&(l.instance=new l),l.instance}execute(e,t,i,n,r){return new u(e,t,i)}}l.instance=null;class u{constructor(e,t,i){this._geometryCursor=e,this._offsetX=void 0!==t.offsetX?t.offsetX*i:0,this._offsetY=void 0!==t.offsetY?t.offsetY*i:0,this._method=void 0!==t.method?t.method:a.YI.OnPolygon,this._placementPerPart=void 0!==t.placePerPart&&t.placePerPart,this._internalPlacement=new o.W}next(){const e=this._geometryCursor;if(!e)return null;if(!this._placementPerPart)return this._geometryCursor=null,this._polygonCenter(e);for(;e.nextPath();)if(!(e.getCurrentRingArea()<0))return this._polygonCenter(e.getCurrentPath());return this._geometryCursor=null,null}_polygonCenter(e){let t=!1;switch(this._method){case a.YI.CenterOfMass:{const i=(0,r.TP)(e);i&&(this._internalPlacement.setTranslate(i[0]+this._offsetX,i[1]+this._offsetY),t=!0)}break;case a.YI.BoundingBoxCenter:{const i=(0,n.z8)(e);i&&(this._internalPlacement.setTranslate((i[2]+i[0])/2+this._offsetX,(i[3]+i[1])/2+this._offsetY),t=!0)}break;case a.YI.OnPolygon:default:{const i=(0,s.d)(e);null!==i&&(this._internalPlacement.setTranslate(i[0]+this._offsetX,i[1]+this._offsetY),t=!0)}}return t?this._internalPlacement:null}}},53838:function(e,t,i){i.d(t,{j:function(){return _}});var n=i(39819),r=i(58941),s=i(40633),o=i(39686),a=i(7459),l=i(88413),u=i(85456),c=i(96402),h=i(12285),d=i(10956);class f{constructor(e,t,i){this._texture=null,this._lastTexture=null,this._fbos={},this.texelSize=4;const{buffer:n,pixelType:r,textureOnly:s}=e,o=(0,l.Qz)(r);this.blockIndex=i,this.pixelType=r,this.size=t,this.textureOnly=s,s||(this.data=new o(n)),this._resetRange()}destroy(){this._texture?.dispose();for(const e in this._fbos){const t=this._fbos[e];t&&("0"===e&&t.detachColorTexture(),t.dispose()),this._fbos[e]=null}this._texture=null}get _textureDesc(){const e=new d.R;return e.wrapMode=u.pF.CLAMP_TO_EDGE,e.samplingMode=u.Cj.NEAREST,e.dataType=this.pixelType,e.width=this.size,e.height=this.size,e}setData(e,t,i){const n=(0,a.Q4)(e),r=this.data,s=n*this.texelSize+t;!r||s>=r.length||(r[s]=i,this.dirtyStart=Math.min(this.dirtyStart,n),this.dirtyEnd=Math.max(this.dirtyEnd,n))}getData(e,t){if(null==this.data)return null;const i=(0,a.Q4)(e)*this.texelSize+t;return!this.data||i>=this.data.length?null:this.data[i]}getTexture(e){return this._texture??this._initTexture(e)}getFBO(e,t=0){if(!this._fbos[t]){const i=0===t?this.getTexture(e):this._textureDesc;this._fbos[t]=new c.H(e,i)}return this._fbos[t]}get hasDirty(){const e=this.dirtyStart;return this.dirtyEnd>=e}updateTexture(e,t){try{const i=this.dirtyStart,o=this.dirtyEnd;if(!this.hasDirty)return;(0,r.A)("esri-2d-update-debug")&&console.debug(`Version[${t}] AttributeStoreView.updateTexture`,{start:i,end:o,firstBytes:new Uint8Array(this.data.buffer.slice(0,16)),block:this}),this._resetRange();const a=this.data.buffer,u=this.getTexture(e),c=4,h=(i-i%this.size)/this.size,d=(o-o%this.size)/this.size,f=h,p=this.size,m=d,_=h*this.size*c,g=(p+m*this.size)*c-_,y=(0,l.Qz)(this.pixelType),v=new y(a,_*y.BYTES_PER_ELEMENT,g),x=this.size,b=m-f+1;if(b>this.size)return void s.A.getLogger("esri.views.2d.engine.webgl.AttributeStoreView").error(new n.A("mapview-webgl","Out-of-bounds index when updating AttributeData"));u.updateData(0,0,f,x,b,v)}catch(e){}}update(e){const{data:t,start:i,end:n}=e;if(null!=t&&null!=this.data){const n=this.data,r=i*this.texelSize;for(let i=0;i<t.length;i++){const s=1<<i%this.texelSize;e.layout&s&&(n[r+i]=t[i])}}this.dirtyStart=Math.min(this.dirtyStart,i),this.dirtyEnd=Math.max(this.dirtyEnd,n)}resize(e,t){const i=this.size;if(this.size=t,this.textureOnly)return void(i!==this.size&&(this._lastTexture=this._texture,this._texture=null));const n=(0,l.Qz)(this.pixelType);this.destroy(),this.data=new n(e.buffer)}_resetRange(){this.dirtyStart=2147483647,this.dirtyEnd=0}_initTexture(e){const t=new h.g(e,this._textureDesc,this.data??void 0);if(null!=this._lastTexture&&this._fbos[0]){const i=this._lastTexture.descriptor.width,n=this._lastTexture.descriptor.height,r=this._lastTexture.descriptor.dataType,s=this._lastTexture.descriptor.pixelFormat,o=this.getFBO(e),a=(0,l.AV)(r),u=new((0,l.Qz)(r))(new ArrayBuffer(i*n*a*this.texelSize)),c=e.getBoundFramebufferObject(),{x:h,y:d,width:f,height:p}=e.getViewport();e.bindFramebuffer(o),o.readPixels(0,0,i,n,s,r,u),t.updateData(0,0,0,2*i,n/2,u),e.setViewport(h,d,f,p),e.bindFramebuffer(c)}return this.destroy(),this._texture=t,this._texture}}class p{constructor(){this.size=0,this._pendingAttributeUpdates=[],this._version=0,this._epoch=0,this._locked=!1}_initialize(e){if(!e)throw new Error("InternalError: initArgs must be defined");const t=e.blockDescriptors;if(this.size=e.blockSize,(0,r.A)("esri-2d-update-debug")&&console.debug("AttributeStoreView.initialize",{message:e}),null==this._data)this._data=t.map(((e,t)=>null!=e?new f(e,this.size,t):null));else for(let e=0;e<this._data.length;e++){const i=this._data[e],n=t[e];null!=n&&(null==i?this._data[e]=new f(n,this.size,e):i.resize(n,this.size))}}destroy(){for(const e of this._data??[])e?.destroy();this._defaultTexture?.dispose(),this._defaultTexture=null,this._pendingAttributeUpdates=[]}isEmpty(){return null==this._data}getBlock(e){return null==this._data?null:this._data[e]}setLabelMinZoom(e,t){this.setData(e,o.dV.FilterFlags,1,t)}setLocalTimeOrigin(e,t){this.setData(e,o.dV.LocalTimeOrigin,0,t)}getLabelMinZoom(e){return this.getData(e,o.dV.FilterFlags,1,255)}getFilterFlags(e){return this.getData(e,o.dV.FilterFlags,0,0)}getVisualVariableData(e,t){return this.getData(e,o.dV.VV,t,0)}getData(e,t,i,n){if(!this._data)return 0;const r=this._data[t];if(null==r)return 0;const s=r.getData(e,i);return null!=s?s:n}setData(e,t,i,n){this._data[t].setData(e,i,n)}lockTextureUploads(){this._locked=!0}unlockTextureUploads(){this._locked=!1,this.update()}requestUpdate(e){this._version=e.version,this._pendingAttributeUpdates.push(e),(0,r.A)("esri-2d-update-debug")&&console.debug(`Version[${this._version}] AttributeStoreView.requestUpdate`,{message:e})}get currentEpoch(){return this._epoch}update(){if(this._locked)return;const e=this._pendingAttributeUpdates;this._pendingAttributeUpdates=[];for(const t of e){const{blockData:e,initArgs:i,sendUpdateEpoch:n,version:s}=t;(0,r.A)("esri-2d-update-debug")&&console.debug(`Version[${this._version}] Epoch[${n}] AttributeStoreView.applyUpdate`),this._version=s,this._epoch=n,null!=i&&this._initialize(i);const o=this._data;for(let t=0;t<e.length;t++){const i=e[t],n=o[t];null!=n&&null!=i&&((0,r.A)("esri-2d-update-debug")&&console.debug(`Version[${this._version}] CpuBlock[${t}] AttributeStoreView.update`,{block:i}),n.update(i))}}}getUniforms(e){return{filterFlags:{texture:this._getTexture(e,o.dV.FilterFlags),unit:o.uM},animation:{texture:this._getTexture(e,o.dV.Animation),unit:o.z2},gpgpu:{texture:this._getTexture(e,o.dV.GPGPU),unit:o.Sr},localTimeOrigin:{texture:this._getTexture(e,o.dV.LocalTimeOrigin),unit:o.zt},visualVariableData:{texture:this._getTexture(e,o.dV.VV),unit:o.nM},dataDriven0:{texture:this._getTexture(e,o.dV.DD0),unit:o.lL},dataDriven1:{texture:this._getTexture(e,o.dV.DD1),unit:o.sn},dataDriven2:{texture:this._getTexture(e,o.dV.DD2),unit:o.n9},size:this.size}}_getTexture(e,t){const i=this._data?.[t];return i?(i.updateTexture(e,this._version),i.getTexture(e)):this._getDefaultTexture(e)}_getDefaultTexture(e){if(null==this._defaultTexture){const t=new d.R;t.wrapMode=u.pF.CLAMP_TO_EDGE,t.samplingMode=u.Cj.NEAREST,t.width=1,t.height=1,this._defaultTexture=new h.g(e,t,new Uint8Array(4))}return this._defaultTexture}}var m=i(82087);class _ extends m.A{constructor(e){super(e),this._statisticsByLevel=new Map,this._entityIndex=new Map,this.attributeView=new p}destroy(){this.children.forEach((e=>e.destroy())),this.removeAllChildren(),this.attributeView.destroy()}doRender(e){e.context.capabilities.enable("textureFloatLinear"),super.doRender(e)}get hasAnimations(){for(const e of this.children)if(e.hasAnimations)return!0;return!1}_reindexAndUpdateFeaturesIfNeeded(){if(this.hasAnimations&&(this._reindexFeatures(),0!==this.attributeView.size))for(const e of this._entityIndex.values())e.dirty&&(this.attributeView.setData(e.displayId,o.dV.LocalTimeOrigin,0,e.firstIndexed),e.dirty=!1)}restartAnimation(e){const t=this._entityIndex.get(e);if(!t)return;const i=performance.now()/1e3;t.firstIndexed=i,t.dirty=!0}restartAllAnimations(){const e=performance.now()/1e3;for(const[t,i]of this._entityIndex)i.firstIndexed=e,i.dirty=!0}_reindexFeatures(){const e=performance.now()/1e3;for(const t of this.children)for(const i of t.entityIds){const{objectId:t}=i;let n=this._entityIndex.get(t);n||(n={objectId:t,displayId:0,firstIndexed:e,lastIndexed:0,dirty:!0},this._entityIndex.set(t,n)),n.lastIndexed=e,n.displayId=i.displayId}for(const[t,i]of this._entityIndex)e-i.lastIndexed>60&&this._entityIndex.delete(t)}_updateAttributeView(){this.attributeView.update(),this._reindexAndUpdateFeaturesIfNeeded()}createRenderParams(e){const t=super.createRenderParams(e);return t.attributeView=this.attributeView,t.instanceStore=this._instanceStore,t.statisticsByLevel=this._statisticsByLevel,t}}},7965:function(e,t,i){i.d(t,{m:function(){return l}});var n=i(44567),r=i(87085),s=i(25090),o=i(36729),a=i(77515);class l extends a.q{constructor(){super(...arguments),this._childrenSet=new Set,this._needsSort=!1,this._children=[],this._childrenObservable=new r.I,this._effectView=null,this._highlightGradient=null}get blendMode(){return this._blendMode}set blendMode(e){this._blendMode=e,this.requestRender()}get children(){return(0,n.gc)(this._childrenObservable),this._children}get clips(){return this._clips}set clips(e){this._clips=e,this.children.forEach((t=>t.clips=e))}get computedEffects(){return this._effectView?.effects??null}get effect(){return this._effectView?.effect??""}set effect(e){(this._effectView||e)&&(this._effectView||(this._effectView=new o.$B,this.addTransitionable(this._effectView)),this._effectView.effect=e,this.requestRender())}get highlightGradient(){return this._highlightGradient}set highlightGradient(e){this._highlightGradient=e,this.requestRender()}get hasBlending(){return!!this.blendMode}get hasHighlight(){return this.children.some((e=>e.hasHighlight))}get hasLabels(){return this.children.some((e=>e.hasLabels))}get requiresDedicatedFBO(){return this.children.some((e=>"blendMode"in e&&e.blendMode&&"normal"!==e.blendMode))}get isReady(){return this.children.every((e=>e.isReady))}get sortFunction(){return this._sortFunction}set sortFunction(e){this._sortFunction=e,e&&(this._needsSort=!0)}doRender(e){const t=this.createRenderParams(e),{painter:i}=t;i.beforeRenderLayer(t,this._clips?.length?255:0,this.computedOpacity),this.renderChildren(t),i.afterRenderLayer(t,this.computedOpacity)}addChild(e){return this.addChildAt(e,this.children.length)}addChildAt(e,t=this.children.length){if(!e)return e;if(this.contains(e))return e;this._needsSort=!0;const i=e.parent;return i&&i!==this&&i.removeChild(e),t>=this.children.length?this.children.push(e):this.children.splice(t,0,e),this._childrenSet.add(e),e.parent=this,e.stage=this.stage,this!==this.stage&&(e.clips=this.clips),this.requestRender(),this._childrenObservable.notify(),e}contains(e){return(0,n.gc)(this._childrenObservable),this._childrenSet.has(e)}removeAllChildren(){this._childrenSet.clear(),this._needsSort=!0;for(const e of this.children)this!==this.stage&&(e.clips=null),e.stage=null,e.parent=null;this.children.length=0,this._childrenObservable.notify()}removeChild(e){return this.contains(e)?this.removeChildAt(this.children.indexOf(e)):e}removeChildAt(e){if(e<0||e>=this.children.length)return null;this._needsSort=!0;const t=this.children.splice(e,1)[0];return this._childrenSet.delete(t),this!==this.stage&&(t.clips=null),t.stage=null,t.parent=null,this._childrenObservable.notify(),t}beforeRender(e){super.beforeRender(e),this.sortFunction&&this._needsSort&&(this.children.sort(this.sortFunction),this._needsSort=!1,this._childrenObservable.notify());for(const t of this.children)t.beforeRender(e)}afterRender(e){super.afterRender(e);for(const t of this.children)t.afterRender(e)}_createTransforms(){return{displayViewScreenMat3:(0,s.vt)()}}onAttach(){super.onAttach();const e=this.stage;for(const t of this.children)t.stage=e}onDetach(){super.onDetach();for(const e of this.children)e.stage=null}renderChildren(e){for(const t of this.children)t.processRender(e)}createRenderParams(e){return{...e,requireFBO:this.requiresDedicatedFBO,blendMode:this.blendMode,effects:this.computedEffects,globalOpacity:e.globalOpacity*this.computedOpacity,inFadeTransition:this.inFadeTransition,highlightGradient:this._highlightGradient||e.highlightGradient}}isTransitioning(){return super.isTransitioning()||this.children.some((e=>e.transitioning))}}},77515:function(e,t,i){i.d(t,{q:function(){return o}});var n=i(50659),r=i(48996),s=i(86668);class o extends r.A{constructor(){super(...arguments),this._transitionables=null,this._clips=null,this._fadeTransition=null,this._isReady=!1,this._opacity=1,this.parent=null,this._stage=null,this._visible=!0}get computedOpacity(){return this._fadeTransition?.computedOpacity??this.opacity}get clips(){return this._clips}set clips(e){this._clips=e,this.requestRender()}get fadeTransitionEnabled(){return null!==this._fadeTransition}set fadeTransitionEnabled(e){!this._fadeTransition&&e?(this._fadeTransition=new s.A({opacity:this.opacity,visible:this.visible}),this.addTransitionable(this._fadeTransition)):this._fadeTransition&&!e&&(this.removeTransitionable(this._fadeTransition),this._fadeTransition=null)}get inFadeTransition(){return this._fadeTransition?.transitioning??!1}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(e){this._opacity!==e&&(this._opacity=Math.min(1,Math.max(e,0)),this._fadeTransition&&(this._fadeTransition.opacity=this._opacity),this.requestRender())}get stage(){return this._stage}set stage(e){if(this._stage===e)return;const t=this._stage;this._stage=e,e?this._stage?.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):t?.trashDisplayObject(this)}get transforms(){return null==this._transforms&&(this._transforms=this._createTransforms()),this._transforms}get transitioning(){return this.isTransitioning()}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this._fadeTransition&&(this._fadeTransition.visible=this._visible),this.requestRender())}get hasLabels(){return!1}get hasHighlight(){return!1}get hasBlending(){return!1}addTransitionable(e){this._transitionables??=[],this._transitionables.push(e),this.requestRender()}removeTransitionable(e){e.endTransition(),this._transitionables&&(0,n.TF)(this._transitionables,e),this.requestRender()}fadeIn(){this.fadeTransitionEnabled=!0;const e=this._fadeTransition.fadeIn();return this.opacity=1,this.requestRender(),e}fadeOut(){this.fadeTransitionEnabled=!0;const e=this._fadeTransition.fadeOut();return this.opacity=0,this.requestRender(),e}endTransitions(){if(this._transitionables){for(const e of this._transitionables)e.endTransition();this.requestRender()}}beforeRender(e){this.transitionStep(e.deltaTime,e.state.scale),this.setTransform(e.state)}afterRender(e){this.transitioning&&this.requestRender()}remove(){this.parent?.removeChild(this)}setTransform(e){}processRender(e){this.stage&&(this._fadeTransition?.computedVisible??this.visible)&&this.doRender(e)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this.endTransitions(),this.onDetach(),this.emit("detach")}isTransitioning(){return this._transitionables?.some((e=>e.transitioning))??!1}transitionStep(e,t){if(this._transitionables)for(const i of this._transitionables)i.transitionStep(e,t)}onAttach(){}onDetach(){}doRender(e){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}}},80708:function(e,t,i){i.d(t,{d:function(){return C}});var n=i(73936),r=i(43745),s=i(88413),o=i(52937),a=i(94020),l=i(85456),u=i(10904);class c extends o.A{constructor(){super(...arguments),this._color=(0,r.fA)(0,1,0,1)}dispose(){this._program&&this._program.dispose()}prepareState({context:e}){e.setStencilTestEnabled(!0),e.setBlendingEnabled(!1),e.setFaceCullingEnabled(!1),e.setColorMask(!1,!1,!1,!1),e.setStencilOp(l.eA.KEEP,l.eA.KEEP,l.eA.REPLACE),e.setStencilWriteMask(255),e.setStencilFunction(l.MT.ALWAYS,0,255)}draw(e,t){const{context:i,state:n,requestRender:r,allowDelayedRender:o}=e,c=(0,s.ES)("clip",{geometry:[{location:0,name:"a_pos",count:2,type:l.pe.SHORT}]}),h=t.getVAO(i,n,c.attributes,c.bufferLayouts);null!=h.indexBuffer&&(this._program||(this._program=(0,u.r)(i,a.T)),!o||null==r||this._program.compiled?(i.useProgram(this._program),this._program.setUniform2fv("u_coord_range",[1,1]),this._program.setUniform4fv("u_color",this._color),this._program.setUniformMatrix3fv("u_dvsMat3",n.displayMat3),i.bindVAO(h),i.drawElements(l.WR.TRIANGLES,h.indexBuffer.size,l.pe.UNSIGNED_INT,0),i.bindVAO()):r())}}var h=i(829),d=i(55382),f=i(15774),p=i(25090),m=i(39686),_=i(86305),g=i(81438);class y extends o.A{constructor(){super(...arguments),this._color=(0,r.fA)(1,0,0,1),this._patternMatrix=(0,p.vt)(),this._programOptions={id:!1,pattern:!1}}dispose(){this._vao&&(this._vao.dispose(),this._vao=null)}drawMany(e,t){const{context:i,painter:n,requestRender:r,allowDelayedRender:s}=e;this._loadWGLResources(e);const o=e.displayLevel,a=e.styleLayer,u=a.backgroundMaterial,c=n.vectorTilesMaterialManager,h=a.getPaintValue("background-color",o),d=a.getPaintValue("background-opacity",o),p=a.getPaintValue("background-pattern",o),_=void 0!==p,g=1|window.devicePixelRatio,y=e.spriteMosaic;let v,x;const b=g>m.C_?2:1,S=this._programOptions;S.pattern=_;const w=c.getMaterialProgram(i,u,S);if(!s||null==r||w.compiled){if(i.bindVAO(this._vao),i.useProgram(w),_){const e=y.getMosaicItemPosition(p,!0);if(null!=e){const{tl:t,br:n,page:r}=e;v=n[0]-t[0],x=n[1]-t[1];const s=y.getPageSize(r);null!=s&&(y.bind(i,l.Cj.LINEAR,r,m.$U),w.setUniform4f("u_tlbr",t[0],t[1],n[0],n[1]),w.setUniform2fv("u_mosaicSize",s),w.setUniform1i("u_texture",m.$U))}w.setUniform1f("u_opacity",d)}else{const e=h[3]*d;this._color[0]=e*h[0],this._color[1]=e*h[1],this._color[2]=e*h[2],this._color[3]=e,w.setUniform4fv("u_color",this._color)}w.setUniform1f("u_depth",a.z||0);for(const e of t){if(w.setUniform1f("u_coord_range",e.rangeX),w.setUniformMatrix3fv("u_dvsMat3",e.transforms.displayViewScreenMat3),_){const t=Math.max(2**(Math.round(o)-e.key.level),1),i=b*e.width*t,n=i/(0,f.yR)(v),r=i/(0,f.yR)(x);this._patternMatrix[0]=n,this._patternMatrix[4]=r,w.setUniformMatrix3fv("u_pattern_matrix",this._patternMatrix)}i.setStencilFunction(l.MT.EQUAL,0,255),i.drawArrays(l.WR.TRIANGLE_STRIP,0,4)}}else r()}_loadWGLResources(e){if(this._vao)return;const{context:t,styleLayer:i}=e,n=i.backgroundMaterial,r=new Int8Array([0,0,1,0,0,1,1,1]),s=_.g.createVertex(t,l._U.STATIC_DRAW,r),o=new g.Z(t,n.getAttributeLocations(),n.getLayoutInfo(),new Map([["geometry",s]]));this._vao=o}}var v=i(5367);class x extends o.A{constructor(){super(...arguments),this._programOptions={id:!1}}dispose(){}drawMany(e,t){const{context:i,displayLevel:n,requiredLevel:r,state:s,painter:o,spriteMosaic:a,styleLayerUID:u,requestRender:c,allowDelayedRender:h}=e;if(!t.some((e=>e.layerData.get(u)?.circleIndexCount??!1)))return;const d=e.styleLayer,f=d.circleMaterial,p=o.vectorTilesMaterialManager,m=d.getPaintValue("circle-translate",n),_=d.getPaintValue("circle-translate-anchor",n),g=this._programOptions,y=p.getMaterialProgram(i,f,g);if(h&&null!=c&&!y.compiled)return void c();i.useProgram(y),y.setUniformMatrix3fv("u_displayMat3",_===v.Cq.VIEWPORT?s.displayMat3:s.displayViewMat3),y.setUniform2fv("u_circleTranslation",m),y.setUniform1f("u_depth",d.z),y.setUniform1f("u_antialiasingWidth",1.2);let x=-1;for(const e of t){if(!e.layerData.has(u))continue;e.key.level!==x&&(x=e.key.level,f.setDataUniforms(y,n,d,x,a));const t=e.layerData.get(u);if(!t.circleIndexCount)continue;t.prepareForRendering(i);const s=t.vao;null!=s&&(i.bindVAO(s),y.setUniformMatrix3fv("u_dvsMat3",e.transforms.displayViewScreenMat3),r!==e.key.level?i.setStencilFunction(l.MT.EQUAL,e.stencilRef,255):i.setStencilFunction(l.MT.GREATER,255,255),i.drawElements(l.WR.TRIANGLES,t.circleIndexCount,l.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*t.circleIndexStart),e.triangleCount+=t.circleIndexCount/3)}}}const b=1/65536;class S extends o.A{constructor(){super(...arguments),this._fillProgramOptions={id:!1,pattern:!1},this._outlineProgramOptions={id:!1}}dispose(){}drawMany(e,t){const{displayLevel:i,renderPass:n,spriteMosaic:r,styleLayerUID:s}=e;let o=!1;for(const e of t)if(e.layerData.has(s)){const t=e.layerData.get(s);if(t.fillIndexCount>0||t.outlineIndexCount>0){o=!0;break}}if(!o)return;const a=e.styleLayer,l=a.getPaintProperty("fill-pattern"),u=void 0!==l,c=u&&l.isDataDriven;let h;if(u&&!c){const e=l.getValue(i);h=r.getMosaicItemPosition(e,!0)}const d=!u&&a.getPaintValue("fill-antialias",i);let f=!0,p=1;if(!u){const e=a.getPaintProperty("fill-color"),t=a.getPaintProperty("fill-opacity");if(!e?.isDataDriven&&!t?.isDataDriven){const e=a.getPaintValue("fill-color",i);p=a.getPaintValue("fill-opacity",i)*e[3],p>=1&&(f=!1)}}if(f&&"opaque"===n)return;const m=a.getPaintValue("fill-translate",i),_=a.getPaintValue("fill-translate-anchor",i);(f||"translucent"!==n)&&this._drawFill(e,s,a,t,m,_,u,h,c);const g=!a.hasDataDrivenOutlineColor&&a.outlineUsesFillColor&&p<1;d&&"opaque"!==n&&!g&&this._drawOutline(e,s,a,t,m,_)}_drawFill(e,t,i,n,r,s,o,a,u){if(o&&!u&&null==a)return;const{context:c,displayLevel:h,state:d,painter:f,pixelRatio:p,spriteMosaic:_,requestRender:g,allowDelayedRender:y}=e,x=i.fillMaterial,S=f.vectorTilesMaterialManager,w=p>m.C_?2:1,T=this._fillProgramOptions;T.pattern=o;const P=S.getMaterialProgram(c,x,T);if(y&&null!=g&&!P.compiled)return void g();if(c.useProgram(P),null!=a){const{page:e}=a,t=_.getPageSize(e);null!=t&&(_.bind(c,l.Cj.LINEAR,e,m.$U),P.setUniform2fv("u_mosaicSize",t),P.setUniform1i("u_texture",m.$U))}P.setUniformMatrix3fv("u_displayMat3",s===v.Cq.VIEWPORT?d.displayMat3:d.displayViewMat3),P.setUniform2fv("u_fillTranslation",r),P.setUniform1f("u_depth",i.z+b);let I=-1;for(const e of n){if(!e.layerData.has(t))continue;e.key.level!==I&&(I=e.key.level,x.setDataUniforms(P,h,i,I,_));const n=e.layerData.get(t);if(!n.fillIndexCount)continue;n.prepareForRendering(c);const r=n.fillVAO;if(null!=r){if(c.bindVAO(r),P.setUniformMatrix3fv("u_dvsMat3",e.transforms.displayViewScreenMat3),c.setStencilFunction(l.MT.EQUAL,e.stencilRef,255),o){const t=Math.max(2**(Math.round(h)-e.key.level),1),i=e.rangeX/(w*e.width*t);P.setUniform1f("u_patternFactor",i)}if(u){const e=n.patternMap;if(!e)continue;for(const[t,i]of e){const e=_.getPageSize(t);null!=e&&(_.bind(c,l.Cj.LINEAR,t,m.$U),P.setUniform2fv("u_mosaicSize",e),P.setUniform1i("u_texture",m.$U),c.drawElements(l.WR.TRIANGLES,i[1],l.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*i[0]))}}else c.drawElements(l.WR.TRIANGLES,n.fillIndexCount,l.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*n.fillIndexStart);e.triangleCount+=n.fillIndexCount/3}}}_drawOutline(e,t,i,n,r,s){const{context:o,displayLevel:a,state:u,painter:c,pixelRatio:h,spriteMosaic:d,requestRender:f,allowDelayedRender:p}=e,m=i.outlineMaterial,_=c.vectorTilesMaterialManager,g=.75/h,y=this._outlineProgramOptions,x=_.getMaterialProgram(o,m,y);if(p&&null!=f&&!x.compiled)return void f();o.useProgram(x),x.setUniformMatrix3fv("u_displayMat3",s===v.Cq.VIEWPORT?u.displayMat3:u.displayViewMat3),x.setUniform2fv("u_fillTranslation",r),x.setUniform1f("u_depth",i.z+b),x.setUniform1f("u_outline_width",g);let S=-1;for(const e of n){if(!e.layerData.has(t))continue;e.key.level!==S&&(S=e.key.level,m.setDataUniforms(x,a,i,S,d));const n=e.layerData.get(t);if(n.prepareForRendering(o),!n.outlineIndexCount)continue;const r=n.outlineVAO;null!=r&&(o.bindVAO(r),x.setUniformMatrix3fv("u_dvsMat3",e.transforms.displayViewScreenMat3),o.setStencilFunction(l.MT.EQUAL,e.stencilRef,255),o.drawElements(l.WR.TRIANGLES,n.outlineIndexCount,l.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*n.outlineIndexStart),e.triangleCount+=n.outlineIndexCount/3)}}}class w extends o.A{constructor(){super(...arguments),this._programOptions={id:!1,pattern:!1,sdf:!1}}dispose(){}drawMany(e,t){const{context:i,displayLevel:n,state:r,painter:s,pixelRatio:o,spriteMosaic:a,styleLayerUID:u,requestRender:c,allowDelayedRender:h}=e;if(!t.some((e=>e.layerData.get(u)?.lineIndexCount??!1)))return;const d=e.styleLayer,f=d.lineMaterial,p=s.vectorTilesMaterialManager,_=d.getPaintValue("line-translate",n),g=d.getPaintValue("line-translate-anchor",n),y=d.getPaintProperty("line-pattern"),x=void 0!==y,b=x&&y.isDataDriven;let S,w;if(x&&!b){const e=y.getValue(n);S=a.getMosaicItemPosition(e)}let T=!1;if(!x){const e=d.getPaintProperty("line-dasharray");if(w=void 0!==e,T=w&&e.isDataDriven,w&&!T){const t=e.getValue(n),i=d.getDashKey(t,d.getLayoutValue("line-cap",n));S=a.getMosaicItemPosition(i)}}const P=1/o,I=this._programOptions;I.pattern=x,I.sdf=w;const M=p.getMaterialProgram(i,f,I);if(h&&null!=c&&!M.compiled)return void c();if(i.useProgram(M),M.setUniformMatrix3fv("u_displayViewMat3",r.displayViewMat3),M.setUniformMatrix3fv("u_displayMat3",g===v.Cq.VIEWPORT?r.displayMat3:r.displayViewMat3),M.setUniform2fv("u_lineTranslation",_),M.setUniform1f("u_depth",d.z),M.setUniform1f("u_antialiasing",P),S&&null!=S){const{page:e}=S,t=a.getPageSize(e);null!=t&&(a.bind(i,l.Cj.LINEAR,e,m.$U),M.setUniform2fv("u_mosaicSize",t),M.setUniform1i("u_texture",m.$U))}let A=-1;for(const e of t){if(!e.layerData.has(u))continue;e.key.level!==A&&(A=e.key.level,f.setDataUniforms(M,n,d,A,a));const t=2**(n-A)/o;M.setUniform1f("u_zoomFactor",t);const r=e.layerData.get(u);if(!r.lineIndexCount)continue;r.prepareForRendering(i);const s=r.vao;if(null!=s){if(i.bindVAO(s),M.setUniformMatrix3fv("u_dvsMat3",e.transforms.displayViewScreenMat3),i.setStencilFunction(l.MT.EQUAL,e.stencilRef,255),b||T){const e=r.patternMap;if(!e)continue;for(const[t,n]of e){const e=a.getPageSize(t);null!=e&&(a.bind(i,l.Cj.LINEAR,t,m.$U),M.setUniform2fv("u_mosaicSize",e),M.setUniform1i("u_texture",m.$U),i.drawElements(l.WR.TRIANGLES,n[1],l.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*n[0]))}}else i.drawElements(l.WR.TRIANGLES,r.lineIndexCount,l.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*r.lineIndexStart);e.triangleCount+=r.lineIndexCount/3}}}}var T=i(14583),P=i(92422),I=i(36753);const M=1/65536;class A extends o.A{constructor(){super(...arguments),this._iconProgramOptions={id:!1,sdf:!1},this._sdfProgramOptions={id:!1},this._spritesTextureSize=(0,T.vt)()}dispose(){}drawMany(e,t){const i=e.styleLayer;this._drawIcons(e,i,t),this._drawText(e,i,t)}_drawIcons(e,t,i){const{context:n,displayLevel:r,painter:s,spriteMosaic:o,state:a,styleLayerUID:l,requestRender:u,allowDelayedRender:c}=e,h=t.iconMaterial,d=s.vectorTilesMaterialManager;let f,p=!1;for(const e of i)if(e.layerData.has(l)&&(f=e.layerData.get(l),f.iconPerPageElementsMap.size>0)){p=!0;break}if(!p)return;const _=t.getPaintValue("icon-translate",r),g=t.getPaintValue("icon-translate-anchor",r);let y=t.getLayoutValue("icon-rotation-alignment",r);y===v.I5.AUTO&&(y=t.getLayoutValue("symbol-placement",r)===v.kt.POINT?v.I5.VIEWPORT:v.I5.MAP);const x=y===v.I5.MAP,b=t.getLayoutValue("icon-keep-upright",r)&&x,S=f.isIconSDF,w=this._iconProgramOptions;w.sdf=S;const T=d.getMaterialProgram(n,h,w);if(c&&null!=u&&!T.compiled)return void u();n.useProgram(T),T.setUniformMatrix3fv("u_displayViewMat3",y===v.I5.MAP?a.displayViewMat3:a.displayMat3),T.setUniformMatrix3fv("u_displayMat3",g===v.Cq.VIEWPORT?a.displayMat3:a.displayViewMat3),T.setUniform2fv("u_iconTranslation",_),T.setUniform1f("u_depth",t.z),T.setUniform1f("u_mapRotation",(0,I.wV)(a.rotation)),T.setUniform1f("u_keepUpright",b?1:0),T.setUniform1f("u_level",10*r),T.setUniform1i("u_texture",m.$U),T.setUniform1f("u_fadeDuration",P.zk/1e3);let M=-1;for(const s of i){if(!s.layerData.has(l))continue;if(s.key.level!==M&&(M=s.key.level,h.setDataUniforms(T,r,t,M,o)),f=s.layerData.get(l),0===f.iconPerPageElementsMap.size)continue;f.prepareForRendering(n),f.updateOpacityInfo();const i=f.iconVAO;if(null!=i){n.bindVAO(i),T.setUniformMatrix3fv("u_dvsMat3",s.transforms.displayViewScreenMat3),T.setUniform1f("u_time",(performance.now()-f.lastOpacityUpdate)/1e3);for(const[t,i]of f.iconPerPageElementsMap)this._renderIconRange(e,T,i,t,s)}}}_renderIconRange(e,t,i,n,r){const{context:s,spriteMosaic:o}=e;this._spritesTextureSize[0]=o.getWidth(n)/4,this._spritesTextureSize[1]=o.getHeight(n)/4,t.setUniform2fv("u_mosaicSize",this._spritesTextureSize),o.bind(s,l.Cj.LINEAR,n,m.$U),this._setStencilState(e,r),s.drawElements(l.WR.TRIANGLES,i[1],l.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*i[0]),r.triangleCount+=i[1]/3}_drawText(e,t,i){const{context:n,displayLevel:r,glyphMosaic:s,painter:o,pixelRatio:a,spriteMosaic:l,state:u,styleLayerUID:c,requestRender:h,allowDelayedRender:d}=e,f=t.textMaterial,p=o.vectorTilesMaterialManager;let _,g=!1;for(const e of i)if(e.layerData.has(c)&&(_=e.layerData.get(c),_.glyphPerPageElementsMap.size>0)){g=!0;break}if(!g)return;const y=t.getPaintProperty("text-opacity");if(y&&!y.isDataDriven&&0===y.getValue(r))return;const x=t.getPaintProperty("text-color"),b=!x||x.isDataDriven||x.getValue(r)[3]>0,S=t.getPaintProperty("text-halo-width"),w=t.getPaintProperty("text-halo-color"),A=(!S||S.isDataDriven||S.getValue(r)>0)&&(!w||w.isDataDriven||w.getValue(r)[3]>0);if(!b&&!A)return;let C=t.getLayoutValue("text-rotation-alignment",r);C===v.I5.AUTO&&(C=t.getLayoutValue("symbol-placement",r)===v.kt.POINT?v.I5.VIEWPORT:v.I5.MAP);const E=C===v.I5.MAP,R=t.getLayoutValue("text-keep-upright",r)&&E,O=.8*3/a;this._glyphTextureSize||(this._glyphTextureSize=(0,T.fA)(s.width/4,s.height/4));const z=t.getPaintValue("text-translate",r),F=t.getPaintValue("text-translate-anchor",r),V=this._sdfProgramOptions,L=p.getMaterialProgram(n,f,V);if(d&&null!=h&&!L.compiled)return void h();n.useProgram(L),L.setUniformMatrix3fv("u_displayViewMat3",C===v.I5.MAP?u.displayViewMat3:u.displayMat3),L.setUniformMatrix3fv("u_displayMat3",F===v.Cq.VIEWPORT?u.displayMat3:u.displayViewMat3),L.setUniform2fv("u_textTranslation",z),L.setUniform1f("u_depth",t.z+M),L.setUniform2fv("u_mosaicSize",this._glyphTextureSize),L.setUniform1f("u_mapRotation",(0,I.wV)(u.rotation)),L.setUniform1f("u_keepUpright",R?1:0),L.setUniform1f("u_level",10*r),L.setUniform1i("u_texture",m.mg),L.setUniform1f("u_antialiasingWidth",O),L.setUniform1f("u_fadeDuration",P.zk/1e3);let D=-1;for(const o of i){if(!o.layerData.has(c))continue;if(o.key.level!==D&&(D=o.key.level,f.setDataUniforms(L,r,t,D,l)),_=o.layerData.get(c),0===_.glyphPerPageElementsMap.size)continue;_.prepareForRendering(n),_.updateOpacityInfo();const i=_.textVAO;if(null==i)continue;n.bindVAO(i),L.setUniformMatrix3fv("u_dvsMat3",o.transforms.displayViewScreenMat3),this._setStencilState(e,o);const a=(performance.now()-_.lastOpacityUpdate)/1e3;L.setUniform1f("u_time",a),_.glyphPerPageElementsMap.forEach(((e,t)=>{this._renderGlyphRange(n,e,t,s,L,A,b,o)}))}}_renderGlyphRange(e,t,i,n,r,s,o,a){n.bind(e,l.Cj.LINEAR,i,m.mg),s&&(r.setUniform1f("u_halo",1),e.drawElements(l.WR.TRIANGLES,t[1],l.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*t[0]),a.triangleCount+=t[1]/3),o&&(r.setUniform1f("u_halo",0),e.drawElements(l.WR.TRIANGLES,t[1],l.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*t[0]),a.triangleCount+=t[1]/3)}_setStencilState(e,t){const{context:i,is3D:n,stencilSymbols:r}=e;if(i.setStencilTestEnabled(!0),r)return i.setStencilWriteMask(255),void i.setStencilFunction(l.MT.ALWAYS,t.stencilRef,255);i.setStencilWriteMask(0),n?i.setStencilFunction(l.MT.EQUAL,t.stencilRef,255):i.setStencilFunction(l.MT.GREATER,255,255)}}const C={clip:c,stencil:h.A,bitmap:n.A,tileDebugInfo:d.A,vtlBackground:y,vtlFill:S,vtlLine:w,vtlCircle:x,vtlSymbol:A}},16043:function(e,t,i){function n(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function r(){const e=n("svg");return e.setAttribute("style","position: absolute;"),e.setAttribute("width","0"),e.setAttribute("height","0"),e.setAttribute("aria-hidden","true"),e.setAttribute("role","presentation"),document.body.appendChild(e),e}function s(e){return null!=e&&document.body.removeChild(e),null}i.d(t,{FJ:function(){return n},p:function(){return r},pK:function(){return s}})},86668:function(e,t,i){i.d(t,{A:function(){return u}});var n=i(53804),r=i(83525),s=i(58941),o=i(60539),a=i(23502),l=(i(40633),i(13798),i(65953));let u=class extends r.A{constructor(e){super(e),this.computedOpacity=1,this.computedVisible=!0,this.opacity=1,this.visible=!0,this._fadeOutResolver=null,this._fadeInResolver=null}get transitioning(){return(this._fadeOutResolver||!this.visible?0:this.opacity)!==this.computedOpacity}endTransition(){this._fadeInResolver?.(),this._fadeOutResolver?.(),this._fadeInResolver=this._fadeOutResolver=null,this.computedOpacity=this.visible?this.opacity:0}fadeIn(){return this._fadeInResolver||(this.opacity=1,this.computedOpacity=0,this._fadeOutResolver?.(),this._fadeOutResolver=null,this._fadeInResolver=(0,o.Tw)()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this.opacity=0,this._fadeInResolver?.(),this._fadeInResolver=null,this._fadeOutResolver=(0,o.Tw)()),this._fadeOutResolver.promise}transitionStep(e,t){const i=(0,s.A)("mapview-transitions-duration"),n=i?1/i:0;if(0===n)this.computedOpacity=this.opacity,this.computedVisible=this.visible;else{const t=this._fadeOutResolver||!this.visible?0:this.opacity,i=this.computedOpacity;if(i===t)this.computedVisible=this.visible;else{const r=e*n;this.computedOpacity=i>t?Math.max(t,i-r):Math.min(t,i+r),this.computedVisible=this.computedOpacity>0}}this.transitioning||(this._fadeInResolver?.(),this._fadeOutResolver?.(),this._fadeOutResolver=this._fadeInResolver=null)}};(0,n._)([(0,a.MZ)()],u.prototype,"computedOpacity",void 0),(0,n._)([(0,a.MZ)()],u.prototype,"computedVisible",void 0),(0,n._)([(0,a.MZ)()],u.prototype,"opacity",void 0),(0,n._)([(0,a.MZ)()],u.prototype,"visible",void 0),(0,n._)([(0,a.MZ)()],u.prototype,"transitioning",null),(0,n._)([(0,a.MZ)()],u.prototype,"_fadeOutResolver",void 0),(0,n._)([(0,a.MZ)()],u.prototype,"_fadeInResolver",void 0),u=(0,n._)([(0,l.$)("esri.views.2d.engine.transitions.FadeTransition")],u)},92422:function(e,t,i){i.d(t,{IT:function(){return n},av:function(){return s},o2:function(){return r},zk:function(){return o}});const n=!0,r=32,s=1.5,o=200},58013:function(e,t,i){i.d(t,{u:function(){return f}});var n=i(67348),r=i(10793),s=i(44705),o=i(25090),a=i(20551),l=i(43274),u=i(39686),c=i(54631);const h=(0,o.vt)(),d=(0,l.vt)();class f extends c.Y{constructor(e,t,i,n){super(e,t,i,n,u.CQ,u.CQ)}destroy(){super.destroy()}setTransform(e){const t=this.resolution/e.resolution,i=this.transforms.tileMat3,[o,a]=e.toScreenNoRotation([0,0],[this.x,this.y]),l=this.width/this.rangeX*t,u=this.height/this.rangeY*t;(0,s.hZ)(i,l,0,0,0,u,0,o,a,1),(0,s.lw)(this.transforms.displayViewScreenMat3,e.displayViewMat3,i);const c=(0,n.hZ)((0,r.vt)(),l,0,0,u,o,a);(0,n.lw)(this.transforms.labelMat2d,e.viewMat2d,c)}_createTransforms(){return{labelMat2d:(0,r.vt)(),tileMat3:(0,o.vt)(),displayViewScreenMat3:(0,o.vt)()}}containsScreenPoint(e,t,i){const n=(0,s.lw)(h,e.viewMat3,this.transforms.tileMat3),r=(0,s.B8)(h,n);if(null==r)return!0;(0,a.i)(d,...t,1);const o=(0,a.q)(d,d,r),l=i*(this.resolution/e.resolution);return o[0]>=-l&&o[0]<this.width+l&&o[1]>=-l&&o[1]<this.height+l}}},94860:function(e,t,i){i.d(t,{Pd:function(){return s},VS:function(){return a},oI:function(){return o}});var n=i(85456),r=i(3817);const s=new Map([["geometry",[new r._("a_pos",2,n.pe.BYTE,0,2)]]]),o=new Map([["geometry",[new r._("a_pos",2,n.pe.BYTE,0,4),new r._("a_tex",2,n.pe.BYTE,2,4)]]]),a=new Map([["geometry",[new r._("a_pos",2,n.pe.UNSIGNED_SHORT,0,4)]]])},46065:function(e,t,i){i.d(t,{A:function(){return s}});var n=i(88231),r=i(24964);class s{constructor(e,t){this.id=e,this.sortKey=t,this.records=[]}serialize(e){return e.push(this.id),e.writeF32(this.sortKey),(0,r.j)(e,this.records),e}static deserialize(e){const t=e.readInt32(),i=e.readF32(),o=new s(t,i);return o.records=(0,r._)(e,n.A)??[],o}}s.byteSizeHint=2*Uint32Array.BYTES_PER_ELEMENT+n.A.byteSizeHint},7459:function(e,t,i){i.d(t,{KQ:function(){return n},Q4:function(){return s},Ss:function(){return o}});const n=8388607,r=8388608,s=e=>e&n;function o(e,t){return((t?r:0)|e)>>>0}},88231:function(e,t,i){i.d(t,{A:function(){return n}});class n{constructor(e,t,i,n,r,s,o){this.instanceId=e,this.textureKey=t,this.indexStart=i,this.indexCount=n,this.vertexStart=r,this.vertexCount=s,this.overlaps=o}updateBaseOffsets(e){this.vertexStart+=e.vertexFrom,this.indexStart+=e.indexFrom}clone(){return new n(this.instanceId,this.textureKey,this.indexStart,this.indexCount,this.vertexStart,this.vertexCount,this.overlaps)}static write(e,t,i,n,r,s,o,a){e.push(t),e.push(i),e.push(n),e.push(r),e.push(s),e.push(o),e.push(a)}serialize(e){return e.push(this.instanceId),e.push(this.textureKey),e.push(this.indexStart),e.push(this.indexCount),e.push(this.vertexStart),e.push(this.vertexCount),e.push(this.overlaps),e}static deserialize(e){const t=e.readInt32(),i=e.readInt32(),r=e.readInt32(),s=e.readInt32(),o=e.readInt32(),a=e.readInt32(),l=e.readInt32();return new n(t,i,r,s,o,a,l)}}n.byteSizeHint=7*Uint32Array.BYTES_PER_ELEMENT},27657:function(e,t,i){i.d(t,{R:function(){return R}});var n=i(58941),r=i(40633),s=i(10793),o=i(58013),a=i(39686),l=i(46065),u=i(28230),c=i(83258),h=i(86847),d=i(85456);function f(e,t){return e<<16|255&t}class p{constructor(e,t,i,n,r){this.instance=e,this.materialKey=t,this.target=i,this.start=n,this.count=r}get textureKey(){return 255&this.materialKey}get indexEnd(){return this.start+this.count}extend(e){this.count+=e}render(e){this.instance.techniqueRef.render(e,this)}getStencilReference(){return this.target.stencilRef}getAttributePrecisionPackFactors(){const e=this.instance.instanceId;return this.target.getMesh(e).getAttributePrecisionPackFactors()}draw(e,t){(0,h.Eq)(e)?this.drawCompute(e.context,t):this.drawGeometry(e.context,t)}drawCompute(e,t){const i=this.instance.instanceId,n=this.target.getMesh(i).getComputeVAO(e,t),r=this.start*Uint32Array.BYTES_PER_ELEMENT/3;e.bindVAO(n),e.drawElements(d.WR.POINTS,this.count/3,d.pe.UNSIGNED_INT,r),e.bindVAO(null)}drawGeometry(e,t){const i=this.instance.instanceId,n=this.target.getMesh(i).getGeometryVAO(e,t),r=this.start*Uint32Array.BYTES_PER_ELEMENT;e.bindVAO(n),e.drawElements(d.WR.TRIANGLES,this.count,d.pe.UNSIGNED_INT,r),e.bindVAO(null)}}class m{constructor(){this._length=0,this._minOrderedLength=0,this._materialKeys=new Set}static fromDisplayEntities(e,t,i,n){const r=new m;for(const s of e.values())for(const e of s.records){const s=i.getInstance(e.instanceId),o=f(s.instanceId,e.textureKey);r.addRecord(s,o,e.indexStart,e.indexCount,e.vertexStart,e.vertexCount,t,n)}return r}get length(){return this._length}get minOrderedLength(){return this._minOrderedLength}get minUnorderedLength(){return this._materialKeys.size}render(e,t){const{drawPhase:i}=e;for(const n of this.infos()){const r=n.instance.techniqueRef;r.drawPhase&i&&(null==t||r.type===t)&&n.render(e)}}addRecord(e,t,i,n,r,s,o,a){let l=i,h=n;if(h||(l=r,h=s),!h)return;if(null==this._head){const i=new p(e,t,o,l,h);return this._head=new c.B(i),this._tail=this._head,this._length++,void this._minOrderedLength++}if(a===u.ch.STRICT_ORDER)return this._insert(e,t,o,l,h,this._tail,null);let d=null,f=this._head;const m=e.instanceId,_=e.techniqueRef.symbologyPlane;if(a===u.ch.STRICT_MARKERS_AND_TEXT&&(_===u.uC.MARKER||_===u.uC.TEXT))return this._insert(e,t,o,l,h,this._tail,null);for(;f;){const i=f.data.instance,n=i.instanceId,r=i.techniqueRef.symbologyPlane,s=d?.data.instance.instanceId;if(_<r||m===s&&m!==n)return this._insert(e,t,o,l,h,d,f);d=f,f=f.next}this._insert(e,t,o,l,h,d,null)}*infos(){if(null!=this._head)for(const e of this._head.values())yield e}_insert(e,t,i,n,r,s,o){if(null==s&&null==o){const s=new p(e,t,i,n,r);return this._head=new c.B(s),this._tail=this._head,this._length++,void this._minOrderedLength++}return t!==this._tail.data.materialKey&&this._minOrderedLength++,this._materialKeys.add(t),null==s&&null!=o?this._insertAtHead(e,t,i,n,r,o):null!=s&&null==o?this._insertAtEnd(e,t,i,n,r,s):null!=s&&null!=o?this._insertAtMiddle(e,t,i,n,r,s,o):void 0}_insertAtHead(e,t,i,n,r,s){const o=n+r;if(t===s.data.materialKey&&i===s.data.target&&o===s.data.start)s.data.start=n,s.data.count+=r;else{const o=new p(e,t,i,n,r);this._head=new c.B(o),this._head.next=s,this._length++}}_insertAtEnd(e,t,i,n,r,s){if(s.data.materialKey===t&&s.data.indexEnd===n)s.data.count+=r;else{const o=new p(e,t,i,n,r);this._tail=new c.B(o),s.next=this._tail,this._length++}}_insertAtMiddle(e,t,i,n,r,s,o){const a=n+r;if(s.data.materialKey===t&&s.data.target===i&&s.data.indexEnd===n)s.data.count+=r,s.data.materialKey===o.data.materialKey&&s.data.target===o.data.target&&s.data.indexEnd===o.data.start&&(s.data.count+=o.data.count,s.next=o.next,this._length--);else if(t===o.data.materialKey&&i===o.data.target&&a===o.data.start)o.data.start=n,o.data.count+=r;else{const a=new p(e,t,i,n,r),l=new c.B(a);s.next=l,l.next=o,this._length++}}}class _{constructor(e){this._indexOnly=e,this.vertex={count:0,operations:[]},this.index={count:0,operations:[]}}copyRecord(e){let t=0;this._indexOnly||(t=this.vertex.count-e.vertexStart,this.vertex.operations.push({srcFrom:e.vertexStart,dstFrom:this.vertex.count,count:e.vertexCount,mutate:0}),e.vertexStart=this.vertex.count,this.vertex.count+=e.vertexCount);let i=!1;if(this._indexOnly&&this.index.operations.length>=1){const t=this.index.operations[this.index.operations.length-1];t.srcFrom+t.count===e.indexStart&&(t.count+=e.indexCount,i=!0)}i||this.index.operations.push({srcFrom:e.indexStart,dstFrom:this.index.count,count:e.indexCount,mutate:t}),e.indexStart=this.index.count,this.index.count+=e.indexCount}}var g=i(57650),y=i(95929),v=i(85475),x=i(28055),b=i(86305);class S{constructor(e,t,i,n){this._pool=n;const r=x.W.create(t*i*Uint32Array.BYTES_PER_ELEMENT,this._pool);this.size=t,this.strideInt=i,this.bufferType=e,this.dirty={start:1/0,end:0},this.memoryStats={bytesUsed:0,bytesReserved:t*i*Uint32Array.BYTES_PER_ELEMENT},this._gpu=null,this._cpu=r,this.clear()}get elementSize(){return this._cpu.length/this.strideInt}get intSize(){return this.fillPointer*this.strideInt}get byteSize(){return this.intSize*Uint32Array.BYTES_PER_ELEMENT}get invalidated(){return this.bufferSize>0&&!this._gpu}get invalidatedComputeBuffer(){return this.bufferSize>0&&!this._gpuComputeTriangles}invalidate(){this._invalidateTriangleBuffer(),this._gpu?.dispose(),this._gpu=null}_invalidateTriangleBuffer(){this._gpuComputeTriangles?.dispose(),this._gpuComputeTriangles=null}destroy(){this._gpu?.dispose(),this._gpuComputeTriangles?.dispose(),this._cpu?.destroy()}clear(){this.dirty.start=1/0,this.dirty.end=0,this.freeList=new c.P({start:0,end:this._cpu.length/this.strideInt}),this.fillPointer=0}ensure(e){if(!(this.maxAvailableSpace()>=e)&&e*this.strideInt>this._cpu.length-this.fillPointer){this.invalidate();const t=this._cpu.length/this.strideInt,i=Math.round(1.25*(t+e)),n=i*this.strideInt;this._cpu.expand(n*Uint32Array.BYTES_PER_ELEMENT),this.freeList.free(t,i-t),this.memoryStats.bytesReserved+=(i-t)*this.strideInt*Uint32Array.BYTES_PER_ELEMENT}}set(e,t){this._cpu.array[e]!==t&&(this._cpu.array[e]=t,this.dirty.start=Math.min(e,this.dirty.start),this.dirty.end=Math.max(e+1,this.dirty.end))}getGPUBuffer(e,t=!1){if(!this.bufferSize)return null;if(t){if("index"!==this.bufferType)throw new Error("Tired to get triangle buffer, but target is not an index buffer");return null==this._gpuComputeTriangles&&(this._gpuComputeTriangles=this._createComputeBuffer(e)),this._gpuComputeTriangles}return null==this._gpu&&(this._gpu=this._createBuffer(e)),this._gpu}getView(e,t){return this._cpu.getUint32View(e,t/Uint32Array.BYTES_PER_ELEMENT)}get bufferSize(){return this._cpu.length/this.strideInt}maxAvailableSpace(){return this.freeList.maxAvailableSpace()}insert(e,t,i,n){const r=i*this.strideInt;if(!r)return 0;const s=t*this.strideInt*Uint32Array.BYTES_PER_ELEMENT,o=new Uint32Array(e,s,r),a=this.freeList.firstFit(i);(0,y.Lw)(a,"First fit region must be defined");const l=a*this.strideInt,u=r;if(this._cpu.array.set(o,l),0!==n)for(let e=0;e<o.length;e++)this._cpu.array[e+l]+=n;return this.dirty.start=Math.min(this.dirty.start,l),this.dirty.end=Math.max(this.dirty.end,l+u),this.fillPointer=Math.max(this.fillPointer,l+u),this.memoryStats.bytesUsed+=i*this.strideInt*Uint32Array.BYTES_PER_ELEMENT,a}copyFrom(e,t,i,n,r){const s=i*this.strideInt;if(!s)return 0;const o=t*this.strideInt*Uint32Array.BYTES_PER_ELEMENT,a=e._cpu.getUint32View(o,s),l=this.freeList.firstFit(i);(0,y.Lw)(l,"First fit region must be defined");const u=l*this.strideInt,c=s;if(this._cpu.array.set(a,u),0!==n)for(let e=0;e<s;e++)this._cpu.array[u+e*this.strideInt+r]+=n;return this.dirty.start=Math.min(this.dirty.start,u),this.dirty.end=Math.max(this.dirty.end,u+c),this.fillPointer=Math.max(this.fillPointer,u+c),this.memoryStats.bytesUsed+=i*this.strideInt*Uint32Array.BYTES_PER_ELEMENT,l}free(e,t,i){const n=e*this.strideInt,r=(e+t)*this.strideInt;if(!0===i)for(let i=e;i!==e+t;i++)this._cpu.array[i*this.strideInt]=2147450879;this.dirty.start=Math.min(this.dirty.start,n),this.dirty.end=Math.max(this.dirty.end,r),this.freeList.free(e,t),this.memoryStats.bytesUsed-=t*this.strideInt*Uint32Array.BYTES_PER_ELEMENT}upload(){if(this.dirty.end){if(this._invalidateTriangleBuffer(),null==this._gpu)return this.dirty.start=1/0,void(this.dirty.end=0);this._gpu.setSubData(this._cpu.array,this.dirty.start,this.dirty.start,this.dirty.end),this.dirty.start=1/0,this.dirty.end=0}}reshuffle(e,t){if(0===t.length)return;const i=this.byteSize,n=e*this.strideInt*Uint32Array.BYTES_PER_ELEMENT,r=i>n,s=this._cpu,o=x.W.create(n,this._pool);r||o.array.set(this._cpu.getUint32View(0,this.intSize));for(const e of t)if(r||e.srcFrom!==e.dstFrom||0!==e.mutate){this.dirty.start=Math.min(this.dirty.start,e.dstFrom*this.strideInt),this.dirty.end=Math.max(this.dirty.end,(e.dstFrom+e.count)*this.strideInt);for(let t=0;t<e.count;t++){const i=(e.dstFrom+t)*this.strideInt,n=(e.srcFrom+t)*this.strideInt;for(let t=0;t<this.strideInt;t++)o.array[i+t]=s.array[n+t]+e.mutate}}this._cpu.destroy(),this._cpu=o,r&&this.invalidate(),this.freeList.clear(),this.memoryStats.bytesUsed=this.memoryStats.bytesReserved=n}_createBuffer(e){const t=d._U.DYNAMIC_DRAW;return"index"===this.bufferType?b.g.createIndex(e,t,this._cpu.array):b.g.createVertex(e,t,this._cpu.array)}_createComputeBuffer(e){const t=d._U.DYNAMIC_DRAW,i=new Uint32Array(this.fillPointer/3);for(let e=0;e<this.fillPointer;e+=3)i[e/3]=this._cpu.array[e];return b.g.createIndex(e,t,i)}}var w=i(5544),T=i(81438);class P{constructor(e,t){if(this._bufferPool=e,this._layout=t,this._invalidatedGeometry=!1,this._invalidatedCompute=!1,this._position=this._layout.attributes.find((e=>"pos"===e.name||"position"===e.name)),!this._position)throw new Error("InternalError: Unable to find position attribute")}destroy(){this._indexBuffer=(0,y.pR)(this._indexBuffer),this._vertexBuffer=(0,y.pR)(this._vertexBuffer),this._computeVAO?.disposeVAOOnly(),this._geometryVAO?.disposeVAOOnly()}get layout(){return this._layout}getDrawArgs(e,t,i,n){return n?{primitive:d.WR.POINTS,count:t/3,offset:i/3}:{primitive:e,count:t,offset:i}}getAttributePrecisionPackFactors(){const e={};for(const t of this.layout.attributes)t.packPrecisionFactor&&(e[t.name]=t.packPrecisionFactor);return e}getDebugVertexInfo(e=!1,t){if(!this._vertexBuffer)return null;const i=this._layout,n=i.stride,r=this._vertexBuffer.getView(0,this._vertexBuffer.byteSize),s=[];if(e)if(null==t)console.log("must provide location info to see compute attributes");else for(const e of i.attributes){const i=t.computeAttributeMap[e.name];null!=i&&2===i.length&&(s.push({...e,name:i[0],offset:e.offset+n}),s.push({...e,name:i[1],offset:e.offset+2*n}))}const o=new DataView(r.slice().buffer);let a=r.byteLength/n;e&&(a=this._indexBuffer.fillPointer/3);const l=this._indexBuffer.getView(0,this._indexBuffer.byteSize);let u=0;const c=[];for(let t=0;t<a;t++){e&&(u=l[3*t]*n);const r={};for(const e of[...i.attributes,...s]){let t=`${e.offset} ${e.name}`,i=(0,w.q)(o,e,u);if(e.packPrecisionFactor)if(t+=` (precision: ${e.packPrecisionFactor})`,"number"==typeof i)i/=e.packPrecisionFactor;else for(let t=0;t<i.length;t++)i[t]/=e.packPrecisionFactor;r[t]=i}u+=n,c.push(r)}return{vertices:c,layout:i}}_ensure(e,t){if(this._vertexBuffer&&this._indexBuffer)this._indexBuffer.ensure(Math.max(e,1e3)),this._vertexBuffer.ensure(Math.max(t,1e3));else{const i=this._layout.stride/Uint32Array.BYTES_PER_ELEMENT;this._indexBuffer=new S("index",Math.max(e,1e3),1,this._bufferPool),this._vertexBuffer=new S("vertex",Math.max(t,1e3),i,this._bufferPool)}}append(e){const t=e.layout.stride,i=e.indices.byteLength/Uint32Array.BYTES_PER_ELEMENT,n=e.vertices.byteLength/t;this._ensure(i,n);const{vertices:r,indices:s}=e,o=this._vertexBuffer.insert(r,0,r.byteLength/t,0);return{vertexFrom:o,indexFrom:this._indexBuffer.insert(s,0,s.byteLength/4,o)}}copyRecordFrom(e,t,i,n){const{indexStart:r,indexCount:s,vertexStart:o,vertexCount:a}=t;this._ensure(s,a);const l=e._position,u=i*(l.packPrecisionFactor??1),c=n*(l.packPrecisionFactor??1),h=l.offset,d=(0,v.M9)(u,c),f=this._vertexBuffer.copyFrom(e._vertexBuffer,o,a,d,h),p=this._indexBuffer.copyFrom(e._indexBuffer,r,s,f-o,0),m=t.clone();return m.vertexStart=f,m.indexStart=p,m.overlaps=0,m}remove(e,t,i,n){this._indexBuffer.free(e,t),this._vertexBuffer.free(i,n)}upload(){this._invalidatedGeometry=!0,this._invalidatedCompute=!0}getGeometryVAO(e,t){if(!this._vertexBuffer||!this._indexBuffer||!this._vertexBuffer.bufferSize)return null;if(this._invalidatedGeometry){(this._vertexBuffer.invalidated||this._indexBuffer.invalidated)&&(this._vertexBuffer.invalidate(),this._indexBuffer.invalidate(),this._geometryVAO?.disposeVAOOnly(),this._geometryVAO=null),this._vertexBuffer.upload(),this._indexBuffer.upload();const i=this._indexBuffer.getGPUBuffer(e,!1),n=this._vertexBuffer.getGPUBuffer(e);this._geometryVAO||(this._geometryVAO=new T.Z(e,t.locations,function(e,t){const i=e.attributes.filter((e=>t.locations.has(e.name))).map((t=>({name:t.name,type:t.type,count:t.count,divisor:0,normalized:t.normalized??!1,offset:t.offset,stride:e.stride})));return new Map([["geometry",i]])}(this.layout,t),new Map([["geometry",n]]),i)),this._invalidatedGeometry=!1}return this._geometryVAO}getComputeVAO(e,t){if(!this._vertexBuffer||!this._indexBuffer||!this._vertexBuffer.bufferSize)return null;if(this._invalidatedCompute){(this._vertexBuffer.invalidated||this._indexBuffer.invalidatedComputeBuffer)&&(this._vertexBuffer.invalidate(),this._indexBuffer.invalidate(),this._computeVAO?.disposeVAOOnly(),this._computeVAO=null),this._vertexBuffer.upload(),this._indexBuffer.upload();const i=this._indexBuffer.getGPUBuffer(e,!0),n=this._vertexBuffer.getGPUBuffer(e);this._computeVAO||(this._computeVAO=new T.Z(e,t.locations,function(e,t){const i=[],n=e.attributes.filter((e=>t.locations.has(e.name)));for(const r of n){i.push({name:r.name,type:r.type,count:r.count,divisor:0,normalized:r.normalized??!1,offset:r.offset,stride:e.stride});const n=t.computeAttributeMap[r.name];null!=n&&2===n.length&&(i.push({name:n[0],count:r.count,divisor:0,type:r.type,normalized:r.normalized??!1,offset:r.offset+e.stride,stride:e.stride}),i.push({name:n[1],count:r.count,divisor:0,type:r.type,normalized:r.normalized??!1,offset:r.offset+2*e.stride,stride:e.stride}))}return new Map([["geometry",i]])}(this.layout,t),new Map([["geometry",n]]),i),this._invalidatedCompute=!1)}return this._computeVAO}get memoryStats(){return{bytesUsed:this._vertexBuffer.memoryStats.bytesUsed+this._indexBuffer.memoryStats.bytesUsed,bytesReserved:this._vertexBuffer.memoryStats.bytesReserved+this._indexBuffer.memoryStats.bytesReserved,vertex:this._vertexBuffer.memoryStats,index:this._indexBuffer.memoryStats}}reshuffle(e){this._vertexBuffer&&this._vertexBuffer.reshuffle(e.vertex.count,e.vertex.operations),this._indexBuffer&&this._indexBuffer.reshuffle(e.index.count,e.index.operations)}}class I{constructor(e){this._pos=0,this._buffer=e,this._i32View=new Int32Array(this._buffer),this._f32View=new Float32Array(this._buffer)}readInt32(){return this._i32View[this._pos++]}readF32(){return this._f32View[this._pos++]}}var M=i(24964);function A(e){return e?{entities:(0,M._)(new I(e.entities),l.A),vertexData:e.data.map(C)}:null}function C(e){const t=e.layout.stride,i=new DataView(e.vertices),n=[],r=e.vertices.byteLength/t;let s=0;for(let o=0;o<r;o++){const r={};for(const t of e.layout.attributes){let e=`${t.offset} ${t.name}`,n=(0,w.q)(i,t,s);if(t.packPrecisionFactor)if(e+=` (precision: ${t.packPrecisionFactor})`,"number"==typeof n)n/=t.packPrecisionFactor;else for(let e=0;e<n.length;e++)n[e]/=t.packPrecisionFactor;r[e]=n}s+=t,n.push(r)}return{vertices:n,layout:e.layout}}let E=0;class R extends o.u{constructor(e,t,i,n,r=!1){super(e,t,i,n),this._meshes=new Map,this._entities=[],this._invalidated=!1,this._nextUploadAllowed=!1,this.tileAge=E++,this._metrics=[],this._entityIds=new Set,this._entityIdsFromBuffer=new Set,this._attributeEpoch=0,this._encounteredEnd=!1,this._objectIdMap=null,this.visible=!0,this.transforms.labelMat2d=(0,s.vt)(),this.enableDeferredUploads=r}destroy(){super.destroy(),this.clear()}clear(){for(const e of this._meshes.values())e.destroy();this._meshes.clear(),this._entities=[],this._metrics=[],this._displayList=null,this._invalidated=!0,this._entityIds.clear(),this._nextUploadAllowed=!0}beforeRender(e){super.beforeRender(e),this._needsReshuffle&&e.reshuffleManager.schedule(this)}tryReady(e){const t=this._invalidated&&!this._uploadAllowed;return!(this.isReady||t||!this._encounteredEnd||!(e>=this._attributeEpoch)||((0,n.A)("esri-2d-update-debug")&&console.debug(`Tile[${this.key.id}] FeatureTile.ready [epoch=${e}]`),this.ready(),this.requestRender(),0))}get labelMetrics(){return this._metrics}get hasData(){return!!this._meshes.size}get hasAnimations(){return!!this._objectIdMap}get needsUpload(){return this._invalidated}get _uploadAllowed(){return!this.enableDeferredUploads||this._nextUploadAllowed}upload(){this._nextUploadAllowed=!0}getDisplayList(e,t){if(this._uploadAllowed&&this._invalidated){this._entities.sort(((e,t)=>{const i=t.sortKey,n=e.sortKey;return n===i?e.id-t.id:n-i})),t===u.ch.BATCHING&&this.reshuffle(!0),this._displayList=m.fromDisplayEntities(this._entities,this,e,t);for(const e of this._meshes.values())e.upload();this.debugInfo.display.length=this._displayList.length,this.debugInfo.display.minOrderedLength=this._displayList.minOrderedLength,this.debugInfo.display.minUnorderedLength=this._displayList.minUnorderedLength,this.requestRender(),this._invalidated=!1,this._nextUploadAllowed=!1}return this._displayList}getMesh(e){if(!this._meshes.has(e))throw new Error(`InternalError: Unable to find VAO for instance: ${e}`);return this._meshes.get(e)}getSortKeys(e){const t=new Map;for(const{id:i,sortKey:n}of this._entities)if(e.has(i)&&t.set(i,n),t.size===e.size)break;return t}onMessage(e){if(e.objectIdMap)for(const t in e.objectIdMap)this._objectIdMap||(this._objectIdMap={}),this._objectIdMap[t]=e.objectIdMap[t];switch(e.type){case"append":this._onAppendMessage(e);break;case"update":this._onUpdateMessage(e)}if(this._aggregateMemoryStats(),this.requestRender(),e.end){if((0,n.A)("esri-2d-update-debug")&&console.debug(`Tile[${this.key.id}] FeatureTile.end [epoch=${e.attributeEpoch}]`),!e.attributeEpoch)throw new Error("InternalError: Attribute epoch not defined.");this._attributeEpoch=e.attributeEpoch,this._encounteredEnd=!0}}_onAppendMessage(e){if((0,n.A)("esri-2d-update-debug")&&console.debug(`Tile[${this.key.id}] FeatureTile.append`,{append:A(e?.append)}),e.clear&&this.clear(),!e.append)return;const t=(0,M._)(new I(e.append.entities),l.A);this._insert(t,e.append.data,!1)}_onUpdateMessage(e){(0,n.A)("esri-2d-update-debug")&&console.debug(`Tile[${this.key.id}] FeatureTile.update`,{isPixelBuffer:e.isPixelBuffer,modify:A(e.modify),remove:e.remove});const t=(0,M._)(new I(e.modify.entities),l.A),i=t.map((e=>e.id)),r=e.isPixelBuffer??!1,s=[...e.remove,...i];r?this._removeByIdsFromBuffer(s):this._removeByIds(s),this._insert(t,e.modify.data,r)}reshuffle(e=!1){if(this.destroyed)return;const t=new Map;for(const i of this._entities)for(const n of i.records){const i=this._meshes.get(n.instanceId);let r=t.get(i);r||(r=new _(e),t.set(i,r)),r.copyRecord(n)}for(const[e,i]of t)e.reshuffle(i);this._invalidated=!0,this._aggregateMemoryStats(),(0,n.A)("esri-2d-update-debug")&&r.A.getLogger("esri.views.2d.engine.webgl.FeatureTile").info(`Tile ${this.key.id} was reshuffled.`)}copyPixelBufferedEntitesFrom(e,t,i,n){const r=i*a.CQ,s=n*a.CQ;for(const i of e._entities){let n=null;for(const o of i.records)if(o.overlaps&t){const t=e.getMesh(o.instanceId),a=this._ensureMesh(o.instanceId,t.layout).copyRecordFrom(t,o,r,s);n||(n=new l.A(i.id,i.sortKey),this._entityIdsFromBuffer.add(i.id),this._entities.push(n)),n.records.push(a)}}this._invalidated=!0}_ensureMesh(e,t){return this._meshes.has(e)||this._meshes.set(e,new P(this._stage.bufferPool,t)),this._meshes.get(e)}_insert(e,t,i){if(!e.length)return;this._removeDuplicatedBufferedEntites(e);const n=this._insertVertexData(t);for(const t of e){for(const e of t.records)e.updateBaseOffsets(n.get(e.instanceId));i?this._tryInsertBufferedEntity(t):this._insertEntity(t)}this._invalidated=!0}_insertVertexData(e){const t=new Map;for(const i of e){const{instanceId:e,layout:n}=i,r=this._ensureMesh(e,n).append(i);if(i.metrics){const e=(0,M._)(new I(i.metrics),g.f)??[];this._metrics.push(...e)}t.set(e,r)}return t}_insertEntity(e){(0,n.A)("esri-2d-update-debug")&&this._entityIds.has(e.id)&&console.error(`Tile ${this.key.id} insertEnitty: Already have entityId ${e.id}`),this._entityIds.add(e.id),this._entities.push(e)}_tryInsertBufferedEntity(e){this._entityIds.has(e.id)?this._removeRecordsFromMesh(e.records):(this._entityIdsFromBuffer.add(e.id),this._entities.push(e))}_removeDuplicatedBufferedEntites(e){if(!this._entityIdsFromBuffer.size)return;const t=[];for(const i of e)this._entityIdsFromBuffer.has(i.id)&&t.push(i.id);this._removeByIds(t)}_removeByIdsFromBuffer(e){this._removeByIds(e.filter((e=>this._entityIdsFromBuffer.has(e))))}_removeByIds(e){if(0===e.length)return;const t=new Set(e),i=[];for(const e of this._entities)t.has(e.id)?this._remove(e):i.push(e);this._entities=i,this._invalidated=!0}_remove(e){this._removeRecordsFromMesh(e.records),this._entityIds.delete(e.id),this._entityIdsFromBuffer.delete(e.id);for(let t=this._metrics.length-1;t>=0;t--)this._metrics[t].entityTexel===e.id&&this._metrics.splice(t,1)}_removeRecordsFromMesh(e){for(const t of e){const{instanceId:e,indexStart:i,indexCount:n,vertexStart:r,vertexCount:s}=t;this._meshes.get(e)?.remove(i,n,r,s)}}_aggregateMemoryStats(){this.debugInfo.memory.bytesUsed=0,this.debugInfo.memory.bytesReserved=0;for(const e of this._meshes.values())this.debugInfo.memory.bytesUsed+=e.memoryStats.bytesUsed,this.debugInfo.memory.bytesReserved+=e.memoryStats.bytesReserved}get _needsReshuffle(){if(this.destroyed)return!1;const{bytesUsed:e,bytesReserved:t}=this.debugInfo.memory,i=e/t,{minOrderedLength:n,length:r}=this.debugInfo.display;return t>a._x&&i<a.eI||r>a.Xh&&n/r<a.Vl}get entityIds(){return this._objectIdMap?this._entities.map((({id:e})=>({objectId:this._objectIdMap[e],displayId:e}))):[]}}},36753:function(e,t,i){i.d(t,{p6:function(){return o},wV:function(){return s}}),Math.PI;const n=256/360,r=1/Math.LN2;function s(e){return function(e,t){return(e%=t)>=0?e:e+t}(e*n,256)}function o(e){return Math.log(e)*r}},28055:function(e,t,i){i.d(t,{W:function(){return a},o:function(){return u}});var n=i(58941),r=i(95929),s=i(83258);const o=(0,n.A)("esri-2d-log-allocations");class a{static create(e,t){const i=t.acquireUint32Array(e);return new a(i,t)}constructor(e,t){this._array=e,this._pool=t}get array(){return this._array}get length(){return this._array.length}getUint32View(e,t){return new Uint32Array(this._array.buffer,e+this._array.byteOffset,t)}expand(e){if(e<=this._array.byteLength)return;const t=this._pool.acquireUint32Array(e);t.set(this._array),this._pool.releaseUint32Array(this._array),this._array=t}destroy(){this._pool.releaseUint32Array(this._array)}}class l{constructor(){this._data=new ArrayBuffer(l.BYTE_LENGTH),this._freeList=new s.P({start:0,end:this._data.byteLength})}static get BYTE_LENGTH(){return 16e6}get buffer(){return this._data}acquireUint32Array(e){const t=this._freeList.firstFit(e);return null==t?null:new Uint32Array(this._data,t,e/Uint32Array.BYTES_PER_ELEMENT)}releaseUint32Array(e){this._freeList.free(e.byteOffset,e.byteLength)}}class u{constructor(){this._pages=[],this._pagesByBuffer=new Map,this._bytesAllocated=0}destroy(){this._pages=[],this._pagesByBuffer=null}get _bytesTotal(){return this._pages.length*l.BYTE_LENGTH}acquireUint32Array(e){if(this._bytesAllocated+=e,o&&console.log(`Allocating ${e}, (${this._bytesAllocated} / ${this._bytesTotal})`),e>=l.BYTE_LENGTH)return new Uint32Array(e/Uint32Array.BYTES_PER_ELEMENT);for(const t of this._pages){const i=t.acquireUint32Array(e);if(null!=i)return i}const t=this._addPage().acquireUint32Array(e);return(0,r.Lw)(t,"Expected to allocate page"),t}releaseUint32Array(e){this._bytesAllocated-=e.byteLength,o&&console.log(`Freeing ${e.byteLength}, (${this._bytesAllocated} / ${this._bytesTotal})`);const t=this._pagesByBuffer.get(e.buffer);t&&t.releaseUint32Array(e)}_addPage(){const e=new l;return this._pages.push(e),this._pagesByBuffer.set(e.buffer,e),e}}},54904:function(e,t,i){i.d(t,{A:function(){return n}});class n{constructor(e=0,t=0,i=0,n=0){this.x=e,this.y=t,this.width=i,this.height=n}get isEmpty(){return this.width<=0||this.height<=0}union(e){this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.width=Math.max(this.width,e.width),this.height=Math.max(this.height,e.height)}}},82087:function(e,t,i){i.d(t,{A:function(){return u}});var n=i(58941),r=i(28230),s=i(57672),o=i(829),a=i(55382);const l=(e,t)=>e.key.level-t.key.level!=0?e.key.level-t.key.level:e.key.row-t.key.row!=0?e.key.row-t.key.row:e.key.col-t.key.col;class u extends s.A{constructor(e){super(),this.tileInfoView=e,this.sortFunction=l}renderChildren(e){this.setStencilReference(e),super.renderChildren(e)}createRenderParams(e){const{state:t}=e,i=super.createRenderParams(e);return i.requiredLevel=this.tileInfoView.getClosestInfoForScale(t.scale).level,i.displayLevel=this.tileInfoView.tileInfo.scaleToZoom(t.scale),i}prepareRenderPasses(e){const t=super.prepareRenderPasses(e);return t.push(e.registerRenderPass({name:"stencil",brushes:[o.A],drawPhase:r.S5.DEBUG|r.S5.MAP|r.S5.HIGHLIGHT|r.S5.LABEL,target:()=>this.getStencilTarget()})),(0,n.A)("esri-tiles-debug")&&t.push(e.registerRenderPass({name:"tileInfo",brushes:[a.A],drawPhase:r.S5.DEBUG,target:()=>this.children})),t}getStencilTarget(){return this.children}setStencilReference(e){let t=1;for(const e of this.children)e.stencilRef=t++}}},54631:function(e,t,i){i.d(t,{Y:function(){return o}});var n=i(44705),r=i(77515),s=i(36008);class o extends r.q{constructor(e,t,i,n,r,o,a=r,l=o){super(),this.tileDebugInfoTexture=null,this.debugInfo={display:{length:0,minOrderedLength:0,minUnorderedLength:0,triangleCount:0},memory:{bytesUsed:0,bytesReserved:0}},this._destroyed=!1,this.key=new s.A(e),this.resolution=t,this.x=i,this.y=n,this.width=r,this.height=o,this.rangeX=a,this.rangeY=l}destroy(){this.tileDebugInfoTexture&&(this.tileDebugInfoTexture.dispose(),this.tileDebugInfoTexture=null),this._destroyed=!0}get debugSlot(){let e=this;for(;e.parent!==this._stage;){if(!e.parent)return 0;e=e.parent}return this._stage.children.indexOf(e)}setTransform(e){const t=this.resolution/(e.resolution*e.pixelRatio),i=this.transforms.tileMat3,[r,s]=e.toScreenNoRotation([0,0],[this.x,this.y]),o=this.width/this.rangeX*t,a=this.height/this.rangeY*t;(0,n.hZ)(i,o,0,0,0,a,0,r,s,1),(0,n.lw)(this.transforms.displayViewScreenMat3,e.displayViewMat3,i)}get destroyed(){return this._destroyed}}},88413:function(e,t,i){i.d(t,{AV:function(){return h},ES:function(){return _},IF:function(){return x},Qz:function(){return d},UE:function(){return g},bX:function(){return y},sZ:function(){return v}});var n=i(39819),r=i(40633),s=(i(33389),i(13798),i(58941),i(41835),i(85456)),o=(i(96402),i(69452),i(48347)),a=i(12285),l=i(10956),u=i(3817);const c=()=>r.A.getLogger("esri.views.2d.engine.webgl.Utils");function h(e){switch(e){case s.ld.UNSIGNED_BYTE:return 1;case s.ld.UNSIGNED_SHORT_4_4_4_4:return 2;case s.ld.FLOAT:return 4;default:return void c().error(new n.A("webgl-utils",`Unable to handle type ${e}`))}}function d(e){switch(e){case s.ld.UNSIGNED_BYTE:return Uint8Array;case s.ld.UNSIGNED_SHORT_4_4_4_4:return Uint16Array;case s.ld.FLOAT:return Float32Array;default:return void c().error(new n.A("webgl-utils",`Unable to handle type ${e}`))}}const f=e=>{const t=new Map;for(const i in e)for(const n of e[i])t.set(n.name,n.location);return t},p=e=>{const t={};return e.forEach(((e,i)=>t[i]=e?.length?e[0].stride:0)),t},m=new Map,_=(e,t)=>{if(!m.has(e)){const i=function(e){const t=new Map;for(const i in e){const n=e[i];let r=0;t.set(i,n.map((e=>{const t=new u._(e.name,e.count,e.type,r,0,e.normalized||!1);return r+=e.count*(0,o._)(e.type),t}))),t.get(i).forEach((e=>e.stride=r))}return t}(t),n={strides:p(i),bufferLayouts:i,attributes:f(t)};m.set(e,n)}return m.get(e)},g=e=>e.includes("data:image/svg+xml");function y(e){const t=[];for(let i=0;i<e.length;i++)t.push(e.charCodeAt(i));return t}function v(e,t,i){const n=new l.R(t.width,t.height);return n.dataType=t.dataType,t.depth&&(n.depth=t.depth),t.flipped&&(n.flipped=t.flipped),t.hasMipmap&&(n.hasMipmap=t.hasMipmap),n.internalFormat=t.internalFormat,t.isImmutable&&(n.isImmutable=t.isImmutable),t.isOpaque&&(n.isOpaque=t.isOpaque),t.maxAnisotropy&&(n.maxAnisotropy=t.maxAnisotropy),n.pixelFormat=t.pixelFormat,t.preMultiplyAlpha&&(n.preMultiplyAlpha=t.preMultiplyAlpha),t.samplingMode&&(n.samplingMode=t.samplingMode),t.target&&(n.target=t.target),n.uniform=t.uniform,t.unpackAlignment&&(n.unpackAlignment=t.unpackAlignment),t.wrapMode&&(n.wrapMode=t.wrapMode),new a.g(e,n,i)}function x(e){return"url"in e&&"urlHash"in e?{...e,url:""}:e}},77416:function(e,t,i){i.d(t,{A:function(){return l}});var n=i(25731),r=i(86305),s=i(85456),o=i(81438),a=i(3817);class l{constructor(e,t){this._rctx=e,this._attributes=[{name:"position",offset:0,type:s.pe.SHORT,count:2}],this.layout={hash:(0,n.hU)(this._attributes),attributes:this._attributes,stride:4},this._vertexBuffer=r.g.createVertex(e,s._U.STATIC_DRAW,new Uint16Array(t)),this._vao=new o.Z(e,new Map([["a_position",0]]),new Map([["geometry",[new a._("a_position",2,s.pe.SHORT,0,4)]]]),new Map([["geometry",this._vertexBuffer]])),this._count=t.length/2}bind(){this._rctx.bindVAO(this._vao)}unbind(){this._rctx.bindVAO(null)}dispose(){this._vao.dispose()}draw(){this._rctx.bindVAO(this._vao),this._rctx.drawArrays(s.WR.TRIANGLE_STRIP,0,this._count)}}},57672:function(e,t,i){i.d(t,{A:function(){return P}}),i(58941);var n=i(80708),r=i(7965),s=i(39819),o=i(40633),a=i(28181),l=i(25090),u=i(77515),c=i(59122),h=i(13786),d=i(1932),f=i(58081),p=i(76613),m=i(85475),_=i(86305),g=i(85456);const y=(e,t,i,n)=>{let r=0;for(let n=1;n<i;n++){const i=e[2*(t+n-1)],s=e[2*(t+n-1)+1];r+=(e[2*(t+n)]-i)*(e[2*(t+n)+1]+s)}return n?r>0:r<0},v=({coords:e,lengths:t},i)=>{const n=[];for(let r=0,s=0;r<t.length;s+=t[r],r+=1){const o=s,a=[];for(;r<t.length-1&&y(e,s+t[r],t[r+1],i);r+=1,s+=t[r])a.push(s+t[r]-o);const l=e.slice(2*o,2*(s+t[r])),u=(0,c.e)(l,a,2);for(const e of u)n.push(e+o)}return n};class x{constructor(e,t,i,n=!1){this._cache={},this.vertices=e,this.indices=t,this.primitiveType=i,this.isMapSpace=n}static fromPath(e){const t=(0,f.eU)(new p.A,e.path,!1,!1),i=t.coords,n=new Uint32Array(v(t,!0)),r=new Uint32Array(i.length/2);for(let e=0;e<r.length;e++)r[e]=(0,m.M9)(Math.floor(i[2*e]),Math.floor(i[2*e+1]));return new x({geometry:r},n,g.WR.TRIANGLES)}static fromGeometry(e,t){const i=t.geometry?.type;switch(i){case"polygon":return x.fromPolygon(e,t.geometry);case"extent":return x.fromMapExtent(e,t.geometry);default:return o.A.getLogger("esri.views.2d.engine.webgl.Mesh2D").error(new s.A("mapview-bad-type",`Unable to create a mesh from type ${i}`,t)),x.fromScreenExtent({xmin:0,ymin:0,xmax:1,ymax:1})}}static fromPolygon(e,t){const i=(0,f.Ye)(new p.A,t,!1,!1),n=i.coords,r=new Uint32Array(v(i,!1)),s=new Uint32Array(n.length/2),o=(0,d.vt)(),a=(0,d.vt)();for(let t=0;t<s.length;t++)(0,h.hZ)(o,n[2*t],n[2*t+1]),e.toScreen(a,o),s[t]=(0,m.M9)(Math.floor(a[0]),Math.floor(a[1]));return new x({geometry:s},r,g.WR.TRIANGLES,!0)}static fromScreenExtent({xmin:e,xmax:t,ymin:i,ymax:n}){const r={geometry:new Uint32Array([(0,m.M9)(e,i),(0,m.M9)(t,i),(0,m.M9)(e,n),(0,m.M9)(e,n),(0,m.M9)(t,i),(0,m.M9)(t,n)])},s=new Uint32Array([0,1,2,3,4,5]);return new x(r,s,g.WR.TRIANGLES)}static fromMapExtent(e,t){const[i,n]=e.toScreen([0,0],[t.xmin,t.ymin]),[r,s]=e.toScreen([0,0],[t.xmax,t.ymax]),o={geometry:new Uint32Array([(0,m.M9)(i,n),(0,m.M9)(r,n),(0,m.M9)(i,s),(0,m.M9)(i,s),(0,m.M9)(r,n),(0,m.M9)(r,s)])},a=new Uint32Array([0,1,2,3,4,5]);return new x(o,a,g.WR.TRIANGLES)}destroy(){null!=this._cache.indexBuffer&&this._cache.indexBuffer.dispose(),this._cache.vertexBuffers?.forEach((e=>e?.dispose())),this._cache.indexBuffer=this._cache.vertexBuffers=null}get elementType(){return(()=>{switch(this.indices.BYTES_PER_ELEMENT){case 1:return g.pe.UNSIGNED_BYTE;case 2:return g.pe.UNSIGNED_SHORT;case 4:return g.pe.UNSIGNED_INT;default:throw new s.A("Cannot get DataType of array")}})()}getIndexBuffer(e,t=g._U.STATIC_DRAW){return this._cache.indexBuffer??=_.g.createIndex(e,t,this.indices),this._cache.indexBuffer}getVertexBuffers(e,t=g._U.STATIC_DRAW){return this._cache.vertexBuffers??=new Map(Object.keys(this.vertices).reduce(((i,n)=>(i.push([n,_.g.createVertex(e,t,this.vertices[n])]),i)),new Array)),this._cache.vertexBuffers}}var b=i(57008),S=i(81438);class w extends u.q{constructor(e,t){super(),this._clip=t,this._cache={},this.stage=e,this._handle=(0,a.watch)((()=>t.version),(()=>this._invalidate())),this.ready()}static fromClipArea(e,t){return new w(e,t)}_destroyGL(){null!=this._cache.mesh&&(this._cache.mesh.destroy(),this._cache.mesh=null),null!=this._cache.vao&&(this._cache.vao.dispose(),this._cache.vao=null)}destroy(){this._destroyGL(),this._handle.remove()}getVAO(e,t,i,n){const[r,s]=t.size;if("geometry"!==this._clip.type&&this._lastWidth===r&&this._lastHeight===s||(this._lastWidth=r,this._lastHeight=s,this._destroyGL()),null==this._cache.vao){const r=this._createMesh(t,this._clip),s=r.getIndexBuffer(e),o=r.getVertexBuffers(e);this._cache.mesh=r,this._cache.vao=new S.Z(e,i,n,o,s)}return this._cache.vao}_createTransforms(){return{displayViewScreenMat3:(0,l.vt)()}}_invalidate(){this._destroyGL(),this.requestRender()}_createMesh(e,t){switch(t.type){case"rect":return x.fromScreenExtent((0,b.p)(t,e.size[0],e.size[1]));case"path":return x.fromPath(t);case"geometry":return x.fromGeometry(e,t);default:return o.A.getLogger("esri.views.2d.engine.webgl.ClippingInfo").error(new s.A("mapview-bad-type","Unable to create ClippingInfo mesh from clip of type: ${clip.type}")),x.fromScreenExtent({xmin:0,ymin:0,xmax:1,ymax:1})}}}var T=i(28230);class P extends r.m{set clips(e){super.clips=e,this._updateClippingInfo(e)}renderChildren(e){e.painter.setPipelineState(null),null==this._renderPasses&&(this._renderPasses=this.prepareRenderPasses(e.painter));for(const t of this._renderPasses)try{t.render(e)}catch(e){}}prepareRenderPasses(e){return[e.registerRenderPass({name:"clip",brushes:[n.d.clip],target:()=>this._clippingInfos,drawPhase:T.S5.MAP|T.S5.LABEL|T.S5.LABEL_ALPHA|T.S5.DEBUG|T.S5.HIGHLIGHT})]}_updateClippingInfo(e){null!=this._clippingInfos&&(this._clippingInfos.forEach((e=>e.destroy())),this._clippingInfos=null),null!=e&&e.length&&(this._clippingInfos=e.items.map((e=>w.fromClipArea(this.stage,e)))),this.requestRender()}}},96564:function(e,t,i){i.d(t,{Dy:function(){return d},UD:function(){return u},fO:function(){return c},gy:function(){return o},iT:function(){return h},xy:function(){return l}});var n=i(40633);const r=()=>n.A.getLogger("esri.views.2d.engine.webgl.alignmentUtils");var s,o,a;function l(e){if(!e)return s.Center;switch(e){case"Left":case"left":return s.Left;case"Right":case"right":return s.Right;case"Justify":return r().warnOnce("Horizontal alignment 'justify' is not implemented. Falling back to 'center'."),s.Center;case"Center":case"center":return s.Center}}function u(e){if(!e)return o.Center;switch(e){case"Top":case"top":return o.Top;case"Center":case"middle":return o.Center;case"Baseline":case"baseline":return o.Baseline;case"Bottom":case"bottom":return o.Bottom}}function c(e){switch(e){case"above-left":case"esriServerPointLabelPlacementAboveLeft":return["right","bottom"];case"above-center":case"above-along":case"esriServerPointLabelPlacementAboveCenter":case"esriServerLinePlacementAboveAlong":return["center","bottom"];case"above-right":case"esriServerPointLabelPlacementAboveRight":return["left","bottom"];case"center-left":case"esriServerPointLabelPlacementCenterLeft":return["right","middle"];case"center-center":case"center-along":case"esriServerPointLabelPlacementCenterCenter":case"esriServerLinePlacementCenterAlong":case"always-horizontal":case"esriServerPolygonPlacementAlwaysHorizontal":return["center","middle"];case"center-right":case"esriServerPointLabelPlacementCenterRight":return["left","middle"];case"below-left":case"esriServerPointLabelPlacementBelowLeft":return["right","top"];case"below-center":case"below-along":case"esriServerPointLabelPlacementBelowCenter":case"esriServerLinePlacementBelowAlong":return["center","top"];case"below-right":case"esriServerPointLabelPlacementBelowRight":return["left","top"];default:return console.debug(`Found invalid placement type ${e}`),["center","middle"]}}function h(e){switch(e){case s.Right:case"right":return-1;case s.Center:case"center":return 0;case s.Left:case"left":return 1;default:return console.debug(`Found invalid horizontal alignment ${e}`),0}}function d(e){switch(e){case o.Top:case"top":return 1;case o.Center:case"middle":return 0;case o.Bottom:case o.Baseline:case"baseline":case"bottom":return-1;default:return console.debug(`Found invalid vertical alignment ${e}`),0}}(a=s||(s={}))[a.Left=-1]="Left",a[a.Center=0]="Center",a[a.Right=1]="Right",function(e){e[e.Top=1]="Top",e[e.Center=0]="Center",e[e.Bottom=-1]="Bottom",e[e.Baseline=2]="Baseline"}(o||(o={}))},99121:function(e,t,i){var n;i.d(t,{DW:function(){return p},GA:function(){return h},mv:function(){return n}}),function(e){e.Local="Local",e.Global="Global"}(n||(n={}));class r{generateSource(e){const t=[];for(let i=1;i<this.length;i++)t.push(`vec4 atom${i} = texture(${e.animationTexture}, (pointer + 0.5) / size);`),t.push("pointer.x += 1.0;");for(let e=0;e<this.ins;e++)t.push("top--;"),t.push(`vec4 in${this.ins-e-1} = stack[top];`);for(let e=0;e<this.outs;e++)t.push(`vec4 out${e};`);const{microcode:i}=this;for(const e of i)t.push(e);for(let e=0;e<this.outs;e++)t.push(`stack[top] = out${e};`),t.push("top++;"),t.push(`if (top >= ${f}) { top = ${f-1}; }`);return t}}let s=128;function o(e){return[`float duration = clamp(${e.duration}, 0.05, 3600.0);`,`float startTimeOffset = ${e.startTimeOffset};`,`float repeatDelay = ${e.repeatDelay};`,`float timeOriginSelector = ${e.timeOriginSelector};`,`float repeatType = ${e.repeatType};`,`float easing = ${e.easing};`,`float playAnimation = ${e.playAnimation} * (1.0 - step(0.0, -${e.duration}));`,`float reverseAnimation = ${e.reverseAnimation};`,"float time = globalTime - (timeOriginSelector == 1.0 ? localTimeOrigin : 0.0);","time *= playAnimation;","time *= 1.0 - reverseAnimation * 2.0;","float period = duration + repeatDelay;","time += reverseAnimation == 1.0 ? (period - startTimeOffset - 0.001) : startTimeOffset + 0.001;","float omega = time / period;","float oi = floor(omega);","omega = repeatType == 1.0 || repeatType == 3.0 ? omega - oi : omega;","float of = omega * period;","of = (clamp(of, reverseAnimation * repeatDelay, period - (1.0 - reverseAnimation) * repeatDelay) - reverseAnimation * repeatDelay) / duration;","of = easing == 2.0 ? pow(of, 3.0) : of;","of = easing == 3.0 ? 1.0 - pow(1.0 - of, 3.0) : of;","of = easing == 4.0 ? of < 0.5 ? 4.0 * pow(of, 3.0) : 1.0 - pow(-2.0 * of + 2.0, 3.0) / 2.0 : of;","bool oscillate = repeatType == 3.0 && mod(oi, 2.0) == 1.0;",`${e.out} = oscillate ? 1.0 - of : of;`]}const a={Linear:1,EaseIn:2,EaseOut:3,EaseInOut:4},l={Loop:1,None:2,Oscillate:3},u={Local:1,Global:2};function c(e){const t=a[e.easing],i=l[e.repeatType],n=u[e.timeOriginSelector];return[[e.duration,e.startTimeOffset,e.repeatDelay,n],[i,t,e.playAnimation,e.reverseAnimation]]}const h={scalar:new class extends r{constructor(){super(...arguments),this.opcode=++s,this.length=1,this.ins=0,this.outs=1,this.microcode=["out0 = vec4(atom0.y, atom0.y, atom0.y, atom0.y);"]}encode(e){return[[this.opcode,e,0,0]]}},vector3:new class extends r{constructor(){super(...arguments),this.opcode=++s,this.length=1,this.ins=0,this.outs=1,this.microcode=["out0 = vec4(atom0.yzw, 0.0);"]}encode(e){return[[this.opcode,e[0]||0,e[1]||0,e[2]||0]]}},vector4:new class extends r{constructor(){super(...arguments),this.opcode=++s,this.length=2,this.ins=0,this.outs=1,this.microcode=["out0 = atom1;"]}encode(e){return[[this.opcode,0,0,0],e]}},animatedTransform:new class extends r{constructor(){super(...arguments),this.opcode=++s,this.length=10,this.ins=1,this.outs=1,this.microcode=["vec2 fromTranslation = atom1.xy;","vec2 toTranslation = atom1.zw;","float fromRotation = atom2.x;","float toRotation = atom2.y;","float fromScale = atom2.z;","float toScale = atom2.w;","bool relativeTranslation = atom9.x == 1.0;","bool absoluteScale = atom9.y == 1.0;","vec2 translationMultiplier = relativeTranslation ? pixelDimensions : vec2(1.0, 1.0);","float scaleDivisor = absoluteScale ? pixelDimensions.y : 1.0;","float fTranslation;","{",...o({duration:"atom3.x",startTimeOffset:"atom3.y",repeatDelay:"atom3.z",timeOriginSelector:"atom3.w",repeatType:"atom4.x",easing:"atom4.y",playAnimation:"atom4.z",reverseAnimation:"atom4.w",out:"fTranslation"}),"}","float fRotation;","{",...o({duration:"atom5.x",startTimeOffset:"atom5.y",repeatDelay:"atom5.z",timeOriginSelector:"atom5.w",repeatType:"atom6.x",easing:"atom6.y",playAnimation:"atom6.z",reverseAnimation:"atom6.w",out:"fRotation"}),"}","float fScale;","{",...o({duration:"atom7.x",startTimeOffset:"atom7.y",repeatDelay:"atom7.z",timeOriginSelector:"atom7.w",repeatType:"atom8.x",easing:"atom8.y",playAnimation:"atom8.z",reverseAnimation:"atom8.w",out:"fScale"}),"}","vec2 aTranslation = mix(fromTranslation, toTranslation, fTranslation);","float aRotation = mix(fromRotation, toRotation, fRotation);","float aScale = mix(fromScale, toScale, fScale);","vec2 pTranslation = in0.xy;","float pRotation = in0.z;","float pScale = in0.w;","aTranslation *= translationMultiplier;","aScale /= scaleDivisor;","float rotation = pRotation + aRotation;","float scale = pScale * aScale;","float sin1 = sin(pRotation);","float cos1 = cos(pRotation);","float s1 = pScale;","float x1 = pTranslation.x;","float y1 = pTranslation.y;","float x2 = aTranslation.x;","float y2 = aTranslation.y;","\n    vec2 translation = vec2(\n      cos1 * s1 * x2 - sin1 * s1 * y2 + x1,\n      sin1 * s1 * x2 + cos1 * s1 * y2 + y1\n    );\n    ","out0 = vec4(translation, rotation, scale);"]}encode(e){return[[this.opcode,0,0,0],[e.translation.from[0],e.translation.from[1],e.translation.to[0],e.translation.to[1]],[e.rotation.from,e.rotation.to,e.scale.from,e.scale.to],...c(e.translation.timing),...c(e.rotation.timing),...c(e.scale.timing),[e.relativeTranslation?1:0,e.absoluteScale?1:0,0,0]]}},animatedColor:new class extends r{constructor(){super(...arguments),this.opcode=++s,this.length=7,this.ins=1,this.outs=1,this.microcode=["float fromOpacity = atom0.y;","float toOpacity = atom0.z;","vec4 fromColor = atom1;","vec4 toColor = atom2;","float fColor;","{",...o({duration:"atom3.x",startTimeOffset:"atom3.y",repeatDelay:"atom3.z",timeOriginSelector:"atom3.w",repeatType:"atom4.x",easing:"atom4.y",playAnimation:"atom4.z",reverseAnimation:"atom4.w",out:"fColor"}),"}","float fOpacity;","{",...o({duration:"atom5.x",startTimeOffset:"atom5.y",repeatDelay:"atom5.z",timeOriginSelector:"atom5.w",repeatType:"atom6.x",easing:"atom6.y",playAnimation:"atom6.z",reverseAnimation:"atom6.w",out:"fOpacity"}),"}","vec4 aColor = mix(fromColor, toColor, fColor);","aColor.a *= mix(fromOpacity, toOpacity, fOpacity);","vec4 pColor = in0;","out0 = aColor * pColor;"]}encode(e){return[[this.opcode,e.opacity.from,e.opacity.to,0],[e.color.from[0],e.color.from[1],e.color.from[2],e.color.from[3]],[e.color.to[0],e.color.to[1],e.color.to[2],e.color.to[3]],...c(e.color.timing),...c(e.opacity.timing)]}},ret:new class extends r{constructor(){super(...arguments),this.opcode=++s,this.length=1,this.ins=0,this.outs=0,this.microcode=["break;"]}encode(){return[[this.opcode,0,0,0]]}}},d=40,f=4;function p(e){const t=[];t.push(`float globalTime = ${e.globalTime};`),t.push(`float localTimeOrigin = ${e.localTimeOrigin};`),t.push(`vec2 pointer = ${e.animationPointer};`),t.push(`vec2 size = ${e.animationTextureSize};`),t.push("int top = 0;"),t.push(`vec4 stack[${f}];`),t.push(`for (int counter = 0; counter < ${d}; counter++) {`),t.push(`vec4 atom0 = texture(${e.animationTexture}, (pointer + 0.5) / size);`),t.push("pointer.x += 1.0;"),t.push(`vec2 pixelDimensions = ${e.pixelDimensions};`),t.push("if (false) {");for(const i in h){const n=h[i];t.push(`} else if (int(atom0.x) == ${n.opcode}) {`);for(const i of n.generateSource(e))t.push(i)}return t.push("} // End if-else."),t.push("} // End for."),t.push(`${e.out} = top > 0 ? stack[top - 1] : vec4(0.0);`),t.join("\n")}},73936:function(e,t,i){i.d(t,{A:function(){return u}});var n=i(39686),r=i(77416),s=i(52937),o=i(85456);const a={nearest:{defines:[],samplingMode:o.Cj.NEAREST,mips:!1},bilinear:{defines:[],samplingMode:o.Cj.LINEAR,mips:!1},bicubic:{defines:["bicubic"],samplingMode:o.Cj.LINEAR,mips:!1},trilinear:{defines:[],samplingMode:o.Cj.LINEAR_MIPMAP_LINEAR,mips:!0}},l=(e,t,i)=>{if("dynamic"===i.samplingMode){const{state:i}=e,n=t.resolution/t.pixelRatio/i.resolution,r=Math.round(e.pixelRatio)!==e.pixelRatio,s=n>1.05||n<.95;return i.rotation||s||r||t.isSourceScaled||t.rotation?a.bilinear:a.nearest}return a[i.samplingMode]};class u extends s.A{constructor(){super(...arguments),this._desc={vsPath:"raster/bitmap",fsPath:"raster/bitmap",attributes:new Map([["a_pos",0]])}}dispose(){this._quad&&this._quad.dispose()}prepareState({context:e}){e.setBlendingEnabled(!0),e.setColorMask(!0,!0,!0,!0),e.setStencilWriteMask(0),e.setStencilTestEnabled(!0)}draw(e,t){const{context:i,renderingOptions:s,painter:a,requestRender:u,allowDelayedRender:c}=e;if(!t.source||!t.isReady)return;const h=l(e,t,s),d=a.materialManager.getProgram(this._desc,h.defines);if(c&&null!=u&&!d.compiled)return void u();e.timeline.begin(this.name),"additive"===t.blendFunction?i.setBlendFunctionSeparate(o.dn.ONE,o.dn.ONE,o.dn.ONE,o.dn.ONE):i.setBlendFunctionSeparate(o.dn.ONE,o.dn.ONE_MINUS_SRC_ALPHA,o.dn.ONE,o.dn.ONE_MINUS_SRC_ALPHA),i.setStencilFunction(o.MT.EQUAL,t.stencilRef,255),this._quad||(this._quad=new r.A(i,[0,0,1,0,0,1,1,1]));const{coordScale:f,computedOpacity:p,transforms:m}=t;t.setSamplingProfile(h),t.bind(e.context,n.YS),i.useProgram(d),d.setUniformMatrix3fv("u_dvsMat3",m.displayViewScreenMat3),d.setUniform1i("u_texture",n.YS),d.setUniform2fv("u_coordScale",f),d.setUniform1f("u_opacity",p),this._quad.draw(),e.timeline.end(this.name)}}},52937:function(e,t,i){i.d(t,{A:function(){return n}});class n{constructor(){this.name=this.constructor.name||"UnnamedBrush",this.brushEffect=null}prepareState(e,t){}draw(e,t,i){}drawMany(e,t,i){for(const n of t)n.visible&&this.draw(e,n,i)}}},829:function(e,t,i){i.d(t,{A:function(){return h}});var n=i(43745),r=i(94860),s=i(52937),o=i(94020),a=i(86305),l=i(85456),u=i(10904),c=i(81438);class h extends s.A{constructor(){super(...arguments),this._color=(0,n.fA)(1,0,0,1),this._initialized=!1}dispose(){this._solidProgram&&(this._solidProgram.dispose(),this._solidProgram=null),this._solidVertexArrayObject&&(this._solidVertexArrayObject.dispose(),this._solidVertexArrayObject=null)}prepareState({context:e}){e.setDepthWriteEnabled(!1),e.setDepthTestEnabled(!1),e.setStencilTestEnabled(!0),e.setBlendingEnabled(!1),e.setColorMask(!1,!1,!1,!1),e.setStencilOp(l.eA.KEEP,l.eA.KEEP,l.eA.REPLACE),e.setStencilWriteMask(255)}draw(e,t){const{context:i,requestRender:n,allowDelayedRender:r}=e;this._initialized||this._initialize(i),!r||null==n||this._solidProgram.compiled?(i.setStencilFunctionSeparate(l.Y7.FRONT_AND_BACK,l.MT.GREATER,t.stencilRef,255),i.bindVAO(this._solidVertexArrayObject),i.useProgram(this._solidProgram),this._solidProgram.setUniformMatrix3fv("u_dvsMat3",t.transforms.displayViewScreenMat3),this._solidProgram.setUniform2fv("u_coord_range",[t.rangeX,t.rangeY]),this._solidProgram.setUniform1f("u_depth",0),this._solidProgram.setUniform4fv("u_color",this._color),i.drawArrays(l.WR.TRIANGLE_STRIP,0,4),i.bindVAO()):n()}_initialize(e){if(this._initialized)return!0;const t=(0,u.r)(e,o.T);if(!t)return!1;const i=new Int8Array([0,0,1,0,0,1,1,1]),n=a.g.createVertex(e,l._U.STATIC_DRAW,i),s=new c.Z(e,o.T.attributes,r.Pd,new Map([["geometry",n]]));return this._solidProgram=t,this._solidVertexArrayObject=s,this._initialized=!0,!0}}},55382:function(e,t,i){i.d(t,{A:function(){return _}});var n=i(43745),r=i(94860),s=i(27657),o=i(52937),a=i(94020),l=i(47272),u=i(86305),c=i(85456),h=i(10904),d=i(12285),f=i(10956),p=i(81438);const m=16;class _ extends o.A{constructor(){super(...arguments),this._color=(0,n.fA)(1,0,0,1)}dispose(){this._outlineProgram?.dispose(),this._outlineProgram=null,this._tileInfoProgram?.dispose(),this._tileInfoProgram=null,this._outlineVertexArrayObject?.dispose(),this._outlineVertexArrayObject=null,this._tileInfoVertexArrayObject?.dispose(),this._tileInfoVertexArrayObject=null,this._ctx=null}prepareState({context:e}){e.setBlendingEnabled(!0),e.setBlendFunctionSeparate(c.dn.ONE,c.dn.ONE_MINUS_SRC_ALPHA,c.dn.ONE,c.dn.ONE_MINUS_SRC_ALPHA),e.setColorMask(!0,!0,!0,!0),e.setStencilWriteMask(0),e.setStencilTestEnabled(!1)}draw(e,t){const{context:i,requestRender:n,allowDelayedRender:r}=e;if(!t.isReady&&t instanceof s.R&&t.hasData)return;if(this._loadWGLResources(i),r&&null!=n&&(!this._outlineProgram.compiled||!this._tileInfoProgram.compiled))return void n();i.bindVAO(this._outlineVertexArrayObject),i.useProgram(this._outlineProgram),this._outlineProgram.setUniformMatrix3fv("u_dvsMat3",t.transforms.displayViewScreenMat3),this._outlineProgram.setUniform2f("u_coord_range",t.rangeX,t.rangeY),this._outlineProgram.setUniform1f("u_depth",0),this._outlineProgram.setUniform4fv("u_color",this._color),i.drawArrays(c.WR.LINE_STRIP,0,4);const o=this._getTexture(i,t);o?(i.bindVAO(this._tileInfoVertexArrayObject),i.useProgram(this._tileInfoProgram),i.bindTexture(o,0),this._tileInfoProgram.setUniformMatrix3fv("u_dvsMat3",t.transforms.displayViewScreenMat3),this._tileInfoProgram.setUniform1f("u_depth",0),this._tileInfoProgram.setUniform2f("u_coord_ratio",t.rangeX/t.width,t.rangeY/t.height),this._tileInfoProgram.setUniform2f("u_delta",0,0),this._tileInfoProgram.setUniform2f("u_dimensions",o.descriptor.width,o.descriptor.height),i.drawArrays(c.WR.TRIANGLE_STRIP,0,4),i.bindVAO()):i.bindVAO()}_loadWGLResources(e){if(this._outlineProgram&&this._tileInfoProgram)return;const t=(0,h.r)(e,a.T),i=(0,h.r)(e,l.H),n=new Int8Array([0,0,1,0,1,1,0,1]),s=u.g.createVertex(e,c._U.STATIC_DRAW,n),o=new p.Z(e,a.T.attributes,r.Pd,new Map([["geometry",s]])),d=new Int8Array([0,0,1,0,0,1,1,1]),f=u.g.createVertex(e,c._U.STATIC_DRAW,d),m=new p.Z(e,l.H.attributes,r.Pd,new Map([["geometry",f]]));this._outlineProgram=t,this._tileInfoProgram=i,this._outlineVertexArrayObject=o,this._tileInfoVertexArrayObject=m}_getTexture(e,t){if(!this._ctx){const e=document.createElement("canvas");e.width=512,e.height=512,this._ctx=e.getContext("2d")}if(!t.tileDebugInfoTexture){const i=new f.R;i.wrapMode=c.pF.CLAMP_TO_EDGE,i.samplingMode=c.Cj.LINEAR,i.isImmutable=!0,i.width=512,i.height=512,t.tileDebugInfoTexture=new d.g(e,i)}const i=this._ctx;i.clearRect(0,0,i.canvas.width,i.canvas.height),i.textAlign="left",i.textBaseline="top",i.font="14px sans-serif",i.lineWidth=2,i.fillStyle="white",i.strokeStyle="black";const{debugSlot:n}=t;let r=8+99.2*n;const s=`${n}) ${t.key.id} (${t.constructor.name})`;i.strokeText(s,8,r),i.fillText(s,8,r),r+=m;const{debugInfo:o}=t;if(o){const{length:e,minOrderedLength:t,minUnorderedLength:n,triangleCount:s}=o.display;if(e>0){const t=`Length: ${e}`;i.strokeText(t,8,r),i.fillText(t,8,r),r+=m}if(t){const e=`Min ordered length: ${t}`;i.strokeText(e,8,r),i.fillText(e,8,r),r+=m}if(n){const e=`Min unordered length: ${n}`;i.strokeText(e,8,r),i.fillText(e,8,r),r+=m}if(s>0){s>1e5&&(i.fillStyle="red",i.strokeStyle="white");const e=`Triangle count: ${s}`;i.strokeText(e,8,r),i.fillText(e,8,r),r+=m}const{bytesUsed:a,bytesReserved:l}=o.memory;if(i.fillStyle="white",i.strokeStyle="black",a>0||l>0){const e=`Memory usage: ${a} of ${l} bytes`;i.strokeText(e,8,r),i.fillText(e,8,r),r+=m}}return t.tileDebugInfoTexture.setData(i.canvas),t.tileDebugInfoTexture}}},87573:function(e,t,i){i.d(t,{A:function(){return r}});var n=i(14583);class r{constructor(e,t,i,r){this.transformedX=0,this.transformedY=0,this.center=(0,n.fA)(e,t),this.centerT=(0,n.vt)(),this.halfWidth=i/2,this.halfHeight=r/2,this.width=i,this.height=r}get x(){return this.center[0]}get y(){return this.center[1]}get blX(){return this.center[0]+this.halfWidth}get blY(){return this.center[1]+this.halfHeight}get trX(){return this.center[0]-this.halfWidth}get trY(){return this.center[1]-this.halfHeight}get xmin(){return this.x-this.halfWidth}get xmax(){return this.x+this.halfWidth}get ymin(){return this.y-this.halfHeight}get ymax(){return this.y+this.halfHeight}set x(e){this.center[0]=e}set y(e){this.center[1]=e}clone(){return new r(this.x,this.y,this.width,this.height)}serialize(e){return e.writeF32(this.center[0]),e.writeF32(this.center[1]),e.push(this.width),e.push(this.height),e}findCollisionDelta(e,t=4){const i=Math.abs(e.centerT[0]-this.centerT[0]),n=Math.abs(e.centerT[1]-this.centerT[1]),r=(e.halfWidth+this.halfWidth+t)/i,s=(e.halfHeight+this.halfHeight+t)/n,o=Math.min(r,s);return Math.log2(o)}extend(e){const t=Math.min(this.xmin,e.xmin),i=Math.min(this.ymin,e.ymin),n=Math.max(this.xmax,e.xmax)-t,r=Math.max(this.ymax,e.ymax)-i,s=t+n/2,o=i+r/2;this.width=n,this.height=r,this.halfWidth=n/2,this.halfHeight=r/2,this.x=s,this.y=o}static deserialize(e){const t=e.readF32(),i=e.readF32(),n=e.readInt32(),s=e.readInt32();return new r(t,i,n,s)}}},57650:function(e,t,i){i.d(t,{f:function(){return s}});var n=i(87573),r=i(24964);class s{constructor(e,t,i,n,r,s,o,a,l=[]){this.entityTexel=e,this.anchorX=t,this.anchorY=i,this.directionX=n,this.directionY=r,this.maxScale=s,this.minScale=o,this.referenceBounds=a,this.bounds=l}serialize(e){e.push(this.entityTexel),e.writeF32(this.anchorX),e.writeF32(this.anchorY),e.writeF32(this.directionX),e.writeF32(this.directionY),e.writeF32(this.maxScale),e.writeF32(this.minScale),null===this.referenceBounds?(e.writeF32(0),e.writeF32(0),e.writeF32(0)):(e.writeF32(this.referenceBounds.size),e.writeF32(this.referenceBounds.offsetX),e.writeF32(this.referenceBounds.offsetY)),(0,r.j)(e,this.bounds)}static deserialize(e){const t=e.readInt32(),i=e.readF32(),o=e.readF32(),a=e.readF32(),l=e.readF32(),u=e.readF32(),c=e.readF32(),h=e.readF32(),d=e.readF32(),f=e.readF32(),p=(0,r._)(e,n.A)??[];return new s(t,i,o,a,l,u,c,{size:h,offsetX:d,offsetY:f},p)}}},83258:function(e,t,i){i.d(t,{B:function(){return n},P:function(){return r}});class n{constructor(e){if(this.next=null,!Array.isArray(e))return void(this.data=e);this.data=e[0];let t=this;for(let i=1;i<e.length;i++)t.next=new n([e[i]]),t=t.next}*values(){let e=this;for(;e;)yield e.data,e=e.next}forEach(e){let t=this;for(;t;)e(t.data),t=t.next}get last(){return this.next?this.next.last:this}}class r{constructor(e){this._head=null,null!=e&&(this._head=new n(e))}get head(){return this._head}maxAvailableSpace(){if(null==this._head)return 0;let e=0;return this._head.forEach((t=>{const i=t.end-t.start;e=Math.max(e,i)})),e}firstFit(e){if(null==this._head)return null;let t=null,i=this._head;for(;i;){const n=i.data.end-i.data.start;if(n===e)return t?t.next=i.next:this._head=i.next,i.data.start;if(n>e){const t=i.data.start;return i.data.start+=e,t}t=i,i=i.next}return null}free(e,t){const i=e+t;if(null==this._head){const t=new n({start:e,end:i});return void(this._head=t)}if(i<=this._head.data.start){if(i===this._head.data.start)return void(this._head.data.start-=t);const r=new n({start:e,end:i});return r.next=this._head,void(this._head=r)}let r=this._head,s=r.next;for(;s;){if(s.data.start>=i){if(r.data.end===e){if(r.data.end+=t,r.data.end===s.data.start){const e=s.data.end-s.data.start;return r.data.end+=e,void(r.next=s.next)}return}if(s.data.start===i)return void(s.data.start-=t);const o=new n({start:e,end:i});return o.next=r.next,void(r.next=o)}r=s,s=s.next}if(e===r.data.end)return void(r.data.end+=t);const o=new n({start:e,end:i});r.next=o}clear(){this._head=null}}},17469:function(e,t,i){i.d(t,{Tl:function(){return T}});var n=i(67348),r=i(10793),s=i(13786),o=i(14583),a=i(96564),l=i(54904),u=i(87573);const c=22,h=4,d=c+h,f=c-6,p=3,m=Math.PI/180;class _{constructor(e,t,i,n){this._rotationT=(0,r.vt)(),this._xBounds=0,this._yBounds=0,this.minZoom=0,this.maxZoom=255,this._bounds=null;const s=i.rect,o=new Float32Array(8);e*=n,t*=n;const a=i.code?s.width*n:i.metrics.width,l=i.code?s.height*n:i.metrics.height;this.width=a,this.height=l,o[0]=e,o[1]=t,o[2]=e+a,o[3]=t,o[4]=e,o[5]=t+l,o[6]=e+a,o[7]=t+l,this._data=o,this._setTextureCoords(s),this._scale=n,this._mosaic=i,this.x=e,this.y=t,this.maxOffset=Math.max(e+a,t+l)}get mosaic(){return this._mosaic}set angle(e){this._angle=e,(0,n.$0)(this._rotationT,-e),this._setOffsets()}get angle(){return this._angle}get xTopLeft(){return this._data[0]}get yTopLeft(){return this._data[1]}get xBottomRight(){return this._data[6]}get yBottomRight(){return this._data[7]}get texcoords(){return this._texcoords}get textureBinding(){return this._mosaic.textureBinding}get offsets(){return this._offsets||this._setOffsets(),this._offsets}get char(){return String.fromCharCode(this._mosaic.code)}get code(){return this._mosaic.code}get bounds(){if(!this._bounds){const{height:e,width:t}=this._mosaic.metrics,i=t*this._scale,s=Math.abs(e)*this._scale,o=new Float32Array(8);o[0]=this.x,o[1]=this.y,o[2]=this.x+i,o[3]=this.y,o[4]=this.x,o[5]=this.y+s,o[6]=this.x+i,o[7]=this.y+s;const a=(0,n.lw)((0,r.vt)(),this._rotationT,this._transform);(0,r.gb)(o,o,a);let l=1/0,c=1/0,h=-1/0,d=-1/0;for(let e=0;e<4;e++){const t=o[2*e],i=o[2*e+1];l=Math.min(l,t),c=Math.min(c,i),h=Math.max(h,t),d=Math.max(d,i)}const f=h-l,p=d-c,m=l+f/2,_=c+p/2;this._bounds=new u.A(m,_,f,p)}return this._bounds}setTransform(e){this._transform=e,this._offsets=null}_setOffsets(){this._offsets||(this._offsets={topLeft:[0,0],topRight:[0,0],bottomLeft:[0,0],bottomRight:[0,0]});const e=(0,n.lw)((0,r.vt)(),this._rotationT,this._transform);this._offsets.topLeft[0]=this._data[0],this._offsets.topLeft[1]=this._data[1],this._offsets.topRight[0]=this._data[2],this._offsets.topRight[1]=this._data[3],this._offsets.bottomLeft[0]=this._data[4],this._offsets.bottomLeft[1]=this._data[5],this._offsets.bottomRight[0]=this._data[6],this._offsets.bottomRight[1]=this._data[7],(0,s.l0)(this._offsets.topLeft,this._offsets.topLeft,e),(0,s.l0)(this._offsets.topRight,this._offsets.topRight,e),(0,s.l0)(this._offsets.bottomLeft,this._offsets.bottomLeft,e),(0,s.l0)(this._offsets.bottomRight,this._offsets.bottomRight,e)}_setTextureCoords({x:e,y:t,width:i,height:n}){this._texcoords={topLeft:[e,t],topRight:[e+i,t],bottomLeft:[e,t+n],bottomRight:[e+i,t+n]}}}const g=(e,t)=>({code:0,page:0,sdf:!0,rect:new l.A(0,0,11,8),textureBinding:t,metrics:{advance:0,height:4,width:e,left:0,top:0}});function y(e,t){return e.forEach((e=>(0,s.l0)(e,e,t))),{topLeft:e[0],topRight:e[1],bottomLeft:e[2],bottomRight:e[3]}}class v{constructor(e,t,i){this._rotation=0,this._decorate(e,t,i),this.glyphs=e,this.bounds=this._createBounds(e),this.isMultiline=t.length>1,this._hasRotation=0!==i.angle,this._transform=this._createGlyphTransform(this.bounds,i),this._borderLineSizePx=i.borderLineSizePx,(i.borderLineSizePx||i.hasBackground)&&([this.bounds,this.textBox]=this.shapeBackground(this._transform));for(const t of e)t.setTransform(this._transform)}setRotation(e){if(0===e&&0===this._rotation)return;this._rotation=e;const t=this._transform,i=(0,n.$0)((0,r.vt)(),e);(0,n.lw)(t,i,t);for(const e of this.glyphs)e.setTransform(this._transform)}_decorate(e,t,i){if(!i.decoration||"none"===i.decoration||!e.length)return;const n=i.scale,r="underline"===i.decoration?d:f,s=e[0].textureBinding;for(const i of t){const t=i.startX*n,o=i.startY*n,a=(i.width+i.glyphWidthEnd)*n;e.push(new _(t,o+r*n,g(a,s),1))}}shapeBackground(e){const t=(1.5+(this._borderLineSizePx||0))/2,i=this._borderLineSizePx?t:0,{xmin:n,ymin:r,xmax:s,ymax:o,x:a,y:l,width:c,height:h}=this.bounds,d=[n-8,r-8],f=[s+8,r-8],p=[n-8,o+8],m=[s+8,o+8],_=y([[d[0]-t,d[1]-t],[f[0]+t,f[1]-t],[d[0]+i,d[1]+i],[f[0]-i,f[1]+i]],e),g=y([[p[0]+i,p[1]-i],[m[0]-i,m[1]-i],[p[0]-t,p[1]+t],[m[0]+t,m[1]+t]],e),v=y([[d[0]-t,d[1]-t],[d[0]+i,d[1]+i],[p[0]-t,p[1]+t],[p[0]+i,p[1]-i]],e),x=y([[f[0]-i,f[1]+i],[f[0]+t,f[1]-t],[m[0]-i,m[1]-i],[m[0]+t,m[1]+t]],e),b={main:y([d,f,p,m],e),top:_,bot:g,left:v,right:x};return[new u.A(a,l,c+2*t,h+2*t),b]}get boundsT(){const e=this.bounds,t=(0,s.hZ)((0,o.vt)(),e.x,e.y);if((0,s.l0)(t,t,this._transform),this._hasRotation){const i=Math.max(e.width,e.height);return new u.A(t[0],t[1],i,i)}return new u.A(t[0],t[1],e.width,e.height)}_createBounds(e){let t=1/0,i=1/0,n=0,r=0;for(const s of e)t=Math.min(t,s.xTopLeft),i=Math.min(i,s.yTopLeft),n=Math.max(n,s.xBottomRight),r=Math.max(r,s.yBottomRight);const s=n-t,o=r-i;return new u.A(t+s/2,i+o/2,s,o)}_createGlyphTransform(e,t){const i=m*t.angle,a=(0,r.vt)(),l=(0,o.vt)();return(0,n.Tl)(a,a,(0,s.hZ)(l,t.xOffset,-t.yOffset)),t.useCIMAngleBehavior?(0,n.e$)(a,a,i):((0,n.Tl)(a,a,(0,s.hZ)(l,e.x,e.y)),(0,n.e$)(a,a,i),(0,n.Tl)(a,a,(0,s.hZ)(l,-e.x,-e.y))),a}}class x{constructor(e,t,i,n,r,s){this.glyphWidthEnd=0,this.startX=0,this.startY=0,this.start=Math.max(0,Math.min(t,i)),this.end=Math.max(0,Math.max(t,i)),this.end<e.length&&(this.glyphWidthEnd=e[this.end].metrics.width),this.width=n,this.yMin=r,this.yMax=s}}const b=e=>10===e,S=e=>32===e;function w(e,t){let i=0;for(let t=0;t<e.length;t++){const{width:n}=e[t];i=Math.max(n,i)}const n="underline"===t.decoration?h:0,r=e[0].yMin;return{x:0,y:r,height:e[e.length-1].yMax+t.lineHeight*(e.length-1)+n-r,width:i}}function T(e,t){const i=t.scale,n=new Array,{glyphs:r,isRightToLeft:s}=e,o=function(e,t,i){const n=new Array,r=1/i.scale,s=i.maxLineWidth*r,o=t?e.length-1:0,a=t?-1:e.length,l=t?-1:1;let u=o,c=0,h=0,d=u,f=d,p=0,m=1/0,_=0;for(;u!==a;){const{code:t,metrics:i}=e[u],r=Math.abs(i.top);if(b(t)||S(t)||(m=Math.min(m,r),_=Math.max(_,r+i.height)),b(t))u!==o&&(n.push(new x(e,d,u-l,c,m===1/0?0:m,_)),m=1/0,_=0),c=0,d=u+l,f=u+l,h=0;else if(S(t))f=u+l,h=0,p=i.advance,c+=i.advance;else if(c>s){if(f!==d){const t=f-2*l;c-=p,n.push(new x(e,d,t,c-h,m,_)),m=1/0,_=0,d=f,c=h}else n.push(new x(e,d,u-l,c,m,_)),m=1/0,_=0,d=u,f=u,c=0;c+=i.advance,h+=i.advance}else c+=i.advance,h+=i.advance;u+=l}const g=new x(e,d,u-l,c,m,_);return g.start>=0&&g.end<e.length&&n.push(g),n}(r,s,t),l=o.length?w(o,t):{x:0,y:0,height:0,width:0},u=(0,a.xy)(t.horizontalAlignment),h=(0,a.UD)(t.verticalAlignment),d=h===a.gy.Baseline?1:0,f=d?0:h-1,m=(1-d)*-l.y+f*(l.height/2)+(d?1:0)*-c;for(let s=0;s<o.length;s++){const{start:a,end:l,width:c}=o[s];let h=-1*(u+1)*(c/2)-p;const d=(e.isRightToLeft?o.length-1-s:s)*t.lineHeight+m-p;o[s].startX=h,o[s].startY=d;for(let e=a;e<=l;e++){const t=r[e];if(b(t.code))continue;const s=new _(h+t.metrics.left,d-t.metrics.top,t,i);h+=t.metrics.advance,n.push(s)}}return new v(n,o,t)}},10899:function(e,t,i){i.d(t,{e:function(){return l}});var n=i(84354),r=i(86305),s=i(85456),o=i(81438),a=i(3817);class l{constructor(e,t){this._boundPart=null,this.vertexBuffers=new Map;for(const[i,n]of Object.entries(t.vertex)){const t=r.g.createVertex(e,s._U.STATIC_DRAW,n);this.vertexBuffers.set(i,t)}const i=new Map;for(const[n,o]of Object.entries(t.index??{})){const t=r.g.createIndex(e,s._U.STATIC_DRAW,o);i.set(n,t)}this.groups=[];for(const n of t.groups){let r;if(null!=n.index){if(!t.index?.[n.index])throw new Error("No index data.");const{BYTES_PER_ELEMENT:e}=t.index[n.index];2===e?r=s.pe.UNSIGNED_SHORT:4===e&&(r=s.pe.UNSIGNED_INT)}const l=null!=n.index?i.get(n.index):null,u=new Map,c=new Map;for(const e of n.attributes){const{name:t,count:i,type:n,offset:r,normalized:s,divisor:o,stride:l,vertex:h,location:d}=e;let f=c.get(h);f||(f=[],c.set(h,f));const p=new a._(t,i,n,r,l,s,o);f.push(p),u.set(t,d)}const h=new o.Z(e,u,c,this.vertexBuffers,l);this.groups.push({...n,vertexArray:h,locations:u,layout:c,indexing:r})}this.parts=t.parts}bind(e,t){this._boundPart=t;const{group:i}=this.parts[this._boundPart],{vertexArray:n}=this.groups[i];e.bindVAO(n)}draw(e){if(null==this._boundPart)throw new Error("Mesh.bind() has not been called.");const{start:t,count:i}=this.parts[this._boundPart],{group:r}=this.parts[this._boundPart],{indexing:s,primitive:o}=this.groups[r];s?e.drawElements(o,i,s,t*n.I[s]):e.drawArrays(o,t,i)}unbind(e){this._boundPart=null,e.bindVAO(null)}destroy(){for(const{vertexArray:e}of this.groups)e.dispose()}}},61117:function(e,t,i){i.d(t,{g:function(){return a}});var n=i(84354),r=i(10899),s=i(85456);const o={position:{type:s.pe.SHORT,count:2}};class a extends r.e{static create(e,t,i){const r=[];let{stride:s}=t;if(null==s){s=0;for(const[e,{count:i,type:r,offset:o}]of Object.entries(t.layout)){if(null!=o)throw new Error("Stride cannot be computed automatically when attribute offsets are supplied explicitly.");s+=i*n.I[r]}}let o=0;for(const[e,{count:a,offset:l,type:u,normalized:c}]of Object.entries(t.layout)){null!=l&&(o=l);const t=i.get(e);if(null==t)throw new Error("Locations must be specified at mesh initialization.");const h={name:e,location:t,vertex:"vertexData",count:a,type:u,offset:o,stride:s,divisor:0,normalized:null!=c&&c};r.push(h),o+=a*n.I[u]}const l={attributes:r,primitive:t.primitive};null!=t.index&&(l.index="indexData");let{count:u}=t;if(null==u&&(u=t.index?t.index.length:t.vertex.byteLength/s,Math.floor(u)!==u))throw new Error(`The byte length of vertex data must be an exact multiple of the stride, which is ${s}.`);const c={start:0,count:u,group:0,primitive:t.primitive},h={vertex:{vertexData:t.vertex},parts:[c],groups:[l]};return null!=t.index&&(h.index={indexData:t.index}),new a(e,h,t.layout)}static fromVertexStream(e,t){return a.create(e,{primitive:s.WR.TRIANGLE_STRIP,vertex:new Uint16Array(t),layout:o},new Map([["position",0]]))}constructor(e,t,i){super(e,t),this._spec=i}bind(e,t=0){super.bind(e,t)}}},84354:function(e,t,i){i.d(t,{I:function(){return r}});var n=i(85456);const r={[n.pe.BYTE]:1,[n.pe.UNSIGNED_BYTE]:1,[n.pe.SHORT]:2,[n.pe.UNSIGNED_SHORT]:2,[n.pe.HALF_FLOAT]:2,[n.pe.INT]:4,[n.pe.UNSIGNED_INT]:4,[n.pe.FLOAT]:4}},85475:function(e,t,i){i.d(t,{Kl:function(){return l},M9:function(){return o},fw:function(){return a}});const n=new Float32Array(1),r=new Uint32Array(n.buffer);function s(e){return n[0]=e,r[0]}function o(e,t){return 65535&e|t<<16}function a(e){const t=s(e),i=t>>>31;let n=t>>>23&255,r=8388607&t;return n-=127,n>15?i<<15|31744:n<-25?0:(n<-14&&(r+=8388608,r/=2**(-14-n),n=-15),n+=15,r/=8192,r=function(e){const t=Math.floor(e),i=e-t;return t<1023&&(i>.5||.5===i&&t%2==1)?t+1:t}(r),i<<15|n<<10|r)}function l(e){let t=e>>>15,i=e>>10&31,n=1023&e;return t=t?-1:1,i-=15,n/=1024,i>-15?n+=1:i=-14,t*2**i*n}},98282:function(e,t,i){i.d(t,{Y7:function(){return L},HS:function(){return D},mm:function(){return N},A:function(){return B},k2:function(){return k},ZA:function(){return V},E8:function(){return z},hF:function(){return E},C5:function(){return C},uK:function(){return O},Pi:function(){return R}});var n=i(53804),r=(i(58941),i(40633)),s=i(50944),o=i(39819),a=i(54516),l=i(90553);class u{constructor(){this._includedModules=new Map}include(e,t){this._includedModules.has(e)?this._includedModules.get(e):(this._includedModules.set(e,t),e(this.builder,t))}}class c extends u{constructor(){super(...arguments),this.vertex=new f,this.fragment=new f,this.attributes=new p,this.varyings=new m,this.extensions=new _,this.constants=new g}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(e,t=!0){const i=this.extensions.generateSource(e),n=this.attributes.generateSource(e),r=this.varyings.generateSource(e),s="vertex"===e?this.vertex:this.fragment,o=s.uniforms.generateSource(),a=s.code.generateSource(),l="vertex"===e?y:"#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif\n",u=this.constants.generateSource().concat(s.constants.generateSource());return`${t?"#version 300 es":""}\n${i.join("\n")}\n${l}\n${u.join("\n")}\n${o.join("\n")}\n${n.join("\n")}\n${r.join("\n")}\n${a.join("\n")}`}generateBindPass(e){const t=new Map;this.vertex.uniforms.entries.forEach((e=>{const i=e.bind[a.c.Pass];i&&t.set(e.name,i)})),this.fragment.uniforms.entries.forEach((e=>{const i=e.bind[a.c.Pass];i&&t.set(e.name,i)}));const i=Array.from(t.values()),n=i.length;return(t,r)=>{for(let s=0;s<n;++s)i[s](e,t,r)}}generateBindDraw(e){const t=new Map;this.vertex.uniforms.entries.forEach((e=>{const i=e.bind[a.c.Draw];i&&t.set(e.name,i)})),this.fragment.uniforms.entries.forEach((e=>{const i=e.bind[a.c.Draw];i&&t.set(e.name,i)}));const i=Array.from(t.values()),n=i.length;return(t,r,s)=>{for(let o=0;o<n;++o)i[o](e,s,t,r)}}}class h{constructor(){this._entries=new Map}add(...e){for(const t of e)this._add(t)}get(e){return this._entries.get(e)}_add(e){if(null!=e){if(this._entries.has(e.name)&&!this._entries.get(e.name).equals(e))throw new o.A(`Duplicate uniform name ${e.name} for different uniform type`);this._entries.set(e.name,e)}else r.A.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder").error(`Trying to add null Uniform from ${(new Error).stack}.`)}generateSource(){return Array.from(this._entries.values()).map((e=>null!=e.arraySize?`uniform ${e.type} ${e.name}[${e.arraySize}];`:`uniform ${e.type} ${e.name};`))}get entries(){return Array.from(this._entries.values())}}class d{constructor(){this._entries=new Array}add(e){this._entries.push(e)}generateSource(){return this._entries}}class f extends u{constructor(){super(...arguments),this.uniforms=new h,this.code=new d,this.constants=new g}get builder(){return this}}class p{constructor(){this._entries=new Array}add(e,t){this._entries.push([e,t])}generateSource(e){return"fragment"===e?[]:this._entries.map((e=>`in ${e[1]} ${e[0]};`))}}class m{constructor(){this._entries=new Map}add(e,t){this._entries.has(e)&&(0,l.vA)(this._entries.get(e)===t),this._entries.set(e,t)}generateSource(e){const t=new Array;return this._entries.forEach(((i,n)=>t.push("vertex"===e?`out ${i} ${n};`:`in ${i} ${n};`))),t}}class _{constructor(){this._entries=new Set}add(e){this._entries.add(e)}generateSource(e){const t="vertex"===e?_.ALLOWLIST_VERTEX:_.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter((e=>t.includes(e))).map((e=>`#extension ${e} : enable`))}}_.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],_.ALLOWLIST_VERTEX=[];class g{constructor(){this._entries=new Set}add(e,t,i){let n="ERROR_CONSTRUCTOR_STRING";switch(t){case"float":n=g._numberToFloatStr(i);break;case"int":n=g._numberToIntStr(i);break;case"bool":n=i.toString();break;case"vec2":n=`vec2(${g._numberToFloatStr(i[0])},                            ${g._numberToFloatStr(i[1])})`;break;case"vec3":n=`vec3(${g._numberToFloatStr(i[0])},                            ${g._numberToFloatStr(i[1])},                            ${g._numberToFloatStr(i[2])})`;break;case"vec4":n=`vec4(${g._numberToFloatStr(i[0])},                            ${g._numberToFloatStr(i[1])},                            ${g._numberToFloatStr(i[2])},                            ${g._numberToFloatStr(i[3])})`;break;case"ivec2":n=`ivec2(${g._numberToIntStr(i[0])},                             ${g._numberToIntStr(i[1])})`;break;case"ivec3":n=`ivec3(${g._numberToIntStr(i[0])},                             ${g._numberToIntStr(i[1])},                             ${g._numberToIntStr(i[2])})`;break;case"ivec4":n=`ivec4(${g._numberToIntStr(i[0])},                             ${g._numberToIntStr(i[1])},                             ${g._numberToIntStr(i[2])},                             ${g._numberToIntStr(i[3])})`;break;case"mat2":case"mat3":case"mat4":n=`${t}(${Array.prototype.map.call(i,(e=>g._numberToFloatStr(e))).join(", ")})`}return this._entries.add(`const ${t} ${e} = ${n};`),this}static _numberToIntStr(e){return e.toFixed(0)}static _numberToFloatStr(e){return Number.isInteger(e)?e.toFixed(1):e.toString()}generateSource(){return Array.from(this._entries)}}const y="precision highp float;\nprecision highp sampler2D;";var v=i(70931);function x(e,t,i){const n=t.split("\n");for(const t of n)if(t.trim().length){{let t="";null!=i&&(t+=`/*id:${i??"000"}*/   `),e.body+=t.padEnd(14)}e.body+=" ".repeat(e.indent)+t+"\n"}}class b{write(e){for(const t of e.rootOutputNodes())e.shouldPruneOutputNode(t)||(t.variableName=this._write(e,t.node));return e}_createVarName(e,t){let i="";return"boolean"!=typeof t&&"number"!=typeof t&&t.debugInfo.name&&(i=`${t.debugInfo.name}_`),`${i}v${e.varCount++}`}_write(e,t,i=!1){if("number"==typeof t)return t.toString();if("boolean"==typeof t)return t.toString();let n=e.getEmit(t);if(n)return n;switch(t.shaderType){case"scope-node":n=this._writeScopeNode(e,t);break;case"primitive-node":n=this._writePrimitiveNode(e,t,i);break;case"function-node":n=this._writeFunctionNode(e,t);break;case"property-access-node":n=this._writePropertyAccessNode(e,t);break;case"text-node":n=t.text;break;case"block-node":n=this._writeBlockNode(e,t);break;case"condition-node":n=this._writeConditionNode(e,t)}return e.setEmit(t,n),n}_writeScopeNode(e,t){const i=new t.child.constructor;i.setDebugName(t.debugInfo.name);const n=this._write(e,i,!0);return x(e,`{ /*ScopeStart: ${t.uid} ${t.debugInfo.name}*/`),e.indent+=2,x(e,`${n} = ${this._write(e,t.child)};`),e.indent-=2,x(e,`} /*ScopeEnd: ${t.uid} ${t.debugInfo.name}*/`),n}_writeConditionNode(e,t){const i=new t.ifTrue.constructor,n=this._write(e,i,!0);x(e,`if (${this._write(e,t.condition)}) {`),e.indent+=2;const r=e.createSubgraphContext(),s=this._write(r,t.ifTrue);if(e.body+=r.body,s&&x(e,`${n} = ${s};`),e.indent-=2,x(e,"}"),t.ifFalse){x(e,"else {"),e.indent+=2;const i=e.createSubgraphContext(),r=this._write(i,t.ifFalse);e.body+=i.body,r&&x(e,`${n} = ${r};`),e.indent-=2,x(e,"}")}return n}_writeBlockNode(e,t){const{captureList:i,generator:n,returnType:r}=t,s={};for(const t in i){if(!i[t])continue;const n=this._write(e,i[t]);s[t]=n}const o=new r,a=this._write(e,o,!0);if(s.out=a,t.subgraph){const i=e.createSubgraphContext(),n=this._write(i,t.subgraph.child),r=i.body;s.subgraph={varName:n,body:r}}const l=n(s);return x(e,"{\n"),e.indent+=2,x(e,l),e.indent-=2,x(e,"}\n"),a}_writePropertyAccessNode(e,t){const i=this._write(e,t.target);return"string"==typeof t.property&&t.property.includes("[")?`${i}${t.property}`:"string"!=typeof t.property?`${i}[${this._write(e,t.property)}]`:`${i}.${t.property}`}_writeFunctionNode(e,t){const i=t.returnType.type;if(t.isInfix){const[n,r]=t.children.map((t=>this._write(e,t))),s=this._createVarName(e,t);return x(e,`${i.padEnd(5)} ${s} = ${n} ${t.token} ${r};`,t.uid),s}const n=t.children.map((t=>this._write(e,t))).join(", "),r=this._createVarName(e,t);return x(e,`${i.padEnd(5)} ${r} = ${t.token}(${n});`,t.uid),r}_writePrimitiveNode(e,t,i=!1){const n=e.getInput(t);if(n)return n.isUsed=!0,n.variableName;const r=1===t.children.length&&t.children[0]?.type===t.type;if(t.isImplicit||r)return this._write(e,t.children[0]);const s=this._createVarName(e,t);if(i)return x(e,`${t.type.padEnd(5)} ${s};`,t.uid),s;const o=!t.debugInfo.name&&!t.isMutable;if(o&&"float"===t.type&&"number"==typeof t.children[0])return Number.isInteger(t.children[0])?t.children[0].toFixed(1):t.children[0].toString();if(o&&"int"===t.type&&"number"==typeof t.children[0]&&Number.isInteger(t.children[0]))return t.children[0].toString();const a=t.children.map((t=>this._write(e,t))).join(", ");return"array"===t.type?(x(e,`${t.type.padEnd(5)} ${s} = [${a}];`,t.uid),s):o?`${t.type}(${a})`:(x(e,`${t.type.padEnd(5)} ${s} = ${t.type}(${a});`,t.uid),s)}}var S=i(44784);class w{constructor(e,t,i){this.variableName=e,this.variableInputType=t,this.node=i,this.type="shader-input",this.isUsed=!1}clone(){return new w(this.variableName,this.variableInputType,(0,S.vA)(this.node))}}class T{constructor(e,t,i){this.outVariableName=e,this.outVariableType=t,this.node=i,this.type="shader-output"}clone(){const e=new T(this.outVariableName,this.outVariableType,(0,S.vA)(this.node));return e.variableName=this.variableName,e}}class P{static createVertex(e,t,i,n,r,s){const o=[];for(const t in e){const n=e[t],r=i.get(t);r?o.push(new w(r,"builtin",n)):o.push(new w("a_"+t,"in",n))}for(const e of n){const t=e.uniformHydrated;o.push(new w(e.uniformName,"uniform",t))}const a=[];for(const e in t){const i=t[e];"glPosition"===e?a.push(new T("gl_Position","builtin",i)):"glPointSize"===e?a.push(new T("gl_PointSize","builtin",i)):a.push(new T("v_"+e,"out",i))}return new P(o,a,r,s)}static createFragment(e,t,i,n,r,s){const o=[],a=Array.from(r.rootOutputNodes());for(const t in e){const n=e[t],r=i.get(t);if(r){o.push(new w(r,"builtin",n));continue}const s=a.find((e=>e.node===n));s&&o.push(new w(s.outVariableName,"in",n))}for(const e of n){const t=e.uniformHydrated;o.push(new w(e.uniformName,"uniform",t))}const l=[];for(const e in t){const n=t[e],r=i.get(e);"discard"===e?l.push(new T(null,"discard",n)):r?l.push(new T(r,"builtin",n)):l.push(new T(e,"out",n))}return new P(o,l,s)}constructor(e,t,i,n){this.type="shader-graph-context",this.indent=0,this.body="",this.varCount=0,this._inputShaderTypesByNodeUid=new Map,this._nodeEmitMap=new Map;for(const t of e)this._inputShaderTypesByNodeUid.set(t.node.uid,t);this._outputShaderTypes=t,this._transformFeedbackBindings=i,this._transformFeedbackNames=new Set(i.map((e=>"v_"+e.propertyKey))),this._usedInFragmentShader=n}shouldPruneOutputNode(e){return!!this._usedInFragmentShader&&"builtin"!==e.outVariableType&&!this._transformFeedbackNames.has(e.outVariableName)&&!this._usedInFragmentShader.has(e.node.uid)}setEmit(e,t){this._nodeEmitMap.set(e.uid,t)}getEmit(e){return this._nodeEmitMap.get(e.uid)}inputs(){return this._inputShaderTypesByNodeUid.values()}getInput(e){return this._inputShaderTypesByNodeUid.get(e.uid)}*rootOutputNodes(){for(const e of this._outputShaderTypes)yield e}*nodes(){const e=[];for(const t of this._outputShaderTypes.values())e.push(t.node);for(;e.length;){const t=e.pop();"number"!=typeof t&&"boolean"!=typeof t&&e.push(...t.children.filter(Boolean)),yield t}}*nodesOfTypeOrFunction(){for(const e of this.nodes())"number"!=typeof e&&"boolean"!=typeof e&&(yield e)}createSubgraphContext(){const e=this.clone();return e.body="",e.indent=this.indent+2,e._nodeEmitMap=new Map(this._nodeEmitMap),e}clone(){const e=new P([],this._outputShaderTypes,this._transformFeedbackBindings,this._usedInFragmentShader);return e._inputShaderTypesByNodeUid=this._inputShaderTypesByNodeUid,e.indent=this.indent,e.body=this.body,e.varCount=this.varCount,e._nodeEmitMap=this._nodeEmitMap,e}insertVertexShader(e){e.vertex.code.add(""),this._insertInputs(e,"vertex"),e.vertex.code.add(""),e.vertex.code.add("// OUTPUTS: "),e.vertex.code.add("// --------------------------------------------------------- ");for(const t of this.rootOutputNodes()){const i="builtin"===t.outVariableType;this.shouldPruneOutputNode(t)||(i?e.vertex.code.add(`// ${t.outVariableType.padEnd(7)} ${t.node.type.padEnd(9)} ${t.outVariableName};`):e.vertex.code.add(`${t.outVariableType.padEnd(10)} ${t.node.type.padEnd(9)} ${t.outVariableName};`))}e.vertex.code.add(""),e.vertex.code.add("void main() {"),e.vertex.code.add("  "+this.body.split("\n").join("\n  "));for(const t of this.rootOutputNodes())this.shouldPruneOutputNode(t)||e.vertex.code.add(`  ${t.outVariableName} = ${t.variableName};`);e.vertex.code.add("}")}insertFragmentShader(e){this._insertInputs(e,"fragment"),e.fragment.code.add(""),e.fragment.code.add("// OUTPUTS: "),e.fragment.code.add("// --------------------------------------------------------- ");for(const t of this.rootOutputNodes())"builtin"===t.outVariableType?e.fragment.code.add(`// ${t.outVariableType.padEnd(7)} ${t.node.type.padEnd(9)} ${t.outVariableName};`):e.fragment.code.add(`${t.outVariableType.padEnd(10)} ${t.node.type.padEnd(9)} ${t.outVariableName};`);e.fragment.code.add(""),e.fragment.code.add("void main() {"),e.fragment.code.add("  "+this.body.split("\n").join("\n  "));for(const t of this.rootOutputNodes())"discard"===t.outVariableType?(e.fragment.code.add("  // TODO: Should ensure codegen for discard appears first in fragment shader"),e.fragment.code.add(`  if (${t.variableName}) {`),e.fragment.code.add("    discard;"),e.fragment.code.add("  }"),e.fragment.code.add("  ")):e.fragment.code.add(`  ${t.outVariableName} = ${t.variableName};`);e.fragment.code.add("}")}_insertInputs(e,t){e[t].code.add("// INPUTS: "),e[t].code.add("// --------------------------------------------------------- ");for(const i of this.inputs())i.isUsed&&"builtin"!==i.variableInputType&&("array"===i.node.type?e[t].code.add(`${i.variableInputType.padEnd(10)} ${i.node.elementType.type.padEnd(9)} ${i.variableName}[${i.node.size}];`):e[t].code.add(`${i.variableInputType.padEnd(10)} ${i.node.type.padEnd(9)} ${i.variableName};`))}}var I=i(22516);function M(e){return new e}function A(e,t,i){const n=e.constructor[t]??[];e.constructor.hasOwnProperty(t)||Object.defineProperty(e.constructor,t,{value:n.slice()}),e.constructor[t].push(i)}function C(e,t){return(i,n)=>{A(i,"locations",{typeCtor:t,propertyKey:n,parameterIndex:null,index:e})}}const E=e=>(t,i,n)=>{A(t,"inputs",{inputCtor:e,propertyKey:i,parameterIndex:n})},R=e=>(t,i)=>{A(t,"uniforms",{typeCtor:e,propertyKey:i})},O=e=>(t,i)=>{A(t,"options",{typeCtor:e,propertyKey:i})},z=(e,t)=>{A(e,"defines",{propertyKey:t})},F=(e,t)=>(i,n)=>{i.constructor.builtins.push({builtin:e,propertyKey:n,typeCtor:t})};class V{}V.builtins=[],(0,n._)([F("gl_VertexID",v.Ai)],V.prototype,"glVertexID",void 0);class L{}class D{}D.builtins=[],(0,n._)([F("gl_FragCoord",v.Zb)],D.prototype,"glFragCoord",void 0),(0,n._)([F("gl_PointCoord",v.ZY)],D.prototype,"glPointCoord",void 0);class N{}class k{constructor(){this.type="uniform-group"}get _uniforms(){return this.constructor.uniforms??[]}}class B{constructor(){this.logShader=!1,this.computeAttributes={}}get vertexInput(){const e=this._shaderModuleClass.inputs.findLast((e=>"vertex"===e.propertyKey&&0===e.parameterIndex));if(!e)throw new Error("Unable to find vertex input parameter");return e}get computeInput(){return this._shaderModuleClass.inputs.findLast((e=>"vertex"===e.propertyKey&&1===e.parameterIndex))}get fragmentInput(){const e=this._shaderModuleClass.inputs.findLast((e=>"fragment"===e.propertyKey));if(!e)throw new Error("Unable to find fragment input parameter");return e}get transformFeedbackBindings(){return this.fragmentInput.inputCtor.transformFeedbackBindings??[]}get locations(){return[...this.vertexInput.inputCtor.locations,...this.computeInput?.inputCtor.locations??[]]}get locationsMap(){const e=new Map,t=new Set;for(const i of this.locations)t.has(i.index)?r.A.getLogger("esri.views.2d.engine.webgl.shaderGraph.GraphShaderModule").warnOnce("mapview-rendering",`Unable to assigned attribute ${i.propertyKey} to ${i.index}. Index already in use`,{locationsMap:e}):(e.set(i.propertyKey,i.index),t.add(i.index));return e}get locationInfo(){if(!this._locationInfo){const e=this.locationsMap,t=Array.from(e.entries()).map((([e,t])=>`${e}.${t}`)).join("."),i=(0,s.Wm)(t),n=this.computeAttributes;this._locationInfo={hash:i,locations:e,computeAttributeMap:n}}return this._locationInfo}get renamedLocationsMap(){const e=new Map;for(const t of this.locations)e.set("a_"+t.propertyKey,t.index);return e}get optionPropertyKeys(){if(!this._optionPropertyKeys){const e=new Set;for(const t of this._options)e.add(t.propertyKey);this._optionPropertyKeys=e}return this._optionPropertyKeys}get _shaderModuleClass(){return this.constructor}get _defines(){return this._shaderModuleClass.defines??[]}get _options(){return this._shaderModuleClass.options??[]}get _uniforms(){return this._shaderModuleClass.uniforms??[]}getProgram(e,t,i,n){try{const{vertex:r,fragment:s,uniformBindings:o}=this._generateShaders(e,t,i,n);return new I.K(r,s,this.renamedLocationsMap,this.locationInfo,o,this.transformFeedbackBindings)}catch(e){return new I.K("","",this.renamedLocationsMap,this.locationInfo,[],this.transformFeedbackBindings)}}getDebugUniformClassInfo(e){const t=this._options.find((t=>t.propertyKey===e));if(t)return{type:"option",className:t.typeCtor};const i=this._uniforms.find((t=>t.propertyKey===e));if(!i)throw new Error(`Unable to find uniform class type for property: ${e}`);return{type:"required",className:i.typeCtor}}getShaderKey(e,t,i,n){const r=Object.keys(e).map((t=>`${t}.${e[t]}`)).join("."),s=Object.keys(i).map((e=>`${e}.${i[e]}`)).join("."),o=Object.keys(n).map((e=>`${e}.${n[e]}`)).join("."),a=Object.keys(t).filter((e=>this.optionPropertyKeys.has(e)&&t[e])).join(".");return`${this.constructor.name}.${r}.${s}.${o}.${a}`}_generateShaders(e,t,i,n){const r=[];this._setDefines(i),this._setOptionalUniforms(r,t),this._setRequiredUniforms(r);const s=this._hydrateVertexInput(n),o=this._injectPackPrecisionFactor(s,e),a=this._hydrateComputeInput(),l=a&&this._injectComputePackPrecisionFactor(a,e),u=this.vertex(o,l),c=this._hydrateFragmentInput(u),h=this.fragment(c),d=new Set;for(const e in h){const t=h[e];(0,S.rz)(d,t)}const f=this._getVertexInputBuiltins(),p=P.createVertex({...s,...a},u,f,r,this.transformFeedbackBindings,d);(new b).write(p);const m=this._getFragmentInputBuiltins(h);m.set("glPointCoord","gl_PointCoord");const _=P.createFragment(c,h,m,r,p,this.transformFeedbackBindings);(new b).write(_);const g=this._createShaderBuilder(p,_),y=g.generate("vertex",!0),v=g.generate("fragment",!0);return this.logShader&&(console.log(y),console.log(v)),{vertex:y,fragment:v,uniformBindings:r}}_setDefines(e){for(const t in e)this[t]=e[t]}_setOptionalUniforms(e,t){for(const i of this._options)t[i.propertyKey]?this[i.propertyKey]=this._hydrateUniformGroup(e,i):this[i.propertyKey]=null}_setRequiredUniforms(e){for(const t of this._uniforms)this[t.propertyKey]=this._hydrateUniformGroup(e,t)}_hydrateUniformGroup(e,t){const i=new(0,t.typeCtor);for(const n of i._uniforms??[]){const r=M(n.typeCtor),s=`u_${t.propertyKey}_${n.propertyKey}`,o=r.type,a=[t.propertyKey,n.propertyKey].join(".");if("type"in n.typeCtor&&"array"===n.typeCtor.type){const t=r;e.push({shaderModulePath:a,uniformName:s,uniformType:o,uniformArrayLength:t.size,uniformArrayElementType:t.elementType.type,uniformHydrated:r})}else e.push({shaderModulePath:a,uniformName:s,uniformType:o,uniformHydrated:r});i[n.propertyKey]=r}return i}_hydrateVertexInput(e){const t=this.vertexInput.inputCtor,i=t.locations.reduce(((t,i)=>!1===e[i.propertyKey]?t:{...t,[i.propertyKey]:M(i.typeCtor)}),{});for(const{propertyKey:e,typeCtor:n}of t.builtins){const t=M(n);i[e]=t}return i}_hydrateComputeInput(){return null==this.computeInput?null:this.computeInput.inputCtor.locations.reduce(((e,t)=>({...e,[t.propertyKey]:M(t.typeCtor)})),{})}_injectPackPrecisionFactor(e,t){const i={};for(const n in e){const r=e[n],s=t[n];if(s){if("float"!==r.type&&"vec2"!==r.type&&"vec3"!==r.type&&"vec4"!==r.type)throw new Error(`InternalError: packPrecisionFactor requires GenType, but found ${r.type}`);i[n]=r.divide(new v.nt(s))}else i[n]=r}return i}_injectComputePackPrecisionFactor(e,t){const i={},n=new Map;for(const e in this.computeAttributes)for(const t of this.computeAttributes[e]??[])n.set(t,e);for(const r in e){const s=e[r],o=n.get(r);if(!o)continue;const a=t[o];if(a){if("float"!==s.type&&"vec2"!==s.type&&"vec3"!==s.type&&"vec4"!==s.type)throw new Error(`InternalError: packPrecisionFactor requires GenType, but found ${s.type}`);i[r]=s.divide(new v.nt(a))}else i[r]=s}return i}_hydrateFragmentInput(e){const t={};for(const i in e)t[i]=e[i];for(const{propertyKey:e,typeCtor:i}of D.builtins){const n=M(i);t[e]=n}return t}_getVertexInputBuiltins(){const e=this.vertexInput.inputCtor,t=new Map;for(const{builtin:i,propertyKey:n}of e.builtins)t.set(n,i);return t}_getFragmentInputBuiltins(e){const t=e.constructor,i=new Map;for(const e of t.builtins??[])i.set(e.propertyKey,e.builtin);return i}_createShaderBuilder(e,t){const i=new c;return this._insertDebugInfo(i),e.insertVertexShader(i),t.insertFragmentShader(i),i}_insertDebugInfo(e){e.vertex.code.add("// DEFINES: "),e.vertex.code.add("// --------------------------------------------------------- ");for(const t of this._defines)this[t.propertyKey]?e.vertex.code.add(`//   ${t.propertyKey}: true`):e.vertex.code.add(`//   ${t.propertyKey}: false`);e.vertex.code.add(""),e.vertex.code.add("// OPTIONS: "),e.vertex.code.add("// --------------------------------------------------------- ");for(const t of this._options)this[t.propertyKey]?e.vertex.code.add(`//   ${t.propertyKey}: true`):e.vertex.code.add(`//   ${t.propertyKey}: false`)}}},44784:function(e,t,i){function n(e,t){const i=[];for(i.push(t);i.length;){const t=i.pop();if("object"==typeof t&&!e.has(t.uid)){e.add(t.uid);for(const e of t.children)i.push(e)}}}i.d(t,{XL:function(){return u},aw:function(){return h},rR:function(){return c},rz:function(){return n},vA:function(){return s},vL:function(){return o},zg:function(){return l}});class r{constructor(){this.uid=r.NodeCount++,this._debugName=null,this._isMutable=!1,this.isImplicit=!1}get isMutable(){return this._isMutable}setMutable(){return this._isMutable=!0,this}setDebugName(e){return e=e.split(" ").map(((e,t)=>t>0?e.charAt(0).toUpperCase()+e.slice(1):e)).join(""),this._debugName=e,this.isImplicit&&this.children[0]instanceof r&&this.children[0].setDebugName(e),this}get debugInfo(){return{name:this._debugName??""}}cloneInto(e){e._debugName=this._debugName,e._isMutable=this._isMutable,e.isImplicit=this.isImplicit,e.uid=this.uid}}function s(e){return"object"==typeof e?e.clone():e}r.NodeCount=0;class o extends r{constructor(){super(...arguments),this.shaderType="primitive-node"}}class a extends r{constructor(e){super(),this.child=e,this.shaderType="scope-node"}get children(){return[this.child]}clone(){const e=new a(s(this.child));return this.cloneInto(e),e}}class l extends r{constructor(e,t,i){super(),this.property=e,this.target=t,this.returnType=i,this.shaderType="property-access-node"}get children(){const e=[this.target];return"string"!=typeof this.property&&e.push(this.property),e}clone(){const e=new l(this.property,s(this.target),this.returnType);return this.cloneInto(e),e}}class u extends r{constructor(e,t,i){super(),this.condition=e,this.ifTrue=t,this.ifFalse=i,this.shaderType="condition-node"}get children(){return[this.condition,this.ifTrue,this.ifFalse]}clone(){const e=s(this.ifTrue),t=this.ifFalse?s(this.ifFalse):null,i=new u(this.condition,e,t);return this.cloneInto(i),i}}class c extends r{constructor(e,t,i,n){super(),this.captureList=e,this.returnType=t,this.generator=n,this.shaderType="block-node",i&&(this.subgraph=new a(i))}get children(){return Object.keys(this.captureList).map((e=>this.captureList[e])).concat(this.subgraph??[])}clone(){const e={};for(const t in this.captureList)e[t]=s(this.captureList[t]);const t=new c(e,this.returnType,this.subgraph?s(this.subgraph.child):this.subgraph,this.generator);return this.cloneInto(t),t}}class h extends r{constructor(e,t,i,n,r,s=!1){super(),this.token=e,this._children=t,this.isInfix=i,this.isPropertyAccess=n,this.returnType=r,this.isTernary=s,this.shaderType="function-node"}get children(){return this._children}clone(){const e=new h(this.token,this._children.map(s),this.isInfix,this.isPropertyAccess,this.returnType,this.isTernary);return this.cloneInto(e),e}}},70931:function(e,t,i){i.d(t,{$5:function(){return me},$I:function(){return H},AU:function(){return De},Ai:function(){return D},Bw:function(){return Re},F8:function(){return Be},Gb:function(){return ce},Io:function(){return Me},LC:function(){return fe},LI:function(){return ke},MM:function(){return _e},My:function(){return S},Ny:function(){return U},Om:function(){return Ae},PM:function(){return He},RI:function(){return Ce},RZ:function(){return Ge},S8:function(){return Le},Sj:function(){return he},T9:function(){return Oe},TF:function(){return Ue},Tk:function(){return re},U:function(){return G},US:function(){return Ye},Uo:function(){return ve},Wh:function(){return Z},Xe:function(){return pe},ZY:function(){return P},Zb:function(){return M},Zc:function(){return $},aX:function(){return ge},eB:function(){return I},eR:function(){return W},fV:function(){return q},gn:function(){return Ie},j1:function(){return se},jc:function(){return Ee},jh:function(){return Fe},jk:function(){return ze},ln:function(){return j},lw:function(){return oe},mk:function(){return Te},n7:function(){return Ne},nf:function(){return de},nt:function(){return T},om:function(){return ne},or:function(){return ye},qE:function(){return Pe},rY:function(){return we},tn:function(){return xe},w0:function(){return X},x:function(){return O},z7:function(){return w},ze:function(){return ie},zi:function(){return Ve}});var n,r,s,o,a,l,u,c,h,d,f,p,m,_,g=i(53804),y=i(44784);function v(e){return new Proxy(e,{get(t,i){if("constructor"===i)return new Proxy(t.constructor,{construct:(e,t,i)=>v(new e(...t))});if(i in t)return t[i];if("string"==typeof i){const t=function(e){const t=[["float","vec2","vec3","vec4"],["int","ivec2","ivec3","ivec4"],["uint","uvec2","uvec3","uvec4"],["bool","bvec2","bvec3","bvec4"]];for(const i of t)if(i.includes(e))return i.map((e=>Y[e]));throw new Error("Unable to find type family")}(e.type);return K(e,i,t[i.length-1])}}})}function x(e){return new Proxy(e,{construct:(e,t,i)=>v(new e(...t))})}class b extends Error{}let S=n=class extends y.vL{constructor(e,t){super(),this.elementType=e,this.size=t,this.children=[],this.type="array"}clone(){const e=new n(this.elementType,this.size);return super.cloneInto(e),e}get(e){if("number"==typeof e){const t=new D(e);return t.isImplicit=!0,K(this,t,this.elementType.constructor)}return K(this,e,this.elementType.constructor)}last(){return this.get(this.size-1)}first(){return this.get(0)}findIndex(e,t,i){return function(e,t,i=0,n=e.size){const r=new D(i).setMutable().setDebugName("FindIndexIterator"),s=t(e.get(r)).setDebugName("FindIndexPredicate"),o=ne({iter:r},D,s,(({out:e,iter:t,subgraph:i})=>`\n${e} = -1;\n\nfor (; ${t} < ${n}; ${t}++) {\n\n${i.body}\n\n  if (${i.varName}) {\n    ${e} = ${t};\n    break;\n  }\n\n}\n`)).setDebugName("FindIndexBlock");return o}(this,e,t,i)}glslFindIndex(e,t,i){return function(e,t,i=0,n=e.size){const r=ne({array:e},D,null,(({out:e,array:r})=>`\n${e} = -1;\nfor (int i = ${i}; i < ${n}; i++) {\n  bool condition;\n  ${t({array:r,i:"i",out:"condition"})}\n  if (condition) {\n    ${e} = i;\n    break;\n  }\n}\n`)).setDebugName("GlslFindIndexBlock");return r}(this,e,t,i)}static ofType(e,t){const i={construct:(i,r)=>new n(new e,t)};return new Proxy(n,i)}};S.type="array",S=n=(0,g._)([function(e){return new Proxy(e,{construct:(e,t,i)=>function(e){return new Proxy(e,{get(t,i){if(i in t)return t[i];if("string"==typeof i){const t=parseInt(i,10);if(!isNaN(t))return K(e,`[${t}]`,e.elementType.constructor)}}})}(new e(...t))})}],S);class w extends y.vL{constructor(){super(...arguments),this.type="sampler2D",this.children=[]}clone(){const e=new w;return e.children=this.children.map(y.vA),super.cloneInto(e),e}}w.type="sampler2D";class T extends y.vL{constructor(e){super(),this.type="float",this.children=[e]}clone(){const e=new T((0,y.vA)(this.children[0]));return super.cloneInto(e),e}multiply(e){return oe(this,"number"==typeof e?V(e,T):e)}divide(e){return ae(this,"number"==typeof e?V(e,T):e)}add(e){return le(this,"number"==typeof e?V(e,T):e)}subtract(e){return ue(this,"number"==typeof e?V(e,T):e)}}T.type="float";let P=r=class extends y.vL{constructor(e,t){super(),this.type="vec2",this.children=[e,t].filter((e=>null!=e))}clone(){const e=new r((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]));return super.cloneInto(e),e}get 0(){return K(this,"[0]",T)}get 1(){return K(this,"[1]",T)}get 2(){throw new b}get 3(){throw new b}multiply(e){return oe(this,"number"==typeof e?V(e,T):e)}divide(e){return ae(this,"number"==typeof e?V(e,T):e)}add(e){return le(this,"number"==typeof e?V(e,T):e)}subtract(e){return ue(this,"number"==typeof e?V(e,T):e)}};P.type="vec2",P=r=(0,g._)([x],P);let I=s=class extends y.vL{constructor(e,t,i){super(),this.type="vec3",this.children=[e,t,i].filter((e=>null!=e))}get 0(){return K(this,"[0]",T)}get 1(){return K(this,"[1]",T)}get 2(){return K(this,"[2]",T)}get 3(){throw new b}clone(){const e=new s((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]));return super.cloneInto(e),e}multiply(e){return oe(this,"number"==typeof e?V(e,T):e)}divide(e){return ae(this,"number"==typeof e?V(e,T):e)}add(e){return le(this,"number"==typeof e?V(e,T):e)}subtract(e){return ue(this,"number"==typeof e?V(e,T):e)}};I.type="vec3",I=s=(0,g._)([x],I);let M=o=class extends y.vL{constructor(e,t,i,n){super(),this.type="vec4",this.children=[e,t,i,n].filter((e=>null!=e))}clone(){const e=new o((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]),(0,y.vA)(this.children[3]));return super.cloneInto(e),e}get 0(){return K(this,"[0]",T)}get 1(){return K(this,"[1]",T)}get 2(){return K(this,"[2]",T)}get 3(){return K(this,"[3]",T)}multiply(e){return oe(this,"number"==typeof e?V(e,T):e)}divide(e){return ae(this,"number"==typeof e?V(e,T):e)}add(e){return le(this,"number"==typeof e?V(e,T):e)}subtract(e){return ue(this,"number"==typeof e?V(e,T):e)}};M.type="vec4",M=o=(0,g._)([x],M);let A=a=class extends y.vL{constructor(e){super(),this.type="uint",this.children=[e]}clone(){const e=new a((0,y.vA)(this.children[0]));return super.cloneInto(e),e}};A.type="uint",A=a=(0,g._)([x],A);let C=l=class extends y.vL{constructor(e,t){super(),this.type="uvec2",this.children=[e,t].filter((e=>null!=e))}clone(){const e=new l((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]));return super.cloneInto(e),e}};C.type="uvec2",C=l=(0,g._)([x],C);let E=u=class extends y.vL{constructor(e,t,i){super(),this.type="uvec3",this.children=[e,t,i].filter((e=>null!=e))}clone(){const e=new u((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]));return super.cloneInto(e),e}};E.type="uvec3",E=u=(0,g._)([x],E);let R=c=class extends y.vL{constructor(e,t,i,n){super(),this.type="uvec4",this.children=[e,t,i,n].filter((e=>null!=e))}clone(){const e=new c((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]),(0,y.vA)(this.children[3]));return super.cloneInto(e),e}};R.type="uvec4",R=c=(0,g._)([x],R);class O extends y.vL{constructor(e){super(),this.type="bool",this.children=[e]}and(e){return ve(this,e)}or(e){return ye(this,e)}clone(){const e=new O((0,y.vA)(this.children[0]));return super.cloneInto(e),e}}O.type="bool";let z=h=class extends y.vL{constructor(e,t){super(),this.type="bvec2",this.children=[e,t].filter((e=>null!=e))}all(){return be(this)}any(){return Se(this)}clone(){const e=new h((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]));return super.cloneInto(e),e}};z.type="bvec2",z=h=(0,g._)([x],z);let F=d=class extends y.vL{constructor(e,t,i){super(),this.type="bvec3",this.children=[e,t,i].filter((e=>null!=e))}all(){return be(this)}any(){return Se(this)}clone(){const e=new d((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]));return super.cloneInto(e),e}};function V(e,t){return"number"==typeof e?new t(e):e}F.type="bvec3",F=d=(0,g._)([x],F);let L=f=class extends y.vL{constructor(e,t,i,n){super(),this.type="bvec4",this.children=[e,t,i,n].filter((e=>null!=e))}all(){return be(this)}any(){return Se(this)}clone(){const e=new f((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]),(0,y.vA)(this.children[3]));return super.cloneInto(e),e}};L.type="bvec4",L=f=(0,g._)([x],L);class D extends y.vL{constructor(e){super(),this.type="int",this.children=[e]}multiply(e){return oe(this,V(e,D))}add(e){return le(this,V(e,D))}subtract(e){return ue(this,V(e,D))}divide(e){return ae(this,V(e,D))}clone(){const e=new D((0,y.vA)(this.children[0]));return super.cloneInto(e),e}}D.type="int";let N=p=class extends y.vL{constructor(e,t){super(),this.type="ivec2",this.children=[e,t].filter((e=>null!=e))}clone(){const e=new p((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]));return super.cloneInto(e),e}};N.type="ivec2",N=p=(0,g._)([x],N);let k=m=class extends y.vL{constructor(e,t,i){super(),this.type="ivec3",this.children=[e,t,i].filter((e=>null!=e))}clone(){const e=new m((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]));return super.cloneInto(e),e}};k.type="ivec3",k=m=(0,g._)([x],k);let B=_=class extends y.vL{constructor(e,t,i,n){super(),this.type="ivec4",this.children=[e,t,i,n].filter((e=>null!=e))}clone(){const e=new _((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]),(0,y.vA)(this.children[3]));return super.cloneInto(e),e}};B.type="ivec4",B=_=(0,g._)([x],B);class U extends y.vL{constructor(e,t,i,n){super(),this.type="mat2",this.children=[e,t,i,n]}clone(){const e=new U((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]),(0,y.vA)(this.children[3]));return super.cloneInto(e),e}multiply(e){return oe(this,e)}}U.type="mat2";class G extends y.vL{static identity(){return new G(1,0,0,0,1,0,0,0,1)}static fromRotation(e){const t=Be(e),i=Ie(e);return new G(i,t,0,ie(t),i,0,0,0,1)}constructor(e,t,i,n,r,s,o,a,l){super(),this.type="mat3",this.children=[e,t,i,n,r,s,o,a,l]}add(e){return le(this,e)}multiply(e){return oe(this,e)}clone(){const e=new G((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]),(0,y.vA)(this.children[3]),(0,y.vA)(this.children[4]),(0,y.vA)(this.children[5]),(0,y.vA)(this.children[6]),(0,y.vA)(this.children[7]),(0,y.vA)(this.children[8]));return super.cloneInto(e),e}}G.type="mat3";class H extends y.vL{static identity(){return new H(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}constructor(e,t,i,n,r,s,o,a,l,u,c,h,d,f,p,m){super(),this.type="mat4",this.children=[e,t,i,n,r,s,o,a,l,u,c,h,d,f,p,m]}static fromColumns(e,t,i,n){return new H(e.x,e.y,e.z,e.w,t.x,t.y,t.z,t.w,i.x,i.y,i.z,i.w,n.x,n.y,n.z,n.w)}multiply(e){return oe(this,e)}clone(){const e=new H((0,y.vA)(this.children[0]),(0,y.vA)(this.children[1]),(0,y.vA)(this.children[2]),(0,y.vA)(this.children[3]),(0,y.vA)(this.children[4]),(0,y.vA)(this.children[5]),(0,y.vA)(this.children[6]),(0,y.vA)(this.children[7]),(0,y.vA)(this.children[8]),(0,y.vA)(this.children[9]),(0,y.vA)(this.children[10]),(0,y.vA)(this.children[11]),(0,y.vA)(this.children[12]),(0,y.vA)(this.children[13]),(0,y.vA)(this.children[14]),(0,y.vA)(this.children[15]));return super.cloneInto(e),e}}H.type="mat4";const Y={float:T,vec2:P,vec3:I,vec4:M,int:D,ivec2:N,ivec3:k,ivec4:B,uint:A,uvec2:C,uvec3:E,uvec4:R,bool:O,bvec2:z,bvec3:F,bvec4:L},Z=(...e)=>new D(...e),q=(...e)=>new T(...e),$=(...e)=>new P(...e),W=(...e)=>new I(...e),j=(...e)=>new M(...e),X=(...e)=>new G(...e);function K(e,t,i){const n=new i(new y.zg(t,e,i));return n.isImplicit=!0,n}function Q(e,t,i,n=null){if(n){const r=new n,s=new n(new y.aw(e,[t,i],!0,!1,r));return s.isImplicit=!0,s}if("float"===t.type||"int"===t.type){const n=new i.constructor(new y.aw(e,[t,i],!0,!1,i.constructor));return n.isImplicit=!0,n}if(("mat2"===t.type||"mat3"===t.type||"mat4"===t.type)&&"float"!==i.type){const n=new i.constructor(new y.aw(e,[t,i],!0,!1,i.constructor));return n.isImplicit=!0,n}const r=new t.constructor(new y.aw(e,[t,i],!0,!1,t.constructor));return r.isImplicit=!0,r}function J(e,t,i=t.constructor){const n=new i(new y.aw(e,[t],!1,!1,i));return n.isImplicit=!0,n}function ee(e,t,i,n=t.constructor){const r=new n(new y.aw(e,[t,i],!1,!1,n));return r.isImplicit=!0,r}function te(e,t,i,n,r=t.constructor){const s=new r(new y.aw(e,[t,i,n],!1,!1,r));return s.isImplicit=!0,s}function ie(e){return oe(e,q(-1))}function ne(e,t,i,n){return new t(new y.rR(e,t,i,n))}function re(e,t,i){const n="function"==typeof t?t():t,r="function"==typeof i?i():i,s=new n.constructor(new y.XL(e,n,r));return s.isImplicit=!0,s}function se(...e){const t=e.map((([e,t])=>"function"==typeof t?[e,t()]:[e,t])),i=t[0][1].constructor,n=t.findIndex((e=>!0===e[0]));if(-1===n)throw new Error("A cond must have a fallthrough case with `true`/; ");const r=t.slice(0,n),s=t[n][1],o=new i(r.reduceRight(((e,t)=>re(t[0],t[1],e)),s));return o.isImplicit=!0,o}function oe(e,t){return Q("*",e,t)}function ae(e,t){return Q("/",e,t)}function le(e,t){return Q("+",e,t)}function ue(e,t){return Q("-",e,t)}function ce(e,t){return Q("%",e,t)}function he(e,t){return Q(">>",e,t)}function de(e,t){return Q("&",e,t)}function fe(e,t){return Q("==",e,t,O)}function pe(e,t){return Q("<",e,t,O)}function me(e,t){return Q("<=",e,t,O)}function _e(e,t){return Q(">",e,t,O)}function ge(e,t){return Q(">=",e,t,O)}function ye(...e){return e.length<=1?e[0]:e.slice(1).reduce(((e,t)=>function(e,t){return Q("||",e,t,O)}(e,t)),e[0])}function ve(...e){return e.length<=1?e[0]:e.slice(1).reduce(((e,t)=>function(e,t){return Q("&&",e,t,O)}(e,t)),e[0])}function xe(e){return J("abs",e)}function be(e){return J("all",e,O)}function Se(e){return J("any",e,O)}function we(e,t){return null==t?J("atan",e):ee("atan",e,t,e.constructor)}function Te(e){return J("ceil",e)}function Pe(e,t,i){return te("clamp",e,t,i,e.constructor)}function Ie(e){return J("cos",e)}function Me(e,t){return ee("distance",e,t,T)}function Ae(e,t){return ee("dot",e,t,T)}function Ce(e){return J("floor",e)}function Ee(e){return J("fract",e)}function Re(e){return J("length",e,T)}function Oe(e,t){return ee("max",e,t)}function ze(e,t){return ee("min",e,t)}function Fe(e,t,i){return te("mix",e,t,i)}function Ve(e,t){return ee("mod",e,t)}function Le(e){return J("normalize",e)}function De(e){return"bool"===e.type?J("!",e):J("not",e)}function Ne(e,t){return ee("pow",e,t)}function ke(e){return J("round",e)}function Be(e){return J("sin",e)}function Ue(e,t,i){return te("smoothstep",e,t,i)}function Ge(e){return J("sqrt",e)}function He(e,t){return ee("step",e,t,t.constructor)}function Ye(e,t){return ee("texture",e,t,M)}},53400:function(e,t,i){i.d(t,{j:function(){return r}});var n=i(28230);class r{constructor(){this.drawPhase=n.S5.MAP|n.S5.HITTEST|n.S5.HIGHLIGHT|n.S5.DEBUG}startup(){}shutdown(e){}}},92543:function(e,t,i){i.d(t,{c:function(){return r}});var n=i(86329);class r{constructor(e,t,i){this._instanceId=e,this.techniqueRef=t,this._input=i}get instanceId(){return(0,n.P)(this._instanceId)}createMeshInfo(e){return{id:(0,n.P)(this._instanceId),techniqueType:this.techniqueRef.type,inputParams:e,optionalAttributes:this._input.optionalAttributes}}getInput(){return this._input}setInput(e){this._input=e}}},63812:function(e,t,i){i.d(t,{YS:function(){return lt},n_:function(){return ct},Wn:function(){return ut}});var n=i(81728),r=i(53804),s=i(3247),o=i(98282),a=i(70931),l=i(99121);class u extends o.k2{}(0,r._)([(0,o.Pi)(a.nt)],u.prototype,"globalTime",void 0),(0,r._)([(0,o.Pi)(a.ZY)],u.prototype,"animationTextureSize",void 0),(0,r._)([(0,o.Pi)(a.z7)],u.prototype,"animationTexture",void 0),(0,r._)([(0,o.Pi)(a.U)],u.prototype,"toScreen",void 0),(0,r._)([(0,o.Pi)(a.U)],u.prototype,"toNdc",void 0),(0,r._)([(0,o.Pi)(a.nt)],u.prototype,"mapRotation",void 0),(0,r._)([(0,o.Pi)(a.nt)],u.prototype,"pixelRatio",void 0);var c=i(33702),h=i(40846),d=i(39979),f=i(86486),p=i(81432),m=i(12026);class _ extends o.k2{getVVRotationMat4(e){return(0,a.Tk)((0,f.M8)(e),a.$I.identity(),(()=>{const t=this.getNormalizedAngle(e).multiply(h.os),i=(0,a.F8)(t),n=(0,a.gn)(t);return new a.$I(n,i,0,0,i.multiply(new a.nt(-1)),n,0,0,0,0,1,0,0,0,0,1)}))}getVVRotationMat3(e){return(0,a.Tk)((0,f.M8)(e),a.U.identity(),(()=>{const t=this.getNormalizedAngle(e).multiply(h.os),i=(0,a.F8)(t),n=(0,a.gn)(t);return new a.U(n,i,0,i.multiply(new a.nt(-1)),n,0,0,0,1)}))}getNormalizedAngle(e){const t=(0,a.LC)(this.rotationType,new a.nt(h.H_.Arithmatic));return(0,a.Tk)(t,new a.nt(90).subtract(e),e)}}(0,r._)([(0,o.Pi)(a.nt)],_.prototype,"rotationType",void 0);var g,y=i(13635),v=i(21385),x=i(21813),b=i(76347),S=i(90906);class w extends c.rz{}(0,r._)([(0,o.C5)(3,a.Zb)],w.prototype,"animationPointerAndBaseSizeAndReferenceSize",void 0),(0,r._)([(0,o.C5)(4,a.ZY)],w.prototype,"zoomRange",void 0);class T extends c.DM{}class P extends c.f_{_getScreenPosition(e){const{pos:t,translation:i,rotation:n,scale:r,offset:s,id:o,vvScale:l}=e,u=(0,S.g_)(this,o).multiply(Math.PI/180),c=i.x.multiply(4/3),h=i.y.multiply(-1).multiply(4/3),d=(0,a.F8)(n.subtract(u)),f=(0,a.gn)(n.subtract(u)),p=new a.nt(0),m=new a.nt(1),{pixelRatio:_}=this.animationInfo,g=new a.U(m,p,p,p,m,p,c.multiply(_),h.multiply(_),m),y=new a.U(f,d.multiply(-1),p,d,f,p,0,0,m),v=r.multiply(l).multiply(_).multiply(4/3),x=y.multiply(v),b=this.animationInfo.toScreen.multiply(new a.eB(t,1)),w=g.multiply(b).xy,T=x.multiply(new a.eB(s,0)).xy;return w.add(T)}_clip(e,t){let i=super.clip(e,t);const n=(0,a.$5)(this._getLocalTimeOrigin(e),new a.nt(0));return s.H.forceGlobalTimeOrigin||(i=i.add((0,a.j1)([n,()=>new a.nt(2)],[!0,()=>new a.nt(0)]))),i}_getLocalTimeOrigin(e){return this.storage.getLocalTimeOrigin(e)}_toNdc(e){return this.animationInfo.toNdc.multiply(new a.eB(e,1)).xy}_getEvalParams(e,t){const{globalTime:i,animationTextureSize:n,animationTexture:r}=this.animationInfo;return{globalTime:i,localTimeOrigin:this._getLocalTimeOrigin(e.id),animationTextureSize:n,animationTexture:r,pixelDimensions:t}}_getColor(e,t){return(0,a.Tk)((0,a.LC)(t.isSDF,new a.nt(1)),this._getSDFColor(e,t),this._getSpriteColor(e,t))}_getSpriteColor(e,t){return(0,a.US)(this.mosaicInfo.texture,e).multiply(t.color)}_getSDFColor(e,t){const i=(0,a.US)(this.mosaicInfo.texture,e),n=new a.nt(.5).subtract((0,f.Rj)(i)).multiply(t.distanceToPx).multiply(h.V5),r=(0,a.qE)(new a.nt(.5).subtract(n),new a.nt(0),new a.nt(1)),s=t.color.multiply(r),o=t.outlineSize.multiply(.5),l=(0,a.tn)(n).subtract(o),u=(0,a.qE)(new a.nt(.5).subtract(l),new a.nt(0),new a.nt(1)),c=t.outlineColor.multiply(u);return new a.nt(1).subtract(c.a).multiply(s).add(c)}}function I(e,t,i){const n=e.add(new a.ZY(t,0)),r=(0,a.US)(i.animationTexture,n.add(.5).divide(i.animationTextureSize)).xy;return e=e.add(r),(0,a.om)({animationPointer:e,...i},a.Zb,null,(e=>{const{out:t}=e;if(!t)throw new Error("out is null");return(0,l.DW)({...e,out:t})}))}(0,r._)([(0,o.Pi)(d.b)],P.prototype,"mosaicInfo",void 0),(0,r._)([(0,o.Pi)(u)],P.prototype,"animationInfo",void 0),(0,r._)([(0,o.uK)(p._)],P.prototype,"visualVariableColor",void 0),(0,r._)([(0,o.uK)(m.i)],P.prototype,"visualVariableOpacity",void 0),(0,r._)([(0,o.uK)(y.n)],P.prototype,"visualVariableSizeMinMaxValue",void 0),(0,r._)([(0,o.uK)(v.F)],P.prototype,"visualVariableSizeScaleStops",void 0),(0,r._)([(0,o.uK)(x.N)],P.prototype,"visualVariableSizeStops",void 0),(0,r._)([(0,o.uK)(b.d)],P.prototype,"visualVariableSizeUnitValue",void 0),(0,r._)([(0,o.uK)(_)],P.prototype,"visualVariableRotation",void 0),function(e){e[e.transform=0]="transform",e[e.fromColor=1]="fromColor",e[e.toColor=2]="toColor",e[e.colorMix=3]="colorMix",e[e.toOpacity=4]="toOpacity",e[e.opacityMix=5]="opacityMix"}(g||(g={}));var M=i(97473),A=i(66425);class C extends w{}(0,r._)([(0,o.C5)(5,a.ZY)],C.prototype,"offset",void 0),(0,r._)([(0,o.C5)(6,a.ZY)],C.prototype,"uv",void 0),(0,r._)([(0,o.C5)(7,a.Zb)],C.prototype,"sizing",void 0),(0,r._)([(0,o.C5)(8,a.nt)],C.prototype,"angle",void 0);class E extends o.Y7{}function R(e,t,i,n){return t.multiply(e.x).add(i.multiply(e.y)).add(n.multiply(e.z))}(0,r._)([(0,o.C5)(12,a.ZY)],E.prototype,"offsetNextVertex1",void 0),(0,r._)([(0,o.C5)(13,a.ZY)],E.prototype,"offsetNextVertex2",void 0),(0,r._)([(0,o.C5)(14,a.ZY)],E.prototype,"textureUVNextVertex1",void 0),(0,r._)([(0,o.C5)(15,a.ZY)],E.prototype,"textureUVNextVertex2",void 0);class O extends P{constructor(){super(...arguments),this.computeAttributes={offset:["offsetNextVertex1","offsetNextVertex2"],uv:["textureUVNextVertex1","textureUVNextVertex2"]}}_vertexPreamble(e){const{id:t,pos:i,offset:n,animationPointerAndBaseSizeAndReferenceSize:r,uv:s,sizing:o,angle:l}=e,u=r.xy,c=r.z,d=r.w,p=o.xy,m=o.z,_=(0,f.mh)(e.bitset,M.c.bitset.isStroke),y=o.w,v=(0,f.mh)(e.bitset,M.c.bitset.scaleSymbolsProportionally),x=this._getEvalParams(e,p),b=I(u,g.transform,x),w=(0,a.j1)([(0,a.LC)((0,f.mh)(e.bitset,M.c.bitset.isMapAligned),new a.nt(1)),this.view.rotation.divide(180).multiply(Math.PI)],[!0,new a.nt(0)]),T=new a.Ny((0,a.gn)(w),(0,a.F8)(w.multiply(-1)),(0,a.F8)(w),(0,a.gn)(w)).multiply(b.xy),P=b.z.subtract(w).subtract(l.multiply(h.rp)),A=b.w,C=(0,f.mh)(e.bitset,M.c.bitset.isSDF),E=(0,S.Mg)(this,t,new a.nt(d)).divide(new a.nt(d));return{baseSize:c,animationPointer:u,strokeWidth:m,isOutline:_,unscaledDistanceToPx:y,scaleSymbolsProportionally:v,isSDF:C,position:this._getScreenPosition({id:t,pos:i,offset:n,referenceSize:d,translation:T,rotation:P,scale:A,vvScale:E}),uv:s,evalParams:x,vvScale:E,scale:A}}vertex(e,t){const{position:i,animationPointer:n,evalParams:r,isOutline:s,unscaledDistanceToPx:o,vvScale:l,uv:u,strokeWidth:c,scaleSymbolsProportionally:h,scale:d,isSDF:p,baseSize:m}=this._vertexPreamble(e),_=this._toNdc(i);let y=I(n,g.fromColor,r);y=new a.Zb(y.rgb.multiply(y.a),y.a);let v=I(n,g.toColor,r);v=new a.Zb(v.rgb.multiply(v.a),v.a);let x=I(n,g.colorMix,r);x=new a.Zb(x.rgb.multiply(x.a),x.a);const b=I(n,g.toOpacity,r).a,w=I(n,g.opacityMix,r).a,T=(0,S.G7)(this,e.id,y,(0,a.or)((0,f.K5)(e.bitset,M.c.bitset.colorLocked),new a.x(s))),P=(0,a.jh)(T,v,x),A=(0,S.cF)(this,e.id),C=(0,a.jh)(A,b,w),E=P.multiply(C),R=this.clip(e.id,e.zoomRange),O=o.multiply(l);return{glPosition:new a.Zb(_,R,1),uv:u.divide(this.mosaicInfo.size),color:E.multiply(new a.nt(1).subtract(s)),outlineColor:E.multiply(s),distanceToPx:O,strokeWidth:c.multiply((0,a.jh)(new a.nt(1),d,h)),isOutline:s,isSDF:p,...this.maybeRunHittest(e,t,{pos:e.pos,size:m,sizeCorrection:new a.nt(1),isMapAligned:new a.nt(1),vvRotationMat3:new a.U(1,0,0,0,1,0,0,0,1),placementMat3:new a.U(1,0,0,0,1,0,0,0,1),outlineSize:new a.nt(1),distanceToPx:O,isSDF:p})}}fragment(e){let t=this._getColor(e.uv,{color:e.color,distanceToPx:e.distanceToPx,isSDF:e.isSDF,outlineColor:e.outlineColor,outlineSize:e.strokeWidth});return s.H.spotlightAnimatedSymbols&&(t=t.add(new a.Zb(0,.3,0,.3))),this.getFragmentOutput(t,e)}hittest(e,t,i){return(0,a.Tk)((0,a.Xe)(i.size,this.hittestRequest.smallSymbolSizeThreshold),this._hittestSmallMarker(e,t,i),this._hittestMarker(e,t,i))}_hittestSmallMarker(e,t,i){const{position:n,distance:r,smallSymbolDistance:s}=this.hittestRequest,o=r.subtract(s),{viewMat3:l,tileMat3:u}=this.view,c=l.multiply(u).multiply(new a.eB(i.pos,1)).xy,h=i.size.multiply(.5);return(0,a.Io)(c,n).subtract(h).add(o)}_hittestMarker(e,t,i){const n=this._vertexPreamble({...e}).position,r=this._vertexPreamble({...e,offset:t.offsetNextVertex1,uv:t.textureUVNextVertex1}).position,s=this._vertexPreamble({...e,offset:t.offsetNextVertex2,uv:t.textureUVNextVertex2}).position,o=this.hittestRequest.position,l=this.hittestRequest.distance,u=(0,A.Bo)(o,n,r,s);return(0,a.Tk)((0,a.MM)(u,l),u,this._hittestSamples(n,r,s,e,t,i))}_hittestSamples(e,t,i,n,r,s){const{outlineSize:o,isSDF:l,distanceToPx:u}=s,c=this.hittestRequest.position,h=this.hittestRequest.distance,d=(0,A.Bs)(c.add(new a.ZY((0,a.ze)(h),(0,a.ze)(h))),e,t,i),f=(0,A.Bs)(c.add(new a.ZY(0,(0,a.ze)(h))),e,t,i),p=(0,A.Bs)(c.add(new a.ZY(h,(0,a.ze)(h))),e,t,i),m=(0,A.Bs)(c.add(new a.ZY((0,a.ze)(h),0)),e,t,i),_=(0,A.Bs)(c,e,t,i),g=(0,A.Bs)(c.add(new a.ZY(h,0)),e,t,i),y=(0,A.Bs)(c.add(new a.ZY((0,a.ze)(h),h)),e,t,i),v=(0,A.Bs)(c.add(new a.ZY(0,h)),e,t,i),x=(0,A.Bs)(c.add(new a.ZY(h,h)),e,t,i),b=n.uv.divide(this.mosaicInfo.size),S=r.textureUVNextVertex1.divide(this.mosaicInfo.size),w=r.textureUVNextVertex2.divide(this.mosaicInfo.size),T={color:new a.Zb(1,1,1,1),outlineSize:o,outlineColor:new a.Zb(1,1,1,1),isSDF:l,distanceToPx:u};let P=new a.nt(0);return P=P.add((0,A.kW)(d).multiply(this._getColor(R(d,b,S,w),T).a)),P=P.add((0,A.kW)(f).multiply(this._getColor(R(f,b,S,w),T).a)),P=P.add((0,A.kW)(p).multiply(this._getColor(R(p,b,S,w),T).a)),P=P.add((0,A.kW)(m).multiply(this._getColor(R(m,b,S,w),T).a)),P=P.add((0,A.kW)(_).multiply(this._getColor(R(_,b,S,w),T).a)),P=P.add((0,A.kW)(g).multiply(this._getColor(R(g,b,S,w),T).a)),P=P.add((0,A.kW)(y).multiply(this._getColor(R(y,b,S,w),T).a)),P=P.add((0,A.kW)(v).multiply(this._getColor(R(v,b,S,w),T).a)),P=P.add((0,A.kW)(x).multiply(this._getColor(R(x,b,S,w),T).a)),(0,a.PM)(P,new a.nt(.05)).multiply((0,A.My)(this.hittestRequest))}}(0,r._)([(0,r.a)(0,(0,o.hF)(C)),(0,r.a)(1,(0,o.hF)(E))],O.prototype,"vertex",null),(0,r._)([(0,r.a)(0,(0,o.hF)(class extends T{}))],O.prototype,"fragment",null);var z=i(44705),F=i(25090),V=i(28230),L=i(53400);class D extends L.j{constructor(){super(...arguments),this.symbologyPlane=V.uC.FILL,this._input=null}}var N=i(86847);class k extends D{render(e,t){const{context:i,painter:n}=e,{target:r}=t,{freezeGlobalTime:o}=s.H,a=n.textureManager.animationStore.getTexture(i,0),l=[2/e.state.size[0],0,0,0,-2/e.state.size[1],0,-1,1,1],u=Array.from((0,z.B8)((0,F.vt)(),l)),c=Array.from((0,z.lw)((0,F.vt)(),u,r.transforms.displayViewScreenMat3)),h=t.instance.getInput();n.setShader({shader:this.shaders.geometry,uniforms:{...(0,N.r3)(e,t.target,h.uniforms),...(0,N.QA)(e,t.target),mosaicInfo:n.textureManager.getMosaicInfo(i,t.textureKey,!0),animationInfo:{globalTime:!1===o?e.time/1e3:o,animationTextureSize:[a.descriptor.width,a.descriptor.height],animationTexture:{unit:6,texture:a},toScreen:c,toNdc:l,mapRotation:e.state.rotation,pixelRatio:e.state.pixelRatio}},defines:{...(0,N.vT)(e)},optionalAttributes:{zoomRange:!0},useComputeBuffer:!0}),n.setPipelineState({...(0,N.Qu)(e)}),n.submitDraw(e,t),!1===o&&r.requestRender()}}var B=i(39686),U=i(97673),G=i(64522);class H extends o.ZA{}(0,r._)([(0,o.C5)(0,a.ZY)],H.prototype,"pos",void 0);class Y extends c.DM{}class Z extends o.k2{}(0,r._)([(0,o.Pi)(a.nt)],Z.prototype,"dotSize",void 0);class q extends o.k2{}(0,r._)([(0,o.Pi)(a.z7)],q.prototype,"locations",void 0),(0,r._)([(0,o.Pi)(a.nt)],q.prototype,"pixelRatio",void 0),(0,r._)([(0,o.Pi)(a.nt)],q.prototype,"tileZoomFactor",void 0);class $ extends o.A{vertex(e){const t=new a.U(1,0,0,0,-1,0,0,1,1).multiply(new a.eB(e.pos.xy.divide(B.CQ),1)),i=(0,a.US)(this.draw.locations,t.xy),n=(0,a.T9)(this.instance.dotSize.divide(2),new a.nt(1));let r=new a.nt(0);r=r.add((0,a.PM)(i.a,new a.nt(1e-6)).multiply(2));let s=n.add(this.instance.dotSize);const o=this.view.displayViewScreenMat3.multiply(new a.eB(e.pos.add(.5),1)),l=new a.Zb(o.xy,r,1),u=this.instance.dotSize.divide(s),c=new a.nt(-1).divide(n.divide(s));return s=s.multiply(this.draw.pixelRatio.multiply(this.draw.tileZoomFactor)),{glPosition:l,glPointSize:s,color:i,ratio:u,invEdgeRatio:c}}fragment(e){const t=(0,a.Bw)(e.glPointCoord.subtract(.5)).multiply(2),i=(0,a.TF)(new a.nt(0),new a.nt(1),e.invEdgeRatio.multiply(t.subtract(e.ratio)).add(1)),n=new o.mm;return n.glFragColor=e.color.multiply(i),n}}(0,r._)([(0,o.Pi)(Z)],$.prototype,"instance",void 0),(0,r._)([(0,o.Pi)(q)],$.prototype,"draw",void 0),(0,r._)([(0,o.Pi)(G.o)],$.prototype,"view",void 0),(0,r._)([(0,r.a)(0,(0,o.hF)(H))],$.prototype,"vertex",null),(0,r._)([(0,r.a)(0,(0,o.hF)(Y))],$.prototype,"fragment",null);class W extends c.rz{}(0,r._)([(0,o.C5)(3,a.nt)],W.prototype,"inverseArea",void 0);class j extends o.k2{}(0,r._)([(0,o.Pi)(a.My.ofType(a.Zb,2))],j.prototype,"isActive",void 0),(0,r._)([(0,o.Pi)(a.My.ofType(a.Zb,8))],j.prototype,"colors",void 0),(0,r._)([(0,o.Pi)(a.nt)],j.prototype,"dotValue",void 0);class X extends o.k2{}(0,r._)([(0,o.Pi)(a.z7)],X.prototype,"dotTexture0",void 0),(0,r._)([(0,o.Pi)(a.z7)],X.prototype,"dotTexture1",void 0),(0,r._)([(0,o.Pi)(a.nt)],X.prototype,"tileZoomFactor",void 0),(0,r._)([(0,o.Pi)(a.nt)],X.prototype,"pixelRatio",void 0),(0,r._)([(0,o.Pi)(a.nt)],X.prototype,"tileDotsOverArea",void 0);class K extends c.f_{_dotThreshold(e,t,i){return e.divide(t).divide(i)}vertex(e){const t=new a.U(2/B.CQ,0,0,0,-2/B.CQ,0,-1,1,1).multiply(new a.eB(e.pos,1)),i=this.clip(e.id),n=new a.Zb(t.xy,i,1),r=this.storage.getVVData(e.id).multiply(this.instance.isActive.get(0)).multiply(e.inverseArea),s=this.storage.getDataDrivenData0(e.id).multiply(this.instance.isActive.get(1)).multiply(e.inverseArea),o=this.draw.tileZoomFactor.multiply(B.CQ).divide(this.draw.pixelRatio),l=this._dotThreshold(r,this.instance.dotValue,this.draw.tileDotsOverArea),u=this._dotThreshold(s,this.instance.dotValue,this.draw.tileDotsOverArea),c=e.pos.add(.5).divide(o);return{glPosition:n,color:new a.Zb(0,0,0,0),textureCoords:c,thresholds0:l,thresholds1:u}}fragment(e){const t=new o.mm,i=(0,a.US)(this.draw.dotTexture0,e.textureCoords),n=(0,a.US)(this.draw.dotTexture1,e.textureCoords),r=e.thresholds0.subtract(i),s=e.thresholds1.subtract(n);let l;const u=a.$I.fromColumns(this.instance.colors[0],this.instance.colors[1],this.instance.colors[2],this.instance.colors[3]),c=a.$I.fromColumns(this.instance.colors[4],this.instance.colors[5],this.instance.colors[6],this.instance.colors[7]);if(this.blending){const e=(0,a.PM)(new a.nt(0),r),t=(0,a.PM)(new a.nt(0),s),i=(0,a.Om)(e,r).add((0,a.Om)(t,s)),n=(0,a.PM)(i,new a.nt(0)),o=new a.nt(1).subtract(n),h=i.add(n),d=r.multiply(e).divide(h),f=s.multiply(t).divide(h),p=u.multiply(d).add(c.multiply(f));l=o.multiply(p)}else{const e=(0,a.T9)((0,f.xf)(r),(0,f.xf)(s)),t=(0,a.PM)(e,new a.nt(0)),i=new a.nt(1).subtract(t),n=(0,a.PM)(e,r),o=(0,a.PM)(e,s),h=u.multiply(n).add(c.multiply(o));l=i.multiply(h)}return t.glFragColor=l,t}hittest(e){return(0,A.My)(this.hittestRequest)}}(0,r._)([o.E8],K.prototype,"blending",void 0),(0,r._)([(0,o.Pi)(j)],K.prototype,"instance",void 0),(0,r._)([(0,o.Pi)(X)],K.prototype,"draw",void 0),(0,r._)([(0,r.a)(0,(0,o.hF)(W))],K.prototype,"vertex",null),(0,r._)([(0,r.a)(0,(0,o.hF)(c.DM))],K.prototype,"fragment",null);var Q=i(13798),J=i(61117),ee=i(85456),te=i(96402),ie=i(49414),ne=i(15167),re=i(12285),se=i(10956);const oe={pos:{count:2,type:ee.pe.UNSIGNED_SHORT}};class ae{constructor(){this._dotTextureSize=0,this._dotTextures=null,this._dotMesh=null}destroy(){this._disposeTextures(),this._dotFBO&&this._dotFBO.dispose(),this._dotMesh&&this._dotMesh.destroy()}getFBO(e){if(null==this._dotFBO){const t=B.CQ,i=B.CQ,n=new se.R(t,i);n.samplingMode=ee.Cj.NEAREST,n.wrapMode=ee.pF.CLAMP_TO_EDGE;const r=new ie.l(e,new ne.q(ee.yQ.DEPTH_STENCIL,t,i));this._dotFBO=new te.H(e,n,r)}return this._dotFBO}getDotDensityMesh(e,t){if(null==this._dotMesh){const i=B.CQ,n=i*i,r=2,s=new Int16Array(n*r);for(let e=0;e<i;e++)for(let t=0;t<i;t++)s[r*(t+e*i)]=t,s[r*(t+e*i)+1]=e;this._dotMesh=J.g.create(e,{primitive:ee.WR.POINTS,vertex:s,count:n,layout:oe},t)}return this._dotMesh}getDotDensityTextures(e,t,i){if(this._dotTextureSize===t&&this._seed===i||(this._disposeTextures(),this._dotTextureSize=t,this._seed=i),null===this._dotTextures){const n=new Q.A(i);this._dotTextures=[this._allocDotDensityTexture(e,t,n),this._allocDotDensityTexture(e,t,n)]}return this._dotTextures}_disposeTextures(){if(this._dotTextures){for(let e=0;e<this._dotTextures.length;e++)this._dotTextures[e].dispose();this._dotTextures=null}}_allocDotDensityTexture(e,t,i){const n=new Float32Array(t*t*4);for(let e=0;e<n.length;e++)n[e]=i.getFloat();const r=new se.R;return r.dataType=ee.ld.FLOAT,r.samplingMode=ee.Cj.NEAREST,r.width=t,r.height=t,new re.g(e,r,n)}}var le=i(42203),ue=i(58991);function ce(e){const t=1/e;return{antialiasing:t,blur:0+t}}var he=i(47461),de=i(54537),fe=i(51741),pe=i(15087),me=i(40633),_e=i(95929),ge=i(39819);class ye{constructor(e,t,i,n){this.dataType=e,this.samplingMode=t,this.pixelFormat=i,this.internalFormat=n}}new ye(ee.ld.HALF_FLOAT,ee.Cj.NEAREST,ee.Ab.RGBA,ee.Ab.RGBA);class ve{destroy(){this._accumulateFramebuffer=(0,_e.WD)(this._accumulateFramebuffer),this._resolveGradientTexture=(0,_e.WD)(this._resolveGradientTexture),this._prevGradientHash=null,this._qualityProfile=null}get initialized(){return null!=this._accumulateFramebuffer&&null!=this._resolveGradientTexture}get accumulateFramebuffer(){return this._accumulateFramebuffer}get resolveGradientTexture(){return this._resolveGradientTexture}loadQualityProfile(e){if(null==this._qualityProfile){const t=function(e,t){const{textureFloatLinear:i,colorBufferFloat:n}=e.capabilities,r=n?.textureFloat,s=n?.textureHalfFloat,o=n?.floatBlend,a=e.driverTest.floatBufferBlend.result;if(!r&&!s)throw new ge.A("heatmap:missing-color-buffer-float","HeatmapRenderer requires the WebGL extension EXT_color_buffer_float or EXT_color_buffer_half_float or WEBGL_color_buffer_float.");if(!(o&&a||s))throw new ge.A("heatmap:missing-float-blend","HeatmapRenderer requires the WebGL extension EXT_float_blend or EXT_color_buffer_half_float."+(a?"":" This device claims support for EXT_float_blend, but does not actually support it."));const l=r&&o&&a,u=s,c=i,h=!!n?.R32F,d=!!n?.R16F;if(l&&c)return c||t.warnOnce("Missing WebGL extension OES_texture_float_linear. Heatmap quality may be reduced."),new ye(ee.ld.FLOAT,c?ee.Cj.LINEAR:ee.Cj.NEAREST,h?ee.Ab.RED:ee.Ab.RGBA,h?ee.H0.R32F:ee.Ab.RGBA);if(u)return new ye(ee.ld.HALF_FLOAT,ee.Cj.LINEAR,d?ee.Ab.RED:ee.Ab.RGBA,d?ee.H0.R16F:ee.Ab.RGBA);throw new ge.A("heatmap:missing-hardware-support","HeatmapRenderer requires WebGL extensions that allow it to render and blend to float or half float textures.")}(e,me.A.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.heatmap.HeatmapResources"));this._qualityProfile={...t,defines:{usesHalfFloatPrecision:t.dataType!==ee.ld.FLOAT}}}return this._qualityProfile}ensureAccumulateFBO(e,t,i){if(null==this._accumulateFramebuffer){const{dataType:n,samplingMode:r,pixelFormat:s,internalFormat:o}=this.loadQualityProfile(e),a=new se.R(t,i);a.pixelFormat=s,a.internalFormat=o,a.dataType=n,a.samplingMode=r,a.wrapMode=ee.pF.CLAMP_TO_EDGE;const l=new ne.q(ee.yQ.DEPTH_STENCIL,t,i);this._accumulateFramebuffer=new te.H(e,a,l)}else{const{width:e,height:n}=this._accumulateFramebuffer;e===t&&n===i||this._accumulateFramebuffer.resize(t,i)}return this._accumulateFramebuffer}ensureResolveGradientTexture(e,t,i){if(null==this._resolveGradientTexture){const t=new se.R;t.wrapMode=ee.pF.CLAMP_TO_EDGE,this._resolveGradientTexture=new re.g(e,t)}else this._prevGradientHash!==t&&(this._resolveGradientTexture.resize(i.length/4,1),this._resolveGradientTexture.setData(i),this._prevGradientHash=t);return this._resolveGradientTexture}}function xe(e){return e?.25:1}class be extends c.rz{}(0,r._)([(0,o.C5)(5,a.ZY)],be.prototype,"offset",void 0);class Se extends c.DM{}class we extends o.k2{}(0,r._)([(0,o.Pi)(a.nt)],we.prototype,"radius",void 0),(0,r._)([(0,o.Pi)(a.nt)],we.prototype,"isFieldActive",void 0);class Te extends c.f_{constructor(){super(...arguments),this.usesHalfFloatPrecision=!1}vertex(e){const{radius:t,isFieldActive:i}=this.kernelControls,n=e.offset,r=i.multiply(this.storage.getVVData(e.id).x).add(new a.nt(1).subtract(i)),s=this.view.displayViewScreenMat3.multiply(new a.eB(e.pos,1)).add(this.view.displayViewMat3.multiply(new a.eB(n,0)).multiply(t)),o=this.clip(e.id);return{glPosition:new a.Zb(s.xy,o,1),offset:n,fieldValue:r,color:new a.Zb(0),...this.maybeRunHittest(e,{},null)}}fragment(e){const{offset:t,fieldValue:i}=e,n=(0,a.Bw)(t),r=(0,a.PM)(n,new a.nt(1)),s=new a.nt(1).subtract(n.multiply(n)),o=s.multiply(s),l=r.multiply(o).multiply(i).multiply(new a.nt(xe(this.usesHalfFloatPrecision)));return this.getFragmentOutput(new a.Zb(l),e)}hittest(e){const{viewMat3:t,tileMat3:i}=this.view,n=t.multiply(i).multiply(new a.eB(e.pos,1));return(0,A.g$)(n.xy,this.kernelControls.radius,this.hittestRequest.position)}}(0,r._)([o.E8],Te.prototype,"usesHalfFloatPrecision",void 0),(0,r._)([(0,o.Pi)(we)],Te.prototype,"kernelControls",void 0),(0,r._)([(0,r.a)(0,(0,o.hF)(be))],Te.prototype,"vertex",null),(0,r._)([(0,r.a)(0,(0,o.hF)(Se))],Te.prototype,"fragment",null);class Pe extends o.ZA{}(0,r._)([(0,o.C5)(0,a.ZY)],Pe.prototype,"position",void 0);class Ie extends o.HS{}class Me extends o.k2{}(0,r._)([(0,o.Pi)(a.z7)],Me.prototype,"texture",void 0),(0,r._)([(0,o.Pi)(a.ZY)],Me.prototype,"minAndInvRange",void 0),(0,r._)([(0,o.Pi)(a.nt)],Me.prototype,"normalization",void 0);class Ae extends o.k2{}(0,r._)([(0,o.Pi)(a.z7)],Ae.prototype,"texture",void 0);class Ce extends o.A{constructor(){super(...arguments),this.usesHalfFloatPrecision=!1}vertex(e){return{glPosition:new a.Zb(e.position.multiply(2).subtract(1),1,1),uv:e.position}}fragment(e){const{accumulatedDensity:t,gradient:i}=this;let n=(0,a.US)(t.texture,e.uv).r.divide(new a.nt(xe(this.usesHalfFloatPrecision)));n=n.multiply(t.normalization),n=n.subtract(t.minAndInvRange.x).multiply(t.minAndInvRange.y);const r=(0,a.US)(i.texture,new a.ZY(n,.5)),s=new o.mm;return s.glFragColor=new a.Zb(r.rgb.multiply(r.a),r.a),s}}function Ee(e){return e.key.level+1}(0,r._)([o.E8],Ce.prototype,"usesHalfFloatPrecision",void 0),(0,r._)([(0,o.Pi)(Me)],Ce.prototype,"accumulatedDensity",void 0),(0,r._)([(0,o.Pi)(Ae)],Ce.prototype,"gradient",void 0),(0,r._)([(0,r.a)(0,(0,o.hF)(Pe))],Ce.prototype,"vertex",null),(0,r._)([(0,r.a)(0,(0,o.hF)(Ie))],Ce.prototype,"fragment",null);const Re={color:{write:[!0,!0,!0,!0],blendMode:"additive"},depth:!1,stencil:{write:!1,test:{ref:Ee,compare:ee.MT.GEQUAL,mask:255,op:{fail:ee.eA.KEEP,zFail:ee.eA.KEEP,zPass:ee.eA.REPLACE}}}},Oe={...Re,stencil:!1},ze={color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1};function Fe(e,t){const{referenceScale:i,radius:n}=e.uniforms;return n*(0!==i?i/t.scale:1)}const Ve=360/254;var Le;!function(e){e[e.Color=0]="Color",e[e.Outline=1]="Outline",e[e.Halo=2]="Halo"}(Le||(Le={}));class De extends c.rz{}(0,r._)([(0,o.C5)(3,a.Zb)],De.prototype,"color",void 0),(0,r._)([(0,o.C5)(4,a.ZY)],De.prototype,"offset",void 0),(0,r._)([(0,o.C5)(5,a.ZY)],De.prototype,"textureUV",void 0),(0,r._)([(0,o.C5)(6,a.nt)],De.prototype,"fontSize",void 0),(0,r._)([(0,o.C5)(7,a.nt)],De.prototype,"referenceSize",void 0),(0,r._)([(0,o.C5)(8,a.Zb)],De.prototype,"outlineColor",void 0),(0,r._)([(0,o.C5)(9,a.Zb)],De.prototype,"haloColor",void 0),(0,r._)([(0,o.C5)(10,a.ZY)],De.prototype,"outlineAndHaloSize",void 0),(0,r._)([(0,o.C5)(11,a.ZY)],De.prototype,"zoomRange",void 0),(0,r._)([(0,o.C5)(12,a.nt)],De.prototype,"clipAngle",void 0),(0,r._)([(0,o.C5)(13,a.Zb)],De.prototype,"referenceSymbol",void 0);class Ne extends o.Y7{}(0,r._)([(0,o.C5)(14,a.ZY)],Ne.prototype,"offsetNextVertex1",void 0),(0,r._)([(0,o.C5)(15,a.ZY)],Ne.prototype,"offsetNextVertex2",void 0);class ke extends c.DM{}class Be extends c.f_{constructor(){super(...arguments),this.computeAttributes={offset:["offsetNextVertex1","offsetNextVertex2"]},this.textRenderPassType=Le.Color,this.isBackgroundPass=!1,this.isLabel=!1}clipLabel(e,t,i){const n=t.multiply(Ve),r=(0,a.tn)(this.view.rotation.subtract(n)),s=(0,a.jk)(new a.nt(360).subtract(r),r);let o=new a.nt(0);const l=(0,a.RI)(this.view.currentZoom.multiply(B.fq)).divide(B.fq),u=e.x,c=e.y,h=new a.nt(1).subtract((0,a.PM)(u,l)).multiply(2),d=(0,a.PM)(new a.nt(90),s).multiply(2),f=new a.nt(2).multiply(new a.nt(1).subtract((0,a.PM)(l,c)));return o=o.add(i.multiply(h)),o=o.add(i.multiply(d)),o=o.add(f),o}vertex(e,t){const i=(0,f.mh)(e.bitset,h.bg),n=new a.nt(1).subtract(i);let r=e.fontSize,s=r.divide(h.au);const o=this.textRenderPassType===Le.Outline?e.outlineColor:this.textRenderPassType===Le.Halo?e.haloColor:this._getVertexColor(e),l=this.isLabel?this.storage.getLabelVisibility(e.id):new a.nt(1),u=this.isLabel?o.multiply(l):o,c=this.view.displayViewScreenMat3.multiply(new a.eB(e.pos,1));let d=e.offset,p=new a.nt(1),m=a.U.identity(),_=new a.ZY(0);if(this.isLabel){if(!e.referenceSymbol)throw new Error("InternalError: Optional attribute 'referenceSymbol' expected for labels");const t=e.referenceSymbol,i=t.xy,n=t.z,r=this._unpackDirection(t.w),s=(0,S.Mg)(this,e.id,n).divide(2),o=r.multiply(s.add(B.C2));_=i.add(o),d=d.add(_)}else p=(0,S.Mg)(this,e.id,e.referenceSize).divide(e.referenceSize),r=r.multiply(p),s=s.multiply(p),d=d.multiply(p),m=(0,S.TL)(this,e.id),d=m.multiply(new a.eB(d,0)).xy;const g=(0,f.mh)(e.bitset,h.ti),y=this._getViewRotationMatrix(g).multiply(new a.eB(d,0));let v=this.isLabel?this.clipLabel(e.zoomRange,e.clipAngle,g):this.clip(e.id,e.zoomRange);v=this.isBackgroundPass?v.add(n.multiply(2)):v.add(i.multiply(2));const x=this.isLabel?(0,a.or)((0,a.MM)(v,new a.nt(1)),(0,a.LC)(l,new a.nt(0))):new a.x(!1),b=new a.Zb(c.xy.add(y.xy),v,1),w=e.textureUV.divide(this.mosaicInfo.size);let T=new a.nt(0);if(this.textRenderPassType===Le.Outline&&((0,a.LC)(e.outlineAndHaloSize.x,new a.nt(0))&&(v=v.add(new a.nt(2))),T=new a.nt(e.outlineAndHaloSize.x).divide(s).divide(h.$w)),this.textRenderPassType===Le.Halo){const t=e.outlineAndHaloSize.x,i=new a.nt(e.outlineAndHaloSize.y);(0,a.LC)(i,new a.nt(0))&&(v=v.add(new a.nt(2))),T=i.add(t).divide(s).divide(h.$w)}return{glPosition:b,color:u,size:s,textureUV:w,antialiasingWidth:new a.nt(.105*h.au).divide(r).divide(this.view.pixelRatio),outlineDistanceOffset:T,...this.maybeRunHittest(e,t,{vvSizeAdjustment:p,vvRotation:m,labelOffset:_,labelClipped:x})}}_getViewRotationMatrix(e){const t=this.view.displayViewMat3,i=this.view.displayMat3,n=new a.nt(1).subtract(e);return t.multiply(e).add(i.multiply(n))}fragment(e){const t=new a.nt(2/8),i=new a.nt(1).subtract(t),n=(0,a.US)(this.mosaicInfo.texture,e.textureUV).a;let r=i.subtract(e.outlineDistanceOffset);this.highlight&&(r=r.divide(2));const s=e.antialiasingWidth,o=(0,a.TF)(r.subtract(s),r.add(s),n);return this.getFragmentOutput(e.color.multiply(o),e)}hittest(e,t,{vvSizeAdjustment:i,vvRotation:n,labelOffset:r,labelClipped:s}){let o,l,u;this.isLabel?(o=new a.eB(e.offset.add(r),0),l=new a.eB(t.offsetNextVertex1.add(r),0),u=new a.eB(t.offsetNextVertex2.add(r),0)):(o=n.multiply(new a.eB(e.offset.multiply(i),0)),l=n.multiply(new a.eB(t.offsetNextVertex1.multiply(i),0)),u=n.multiply(new a.eB(t.offsetNextVertex2.multiply(i),0)));const{viewMat3:c,tileMat3:h}=this.view,d=c.multiply(h).multiply(new a.eB(e.pos,1)),f=d.add(h.multiply(o)).xy,p=d.add(h.multiply(l)).xy,m=d.add(h.multiply(u)).xy,_=(0,A.Bo)(this.hittestRequest.position,f.xy,p.xy,m.xy);return this.isLabel?(0,a.Tk)(s,(0,A.My)(this.hittestRequest),_):_}_unpackDirection(e){const t=new a.Ai(e),i=(0,a.Sj)(t,new a.Ai(2)),n=(0,a.nf)(t,new a.Ai(3));return new a.ZY(new a.nt(i).subtract(1),new a.nt(n).subtract(1))}_getVertexColor(e){let t=e.color;if(this.visualVariableColor){const i=this.storage.getColorValue(e.id);t=this.visualVariableColor.getColor(i,e.color,new a.x(!1))}if(this.visualVariableOpacity){const i=this.storage.getOpacityValue(e.id),n=this.visualVariableOpacity.getOpacity(i);t=t.multiply(n)}return t}}(0,r._)([(0,o.uK)(p._)],Be.prototype,"visualVariableColor",void 0),(0,r._)([(0,o.uK)(m.i)],Be.prototype,"visualVariableOpacity",void 0),(0,r._)([(0,o.uK)(_)],Be.prototype,"visualVariableRotation",void 0),(0,r._)([(0,o.uK)(y.n)],Be.prototype,"visualVariableSizeMinMaxValue",void 0),(0,r._)([(0,o.uK)(v.F)],Be.prototype,"visualVariableSizeScaleStops",void 0),(0,r._)([(0,o.uK)(x.N)],Be.prototype,"visualVariableSizeStops",void 0),(0,r._)([(0,o.uK)(b.d)],Be.prototype,"visualVariableSizeUnitValue",void 0),(0,r._)([(0,o.Pi)(d.b)],Be.prototype,"mosaicInfo",void 0),(0,r._)([o.E8],Be.prototype,"textRenderPassType",void 0),(0,r._)([o.E8],Be.prototype,"isBackgroundPass",void 0),(0,r._)([o.E8],Be.prototype,"isLabel",void 0),(0,r._)([(0,r.a)(0,(0,o.hF)(De)),(0,r.a)(1,(0,o.hF)(Ne))],Be.prototype,"vertex",null),(0,r._)([(0,r.a)(0,(0,o.hF)(ke))],Be.prototype,"fragment",null);var Ue=i(59224),Ge=i(13520),He=i(2014);class Ye extends Ue.Xc{}(0,r._)([(0,o.C5)(9,a.nt)],Ye.prototype,"accumulatedDistance",void 0),(0,r._)([(0,o.C5)(10,a.ZY)],Ye.prototype,"segmentDirection",void 0),(0,r._)([(0,o.C5)(11,a.nt)],Ye.prototype,"offsetAlongLine",void 0),(0,r._)([(0,o.C5)(12,a.nt)],Ye.prototype,"capType",void 0),(0,r._)([(0,o.C5)(13,a.Zb)],Ye.prototype,"tlbr",void 0);class Ze extends Ue.cM{_getDistanceRatio(e,t){const i=(0,f.mh)(e.bitset,h.kx);return i.multiply((0,a.T9)(t,new a.nt(.25)).multiply(new a.nt(2))).add(new a.nt(1).subtract(i).multiply((0,Ge.Lz)(1)))}_getSDFAlpha(e){const{halfWidth:t,normal:i,tlbr:n,patternSize:r,accumulatedDistance:s,offsetAlongLine:o,dashToPx:l,capType:u}=e,c=r.x.divide(He.zA).multiply(l),h=(0,a.jc)(s.add(o).divide(c)),d=(0,a.jh)(n.xy,n.zw,new a.ZY(h,.5)),p=(0,f.Rj)((0,a.US)(this.mosaicInfo.texture,d)).multiply(2).subtract(1).multiply(He.gR).multiply(l),m=i.y.multiply(t),_=(0,a.j1)([(0,a.LC)(u,new a.nt(1)),p.subtract(t)],[(0,a.LC)(u,new a.nt(2)),(0,a.RZ)((0,a.n7)((0,a.T9)(p,new a.nt(0)),new a.nt(2)).add(m.multiply(m))).subtract(t)],[!0,p]),g=(0,a.qE)(new a.nt(.25).subtract(_),new a.nt(0),new a.nt(1));return new a.Zb(g)}_getPatternColor(e){const{halfWidth:t,normal:i,color:n,accumulatedDistance:r,patternSize:s,sampleAlphaOnly:o,tlbr:l}=e,u=s.y.multiply(new a.nt(2).multiply(t).divide(s.x)),c=(0,a.jc)(r.divide(u)),h=new a.nt(.5).multiply(i.y).add(new a.nt(.5)),d=(0,a.jh)(l.xy,l.zw,new a.ZY(h,c));let f=(0,a.US)(this.mosaicInfo.texture,d);return null!=this.visualVariableColor&&(f=(0,a.Tk)((0,a.MM)(o,new a.nt(.5)),new a.Zb(n.a),n)),f}vertex(e,t){const{segmentDirection:i,tlbr:n,bitset:r}=e,s=(0,Ue.$0)(this,e),o=e.accumulatedDistance.divide(this.view.displayZoomFactor).add((0,a.Om)(i,s.scaledOffset)),l=new a.ZY(n.z.subtract(n.x),n.w.subtract(n.y)),u=n.divide(this.mosaicInfo.size.xyxy),c=(0,f.mh)(r,h.b5),d=(0,f.mh)(r,h.cn),p=(0,a.Tk)((0,a.MM)(c,new a.nt(.5)),this._getDistanceRatio(e,s.scaledHalfWidth),new a.nt(1));return{...s,tlbr:u,patternSize:l,accumulatedDistance:o,isSDF:c,sampleAlphaOnly:d,dashToPx:p,offsetAlongLine:e.offsetAlongLine,capType:e.capType,...this.maybeRunHittest(e,t,s.halfWidth)}}fragment(e){const{color:t,opacity:i,isSDF:n}=e,r=(0,Ue.xw)(e,this.antialiasingControls.blur),s=(0,a.Tk)((0,a.MM)(n,new a.nt(.5)),this._getSDFAlpha(e),this._getPatternColor(e)),o=t.multiply(i).multiply(r).multiply(s);return this.getFragmentOutput(o,e)}}(0,r._)([(0,o.Pi)(d.b)],Ze.prototype,"mosaicInfo",void 0),(0,r._)([(0,r.a)(0,(0,o.hF)(Ye)),(0,r.a)(1,(0,o.hF)(c.$Z))],Ze.prototype,"vertex",null);class qe extends c.rz{}(0,r._)([(0,o.C5)(3,a.Zb)],qe.prototype,"color",void 0),(0,r._)([(0,o.C5)(4,a.Zb)],qe.prototype,"outlineColor",void 0),(0,r._)([(0,o.C5)(5,a.ZY)],qe.prototype,"offset",void 0),(0,r._)([(0,o.C5)(6,a.ZY)],qe.prototype,"textureUV",void 0),(0,r._)([(0,o.C5)(7,a.Zb)],qe.prototype,"sizing",void 0),(0,r._)([(0,o.C5)(8,a.nt)],qe.prototype,"placementAngle",void 0),(0,r._)([(0,o.C5)(9,a.nt)],qe.prototype,"sdfDecodeCoeff",void 0),(0,r._)([(0,o.C5)(10,a.ZY)],qe.prototype,"zoomRange",void 0);class $e extends o.Y7{}(0,r._)([(0,o.C5)(12,a.ZY)],$e.prototype,"offsetNextVertex1",void 0),(0,r._)([(0,o.C5)(13,a.ZY)],$e.prototype,"offsetNextVertex2",void 0),(0,r._)([(0,o.C5)(14,a.ZY)],$e.prototype,"textureUVNextVertex1",void 0),(0,r._)([(0,o.C5)(15,a.ZY)],$e.prototype,"textureUVNextVertex2",void 0);class We extends c.DM{}function je(e,t,i,n){return t.multiply(e.x).add(i.multiply(e.y)).add(n.multiply(e.z))}function Xe(e){return e.multiply(e).divide(128)}class Ke extends c.f_{constructor(){super(...arguments),this.computeAttributes={offset:["offsetNextVertex1","offsetNextVertex2"],textureUV:["textureUVNextVertex1","textureUVNextVertex2"]}}vertex(e,t){const i=Xe(e.sizing.x),n=Xe(e.sizing.y),r=Xe(e.sizing.z),s=e.placementAngle,o=(0,f.mh)(e.bitset,M.c.bitset.isSDF),l=(0,f.mh)(e.bitset,M.c.bitset.isMapAligned),u=(0,f.mh)(e.bitset,M.c.bitset.scaleSymbolsProportionally),c=(0,f.K5)(e.bitset,M.c.bitset.colorLocked),d=(0,S.cF)(this,e.id),p=(0,S.G7)(this,e.id,e.color,c).multiply(d),m=this.view.displayViewScreenMat3.multiply(new a.eB(e.pos.xy,1)),_=(0,S.Mg)(this,e.id,r).divide(r),g=i.multiply(_),y=e.offset.xy.multiply(_);let v=n.multiply(u.multiply(_.subtract(1)).add(1));v=(0,a.jk)(v,(0,a.T9)(g.subtract(.99),new a.nt(0)));const x=(0,a.T9)(v,new a.nt(1)),b=(0,a.jk)(v,new a.nt(1)),w=a.U.fromRotation(s.multiply(h.rp)),T=(0,S.TL)(this,e.id),P=this._getViewRotationMatrix(l).multiply(T).multiply(w).multiply(new a.eB(y.xy,0)),I=this.clip(e.id,e.zoomRange),A=new a.Zb(m.xy.add(P.xy),I,1),C=e.textureUV.divide(this.mosaicInfo.size),E=e.outlineColor.multiply(b),R=(0,f.mh)(e.bitset,M.c.bitset.overrideOutlineColor),O=e.sdfDecodeCoeff.multiply(g);return{glPosition:A,color:p,textureUV:C,outlineColor:E,outlineSize:x,distanceToPx:O,isSDF:o,overrideOutlineColor:R,...this.maybeRunHittest(e,t,{pos:e.pos,size:g,sizeCorrection:_,isMapAligned:l,vvRotationMat3:T,placementMat3:w,outlineSize:x,distanceToPx:O,isSDF:o})}}fragment(e){const t=this._getColor(e.textureUV,e);return this.getFragmentOutput(t,e)}hittest(e,t,i){return(0,a.Tk)((0,a.Xe)(i.size,this.hittestRequest.smallSymbolSizeThreshold),this._hittestSmallMarker(e,t,i),this._hittestMarker(e,t,i))}_getViewRotationMatrix(e){const t=this.view.displayViewMat3,i=this.view.displayMat3,n=new a.nt(1).subtract(e);return t.multiply(e).add(i.multiply(n))}_getViewScreenMatrix(e){const t=this.view.viewMat3.multiply(this.view.tileMat3),i=this.view.tileMat3,n=new a.nt(1).subtract(e);return t.multiply(e).add(i.multiply(n))}_getColor(e,t){return(0,a.Tk)((0,a.LC)(t.isSDF,new a.nt(1)),this._getSDFColor(e,t),this._getSpriteColor(e,t))}_getSpriteColor(e,t){return(0,a.US)(this.mosaicInfo.texture,e).multiply(t.color)}_getSDFColor(e,t){const i=(0,a.US)(this.mosaicInfo.texture,e),n=new a.nt(.5).subtract((0,f.Rj)(i)).multiply(t.distanceToPx).multiply(h.V5),r=(0,a.qE)(new a.nt(.5).subtract(n),new a.nt(0),new a.nt(1)),s=t.color.multiply(r);let o=t.outlineSize;this.highlight&&(o=(0,a.T9)(o,t.overrideOutlineColor.multiply(4)));const l=o.multiply(.5),u=(0,a.tn)(n).subtract(l),c=(0,a.qE)(new a.nt(.5).subtract(u),new a.nt(0),new a.nt(1)),d=(0,a.jh)(t.outlineColor,t.color,t.overrideOutlineColor).multiply(c);return new a.nt(1).subtract(d.a).multiply(s).add(d)}_hittestSmallMarker(e,t,i){const{position:n,distance:r,smallSymbolDistance:s}=this.hittestRequest,o=r.subtract(s),{viewMat3:l,tileMat3:u}=this.view,c=l.multiply(u).multiply(new a.eB(i.pos,1)).xy,h=i.size.multiply(.5);return(0,a.Io)(c,n).subtract(h).add(o)}_hittestMarker(e,t,i){const{pos:n,sizeCorrection:r,isMapAligned:s}=i,o=new a.eB(e.offset.multiply(r),0),l=new a.eB(t.offsetNextVertex1.multiply(r),0),u=new a.eB(t.offsetNextVertex2.multiply(r),0),{viewMat3:c,tileMat3:h}=this.view,d=c.multiply(h).multiply(new a.eB(n,1)),f=this._getViewScreenMatrix(s).multiply(i.vvRotationMat3).multiply(i.placementMat3),p=d.add(f.multiply(o)).xy,m=d.add(f.multiply(l)).xy,_=d.add(f.multiply(u)).xy,g=this.hittestRequest.position,y=this.hittestRequest.distance,v=(0,A.Bo)(g,p,m,_);return(0,a.Tk)((0,a.MM)(v,y),v,this._hittestSamples(p,m,_,e,t,i))}_hittestSamples(e,t,i,n,r,s){const{outlineSize:o,isSDF:l,distanceToPx:u}=s,c=this.hittestRequest.position,h=this.hittestRequest.distance,d=(0,A.Bs)(c.add(new a.ZY((0,a.ze)(h),(0,a.ze)(h))),e,t,i),f=(0,A.Bs)(c.add(new a.ZY(0,(0,a.ze)(h))),e,t,i),p=(0,A.Bs)(c.add(new a.ZY(h,(0,a.ze)(h))),e,t,i),m=(0,A.Bs)(c.add(new a.ZY((0,a.ze)(h),0)),e,t,i),_=(0,A.Bs)(c,e,t,i),g=(0,A.Bs)(c.add(new a.ZY(h,0)),e,t,i),y=(0,A.Bs)(c.add(new a.ZY((0,a.ze)(h),h)),e,t,i),v=(0,A.Bs)(c.add(new a.ZY(0,h)),e,t,i),x=(0,A.Bs)(c.add(new a.ZY(h,h)),e,t,i),b=n.textureUV.divide(this.mosaicInfo.size),S=r.textureUVNextVertex1.divide(this.mosaicInfo.size),w=r.textureUVNextVertex2.divide(this.mosaicInfo.size),T={color:new a.Zb(1),outlineColor:new a.Zb(1),overrideOutlineColor:new a.nt(1),outlineSize:o,distanceToPx:u,isSDF:l};let P=new a.nt(0);return P=P.add((0,A.kW)(d).multiply(this._getColor(je(d,b,S,w),T).a)),P=P.add((0,A.kW)(f).multiply(this._getColor(je(f,b,S,w),T).a)),P=P.add((0,A.kW)(p).multiply(this._getColor(je(p,b,S,w),T).a)),P=P.add((0,A.kW)(m).multiply(this._getColor(je(m,b,S,w),T).a)),P=P.add((0,A.kW)(_).multiply(this._getColor(je(_,b,S,w),T).a)),P=P.add((0,A.kW)(g).multiply(this._getColor(je(g,b,S,w),T).a)),P=P.add((0,A.kW)(y).multiply(this._getColor(je(y,b,S,w),T).a)),P=P.add((0,A.kW)(v).multiply(this._getColor(je(v,b,S,w),T).a)),P=P.add((0,A.kW)(x).multiply(this._getColor(je(x,b,S,w),T).a)),(0,a.PM)(P,new a.nt(.05)).multiply((0,A.My)(this.hittestRequest))}}(0,r._)([(0,o.uK)(p._)],Ke.prototype,"visualVariableColor",void 0),(0,r._)([(0,o.uK)(m.i)],Ke.prototype,"visualVariableOpacity",void 0),(0,r._)([(0,o.uK)(_)],Ke.prototype,"visualVariableRotation",void 0),(0,r._)([(0,o.uK)(y.n)],Ke.prototype,"visualVariableSizeMinMaxValue",void 0),(0,r._)([(0,o.uK)(v.F)],Ke.prototype,"visualVariableSizeScaleStops",void 0),(0,r._)([(0,o.uK)(x.N)],Ke.prototype,"visualVariableSizeStops",void 0),(0,r._)([(0,o.uK)(b.d)],Ke.prototype,"visualVariableSizeUnitValue",void 0),(0,r._)([(0,o.Pi)(d.b)],Ke.prototype,"mosaicInfo",void 0),(0,r._)([(0,r.a)(0,(0,o.hF)(qe)),(0,r.a)(1,(0,o.hF)($e))],Ke.prototype,"vertex",null),(0,r._)([(0,r.a)(0,(0,o.hF)(We))],Ke.prototype,"fragment",null);var Qe=i(50944),Je=i(22516);class et{constructor(){this.computeAttributes={}}get locationsMap(){const e=new Map;for(const t in this.locations)e.set(t,this.locations[t].index);return e}get optionPropertyKeys(){if(!this._optionPropertyKeys){const e=new Set(Object.keys(this.options));this._optionPropertyKeys=e}return this._optionPropertyKeys}get _transformFeedbackBindings(){return[]}get locationInfo(){if(!this._locationInfo){const e=this.locationsMap,t=Array.from(e.entries()).map((([e,t])=>`${e}.${t}`)).join("."),i=(0,Qe.Wm)(t);this._locationInfo={hash:i,locations:e,computeAttributeMap:this.computeAttributes}}return this._locationInfo}get renamedLocationsMap(){const e=new Map;for(const[t,i]of this.locationsMap.entries())e.set("a_"+t,i);return e}getShaderKey(e,t,i){return`${Object.keys(e).map((t=>`${t}.${e[t]}`)).join(".")}.${Object.keys(i).filter((e=>i[e])).map((e=>`${e}_${i[e].toString()}`)).join(".")}.${Object.keys(t).filter((e=>this.optionPropertyKeys.has(e))).join(".")}`}getProgram(e,t,i,n){let r="",s="";for(const e in i)if(i[e]){const t="boolean"==typeof i[e]?`#define ${e}\n`:`#define ${e} ${i[e]}\n`;r+=t,s+=t}return r+=this.vertexShader,s+=this.fragmentShader,new Je.K(r,s,this.renamedLocationsMap,this.locationInfo,this._getUniformBindings(t),this._transformFeedbackBindings)}_getUniformBindings(e){const t=[];for(const e in this.required){const i=this.required[e];t.push({uniformHydrated:null,shaderModulePath:e,uniformName:e,uniformType:i.type,uniformArrayElementType:tt(i),uniformArrayLength:it(i)})}for(const i in e){const n=this.options[i];if(e[i])for(const e in n){const r=n[e];t.push({uniformHydrated:null,shaderModulePath:`${i}.${e}`,uniformName:e,uniformType:r.type,uniformArrayElementType:tt(r),uniformArrayLength:it(r)})}}return t}}const tt=e=>"array"===e.type?e.elementType?.type:void 0,it=e=>"array"===e.type?e.size:void 0;var nt=i(44723);const rt={hittestDist:a.nt,hittestPos:a.ZY},st={filterFlags:a.z7,animation:a.z7,visualVariableData:a.z7,dataDriven0:a.z7,dataDriven1:a.z7,dataDriven2:a.z7,gpgpu:a.z7,size:a.nt},ot={displayViewScreenMat3:a.U,displayViewMat3:a.U,displayMat3:a.U,viewMat3:a.U,tileMat3:a.U,displayZoomFactor:a.nt,requiredZoomFactor:a.nt,tileOffset:a.ZY,currentScale:a.nt,currentZoom:a.nt,metersPerSRUnit:a.nt};class at extends et{constructor(){super(...arguments),this.vertexShader=(0,nt.Q)("materials/pie/pie.vert"),this.fragmentShader=(0,nt.Q)("materials/pie/pie.frag"),this.required={...st,...ot,outlineWidth:a.nt,colors:a.My,defaultColor:a.Zb,othersColor:a.Zb,outlineColor:a.Zb,donutRatio:a.nt,sectorThreshold:a.nt},this.options={hittestUniforms:rt,visualVariableSizeMinMaxValue:{minMaxValueAndSize:a.Zb},visualVariableSizeScaleStops:{sizes:{...a.My.ofType(a.nt,8),type:"array",elementType:a.nt,size:8},values:{...a.My.ofType(a.nt,8),type:"array",elementType:a.nt,size:8}},visualVariableSizeStops:{sizes:{...a.My.ofType(a.nt,8),type:"array",elementType:a.nt,size:8},values:{...a.My.ofType(a.nt,8),type:"array",elementType:a.nt,size:8}},visualVariableSizeUnitValue:{unitValueToPixelsRatio:a.nt},visualVariableOpacity:{opacities:{...a.My.ofType(a.nt,8),type:"array",elementType:a.nt,size:8},opacityValues:{...a.My.ofType(a.nt,8),type:"array",elementType:a.nt,size:8}}},this.locations={pos:{index:0,type:a.ZY},id:{index:1,type:a.eB},bitset:{index:2,type:a.nt},offset:{index:3,type:a.ZY},texCoords:{index:4,type:a.ZY},size:{index:5,type:a.ZY},referenceSize:{index:6,type:a.nt},zoomRange:{index:7,type:a.ZY}},this.defines={VV_SIZE_MIN_MAX_VALUE:"boolean",VV_SIZE_SCALE_STOPS:"boolean",VV_SIZE_FIELD_STOPS:"boolean",VV_SIZE_UNIT_VALUE:"boolean",VV_OPACITY:"boolean",HITTEST:"boolean",numberOfFields:"number",highlight:"boolean",inside:"boolean",outside:"boolean"}}setNumberOfFields(e){this.required.colors={...a.My.ofType(a.Zb,e),type:"array",elementType:a.Zb,size:e}}}const lt={fill:new class extends D{constructor(){super(...arguments),this.type=n.N.Fill,this.shaders={geometry:new le.z}}render(e,t){const{painter:i}=e,n=t.instance.getInput();i.setShader({shader:this.shaders.geometry,uniforms:{...(0,N.r3)(e,t.target,n.uniforms),...(0,N.QA)(e,t.target)},defines:(0,N.vT)(e),optionalAttributes:n.optionalAttributes,useComputeBuffer:(0,N.Eq)(e)}),i.setPipelineState((0,N.Qu)(e)),i.submitDraw(e,t)}},patternFill:new class extends D{constructor(){super(...arguments),this.type=n.N.PatternFill,this.shaders={geometry:new fe.vx}}render(e,t){const{context:i,painter:n}=e,r=t.instance.getInput();n.setShader({shader:this.shaders.geometry,uniforms:{...(0,N.r3)(e,t.target,r.uniforms),...(0,N.QA)(e,t.target),mosaicInfo:n.textureManager.getMosaicInfo(i,t.textureKey),localTileOffset:(0,N.Pr)(t.target)},defines:{...(0,N.vT)(e)},optionalAttributes:r.optionalAttributes,useComputeBuffer:(0,N.Eq)(e)}),n.setPipelineState((0,N.Qu)(e)),n.submitDraw(e,t)}},complexFill:new class extends D{constructor(){super(...arguments),this.type=n.N.ComplexFill,this.shaders={geometry:new ue.Ps}}render(e,t){const{context:i,painter:n}=e,r=t.instance.getInput();n.setShader({shader:this.shaders.geometry,uniforms:{...(0,N.r3)(e,t.target,r.uniforms),...(0,N.QA)(e,t.target),mosaicInfo:n.textureManager.getMosaicInfo(i,t.textureKey),localTileOffset:(0,N.Pr)(t.target)},defines:{...(0,N.vT)(e)},optionalAttributes:r.optionalAttributes,useComputeBuffer:(0,N.Eq)(e)}),n.setPipelineState((0,N.Qu)(e)),n.submitDraw(e,t)}},outlineFill:new class extends D{constructor(){super(...arguments),this.type=n.N.OutlineFill,this.shaders={geometry:new de.nj}}render(e,t){const{painter:i,pixelRatio:n}=e,r=t.instance.getInput();i.setShader({shader:this.shaders.geometry,uniforms:{...(0,N.r3)(e,t.target,r.uniforms),...(0,N.QA)(e,t.target),antialiasingControls:ce(n)},defines:{...(0,N.vT)(e)},optionalAttributes:r.optionalAttributes,useComputeBuffer:(0,N.Eq)(e)}),i.setPipelineState((0,N.Qu)(e)),i.submitDraw(e,t)}},patternOutlineFill:new class extends D{constructor(){super(...arguments),this.type=n.N.PatternOutlineFill,this.shaders={geometry:new pe.tA}}render(e,t){const{context:i,painter:n,pixelRatio:r}=e,s=t.instance.getInput();n.setShader({shader:this.shaders.geometry,uniforms:{...(0,N.r3)(e,t.target,s.uniforms),...(0,N.QA)(e,t.target),antialiasingControls:ce(r),mosaicInfo:n.textureManager.getMosaicInfo(i,t.textureKey),localTileOffset:(0,N.Pr)(t.target)},defines:{...(0,N.vT)(e)},optionalAttributes:s.optionalAttributes,useComputeBuffer:(0,N.Eq)(e)}),n.setPipelineState((0,N.Qu)(e)),n.submitDraw(e,t)}},complexOutlineFill:new class extends D{constructor(){super(...arguments),this.type=n.N.ComplexOutlineFill,this.shaders={geometry:new he.RH}}render(e,t){const{context:i,painter:n,pixelRatio:r}=e,s=t.instance.getInput();n.setShader({shader:this.shaders.geometry,uniforms:{...(0,N.r3)(e,t.target,s.uniforms),...(0,N.QA)(e,t.target),antialiasingControls:ce(r),mosaicInfo:n.textureManager.getMosaicInfo(i,t.textureKey),localTileOffset:(0,N.Pr)(t.target)},defines:{...(0,N.vT)(e)},optionalAttributes:s.optionalAttributes,useComputeBuffer:(0,N.Eq)(e)}),n.setPipelineState((0,N.Qu)(e)),n.submitDraw(e,t)}},marker:new class extends D{constructor(){super(...arguments),this.type=n.N.Marker,this.shaders={geometry:new Ke},this.symbologyPlane=V.uC.MARKER}render(e,t){const{context:i,painter:n}=e,r=t.instance.getInput();n.setShader({shader:this.shaders.geometry,uniforms:{...(0,N.r3)(e,t.target,r.uniforms),...(0,N.QA)(e,t.target),mosaicInfo:n.textureManager.getMosaicInfo(i,t.textureKey,!0)},defines:{...(0,N.vT)(e)},optionalAttributes:r.optionalAttributes,useComputeBuffer:(0,N.Eq)(e)}),n.setPipelineState((0,N.Qu)(e)),n.submitDraw(e,t)}},pieChart:new class extends D{constructor(){super(...arguments),this.type=n.N.PieChart,this.shaders={geometry:new at},this.symbologyPlane=V.uC.MARKER}render(e,t){const{painter:i}=e,{instance:n,target:r}=t,s=this.shaders.geometry,o=n.getInput(),a=o.uniforms.numberOfFields,l=(0,N.Eq)(e),u=(0,N.QA)(e,r),c=(0,N.vT)(e);s.setNumberOfFields(a),i.setShader({shader:s,uniforms:{...(0,N.r3)(e,t.target,o.uniforms.shader),...u.storage,...u.view,hittestUniforms:u.hittestRequest?{hittestDist:u.hittestRequest?.distance,hittestPos:u.hittestRequest?.position}:null},defines:{VV_SIZE_MIN_MAX_VALUE:!!o.uniforms.shader.visualVariableSizeMinMaxValue,VV_SIZE_SCALE_STOPS:!!o.uniforms.shader.visualVariableSizeScaleStops,VV_SIZE_FIELD_STOPS:!!o.uniforms.shader.visualVariableSizeStops,VV_SIZE_UNIT_VALUE:!!o.uniforms.shader.visualVariableSizeUnitValue,VV_OPACITY:!!o.uniforms.shader.visualVariableOpacity,HITTEST:l,highlight:u.highlight?1:0,...c,numberOfFields:a},optionalAttributes:{},useComputeBuffer:l}),i.setPipelineState((0,N.Qu)(e)),i.submitDraw(e,t)}},line:new class extends D{constructor(){super(...arguments),this.type=n.N.Line,this.shaders={geometry:new Ue.cM},this.symbologyPlane=V.uC.LINE}render(e,t){const{painter:i,pixelRatio:n}=e,r=t.instance.getInput();i.setShader({shader:this.shaders.geometry,uniforms:{...(0,N.r3)(e,t.target,r.uniforms),...(0,N.QA)(e,t.target),antialiasingControls:ce(n)},defines:{...(0,N.vT)(e)},optionalAttributes:r.optionalAttributes,useComputeBuffer:(0,N.Eq)(e)}),i.setPipelineState((0,N.Qu)(e)),i.submitDraw(e,t)}},texturedLine:new class extends D{constructor(){super(...arguments),this.type=n.N.TexturedLine,this.shaders={geometry:new Ze},this.symbologyPlane=V.uC.LINE}render(e,t){const{context:i,painter:n,pixelRatio:r}=e,s=t.instance.getInput();n.setShader({shader:this.shaders.geometry,uniforms:{...(0,N.r3)(e,t.target,s.uniforms),...(0,N.QA)(e,t.target),antialiasingControls:ce(r),mosaicInfo:n.textureManager.getMosaicInfo(i,t.textureKey)},defines:{...(0,N.vT)(e)},optionalAttributes:s.optionalAttributes,useComputeBuffer:(0,N.Eq)(e)}),n.setPipelineState((0,N.Qu)(e)),n.submitDraw(e,t)}},text:new class extends D{constructor(){super(...arguments),this.type=n.N.Text,this.shaders={geometry:new Be},this.symbologyPlane=V.uC.TEXT}render(e,t){const{context:i,painter:n}=e,r=(0,N.vT)(e),s=t.instance.getInput(),o={shader:this.shaders.geometry,uniforms:{...(0,N.r3)(e,t.target,s.uniforms),...(0,N.QA)(e,t.target),mosaicInfo:n.textureManager.getMosaicInfo(i,t.textureKey)},defines:{...r,isBackgroundPass:!0,isLabel:!1,textRenderPassType:Le.Color},optionalAttributes:s.optionalAttributes,useComputeBuffer:(0,N.Eq)(e)};n.setShader(o),n.setPipelineState((0,N.Qu)(e)),n.submitDraw(e,t),n.setShader({...o,defines:{...r,isBackgroundPass:!1,isLabel:!1,textRenderPassType:Le.Halo}}),n.submitDraw(e,t),n.setShader({...o,defines:{...r,isBackgroundPass:!1,isLabel:!1,textRenderPassType:Le.Outline}}),n.submitDraw(e,t),n.setShader({...o,defines:{...r,isBackgroundPass:!1,isLabel:!1,textRenderPassType:Le.Color}}),n.submitDraw(e,t)}},label:new class extends D{constructor(){super(...arguments),this.type=n.N.Label,this.shaders={geometry:new Be},this.drawPhase=V.S5.LABEL|V.S5.LABEL_ALPHA|V.S5.HITTEST,this.symbologyPlane=V.uC.TEXT}render(e,t){const{context:i,painter:n}=e,r=(0,N.vT)(e),s={...(0,N.Qu)(e)},o=t.instance.getInput(),a={shader:this.shaders.geometry,uniforms:{...(0,N.r3)(e,t.target,o.uniforms),...(0,N.QA)(e,t.target),mosaicInfo:n.textureManager.getMosaicInfo(i,t.textureKey)},defines:{...r,textRenderPassType:Le.Color,isBackgroundPass:!0,isLabel:!0},optionalAttributes:o.optionalAttributes,useComputeBuffer:(0,N.Eq)(e)};n.setShader(a),n.setPipelineState(s),n.submitDraw(e,t),n.setShader({...a,defines:{...r,textRenderPassType:Le.Halo,isBackgroundPass:!1,isLabel:!0}}),n.setPipelineState(s),n.submitDraw(e,t),n.setShader({...a,defines:{...r,textRenderPassType:Le.Color,isBackgroundPass:!1,isLabel:!0}}),n.setPipelineState(s),n.submitDraw(e,t)}},heatmap:new class extends D{constructor(){super(...arguments),this.type=n.N.Heatmap,this.drawPhase=V.S5.MAP|V.S5.HITTEST|V.S5.DEBUG,this.shaders={accumulate:new Te,resolve:new Ce},this._isBound=!1,this._resources=new Map}shutdown(e){super.shutdown(e),this._resources.get(e)?.destroy(),this._resources.delete(e),this._prevFBO=null,this._unbind()}render(e,t){const{context:i,painter:n,state:r}=e,s=t.instance.getInput(),{isFieldActive:o}=s.uniforms,a=this._getOrCreateResourcesRecord(i),l=a.loadQualityProfile(i);(0,N.Eq)(e)||this._bind(e,a,s),n.setShader({shader:this.shaders.accumulate,uniforms:{...(0,N.QA)(e,t.target),kernelControls:{radius:Fe(s,r),isFieldActive:o?1:0}},defines:{...(0,N.vT)(e),...l.defines},optionalAttributes:{},useComputeBuffer:(0,N.Eq)(e)});const u=(0,N.Eq)(e)?Oe:Re;n.setPipelineState(u),n.submitDraw(e,t)}getStencilReference(e){return Ee(e)}renderResolvePass(e,t){if((0,N.Eq)(e))return;const{context:i,painter:n}=e,r=this._resources.get(i);if(null==this._prevFBO||null==this._prevViewport||!r?.initialized)return;const{defines:s}=r.loadQualityProfile(i),{minDensity:o,maxDensity:a,radius:l}=t.getInput().uniforms,u=r.accumulateFramebuffer,c=r.resolveGradientTexture,h={shader:this.shaders.resolve,uniforms:{accumulatedDensity:{texture:{unit:8,texture:u.colorTexture},minAndInvRange:[o,1/(a-o)],normalization:3/(l*l*Math.PI)},gradient:{texture:{unit:9,texture:c}}},defines:s,optionalAttributes:{},useComputeBuffer:!1};i.bindFramebuffer(this._prevFBO),i.setViewport(0,0,this._prevViewport.width,this._prevViewport.height),i.bindTexture(u.colorTexture,8),i.bindTexture(c,9),n.setPipelineState(ze),n.submitDrawMesh(i,h,n.quadMesh),this._unbind()}_getOrCreateResourcesRecord(e){let t=this._resources.get(e);return null==t&&(t=new ve,this._resources.set(e,t)),t}_unbind(){this._prevFBO=null,this._prevViewport=null,this._isBound=!1}_bind(e,t,i){if(this._isBound)return;const{context:n,state:r,pixelRatio:s}=e,o=n.getBoundFramebufferObject(),a=n.getViewport();this._prevFBO=o,this._prevViewport=a;const{gradient:l,gradientHash:u}=i.uniforms;t.ensureResolveGradientTexture(n,u,l);const{width:c,height:h}=a,d=function(e,t){const i=t>1.5?.25:.5;return e<1/(2*i)?1:i}(Fe(i,r),s),f=c*d,p=h*d,m=t.ensureAccumulateFBO(n,f,p);n.blitFramebuffer(o,m,0,0,o.width,o.height,0,0,m.width,m.height,ee.NV.STENCIL,ee.Cj.NEAREST),n.bindFramebuffer(m),n.setViewport(0,0,m.width,m.height),n.setColorMask(!0,!0,!0,!0),n.setClearColor(0,0,0,0),n.clear(ee.NV.COLOR),this._isBound=!0}},dotDensity:new class extends D{constructor(){super(...arguments),this.type=n.N.DotDensity,this.shaders={polygon:new K,point:new $,fill:new le.z},this._resources=new Map}render(e,t){(0,N.dJ)(e)||(0,N.Eq)(e)?this._renderPolygons(e,t):this._renderDotDensity(e,t)}_renderPolygons(e,t){const{painter:i}=e;i.setShader({shader:this.shaders.fill,uniforms:{...(0,N.QA)(e,t.target),visualVariableColor:null,visualVariableOpacity:null},defines:{...(0,N.vT)(e)},optionalAttributes:{zoomRange:!1},useComputeBuffer:(0,N.Eq)(e)}),i.setPipelineState((0,N.Qu)(e)),i.submitDraw(e,t)}_renderDotDensity(e,t){const{context:i,painter:n,requiredLevel:r}=e,s=t.instance.getInput().uniforms,o=this._getOrCreateResourcesRecord(i),a=o.getDotDensityTextures(i,B.CQ,s.seed),l=1/2**(r-t.target.key.level),u=B.CQ,c=u*window.devicePixelRatio*u*window.devicePixelRatio,h=1/l*(1/l),d=s.dotScale?e.state.scale/s.dotScale:1,f=s.dotValue*d*h;n.setShader({shader:this.shaders.polygon,uniforms:{...(0,N.QA)(e,t.target),instance:{isActive:s.isActive,colors:s.colors,dotValue:Math.max(1,f)},draw:{dotTexture0:{unit:B.Cp,texture:a[0]},dotTexture1:{unit:B.vN,texture:a[1]},tileZoomFactor:l,pixelRatio:window.devicePixelRatio,tileDotsOverArea:c/(B.CQ*window.devicePixelRatio*B.CQ*window.devicePixelRatio)}},defines:{...(0,N.vT)(e),blending:s.blending},optionalAttributes:{},useComputeBuffer:!1});const p=i.getViewport();i.setViewport(0,0,B.CQ,B.CQ);const m=i.getBoundFramebufferObject(),_=o.getFBO(i);i.bindFramebuffer(_),i.setClearColor(0,0,0,0),i.clear(ee.NV.COLOR),n.setPipelineState({color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1}),n.updatePipelineState(i),n.submitDraw(e,t),i.bindFramebuffer(m),i.setViewport(p.x,p.y,p.width,p.height);const g=o.getFBO(i).colorTexture,y={shader:this.shaders.point,uniforms:{view:(0,N.L4)(e,t.target),instance:{dotSize:s.dotSize},draw:{locations:{unit:B.Cp,texture:g},tileZoomFactor:1,pixelRatio:window.devicePixelRatio}},defines:{...(0,N.vT)(e)},optionalAttributes:{},useComputeBuffer:!1};n.setPipelineState((0,N.Qu)(e)),n.submitDrawMesh(i,y,o.getDotDensityMesh(i,(0,U.V)(this.shaders.point)))}shutdown(e){super.shutdown(e),this._resources.get(e)?.destroy(),this._resources.delete(e)}_getOrCreateResourcesRecord(e){let t=this._resources.get(e);return null==t&&(t=new ae,this._resources.set(e,t)),t}},animatedMarker:new class extends k{constructor(){super(...arguments),this.type=n.N.AnimatedMarker,this.shaders={geometry:new O}}}};function ut(){for(const e in lt)lt[e].startup()}function ct(e){for(const t in lt)lt[t].shutdown(e)}},81728:function(e,t,i){var n;i.d(t,{N:function(){return n}}),function(e){e[e.AnimatedMarker=0]="AnimatedMarker",e[e.Blend=1]="Blend",e[e.ComplexFill=2]="ComplexFill",e[e.ComplexOutlineFill=3]="ComplexOutlineFill",e[e.DotDensity=4]="DotDensity",e[e.Fill=5]="Fill",e[e.Grid=6]="Grid",e[e.Heatmap=7]="Heatmap",e[e.Label=8]="Label",e[e.Line=9]="Line",e[e.Magnifier=10]="Magnifier",e[e.Marker=11]="Marker",e[e.OutlineFill=12]="OutlineFill",e[e.Overlay=13]="Overlay",e[e.PatternFill=14]="PatternFill",e[e.PatternOutlineFill=15]="PatternOutlineFill",e[e.PieChart=16]="PieChart",e[e.Test=17]="Test",e[e.Text=18]="Text",e[e.TexturedLine=19]="TexturedLine"}(n||(n={}))},97473:function(e,t,i){i.d(t,{c:function(){return n}});const n={bitset:{isSDF:0,isMapAligned:1,scaleSymbolsProportionally:2,overrideOutlineColor:3,colorLocked:4,isStroke:5}}},5544:function(e,t,i){i.d(t,{F:function(){return s},q:function(){return o}});var n=i(85475),r=i(85456);function s(e,t,i,s){const o=i.packPrecisionFactor??1;switch(i.type){case r.pe.BYTE:if(1===i.count)e.setInt8(s+i.offset,t*o);else for(let n=0;n<i.count;n++){const r=n*Int8Array.BYTES_PER_ELEMENT;e.setInt8(s+i.offset+r,t[n]*o)}break;case r.pe.UNSIGNED_BYTE:if(1===i.count)e.setUint8(s+i.offset,t*o);else for(let n=0;n<i.count;n++){const r=n*Uint8Array.BYTES_PER_ELEMENT;e.setUint8(s+i.offset+r,t[n]*o)}break;case r.pe.SHORT:if(1===i.count)e.setInt16(s+i.offset,t*o,!0);else for(let n=0;n<i.count;n++){const r=n*Int16Array.BYTES_PER_ELEMENT;e.setInt16(s+i.offset+r,t[n]*o,!0)}break;case r.pe.UNSIGNED_SHORT:if(1===i.count)e.setUint16(s+i.offset,t*o,!0);else for(let n=0;n<i.count;n++){const r=n*Uint16Array.BYTES_PER_ELEMENT;e.setUint16(s+i.offset+r,t[n]*o,!0)}break;case r.pe.INT:if(1===i.count)e.setInt32(s+i.offset,t*o,!0);else for(let n=0;n<i.count;n++){const r=n*Int32Array.BYTES_PER_ELEMENT;e.setInt32(s+i.offset+r,t[n]*o,!0)}break;case r.pe.UNSIGNED_INT:if(1===i.count)e.setUint32(s+i.offset,t*o,!0);else for(let n=0;n<i.count;n++){const r=n*Uint32Array.BYTES_PER_ELEMENT;e.setUint32(s+i.offset+r,t[n]*o,!0)}break;case r.pe.FLOAT:if(1===i.count)e.setFloat32(s+i.offset,t*o,!0);else for(let n=0;n<i.count;n++){const r=n*Float32Array.BYTES_PER_ELEMENT;e.setFloat32(s+i.offset+r,t[n]*o,!0)}break;case r.pe.HALF_FLOAT:if(1===i.count)e.setUint16(s+i.offset,(0,n.fw)(t*o),!0);else for(let r=0;r<i.count;r++){const a=r*Uint16Array.BYTES_PER_ELEMENT;e.setUint16(s+i.offset+a,(0,n.fw)(t[r]*o),!0)}}}function o(e,t,i){switch(t.type){case r.pe.BYTE:{if(1===t.count)return e.getInt8(i+t.offset);const n=[];for(let r=0;r<t.count;r++){const s=r*Int8Array.BYTES_PER_ELEMENT;n.push(e.getInt8(i+t.offset+s))}return n}case r.pe.UNSIGNED_BYTE:{if(1===t.count)return e.getUint8(i+t.offset);const n=[];for(let r=0;r<t.count;r++){const s=r*Uint8Array.BYTES_PER_ELEMENT;n.push(e.getUint8(i+t.offset+s))}return n}case r.pe.SHORT:{if(1===t.count)return e.getInt16(i+t.offset,!0);const n=[];for(let r=0;r<t.count;r++){const s=r*Int16Array.BYTES_PER_ELEMENT;n.push(e.getInt16(i+t.offset+s,!0))}return n}case r.pe.UNSIGNED_SHORT:{if(1===t.count)return e.getUint16(i+t.offset,!0);const n=[];for(let r=0;r<t.count;r++){const s=r*Uint16Array.BYTES_PER_ELEMENT;n.push(e.getUint16(i+t.offset+s,!0))}return n}case r.pe.INT:{if(1===t.count)return e.getInt32(i+t.offset,!0);const n=[];for(let r=0;r<t.count;r++){const s=r*Int32Array.BYTES_PER_ELEMENT;n.push(e.getInt32(i+t.offset+s,!0))}return n}case r.pe.UNSIGNED_INT:{if(1===t.count)return e.getUint32(i+t.offset,!0);const n=[];for(let r=0;r<t.count;r++){const s=r*Uint32Array.BYTES_PER_ELEMENT;n.push(e.getUint32(i+t.offset+s,!0))}return n}case r.pe.FLOAT:{if(1===t.count)return e.getFloat32(i+t.offset,!0);const n=[];for(let r=0;r<t.count;r++){const s=r*Float32Array.BYTES_PER_ELEMENT;n.push(e.getFloat32(i+t.offset+s,!0))}return n}case r.pe.HALF_FLOAT:{if(1===t.count)return(0,n.Kl)(e.getUint16(i+t.offset,!0));const r=[];for(let s=0;s<t.count;s++){const o=s*Uint16Array.BYTES_PER_ELEMENT;r.push((0,n.Kl)(e.getUint16(i+t.offset+o,!0)))}return r}}}},86329:function(e,t,i){function n(e){return e}function r(e){return e}i.d(t,{P:function(){return n},U:function(){return r}})},25731:function(e,t,i){i.d(t,{Ph:function(){return s},Z0:function(){return a},hU:function(){return r}});var n=i(50944);function r(e){const t=e.map((({name:e,count:t,type:i})=>`${e}.${t}.${i}`)).join(",");return(0,n.Wm)(t)}function s(e,t,i,n,r,o,a){if(e.primitiveName===t){let t=n?.readWithDefault(r,o,e[i]&&a);return"text"===e.type&&(t=t.toString()),void(e[i]=t)}if("type"in e&&null!=e.type){if(e.effects)for(const l of e.effects)s(l,t,i,n,r,o,a);switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.symbolLayers)for(const l of e.symbolLayers)s(l,t,i,n,r,o,a);break;case"CIMTextSymbol":e.symbol&&s(e.symbol,t,i,n,r,o,a);break;case"CIMHatchFill":e.lineSymbol&&s(e.lineSymbol,t,i,n,r,o,a);break;case"CIMPictureMarker":case"CIMCharacterMarker":case"CIMVectorMarker":if(e.markerPlacement&&s(e.markerPlacement,t,i,n,r,o,a),"CIMVectorMarker"===e.type&&e.markerGraphics)for(const l of e.markerGraphics)s(l,t,i,n,r,o,a),s(l.symbol,t,i,n,r,o,a)}}}const o=400;function a(e){const t=e.width;return null!=e.effects?o:Math.max(1.25*t,8)}},33702:function(e,t,i){i.d(t,{f_:function(){return _},$Z:function(){return p},DM:function(){return m},rz:function(){return f}});var n=i(53804),r=i(39686),s=i(98282),o=i(70931),a=i(58941),l=i(86486);class u extends s.k2{getVisualVariableData(e){if(!this._vvData){const t=this.getAttributeDataCoords(e);this._vvData=(0,o.US)(this.visualVariableData,t).setDebugName("storage2")}return this._vvData}getAttributeDataCoords(e){if(!this._uv){const t=(0,l.Kt)(e),i=this.size,n=(0,o.Wh)(t.x),r=(0,o.Wh)(t.y).multiply((0,o.Wh)(256)),s=(0,o.Wh)(t.z).multiply((0,o.Wh)(256)).multiply((0,o.Wh)(256)),a=(0,o.fV)(n.add(r).add(s)),u=(0,o.zi)(a,i),c=a.subtract(u).divide(i);this._uv=new o.ZY(u,c).add(.5).divide(i)}return this._uv}getFilterData(e){const t=this.getAttributeDataCoords(e);return(0,o.US)(this.filterFlags,t).setDebugName("storage0")}getAnimationData(e){const t=this.getAttributeDataCoords(e);return(0,o.US)(this.animation,t).setDebugName("storage1")}getVVData(e){return this.getVisualVariableData(e)}getDataDrivenData0(e){const t=this.getAttributeDataCoords(e);return(0,o.US)(this.dataDriven0,t).setDebugName("storage30")}getDataDrivenData1(e){const t=this.getAttributeDataCoords(e);return(0,o.US)(this.dataDriven1,t).setDebugName("storage31")}getDataDrivenData2(e){const t=this.getAttributeDataCoords(e);return(0,o.US)(this.dataDriven2,t).setDebugName("storage32")}getGPGPUData(e){const t=this.getAttributeDataCoords(e);return(0,o.US)(this.gpgpu,t).setDebugName("storage4")}getLocalTimeOrigin(e){const t=this.getAttributeDataCoords(e);return(0,o.US)(this.localTimeOrigin,t).x.setDebugName("storage5")}getFilterFlags(e){return(0,a.A)("webgl-ignores-sampler-precision")?(0,o.mk)(this.getFilterData(e).x.multiply((0,o.fV)(255))):this.getFilterData(e).x.multiply((0,o.fV)(255))}getLabelVisibility(e){const t=this.getFilterData(e).y.multiply(255);return new o.nt(1).subtract(t)}getAnimationValue(e){return this.getAnimationData(e).x}getSizeValue(e){return this.getVisualVariableData(e).x}getColorValue(e){return this.getVisualVariableData(e).y}getOpacityValue(e){return this.getVisualVariableData(e).z}getRotationValue(e){return this.getVisualVariableData(e).w}}(0,n._)([(0,s.Pi)(o.z7)],u.prototype,"filterFlags",void 0),(0,n._)([(0,s.Pi)(o.z7)],u.prototype,"animation",void 0),(0,n._)([(0,s.Pi)(o.z7)],u.prototype,"gpgpu",void 0),(0,n._)([(0,s.Pi)(o.z7)],u.prototype,"localTimeOrigin",void 0),(0,n._)([(0,s.Pi)(o.z7)],u.prototype,"visualVariableData",void 0),(0,n._)([(0,s.Pi)(o.z7)],u.prototype,"dataDriven0",void 0),(0,n._)([(0,s.Pi)(o.z7)],u.prototype,"dataDriven1",void 0),(0,n._)([(0,s.Pi)(o.z7)],u.prototype,"dataDriven2",void 0),(0,n._)([(0,s.Pi)(o.nt)],u.prototype,"size",void 0);class c extends s.k2{}(0,n._)([(0,s.Pi)(o.nt)],c.prototype,"activeReasons",void 0),(0,n._)([(0,s.Pi)(o.nt)],c.prototype,"highlightAll",void 0);class h extends s.k2{}(0,n._)([(0,s.Pi)(o.ZY)],h.prototype,"position",void 0),(0,n._)([(0,s.Pi)(o.nt)],h.prototype,"distance",void 0),(0,n._)([(0,s.Pi)(o.nt)],h.prototype,"smallSymbolDistance",void 0),(0,n._)([(0,s.Pi)(o.nt)],h.prototype,"smallSymbolSizeThreshold",void 0);var d=i(64522);class f extends s.ZA{}(0,n._)([(0,s.C5)(0,o.eB)],f.prototype,"id",void 0),(0,n._)([(0,s.C5)(1,o.nt)],f.prototype,"bitset",void 0),(0,n._)([(0,s.C5)(2,o.ZY)],f.prototype,"pos",void 0);class p extends s.Y7{}(0,n._)([(0,s.C5)(14,o.ZY)],p.prototype,"nextPos1",void 0),(0,n._)([(0,s.C5)(15,o.ZY)],p.prototype,"nextPos2",void 0);class m extends s.HS{}class _ extends s.A{clip(e,t){let i=new o.nt(0);const n=this.storage.getFilterFlags(e);if(i=i.add((0,o.fV)(2).multiply((0,o.fV)(1).subtract((0,l.i6)(n,0)))),this.inside?i=i.add((0,o.fV)(2).multiply((0,o.fV)(1).subtract((0,l.i6)(n,1)))):this.outside?i=i.add((0,o.fV)(2).multiply((0,l.i6)(n,1))):this.highlight&&(i=i.add((0,o.fV)(2).multiply((0,o.fV)(1).subtract(this._checkHighlight(n))))),null!=t){const e=new o.nt(1).subtract((0,o.PM)(t.x,this.view.currentZoom)),n=(0,o.PM)(t.y,this.view.currentZoom);i=i.add(new o.nt(2).multiply(e.add(n)))}return i}getFragmentOutput(e,t,i=new o.nt(1/255)){const n=new s.mm;return n.glFragColor=this._maybeWriteHittest(t)??this._maybeHighlight(e,i)??e,n}_maybeHighlight(e,t){return this.highlight?new o.Zb(e.rgb,(0,o.PM)(t,e.a)):null}_checkHighlight(e){let t=this._checkHighlightBit(e,0);for(let i=1;i<r.U5;i++)t=t.add(this._checkHighlightBit(e,i));return(0,o.PM)(new o.nt(.1),t.add(this.highlight.highlightAll))}_checkHighlightBit(e,t){return(0,l.yS)(e,t).multiply((0,l.mh)(this.highlight.activeReasons,t))}maybeRunHittest(e,t,i){if(null==this.hittestRequest)return null;const n=this.hittest(e,t,i);let r=(0,o.Tk)((0,o.MM)(n,this.hittestRequest.distance),new o.nt(2),new o.nt(0));const s=this.storage.getAttributeDataCoords(e.id),a=(0,l.nb)(s);r=r.add(this.clip(e.id,e.zoomRange));const u=new o.Zb(new o.nt(1/255),0,0,0);return{glPointSize:new o.nt(1),glPosition:new o.Zb(a,r,1),color:u}}_maybeWriteHittest(e){return null!=this.hittestRequest?e.color:null}}(0,n._)([s.E8],_.prototype,"inside",void 0),(0,n._)([s.E8],_.prototype,"outside",void 0),(0,n._)([(0,s.uK)(c)],_.prototype,"highlight",void 0),(0,n._)([(0,s.Pi)(u)],_.prototype,"storage",void 0),(0,n._)([(0,s.Pi)(d.o)],_.prototype,"view",void 0),(0,n._)([(0,s.uK)(h)],_.prototype,"hittestRequest",void 0)},58991:function(e,t,i){i.d(t,{Bh:function(){return m},KP:function(){return p},Ps:function(){return _}});var n=i(53804),r=i(98282),s=i(70931),o=i(33702),a=i(40846),l=i(42203),u=i(31299),c=i(39979),h=i(86486);class d extends l._{}(0,n._)([(0,r.C5)(5,s.Zb)],d.prototype,"tlbr",void 0),(0,n._)([(0,r.C5)(6,s.nt)],d.prototype,"width",void 0),(0,n._)([(0,r.C5)(7,s.nt)],d.prototype,"height",void 0),(0,n._)([(0,r.C5)(8,s.ZY)],d.prototype,"offset",void 0),(0,n._)([(0,r.C5)(9,s.ZY)],d.prototype,"scale",void 0),(0,n._)([(0,r.C5)(10,s.nt)],d.prototype,"angle",void 0);class f extends o.DM{}function p(e,t){const i=e.view.requiredZoomFactor,n=new s.ZY(t.width,t.height),r=n.multiply(t.scale).multiply(i),o=t.angle.multiply(a.rp),l=(0,s.F8)(o),u=(0,s.gn)(o),c=function(e,t,i,n,r){const o=(0,s.LC)((0,h.mh)(r,a.Fz),(0,s.fV)(1)),l=(0,h.Rj)(new s.Zb(e,0));return(0,s.Tk)(o,(0,s.w0)(n.divide(t.x),i.divide(t.y),0,(0,s.ze)(i.divide(t.x)),n.divide(t.y),0,(0,h._9)((0,s.Zc)(l,0)),(0,h._9)((0,s.Zc)(0,l)),1),(0,s.w0)(n.divide(t.x),i.divide(t.y),0,(0,s.ze)(i.divide(t.x)),n.divide(t.y),0,0,0,1))}(t.id,r,l,u,t.bitset),d=e.localTileOffset.getPatternOffsetAtTileOrigin(n,l,u),f=i.multiply(t.scale).multiply(t.offset.subtract(d)).divide(r),p=new s.eB(t.pos,1),m=c.multiply(p).xy.subtract(f),_=t.tlbr.divide(e.mosaicInfo.size.xyxy);let g=(0,h.mh)(t.bitset,a.cn);return null!=e.visualVariableColor&&(g=(0,s.Tk)((0,h.M8)(e.storage.getColorValue(t.id)),new s.nt(0),g)),{tileTextureCoord:m,tlbr:_,sampleAlphaOnly:g}}function m(e,t){const i=(0,s.zi)(t.tileTextureCoord,new s.nt(1)),n=(0,s.jh)(t.tlbr.xy,t.tlbr.zw,i);let r=(0,s.US)(e.mosaicInfo.texture,n);return r=(0,s.Tk)((0,s.MM)(t.sampleAlphaOnly,new s.nt(.5)),r.aaaa,r),t.color.multiply(r)}class _ extends l.z{vertex(e,t){return{...super.vertex(e,t),...p(this,e)}}fragment(e){const t=m(this,e);return this.getFragmentOutput(t,e,new s.nt(0))}}(0,n._)([(0,r.Pi)(c.b)],_.prototype,"mosaicInfo",void 0),(0,n._)([(0,r.Pi)(u.P)],_.prototype,"localTileOffset",void 0),(0,n._)([(0,n.a)(0,(0,r.hF)(d)),(0,n.a)(1,(0,r.hF)(o.$Z))],_.prototype,"vertex",null),(0,n._)([(0,n.a)(0,(0,r.hF)(f))],_.prototype,"fragment",null)},47461:function(e,t,i){i.d(t,{RH:function(){return v},cZ:function(){return p},v9:function(){return _}});var n=i(53804),r=i(98282),s=i(70931),o=i(33702),a=i(58991),l=i(66425),u=i(59224),c=i(31299),h=i(39979),d=i(54537),f=i(15087);const p=16,m=1/p,_=128;class g extends o.rz{}(0,n._)([(0,r.C5)(3,s.Zb)],g.prototype,"color",void 0),(0,n._)([(0,r.C5)(4,s.Zb)],g.prototype,"tlbr",void 0),(0,n._)([(0,r.C5)(5,s.nt)],g.prototype,"angle",void 0),(0,n._)([(0,r.C5)(6,s.nt)],g.prototype,"aux1",void 0),(0,n._)([(0,r.C5)(7,s.nt)],g.prototype,"aux2",void 0),(0,n._)([(0,r.C5)(8,s.ZY)],g.prototype,"aux3",void 0),(0,n._)([(0,r.C5)(9,s.ZY)],g.prototype,"aux4",void 0),(0,n._)([(0,r.C5)(10,s.ZY)],g.prototype,"zoomRange",void 0);class y extends f.A1{}class v extends d.My{vertex(e,t){const{aux1:i,aux2:n,aux3:r,aux4:o}=e,l={...e,width:i,height:n,offset:r,scale:o.multiply(m)},u={...e,halfWidth:i,referenceHalfWidth:n,offset:r,normal:o.subtract(_).multiply(m)},c=(0,d.Yb)(this,u),h=(0,a.KP)(this,l),f=(0,s.MM)(c.isOutline,new s.nt(.5));return{...c,...h,...this.maybeRunHittest(e,t,f)}}fragment(e){const{isOutline:t}=e,i=(0,s.MM)(t,new s.nt(.5)),n=(0,u.o7)(e,this.antialiasingControls.blur),r=(0,a.Bh)(this,e),o=(0,s.Tk)(i,n,r),l=(0,s.Tk)(i,new s.nt(1/255),new s.nt(0));return this.getFragmentOutput(o,e,l)}hittest(e,t,i){return(0,s.Tk)(i,(0,l.My)(this.hittestRequest),(0,l.Lq)(this,e,t))}}(0,n._)([(0,r.Pi)(h.b)],v.prototype,"mosaicInfo",void 0),(0,n._)([(0,r.Pi)(c.P)],v.prototype,"localTileOffset",void 0),(0,n._)([(0,n.a)(0,(0,r.hF)(g)),(0,n.a)(1,(0,r.hF)(o.$Z))],v.prototype,"vertex",null),(0,n._)([(0,n.a)(0,(0,r.hF)(y))],v.prototype,"fragment",null)},42203:function(e,t,i){i.d(t,{_:function(){return h},z:function(){return d}});var n=i(53804),r=i(98282),s=i(70931),o=i(33702),a=i(66425),l=i(81432),u=i(12026),c=i(90906);class h extends o.rz{}(0,n._)([(0,r.C5)(3,s.Zb)],h.prototype,"color",void 0),(0,n._)([(0,r.C5)(4,s.ZY)],h.prototype,"zoomRange",void 0);class d extends o.f_{constructor(){super(...arguments),this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(e,t){const i=(0,c.cF)(this,e.id),n=(0,c.G7)(this,e.id,e.color).multiply(i),r=this.view.displayViewScreenMat3.multiply(new s.eB(e.pos.xy,1)),o=this.clip(e.id,e.zoomRange);return{glPosition:new s.Zb(r.xy,o,1),color:n,...this.maybeRunHittest(e,t,null)}}fragment(e){return this.getFragmentOutput(e.color,e,new s.nt(0))}hittest(e,t){return(0,a.Lq)(this,e,t)}}(0,n._)([(0,r.uK)(l._)],d.prototype,"visualVariableColor",void 0),(0,n._)([(0,r.uK)(u.i)],d.prototype,"visualVariableOpacity",void 0),(0,n._)([(0,n.a)(0,(0,r.hF)(h)),(0,n.a)(1,(0,r.hF)(o.$Z))],d.prototype,"vertex",null),(0,n._)([(0,n.a)(0,(0,r.hF)(o.DM))],d.prototype,"fragment",null)},59224:function(e,t,i){i.d(t,{$0:function(){return b},Xc:function(){return _},cM:function(){return w},fF:function(){return g},fg:function(){return y},o7:function(){return S},xw:function(){return x}});var n=i(53804),r=i(98282),s=i(70931),o=i(33702),a=i(40846),l=i(66425),u=i(81432),c=i(12026),h=i(13635),d=i(21385),f=i(21813),p=i(76347),m=i(90906);class _ extends o.rz{}(0,n._)([(0,r.C5)(3,s.Zb)],_.prototype,"color",void 0),(0,n._)([(0,r.C5)(4,s.ZY)],_.prototype,"offset",void 0),(0,n._)([(0,r.C5)(5,s.ZY)],_.prototype,"normal",void 0),(0,n._)([(0,r.C5)(6,s.nt)],_.prototype,"halfWidth",void 0),(0,n._)([(0,r.C5)(7,s.nt)],_.prototype,"referenceHalfWidth",void 0),(0,n._)([(0,r.C5)(8,s.ZY)],_.prototype,"zoomRange",void 0);class g extends o.DM{}class y extends r.k2{}function v(e){return(0,s.T9)(new s.nt(a.Fb).multiply((0,s.PM)(e,new s.nt(a.J5))),new s.nt(1))}function x(e,t){const{halfWidth:i,normal:n}=e,r=v(i),o=(0,s.Bw)(n).multiply(i);return(0,s.qE)(r.multiply(i.subtract(o)).divide(t.add(r).subtract(new s.nt(1))),new s.nt(0),new s.nt(1))}function b(e,t){const{id:i,offset:n,pos:r,normal:o,zoomRange:l}=t,{displayViewScreenMat3:u,displayViewMat3:c}=e.view,h=(0,m.G7)(e,i,t.color),d=(0,m.cF)(e,i),f=function(e,t){const{id:i,halfWidth:n,referenceHalfWidth:r}=t;if((0,m.G5)(e)){const t=new s.nt(2).multiply(r),o=(0,m.Mg)(e,i,t);return new s.nt(.5).multiply(n.divide((0,s.T9)(r,new s.nt(a.Ni)))).multiply(o)}return n}(e,t),p=new s.nt(.5).multiply(e.antialiasingControls.antialiasing),_=(0,s.T9)(f.add(p),new s.nt(.45)).add(new s.nt(.1).multiply(p)),g=v(_).multiply(_).multiply(n),y=c.multiply(new s.eB(g,new s.nt(0))),x=u.multiply(new s.eB(r,new s.nt(1))).add(y),b=new s.nt(2).multiply((0,s.PM)(f,new s.nt(0))).add(e.clip(i,l)),S=new s.Zb(x.xy,b,1);return{color:h,opacity:d,halfWidth:_,normal:o,scaledOffset:g,scaledHalfWidth:f,glPosition:new s.Zb(S.xy,b,1)}}function S(e,t){const{opacity:i,color:n}=e,r=x(e,t);return i.multiply(n).multiply(r)}(0,n._)([(0,r.Pi)(s.nt)],y.prototype,"antialiasing",void 0),(0,n._)([(0,r.Pi)(s.nt)],y.prototype,"blur",void 0);class w extends o.f_{constructor(){super(...arguments),this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(e,t){const i=b(this,e);return{...i,...this.maybeRunHittest(e,t,i.halfWidth)}}fragment(e){const t=S(e,this.antialiasingControls.blur);return this.getFragmentOutput(t,e)}hittest(e,t,i){const{viewMat3:n,tileMat3:r}=this.view,o=n.multiply(r),a=o.multiply(new s.eB(e.pos,1)),u=o.multiply(new s.eB(t.nextPos1,1)),c=o.multiply(new s.eB(t.nextPos2,1)),{distance:h,smallSymbolDistance:d,smallSymbolSizeThreshold:f}=this.hittestRequest,p=(0,s.PM)(i,f.multiply(.5)).multiply(h.subtract(d)),m=this.hittestRequest.position;return(0,s.jk)((0,l.E2)(m,a.xy,u.xy),(0,l.E2)(m,a.xy,c.xy)).subtract(i).add(p)}}(0,n._)([(0,r.Pi)(y)],w.prototype,"antialiasingControls",void 0),(0,n._)([(0,r.uK)(u._)],w.prototype,"visualVariableColor",void 0),(0,n._)([(0,r.uK)(c.i)],w.prototype,"visualVariableOpacity",void 0),(0,n._)([(0,r.uK)(h.n)],w.prototype,"visualVariableSizeMinMaxValue",void 0),(0,n._)([(0,r.uK)(d.F)],w.prototype,"visualVariableSizeScaleStops",void 0),(0,n._)([(0,r.uK)(f.N)],w.prototype,"visualVariableSizeStops",void 0),(0,n._)([(0,r.uK)(p.d)],w.prototype,"visualVariableSizeUnitValue",void 0),(0,n._)([(0,n.a)(0,(0,r.hF)(_)),(0,n.a)(1,(0,r.hF)(o.$Z))],w.prototype,"vertex",null),(0,n._)([(0,n.a)(0,(0,r.hF)(g))],w.prototype,"fragment",null)},31299:function(e,t,i){i.d(t,{P:function(){return a}});var n=i(53804),r=i(98282),s=i(70931),o=i(40846);class a extends r.k2{getPatternOffsetAtTileOrigin(e,t=new s.nt(0),i=new s.nt(1)){const n=new s.ZY(o.YV).divide(e);let r=e.multiply((0,s.jc)(this.maxIntsToLocalOrigin.multiply(n))).add(this.tileOffsetFromLocalOrigin).subtract(new s.nt(.5).multiply(e));return r=new s.ZY(r.x.multiply(i).subtract(r.y.multiply(t)),r.x.multiply(t).add(r.y.multiply(i))),(0,s.zi)(r,e)}}(0,n._)([(0,r.Pi)(s.ZY)],a.prototype,"tileOffsetFromLocalOrigin",void 0),(0,n._)([(0,r.Pi)(s.ZY)],a.prototype,"maxIntsToLocalOrigin",void 0)},39979:function(e,t,i){i.d(t,{b:function(){return o}});var n=i(53804),r=i(98282),s=i(70931);class o extends r.k2{}(0,n._)([(0,r.Pi)(s.ZY)],o.prototype,"size",void 0),(0,n._)([(0,r.Pi)(s.z7)],o.prototype,"texture",void 0)},54537:function(e,t,i){i.d(t,{A7:function(){return v},My:function(){return b},Yb:function(){return x},nj:function(){return S},wG:function(){return y}});var n=i(53804),r=i(98282),s=i(70931),o=i(33702),a=i(40846),l=i(66425),u=i(59224),c=i(86486),h=i(81432),d=i(12026),f=i(13635),p=i(21385),m=i(21813),_=i(76347),g=i(90906);class y extends o.rz{}(0,n._)([(0,r.C5)(3,s.ZY)],y.prototype,"offset",void 0),(0,n._)([(0,r.C5)(4,s.Zb)],y.prototype,"color",void 0),(0,n._)([(0,r.C5)(5,s.ZY)],y.prototype,"normal",void 0),(0,n._)([(0,r.C5)(6,s.nt)],y.prototype,"halfWidth",void 0),(0,n._)([(0,r.C5)(7,s.nt)],y.prototype,"referenceHalfWidth",void 0),(0,n._)([(0,r.C5)(8,s.ZY)],y.prototype,"zoomRange",void 0);class v extends u.fF{}function x(e,t,i){const{id:n,bitset:r}=t,o=(0,c.mh)(r,a.Xx),l=(0,s.MM)(o,new s.nt(.5)),h=(0,u.$0)(e,t),d=(0,s.Tk)(l,h.halfWidth,new s.nt(0)),f=(0,g.cF)(e,n),p=(0,g.G7)(e,n,t.color),m=(0,s.Tk)(l,t.color,p.multiply(f)),_=e.view.displayViewScreenMat3.multiply(new s.eB(t.pos.xy,1)),y=e.clip(t.id),v=new s.Zb(_.xy,y,1),x=(0,s.Tk)(l,h.glPosition,v),b=i&&e.maybeRunHittest(t,i,l);return{isOutline:o,color:m,opacity:new s.nt(1),halfWidth:d,normal:h.normal,glPosition:x,...b}}class b extends o.f_{constructor(){super(...arguments),this.computeAttributes={pos:["nextPos1","nextPos2"]}}}(0,n._)([(0,r.Pi)(u.fg)],b.prototype,"antialiasingControls",void 0),(0,n._)([(0,r.uK)(h._)],b.prototype,"visualVariableColor",void 0),(0,n._)([(0,r.uK)(d.i)],b.prototype,"visualVariableOpacity",void 0),(0,n._)([(0,r.uK)(f.n)],b.prototype,"visualVariableSizeMinMaxValue",void 0),(0,n._)([(0,r.uK)(p.F)],b.prototype,"visualVariableSizeScaleStops",void 0),(0,n._)([(0,r.uK)(m.N)],b.prototype,"visualVariableSizeStops",void 0),(0,n._)([(0,r.uK)(_.d)],b.prototype,"visualVariableSizeUnitValue",void 0);class S extends b{vertex(e,t){return x(this,e,t)}fragment(e){const{color:t,isOutline:i}=e,n=(0,s.MM)(i,new s.nt(.5)),r=(0,u.o7)(e,this.antialiasingControls.blur),o=(0,s.Tk)(n,r,t),a=(0,s.Tk)(n,new s.nt(1/255),new s.nt(0));return this.getFragmentOutput(o,e,a)}hittest(e,t,i){return(0,s.Tk)(i,(0,l.My)(this.hittestRequest),(0,l.Lq)(this,e,t))}}(0,n._)([(0,n.a)(0,(0,r.hF)(y)),(0,n.a)(1,(0,r.hF)(o.$Z))],S.prototype,"vertex",null),(0,n._)([(0,n.a)(0,(0,r.hF)(v))],S.prototype,"fragment",null)},51741:function(e,t,i){i.d(t,{_u:function(){return d},dW:function(){return f},vx:function(){return p}});var n=i(53804),r=i(98282),s=i(70931),o=i(33702),a=i(42203),l=i(31299),u=i(39979);class c extends a._{}(0,n._)([(0,r.C5)(5,s.Zb)],c.prototype,"tlbr",void 0),(0,n._)([(0,r.C5)(6,s.nt)],c.prototype,"inverseRasterizationScale",void 0);class h extends o.DM{}function d(e,t){const i=t.tlbr.xy,n=t.tlbr.zw,r=n.x.subtract(i.x),o=i.y.subtract(n.y),a=new s.ZY(r,o).multiply(t.inverseRasterizationScale),l=a.multiply(e.view.requiredZoomFactor),u=function(e){const t=new s.nt(1),i=new s.nt(0);return new s.U(t.divide(e.x),i.divide(e.y),0,(0,s.ze)(i.divide(e.x)),t.divide(e.y),0,0,0,1)}(l),c=e.localTileOffset.getPatternOffsetAtTileOrigin(a).divide(l),h=new s.eB(t.pos,1);return{tileTextureCoord:u.multiply(h).xy.subtract(c),tlbr:t.tlbr.divide(e.mosaicInfo.size.xyxy)}}function f(e,t){const i=(0,s.zi)(e.tileTextureCoord,new s.nt(1)),n=(0,s.jh)(e.tlbr.xy,e.tlbr.zw,i),r=(0,s.US)(t.texture,n);return e.color.multiply(r)}class p extends a.z{vertex(e,t){return{...super.vertex(e,t),...d(this,e)}}fragment(e){const t=f(e,this.mosaicInfo);return this.getFragmentOutput(t,e,new s.nt(0))}}(0,n._)([(0,r.Pi)(u.b)],p.prototype,"mosaicInfo",void 0),(0,n._)([(0,r.Pi)(l.P)],p.prototype,"localTileOffset",void 0),(0,n._)([(0,n.a)(0,(0,r.hF)(c)),(0,n.a)(1,(0,r.hF)(o.$Z))],p.prototype,"vertex",null),(0,n._)([(0,n.a)(0,(0,r.hF)(h))],p.prototype,"fragment",null)},15087:function(e,t,i){i.d(t,{A1:function(){return f},tA:function(){return p}});var n=i(53804),r=i(98282),s=i(70931),o=i(33702),a=i(59224),l=i(31299),u=i(39979),c=i(54537),h=i(51741);class d extends c.wG{}(0,n._)([(0,r.C5)(9,s.Zb)],d.prototype,"tlbr",void 0),(0,n._)([(0,r.C5)(10,s.nt)],d.prototype,"inverseRasterizationScale",void 0);class f extends c.A7{}class p extends c.nj{vertex(e,t){return{...(0,c.Yb)(this,e,t),...(0,h._u)(this,e)}}fragment(e){const{isOutline:t}=e,i=(0,s.MM)(t,new s.nt(.5)),n=(0,a.o7)(e,this.antialiasingControls.blur),r=(0,h.dW)(e,this.mosaicInfo),o=(0,s.Tk)(i,n,r),l=(0,s.Tk)(i,new s.nt(1/255),new s.nt(0));return this.getFragmentOutput(o,e,l)}}(0,n._)([(0,r.Pi)(u.b)],p.prototype,"mosaicInfo",void 0),(0,n._)([(0,r.Pi)(l.P)],p.prototype,"localTileOffset",void 0),(0,n._)([(0,n.a)(0,(0,r.hF)(d)),(0,n.a)(1,(0,r.hF)(o.$Z))],p.prototype,"vertex",null),(0,n._)([(0,n.a)(0,(0,r.hF)(f))],p.prototype,"fragment",null)},64522:function(e,t,i){i.d(t,{o:function(){return o}});var n=i(53804),r=i(98282),s=i(70931);class o extends r.k2{}(0,n._)([(0,r.Pi)(s.U)],o.prototype,"displayViewScreenMat3",void 0),(0,n._)([(0,r.Pi)(s.U)],o.prototype,"displayViewMat3",void 0),(0,n._)([(0,r.Pi)(s.U)],o.prototype,"displayMat3",void 0),(0,n._)([(0,r.Pi)(s.U)],o.prototype,"viewMat3",void 0),(0,n._)([(0,r.Pi)(s.U)],o.prototype,"tileMat3",void 0),(0,n._)([(0,r.Pi)(s.nt)],o.prototype,"displayZoomFactor",void 0),(0,n._)([(0,r.Pi)(s.nt)],o.prototype,"requiredZoomFactor",void 0),(0,n._)([(0,r.Pi)(s.ZY)],o.prototype,"tileOffset",void 0),(0,n._)([(0,r.Pi)(s.nt)],o.prototype,"currentScale",void 0),(0,n._)([(0,r.Pi)(s.nt)],o.prototype,"currentZoom",void 0),(0,n._)([(0,r.Pi)(s.nt)],o.prototype,"metersPerSRUnit",void 0),(0,n._)([(0,r.Pi)(s.nt)],o.prototype,"rotation",void 0),(0,n._)([(0,r.Pi)(s.nt)],o.prototype,"pixelRatio",void 0)},81432:function(e,t,i){i.d(t,{_:function(){return a}});var n=i(53804),r=i(98282),s=i(70931),o=i(86486);class a extends r.k2{getColor(e,t,i){return(0,s.j1)([(0,s.or)((0,o.M8)(e),i),t],[(0,s.$5)(e,this.values.first()),this.colors.first()],[(0,s.aX)(e,this.values.last()),this.colors.last()],[!0,()=>{const t=this.values.findIndex((t=>(0,s.MM)(t,e))),i=this.values.get(t),n=t.subtract(1),r=this.values.get(n),o=e.subtract(r).divide(i.subtract(r));return(0,s.jh)(this.colors.get(n),this.colors.get(t),o)}])}}(0,n._)([(0,r.Pi)(s.My.ofType(s.Zb,8))],a.prototype,"colors",void 0),(0,n._)([(0,r.Pi)(s.My.ofType(s.nt,8))],a.prototype,"values",void 0)},12026:function(e,t,i){i.d(t,{i:function(){return a}});var n=i(53804),r=i(98282),s=i(70931),o=i(86486);class a extends r.k2{getOpacity(e){return(0,s.j1)([(0,o.M8)(e),new s.nt(1)],[(0,s.$5)(e,this.opacityValues.first()),this.opacities.first()],[(0,s.aX)(e,this.opacityValues.last()),this.opacities.last()],[!0,()=>{const t=this.opacityValues.findIndex((t=>(0,s.MM)(t,e))),i=this.opacityValues.get(t),n=t.subtract(1),r=this.opacityValues.get(n),o=e.subtract(r).divide(i.subtract(r));return(0,s.jh)(this.opacities.get(n),this.opacities.get(t),o)}])}}(0,n._)([(0,r.Pi)(s.My.ofType(s.nt,8))],a.prototype,"opacities",void 0),(0,n._)([(0,r.Pi)(s.My.ofType(s.nt,8))],a.prototype,"opacityValues",void 0)},13635:function(e,t,i){i.d(t,{n:function(){return a}});var n=i(53804),r=i(98282),s=i(70931),o=i(86486);class a extends r.k2{getSize(e,t){const i=this.minMaxValueAndSize.xy,n=this.minMaxValueAndSize.zw;return(0,s.Tk)((0,o.M8)(e),t,(()=>{const t=e.subtract(i.x).divide(i.y.subtract(i.x)),r=(0,s.qE)(t,new s.nt(0),new s.nt(1));return n.x.add(r.multiply(n.y.subtract(n.x)))}))}}(0,n._)([(0,r.Pi)(s.Zb)],a.prototype,"minMaxValueAndSize",void 0)},21385:function(e,t,i){i.d(t,{F:function(){return o}});var n=i(53804),r=i(98282),s=i(70931);class o extends r.k2{getSizeForViewScale(e){return(0,s.j1)([(0,s.$5)(e,this.values.first()),this.sizes.first()],[(0,s.aX)(e,this.values.last()),this.sizes.last()],[!0,()=>{const t=this.values.findIndex((t=>(0,s.MM)(t,e))),i=this.values.get(t),n=t.subtract(1),r=this.values.get(n),o=e.subtract(r).divide(i.subtract(r));return(0,s.jh)(this.sizes.get(n),this.sizes.get(t),o)}])}}(0,n._)([(0,r.Pi)(s.My.ofType(s.nt,8))],o.prototype,"sizes",void 0),(0,n._)([(0,r.Pi)(s.My.ofType(s.nt,8))],o.prototype,"values",void 0)},21813:function(e,t,i){i.d(t,{N:function(){return a}});var n=i(53804),r=i(98282),s=i(70931),o=i(86486);class a extends r.k2{getSize(e,t){const i=(0,s.j1)([(0,o.M8)(e),t],[(0,s.$5)(e,this.values.first()),this.sizes.first()],[(0,s.aX)(e,this.values.last()),this.sizes.last()],[!0,()=>{const t=this.values.findIndex((t=>(0,s.MM)(t,e))),i=this.values.get(t),n=t.subtract(1),r=this.values.get(n),o=e.subtract(r).divide(i.subtract(r));return(0,s.jh)(this.sizes.get(n),this.sizes.get(t),o)}]);return(0,s.Tk)((0,o.M8)(i),t,i)}}(0,n._)([(0,r.Pi)(s.My.ofType(s.nt,8))],a.prototype,"sizes",void 0),(0,n._)([(0,r.Pi)(s.My.ofType(s.nt,8))],a.prototype,"values",void 0)},76347:function(e,t,i){i.d(t,{d:function(){return a}});var n=i(53804),r=i(98282),s=i(70931),o=i(86486);class a extends r.k2{getSize(e,t){return(0,s.Tk)((0,o.M8)(e),t,e.multiply(this.unitValueToPixelsRatio))}}(0,n._)([(0,r.Pi)(s.nt)],a.prototype,"unitValueToPixelsRatio",void 0)},40846:function(e,t,i){var n;i.d(t,{$w:function(){return c},Fb:function(){return a},Fz:function(){return _},H_:function(){return n},J5:function(){return l},M:function(){return d},Ni:function(){return h},V5:function(){return o},Xx:function(){return m},YV:function(){return b},au:function(){return u},b5:function(){return y},bg:function(){return v},cn:function(){return p},eo:function(){return S},kx:function(){return g},os:function(){return r},qM:function(){return f},rp:function(){return s},ti:function(){return x}}),function(e){e[e.Geographic=0]="Geographic",e[e.Arithmatic=1]="Arithmatic"}(n||(n={}));const r=3.14159265359/180,s=3.14159265359/128,o=1,a=1.1,l=1,u=24,c=8,h=1e-5,d=.05,f=1e-30,p=4,m=0,_=2,g=2,y=3,v=0,x=3,b=16777216,S=1.1},66425:function(e,t,i){i.d(t,{Bo:function(){return c},Bs:function(){return l},E2:function(){return o},Lq:function(){return d},My:function(){return h},g$:function(){return f},kW:function(){return a}});var n=i(70931),r=i(40846),s=i(86486);function o(e,t,i){const r=i.subtract(t),s=(a=e.subtract(t),l=r,(0,n.Om)(a,(0,n.S8)(l))),o=(0,n.qE)(s.divide((0,n.Bw)(r)),new n.nt(0),new n.nt(1));var a,l;return(0,n.Io)(e,t.add(o.multiply(i.subtract(t))))}function a(e){const t=(0,n.tn)(e);return(0,n.PM)(t.x.add(t.y).add(t.z),new n.nt(1.05))}function l(e,t,i,r){const s=new n.U(i.x.multiply(r.y).subtract(r.x.multiply(i.y)),r.x.multiply(t.y).subtract(t.x.multiply(r.y)),t.x.multiply(i.y).subtract(i.x.multiply(t.y)),i.y.subtract(r.y),r.y.subtract(t.y),t.y.subtract(i.y),r.x.subtract(i.x),t.x.subtract(r.x),i.x.subtract(t.x)),o=t.x.multiply(i.y.subtract(r.y)),a=i.x.multiply(r.y.subtract(t.y)),l=r.x.multiply(t.y.subtract(i.y)),u=o.add(a).add(l);return new n.nt(1).divide(u).multiply(s.multiply(new n.eB(1,e)))}function u(e,t,i,r){return(0,n.LC)(a(l(e,t,i,r)),new n.nt(1))}function c(e,t,i,a){const l=i.subtract(t),c=a.subtract(t),h=(0,s.tL)(l,c),d=(0,n.Uo)((0,n.Xe)(h,new n.nt(r.M)),(0,n.MM)(h,new n.nt(-r.M)));return(0,n.j1)([(0,n.Uo)((0,n.AU)(d),u(e.xy,t,i,a)),new n.nt(-1)],[!0,()=>{const r=o(e,t,i),s=o(e,i,a),l=o(e,a,t);return(0,n.jk)((0,n.jk)(r,s),l)}])}function h(e){return e.distance.add(1)}function d(e,t,i){const{viewMat3:r,tileMat3:s}=e.view,o=r.multiply(s),a=o.multiply(new n.eB(t.pos,1)),l=o.multiply(new n.eB(i.nextPos1,1)),u=o.multiply(new n.eB(i.nextPos2,1));return c(e.hittestRequest.position,a.xy,l.xy,u.xy)}function f(e,t,i){return(0,n.Io)(e,i).subtract(t)}},86486:function(e,t,i){i.d(t,{K5:function(){return h},Kt:function(){return p},M8:function(){return a},Rj:function(){return m},_9:function(){return o},i6:function(){return d},mh:function(){return c},nb:function(){return u},p8:function(){return y},tL:function(){return l},xf:function(){return _},yS:function(){return f},zb:function(){return g},zy:function(){return v}});var n=i(39686),r=i(70931),s=i(40846);function o(e){const t=(0,r.fV)(12.9898),i=(0,r.fV)(78.233),n=(0,r.fV)(43758.5453),s=(0,r.Om)(e,(0,r.Zc)(t,i)),o=(0,r.zi)(s,(0,r.fV)(3.14));return(0,r.jc)((0,r.F8)(o).multiply(n))}function a(e){return(0,r.LC)(e,(0,r.fV)(s.qM))}function l(e,t){return e.x.multiply(t.y).subtract(t.x.multiply(e.y))}function u(e){return e.multiply(2).subtract(1)}function c(e,t){const i=(0,r.fV)(2**t);return(0,r.zi)((0,r.RI)(e.divide(i)),(0,r.fV)(2))}function h(e,t){return(0,r.MM)(c(e,t),(0,r.fV)(.5))}function d(e,t){return c(e,t+n.U5)}function f(e,t){return c(e,t)}function p(e){const t=c(e.z,7),i=(0,r.fV)(1).subtract(t),n=e.xyz.subtract((0,r.eR)(0,0,(0,r.fV)(128)));return i.multiply(e).add(t.multiply(n))}function m(e){const t=(0,r.ln)(255/256,255/65536,255/16777216,255/4294967296);return(0,r.Om)(e,t)}function _(e){return(0,r.T9)((0,r.T9)((0,r.T9)(e.x,e.y),e.z),e.w)}function g(e){return new r.nt(1).subtract(e)}function y(e){return e.subtract(new r.nt(1))}function v(e,t){return e.subtract(new r.nt(t))}},90906:function(e,t,i){i.d(t,{G5:function(){return r},G7:function(){return o},Mg:function(){return s},TL:function(){return l},cF:function(){return a},g_:function(){return u}});var n=i(70931);function r(e){return null!=e.visualVariableSizeMinMaxValue||null!=e.visualVariableSizeScaleStops||null!=e.visualVariableSizeStops||null!=e.visualVariableSizeUnitValue}function s(e,t,i){if(r(e)){const n=e.storage.getSizeValue(t);return e.visualVariableSizeMinMaxValue?.getSize(n,i)??e.visualVariableSizeScaleStops?.getSizeForViewScale(e.view.currentScale)??e.visualVariableSizeStops?.getSize(n,i)??e.visualVariableSizeUnitValue?.getSize(n,i)}return i}function o(e,t,i,r=new n.x(!1)){if(null==e.visualVariableColor)return i;const s=e.storage.getColorValue(t);return e.visualVariableColor.getColor(s,i,r)}function a(e,t){if(null==e.visualVariableOpacity)return new n.nt(1);const i=e.storage.getOpacityValue(t);return e.visualVariableOpacity.getOpacity(i)}function l(e,t){if(null==e.visualVariableRotation)return n.U.identity();const i=e.storage.getRotationValue(t);return e.visualVariableRotation.getVVRotationMat3(i)}function u(e,t){if(null==e.visualVariableRotation)return new n.nt(0);const i=e.storage.getRotationValue(t);return e.visualVariableRotation.getNormalizedAngle(i)}},22516:function(e,t,i){i.d(t,{K:function(){return u}});var n=i(39819),r=i(40633),s=i(34194),o=(i(13798),i(58941),i(41835),i(85456),i(96402),i(95904)),a=(i(69452),i(12285),i(88413));function l(e,t,i){const s=t.length;if(s!==i){const o=new n.A("Invalid Uniform",`Invalid length, expected ${i} but got ${s}`,{uniformName:e,values:t});r.A.getLogger("esri.views.2d.engine.webgl.shaderGraph.typed.TypedShaderProgram").errorOnce(o)}}class u{constructor(e,t,i,n,r,s){this._program=null,this._vao=null,this._temporaryTextures=[],this.vertexShader=e,this.fragmentShader=t,this._locations=i,this._locationInfo=n,this._uniformBindings=r,this._transformFeedbackBindings=s}destroy(){this._program&&this._program.dispose(),this.cleanupTemporaryTextures()}get locations(){return this._locations}get locationInfo(){return this._locationInfo}setUniforms(e){this._uniforms=e}cleanupTemporaryTextures(){for(const e of this._temporaryTextures)e.dispose();this._temporaryTextures=[]}bind(e){const t=this._uniforms;if(!this._program){const t=new Map;for(const[e,i]of this._locations)t.set(e,i);const i=[];for(const e of this._transformFeedbackBindings??[]){const{index:t,propertyKey:n}=e;i[t]=`v_${n}`}this._program=new o.B(e,this.vertexShader,this.fragmentShader,t,new Map,i)}const i=this._program;e.useProgram(i);for(const n of this._uniformBindings){const{shaderModulePath:r,uniformName:o,uniformType:u,uniformArrayLength:c}=n,h=(0,s.wc)(r,t);if(null==h){if("sampler2D"===u)continue;throw new Error(`Failed to find uniform value for ${r}`)}switch("array"===u?n.uniformArrayElementType:u){case"sampler2D":{const{unit:t,texture:n}=h;if(i.setUniform1i(o,t),"type"in n)e.bindTexture(n,t);else{const i=(0,a.sZ)(e,n.descriptor,n.data);e.bindTexture(i,t)}break}case"int":if(!c){i.setUniform1i(o,h);break}l(n.uniformName,h,c),i.setUniform1iv(o,h);break;case"float":if(!c){i.setUniform1f(o,h);break}l(n.uniformName,h,c),i.setUniform1fv(o,h);break;case"vec2":if(!c){i.setUniform2f(o,h[0],h[1]);break}l(n.uniformName,h,c),i.setUniform2fv(o,h.flat());break;case"vec3":if(!c){i.setUniform3f(o,h[0],h[1],h[2]);break}l(n.uniformName,h,c),i.setUniform3fv(o,h.flat());break;case"vec4":if(!c){i.setUniform4f(o,h[0],h[1],h[2],h[3]);break}l(n.uniformName,h,c),i.setUniform4fv(o,h.flat());break;case"mat3":i.setUniformMatrix3fv(o,h);break;case"mat4":i.setUniformMatrix4fv(o,h);break;default:throw new Error(`Unable to set uniform for type ${u}`)}}}}},97673:function(e,t,i){function n(e){return e.locationsMap}i.d(t,{V:function(){return n},i:function(){return r}});const r={color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1}},94020:function(e,t,i){i.d(t,{T:function(){return r}});var n=i(44723);const r={shaders:{vertexShader:(0,n.Q)("background/background.vert"),fragmentShader:(0,n.Q)("background/background.frag")},attributes:new Map([["a_pos",0]])}},47272:function(e,t,i){i.d(t,{H:function(){return r}});var n=i(44723);const r={shaders:{vertexShader:(0,n.Q)("tileInfo/tileInfo.vert"),fragmentShader:(0,n.Q)("tileInfo/tileInfo.frag")},attributes:new Map([["a_pos",0]])}},44723:function(e,t,i){i.d(t,{Q:function(){return s}});const n=new(i(65644).Z)((r={background:{"background.frag":"uniform lowp vec4 u_color;\nvoid main() {\ngl_FragColor = u_color;\n}","background.vert":"attribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform mediump vec2 u_coord_range;\nuniform mediump float u_depth;\nvoid main() {\nvec3 v_pos = u_dvsMat3 * vec3(u_coord_range * a_pos, 1.0);\ngl_Position = vec4(v_pos.xy, 0.0, 1.0);\n}"},bitBlit:{"bitBlit.frag":"uniform lowp sampler2D u_tex;\nuniform lowp float u_opacity;\nvarying mediump vec2 v_uv;\nvoid main() {\nlowp vec4 color = texture2D(u_tex, v_uv);\ngl_FragColor = color * u_opacity;\n}","bitBlit.vert":"attribute vec2 a_pos;\nattribute vec2 a_tex;\nvarying mediump vec2 v_uv;\nvoid main(void) {\ngl_Position = vec4(a_pos , 0.0, 1.0);\nv_uv = a_tex;\n}"},debug:{overlay:{"overlay.frag":"precision mediump float;\nvarying vec4 v_color;\nvoid main(void) {\ngl_FragColor = v_color;\n}","overlay.vert":"attribute vec3 a_PositionAndFlags;\nuniform mat3 u_dvsMat3;\nuniform vec4 u_colors[4];\nuniform float u_opacities[4];\nvarying vec4 v_color;\nvoid main(void) {\nvec2 position = a_PositionAndFlags.xy;\nfloat flags = a_PositionAndFlags.z;\nint colorIndex = int(mod(flags, 4.0));\nvec4 color;\nfor (int i = 0; i < 4; i++) {\ncolor = u_colors[i];\nif (i == colorIndex) {\nbreak;\n}\n}\nint opacityIndex = int(mod(floor(flags / 4.0), 4.0));\nfloat opacity;\nfor (int i = 0; i < 4; i++) {\nopacity = u_opacities[i];\nif (i == opacityIndex) {\nbreak;\n}\n}\nv_color = color * opacity;\ngl_Position = vec4((u_dvsMat3 * vec3(position, 1.0)).xy, 0.0, 1.0);\n}"}},dot:{dot:{"dot.frag":"precision mediump float;\nvarying vec4 v_color;\nvarying float v_dotRatio;\nvarying float v_invEdgeRatio;\nuniform highp float u_tileZoomFactor;\nvoid main()\n{\nfloat dist = length(gl_PointCoord - vec2(.5, .5)) * 2.;\nfloat alpha = smoothstep(0., 1., v_invEdgeRatio * (dist - v_dotRatio) + 1.);\ngl_FragColor = v_color * alpha;\n}","dot.vert":"precision highp float;\nattribute vec2 a_pos;\nuniform sampler2D u_texture;\nuniform highp mat3 u_dvsMat3;\nuniform highp float u_tileZoomFactor;\nuniform highp float u_dotSize;\nuniform highp float u_pixelRatio;\nvarying vec2 v_pos;\nvarying vec4 v_color;\nvarying float v_dotRatio;\nvarying float v_invEdgeRatio;\nconst float EPSILON = 0.000001;\nvoid main()\n{\nmat3 tileToTileTexture = mat3(  1., 0., 0.,\n0., -1., 0.,\n0., 1., 1.  );\nvec3 texCoords = tileToTileTexture * vec3(a_pos.xy / 512., 1.);\nv_color = texture2D(u_texture, texCoords.xy);\nfloat smoothEdgeWidth = max(u_dotSize / 2., 1.) ;\nfloat z = 0.;\nz += 2.0 * step(v_color.a, EPSILON);\ngl_PointSize = (smoothEdgeWidth + u_dotSize);\ngl_Position = vec4((u_dvsMat3 * vec3(a_pos + .5, 1.)).xy, z, 1.);\nv_dotRatio = u_dotSize / gl_PointSize;\nv_invEdgeRatio = -1. / ( smoothEdgeWidth / gl_PointSize );\ngl_PointSize  *= (u_pixelRatio * u_tileZoomFactor);\n}"}},filtering:{"bicubic.glsl":"vec4 computeWeights(float v) {\nfloat b = 1.0 / 6.0;\nfloat v2 = v * v;\nfloat v3 = v2 * v;\nfloat w0 = b * (-v3 + 3.0 * v2 - 3.0 * v + 1.0);\nfloat w1 = b * (3.0 * v3  - 6.0 * v2 + 4.0);\nfloat w2 = b * (-3.0 * v3 + 3.0 * v2 + 3.0 * v + 1.0);\nfloat w3 = b * v3;\nreturn vec4(w0, w1, w2, w3);\n}\nvec4 bicubicOffsetsAndWeights(float v) {\nvec4 w = computeWeights(v);\nfloat g0 = w.x + w.y;\nfloat g1 = w.z + w.w;\nfloat h0 = 1.0 - (w.y / g0) + v;\nfloat h1 = 1.0 + (w.w / g1) - v;\nreturn vec4(h0, h1, g0, g1);\n}\nvec4 sampleBicubicBSpline(sampler2D sampler, vec2 coords, vec2 texSize) {\nvec2 eX = vec2(1.0 / texSize.x, 0.0);\nvec2 eY = vec2(0.0, 1.0 / texSize.y);\nvec2 texel = coords * texSize - 0.5;\nvec3 hgX = bicubicOffsetsAndWeights(fract(texel).x).xyz;\nvec3 hgY = bicubicOffsetsAndWeights(fract(texel).y).xyz;\nvec2 coords10 = coords + hgX.x * eX;\nvec2 coords00 = coords - hgX.y * eX;\nvec2 coords11 = coords10 + hgY.x * eY;\nvec2 coords01 = coords00 + hgY.x * eY;\ncoords10 = coords10 - hgY.y * eY;\ncoords00 = coords00 - hgY.y * eY;\nvec4 color00 = texture2D(sampler, coords00);\nvec4 color10 = texture2D(sampler, coords10);\nvec4 color01 = texture2D(sampler, coords01);\nvec4 color11 = texture2D(sampler, coords11);\ncolor00 = mix(color00, color01, hgY.z);\ncolor10 = mix(color10, color11, hgY.z);\ncolor00 = mix(color00, color10, hgX.z);\nreturn color00;\n}","bilinear.glsl":"vec4 sampleBilinear(sampler2D sampler, vec2 coords, vec2 texSize) {\nvec2 texelStart = floor(coords * texSize);\nvec2 coord0 = texelStart / texSize;\nvec2 coord1 = (texelStart +  vec2(1.0, 0.0)) / texSize;\nvec2 coord2 = (texelStart +  vec2(0.0, 1.0)) / texSize;\nvec2 coord3 = (texelStart +  vec2(1.0, 1.0)) / texSize;\nvec4 color0 = texture2D(sampler, coord0);\nvec4 color1 = texture2D(sampler, coord1);\nvec4 color2 = texture2D(sampler, coord2);\nvec4 color3 = texture2D(sampler, coord3);\nvec2 blend = fract(coords * texSize);\nvec4 color01 = mix(color0, color1, blend.x);\nvec4 color23 = mix(color2, color3, blend.x);\nvec4 color = mix(color01, color23, blend.y);\n#ifdef NNEDGE\nfloat alpha = floor(color0.a * color1.a * color2.a * color3.a + 0.5);\ncolor = color * alpha + (1.0 - alpha) * texture2D(sampler, coords);\n#endif\nreturn color;\n}","epx.glsl":"vec4 sampleEPX(sampler2D sampler, float size, vec2 coords, vec2 texSize) {\nvec2 invSize = 1.0 / texSize;\nvec2 texel = coords * texSize;\nvec2 texel_i = floor(texel);\nvec2 texel_frac = fract(texel);\nvec4 colorP = texture2D(sampler, texel_i * invSize);\nvec4 colorP1 = vec4(colorP);\nvec4 colorP2 = vec4(colorP);\nvec4 colorP3 = vec4(colorP);\nvec4 colorP4 = vec4(colorP);\nvec4 colorA = texture2D(sampler, (texel_i - vec2(0.0, 1.0)) * invSize);\nvec4 colorB = texture2D(sampler, (texel_i + vec2(1.0, 0.0)) * invSize);\nvec4 colorC = texture2D(sampler, (texel_i - vec2(1.0, 0.0)) * invSize);\nvec4 colorD = texture2D(sampler, (texel_i + vec2(0.0, 1.0)) * invSize);\nif (colorC == colorA && colorC != colorD && colorA != colorB) {\ncolorP1 = colorA;\n}\nif (colorA == colorB && colorA != colorC && colorB != colorD) {\ncolorP2 = colorB;\n}\nif (colorD == colorC && colorD != colorB && colorC != colorA) {\ncolorP3 = colorC;\n}\nif (colorB == colorD && colorB != colorA && colorD != colorC) {\ncolorP4 = colorD;\n}\nvec4 colorP12 = mix(colorP1, colorP2, texel_frac.x);\nvec4 colorP34 = mix(colorP1, colorP2, texel_frac.x);\nreturn mix(colorP12, colorP34, texel_frac.y);\n}"},heatmap:{heatmapResolve:{"heatmapResolve.frag":"precision highp float;\n#ifdef HEATMAP_PRECISION_HALF_FLOAT\n#define COMPRESSION_FACTOR 4.0\n#else\n#define COMPRESSION_FACTOR 1.0\n#endif\nuniform sampler2D u_texture;\nuniform sampler2D u_gradient;\nuniform vec2 u_densityMinAndInvRange;\nuniform float u_densityNormalization;\nvarying vec2 v_uv;\nvoid main() {\nvec4 data = texture2D(u_texture, v_uv);\nfloat density = data.r * COMPRESSION_FACTOR;\ndensity *= u_densityNormalization;\ndensity = (density - u_densityMinAndInvRange.x) * u_densityMinAndInvRange.y;\nvec4 color = texture2D(u_gradient, vec2(density, 0.5));\ngl_FragColor = vec4(color.rgb * color.a, color.a);\n}","heatmapResolve.vert":"precision highp float;\nattribute vec2 a_pos;\nvarying vec2 v_uv;\nvoid main() {\nv_uv = a_pos;\ngl_Position = vec4(a_pos * 2.0 - 1.0, 1., 1.);\n}"}},highlight:{"blur.frag":"varying mediump vec2 v_texcoord;\nuniform mediump vec4 u_direction;\nuniform mediump mat4 u_channelSelector;\nuniform mediump float u_sigma;\nuniform sampler2D u_texture;\nmediump float gauss1(mediump vec2 dir) {\nreturn exp(-dot(dir, dir) / (2.0 * u_sigma * u_sigma));\n}\nmediump vec4 selectChannel(mediump vec4 sample) {\nreturn u_channelSelector * sample;\n}\nvoid accumGauss1(mediump float i, inout mediump float tot, inout mediump float weight) {\nmediump float w = gauss1(i * u_direction.xy);\ntot += selectChannel(texture2D(u_texture, v_texcoord + i * u_direction.zw))[3] * w;\nweight += w;\n}\nvoid main(void) {\nmediump float tot = 0.0;\nmediump float weight = 0.0;\naccumGauss1(-5.0, tot, weight);\naccumGauss1(-4.0, tot, weight);\naccumGauss1(-3.0, tot, weight);\naccumGauss1(-2.0, tot, weight);\naccumGauss1(-1.0, tot, weight);\naccumGauss1(0.0, tot, weight);\naccumGauss1(1.0, tot, weight);\naccumGauss1(2.0, tot, weight);\naccumGauss1(3.0, tot, weight);\naccumGauss1(4.0, tot, weight);\naccumGauss1(5.0, tot, weight);\ngl_FragColor = vec4(0.0, 0.0, 0.0, tot / weight);\n}","highlight.frag":"varying mediump vec2 v_texcoord;\nuniform sampler2D u_texture;\nuniform mediump float u_sigma;\nuniform sampler2D u_shade;\nuniform mediump vec2 u_minMaxDistance;\nmediump float estimateDistance() {\nmediump float y = texture2D(u_texture, v_texcoord)[3];\nconst mediump float y0 = 0.5;\nmediump float m0 = 1.0 / (sqrt(2.0 * 3.1415) * u_sigma);\nmediump float d = (y - y0) / m0;\nreturn d;\n}\nmediump vec4 shade(mediump float d) {\nmediump float mappedDistance = (d - u_minMaxDistance.x) / (u_minMaxDistance.y - u_minMaxDistance.x);\nmappedDistance = clamp(mappedDistance, 0.0, 1.0);\nreturn texture2D(u_shade, vec2(mappedDistance, 0.5));\n}\nvoid main(void) {\nmediump float d = estimateDistance();\ngl_FragColor = shade(d);\n}","textured.vert":"attribute mediump vec2 a_position;\nattribute mediump vec2 a_texcoord;\nvarying mediump vec2 v_texcoord;\nvoid main(void) {\ngl_Position = vec4(a_position, 0.0, 1.0);\nv_texcoord = a_texcoord;\n}"},materials:{"attributeData.glsl":"uniform highp sampler2D filterFlags;\nuniform highp sampler2D animation;\nuniform highp sampler2D gpgpu;\nuniform highp sampler2D visualVariableData;\nuniform highp sampler2D dataDriven0;\nuniform highp sampler2D dataDriven1;\nuniform highp sampler2D dataDriven2;\nuniform float size;\nhighp vec2 getAttributeDataCoords(in highp vec3 id) {\nhighp vec3  texel = unpackDisplayIdTexel(id);\nhighp float u32 = float(int(texel.r) + int(texel.g) * 256 + int(texel.b) * 256 * 256);\nhighp float col = mod(u32, size);\nhighp float row = (u32 - col) / size;\nhighp float u = col / size;\nhighp float v = row / size;\nreturn vec2(u, v);\n}\nhighp vec2 getAttributeDataTextureCoords(in highp vec3 id) {\nreturn (getAttributeDataCoords(id) * 2.0) - 1.0 + (.5 / vec2(size));\n}\nhighp vec4 getFilterData(in highp vec3 id) {\nvec2 coords = getAttributeDataCoords(id);\nreturn texture2D(filterFlags, coords);\n}\nhighp vec4 getAnimation(in highp vec3 id) {\nhighp vec2 coords = getAttributeDataCoords(id);\nreturn texture2D(animation, coords);\n}\nhighp vec4 getVisualVariableData(in highp vec3 id) {\nhighp vec2 coords = getAttributeDataCoords(id);\nreturn texture2D(visualVariableData, coords);\n}\nhighp vec4 getDataDriven0(in highp vec3 id) {\nhighp vec2 coords = getAttributeDataCoords(id);\nreturn texture2D(dataDriven0, coords);\n}\nhighp vec4 getDataDriven1(in highp vec3 id) {\nhighp vec2 coords = getAttributeDataCoords(id);\nreturn texture2D(dataDriven1, coords);\n}\nhighp vec4 getGPGPU(in highp vec3 id) {\nhighp vec2 coords = getAttributeDataCoords(id);\nreturn texture2D(gpgpu, coords);\n}\nhighp vec4 getDataDriven2(in highp vec3 id) {\nhighp vec2 coords = getAttributeDataCoords(id);\nreturn texture2D(dataDriven2, coords);\n}\nfloat u88VVToFloat(in vec2 v) {\nbool isMagic = v.x == 255.0 && v.y == 255.0;\nif (isMagic) {\nreturn NAN_MAGIC_NUMBER;\n}\nreturn (v.x + v.y * float(0x100)) - 32768.0;\n}","barycentric.glsl":"float inTriangle(vec3 bary) {\nvec3 absBary = abs(bary);\nreturn step((absBary.x + absBary.y + absBary.z), 1.05);\n}\nvec3 xyToBarycentric(in vec2 pos, in vec2 v0,  in vec2 v1, in vec2 v2) {\nmat3 xyToBarycentricMat3 = mat3(\nv1.x * v2.y - v2.x * v1.y, v2.x * v0.y - v0.x * v2.y, v0.x * v1.y - v1.x * v0.y,\nv1.y - v2.y, v2.y - v0.y, v0.y - v1.y,\nv2.x - v1.x, v0.x - v2.x, v1.x - v0.x\n);\nfloat A2 = v0.x * (v1.y - v2.y) + v1.x * (v2.y - v0.y) + v2.x * (v0.y - v1.y);\nreturn (1. / A2) * xyToBarycentricMat3 * vec3(1., pos);\n}","constants.glsl":"const float C_DEG_TO_RAD = 3.14159265359 / 180.0;\nconst float C_256_TO_RAD = 3.14159265359 / 128.0;\nconst float C_RAD_TO_DEG = 180.0 / 3.141592654;\nconst float POSITION_PRECISION = 1.0 / 8.0;\nconst float FILL_POSITION_PRECISION = 1.0 / 1.0;\nconst float SOFT_EDGE_RATIO = 1.0;\nconst float THIN_LINE_WIDTH_FACTOR = 1.1;\nconst float THIN_LINE_HALF_WIDTH = 1.0;\nconst float EXTRUDE_SCALE_PLACEMENT_PADDING = 1.0 / 4.0;\nconst float OFFSET_PRECISION = 1.0 / 8.0;\nconst float OUTLINE_SCALE = 1.0 / 5.0;\nconst float SDF_FONT_SIZE = 24.0;\nconst float MAX_SDF_DISTANCE = 8.0;\nconst float PLACEMENT_PADDING = 8.0;\nconst float EPSILON = 0.00001;\nconst float EPSILON_HITTEST = 0.05;\nconst int MAX_FILTER_COUNT = 2;\nconst int ATTR_VV_SIZE = 0;\nconst int ATTR_VV_COLOR = 1;\nconst int ATTR_VV_OPACITY = 2;\nconst int ATTR_VV_ROTATION = 3;\nconst highp float NAN_MAGIC_NUMBER = 1e-30;\nconst int BITSET_GENERIC_LOCK_COLOR = 1;\nconst int BITSET_GENERIC_CONSIDER_ALPHA_ONLY = 4;\nconst int BITSET_MARKER_ALIGNMENT_MAP = 0;\nconst int BITSET_MARKER_OUTLINE_ALLOW_COLOR_OVERRIDE = 2;\nconst int BITSET_MARKER_SCALE_SYMBOLS_PROPORTIONALLY = 3;\nconst int BITSET_TYPE_FILL_OUTLINE = 0;\nconst int BITSET_FILL_RANDOM_PATTERN_OFFSET = 2;\nconst int BITSET_FILL_HAS_UNRESOLVED_REPLACEMENT_COLOR = 3;\nconst int BITSET_FILL_HAS_PATTERN_HEIGHT_PRECISION_FACTOR = 5;\nconst int BITSET_FILL_HAS_PATTERN_WIDTH_PRECISION_FACTOR = 6;\nconst int BITSET_LINE_SCALE_DASH = 2;",fill:{"common.glsl":"#include <materials/symbologyTypeUtils.glsl>\n#ifdef PATTERN\nuniform mediump vec2 u_mosaicSize;\nvarying mediump float v_sampleAlphaOnly;\n#endif\n#if SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_DOT_DENSITY\nuniform lowp vec4 u_isActive[ 2 ];\nuniform highp float u_dotValue;\nuniform highp float u_tileDotsOverArea;\nuniform highp float u_dotTextureDotCount;\nuniform mediump float u_tileZoomFactor;\n#endif\nvarying highp vec3 v_id;\nvarying lowp vec4 v_color;\nvarying lowp float v_opacity;\nvarying mediump vec4 v_aux1;\n#ifdef PATTERN\nvarying mediump vec2 v_tileTextureCoord;\n#endif\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\nvarying lowp float v_isOutline;\n#endif\n#if SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_DOT_DENSITY\nvarying highp vec2 v_dotTextureCoords;\nvarying highp vec4 v_dotThresholds[ 2 ];\n#endif","fill.frag":"precision highp float;\n#include <materials/constants.glsl>\n#include <materials/utils.glsl>\n#include <materials/fill/common.glsl>\n#ifdef PATTERN\nuniform lowp sampler2D u_texture;\n#endif\n#if SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_DOT_DENSITY\nuniform mediump mat4 u_dotColors[ 2 ];\nuniform sampler2D u_dotTextures[ 2 ];\nuniform vec4 u_dotBackgroundColor;\n#endif\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#include <materials/shared/line/common.glsl>\n#include <materials/shared/line/line.frag>\nlowp vec4 drawLine() {\nfloat v_lineWidth = v_aux1.x;\nvec2  v_normal    = v_aux1.yz;\nLineData inputs = LineData(\nv_color,\nv_normal,\nv_lineWidth,\nv_opacity,\nv_id\n);\nreturn shadeLine(inputs);\n}\n#endif\nlowp vec4 drawFill() {\nlowp vec4 out_color = vec4(0.);\n#ifdef HITTEST\nout_color = v_color;\n#elif defined(PATTERN)\nmediump vec4 v_tlbr = v_aux1;\nmediump vec2 normalizedTextureCoord = mod(v_tileTextureCoord, 1.0);\nmediump vec2 samplePos = mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color = texture2D(u_texture, samplePos);\nif (v_sampleAlphaOnly > 0.5) {\ncolor.rgb = vec3(color.a);\n}\nout_color = v_opacity * v_color * color;\n#elif SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_DOT_DENSITY && !defined(HIGHLIGHT)\nvec4 textureThresholds0 = texture2D(u_dotTextures[0], v_dotTextureCoords);\nvec4 textureThresholds1 = texture2D(u_dotTextures[1], v_dotTextureCoords);\nvec4 difference0 = v_dotThresholds[0] - textureThresholds0;\nvec4 difference1 = v_dotThresholds[1] - textureThresholds1;\n#ifdef DD_DOT_BLENDING\nvec4 isPositive0 = step(0.0, difference0);\nvec4 isPositive1 = step(0.0, difference1);\nfloat weightSum = dot(isPositive0, difference0) + dot(isPositive1, difference1);\nfloat lessThanEqZero = step(weightSum, 0.0);\nfloat greaterThanZero = 1.0 - lessThanEqZero ;\nfloat divisor = (weightSum + lessThanEqZero);\nvec4 weights0 = difference0 * isPositive0 / divisor;\nvec4 weights1 = difference1 * isPositive1 / divisor;\nvec4 dotColor = u_dotColors[0] * weights0 + u_dotColors[1] * weights1;\nvec4 preEffectColor = greaterThanZero * dotColor + lessThanEqZero * u_dotBackgroundColor;\n#else\nfloat diffMax = max(max4(difference0), max4(difference1));\nfloat lessThanZero = step(diffMax, 0.0);\nfloat greaterOrEqZero = 1.0 - lessThanZero;\nvec4 isMax0 = step(diffMax, difference0);\nvec4 isMax1 = step(diffMax, difference1);\nvec4 dotColor = u_dotColors[0] * isMax0 + u_dotColors[1] * isMax1;\nvec4 preEffectColor = greaterOrEqZero * dotColor + lessThanZero * u_dotBackgroundColor;\n#endif\nout_color = preEffectColor;\n#else\nout_color = v_opacity * v_color;\n#endif\n#ifdef HIGHLIGHT\nout_color.a = 1.0;\n#endif\nreturn out_color;\n}\nvoid main() {\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\nif (v_isOutline > 0.5) {\ngl_FragColor = drawLine();\n} else {\ngl_FragColor = drawFill();\n}\n#else\ngl_FragColor = drawFill();\n#endif\n}","fill.vert":"#include <materials/symbologyTypeUtils.glsl>\n#define PACKED_LINE\nprecision highp float;\nattribute float a_bitset;\n#if SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_DOT_DENSITY\nattribute float a_inverseArea;\nvec4 a_color = vec4(0.0, 0.0, 0.0, 1.0);\nvec2 a_zoomRange = vec2(0.0, 10000.0);\n#else\nattribute vec4 a_color;\nattribute vec4 a_aux2;\nattribute vec4 a_aux3;\n#ifndef SYMBOLOGY_TYPE_IS_SIMPLE_LIKE\nattribute vec4 a_aux1;\nattribute vec2 a_zoomRange;\n#else\nvec2 a_zoomRange = vec2(0.0, 10000.0);\n#endif\n#endif\nuniform vec2 u_tileOffset;\nuniform vec2 u_maxIntNumOfCrossing;\n#include <util/encoding.glsl>\n#include <materials/vcommon.glsl>\n#include <materials/fill/common.glsl>\n#include <materials/fill/hittest.glsl>\nconst float INV_SCALE_COMPRESSION_FACTOR = 1.0 / 128.0;\nconst float MAX_REPRESENTABLE_INT = 16777216.0;\n#if SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_DOT_DENSITY\nvec4 dotThreshold(vec4 featureAttrOverFeatureArea, float dotValue, float tileDotsOverArea) {\nreturn featureAttrOverFeatureArea * (1.0 / dotValue)  * (1.0 / tileDotsOverArea);\n}\n#endif\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#include <materials/shared/line/common.glsl>\n#include <materials/shared/line/line.vert>\nvoid drawLine(out lowp vec4 out_color, out highp vec3 out_pos) {\nLineData outputs = buildLine(\nout_pos,\na_id,\na_pos,\na_color,\n(a_aux3.xy - 128.) / 16.,\n(a_aux3.zw - 128.) / 16.,\n0.,\na_aux2.z / 16.,\na_bitset,\nvec4(0.),\nvec2(0.),\na_aux2.w / 16.\n);\nv_id      = outputs.id;\nv_opacity = outputs.opacity;\nv_aux1    = vec4(outputs.lineHalfWidth, outputs.normal, 0.);\nout_color = outputs.color;\n}\n#endif\nvoid drawFill(out lowp vec4 out_color, out highp vec3 out_pos) {\nfloat a_bitSet = a_bitset;\nout_color = getColor(a_color, a_bitSet, BITSET_GENERIC_LOCK_COLOR);\nv_opacity = getOpacity();\nv_id      = norm(a_id);\n#if SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_DOT_DENSITY\nmat3 tileToTileNormalized = mat3(  2. / 512.,  0.,  0.,\n0., -2. / 512.,  0.,\n-1.,  1.,  1.  );\nout_pos   = tileToTileNormalized * vec3((a_pos * FILL_POSITION_PRECISION), 1.);\n#else\nout_pos   = u_dvsMat3 * vec3(a_pos * FILL_POSITION_PRECISION, 1.);\n#endif\n#ifdef PATTERN\nvec4  a_tlbr   = a_aux1;\nfloat a_width  = a_aux2.x;\nfloat a_height = a_aux2.y;\nvec2  a_offset = a_aux2.zw;\nvec2  a_scale  = a_aux3.xy;\nfloat a_angle  = a_aux3.z;\nif (getBit(a_bitset, BITSET_FILL_HAS_PATTERN_WIDTH_PRECISION_FACTOR) > 0.5) {\na_width *= INV_SCALE_COMPRESSION_FACTOR;\n}\nif (getBit(a_bitset, BITSET_FILL_HAS_PATTERN_HEIGHT_PRECISION_FACTOR) > 0.5) {\na_height *= INV_SCALE_COMPRESSION_FACTOR;\n}\nvec2 scale = INV_SCALE_COMPRESSION_FACTOR * a_scale;\nfloat width = u_zoomFactor * a_width * scale.x;\nfloat height = u_zoomFactor * a_height * scale.y;\nfloat angle = C_256_TO_RAD * a_angle;\nfloat sinA = sin(angle);\nfloat cosA = cos(angle);\nfloat dx = 0.0;\nfloat dy = 0.0;\nif (getBit(a_bitset, BITSET_FILL_RANDOM_PATTERN_OFFSET) > 0.5) {\nfloat id = rgba2float(vec4(a_id, 0.0));\ndx = rand(vec2(id, 0.0));\ndy = rand(vec2(0.0, id));\n}\nmat3 patternMatrix = mat3(cosA / width, sinA / height, 0,\n-sinA / width, cosA / height, 0,\ndx,            dy,           1);\nvec2 patternSize = vec2(a_width, a_height);\nvec2 numPatternsPerMaxInt = vec2(MAX_REPRESENTABLE_INT) / patternSize;\nvec2 maxIntCrossingOffsetCorrection = patternSize * fract(u_maxIntNumOfCrossing * numPatternsPerMaxInt);\nvec2 tileOffset = u_tileOffset + maxIntCrossingOffsetCorrection - 0.5 * patternSize;\ntileOffset = vec2(tileOffset.x * cosA - tileOffset.y * sinA, tileOffset.x * sinA + tileOffset.y * cosA);\ntileOffset = mod(tileOffset, patternSize);\nvec2 symbolOffset = u_zoomFactor * scale * vec2(a_offset - tileOffset) / vec2(width, height);\nv_tileTextureCoord = (patternMatrix * vec3(a_pos * FILL_POSITION_PRECISION, 1.0)).xy - symbolOffset;\nv_aux1 = a_tlbr / u_mosaicSize.xyxy;\nv_sampleAlphaOnly = getBit(a_bitset, BITSET_GENERIC_CONSIDER_ALPHA_ONLY);\nif (getBit(a_bitSet, BITSET_FILL_HAS_UNRESOLVED_REPLACEMENT_COLOR) > 0.5) {\n#ifdef VV_COLOR\nv_sampleAlphaOnly *= (1.0 - float(isNan(VV_ADATA[ATTR_VV_COLOR]))) * (1.0 - getBit(a_bitSet, BITSET_GENERIC_LOCK_COLOR));\n#else\nv_sampleAlphaOnly = 0.0;\n#endif\n}\n#elif SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_DOT_DENSITY\nvec4 ddAttributeData0 = getAttributeData2(a_id) * u_isActive[0] * a_inverseArea;\nvec4 ddAttributeData1 = getAttributeData3(a_id) * u_isActive[1] * a_inverseArea;\nfloat size = u_tileZoomFactor * 512.0 * 1.0 / u_pixelRatio;\nv_dotThresholds[0] = dotThreshold(ddAttributeData0, u_dotValue, u_tileDotsOverArea);\nv_dotThresholds[1] = dotThreshold(ddAttributeData1, u_dotValue, u_tileDotsOverArea);\nv_dotTextureCoords = (a_pos * FILL_POSITION_PRECISION + 0.5) / size;\n#endif\n}\n#ifdef HITTEST\nvoid draw(out lowp vec4 out_color, out highp vec3 out_pos) {\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\nif (getBit(a_bitset, BITSET_TYPE_FILL_OUTLINE) > 0.5) {\nout_pos = vec3(0., 0., 2.);\nreturn;\n}\n#endif\nhittestFill(out_color, out_pos);\ngl_PointSize = 1.0;\n}\n#elif defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE)\nvoid draw(out lowp vec4 out_color, out highp vec3 out_pos) {\nv_isOutline = getBit(a_bitset, BITSET_TYPE_FILL_OUTLINE);\nif (v_isOutline > 0.5) {\ndrawLine(out_color, out_pos);\n} else {\ndrawFill(out_color, out_pos);\n}\n}\n#else\n#define draw drawFill\n#endif\nvoid main()\n{\nINIT;\nhighp vec3 pos  = vec3(0.);\nhighp vec4 color  = vec4(0.);\ndraw(color, pos);\nv_color = color;\ngl_Position = vec4(clip(v_color, pos, getFilterFlags(), a_zoomRange), 1.0);\n}","hittest.glsl":"#ifdef HITTEST\n#include <materials/hittest/common.glsl>\nattribute vec2 a_pos1;\nattribute vec2 a_pos2;\nvoid hittestFill(\nout lowp vec4 out_color,\nout highp vec3 out_pos\n) {\nvec3 pos        = u_viewMat3 * u_tileMat3 * vec3(a_pos  * FILL_POSITION_PRECISION, 1.);\nvec3 pos1       = u_viewMat3 * u_tileMat3 * vec3(a_pos1 * FILL_POSITION_PRECISION, 1.);\nvec3 pos2       = u_viewMat3 * u_tileMat3 * vec3(a_pos2 * FILL_POSITION_PRECISION, 1.);\nfloat hittestDist = u_hittestDist;\nfloat dist = distPointTriangle(u_hittestPos, pos.xy, pos1.xy, pos2.xy);\nout_pos = vec3(getAttributeDataTextureCoords(a_id), 0.0);\nif (dist < 0. || dist >= hittestDist) {\nout_pos.z += 2.0;\n}\nout_color = vec4(1. / 255., 0, 0, dist == 0. ? (1. / 255.) : 0.);\n}\n#endif"},hittest:{"common.glsl":"#ifdef HITTEST\nuniform float hittestDist;\nuniform highp vec2 hittestPos;\nfloat projectScalar(vec2 a, vec2 b) {\nreturn dot(a, normalize(b));\n}\nfloat distPointSegment(vec2 p0, vec2 p1, vec2 p2) {\nvec2 L = p2 - p1;\nvec2 A = p0 - p1;\nfloat projAL = projectScalar(A, L);\nfloat t = clamp(projAL / length(L), 0., 1.);\nreturn distance(p0, p1 + t * (p2 - p1));\n}\nvoid hittestMarker(out lowp vec4 out_color, out highp vec3 out_pos, in highp vec3 pos, float size) {\nfloat dist = distance(pos, vec3(hittestPos, 1.));\nout_pos = vec3(getAttributeDataTextureCoords(a_id), 0.0);\nif ((dist - size) > hittestDist) {\nout_pos.z += 2.0;\n}\nout_color = vec4(1. / 255., 0, 0, (dist - size) < 0. ? (1. / 255.) : 0.);\n}\nfloat intersectPointTriangleBary(vec2 p, vec2 a, vec2 b, vec2 c) {\nreturn inTriangle(xyToBarycentric(p, a, b, c));\n}\nfloat distPointTriangle(vec2 p, vec2 a, vec2 b, vec2 c) {\nvec2 ba = b - a;\nvec2 ca = c - a;\nfloat crossProduct = ba.x * ca.y - ca.x * ba.y;\nbool isParallel = crossProduct < EPSILON_HITTEST && crossProduct > -EPSILON_HITTEST;\nif (isParallel) {\nreturn -1.;\n}\nif (intersectPointTriangleBary(p.xy, a, b, c) == 1.) {\nreturn 0.;\n}\nfloat distAB = distPointSegment(p, a, b);\nfloat distBC = distPointSegment(p, b, c);\nfloat distCA = distPointSegment(p, c, a);\nreturn min(min(distAB, distBC), distCA);\n}\n#endif"},icon:{"common.glsl":"#include <util/encoding.glsl>\nuniform lowp vec2 u_mosaicSize;\nvarying lowp vec4 v_color;\nvarying highp vec3 v_id;\nvarying highp vec4 v_sizeTex;\nvarying mediump vec3 v_pos;\nvarying lowp float v_opacity;\nuniform lowp sampler2D u_texture;\n#ifdef SDF\nvarying lowp vec4 v_outlineColor;\nvarying mediump float v_outlineWidth;\nvarying mediump float v_distRatio;\nvarying mediump float v_overridingOutlineColor;\nvarying mediump float v_isThin;\n#endif\n#ifdef SDF\nvec4 getColor(vec2 v_size, vec2 v_tex) {\n#ifdef HITTEST\nlowp vec4 fillPixelColor = vec4(1.0);\n#else\nlowp vec4 fillPixelColor = v_color;\n#endif\nfloat d = 0.5 - rgba2float(texture2D(u_texture, v_tex));\nfloat size = max(v_size.x, v_size.y);\nfloat dist = d * size * SOFT_EDGE_RATIO * v_distRatio;\nfillPixelColor *= clamp(0.5 - dist, 0.0, 1.0);\nfloat outlineWidth = v_outlineWidth;\n#ifdef HIGHLIGHT\noutlineWidth = max(outlineWidth, 4.0 * v_isThin);\n#endif\nif (outlineWidth > 0.25) {\nlowp vec4 outlinePixelColor = v_overridingOutlineColor * v_color + (1.0 - v_overridingOutlineColor) * v_outlineColor;\nfloat clampedOutlineSize = min(outlineWidth, size);\noutlinePixelColor *= clamp(0.5 - abs(dist) + clampedOutlineSize * 0.5, 0.0, 1.0);\nreturn v_opacity * ((1.0 - outlinePixelColor.a) * fillPixelColor + outlinePixelColor);\n}\nreturn v_opacity * fillPixelColor;\n}\n#else\nvec4 getColor(vec2 _v_size, vec2 v_tex) {\nlowp vec4 texColor = texture2D(u_texture, v_tex);\nreturn v_opacity * texColor * v_color;\n}\n#endif",heatmapAccumulate:{"common.glsl":"varying lowp vec4 v_hittestResult;\nvarying mediump vec2 v_offsetFromCenter;\nvarying highp float v_fieldValue;","heatmapAccumulate.frag":"precision mediump float;\n#include <materials/icon/heatmapAccumulate/common.glsl>\n#ifdef HEATMAP_PRECISION_HALF_FLOAT\n#define COMPRESSION_FACTOR 0.25\n#else\n#define COMPRESSION_FACTOR 1.0\n#endif\nuniform lowp sampler2D u_texture;\nvoid main() {\n#ifdef HITTEST\ngl_FragColor = v_hittestResult;\n#else\nfloat radius = length(v_offsetFromCenter);\nfloat shapeWeight = step(radius, 1.0);\nfloat oneMinusRadiusSquared = 1.0 - radius * radius;\nfloat kernelWeight = oneMinusRadiusSquared * oneMinusRadiusSquared;\ngl_FragColor = vec4(shapeWeight * kernelWeight * v_fieldValue * COMPRESSION_FACTOR);\n#endif\n}","heatmapAccumulate.vert":"precision highp float;\nattribute vec2 a_vertexOffset;\nvec4 a_color = vec4(0.0);\nvec2 a_zoomRange = vec2(0.0, 10000.0);\nuniform float u_radius;\nuniform float u_isFieldActive;\n#include <materials/vcommon.glsl>\n#include <materials/hittest/common.glsl>\n#include <materials/icon/heatmapAccumulate/common.glsl>\nvoid main() {\nfloat filterFlags = getFilterFlags();\n#ifdef HITTEST\nhighp vec4 out_hittestResult = vec4(0.);\nhighp vec3 out_pos = vec3(0.);\nvec3 pos = u_viewMat3 * u_tileMat3 * vec3(a_pos * POSITION_PRECISION, 1.0);\nhittestMarker(out_hittestResult, out_pos, pos, u_radius);\nv_hittestResult = out_hittestResult;\ngl_PointSize = 1.;\ngl_Position = vec4(clip(a_color, out_pos, filterFlags, a_zoomRange), 1.0);\n#else\nv_offsetFromCenter = sign(a_vertexOffset);\nv_fieldValue = getAttributeData2(a_id).x * u_isFieldActive + 1.0 - u_isFieldActive;\nvec3 centerPos = u_dvsMat3 * vec3(a_pos * POSITION_PRECISION, 1.0);\nvec3 vertexPos = centerPos + u_displayViewMat3 * vec3(v_offsetFromCenter, 0.0) * u_radius;\ngl_Position = vec4(clip(a_color, vertexPos, filterFlags, a_zoomRange), 1.0);\n#endif\n}"},"hittest.glsl":"#ifdef HITTEST\n#include <materials/hittest/common.glsl>\nattribute vec2 a_vertexOffset1;\nattribute vec2 a_vertexOffset2;\nattribute vec2 a_texCoords1;\nattribute vec2 a_texCoords2;\nvec2 getTextureCoords(in vec3 bary, in vec2 texCoords0, in vec2 texCoords1, in vec2 texCoords2) {\nreturn texCoords0 * bary.x + texCoords1 * bary.y + texCoords2 * bary.z;\n}\nvoid hittestIcon(\ninout lowp vec4 out_color,\nout highp vec3 out_pos,\nin vec3 pos,\nin vec3 offset,\nin vec2 size,\nin float scaleFactor,\nin float isMapAligned\n) {\nout_pos = vec3(getAttributeDataTextureCoords(a_id), 0.0);\nvec3 posBase = u_viewMat3 * u_tileMat3  * pos;\nvec3 offset1 = scaleFactor * vec3(a_vertexOffset1 / 16.0, 0.);\nvec3 offset2 = scaleFactor * vec3(a_vertexOffset2 / 16.0, 0.);\nvec2 pos0    = (posBase + getMatrixNoDisplay(isMapAligned) * offset).xy;\nvec2 pos1    = (posBase + getMatrixNoDisplay(isMapAligned) * offset1).xy;\nvec2 pos2    = (posBase + getMatrixNoDisplay(isMapAligned) * offset2).xy;\nvec3 bary0 = xyToBarycentric(u_hittestPos + vec2(-u_hittestDist, -u_hittestDist), pos0, pos1, pos2);\nvec3 bary1 = xyToBarycentric(u_hittestPos + vec2(0., -u_hittestDist), pos0, pos1, pos2);\nvec3 bary2 = xyToBarycentric(u_hittestPos + vec2(u_hittestDist, -u_hittestDist), pos0, pos1, pos2);\nvec3 bary3 = xyToBarycentric(u_hittestPos + vec2(-u_hittestDist, 0.), pos0, pos1, pos2);\nvec3 bary4 = xyToBarycentric(u_hittestPos, pos0, pos1, pos2);\nvec3 bary5 = xyToBarycentric(u_hittestPos + vec2(u_hittestDist, 0.), pos0, pos1, pos2);\nvec3 bary6 = xyToBarycentric(u_hittestPos + vec2(-u_hittestDist, u_hittestDist), pos0, pos1, pos2);\nvec3 bary7 = xyToBarycentric(u_hittestPos + vec2(0., u_hittestDist), pos0, pos1, pos2);\nvec3 bary8 = xyToBarycentric(u_hittestPos + vec2(u_hittestDist, u_hittestDist), pos0, pos1, pos2);\nvec2 tex0 = a_texCoords  / u_mosaicSize;\nvec2 tex1 = a_texCoords1 / u_mosaicSize;\nvec2 tex2 = a_texCoords2 / u_mosaicSize;\nfloat alphaSum = 0.;\nalphaSum += inTriangle(bary0) * getColor(size, getTextureCoords(bary0, tex0, tex1, tex2)).a;\nalphaSum += inTriangle(bary1) * getColor(size, getTextureCoords(bary1, tex0, tex1, tex2)).a;\nalphaSum += inTriangle(bary2) * getColor(size, getTextureCoords(bary2, tex0, tex1, tex2)).a;\nalphaSum += inTriangle(bary3) * getColor(size, getTextureCoords(bary3, tex0, tex1, tex2)).a;\nalphaSum += inTriangle(bary4) * getColor(size, getTextureCoords(bary4, tex0, tex1, tex2)).a;\nalphaSum += inTriangle(bary5) * getColor(size, getTextureCoords(bary5, tex0, tex1, tex2)).a;\nalphaSum += inTriangle(bary6) * getColor(size, getTextureCoords(bary6, tex0, tex1, tex2)).a;\nalphaSum += inTriangle(bary7) * getColor(size, getTextureCoords(bary7, tex0, tex1, tex2)).a;\nout_pos.z += step(alphaSum, .05) * 2.0;\nout_color = vec4(1. / 255., 0., 0., alphaSum / 255.);\n}\n#endif","icon.frag":"precision mediump float;\n#include <materials/constants.glsl>\n#include <materials/utils.glsl>\n#include <materials/icon/common.glsl>\nvoid main()\n{\n#ifdef HITTEST\nvec4 color = v_color;\n#else\nvec4 color = getColor(v_sizeTex.xy, v_sizeTex.zw);\n#endif\n#ifdef HIGHLIGHT\ncolor.a = step(1.0 / 255.0, color.a);\n#endif\ngl_FragColor = color;\n}","icon.vert":"precision highp float;\nattribute vec4 a_color;\nattribute vec4 a_outlineColor;\nattribute vec4 a_sizeAndOutlineWidth;\nattribute vec2 a_vertexOffset;\nattribute vec2 a_texCoords;\nattribute vec2 a_bitSetAndDistRatio;\nattribute vec2 a_zoomRange;\n#include <materials/vcommon.glsl>\n#include <materials/icon/common.glsl>\n#include <materials/icon/hittest.glsl>\nfloat getMarkerScaleFactor(inout vec2 size, in float referenceSize) {\n#ifdef VV_SIZE\nfloat f = getSize(size.y) / size.y;\nfloat sizeFactor = size.y / referenceSize;\nreturn getSize(referenceSize) / referenceSize;\n#else\nreturn 1.;\n#endif\n}\nvoid main()\n{\nINIT;\nfloat a_bitSet = a_bitSetAndDistRatio.x;\nvec3  pos           = vec3(a_pos * POSITION_PRECISION, 1.0);\nvec2  size          = a_sizeAndOutlineWidth.xy * a_sizeAndOutlineWidth.xy / 128.0;\nvec3  offset        = vec3(a_vertexOffset / 16.0, 0.);\nfloat outlineSize   = a_sizeAndOutlineWidth.z * a_sizeAndOutlineWidth.z / 128.0;\nfloat isMapAligned  = getBit(a_bitSet, BITSET_MARKER_ALIGNMENT_MAP);\nfloat referenceSize = a_sizeAndOutlineWidth.w * a_sizeAndOutlineWidth.w / 128.0;\nfloat scaleSymbolProportionally = getBit(a_bitSet, BITSET_MARKER_SCALE_SYMBOLS_PROPORTIONALLY);\nfloat scaleFactor               = getMarkerScaleFactor(size, referenceSize);\nsize.xy     *= scaleFactor;\noffset.xy   *= scaleFactor;\noutlineSize *= scaleSymbolProportionally * (scaleFactor - 1.0) + 1.0;\nvec2 v_tex   = a_texCoords / u_mosaicSize;\nfloat filterFlags = getFilterFlags();\nv_color    = getColor(a_color, a_bitSet, BITSET_GENERIC_LOCK_COLOR);\nv_opacity  = getOpacity();\nv_id       = norm(a_id);\nv_pos      = u_dvsMat3 * pos + getMatrix(isMapAligned) * getRotation()  * offset;\nv_sizeTex  = vec4(size.xy, v_tex.xy);\n#ifdef SDF\nv_isThin   = getBit(a_bitSet, BITSET_MARKER_OUTLINE_ALLOW_COLOR_OVERRIDE);\n#ifdef VV_COLOR\nv_overridingOutlineColor = v_isThin;\n#else\nv_overridingOutlineColor = 0.0;\n#endif\nv_outlineWidth = min(outlineSize, max(max(size.x, size.y) - 0.99, 0.0));\nv_outlineColor = a_outlineColor;\nv_distRatio = a_bitSetAndDistRatio.y / 128.0;\n#endif\n#ifdef HITTEST\nhighp vec4 out_color = vec4(0.);\nhighp vec3 out_pos   = vec3(0.);\nhittestIcon(out_color, out_pos, pos, offset, size, scaleFactor, isMapAligned);\nv_color = out_color;\ngl_PointSize = 1.;\ngl_Position = vec4(clip(v_color, out_pos, filterFlags, a_zoomRange), 1.0);\n#else\ngl_Position = vec4(clip(v_color, v_pos, filterFlags, a_zoomRange), 1.0);\n#endif\n}"},label:{"common.glsl":"uniform mediump float u_zoomLevel;\nuniform mediump float u_mapRotation;\nuniform mediump float u_mapAligned;\nuniform mediump vec2 u_mosaicSize;\nvarying mediump float v_antialiasingWidth;\nvarying mediump float v_edgeDistanceOffset;\nvarying mediump vec2 v_tex;\nvarying mediump vec4 v_color;\nvarying lowp vec4 v_animation;","label.frag":"#include <materials/text/text.frag>","label.vert":"precision highp float;\n#include <materials/vcommon.glsl>\n#include <materials/text/common.glsl>\nattribute vec4 a_color;\nattribute vec4 a_haloColor;\nattribute vec4 a_texAndSize;\nattribute vec4 a_refSymbolAndPlacementOffset;\nattribute vec4 a_glyphData;\nattribute vec2 a_vertexOffset;\nattribute vec2 a_texCoords;\nuniform float u_isHaloPass;\nuniform float u_isBackgroundPass;\nuniform float u_mapRotation;\nuniform float u_mapAligned;\nfloat getZ(in float minZoom, in float maxZoom, in float angle) {\nfloat glyphAngle = angle * 360.0 / 254.0;\nfloat mapAngle = u_mapRotation * 360.0 / 254.0;\nfloat diffAngle = min(360.0 - abs(mapAngle - glyphAngle), abs(mapAngle - glyphAngle));\nfloat z = 0.0;\nz += u_mapAligned * (2.0 * (1.0 - step(minZoom, u_currentZoom)));\nz += u_mapAligned * 2.0 * step(90.0, diffAngle);\nz += 2.0 * (1.0 - step(u_currentZoom, maxZoom));\nreturn z;\n}\nvoid main()\n{\nINIT;\nfloat groupMinZoom    = getMinZoom();\nfloat glyphMinZoom    = a_glyphData.x;\nfloat glyphMaxZoom    = a_glyphData.y;\nfloat glyphAngle      = a_glyphData.z;\nfloat a_isBackground  = a_glyphData.w;\nfloat a_minZoom          = max(groupMinZoom, glyphMinZoom);\nfloat a_placementPadding = a_refSymbolAndPlacementOffset.x * EXTRUDE_SCALE_PLACEMENT_PADDING;\nvec2  a_placementDir     = unpack_u8_nf32(a_refSymbolAndPlacementOffset.zw);\nfloat a_refSymbolSize    = a_refSymbolAndPlacementOffset.y;\nfloat fontSize           = a_texAndSize.z;\nfloat haloSize           = a_texAndSize.w * OUTLINE_SCALE;\nvec2  vertexOffset = a_vertexOffset * OFFSET_PRECISION;\nvec3  pos          = vec3(a_pos * POSITION_PRECISION, 1.0);\nfloat z            = getZ(a_minZoom, glyphMaxZoom, glyphAngle);\nfloat fontScale    = fontSize / SDF_FONT_SIZE;\nfloat halfSize     = getSize(a_refSymbolSize) / 2.0;\nfloat animation    = pow(getAnimationState(), vec4(2.0)).r;\nfloat isText = 1.0 - a_isBackground;\nfloat isBackground = u_isBackgroundPass * a_isBackground;\nvec4  nonHaloColor = (isBackground + isText) * a_color;\nv_color     = animation * ((1.0 - u_isHaloPass) * nonHaloColor + (u_isHaloPass * a_haloColor));\nv_opacity   = 1.0;\nv_tex       = a_texCoords / u_mosaicSize;\nv_edgeDistanceOffset = u_isHaloPass * haloSize / fontScale / MAX_SDF_DISTANCE;\nv_antialiasingWidth  = 0.105 * SDF_FONT_SIZE / fontSize / u_pixelRatio;\nvec2 placementOffset = a_placementDir * (halfSize + a_placementPadding);\nvec3 glyphOffset     = u_displayMat3 * vec3(vertexOffset + placementOffset, 0.0);\nvec3 v_pos           = vec3((u_dvsMat3 * pos + glyphOffset).xy, z);\nfloat isHidden = u_isBackgroundPass * isText + (1.0 - u_isBackgroundPass) * a_isBackground;\nv_pos.z += 2.0 * isHidden;\ngl_Position = vec4(v_pos, 1.0);\n#ifdef DEBUG\nv_color = vec4(a_color.rgb, z == 0.0 ? 1.0 : 0.645);\n#endif\n}"},line:{"common.glsl":"varying lowp vec4 v_color;\nvarying highp vec3 v_id;\nvarying mediump vec2 v_normal;\nvarying mediump float v_lineHalfWidth;\nvarying lowp float v_opacity;\n#ifdef PATTERN\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\n#endif\n#if defined(PATTERN) || defined(SDF)\nvarying highp float v_accumulatedDistance;\n#endif\n#ifdef SDF\nvarying mediump float v_lineWidthRatio;\n#endif","hittest.glsl":"#include <materials/hittest/common.glsl>\n#ifdef HITTEST\nattribute vec2 a_pos1;\nattribute vec2 a_pos2;\nvoid hittestLine(out lowp vec4 out_color, out highp vec3 out_pos, float halfWidth) {\nvec3 pos        = u_viewMat3 * u_tileMat3 * vec3(a_pos  * POSITION_PRECISION, 1.);\nvec3 pos1       = u_viewMat3 * u_tileMat3 * vec3(a_pos1 * POSITION_PRECISION, 1.);\nvec3 pos2       = u_viewMat3 * u_tileMat3 * vec3(a_pos2 * POSITION_PRECISION, 1.);\nvec3 outTextureCoords = vec3(getAttributeDataTextureCoords(a_id), 0.0);\nfloat dist = min(distPointSegment(u_hittestPos, pos.xy, pos1.xy),\ndistPointSegment(u_hittestPos, pos.xy, pos2.xy)) - halfWidth;\nout_pos = vec3(getAttributeDataTextureCoords(a_id), 0.0);\nif (dist >= u_hittestDist) {\nout_pos.z += 2.0;\n}\nout_color = vec4(1. / 255., 0, 0, dist <= 0. ? (1. / 255.) : 0.);\n}\n#endif","line.frag":"precision lowp float;\n#include <util/encoding.glsl>\n#include <materials/constants.glsl>\n#include <materials/symbologyTypeUtils.glsl>\n#include <materials/line/common.glsl>\n#include <materials/shared/line/common.glsl>\n#include <materials/shared/line/line.frag>\n#ifdef HITTEST\nvoid main() {\ngl_FragColor = v_color;\n}\n#else\nvoid main() {\nLineData inputs = LineData(\nv_color,\nv_normal,\nv_lineHalfWidth,\nv_opacity,\n#ifndef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#ifdef PATTERN\nv_tlbr,\nv_patternSize,\n#endif\n#ifdef SDF\nv_lineWidthRatio,\n#endif\n#if defined(PATTERN) || defined(SDF)\nv_accumulatedDistance,\n#endif\n#endif\nv_id\n);\ngl_FragColor = shadeLine(inputs);\n}\n#endif","line.vert":"precision highp float;\nattribute vec4 a_color;\nattribute vec4 a_offsetAndNormal;\nattribute vec2 a_accumulatedDistanceAndHalfWidth;\nattribute vec4 a_tlbr;\nattribute vec4 a_segmentDirection;\nattribute vec2 a_aux;\nattribute vec2 a_zoomRange;\n#include <materials/vcommon.glsl>\n#include <materials/symbologyTypeUtils.glsl>\n#include <materials/line/common.glsl>\n#include <materials/line/hittest.glsl>\n#include <materials/shared/line/common.glsl>\n#include <materials/shared/line/line.vert>\n#ifdef HITTEST\nvoid draw() {\nfloat aa        = 0.5 * u_antialiasing;\nfloat a_halfWidth = a_accumulatedDistanceAndHalfWidth.y / 16.;\nfloat a_cimHalfWidth = a_aux.x / 16. ;\nvec2  a_offset = a_offsetAndNormal.xy / 16.;\nfloat baseWidth = getBaseLineHalfWidth(a_halfWidth, a_cimHalfWidth);\nfloat halfWidth = getLineHalfWidth(baseWidth, aa);\nhighp vec3 pos  = vec3(0.);\nv_color = vec4(0.);\nhittestLine(v_color, pos, halfWidth);\ngl_PointSize = 1.;\ngl_Position = vec4(clip(v_color, pos, getFilterFlags(), a_zoomRange), 1.0);\n}\n#else\nvoid draw()\n{\nhighp vec3 pos = vec3(0.);\nLineData outputs = buildLine(\npos,\na_id,\na_pos,\na_color,\na_offsetAndNormal.xy / 16.,\na_offsetAndNormal.zw / 16.,\na_accumulatedDistanceAndHalfWidth.x,\na_accumulatedDistanceAndHalfWidth.y / 16.,\na_segmentDirection.w,\na_tlbr,\na_segmentDirection.xy / 16.,\na_aux.x / 16.\n);\nv_id              = outputs.id;\nv_color           = outputs.color;\nv_normal          = outputs.normal;\nv_lineHalfWidth   = outputs.lineHalfWidth;\nv_opacity         = outputs.opacity;\n#ifndef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#ifdef PATTERN\nv_tlbr          = outputs.tlbr;\nv_patternSize   = outputs.patternSize;\n#endif\n#ifdef SDF\nv_lineWidthRatio = outputs.lineWidthRatio;\n#endif\n#if defined(PATTERN) || defined(SDF)\nv_accumulatedDistance = outputs.accumulatedDistance;\n#endif\n#endif\ngl_Position = vec4(clip(outputs.color, pos, getFilterFlags(), a_zoomRange), 1.0);\n}\n#endif\nvoid main() {\nINIT;\ndraw();\n}"},pie:{"pie.common.glsl":"uniform float outlineWidth;\nuniform mediump float sectorThreshold;\nvarying vec3  v_id;\nvarying vec3  v_pos;\nvarying vec2  v_offset;\nvarying vec4  v_color;\nvarying float v_size;\nvarying float v_numOfEntries;\nvarying float v_maxSectorAngle;\nvarying vec2  v_filteredSectorToColorId[numberOfFields];\nvarying vec2  v_texCoords;\nvarying float v_outlineWidth;\nvarying float v_opacity;\nstruct FilteredChartInfo {\nfloat endSectorAngle;\nint colorId;\n};","pie.frag":"precision highp float;\n#include <util/atan2.glsl>\n#include <materials/constants.glsl>\n#include <materials/utils.glsl>\n#include <materials/pie/pie.common.glsl>\nuniform lowp vec4 colors[numberOfFields];\nuniform lowp vec4 defaultColor;\nuniform lowp vec4 othersColor;\nuniform lowp vec4 outlineColor;\nuniform float donutRatio;\nlowp vec4 getSectorColor(in int index, in vec2 filteredSectorToColorId[numberOfFields]) {\nmediump int colorIndex = int(filteredSectorToColorId[index].y);\nreturn colors[colorIndex];\n}\nconst int OTHER_SECTOR_ID = 255;\n#ifdef HITTEST\nvec4 getColor() {\nfloat distanceSize = length(v_offset) * v_size;\nfloat donutSize = donutRatio * v_size;\nfloat alpha = step(donutSize, distanceSize) * (1.0 - step(v_size, distanceSize));\nreturn v_color;\n}\n#else\nvec4 getColor() {\nfloat angle = 90.0 - C_RAD_TO_DEG * atan2(v_offset.y, v_offset.x);\nif (angle < 0.0) {\nangle += 360.0;\n} else if (angle > 360.0) {\nangle = mod(angle, 360.0);\n}\nint numOfEntries = int(v_numOfEntries);\nfloat maxSectorAngle = v_maxSectorAngle;\nlowp vec4 fillColor = (maxSectorAngle > 0.0 || sectorThreshold > 0.0) ? othersColor : defaultColor;\nlowp vec4 prevColor = vec4(0.0);\nlowp vec4 nextColor = vec4(0.0);\nfloat startSectorAngle = 0.0;\nfloat endSectorAngle = 0.0;\nif (angle < maxSectorAngle) {\nfor (int index = 0; index < numberOfFields; ++index) {\nstartSectorAngle = endSectorAngle;\nendSectorAngle = v_filteredSectorToColorId[index].x;\nif (endSectorAngle > angle) {\nfillColor = getSectorColor(index, v_filteredSectorToColorId);\nprevColor = sectorThreshold != 0.0 && index == 0 && abs(360.0 - maxSectorAngle) < EPSILON ? othersColor :\ngetSectorColor(index > 0 ? index - 1 : numOfEntries - 1, v_filteredSectorToColorId);\nnextColor = sectorThreshold != 0.0 && abs(endSectorAngle - maxSectorAngle) < EPSILON ? othersColor :\ngetSectorColor(index < numOfEntries - 1 ? index + 1 : 0, v_filteredSectorToColorId);\nbreak;\n}\nif (index == numOfEntries - 1) {\nbreak;\n}\n}\n} else {\nprevColor = getSectorColor(numOfEntries - 1, v_filteredSectorToColorId);\nnextColor = getSectorColor(0, v_filteredSectorToColorId);\nstartSectorAngle = maxSectorAngle;\nendSectorAngle = 360.0;\n}\nlowp vec4 outlineColor = outlineColor;\nfloat offset = length(v_offset);\nfloat distanceSize = offset * v_size;\nif (startSectorAngle != 0.0 || endSectorAngle != 360.0) {\nfloat distanceToStartSector = (angle - startSectorAngle);\nfloat distanceToEndSector = (endSectorAngle - angle);\nfloat sectorThreshold = 0.6;\nfloat beginSectorAlpha = smoothstep(0.0, sectorThreshold, distanceToStartSector * offset);\nfloat endSectorAlpha = smoothstep(0.0, sectorThreshold, distanceToEndSector * offset);\nif (endSectorAlpha > 0.0) {\nfillColor = mix(nextColor, fillColor, endSectorAlpha);\n} else if (beginSectorAlpha > 0.0) {\nfillColor = mix(prevColor, fillColor, beginSectorAlpha);\n}\n}\nfloat donutSize = donutRatio * (v_size - v_outlineWidth);\nfloat endOfDonut = donutSize - v_outlineWidth;\nfloat aaThreshold = 0.75;\nfloat innerCircleAlpha = endOfDonut - aaThreshold > 0.0 ? smoothstep(endOfDonut - aaThreshold, endOfDonut + aaThreshold, distanceSize) : 1.0;\nfloat outerCircleAlpha = 1.0 - smoothstep(v_size - aaThreshold, v_size + aaThreshold , distanceSize);\nfloat circleAlpha = innerCircleAlpha * outerCircleAlpha;\nfloat startOfOutline = v_size - v_outlineWidth;\nif (startOfOutline > 0.0 && v_outlineWidth > 0.25) {\nfloat outlineFactor = smoothstep(startOfOutline - aaThreshold, startOfOutline + aaThreshold, distanceSize);\nfloat innerLineFactor = donutSize - aaThreshold > 0.0 ? 1.0 - smoothstep(donutSize - aaThreshold, donutSize + aaThreshold , distanceSize) : 0.0;\nfillColor = mix(fillColor, outlineColor, innerLineFactor + outlineFactor);\n}\nreturn v_opacity * circleAlpha * fillColor;\n}\n#endif\nvoid main()\n{\nvec4 color = getColor();\n#ifdef highlight\ncolor.a = step(1.0 / 255.0, color.a);\n#endif\ngl_FragColor = color;\n}","pie.vert":"#include <materials/constants.glsl>\n#include <materials/utils.glsl>\n#include <materials/barycentric.glsl>\n#include <materials/vcommon.glsl>\n#include <materials/vv.glsl>\n#include <materials/attributeData.glsl>\n#include <materials/pie/pie.common.glsl>\n#include <materials/hittest/common.glsl>\nattribute float a_bitSet;\nattribute vec2  a_offset;\nattribute vec2  a_texCoords;\nattribute vec2  a_size;\nattribute float a_referenceSize;\nattribute vec2  a_zoomRange;\nint filterValue(in float sectorAngle,\nin int currentIndex,\ninout FilteredChartInfo filteredInfo,\ninout vec2 filteredSectorToColorId[numberOfFields]) {\nif (sectorAngle > sectorThreshold * 360.0) {\nfilteredInfo.endSectorAngle += sectorAngle;\nfilteredSectorToColorId[filteredInfo.colorId] = vec2(filteredInfo.endSectorAngle, currentIndex);\n++filteredInfo.colorId;\n}\nreturn 0;\n}\nint filterValues(inout vec2 filteredSectorToColorId[numberOfFields],\ninout FilteredChartInfo filteredInfo,\nin float sectorAngles[numberOfFields]) {\nfor (int index = 0; index < numberOfFields; ++index) {\nfloat sectorValue = sectorAngles[index];\nfilterValue(sectorValue, index, filteredInfo, filteredSectorToColorId);\n}\nreturn filteredInfo.colorId;\n}\nvec2 getMarkerSize(inout vec2 offset, inout vec2 baseSize, inout float outlineSize, in float a_referenceSize, in float bitSet) {\nvec2 outSize = baseSize;\n#ifdef VV_SIZE\nfloat r = getSize(a_referenceSize, currentScale) / a_referenceSize;\noutSize.xy *= r;\noffset.xy *= r;\nfloat scaleSymbolProportionally = getBit(bitSet, BITSET_MARKER_SCALE_SYMBOLS_PROPORTIONALLY);\noutlineSize *= scaleSymbolProportionally * (r - 1.0) + 1.0;\n#endif\nreturn outSize;\n}\nvec3 getOffset(in vec2 in_offset, float a_bitSet) {\nfloat isMapAligned = getBit(a_bitSet, BITSET_MARKER_ALIGNMENT_MAP);\nvec3  offset       = vec3(in_offset, 0.0);\nreturn getMatrix(isMapAligned) * offset;\n}\nfloat filterNaNValues(in float value) {\nreturn value != NAN_MAGIC_NUMBER && value > 0.0 ? value : 0.0;\n}\nvoid main()\n{\nINIT;\nvec2  a_size   = a_size;\nvec2  a_offset = a_offset / 16.0;\nfloat outlineSize = outlineWidth;\nfloat a_bitSet = a_bitSet;\nfloat a_referenceSize = a_referenceSize;\nvec2 a_texCoords = a_texCoords / 4.0;\nvec2 markerSize = getMarkerSize(a_offset, a_size, outlineSize, a_referenceSize, a_bitSet);\nfloat filterFlags = getFilterFlags();\nvec3  pos         = vec3(a_pos / 10.0, 1.0);\nv_opacity      = getOpacity();\nv_id           = norm(a_id);\nv_pos          = displayViewScreenMat3 * pos + getOffset(a_offset, a_bitSet);\nv_offset       = sign(a_texCoords - 0.5);\nv_size         = max(markerSize.x, markerSize.y);\nv_outlineWidth = outlineSize;\nfloat attributeData[10];\nvec4 attributeData3 = getDataDriven0(a_id);\nattributeData[0] = filterNaNValues(attributeData3.x);\nattributeData[1] = filterNaNValues(attributeData3.y);\nattributeData[2] = filterNaNValues(attributeData3.z);\nattributeData[3] = filterNaNValues(attributeData3.w);\n#if (numberOfFields > 4)\nvec4 attributeData4 = getDataDriven1(a_id);\nattributeData[4] = filterNaNValues(attributeData4.x);\nattributeData[5] = filterNaNValues(attributeData4.y);\nattributeData[6] = filterNaNValues(attributeData4.z);\nattributeData[7] = filterNaNValues(attributeData4.w);\n#endif\n#if (numberOfFields > 8)\nvec4 attributeData5 = getDataDriven2(a_id);\nattributeData[8] = filterNaNValues(attributeData5.x);\nattributeData[9] = filterNaNValues(attributeData5.y);\n#endif\nfloat sum = 0.0;\nfor (int i = 0; i < numberOfFields; ++i) {\nsum += attributeData[i];\n}\nfloat sectorAngles[numberOfFields];\nfor (int i = 0; i < numberOfFields; ++i) {\nsectorAngles[i] = 360.0 * attributeData[i] / sum;\n}\nvec2 filteredSectorToColorId[numberOfFields];\nFilteredChartInfo filteredInfo = FilteredChartInfo(0.0, 0);\nint numOfEntries = filterValues(filteredSectorToColorId, filteredInfo, sectorAngles);\nv_numOfEntries = float(numOfEntries);\nv_maxSectorAngle = filteredInfo.endSectorAngle;\nv_filteredSectorToColorId = filteredSectorToColorId;\n#ifdef HITTEST\nhighp vec3 out_pos = vec3(0.0);\nv_color            = vec4(0.0);\nhittestMarker(v_color, out_pos, viewMat3 * tileMat3 *  pos, v_size);\ngl_PointSize = 1.0;\ngl_Position = vec4(clip(v_color, out_pos, filterFlags, a_zoomRange), 1.0);\n#else\ngl_Position = vec4(clip(v_color, v_pos, filterFlags, a_zoomRange), 1.0);\n#endif\n}"},shared:{line:{"common.glsl":"#if !defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE) && defined(PATTERN)\nuniform mediump vec2 u_mosaicSize;\nvarying mediump float v_sampleAlphaOnly;\n#endif\nstruct LineData {\nlowp vec4 color;\nmediump vec2 normal;\nmediump float lineHalfWidth;\nlowp float opacity;\n#ifndef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#ifdef PATTERN\nmediump vec4 tlbr;\nmediump vec2 patternSize;\n#endif\n#ifdef SDF\nmediump float lineWidthRatio;\n#endif\n#if defined(PATTERN) || defined(SDF)\nhighp float accumulatedDistance;\n#endif\n#endif\nhighp vec3 id;\n};","line.frag":"uniform lowp float u_blur;\n#if !defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE) && !defined(HIGHLIGHT)\n#if defined(PATTERN) || defined(SDF)\nuniform sampler2D u_texture;\nuniform highp float u_pixelRatio;\n#endif\n#endif\n#if defined(SDF) && !defined(HIGHLIGHT) && !defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE)\nlowp vec4 getLineColor(LineData line) {\nmediump float adjustedPatternWidth = line.patternSize.x * 2.0 * line.lineWidthRatio;\nmediump float relativeTexX = fract(line.accumulatedDistance / adjustedPatternWidth);\nmediump float relativeTexY = 0.5 + 0.25 * line.normal.y;\nmediump vec2 texCoord = mix(line.tlbr.xy, line.tlbr.zw, vec2(relativeTexX, relativeTexY));\nmediump float d = rgba2float(texture2D(u_texture, texCoord)) - 0.5;\nfloat dist = d * line.lineHalfWidth;\nreturn line.opacity * clamp(0.5 - dist, 0.0, 1.0) * line.color;\n}\n#elif defined(PATTERN) && !defined(HIGHLIGHT) && !defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE)\nlowp vec4 getLineColor(LineData line) {\nmediump float lineHalfWidth = line.lineHalfWidth;\nmediump float adjustedPatternHeight = line.patternSize.y * 2.0 * lineHalfWidth / line.patternSize.x;\nmediump float relativeTexY = fract(line.accumulatedDistance / adjustedPatternHeight);\nmediump float relativeTexX = 0.5 + 0.5 * line.normal.y;\nmediump vec2 texCoord = mix(line.tlbr.xy, line.tlbr.zw, vec2(relativeTexX, relativeTexY));\nlowp vec4 color = texture2D(u_texture, texCoord);\n#ifdef VV_COLOR\nif (v_sampleAlphaOnly > 0.5) {\ncolor.rgb = vec3(color.a);\n}\n#endif\nreturn line.opacity * line.color * color;\n}\n#else\nlowp vec4 getLineColor(LineData line) {\nreturn line.opacity * line.color;\n}\n#endif\nvec4 shadeLine(LineData line)\n{\nmediump float thinLineFactor = max(THIN_LINE_WIDTH_FACTOR * step(line.lineHalfWidth, THIN_LINE_HALF_WIDTH), 1.0);\nmediump float fragDist = length(line.normal) * line.lineHalfWidth;\nlowp float alpha = clamp(thinLineFactor * (line.lineHalfWidth - fragDist) / (u_blur + thinLineFactor - 1.0), 0.0, 1.0);\nlowp vec4 out_color = getLineColor(line) * alpha;\n#ifdef HIGHLIGHT\nout_color.a = step(1.0 / 255.0, out_color.a);\n#endif\n#ifdef ID\nif (out_color.a < 1.0 / 255.0) {\ndiscard;\n}\nout_color = vec4(line.id, 0.0);\n#endif\nreturn out_color;\n}","line.vert":"float getBaseLineHalfWidth(in float lineHalfWidth, in float referenceHalfWidth) {\n#ifdef VV_SIZE\nfloat refLineWidth = 2.0 * referenceHalfWidth;\nreturn 0.5 * (lineHalfWidth / max(referenceHalfWidth, EPSILON)) * getSize(refLineWidth);\n#else\nreturn lineHalfWidth;\n#endif\n}\nfloat getLineHalfWidth(in float baseWidth, in float aa) {\nfloat halfWidth = max(baseWidth + aa, 0.45) + 0.1 * aa;\n#ifdef HIGHLIGHT\nhalfWidth = max(halfWidth, 2.0);\n#endif\nreturn halfWidth;\n}\nvec2 getDist(in vec2 offset, in float halfWidth) {\nfloat thinLineFactor = max(THIN_LINE_WIDTH_FACTOR * step(halfWidth, THIN_LINE_HALF_WIDTH), 1.0);\nreturn thinLineFactor * halfWidth * offset;\n}\nLineData buildLine(\nout vec3 out_pos,\nin vec3 in_id,\nin vec2 in_pos,\nin vec4 in_color,\nin vec2 in_offset,\nin vec2 in_normal,\nin float in_accumulatedDist,\nin float in_lineHalfWidth,\nin float in_bitSet,\nin vec4 in_tlbr,\nin vec2 in_segmentDirection,\nin float in_referenceHalfWidth\n)\n{\nfloat aa        = 0.5 * u_antialiasing;\nfloat baseWidth = getBaseLineHalfWidth(in_lineHalfWidth, in_referenceHalfWidth);\nfloat halfWidth = getLineHalfWidth(baseWidth, aa);\nfloat z         = 2.0 * step(baseWidth, 0.0);\nvec2  dist      = getDist(in_offset, halfWidth);\nvec3  offset    = u_displayViewMat3 * vec3(dist, 0.0);\nvec3  pos       = u_dvsMat3 * vec3(in_pos * POSITION_PRECISION, 1.0) + offset;\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\nvec4  color     = in_color;\nfloat opacity   = 1.0;\n#else\nvec4  color     = getColor(in_color, in_bitSet, BITSET_GENERIC_LOCK_COLOR);\nfloat opacity   = getOpacity();\n#ifdef SDF\nconst float SDF_PATTERN_HALF_WIDTH = 15.5;\nfloat scaleDash = getBit(in_bitSet, BITSET_LINE_SCALE_DASH);\nfloat lineWidthRatio = (scaleDash * max(halfWidth - 0.55 * u_antialiasing, 0.25) + (1.0 - scaleDash)) / SDF_PATTERN_HALF_WIDTH;\n#endif\n#endif\n#if !defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE) && defined(PATTERN)\nv_sampleAlphaOnly = getBit(in_bitSet, BITSET_GENERIC_CONSIDER_ALPHA_ONLY);\n#endif\nout_pos = vec3(pos.xy, z);\nreturn LineData(\ncolor,\nin_normal,\nhalfWidth,\nopacity,\n#ifndef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#ifdef PATTERN\nin_tlbr / u_mosaicSize.xyxy,\nvec2(in_tlbr.z - in_tlbr.x, in_tlbr.w - in_tlbr.y),\n#endif\n#ifdef SDF\nlineWidthRatio,\n#endif\n#if defined(PATTERN) || defined(SDF)\nin_accumulatedDist * u_zoomFactor + dot(in_segmentDirection, dist),\n#endif\n#endif\nnorm(in_id)\n);\n}"}},"symbologyTypeUtils.glsl":"#if SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_OUTLINE_FILL || SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_OUTLINE_FILL_SIMPLE\n#define SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#endif\n#if SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_SIMPLE || SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_OUTLINE_FILL_SIMPLE\n#define SYMBOLOGY_TYPE_IS_SIMPLE_LIKE\n#endif",text:{"common.glsl":"uniform highp vec2 u_mosaicSize;\nvarying highp vec3 v_id;\nvarying mediump vec3 v_pos;\nvarying lowp float v_opacity;\nvarying lowp vec4 v_color;\nvarying highp vec2 v_tex;\nvarying mediump float v_antialiasingWidth;\nvarying mediump float v_edgeDistanceOffset;\nvarying lowp float v_transparency;","hittest.glsl":"#include <materials/hittest/common.glsl>","text.frag":"precision mediump float;\n#include <materials/text/common.glsl>\nuniform lowp sampler2D u_texture;\n#ifdef HITTEST\nvec4 getColor() {\nreturn v_color;\n}\n#else\nvec4 getColor()\n{\nfloat SDF_CUTOFF = (2.0 / 8.0);\nfloat SDF_BASE_EDGE_DIST = 1.0 - SDF_CUTOFF;\nlowp float dist = texture2D(u_texture, v_tex).a;\nmediump float edge = SDF_BASE_EDGE_DIST - v_edgeDistanceOffset;\n#ifdef HIGHLIGHT\nedge /= 2.0;\n#endif\nlowp float aa = v_antialiasingWidth;\nlowp float alpha = smoothstep(edge - aa, edge + aa, dist);\nreturn alpha * v_color * v_opacity;\n}\n#endif\nvoid main()\n{\ngl_FragColor = getColor();\n}","text.vert":"precision highp float;\n#include <materials/utils.glsl>\n#include <materials/vcommon.glsl>\n#include <materials/text/common.glsl>\n#include <materials/text/hittest.glsl>\nattribute vec4 a_color;\nattribute vec4 a_haloColor;\nattribute vec4 a_texFontSize;\nattribute vec4 a_aux;\nattribute vec2 a_zoomRange;\nattribute vec2 a_vertexOffset;\nattribute vec2 a_texCoords;\nuniform float u_isHaloPass;\nuniform float u_isBackgroundPass;\nfloat getTextSize(inout vec2 offset, inout float baseSize, in float referenceSize) {\n#ifdef VV_SIZE\nfloat r = getSize(referenceSize) / referenceSize;\nbaseSize *= r;\noffset.xy *= r;\nreturn baseSize;\n#endif\nreturn baseSize;\n}\nvoid main()\n{\nINIT;\nfloat a_isBackground  = a_aux.y;\nfloat a_referenceSize = a_aux.z * a_aux.z / 256.0;\nfloat a_bitSet        = a_aux.w;\nfloat a_fontSize      = a_texFontSize.z;\nvec2  a_offset        = a_vertexOffset * OFFSET_PRECISION;\nvec3  in_pos        = vec3(a_pos * POSITION_PRECISION, 1.0);\nfloat fontSize      = getTextSize(a_offset, a_fontSize, a_referenceSize);\nfloat fontScale     = fontSize / SDF_FONT_SIZE;\nvec3  offset        = getRotation() * vec3(a_offset, 0.0);\nmat3  extrudeMatrix = getBit(a_bitSet, 0) == 1.0 ? u_displayViewMat3 : u_displayMat3;\nfloat isText = 1.0 - a_isBackground;\nfloat isBackground = u_isBackgroundPass * a_isBackground;\nvec4  nonHaloColor  = (isBackground * a_color) + (isText * getColor(a_color, a_bitSet, 1));\nv_color   = u_isHaloPass * a_haloColor + (1.0 - u_isHaloPass) * nonHaloColor;\nv_opacity = getOpacity();\nv_id      = norm(a_id);\nv_tex     = a_texCoords / u_mosaicSize;\nv_pos     = u_dvsMat3 * in_pos + extrudeMatrix * offset;\nfloat isHidden = u_isBackgroundPass * isText + (1.0 - u_isBackgroundPass) * a_isBackground;\nv_pos.z += 2.0 * isHidden;\nv_edgeDistanceOffset = u_isHaloPass * OUTLINE_SCALE * a_texFontSize.w / fontScale / MAX_SDF_DISTANCE;\nv_antialiasingWidth  = 0.105 * SDF_FONT_SIZE / fontSize / u_pixelRatio;\n#ifdef HITTEST\nhighp vec3 out_pos  = vec3(0.);\nv_color = vec4(0.);\nhittestMarker(v_color, out_pos, u_viewMat3 * u_tileMat3 *  vec3(a_pos * POSITION_PRECISION, 1.0)\n+ u_tileMat3 * offset, fontSize / 2.);\ngl_PointSize = 1.;\ngl_Position = vec4(clip(v_color, out_pos, getFilterFlags(), a_zoomRange), 1.0);\n#else\ngl_Position =  vec4(clip(v_color, v_pos, getFilterFlags(), a_zoomRange), 1.0);\n#endif\n}"},"utils.glsl":"float rshift(in float u32, in int amount) {\nreturn floor(u32 / pow(2.0, float(amount)));\n}\nfloat getBit(in float bitset, in int bitIndex) {\nfloat offset = pow(2.0, float(bitIndex));\nreturn mod(floor(bitset / offset), 2.0);\n}\nconst int maxHighlightReasons = 6;\nfloat getFilterBit(in float bitset, in int bitIndex) {\nreturn getBit(bitset, bitIndex + maxHighlightReasons);\n}\nfloat getHighlightBit(in float bitset, in int bitIndex) {\nreturn getBit(bitset, bitIndex);\n}\nhighp vec3 unpackDisplayIdTexel(in highp vec3 bitset) {\nfloat isAggregate = getBit(bitset.b, 7);\nreturn (1.0 - isAggregate) * bitset + isAggregate * (vec3(bitset.rgb) - vec3(0.0, 0.0, float(0x80)));\n}\nvec4 unpack(in float u32) {\nfloat r = mod(rshift(u32, 0), 255.0);\nfloat g = mod(rshift(u32, 8), 255.0);\nfloat b = mod(rshift(u32, 16), 255.0);\nfloat a = mod(rshift(u32, 24), 255.0);\nreturn vec4(r, g, b, a);\n}\nvec3 norm(in vec3 v) {\nreturn v /= 255.0;\n}\nvec4 norm(in vec4 v) {\nreturn v /= 255.0;\n}\nfloat max4(vec4 target) {\nreturn max(max(max(target.x, target.y), target.z), target.w);\n}\nvec2 unpack_u8_nf32(vec2 bytes) {\nreturn (bytes - 127.0) / 127.0;\n}\nhighp float rand(in vec2 co) {\nhighp float a = 12.9898;\nhighp float b = 78.233;\nhighp float c = 43758.5453;\nhighp float dt = dot(co, vec2(a,b));\nhighp float sn = mod(dt, 3.14);\nreturn fract(sin(sn) * c);\n}","vcommon.glsl":"#include <materials/constants.glsl>\n#include <materials/utils.glsl>\n#include <materials/attributeData.glsl>\n#include <materials/vv.glsl>\n#include <materials/barycentric.glsl>\nattribute vec2 a_pos;\nattribute highp vec3 a_id;\nuniform highp mat3 displayViewScreenMat3;\nuniform highp mat3 displayViewMat3;\nuniform highp mat3 displayMat3;\nuniform highp mat3 tileMat3;\nuniform highp mat3 viewMat3;\nuniform highp float pixelRatio;\nuniform mediump float zoomFactor;\nuniform mediump float antialiasing;\nuniform mediump float currentScale;\nuniform mediump float currentZoom;\nuniform mediump float metersPerSRUnit;\nvec4 VV_ADATA = vec4(0.0);\nvoid loadVisualVariableData(inout vec4 target) {\ntarget.rgba = getVisualVariableData(a_id);\n}\n#ifdef VV\n#define INIT loadVisualVariableData(VV_ADATA)\n#else\n#define INIT\n#endif\nvec4 getColor(in vec4 a_color, in float a_bitSet, int index) {\n#ifdef VV_COLOR\nfloat isColorLocked   = getBit(a_bitSet, index);\nreturn getVVColor(VV_ADATA[ATTR_VV_COLOR], a_color, isColorLocked);\n#else\nreturn a_color;\n#endif\n}\nfloat getOpacity() {\n#ifdef VV_OPACITY\nreturn getVVOpacity(VV_ADATA[ATTR_VV_OPACITY]);\n#else\nreturn 1.0;\n#endif\n}\nfloat getSize(in float in_size, in float currentScale) {\n#ifdef VV_SIZE\nreturn getVVSize(in_size, VV_ADATA[ATTR_VV_SIZE], currentScale);\n#else\nreturn in_size;\n#endif\n}\nmat3 getRotation() {\n#ifdef VV_ROTATION\nreturn getVVRotationMat3(mod(VV_ADATA[ATTR_VV_ROTATION], 360.0));\n#else\nreturn mat3(1.0);\n#endif\n}\nfloat getFilterFlags() {\n#ifdef IGNORES_SAMPLER_PRECISION\nreturn ceil(getFilterData(a_id).x * 255.0);\n#else\nreturn getFilterData(a_id).x * 255.0;\n#endif\n}\nvec4 getAnimationState() {\nreturn getAnimation(a_id);\n}\nfloat getMinZoom() {\nvec4 data0 = getFilterData(a_id) * 255.0;\nreturn data0.g;\n}\nmat3 getMatrixNoDisplay(float isMapAligned) {\nreturn isMapAligned * viewMat3 * tileMat3 + (1.0 - isMapAligned) * tileMat3;\n}\nmat3 getMatrix(float isMapAligned) {\nreturn isMapAligned * displayViewMat3 + (1.0 - isMapAligned) * displayMat3;\n}\nfloat checkHighlightBit(float filterFlags, int index) {\nreturn getHighlightBit(filterFlags, index);\n}\nfloat checkHighlight(float filterFlags) {\nfloat result = checkHighlightBit(filterFlags, 0);\nfor (int i = 1; i < maxHighlightReasons; i++) {\nresult = result + checkHighlightBit(filterFlags, i);\n}\nreturn step(0.1, result);\n}\nvec3 clip(inout vec4 color, inout vec3 pos, in float filterFlags, in vec2 minMaxZoom) {\npos.z += 2.0 * (1.0 - getFilterBit(filterFlags, 0));\n#ifdef inside\npos.z += 2.0 * (1.0 - getFilterBit(filterFlags, 1));\n#elif defined(outside)\npos.z += 2.0 * getFilterBit(filterFlags, 1);\n#elif defined(highlight)\n#if !defined(highlight_all)\npos.z += 2.0 * (1.0 - checkHighlight(filterFlags));\n#endif\n#endif\npos.z += 2.0 * (step(minMaxZoom.y, currentZoom) + (1.0 - step(minMaxZoom.x, currentZoom)));\nreturn pos;\n}","vv.glsl":"#if defined(VV_SIZE_MIN_MAX_VALUE) || defined(VV_SIZE_SCALE_STOPS) || defined(VV_SIZE_FIELD_STOPS) || defined(VV_SIZE_UNIT_VALUE)\n#define VV_SIZE\n#endif\n#if defined(VV_COLOR) || defined(VV_SIZE) || defined(VV_OPACITY) || defined(VV_ROTATION)\n#define VV\n#endif\n#ifdef VV_COLOR\nuniform highp float colorValues[8];\nuniform vec4 colors[8];\n#endif\n#ifdef VV_SIZE_MIN_MAX_VALUE\nuniform highp vec4 minMaxValueAndSize;\n#endif\n#ifdef VV_SIZE_SCALE_STOPS\nuniform highp float values[8];\nuniform float sizes[8];\n#endif\n#ifdef VV_SIZE_FIELD_STOPS\nuniform highp float values[8];\nuniform float sizes[8];\n#endif\n#ifdef VV_SIZE_UNIT_VALUE\nuniform highp float unitMeterRatio;\n#endif\n#ifdef VV_OPACITY\nuniform highp float opacityValues[8];\nuniform float opacities[8];\n#endif\n#ifdef VV_ROTATION\nuniform lowp float rotationType;\n#endif\nbool isNan(float val) {\nreturn (val == NAN_MAGIC_NUMBER);\n}\n#ifdef VV_SIZE_MIN_MAX_VALUE\nfloat getVVMinMaxSize(float sizeValue, float fallback) {\nif (isNan(sizeValue)) {\nreturn fallback;\n}\nfloat interpolationRatio = (sizeValue  - minMaxValueAndSize.x) / (minMaxValueAndSize.y - minMaxValueAndSize.x);\ninterpolationRatio = clamp(interpolationRatio, 0.0, 1.0);\nreturn minMaxValueAndSize.z + interpolationRatio * (minMaxValueAndSize.w - minMaxValueAndSize.z);\n}\n#endif\n#ifdef VV_SIZE_SCALE_STOPS\nfloat getVVScaleStopsSize(float currentScale) {\nfloat outSize;\nif (currentScale <= values[0]) {\noutSize = sizes[0];\n} else {\nif (currentScale >= values[7]) {\noutSize = sizes[7];\n} else {\nint index;\nindex = -1;\nfor (int i = 0; i < 8; i++) {\nif (values[i] > currentScale) {\nindex = i;\nbreak;\n}\n}\nint prevIndex = index - 1;\nfloat a = currentScale - values[prevIndex];\nfloat b = values[index] - values[prevIndex];\noutSize = mix(sizes[prevIndex], sizes[index], a / b);\n}\n}\nreturn outSize;\n}\n#endif\n#ifdef VV_SIZE_FIELD_STOPS\nconst int VV_SIZE_N = 8;\nfloat getVVStopsSize(float sizeValue, float fallback) {\nif (isNan(sizeValue)) {\nreturn fallback;\n}\nif (sizeValue <= values[0]) {\nreturn sizes[0];\n}\nif (sizeValue >= values[VV_SIZE_N - 1]) {\nreturn sizes[VV_SIZE_N - 1];\n}\nfor (int i = 1; i < VV_SIZE_N; ++i) {\nif (values[i] >= sizeValue) {\nfloat f = (sizeValue - values[i-1]) / (values[i] - values[i-1]);\nreturn mix(sizes[i-1], sizes[i], f);\n}\n}\nreturn sizes[VV_SIZE_N - 1];\n}\n#endif\n#ifdef VV_SIZE_UNIT_VALUE\nfloat getVVUnitValue(float sizeValue, float fallback) {\nif (isNan(sizeValue)) {\nreturn fallback;\n}\nreturn sizeValue * (metersPerSRUnit / unitMeterRatio);\n}\n#endif\n#ifdef VV_OPACITY\nconst int VV_OPACITY_N = 8;\nfloat getVVOpacity(float opacityValue) {\nif (isNan(opacityValue)) {\nreturn 1.0;\n}\nif (opacityValue <= opacityValues[0]) {\nreturn opacities[0];\n}\nfor (int i = 1; i < VV_OPACITY_N; ++i) {\nif (opacityValues[i] >= opacityValue) {\nfloat f = (opacityValue - opacityValues[i-1]) / (opacityValues[i] - opacityValues[i-1]);\nreturn mix(opacities[i-1], opacities[i], f);\n}\n}\nreturn opacities[VV_OPACITY_N - 1];\n}\n#endif\n#ifdef VV_ROTATION\nmat4 getVVRotation(float rotationValue) {\nif (isNan(rotationValue)) {\nreturn mat4(1, 0, 0, 0,\n0, 1, 0, 0,\n0, 0, 1, 0,\n0, 0, 0, 1);\n}\nfloat rotation = rotationValue;\nif (rotationType == 1.0) {\nrotation = 90.0 - rotation;\n}\nfloat angle = C_DEG_TO_RAD * rotation;\nfloat sinA = sin(angle);\nfloat cosA = cos(angle);\nreturn mat4(cosA, sinA, 0, 0,\n-sinA,  cosA, 0, 0,\n0,     0, 1, 0,\n0,     0, 0, 1);\n}\nmat3 getVVRotationMat3(float rotationValue) {\nif (isNan(rotationValue)) {\nreturn mat3(1, 0, 0,\n0, 1, 0,\n0, 0, 1);\n}\nfloat rotation = rotationValue;\nif (rotationType == 1.0) {\nrotation = 90.0 - rotation;\n}\nfloat angle = C_DEG_TO_RAD * -rotation;\nfloat sinA = sin(angle);\nfloat cosA = cos(angle);\nreturn mat3(cosA, -sinA, 0,\nsinA, cosA, 0,\n0,    0,    1);\n}\n#endif\n#ifdef VV_COLOR\nconst int VV_COLOR_N = 8;\nvec4 getVVColor(float colorValue, vec4 fallback, float isColorLocked) {\nif (isNan(colorValue) || isColorLocked == 1.0) {\nreturn fallback;\n}\nif (colorValue <= colorValues[0]) {\nreturn colors[0];\n}\nfor (int i = 1; i < VV_COLOR_N; ++i) {\nif (colorValues[i] >= colorValue) {\nfloat f = (colorValue - colorValues[i-1]) / (colorValues[i] - colorValues[i-1]);\nreturn mix(colors[i-1], colors[i], f);\n}\n}\nreturn colors[VV_COLOR_N - 1];\n}\n#endif\nfloat getVVSize(in float size, in float vvSize, in float currentScale)  {\n#ifdef VV_SIZE_MIN_MAX_VALUE\nreturn getVVMinMaxSize(vvSize, size);\n#elif defined(VV_SIZE_SCALE_STOPS)\nfloat outSize = getVVScaleStopsSize(currentScale);\nreturn isNan(outSize) ? size : outSize;\n#elif defined(VV_SIZE_FIELD_STOPS)\nfloat outSize = getVVStopsSize(vvSize, size);\nreturn isNan(outSize) ? size : outSize;\n#elif defined(VV_SIZE_UNIT_VALUE)\nreturn getVVUnitValue(vvSize, size);\n#else\nreturn size;\n#endif\n}"},"post-processing":{blit:{"blit.frag":"precision mediump float;\nuniform sampler2D u_texture;\nvarying vec2 v_uv;\nvoid main() {\ngl_FragColor = texture2D(u_texture, v_uv);\n}"},bloom:{composite:{"composite.frag":"precision mediump float;\nvarying vec2 v_uv;\nuniform sampler2D u_blurTexture1;\nuniform sampler2D u_blurTexture2;\nuniform sampler2D u_blurTexture3;\nuniform sampler2D u_blurTexture4;\nuniform sampler2D u_blurTexture5;\nuniform float u_bloomStrength;\nuniform float u_bloomRadius;\nuniform float u_bloomFactors[NUMMIPS];\nuniform vec3 u_bloomTintColors[NUMMIPS];\nfloat lerpBloomFactor(const in float factor) {\nfloat mirrorFactor = 1.2 - factor;\nreturn mix(factor, mirrorFactor, u_bloomRadius);\n}\nvoid main() {\nvec4 color = u_bloomStrength * (\nlerpBloomFactor(u_bloomFactors[0]) * vec4(u_bloomTintColors[0], 1.0) * texture2D(u_blurTexture1, v_uv) +\nlerpBloomFactor(u_bloomFactors[1]) * vec4(u_bloomTintColors[1], 1.0) * texture2D(u_blurTexture2, v_uv) +\nlerpBloomFactor(u_bloomFactors[2]) * vec4(u_bloomTintColors[2], 1.0) * texture2D(u_blurTexture3, v_uv) +\nlerpBloomFactor(u_bloomFactors[3]) * vec4(u_bloomTintColors[3], 1.0) * texture2D(u_blurTexture4, v_uv) +\nlerpBloomFactor(u_bloomFactors[4]) * vec4(u_bloomTintColors[4], 1.0) * texture2D(u_blurTexture5, v_uv)\n);\ngl_FragColor = clamp(color, 0.0, 1.0);\n}"},gaussianBlur:{"gaussianBlur.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nuniform vec2 u_texSize;\nuniform vec2 u_direction;\nvarying vec2 v_uv;\n#define KERNEL_RADIUS RADIUS\n#define SIGMA RADIUS\nfloat gaussianPdf(in float x, in float sigma) {\nreturn 0.39894 * exp(-0.5 * x * x / ( sigma * sigma)) / sigma;\n}\nvoid main() {\nvec2 invSize = 1.0 / u_texSize;\nfloat fSigma = float(SIGMA);\nfloat weightSum = gaussianPdf(0.0, fSigma);\nvec4 pixelColorSum = texture2D(u_colorTexture, v_uv) * weightSum;\nfor (int i = 1; i < KERNEL_RADIUS; i ++) {\nfloat x = float(i);\nfloat w = gaussianPdf(x, fSigma);\nvec2 uvOffset = u_direction * invSize * x;\nvec4 sample1 = texture2D(u_colorTexture, v_uv + uvOffset);\nvec4 sample2 = texture2D(u_colorTexture, v_uv - uvOffset);\npixelColorSum += (sample1 + sample2) * w;\nweightSum += 2.0 * w;\n}\ngl_FragColor = pixelColorSum /weightSum;\n}"},luminosityHighPass:{"luminosityHighPass.frag":"precision mediump float;\nuniform sampler2D u_texture;\nuniform vec3 u_defaultColor;\nuniform float u_defaultOpacity;\nuniform float u_luminosityThreshold;\nuniform float u_smoothWidth;\nvarying vec2 v_uv;\nvoid main() {\nvec4 texel = texture2D(u_texture, v_uv);\nvec3 luma = vec3(0.299, 0.587, 0.114);\nfloat v = dot(texel.xyz, luma);\nvec4 outputColor = vec4(u_defaultColor.rgb, u_defaultOpacity);\nfloat alpha = smoothstep(u_luminosityThreshold, u_luminosityThreshold + u_smoothWidth, v);\ngl_FragColor = mix(outputColor, texel, alpha);\n}"}},blur:{gaussianBlur:{"gaussianBlur.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nuniform vec2 u_texSize;\nuniform vec2 u_direction;\nuniform float u_sigma;\nvarying vec2 v_uv;\n#define KERNEL_RADIUS RADIUS\nfloat gaussianPdf(in float x, in float sigma) {\nreturn 0.39894 * exp(-0.5 * x * x / ( sigma * sigma)) / sigma;\n}\nvoid main() {\nvec2 invSize = 1.0 / u_texSize;\nfloat fSigma = u_sigma;\nfloat weightSum = gaussianPdf(0.0, fSigma);\nvec4 pixelColorSum = texture2D(u_colorTexture, v_uv) * weightSum;\nfor (int i = 1; i < KERNEL_RADIUS; i ++) {\nfloat x = float(i);\nfloat w = gaussianPdf(x, fSigma);\nvec2 uvOffset = u_direction * invSize * x;\nvec4 sample1 = texture2D(u_colorTexture, v_uv + uvOffset);\nvec4 sample2 = texture2D(u_colorTexture, v_uv - uvOffset);\npixelColorSum += (sample1 + sample2) * w;\nweightSum += 2.0 * w;\n}\ngl_FragColor = pixelColorSum /weightSum;\n}"},"radial-blur":{"radial-blur.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nvarying vec2 v_uv;\nconst float sampleDist = 1.0;\nconst float sampleStrength = 2.2;\nvoid main(void) {\nfloat samples[10];\nsamples[0] = -0.08;\nsamples[1] = -0.05;\nsamples[2] = -0.03;\nsamples[3] = -0.02;\nsamples[4] = -0.01;\nsamples[5] =  0.01;\nsamples[6] =  0.02;\nsamples[7] =  0.03;\nsamples[8] =  0.05;\nsamples[9] =  0.08;\nvec2 dir = 0.5 - v_uv;\nfloat dist = sqrt(dir.x * dir.x + dir.y * dir.y);\ndir = dir / dist;\nvec4 color = texture2D(u_colorTexture,v_uv);\nvec4 sum = color;\nfor (int i = 0; i < 10; i++) {\nsum += texture2D(u_colorTexture, v_uv + dir * samples[i] * sampleDist);\n}\nsum *= 1.0 / 11.0;\nfloat t = dist * sampleStrength;\nt = clamp(t, 0.0, 1.0);\ngl_FragColor = mix(color, sum, t);\n}"}},dra:{"dra.frag":"precision mediump float;\nuniform sampler2D u_minColor;\nuniform sampler2D u_maxColor;\nuniform sampler2D u_texture;\nvarying vec2 v_uv;\nvoid main() {\nvec4 minColor = texture2D(u_minColor, vec2(0.5));\nvec4 maxColor = texture2D(u_maxColor, vec2(0.5));\nvec4 color = texture2D(u_texture, v_uv);\nvec3 minColorUnpremultiply = minColor.rgb / minColor.a;\nvec3 maxColorUnpremultiply = maxColor.rgb / maxColor.a;\nvec3 colorUnpremultiply = color.rgb / color.a;\nvec3 range = maxColorUnpremultiply - minColorUnpremultiply;\ngl_FragColor = vec4(color.a * (colorUnpremultiply - minColorUnpremultiply) / range, color.a);\n}","min-max":{"min-max.frag":"#extension GL_EXT_draw_buffers : require\nprecision mediump float;\n#define CELL_SIZE 2\nuniform sampler2D u_minTexture;\nuniform sampler2D u_maxTexture;\nuniform vec2 u_srcResolution;\nuniform vec2 u_dstResolution;\nvarying vec2 v_uv;\nvoid main() {\nvec2 srcPixel = floor(gl_FragCoord.xy) * float(CELL_SIZE);\nvec2 onePixel = vec2(1.0) / u_srcResolution;\nvec2 uv = (srcPixel + 0.5) / u_srcResolution;\nvec4 minColor = vec4(1.0);\nvec4 maxColor = vec4(0.0);\nfor (int y = 0; y < CELL_SIZE; ++y) {\nfor (int x = 0; x < CELL_SIZE; ++x) {\nvec2 offset = uv + vec2(x, y) * onePixel;\nminColor = min(minColor, texture2D(u_minTexture, offset));\nmaxColor = max(maxColor, texture2D(u_maxTexture, offset));\n}\n}\ngl_FragData[0] = minColor;\ngl_FragData[1] = maxColor;\n}"}},"drop-shadow":{composite:{"composite.frag":"precision mediump float;\nuniform sampler2D u_layerFBOTexture;\nuniform sampler2D u_blurTexture;\nuniform vec4 u_shadowColor;\nuniform vec2 u_shadowOffset;\nuniform highp mat3 u_displayViewMat3;\nvarying vec2 v_uv;\nvoid main() {\nvec3 offset = u_displayViewMat3 * vec3(u_shadowOffset, 0.0);\nvec4 layerColor = texture2D(u_layerFBOTexture, v_uv);\nvec4 blurColor = texture2D(u_blurTexture, v_uv - offset.xy / 2.0);\ngl_FragColor = ((1.0 - layerColor.a) * blurColor.a * u_shadowColor + layerColor);\n}"}},"edge-detect":{"frei-chen":{"frei-chen.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nuniform vec2 u_texSize;\nvarying vec2 v_uv;\nvec2 texel = vec2(1.0 / u_texSize.x, 1.0 / u_texSize.y);\nmat3 G[9];\nconst mat3 g0 = mat3( 0.3535533845424652, 0, -0.3535533845424652, 0.5, 0, -0.5, 0.3535533845424652, 0, -0.3535533845424652 );\nconst mat3 g1 = mat3( 0.3535533845424652, 0.5, 0.3535533845424652, 0, 0, 0, -0.3535533845424652, -0.5, -0.3535533845424652 );\nconst mat3 g2 = mat3( 0, 0.3535533845424652, -0.5, -0.3535533845424652, 0, 0.3535533845424652, 0.5, -0.3535533845424652, 0 );\nconst mat3 g3 = mat3( 0.5, -0.3535533845424652, 0, -0.3535533845424652, 0, 0.3535533845424652, 0, 0.3535533845424652, -0.5 );\nconst mat3 g4 = mat3( 0, -0.5, 0, 0.5, 0, 0.5, 0, -0.5, 0 );\nconst mat3 g5 = mat3( -0.5, 0, 0.5, 0, 0, 0, 0.5, 0, -0.5 );\nconst mat3 g6 = mat3( 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.6666666865348816, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204 );\nconst mat3 g7 = mat3( -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, 0.6666666865348816, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408 );\nconst mat3 g8 = mat3( 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408 );\nvoid main() {\nG[0] = g0,\nG[1] = g1,\nG[2] = g2,\nG[3] = g3,\nG[4] = g4,\nG[5] = g5,\nG[6] = g6,\nG[7] = g7,\nG[8] = g8;\nmat3 I;\nfloat cnv[9];\nvec3 sample;\nfor (float i = 0.0; i < 3.0; i++) {\nfor (float j = 0.0; j < 3.0; j++) {\nsample = texture2D(u_colorTexture, v_uv + texel * vec2(i - 1.0,j - 1.0)).rgb;\nI[int(i)][int(j)] = length(sample);\n}\n}\nfor (int i = 0; i < 9; i++) {\nfloat dp3 = dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);\ncnv[i] = dp3 * dp3;\n}\nfloat M = (cnv[0] + cnv[1]) + (cnv[2] + cnv[3]);\nfloat S = (cnv[4] + cnv[5]) + (cnv[6] + cnv[7]) + (cnv[8] + M);\ngl_FragColor = vec4(vec3(sqrt(M / S)), texture2D(u_colorTexture, v_uv).a);\n}"},sobel:{"sobel.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nvarying vec2 v_uv;\nuniform vec2 u_texSize;\nvec2 texel = vec2(1.0 / u_texSize.x, 1.0 / u_texSize.y);\nmat3 G[2];\nconst mat3 g0 = mat3( 1.0, 2.0, 1.0, 0.0, 0.0, 0.0, -1.0, -2.0, -1.0 );\nconst mat3 g1 = mat3( 1.0, 0.0, -1.0, 2.0, 0.0, -2.0, 1.0, 0.0, -1.0 );\nvoid main() {\nmat3 I;\nfloat cnv[2];\nvec3 sample;\nG[0] = g0;\nG[1] = g1;\nfor (float i = 0.0; i < 3.0; i++) {\nfor (float j = 0.0; j < 3.0; j++) {\nsample = texture2D( u_colorTexture, v_uv + texel * vec2(i-1.0,j-1.0) ).rgb;\nI[int(i)][int(j)] = length(sample);\n}\n}\nfor (int i = 0; i < 2; i++) {\nfloat dp3 = dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);\ncnv[i] = dp3 * dp3;\n}\ngl_FragColor = vec4(vec3(0.5 * sqrt(cnv[0] * cnv[0] + cnv[1] * cnv[1])), texture2D(u_colorTexture, v_uv).a);\n}"}},"edge-enhance":{"edge-enhance.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nvarying vec2 v_uv;\nuniform vec2 u_texSize;\nvec2 texel = vec2(1.0 / u_texSize.x, 1.0 / u_texSize.y);\nmat3 G[2];\nconst mat3 g0 = mat3( 1.0, 0.0, -1.0, 1.0, 0.0, -1.0, 1.0, 0.0, -1.0 );\nconst mat3 g1 = mat3( 1.0, 1.0, 1.0, 0.0, 0.0, 0.0, -1.0, -1.0, -1.0 );\nvoid main() {\nmat3 I;\nfloat cnv[2];\nvec3 sample;\nG[0] = g0;\nG[1] = g1;\nfor (float i = 0.0; i < 3.0; i++) {\nfor (float j = 0.0; j < 3.0; j++) {\nsample = texture2D( u_colorTexture, v_uv + texel * vec2(i-1.0,j-1.0) ).rgb;\nI[int(i)][int(j)] = length(sample);\n}\n}\nfor (int i = 0; i < 2; i++) {\nfloat dp3 = dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);\ncnv[i] = dp3 * dp3;\n}\nvec4 color = texture2D(u_colorTexture, v_uv);\ngl_FragColor = vec4(0.5 * sqrt(cnv[0] * cnv[0] + cnv[1] * cnv[1]) * color);\n}"},filterEffect:{"filterEffect.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nuniform mat4 u_coefficients;\nvarying vec2 v_uv;\nvoid main() {\nvec4 color = texture2D(u_colorTexture, v_uv);\nvec4 rgbw = u_coefficients * vec4(color.a > 0.0 ? color.rgb / color.a : vec3(0.0), 1.0);\nfloat a = color.a;\ngl_FragColor = vec4(a * rgbw.rgb, a);\n}"},pp:{"pp.vert":"precision mediump float;\nattribute vec2 a_position;\nvarying vec2 v_uv;\nvoid main() {\ngl_Position = vec4(a_position, 0.0, 1.0);\nv_uv = (a_position + 1.0) / 2.0;\n}"}},raster:{bitmap:{"bitmap.frag":"precision mediump float;\nvarying highp vec2 v_texcoord;\nuniform sampler2D u_texture;\nuniform highp vec2 u_coordScale;\nuniform lowp float u_opacity;\n#include <filtering/bicubic.glsl>\nvoid main() {\n#ifdef BICUBIC\nvec4 color = sampleBicubicBSpline(u_texture, v_texcoord, u_coordScale);\n#else\nvec4 color = texture2D(u_texture, v_texcoord);\n#endif\ngl_FragColor = vec4(color.rgb * u_opacity, color.a * u_opacity);\n}","bitmap.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\nv_texcoord = a_pos;\ngl_Position = vec4(u_dvsMat3 * vec3(a_pos * u_coordScale, 1.0), 1.0);\n}"},common:{"common.glsl":"uniform sampler2D u_image;\nuniform int u_bandCount;\nuniform bool u_flipY;\nuniform float u_opacity;\nuniform int u_resampling;\nuniform vec2 u_srcImageSize;\n#ifdef APPLY_PROJECTION\n#include <raster/common/projection.glsl>\n#endif\n#ifdef BICUBIC\n#include <filtering/bicubic.glsl>\n#endif\n#ifdef BILINEAR\n#include <filtering/bilinear.glsl>\n#endif\nvec2 getPixelLocation(vec2 coords) {\nvec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;\n#ifdef APPLY_PROJECTION\ntargetLocation = projectPixelLocation(targetLocation);\n#endif\nreturn targetLocation;\n}\nbool isOutside(vec2 coords){\nif (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {\nreturn true;\n} else {\nreturn false;\n}\n}\nvec4 getPixel(vec2 pixelLocation) {\n#ifdef BICUBIC\nvec4 color = sampleBicubicBSpline(u_image, pixelLocation, u_srcImageSize);\n#elif defined(BILINEAR)\nvec4 color = sampleBilinear(u_image, pixelLocation, u_srcImageSize);\n#else\nvec4 color = texture2D(u_image, pixelLocation);\n#endif\nreturn color;\n}","common.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nuniform highp float u_scale;\nuniform highp vec2 u_offset;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\nv_texcoord = a_pos * u_scale + u_offset;\ngl_Position = vec4(u_dvsMat3 * vec3(a_pos * u_coordScale, 1.0), 1.0);\n}","contrastBrightness.glsl":"uniform float u_contrastOffset;\nuniform float u_brightnessOffset;\nvec4 adjustContrastBrightness(vec4 currentPixel, bool isFloat) {\nvec4 pixelValue = isFloat ? currentPixel * 255.0 : currentPixel;\nfloat maxI = 255.0;\nfloat mid = 128.0;\nfloat c = u_contrastOffset;\nfloat b = u_brightnessOffset;\nvec4 v;\nif (c > 0.0 && c < 100.0) {\nv = (200.0 * pixelValue - 100.0 * maxI + 2.0 * maxI * b) / (2.0 * (100.0 - c)) + mid;\n} else if (c <= 0.0 && c > -100.0) {\nv = (200.0 * pixelValue - 100.0 * maxI + 2.0 * maxI * b) * (100.0 + c) / 20000.0 + mid;\n} else if (c == 100.0) {\nv = (200.0 * pixelValue - 100.0 * maxI + (maxI + 1.0) * (100.0 - c) + 2.0 * maxI * b);\nv = (sign(v) + 1.0) / 2.0;\n} else if (c == -100.0) {\nv = vec4(mid, mid, mid, currentPixel.a);\n}\nvec3 rgb = clamp(v.rgb / 255.0, 0.0, 1.0);\nreturn vec4(rgb, currentPixel.a);\n}","getSurfaceValues.glsl":"#include <raster/common/mirror.glsl>\nvoid getSurfaceValues(sampler2D imageTexture, vec2 texCoord, vec2 srcImageSize, inout float values[10]) {\nvec2 onePixel = 1.0 / srcImageSize;\nvec4 va = texture2D(imageTexture, mirror(texCoord + onePixel * vec2(-1.0, -1.0)));\nvec4 vb = texture2D(imageTexture, mirror(texCoord + onePixel * vec2(0.0, -1.0)));\nvec4 vc = texture2D(imageTexture, mirror(texCoord + onePixel * vec2(1.0, -1.0)));\nvec4 vd = texture2D(imageTexture, mirror(texCoord + onePixel * vec2(-1.0, 0.0)));\nvec4 ve = texture2D(imageTexture, mirror(texCoord));\nvec4 vf = texture2D(imageTexture, mirror(texCoord + onePixel * vec2(1.0, 0.0)));\nvec4 vg = texture2D(imageTexture, mirror(texCoord + onePixel * vec2(-1.0, 1.0)));\nvec4 vh = texture2D(imageTexture, mirror(texCoord + onePixel * vec2(0.0, 1.0)));\nvec4 vi = texture2D(imageTexture, mirror(texCoord + onePixel * vec2(1.0, 1.0)));\nfloat alpha = va.a * vb.a * vc.a * vd.a * ve.a * vf.a * vg.a * vh.a * vi.a;\nvalues[0] = va.r;\nvalues[1] = vb.r;\nvalues[2] = vc.r;\nvalues[3] = vd.r;\nvalues[4] = ve.r;\nvalues[5] = vf.r;\nvalues[6] = vg.r;\nvalues[7] = vh.r;\nvalues[8] = vi.r;\nvalues[9] = alpha;\n}","inverse.glsl":"float invertValue(float value) {\nfloat s = sign(value);\nreturn (s * s) / (value + abs(s) - 1.0);\n}","mirror.glsl":"vec2 mirror(vec2 pos) {\nvec2 pos1 = abs(pos);\nreturn step(pos1, vec2(1.0, 1.0)) * pos1 + step(1.0, pos1) * (2.0 - pos1);\n}","projection.glsl":"uniform sampler2D u_transformGrid;\nuniform vec2 u_transformSpacing;\nuniform vec2 u_transformGridSize;\nuniform vec2 u_targetImageSize;\nvec2 projectPixelLocation(vec2 coords) {\n#ifdef LOOKUP_PROJECTION\nvec4 pv = texture2D(u_transformGrid, coords);\nreturn vec2(pv.r, pv.g);\n#endif\nvec2 index_image = floor(coords * u_targetImageSize);\nvec2 oneTransformPixel = vec2(0.25 / u_transformGridSize.s, 1.0 / u_transformGridSize.t);\nvec2 index_transform = floor(index_image / u_transformSpacing) / u_transformGridSize;\nvec2 pos = fract((index_image + vec2(0.5, 0.5)) / u_transformSpacing);\nvec2 srcLocation;\nvec2 transform_location = index_transform + oneTransformPixel * 0.5;\nif (pos.s <= pos.t) {\nvec4 ll_abc = texture2D(u_transformGrid, vec2(transform_location.s, transform_location.t));\nvec4 ll_def = texture2D(u_transformGrid, vec2(transform_location.s + oneTransformPixel.s, transform_location.t));\nsrcLocation.s = dot(ll_abc.rgb, vec3(pos, 1.0));\nsrcLocation.t = dot(ll_def.rgb, vec3(pos, 1.0));\n} else {\nvec4 ur_abc = texture2D(u_transformGrid, vec2(transform_location.s + 2.0 * oneTransformPixel.s, transform_location.t));\nvec4 ur_def = texture2D(u_transformGrid, vec2(transform_location.s + 3.0 * oneTransformPixel.s, transform_location.t));\nsrcLocation.s = dot(ur_abc.rgb, vec3(pos, 1.0));\nsrcLocation.t = dot(ur_def.rgb, vec3(pos, 1.0));\n}\nreturn srcLocation;\n}"},flow:{"getFadeOpacity.glsl":"uniform float u_decayRate;\nuniform float u_fadeToZero;\nfloat getFadeOpacity(float x) {\nfloat cutOff = mix(0.0, exp(-u_decayRate), u_fadeToZero);\nreturn (exp(-u_decayRate * x) - cutOff) / (1.0 - cutOff);\n}","getFragmentColor.glsl":"vec4 getFragmentColor(vec4 color, float dist, float size, float featheringSize) {\nfloat featheringStart = clamp(0.5 - featheringSize / size, 0.0, 0.5);\nif (dist > featheringStart) {\ncolor *= 1.0 - (dist - featheringStart) / (0.5 - featheringStart);\n}\nreturn color;\n}",imagery:{"imagery.frag":"precision highp float;\nvarying vec2 v_texcoord;\nuniform sampler2D u_texture;\nuniform float u_Min;\nuniform float u_Max;\nuniform float u_featheringSize;\n#include <raster/flow/vv.glsl>\nfloat getIntensity(float v) {\nreturn u_Min + v * (u_Max - u_Min);\n}\nvoid main(void) {\nvec4 sampled = texture2D(u_texture, v_texcoord);\nfloat intensity = getIntensity(sampled.r);\ngl_FragColor = getColor(intensity);\ngl_FragColor.a *= getOpacity(sampled.r);\ngl_FragColor.a *= sampled.a;\ngl_FragColor.rgb *= gl_FragColor.a;\n}","imagery.vert":"attribute vec2 a_position;\nattribute vec2 a_texcoord;\nuniform mat3 u_dvsMat3;\nvarying vec2 v_texcoord;\nvoid main(void) {\nvec2 xy = (u_dvsMat3 * vec3(a_position, 1.0)).xy;\ngl_Position = vec4(xy, 0.0, 1.0);\nv_texcoord = a_texcoord;\n}"},particles:{"particles.frag":"precision highp float;\nvarying vec4 v_color;\nvarying vec2 v_texcoord;\nvarying float v_size;\nuniform float u_featheringSize;\n#include <raster/flow/getFragmentColor.glsl>\nvoid main(void) {\ngl_FragColor = getFragmentColor(v_color, length(v_texcoord - 0.5), v_size, u_featheringSize);\n}","particles.vert":"attribute vec4 a_xyts0;\nattribute vec4 a_xyts1;\nattribute vec4 a_typeIdDurationSeed;\nattribute vec4 a_extrudeInfo;\nuniform mat3 u_dvsMat3;\nuniform mat3 u_displayViewMat3;\nuniform float u_time;\nuniform float u_trailLength;\nuniform float u_flowSpeed;\nvarying vec4 v_color;\nvarying vec2 v_texcoord;\nvarying float v_size;\nuniform float u_featheringSize;\nuniform float u_introFade;\n#include <raster/flow/vv.glsl>\n#include <raster/flow/getFadeOpacity.glsl>\nvoid main(void) {\nvec2 position0 = a_xyts0.xy;\nfloat t0 = a_xyts0.z;\nfloat speed0 = a_xyts0.w;\nvec2 position1 = a_xyts1.xy;\nfloat t1 = a_xyts1.z;\nfloat speed1 = a_xyts1.w;\nfloat type = a_typeIdDurationSeed.x;\nfloat id = a_typeIdDurationSeed.y;\nfloat duration = a_typeIdDurationSeed.z;\nfloat seed = a_typeIdDurationSeed.w;\nvec2 e0 = a_extrudeInfo.xy;\nvec2 e1 = a_extrudeInfo.zw;\nfloat animationPeriod = duration + u_trailLength;\nfloat scaledTime = u_time * u_flowSpeed;\nfloat randomizedTime = scaledTime + seed * animationPeriod;\nfloat t = mod(randomizedTime, animationPeriod);\nfloat fUnclamped = (t - t0) / (t1 - t0);\nfloat f = clamp(fUnclamped, 0.0, 1.0);\nfloat clampedTime = mix(t0, t1, f);\nfloat speed = mix(speed0, speed1, f);\nvec2 extrude;\nvec2 position;\nfloat fadeOpacity;\nfloat introOpacity;\nif (type == 2.0) {\nif (fUnclamped < 0.0 || (fUnclamped > 1.0 && t1 != duration)) {\ngl_Position = vec4(0.0, 0.0, -2.0, 1.0);\nreturn;\n}\nvec2 ortho = mix(e0, e1, f);\nvec2 parallel;\nparallel = normalize(position1 - position0) * 0.5;\nif (id == 1.0) {\nextrude = ortho;\nv_texcoord = vec2(0.5, 0.0);\n} else if (id == 2.0) {\nextrude = -ortho;\nv_texcoord = vec2(0.5, 1.0);\n} else if (id == 3.0) {\nextrude = ortho + parallel;\nv_texcoord = vec2(1.0, 0.0);\n} else if (id == 4.0) {\nextrude = -ortho + parallel;\nv_texcoord = vec2(1.0, 1.0);\n}\nfadeOpacity = getFadeOpacity((t - clampedTime) / u_trailLength);\nintroOpacity = 1.0 - exp(-clampedTime);\nv_size = getSize(speed);\nv_color = getColor(speed);\nv_color.a *= getOpacity(speed);\nposition = mix(position0, position1, f);\n} else {\nif (fUnclamped < 0.0) {\ngl_Position = vec4(0.0, 0.0, -2.0, 1.0);\nreturn;\n}\nif (id == 1.0) {\nextrude = e0;\nv_texcoord = vec2(0.5, 0.0);\nfadeOpacity = getFadeOpacity((t - t0) / u_trailLength);\nintroOpacity = 1.0 - exp(-t0);\nv_size = getSize(speed0);\nv_color = getColor(speed0);\nv_color.a *= getOpacity(speed0);\nposition = position0;\n} else if (id == 2.0) {\nextrude = -e0;\nv_texcoord = vec2(0.5, 1.0);\nfadeOpacity = getFadeOpacity((t - t0) / u_trailLength);\nintroOpacity = 1.0 - exp(-t0);\nv_size = getSize(speed0);\nv_color = getColor(speed0);\nv_color.a *= getOpacity(speed0);\nposition = position0;\n} else if (id == 3.0) {\nextrude = mix(e0, e1, f);\nv_texcoord = vec2(0.5, 0.0);\nfadeOpacity = getFadeOpacity((t - clampedTime) / u_trailLength);\nintroOpacity = 1.0 - exp(-clampedTime);\nv_size = getSize(speed);\nv_color = getColor(speed);\nv_color.a *= getOpacity(speed);\nposition = mix(position0, position1, f);\n} else if (id == 4.0) {\nextrude = -mix(e0, e1, f);\nv_texcoord = vec2(0.5, 1.0);\nfadeOpacity = getFadeOpacity((t - clampedTime) / u_trailLength);\nintroOpacity = 1.0 - exp(-clampedTime);\nv_size = getSize(speed);\nv_color = getColor(speed);\nv_color.a *= getOpacity(speed);\nposition = mix(position0, position1, f);\n}\n}\nvec2 xy = (u_dvsMat3 * vec3(position, 1.0) + u_displayViewMat3 * vec3(extrude * v_size, 0.0)).xy;\ngl_Position = vec4(xy, 0.0, 1.0);\nv_color.a *= fadeOpacity;\nv_color.a *= mix(1.0, introOpacity, u_introFade);\nv_color.rgb *= v_color.a;\n}"},streamlines:{"streamlines.frag":"precision highp float;\nvarying float v_side;\nvarying float v_time;\nvarying float v_totalTime;\nvarying float v_timeSeed;\nvarying vec4 v_color;\nvarying float v_size;\nuniform float u_time;\nuniform float u_trailLength;\nuniform float u_flowSpeed;\nuniform float u_featheringSize;\nuniform float u_introFade;\n#include <raster/flow/getFragmentColor.glsl>\n#include <raster/flow/getFadeOpacity.glsl>\nvoid main(void) {\nfloat t = mod(v_timeSeed * (v_totalTime + u_trailLength) + u_time * u_flowSpeed, v_totalTime + u_trailLength) - v_time;\nvec4 color = v_color * step(0.0, t) * getFadeOpacity(t / u_trailLength);\ncolor *= mix(1.0, 1.0 - exp(-v_time), u_introFade);\ngl_FragColor = getFragmentColor(color, length((v_side + 1.0) / 2.0 - 0.5), v_size, u_featheringSize);\n}","streamlines.vert":"attribute vec3 a_positionAndSide;\nattribute vec3 a_timeInfo;\nattribute vec2 a_extrude;\nattribute float a_speed;\nuniform mat3 u_dvsMat3;\nuniform mat3 u_displayViewMat3;\nvarying float v_time;\nvarying float v_totalTime;\nvarying float v_timeSeed;\nvarying vec4 v_color;\nvarying float v_side;\nvarying float v_size;\nuniform float u_featheringSize;\n#include <raster/flow/vv.glsl>\nvoid main(void) {\nvec4 lineColor = getColor(a_speed);\nfloat lineOpacity = getOpacity(a_speed);\nfloat lineSize = getSize(a_speed);\nvec2 position = a_positionAndSide.xy;\nv_side = a_positionAndSide.z;\nvec2 xy = (u_dvsMat3 * vec3(position, 1.0) + u_displayViewMat3 * vec3(a_extrude * lineSize, 0.0)).xy;\ngl_Position = vec4(xy, 0.0, 1.0);\nv_time = a_timeInfo.x;\nv_totalTime = a_timeInfo.y;\nv_timeSeed = a_timeInfo.z;\nv_color = lineColor;\nv_color.a *= lineOpacity;\nv_color.rgb *= v_color.a;\nv_size = lineSize;\n}"},"vv.glsl":"#define MAX_STOPS 8\n#ifdef VV_COLOR\nuniform float u_color_stops[MAX_STOPS];\nuniform vec4 u_color_values[MAX_STOPS];\nuniform int u_color_count;\n#else\nuniform vec4 u_color;\n#endif\n#ifdef VV_OPACITY\nuniform float u_opacity_stops[MAX_STOPS];\nuniform float u_opacity_values[MAX_STOPS];\nuniform int u_opacity_count;\n#else\nuniform float u_opacity;\n#endif\n#ifdef VV_SIZE\nuniform float u_size_stops[MAX_STOPS];\nuniform float u_size_values[MAX_STOPS];\nuniform int u_size_count;\n#else\nuniform float u_size;\n#endif\nuniform float u_featheringOffset;\nvec4 getColor(float x) {\n#ifdef VV_COLOR\nvec4 color = u_color_values[0];\n{\nfor (int i = 1; i < MAX_STOPS; i++) {\nif (i >= u_color_count) {\nbreak;\n}\nfloat x1 = u_color_stops[i - 1];\nif (x < x1) {\nbreak;\n}\nfloat x2 = u_color_stops[i];\nvec4 y2 = u_color_values[i];\nif (x < x2) {\nvec4 y1 = u_color_values[i - 1];\ncolor = y1 + (y2 - y1) * (x - x1) / (x2 - x1);\n} else {\ncolor = y2;\n}\n}\n}\n#else\nvec4 color = u_color;\n#endif\nreturn color;\n}\nfloat getOpacity(float x) {\n#ifdef VV_OPACITY\nfloat opacity = u_opacity_values[0];\n{\nfor (int i = 1; i < MAX_STOPS; i++) {\nif (i >= u_opacity_count) {\nbreak;\n}\nfloat x1 = u_opacity_stops[i - 1];\nif (x < x1) {\nbreak;\n}\nfloat x2 = u_opacity_stops[i];\nfloat y2 = u_opacity_values[i];\nif (x < x2) {\nfloat y1 = u_opacity_values[i - 1];\nopacity = y1 + (y2 - y1) * (x - x1) / (x2 - x1);\n} else {\nopacity = y2;\n}\n}\n}\n#else\nfloat opacity = u_opacity;\n#endif\nreturn opacity;\n}\nfloat getSize(float x) {\n#ifdef VV_SIZE\nfloat size = u_size_values[0];\n{\nfor (int i = 1; i < MAX_STOPS; i++) {\nif (i >= u_size_count) {\nbreak;\n}\nfloat x1 = u_size_stops[i - 1];\nif (x < x1) {\nbreak;\n}\nfloat x2 = u_size_stops[i];\nfloat y2 = u_size_values[i];\nif (x < x2) {\nfloat y1 = u_size_values[i - 1];\nsize = y1 + (y2 - y1) * (x - x1) / (x2 - x1);\n} else {\nsize = y2;\n}\n}\n}\n#else\nfloat size = u_size;\n#endif\nreturn size + 2.0 * u_featheringSize * u_featheringOffset;\n}"},hillshade:{"hillshade.frag":"precision mediump float;\nvarying highp vec2 v_texcoord;\n#include <raster/common/common.glsl>\nuniform int u_hillshadeType;\nuniform float u_sinZcosAs[6];\nuniform float u_sinZsinAs[6];\nuniform float u_cosZs[6];\nuniform float u_weights[6];\nuniform vec2 u_factor;\nuniform float u_minValue;\nuniform float u_maxValue;\nuniform float u_scaling;\n#include <raster/lut/colorize.glsl>\n#include <raster/common/getSurfaceValues.glsl>\nvec3 rgb2hsv(vec3 c) {\nvec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\nvec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\nvec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\nfloat d = q.x - min(q.w, q.y);\nfloat e = 1.0e-10;\nreturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);\n}\nvec3 hsv2rgb(vec3 c) {\nvec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\nvec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\nreturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\nvec4 overlay(float val, float minValue, float maxValue, float hillshade) {\nval = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);\nvec4 rgb = colorize(vec4(val, val, val, 1.0), 255.0);\nvec3 hsv = rgb2hsv(rgb.xyz);\nhsv.z = hillshade;\nreturn vec4(hsv2rgb(hsv) * u_scaling, 1.0) * rgb.a;\n}\nvoid main() {\nvec2 pixelLocation = getPixelLocation(v_texcoord);\nif (isOutside(pixelLocation)) {\ngl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\nvec4 currentPixel = getPixel(pixelLocation);\nif (currentPixel.a == 0.0) {\ngl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\nfloat pv[10];\ngetSurfaceValues(u_image, pixelLocation, u_srcImageSize, pv);\nfloat alpha = pv[9];\nfloat dzx = (pv[2] + 2.0 * pv[5] + pv[8] - pv[0] - 2.0 * pv[3] - pv[6]) * u_factor.s;\nfloat dzy = (pv[6] + 2.0 * pv[7] + pv[8] - pv[0] - 2.0 * pv[1] - pv[2]) * u_factor.t;\nfloat dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);\nfloat hillshade = 0.0;\nif (u_hillshadeType == 0){\nfloat cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;\nfloat z = (u_cosZs[0] + cosDelta) / dzd;\nif (z < 0.0)  z = 0.0;\nhillshade = z;\n} else {\nfor (int k = 0; k < 6; k++) {\nfloat cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;\nfloat z = (u_cosZs[k] + cosDelta) / dzd;\nif (z < 0.0) z = 0.0;\nhillshade = hillshade + z * u_weights[k];\nif (k == 5) break;\n}\n}\n#ifdef APPLY_COLORMAP\nvec4 result = overlay(pv[4], u_minValue, u_maxValue, hillshade) * alpha * u_opacity;\n#else\nhillshade *= u_scaling;\nvec4 result = vec4(hillshade, hillshade, hillshade, 1.0) * alpha * u_opacity;\n#endif\n#ifdef ROUND_OUTPUT\nresult = vec4(floor(result.xyz + 0.5), result.a);\n#endif\ngl_FragColor = result;\n}"},lut:{"colorize.glsl":"uniform sampler2D u_colormap;\nuniform float u_colormapOffset;\nuniform float u_colormapMaxIndex;\nvec4 colorize(vec4 currentPixel, float scaleFactor) {\nfloat clrIndex = clamp(currentPixel.r * scaleFactor - u_colormapOffset, 0.0, u_colormapMaxIndex);\nvec2 clrPosition = vec2((clrIndex + 0.5) / (u_colormapMaxIndex + 1.0), 0.0);\nvec4 color = texture2D(u_colormap, clrPosition);\nvec4 result = vec4(color.rgb, color.a * currentPixel.a);\nreturn result;\n}\nvec4 colorizeNoClamp(vec4 currentPixel, float scaleFactor) {\nfloat value = currentPixel.r * scaleFactor - u_colormapOffset;\nvec4 result = colorize(currentPixel, scaleFactor);\nreturn result * step(0.0, value) * step(value, u_colormapMaxIndex);\n}","lut.frag":"precision mediump float;\nvarying highp vec2 v_texcoord;\n#include <raster/common/common.glsl>\n#include <raster/lut/colorize.glsl>\nvoid main() {\nvec2 pixelLocation = getPixelLocation(v_texcoord);\nif (isOutside(pixelLocation)) {\ngl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\nvec4 currentPixel = getPixel(pixelLocation);\nvec4 result = colorizeNoClamp(currentPixel, 1.0);\ngl_FragColor = vec4(result.xyz, 1.0) * result.a * u_opacity;\n}"},magdir:{"magdir.frag":"precision mediump float;\nvarying vec4 v_color;\nuniform lowp float u_opacity;\nvoid main() {\ngl_FragColor = v_color * u_opacity;\n}","magdir.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_vv;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nuniform vec2 u_symbolSize;\nuniform vec2 u_symbolPercentRange;\nuniform vec2 u_dataRange;\nuniform float u_rotation;\nuniform vec4 u_colors[12];\nvarying vec4 v_color;\nvoid main()\n{\nfloat angle = a_offset.y + u_rotation;\n#ifndef ROTATION_GEOGRAPHIC\nangle = 3.14159265359 * 2.0 - angle - 3.14159265359 / 2.0;\n#endif\nvec2 offset = vec2(cos(angle), sin(angle)) * a_offset.x;\n#ifdef DATA_RANGE\nfloat valuePercentage = clamp((a_vv.y - u_dataRange.x) / (u_dataRange.y - u_dataRange.x), 0.0, 1.0);\nfloat sizeRatio = u_symbolPercentRange.x + valuePercentage * (u_symbolPercentRange.y - u_symbolPercentRange.x);\nfloat sizePercentage = clamp(sizeRatio, u_symbolPercentRange.x, u_symbolPercentRange.y);\n#else\nfloat sizePercentage = (u_symbolPercentRange.x + u_symbolPercentRange.y) / 2.0;\n#endif\nvec2 pos = a_pos + offset * sizePercentage * u_symbolSize;\nv_color = u_colors[int(a_vv.x)];\ngl_Position = vec4(u_dvsMat3 * vec3(pos * u_coordScale, 1.0), 1.0);\n}"},reproject:{"reproject.frag":"precision mediump float;\nvarying vec2 v_texcoord;\n#include <raster/common/common.glsl>\nvoid main() {\nvec2 pixelLocation = getPixelLocation(v_texcoord);\nif (isOutside(pixelLocation)) {\ngl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\nreturn;\n}\nvec4 currentPixel = getPixel(pixelLocation);\ngl_FragColor = vec4(currentPixel.rgb, 1.0) * currentPixel.a * u_opacity;\n}","reproject.vert":"precision mediump float;\nattribute vec2 a_position;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\nv_texcoord = a_position;\ngl_Position = vec4(2.0 * (a_position - 0.5), 0.0, 1.0);\n}"},rfx:{aspect:{"aspect.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform vec2 u_cellSize;\nuniform vec2 u_srcImageSize;\n#include <raster/common/getSurfaceValues.glsl>\nconst float pi = 3.14159265359;\nvoid main() {\nfloat pv[10];\ngetSurfaceValues(u_image, v_texcoord, u_srcImageSize, pv);\nfloat alpha = pv[9];\nfloat dzx = (pv[2] + 2.0 * pv[5] + pv[8] - pv[0] - 2.0 * pv[3] - pv[6]) / (8.0 * u_cellSize[0]);\nfloat dzy = -(pv[6] + 2.0 * pv[7] + pv[8] - pv[0] - 2.0 * pv[1] - pv[2]) / (8.0 * u_cellSize[1]);\nalpha *= sign(abs(dzx) + abs(dzy));\nfloat aspect_rad = (dzx == 0.0) ? (step(0.0, dzy) * 0.5 * pi + step(dzy, 0.0) * 1.5 * pi) : mod((2.5 * pi + atan(dzy, -dzx)), 2.0 * pi);\nfloat aspect = aspect_rad * 180.0 / pi;\ngl_FragColor = vec4(aspect, aspect, aspect, 1.0) * alpha;\n}"},bandarithmetic:{"bandarithmetic.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform mediump mat3 u_bandIndexMat3;\nuniform float u_adjustments[3];\n#include <raster/common/inverse.glsl>\nvoid main() {\nvec4 pv = texture2D(u_image, v_texcoord);\nvec3 pv2 = u_bandIndexMat3 * pv.rgb;\nfloat nir = pv2.r;\nfloat red = pv2.g;\nfloat index;\n#ifdef NDXI\nindex = (nir - red) * invertValue(nir + red);\n#elif defined(SR)\nindex = nir * invertValue(red);\n#elif defined(CI)\nindex = nir * invertValue(red) - 1.0;\n#elif defined(SAVI)\nindex = (nir - red) * invertValue(nir + red + u_adjustments[0]) * (1.0 + u_adjustments[0]);\n#elif defined(TSAVI)\nfloat s = u_adjustments[0];\nfloat a = u_adjustments[1];\nfloat x = u_adjustments[2];\nfloat y = -a * s + x * (1.0 + s * s);\nindex = (s * (nir - s * red - a)) * invertValue(a * nir + red + y);\n#elif defined(MSAVI)\nfloat nir2 = 2.0 * nir + 1.0;\nindex = 0.5 * (nir2 - sqrt(nir2 * nir2 - 8.0 * (nir - red)));\n#elif defined(GEMI)\nfloat eta = (2.0 * (nir * nir - red * red) + 1.5 * nir + 0.5 * red) * invertValue(nir + red + 0.5);\nindex = eta * (1.0 - 0.25 * eta) - (red - 0.125) * invertValue(1.0 - red);\n#elif defined(PVI)\nfloat a = u_adjustments[0];\nfloat b = u_adjustments[1];\nfloat y = sqrt(1.0 + a * a);\nindex = (nir - a * red - b) * invertValue(y);\n#elif defined(VARI)\nindex = (pv2.g - pv2.r) * invertValue(pv2.g + pv2.r - pv2.b);\n#elif defined(MTVI)\nfloat green = pv2.b;\nfloat v = sqrt(pow((2.0 * nir + 1.0), 2.0) - (6.0 * nir - 5.0 * sqrt(red)) - 0.5);\nindex = 1.5 * (1.2 * (nir - green) - 2.5 * (red - green)) * invertValue(v);\n#elif defined(RTVICORE)\nfloat green = pv2.b;\nindex = 100.0 * (nir - red) - 10.0 * (nir - green);\n#elif defined(EVI)\nfloat blue = pv2.b;\nfloat denom = nir + 6.0 * red - 7.5 * blue + 1.0;\nindex =  (2.5 * (nir - red)) * invertValue(denom);\n#elif defined(WNDWI)\nfloat g = pv2.r;\nfloat n = pv2.g;\nfloat s = pv2.b;\nfloat a = u_adjustments[0];\nfloat denom = g + a * n + (1.0 - a) * s;\nindex = (g - a * n - (1.0 - a) * s) * invertValue(denom);\n#elif defined(BAI)\nindex = invertValue(pow((0.1 - red), 2.0) + pow((0.06 - nir), 2.0));\n#else\ngl_FragColor = pv;\nreturn;\n#endif\n#ifdef ROUND_OUTPUT\nindex = floor(index + 0.5);\n#endif\ngl_FragColor = vec4(index, index, index, pv.a);\n}"},colormap2rgb:{"colormap2rgb.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\n#include <raster/lut/colorize.glsl>\nvoid main() {\nvec4 pv = texture2D(u_image, v_texcoord);\nvec4 result = colorizeNoClamp(vec4(pv.r, pv.r, pv.r, 1.0), 1.0);\ngl_FragColor = vec4(result.xyz * 255.0, 1.0) * result.a * pv.a;\n}"},compositeband:{"compositeband.frag":"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nuniform sampler2D u_image2;\n#ifdef ONE_CONSTANT\nuniform float u_image1Const;\n#ifdef TWO_CONSTANT\nuniform float u_image2Const;\n#endif\nuniform mat3 u_imageSwap;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\nvec4 pv0 = texture2D(u_image, v_texcoord);\nfloat a = pv0.r;\nfloat alpha = pv0.a;\n#ifdef TWO_CONSTANT\nfloat b = u_image1Const;\nfloat c = u_image2Const;\nvec3 abc = u_imageSwap * vec3(a, b, c);\na = abc.s;\nb = abc.t;\nc = abc.p;\n#elif defined(ONE_CONSTANT)\nvec4 pv1 = texture2D(u_image1, v_texcoord);\nfloat b = pv1.r;\nfloat c = u_image1Const;\nvec3 abc = u_imageSwap * vec3(a, b, c);\na = abc.s;\nb = abc.t;\nc = abc.p;\nalpha *= pv1.a;\n#else\nvec4 pv1 = texture2D(u_image1, v_texcoord);\nvec4 pv2 = texture2D(u_image2, v_texcoord);\nfloat b = pv1.r;\nfloat c = pv2.r;\nalpha = alpha * pv1.a * pv2.a;\n#endif\ngl_FragColor = vec4(a, b, c, alpha);\n}"},computechange:{"computechange.frag":"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\n#ifdef ONE_CONSTANT\nuniform float u_image1Const;\nuniform mat3 u_imageSwap;\n#endif\nvarying vec2 v_texcoord;\nuniform vec2 u_domainRange;\n#include <raster/common/inverse.glsl>\nvoid main() {\nvec4 pv0 = texture2D(u_image, v_texcoord);\nfloat a = pv0.r;\n#ifdef ONE_CONSTANT\nfloat b = u_image1Const;\nvec3 abc = u_imageSwap * vec3(a, b, 0);\na = abc.s;\nb = abc.t;\n#else\nvec4 pv1 = texture2D(u_image1, v_texcoord);\nfloat b = pv1.r;\n#endif\nfloat result = a;\nfloat alpha = pv0.a;\n#ifdef DIFFERENCE\nresult = a - b;\n#elif defined(RELATIVE)\nresult = (a - b) * invertValue(max(abs(a), abs(b)));\n#endif\nbool isInvalid = result < u_domainRange.s || result > u_domainRange.t;\nresult = isInvalid ? 0.0 : result;\nalpha *= float(!isInvalid);\n#ifdef ROUND_OUTPUT\nresult = floor(result + 0.5);\n#endif\ngl_FragColor = vec4(result, result, result, alpha);\n}"},contrast:{"contrast.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\n#include <raster/common/contrastBrightness.glsl>\nvoid main() {\nvec4 pv = texture2D(u_image, v_texcoord);\nvec4 result = adjustContrastBrightness(pv, false);\ngl_FragColor = vec4(floor(result.rgb * 255.0 + 0.5), result.a);\n}"},convolution:{"convolution.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform vec2 u_srcImageSize;\n#define KERNEL_SIZE_ROWS ROWS\n#define KERNEL_SIZE_COLS COLS\nuniform vec2 u_clampRange;\nuniform float u_kernel[25];\n#include <raster/common/mirror.glsl>\nvoid main() {\nvec3 rgb = vec3(0.0, 0.0, 0.0);\nvec2 resolution = 1.0 / u_srcImageSize;\nfloat rowOffset = -float(floor(float(KERNEL_SIZE_ROWS) / 2.0));\nfloat colOffset = -float(floor(float(KERNEL_SIZE_COLS) / 2.0));\nfloat alpha = 1.0;\nfor (int row = 0; row < KERNEL_SIZE_ROWS; row++) {\nfloat pos_row = rowOffset + float(row);\nfor (int col = 0; col < KERNEL_SIZE_COLS; col++) {\nvec2 pos = v_texcoord + vec2(colOffset + float(col), pos_row) * resolution;\nvec4 pv = texture2D(u_image, mirror(pos));\nrgb += pv.rgb * u_kernel[row * KERNEL_SIZE_COLS + col];\nalpha *= pv.a;\n}\n}\nrgb = clamp(rgb, u_clampRange.s, u_clampRange.t);\ngl_FragColor = vec4(rgb * alpha, alpha);\n}"},curvature:{"curvature.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform float u_zlFactor;\nuniform vec2 u_srcImageSize;\n#include <raster/common/getSurfaceValues.glsl>\nvoid main() {\nfloat pv[10];\ngetSurfaceValues(u_image, v_texcoord, u_srcImageSize, pv);\nfloat alpha = pv[9];\nfloat d = ((pv[3] + pv[5]) * 0.5 - pv[4]);\nfloat e = ((pv[1] + pv[7]) * 0.5 - pv[4]);\nfloat curvature = 0.0;\n#ifdef STANDARD\ncurvature = -u_zlFactor * (d + e);\ngl_FragColor = vec4(curvature, curvature, curvature, alpha);\n#else\nfloat f = (-pv[0] + pv[2] + pv[6] - pv[8]) / 4.0;\nfloat g = (-pv[3] + pv[5]) / 2.0;\nfloat h = (pv[1] - pv[7]) / 2.0;\nfloat g2 = g * g;\nfloat h2 = h * h;\n#ifdef PROFILE\ncurvature = (u_zlFactor * (d * g2 + e * h2 + f * g * h)) / (g2 + h2);\n#else\ncurvature = (-u_zlFactor * (d * h2 + e * g2 - f * g * h)) / (g2 + h2);\n#endif\n#endif\ngl_FragColor = vec4(curvature, curvature, curvature, alpha);\n}"},extractband:{"extractband.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform mediump mat3 u_bandIndexMat3;\nvoid main() {\nvec4 pv = texture2D(u_image, v_texcoord);\nvec3 pv2 = u_bandIndexMat3 * pv.rgb;\ngl_FragColor = vec4(pv2, pv.a);\n}"},focalstatistics:{"focalstatistics.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform vec2 u_srcImageSize;\n#define KERNEL_SIZE_ROWS ROWS\n#define KERNEL_SIZE_COLS COLS\nuniform vec2 u_clampRange;\n#include <raster/common/mirror.glsl>\n#include <raster/common/inverse.glsl>\nvoid main() {\nvec2 resolution = 1.0 / u_srcImageSize;\nfloat rowOffset = -float(floor(float(KERNEL_SIZE_ROWS) / 2.0));\nfloat colOffset = -float(floor(float(KERNEL_SIZE_COLS) / 2.0));\nfloat count = 0.0;\n#ifdef STDDEV\nvec3 sum = vec3(0.0, 0.0, 0.0);\nvec3 sum2 = vec3(0.0, 0.0, 0.0);\n#endif\nvec4 currentPixel = texture2D(u_image, v_texcoord);\nvec3 rgb = currentPixel.rgb;\nfor (int row = 0; row < KERNEL_SIZE_ROWS; row++) {\nfloat pos_row = rowOffset + float(row);\nfor (int col = 0; col < KERNEL_SIZE_COLS; col++) {\nvec2 pos = v_texcoord + vec2(colOffset + float(col), pos_row) * resolution;\nvec4 pv = texture2D(u_image, mirror(pos));\ncount += pv.a;\n#ifdef MIN\nrgb = min(rgb, pv.rgb);\n#elif defined(MAX)\nrgb = max(rgb, pv.rgb);\n#elif defined(MEAN)\nrgb += pv.rgb;\n#elif defined(STDDEV)\nsum += pv.rgb;\nsum2 += (pv.rgb * pv.rgb);\n#endif\n}\n}\n#ifdef MEAN\nrgb *= invertValue(count);\n#elif defined(STDDEV)\nrgb = sqrt((sum2 - sum * sum * invertValue(count)) * invertValue(count));\n#endif\nfloat alpha = step(0.9999, count);\nrgb = clamp(rgb, u_clampRange.s, u_clampRange.t);\n#ifdef FILL\nrgb = (1.0 - currentPixel.a) * rgb + currentPixel.a * currentPixel.rgb;\n#endif\ngl_FragColor = vec4(rgb * alpha, alpha);\n}"},grayscale:{"grayscale.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform vec3 u_weights;\nvoid main() {\nvec4 pv = texture2D(u_image, v_texcoord);\nfloat value = dot(u_weights, pv.rgb);\ngl_FragColor = vec4(value, value, value, pv.a);\n}"},local:{"local.frag":"precision highp float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\n#ifdef ONE_CONSTANT\nuniform float u_image1Const;\n#ifdef TWO_CONSTANT\nuniform float u_image2Const;\n#endif\nuniform mat3 u_imageSwap;\n#endif\nvarying vec2 v_texcoord;\nuniform vec2 u_domainRange;\n#include <raster/common/inverse.glsl>\nvoid main() {\nvec4 pv0 = texture2D(u_image, v_texcoord);\nfloat a = pv0.r;\n#ifdef TWO_IMAGES\n#ifdef ONE_CONSTANT\nfloat b = u_image1Const;\nvec3 abc = u_imageSwap * vec3(a, b, 0);\na = abc.s;\nb = abc.t;\n#else\nvec4 pv1 = texture2D(u_image1, v_texcoord);\nfloat b = pv1.r;\n#endif\n#elif defined(CONDITIONAL)\n#ifdef TWO_CONSTANT\nfloat b = u_image1Const;\nfloat c = u_image2Const;\nvec3 abc = u_imageSwap * vec3(a, b, c);\na = abc.s;\nb = abc.t;\nc = abc.p;\n#elif defined(ONE_CONSTANT)\nvec4 pv1 = texture2D(u_image1, v_texcoord);\nfloat b = pv1.r;\nfloat c = u_image1Const;\nvec3 abc = u_imageSwap * vec3(a, b, c);\na = abc.s;\nb = abc.t;\nc = abc.p;\n#else\nvec4 pv1 = texture2D(u_image1, v_texcoord);\nvec4 pv2 = texture2D(u_image2, v_texcoord);\nfloat b = pv1.r;\nfloat c = pv2.r;\n#endif\n#endif\nfloat result = a;\nfloat alpha = pv0.a;\n#ifdef PLUS\nresult = a + b;\n#elif defined(MINUS)\nresult = a - b;\n#elif defined(TIMES)\nresult = a * b;\n#elif defined(DIVIDE)\nresult = a * invertValue(b);\nalpha *= float(abs(sign(b)));\n#elif defined(FLOATDIVIDE)\nresult = a * invertValue(b);\nalpha *= float(abs(sign(b)));\n#elif defined(FLOORDIVIDE)\nresult = floor(a * invertValue(b));\nalpha *= float(abs(sign(b)));\n#elif defined(SQUARE)\nresult = a * a;\n#elif defined(SQRT)\nresult = sqrt(a);\n#elif defined(POWER)\nresult = pow(a, b);\n#elif defined(LN)\nresult = a <= 0.0 ? 0.0: log(a);\nalpha *= float(a > 0.0);\n#elif defined(LOG_1_0)\nresult = a <= 0.0 ? 0.0: log2(a) * invertValue(log2(10.0));\nalpha *= float(a > 0.0);\n#elif defined(LOG_2)\nresult = a <= 0.0 ? 0.0: log2(a);\nalpha *= float(a > 0.0);\n#elif defined(EXP)\nresult = exp(a);\n#elif defined(EXP_1_0)\nresult = pow(10.0, a);\n#elif defined(EXP_2)\nresult = pow(2.0, a);\n#elif defined(ROUNDDOWN)\nresult = floor(a);\n#elif defined(ROUNDUP)\nresult = ceil(a);\n#elif defined(INT)\nresult = float(sign(a)) * floor(abs(a));\n#elif defined(MOD)\nresult = mod(a, b);\n#elif defined(NEGATE)\nresult = -a;\n#elif defined(ABS)\nresult = abs(a);\n#elif defined(ACOS)\nresult = abs(a) > 1.0 ? 0.0: acos(a);\nalpha *= step(abs(a), 1.00001);\n#elif defined(ACOSH)\nresult = acosh(a);\n#elif defined(ASIN)\nresult = abs(a) > 1.0 ? 0.0: asin(a);\nalpha *= step(abs(a), 1.00001);\n#elif defined(ASINH)\nresult = asinh(a);\n#elif defined(ATAN)\nresult = atan(a);\n#elif defined(ATANH)\nresult = abs(a) > 1.0 ? 0.0: atanh(a);\nalpha *= step(abs(a), 1.0);\n#elif defined(ATAN_2)\nresult = atan(a, b);\n#elif defined(COS)\nresult = cos(a);\n#elif defined(COSH)\nresult = cosh(a);\n#elif defined(SIN)\nresult = sin(a);\n#elif defined(SINH)\nresult = sinh(a);\n#elif defined(TAN)\nresult = tan(a);\n#elif defined(TANH)\nresult = tanh(a);\n#elif defined(BITWISEAND)\nresult = float(int(a) & int(b));\n#elif defined(BITWISEOR)\nresult = float(int(a) | int(b));\n#elif defined(BITWISELEFTSHIFT)\nresult = float(int(a) << int(b));\n#elif defined(BITWISERIGHTSHIFT)\nresult = float(int(a) >> int(b));\n#elif defined(BITWISENOT)\nresult = float(~(int(a)));\n#elif defined(BITWISEXOR)\nresult = float(int(a) ^ int(b));\n#elif defined(BOOLEANAND)\nresult = float((a != 0.0) && (b != 0.0));\n#elif defined(BOOLEANNOT)\nresult = float(a == 0.0);\n#elif defined(BOOLEANOR)\nresult = float((a != 0.0) || (b != 0.0));\n#elif defined(BOOLEANXOR)\nresult = float((a != 0.0) ^^ (b != 0.0));\n#elif defined(GREATERTHAN)\nresult = float(a > b);\n#elif defined(GREATERTHANEQUAL)\nresult = float(a >= b);\n#elif defined(LESSTHAN)\nresult = float(a < b);\n#elif defined(LESSTHANEQUAL)\nresult = float(a <= b);\n#elif defined(EQUALTO)\nresult = float(a == b);\n#elif defined(NOTEQUAL)\nresult = float(a != b);\n#elif defined(ISNULL)\nresult = float(alpha == 0.0);\nalpha = 1.0;\n#elif defined(SETNULL)\nfloat maskValue = float(a == 0.0);\nresult = maskValue * b;\nalpha *= maskValue;\n#elif defined(CONDITIONAL)\nfloat weight = float(abs(sign(a)));\nresult = weight * b + (1.0 - weight) * c;\n#endif\nfloat rangeFactor = step(u_domainRange.s, result) * step(result, u_domainRange.t);\nresult *= rangeFactor;\nalpha *= rangeFactor;\n#ifdef ROUND_OUTPUT\nresult = floor(result + 0.5);\n#endif\ngl_FragColor = vec4(result, result, result, alpha);\n}"},mask:{"mask.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\n#define LEN_INCLUDED_RANGES 6\n#define LEN_NODATA_VALUES 6\nuniform highp float u_includedRanges[6];\nuniform highp float u_noDataValues[6];\nfloat maskFactor(float bandValue, float fromValue, float to) {\nfloat factor = 1.0;\nfor (int i = 0; i < LEN_NODATA_VALUES; i++) {\nfactor *= float(u_noDataValues[i] != bandValue);\n}\nfactor *= step(fromValue, bandValue) * step(bandValue, to);\nreturn factor;\n}\nvoid main() {\nvec4 pv = texture2D(u_image, v_texcoord);\nfloat redFactor = maskFactor(pv.r, u_includedRanges[0], u_includedRanges[1]);\n#ifdef MULTI_BAND\nfloat greenFactor = maskFactor(pv.g, u_includedRanges[2], u_includedRanges[3]);\nfloat blueFactor = maskFactor(pv.b, u_includedRanges[4], u_includedRanges[5]);\nfloat maskFactor = redFactor * greenFactor * blueFactor;\ngl_FragColor = pv * maskFactor;\n#else\ngl_FragColor = pv * redFactor;\n#endif\n}"},ndvi:{"ndvi.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform mediump mat3 u_bandIndexMat3;\n#include <raster/common/inverse.glsl>\nvoid main() {\nvec4 pv = texture2D(u_image, v_texcoord);\nvec3 pv2 = u_bandIndexMat3 * pv.rgb;\nfloat nir = pv2.r;\nfloat red = pv2.g;\nfloat index = (nir - red) * invertValue(nir + red);\n#ifdef SCALED\nindex = floor((index + 1.0) * 100.0 + 0.5);\n#endif\ngl_FragColor = vec4(index, index, index, pv.a);\n}"},remap:{"remap.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\n#define LEN_REMAP_RANGES 18\n#define LEN_NODATA_RANGES 12\nuniform highp float u_rangeMaps[18];\nuniform highp float u_noDataRanges[12];\nuniform highp float u_unmatchMask;\nuniform vec2 u_clampRange;\nvoid main() {\nvec4 pv = texture2D(u_image, v_texcoord);\nfloat factor = 1.0;\nfloat bandValue = pv.r;\nfor (int i = 0; i < LEN_NODATA_RANGES; i+=2) {\nfloat inside = 1.0 - step(u_noDataRanges[i], bandValue) * step(bandValue, u_noDataRanges[i+1]);\nfactor *= inside;\n}\nfloat mapValue = 0.0;\nfloat includeMask = 0.0;\nfor (int i = 0; i < LEN_REMAP_RANGES; i+=3) {\nfloat stepMask = step(u_rangeMaps[i], bandValue) * step(bandValue, u_rangeMaps[i+1]);\nincludeMask = (1.0 - stepMask) * includeMask + stepMask;\nmapValue = (1.0 - stepMask) * mapValue + stepMask * u_rangeMaps[i+2];\n}\nbandValue = factor * (mapValue + (1.0 - includeMask) * u_unmatchMask * pv.r);\nfloat bandMask = factor * max(u_unmatchMask, includeMask);\nbandValue = clamp(bandValue, u_clampRange.s, u_clampRange.t);\ngl_FragColor = vec4(bandValue, bandValue, bandValue, bandMask * pv.a);\n}"},slope:{"slope.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform vec2 u_cellSize;\nuniform float u_zFactor;\nuniform vec2 u_srcImageSize;\nuniform float u_pixelSizePower;\nuniform float u_pixelSizeFactor;\n#include <raster/common/getSurfaceValues.glsl>\nvoid main() {\nfloat pv[10];\ngetSurfaceValues(u_image, v_texcoord, u_srcImageSize, pv);\nfloat alpha = pv[9];\nfloat xf = (u_zFactor + pow(u_cellSize[0], u_pixelSizePower) * u_pixelSizeFactor) / (8.0 * u_cellSize[0]);\nfloat yf = (u_zFactor + pow(u_cellSize[1], u_pixelSizePower) * u_pixelSizeFactor) / (8.0 * u_cellSize[1]);\nfloat dzx = (pv[2] + 2.0 * pv[5] + pv[8] - pv[0] - 2.0 * pv[3] - pv[6]) * xf;\nfloat dzy = -(pv[6] + 2.0 * pv[7] + pv[8] - pv[0] - 2.0 * pv[1] - pv[2]) * yf;\nfloat rise2run = sqrt(dzx * dzx + dzy * dzy);\n#ifdef PERCENT_RISE\nfloat result = rise2run * 100.0;\n#else\nfloat result = atan(rise2run) * 57.2957795;\n#endif\n#ifdef ROUND_OUTPUT\nresult = floor(result + 0.5);\n#endif\ngl_FragColor = vec4(result, result, result, alpha);\n}"},stretch:{"stretch.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying highp vec2 v_texcoord;\nuniform float u_minCutOff[3];\nuniform float u_maxCutOff[3];\nuniform float u_minOutput;\nuniform float u_maxOutput;\nuniform float u_factor[3];\nuniform float u_gamma[3];\nuniform float u_gammaCorrection[3];\nfloat stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, float gamma, float gammaCorrection) {\nval = clamp(val, minCutOff, maxCutOff);\nfloat stretchedVal;\n#ifdef USE_GAMMA\nfloat tempf = 1.0;\nfloat outRange = maxOutput - minOutput;\nfloat relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);\ntempf -= step(1.0, gamma) * sign(gamma - 1.0) * pow(1.0 / outRange, relativeVal * gammaCorrection);\nstretchedVal = tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput;\nstretchedVal = clamp(stretchedVal, minOutput, maxOutput);\n#else\nstretchedVal = minOutput + (val - minCutOff) * factor;\n#endif\n#ifdef ROUND_OUTPUT\nstretchedVal = floor(stretchedVal + 0.5);\n#endif\nreturn stretchedVal;\n}\nvoid main() {\nvec4 currentPixel = texture2D(u_image, v_texcoord);\nfloat redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_gamma[0], u_gammaCorrection[0]);\n#ifdef MULTI_BAND\nfloat greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_gamma[1], u_gammaCorrection[1]);\nfloat blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_gamma[2], u_gammaCorrection[2]);\ngl_FragColor = vec4(redVal, greenVal, blueVal, currentPixel.a);\n#else\ngl_FragColor = vec4(redVal, redVal, redVal, currentPixel.a);\n#endif\n}"},vs:{"vs.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\nv_texcoord = a_pos;\ngl_Position = vec4(u_dvsMat3 * vec3(a_pos * u_coordScale, 1.0), 1.0);\n}"}},scalar:{"scalar.frag":"precision mediump float;\nuniform lowp float u_opacity;\nvarying vec2 v_pos;\nconst vec4 outlineColor = vec4(0.2, 0.2, 0.2, 1.0);\nconst float outlineSize = 0.02;\nconst float innerRadius = 0.25;\nconst float outerRadius = 0.42;\nconst float innerSquareLength = 0.15;\nvoid main() {\nmediump float dist = length(v_pos);\nmediump float fillalpha1 = smoothstep(outerRadius, outerRadius + outlineSize, dist);\nfillalpha1 *= (1.0-smoothstep(outerRadius + outlineSize, outerRadius + 0.1 + outlineSize, dist));\n#ifdef INNER_CIRCLE\nmediump float fillalpha2 = smoothstep(innerRadius, innerRadius + outlineSize, dist);\nfillalpha2 *= (1.0-smoothstep(innerRadius + outlineSize, innerRadius + 0.1 + outlineSize, dist));\n#else\nmediump float fillalpha2 = (abs(v_pos.x) < innerSquareLength ? 1.0 : 0.0) * (abs(v_pos.y) < innerSquareLength ? 1.0 : 0.0);\n#endif\ngl_FragColor = (fillalpha2 + fillalpha1) * outlineColor * u_opacity;\n}","scalar.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_vv;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nuniform vec2 u_symbolSize;\nuniform vec2 u_symbolPercentRange;\nuniform vec2 u_dataRange;\nvarying vec2 v_pos;\nvoid main()\n{\n#ifdef DATA_RANGE\nfloat valuePercentage = clamp((a_vv.y - u_dataRange.x) / (u_dataRange.y - u_dataRange.x), 0.0, 1.0);\nfloat sizeRatio = u_symbolPercentRange.x + valuePercentage * (u_symbolPercentRange.y - u_symbolPercentRange.x);\nfloat sizePercentage = clamp(sizeRatio, u_symbolPercentRange.x, u_symbolPercentRange.y);\n#else\nfloat sizePercentage = (u_symbolPercentRange.x + u_symbolPercentRange.y) / 2.0;\n#endif\nvec2 size = u_symbolSize * sizePercentage;\nvec2 pos = a_pos + a_offset * size;\nv_pos = a_offset;\ngl_Position = vec4(u_dvsMat3 * vec3(pos * u_coordScale, 1.0), 1.0);\n}"},stretch:{"stretch.frag":"precision mediump float;\nvarying highp vec2 v_texcoord;\n#include <raster/common/common.glsl>\nuniform float u_minCutOff[3];\nuniform float u_maxCutOff[3];\nuniform float u_minOutput;\nuniform float u_maxOutput;\nuniform float u_factor[3];\nuniform bool u_useGamma;\nuniform float u_gamma[3];\nuniform float u_gammaCorrection[3];\n#include <raster/lut/colorize.glsl>\nfloat stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {\nif (val >= maxCutOff) {\nreturn maxOutput;\n} else if (val <= minCutOff) {\nreturn minOutput;\n}\nfloat stretchedVal;\nif (useGamma) {\nfloat tempf = 1.0;\nfloat outRange = maxOutput - minOutput;\nfloat relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);\nif (gamma > 1.0) {\ntempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);\n}\nstretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;\n} else {\nstretchedVal = minOutput + (val - minCutOff) * factor;\n}\n#ifdef ROUND_OUTPUT\nstretchedVal = floor(stretchedVal + 0.5);\n#endif\nreturn stretchedVal;\n}\nvoid main() {\nvec2 pixelLocation = getPixelLocation(v_texcoord);\nif (isOutside(pixelLocation)) {\ngl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\nvec4 currentPixel = getPixel(pixelLocation);\n#ifdef NOOP\ngl_FragColor = vec4(currentPixel.rgb, 1.0) * currentPixel.a * u_opacity;\nreturn;\n#endif\nif (u_bandCount == 1) {\nfloat grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);\n#ifdef APPLY_COLORMAP\nvec4 result = colorize(vec4(grayVal, grayVal, grayVal, 1.0), u_useGamma ? 255.0 : 1.0);\ngl_FragColor = vec4(result.xyz, 1.0) * result.a * currentPixel.a * u_opacity;\n#else\ngl_FragColor = vec4(grayVal, grayVal, grayVal, 1.0) * currentPixel.a * u_opacity;\n#endif\n} else {\nfloat redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);\nfloat greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);\nfloat blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);\ngl_FragColor = vec4(redVal, greenVal, blueVal, 1.0) * currentPixel.a * u_opacity;\n}\n}"}},stencil:{"stencil.frag":"void main() {\ngl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);\n}","stencil.vert":"attribute vec2 a_pos;\nuniform mat3 u_worldExtent;\nvoid main() {\ngl_Position = vec4(u_worldExtent * vec3(a_pos, 1.0), 1.0);\n}"},test:{"TestShader.common.glsl":"#ifndef RETURN_RED\nvarying    vec4      v_color;\n#endif\nvarying    vec2      v_offset;","TestShader.frag":"precision highp float;\n#include <test/TestShader.common.glsl>\nvoid main() {\nif (v_offset.x > -.5 && v_offset.y > -.5 && v_offset.x < .5 && v_offset.y < .5) {\ndiscard;\n}\n#ifdef RETURN_RED\ngl_FragColor = vec4(1., 0., 0., 1.);\n#else\ngl_FragColor = v_color;\n#endif\n}","TestShader.vert":"const float POS_PRECISION_FACTOR = 10.;\nconst float OFFSET_PRECISION_FACTOR = 10.;\nconst float SIZE_PRECISION_FACTOR = 10.;\nattribute  vec2      a_pos_packed;\nattribute  vec2      a_offset_packed;\nattribute  float     a_size_packed;\n#ifdef DATA_DRIVEN_COLOR\nconst float u_dataDrivenColor_validValues[4] = float[4](0., 0., 1., 0.);\nuniform    vec4      u_dataDrivenColor_colorFallback;\nuniform    vec4      u_dataDrivenColor_color;\n#endif\nuniform    float     u_view_zoomLevel;\n#include <test/TestShader.common.glsl>\n#ifdef DATA_DRIVEN_COLOR\nvec4 getColor(float value) {\nint index = -1;\nfor (int i = 0; i < 4; i++) {\nif (u_dataDrivenColor_validValues[i] == value) {\nindex = i;\nbreak;\n}\n}\nif (index == -1) {\nreturn u_dataDrivenColor_colorFallback;\n}\nreturn u_dataDrivenColor_color;\n}\n#endif\nvoid main() {\nvec2  a_pos = a_pos_packed / POS_PRECISION_FACTOR;\nvec2  a_offset = a_offset_packed / OFFSET_PRECISION_FACTOR;\nfloat a_size = a_size_packed / SIZE_PRECISION_FACTOR;\nvec4 color = vec4(1., 0., 0., 1.);\n#ifdef DATA_DRIVEN_COLOR\ncolor = getColor(1.);\n#endif\nvec2 offsetScaled = a_offset * a_size;\nvec4 pos = vec4(a_pos.xy + offsetScaled, 0., 1.);\ngl_Position = pos;\n#ifndef RETURN_RED\nv_color = color;\n#endif\nv_offset = a_offset;\n}"},tileInfo:{"tileInfo.frag":"uniform mediump sampler2D u_texture;\nvarying mediump vec2 v_tex;\nvoid main(void) {\nlowp vec4 color = texture2D(u_texture, v_tex);\ncolor.rgb *= color.a;\ngl_FragColor = color;\n}","tileInfo.vert":"attribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform mediump float u_depth;\nuniform mediump vec2 u_coord_ratio;\nuniform mediump vec2 u_delta;\nuniform mediump vec2 u_dimensions;\nvarying mediump vec2 v_tex;\nvoid main() {\nmediump vec2 offset = u_coord_ratio * vec2(u_delta + a_pos * u_dimensions);\nvec3 v_pos = u_dvsMat3 * vec3(offset, 1.0);\ngl_Position = vec4(v_pos.xy, 0.0, 1.0);\nv_tex = a_pos;\n}"},util:{"atan2.glsl":"float atan2(in float y, in float x) {\nfloat t0, t1, t2, t3, t4;\nt3 = abs(x);\nt1 = abs(y);\nt0 = max(t3, t1);\nt1 = min(t3, t1);\nt3 = 1.0 / t0;\nt3 = t1 * t3;\nt4 = t3 * t3;\nt0 =         - 0.013480470;\nt0 = t0 * t4 + 0.057477314;\nt0 = t0 * t4 - 0.121239071;\nt0 = t0 * t4 + 0.195635925;\nt0 = t0 * t4 - 0.332994597;\nt0 = t0 * t4 + 0.999995630;\nt3 = t0 * t3;\nt3 = (abs(y) > abs(x)) ? 1.570796327 - t3 : t3;\nt3 = x < 0.0 ?  3.141592654 - t3 : t3;\nt3 = y < 0.0 ? -t3 : t3;\nreturn t3;\n}","encoding.glsl":"const vec4 rgba2float_factors = vec4(\n255.0 / (256.0),\n255.0 / (256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n);\nfloat rgba2float(vec4 rgba) {\nreturn dot(rgba, rgba2float_factors);\n}"}},function(e){let t=r;return e.split("/").forEach((e=>{t&&(t=t[e])})),t}));var r;function s(e){return n.resolveIncludes(e)}},24964:function(e,t,i){function n(e,t){if(null!==t){e.push(t.length);for(const i of t)i.serialize(e);return e}e.push(0)}function r(e,t,i){const n=e.readInt32(),r=new Array(n);for(let n=0;n<r.length;n++)r[n]=t.deserialize(e,i);return r}i.d(t,{_:function(){return r},j:function(){return n}})},7295:function(e,t,i){i.r(t),i.d(t,{default:function(){return Dt}});var n=i(53804),r=i(59469),s=i(23502),o=i(58941),a=i(40633),l=(i(13798),i(65953));let u=class extends r.default{constructor(){super(...arguments),this.isAggregate=!0}getEffectivePopupTemplate(e=!1){if(this.popupTemplate)return this.popupTemplate;const t=this.sourceLayer?.featureReduction;return t&&"popupTemplate"in t&&t.popupEnabled?t.popupTemplate:null}getObjectId(){return this.attributes.aggregateId}};(0,n._)([(0,s.MZ)({type:Boolean})],u.prototype,"isAggregate",void 0),u=(0,n._)([(0,l.$)("esri.AggregateGraphic")],u);const c=u;i(50917);var h=i(50659),d=i(78879),f=i(82547),p=i(39819),m=i(61226),_=i(95929),g=i(34194),y=i(60539),v=i(28181),x=i(83525),b=i(36729);let S=class extends x.A{constructor(e){super(e),this._filter=null,this.duration=(0,o.A)("mapview-transitions-duration"),this._excludedEffectView=new b.$B(e),this._includedEffectView=new b.$B(e)}get excludedEffects(){return this._excludedEffectView.effects}set featureEffect(e){this._get("featureEffect")!==e&&this._transitionTo(e)}get filter(){return this._filter||this.featureEffect?.filter||null}get hasEffects(){return this._excludedEffectView.hasEffects||this._includedEffectView.hasEffects}get includedEffects(){return this._includedEffectView.effects}set scale(e){this._set("scale",e),this._excludedEffectView.scale=e,this._includedEffectView.scale=e}get transitioning(){return this._excludedEffectView.transitioning||this._includedEffectView.transitioning}get transitioningToEmpty(){return!this._excludedEffectView.final&&!this._includedEffectView.final}transitionStep(e,t){this._set("scale",t),this.transitioning?(this._includedEffectView.transitionStep(e,t),this._excludedEffectView.transitionStep(e,t),this.transitioning||(this._filter=null)):(this._excludedEffectView.scale=t,this._includedEffectView.scale=t)}endTransition(){this._includedEffectView.endTransition(),this._excludedEffectView.endTransition(),this._filter=null}_transitionTo(e){const t=this._get("featureEffect"),i=e,n=i?.includedEffect,r=i?.excludedEffect,s=this._includedEffectView.canTransitionTo(n)&&this._excludedEffectView.canTransitionTo(r);this._includedEffectView.effect=n,this._excludedEffectView.effect=r,this._set("featureEffect",i),this._filter=i?.filter||t?.filter||null,s||this.endTransition()}};(0,n._)([(0,s.MZ)()],S.prototype,"_filter",void 0),(0,n._)([(0,s.MZ)()],S.prototype,"_excludedEffectView",void 0),(0,n._)([(0,s.MZ)()],S.prototype,"_includedEffectView",void 0),(0,n._)([(0,s.MZ)()],S.prototype,"duration",void 0),(0,n._)([(0,s.MZ)()],S.prototype,"excludedEffects",null),(0,n._)([(0,s.MZ)()],S.prototype,"featureEffect",null),(0,n._)([(0,s.MZ)()],S.prototype,"filter",null),(0,n._)([(0,s.MZ)()],S.prototype,"hasEffects",null),(0,n._)([(0,s.MZ)()],S.prototype,"includedEffects",null),(0,n._)([(0,s.MZ)({value:0})],S.prototype,"scale",null),(0,n._)([(0,s.MZ)()],S.prototype,"transitioning",null),(0,n._)([(0,s.MZ)()],S.prototype,"transitioningToEmpty",null),S=(0,n._)([(0,l.$)("esri.layers.effects.FeatureEffectView")],S);const w=S;var T=i(58081),P=i(23812),I=i(53743),M=i(11432),A=i(97357),C=i(47332),E=i(51084),R=i(57165);let O=class extends E.A{constructor(){super(...arguments),this.features=[]}readFeatures(e,t){const i=R.A.fromJSON(t.spatialReference),n=[];for(let t=0;t<e.length;t++){const r=e[t],s=c.fromJSON(r),o=r.geometry?.spatialReference;null==s.geometry||o||(s.geometry.spatialReference=i);const a=r.aggregateGeometries,l=s.aggregateGeometries;if(a&&null!=l)for(const e in l){const t=l[e],n=a[e],r=n?.spatialReference;null==t||r||(t.spatialReference=i)}n.push(s)}return n}};(0,n._)([(0,s.MZ)({type:[c],json:{write:!0}})],O.prototype,"features",void 0),(0,n._)([(0,C.w)("features")],O.prototype,"readFeatures",null),O=(0,n._)([(0,l.$)("esri.rest.support.AggregateFeatureSet")],O);const z=O;var F=i(7926),V=i(60021),L=i(20248),D=i(53838),N=i(28230),k=i(50944),B=i(92543),U=i(86329);class G{constructor(){this._instanceById=new Map}destroy(){this._instanceById.clear()}get size(){return this._instanceById.size}entries(){return this._instanceById.entries()}updateStart(){this._instanceByIdNext=new Map}updateEnd(){if(!this._instanceByIdNext)throw new Error("InternalError: Found updateEnd call without corresponding updateStart");for(const e of this._instanceById.keys())this._instanceByIdNext.has(e)||this._instanceById.delete(e);for(const[e,t]of this._instanceByIdNext.entries()){const i=this._instanceById.get(e);i?i.setInput(t.getInput()):this._instanceById.set(e,t)}this._instanceByIdNext=null}values(){return this._instanceById.values()}ensureInstance(e,t){let i;if("object"==typeof t&&"optionalAttributes"in t&&"uniforms"in t){i=`${e.type}${JSON.stringify(t.optionalAttributes)}`;const n=t.uniforms;if("object"==typeof n)for(const e in n)i+=`${e}.${null!=n[e]}`}else i=`${e.type}.${JSON.stringify(t)}`;const n=(0,k.Wm)(i);if(this._instanceByIdNext){const i=new B.c((0,U.U)(n),e,t);return this._instanceByIdNext.set(n,i),i}if(!this._instanceById.has(n)){const i=new B.c((0,U.U)(n),e,t);this._instanceById.set(n,i)}return this._instanceById.get(n)}getInstance(e){return this._instanceById.get(e)}}var H=i(63812),Y=i(81728),Z=i(42827),q=i(87416),$=(i(54608),i(36008)),W=(i(38648),i(82563),i(27657));class j{constructor(e,t,i,n){this.getStage=e,this.getSubscriptionVersion=t,this.version=i,this._tileInfoView=n,this._pendingUpdates=new Z.A(1e3),this._locked=!1,this._tiles=new Map}destroy(){for(const e of this.tiles())e.destroy();this._pendingUpdates.clear(),this._tiles.clear()}tiles(){return this._tiles.values()}size(){return this._tiles.size}setTiles(e){this._tiles.clear();for(const t of e)this._tiles.set(t.key.id,t)}lockUploads(){this._locked=!0}unlockUploads(){this._locked=!1,this.flush()}enqueueUpdate(e){this._pendingUpdates.enqueue(e)}update(e){if(!this._locked)for(;this._pendingUpdates.size;){const t=this._pendingUpdates.peek();if(null==t||t.inner.attributeEpoch>e)break;this._updateTile(t),this._pendingUpdates.dequeue()}}removeTile(e){const t=this._tiles.get(e);(0,o.A)("esri-2d-update-debug")&&console.debug(`Tile[${e}] RenderState.removeTile`),t?.destroy(),this._tiles.delete(e)}isTileDone(e){const t=this._tiles.get(e.id);return!!t&&t.isReady}flush(){for(;this._pendingUpdates.size;){const e=this._pendingUpdates.dequeue();null!=e&&this._updateTile(e)}for(const e of this._tiles.values())e.upload()}_updateTile(e){const{inner:t,objectIdMap:i}=e,n=this.getSubscriptionVersion(t.id);if(n!==t.subscriptionVesrion){if((0,o.A)("esri-2d-update-debug")){const e=`${t.subscriptionVesrion} != ${n}`;console.debug(`Version[${e}] Tile[${t.id}] FeatureContainer - Dropping message, outdated version]`,t)}return}if((0,o.A)("esri-2d-update-debug")){const e=t.debugInfo?.chunkId??"<EnsureEnd>";console.debug(`Version[${t.version}] Tile[${t.id}] Chunk[${e}] RenderState.updateTile [${t.type}]`,t)}const r=this._ensureTile(t.id);if("update"===t.type){const[e,...n]=t.modify;r.onMessage({type:"update",modify:e,remove:t.remove,end:t.end,attributeEpoch:t.attributeEpoch,objectIdMap:i});for(const e of n){const n=this._tiles.get(e.tileId);n&&n.onMessage({type:"update",modify:e,remove:t.remove,end:!1,isPixelBuffer:!0,attributeEpoch:null,objectIdMap:i})}return}if(null==t.append)return void r.onMessage({type:"append",clear:t.clear,debugInfo:t.debugInfo,end:t.end,attributeEpoch:t.attributeEpoch,objectIdMap:i});const[s,...a]=t.append;r.onMessage({type:"append",clear:t.clear,append:s,debugInfo:t.debugInfo,end:t.end,attributeEpoch:t.attributeEpoch,objectIdMap:i});for(const e of a){const t=this._tiles.get(e.tileId);t&&t.onMessage({type:"update",modify:e,remove:[],sort:!1,end:!1,isPixelBuffer:!0,attributeEpoch:null,objectIdMap:i})}}_ensureTile(e){if(!this._tiles.has(e)){const t=this._createTile(e);this._copyPixelBufferedEntitiesInto(t),this._tiles.set(e,t)}return this._tiles.get(e)}_createTile(e){(0,o.A)("esri-2d-update-debug")&&console.debug(`Version[${this.version}] Tile[${e}] RenderState.createTile`);const t=new $.A(e),i=this._tileInfoView.getTileBounds((0,q.vt)(),t),n=this._tileInfoView.getTileResolution(t.level),r=new W.R(t,n,i[0],i[3],!0);if(r.stage=this.getStage(),!r.stage){const e=new p.A("featurelayerview:webgl","Cannot create tile with empty stage");a.A.getLogger("esri.views.2d.layers.features.RenderState").error(e)}return r}_copyPixelBufferedEntitiesInto(e){let t=7;const i=this._tileInfoView.getLODInfoAt(e.key);for(let n=-1;n<=1;n++)for(let r=-1;r<=1;r++){if(0===n&&0===r)continue;const s=e.key.getNormalizedNeighbor(r,n,i).id,o=this._tiles.get(s);if(null!=o){const i=1<<t;e.copyPixelBufferedEntitesFrom(o,i,r,n)}t--}}}var X=i(30488);class K{constructor(e,t){this.id=e,this.version=t,this._resolver=(0,y.Tw)(),this._done=!1}get done(){return this._done}get promise(){return this._resolver.promise}end(){this._resolver.resolve(),this._done=!0}destroy(){this._resolver.reject()}}class Q extends D.j{constructor(e){super(e.view.featuresTilingScheme),this.updatingHandles=new L.U,this._hitTestsRequests=[],this._store=new G,this._visibleTiles=new Set,this._subscriptions=new Map,this._updateStatisticsRequests=[],this._lockStatisticUpdates=!1,this._layerView=e,this.addTransitionable(this._layerView.featureEffectView)}renderChildren(e){if(this._updateAttributeView(),this._renderState?.update(this.attributeView.currentEpoch),this._renderState){const e=Array.from(this._renderState.tiles()).filter((e=>e.needsUpload));e.length&&(e[Math.floor(Math.random()*e.length)].upload(),e.length>=2&&this.requestRender());for(const e of this._renderState.tiles())e.tryReady(this.attributeView.currentEpoch)&&(this._subscriptions.get(e.key.id)?.end(),this._layerView.requestUpdate(),this.hasLabels&&this._layerView.view.labelManager.requestUpdate(),this.requestRender())}for(const t of this.children)t.setTransform(e.state);switch(super.renderChildren(e),e.drawPhase){case N.S5.MAP:return this._renderMapPhase(e);case N.S5.HIGHLIGHT:return this._renderHighlightPhase(e);case N.S5.LABEL:return this._renderLabelPhase(e)}}subscriptions(){return this._subscriptions.values()}get _instanceStore(){return this._store}get instanceStore(){return this._store}get layerView(){return this._layerView}get hasLabels(){return this._layerView.labelingCollisionInfos.length>0}get hasHighlight(){return this._layerView.hasHighlight()}get _layer(){return this._layerView.layer}_getHeatmapInstance(e){if(null==this._instanceStore||!(e.drawPhase&H.YS.heatmap.drawPhase))return null;for(const e of this._instanceStore.values())if(J(e))return e;return null}get children(){return this._renderState?Array.from(this._renderState.tiles()).filter((e=>this._visibleTiles.has(e.key.id))):[]}updateAttributeView(e){this.requestRender(),this.attributeView.requestUpdate(e),this.hasLabels&&this._layerView.view.labelManager.requestUpdate()}updateSubscriptions(e){for(const{tileId:t,version:i}of e.subscribe)if(this._subscriptions.has(t))this._subscriptions.get(t).version=i;else{const e=new K(t,i);this._subscriptions.set(t,e),this.updatingHandles.addPromise(e.promise)}for(const t of e.unsubscribe){const e=this._subscriptions.get(t);e?.destroy(),this._subscriptions.delete(t),this.removeTile(t)}}isDone(e){return!!this._renderState&&this._renderState.isTileDone(e)}async updateRenderState(e){(0,o.A)("esri-2d-update-debug")&&console.debug(`Version[${e}] FeatureContainer.updateRenderState`),this._renderStateNext=new j((()=>this._stage),(e=>this._subscriptions.get(e)?.version),e,this.tileInfoView)}getDisplayStatistics(e,t){const i=this._statisticsByLevel.get(e);return i?i.get(t):null}updateStatistics(e,t){if(this._lockStatisticUpdates)return void this._updateStatisticsRequests.push({level:e,statistics:t});let i=this._statisticsByLevel.get(e);i||(i=new Map,this._statisticsByLevel.set(e,i));for(const e of t)i.set(e.fieldName,{minValue:e.minValue,maxValue:e.maxValue})}editStart(){this._renderState?.lockUploads(),this.attributeView.lockTextureUploads(),this._lockStatisticUpdates=!0}editEnd(){this._renderState?.unlockUploads(),this.attributeView.unlockTextureUploads(),this._lockStatisticUpdates=!1;for(const e of this._updateStatisticsRequests)this.updateStatistics(e.level,e.statistics);this._updateStatisticsRequests=[],this.requestRender()}swapRenderState(){this._renderStateNext&&((0,o.A)("esri-2d-update-debug")&&console.debug(`Version[${this._renderStateNext.version}] FeatureContainer.update.swapRenderState`),this._renderState?.destroy(),this._renderState=this._renderStateNext,this._renderStateNext=null),this._renderState&&this._renderState.flush(),this.requestRender()}setVisibleTiles(e){this._visibleTiles=e}async onMessage(e,t){(0,y.Te)(t);const i=e.inner;if(!this._subscriptions.has(i.id))return;const n=this._subscriptions.get(i.id);if(n.version!==i.subscriptionVesrion){if((0,o.A)("esri-2d-update-debug")){const e=`${i.subscriptionVesrion} != ${n.version}`;console.debug(`Version[${e}] Tile[${i.id}] FeatureContainer - Dropping message, outdated version]`,i)}return}const r=this._renderStateNext??this._renderState;if(!r)throw new Error("InternalError: No renderState defined");r.version!==i.version&&console.error(`InternalError: Version mismatch. [renderState: ${r.version}, message: ${i.version}]`),r.enqueueUpdate(e),this.requestRender(),this._layerView.view.labelManager.requestUpdate(),this._layerView.requestUpdate()}removeTile(e){(this._renderState||this._renderStateNext)&&(this._renderState&&this._renderState.removeTile(e),this._renderStateNext&&this._renderStateNext.removeTile(e))}hitTest(e){let t=this._hitTestsRequests.find((({x:t,y:i})=>t===e.x&&i===e.y));const i=(0,y.Tw)();return t?t.resolvers.push(i):(t={x:e.x,y:e.y,resolvers:[i]},this._hitTestsRequests.push(t)),this.requestRender(),i.promise}getSortKeys(e){const t=new Set(e),i=new Map;for(const e of this.children)if(e.getSortKeys(t).forEach(((e,t)=>i.set(t,e))),i.size===t.size)break;return i}get hasAnimation(){return this.hasLabels}doRender(e){const{minScale:t,maxScale:i}=this._layer.effectiveScaleRange,n=e.state.scale;n<=(t||1/0)&&n>=i&&super.doRender(e)}afterRender(e){super.afterRender(e),this._hitTestsRequests.length&&this.requestRender()}setStencilReference(e){if(null==this._getHeatmapInstance(e))super.setStencilReference(e);else for(const e of this.children)e.stencilRef=H.YS.heatmap.getStencilReference(e)}_renderMapPhase(e){this._layerView.featureEffectView.hasEffects?(this._renderOutsideEffect(e),this._renderInsideEffect(e)):this._renderFeatures(e,N.RI.All),this._hitTestsRequests.length>0&&this._renderHittest(e)}_renderHighlightPhase(e){this.hasHighlight&&(0,X.lB)(e,!1,(e=>{this._renderFeatures(e,N.RI.Highlight)}))}_renderLabelPhase(e){this._renderFeatures(e,N.RI.All)}_renderInsideEffect(e){const t=e.painter.effects.insideEffect;t.bind(e),this._renderFeatures(e,N.RI.InsideEffect),t.draw(e,this._layerView.featureEffectView.includedEffects),t.unbind()}_renderOutsideEffect(e){const t=e.painter.effects.outsideEffect;t.bind(e),this._renderFeatures(e,N.RI.OutsideEffect),t.draw(e,this._layerView.featureEffectView.excludedEffects),t.unbind()}_renderHittest(e){const{context:t}=e,i=e.painter.effects.hittest,n=t.getBoundFramebufferObject(),r=t.getViewport(),s=e.passOptions,o=e.drawPhase;i.bind(e),e.passOptions=i.createOptions(e,this._hitTestsRequests),e.drawPhase=N.S5.HITTEST;const{distance:a,smallSymbolDistance:l}=e.passOptions,u=Math.max(a,l);for(const t of this.children)t.visible&&t.containsScreenPoint(e.state,e.passOptions.position,2*u)&&this._renderTile(t,e,N.RI.All);i.draw(e),i.unbind(),t.bindFramebuffer(n),t.restoreViewport(r),e.passOptions=s,e.drawPhase=o}_renderFeatures(e,t){const i=this._getHeatmapInstance(e);null!=i?this._renderHeatmapFeatures(e,t,i):this._renderGeometryFeatures(e,t)}_renderGeometryFeatures(e,t){for(const i of this.children)i.visible&&this._renderTile(i,e,t)}_renderHeatmapFeatures(e,t,i){for(const i of this.children)i.visible&&this._renderTile(i,e,t,Y.N.Heatmap);i.techniqueRef.renderResolvePass(e,i)}_renderTile(e,t,i,n){const r=(0,o.A)("featurelayer-force-marker-text-draw-order")?N.ch.STRICT_MARKERS_AND_TEXT:N.ch.BATCHING,s=e.getDisplayList(this._instanceStore,r);t.selection=i,s?.render(t,n)}}function J(e){return e.techniqueRef.type===Y.N.Heatmap}var ee=i(86027);class te{constructor(e){this._connection=e,this.pipeline=this._connection.createInvokeProxy(),this.features=this._connection.createInvokeProxy("features"),this.aggregates=this._connection.createInvokeProxy("aggregates"),this.streamMessenger=this._connection.createInvokeProxy("streamMessenger")}destroy(){this._connection.destroy()}get closed(){return this._connection.closed}}var ie=i(48996),ne=i(62790);let re=class extends x.A{constructor(){super(...arguments),this.events=new ie.A,this._updatingStrategy=!0,this._tileToEvent=new ne.A,this._fetchStatus={outstanding:0,done:0}}get hasAllFeatures(){return this._hasAllData()&&(this._strategyInfo?.willQueryAllFeatures??!1)}get hasAllFeaturesInView(){return this._hasAllData()}get hasFullGeometries(){return this._hasAllData()&&(this._strategyInfo?.willQueryFullResolutionGeometry??!1)}onEvent(e){switch(e.type){case"subscribe":case"unsubscribe":case"loaded":case"error":this._handleTileEvent(e);break;case"updateStrategyStart":this._updatingStrategy=!0,this._fetchStatus={done:0,outstanding:0},this._strategyInfo=e.about;break;case"updateStrategyEnd":this._updatingStrategy=!1;break;case"updateFieldsStart":this._fetchStatus={done:0,outstanding:0};break;case"updateFieldsEnd":break;case"updateFieldsError":this.events.emit("error",e);break;case"fetchStart":this._fetchStatus.outstanding+=1,this.events.emit("status",this._fetchStatus);break;case"fetchEnd":this._fetchStatus.done+=1,this.events.emit("status",this._fetchStatus),e.done&&(this._fetchStatus={done:0,outstanding:0})}}_hasAllData(){return!this._updatingStrategy&&this._hasAllTileData()}_hasAllTileData(){for(const e of this._tileToEvent.values()){const t=e.peekLast();if("loaded"!==t?.type)return!1}return!0}_handleTileEvent(e){switch(e.type){case"subscribe":{const t=new Z.A(10);t.enqueue(e),this._tileToEvent.set(e.tile,t);break}case"unsubscribe":this._tileToEvent.delete(e.tile);break;case"loaded":{const t=this._tileToEvent.get(e.tile);if(!t)return;t.enqueue(e),this._tileToEvent.set(e.tile,t);break}case"error":{const t=this._tileToEvent.get(e.tile);if(!t)return;t.enqueue(e),this._tileToEvent.set(e.tile,t),this.events.emit("error",e);break}}}};(0,n._)([(0,s.MZ)({readOnly:!0})],re.prototype,"hasAllFeatures",null),(0,n._)([(0,s.MZ)({readOnly:!0})],re.prototype,"hasAllFeaturesInView",null),(0,n._)([(0,s.MZ)({readOnly:!0})],re.prototype,"hasFullGeometries",null),(0,n._)([(0,s.MZ)()],re.prototype,"_updatingStrategy",void 0),(0,n._)([(0,s.MZ)()],re.prototype,"_strategyInfo",void 0),(0,n._)([(0,s.MZ)()],re.prototype,"_tileToEvent",void 0),re=(0,n._)([(0,l.$)("esri.views.2d.layers.features.FeatureSourceEventLog")],re);var se=i(21609),oe=i(93389);function ae(e){switch(e.geometryType){case"point":return"esriGeometryPoint";case"polyline":return"esriGeometryPolyline";case"polygon":return"esriGeometryPolygon";case"multipatch":return"esriGeometryMultiPatch";case"multipoint":return"esriGeometryMultipoint";default:return null}}var le=i(13520);function ue(e,t){const i=e.featureReduction;return i&&"selection"!==i.type&&(!("maxScale"in i)||!i.maxScale||i.maxScale<t.scale)?i:null}var ce=i(15774),he=i(85031),de=i(32974);const fe=Math.PI;function pe(e,t){switch(t.transformationType){case de._w.Additive:return function(e,t){return e+(me(t.minSize,e)||t.minDataValue)}(e,t);case de._w.Constant:return function(e,t){const i=e.stops;let n=i?.length&&i[0].size;return null==n&&(n=e.minSize),me(n,t)}(t,e);case de._w.ClampedLinear:return function(e,t){const i=t.minDataValue,n=t.maxDataValue,r=(e-i)/(n-i),s=me(t.minSize,e),o=me(t.maxSize,e);return e<=i?s:e>=n?o:s+r*(o-s)}(e,t);case de._w.Proportional:return function(e,t){const i=e/t.minDataValue,n=me(t.minSize,e),r=me(t.maxSize,e);let s=null;return s=i*n,(0,ce.qE)(s,n,r)}(e,t);case de._w.Stops:return function(e,t){const[i,n,r]=function(e,t){if(!t)return;let i=0,n=t.length-1;return t.some(((t,r)=>e<t?(n=r,!0):(i=r,!1))),[i,n,(e-t[i])/(t[n]-t[i])]}(e,t.cache.ipData);if(i===n)return me(t.stops[i].size,e);{const s=me(t.stops[i].size,e);return s+(me(t.stops[n].size,e)-s)*r}}(e,t);case de._w.RealWorldSize:return function(e,t){const i=he.j[t.valueUnit],n=me(t.minSize,e),r=me(t.maxSize,e),{valueRepresentation:s}=t;let o=null;return o="area"===s?2*Math.sqrt(e/fe)/i:"radius"===s||"distance"===s?2*e/i:e/i,(0,ce.qE)(o,n,r)}(e,t);case de._w.Identity:return e;case de._w.Unknown:return null}}function me(e,t){return"number"==typeof e?e:pe(t,e)}function _e(e){return(e.labelsVisible&&e.labelingInfo?.every((e=>"none"!==e.deconflictionStrategy)))??!1}function ge(e,t){const i=ue(e,t);if(i?.labelsVisible&&i.labelingInfo?.length)return i.labelingInfo.every((e=>"none"!==e.deconflictionStrategy))}function ye(e){return t=>(0,le.Lz)(pe(t,e))}function ve(e){const t=null!=e&&"visualVariables"in e&&e.visualVariables;if(!t)return null;for(const e of t)if("size"===e.type)return ye(e);return null}var xe=i(98737);function be(e,t,i,n){const r=null!=e.subtypeCode?`${e.subtypeField} = ${e.subtypeCode}`:null,s=(0,xe.m)(e.definitionExpression,r),o=e.customParameters??{};return n&&(o.token=n),{type:"feature",mutable:{sourceRefreshVersion:i,availableFields:t.availableFields,dataFilter:{queryScaleRanges:e.queryScaleRanges??[],definitionExpression:s,gdbVersion:e.gdbVersion,historicMoment:e.historicMoment?.getTime(),timeExtent:e.timeExtent?.toJSON(),customParameters:o}}}}var Se=i(41165),we=i(79212),Te=(i(10748),i(70181)),Pe=i(57176),Ie=i(33389),Me=i(44508),Ae=i(96564);function Ce(e,t,i=0){if(null==t)return e[i]=0,e[i+1]=0,e[i+2]=0,void(e[i+3]=0);const{r:n,g:r,b:s,a:o}=t;e[i]=n*o/255,e[i+1]=r*o/255,e[i+2]=s*o/255,e[i+3]=o}i(85475);var Ee=i(39686),Re=i(29397),Oe=i(44327),ze=i(81672),Fe=i(80958),Ve=i(8740),Le=i(90363),De=i(22198);async function Ne(e,t){if(!e)return[];switch(e.type){case"simple-fill":return Ze(e,t);case"picture-fill":return function(e,t){const{outline:i}=e,{uniforms:n,schemaOptions:r}=t,{store:s}=r,o=[],a=Pe.wp.createPictureFillRasterizationParam(e);if(!a)return[];const{width:l,height:u,xoffset:c,yoffset:h,xscale:d,yscale:f}=e,p={color:[255,255,255,255],sprite:a,height:u,aspectRatio:l/u,offsetX:c,offsetY:h,scaleX:d,scaleY:f,angle:0,applyRandomOffset:!1,sampleAlphaOnly:!1,scaleProportionally:!1,effects:null,scaleInfo:null};if("solid"===i?.style)return[s.ensureInstance(H.YS.complexOutlineFill,{uniforms:{visualVariableColor:n.visualVariableColor,visualVariableOpacity:n.visualVariableOpacity,visualVariableSizeScaleStops:n.visualVariableSizeOutlineScaleStops,visualVariableSizeMinMaxValue:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null},optionalAttributes:{zoomRange:!1}}).createMeshInfo({...p,...Ye(i,!!n.visualVariableSizeOutlineScaleStops)})];const m=s.ensureInstance(H.YS.complexFill,{uniforms:{visualVariableColor:n.visualVariableColor,visualVariableOpacity:n.visualVariableOpacity},optionalAttributes:{zoomRange:!1}});return o.push(m.createMeshInfo(p)),i&&o.push(...qe(i,t,!0)),o}(e,t);case"simple-marker":return He(e,t);case"picture-marker":return function(e,t){const{uniforms:i,schemaOptions:n}=t,{store:r}=n,s=r.ensureInstance(H.YS.marker,{uniforms:{visualVariableColor:i.visualVariableColor,visualVariableOpacity:i.visualVariableOpacity,visualVariableSizeMinMaxValue:i.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:i.visualVariableSizeScaleStops,visualVariableSizeStops:i.visualVariableSizeStops,visualVariableSizeUnitValue:i.visualVariableSizeUnitValue,visualVariableRotation:i.visualVariableRotation},optionalAttributes:{zoomRange:!1}}),o=Pe.wp.createPictureMarkerRasterizationParam(e);return o?[s.createMeshInfo({type:"picture",color:[255,255,255,255],height:e.height,width:e.width,offsetX:e.xoffset,offsetY:e.yoffset,angle:e.angle,alignment:(0,Fe.N)(i)?Ie.C1.MAP:Ie.C1.SCREEN,outlineColor:null,outlineSize:0,referenceSize:e.height,sprite:o,overrideOutlineColor:!1,hasSizeVV:(0,Fe.I)(i),placement:null,effects:null,transforms:null,scaleInfo:null,minPixelBuffer:(0,Oe.j0)(i)})]:[]}(e,t);case"simple-line":return qe(e,t,!1);case"text":return function(e,t){const{uniforms:i,schemaOptions:n}=t,{store:r}=n;return[r.ensureInstance(H.YS.text,{uniforms:{visualVariableColor:i.visualVariableColor,visualVariableOpacity:i.visualVariableOpacity,visualVariableRotation:i.visualVariableRotation,visualVariableSizeMinMaxValue:i.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:i.visualVariableSizeScaleStops,visualVariableSizeStops:i.visualVariableSizeStops,visualVariableSizeUnitValue:i.visualVariableSizeUnitValue},optionalAttributes:{zoomRange:!1,clipAngle:!1,referenceSymbol:!1}}).createMeshInfo({boxBackgroundColor:e.backgroundColor?.toArray(),boxBorderLineColor:e.borderLineColor?.toArray(),boxBorderLineSize:e.borderLineSize??0,color:e.color?.toArray()??[0,0,0,0],offsetX:e.xoffset,offsetY:e.yoffset,postAngle:e.angle,fontSize:e.font.size,decoration:e.font.decoration,haloColor:e.haloColor?.toArray()??[0,0,0,0],haloSize:e.haloSize??0,outlineColor:[0,0,0,0],outlineSize:0,lineWidth:e.lineWidth,lineHeightRatio:e.lineHeight,horizontalAlignment:e.horizontalAlignment,verticalAlignment:e.verticalAlignment,useCIMAngleBehavior:!1,glyphs:{type:"text-rasterization-param",resource:{type:"text",font:e.font.toJSON(),textString:e.text,symbol:Pe.wp.createCIMTextSymbolfromTextSymbol(e)},overrides:[]},referenceSize:null,effects:null,placement:null,scaleInfo:null,transforms:null,scaleFactor:1,minPixelBuffer:(0,Oe.j0)(i),repeatLabel:null,repeatLabelDistance:null,allowOverrun:null,labelPosition:null})]}(e,t);case"label":return function(e,t){const{schemaOptions:i,uniforms:n}=t,{store:r}=i,s=e.symbol,{allowOverrun:o,repeatLabel:a,repeatLabelDistance:l}=e,u={maxScale:e.maxScale??0,minScale:e.minScale??0},c=r.ensureInstance(H.YS.label,{uniforms:{visualVariableColor:null,visualVariableOpacity:null,visualVariableRotation:n.visualVariableRotation,visualVariableSizeMinMaxValue:n.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:n.visualVariableSizeScaleStops,visualVariableSizeStops:n.visualVariableSizeStops,visualVariableSizeUnitValue:n.visualVariableSizeUnitValue},optionalAttributes:{zoomRange:!0,clipAngle:!0,referenceSymbol:!0}}),h=e.labelPlacement,[d,f]=(0,Ae.fO)(h);return[c.createMeshInfo({boxBackgroundColor:s.backgroundColor?.toArray(),boxBorderLineColor:s.borderLineColor?.toArray(),boxBorderLineSize:s.borderLineSize??0,color:s.color?.toArray()??[0,0,0,0],offsetX:s.xoffset,offsetY:s.yoffset,postAngle:s.angle,fontSize:s.font.size,decoration:s.font.decoration,outlineColor:[0,0,0,0],outlineSize:0,haloColor:s.haloColor?.toArray()??[0,0,0,0],haloSize:s.haloSize??0,lineWidth:s.lineWidth,lineHeightRatio:s.lineHeight,horizontalAlignment:d,verticalAlignment:f,repeatLabel:a,repeatLabelDistance:(0,le.Lz)(l),allowOverrun:o,labelPosition:e.labelPosition,scaleInfo:u,minPixelBuffer:(0,Oe.j0)(n),useCIMAngleBehavior:!1,glyphs:{type:"text-rasterization-param",resource:{type:"text",font:s.font.toJSON(),textString:s.text,symbol:Pe.wp.createCIMTextSymbolfromTextSymbol(s),primitiveName:"label-override"},useLegacyLabelEvaluationRules:null==e.labelExpressionInfo?.expression,overrides:[{type:"CIMPrimitiveOverride",valueExpressionInfo:{type:"CIMExpressionInfo",expression:e.labelExpressionInfo?.expression??e.labelExpression,returnType:"String"},primitiveName:"label-override",propertyName:"textString",defaultValue:""}]},referenceSize:null,effects:null,placement:null,transforms:null,scaleFactor:1})]}(e,t);case"cim":return(0,ze.Jk)(e.data,t);case"web-style":{const i=await e.fetchCIMSymbol();return(0,ze.Jk)(i.data,t)}case"line-3d":return a.A.getLogger("esri.views.layers.FeatureLayerView").warn("unsupported-symbol",`Symbol of type "${e.type}" unsupported in MapView. Defaulting to simple-line`),qe(new De.A,t,!1);case"point-3d":return a.A.getLogger("esri.views.layers.FeatureLayerView").warn("unsupported-symbol",`Symbol of type "${e.type}" unsupported in MapView. Defaulting to simple-marker`),He(new Le.A,t);case"polygon-3d":return a.A.getLogger("esri.views.layers.FeatureLayerView").warn("unsupported-symbol",`Symbol of type "${e.type}" unsupported in MapView. Defaulting to simple-fill`),Ze(new Ve.A,t);case"mesh-3d":case"label-3d":return a.A.getLogger("esri.views.layers.FeatureLayerView").warn("unsupported-symbol",`Symbol of type "${e.type}" unsupported in MapView. Ignoring`),[];case"CIMSymbolReference":throw new Error("InternalError: CIMSymbolReference should already be resolved")}}async function ke(e,t){const{schemaOptions:i}=t,{store:n}=i,r=new Array(Ee.ju),s=new Array(Ee.ju/4);for(let t=0;t<Ee.ju;t++){const i=t<e.attributes.length?e.attributes[t].color:null;r[t]=[0,0,0,0],Ce(r[t],i)}for(let t=0;t<Ee.ju/4;t++)s[t]=[0,0,0,0],s[t][0]=4*t<e.attributes.length?1:0,s[t][1]=4*t+1<e.attributes.length?1:0,s[t][2]=4*t+2<e.attributes.length?1:0,s[t][3]=4*t+3<e.attributes.length?1:0;const o={uniforms:{isActive:s,colors:r,dotValue:e.dotValue,dotScale:e.referenceScale,blending:e.dotBlendingEnabled,dotSize:e.dotSize,seed:e.seed},optionalAttributes:{}},a=n.ensureInstance(H.YS.dotDensity,o).createMeshInfo({effects:null}),l=[],u=new Ve.A({color:e.backgroundColor??[0,0,0,0],outline:null}),c=await Ne(u,t);if(l.push(...c),l.push(a),e.outline){const i=qe(e.outline,t,!0);l.push(...i)}return l}async function Be(e,t){const{store:i}=t,{radius:n,minDensity:r,maxDensity:s,referenceScale:o,field:a,valueExpression:l,colorStops:u}=e,c=(0,Te.O3)(u);return[i.ensureInstance(H.YS.heatmap,{uniforms:{radius:(0,le.Lz)(n),minDensity:r,maxDensity:s,referenceScale:o,isFieldActive:!(!a&&!l),gradient:c,gradientHash:c.join(",")},optionalAttributes:{}}).createMeshInfo({effects:null})]}async function Ue(e,t){const{store:i}=t,n=e.outline?.width||0,r=(0,Oe.K4)(e),s=i.ensureInstance(H.YS.pieChart,{uniforms:{shader:{outlineWidth:Math.round((0,le.Lz)(n)),defaultColor:(0,Re.p)(e.defaultColor),outlineColor:(0,Re.p)(e.outline?.color),othersColor:(0,Re.p)(e.othersCategory?.color),donutRatio:e.holePercentage,sectorThreshold:e.othersCategory?.threshold||0,colors:e.attributes.map((e=>(0,Re.p)(e.color))),visualVariableOpacity:r.visualVariableOpacity,visualVariableSizeMinMaxValue:r.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:r.visualVariableSizeScaleStops,visualVariableSizeStops:r.visualVariableSizeStops,visualVariableSizeUnitValue:r.visualVariableSizeUnitValue,hittestUniforms:null},numberOfFields:e.attributes.length},optionalAttributes:{}}).createMeshInfo({size:e.size,outlineWidth:n,effects:null,scaleInfo:null,minPixelBuffer:(0,Oe.j0)(r)});return[...e.backgroundFillSymbol?await Ze(e.backgroundFillSymbol,{schemaOptions:t,path:"",uniforms:Oe.Dk}):[],s]}function Ge(e){if("path"===e.style){if(null==e.path)throw new Error("Symbol with a style of type path must define a path");return{type:"sprite-rasterization-param",overrides:[],resource:{type:"path",path:e.path,asFill:!0}}}const t=Pe.wp.fromSimpleMarker(e);if("outline"in e&&e.outline&&"none"!==e.outline.style&&"solid"!==e.outline.style){if(!t||!t.symbolLayers)throw new Error("Error handling marker! ");return{type:"sprite-rasterization-param",resource:t.symbolLayers[0],overrides:[]}}return{type:"sprite-rasterization-param",resource:(0,Me.eR)(t),overrides:[]}}async function He(e,t){const{uniforms:i,schemaOptions:n}=t,{store:r}=n;if("path"===e.style||e.outline&&"solid"!==e.outline.style&&"none"!==e.outline.style){const n=Pe.wp.fromSimpleMarker(e);if(!n||!n.symbolLayers)throw new Error("Error handling marker! ");if(i.visualVariableRotation&&(n.angleAlignment="Map"),"path"!==e.style){const e=n.symbolLayers[0];if((0,Fe.I)(t.uniforms)){const i=(0,Oe.j0)(t.uniforms,0,1);if(i>e.size){const t=i/e.size;e.size=i;const n=e.markerGraphics?.[0].symbol;(n.symbolLayers&&n.symbolLayers[0]).width*=t}}}return(0,ze.Jk)({type:"CIMSymbolReference",symbol:n},t)}const s=r.ensureInstance(H.YS.marker,{uniforms:{visualVariableColor:i.visualVariableColor,visualVariableOpacity:i.visualVariableOpacity,visualVariableSizeMinMaxValue:i.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:i.visualVariableSizeScaleStops,visualVariableSizeStops:i.visualVariableSizeStops,visualVariableSizeUnitValue:i.visualVariableSizeUnitValue,visualVariableRotation:i.visualVariableRotation},optionalAttributes:{zoomRange:!1}}),o=Ge(e);let a=e.color?.toArray()??[0,0,0,0];"CIMVectorMarker"===o.resource.type&&(a=[255,255,255,255]);const l="triangle"===e.style?124/116:1,u=e.size,c=u*l,h=null!=i.visualVariableColor&&("cross"===e.style||"x"===e.style);return[s.createMeshInfo({type:"simple",color:a,height:u,width:c,offsetX:e.xoffset,offsetY:e.yoffset,angle:e.angle,alignment:(0,Fe.N)(i)?Ie.C1.MAP:Ie.C1.SCREEN,outlineColor:e.outline?.color?.toArray()??[0,0,0,0],outlineSize:e.outline?.width??1,referenceSize:u,sprite:o,overrideOutlineColor:h,hasSizeVV:(0,Fe.I)(i),placement:null,effects:null,transforms:null,scaleInfo:null,minPixelBuffer:(0,Oe.j0)(i)})]}function Ye(e,t){const i=e.width;return{outlineColor:e.color?.toArray()||[0,0,0,1],width:i,referenceWidth:i,capType:e.cap??"round",joinType:e.join??"round",miterLimit:e.miterLimit,hasSizeVV:t}}async function Ze(e,t){if("cim"===e.type)return(0,ze.Jk)(e.data,t);const{style:i}=e;return i&&"none"!==i&&"solid"!==i?function(e,t){const{uniforms:i,schemaOptions:n}=t,{store:r}=n,s=e.color?.toArray()??[0,0,0,0],o={type:"sprite-rasterization-param",resource:{type:"fill-style",style:e.style},overrides:[]};if("solid"===e.outline?.style)return[r.ensureInstance(H.YS.patternOutlineFill,{uniforms:{visualVariableColor:i.visualVariableColor,visualVariableOpacity:i.visualVariableOpacity,visualVariableSizeScaleStops:i.visualVariableSizeOutlineScaleStops,visualVariableSizeMinMaxValue:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null},optionalAttributes:{zoomRange:!1}}).createMeshInfo({color:s,...Ye(e.outline,!!i.visualVariableSizeOutlineScaleStops),sprite:o,scaleInfo:null,effects:null})];const a=[],l=r.ensureInstance(H.YS.patternFill,{uniforms:{visualVariableColor:i.visualVariableColor,visualVariableOpacity:i.visualVariableOpacity},optionalAttributes:{zoomRange:!1}}).createMeshInfo({color:e.color?.toArray()??[0,0,0,0],sprite:o,scaleInfo:null,effects:null});return a.push(l),e.outline&&a.push(...qe(e.outline,t,!0)),a}(e,t):function(e,t){const{uniforms:i,schemaOptions:n}=t,{store:r}=n,s=e.color?.toArray()??[0,0,0,0];if("none"!==e.style&&"solid"===e.outline?.style)return[r.ensureInstance(H.YS.outlineFill,{uniforms:{visualVariableColor:i.visualVariableColor,visualVariableOpacity:i.visualVariableOpacity,visualVariableSizeScaleStops:i.visualVariableSizeOutlineScaleStops,visualVariableSizeMinMaxValue:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null},optionalAttributes:{zoomRange:!1}}).createMeshInfo({color:s,...Ye(e.outline,!!i.visualVariableSizeOutlineScaleStops),scaleInfo:null,effects:null})];const o=[];if("none"!==e.style){const e=r.ensureInstance(H.YS.fill,{uniforms:{visualVariableColor:i.visualVariableColor,visualVariableOpacity:i.visualVariableOpacity},optionalAttributes:{zoomRange:!1}}).createMeshInfo({color:s,scaleInfo:null,effects:null});o.push(e)}return e.outline&&o.push(...qe(e.outline,t,!0)),o}(e,t)}function qe(e,t,i){const{color:n,style:r,width:s,cap:o,join:a}=e,{schemaOptions:l}=t,{store:u}=l,c=[],h=i?{...Oe.Dk,visualVariableSizeScaleStops:t.uniforms.visualVariableSizeOutlineScaleStops}:t.uniforms,d={uniforms:{visualVariableColor:h.visualVariableColor,visualVariableOpacity:h.visualVariableOpacity,visualVariableSizeMinMaxValue:h.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:h.visualVariableSizeScaleStops,visualVariableSizeStops:h.visualVariableSizeStops,visualVariableSizeUnitValue:h.visualVariableSizeUnitValue},optionalAttributes:{zoomRange:!1}},f={color:n?.toArray()??[0,0,0,0],width:s,referenceWidth:s,capType:o,joinType:a,miterLimit:e.miterLimit,hasSizeVV:(0,Fe.I)(h),effects:null,scaleInfo:null};if(null==r||"solid"===r){const e=u.ensureInstance(H.YS.line,d).createMeshInfo(f);c.push(e)}else if("none"!==r){const e=u.ensureInstance(H.YS.texturedLine,d).createMeshInfo({...f,offsetAlongLine:0,shouldScaleDash:!0,shouldSampleAlphaOnly:!1,isSDF:!0,sprite:{type:"sprite-rasterization-param",resource:{type:"dash",dashTemplate:(0,Pe.BW)(r,o)},overrides:[]}});c.push(e)}return null!=e.marker&&c.push(...function(e,t,i){const{uniforms:n,schemaOptions:r}=i,{store:s}=r,o=s.ensureInstance(H.YS.marker,{uniforms:{visualVariableColor:n.visualVariableColor,visualVariableOpacity:n.visualVariableOpacity,visualVariableSizeMinMaxValue:n.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:n.visualVariableSizeScaleStops,visualVariableSizeStops:n.visualVariableSizeStops,visualVariableSizeUnitValue:n.visualVariableSizeUnitValue,visualVariableRotation:n.visualVariableRotation},optionalAttributes:{zoomRange:!1}}),a=Ge(e),l=6*t.width,u=l,c=e.color?.toArray()??t.color?.toArray()??[0,0,0,0],h="cross"===e.style||"x"===e.style;let d;switch(e.placement){case"begin-end":d=Ie.$2.Both;break;case"begin":d=Ie.$2.JustBegin;break;case"end":d=Ie.$2.JustEnd;break;default:d=Ie.$2.None}const f={type:"cim-marker-placement-param",placement:{type:"CIMMarkerPlacementAtExtremities",angleToLine:!0,offset:0,extremityPlacement:d,offsetAlongLine:0},overrides:[]};return[o.createMeshInfo({type:"simple",color:c,height:u,width:l,offsetX:0,offsetY:0,angle:0,alignment:(0,Fe.N)(n)?Ie.C1.MAP:Ie.C1.SCREEN,outlineColor:c,outlineSize:h?t.width:0,referenceSize:u/6,sprite:a,overrideOutlineColor:h&&null!=n.visualVariableColor,hasSizeVV:(0,Fe.I)(n),placement:f,transforms:null,effects:null,scaleInfo:null,minPixelBuffer:(0,Oe.j0)(n)})]}(e.marker,e,t)),c}async function $e(e,t,i){const n=t.labelsVisible&&t.labelingInfo||[],r=ae(t),s=(0,we.z)(n,r);return{type:"label",classes:await Promise.all(s.map(((t,n)=>async function(e,t,i,n){const r=await Ne(t,{path:`${i}`,schemaOptions:e,uniforms:n});return{maxScale:t.maxScale,minScale:t.minScale,expression:t.labelExpressionInfo?.expression??t.labelExpression,where:t.where,meshes:r}}(e,t,n,i))))}}async function We(e,t){if(!t)return{type:"simple",meshes:[]};switch(t.type){case"simple":return async function(e,t){const i=t.getSymbols(),n=i.length?i[0]:null,r=(0,Oe.K4)(t);return{type:"simple",meshes:await Ne(n,{schemaOptions:e,uniforms:r,path:"renderer.symbol"})}}(e,t);case"dot-density":return async function(e,t){const i=(0,Oe.K4)(t);return{type:"dot-density",meshes:await ke(t,{schemaOptions:e,uniforms:i,path:"renderer.symbol"})}}(e,t);case"class-breaks":return async function(e,t){const i=(0,Oe.K4)(t),n=t.backgroundFillSymbol,r=t.normalizationType,s="log"===r?"esriNormalizeByLog":"percent-of-total"===r?"esriNormalizeByPercentOfTotal":"field"===r?"esriNormalizeByField":null,o=t.classBreakInfos.map((async t=>({meshes:await Ne(t.symbol,{path:`renderer-stop-${t.minValue}-${t.maxValue}`,schemaOptions:e,uniforms:i}),min:t.minValue,max:t.maxValue}))),a=(await Promise.all(o)).sort(((e,t)=>e.min-t.min)),l=await Ne(n,{schemaOptions:e,path:"renderer.backgroundFill",uniforms:{...Oe.Dk,visualVariableSizeOutlineScaleStops:i.visualVariableSizeOutlineScaleStops}}),u=await Ne(t.defaultSymbol,{schemaOptions:e,path:"renderer.defaultSymbol",uniforms:i});return{type:"interval",field:t.field,expression:t.valueExpression,backgroundFill:l,defaultSymbol:u,intervals:a,normalizationField:t.normalizationField,normalizationTotal:t.normalizationTotal,normalizationType:s,isMaxInclusive:t.isMaxInclusive}}(e,t);case"unique-value":return async function(e,t){const i=[],n=(0,Oe.K4)(t),r=await Ne(t.backgroundFillSymbol,{schemaOptions:e,path:"renderer.backgroundFill",uniforms:{...Oe.Dk,visualVariableSizeOutlineScaleStops:n.visualVariableSizeOutlineScaleStops}}),s=await Ne(t.defaultSymbol,{schemaOptions:e,path:"renderer.defaultSymbol",uniforms:n});for(const r of t.uniqueValueInfos??[]){const t=await Ne(r.symbol,{path:`renderer-unique-value-${r.value}`,schemaOptions:e,uniforms:n});i.push({value:""+r.value,symbol:t})}return{type:"map",field:t.field,expression:t.valueExpression,field2:t.field2,field3:t.field3,fieldDelimiter:t.fieldDelimiter,backgroundFill:r,defaultSymbol:s,map:i}}(e,t);case"dictionary":return function(e){const t=(0,Oe.K4)(e),i=e.scaleExpression,n=null!=i&&"1"!==i?{valueExpressionInfo:{type:"CIMExpressionInfo",expression:e.scaleExpression,returnType:"Numeric"},defaultValue:1}:void 0;return{type:"dictionary",fieldMap:e.fieldMap,scaleExpression:n,visualVariableUniforms:t}}(t);case"heatmap":return async function(e,t){return{type:"heatmap",meshes:await Be(t,e)}}(e,t);case"pie-chart":return async function(e,t){return{type:"pie-chart",meshes:await Ue(t,e)}}(e,t)}}var je=i(29739);async function Xe(e,t,i,n){const r=i.featureReduction;if(r)switch(r.type){case"binning":return async function(e,t,i,n,r){const s=Ke(e,n.fields),o=e.renderer,a=await We(t,o),l=(0,je.T9)(o,[null,null]),u=(0,Oe.K4)(o),c=await $e(t,{geometryType:"polygon",labelingInfo:e.labelingInfo,labelsVisible:e.labelsVisible},u),h=et(a),d="geohash"===e.binType?{type:"geohash",fixBinLevel:e.fixedBinLevel??3}:{type:"grid",size:(0,le.Lz)(e.size),fixedBinLevel:e.fixedBinLevel};return{storage:l,mesh:{properties:{sortKey:null,timeZone:i.timeZone,returnMeshObjectId:h,displayRefreshVersion:r},strategy:{type:"binning",fields:s,index:d,featureFilter:i.filters[0]},factory:{labels:c,symbology:a}}}}(r,e,t,i,n);case"cluster":return async function(e,t,i,n,r){const s=Ke(e,n.fields),o={type:"cluster",feature:await We(t,e.effectiveFeatureRenderer),cluster:await We(t,e.effectiveClusterRenderer)},a=(0,Oe.K4)(e.effectiveFeatureRenderer),l={type:"cluster",feature:await $e(t,n,a),cluster:await $e(t,{geometryType:"point",labelingInfo:e.labelingInfo,labelsVisible:e.labelsVisible},a)},u=(0,je.T9)(e.effectiveFeatureRenderer,[null,null]),c=et(o);return{storage:u,mesh:{properties:{sortKey:null,timeZone:i.timeZone,displayRefreshVersion:r,returnMeshObjectId:c},strategy:{type:"cluster",fields:s,featureFilter:i.filters[0],clusterRadius:(0,le.Lz)(e.clusterRadius/2)},factory:{labels:l,symbology:o}}}}(r,e,t,i,n)}const s=function(e,t,i){const n=null!=t&&"unique-value"===t.type&&t.orderByClassesEnabled;if("default"!==e||n||(e=[new Se.A({field:i,order:"descending"})]),"default"!==e&&e?.length){e.length;const t=e[0],i="ascending"===t.order?"asc":"desc";return t.field?{field:t.field,order:i}:t.valueExpression?{expression:t.valueExpression,order:i}:null}return n?{byRenderer:!0,order:"asc"}:null}(i.orderBy,i.renderer,i.objectIdField),o=(0,je.T9)(i.renderer,t.filters),a=await async function(e,t){const i=t.renderer,n=(0,Oe.K4)(i);return{symbology:await We(e,i),labels:await $e(e,t,n)}}(e,i),l=et(a.symbology);return{storage:o,mesh:{properties:{sortKey:s,timeZone:t.timeZone,returnMeshObjectId:l,displayRefreshVersion:n},strategy:{type:"feature"},factory:a}}}function Ke(e,t){return e.fields.map((e=>({...e.toJSON(),type:Qe(e,t)})))}function Qe(e,t){const{onStatisticExpression:i,onStatisticField:n,statisticType:r}=e;switch(r){case"min":case"max":case"avg":case"avg_angle":case"sum":case"count":return"esriFieldTypeDouble";case"mode":{if(i){const{returnType:e}=i;return e?"string"===e?"esriFieldTypeString":"esriFieldTypeDouble":"esriFieldTypeString"}const e=t.find((e=>e.name===n));return e?e.type:"esriFieldTypeString"}}}function Je(e){return e.techniqueType===Y.N.AnimatedMarker}function et(e){if("simple"===e.type&&e.meshes.some(Je))return!0;if("interval"===e.type){if(e.intervals.some((e=>e.meshes.some(Je))))return!0;if(e.backgroundFill.some(Je))return!0}if("map"===e.type){if(e.map.some((e=>e.symbol.some(Je))))return!0;if(e.backgroundFill.some(Je))return!0}return!1}var tt=i(51008);class it{constructor(e){this.layer=e}getLabelingDeconflictionInfo(e){const t=this.layer,i=_e(t);return[{vvEvaluators:{0:ve(t.renderer)},deconflictionEnabled:i}]}async createServiceOptions(e){const t=this.layer,{capabilities:i,editingInfo:n,objectIdField:r,globalIdField:s,datesInUnknownTimezone:o,orderBy:a,parsedUrl:l}=t,u=t.fieldsIndex.toJSON(),c=ae(t),h=t.timeInfo?.toJSON(),d=t.spatialReference.toJSON(),f=(0,se.o8)(l);let p=r;if(a?.length){const e=!a[0].valueExpression&&a[0].field;e&&(p=e)}return{type:"feature-service",source:f,isSourceHosted:(0,oe.Wo)(f.path),orderByFields:p,outSpatialReference:e.spatialReference.toJSON(),metadata:{timeReferenceUnknownClient:o,globalIdField:s,fieldsIndex:u,geometryType:c,objectIdField:r,timeInfo:h,spatialReference:d,subtypeField:null,subtypes:null,typeIdField:null,types:null},queryMetadata:{maxRecordCount:i.query.maxRecordCount,supportsCompactGeometry:i.query.supportsCompactGeometry,supportsDefaultSpatialReference:i.query.supportsDefaultSpatialReference,supportsFormatPBF:i.query.supportsFormatPBF,supportsMaxRecordCountFactor:i.query.supportsMaxRecordCountFactor,supportsQuantization:i.query.supportsQuantization,lastEditDate:n?.lastEditDate?.getTime(),snapshotInfo:null}}}createSourceSchema(e,t){const{definitionExpression:i,customParameters:n,timeExtent:r,apiKey:s}=this.layer;return be({definitionExpression:i,customParameters:n,timeExtent:r},e,t,s)}createProcessorSchema(e,t,i){const{fields:n,geometryType:r,orderBy:s,objectIdField:o,renderer:a,labelingInfo:l,labelsVisible:u}=this.layer,c={featureReduction:null,fields:n.map((e=>e.toJSON())),geometryType:r,labelingInfo:l,labelsVisible:u,objectIdField:o,orderBy:s??"default",renderer:a?.clone()};return Xe(e,t,c,i)}get hasRequiredSupport(){return(0,tt.e)(this.layer.renderer)}get timeOptions(){return this.layer}getUpdateHashProperties(e){const t=this.layer,{definitionExpression:i,apiKey:n,renderer:r}=t,s=this.layer.labelsVisible?this.layer.labelingInfo:null,o=JSON.stringify(t.customParameters),a=JSON.stringify(t.orderBy);return{outFields:this.layer.outFields,apiKey:n,customParameters:o,definitionExpression:i,labelingInfo:s,orderBy:a,renderer:r}}setGraphicOrigin(e){e.origin={type:"catalog",layer:this.layer}}}function nt(e,t){const i=e.extent,n=t?.clone().intersection(i),r=null!=n?n.width*n.height:0,s=t?t.width*t.height:0,a=0===s?0:r/s,l=(0,o.A)("featurelayer-snapshot-point-coverage");return!isNaN(a)&&a>=l}function rt(e,t){return null!=e.floorInfo&&(e.floorInfo.viewAllLevelIds.length>0||t.floors.length>0)}function st(e,t,i){const n=function(e,t,i){if(null==e.floorInfo||!i.floors?.length)return t;let n=i.floors;const{floorField:r,viewAllLevelIds:s}=e.floorInfo;s.length&&(n=s);const o=n.filter((e=>""!==e)).map((e=>"'"+e+"'"));if(o.push("''"),t?.includes(r)){let e=new RegExp("AND \\("+r+".*NULL\\)","g");t=t.replace(e,""),e=new RegExp("\\("+r+".*NULL\\)","g"),t=(t=t.replace(e,"")).replaceAll(/\s+/g," ").trim()}let a="("+r+" IN ({ids}) OR "+r+" IS NULL)";return a=a.replace("{ids}",o.join(", ")),(0,xe.m)(t,a)}(e,t?.where,i);return n?(t??=new P.A,t.where=n,t):t}class ot{constructor(e){this.layer=e}getLabelingDeconflictionInfo(e){const t=this.layer,i=ge(t,e)??_e(t);return[{vvEvaluators:{0:ve(t.renderer)},deconflictionEnabled:i}]}async createServiceOptions(e){const t=this.layer,{capabilities:i,editingInfo:n,objectIdField:r,typeIdField:s,globalIdField:a,datesInUnknownTimezone:l,orderBy:u,subtypeField:c,refreshInterval:h}=t,d=t.fieldsIndex.toJSON(),f=ae(t),p=t.timeInfo?.toJSON(),m=t.spatialReference.toJSON(),_=t.types?.map((e=>e.toJSON())),g=(0,se.o8)(this.layer.parsedUrl);this.layer.dynamicDataSource&&(g.query={layer:JSON.stringify({source:this.layer.dynamicDataSource})});let y=this.layer.objectIdField;if(u?.length){const e=!u[0].valueExpression&&u[0].field;e&&(y=e)}const v=!(null!=n?.lastEditDate)&&h>0,x=!!(0,o.A)("featurelayer-snapshot-enabled")&&"point"===t.geometryType&&i?.query.supportsPagination&&!i?.operations.supportsEditing&&!v,b=x&&nt(e,t.fullExtent);return{type:"feature-service",source:g,isSourceHosted:(0,oe.Wo)(g.path),orderByFields:y,outSpatialReference:e.spatialReference.toJSON(),metadata:{typeIdField:s??void 0,types:_,timeReferenceUnknownClient:l,subtypeField:c,globalIdField:a,fieldsIndex:d,geometryType:f,objectIdField:r,timeInfo:p,spatialReference:m,subtypes:this.layer.subtypes?.map((e=>e.toJSON()))},queryMetadata:{maxRecordCount:i.query.maxRecordCount,supportsCompactGeometry:i.query.supportsCompactGeometry,supportsDefaultSpatialReference:i.query.supportsDefaultSpatialReference,supportsFormatPBF:i.query.supportsFormatPBF,supportsMaxRecordCountFactor:i.query.supportsMaxRecordCountFactor,supportsQuantization:i.query.supportsQuantization,lastEditDate:n?.lastEditDate?.getTime(),snapshotInfo:{supportsSnapshotMinThreshold:x,supportsSnapshotMaxThreshold:b,snapshotCountThresholds:{min:(0,o.A)("featurelayer-snapshot-point-min-threshold"),max:(0,o.A)("featurelayer-snapshot-point-max-threshold")}}}}}createSourceSchema(e,t){const{definitionExpression:i,customParameters:n,gdbVersion:r,historicMoment:s,subtypeCode:o,subtypeField:a,timeExtent:l,apiKey:u}=this.layer;return be({definitionExpression:i,customParameters:n,gdbVersion:r,historicMoment:s,subtypeCode:o,subtypeField:a,timeExtent:l},e,t,u)}createProcessorSchema(e,t,i){const{fields:n,renderer:r,geometryType:s,labelingInfo:o,labelsVisible:a,orderBy:l,objectIdField:u}=this.layer,c={fields:n.map((e=>e.toJSON())),renderer:r?.clone(),featureReduction:ue(this.layer,t),geometryType:s,labelingInfo:o,labelsVisible:a,objectIdField:u,orderBy:l??"default"};return Xe(e,t,c,i)}get hasRequiredSupport(){return(0,tt.e)(this.layer.renderer)}get timeOptions(){return this.layer}hasFilters(e){return rt(this.layer,e)}addFilters(e,t){return st(this.layer,e,t)}getUpdateHashProperties(e){const t=this.layer,{definitionExpression:i,renderer:n,gdbVersion:r,apiKey:s,subtypeCode:o}=t,a=this.layer.labelsVisible?this.layer.labelingInfo:null,l=t.historicMoment?.getTime()??void 0,u=JSON.stringify(t.customParameters),c=ue(t,e),h=JSON.stringify(t.orderBy),d=rt(this.layer,e)?e.floors:null;return{outFields:this.layer.outFields,apiKey:s,customParameters:u,definitionExpression:i,featureReduction:c,floors:d,gdbVersion:r,historicMoment:l,labelingInfo:a,orderBy:h,renderer:n,subtypeCode:o}}}class at{constructor(e){this.layer=e}getLabelingDeconflictionInfo(e){const t=this.layer,i=ge(t,e)??_e(t);return[{vvEvaluators:{0:ve(t.renderer)},deconflictionEnabled:i}]}async createServiceOptions(e){const t=this.layer,{capabilities:i,objectIdField:n}=t,r=t.fieldsIndex.toJSON(),s=ae(t),o=t.timeInfo?.toJSON(),a=t.spatialReference.toJSON();return function(e){if(!("openPorts"in e))throw new p.A("source-not-supported")}(t.source),{type:"memory",source:await t.source.openPorts(),orderByFields:n,outSpatialReference:e.spatialReference.toJSON(),metadata:{fieldsIndex:r,geometryType:s,objectIdField:n,timeInfo:o,spatialReference:a,subtypes:null,subtypeField:null,globalIdField:null,typeIdField:null,types:null,timeReferenceUnknownClient:null},queryMetadata:{maxRecordCount:i.query.maxRecordCount,supportsCompactGeometry:i.query.supportsCompactGeometry,supportsDefaultSpatialReference:i.query.supportsDefaultSpatialReference,supportsFormatPBF:i.query.supportsFormatPBF,supportsMaxRecordCountFactor:i.query.supportsMaxRecordCountFactor,supportsQuantization:i.query.supportsQuantization,lastEditDate:null,snapshotInfo:null}}}createSourceSchema(e,t){const{definitionExpression:i,timeExtent:n}=this.layer;return be({definitionExpression:i,timeExtent:n,customParameters:null},e,t,null)}createProcessorSchema(e,t,i){const{fields:n,renderer:r,geometryType:s,labelingInfo:o,labelsVisible:a,orderBy:l,objectIdField:u}=this.layer,c={fields:n.map((e=>e.toJSON())),renderer:r?.clone(),featureReduction:ue(this.layer,t),geometryType:s,labelingInfo:o,labelsVisible:a,objectIdField:u,orderBy:l??"default"};return Xe(e,t,c,i)}get hasRequiredSupport(){return(0,tt.e)(this.layer.renderer)}get timeOptions(){return this.layer}getUpdateHashProperties(e){const t=this.layer,{definitionExpression:i,renderer:n}=t,r=this.layer.labelsVisible?this.layer.labelingInfo:null,s=ue(t,e),o=JSON.stringify(t.orderBy);return{outFields:this.layer.outFields,orderBy:o,definitionExpression:i,renderer:n,labelingInfo:r,featureReduction:s}}}class lt{constructor(e){this.layer=e}getLabelingDeconflictionInfo(e){const t=this.layer,i=ge(t,e)??_e(t);return[{vvEvaluators:{0:ve(t.renderer)},deconflictionEnabled:i}]}async createServiceOptions(e){const t=this.layer,{capabilities:i,objectIdField:n}=t,r=t.fieldsIndex.toJSON(),s=ae(t),o=t.spatialReference.toJSON();return{type:"memory",source:await t.source.openPorts(),orderByFields:n,outSpatialReference:e.spatialReference.toJSON(),metadata:{fieldsIndex:r,geometryType:s,objectIdField:n,spatialReference:o,globalIdField:null,subtypeField:null,subtypes:null,timeInfo:t.timeInfo?.toJSON(),timeReferenceUnknownClient:null,typeIdField:null,types:null},queryMetadata:{maxRecordCount:i.query.maxRecordCount,supportsCompactGeometry:i.query.supportsCompactGeometry,supportsDefaultSpatialReference:i.query.supportsDefaultSpatialReference,supportsFormatPBF:i.query.supportsFormatPBF,supportsMaxRecordCountFactor:i.query.supportsMaxRecordCountFactor,supportsQuantization:i.query.supportsQuantization,lastEditDate:null,snapshotInfo:null}}}createSourceSchema(e,t){const{definitionExpression:i}=this.layer;return be({definitionExpression:i,customParameters:null},e,t,null)}createProcessorSchema(e,t,i){const{fields:n,renderer:r,geometryType:s,labelingInfo:o,labelsVisible:a,objectIdField:l}=this.layer;return Xe(e,t,{fields:n.map((e=>e.toJSON())),renderer:r?.clone(),featureReduction:ue(this.layer,t),geometryType:s,labelingInfo:o,labelsVisible:a,objectIdField:l,orderBy:"default"},i)}get hasRequiredSupport(){return(0,tt.e)(this.layer.renderer)}get timeOptions(){return this.layer}getUpdateHashProperties(e){const t=this.layer,{definitionExpression:i,renderer:n}=t;return{definitionExpression:i,renderer:n,labelingInfo:this.layer.labelsVisible?this.layer.labelingInfo:null,featureReduction:ue(t,e)}}}class ut{constructor(e){this.layer=e}getLabelingDeconflictionInfo(e){const t=this.layer,i=ge(t,e)??_e(t);return[{vvEvaluators:{0:ve(t.renderer)},deconflictionEnabled:i}]}async createServiceOptions(e){const t=this.layer,{capabilities:i,objectIdField:n}=t,r=t.fieldsIndex.toJSON(),s=ae(t),o=t.timeInfo?.toJSON(),a=t.spatialReference.toJSON(),l=t.source.getSource(),u=this.layer.objectIdField,c=(0,se.o8)(i);return c.query.maxRecordCount=l.maxRecordCount,{type:"ogc",source:l,orderByFields:u,outSpatialReference:e.spatialReference.toJSON(),metadata:{fieldsIndex:r,geometryType:s,objectIdField:n,timeInfo:o,spatialReference:a,globalIdField:null,subtypeField:null,subtypes:null,timeReferenceUnknownClient:null,typeIdField:null,types:null},queryMetadata:{maxRecordCount:c.query.maxRecordCount,supportsCompactGeometry:c.query.supportsCompactGeometry,supportsDefaultSpatialReference:c.query.supportsDefaultSpatialReference,supportsFormatPBF:c.query.supportsFormatPBF,supportsMaxRecordCountFactor:c.query.supportsMaxRecordCountFactor,supportsQuantization:c.query.supportsQuantization,lastEditDate:null,snapshotInfo:null}}}createSourceSchema(e,t){const{customParameters:i,timeExtent:n,apiKey:r}=this.layer;return be({customParameters:i,timeExtent:n},e,t,r)}createProcessorSchema(e,t,i){const{fields:n,renderer:r,geometryType:s,labelingInfo:o,labelsVisible:a,orderBy:l,objectIdField:u}=this.layer,c={fields:n.map((e=>e.toJSON())),renderer:r?.clone(),featureReduction:ue(this.layer,t),geometryType:s,labelingInfo:o,labelsVisible:a,objectIdField:u,orderBy:l??"default"};return Xe(e,t,c,i)}get hasRequiredSupport(){return(0,tt.e)(this.layer.renderer)}get timeOptions(){return this.layer}getUpdateHashProperties(e){const t=this.layer,{renderer:i,apiKey:n}=t,r=this.layer.labelsVisible?this.layer.labelingInfo:null;return{apiKey:n,customParameters:JSON.stringify(t.customParameters),featureReduction:ue(t,e),labelingInfo:r,orderBy:JSON.stringify(t.orderBy),renderer:i}}}class ct{constructor(e){this.layer=e}getLabelingDeconflictionInfo(e){const t=this.layer,i=ge(t,e)??_e(t);return[{vvEvaluators:{0:ve(t.renderer)},deconflictionEnabled:i}]}async createServiceOptions(e){const t=this.layer,{capabilities:i,objectIdField:n,globalIdField:r,orderBy:s,refreshInterval:a}=t,l=t.fieldsIndex.toJSON(),u=ae(t),c=t.timeInfo?.toJSON(),h=t.spatialReference.toJSON(),d=(0,se.o8)(this.layer.parsedUrl);let f=this.layer.objectIdField;if(s?.length){const e=!s[0].valueExpression&&s[0].field;e&&(f=e)}const p=a>0,m=!!(0,o.A)("featurelayer-snapshot-enabled")&&"point"===t.geometryType&&i?.query.supportsPagination&&!i?.operations.supportsEditing&&!p,_=m&&nt(e,t.fullExtent);return{type:"feature-service",source:d,isSourceHosted:(0,oe.Wo)(d.path),orderByFields:f,outSpatialReference:e.spatialReference.toJSON(),metadata:{globalIdField:r,fieldsIndex:l,geometryType:u,objectIdField:n,timeInfo:c,spatialReference:h,timeReferenceUnknownClient:!1,subtypeField:null,subtypes:null,typeIdField:null,types:null},queryMetadata:{maxRecordCount:i.query.maxRecordCount,supportsCompactGeometry:i.query.supportsCompactGeometry,supportsDefaultSpatialReference:i.query.supportsDefaultSpatialReference,supportsFormatPBF:i.query.supportsFormatPBF,supportsMaxRecordCountFactor:i.query.supportsMaxRecordCountFactor,supportsQuantization:i.query.supportsQuantization,lastEditDate:null,snapshotInfo:{supportsSnapshotMinThreshold:m,supportsSnapshotMaxThreshold:_,snapshotCountThresholds:{min:(0,o.A)("featurelayer-snapshot-point-min-threshold"),max:(0,o.A)("featurelayer-snapshot-point-max-threshold")}}}}}createSourceSchema(e,t){const{definitionExpression:i,customParameters:n,timeExtent:r}=this.layer;return be({definitionExpression:i,customParameters:n,timeExtent:r},e,t,null)}createProcessorSchema(e,t,i){const{fields:n,renderer:r,geometryType:s,labelingInfo:o,labelsVisible:a,orderBy:l,objectIdField:u}=this.layer,c={fields:n.map((e=>e.toJSON())),renderer:r?.clone(),featureReduction:ue(this.layer,t),geometryType:s,labelingInfo:o,labelsVisible:a,objectIdField:u,orderBy:l??"default"};return Xe(e,t,c,i)}get hasRequiredSupport(){return(0,tt.e)(this.layer.renderer)}get timeOptions(){return this.layer}hasFilters(e){return rt(this.layer,e)}addFilters(e,t){return st(this.layer,e,t)}getUpdateHashProperties(e){const t=this.layer,{definitionExpression:i,renderer:n,outFields:r}=t,s=this.layer.labelsVisible?this.layer.labelingInfo:null,o=JSON.stringify(t.customParameters),a=ue(t,e);return{outFields:r,orderBy:JSON.stringify(t.orderBy),definitionExpression:i,renderer:n,labelingInfo:s,featureReduction:a,customParameters:o,floors:rt(this.layer,e)?e.floors:null}}}class ht{constructor(e){this.layer=e}get hasRequiredSupport(){return(0,tt.e)(this.layer.renderer)}get timeOptions(){return null}getLabelingDeconflictionInfo(e){const t=this.layer,i=ge(t,e)??_e(t);return[{vvEvaluators:{0:ve(t.renderer)},deconflictionEnabled:i}]}getUpdateHashProperties(e){const t=this.layer,{renderer:i}=t,n=this.layer.labelsVisible?this.layer.labelingInfo:null,r=JSON.stringify(t.customParameters),s=ue(t,e),o=JSON.stringify(t.orderBy);return{outFields:this.layer.outFields,labelingInfo:n,featureReduction:s,customParameters:r,orderBy:o,renderer:i}}async createServiceOptions(e){const t=ae(this.layer);return{type:"parquet",source:{urls:this.layer.urls.items},outSpatialReference:e.spatialReference.toJSON(),geometryInfo:this.layer.source.geometryInfo,metadata:{spatialReference:this.layer.spatialReference,fieldsIndex:this.layer.fieldsIndex.toJSON(),objectIdField:this.layer.objectIdField,geometryType:t,types:null,subtypes:null,timeInfo:null,typeIdField:null,subtypeField:null,globalIdField:null,timeReferenceUnknownClient:null}}}createSourceSchema(e,t){return{type:"parquet",mutable:{sourceRefreshVersion:t,availableFields:e.availableFields,dataFilter:{customParameters:this.layer.customParameters??null}}}}createProcessorSchema(e,t,i){return Xe(e,t,{fields:this.layer.fields.map((e=>e.toJSON())),renderer:this.layer.renderer?.clone(),featureReduction:ue(this.layer,t),geometryType:this.layer.geometryType,labelingInfo:this.layer.labelingInfo,labelsVisible:this.layer.labelsVisible,objectIdField:this.layer.objectIdField,orderBy:this.layer.orderBy},i)}}class dt{constructor(e){this.layer=e}getLabelingDeconflictionInfo(e){const t=this.layer,i=ge(t,e)??_e(t);return[{vvEvaluators:{0:ve(t.renderer)},deconflictionEnabled:i}]}async createServiceOptions(e){const t=this.layer,{objectIdField:i}=t,n=ae(t),r=t.timeInfo?.toJSON()||null,s=t.spatialReference?t.spatialReference.toJSON():null;return{type:"stream",source:this.layer.parsedUrl,outSpatialReference:e.spatialReference.toJSON(),metadata:{fieldsIndex:this.layer.fieldsIndex.toJSON(),geometryType:n,objectIdField:i,timeInfo:r,timeReferenceUnknownClient:null,spatialReference:s,subtypeField:null,subtypes:null,globalIdField:null,typeIdField:null,types:null}}}createSourceSchema(e,t){const{definitionExpression:i,geometryDefinition:n,customParameters:r}=this.layer;return{type:"stream",mutable:{sourceRefreshVersion:t,availableFields:e.availableFields,dataFilter:{geometryDefinition:n?.toJSON(),definitionExpression:i,customParameters:r??null,maxReconnectionAttempts:this.layer.maxReconnectionAttempts,maxReconnectionInterval:this.layer.maxReconnectionInterval,purgeOptions:this.layer.purgeOptions.toJSON()}}}}createProcessorSchema(e,t,i){const{fields:n,renderer:r,geometryType:s,labelingInfo:o,labelsVisible:a,objectIdField:l}=this.layer;return Xe(e,t,{fields:n.map((e=>e.toJSON())),renderer:r?.clone(),featureReduction:ue(this.layer,t),geometryType:s,labelingInfo:o,labelsVisible:a,objectIdField:l,orderBy:"default"},i)}get hasRequiredSupport(){return(0,tt.e)(this.layer.renderer)}get timeOptions(){return this.layer}getUpdateHashProperties(e){const t=this.layer,{definitionExpression:i,renderer:n}=t,r=this.layer.labelsVisible?this.layer.labelingInfo:null,s=JSON.stringify(t.customParameters);return{definitionExpression:i,renderer:n,labelingInfo:r,featureReduction:ue(t,e),customParameters:s,geometryDefinition:t.geometryDefinition,definitionExpressoin:t.definitionExpression}}}var ft=i(2746);async function pt(e,{subtypeField:t,sublayers:i}){const n=await Promise.all(i.map((({renderer:t})=>We(e,t))));return{type:"subtype",subtypeField:t,renderers:i.reduce(((e,{subtypeCode:t},i)=>({...e,[t]:n[i]})),{})}}function mt(e,t){const i=(0,ft.C)();return{type:"subtype",filters:e.filters,capabilities:{maxTextureSize:i.maxTextureSize},subtypeField:t.subtypeField,target:"feature",bindings:t.sublayers.reduce(((e,{renderer:t,subtypeCode:i})=>{const n=(0,je.Jz)(t);return{...e,[i]:n}}),{})}}async function _t(e,{subtypeField:t,sublayers:i}){const n=await Promise.all(i.map((t=>{const i=(0,Oe.K4)(t.renderer),n={...t,geometryType:t.geometryType??null};return $e(e,n,i)})));return{type:"subtype",subtypeField:t,renderers:i.reduce(((e,{subtypeCode:t},i)=>({...e,[t]:n[i]})),{})}}class gt{constructor(e){this.layer=e}getLabelingDeconflictionInfo(e){return[{vvEvaluators:{},deconflictionEnabled:this.layer.sublayers.every((e=>_e(e)))}]}async createServiceOptions(e){const t=this.layer,{capabilities:i,datesInUnknownTimezone:n,editingInfo:r,globalIdField:s,objectIdField:a,refreshInterval:l,subtypeField:u}=t,c=t.fieldsIndex.toJSON(),h=ae(t),d=t.timeInfo?.toJSON(),f=t.spatialReference.toJSON(),p=(0,se.o8)(this.layer.parsedUrl),m=a,_=!(null!=r?.lastEditDate)&&l>0,g=!!(0,o.A)("featurelayer-snapshot-enabled")&&"point"===t.geometryType&&i?.query.supportsPagination&&!i?.operations.supportsEditing&&!_,y=g&&nt(e,t.fullExtent);return{type:"feature-service",source:p,isSourceHosted:(0,oe.Wo)(p.path),orderByFields:m,outSpatialReference:e.spatialReference.toJSON(),metadata:{timeReferenceUnknownClient:n,subtypeField:u,globalIdField:s,fieldsIndex:c,geometryType:h,objectIdField:a,timeInfo:d,spatialReference:f,subtypes:this.layer.subtypes?.map((e=>e.toJSON())),typeIdField:null,types:null},queryMetadata:{maxRecordCount:i.query.maxRecordCount,supportsCompactGeometry:i.query.supportsCompactGeometry,supportsDefaultSpatialReference:i.query.supportsDefaultSpatialReference,supportsFormatPBF:i.query.supportsFormatPBF,supportsMaxRecordCountFactor:i.query.supportsMaxRecordCountFactor,supportsQuantization:i.query.supportsQuantization,lastEditDate:r?.lastEditDate?.getTime(),snapshotInfo:{supportsSnapshotMinThreshold:g,supportsSnapshotMaxThreshold:y,snapshotCountThresholds:{min:(0,o.A)("featurelayer-snapshot-point-min-threshold"),max:(0,o.A)("featurelayer-snapshot-point-max-threshold")}}}}}createSourceSchema(e,t){const{definitionExpression:i,customParameters:n,gdbVersion:r,historicMoment:s,subtypeField:o,timeExtent:a,apiKey:l}=this.layer,u={queryScaleRanges:this.layer.sublayers.items.map((e=>({subtypeCode:e.subtypeCode,minScale:e.minScale,maxScale:e.maxScale}))),definitionExpression:i,customParameters:n,gdbVersion:r,historicMoment:s,subtypeField:o,timeExtent:a};return be(u,e,t,l)}createProcessorSchema(e,t,i){const n={subtypeField:this.layer.subtypeField,sublayers:Array.from(this.layer.sublayers,(e=>({featureReduction:null,geometryType:this.layer.geometryType,labelingInfo:e.labelingInfo,labelsVisible:e.labelsVisible,renderer:e.renderer,subtypeCode:e.subtypeCode,orderBy:null})))};return async function(e,t,i,n){return{storage:mt(t,i),mesh:{properties:{timeZone:t.timeZone,displayRefreshVersion:n,returnMeshObjectId:!1,sortKey:null},strategy:{type:"feature"},factory:{symbology:await pt(e,i),labels:await _t(e,i)}}}}(e,t,n,i)}hasFilters(e){return rt(this.layer,e)||function(e,t){return e.sublayers.some((e=>!yt(e,t)))}(this.layer,e)}addFilters(e,t){e=st(this.layer,e,t);const i=this.layer.sublayers.filter((e=>!yt(e,t))).map((e=>e.subtypeCode));if(!i.length)return e;e??=new P.A;const n=`NOT ${this.layer.subtypeField} IN (${i.join(",")})`;return e.where=(0,xe.m)(e.where,n),e}get hasRequiredSupport(){return!0}get timeOptions(){return this.layer}getUpdateHashProperties(e){const t=this.layer,{definitionExpression:i,gdbVersion:n,apiKey:r}=t,s=t.historicMoment?.getTime()??void 0,o=JSON.stringify(t.customParameters),a=rt(this.layer,e)?e.floors:null,l=this.layer.sublayers.map((({renderer:e,labelsVisible:t,labelingInfo:i,visible:n})=>({renderer:e,labelsVisible:t,labelingInfo:i,visible:n})));return{outFields:this.layer.outFields,gdbVersion:n,definitionExpression:i,historicMoment:s,customParameters:o,apiKey:r,sublayers:l,floors:a}}setGraphicOrigin(e){const t=this.layer.fieldsIndex.get(this.layer.subtypeField),i=e.attributes[t.name],n=this.layer.sublayers.find((e=>e.subtypeCode===i));e.layer=e.sourceLayer=n}}function yt(e,t){return e.visible&&(0===e.minScale||(0,ce.Sp)(t.scale,e.minScale)||t.scale<e.minScale)&&(0===e.maxScale||(0,ce.Sp)(t.scale,e.maxScale)||t.scale>e.maxScale)}var vt=i(21884),xt=i(16541),bt=i(89872);function St(e,t){const i=new Set;for(const n of e instanceof Set?e.values():e.keys())t.has(n)||i.add(n);return i}class wt{constructor(e,t,i){const n=i?e.getTileCoverage(i,0,!0,"closest"):null,r=e.getTileCoverage(t,0,!0,"closest");if(this._tileKeys=new Map,n)for(const e of n.keys())this._tileKeys.set(e.id,e);if(r)for(const e of r.keys())this._tileKeys.set(e.id,e)}get coverageSet(){return new Set(this._tileKeys.keys())}keys(){return this._tileKeys.values()}}class Tt{constructor(e){this.version=e}}class Pt{constructor(e){this._subscriptions=new Map,this._visible=new Set,this._paused=new Set,this._version=0,this._config=e}destroy(){}get _coverageSet(){return this._coverage?.coverageSet??new Set}suspend(){this._suspendedOverage=this._coverage,this._coverage=null,this._updateSubscriptions()}resume(){null==this._coverage&&(this._coverage=this._suspendedOverage,this._suspendedOverage=null,this._updateSubscriptions())}update(e,t){return this._version=(this._version+1)%Number.MAX_SAFE_INTEGER,this._updateCoverage(e,t),this._updateSubscriptions(),new Set(this._visible)}_updateCoverage(e,t){this._coverage=new wt(this._config.tileInfoView,e,t)}_updateSubscriptions(){const e=this._coverageSet,t=this._updateVisibility(),i=St(t,e),n=St(this._subscriptions,t),r=St(e,this._subscriptions),s=St(n,e),o=St(i,s),a=St(o,this._paused);this._visible=t;for(const e of r.values())this._subscriptions.set(e,new Tt(this._version));for(const e of a.values())this._paused.add(e);for(const e of s.values())this._subscriptions.delete(e),this._paused.delete(e);(r.size||s.size||a.size)&&this._sendUpdateSubscriptions(r,s,a)}_sendUpdateSubscriptions(e,t,i){const n=Array.from(e.values()).map((e=>({tileId:e,version:this._subscriptions.get(e).version})));this._config.updateSubscriptions({subscribe:n,unsubscribe:Array.from(t.values()),pause:Array.from(i.values())})}_updateVisibility(){const e=new Set,t=new Set;if(!this._coverage)return e;for(const i of this._coverage.keys())this._config.isDone(i)?e.add(i.id):this._addVisibleParent(e,t,i)||this._addVisibleChildren(e,i)||e.add(i.id);const i=new $.A(0,0,0,0),n=new $.A(0,0,0,0);for(const r of t){i.id=r;for(const t of e)n.id=t,i.containsChild(n)&&e.delete(t)}return e}_addVisibleParent(e,t,i){let n=!1;for(const r of this._visible.values())new $.A(r).containsChild(i)&&(e.add(r),t.add(r),n=!0);return n}_addVisibleChildren(e,t){let i=!1;for(const n of this._visible.values()){const r=new $.A(n);t.containsChild(r)&&(e.add(n),i=!0)}return i}}var It=i(71843),Mt=i(45991),At=i(54547),Ct=i(28088);const Et=e=>{let t=class extends e{constructor(...e){super(...e),this._updatingRequiredFieldsPromise=null,this.dataUpdating=!1,this.filter=null,this.layer=null,this.requiredFields=[],this.view=null}initialize(){this.addHandles([(0,v.watch)((()=>{const e=this.layer;return[e&&"elevationInfo"in e?e.elevationInfo?.featureExpressionInfo:null,e&&"displayField"in e?e.displayField:null,e&&"timeInfo"in e&&e.timeInfo,e&&"renderer"in e&&e.renderer,e&&"labelingInfo"in e&&e.labelingInfo,e&&"floorInfo"in e&&e.floorInfo,this.filter,this.featureEffect,this.timeExtent]}),(()=>this._handleRequiredFieldsChange()),v.pc),(0,v.on)((()=>this.view?.floors),"change",(()=>this._handleRequiredFieldsChange())),(0,v.on)((()=>{const e=this.layer;return e&&"sublayers"in e?e.sublayers:null}),"change",(()=>this._handleRequiredFieldsChange()))])}get availableFields(){if(!this.layer)return[];const{layer:e,layer:{fieldsIndex:t},requiredFields:i}=this;return"outFields"in e&&e.outFields?(0,I.DB)(t,[...(0,I.hL)(t,e.outFields),...i]):(0,I.DB)(t,i)}get featureEffect(){return this.layer&&"featureEffect"in this.layer?this.layer.featureEffect:null}set featureEffect(e){this._override("featureEffect",e)}get maximumNumberOfFeatures(){return 0}set maximumNumberOfFeatures(e){a.A.getLogger(this).error("#maximumNumberOfFeatures=","Setting maximum number of features is not supported")}get maximumNumberOfFeaturesExceeded(){return!1}highlight(e){throw new Error("missing implementation")}createQuery(){const e={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference},t=null!=this.filter?this.filter.createQuery(e):new F.A(e);if("floorInfo"in this.layer&&this.layer.floorInfo){const e=(0,Mt.E)(this);null!=e&&(t.where=t.where?`(${t.where}) AND (${e})`:e)}return null!=this.timeExtent&&(t.timeExtent=null!=t.timeExtent?t.timeExtent.intersection(this.timeExtent):this.timeExtent.clone()),t}createAggregateQuery(){const e={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};return new F.A(e)}queryFeatures(e,t){throw new Error("missing implementation")}queryObjectIds(e,t){throw new Error("missing implementation")}queryFeatureCount(e,t){throw new Error("missing implementation")}queryExtent(e,t){throw new Error("missing implementation")}async fetchPopupFeaturesFromGraphics(e,t){return this._validateFetchPopupFeatures(e,t),this._fetchPopupFeatures(e,t)}_loadArcadeModules(e){return e.expressionInfos?.length||Array.isArray(e.content)&&e.content.some((e=>"expression"===e.type))?(0,At.lw)():Promise.resolve()}_handleRequiredFieldsChange(){const e=this._updateRequiredFields();this._set("_updatingRequiredFieldsPromise",e),e.then((()=>{this._updatingRequiredFieldsPromise===e&&this._set("_updatingRequiredFieldsPromise",null)}))}async _updateRequiredFields(){if(!this.layer||!this.view)return;const e="3d"===this.view.type,{layer:t,layer:{fieldsIndex:i,objectIdField:n}}=this,r="renderer"in t&&t.renderer,s="orderBy"in t&&t.orderBy,o="featureReduction"in t?t.featureReduction:null,l=new Set,u=await Promise.allSettled([r?r.collectRequiredFields(l,i):null,(0,I.Im)(l,t),e&&"elevationInfo"in t?(0,I.NO)(l,t):null,null!=this.filter?(0,I.o)(l,t,this.filter):null,e||null==this.featureEffect?null:(0,I.o)(l,t,this.featureEffect.filter),!e&&o?(0,I.RP)(l,t,o):null,!e&&s?(0,I.f)(l,t,s):null]);if("timeInfo"in t&&t.timeInfo&&this.timeExtent&&(0,I._w)(l,t.fieldsIndex,[t.timeInfo.startField,t.timeInfo.endField]),"floorInfo"in t&&t.floorInfo&&(0,I._w)(l,t.fieldsIndex,[t.floorInfo.floorField]),"feature"===t.type&&e&&null!=t.infoFor3D&&(null==t.globalIdField&&a.A.getLogger(this).error("globalIdField missing on 3DObjectFeatureLayer"),(0,I._w)(l,t.fieldsIndex,[t.globalIdField])),"subtype-group"===t.type){(0,I.rq)(l,i,t.subtypeField);const e=t.sublayers.map((e=>Promise.all([e.renderer?.collectRequiredFields(l,i),(0,I.Im)(l,e)])));await Promise.allSettled(e)}if("catalog-footprint"===t.type&&t.parent){const e=t.parent;(0,I._w)(l,i,[e.itemNameField,e.itemSourceField,e.itemTypeField,e.maxScaleField,e.minScaleField])}for(const e of u)"rejected"===e.status&&a.A.getLogger(this).error(e.reason);(0,I.rq)(l,i,n),e&&"displayField"in t&&t.displayField&&(0,I.rq)(l,i,t.displayField);const c=Array.from(l).sort();this._set("requiredFields",c)}_validateFetchPopupFeatures(e,t){if(null!=t)for(const i of e){const e=i.origin&&"layer"in i.origin?i.origin.layer:i.layer;if("popupEnabled"in e&&!e.popupEnabled)throw new p.A("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:e});if(i.isAggregate){const t="featureReduction"in e?e.featureReduction:null;if(!(t&&"popupTemplate"in t&&t.popupEnabled&&t.popupTemplate))throw new p.A("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:e})}else if("popupTemplate"in e&&!(0,Ct.D8)(e,t))throw new p.A("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:e})}}_popupFeatureHasRequiredFields(e,t){return(0,I.Kl)(t,e)}async _fetchPopupFeatures(e,t){const i=new Array(e.length),n=new Map,r=await this._createPopupQuery(e.map((e=>e.origin?.layer??e.layer)),t);for(let s=0;s<e.length;s++){const o=e[s];if(o.isAggregate){i[s]=o;continue}const a=o.origin?.layer??o.layer;if(!a||!("popupEnabled"in a))continue;const l=(0,I.hL)(this.layer.fieldsIndex,r.outFields),u=(0,Ct.D8)(a,t);if(null==u)continue;const c=await this._loadArcadeModules(u);(0,y.Te)(t),c&&c.arcadeUtils.hasGeometryOperations(u)||!this._popupFeatureHasRequiredFields(o,l)?n.set(o.getObjectId(),{graphic:o,index:s}):i[s]=o}if("stream"===this.layer.type||"parquet"===this.layer.type||0===n.size)return i.filter(Boolean);r.objectIds=Array.from(n.keys());try{const e=await this.layer.queryFeatures(r,t);for(const t of e.features){const{graphic:{geometry:e,origin:r},index:s}=n.get(t.getObjectId());t.geometry||=e,t.origin=r,i[s]=t}}catch{}return i.filter(Boolean)}async _createPopupQuery(e,t){const i=this.layer.createQuery(),n=new Set;let r=!1;const s=e??[this.layer];for(const e of s){if(!("popupEnabled"in e))continue;const i=(0,Ct.D8)(e,t);if(null==i)continue;const s=await this._loadArcadeModules(i);(0,y.Te)(t);const o=s&&s.arcadeUtils.hasGeometryOperations(i);r=!("point"!==this.layer.geometryType&&!o);const a=await(0,Ct.TO)(this.layer,i);(0,y.Te)(t);for(const e of a)n.add(e)}if(i.returnGeometry=r,i.returnZ=r,i.returnM=r,i.outFields=Array.from(n),i.outSpatialReference=this.view.spatialReference,"floorInfo"in this.layer&&this.layer.floorInfo){const e=(0,Mt.E)(this);null!=e&&(i.where=i.where?`(${i.where}) AND (${e})`:e)}return i}canResume(){return!(!super.canResume()||null!=this.timeExtent&&this.timeExtent.isEmpty)}getTest(){}get test(){}};return(0,n._)([(0,s.MZ)()],t.prototype,"_updatingRequiredFieldsPromise",void 0),(0,n._)([(0,s.MZ)({readOnly:!0})],t.prototype,"availableFields",null),(0,n._)([(0,s.MZ)({readOnly:!0})],t.prototype,"dataUpdating",void 0),(0,n._)([(0,s.MZ)({type:It.A})],t.prototype,"featureEffect",null),(0,n._)([(0,s.MZ)({type:P.A})],t.prototype,"filter",void 0),(0,n._)([(0,s.MZ)()],t.prototype,"layer",void 0),(0,n._)([(0,s.MZ)({type:Number})],t.prototype,"maximumNumberOfFeatures",null),(0,n._)([(0,s.MZ)({readOnly:!0,type:Boolean})],t.prototype,"maximumNumberOfFeaturesExceeded",null),(0,n._)([(0,s.MZ)({readOnly:!0})],t.prototype,"requiredFields",void 0),(0,n._)([(0,s.MZ)()],t.prototype,"suspended",void 0),(0,n._)([(0,s.MZ)()],t.prototype,"view",void 0),t=(0,n._)([(0,l.$)("esri.views.layers.FeatureLayerView")],t),t};var Rt=i(58251),Ot=i(58374),zt=i(91484);const Ft=4294967294;let Vt=class extends(Et((0,Ot.A)((0,V.e)(Rt.A)))){constructor(){super(...arguments),this._commandsQueue=new vt.A({process:e=>{switch(e.type){case"edit-by-feature":case"edit-by-id":return this._doEdit(e);case"update":return this._doUpdate();case"highlight":return this._updateHighlights()}}}),this._visibilityOverrides=new Set,this._highlightCounter=new bt.t,this._lastAvailableFields=[],this._lastTargetState=null,this.eventLog=new re,this._sourceRefreshVersion=1,this._displayRefreshVersion=1,this._pipelineUpdating=!1,this._fields=null,this.featureEffectView=new w}destroy(){this._workerProxy?.destroy(),this._workerAttached.reject((0,y.NK)()),this._commandsQueue.destroy()}initialize(){this._workerAttached=(0,y.Tw)(),(0,y.QZ)(this._workerAttached.promise),this.addResolvingPromise(this._initProxy()),this.featureEffectView.featureEffect=this.featureEffect,this.featureEffectView.endTransition()}async _initProxy(){const e=this.layer;if("isTable"in e&&e.isTable)throw new p.A("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:e});if("mesh"===e.geometryType)throw new p.A("featurelayerview:geometry-type-not-supported",`Geometry type of ${e.geometryType} is not supported`,{layer:e});if(("feature"===e.type||"subtype-group"===e.type)&&!1===(0,M.BR)(e)?.operations.supportsQuery)throw new p.A("featurelayerview:query-not-supported","layer view requires a layer with query capability",{layer:e});this._workerProxy&&this._workerProxy.destroy();const t=this._createClientOptions();this._workerProxy=await async function(e){const t=await(0,ee.ho)("FeaturePipelineWorker",{client:e,strategy:"dedicated"});return new te(t)}(t)}async _attachProxy(){const e={service:await this.layerAdapter.createServiceOptions(this.view),tileInfoJSON:this.view?.featuresTilingScheme?.tileInfo?.toJSON()};let t=[];Array.isArray(e.service.source)&&(t=e.service.source);try{await this._workerProxy.pipeline.onAttach(e,{transferList:t}),this._workerAttached.resolve()}catch(e){this._workerAttached.reject((0,y.NK)()),(0,y.jH)(e)}}async _detachProxy(){return this._workerProxy.pipeline.onDetach()}async getWorker(){return await this._workerAttached.promise,this._workerProxy}get hasAllFeatures(){return this.layer.visible&&!this.suspended&&this.eventLog.hasAllFeatures}get hasAllFeaturesInView(){return this.layer.visible&&!this.suspended&&this.eventLog.hasAllFeaturesInView}get hasFullGeometries(){return this.layer.visible&&!this.suspended&&this.eventLog.hasFullGeometries}get labelingCollisionInfos(){const e=this.layerAdapter.getLabelingDeconflictionInfo(this.view),t=this.layer.geometryType,i=!this.suspended;return e.map((({vvEvaluators:e,deconflictionEnabled:n})=>({container:this.featureContainer,vvEvaluators:e,deconflictionEnabled:n,geometryType:t,visible:i})))}get layerAdapter(){switch(this.layer.type){case"feature":return"memory"===this.layer.source.type?new at(this.layer):new ot(this.layer);case"geojson":case"csv":case"wfs":return new at(this.layer);case"parquet":return new ht(this.layer);case"subtype-group":return new gt(this.layer);case"ogc-feature":return new ut(this.layer);case"stream":return new dt(this.layer);case"oriented-imagery":return new ct(this.layer);case"knowledge-graph-sublayer":return new lt(this.layer);case"catalog-footprint":return new it(this.layer);default:(0,f.Xb)(this.layer)}return null}get timeExtent(){return(0,A.F)(this.layerAdapter.timeOptions,this.view?.timeExtent,this._get("timeExtent"))}getDisplayStatistics(e,t){return this.featureContainer?.getDisplayStatistics(e,t)}async queryHeatmapStatistics(e){return(await this.getWorker()).pipeline.queryHeatmapStatistics(e)}highlight(e,t="default"){let i;e instanceof r.default?i=[e.getObjectId()]:"number"==typeof e||"string"==typeof e?i=[e]:d.A.isCollection(e)&&e.length>0?i=e.map((e=>e?.getObjectId())).toArray():Array.isArray(e)&&e.length>0&&(i="number"==typeof e[0]||"string"==typeof e[0]?e:e.map((e=>e?.getObjectId())));const n=i?.filter(h.Ru);return n?.length?(this._addHighlights(n,t),(0,m.hA)((()=>this._removeHighlights(n,t)))):(0,m.hA)()}getHighlightIds(){return Array.from(this._highlightCounter.ids())}hasHighlight(){return!this._highlightCounter.empty}async hitTest(e,t){const i=await this.featureContainer.hitTest(t);if(0===i.length)return null;const n=await this.getWorker(),{features:s,aggregates:o}=await n.pipeline.getDisplayFeatures(i),a=this.featureContainer.getSortKeys(i),l=({displayId:e},{displayId:t})=>a.has(e)&&a.has(t)?a.get(e)-a.get(t):e-t;return s.sort(l).reverse(),o.sort(l).reverse(),[...o.map((t=>this._createGraphicHit(e,c.fromJSON(t)))),...s.map((t=>this._createGraphicHit(e,r.default.fromJSON(t))))]}async queryStatistics(){const e=await this.getWorker();return(0,xt.E)(e.pipeline.queryStatistics(),{featureCount:0,ringCount:0,vertexCount:0})}async querySummaryStatistics(e,t,i){const n=await this.getWorker(),r={...t,scale:this.view.scale},s=n.features.executeQueryForSummaryStatistics(this._cleanUpQuery(e),r,i);return(0,xt.E)(s,{})}async queryAggregateSummaryStatistics(e,t,i){const n={...t,scale:this.view.scale},r=(await this.getWorker()).aggregates.executeQueryForSummaryStatistics(this._cleanUpAggregateQuery(e),n,i);return(0,xt.E)(r,{})}async queryUniqueValues(e,t,i){const n=await this.getWorker(),r={...t,scale:this.view.scale},s=n.features.executeQueryForUniqueValues(this._cleanUpQuery(e),r,i);return(0,xt.E)(s,{uniqueValueInfos:[]})}async queryAggregateUniqueValues(e,t,i){const n=await this.getWorker(),r={...t,scale:this.view.scale},s=n.aggregates.executeQueryForUniqueValues(this._cleanUpAggregateQuery(e),r,i);return(0,xt.E)(s,{uniqueValueInfos:[]})}async queryClassBreaks(e,t,i){const n=await this.getWorker(),r={...t,scale:this.view.scale},s=n.features.executeQueryForClassBreaks(this._cleanUpQuery(e),r,i);return(0,xt.E)(s,{classBreakInfos:[]})}async queryAggregateClassBreaks(e,t,i){const n=await this.getWorker(),r={...t,scale:this.view.scale},s=n.aggregates.executeQueryForClassBreaks(this._cleanUpAggregateQuery(e),r,i);return(0,xt.E)(s,{classBreakInfos:[]})}async queryHistogram(e,t,i){const n=await this.getWorker(),r={...t,scale:this.view.scale},s=n.features.executeQueryForHistogram(this._cleanUpQuery(e),r,i);return(0,xt.E)(s,{bins:[],maxValue:null,minValue:null,normalizationTotal:null})}async queryAggregateHistogram(e,t,i){const n=await this.getWorker(),r={...t,scale:this.view.scale},s=n.aggregates.executeQueryForHistogram(this._cleanUpAggregateQuery(e),r,i);return(0,xt.E)(s,{bins:[],maxValue:null,minValue:null,normalizationTotal:null})}queryFeatures(e,t){return this.queryFeaturesJSON(e,t).then((e=>{const t=E.A.fromJSON(e);return t.features.forEach((e=>this._setLayersForFeature(e))),t}))}async queryVisibleFeatures(e,t){const i=(await this.getWorker()).pipeline.queryVisibleFeatures(this._cleanUpQuery(e),t),n=await(0,xt.E)(i,{features:[]}),r=E.A.fromJSON(n);return r.features.forEach((e=>this._setLayersForFeature(e))),r}async queryAggregates(e,t){const i=(await this.getWorker()).aggregates.executeQuery(this._cleanUpAggregateQuery(e),t),n=await(0,xt.E)(i,{features:[]}),r=z.fromJSON(n);return r.features.forEach((e=>this._setLayersForFeature(e))),r}async queryAggregateIds(e,t){const i=(await this.getWorker()).aggregates.executeQueryForIds(this._cleanUpAggregateQuery(e),t);return(0,xt.E)(i,[])}async queryAggregateCount(e,t){const i=(await this.getWorker()).aggregates.executeQueryForCount(this._cleanUpAggregateQuery(e),t);return(0,xt.E)(i,0)}async queryAggregateJSON(e,t){const i=(await this.getWorker()).aggregates.executeQuery(this._cleanUpAggregateQuery(e),t);return(0,xt.E)(i,{features:[]})}async queryFeaturesJSON(e,t){const i=(await this.getWorker()).features.executeQuery(this._cleanUpQuery(e),t);return(0,xt.E)(i,{features:[]})}async queryObjectIds(e,t){const i=(await this.getWorker()).features.executeQueryForIds(this._cleanUpQuery(e),t);return(0,xt.E)(i,[])}async queryFeatureCount(e,t){const i=(await this.getWorker()).features.executeQueryForCount(this._cleanUpQuery(e),t);return(0,xt.E)(i,0)}async queryExtent(e,t){const i=(await this.getWorker()).features.executeQueryForExtent(this._cleanUpQuery(e),t),n=await(0,xt.E)(i,{count:0,extent:null});return{count:n.count,extent:zt.default.fromJSON(n.extent)}}async getSampleFeatures(e){return(await this.getWorker()).pipeline.getSampleFeatures(e)}setVisibility(e,t){t?this._visibilityOverrides.delete(e):this._visibilityOverrides.add(e),this._update()}update(e){if(!this._subscriptionManager)return;this.view.animation&&!this._lastTargetState&&(this._lastTargetState=e.state.clone()),!this.view.animation&&this._lastTargetState&&(this._lastTargetState=null);const t=this._subscriptionManager.update(e.targetState,this._lastTargetState);this.featureContainer.setVisibleTiles(t)}attach(){(0,o.A)("esri-2d-update-debug")&&console.debug("FeatureLayerView2D.attach"),(0,y.QZ)(this._updatingHandles.addPromise(this._workerAttached.promise)),(0,y.QZ)(this._attachProxy()),this.featureContainer=new Q(this),this.container.addChild(this.featureContainer),this.view.timeline.record(`${this.layer.title} (FeatureLayer) Attach`),this._subscriptionManager=new Pt({tileInfoView:this.view.featuresTilingScheme,updateSubscriptions:e=>{this.featureContainer.updateSubscriptions(e),(0,y.QZ)(this._updatingHandles.addPromise(this.getWorker().then((t=>t.pipeline.updateSubscriptions(e)))))},isDone:e=>this.featureContainer.isDone(e)}),this.requestUpdate(),this.addAttachHandles([(0,v.watch)((()=>JSON.stringify({displayRefreshVersion:this._displayRefreshVersion,timeExtent:this.timeExtent,clips:this.clips,filter:this.filter,featureEffect:this.featureEffect,sourceRefreshVersion:this._sourceRefreshVersion,timeZone:this.view.timeZone,effect:this.featureEffect,...this.layerAdapter.getUpdateHashProperties(this.view)})),(()=>this._update()),v.Vh),(0,v.watch)((()=>this.updateSuspended),(e=>{e||(this._subscriptionManager.resume(),this.view.labelManager.requestUpdate())})),(0,v.watch)((()=>this.visible),(e=>{this.view.labelManager.requestUpdate()}))]),"stream"!==this.layer.type&&"parquet"!==this.layer.type&&"catalog-footprint"!==this.layer.type&&this.addAttachHandles(this.layer.on("edits",(e=>this._edit(e))))}detach(){(0,o.A)("esri-2d-update-debug")&&console.debug("FeatureLayerView2D.detach"),this._detachProxy(),this._fields=null,this.featureContainer.destroy(),this.featureContainer=null,this._commandsQueue.clear(),this.container.removeAllChildren(),this._subscriptionManager=(0,_.pR)(this._subscriptionManager),this._workerProxy.pipeline.onDetach(),this._workerAttached=(0,y.Tw)(),(0,y.QZ)(this._workerAttached.promise),this._lastAvailableFields=[],this._lastSchema=null}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}isUpdating(){const e="renderer"in this.layer&&null!=this.layer.renderer,t=this._commandsQueue.updateTracking.updating,i=null!=this._updatingRequiredFieldsPromise,n=this.featureContainer.updatingHandles.updating,r=this.updateRequested||e&&(t||i)||n||this._pipelineUpdating||this.dataUpdating;if((0,o.A)("esri-2d-log-updating")){console.log(`Updating FLV2D (${this.layer.id}): ${r}\n  -> updateRequested ${this.updateRequested}\n  -> hasRenderer ${e}\n  -> updatingRequiredFields ${i}\n  -> hasPendingCommand ${t}\n  -> dataUpdating ${this.dataUpdating}\n  -> processing ${this._pipelineUpdating}\n  -> updatingContainer ${n}\n`);for(const e of this.featureContainer.subscriptions())console.log(`    -> Tile[${e.id}] Done: ${e.done}`)}return r}_createClientOptions(){const e=this;return{get container(){return e.featureContainer},setUpdating:e=>{this._set("_pipelineUpdating",e.pipeline),this._set("dataUpdating",e.data)},emitEvent:e=>{this.emit(e.name,e.event)},get eventLog(){return e.eventLog},fetch:t=>Promise.all(t.map((t=>e.view.stage.painter.textureManager.rasterizeItem(t)))),fetchDictionary:e=>Promise.all(e.map((e=>this._fetchDictionaryRequest(e))))}}async _fetchDictionaryRequest(e){try{if("subtype-group"===this.layer.type)throw new Error("InternalError: SubtypeGroupLayer does not support dictionary renderer");const t=this.layer.renderer;if(!t||"dictionary"!==t.type)throw new Error("InternalError: Expected layer to have a DictionaryRenderer");const i=this._lastSchema.processor.mesh.factory.symbology;if("dictionary"!==i.type)throw new Error("InternalError: Expected schema to be of type 'dictionary'");const n={cimAnalyzer:this.view.stage.cimAnalyzer,cimResourceManager:this.view.stage.painter.textureManager.resourceManager,store:this.featureContainer.instanceStore,scaleExpression:i.scaleExpression};this._fields||(this._fields=this.layer.fields.map((e=>e.toJSON())));const r=i.visualVariableUniforms,s=await t.getSymbolAsync(e.feature,{fields:this._fields});return s&&s.data?{type:"dictionary-response",meshes:await(0,ze.Jk)(s.data,{uniforms:r,path:"renderer",schemaOptions:n})}:{type:"dictionary-response",meshes:[]}}catch(e){return{type:"dictionary-response",meshes:[]}}}_cleanUpQuery(e){const t=F.A.from(e)||this.createQuery();return t.outSpatialReference||(t.outSpatialReference=this.view.spatialReference),t.toJSON()}_cleanUpAggregateQuery(e){const t=F.A.from(e)||this.createAggregateQuery();t.outSpatialReference||(t.outSpatialReference=this.view.spatialReference);const i=t.objectIds??[];for(const e of t.aggregateIds??[])i.push(e);return t.objectIds=i,t.aggregateIds=[],t.toJSON()}async _update(){return this._commandsQueue.push({type:"update"})}async _edit(e){if(this.updateSuspended)return void this._subscriptionManager.suspend();const t=this._getEffectiveEdit(e);return t?this._commandsQueue.push(t).catch(y.jH):void 0}async doRefresh(e){this.attached&&(this.updateSuspended&&e||(e?this.incrementSourceRefreshVersion():this.incrementDisplayRefreshVersion()))}incrementSourceRefreshVersion(){this._sourceRefreshVersion=(this._sourceRefreshVersion+1)%Ft+1}incrementDisplayRefreshVersion(){this._displayRefreshVersion=(this._displayRefreshVersion+1)%Ft+1}_getEffectiveEdit(e){const t="globalIdField"in this.layer&&this.layer.globalIdField,i=e.deletedFeatures.some((e=>-1===e.objectId||!e.objectId)),n=t&&this.availableFields.includes(t);if(i&&!n)return a.A.getLogger(this).error(new p.A("mapview-apply-edits",`Editing the specified service requires the layer's globalIdField, ${t} to be included the layer's outFields for updates to be reflected on the map`)),null;const r=this.layer,s=e.historicMoment?.getTime()??null,o="layerId"in r&&e.editedFeatures?.find((e=>e.layerId===r.layerId));if(o&&this._canEditByFeature(o)){const e=!1,i=!1,n=(0,X.eh)(this.layer.geometryType),{adds:r,deletes:a,updates:l}=o.editedFeatures,u=this.layer.objectIdField,c=r.map((t=>(0,T.E2)(t,n,e,i))),h=l.map((t=>(0,T.E2)(t.current,n,e,i)));return{type:"edit-by-feature",added:c,removed:a.map((e=>"attributes"in e?{globalId:t?e.attributes[t]:null,objectId:u?e.attributes[u]:null}:e)),updated:h,historicMoment:s}}return{type:"edit-by-id",added:e.addedFeatures,updated:e.updatedFeatures,removed:e.deletedFeatures,historicMoment:s}}_canEditByFeature(e){const{adds:t,updates:i}=e.editedFeatures;return t.every((e=>this.view.spatialReference.equals(e.geometry?.spatialReference)))&&i.every((e=>this.view.spatialReference.equals(e.current.geometry?.spatialReference)))}async _doUpdate(){"featureReduction"in this.layer&&this.layer.featureReduction&&this.layer.featureReduction!==this._lastFeatureReduction&&(this.layer.featureReduction=this.layer.featureReduction?.clone(),this._lastFeatureReduction=this.layer.featureReduction);try{if(await this._updateRequiredFields(),this.destroyed||!this.layerAdapter?.hasRequiredSupport||!this._subscriptionManager)return;const e=this.featureContainer.instanceStore;this.featureContainer.attributeView.lockTextureUploads(),e.updateStart();const t=this.featureEffect,i={store:e,cimAnalyzer:this.view.stage.cimAnalyzer,cimResourceManager:this.view.stage.painter.textureManager.resourceManager,scaleExpression:void 0},n=this._createViewSchemaConfig(),r={source:this.layerAdapter.createSourceSchema(n,this._sourceRefreshVersion),processor:await this.layerAdapter.createProcessorSchema(i,n,this._displayRefreshVersion)},s=(0,g.i8)(this._lastSchema?.source.mutable,r.source.mutable)||(0,g.i8)(this._lastSchema?.processor,r.processor);if(!s)return this.featureContainer.requestRender(),this.featureContainer.attributeView.unlockTextureUploads(),e.updateEnd(),void(this.featureEffectView.featureEffect=t);this._lastSchema=r,this._fields=null;const a=Math.round(performance.now());(0,o.A)("esri-2d-update-debug")&&console.debug(`Id[${this.layer.uid}] Version[${a}] FeatureLayerView2D._doUpdate`,{changes:s});const l=await this.getWorker();await l.pipeline.updateSchema(r,a),e.updateEnd(),this.featureEffectView.featureEffect=t,this.featureEffectView.endTransition(),this.featureContainer.restartAllAnimations(),this.featureContainer.attributeView.unlockTextureUploads(),this.featureContainer.swapRenderState(),this.featureContainer.requestRender(),(0,o.A)("esri-2d-update-debug")&&console.debug(`Version[${a}] FeatureLayerView2D.updateEnd`),this.requestUpdate()}catch(e){(0,o.A)("esri-2d-update-debug")&&console.error("Encountered an error during update",e)}}async _doEdit(e){const t=await this.getWorker();try{this.featureContainer.editStart(),await t.pipeline.onEdits(e),this.featureContainer.editEnd()}catch(e){(0,y.zf)(e)}}get hasFilter(){const e=this.layerAdapter.hasFilters?.(this.view)??!1;return null!=this.filter||null!=this.timeExtent||this._visibilityOverrides.size>0||e}_getEffectiveAvailableFields(e){const t=function(e,t){const i=new Set;return e&&e.forEach((e=>i.add(e))),t&&t.forEach((e=>i.add(e))),i.has("*")?["*"]:Array.from(i)}(this._lastAvailableFields,e);return this._lastAvailableFields=t,(0,I.hW)(this.layer.fieldsIndex,t)}_createViewSchemaConfig(){const e=[Lt(this.view,this.layerAdapter,this.timeExtent,this._visibilityOverrides,this.filter),this.featureEffect?.filter?.toJSON()??null];return{availableFields:this._getEffectiveAvailableFields(this.availableFields),filters:e,scale:this.view.scale,timeZone:this.view.timeZone}}_addHighlights(e,t){this._highlightCounter.addGroup(e,t),this._commandsQueue.push({type:"highlight"})}_removeHighlights(e,t){this._highlightCounter.deleteGroup(e,t),this._commandsQueue.push({type:"highlight"})}async _updateHighlights(){const e=[];for(const t of this._highlightCounter.ids()){const i=this._highlightCounter.getHighlightGroups(t),n=this._getHighlightBits(i);e.push({objectId:t,highlightFlags:n})}const t=await this.getWorker();if(this.destroyed)return;const i=t.pipeline.updateHighlight({highlights:e}).catch((e=>{(0,y.zf)(e)||a.A.getLogger(this).error(e)}));this._updatingHandles.addPromise(i)}_setLayersForFeature(e){e.layer=e.sourceLayer=this.layer,this.layerAdapter.setGraphicOrigin&&this.layerAdapter.setGraphicOrigin(e)}_createGraphicHit(e,t){return this._setLayersForFeature(t),null!=t.geometry&&(t.geometry.spatialReference=this.view.spatialReference),{type:"graphic",graphic:t,layer:this.layer,mapPoint:e}}};function Lt(e,t,i,n,r){r&&(r=r.clone());const s=null!=r?r.timeExtent:null,o=null!=i&&null!=s?i.intersection(s):i||s;o&&(r??=new P.A,r.timeExtent=o),r=t.addFilters?.(r,e)??r;let a=r?.toJSON()??null;return n.size&&(a??=(new P.A).toJSON(),a.hiddenIds=Array.from(n)),a}(0,n._)([(0,s.MZ)()],Vt.prototype,"_commandsQueue",void 0),(0,n._)([(0,s.MZ)()],Vt.prototype,"_sourceRefreshVersion",void 0),(0,n._)([(0,s.MZ)()],Vt.prototype,"_displayRefreshVersion",void 0),(0,n._)([(0,s.MZ)({readOnly:!0})],Vt.prototype,"_pipelineUpdating",void 0),(0,n._)([(0,s.MZ)({readOnly:!0})],Vt.prototype,"hasAllFeatures",null),(0,n._)([(0,s.MZ)({readOnly:!0})],Vt.prototype,"hasAllFeaturesInView",null),(0,n._)([(0,s.MZ)({readOnly:!0})],Vt.prototype,"hasFullGeometries",null),(0,n._)([(0,s.MZ)()],Vt.prototype,"featureEffectView",void 0),(0,n._)([(0,s.MZ)()],Vt.prototype,"labelingCollisionInfos",null),(0,n._)([(0,s.MZ)()],Vt.prototype,"layerAdapter",null),(0,n._)([(0,s.MZ)({readOnly:!0})],Vt.prototype,"timeExtent",null),(0,n._)([(0,s.MZ)()],Vt.prototype,"updating",void 0),Vt=(0,n._)([(0,l.$)("esri.views.2d.layers.FeatureLayerView2D")],Vt);const Dt=Vt},60021:function(e,t,i){i.d(t,{e:function(){return I}});var n,r=i(53804),s=i(78879),o=i(61500),a=i(39819),l=i(40633),u=i(28181),c=i(23502),h=(i(58941),i(13798),i(65953)),d=i(7965),f=i(30488),p=i(28712),m=i(70963),_=i(95952),g=i(94548);let y=n=class extends g.A{constructor(e){super(e),this.type="rect",this.left=null,this.right=null,this.top=null,this.bottom=null}clone(){return new n({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}commitVersionProperties(){this.commitProperty("left"),this.commitProperty("right"),this.commitProperty("top"),this.commitProperty("bottom")}};(0,r._)([(0,c.MZ)({type:[Number,String],json:{write:!0}})],y.prototype,"left",void 0),(0,r._)([(0,c.MZ)({type:[Number,String],json:{write:!0}})],y.prototype,"right",void 0),(0,r._)([(0,c.MZ)({type:[Number,String],json:{write:!0}})],y.prototype,"top",void 0),(0,r._)([(0,c.MZ)({type:[Number,String],json:{write:!0}})],y.prototype,"bottom",void 0),y=n=(0,r._)([(0,h.$)("esri.views.layers.support.ClipRect")],y);const v=y;var x=i(29627);let b=class extends g.A{constructor(e){super(e),this.type="path",this.path=[]}commitVersionProperties(){this.commitProperty("path")}};(0,r._)([(0,c.MZ)({type:[[[Number]]],json:{write:!0}})],b.prototype,"path",void 0),b=(0,r._)([(0,h.$)("esri.views.layers.support.Path")],b);const S=b;var w=i(39715);const T=s.A.ofType({key:"type",base:null,typeMap:{rect:v,path:S,geometry:x.A}}),P=new(s.A.ofType(p.W)),I=e=>{let t=class extends e{constructor(){super(...arguments),this.attached=!1,this.clips=new T,this.highlights=null,this.lastUpdateId=-1,this.moving=!1,this.updateRequested=!1,this._visibleAtCurrentScale=!0}initialize(){const e=this.view?.spatialReferenceLocked??!0,t=this.view?.spatialReference;t&&e&&!this.spatialReferenceSupported?this.addResolvingPromise(Promise.reject(new a.A("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new d.m),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.addHandles([(0,u.watch)((()=>this.suspended),(e=>{this.container&&(this.container.visible=!e)}),u.pc),(0,u.watch)((()=>this.updateSuspended),(e=>{this.view&&!e&&this.updateRequested&&this.view.requestUpdate()}),u.pc),(0,u.watch)((()=>this.layer?.opacity??1),(e=>{this.container&&(this.container.opacity=e)}),u.pc),(0,u.watch)((()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal"),(e=>{this.container&&(this.container.blendMode=e)}),u.pc),(0,u.watch)((()=>this.layer&&"effect"in this.layer?this.layer.effect:null),(e=>{this.container&&(this.container.effect=e)}),u.pc),(0,u.watch)((()=>this._mergedHighlights.items.map((e=>({name:e.name,options:{fillColor:e.options.color,haloColor:e.options.haloColor,fillOpacity:e.options.fillOpacity,haloOpacity:e.options.haloOpacity,haloWidth:e.options.haloWidth,haloBlur:e.options.haloBlur}})))),(()=>{this.container.highlightGradient=(0,f.u4)(this.container.highlightGradient,this._mergedHighlights.items)}),u.pc),(0,u.watch)((()=>this._mergedHighlights.items.map((e=>e.name))),(()=>{this._updateHighlights()})),(0,u.on)((()=>this.clips),"change",(()=>{this.container&&(this.container.clips=this.clips)}),u.pc),(0,u.watch)((()=>({scale:this.view?.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null})),(({scale:e,scaleRange:t})=>{const i=(0,w.E5)(t,e);i!==this._visibleAtCurrentScale&&(this._visibleAtCurrentScale=i)}),u.pc)],"constructor"),this.view?.whenLayerView?this.view.whenLayerView(this.layer).then((e=>{e===this&&this.processAttach()}),(()=>{})):this.when().then((()=>{this.processAttach()}),(()=>{})))}_updateHighlights(){}destroy(){this.processDetach(),this.updateRequested=!1}get highlightOptions(){return(0,m.ax)(this)}set highlightOptions(e){(0,m.ou)(this,e)}get _mergedHighlights(){if(!this.view)return P;if(!this.highlights)return this.view.highlights;const e=this.view.highlights.clone();for(const t of this.highlights){const i=e.find((e=>e.name===t.name));i&&(i.options=t.options)}return e}get scheduler(){return this.view.scheduler}get spatialReferenceSupported(){const e=this.view?.spatialReference;return null==e||this.supportsSpatialReference(e)}get updating(){return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!!this._updatingHandles?.updating||this.container.transitioning)}get visibleAtCurrentScale(){return this._visibleAtCurrentScale}processAttach(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())}processDetach(){this.attached&&(this.attached=!1,this.removeHandles("attach"),this.detach(),this.updateRequested=!1)}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.updateSuspended||this.view.requestUpdate())}processUpdate(e){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",e),this.updateRequested&&!this.updateSuspended&&(this.updateRequested=!1,this.update(e))):this.updateRequested=!1}hitTest(e,t){return Promise.resolve(null)}supportsSpatialReference(e){return!0}canResume(){if(!this.spatialReferenceSupported)return!1;switch(this.layer?.type){case"link-chart":case"knowledge-graph-sublayer":break;default:if(null!=(e=this.view)&&"object"==typeof e&&"2d"===e.type&&"linkchart"===e.view2dType&&!this.view.inGeographicLayout)return!1}var e;return!!super.canResume()&&this.visibleAtCurrentScale}getSuspendInfo(){const e=super.getSuspendInfo(),t=!this.spatialReferenceSupported;return t&&(e.spatialReferenceNotSupported=t),e}addAttachHandles(e){this.addHandles(e,"attach")}_getHighlightBits(e){e=new Set(e);let t=1,i=0;if(!this.view)return 0;const n=this._mergedHighlights;for(const{name:r}of n)e.delete(r)&&(i=t),t<<=1;for(const t of e)l.A.getLogger(this).error("#highlights",`${t} was not found. Features in this group will not be highlighted.`);return i}};return(0,r._)([(0,c.MZ)()],t.prototype,"attached",void 0),(0,r._)([(0,c.MZ)({type:T,set(e){const t=(0,o.V)(e,this._get("clips"),T);this._set("clips",t)}})],t.prototype,"clips",void 0),(0,r._)([(0,c.MZ)()],t.prototype,"container",void 0),(0,r._)([(0,c.MZ)({type:_.A})],t.prototype,"highlightOptions",null),(0,r._)([(0,c.MZ)({type:s.A.ofType(p.W)})],t.prototype,"highlights",void 0),(0,r._)([(0,c.MZ)()],t.prototype,"_mergedHighlights",null),(0,r._)([(0,c.MZ)()],t.prototype,"moving",void 0),(0,r._)([(0,c.MZ)({readOnly:!0})],t.prototype,"spatialReferenceSupported",null),(0,r._)([(0,c.MZ)({readOnly:!0})],t.prototype,"updateParameters",void 0),(0,r._)([(0,c.MZ)()],t.prototype,"updateRequested",void 0),(0,r._)([(0,c.MZ)()],t.prototype,"updating",null),(0,r._)([(0,c.MZ)()],t.prototype,"view",void 0),(0,r._)([(0,c.MZ)()],t.prototype,"_visibleAtCurrentScale",void 0),(0,r._)([(0,c.MZ)({readOnly:!0})],t.prototype,"visibleAtCurrentScale",null),t=(0,r._)([(0,h.$)("esri.views.2d.layers.LayerView2D")],t),t}},38603:function(e,t,i){i.r(t),i.d(t,{default:function(){return u}});var n=i(53804),r=i(58941),s=i(28181),o=(i(40633),i(13798),i(39819),i(65953)),a=i(7295);let l=class extends a.default{initialize(){this.addHandles([(0,s.watch)((()=>this.view.scale),(()=>this._update()),s.Vh)],"constructor")}isUpdating(){const e=this.layer.sublayers.some((e=>null!=e.renderer)),t=this._commandsQueue.updateTracking.updating,i=null!=this._updatingRequiredFieldsPromise,n=!this._workerProxy,s=this.dataUpdating,o=e&&(t||i||n||s);return(0,r.A)("esri-2d-log-updating")&&console.log(`Updating FLV2D: ${o}\n  -> hasRenderer ${e}\n  -> hasPendingCommand ${t}\n  -> updatingRequiredFields ${i}\n  -> updatingProxy ${n}\n  -> updatingPipeline ${s}\n`),o}};l=(0,n._)([(0,o.$)("esri.views.2d.layers.SubtypeGroupLayerView2D")],l);const u=l},29739:function(e,t,i){i.d(t,{Jz:function(){return c},T9:function(){return a}});var n=i(50659),r=i(28230),s=i(51008),o=i(2746);function a(e,t){return{type:"simple",filters:t,capabilities:{maxTextureSize:(0,o.C)().maxTextureSize},bindings:u(e)}}function l(e){switch(e){case"opacity":return r.Gn.OPACITY;case"color":return r.Gn.COLOR;case"rotation":return r.Gn.ROTATION;case"size":return r.Gn.SIZE;default:return null}}function u(e){if(!e)return[];switch(e.type){case"simple":case"class-breaks":case"unique-value":case"dictionary":return c(e);case"dot-density":return function(e){const t=[];for(const i of e.attributes)t.push({binding:t.length,expression:i.valueExpression,field:i.field});return t}(e);case"pie-chart":return function(e){const t=c(e);let i=4;for(const n of e.attributes)t.push({binding:i++,expression:n.valueExpression,field:n.field});return t}(e);case"heatmap":return function({valueExpression:e,field:t}){return e||t?[{binding:0,expression:e,field:t}]:[]}(e)}}function c(e){return"visualVariables"in e&&e.visualVariables?.length?(0,s.R)(e.visualVariables).map((e=>function(e){switch(e.type){case"size":return function(e){return"$view.scale"===e.valueExpression?null:{binding:l(e.type),field:e.field,normalizationField:e.normalizationField,expression:e.valueExpression,valueRepresentation:e.valueRepresentation}}(e);case"color":case"opacity":return function(e){return{binding:l(e.type),field:e.field,normalizationField:e.normalizationField,expression:e.valueExpression}}(e);case"rotation":return function(e){return{binding:l(e.type),expression:e.valueExpression,field:e.field}}(e)}}(e))).filter(n.Ru):[]}},44327:function(e,t,i){i.d(t,{Dk:function(){return x},K4:function(){return S},j0:function(){return b}}),i(58941);var n=i(13520),r=i(62938),s=i(85031),o=i(39686),a=i(40846),l=i(29397),u=i(51008);const c=1.25,h=128,d=128;function f(e){if(!e.stops?.length)return null;const t=e.stops.sort(((e,t)=>e.value-t.value)),i=(0,l.r)(t,8),n=i.map((({value:e})=>e)),r=i.map((({color:e})=>(0,l.p)(e)));return{values:n,colors:r}}function p(e){if(!e.stops?.length)return null;const t=e.stops.sort(((e,t)=>e.value-t.value)),i=(0,l.r)(t,8);return{opacityValues:i.map((({value:e})=>e)),opacities:i.map((({opacity:e})=>e))}}function m(e){return{rotationType:"geographic"===e.rotationType?a.H_.Geographic:a.H_.Arithmatic}}function _(e){if(!e.stops?.length)return null;if(e.stops.some((e=>e.useMaxValue||e.useMinValue)))return(t,i)=>{const r=t.statisticsByLevel.get(i.key.level),s=e.stops.map((t=>({value:t.useMaxValue?r?.get(e.field)?.maxValue??0:t.useMinValue?r?.get(e.field)?.minValue??0:t.value,size:t.size?(0,n.Lz)(t.size):o.qM}))).sort(((e,t)=>e.value-t.value)),a=(0,l.r)(s,8);return{values:a.map((({value:e})=>e)),sizes:a.map((({size:e})=>e))}};const t=e.stops.sort(((e,t)=>e.value-t.value)),i=(0,l.r)(t,8);return{values:i.map((({value:e})=>e)),sizes:i.map((({size:e})=>(0,n.Lz)(e)))}}function g(e){return t=>{const{state:i}=t;return{unitValueToPixelsRatio:(0,r.GA)(i.spatialReference)/s.j[e.valueUnit??"meters"]/i.resolution}}}function y(e,t){const i=t.length;if(e<t[0].value||1===i)return t[0].size;for(let n=1;n<i;n++)if(e<t[n].value){const i=(e-t[n-1].value)/(t[n].value-t[n-1].value);return t[n-1].size+i*(t[n].size-t[n-1].size)}return t[i-1].size}function v(e){const{minDataValue:t,maxDataValue:i,minSize:r,maxSize:s}=e;if("object"==typeof r&&"object"==typeof s)return(e,o)=>{const a=e.state.scale,l=(0,n.Lz)(y(a,r.stops)),u=(0,n.Lz)(y(a,s.stops));return{minMaxValueAndSize:[t,i,l,u]}};if("object"==typeof r||"object"==typeof s)throw new Error("InternalError: Found a partial VisualVariableSizeMinMaxValue");return{minMaxValueAndSize:[t,i,(0,n.Lz)(r),(0,n.Lz)(s)]}}const x={visualVariableColor:null,visualVariableOpacity:null,visualVariableRotation:null,visualVariableSizeStops:null,visualVariableSizeScaleStops:null,visualVariableSizeOutlineScaleStops:null,visualVariableSizeUnitValue:null,visualVariableSizeMinMaxValue:null};function b(e,t=d,i=c){if(e.visualVariableSizeMinMaxValue)return e.visualVariableSizeMinMaxValue instanceof Function?h:Math.max(e.visualVariableSizeMinMaxValue.minMaxValueAndSize[3]*i,t);if(e.visualVariableSizeScaleStops){if(e.visualVariableSizeScaleStops instanceof Function)return h;const n=e.visualVariableSizeScaleStops.sizes;return Math.max(n[n.length-1]*i,t)}if(e.visualVariableSizeStops){if(e.visualVariableSizeStops instanceof Function)return h;const n=e.visualVariableSizeStops.sizes;return Math.max(n[n.length-1]*i,t)}return e.visualVariableSizeUnitValue?2*h:0}function S(e){const t={...x};if(!e||!("visualVariables"in e)||!e.visualVariables)return t;for(const i of(0,u.R)(e.visualVariables))switch(i.type){case"color":t.visualVariableColor=f(i);break;case"opacity":t.visualVariableOpacity=p(i);break;case"rotation":t.visualVariableRotation=m(i);break;case"size":switch(w(i)){case"field-stops":t.visualVariableSizeStops=_(i);break;case"scale-stops":"outline"===i.target?t.visualVariableSizeOutlineScaleStops=_(i):t.visualVariableSizeScaleStops=_(i);break;case"min-max":t.visualVariableSizeMinMaxValue=v(i);break;case"unit-value":t.visualVariableSizeUnitValue=g(i)}}return t}function w(e){return"number"==typeof e.minDataValue&&"number"==typeof e.maxDataValue&&null!=e.minSize&&null!=e.maxSize?"min-max":"$view.scale"===e?.valueExpression&&Array.isArray(e.stops)?"scale-stops":null==e.field&&"$view.scale"===e?.valueExpression||!(Array.isArray(e.stops)||"levels"in e&&e.levels)?null!=e.field||"$view.scale"!==e?.valueExpression?"unit-value":null:"field-stops"}},29397:function(e,t,i){function n(e,t){const i=e.slice(0,t),n=t-i.length;for(let e=0;e<n;e++){const e=i[i.length-1];i.push(e)}return i}function r(e){if(!e)return[0,0,0,0];const{r:t,g:i,b:n,a:r}=e;return[t*(r/255),i*(r/255),n*(r/255),r]}i.d(t,{p:function(){return r},r:function(){return n}})},81672:function(e,t,i){i.d(t,{EM:function(){return b},Gn:function(){return m},IQ:function(){return w},Jk:function(){return h},NZ:function(){return x},TY:function(){return u},Zi:function(){return p},gF:function(){return f},oF:function(){return g}});var n=i(57176),r=i(38821),s=i(33389),o=i(63812),a=i(44327),l=i(80958);function u(e){return e.minScale||e.maxScale?{minScale:e.minScale??0,maxScale:e.maxScale??0}:null}function c(e){if(null==e)return null;if(Array.isArray(e)){const[t,i,n,r]=e;return[t,i,n,255*r]}return"string"==typeof e?e:{...e,defaultValue:c(e?.defaultValue)}}async function h(e,t){const{cimResourceManager:i,cimAnalyzer:r,scaleExpression:s}=t.schemaOptions;await Promise.all(n.wp.fetchResources(e.symbol,i,[]));const o=r.analyzeSymbolReference(e,!1),a={scaleInfo:u(e),scaleExpression:s},l=[];for(const e of o)switch(e.type){case"marker":l.push(...d(e,t,a));break;case"fill":l.push(..._(e,t,a));break;case"line":l.push(...y(e,t,a));break;case"text":l.push(...S(e,t,a))}return l}function d(e,t,i){const{uniforms:n,schemaOptions:r}=t,{store:s}=r,l=e.isOutline?{...a.Dk,visualVariableSizeScaleStops:n.visualVariableSizeOutlineScaleStops}:{visualVariableColor:n.visualVariableColor,visualVariableOpacity:n.visualVariableOpacity,visualVariableSizeMinMaxValue:n.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:n.visualVariableSizeScaleStops,visualVariableSizeStops:n.visualVariableSizeStops,visualVariableSizeUnitValue:n.visualVariableSizeUnitValue,visualVariableRotation:n.visualVariableRotation};return e.animationParams?f(s.ensureInstance(o.YS.animatedMarker,{uniforms:l,optionalAttributes:{zoomRange:!0}}),e,a.Dk,i):p(s.ensureInstance(o.YS.marker,{uniforms:l,optionalAttributes:{zoomRange:!!i.scaleInfo}}),e,n,i)}function f(e,t,i,n){return t.animationParams?[e.createMeshInfo({pixelDimensions:t.pixelDimensions,texelDimensions:t.texelDimensions,effects:t.effects?{type:"cim-effect-infos",effectInfos:t.effects}:null,sprite:t.spriteRasterizationParam,animations:t.animationParams,scaleInfo:n.scaleInfo,scaleSymbolsProportionally:t.scaleSymbolsProportionally,strokeWidth:t.outlineWidth,isMapAligned:t.alignment===s.C1.MAP,colorLocked:t.colorLocked,isStroke:t.isStroke,baseSize:t.baseSize,referenceSize:t.referenceSize,angleToLine:!!t.markerPlacement&&t.markerPlacement.placement&&"angleToLine"in t.markerPlacement.placement&&t.markerPlacement.placement.angleToLine,sizeRatio:t.sizeRatio})]:[]}function p(e,t,i,{scaleInfo:n,scaleExpression:s}){const o=(0,l.I)(i);return[e.createMeshInfo({size:t.size,scaleX:t.scaleX,anchorX:t.anchorPoint.x,anchorY:t.anchorPoint.y,angle:t.rotation,color:c(t.color)??[0,0,0,0],colorLocked:t.colorLocked,frameHeight:t.frameHeight,widthRatio:t.widthRatio,scaleInfo:n,offsetX:t.offsetX,offsetY:t.offsetY,outlineColor:c(t.outlineColor)??[0,0,0,0],outlineSize:t.outlineWidth,referenceSize:t.referenceSize||r.D.CIMVectorMarker.size,rotateClockwise:t.rotateClockwise,scaleFactor:s??1,sizeRatio:t.sizeRatio,alignment:t.alignment,isAbsoluteAnchorPoint:t.isAbsoluteAnchorPoint,scaleSymbolsProportionally:t.scaleSymbolsProportionally,sprite:t.spriteRasterizationParam,hasSizeVV:o,placement:t.markerPlacement,effects:t.effects?{type:"cim-effect-infos",effectInfos:t.effects}:null,transforms:t.transform,minPixelBuffer:(0,a.j0)(i)})]}function m(e,t,{scaleInfo:i}){return[e.createMeshInfo({color:c(t.color)??[0,0,0,0],scaleInfo:i,effects:t.effects?{type:"cim-effect-infos",effectInfos:t.effects}:null})]}function _(e,t,i){if(!e.spriteRasterizationParam)return function(e,t,i){const{uniforms:n,schemaOptions:r}=t,{store:s}=r;return m(s.ensureInstance(o.YS.fill,{uniforms:{visualVariableColor:e.colorLocked?null:n.visualVariableColor,visualVariableOpacity:n.visualVariableOpacity},optionalAttributes:{zoomRange:!!i.scaleInfo}}),e,i)}(e,t,i);const{uniforms:n,schemaOptions:r}=t,{store:s}=r;return g(s.ensureInstance(o.YS.complexFill,{uniforms:{visualVariableColor:e.colorLocked?null:n.visualVariableColor,visualVariableOpacity:n.visualVariableOpacity},optionalAttributes:{zoomRange:!!i.scaleInfo}}),e,null!=n.visualVariableColor,i)}function g(e,t,i,{scaleInfo:n}){if(!t.spriteRasterizationParam)throw new Error("InternalError: Sprite should always be defined");const r=!!t.hasUnresolvedReplacementColor&&(!i||t.colorLocked),s=t.sampleAlphaOnly&&!r,o=t.spriteRasterizationParam;return[e.createMeshInfo({color:c(t.color)??[0,0,0,0],height:t.height,aspectRatio:t.scaleX,offsetX:t.offsetX,offsetY:t.offsetY,scaleX:1,scaleY:1,angle:t.angle,applyRandomOffset:t.applyRandomOffset,sampleAlphaOnly:s,scaleProportionally:"CIMHatchFill"===o.resource.type,sprite:o,scaleInfo:n,effects:t.effects?{type:"cim-effect-infos",effectInfos:t.effects}:null})]}function y(e,t,i){const{uniforms:n,schemaOptions:r}=t,{store:s}=r,l=e.isOutline?{...a.Dk,visualVariableSizeScaleStops:n.visualVariableSizeOutlineScaleStops}:{visualVariableColor:e.colorLocked?null:n.visualVariableColor,visualVariableOpacity:n.visualVariableOpacity,visualVariableSizeMinMaxValue:n.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:n.visualVariableSizeScaleStops,visualVariableSizeStops:n.visualVariableSizeStops,visualVariableSizeUnitValue:n.visualVariableSizeUnitValue},u={uniforms:l,optionalAttributes:{zoomRange:!!i.scaleInfo}},c=!!(l.visualVariableSizeMinMaxValue||l.visualVariableSizeScaleStops||l.visualVariableSizeStops||l.visualVariableSizeUnitValue);return e.spriteRasterizationParam?b(s.ensureInstance(o.YS.texturedLine,u),e,c,i):x(s.ensureInstance(o.YS.line,u),e,c,i)}function v(e,t,{scaleInfo:i}){return{color:c(e.color)??[0,0,0,0],width:e.width,referenceWidth:e.referenceWidth,capType:e.cap,joinType:e.join,miterLimit:e.miterLimit,scaleInfo:i,hasSizeVV:t,effects:e.effects?{type:"cim-effect-infos",effectInfos:e.effects}:null}}function x(e,t,i,n){if(t.spriteRasterizationParam)throw new Error("InternalError: Sprite should not be defined");const r=v(t,i,n);return[e.createMeshInfo(r)]}function b(e,t,i,n){const{spriteRasterizationParam:r,scaleDash:s,sampleAlphaOnly:o}=t;if(!r)throw new Error("InternalError: Sprite should be defined");return[e.createMeshInfo({...v(t,i,n),offsetAlongLine:t.offsetAlongLine??0,shouldScaleDash:s??!1,shouldSampleAlphaOnly:o,isSDF:"CIMPictureStroke"!==r.resource.type,sprite:r})]}function S(e,t,i){const{uniforms:n,schemaOptions:r}=t,{store:s}=r;return w(s.ensureInstance(o.YS.text,{uniforms:{visualVariableColor:e.colorLocked?null:n.visualVariableColor,visualVariableOpacity:n.visualVariableOpacity,visualVariableRotation:n.visualVariableRotation,visualVariableSizeMinMaxValue:n.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:n.visualVariableSizeScaleStops,visualVariableSizeStops:n.visualVariableSizeStops,visualVariableSizeUnitValue:n.visualVariableSizeUnitValue},optionalAttributes:{zoomRange:!!i.scaleInfo,referenceSymbol:!1,clipAngle:!1}}),e,n,i)}function w(e,t,i,{scaleInfo:n,scaleExpression:r}){return[e.createMeshInfo({boxBackgroundColor:c(t.backgroundColor),boxBorderLineColor:c(t.borderLineColor),boxBorderLineSize:t.borderLineWidth??0,color:c(t.color)??[0,0,0,0],offsetX:t.offsetX,offsetY:t.offsetY,postAngle:t.angle,fontSize:t.size,referenceSize:t.referenceSize,decoration:t.decoration,haloColor:c(t.haloColor)??[0,0,0,0],haloSize:t.haloSize??0,outlineColor:c(t.outlineColor)??[0,0,0,0],outlineSize:t.outlineSize,lineWidth:t.lineWidth||512,lineHeightRatio:1,horizontalAlignment:t.horizontalAlignment??"center",verticalAlignment:t.verticalAlignment??"baseline",useCIMAngleBehavior:!1,glyphs:t.textRasterizationParam,scaleInfo:n,effects:t.effects?{type:"cim-effect-infos",effectInfos:t.effects}:null,placement:t.markerPlacement,transforms:t.transform,scaleFactor:r??1,minPixelBuffer:(0,a.j0)(i),repeatLabel:null,repeatLabelDistance:null,allowOverrun:null,labelPosition:null})]}},80958:function(e,t,i){function n(e){return!!(e.visualVariableSizeMinMaxValue||e.visualVariableSizeScaleStops||e.visualVariableSizeStops||e.visualVariableSizeUnitValue||e.visualVariableSizeOutlineScaleStops)}function r(e){return!!e.visualVariableRotation}i.d(t,{I:function(){return n},N:function(){return r}})},51008:function(e,t,i){i.d(t,{R:function(){return c},e:function(){return d}});var n=i(39819),r=i(40633),s=i(13520),o=i(2746);const a=8,l=a-2,u=()=>r.A.getLogger("esri.views.2d.layers.features.support.rendererUtils");function c(e){return e.map((e=>function(e){return("size"===e.type||"color"===e.type||"opacity"===e.type)&&null!=e.stops}(e)?function(e){return e.stops=function(e,t){return t.length<=a?t:(u().warn(`Found ${t.length} Visual Variable stops, but MapView only supports ${a}. Displayed stops will be simplified.`),t.length>2*a?function(e,t){const[i,...n]=t,r=n.pop(),o=n[0].value,a=n[n.length-1].value,u=(a-o)/l,c=[];for(let i=o;i<a;i+=u){let r=0;for(;i>=n[r].value;)r++;const o=n[r],a=t[r-1],l=i-a.value,u=o.value===a.value?1:l/(o.value-a.value);if("color"===e){const e=n[r],s=t[r-1],o=e.color.clone();o.r=h(s.color.r,o.r,u),o.g=h(s.color.g,o.g,u),o.b=h(s.color.b,o.b,u),o.a=h(s.color.a,o.a,u),c.push({value:i,color:o,label:e.label})}else if("size"===e){const e=n[r],o=t[r-1],a=(0,s.cr)(e.size),l=h((0,s.cr)(o.size),a,u);c.push({value:i,size:l,label:e.label})}else{const e=n[r],s=h(t[r-1].opacity,e.opacity,u);c.push({value:i,opacity:s,label:e.label})}}return[i,...c,r]}(e,t):function(e){const[t,...i]=e,n=i.pop();for(;i.length>l;){let e=0,t=0;for(let n=1;n<i.length;n++){const r=i[n-1],s=i[n],o=Math.abs(s.value-r.value);o>t&&(t=o,e=n)}i.splice(e,1)}return[t,...i,n]}(t))}(e.type,e.stops??[]),e}(e.clone()):e))}function h(e,t,i){return(1-i)*e+i*t}function d(e){if(!e)return!0;switch(e.type){case"dot-density":break;case"heatmap":if(!function(){const{supportsColorBufferFloat:e,supportsColorBufferFloatBlend:t,supportsColorBufferHalfFloat:i}=(0,o.C)();return e&&t||i}()){const e=(0,o.C)(),t=["supportsColorBufferFloat","supportsColorBufferFloatBlend","supportsColorBufferHalfFloat"].filter((t=>!e[t])).join(", ");return u().errorOnce(new n.A("webgl-missing-extension",`Missing WebGL2 requirements for Heatmap: ${t}`)),!1}}return!0}},96700:function(e,t,i){i.d(t,{DF:function(){return a},Lu:function(){return u},RA:function(){return o},hV:function(){return l}});var n=i(13520),r=i(44740),s=(i(87416),i(57652),i(39686));const o=50;function a(e){if(!e)return null;const{xmin:t,ymin:i,xmax:n,ymax:s,spatialReference:o}=e;return new r.A({rings:[[[t,i],[t,s],[n,s],[n,i],[t,i]]],spatialReference:o})}function l(e){return(0,n.PN)(Math.round((0,n.Lz)(e)))}function u(e){const t=(0,n.PN)(s.GR),i=(0,n.PN)(s.cp);return Math.max(t,Math.min(e||i,i))}},21884:function(e,t,i){i.d(t,{A:function(){return o}});var n=i(60539),r=i(60478),s=i(46863);class o{constructor(e){this.updateTracking=new r.F({debugName:"FeatureCommandQueue"}),this._queueProcessor=new s.e({concurrency:1,process:e.process})}destroy(){this.updateTracking.destroy(),this._queueProcessor.destroy(),this.clear()}clear(){this._queueProcessor.clear()}async push(e){return(0,n.QZ)(this.updateTracking.addPromise(this._doPush(e)))}async _doPush(e){const t=this._queueProcessor,i=t.last();switch(e.type){case"update":case"highlight":if(i?.type===e.type)return;return t.push(e);case"edit-by-id":case"edit-by-feature":return t.push(e)}}}},89872:function(e,t,i){i.d(t,{t:function(){return r}});const n=new Set;class r{constructor(){this._idToCounters=new Map}get empty(){return 0===this._idToCounters.size}addGroup(e,t){for(const i of e){let e=this._idToCounters.get(i);e||(e=new Map,this._idToCounters.set(i,e)),e.set(t,(e.get(t)||0)+1)}}deleteGroup(e,t){for(const i of e){const e=this._idToCounters.get(i);if(!e)continue;let n=e.get(t);if(null==n)return;n--,n>0?e.set(t,n):e.delete(t),0===e.size&&this._idToCounters.delete(i)}}getHighlightGroups(e){const t=this._idToCounters.get(e);if(!t)return n;const i=new Set;for(const[e,n]of t)n>0&&i.add(e);return i}ids(){return this._idToCounters.keys()}}},60478:function(e,t,i){i.d(t,{F:function(){return h}});var n=i(53804),r=i(83525),s=i(58941),o=i(62790),a=i(28181),l=i(23502),u=(i(40633),i(13798),i(65953)),c=i(20248);let h=class extends r.A{constructor(e){super(e),this.debugName="",this._updatingHandles=new c.U,this._idToUpdatingState=new o.A}get updating(){const e=this._updatingHandles.updating||Array.from(this._idToUpdatingState.values()).some((e=>e));if((0,s.A)("esri-2d-log-updating")){const t=Array.from(this._idToUpdatingState.entries()).map((([e,t])=>`-> ${e}: ${t}`)).join("\n");console.log(`${this.debugName}: Updating: ${e}\n-> Handles: ${this._updatingHandles.updating}\n${t}`)}return e}addUpdateTracking(e,t){const i=(0,a.watch)((()=>t.updating),(t=>this._idToUpdatingState.set(e,t)),{sync:!0});this.addHandles(i)}addPromise(e){return this._updatingHandles.addPromise(e)}};(0,n._)([(0,l.MZ)({constructOnly:!0})],h.prototype,"debugName",void 0),(0,n._)([(0,l.MZ)({readOnly:!0})],h.prototype,"updating",null),h=(0,n._)([(0,u.$)("esri.views.2d.layers.support.UpdateTracking2D")],h)},16541:function(e,t,i){async function n(e,t){try{return await e}catch(e){if("no-queryEngine"!==e.name)throw e;return t}}i.d(t,{E:function(){return n}})},54516:function(e,t,i){var n;i.d(t,{c:function(){return n}}),function(e){e[e.Pass=0]="Pass",e[e.Draw=1]="Draw"}(n||(n={}))},90553:function(e,t,i){i.d(t,{L:function(){return l},MX:function(){return o},O_:function(){return a},kL:function(){return u},vA:function(){return s},zH:function(){return c}});var n=i(1932);i(33400),(0,i(41546).vt)();class r{constructor(e){this.message=e}toString(){return`AssertException: ${this.message}`}}function s(e,t="Assertion"){if(!e){const e=new Error(t).stack;throw new r(`${t} at ${e}`)}}function o(e,t){e||(t=t||"",console.warn("Verify failed: "+t+"\n"+new Error("verify").stack))}function a(e,t,i,n){let r,s=(i[0]-e[0])/t[0],o=(n[0]-e[0])/t[0];s>o&&(r=s,s=o,o=r);let a=(i[1]-e[1])/t[1],l=(n[1]-e[1])/t[1];if(a>l&&(r=a,a=l,l=r),s>l||a>o)return!1;a>s&&(s=a),l<o&&(o=l);let u=(i[2]-e[2])/t[2],c=(n[2]-e[2])/t[2];return u>c&&(r=u,u=c,c=r),!(s>c||u>o||(c<o&&(o=c),o<0))}function l(e,t,i,r,s,o=(0,n.vt)()){const a=(r[s]-i[s])*(t[0]-e[0])-(r[0]-i[0])*(t[s]-e[s]),l=(r[0]-i[0])*(e[s]-i[s])-(r[s]-i[s])*(e[0]-i[0]);if(0===a)return!1;const u=l/a;return o[0]=e[0]+u*(t[0]-e[0]),o[1]=e[s]+u*(t[s]-e[s]),!0}function u(e,t){return Math.log(e)/Math.log(t)}function c(e){return 1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&1===e[15]}},58251:function(e,t,i){i.d(t,{A:function(){return m}});var n=i(53804),r=i(83525),s=i(48996),o=i(88781),a=i(40633),l=i(95929),u=i(62560),c=i(23502),h=(i(58941),i(13798),i(65953)),d=i(20248),f=i(39715);let p=class extends((0,o.sA)((0,u.g)(s.A.EventedMixin(r.A)))){constructor(e){super(e),this._updatingHandles=new d.U,this.layer=null,this.parent=null}initialize(){this.when().catch((e=>{if("layerview:create-error"!==e.name){const t=this.layer&&this.layer.id||"no id",i=this.layer?.title||"no title";a.A.getLogger(this).error("#resolve()",`Failed to resolve layer view (layer title: '${i}', id: '${t}')`,e)}}))}destroy(){this._updatingHandles=(0,l.pR)(this._updatingHandles)}get fullOpacity(){return(this.layer?.opacity??1)*(this.parent?.fullOpacity??1)}get suspended(){return this.destroyed||!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){return!this.suspended&&!0===this.layer?.legendEnabled}get updating(){return!(!this._updatingHandles?.updating&&!this.isUpdating())}get updatingProgress(){return this.updating?0:1}get updateSuspended(){return this.suspended}get visible(){return!0===this.layer?.visible}set visible(e){this._overrideIfSome("visible",e)}get visibleAtCurrentScale(){return!0}get visibleAtCurrentTimeExtent(){const e=this.view.timeExtent,t=this.layer?.visibilityTimeExtent;return!e||!t||!e.intersection(t).isEmpty}canResume(){const e=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return this.visible&&this.layer?.loaded&&!this.parent?.suspended&&this.view?.ready&&(0,f.g7)(e)&&this.visibleAtCurrentScale&&this.visibleAtCurrentTimeExtent||!1}getSuspendInfo(){const e=this.parent?.suspended?this.parent.suspendInfo:{};this.view?.ready||(e.viewNotReady=!0),this.layer&&this.layer.loaded||(e.layerNotLoaded=!0);const t=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return(0,f.g7)(t)&&this.visibleAtCurrentScale||(e.outsideScaleRange=!0),this.visibleAtCurrentTimeExtent||(e.outsideVisibilityTimeExtent=!0),this.visible||(e.layerInvisible=!0),e}isUpdating(){return!1}};(0,n._)([(0,c.MZ)()],p.prototype,"view",void 0),(0,n._)([(0,c.MZ)()],p.prototype,"fullOpacity",null),(0,n._)([(0,c.MZ)()],p.prototype,"layer",void 0),(0,n._)([(0,c.MZ)()],p.prototype,"parent",void 0),(0,n._)([(0,c.MZ)({readOnly:!0})],p.prototype,"suspended",null),(0,n._)([(0,c.MZ)({readOnly:!0})],p.prototype,"suspendInfo",null),(0,n._)([(0,c.MZ)({readOnly:!0})],p.prototype,"legendEnabled",null),(0,n._)([(0,c.MZ)({type:Boolean,readOnly:!0})],p.prototype,"updating",null),(0,n._)([(0,c.MZ)({readOnly:!0})],p.prototype,"updatingProgress",null),(0,n._)([(0,c.MZ)()],p.prototype,"updateSuspended",null),(0,n._)([(0,c.MZ)()],p.prototype,"visible",null),(0,n._)([(0,c.MZ)({readOnly:!0})],p.prototype,"visibleAtCurrentScale",null),(0,n._)([(0,c.MZ)({readOnly:!0})],p.prototype,"visibleAtCurrentTimeExtent",null),p=(0,n._)([(0,h.$)("esri.views.layers.LayerView")],p);const m=p},58374:function(e,t,i){i.d(t,{A:function(){return l}});var n=i(53804),r=i(40633),s=i(60539),o=i(28181),a=(i(58941),i(13798),i(39819),i(65953));const l=e=>{let t=class extends e{initialize(){this.addHandles((0,o.on)((()=>this.layer),"refresh",(e=>{this.doRefresh(e.dataChanged).catch((e=>{(0,s.zf)(e)||r.A.getLogger(this).error(e)}))})),"RefreshableLayerView")}};return t=(0,n._)([(0,a.$)("esri.views.layers.RefreshableLayerView")],t),t}},94548:function(e,t,i){i.d(t,{A:function(){return l}});var n=i(53804),r=i(30905),s=i(23502),o=(i(58941),i(40633),i(13798),i(65953));let a=class extends r.oY{get version(){return this.commitVersionProperties(),(this._get("version")||0)+1}};(0,n._)([(0,s.MZ)({readOnly:!0})],a.prototype,"version",null),a=(0,n._)([(0,o.$)("esri.views.layers.support.ClipArea")],a);const l=a},29627:function(e,t,i){i.d(t,{A:function(){return p}});var n,r=i(53804),s=(i(50917),i(23502)),o=(i(58941),i(40633),i(13798),i(65953)),a=i(46556),l=i(74697),u=i(94548),c=i(91484),h=i(44740);const d={base:a.A,key:"type",typeMap:{extent:c.default,polygon:h.A}};let f=n=class extends u.A{constructor(e){super(e),this.type="geometry",this.geometry=null}clone(){return new n({geometry:this.geometry?.clone()??null})}commitVersionProperties(){this.commitProperty("geometry")}};(0,r._)([(0,s.MZ)({types:d,json:{read:l.rS,write:!0}})],f.prototype,"geometry",void 0),f=n=(0,r._)([(0,o.$)("esri.views.layers.support.Geometry")],f);const p=f},28088:function(e,t,i){i.d(t,{D8:function(){return s},TO:function(){return r},d0:function(){return o}});var n=i(53743);async function r(e,t=e.popupTemplate){if(null==t)return[];const i=await t.getRequiredFields(e.fieldsIndex),{lastEditInfoEnabled:r}=t,{objectIdField:s,typeIdField:o,globalIdField:a,relationships:l}=e;if(i.includes("*"))return["*"];const u=r?(0,n.eX)(e):[],c=(0,n.DB)(e.fieldsIndex,[...i,...u]);return o&&c.push(o),c&&s&&e.fieldsIndex?.has(s)&&!c.includes(s)&&c.push(s),c&&a&&e.fieldsIndex?.has(a)&&!c.includes(a)&&c.push(a),l&&l.forEach((t=>{const{keyField:i}=t;c&&i&&e.fieldsIndex?.has(i)&&!c.includes(i)&&c.push(i)})),c}function s(e,t){return e.popupTemplate?e.popupTemplate:null!=t&&t.defaultPopupTemplateEnabled&&null!=e.defaultPopupTemplate?e.defaultPopupTemplate:null}function o(e,t){return null!=s(e,{defaultPopupTemplateEnabled:t})}},39715:function(e,t,i){function n(e){return e&&"function"==typeof e.highlight}function r(e,t,i){return null==e||e>=i&&(0===t||e<=t)}function s(e,t){if(t&&e){const{minScale:i,maxScale:n}=e;if(function(e,t){return null!=e&&e>0||null!=t&&t>0}(i,n))return r(t,i,n)}return!0}function o(e){return!e?.minScale||!e.maxScale||e.minScale>=e.maxScale}i.d(t,{E5:function(){return s},JU:function(){return r},Of:function(){return n},g7:function(){return o}}),i(39819)},86305:function(e,t,i){i.d(t,{g:function(){return u}});var n=i(50659),r=(i(58941),i(40633)),s=i(24540),o=i(41835),a=i(85456);const l=()=>r.A.getLogger("esri.views.webgl.BufferObject");class u{static createIndex(e,t,i){return new u(e,a.NZ.ELEMENT_ARRAY_BUFFER,t,i)}static createVertex(e,t,i){return new u(e,a.NZ.ARRAY_BUFFER,t,i)}static createUniform(e,t,i){return new u(e,a.NZ.UNIFORM_BUFFER,t,i)}static createPixelPack(e,t=a._U.STREAM_READ,i){const n=new u(e,a.NZ.PIXEL_PACK_BUFFER,t);return i&&n.setSize(i),n}static createPixelUnpack(e,t=a._U.STREAM_DRAW,i){return new u(e,a.NZ.PIXEL_UNPACK_BUFFER,t,i)}static createTransformFeedback(e,t=a._U.STATIC_DRAW,i){const n=new u(e,a.NZ.TRANSFORM_FEEDBACK_BUFFER,t);return n.setSize(i),n}constructor(e,t,i,n){this._context=e,this.bufferType=t,this.usage=i,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(a.vt.BufferObject,this),this._glName=this._context.gl.createBuffer(),(0,o.Y2)(this._context.gl),n&&this.setData(n)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get usedMemory(){if(this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER){if(this._indexType===a.pe.UNSIGNED_INT)return 4*this._size;if(this._indexType===a.pe.UNSIGNED_SHORT)return 2*this._size}return this._size}get _isVAOAware(){return this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER||this.bufferType===a.NZ.ARRAY_BUFFER}dispose(){this._context?.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(a.vt.BufferObject,this),this._context=null):this._glName&&l().warn("Leaked WebGL buffer object")}setSize(e,t=null){if(this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER&&null!=t)switch(this._indexType=t,t){case a.pe.UNSIGNED_SHORT:e*=2;break;case a.pe.UNSIGNED_INT:e*=4}this._setBufferData(e)}setData(e){if(!e)return;let t=e.byteLength;this.bufferType===a.NZ.ELEMENT_ARRAY_BUFFER&&((0,s.mg)(e)?this._indexType=a.pe.UNSIGNED_BYTE:(0,s.jq)(e)?(t/=2,this._indexType=a.pe.UNSIGNED_SHORT):(0,s.XJ)(e)&&(t/=4,this._indexType=a.pe.UNSIGNED_INT)),this._setBufferData(t,e)}_setBufferData(e,t=null){this._size=e;const i=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const n=this._context.gl;null!=t?n.bufferData(this.bufferType,t,this.usage):n.bufferData(this.bufferType,e,this.usage),(0,o.Y2)(n),this._isVAOAware&&this._context.bindVAO(i)}setSubData(e,t,i,n){if(!e)return;const r=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const{gl:s}=this._context;s.bufferSubData(this.bufferType,t*e.BYTES_PER_ELEMENT,e,i,n-i),(0,o.Y2)(s),this._isVAOAware&&this._context.bindVAO(r)}getSubData(e,t=0,i,r){if(i<0||r<0)return;const s=function(e){return(0,n.Xj)(e)}(e)?e.BYTES_PER_ELEMENT:1;if(s*((i??0)+(r??0))>e.byteLength)return;t+s*(r??0)>this.usedMemory&&l().warn("Potential problem getting subdata: requested data exceeds buffer size!");const o=this._context.gl;this.bufferType===a.NZ.TRANSFORM_FEEDBACK_BUFFER?(this._context.bindBuffer(this,a.NZ.TRANSFORM_FEEDBACK_BUFFER),o.getBufferSubData(a.NZ.TRANSFORM_FEEDBACK_BUFFER,t,e,i,r),this._context.unbindBuffer(a.NZ.TRANSFORM_FEEDBACK_BUFFER)):(this._context.bindBuffer(this,a.NZ.COPY_READ_BUFFER),o.getBufferSubData(a.NZ.COPY_READ_BUFFER,t,e,i,r),this._context.unbindBuffer(a.NZ.COPY_READ_BUFFER))}async getSubDataAsync(e,t=0,i,n){await this._context.clientWaitAsync(),this.getSubData(e,t,i,n)}}},96402:function(e,t,i){i.d(t,{H:function(){return h}}),i(58941);var n=i(40633),r=i(95929),s=i(86305),o=i(41835),a=i(85456),l=i(69452),u=i(49414),c=i(12285);class h{constructor(e,t,i=null){this._context=e,this._glName=null,this._colorAttachments=new Map,this._depthStencilBuffer=null,this._depthStencilTexture=null,this._initialized=!1,e.instanceCounter.increment(a.vt.FramebufferObject,this);const n=d(t)?t:new c.g(this._context,t);if(this._colorAttachments.set(a.Nm.COLOR_ATTACHMENT0,n),this._validateTextureDescriptor(n.descriptor),this._validateColorAttachmentPoint(a.Nm.COLOR_ATTACHMENT0),null!=i)if(function(e){return d(e)||null!=e&&"pixelFormat"in e}(i))this._depthStencilTexture=d(i)?i:new c.g(this._context,i),this._validateTextureDescriptor(this._depthStencilTexture.descriptor);else{const e=function(e){return null!=e&&"type"in e&&e.type===l.p.RenderBuffer}(i)?i:new u.l(this._context,i);this._depthStencilBuffer=e,this._validateRenderBufferDescriptor(e.descriptor)}}dispose(){if(0===this._colorAttachments.size&&!this._glName)return;const e=this._context.getBoundFramebufferObject();this._colorAttachments.forEach(((e,t)=>this.detachColorTexture(t)?.dispose())),this.detachDepthStencilBuffer()?.dispose(),this.detachDepthStencilTexture()?.dispose(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(e),this._context.instanceCounter.decrement(a.vt.FramebufferObject,this)}get glName(){return this._glName}get colorTexture(){return this._colorAttachments.get(a.Nm.COLOR_ATTACHMENT0)}get depthStencil(){return this._depthStencilTexture||this._depthStencilBuffer}get depthStencilTexture(){return this._depthStencilTexture}get width(){const e=this._colorAttachments.get(a.Nm.COLOR_ATTACHMENT0);return e?.descriptor?.width??0}get height(){const e=this._colorAttachments.get(a.Nm.COLOR_ATTACHMENT0);return e?.descriptor?.height??0}get usedMemory(){return[...this._colorAttachments].reduce(((e,[t,i])=>e+i.usedMemory),this.depthStencil?.usedMemory??0)}getColorTexture(e){const t=this._colorAttachments.get(e);return t&&d(t)?t:null}get colorAttachments(){return[...this._colorAttachments.keys()]}attachColorTexture(e,t=a.Nm.COLOR_ATTACHMENT0){if(!e)return;this._validateColorAttachmentPoint(t);const i=e.descriptor;this._validateTextureDescriptor(i),this.detachColorTexture(t)?.dispose(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,t)),this._colorAttachments.set(t,e)}detachColorTexture(e=a.Nm.COLOR_ATTACHMENT0){const t=this._colorAttachments.get(e);if(t){if(this._initialized){const t=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e),this._context.bindFramebuffer(t)}return this._colorAttachments.delete(e),t}}setColorTextureTarget(e,t=a.Nm.COLOR_ATTACHMENT0){const i=this._colorAttachments.get(t);i&&this._framebufferTexture2D(i.glName,t,e)}attachDepthStencil(e){if(e)switch(e.type){case l.p.Texture:return this._attachDepthStencilTexture(e);case l.p.RenderBuffer:return this._attachDepthStencilBuffer(e)}}_attachDepthStencilTexture(e){if(null==e)return;const t=e.descriptor;t.pixelFormat!==a.Ab.DEPTH_STENCIL&&t.pixelFormat!==a.Ab.DEPTH24_STENCIL8&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),t.dataType!==a.ld.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._validateTextureDescriptor(t),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,a.nI)),this._depthStencilTexture?.dispose(),this._depthStencilTexture=e}detachDepthStencilTexture(){const e=this._depthStencilTexture;if(e&&this._initialized){const e=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this),this._framebufferTexture2D(null,a.nI),this._context.bindFramebuffer(e)}return this._depthStencilTexture=null,e}_attachDepthStencilBuffer(e){if(null==e)return;const t=e.descriptor;if(this._validateRenderBufferDescriptor(t),this._disposeDepthStencilAttachments(),this._initialized){this._context.bindFramebuffer(this);const i=this._context.gl,n=this._getGLAttachmentPoint(t);i.framebufferRenderbuffer(a.R.FRAMEBUFFER,n,i.RENDERBUFFER,e.glName)}this._depthStencilBuffer=e}detachDepthStencilBuffer(){const e=this._depthStencilBuffer;if(e&&this._initialized){const t=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this);const i=this._context.gl,n=this._getGLAttachmentPoint(e.descriptor);i.framebufferRenderbuffer(a.R.FRAMEBUFFER,n,i.RENDERBUFFER,null),this._context.bindFramebuffer(t)}return this._depthStencilBuffer=null,e}copyToTexture(e,t,i,n,r,s,o){(e<0||t<0||r<0||s<0)&&console.error("Offsets cannot be negative!"),(i<=0||n<=0)&&console.error("Copy width and height must be greater than zero!");const l=o.descriptor;o.descriptor.target!==a.Ap.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),(null==l?.width||null==l?.height||e+i>this.width||t+n>this.height||r+i>l.width||s+n>l.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const u=this._context,h=u.bindTexture(o,c.g.TEXTURE_UNIT_FOR_UPDATES);u.setActiveTexture(c.g.TEXTURE_UNIT_FOR_UPDATES),u.bindFramebuffer(this),u.gl.copyTexSubImage2D(a.Ap.TEXTURE_2D,0,r,s,e,t,i,n),u.bindTexture(h,c.g.TEXTURE_UNIT_FOR_UPDATES)}readPixels(e,t,i,n,r,s,o){(i<=0||n<=0)&&console.error("Copy width and height must be greater than zero!"),o||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(e,t,i,n,r,s,o)}async readPixelsAsync(e,t,i,n,r,o,l){const{gl:u}=this._context,c=s.g.createPixelPack(this._context,a._U.STREAM_READ,l.byteLength);this._context.bindBuffer(c);const h=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this),u.readPixels(e,t,i,n,r,o,0),this._context.unbindBuffer(a.NZ.PIXEL_PACK_BUFFER),this._context.bindFramebuffer(h),await c.getSubDataAsync(l),c.dispose()}resize(e,t){if(this.width===e&&this.height===t)return;const i={width:e,height:t};f(i,this._context.parameters.maxTextureSize),this._colorAttachments.forEach((e=>e.resize(i.width,i.height))),this._depthStencilTexture?.resize(i.width,i.height),this._initialized&&(f(i,this._context.parameters.maxRenderbufferSize),this._depthStencilBuffer?.resize(i.width,i.height),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1)}initializeAndBind(e=a.R.FRAMEBUFFER){const t=this._context.gl;if(this._initialized)return void t.bindFramebuffer(e,this.glName);this._glName&&t.deleteFramebuffer(this._glName);const i=t.createFramebuffer();if(t.bindFramebuffer(e,i),this._colorAttachments.forEach(((t,i)=>this._framebufferTexture2D(t.glName,i,p(t),e))),this._depthStencilBuffer){const i=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);t.framebufferRenderbuffer(e,i,t.RENDERBUFFER,this._depthStencilBuffer.glName)}else this._depthStencilTexture&&this._framebufferTexture2D(this._depthStencilTexture.glName,t.DEPTH_STENCIL_ATTACHMENT,p(this._depthStencilTexture),e);(0,o.en)()&&t.checkFramebufferStatus(e)!==t.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=i,this._initialized=!0}_framebufferTexture2D(e,t=a.Nm.COLOR_ATTACHMENT0,i=a.Ap.TEXTURE_2D,n=a.R.FRAMEBUFFER,r=0){this._context.gl.framebufferTexture2D(n,t,i,e,r)}_disposeDepthStencilAttachments(){const e=this._context.gl;if(this._depthStencilBuffer){if(this._initialized){this._context.bindFramebuffer(this);const t=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);e.framebufferRenderbuffer(a.R.FRAMEBUFFER,t,e.RENDERBUFFER,null)}this._depthStencilBuffer=(0,r.WD)(this._depthStencilBuffer)}this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture=(0,r.WD)(this._depthStencilTexture))}_validateTextureDescriptor(e){e.target!==a.Ap.TEXTURE_2D&&e.target!==a.Ap.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),f(e,this._context.parameters.maxTextureSize),this._validateBufferDimensions(e)}_validateRenderBufferDescriptor(e){f(e,this._context.parameters.maxRenderbufferSize),this._validateBufferDimensions(e)}_validateBufferDimensions(e){e.width<=0&&(e.width=this.width),e.height<=0&&(e.height=this.height),this.width>0&&this.height>0&&(this.width===e.width&&this.height===e.height||console.error("Attachment size must match framebuffer size!"))}_getGLAttachmentPoint(e){switch(e.internalFormat){case a.yQ.DEPTH_COMPONENT16:case a.yQ.DEPTH_COMPONENT24:case a.yQ.DEPTH_COMPONENT32F:return this._context.gl.DEPTH_ATTACHMENT;case a.yQ.DEPTH24_STENCIL8:case a.yQ.DEPTH32F_STENCIL8:case a.yQ.DEPTH_STENCIL:return this._context.gl.DEPTH_STENCIL_ATTACHMENT;case a.yQ.STENCIL_INDEX8:return this._context.gl.STENCIL_ATTACHMENT}}_validateColorAttachmentPoint(e){if(-1===h._MAX_COLOR_ATTACHMENTS){const{gl:e}=this._context;h._MAX_COLOR_ATTACHMENTS=e.getParameter(e.MAX_COLOR_ATTACHMENTS)}const t=e-a.Nm.COLOR_ATTACHMENT0;t+1>h._MAX_COLOR_ATTACHMENTS&&n.A.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${t+1}. Implementation supports up to ${h._MAX_COLOR_ATTACHMENTS} color attachments`)}}function d(e){return null!=e&&"type"in e&&e.type===l.p.Texture}function f(e,t){const i=Math.max(e.width,e.height);if(i>t){n.A.getLogger("esri.views.webgl.FramebufferObject").warn(`Resizing FBO attachment size ${e.width}x${e.height} to device limit ${t}`);const r=t/i;return e.width=Math.round(e.width*r),e.height=Math.round(e.height*r),!1}return!0}function p(e){return e.descriptor.target===a.Ap.TEXTURE_CUBE_MAP?a.Ap.TEXTURE_CUBE_MAP_POSITIVE_X:a.Ap.TEXTURE_2D}h._MAX_COLOR_ATTACHMENTS=-1},95904:function(e,t,i){i.d(t,{B:function(){return x}}),i(58941);var n=i(41835),r=i(85456);const s=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"],o=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"],a=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"],l=["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT","textureSize","texelFetch"];var u=999,c=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function h(e){return function(e){var t=function(){var e,t,i,n=0,r=0,s=u,h=[],d=[],f=1,p=0,m=0,_=!1,g=!1,y="";return function(e){return d=[],null!==e?x(e.replace?e.replace(/\r\n/g,"\n"):e):(h.length&&v(h.join("")),s=10,v("(eof)"),d)};function v(e){e.length&&d.push({type:c[s],data:e,position:m,line:f,column:p})}function x(t){var o;for(n=0,i=(y+=t).length;e=y[n],n<i;){switch(o=n,s){case 0:n=T();break;case 1:case 2:n=w();break;case 3:n=P();break;case 4:n=A();break;case 11:n=M();break;case 5:n=C();break;case 9999:n=E();break;case 9:n=S();break;case u:n=b()}o!==n&&("\n"===y[o]?(p=0,++f):++p)}return r+=n,y=y.slice(n),d}function b(){return h=h.length?[]:h,"/"===t&&"*"===e?(m=r+n-1,s=0,t=e,n+1):"/"===t&&"/"===e?(m=r+n-1,s=1,t=e,n+1):"#"===e?(s=2,m=r+n,n):/\s/.test(e)?(s=9,m=r+n,n):(_=/\d/.test(e),g=/[^\w_]/.test(e),m=r+n,s=_?4:g?3:9999,n)}function S(){return/[^\s]/g.test(e)?(v(h.join("")),s=u,n):(h.push(e),t=e,n+1)}function w(){return"\r"!==e&&"\n"!==e||"\\"===t?(h.push(e),t=e,n+1):(v(h.join("")),s=u,n)}function T(){return"/"===e&&"*"===t?(h.push(e),v(h.join("")),s=u,n+1):(h.push(e),t=e,n+1)}function P(){if("."===t&&/\d/.test(e))return s=5,n;if("/"===t&&"*"===e)return s=0,n;if("/"===t&&"/"===e)return s=1,n;if("."===e&&h.length){for(;I(h););return s=5,n}if(";"===e||")"===e||"("===e){if(h.length)for(;I(h););return v(e),s=u,n+1}var i=2===h.length&&"="!==e;if(/[\w_\d\s]/.test(e)||i){for(;I(h););return s=u,n}return h.push(e),t=e,n+1}function I(e){for(var t,i,n=0;;){if(t=a.indexOf(e.slice(0,e.length+n).join("")),i=a[t],-1===t){if(n--+e.length>0)continue;i=e.slice(0,1).join("")}return v(i),m+=i.length,(h=h.slice(i.length)).length}}function M(){return/[^a-fA-F0-9]/.test(e)?(v(h.join("")),s=u,n):(h.push(e),t=e,n+1)}function A(){return"."===e||/[eE]/.test(e)?(h.push(e),s=5,t=e,n+1):"x"===e&&1===h.length&&"0"===h[0]?(s=11,h.push(e),t=e,n+1):/[^\d]/.test(e)?(v(h.join("")),s=u,n):(h.push(e),t=e,n+1)}function C(){return"f"===e&&(h.push(e),t=e,n+=1),/[eE]/.test(e)||"-"===e&&/[eE]/.test(t)?(h.push(e),t=e,n+1):/[^\d]/.test(e)?(v(h.join("")),s=u,n):(h.push(e),t=e,n+1)}function E(){if(/[^\d\w_]/.test(e)){var i=h.join("");return s=o.indexOf(i)>-1?8:l.indexOf(i)>-1?7:6,v(h.join("")),s=u,n}return h.push(e),t=e,n+1}}(),i=[];return(i=i.concat(t(e))).concat(t(null))}(e)}const d=new Set(["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"]);function f(e,t){for(let i=t-1;i>=0;i--){const t=e[i];if("whitespace"!==t.type&&"block-comment"!==t.type){if("keyword"!==t.type)break;if("attribute"===t.data||"in"===t.data)return!0}}return!1}function p(e,t,i,n){n=n||i;for(const r of e)if("ident"===r.type&&r.data===i)return n in t?t[n]++:t[n]=0,p(e,t,n+"_"+t[n],n);return i}function m(e,t,i="afterVersion"){function n(e,t){for(let i=t;i<e.length;i++){const t=e[i];if("operator"===t.type&&";"===t.data)return i}return null}const r={data:"\n",type:"whitespace"},s=t=>t<e.length&&/[^\r\n]$/.test(e[t].data);let o=function(e){let t=-1,r=0,s=-1;for(let o=0;o<e.length;o++){const a=e[o];if("preprocessor"===a.type&&(/#(if|ifdef|ifndef)\s+.+/.test(a.data)?++r:/#endif\s*.*/.test(a.data)&&--r),"afterVersion"!==i&&"afterPrecision"!==i||"preprocessor"===a.type&&a.data.startsWith("#version")&&(s=Math.max(s,o)),"afterPrecision"===i&&"keyword"===a.type&&"precision"===a.data){const t=n(e,o);if(null===t)throw new Error("precision statement not followed by any semicolons!");s=Math.max(s,t)}t<s&&0===r&&(t=o)}return t+1}(e);s(o-1)&&e.splice(o++,0,r);for(const i of t)e.splice(o++,0,i);s(o-1)&&s(o)&&e.splice(o,0,r)}function _(e,t,i,n="lowp"){m(e,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:n},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}function g(e,t,i,n,r="lowp"){m(e,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:n.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}function y(e,t){let i,n,r=-1;for(let s=t;s<e.length;s++){const t=e[s];if("operator"===t.type&&("["===t.data&&(i=s),"]"===t.data)){n=s;break}"integer"===t.type&&(r=parseInt(t.data,10))}return i&&n&&e.splice(i,n-i+1),r}function v(e,t){if(e.startsWith("#version 300"))return e;const i=h(e);if("300 es"===function(e,t="100",i="300 es"){const n=/^\s*#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const r of e)if("preprocessor"===r.type){const e=n.exec(r.data);if(e){const n=e[1].replaceAll(/\s{2,}/g," ");if(n===i)return n;if(n===t)return r.data="#version "+i,t;throw new Error("unknown glsl version: "+n)}}return e.splice(0,0,{type:"preprocessor",data:"#version "+i},{type:"whitespace",data:"\n"}),null}(i,"100","300 es"))return e;let n=null,o=null;const a={},l={};for(let e=0;e<i.length;++e){const u=i[e];switch(u.type){case"keyword":t===r.Co.VERTEX_SHADER&&"attribute"===u.data?u.data="in":"varying"===u.data&&(u.data=t===r.Co.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(u.data.trim())&&(u.data=u.data.replaceAll(/(2D|Cube|EXT)/g,"")),t===r.Co.FRAGMENT_SHADER&&"gl_FragColor"===u.data&&(n||(n=p(i,a,"fragColor"),_(i,n,"vec4")),u.data=n),t===r.Co.FRAGMENT_SHADER&&"gl_FragData"===u.data){const t=y(i,e+1),n=p(i,a,"fragData");g(i,n,"vec4",t,"mediump"),u.data=n}else t===r.Co.FRAGMENT_SHADER&&"gl_FragDepthEXT"===u.data&&(o||(o=p(i,a,"gl_FragDepth")),u.data=o);break;case"ident":if(s.includes(u.data)){if(t===r.Co.VERTEX_SHADER&&f(i,e))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");u.data in l||(l[u.data]=p(i,a,u.data)),u.data=l[u.data]}}}for(let e=i.length-1;e>=0;--e){const t=i[e];if("preprocessor"===t.type){const n=t.data.match(/#extension\s+(.*):/);if(n?.[1]&&d.has(n[1].trim())){const t=i[e+1];i.splice(e,t&&"whitespace"===t.type?2:1)}const r=t.data.match(/#ifdef\s+(.*)/);r?.[1]&&d.has(r[1].trim())&&(t.data="#if 1");const s=t.data.match(/#ifndef\s+(.*)/);s?.[1]&&d.has(s[1].trim())&&(t.data="#if 0")}}return u=function(e){return e.map((e=>"eof"!==e.type?e.data:"")).join("")}(i),u;var u}new Map;class x{constructor(e,t,i,s,o=new Map,a=[]){this._context=e,this._locations=s,this._uniformBlockBindings=o,this._transformFeedbackVaryings=a,this._refCount=1,this._compiled=!1,this._linesOfCode=0,this._nameToUniformLocation=new Map,this._nameToUniform1=new Map,this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,e||console.error("RenderingContext isn't initialized!"),0===t.length&&console.error("Shaders source should not be empty!"),t=v(t,r.Co.VERTEX_SHADER),i=v(i,r.Co.FRAGMENT_SHADER),this._vShader=b(this._context,r.Co.VERTEX_SHADER,t),this._fShader=b(this._context,r.Co.FRAGMENT_SHADER,i),w.enabled&&(this._linesOfCode=t.match(/\n/g).length+i.match(/\n/g).length+2,this._context.instanceCounter.increment(r.vt.LinesOfCode,this._vShader,this._linesOfCode)),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(r.vt.Shader,this),(0,n.Xc)()&&(this.vertexShader=t,this.fragmentShader=i),this.usedMemory=t.length+i.length;const l=this._context.gl,u=l.createProgram();l.attachShader(u,this._vShader),l.attachShader(u,this._fShader),this._locations.forEach(((e,t)=>l.bindAttribLocation(u,e,t))),this._transformFeedbackVaryings?.length&&l.transformFeedbackVaryings(u,this._transformFeedbackVaryings,l.SEPARATE_ATTRIBS),l.linkProgram(u),(0,n.Xc)()&&!l.getProgramParameter(u,l.LINK_STATUS)&&console.error(`Could not link shader\nvalidated: ${l.getProgramParameter(u,l.VALIDATE_STATUS)}, gl error ${l.getError()}, vertex: ${l.getShaderParameter(this._vShader,l.COMPILE_STATUS)}, fragment: ${l.getShaderParameter(this._fShader,l.COMPILE_STATUS)}, info log: ${l.getProgramInfoLog(u)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`);for(const[e,t]of this._uniformBlockBindings){const i=l.getUniformBlockIndex(u,e);i<4294967295&&l.uniformBlockBinding(u,i,t)}this._glName=u,this._context.instanceCounter.increment(r.vt.Program,this)}get glName(){return this._glName}get hasGLName(){return null!=this._glName}get hasTransformFeedbackVaryings(){return!!this._transformFeedbackVaryings?.length}get compiled(){if(this._compiled)return!0;const e=this._context.gl.getExtension("KHR_parallel_shader_compile");return null==e||null==this.glName?(this._compiled=!0,!0):(this._compiled=!!this._context.gl.getProgramParameter(this.glName,e.COMPLETION_STATUS_KHR),this._compiled)}dispose(){if(--this._refCount>0)return;const e=this._context.gl,t=this._context.instanceCounter;this._nameToUniformLocation.forEach((e=>e&&t.decrement(r.vt.Uniform,e))),this._nameToUniformLocation.clear(),this._vShader&&(this._linesOfCode>0&&(t.decrement(r.vt.LinesOfCode,this._vShader,this._linesOfCode),this._linesOfCode=0),e.deleteShader(this._vShader),this._vShader=null,t.decrement(r.vt.Shader,this)),this._fShader&&(e.deleteShader(this._fShader),this._fShader=null),this._glName&&(e.deleteProgram(this._glName),this._glName=null,t.decrement(r.vt.Program,this))}ref(){++this._refCount}_getUniformLocation(e){const t=this._nameToUniformLocation.get(e);if(void 0!==t)return t;if(this.glName){const t=this._context.gl.getUniformLocation(this.glName,e);return this._nameToUniformLocation.set(e,t),t&&this._context.instanceCounter.increment(r.vt.Uniform,t),t}return null}hasUniform(e){return null!=this._getUniformLocation(e)}setUniform1i(e,t){const i=this._nameToUniform1.get(e);void 0!==i&&t===i||(this._context.gl.uniform1i(this._getUniformLocation(e),t),this._nameToUniform1.set(e,t))}setUniform1iv(e,t){S(this._nameToUniform1v,e,t)&&this._context.gl.uniform1iv(this._getUniformLocation(e),t)}setUniform2iv(e,t){S(this._nameToUniform2,e,t)&&this._context.gl.uniform2iv(this._getUniformLocation(e),t)}setUniform3iv(e,t){S(this._nameToUniform3,e,t)&&this._context.gl.uniform3iv(this._getUniformLocation(e),t)}setUniform4iv(e,t){S(this._nameToUniform4,e,t)&&this._context.gl.uniform4iv(this._getUniformLocation(e),t)}setUniform1f(e,t){const i=this._nameToUniform1.get(e);void 0!==i&&t===i||(this._context.gl.uniform1f(this._getUniformLocation(e),t),this._nameToUniform1.set(e,t))}setUniform1fv(e,t){S(this._nameToUniform1v,e,t)&&this._context.gl.uniform1fv(this._getUniformLocation(e),t)}setUniform2f(e,t,i){const n=this._nameToUniform2.get(e);void 0===n?(this._context.gl.uniform2f(this._getUniformLocation(e),t,i),this._nameToUniform2.set(e,[t,i])):t===n[0]&&i===n[1]||(this._context.gl.uniform2f(this._getUniformLocation(e),t,i),n[0]=t,n[1]=i)}setUniform2fv(e,t){S(this._nameToUniform2,e,t)&&this._context.gl.uniform2fv(this._getUniformLocation(e),t)}setUniform3f(e,t,i,n){const r=this._nameToUniform3.get(e);void 0===r?(this._context.gl.uniform3f(this._getUniformLocation(e),t,i,n),this._nameToUniform3.set(e,[t,i,n])):t===r[0]&&i===r[1]&&n===r[2]||(this._context.gl.uniform3f(this._getUniformLocation(e),t,i,n),r[0]=t,r[1]=i,r[2]=n)}setUniform3fv(e,t){const i=this._getUniformLocation(e);null!=i&&S(this._nameToUniform3,e,t)&&this._context.gl.uniform3fv(i,t)}setUniform4f(e,t,i,n,r){const s=this._nameToUniform4.get(e);void 0===s?(this._context.gl.uniform4f(this._getUniformLocation(e),t,i,n,r),this._nameToUniform4.set(e,[t,i,n,r])):void 0!==s&&t===s[0]&&i===s[1]&&n===s[2]&&r===s[3]||(this._context.gl.uniform4f(this._getUniformLocation(e),t,i,n,r),s[0]=t,s[1]=i,s[2]=n,s[3]=r)}setUniform4fv(e,t){const i=this._getUniformLocation(e);null!=i&&S(this._nameToUniform4,e,t)&&this._context.gl.uniform4fv(i,t)}setUniformMatrix3fv(e,t,i=!1){const n=this._getUniformLocation(e);null!=n&&S(this._nameToUniformMatrix3,e,t)&&this._context.gl.uniformMatrix3fv(n,i,t)}setUniformMatrix4fv(e,t,i=!1){const n=this._getUniformLocation(e);null!=n&&S(this._nameToUniformMatrix4,e,t)&&this._context.gl.uniformMatrix4fv(n,i,t)}stop(){}}function b(e,t,i){const s=e.gl,o=s.createShader(t);return s.shaderSource(o,i),s.compileShader(o),(0,n.Xc)()&&!s.getShaderParameter(o,s.COMPILE_STATUS)&&(console.error("Compile error in ".concat(t===r.Co.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(s.getShaderInfoLog(o)),console.error(function(e){let t=2;return e.replaceAll("\n",(()=>"\n"+function(e){return e>=1e3?e.toString():("  "+e).slice(-3)}(t++)+":"))}(i))),o}function S(e,t,i){const n=e.get(t);if(!n)return e.set(t,Array.from(i)),!0;const r=i.length;if(n.length!==r)return e.set(t,Array.from(i)),!0;for(let e=0;e<r;++e){const t=i[e];if(n[e]!==t){for(n[e]=t;e<r;++e)n[e]=i[e];return!0}}return!1}const w={enabled:!1}},10904:function(e,t,i){i.d(t,{r:function(){return r}});var n=i(95904);function r(e,t,i=""){return new n.B(e,i+t.shaders.vertexShader,i+t.shaders.fragmentShader,t.attributes)}},49414:function(e,t,i){i.d(t,{l:function(){return o}});var n=i(85456),r=i(69452),s=i(15167);class o{constructor(e,t){this._context=e,this._descriptor=t,this.type=r.p.RenderBuffer,this._context.instanceCounter.increment(n.vt.Renderbuffer,this);const i=this._context.gl;this.glName=i.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:s,height:o,internalFormat:a,multisampled:l}=t;l?i.renderbufferStorageMultisample(i.RENDERBUFFER,this.samples,a,s,o):i.renderbufferStorage(i.RENDERBUFFER,a,s,o),this._context.bindRenderbuffer(null)}get descriptor(){return this._descriptor}get samples(){const e=this._descriptor.samples,t=this._context.parameters.maxSamples;return e?Math.min(e,t):t}get usedMemory(){return(0,s.e)(this._descriptor)}resize(e,t){const i=this._descriptor;if(i.width===e&&i.height===t)return;i.width=e,i.height=t;const n=this._context.gl;this._context.bindRenderbuffer(this),i.multisampled?n.renderbufferStorageMultisample(n.RENDERBUFFER,this.samples,i.internalFormat,i.width,i.height):n.renderbufferStorage(n.RENDERBUFFER,i.internalFormat,i.width,i.height),this._context.bindRenderbuffer(null)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(n.vt.Renderbuffer,this),this._context=null)}}},15167:function(e,t,i){i.d(t,{e:function(){return s},q:function(){return r}});var n=i(93380);class r{constructor(e,t,i=t){this.internalFormat=e,this.width=t,this.height=i,this.multisampled=!1,this.samples=1}}function s(e){return e.width<=0||e.height<=0||null==e.internalFormat?0:e.width*e.height*(0,n.IB)(e.internalFormat)}},65644:function(e,t,i){i.d(t,{Z:function(){return n}});class n{constructor(e){this._readFile=e}resolveIncludes(e){return this._resolve(e)}_resolve(e,t=new Map){if(t.has(e))return t.get(e);const i=this._read(e);if(!i)throw new Error(`cannot find shader file ${e}`);const n=/^[^\S\n]*#include\s+<(\S+)>[^\S\n]?/gm;let r=n.exec(i);const s=[];for(;null!=r;)s.push({path:r[1],start:r.index,length:r[0].length}),r=n.exec(i);let o=0,a="";return s.forEach((e=>{a+=i.slice(o,e.start),a+=t.has(e.path)?"":this._resolve(e.path,t),o=e.start+e.length})),a+=i.slice(o),t.set(e,a),a}_read(e){return this._readFile(e)}}},81438:function(e,t,i){i.d(t,{Z:function(){return u}});var n=i(40633),r=i(95929),s=i(24540),o=i(85456),a=i(93380);const l=()=>n.A.getLogger("esri.views.webgl.VertexArrayObject");let u=class{constructor(e,t,i,n,r=null){this._context=e,this._locations=t,this._layout=i,this._buffers=n,this._indexBuffer=r,this._glName=null,this._initialized=!1}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get byteSize(){return Array.from(this._buffers.values()).reduce(((e,t)=>e+t.usedMemory),null!=this._indexBuffer?this._indexBuffer.usedMemory:0)}get layout(){return this._layout}get locations(){return this._locations}get usedMemory(){return this.byteSize+(Object.keys(this._buffers).length+(this._indexBuffer?1:0))*s.zQ}dispose(){this._context?(this._context.getBoundVAO()===this&&this._context.bindVAO(null),this._buffers.forEach((e=>e.dispose())),this._buffers.clear(),this._indexBuffer=(0,r.WD)(this._indexBuffer),this.disposeVAOOnly()):(this._glName||Object.getOwnPropertyNames(this._buffers).length>0)&&l().warn("Leaked WebGL VAO")}disposeVAOOnly(){this._glName&&(this._context.gl.deleteVertexArray(this._glName),this._glName=null,this._context.instanceCounter.decrement(o.vt.VertexArrayObject,this)),this._context=null}initialize(){if(this._initialized)return;const{gl:e}=this._context,t=e.createVertexArray();e.bindVertexArray(t),this._bindLayout(),e.bindVertexArray(null),this._glName=t,this._context.instanceCounter.increment(o.vt.VertexArrayObject,this),this._initialized=!0}bind(){this.initialize(),this._context.gl.bindVertexArray(this.glName)}_bindLayout(){const{_buffers:e,_layout:t,_indexBuffer:i}=this;e||l().error("Vertex buffer dictionary is empty!");const n=this._context.gl;this._buffers.forEach(((e,i)=>{const n=t.get(i);n?(0,a.yu)(this._context,this._locations,e,n):l().error("Vertex element descriptor is empty!")})),null!=i&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,i.glName)}unbind(){this.initialize(),this._context.gl.bindVertexArray(null)}}}}]);
//# sourceMappingURL=layers-SubtypeGroupLayerView2D.js.map