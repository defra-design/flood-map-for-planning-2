{"version":3,"file":"FeatureSnappingEngine.js","mappings":"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","sources":["webpack://defra/./node_modules/@arcgis/core/core/support/UpdatingHandles.js","webpack://defra/./node_modules/@arcgis/core/layers/support/FeatureFilter.js","webpack://defra/./node_modules/@arcgis/core/layers/support/floorFilterUtils.js","webpack://defra/./node_modules/@arcgis/core/views/interactive/snapping/FeatureSnappingSourceInfo.js","webpack://defra/./node_modules/@arcgis/core/views/interactive/snapping/FeatureSnappingEngine.js","webpack://defra/./node_modules/@arcgis/core/views/support/layerViewUtils.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport{_ as s}from\"../../chunks/tslib.es6.js\";import e from\"../Accessor.js\";import{makeHandle as t}from\"../handleUtils.js\";import{watch as i,when as n,on as d,sync as a}from\"../reactiveUtils.js\";import{schedule as r}from\"../scheduling.js\";import{property as o}from\"../accessorSupport/decorators/property.js\";import{subclass as l}from\"../accessorSupport/decorators/subclass.js\";let h=class extends e{constructor(){super(...arguments),this.updating=!1,this._handleId=0,this._scheduleHandleId=0,this._pendingPromises=new Set}destroy(){this.removeAll()}add(s,e,t={}){return this._installWatch(s,e,t,i)}addWhen(s,e,t={}){return this._installWatch(s,e,t,n)}addOnCollectionChange(s,e,{initial:i=!1,final:n=!1}={}){const r=++this._handleId;return this.addHandles([d(s,\"after-changes\",this._createSyncUpdatingCallback(),a),d(s,\"change\",e,{onListenerAdd:i?s=>e({added:s.toArray(),removed:[]}):void 0,onListenerRemove:n?s=>e({added:[],removed:s.toArray()}):void 0})],r),t((()=>this.removeHandles(r)))}addPromise(s){if(null==s)return s;const e=++this._handleId;this.addHandles(t((()=>{this._pendingPromises.delete(s)&&(0!==this._pendingPromises.size||this.hasHandles(c)||this._set(\"updating\",!1))})),e),this._pendingPromises.add(s),this._set(\"updating\",!0);const i=()=>this.removeHandles(e);return s.then(i,i),s}removeAll(){this._pendingPromises.clear(),this.removeAllHandles(),this._set(\"updating\",!1)}_installWatch(s,e,i={},n){const d=++this._handleId;i.sync||this._installSyncUpdatingWatch(s,d);const a=n(s,e,i);return this.addHandles(a,d),t((()=>this.removeHandles(d)))}_installSyncUpdatingWatch(s,e){const t=this._createSyncUpdatingCallback(),n=i(s,t,{sync:!0,equals:()=>!1});return this.addHandles(n,e),n}_createSyncUpdatingCallback(){return()=>{this.removeHandles(c),++this._scheduleHandleId;const s=this._scheduleHandleId;this._get(\"updating\")||this._set(\"updating\",!0),this.addHandles(r((()=>{s===this._scheduleHandleId&&(this._set(\"updating\",this._pendingPromises.size>0),this.removeHandles(c))})),c)}}};s([o({readOnly:!0})],h.prototype,\"updating\",void 0),h=s([l(\"esri.core.support.UpdatingHandles\")],h);const c=-42;export{h as UpdatingHandles};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import{geometryTypes as t}from\"../../geometry.js\";import{JSONMap as i}from\"../../core/jsonMap.js\";import{JSONSupport as r}from\"../../core/JSONSupport.js\";import{clone as s}from\"../../core/lang.js\";import{property as o}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/has.js\";import\"../../core/Logger.js\";import{subclass as n}from\"../../core/accessorSupport/decorators/subclass.js\";import l from\"../../rest/support/Query.js\";import a from\"../../time/TimeExtent.js\";var p;const c=new i({esriSpatialRelIntersects:\"intersects\",esriSpatialRelContains:\"contains\",esriSpatialRelCrosses:\"crosses\",esriSpatialRelDisjoint:\"disjoint\",esriSpatialRelEnvelopeIntersects:\"envelope-intersects\",esriSpatialRelIndexIntersects:\"index-intersects\",esriSpatialRelOverlaps:\"overlaps\",esriSpatialRelTouches:\"touches\",esriSpatialRelWithin:\"within\",esriSpatialRelRelation:\"relation\"}),m=new i({esriSRUnit_Meter:\"meters\",esriSRUnit_Kilometer:\"kilometers\",esriSRUnit_Foot:\"feet\",esriSRUnit_StatuteMile:\"miles\",esriSRUnit_NauticalMile:\"nautical-miles\",esriSRUnit_USNauticalMile:\"us-nautical-miles\"});let u=p=class extends r{constructor(e){super(e),this.where=null,this.geometry=null,this.spatialRelationship=\"intersects\",this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null}createQuery(e={}){const{where:t,geometry:i,spatialRelationship:r,timeExtent:o,objectIds:n,units:a,distance:p}=this;return new l({geometry:s(i),objectIds:s(n),spatialRelationship:r,timeExtent:s(o),where:t,units:a,distance:p,...e})}clone(){const{where:e,geometry:t,spatialRelationship:i,timeExtent:r,objectIds:o,units:n,distance:l}=this;return new p({geometry:s(t),objectIds:s(o),spatialRelationship:i,timeExtent:s(r),where:e,units:n,distance:l})}};e([o({type:String,json:{write:!0}})],u.prototype,\"where\",void 0),e([o({types:t,json:{write:!0}})],u.prototype,\"geometry\",void 0),e([o({type:c.apiValues,json:{name:\"spatialRel\",read:{reader:c.read},write:{allowNull:!1,writer:c.write,overridePolicy(){return{enabled:null!=this.geometry}}}}})],u.prototype,\"spatialRelationship\",void 0),e([o({type:Number,json:{write:{overridePolicy(e){return{enabled:null!=e&&null!=this.geometry}}}}})],u.prototype,\"distance\",void 0),e([o({type:[Number],json:{write:!0}})],u.prototype,\"objectIds\",void 0),e([o({type:m.apiValues,json:{read:m.read,write:{writer:m.write,overridePolicy(e){return{enabled:null!=e&&null!=this.geometry}}}}})],u.prototype,\"units\",void 0),e([o({type:a,json:{write:!0}})],u.prototype,\"timeExtent\",void 0),u=p=e([n(\"esri.layers.support.FeatureFilter\")],u);const d=u;export{d as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nfunction o(o){const n=o.layer;if(\"floorInfo\"in n&&n.floorInfo?.floorField&&\"floors\"in o.view){return l(o.view.floors,n.floorInfo.floorField)}return null}function n(o,n){return\"floorInfo\"in n&&n.floorInfo?.floorField?l(o,n.floorInfo.floorField):null}function l(o,n){if(!o?.length)return null;const l=o.filter((o=>\"\"!==o)).map((o=>`'${o}'`));return l.push(\"''\"),`${n} IN (${l.join(\",\")}) OR ${n} IS NULL`}export{o as getFloorFilterClause,n as getLayerFloorFilterClause};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import t from\"../../../core/Accessor.js\";import has from\"../../../core/has.js\";import r from\"../../../core/Logger.js\";import{watch as i,syncAndInitial as l}from\"../../../core/reactiveUtils.js\";import{sqlAnd as s}from\"../../../core/sql.js\";import{property as o}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/RandomLCG.js\";import{subclass as a}from\"../../../core/accessorSupport/decorators/subclass.js\";import n from\"../../../layers/support/FeatureFilter.js\";import{getFloorFilterClause as u}from\"../../../layers/support/floorFilterUtils.js\";import{isSubtypeGroupLayer as p,isFeatureLayer as d}from\"../../../layers/support/layerUtils.js\";import{isUtilityNetworkWebMap as c}from\"./snappingUtils.js\";import{scaleBoundsPredicate as y}from\"../../support/layerViewUtils.js\";let f=class extends t{set attributeRulesEnabled(e){this._set(\"attributeRulesEnabled\",e),e&&this.loadRules()}get layerView(){return this.view?.allLayerViews?.find((e=>e.layer===this.layer))}get valid(){const{_valid:e,snappingSource:t,layer:r}=this;return!(!t||!r)&&e}get subtypeFilter(){const{layer:e,snappingSource:t}=this;if(!p(e)||!e.subtypes?.length||!t)return{mode:\"not-in-use\",filter:null};const r=t.layerSource.sublayerSources.filter((e=>e.enabled&&e.layer.visible&&y(this.view?.scale,e.layer.effectiveScaleRange.minScale,e.layer.effectiveScaleRange.maxScale))).map((e=>e.layer.subtypeCode));if(!r.length)return{mode:\"none-visible\",filter:null};if(r.length===e.subtypes.length)return{mode:\"all-visible\",filter:null};const i=e.fieldsIndex.get(e.subtypeField)?.name??e.subtypeField;return 1===r.length?{mode:\"in-use\",filter:`${i} = ${r.getItemAt(0)}`}:{mode:\"in-use\",filter:`${i} IN (${r.join(\", \")})`}}get floorFilter(){const{view:e,layer:t}=this;return e&&t?u({view:e,layer:t}):null}constructor(e){super(e),this.layer=null,this.snappingSource=null,this.rulesTable=null,this._valid=null}initialize(){if(!this.snappingSource||!this.layer)return void(this._valid=!1);const{layer:e,snappingSource:t}=this;if(\"refresh\"in e){const r=e;this.addHandles(r.on(\"refresh\",(()=>t.refresh())))}this.loadRules(),this.addHandles([i((()=>t.updating),(e=>t.layerSource.updating=e),l),i((()=>t.availability),(e=>t.layerSource.availability=e),l)])}getFetchCandidatesParameters(e,t,r){if(!this.valid)return[];const{layer:i,layerView:l,floorFilter:o,rulesTable:a,subtypeFilter:u}=this,y={distance:r,mode:this.view?.type??\"2d\",point:e,coordinateHelper:t.coordinateHelper,...h(),filter:l&&\"filter\"in l?l.filter:null};if(o&&(y.filter=m(y.filter,o)),\"not-in-use\"!==u.mode&&\"all-visible\"!==u.mode){if(\"none-visible\"===u.mode)return[];y.filter?y.filter.where=s(y.filter.where,u.mode):y.filter=new n({where:u.filter})}if(!this.attributeRulesEnabled)return[y];const f=t.feature,v=\"subtype-sublayer\"===f?.sourceLayer?.type?f.sourceLayer.parent:f?.sourceLayer;if(a&&f&&c(this.view?.map)&&(d(i)||p(i))&&i.layerId&&(d(v)||p(v))&&this.view.map.utilityNetworks?.find((e=>e.isUtilityLayer(v)))){if(\"loaded\"!==a.loadStatus)return[];const e=[],t=i.layerId,r=a.getFeatureSQL(v,f)?.[t];if(!r)return[];const l=r.anyVertex;let s=r.endVertex;return s&&l&&s===l&&(s=\"\"),s&&e.push({...y,returnEdge:!1,vertexMode:\"ends\",filter:m(y.filter,s)}),l&&e.push({...y,returnEdge:has(\"snapping-include-edges-when-applying-any-vertex-rule\")??!1,vertexMode:\"all\",filter:m(y.filter,l)}),e}return[y]}async loadRules(){this._valid=null;const{layer:e,view:t,attributeRulesEnabled:i}=this;if(i&&e&&t&&c(t?.map)&&(d(e)||p(e)))try{await Promise.allSettled(t.map.utilityNetworks?.map((e=>e.load()))??[]);const r=t.map.utilityNetworks?.find((t=>t.isUtilityLayer(e)));r&&(this.rulesTable=await r.getRulesTable(),await(this.rulesTable?.load()))}catch(l){return this._valid=!1,void r.getLogger(\"esri.views.interactive.snapping.FeatureSnappingSourceInfo\").error(\"Failed to load rules table for snapping source\",e.title)}this._valid=!0}remove(){this.destroy()}destroy(){this.snappingSource?.destroy()}};function h(){return{returnEdge:!0,vertexMode:\"all\"}}function m(e,t){return null==e?new n({where:t}):e.where?new n({where:s(e.where,t)}):new n({where:t})}e([o({constructOnly:!0})],f.prototype,\"layer\",void 0),e([o({constructOnly:!0})],f.prototype,\"snappingSource\",void 0),e([o({constructOnly:!0})],f.prototype,\"view\",void 0),e([o({value:!1})],f.prototype,\"attributeRulesEnabled\",null),e([o()],f.prototype,\"layerView\",null),e([o()],f.prototype,\"rulesTable\",void 0),e([o()],f.prototype,\"valid\",null),e([o()],f.prototype,\"subtypeFilter\",null),e([o()],f.prototype,\"floorFilter\",null),e([o()],f.prototype,\"_valid\",void 0),f=e([a(\"esri.views.interactive.snapping.FeatureSnappingSourceInfo\")],f);export{f as FeatureSnappingSourceInfo};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import t from\"../../../core/Accessor.js\";import{isSome as r}from\"../../../core/arrayUtils.js\";import{destroyHandle as a}from\"../../../core/handleUtils.js\";import\"../../../core/has.js\";import{allSettledValues as n,throwIfAborted as s}from\"../../../core/promiseUtils.js\";import{mapCollectionAsync as i,watch as o,sync as c}from\"../../../core/reactiveUtils.js\";import{getMetersPerUnitForSR as u,getMetersPerVerticalUnitForSR as l}from\"../../../core/unitUtils.js\";import{property as p}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/Logger.js\";import{subclass as d}from\"../../../core/accessorSupport/decorators/subclass.js\";import{squaredDistance as m}from\"../../../core/libs/gl-matrix-2/math/vec2.js\";import{s as g,c as h}from\"../../../chunks/vec32.js\";import{create as S}from\"../../../core/libs/gl-matrix-2/factories/vec3f64.js\";import{getEpsilon as f}from\"../../../core/libs/gl-matrix-2/math/common.js\";import{UpdatingHandles as y}from\"../../../core/support/UpdatingHandles.js\";import{absoluteHeightElevationInfo as _}from\"../../../support/elevationInfoUtils.js\";import{VerticalHalfPlaneConstraint as v}from\"../sketch/constraints.js\";import{fromAnyMapPoint as w,markAsTarget as j,asVec2 as F}from\"../sketch/normalizedPoint.js\";import{FeatureSnappingSourceInfo as b}from\"./FeatureSnappingSourceInfo.js\";import{SnappingDomain as x}from\"./SnappingDomain.js\";import{sortCandidatesInPlace as C,screenDistance as R}from\"./snappingUtils.js\";import{DrapedEdgeSnappingCandidate as E}from\"./candidates/DrapedEdgeSnappingCandidate.js\";import{EdgeSnappingCandidate as M}from\"./candidates/EdgeSnappingCandidate.js\";import{FeatureSnappingCandidate as L}from\"./candidates/FeatureSnappingCandidate.js\";import{RightAngleSnappingCandidate as I,OtherVertexType as G}from\"./candidates/RightAngleSnappingCandidate.js\";import{vectorToScreenPoint as H}from\"../support/viewUtils.js\";let P=class extends t{get updating(){return this._snappingSources.some((e=>null==e?.valid||!0===e.valid&&!0===e.snappingSource?.updating))||this._updatingHandles.updating}constructor(e){super(e),this.options=null,this._domain=x.FEATURE,this._updatingHandles=new y,this._sourceModules={featureService:{module:null,loader:null},featureCollection:{module:null,loader:null},graphics:{module:null,loader:null},notes:{module:null,loader:null},scene:{module:null,loader:null}}}initialize(){const e=i((()=>this.options?._effectiveFeatureSources),((e,t)=>this._createSourceInfo(e,t)));this._snappingSources=e,this.addHandles([a(e),o((()=>({rulesEnabled:!!this.options?.attributeRulesEnabled,sources:this._snappingSources.filter(r)})),(({rulesEnabled:e,sources:t})=>{for(const r of t)r.attributeRulesEnabled=e}),c)])}destroy(){this._set(\"options\",null),this._updatingHandles.destroy()}async fetchCandidates(e,t,r,a){if(!(t&this._domain&&null!=this.options&&this.options.effectiveFeatureEnabled))return[];const i=[],o=this._computeScreenSizeDistanceParameters(e,r);for(const n of this._snappingSources){if(!n?.valid||!n.snappingSource?.layerSource?.enabled||n.layerView?.suspended)continue;const t=n.getFetchCandidatesParameters(e,r,o);for(const e of t)i.push(n.snappingSource.fetchCandidates(e,a).then((e=>e.filter((e=>!this._candidateIsExcluded(n.snappingSource,e,r.excludeFeature))))))}const c=(await n(i)).flat();return this._addRightAngleCandidates(c,e,o,r),s(a),C(e,c),c}_addRightAngleCandidates(e,t,r,a){const n=null!=a.vertexHandle?a.vertexHandle.rightEdge?.rightVertex?.pos:null!=a.editGeometryOperations&&\"polygon\"===a.editGeometryOperations.data.type?a.editGeometryOperations.data.components[0]?.getFirstVertex()?.pos:null,s=null!=a.vertexHandle?a.vertexHandle.leftEdge?.leftVertex?.pos:null!=a.editGeometryOperations?a.editGeometryOperations.data.components[0]?.getLastVertex()?.pos:null,{view:i}=this,o=w(n,i,a),c=w(s,i,a),u=e.length;for(let l=0;l<u;l++)this._addRightAngleCandidate(e[l],c,t,r,e),this._addRightAngleCandidate(e[l],o,t,r,e)}_addRightAngleCandidate(e,t,r,a,n){if(null==t||!A(e))return;const s=e.constraint.closestTo(t),i=(s[0]-r[0])/a.x,o=(s[1]-r[1])/a.y,{start:c,end:u}=e.constraint;if(i*i+o*o<=1){const r=m(F(s),F(c))>m(F(s),F(u))?c:u,a=new I({targetPoint:j(s),otherVertex:t,otherVertexType:G.NEXT,previousVertex:r,constraint:new v(t,s),objectId:e.objectId,isDraped:e.isDraped,domain:x.FEATURE});n.push(a)}}_computeScreenSizeDistanceParameters(e,t){let r=null!=this.options?this.options.distance*(\"touch\"===t.pointer?this.options.touchSensitivityMultiplier:1):0;return null==this.view?{x:r,y:r,z:r,distance:r}:\"2d\"===this.view.type?(r*=this.view.resolution,{x:r,y:r,z:r,distance:r}):this._computeScreenSizeDistanceParameters3D(e,r,this.view,t)}_computeScreenSizeDistanceParameters3D(e,t,r,a){const{spatialReference:n}=a;r.renderCoordsHelper.toRenderCoords(e,n,D);const s=r.state.camera.computeScreenPixelSizeAt(D),i=s*r.renderCoordsHelper.unitInMeters,o=i/u(n),c=i/l(n),p=t*o,d=t*c,m=H(e,n,_,r),g=m?z(m,e,o,0,0,r,a):0,h=m?z(m,e,0,o,0,r,a):0,S=m?z(m,e,0,0,c,r,a):0;return{x:0===g?0:p/g,y:0===h?0:p/h,z:0===S?0:d/S,distance:s*t}}_candidateIsExcluded(e,t,r){if(null==r)return!1;const a=this._getCandidateObjectId(t);if(null==a)return!1;const n=e.layerSource.layer;return\"graphics\"===n.type?r.uid===a:r.sourceLayer===n&&(!(!r.attributes||!(\"objectIdField\"in n))&&r.attributes[n.objectIdField]===a)}_getCandidateObjectId(e){return e instanceof L?e.objectId:null}async _createSourceInfo(e,t){const r=e.layer;r.loaded||(await r.load(),s(t));const{view:a}=this,n=await this._createFeatureSnappingSourceType(e);return s(t),new b(null==n?{}:{snappingSource:n,view:a,layer:r})}async _createFeatureSnappingSourceType(e){switch(e.layer.type){case\"feature\":case\"geojson\":case\"csv\":case\"oriented-imagery\":case\"subtype-group\":case\"wfs\":return this._createFeatureSnappingSourceFeatureLayer(e);case\"graphics\":return this._createFeatureSnappingSourceGraphicsLayer(e);case\"map-notes\":return this._createFeatureSnappingSourceMapNotesLayer(e);case\"scene\":case\"building-scene\":return this._createFeatureSnappingSourceSceneLayer(e)}return null}async _createFeatureSnappingSourceSceneLayer(e){const{view:t}=this;if(null==t||\"3d\"!==t.type)return null;return new((await this._getSourceModule(\"scene\")).SceneLayerSnappingSource)({layerSource:e,view:t})}async _createFeatureSnappingSourceFeatureLayer(e){switch(e.layer.source?.type){case\"feature-layer\":case\"oriented-imagery\":return new((await this._getSourceModule(\"featureService\")).FeatureServiceSnappingSource)({spatialReference:this.spatialReference,view:this.view,layerSource:e});case\"memory\":case\"csv\":case\"geojson\":case\"wfs\":if(\"mesh\"===e.layer.geometryType)return null;return new((await this._getSourceModule(\"featureCollection\")).FeatureCollectionSnappingSource)({layerSource:e,view:this.view})}return null}async _createFeatureSnappingSourceGraphicsLayer(e){return new((await this._getSourceModule(\"graphics\")).GraphicsSnappingSource)({getGraphicsLayers:()=>[e.layer],spatialReference:this.spatialReference,view:this.view,layerSource:e})}async _createFeatureSnappingSourceMapNotesLayer(e){return new((await this._getSourceModule(\"notes\")).GraphicsSnappingSource)({getGraphicsLayers:()=>e.layer.sublayers?.toArray()??[],spatialReference:this.spatialReference,view:this.view,layerSource:e})}async _getSourceModule(e){const t=this._sourceModules[e];if(null==t.loader){const t=this._loadSourceModule(e),r={module:null,loader:t};this._sourceModules[e]=r;const a=await t,n={module:a,loader:t};return this._sourceModules[e]=n,a}return null==t.module?t.loader:t.module}_loadSourceModule(e){const t=this._updatingHandles;switch(e){case\"featureService\":return t.addPromise(import(/* webpackChunkName: \"featureSources-FeatureServiceSnappingSource\" */ \"./featureSources/FeatureServiceSnappingSource.js\"));case\"featureCollection\":return t.addPromise(import(/* webpackChunkName: \"featureSources-FeatureCollectionSnappingSource\" */ \"./featureSources/FeatureCollectionSnappingSource.js\"));case\"graphics\":case\"notes\":return t.addPromise(import(/* webpackChunkName: \"featureSources-GraphicsSnappingSource\" */ \"./featureSources/GraphicsSnappingSource.js\"));case\"scene\":return t.addPromise(import(/* webpackChunkName: \"featureSources-SceneLayerSnappingSource\" */ \"./featureSources/SceneLayerSnappingSource.js\"))}}get test(){}};function A(e){return(e instanceof M||e instanceof E)&&!U(e)}function U({constraint:{start:e,end:t}}){const r=g(e,t),a=m(F(e),F(t));return r<f()||a/r<T}function z(e,t,r,a,n,s,{spatialReference:i}){const o=h(O,t);o[0]+=r,o[1]+=a,o[2]+=n;const c=H(o,i,_,s);return c?R(c,e):1/0}e([p({constructOnly:!0})],P.prototype,\"spatialReference\",void 0),e([p({constructOnly:!0})],P.prototype,\"view\",void 0),e([p()],P.prototype,\"options\",void 0),e([p({readOnly:!0})],P.prototype,\"updating\",null),e([p()],P.prototype,\"_snappingSources\",void 0),P=e([d(\"esri.views.interactive.snapping.FeatureSnappingEngine\")],P);const D=S(),O=S(),T=1e-4;export{P as FeatureSnappingEngine};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport e from\"../../core/Error.js\";function n(e){return e&&\"function\"==typeof e.highlight}function t(e){return e&&\"function\"==typeof e.maskOccludee}function i(e,n,t){return null==e||e>=t&&(0===n||e<=n)}function r(e,n){if(n&&e){const{minScale:t,maxScale:r}=e;if(c(t,r))return i(n,t,r)}return!0}function c(e,n){return null!=e&&e>0||null!=n&&n>0}function a(e){return!e?.minScale||!e.maxScale||e.minScale>=e.maxScale}function u(e){const n=e.effectiveScaleRange;return{minScale:n?.minScale??0,maxScale:n?.maxScale??0}}function l(e){return null!=e&&\"object\"==typeof e&&\"createQuery\"in e&&\"queryFeatures\"in e&&\"layer\"in e&&\"view\"in e}function o(n,t,i){return new e(\"layerview:spatial-reference-incompatible\",`The spatial reference of this ${n}${t?`(wkid:${t})`:\"\"} is incompatible with the spatial reference of the view${i?`(wkid:${i})`:\"\"}.`,{})}export{u as extractSafeScaleBounds,n as highlightsSupported,r as isInEffectiveScaleRange,c as isScaleRangeActive,l as isSelectableLayerView2D,t as occludeesSupported,i as scaleBoundsPredicate,o as spatialReferenceIncompatibleError,a as validateScaleRange};\n"],"names":["h","constructor","super","arguments","this","updating","_handleId","_scheduleHandleId","_pendingPromises","Set","destroy","removeAll","add","s","e","t","_installWatch","addWhen","addOnCollectionChange","initial","i","final","n","r","addHandles","_createSyncUpdatingCallback","onListenerAdd","added","toArray","removed","onListenerRemove","removeHandles","addPromise","delete","size","hasHandles","c","_set","then","clear","removeAllHandles","d","sync","_installSyncUpdatingWatch","a","equals","_get","readOnly","prototype","p","esriSpatialRelIntersects","esriSpatialRelContains","esriSpatialRelCrosses","esriSpatialRelDisjoint","esriSpatialRelEnvelopeIntersects","esriSpatialRelIndexIntersects","esriSpatialRelOverlaps","esriSpatialRelTouches","esriSpatialRelWithin","esriSpatialRelRelation","m","esriSRUnit_Meter","esriSRUnit_Kilometer","esriSRUnit_Foot","esriSRUnit_StatuteMile","esriSRUnit_NauticalMile","esriSRUnit_USNauticalMile","u","where","geometry","spatialRelationship","distance","objectIds","units","timeExtent","createQuery","o","clone","l","type","String","json","write","types","apiValues","name","read","reader","allowNull","writer","overridePolicy","enabled","Number","layer","floorInfo","floorField","view","floors","length","filter","map","push","join","f","attributeRulesEnabled","loadRules","layerView","allLayerViews","find","valid","_valid","snappingSource","subtypeFilter","subtypes","mode","layerSource","sublayerSources","visible","scale","effectiveScaleRange","minScale","maxScale","subtypeCode","fieldsIndex","get","subtypeField","getItemAt","floorFilter","rulesTable","initialize","on","refresh","availability","getFetchCandidatesParameters","y","point","coordinateHelper","returnEdge","vertexMode","feature","v","sourceLayer","parent","layerId","utilityNetworks","isUtilityLayer","loadStatus","getFeatureSQL","anyVertex","endVertex","has","Promise","allSettled","load","getRulesTable","getLogger","error","title","remove","constructOnly","value","P","_snappingSources","some","_updatingHandles","options","_domain","FEATURE","_sourceModules","featureService","module","loader","featureCollection","graphics","notes","scene","_effectiveFeatureSources","_createSourceInfo","rulesEnabled","sources","fetchCandidates","effectiveFeatureEnabled","_computeScreenSizeDistanceParameters","suspended","_candidateIsExcluded","excludeFeature","flat","_addRightAngleCandidates","vertexHandle","rightEdge","rightVertex","pos","editGeometryOperations","data","components","getFirstVertex","leftEdge","leftVertex","getLastVertex","_addRightAngleCandidate","constraint","start","end","T","U","A","closestTo","x","targetPoint","otherVertex","otherVertexType","NEXT","previousVertex","objectId","isDraped","domain","pointer","touchSensitivityMultiplier","z","resolution","_computeScreenSizeDistanceParameters3D","spatialReference","renderCoordsHelper","toRenderCoords","D","state","camera","computeScreenPixelSizeAt","unitInMeters","g","S","_getCandidateObjectId","uid","attributes","objectIdField","loaded","_createFeatureSnappingSourceType","_createFeatureSnappingSourceFeatureLayer","_createFeatureSnappingSourceGraphicsLayer","_createFeatureSnappingSourceMapNotesLayer","_createFeatureSnappingSourceSceneLayer","_getSourceModule","source","geometryType","getGraphicsLayers","sublayers","_loadSourceModule","test","O","highlight"],"sourceRoot":""}